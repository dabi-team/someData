IEEE TRANSACTIONS ON SUSTAINABLE ENERGY

1

Optimal Scheduling of Isolated Microgrids Using
Automated Reinforcement Learning-based
Multi-period Forecasting

Yang Li, Senior Member, IEEE, Ruinong Wang, Zhen Yang

1
2
0
2

g
u
A
5
1

]
P
S
.
s
s
e
e
[

1
v
4
6
7
6
0
.
8
0
1
2
:
v
i
X
r
a

the
Abstract—In order to reduce the negative impact of
uncertainty of load and renewable energies outputs on micro-
grid operation, an optimal scheduling model
is proposed for
isolated microgrids by using automated reinforcement learning-
based multi-period forecasting of renewable power generations
and loads. Firstly, a prioritized experience replay automated
reinforcement learning (PER-AutoRL) is designed to simplify
the deployment of deep reinforcement learning (DRL)-based
forecasting model in a customized manner, the single-step multi-
period forecasting method based on PER-AutoRL is proposed for
the ﬁrst time to address the error accumulation issue suffered
by existing multi-step forecasting methods, then the prediction
values obtained by the proposed forecasting method are revised
via the error distribution to improve the prediction accuracy;
secondly, a scheduling model considering demand response is con-
structed to minimize the total microgrid operating costs, where
the revised forecasting values are used as the dispatch basis, and
a spinning reserve chance constraint is set according to the error
distribution; ﬁnally, by transforming the original scheduling
model into a readily solvable mixed integer linear programming
via the sequence operation theory (SOT), the transformed model
is solved by using CPLEX solver. The simulation results show
that compared with the traditional scheduling model without
forecasting, this approach manages to signiﬁcantly reduce the
system operating costs by improving the prediction accuracy.

Index Terms—Microgrid, optimal scheduling, automated re-
inforcement learning, uncertainty handling, single-step multi-
period forecasting, sequence operation theory.

I. INTRODUCTION

W ITH the gradual depletion of fossil fuels, the deteriorat-

ing ecological environment, combined with traditional
centralized power supply exposes many shortcomings,
the
proportion of renewable power generation in power system is
increasing due to its sustainability and environmental friend-
liness [1]. As an effective carrier of distributed generations
(DGs), a microgrid has been widely used in power systems in
recent years. In-depth research and accelerated construction
of microgrids can promote the large-scale integration of DGs
and renewable energy sources, which contributes to reshaping
today’s power system toward a sustainable and clean energy
system. However, due to the uncertainty of renewable energy

This work is partly supported by the Natural Science Foundation of Jilin
Province, China under Grant No. 2020122349JC. (Corresponding author:
Yang Li.)

Y. Li and R. Wang are with the School of Electrical Engineering, Northeast
Electric Power University, Jilin 132012, China (e-mail: liyang@neepu.edu.cn;
624895223@qq.com).

Z. Yang is with the State Grid Beijing Electric Power Company, Xicheng

District, Beijing 100032, China (e-mail: 1678084931@qq.com).

generation and load, this has caused a strong obstacle to day-
ahead dispatching plans of a microgrid [2]. It’s known that
an accurate forecasting result can provide a reliable basis for
dispatching plans to arrange the start and stop of microturbines
(MT) and set the spinning reserve capacity. A scheduling
model combined with advanced forecasting methods can un-
doubtedly reduce the impact of the uncertainty of renewable
generations and load on microgrids, and improve the economy
of microgrid operation [3].

A. Literature Review

Forecasting methods of renewable energy generation and
load have been extensively investigated. As far as current fore-
casting methods are concerned, they are mainly divided into
two categories. 1) One is the traditional time series analysis
method: In the 1970s, George Box and Gwilym Jenkins pro-
posed the “Box-Jenkins method”, Ref. [4] used this method for
the ﬁrst time for short-term load forecasting, and subsequently,
more modern mathematical theories were applied to power
system forecasting. In [5], a gray theory was used to predict
electricity prices and renewable energy power generation, and
[6] used probability forecasting methods to predict the load.
However, traditional time series forecasting methods heavily
rely on the choice of model parameters, the appropriate model
parameters can largely determine the accuracy of the predicted
results, and they have a poor generic capability. 2) Another one
is machine learning (ML) algorithms such as support vector
machines and artiﬁcial neural networks: Ref. [7] used support
vector regression to ﬁnely predict the load of the distribution
network and an artiﬁcial neural network (ANN) was used
to forecast photovoltaic (PV) power output in [8]; With the
development of computer technology and the advent of the era
of big data, deep learning has become a hot spot in forecasting
methods; In [9], long short term memory (LSTM) network
was used to predict load, and a more sophisticated neural
network was proposed in [10], which combined convolutional
neural network (CNN) with gated recurrent unit (GRU) to
predict renewable energy outputs, electricity price, and load.
But traditional supervised learning needs high-quality datasets
for training to obtain a perfect forecasting performance, which
limits the application of such methods in real-world systems to
a certain extent. Reinforcement learning, which has received
widespread attention, has also been applied to building energy
consumption forecasting [11]. Compared with traditional time
series analysis methods, forecasting methods based on ma-
chine learning can provide more accurate prediction results,

 
 
 
 
 
 
IEEE TRANSACTIONS ON SUSTAINABLE ENERGY

2

but such kind of methods require a lot of domain knowledge
and human interventions when constructing a forecasting
model, which seriously affects the efﬁciency of model con-
struction and the model’s versatility. As is known, accurate
multi-period forecasting results are necessary for microgrid
day-ahead scheduling. Unfortunately, these methods used in
the aforementioned literature can only guarantee a certain
accuracy for multi-period prediction issues, which poses a
signiﬁcant barrier for developing a forecasting model with
high performances in practical applications. In this context, our
motivation is to leverage reinforcement learning framework
for renewable energy and load forecasting so that compared
with supervised learning, which is more robust and more
potential connections can be learned under the same amount
of information to improve the performance of a forecasting
model [12].

For isolated microgrids, how to deal with the uncertainty
of renewable energy output and load is a crucial problem due
to its relatively small capacity and unavailability to obtain the
power support from the main grids. An economic operation
model of microgrid was proposed in [13] earlier, on the basis
of including multiple forms of DGs, the model considered
the constraints of microgrid cogeneration, reserve capacity,
etc. Ref. [14] adopted the method of robust programming,
expressed the variation range of wind turbine (WT) output
and load according to the uncertainty set. In order to improve
the operating economy of the microgrid, Ref. [15] used mul-
tivariate global sensitivity analysis to identify and retain the
key uncertain factors that affect the operation of the system. In
[16], authors ﬁtted the best probability distribution based on
historical data of WT output and load, then used the chance
constraint programming method for microgrid dispatch. This
method balanced the economy and reliability of microgrid
operation, but
it used WT output and load data in their
expectation form as the input for scheduling, which was not
able to provide a reliable basis for the dispatch model. In [17],
authors used LSTM to predict PV output and load, and then
used particle swarm optimization to optimize the scheduling
model. However, in this method, the forecasting model and
the scheduling model are two separate parts.

It can be seen from the above literature that the existing
research has made an in-depth discussion on the optimal
scheduling of microgrids, however, there are still the following
gaps that need to be addressed:

1) The architecture and hyperparameters of a machine
learning model have a signiﬁcant
impact on model
performances, and building a learning model requires
lots of domain knowledge and human interventions.
2) The prediction accuracies of most existing forecasting
models are not ideal for multi-period prediction, which
cannot provide reliable data support for microgrid day-
ahead scheduling.

3) The existing forecasting approaches rarely consider un-
certainty modeling of forecasting errors and the impact
of the errors on forecasting results, which will inevitably
deteriorate the forecasting performance.

4) Most of current microgrid scheduling models adopt the
load and renewable energy generations in the form of

ﬁxed values or rough estimations, and do not combine a
sophisticated forecasting model to establish an organic
dynamic integration.

B. Contribution of This Paper

The main contributions of this paper are the following

fourfold:

1) A prioritized experience replay automated reinforcement
learning (PER-AutoRL) is designed to predict renewable
energy outputs and load in a customized manner, which
can automatically determine the most appropriate model
architecture and optimize hyperparameters based on the
input data. This design will improve modeling efﬁciency,
strengthen the combination of forecasting and schedul-
ing, and provide reliable data support for scheduling.
2) We propose a multi-period single-step forecasting
method based on PER-AutoRL, which can signiﬁcantly
improve the forecasting accuracy by solving the error
accumulation issues suffered by traditional multi-step
forecasting methods.

3) By modeling uncertainty of forecasting errors, we con-
sider the impact of the errors on the prediction accuracy,
and revise the predicted values according to the error
distribution described by the t location-scale (TLS) dis-
tribution to further improve the forecasting performance.
4) We construct a microgrid scheduling model integrating
the designed forecasting method with consideration of
demand response, which can signiﬁcantly reduce the
microgrid operating costs.

II. FORECASTING MODEL BASED ON PRIORITIZED
EXPERIENCE REPLAY AUTOMATED REINFORCEMENT
LEARNING

A. Deep Deterministic Policy Gradient

Deep reinforcement learning (DRL) is a combination of
deep learning and reinforcement
learning, which provides
solutions for the perception and decision-making problems
of sophisticated systems [18]. As a powerful DRL algorithm,
deep deterministic policy gradient (DDPG) has demonstrated
a powerful ability in dealing with continuous action space
problems.

In DDPG, deep neural networks with parameters θµ and
θQ are used to represent the main actor network, a = π(s|θµ)
and the main critic network, Q(s, a|θQ). The main function
of the Actor part is to interact with the environment, that is,
directly select the output action, a according to state, s, and
get the next state, s(cid:48) and reward, r after interacting with the
environment. The objective function is the total reward with a
discount factor γ, which is formulated as

J(θµ) = Eθµ[r1 + γr2 + γ2r3 + ... + γi−1ri]
To improve the total reward J, the objective function is
optimized through the stochastic gradient. Silver et al. proved
that the gradient of the objective function with respect to θµ is
equivalent to the expectation gradient of the Q-value function
with respect to θQ [19], when updating the main actor network,
the gradient can be approximated as

(1)

IEEE TRANSACTIONS ON SUSTAINABLE ENERGY

3

Algorithm 1 AutoRL with Prioritized Experience Replay

∇θµ J ≈

1
N

i

(cid:88)

[∇aQ(s, a|θQ)|s=si,a=π(si)∇θµπ(s|θµ)|s = si]

(2)
The main function of the Critic part is to evaluate the
strategy proposed by the Actor. The main critic network is
updated with the goal of minimizing the loss function, the
loss function is as follows:

L(θQ) = Es,a,r,s(cid:48)D(T D − error)2

(3)
)] − Q(s, a|θQ) (4)

T D − error = [r + γQ(cid:48)(s(cid:48), π(s(cid:48)|θµ(cid:48)
where Q(cid:48) is the target Q-value function; θµ(cid:48)
denote
the parameters of the target actor network and the target critic
network, respectively.

and θQ(cid:48)

)|θQ(cid:48)

The target networks of the Actor and Critic part are con-
structed mainly to make the network training more stable, their
parameters can be updated with a soft update factor ς every
ﬁxed period of time:
θQ(cid:48)
θµ(cid:48)

← ςθQ + (1 − ς)θQ(cid:48)
← ςθµ + (1 − ς)θµ(cid:48)

(5)

B. PER-AutoRL

Automated machine learning (AutoML) can be regarded as
a system with powerful learning and generalization capabilities
on given data and tasks. For traditional machine learning,
obtaining a model with good performances often requires a
lot of experts’ experience and human debugging. AutoML
is designed to reduce the demand for data scientists and
enable domain experts to automatically build ML applications
without much requirement for statistical and ML knowledge,
it can undoubtedly improve the efﬁciency of model design and
reduce the difﬁculty in applying ML.

To simplify the deployment of DRL models and improve the
efﬁciency, we propose a PER-AutoRL by extending AutoML
to DRL. We use the Metis method, a type of sequence-based
Bayesian optimization algorithm, to determine the architecture
of the DRL model and optimize the hyperparameters [20]. By
using the DDPG algorithm as an overall framework, the Actor
part makes predictions based on the input data and the Critic
part evaluates the prediction results and obtains the optimal
prediction policy in this study, which enables the perception
ability of deep learning to integrate the decision-making ability
of reinforcement learning for solving the forecasting problem.
We set the actor network and the critic network to a ﬁx
depth feed-forward fully-connected neural network, and then
determine the network architecture according to the size of
each layer and the activation function, and then optimize the
hyperparameters in the model.

For DRL, an appropriate reward function can improve the
performance of the model. In this respect, we set a reward
function pool to store a reward function that may be applicable
and treat the reward function as a hyperparameter, which is
optimized in synchronization with other hyperparameters. For
the prediction problem studied in this paper, the absolute error
σ, mean absolute error (MAE), mean square error (MSE),
mean absolute percentage error (MAPE), root mean square
error (RMSE) and the coefﬁcient of determination R2 are

3:
4:
5:
6:
7:
8:

9:
10:
11:
12:

13:

14:
15:

Initialize: Neural network architecture θµ, θQ.
Initialize: Replay buffer R with size S, reward function.
Initialize: Maximum priority, parameters ι, β.
1: for trail = 1, ..., M do
2:

Select new neural network architecture θµ, θQ according to
the Metis Tuner.
Select reward function from reward function pool.
Select an initial state st from state space.
for t=1, ..., H do

Select action at according to the new policy.
Obtain reward rt and new state st+1.
Store experience (st, at, rt, st+1) in replay buffer R and
set Dt = maxi<t Di.
if t > S then

for j=1, ..., N do

Sample experience j with probability P (j).
Compute importance-sampling weight Wj and TD-
error δj.
Update the priority of transition j according to abso-
lute TD-error |δj|.

end for
Update main critic network according to minimize the
(cid:80)
i wiδ2
loss function: L = 1
i .
N
Update main actor network according to (2).
Update target networks according to (5).

16:
17:
18:
19:
20:
21: end for
22: Select the best neural network architecture θµ, θQ and the best

end if
end for
Collect the testing MAPE and upload it to the Metis Tuner

policy π according to minimal MAPE.

23: return θµ, θQ,π

slightly modiﬁed as options of the reward function. Their
expressions are


−|σ| = −|yac
i − pi|
−M AE = −[(cid:80)N
−M SE = −[(cid:80)N
−M AP E = −[(cid:80)N

(cid:114)

−RM SE = −

R2 = 1 −

(cid:110)
[(cid:80)N




i=1 (|yac
i=1 (yac

i − pi|)]
i − pi)2]

(cid:46)

N

(cid:46)

N

(cid:46)

N

i=1 |(yac
[(cid:80)N

i − pi)/yac
|]
i
(cid:46)
i − pi)2]
(cid:46)
[(cid:80)N

i=1 (yac
i − pi)2]

i=1 (yac

N

i=1 (yac

2
i − yac
i )

(cid:111)
]

(6)
where N is the number of samples, yac is the actual value,
yac is the mean value of yac, and p is the prediction result.

Compared with ML, DRL has more hyperparameters that
need to be optimized, which will affect
the efﬁciency of
the AutoRL. This work adopts Prioritized Experience Replay
(PER) to improve the experience replay mechanism in DDPG,
which greatly reduces the training time [21]. The core of
PER is to increase the frequency of valuable experiences.
A repeated replay of extreme experience helps accelerate the
agent recognize how to choose the right action to obtain high
reward, or avoid the terrible results of choosing the wrong
action. The DDPG updates the critic network according to
TD-errors. the larger its absolute value, the more aggressive
the correction of the critic network, which means that the
experience has a higher value. Therefore, this paper selects
the absolute value of TD-errors as the experience evaluation

IEEE TRANSACTIONS ON SUSTAINABLE ENERGY

4

index to rank the experience and deﬁnes the probability P (j)
of the sampled experience j according to this rank.

P (j) =

Dι
j
j=1 Dι
j
where Dj =
rank(j) , rank(j) is the rank of experience j, N
is the total number of experience stored in the reply buffer, ι
is a parameter controlling the prioritization.

(cid:80)N

(7)

1

To avoid frequent sampling of high TD-errors experiences
that may cause the neural network to oscillate or diverge,
we set the importance-sampling weight for the critic network
updates:

Wj =

1
Sβ · P (j)β

(8)

where S is the size of the reply buffer, parameter β controls
to what extent the correction is used.

The integrated algorithm of PER-AutoRL is shown in

Algorithm 1.

C. Multi-period Forecasting Based on PER-AutoRL

The multi-period forecasting methods can be divided into
two categories: multi-step forecasting and single-step forecast-
ing. The former takes the prediction results of each step to
make next prediction; while the latter is based on the real
value in the previous period to predict the next-period value;
after each prediction step, the real value in the previous period
needs to be updated for the next-period prediction. The single-
step forecasting cannot provide complete prediction results
for day-ahead scheduling, because the real values of each
period cannot be updated timely. And it should be noted that
the errors accumulation is inevitable in multi-step forecasting,
resulting in a decrease in the forecasting accuracy.

This paper proposes a multi-period forecasting method
based on PER-AutoRL, which transforms the multi-step fore-
casting problem into a multi-period single-step forecasting
problem. The proposed method addresses the error accumula-
tion issue and improves the prediction accuracy, the speciﬁc
procedure is as follows:

1) Dataset preprocessing. Extract

the data in the same
period of a day from the dataset and reconstruct it into
multiple sets of new time series (this work uses 1h as
the time interval to reconstruct the dataset into 24 new
time series).

2) Constructing PER-AutoRL model. The different archi-
tecture and hyperparameters of the PER-AutoRL model
for predicting each time series are automatically deter-
mined according to the separate new time series. For the
prediction problem in this study, we select the data of the
same period in 7 consecutive days to construct a matrix
as the state s, and then the agent outputs a predicted
value as the action a based on its observed state. The
loss function of the main actor network aims to minimize
the forecasting errors, while the loss function of the main
critic network is built for minimizing the gaps between
the predicted value and the true value of the reward.
3) Training PER-AutoRL model. The weight matrices and
biases of the main actor network and the main critic

Fig. 1: Probability distribution of forecasting errors.

network are determined until the predetermined number
of training episodes is completed.

4) Day-ahead forecasting. Respectively forecast the values
in each period, then integrate the forecasting results of
each group to form a forecasting data for the next 24
hours.

5) Revising forecasting results. After obtaining the error
distribution via the forecasting errors of PER-AutoRL,
we calculate the expected values of errors, then revise
the forecasting values based on them. The revised fore-
casting results are used as the input of the scheduling
model and the error expected values of PER-AutoRL are
prepared for the determination of the spinning reserve
in the scheduling.

By constructing a multi-period single-step prediction model
based on PER-AutoRL, the error accumulation is effectively
solved. In addition, beneﬁts from the training methods and ex-
ploration capabilities of DRL, the robustness and practicability
of the prediction model have been improved [12].

D. Uncertainty Modeling of Forecasting Errors and Revised
Forecasting Results

1) Stochastic Model of Forecasting Errors: In this paper,
TLS distribution is used to describe the probability distribution
of the PER-AutoRL prediction errors [22]:
2
ϑ + ( x−µ
ε )
ϑ

Γ( ϑ+1
2 )
√
ϑπΓ( ϑ
2 )
where Γ is the gamma function, µ is the mean value, ε is the
standard deviation, and ϑ is the shape coefﬁcient.

f (x; µ, ε, ϑ) =

]−ϑ+1/2

(9)

ε

[

Fig. 1 is a ﬁtting diagram of the probability distribution
of WT output forecasting errors for a total of one year
from January 1, 2018 to December 31, 2019. It can be seen
from Fig. 1 that compared with the normal distribution and
logistic distribution, the TLS distribution can better describe
the forecasting error probability distribution.

2) Revised Forecasting Results: To obtain a more accurate
forecasting result, we acquire the expectation of error via
the distribution of the prediction errors, and then modify the
forecasting results. The calculation process is:
L,t − E(σL
t )
W T,t − E(σW T
P V,t − E(σP V
)

C(P P red
) = P P red
L,t
W T,t) = P P red
C(P P red
P V,t ) = P P red





C(P P red

(10)

)

t

t

IEEE TRANSACTIONS ON SUSTAINABLE ENERGY

5

L,t

), C(P P red

where C(P P red
W T,t), C(P P red
P V,t ) are the revised fore-
casting results of load, WT and PV outputs, respectively;
W T,t, P P red
, P P red
P P red
P V,t are the forecasting results of load, WT
L,t
and PV outputs; σL
are the forecasting errors
of load, WT and PV outputs; and E(σL
)
are the expectation of forecasting errors of load, WT and PV
outputs, respectively.

t ), E(σW T

t , σW T
t

), E(σP V

, σP V
t

t

t

3) Evaluation Indices: This paper evaluates the forecasting
methods based on the common prediction evaluation indicators
MAPE and RMSE [23].

III. SERIALIZATION MODELLING OF RANDOM VARIABLES
A. Sequence Operation Theory

Sequence operation theory (SOT) is a powerful mathemati-
cal tool for dealing with multiple uncertain variables. The core
idea is to acquire a probabilistic sequence of random variables
through discretization, and then generate a new sequence
through sequence operations [24].

Suppose the discrete sequence a(i) of length Na satisﬁes

the following conditions:
Na(cid:88)

a(ia) = 1, a(ia) ≥ 0, i = 0, 1, 2, ..., N a

ia=0

the sequence is regarded as a probabilistic sequence.

(11)

B. Sequence Description of Equivalent Load Forecasting Er-
rors

During period t, the forecasting errors σW T , σP V and σL
of WT, PV outputs, and load are all random variables. In this
study, it is assumed that the uncertainty of them does not affect
each other. After discretizating the continuous probability
distributions of WT outputs forecasting errors according to
the step length q, the probabilistic sequences a(ia,t) can be
obtained by

a(ia,t) =






min +q/2

(cid:82) σW T ,t
σW T ,t
min
(cid:82) σW T ,t
min +ia,tq+q/2
σW T ,t
min +ia,tq−q/2

fo(σW T )dσW T ,

ia,t = 0

fo(σW T )dσW T ,

(cid:82) σW T ,t
σW T ,t

min +ia,tq
min +ia,tq−q/2

ia,t > 0, ia,t (cid:54)= Na,t
fo(σW T )dσW T , ia,t = Na,t

Na,t = [ σW T ,t

max −σW T ,t
q

min

]

(12)
where fo is the probability density function, Na,t is the length
of the sequence, σW T,t
and σW T,t
are the minimum and
max
maximum values of WT outputs forecasting errors.

min

In the same way, the probabilistic sequence b(ib,t), d(id,t)
with length Nb,t, Nd,t of the PV outputs forecasting errors
and load forecasting errors can be obtained.

We deﬁne the equivalent load (EL) as the difference between
the load power and the joint outputs of WT and PV. The
probabilistic sequence c(ic, t) of the joint outputs forecasting
errors with length Nc,t can be obtained by addition-type-
convolution operation:

c(ic,t) = a(ia,t) ⊕ b(ib,t) = (cid:80)

ia,t+ib,t=ic,t

ic,t = 0, 1, ..., Na,t + Nb,t

a(ia,t)b(ib,t),

(13)

TABLE I: Prediction error of the EL and its probabilistic
sequence

Error(kW)

σEL,t
min

σEL,t
min + q

Probability

e(0)

e(1)

...

...

σEL,t
min + ie,tq

e(ie,t)

...

...

σEL,t
min + Ne,tq

e(Ne,t)

Then, subtraction-type-convolution is employed to calculate
the probabilistic sequence e(ie, t) of the EL forecasting errors
[25]:

e(ie,t) = d(id,t) (cid:9) c(ic,t)
(cid:40) (cid:80)
(cid:80)

id,t−ic,t=ie,t

=

d(id)c(ic), 1 ≤ ie,t ≤ Ne,t

id,t≤ic,t

d(id)c(ic), ie,t = 0

(14)
The corresponding relationship between prediction errors
of EL and their probabilistic sequence are shown in Tab. I,
where σEL,t
min denotes the minimum value of EL forecasting
errors, Ne,t is the length of e(ie,t). The expectation of e(ie,t)
can be calculated by

E(e) =

Ne,t
(cid:88)

ie,t=0

[(σEL,t

min + ie,tq) · e(ie,t)]

(15)

IV. OPTIMAL SCHEDULING MODEL OF MICROGRID
BASED ON PER-AUTORL FORECASTING

A. Optimal Scheduling Model

1) Objective Function: The objective function Fc of the
optimal scheduling model considering demand response is
constructed to minimize the total microgrid operating costs
that are comprised of the MT units fuel costs and the spinning
reserve costs. In light of the nature of the demand-side
loads,
this work divides electric load into ﬁxed load and
interruptible load. Since the load interruption inevitably affects
user experience, certain subsidies will generally be provided
to users [26], and the subsidies are also considered in the total
operating costs. The objective function is as follows:

min Fc =

T
(cid:80)
t=1

[

MG(cid:80)
n=1

(ςnRM T

n,t + τnSn,t + κP IE
+Un,t(ψn + ξnP M T

t

n,t ))]

(16)

where T denotes the total number of time period t in a
scheduling cycle (T =24 in this paper); MG denotes the total
number of MT units; n is the MT number; ψn and ξn
represent the consumption factors of MT n; Un,t and Sn,t
are 0-1 variables representing the state variable and the startup
variable of MT n, respectively; P IE
is the interruptible electric
load, and κ is the subsidies; ςn and τn denote the costs
of spinning reserves and the startup costs of MT n; P M T
n,t
and RM T
n,t are respectively the output power and the spinning
reserve of MT n in period t.
2) Constraint Conditions:

t

a) Power balance constraint: To maintain the power
balance of the isolated microgrid, the controllable loads need
to be deployed, so the power balance constraints are

MG(cid:88)

n=1

n,t +P DC
P M T

t − P CH

t = C(P P red
EL,t )

∀t

(17)

+P CN LOAD

n,t

− P IE
t

IEEE TRANSACTIONS ON SUSTAINABLE ENERGY

6

t ≤ ρC(P P red
P IE

EL,t ) ∀t

(18)

where PRess,t denotes the ESS reserve capacity.

W T,t + P P red
P V,t )
and P DC

L,t − (P P red
EL,t = P P red
P P red
where ρ is the ratio of P IE
, P CH
are the charging
t
and discharging power of the energy storage in period t,
P CN LOAD
is the predicted
value of the EL, C(P P red
EL,t , the
calculation process is as follows:

EL,t ) is the revised value of P P red

is the controllable load. P P red
EL,t

(19)

t

t

t

C(P P red

EL,t ) = P P red

L,t − E(σL

−[P P red

P V,t − E(σP V

t

t ) − [P P red
)]

W T,t − E(σW T

t

)]

(20)

b) MT output constraint: The output of MT must comply

with the following inequality:

Un,tP M T

n,min ≤ P M T
where P M T
n,max and P M T
the output power of MT unit n.

n,t ≤ Un,tP M T
n,min are the upper and lower limits of

n,max ∀t, n ∈ MG

(21)

c) Energy storage system constraints: In this paper, the
energy storage system (ESS) adopts lead-acid batteries to
balance the random ﬂuctuations in the microgrid because it
provides many advantages, such as low price and long service
life [27].

Charge-discharge equation: The relationship between the

ESS and the charge-discharge powers is expressed as

St+1 = St + (ηchP CH

t − P DC

t

/ηdc)∆t ∀t

(22)

where St+1 and St are respectively the ESS energy storage
at the beginning of period t + 1 and t, ηch and ηdc are the
charge/discharge efﬁciency, and ∆t denotes the duration of
each period, which is taken as 1h in this paper.

The output limits of lead-acid batteries:
(cid:26) 0 ≤ P DC
max ∀t
0 ≤ P CH
max ∀t

t ≤ P DC
t ≤ P CH

(23)

where P CH
battery charge and discharge in time period t, respectively.

max are the maximum values of lead-acid

max and P DC

It can be seen from (17) that when the power balance
constraint is considered, the EL is processed by the revised
prediction value C(P P red
EL,t ). Due to the uncertainty of load and
renewable energy outputs, the total spinning reserve provided
by ESS and MTs must be able to make up for the difference
between the ﬂuctuating EL and C(P P red

EL,t ).

When the extreme situation with zero renewable energy out-
puts occurs, the system needs a large spinning reserve capacity,
which will incur high spinning reserve costs. However, the
possibility of such cases occurring is very low. To balance
the reliability and economy in the economic operation of the
microgrid, the spinning reserve constraint can be expressed as
a chance constraint [16]:

Prob{

MG(cid:88)

n=1

RM T

n,t + PRess,t ≥ (P L

t −P W T

t −P P V

t

≥ α ∀t

By using




t = P P red
P L
P W T
= P P red
t
t = P P red
P P V

L,t − σL
t
W T,t − σW T
t
P V,t − σP V
t denotes load in period t; P W T
where P L
WT and PV outputs, respectively; C(P P red
by (20). Accordingly, (28) can be simpliﬁed to



t

)− C(P P red

EL,t )}

(28)

(29)

and P P V
are the
t
t
EL,t ) can be calculated

MG(cid:88)

Prob{

n=1

RM T

n,t +PRess,t ≥ E(σEL

t

)−(σL

t −σW T

t −σP V

t

)}

≥ α ∀t

(30)
where α is the preset conﬁdence level, and E(σEL
) is the
expectation of the EL forecasting error which can be obtained
by the method in Sec.III.

t

The capacity limit of lead-acid batteries is

B. Deterministic Transformation of Chance Constraints

Smin ≤ St ≤ Smax ∀t
where Smax and Smin are the maximum and minimum
allowable capacities of the batteries, respectively.
The ESS starting and ending constraints are

(24)

S0 = STend = S∗ ∀t
where S0 is the ESS initial energy storage, S∗ is the limit of
the initial energy storage in ESS, and Tend is the end of the
scheduling cycle (Tend=24h in this paper). For the ESS energy
balance, we set the remaining capacity STend of the ESS after
each scheduling cycle the same as S0.

(25)

d) Spinning reserve constraint: The spinning reserve is
an important resource for an isolated microgrid to suppress
the renewable DGs outputs ﬂuctuations and ensure the system
operates reliably. The required spinning reserves are provided
by the MT units and ESS. Therefore, the spinning reserve
constraints are expressed as

n.t + RM T
P M T

n,t ≤ Un,tP M T

PRess,t ≤ min{ηdc(St − Smin)/∆t, P DC

n,max ∀t, n ∈ MG
max − P DC

t

(26)

} ∀t

(27)

To facilitate the processing of (30), we design a new type

of 0-1 variable as follows:

Wie,t =





1,

(cid:88)MG
n=1

RM T

n,t + PRess,t ≥ E(σEL

t

) − (σEL,t

min + ie,tq)

0, otherwise

∀t, ie,t = 0, 1, ..., Ne,t

(31)

As Tab. I shows, the probability of EL forecasting error
min + ie,tq) is e(ie,t), so (30) can be transformed into

(σEL,t

Ne,t
(cid:88)

ie,t=0

Wie,t e(ie,t) ≥ α

(32)

The expression of Wie,t in (32) is not compatible with the
solution form of the mixed integer programming. In order to
solve the problem, (31) must be replaced by

M G
(cid:88)

(
n=1

RM T

n,t + PRess,t + σEL,t

min + ie,tq − E(σEL

t

))/Φ ≤ Wie,t

≤ 1 + (

M G
(cid:88)

n=1

RM T

n,t + PRess,t + σEL,t

min + ie,tq − E(σEL

t

(33)

))/Φ

∀t, ie,t = 0, 1, ..., Ne,t

IEEE TRANSACTIONS ON SUSTAINABLE ENERGY

7

Fig. 4: Hyperparameters optimization.

Fig. 5: Forecasting errors with different methods.

TABLE II: Main parameters of MT units

ψ($)

ξ($/Kw)

1.2
1.0

0.35
0.26

Pmin(Kw)
5
10

Pmax(Kw)
30
65

τ ($)

ζ($) N

1.6
3.5

0.04
0.04

2
1

sec. II-C to divide the datasets into 24 new time series, and
regard these as the original datasets for prediction. Finally,
the original datasets are divided at a ratio of 0.8:0.2 for model
training and testing.

We use this system to verify the feasibility of the scheduling
model based on PER-AutoRL forecasting. Tab. II shows the
speciﬁc parameters of the MTs in this system.

The parameters of
max=P DC
P DC
ηch = ηdc = 0.9.

lead-acid batteries are as follows:
max = 40kW, Smin = 32kW·h, Smax = 160kW·h,

B. Multi-period Renewable Power Outputs and Load Fore-
casting

For the prediction problem in this work, the proposed PER-
AutoRL will automatically determine the model architecture
and hyperparameters based on the input multi-sub time series
of WT, PV outputs, and load in a customized manner. Fig. 4
shows the optimization results of the hyperparameters required
by the PER-AutoRL to model the load data. Each curve in the
ﬁgure represents a set of hyperparameters, each ordinate axis
represents the values of various hyperparameters, and the last
ordinate is the negative MAPEs of using these hyperparameter
sets; the darker the color, the more appropriate the hyperpa-
rameters. It can be seen from the ﬁgure that our designed PER-
AutoRL manages to achieve satisfactory optimization results
in most cases, and only the MAPEs resulting by three sets
of hyperparameters are higher than 15%. Furthermore, only a
few optimization iterations are needed for the PER-AutoRL to
ﬁnd suitable hyperparameters. Therefore, these results prove
that our PER-AutoRL is able to automatically determine the

Fig. 2: Flowchart of the proposed scheduling model.

Fig. 3: The microgrid test system.

where Φ is a very large positive number in this formula. By
substituting (30) with (32) and (33), the model in Sec. IV-A
will be completely transformed into the form of the mixed
integer programming. The overall ﬂowchart of the proposed
scheduling model is shown in Fig. 2 .

V. CASE STUDY
To examine the effectiveness of the proposed approach, a
real-world microgrid in North China is used for numerical
simulation analysis. In this paper, Python is used as the
programming language and all simulations are performed on
a PC platform with 2 Intel Core dual-core CPUs (2.6Hz) and
6 GB RAM.

A.

Introduction of Test System

As shown in Fig. 3, the system is mainly composed of 3

MT units, a WT unit, a PV panel, and a battery pack.

In order to reasonably verify the rationality of the proposed
forecasting method, the 5 years of WT and PV outputs and
load data from the microgrid from January 1, 2015 to Decem-
ber 31, 2019 are adopted. Then use the method described in

IEEE TRANSACTIONS ON SUSTAINABLE ENERGY

8

Fig. 6: Forecasting results with different forecasting models.

our method is able to handle the error accumulation issue in
traditional multi-step forecasting.

As illustrated in Fig. 6, the scatter diagram shows the load
forecasting results of the proposed method and multi-step
forecasting method with different models. The red diagonal
line in the ﬁgure is ideal ﬁtting line. The closer the ﬁtting of
the scatter points is to this diagonal line, the more accurate
the prediction results will be. It can be seen from the ﬁgure
that no matter what kind of prediction models, the results
of the proposed prediction method is signiﬁcantly higher
than the multi-step prediction. In the proposed forecasting
method, the prediction performance of the PER-AutoRL is
signiﬁcantly better than that of traditional multiple linear
regressions (MLR), autoregressive integrated moving average
(ARIMA), LSTM, and recurrent deterministic policy gradient
(RDPG).

Fig. 7 shows the one-day load forecasting results of the
microgrid using the proposed forecasting method. It can be
seen from Fig. 7 that the load in this area has a certain
regularity. The load gradually increases from 5:00 to 10:00,
and decreases during the lunch break from 11:00 to 14:00, then
it increases from 15:00 to 20:00. The load gradually reduced
again from 21:00 to 5:00. It can be seen that the forecasting
results can reﬂect this trend appropriately.

Fig. 8 shows the forecasting results of WT and PV outputs.
The ﬁgure reveals that when we adopt the proposed method,
no matter the prediction results of WT or PV outputs can ﬁt
the real power generation curve suitably.

It can be seen from Tab. III that, compared with the
multi-step prediction method, the forecasting accuracy of the
proposed method is signiﬁcantly improved, and it is further
improved by revising the prediction values via the error distri-
bution compared with single-step prediction method, indicat-
ing that the proposed method has achieved the goal of reducing
error accumulation and improving prediction accuracy. At the
same time, it can be seen that the load forecasting errors are
smaller than that of WT and PV outputs, which suggests that
the randomness of WT and PV outputs are stronger than that
of the load.

Fig. 7: Forecasting results of loads.

Fig. 8: Forecasting results of WT and PV outputs.

most proper model architecture and hyperparameters in a
customized and efﬁcient manner.

Fig. 5 shows the load forecasting errors of the microgrid
for a total of 72 hours in 3 days. Regarding the multi-
step forecasting method, the forecasting results are relatively
accurate only in the ﬁrst few steps; while as time goes by,
the error accumulation phenomenon gradually occurs, which
leads to poor performance in forecasting. In contrast, when
using our forecasting method, the prediction error is stably
maintained in a much smaller interval, which conﬁrms that

IEEE TRANSACTIONS ON SUSTAINABLE ENERGY

9

Fig. 9: Scheduling results.

TABLE III: Forecasting errors of different methods

Indicators

Proposed method

Single-step Multi-step

Load

WT

PV

MAPE
RMSE

MAPE
RMSE

MAPE
RMSE

0.01825
3.9736

0.0709
25.8691

0.0813
38.8431

0.0215
8.8031

0.1015
30.5605

0.1261
48.7785

0.1416
49.9875

0.2227
66.6884

0.2611
59.8621

TABLE IV: Operating costs at different conﬁdence levels

Conﬁdence
levels(%)

90%
95%
99%

Proposed
approach

128.0413
139.3082
206.8478

Operating cost($)

Scheduling without fore-
casting

207.9492
219.9456
253.3075

C. Optimal Scheduling Based on PER-AutoRL Forecasting

As a comparison, the renewable energy outputs and load
in traditional scheduling methods without forecasting are
obtained by discretizing their probability distributions in an
expectation form; while the required spinning reserve capacity
is determined via the probability distributions of the WT, PV
outputs, and load [25]. And then, based on the above data
as the input data, the scheduling results of the scheduling
model without forecasting can be obtained by optimizing the
scheduling model.

Fig. 9 shows the scheduling results with/without a fore-
casting method at the 95% conﬁdence level. It can be seen
from Fig. 9 (a) and (b) that the ESS is charged by MTs
at the beginning of the scheduling cycle. As shown in Fig.
9 (a), when the scheduling model without forecasting, MT1
and MT3 provide the spinning reserve to meet the required
conﬁdence level and balance the load in most periods. When
the load demand increases, MT2 also participates in power
generation. As shown in Fig. 9 (b), the power generated by
MT3 and ESS can basically meet the load and spinning reserve
demand; it is only necessary to start MT1 at 24:00 and MT2
needn’t participate in scheduling. This fact suggests that our
approach is capable of improving the operational economy
of the microgrid by reducing the MTs’ starting and stopping
costs.

As shown in Fig. 10, the accuracy of the prediction results is
closely related to the operating costs, the greater the prediction
errors, the higher the operating costs. This fact conﬁrms that

Fig. 10: Operation costs of scheduling with different
prediction methods.

Fig. 11: Comparison of spinning reserve capacity with
traditional scheduling model without forecasting.

TABLE V: Performance comparison

Conﬁdence
levels(%)

Proposed approach

Traditional approach

Operating
cost($)

Calculation
time(s)

Operating
cost($)

Calculation
time(s)

90%
95%
99%

128.0413
139.3082
206.8478

3.7
5.9
5.1

220.8436
238.5843
249.2354

78.2
89.2
118.68

different prediction methods have a signiﬁcant impact on the
operating costs of the microgrid.

Fig. 11 shows the effect of the proposed forecasting method
on the required spinning reserve capacity at the 95% con-
ﬁdence level. Speciﬁcally, the spinning reserve capacity re-
quired in the proposed scheduling model is less than that
of the model without forecasting in 66.67% periods. This
conﬁrms that accuracy forecasting can reduce the spinning
reserve capacity signiﬁcantly.

As shown in Tab. IV, the spinning reserve capacity cost
must be increased with the increase of the conﬁdence level,
inevitably lead to a increase in the operating
which will
costs. Furthermore, Tab. IV also illustrates that compared
with the scheduling without forecasting, the operating costs
of the proposed approach are reduced by 18.3%, 36.7%,
the 99%, 95%, and 90% conﬁdence level,
and 38.4% at
respectively. Therefore, it can be concluded that the scheduling
with forecasting is able to effectively improve the operational
economy of the microgrid, and that choosing a reasonable
conﬁdence level is a key to realize the trade-off between
reliability and economy.

IEEE TRANSACTIONS ON SUSTAINABLE ENERGY

10

D. Performance Comparison

In generally, traditional chance-constrained programming
uses Monte Carlo simulations (MCS) to handle the problem,
so we use the hybrid intelligent algorithm which combines
the particle swarm optimization (PSO) algorithm with MCS
in [28] to solve the chance-constrained model in sec. IV-A
as a comparison. In PSO, the population size is 20, and the
maximum number of iterations T is set as 150; in MCS, the
number of random variables N is 500. Considering that this
approach has randomness, the average results of 10 runs are
taken.

The results in Tab. V show that the proposed approach
outperforms the traditional approach in calculation efﬁciency
and can signiﬁcantly reduce the operation costs.

VI. CONCLUSION

How to deal with the uncertainty of renewable energies out-
puts and load is a crucial issue in an isolated microgrids day-
ahead scheduling. In this paper, we for the ﬁrst time propose
a multi-period forecasting method based on PER-AutoRL and
integrate it into the microgrid scheduling model considering
demand response. The designed PER-AutoRL manages to
improve the construction efﬁciency of the forecasting model
in a customized way and the test results demonstrate that
the prediction accuracy of the proposed forecasting method
is signiﬁcantly superior to that of a traditional multi-step
forecasting method. Compared with the traditional scheduling
methods without forecasting, our proposed approach is able to
signiﬁcantly reduce the operating costs with faster calculation
speed.

In future work, we will extend this method to the energy
management of integrated energy systems. Besides, exploring
advanced technologies to protect the users privacy is also an
interesting topic.

REFERENCES

[1] R. H. M. Zargar and M. H. Y. Moghaddam, “Development of a
markov-chain-based solar generation model for smart microgrid energy
management system,” IEEE Transactions on Sustainable Energy, vol. 11,
no. 2, pp. 736–745, 2019.

[2] A. Kumar, A. Verma, and R. Talwar, “Optimal techno-economic sizing
of a multi-generation microgrid system with reduced dependency on grid
for critical health-care, educational and industrial facilities,” Energy, vol.
208, p. 118248, 2020.

[3] A. Ag¨uera-P´erez, J. C. Palomares-Salas, J. J. G. de la Rosa, and
O. Florencias-Oliveros, “Weather forecasts for microgrid energy man-
agement: Review, discussion and recommendations,” Applied Energy,
vol. 228, pp. 265–278, 2018.

[4] P. V¨ah¨akyla, E. Hakonen, and P. L´eman, “Short-term forecasting of grid
load using box-jenkins techniques,” International Journal of Electrical
Power & Energy Systems, vol. 2, no. 1, pp. 29–34, 1980.

[5] S.-C. Lee and L.-H. Shih, “Forecasting of electricity costs based on an
enhanced gray-based learning model: A case study of renewable energy
in taiwan,” Technological Forecasting and Social Change, vol. 78, no. 7,
pp. 1242–1253, 2011.

[6] Y. Wang, Q. Chen, N. Zhang, and Y. Wang, “Conditional residual
modeling for probabilistic load forecasting,” IEEE Transactions on
Power Systems, vol. 33, no. 6, pp. 7327–7330, 2018.

[7] H. Jiang, Y. Zhang, E. Muljadi, J. J. Zhang, and D. W. Gao, “A short-
term and high-resolution distribution system load forecasting approach
using support vector regression with hybrid parameters optimization,”
IEEE Transactions on Smart Grid, vol. 9, no. 4, pp. 3341–3350, 2016.

[8] F. Rodr´ıguez, A. Fleetwood, A. Galarza, and L. Font´an, “Predicting
solar energy generation through artiﬁcial neural networks using weather
forecasts for microgrid control,” Renewable Energy, vol. 126, pp. 855–
864, 2018.

[9] M. Tan, S. Yuan, S. Li, Y. Su, H. Li, and F. He, “Ultra-short-term
industrial power demand forecasting using lstm based hybrid ensemble
learning,” IEEE Transactions on Power Systems, vol. 35, no. 4, pp. 2937–
2948, 2019.

[10] M. Afrasiabi, M. Mohammadi, M. Rastegar, and A. Kargarian, “Multi-
agent microgrid energy management based on deep learning forecaster,”
Energy, vol. 186, p. 115873, 2019.

[11] T. Liu, Z. Tan, C. Xu, H. Chen, and Z. Li, “Study on deep reinforce-
ment learning techniques for building energy consumption forecasting,”
Energy and Buildings, vol. 208, p. 109675, 2020.

[12] T. Kuremoto, T. Hirata, M. Obayashi, S. Mabu, and K. Kobayashi,
“Training deep neural networks with reinforcement learning for time
series forecasting,” in Time Series Analysis-Data, Methods, and Appli-
cations. Rijeka, Croatia: InTech, 2019.

[13] C. A. Hernandez-Aramburo, T. C. Green, and N. Mugniot, “Fuel con-
sumption minimization of a microgrid,” IEEE Transactions on Industry
Applications, vol. 41, no. 3, pp. 673–681, 2005.

[14] M. R. Ebrahimi and N. Amjady, “Adaptive robust optimization frame-
work for day-ahead microgrid scheduling,” International Journal of
Electrical Power & Energy Systems, vol. 107, pp. 213–223, 2019.
[15] H. Wang, Z. Yan, M. Shahidehpour, X. Xu, and Q. Zhou, “Quantitative
evaluations of uncertainties in multivariate operations of microgrids,”
IEEE Transactions on Smart Grid, vol. 11, no. 4, pp. 2892–2903, 2020.
[16] O. Ciftci, M. Mehrtash, and A. Kargarian, “Data-driven nonparametric
chance-constrained optimization for microgrid energy management,”
IEEE Transactions on Industrial Informatics, vol. 16, no. 4, pp. 2447–
2457, 2019.

[17] L. Wen, K. Zhou, S. Yang, and X. Lu, “Optimal load dispatch of
community microgrid with deep learning based solar power and load
forecasting,” Energy, vol. 171, pp. 1053–1065, 2019.

[18] V. Mnih, K. Kavukcuoglu, D. Silver, A. A. Rusu, J. Veness, M. G.
Bellemare, A. Graves, M. Riedmiller, A. K. Fidjeland, G. Ostrovski
et al., “Human-level control
learning,”
Nature, vol. 518, no. 7540, pp. 529–533, 2015.

through deep reinforcement

[19] D. Silver, G. Lever, N. Heess, T. Degris, D. Wierstra, and M. Riedmiller,
“Deterministic policy gradient algorithms,” in International Conference
on Machine Learning. PMLR, 2014, pp. 387–395.

[20] Z. L. Li, C.-J. M. Liang, W. He, L. Zhu, W. Dai, J. Jiang, and
G. Sun, “Metis: Robustly tuning tail latencies of cloud systems,” in
2018 {USENIX} Annual Technical Conference ({USENIX}{ATC} 18),
2018, pp. 981–992.

[21] Y. Hou, L. Liu, Q. Wei, X. Xu, and C. Chen, “A novel ddpg method with
prioritized experience replay,” in 2017 IEEE International Conference
on Systems, Man, and Cybernetics (SMC).
IEEE, 2017, pp. 316–321.
[22] J. Wang, T. Niu, H. Lu, W. Yang, and P. Du, “A novel framework
of reservoir computing for deterministic and probabilistic wind power
forecasting,” IEEE Transactions on Sustainable Energy, vol. 11, no. 1,
pp. 337–349, 2019.

[23] C. Li, G. Tang, X. Xue, A. Saeed, and X. Hu, “Short-term wind speed
interval prediction based on ensemble gru model,” IEEE Transactions
on Sustainable Energy, vol. 11, no. 3, pp. 1370–1380, 2019.

[24] C. Kang, Q. Xia, and N. Xiang, “Sequence operation theory and its ap-
plication in power system reliability evaluation,” Reliability Engineering
& System Safety, vol. 78, no. 2, pp. 101–109, 2002.

[25] Y. Li, Z. Yang, G. Li, D. Zhao, and W. Tian, “Optimal scheduling of an
isolated microgrid with battery storage considering load and renewable
generation uncertainties,” IEEE Transactions on Industrial Electronics,
vol. 66, no. 2, pp. 1565–1575, 2018.

[26] Y. Li, C. Wang, G. Li, and C. Chen, “Optimal scheduling of integrated
demand response-enabled integrated energy systems with uncertain re-
newable generations: A stackelberg game approach,” Energy Conversion
and Management, vol. 235, p. 113996, 2021.

[27] P. B. L. Neto, O. R. Saavedra, and L. A. de Souza Ribeiro, “A dual-
battery storage bank conﬁguration for isolated microgrids based on
renewable sources,” IEEE Transactions on Sustainable Energy, vol. 9,
no. 4, pp. 1618–1626, 2018.

[28] Z. Wu, W. Gu, R. Wang, X. Yuan, and W. Liu, “Economic optimal sched-
ule of chp microgrid system using chance constrained programming and
particle swarm optimization,” in 2011 IEEE Power and Energy Society
General Meeting.

IEEE, 2011, pp. 1–11.

