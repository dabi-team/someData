1

Integrating Over-the-Air Federated Learning and
Non-Orthogonal Multiple Access: What Role can
RIS Play?

Wanli Ni, Graduate Student Member, IEEE, Yuanwei Liu, Senior Member, IEEE, Zhaohui Yang, Member, IEEE,

Hui Tian, Senior Member, IEEE, and Xuemin Shen, Fellow, IEEE

2
2
0
2

l
u
J

3

]
T
I
.
s
c
[

2
v
5
3
4
0
0
.
3
0
1
2
:
v
i
X
r
a

Abstract—With the aim of integrating over-the-air federated
learning (AirFL) and non-orthogonal multiple access (NOMA)
into an on-demand universal framework, this paper proposes
a reconﬁgurable intelligent surface (RIS)-aided hybrid network
by leveraging the RIS to ﬂexibly adjust the decoding order of
heterogeneous data. A new metric of computation rate is deﬁned
to measure the performance of AirFL users. Upon this, the
objective of this work is to maximize the achievable hybrid
rate by jointly optimizing the transmit power, controlling the
receive scalar, and designing the reﬂection coefﬁcients. Since the
concurrent transmissions of all computation and communication
signals are aided by the discrete phase-shifting elements at
the RIS, the formulated problem (P0) is a challenging mixed-
integer programming problem. To tackle this intractable issue, we
decompose the original problem (P0) into a non-convex problem
(P1) and a combinatorial problem (P2), which are characterized
by the continuous and discrete variables, respectively. For the
transceiver design problem (P1), the power allocation subproblem
is ﬁrst solved by difference-of-convex programming, and then
the receive control subproblem is addressed by successive convex
approximation, where the closed-form expressions of simpliﬁed
cases are derived to obtain deep insights. For the reﬂection
design problem (P2), a relaxation-then-quantization method is
adopted to ﬁnd a suboptimal solution for striking a trade-off
between complexity and performance. Afterwards, an alternating
optimization algorithm is developed to solve the non-linear non-
convex problem (P0) iteratively. Finally, simulation results reveal
that i) the proposed RIS-aided hybrid network can support
on-demand communication and computation efﬁciently, ii) the
system performance can be improved by properly selecting the
location of the RIS, and iii) the designed algorithms are also
applicable to conventional networks with only AirFL or NOMA
users.

Index Terms—Federated learning, non-orthogonal multiple ac-
cess, over-the-air computation, reconﬁgurable intelligent surface.

This work was supported by the National Key Research and Development
Program of China (2018YFE0205502) and the BUPT Excellent Ph.D. Stu-
dents Foundation. A short version of this paper has been presented at the IEEE
INFOCOM Workshop on Distributed Machine Learning and Fog Networks,
Virtual, May 2021 [1]. (Corresponding author: Hui Tian.)

W. Ni and H. Tian are with the State Key Laboratory of Networking
and Switching Technology, Beijing University of Posts and Telecommu-
nications, Beijing 100876, China (e-mail: charleswall@bupt.edu.cn;
tian-
hui@bupt.edu.cn).

Y. Liu is with the School of Electronic Engineering and Computer Science,
Queen Mary University of London, London E1 4NS, United Kingdom (e-mail:
yuanwei.liu@qmul.ac.uk).

Z. Yang is with the Department of Electronic and Electrical Engineering,
University College London, London WC1E 7JE, United Kingdom (e-mail:
zhaohui.yang@ucl.ac.uk).

X. Shen is with the Department of Electrical and Computer Engineer-
ing, University of Waterloo, Waterloo, ON, N2L 3G1, Canada (e-mail:
sshen@uwaterloo.ca).

I. INTRODUCTION

T HE prosperity of machine learning is expected to provide

pervasive intelligence for beyond ﬁfth generation (B5G)
networks [2], [3], which will also make the ubiquitous data
transmission more sensitive and demanding from privacy pro-
tection to resource utilization [4]. By exploring the superposi-
tion property of wireless channels to compute a target function
[5] and allowing all participants to collaboratively train a
shared model with keeping their raw data locally, over-the-air
federated learning (AirFL) is greatly desired in many resource-
limited and privacy-sensitive scenarios empowered by large-
scale machine learning [6], [7]. Additionally, as the number
of connected devices and data trafﬁc grow exponentially,
the data-intensive applications would demand heterogeneous
services such as high throughput, ultra reliability, and low
latency [8]. Being helpful to overcome the challenges raised
from the massive connectivity and resource scarceness, non-
orthogonal multiple access (NOMA) has been deemed as
one of the promising enablers for future networks [9]. To
efﬁciently cope with the differentiated requirements of the
hybrid networks consisting of both AirFL and NOMA users,
it is particularly important to design an on-demand universal
framework that
is capable of integrating computation and
communication together for meeting the diversity needs of the
forthcoming ﬂourish applications.

Since the conﬂicts between the spectrum scarcity of ex-
isting networks and the bandwidth requirements of emerging
applications are ever-increasingly striking [8], the co-design
of distributed machine learning and wireless communication
is essential for B5G networks to bring considerable gains
in terms of latency reduction [10], spectrum efﬁciency [11],
energy consumption [12], and hardware cost. To this end,
understanding the similarity and difference between AirFL and
NOMA is extremely valuable for the seamless integration of
them. On the one hand, the uplink transmissions of AirFL
are over the same multiple-access channel [10], which is
similar to that of NOMA technique [9]. On the other hand, the
AirFL concentrates on the computation result rather than the
individual data itself [7], [11], which is different from NOMA.
Exploiting the mentioned similarity, the signals from hybrid
users can be multiplexed on the same channel simultaneously.
However, it is still not a trivial task to provide heterogeneous
services over limited radio spectrum, due to the processing
difﬁculties of the mixed signals. Therefore, it is highly desired

 
 
 
 
 
 
2

for the hybrid network to deploy the reconﬁgurable intelligent
surface (RIS) for dynamically tuning the wireless channels,
which plays a key role to ﬂexibly adjust the signal processing
order of hybrid users.

quite various from one another [24]. Therefore, these behavior
heterogeneities should be carefully addressed to fulﬁll the
intelligence vision of next-generation wireless networks.

A. Related Works

Recently, both AirFL and NOMA have attracted compelling
attention, but most previous studies have focused on the sepa-
rate implementation of AirFL and NOMA in diverse scenarios
such as the works in [6], [7], [9], [13]–[17]. However, the
network architecture may be isolated and dedicated if designed
independently, which inevitably makes the ﬂexibility and
versatility of existing networks insufﬁcient. By establishing
an explicit expression for the packet error rate and the con-
vergence rate of federated learning, Chen et. al [18] provided
a joint learning and communication algorithm to reduce the
training loss. Different from the conventional communication
paradigms based on orthogonal multiple access, by exploiting
the superposition property of wireless channels, multiple users
are able to implement model aggregation (i.e., function com-
putation) over-the-air with the help of the remote base station
(BS) [5]–[7]. Thus, the new technique called AirFL is recently
developed, which is beneﬁcial to alleviate the communication
latency dramatically [10], [14], [19]. In order to improve the
convergence rate and prediction accuracy of AirFL, the authors
of [6] proposed a difference-of-convex (DC) programming
based method to optimize the device selection and active
beamforming for aggregation error minimization. Additionally,
to overcome the unfavorable noise brought by the wireless
environment, Jiang et. al [20] deployed the RIS to alleviate
the signal distortion of AirFL. Moreover, our previous work
in [7] jointly designed the transceiver and reﬂection settings
to further enhance the learning performance of AirFL with the
aid of multiple intelligent surfaces.

Due to the interference caused by the spectrum sharing
among multiple users, efﬁcient resource management and in-
terference mitigation are the fundamental research challenges
for NOMA networks [9], [15]–[17]. To improve the spectrum
efﬁciency, Zhao et. al [16] formulated a joint problem of
spectrum allocation and power control in NOMA enhanced
heterogeneous networks. Also, by adopting the matching the-
ory and optimization methods,
the authors of [17] aimed
to provide better user experience in the multi-cell NOMA
networks with multiple subcarriers. Besides, considering the
problems in RIS-aided NOMA networks, cases from ideal
and non-ideal RIS to single and multi-cell were discussed
in [21] and [22], respectively. Motivated by the ability to
learn from long-term evolution, Liu et. al [23] developed
reinforcement learning based approaches to solve the RIS
deployment problem in a highly dynamic NOMA network.
However, most prior works ignore the system heterogeneity
from device status to service requirements. For instance, the
computation units and energy supplies of many Internet-of-
Things (IoT) devices are usually insufﬁcient, which makes
them prefer to data ofﬂoading rather than local computing.
Moreover, future networks may involve a multitude of user
devices in most cases, their services and applications can be

B. Motivations and Challenges

Again, although previous studies have well investigated the
separate design, the network-wide convergence of distributed
learning and wireless communication is still a nascent ﬁeld and
many open issues deserve exploration. The goal of this work
is to consider: Is it possible to seamlessly merge distributed
machine learning into traditional wireless networks with con-
strained resources, and what role can RIS play in it? Note
that the integration of AirFL and NOMA makes the received
superposition signal at the BS quite complicated, namely two
different types of users are multiplexed on the same channel,
which also makes the critical issues of integrated networks
different from that of conventional networks consisting of only
AirFL or NOMA users. In summary, this entails the following
challenges.

• At present, it is generally difﬁcult for the computation-
centric AirFL to be integrated into the communication-
centric wireless networks. So far a huge challenge is how
to distinguish the homogeneous signals received simulta-
neously from different types of users, which motivates
us to rethink existing techniques as reliable solutions for
building a universal framework.

• To date, there is a lack of rate-like criterion to evaluate the
aggregation performance for the collaborative learning of
AirFL users. Most existing works address the computa-
tion error issue only by minimizing the signal distortion
measured by the mean-square-error (MSE) but neglect the
performance comparison requirements of different user
types, which thus motivates us to give a novel metric for
deﬁning a comparable evaluation methodology.

• In addition, due to the practical implementation concerns,
the discrete phase shifts of the RIS make the joint
optimization problem be a mixed-integer programming,
which is highly challenging. Thus, the resource allocation
problem in terms of transceiver control and reﬂection
design is NP-hard and is non-trivial to solve. Not to
mention that the previous researches on RIS-aided hybrid
networks are insufﬁcient, or even almost none.

C. Contributions and Organization

To overcome the aforementioned challenges, we ﬁrst
combine the communication-centric NOMA users and the
computation-centric AirFL users into one concurrent uplink
transmission. Then, the RIS is leveraged to adjust the signal
processing order of successive interference cancellation (SIC)
decoding via tuning the channel quality of hybrid users on
demand. By doing so, the concurrent transmission of heteroge-
neous data is capable of providing the high spectrum efﬁciency
and low latency services to satisfy diverse requirements. To
the best of our knowledge, this is the ﬁrst effort to provide a
universal framework by leveraging the RIS to unify NOMA
communication and collaborative computation via concurrent

uplink transmission. The main contributions of this paper can
be summarized as follows:

1) We integrate AirFL and NOMA in a universal frame-
work by combining computation and communication
signals into one concurrent transmission, in which the
important role of RIS is revealed. In order to unify the
performance metrics of different user types, we deﬁne
an exact expression of computation rate to evaluate the
learning behavior of AirFL users. Based on which, we
aim to maximize the hybrid rate (deﬁned as the weighted
sum of the communication rate and the computation
rate) by jointly optimizing the continuous transceiver
scalars and the discrete phase shifts at the RIS, while
satisfying the minimum rate requirements of NOMA
users and the maximum aggregation error of AirFL
users. The formulated resource allocation problem is
analyzed to be a mixed-integer non-linear programming
(MINLP), where the network characterization is repre-
sented effectively.

2) In an effort to solve the transceiver design problem
with continuous variables, we ﬁrst use DC programming
and successive convex approximation (SCA) methods
to transform decoupled non-convex subproblems into
convex ones. Then, in order to tackle the discrete vari-
ables in the reﬂection design problem, we adopt linear
substitution and semideﬁnite relaxation (SDR) methods
to handle the combinatorial optimization challenge. Fur-
thermore, regarding the simpliﬁed cases without quality-
of-service (QoS) and MSE constraints, we provide ex-
plicit closed-form solutions for power allocation at the
NOMA users and the receive control at the BS, respec-
tively. After that, we develop an alternating optimization
algorithm to solve the intractable original problem with
low complexity.

3) We conduct extensive numerical simulations to demon-
strate the effectiveness of our proposed three-step al-
ternating optimization algorithm for the designed RIS-
aided hybrid network. Speciﬁcally, benchmark schemes
from ideal phase shifts to non-ideal cases are compared
to evaluate the performance gain under different condi-
tions. We also show that the RIS conﬁgurations such
as the number of passive elements,
the quantization
resolution and the deployment location have signiﬁcant
impacts on the achievable communication-computation
hybrid rate. Therefore,
these aforementioned factors
should be carefully optimized in practice to strike a
good balance between hardware cost and network per-
formance.

The rest of this paper is organized as follows. First, system
model of RIS-aided hybrid networks is given in Section II.
Then, a resource allocation problem is formulated in Section
III. Next, an alternating optimization algorithm is proposed in
Section IV, where the corresponding convergence and com-
plexity are analyzed. Finally, simulations results are presented
in Section V. The conclusion is drawn in Section VI, where
the role of RIS is summarized.

3

Fig. 1. An illustration of the RIS-aided network, where one RIS equipped
with M reﬂecting elements is deployed to assist the communication and
computation in concurrent transmissions from the users to the BS. Speciﬁcally,
there are two types of users, namely the NOMA users and the AirFL users,
are served by the BS simultaneously. Meanwhile, the direct links between the
users and the BS are not available due to the blockage.

II. SYSTEM MODEL

A. Network and Channel Model

As illustrated in Fig. 1, we consider a RIS-aided wireless
network consisting of one single-antenna BS, I single-antenna
hybrid users, and one RIS equipped with M reﬂecting ele-
ments. Note that the hybrid users are composed of two types,
i.e., the NOMA users and the AirFL users. Both of them are
served by the non-orthogonal communication over the wireless
multiple-access channels. The set of hybrid users is indexed
by I = {1, 2, . . . , K, K + 1, K + 2, . . . , K + N }, where
the sets of AirFL users and NOMA users are indexed by
K = {1, 2, . . . , K} and N = {K + 1, K + 2, . . . , K + N },
respectively. The set of reﬂecting elements is denoted by
M = {1, 2, . . . , M }. The M ×M diagonal reﬂection matrix of
the RIS is denoted by Θ = diag(ejθ1, ejθ2 , . . . , ejθM ), where
θm represents the phase shift of the m-th reﬂecting element.
In practice, the phase shifts of the RIS are limited to a
ﬁnite number of discrete values due to the inevitable hardware
impairments brought by the physical
implementation [21],
[25]–[27]. For this reason, we assume that the resolution of
phase shifts is encoded by b ∈ N+ bits, and each reﬂecting
element has ¯B = 2b possible conﬁguration patterns. By using
the common uniform quantization method, the feasible set of
the discrete phase shifts can be expressed as

A =

(cid:26) 1
2

∆,

3
2

∆,

5
2

∆, . . . ,

2 ¯B − 1
2

(cid:27)

∆

,

(1)

where ∆ = 2π/ ¯B represents the phase resolution. Then, one
can know that the RIS with M reﬂecting elements can be
conﬁgured to one of ¯BM operation modes [26]. Furthermore,
we assume that the direct links between the users and the

BSBS-RIS linkUser KUser 2User K+1User K+NUser 1RISUser K+2ObstaclesNOMA userAirFL userHybrid usersLocal modelLocal dataBS are blocked by unfavorable propagation conditions such as
obstacles [27]–[30]. Due to the light-of-sight (LoS) component
provided by the RIS conﬁgured at a high building, we use
Rician model to formulate all RIS-related channels [27], [29].
Speciﬁcally, the small-scale fading channels of the BS-RIS
link and the user-RIS link are denoted by g ∈ CM ×1 and
hi ∈ CM ×1, ∀i ∈ I, respectively.

When the RIS is deployed on the facade of a building, the
distance from the RIS to the BS and hybrid users can be given
as di, ∀i ∈ {0}∪I, where i = 0 for the BS, while i ∈ I for the
hybrid user. In terms of the large-scale fading, the distance-
dependent path loss model is adopted as Li = ς0(di)−α, ∀i ∈
{0} ∪ I, where ς0 is the path loss at the reference distance of
1 meter and α ≥ 2 is the path loss exponent. Therefore, the
combined channel coefﬁcient from the i-th user to the BS via
the RIS can be given by

(cid:112)

¯hi =

(cid:112)(d0di)−αvHΦi, ∀i ∈ I,

L0LigHΘhi = ς0

(2)
where Φi = diag(gH)hi and v = [v1, v2, . . . , vM ]H with
vm = ejθm. Note that the vector v is able to well contain all
information of the phase shifts of the RIS by separating the
vector v from the reﬂective channels Φi, which is signiﬁcantly
beneﬁcial to our derivations in Section IV-C. Moreover, we
assume that the perfect channel state information (CSI) of all
channels is available at the BS via the estimation methods
described in [31] and [32]. Meanwhile, all channels are
assumed to obey the frequency-ﬂat and quasi-static fading
model [22], [30].

B. RIS-Aided Concurrent Transmission

By serving both the AirFL and NOMA users on the same
time-frequency resource, the superposed signal received at the
BS is expressed as y = (cid:80)K+N
i=1

¯hipisi + z0, expanded as

y =

(cid:88)K

k=1

¯hkpksk
(cid:125)
(cid:123)(cid:122)
AirFL users

(cid:124)

+

(cid:124)

(cid:88)K+N

¯hnpnsn
(cid:125)

n=K+1
(cid:123)(cid:122)
NOMA users

,

+ z0
(cid:124)(cid:123)(cid:122)(cid:125)
noise

(3)

where pk (pn) is the power scalar at the k-th (n-th) user,
sk is the transmit signal (i.e., computation symbol) of local
model after pre-processing at the k-th AirFL user, and sn is
the information-bearing signal (i.e., communication symbol)
of the n-th NOMA user. z0 ∼ CN (0, σ2) is the additive white
Gaussian noise (AWGN) with zero mean, and σ2 is the noise
power at the BS. The reason for distinguishing signals from
different users in (3) is provided in the remark below.

Remark 1: Note that the transmission goals of the NOMA
users and the AirFL users are very different in nature. To
be speciﬁc, the NOMA users are so communication-centric
that they expect to maximize individual data rate and/or their
sum rate [9], [15], [33]. On the contrary, the AirFL users
are computation-centric such that all of them anticipate min-
imizing the global aggregation error to improve the learning
performance [6], [7], [10]. As a result, compared with the
NOMA users,
these AirFL users concentrate more on the
computation results of the transmitted data rather than the
individual data itself.

To facilitate the optimization of transmit power, the in-
formation symbols of all users are assumed to be statisti-

4

cally independent and are normalized with unit variance, i.e.,
E(|si|2) = 1 and E(sH
i sj) = 0, ∀i (cid:54)= j. Then, the transmit
power constraint at the i-th user can be given by

E(|pisi|2) = |pi|2 ≤ Pi, ∀i ∈ I,

(4)

where Pi > 0 is the maximum transmit power at the i-th user.
Since all users are served by the entire bandwidth simulta-
neously, interference management is an essential issue for the
hybrid network composed of both AirFL and NOMA users,
especially the interference from inter-type users. Using SIC
techniques, the BS can ﬁrst decode the signals of strong users
in a successive order to remove the interference, and then it is
able to obtain the superposed signal of weak users [9]. To take
advantage of this technique, all NOMA users are expected to
become strong users and all AirFL users are anticipated to
be treated as weak users in the hybrid network. By doing so,
the BS is capable of eliminating the interference from NOMA
users for these AirFL users via SIC decoding before executing
global model aggregation.

Sparked by the above innovative idea, the block diagram
of the RIS-aided hybrid network is illustrated in Fig. 2. From
this ﬁgure, one can notice that it is highly desired for the
AirFL and NOMA hybrid network to ﬂexibly adjust the signal
processing order of hybrid users by effectively deploying the
RIS to change multiple-access channels. In order to guide the
adjustment of SIC decoding order (i.e., tuning the AirFL users
into weak users), the following constraint should be met by
judiciously optimizing the phase shifts at the RIS, i.e.,

2

(cid:12)
(cid:12)¯hk

(cid:12)
(cid:12)

≤ (cid:12)

(cid:12)¯hK+1

(cid:12)
(cid:12)

2

≤ (cid:12)

(cid:12)¯hK+2

(cid:12)
2
(cid:12)

≤ · · · ≤ (cid:12)

(cid:12)¯hK+N

2

(cid:12)
(cid:12)

, ∀k ∈ K.

(5)
In this paper, the SIC decoding order only depends on the
uplink channel gains of hybrid users, and is assumed to be
ﬁxed for simplicity. The design of more complicated SIC
decoding schemes may further improve the attainable system
performance, but this is beyond the scope of this work. Note
that the RIS in this paper acts as a coordinator to dynamically
adjust the channel coefﬁcient between two types of users,
which makes the SIC decoding order more ﬂexible. Compared
with many previous studies that only use RIS to improve the
performance of existing networks, the RIS in our proposed
universal framework plays a very important role in maintaining
the decoding order given in (5).

C. Achievable Hybrid Rate

Due to the co-existence of two types of users, the perfor-
mance metrics of the considered network are composed of two
parts: communication rate for NOMA users and computation
rate for AirFL users, the details are given below.

1) NOMA Communication Rate: According to the ﬁxed
SIC decoding order given in (5), the BS ﬁrst successfully de-
codes the signal of the strongest user, and then it successively
removes the interference to decode the desired signal of the
second strongest user, and so on. As such, the SINR of the

5

Fig. 2. Block diagram of the RIS-aided hybrid network consisting of both AirFL and NOMA users.

n-th NOMA user at the BS can be written as

γn =

(cid:80)K

k=1 |pk|2 (cid:12)

(cid:12)¯hk

(cid:12)
(cid:12)

2

2

|pn|2 (cid:12)
(cid:12)
(cid:12)¯hn
(cid:12)
i=K+1 |pi|2 (cid:12)
+ (cid:80)n−1

(cid:12)¯hi

(cid:12)
(cid:12)

, ∀n ∈ N .

2

+ σ2

(6)
It is worth pointing out that the computation symbols from
the weak AirFL users are not removed and are treated as
interference by the strong NOMA users. Based on the Shannon
capacity theory, the achievable uplink data rate of the n-th
NOMA user can be given by

(cid:33)

(cid:32)

2

2

1 +

Rn = B log2

|pn|2 (cid:12)
(cid:12)¯hn
i=1 |pi|2 (cid:12)
(cid:12)¯hi
where B is the available bandwidth at the BS. Hence, the
uplink sum rate of these NOMA users can be given as
RNOMA = (cid:80)K+N

, ∀n ∈ N , (7)

(cid:80)n−1

+ σ2

n=K+1 Rn.

(cid:12)
(cid:12)
(cid:12)
(cid:12)

2) AirFL Computation Rate: When all signals from NOMA
the BS can
users have been decoded via SIC technique,
subtract them from the received superposition signal to obtain
the aggregated signal of all AirFL users for model aggregation,
which can be written as

ˆy =

(cid:88)K

k=1

¯hkpksk + z0.

(8)

Next, as shown in Fig. 2, the BS applies a receive scalar
a ∈ C to the aggregated signal ˆy, then the reconstructed signal
of interest to AirFL users can be given by

ˆs =

a
K

ˆy =

a
K

(cid:88)K

k=1

¯hkpksk +

a
K

z0,

(9)

where the post-processing function 1/K is a model aggrega-
tion operation using arithmetic mean that can be replaced with
other nomographic functions summarized in [11], [19], [34].
Compared with the desired computation result from all

AirFL users, denoted by

s =

1
K

(cid:88)K

k=1

sk,

(10)

the computation distortion of ˆs with respect to s is deﬁned as
MSE(ˆs, s) (cid:44) E(|ˆs − s|2) [6], i.e.,

MSE (ˆs, s) =

1
K 2

(cid:88)K

k=1

(cid:12)a¯hkpk − 1(cid:12)
(cid:12)
(cid:12)

2

+

|a|2σ2
K 2 ,

(11)

where MSE(ˆs, s) can be regarded as the interference-plus-
noise power experienced by AirFL users. Since MSE(ˆs, s) can
effectively measure the computation distortion of all AirFL
users, we are now interested in quantifying the system rate
for the collaborative computation. To this end, the achievable
computation rate of global model aggregation is deﬁned as
follows.

Deﬁnition 1: For AirFL users, the computation rate of
model aggregation over a noisy multiple-access channel can
be deﬁned as [1], [35]
(cid:18)

(cid:19)

E(|ˆs|2) − MSE(ˆs, s)
MSE(ˆs, s)

,

(12)

RAirFL = B log2

1 +

where E(|ˆs|2) can be deemed as the total received power of
the reconstructed signal.

Note that the computation rate given in Deﬁnition 1 is
characterized by the similar logarithm form of the commu-
nication rate in (7), which uniﬁes the performance metrics of
two different types of users and also makes them comparable.
Therefore, based on the derived rate expressions in (7) and
(12), the achievable hybrid rate of the considered network can
be written as

RHybrid = (1 − λ)RNOMA + λRAirFL,

(13)

where λ ∈ [0, 1] is a weight parameter for the performance
trade-off between the NOMA users and the AirFL users.
An exact expression of the achievable hybrid rate is given
in (14). Meanwhile, it can be noted that the choice of this
weight parameter has a great impact on the resource allocation
between the two types of users.

D1Local ModelPre-processingComputationSymbolTransmit PowerDKj1 () jK () s1sKp1pKDK+1Local DataEncodingCommunicationSymbolTransmit PowerDK+NjK+1 () jK+N () sK+1sK+NpK+1pK+NUser DetectionSignal Decoding of User K+NSignal Decoding of User K+2Signal Decoding of User K+1-Communication Output-sK+NsK+2sK+1-Post-processingReceiveScalarComputationOutputf () Stage II: Model AggregationStage I:  SIC DecodingAWGNz0WirelessChannelWirelessChannelType I: AirFL UsersType II: NOMA Users` h1` hK` hK+1` hK+NMultiple-Access ChannelsBase StationHybrid UsersaˆsRHybrid = (1−λ)

(cid:88)

n∈N

(cid:124)







Blog2

1+

2

(cid:12)
(cid:12)

|pn|2 (cid:12)
|pi|2 (cid:12)

(cid:12)¯hn
(cid:12)
(cid:12)

2

+ σ2

n−1
(cid:80)
i=1
(cid:123)(cid:122)
Communication rate

(cid:12)¯hi







+λBlog2






(cid:124)

(cid:125)

2

(cid:12)
(cid:12)

(cid:12)
(cid:80)
(cid:12)a¯hkpk
k∈K
(cid:12)a¯hkpk − 1(cid:12)
(cid:12)
2
(cid:12)
(cid:123)(cid:122)
Computation rate

(cid:80)
k∈K

+ |a|2σ2

+ |a|2σ2

6

(14)






(cid:125)

III. PROBLEM FORMULATION AND DECOMPOSITION

problem for transceiver design can be given by

Given the considered system model of RIS-aided hybrid
networks,
the objective of this paper is to maximize the
achievable hybrid rate by jointly designing the transmit power
p at the users, controlling the receive scalar a at the BS,
and tuning the phase shifts v at the RIS. Subject to the QoS
requirement, the aggregation error demand, and the maximum
power constraint, the hybrid rate maximization problem can
be formulated as

(1 − λ)RNOMA + λRAirFL

(P0) : max
p,a,v
s.t. Rn ≥ Rmin

n , ∀n ∈ N ,

MSE (ˆs, s) ≤ ε0,
θm ∈ A, ∀m ∈ M,
(4) and (5),

(15a)

(15b)

(15c)

(15d)

(15e)

where p = [p1, p2, . . . , pK+N ]T is the transmit power vector,
Rmin
is the minimum communication rate required by the n-
n
th NOMA user, ε0 > 0 is the maximum computation error
allowed by AirFL users. Speciﬁcally, the objective function
is given in (15a). The QoS requirement is guaranteed by
constraint (15b). The MSE tolerance of global aggregation
is represented in constraint (15c). The discrete phase shift is
drawn in constraint (15d). Constraints (4) and (5) in (15e) are
related to transmit power and SIC decoding, respectively. Due
to the coupling of multiple continuous and discrete variables
in both the objective function and constraints, the formulated
problem (15) is intractable.

The formulated problem (15) with both continuous and
discrete variables is a MINLP problem and it generally belongs
to NP-hard, which is difﬁcult to solve optimally. Furthermore,
the original problem (15) is still very hard to tackle efﬁciently
even for the case with only one user type, i.e., λ = 0 or λ = 1,
due to the non-convex objective function and constraints from
(15a) to (15c) as well as the combinatorial features of discrete
phase shifts in (15d). On the whole, there is no standard
optimization approach to ﬁnd the global optimal solution for
the NP-hard problem (15) directly. To address this MINLP
problem effectively for obtaining high quality suboptimal
solutions, we propose to decouple it into the following two
subproblems:

1) Transceiver Design: Given the discrete phase shifts of
the RIS, our ﬁrst subproblem is to maximize the hybrid
rate by dynamically controlling the transmit power at
users and optimizing the receive scalar at the BS. As
a result, subject to the QoS requirements of NOMA
users, the MSE tolerance of AirFL users, and the trans-
mit power constraints, the non-convex and non-linear

(1 − λ)RNOMA + λRAirFL

(P1) : max
p,a
s.t. (4), (15b) and (15c).

(16a)

(16b)

2) Reﬂection Design: Given the transmit power and the
receive scalar, our second subproblem is to improve
the achievable performance by judiciously tuning the
discrete phase shifts of the RIS. Therefore, subject to
the channel quality order, data rate and error-related
constraints for users, as well as the discrete phase shifts
constraints, the combinatorial optimization problem for
reﬂection design can be written as

(P2) : max

(1 − λ)RNOMA + λRAirFL

v
s.t. (5), (15b), (15c) and (15d).

(17a)

(17b)

Note that the transceiver design subproblem (16) is very
challenging even when only the transmit power subproblem
or the receive scalar subproblem is considered. Moreover,
the reﬂection design subproblem (17) is still intractable even
we relax the phase shifts into continuous ones. Although
subproblems (16) looks simpler than the original problem (15),
it is still almost impossible to derive closed-form solutions for
the transmit power and receive scalar in the considered RIS-
aided hybrid network. Not to mention that the combinatorial
feature of subproblem (17) makes it NP-hard and much more
complicated, e.g., there are BM operation modes of the phase
shifts to be tested if the exhaustive search is used [25], [26]. To
avoid an unacceptable computation complexity, one common
approach is to transform these non-linear and non-convex
subproblems of transceiver control and reﬂection design into
convex ones, and then standard methods can be invoked to
solve them separately and alternatively over iterations. As a
consequence, the alternating optimization technique can be
adopted as an intuitive approach to solve the MINLP problem
(15) in an efﬁcient manner.

For providing a clear illustration, Fig. 3 gives an overview
of the roadmap to solve the hybrid rate maximization problem,
especially the connections between key optimization subprob-
lems and the designed algorithms. Firstly, the original MINLP
problem (15) is decomposed into two subproblems: the non-
convex transceiver design subproblem (16) and the combina-
torial reﬂection design problem (17), which are characterized
by the continuous variables and discrete variables. Secondly,
the subproblems of transmit power allocation, receive scalar
control, phase shifts design are solved sequentially in Section
IV by using common optimization methods such as DC pro-
gramming, SCA, and SDR. Notably, closed-form solutions for
some simpliﬁed cases are derived to provide useful insights.

7

Fig. 3. An overview of the problem decomposition and proposed methods to subproblems.

IV. ALTERNATING OPTIMIZATION

A. Transmit Power Allocation

With given receive scalar a in subproblem (16), we fo-
cus on optimizing the transmit power p in this subsection.
Before solving this problem, we notice that the power al-
location strategies of AirFL and NOMA users, i.e., pA =
[p1, p2, . . . , pK]T and pN = [pK+1, pK+2, . . . , pK+N ]T, are
coupled in the objective function (16a), but separated in the
constraints. Meanwhile, considering that the signals of NOMA
users are processed ﬁrst at the BS, followed by the signals of
AirFL users, which has been illustrated in Fig. 2. Thus, we
propose to ﬁrst ﬁx the transmit power pA of AirFL users, and
tackle the power allocation problem of NOMA users, then
repeat this in turn until convergence. The details are given
below.

1) Power allocation of NOMA users: By following the
the power allocation problem of

above ideas, given pA,
NOMA users can be equivalently written as
(cid:32)
|pn|2 (cid:12)
(cid:12)
(cid:12)¯hn
(cid:12)
max
(cid:12)
i=1 |pi|2 (cid:12)
2
(cid:12)¯hi
pN
(cid:12)
s.t. (15b) and |pn|2 ≤ Pn, ∀n ∈ N .

B log2

(cid:80)n−1

1 +

(cid:88)

n∈N

2

(cid:33)

+ σ2

(18a)

(18b)

Note that

the problem (18) is not convex due to the
non-convex objective function (18a) and constraint (15b). To
handle the non-convexity of the objective function (18a), we
rewrite it as

RNOMA =

(cid:88)K+N

n=K+1

B log2

(cid:32)

= B log2

1 +

(cid:32) (cid:80)n

i=1 |pi|2 (cid:12)
(cid:12)¯hi
i=1 |pi|2 (cid:12)
(cid:12)
(cid:12)¯hi
(cid:12)
(cid:12)
2
(cid:12)¯hn
(cid:12)
+ σ2

(cid:80)n−1
n=K+1 |pn|2 (cid:12)
(cid:80)K+N
k=1 |pk|2 (cid:12)
(cid:12)
2
(cid:12)¯hk
(cid:12)

2

(cid:80)K

(cid:33)

2

(cid:12)
(cid:12)
+ σ2
(cid:33)

.

(19)

Next, we denote ζn = 2Rmin

n /B − 1, ∀n ∈ N , then the non-

convex constraint (15b) can be transformed as
(cid:19)
(cid:18)(cid:88)n−1

2

2

|pn|2 (cid:12)

(cid:12)¯hn

(cid:12)
(cid:12)

≥ ζn

|pi|2 (cid:12)

(cid:12)¯hi

(cid:12)
(cid:12)

+ σ2

i=1

, ∀n ∈ N . (20)

Replacing the objective function (18a) and constraint (15b)
with the newly derived expressions in (19) and (20), the non-
convex problem (18) can be rewritten as
(cid:32)
n=K+1 |pn|2 (cid:12)
(cid:80)K+N
k=1 |pk|2 (cid:12)
(cid:12)
2
(cid:12)¯hk
(cid:12)

max
pN
s.t. (20) and |pn|2 ≤ Pn, ∀n ∈ N .

(cid:12)
(cid:12)¯hn
(cid:12)
+ σ2

B log2

(21b)

(21a)

(cid:80)K

1 +

(cid:33)

2

Note that problem (21) is convex with ρn = |pn|2 , ∀n ∈ N ,
thus it can be solved by the existing convex software packages
such as CVX [36]. After obtaining the solution ρ∗
n, the optimal
transmit power at the n-th NOMA user can be recovered as
p∗
ρ∗
n =
n, ∀n ∈ N . Moreover, by taking a deep think for the
power allocation problem (21), the closed-form solution to a
simpler case is given in the following proposition.

√

Proposition 1: If all NOMA users do not have requirements
on target data rate, i.e., Rmin
n = 0, ∀n ∈ N , then each NOMA
user just needs to simply perform full power transmission for
the sum rate maximization [37], which can be given by
(cid:112)

p∗
n =

Pn, ∀n ∈ N .

(22)

Proof: As one can see that

the objective function is
monotonically increasing with pn, ∀n ∈ N , thus the optimal
power allocation at each NOMA user is to transmit at full
power if constraint (20) is ignored. Moreover, it is worth
pointing out that full power transmission is always the optimal
solution for NOMA users in the absence of QoS requirement,
regardless of the conﬁgurations of the RIS in problem (21).
This completes the proof.

Original problem: Hybrid rate maximization (15)(MINLP)Subproblem 1: Transceiver design (16)(Non-convex)Subproblem 2: Reflection design (17)(Combinatorial)Transmit with QoS constraintReceive with MSE constraintDC programming(Algorithm 1) SCA method(Algorithm 2)SDR approach (Algorithm 3)high resolution or large RISTransmit without QoS constraintClosed-form solutionReceive without MSE constraintClosed-form solutionLow resolution and small RISExhaustive searchTransmit power allocationReceive scalar controlPhase shifts design2) Power allocation of AirFL users: With obtained p∗

N, the

power allocation problem of AirFL users is given by

(1 − λ)RNOMA + λRAirFL

max
pA
s.t. (15c) and |pk|2 ≤ Pk, ∀k ∈ K.

(23a)

(23b)

In problem (23), the MSE constraint (15c) and the power
constraint are convex, but the objective function (23a) is non-
convex. Thus, we deﬁne two convex functions as follows:
(cid:33)

(cid:32) K
(cid:88)

|pk|2 (cid:12)

(cid:12)¯hk

(cid:12)
(cid:12)

2

F (pA) = (1 − λ)B log2

+ λB log2

(cid:32) K
(cid:88)

k=1

G (pA, β) = (1 − λ)B log2

k=1

(cid:12)
(cid:12)a¯hkpk

(cid:12)
(cid:12)

2

(cid:18)(cid:88)K

k=1

+ λB log2

(cid:16)

β + |a|2 σ2(cid:17)

,

+ IN + σ2

(cid:33)

+ |a|2 σ2

,

(24)

|pk|2 (cid:12)

(cid:12)¯hk

(cid:12)
(cid:12)

2

+ σ2

(cid:19)

2

2

(cid:12)¯hn

is a constant and β =

n∈N |pn|2 (cid:12)
where IN = (cid:80)
(cid:12)a¯hkpk − 1(cid:12)
(cid:12)
(cid:80)
(cid:12)

(cid:12)
(cid:12)
is an auxiliary variable.
k∈K
Then, the objective function (23a) can be rewritten as the
difference of two convex functions, i.e., RHybrid = F (pA) −
G (pA, β). As such, the problem (23) can be re-expressed
as a canonical DC programming problem with convex fea-
sible set. Speciﬁcally, by replacing (25) with its ﬁrst-order
approximation, the non-convex objective function in (23a) can
be well approximated by the concave objective in (26a). By
doing so, the problem (23) is reconstructed as a jointly convex
optimization problem, which is given by
(cid:68)

(cid:69)

(cid:69)

(cid:68)

F (pA) −

∇G(p((cid:96))

A ), pA

−

∇G(β((cid:96))), β

(26a)

max
pA,β

s.t. β ≥

(cid:88)K

(cid:12)a¯hkpk − 1(cid:12)
(cid:12)
(cid:12)

2

,

(cid:88)K

k=1
(cid:12)a¯hkpk − 1(cid:12)
(cid:12)
(cid:12)
|pk|2 ≤ Pk, ∀k ∈ K,

k=1

2

+ |a|2 σ2 ≤ ε0K 2,

(26b)

(26c)

(26d)

where p((cid:96))
A and β((cid:96)) are the converged solutions after the (cid:96)-
th iteration, ∇G(p((cid:96))
A ) and ∇G(β((cid:96))) are the gradients of G
at points p((cid:96))
A and β((cid:96)), respectively. Therein, (cid:104)x, y(cid:105) denotes
the dot product of two vector x and y. In fact, the DC pro-
gramming is able to generate a sequence of improved feasible
solutions with global convergence, which has been proved in
[6]. In summary, the DC-based algorithm for transmit power
allocation is described in Algorithm 1.

B. Receive Scalar Control

With the optimized p∗ in problem (16), the subproblem
of receive scalar control is still intractable due to the non-
convex objective function and constraint with respect to (w.r.t.)
a, which can be equivalently expressed as

max
a

log2

(cid:32) (cid:80)K

2

(cid:12)
(cid:12)

(cid:12)
(cid:12)a¯hkpk
k=1
(cid:12)a¯hkpk − 1(cid:12)
(cid:12)
(cid:12)

+ |a|2 σ2
2

+ |a|2 σ2

(cid:80)K

k=1

(cid:33)

s.t. (15c).

(27)

8

Algorithm 1 DC-Based Algorithm for Power Allocation
A , p(0)
p(0)
maximum iteration number L1, and set (cid:96)1 = 0.

1: Initialize p(0) =

, β(0), the tolerance (cid:15)1, the

(cid:105)T

(cid:104)

N

2: if Rmin
3:

n = 0, ∀n ∈ N then

;

;

(cid:16)

(cid:17)

(cid:3)T

N = (cid:2)(cid:112)PK+1, (cid:112)PK+2, . . . , (cid:112)PK+N
p((cid:96)1)
A , p∗
N

Obtain the optimal transmit power for NOMA users via
(22), i.e., p∗
Compute U ((cid:96)1) = RHybrid
repeat
A , β((cid:96)1)(cid:17)
(cid:16)
p((cid:96)1)

, β((cid:96)1+1)(cid:17)
With given
by solving problem (26) to ﬁnd the transmit power
solution for AirFL users;
Compute U ((cid:96)1+1) = RHybrid
Update (cid:96)1 := (cid:96)1 + 1;
(cid:12)U ((cid:96)1) − U ((cid:96)1−1)(cid:12)

(cid:12) ≤ (cid:15)1 or (cid:96)1 > L1;

(cid:16)
p((cid:96)1+1)
A

p((cid:96)1+1)
A

until (cid:12)

, obtain

, p∗
N

(cid:16)

(cid:17)

;

8:
9:
10: else
11:

repeat

(25)

12:

by solving problem

N

A , obtain p((cid:96)1+1)

With given p((cid:96)1)
(21) with CVX;
With given p((cid:96)1+1)
to obtain p((cid:96)1+1)
;
Compute U ((cid:96)1+1) = RHybrid
Update (cid:96)1 := (cid:96)1 + 1;

N

A

, repeat similar steps from 5 to 9

(cid:16)
p((cid:96)1+1)
A

, p((cid:96)1+1)
N

(cid:17)

;

4:

5:

6:

7:

13:

14:

15:

16:

the solution improvement

until
iteration number exceeds L1;

is below (cid:15)1 or the

17: end if
18: Output the transmit power solution p∗ = [p∗

A, p∗

N]T.

To simplify problem (27), we introduce an auxiliary variable

¯a = 1/a with a (cid:54)= 0. Then, problem (27) is rewritten as

max
¯a

log2

(cid:32) (cid:80)K

2

(cid:12)
(cid:12)

(cid:12)
(cid:12)¯hkpk
k=1
(cid:12)¯hkpk − ¯a(cid:12)
(cid:12)
(cid:12)

+ σ2
2

(cid:80)K

k=1

(cid:33)

s.t.

(cid:88)K

k=1

(cid:12)¯hkpk − ¯a(cid:12)
(cid:12)
(cid:12)

2

+ σ2
+ σ2 ≤ ε0K 2 |¯a|2 .

(28a)

(28b)

(cid:12)
(cid:12)¯a − ¯hkpk

the objective function (28a) is equivalent

to
Note that
minimize (cid:80)K
, which is a convex function of
¯a. To tackle the non-convexity of constraint (28b), the SCA
method is invoked to replace |¯a|2 with its ﬁrst-order Taylor
expansion. The constraint (28b) is approximated by

k=1

(cid:12)
(cid:12)

2

2

+ σ2

(cid:88)K

k=1

≤ ε0K 2

(cid:12)¯hkpk − ¯a(cid:12)
(cid:12)
(cid:12)
(cid:20)(cid:12)
(cid:12)¯a((cid:96))(cid:12)
(cid:12)

(cid:12)
(cid:12)

2

(cid:18)(cid:16)

¯a((cid:96))(cid:17)H (cid:16)

¯a − ¯a((cid:96))(cid:17)(cid:19)(cid:21)

.

(29)

+ 2Re

Based on the above approximations, the non-convex prob-
lem (29) can be equivalently reformulated as the following
convex one:

min
¯a

(cid:88)K

k=1

(cid:12)
(cid:12)¯a − ¯hkpk

(cid:12)
2
(cid:12)

s.t. (29).

(30)

Since problem (30) is convex, the subproblem of receive
scalar control can be efﬁciently addressed by using the SCA
method, where the approximated convex problem (30) is
solved at each iteration to generate a sequence {¯a((cid:96))} of im-
proved feasible solutions. With the converged ¯a∗, the optimal

Algorithm 2 SCA-Based Algorithm for Receive Scalar Con-
trol
1: Initialize a(0), the tolerance (cid:15)2, the maximum iteration

number L2, and set (cid:96)2 = 0.

2: if ε0 → +∞ then
3:

Obtain the optimal receive scalar a∗ at the BS via the
closed-form solution in (31), i.e., a∗ = K/ (cid:80)K
¯hkpk;

k=1

(cid:0)a((cid:96)2)(cid:1);

4: else
5:
6:
7:

Compute ¯a((cid:96)2) = 1/a((cid:96)2) and U ((cid:96)2) = RAirFL
repeat

Compute ¯a((cid:96)2+1) by solving problem (30);
Recover a((cid:96)2+1) = 1/¯a((cid:96)2+1);
Compute U ((cid:96)2+1) = RAirFL
Update (cid:96)2 := (cid:96)2 + 1;
(cid:12)U ((cid:96)2) − U ((cid:96)2−1)(cid:12)

8:
9:
10:
11:
12: end if
13: Output the receive scalar solution a∗.

(cid:12) ≤ (cid:15)2 or (cid:96)2 > L2;

(cid:0)a((cid:96)2+1)(cid:1);

until (cid:12)

receive scalar can be recovered as a∗ = 1/¯a∗. The details
of using SCA method to solve problem (27) is presented in
Algorithm 2.

To draw deep and useful insights into the receive scalar
control problem in a simpler case, we consider that the AirFL
users have no requirement on aggregation error, then the MSE
constraint in (15c) can be ignored. In that simpliﬁed case,
there is no need to tackle the non-convex constraint (28b),
and the receive scalar at the BS can be given in a closed-form
expression, which is provided in the following proposition.

Proposition 2: If all AirFL users do not have requirements
on aggregation error, i.e., ε0 → +∞, then the optimal receive
scalar at the BS can be derived as
K

(31)

a∗ =

(cid:80)K

,

¯hkpk

k=1
which is the reciprocal of the average value of the actual
quality indicators (i.e., the product of the power budget and
the combined channel gain) for all AirFL users.

Proof: When the MSE constraint in problem (28) is ig-
nored, it reduces into an unconstrained optimization problem:

9

[0, 2π), ∀m ∈ M, and solve the relaxed problem with con-
tinuous variable v1, then the obtained phase-shifting solution
θ∗ = [θ1, θ2, . . . , θM ] would be recovered into their closest
discrete values in A. Speciﬁcally, combining the deﬁnitions in
(24) and (25), the continuous counterpart of subproblem (17)
can be written as

F (v) − G (v)

max
v
s.t. (5), (15b) and (15c),

θm ∈ [0, 2π), ∀m ∈ M,

(34a)

(34b)

(34c)

where all constraints in (34b) represent their continuous coun-
terparts. Nevertheless, the problem is still non-convex due to
the non-convex objective function and constraints.

To facilitate derivation, we set α = 2, the combined channel

coefﬁcient is then given by2
ς0vHΦi
d0di

¯hi =

= vH (cid:101)Φi, ∀i ∈ I,

(35)

where (cid:101)Φi = ς0Φi
d0di
three lemma to tackle the non-convexity of problem (34).

, ∀i ∈ I. Besides, we give the following

Lemma 1: If we deﬁne Λi = (cid:101)Φi (cid:101)Φ

H
i , (cid:101)V = vvH and (cid:101)V (cid:23) 0,
then the combined channel gain is a convex function w.r.t. (cid:101)V ,
i.e.,

2

(cid:12)
(cid:12)¯hi

(cid:12)
(cid:12)

(cid:16)

(cid:17)

= tr

Λi (cid:101)V

, ∀i ∈ I.

(36)

Proof: Please refer to Appendix A.
Lemma 2: If we deﬁne (cid:98)Φk = aς0Φkpk

d0dk

, ∀k ∈ K and (cid:101)Λk =

(cid:98)Φk (cid:98)Φ

H
k , ∀k ∈ K, then we have
(cid:16)
(cid:12)
(cid:12)a¯hkpk

= tr

(cid:12)
(cid:12)

2

(cid:17)

(cid:101)Λk (cid:101)V

, ∀k ∈ K.

Proof: Please refer to Appendix B.

Lemma 3: If we deﬁne

(cid:98)Λk =

(cid:34)

H
k − (cid:98)Φk
(cid:98)Φk (cid:98)Φ
H
− (cid:98)Φ
k

0

(cid:35)

and ¯v =

(cid:20) v
1

(cid:21)

,

then we have

(cid:12)a¯hkpk − 1(cid:12)
(cid:12)
(cid:12)

2

= tr

(cid:16)

(cid:98)ΛkV

(cid:17)

+ 1, ∀k ∈ K,

(39)

(37)

(38)

min
¯a

(cid:88)K

k=1

(cid:12)
(cid:12)¯a − ¯hkpk

(cid:12)
(cid:12)

2

.

(32)

where V = ¯v¯vH, while V (cid:23) 0 and rank(V ) = 1.

(cid:0)¯a − ¯hkpk
Suppose f (¯a) = (cid:80)K
, and set the ﬁrst-order
derivative of f (¯a) to zero, i.e., f (cid:48)(¯a) = 0, the optimal solution
of ¯a can be obtained as

k=1

(cid:1)2

¯a∗ =

(cid:80)K

¯hkpk

k=1
K

.

(33)

Thus, the optimal receive scalar can be recovered as a∗ =
1/¯a∗, which completes the proof.

Proof: Please refer to Appendix C.

To unify the variables in (36), (37) and (39) as V , the

expressions in (36) and (37) can be rewritten as
(cid:16)˚ΛivvH(cid:17)
(cid:16) ¨ΛkvvH(cid:17)

(cid:16)˚ΛiV
(cid:16) ¨ΛkV

(cid:12)
(cid:12)¯hi
(cid:12)
(cid:12)a¯hkpk

, ∀i ∈ I,
(cid:17)

= tr

= tr

= tr

= tr

(cid:12)
2
(cid:12)

(cid:17)

, ∀k ∈ K.

(cid:12)
(cid:12)

2

(40)

(41)

where ˚Λi = diag( (cid:101)Φi (cid:101)Φ
are obtained by matrix lifting.

H

i , 0), ∀i and ¨Λk = diag( (cid:98)Φk (cid:98)Φ

H
k , 0), ∀k

C. Phase Shifts Design

With obtained transceiver solutions p∗ and a∗, the sub-
problem (17) w.r.t. discrete phase shifts is still challenging
due to the combinatorial optimization nature. As a result, we
propose to ﬁrst adopt the linear relaxation method to relax
them into the continuous ones, i.e., θm ∈ A −→ θm ∈

1In order to simplify the expression and reduce the number of symbols,
there are some symbol abuses in this subsection. For example, both the discrete
phase shift and its continuous counterpart are denoted by θm, so is v. For
clarity, we will put them in clear words when they represent discrete values.
2We assume that the small-scale fading g and hi are only related to the
statistical channel information, but not related to the location of RIS [29], thus
Φi = diag(gH)hi is assumed to be unchanged during one transmission.

F (V ) = (1−λ)Blog2

(cid:32)

(cid:88)

i∈I

|pi|2 tr

(cid:16)˚ΛiV

(cid:17)

+σ2

(cid:33)

(cid:32)

+λBlog2

(cid:88)

(cid:16) ¨ΛkV

tr

(cid:17)

+|a|2 σ2

(cid:33)

k∈K

G (V ) = (1−λ)Blog2

(cid:32)

(cid:88)

|pk|2 tr

(cid:16)˚ΛkV

(cid:17)

+σ2

(cid:33)

(cid:32)

+λBlog2

(cid:88)

(cid:16)

tr

(cid:98)ΛkV

(cid:17)

+K +|a|2 σ2

(cid:33)

k∈K

k∈K

10

(42)

(43)

Based on the above derivations in (39), (40) and (41), the
hybrid rate can be rewritten as RHybrid = F (V ) − G (V ),
where the exact expressions of F (V ) and G (V ) are given
in (42) and (43). In addition, the non-convex constraints (5),
(15b) and (15c) can be transformed as the following convex
ones:

(cid:16)˚ΛkV

tr

(cid:17)

≤ tr

(cid:16)˚ΛK+1V

(cid:17)

≤ . . . ≤ tr

(cid:16)˚ΛK+N V

(cid:17)

|pn|2 tr

(cid:16)˚ΛnV

(cid:17)

≥ ζn

(cid:32)n−1
(cid:88)

|pi|2 tr

(cid:16)˚ΛiV

(cid:17)

+ σ2

(cid:33)

,

,

(44)

(45)

i=1
(cid:17)

(cid:98)ΛkV

(cid:16)

tr

(cid:88)K

k=1

+ K + |a|2 σ2 ≤ ε0K 2.

(46)

With the newly derived objective function and constraints,
the continuous phase shifts design problem (34) can be ex-
pressed as

F (V ) − G (V )

max
V
s.t. (44), (45) and (46),

V m,m = 1, ∀m = 1, 2, . . . , M + 1,
V (cid:23) 0,
(cid:104)(cid:104)(cid:104)(cid:104)(cid:104)(cid:104)
rank(V ) = 1.

(47a)

(47b)

(47c)

(47d)

(47e)

Since only the rank-one constraint (47e) is non-convex in
problem (47), the SDR method can be invoked to relax this
constraint. After that, the relaxed problem of (47) is a convex
semideﬁnite programming (SDP) problem, thus the optimal
solution V ∗ can be obtained by using the well-known toolbox
such as CVX. Note that if the obtained solution V ∗ fails to
be rank-one, the Gaussian randomization method [38] can be
adopted to obtain a reconstructed rank-one solution to problem
(47). Alternatively, in order to avoid the limitations brought by
ignoring the rank-one constraint directly, the sequential rank-
one constraint relaxation approach [21] can also be invoked
to solve problem (47) for ﬁnding a local optimal rank-one
solution.

Eventually, by using the Cholesky decomposition V ∗ =
¯v∗¯v∗H and ¯v∗ = [v∗, 1]T, the optimal continuous reﬂection
vector v∗ can be obtained. Afterwards, the discrete phase shifts
can be straightforwardly recovered as

θm = arg min
θ∈A

|θ − θ∗

m| , ∀m ∈ M.

(48)

m = arg(v∗

where θ∗
m) is the continuous phase shift of the
m-th element of the obtained reﬂection vector. Based on the
above results, the SDR-based algorithm for discrete phase
shifts design can be summarized in Algorithm 3.

Remark 2: The proposed relaxation-then-quantization
scheme is a direct approach to ﬁnd a feasible solution, and
is highly suitable for the high-resolution case or the large

Algorithm 3 SDR-Based Algorithm for Phase Shifts Design
1: Initialize v(0), the tolerance (cid:15)3, the maximum iteration

number L3, and set (cid:96)3 = 0.
2: if both b and M are small then
3:
4: else
5:

Solve problem (17) via an exhaustive search method;

6:

7:

8:
9:

10:

Relax the phase shifts as θm ∈ [0, 2π), ∀m ∈ M;
Compute ¯v((cid:96)3) = [v((cid:96)3), 1]T and V ((cid:96)3) =
¯v((cid:96)3) (cid:0)¯v((cid:96)3)(cid:1)H
Compute U ((cid:96)3) = F
repeat

V ((cid:96)3)(cid:17)

V ((cid:96)3)(cid:17)

− G

(cid:16)

(cid:16)

;

;

(cid:16)

(cid:16)

V ((cid:96)3+1)(cid:17)

With given V ((cid:96)3), obtain V ((cid:96)3+1) by solving the
relaxed SDP problem of (47);
V ((cid:96)3+1)(cid:17)
Compute U ((cid:96)3+1) = F
Update (cid:96)3 := (cid:96)3 + 1;
(cid:12)U ((cid:96)3) − U ((cid:96)3−1)(cid:12)

until (cid:12)
Obtain ¯v∗ by Cholesky decomposition V ∗ = ¯v∗¯v∗H;
Obtain v∗ according to ¯v∗ = [v∗, 1]T;
Recover the discrete phase shifts θ∗ via (48);

11:
12:
13:
14:
15:
16: end if
17: Output the phase-shifting solution θ∗ = [θ1, θ2, . . . , θM ].

(cid:12) ≤ (cid:15)3 or (cid:96)3 > L3;

− G

;

RIS case that equips with many reﬂecting elements, especially
for the extreme case with continuous phase shifts. However,
it may be ineffective for some practical cases with very low
resolution (e.g., b = 1) and small RIS (e.g., M ≤ 5), due to the
non-negligible performance loss. To overcome this drawback,
an exhaustive search-based method can be used to obtain an
optimal solution for the low resolution and small RIS cases.

D. Convergence and Complexity Analysis

Invoking the designed algorithms to ﬁnd suboptimal so-
lutions for the corresponding decomposed subproblems, an
alternating optimization algorithm for solving the MINLP
problem (15) is given in Algorithm 4. In the ﬁrst step, the
transmit power at each user is performed based on the DC
programming-based allocation strategy, i.e., Algorithm 1. In
the second step, the receive scalar at the BS is controlled by
the converged solution obtained from the SCA-based receive
scaling approach, i.e., Algorithm 2. In the third step, the
design of the discrete phase shifts is determined according
to the relaxation-then-quantization method, i.e., Algorithm 3.
In addition, when the NOMA users have no requirement on
the target data rate, i.e., Rmin
n = 0, ∀n ∈ N , they just need
to perform full power transmission described in Proposition
1. On the other hand,
if the AirFL users can tolerate a
large error, i.e., ε0 (cid:29) 0, the optimal receive scalar can be

Algorithm 4 AO-Based Algorithm for Solving Problem (15)
1: Initialize (p(0), a(0), v(0)), the tolerance (cid:15)4, the maximum

iteration number L4, and set (cid:96)4 = 0.

(cid:0)p((cid:96)4), a((cid:96)4), v((cid:96)4)(cid:1);

2: Compute U ((cid:96)4+1) = RHybrid
3: repeat
4:
5:

6:
7:

8:
9:

Step 1: Transmit power allocation
Given (a((cid:96)4), v((cid:96)4)), obtain p((cid:96)4+1) by solving problems
(18) and (23) via Algorithm 1.
Step 2: Receive scalar control
Given (p((cid:96)4+1), v((cid:96)4)), obtain a((cid:96)4+1) by solving prob-
lem (27) via Algorithm 2.
Step 3: Phase shifts design
Given (p((cid:96)4+1), a((cid:96)4+1)), obtain (v((cid:96)4+1)) by solving
problem (17) via Algorithm 3;
Update (cid:96)4 := (cid:96)4 + 1;
(cid:12)U ((cid:96)4) − U ((cid:96)4−1)(cid:12)

10:
11: until (cid:12)
12: Output the converged solution (p∗, a∗, v∗).

(cid:12) ≤ (cid:15)4 or n4 > N4;

controlled by the closed-form solution in Proposition 2. In
these simpler cases, the complexity of Algorithm 4 can be
largely reduced. Moreover, the convergence and complexity of
the three-step alternating optimization algorithm are analyzed
in the following context.

1) Convergence:

denote
(p((cid:96)), a((cid:96)), v((cid:96))) as the solution to problem (15) obtained in
the (cid:96)-th iteration, where the objective value is deﬁned as

In Algorithm 4, we

(cid:16)

p((cid:96)), a((cid:96)), v((cid:96))(cid:17)

U

= RHybrid

(cid:16)

p((cid:96)), a((cid:96)), v((cid:96))(cid:17)

.

(49)

Let U ((cid:96)) = U (cid:0)p((cid:96)), a((cid:96)), v((cid:96))(cid:1), and substitute the current
solution (p((cid:96)), a((cid:96)), v((cid:96))) into (15). Then, executing Step 1-2-
3 once again, we have

U ((cid:96)) = U

(b)
≤ U

(cid:16)

(cid:16)

p((cid:96)), a((cid:96)), v((cid:96))(cid:17) (a)
p((cid:96)+1), a((cid:96)+1), v((cid:96))(cid:17) (d)
(cid:16)
≤ U

≤ U

p((cid:96)+1), a((cid:96)), v((cid:96))(cid:17)

(cid:16)

p((cid:96)+1), a((cid:96)+1), v((cid:96)+1)(cid:17)

(50)

= U ((cid:96)+1),

the receive scalar control

where the inequality (a), (b), and (c) comes from the fact that
the continuous improvements of the transmit power allocation
in Step 1,
in Step 2, and the
combinatorial optimization of reﬂection design in Step 3,
the achievable hybrid rate is non-
respectively. Therefore,
decreasing over the iterations. Meanwhile, owing to the ﬁnite
power budget and bandwidth, the optimal hybrid rate has a
limited upper bound. Thus, the sequence {U ((cid:96))} can at least
converge to a locally optimal solution of the original MINLP
problem (15), if not an optimal one.

2) Complexity: When the convex subproblems are solved
the interior point method is considered, unless
by CVX,
otherwise stated. For Algorithm 4,
the main complexity
of solving problem (15) lies in addressing the power al-
location problems with Algorithm 1 and dealing with the
reﬂection design problem with Algorithm 3. Speciﬁcally,
the worst-case complexity of Algorithm 1 can be expressed
1(K + 1)3(cid:1). The complexity of Algorithm
as O (cid:0)L1N 3 + L2
3 mainly depends on the steps from 8 to 12 for solv-

11

ing the convex SDP problem (47), which can be given
by O (cid:0)L3M 6(cid:1). Thus, the overall complexity of solving the
MINLP problem (15) with Algorithm 3 can be represented
as O (cid:0)L1L4N 3 + L2
1L4(K + 1)3 + L3L4M 6(cid:1), which can be
further reduced for these simpliﬁed cases without QoS and/or
MES constraints.

E. Extension to Multi-Antenna BS and Imperfect SIC Scenario

When the BS has Nr antennas, the BS-RIS link is denoted
by G ∈ CM ×Nr , and the receive vector at the BS is denoted
by a ∈ C1×Nr . Let ˜Φi = GHdiag(hi). Then, the combined
(cid:112)(d0di)−α ˜Φiv, ∀i ∈
channel coefﬁcient is given by ¯hi = ς0
I. The superposition signal received at the BS is expressed as
(cid:88)K+N

(cid:88)K

k=1

¯hkpksk
(cid:123)(cid:122)
(cid:125)
AirFL users

(cid:124)

+

(cid:124)

¯hnpnsn
(cid:125)

n=K+1
(cid:123)(cid:122)
NOMA users

,

+ z0
(cid:124)(cid:123)(cid:122)(cid:125)
noise

y =

(51)

where z0 ∼ CN (0, σ2I) is the AWGN at the BS.

Similar to the decoding order (5) in the single-antenna BS
scenario, the SIC decoding order in the multi-antenna BS
scenario can be ranked as
(cid:13)
(cid:13)¯hK+1
(cid:13)¯hk
· · · ≤
(cid:124)
(cid:125)
(cid:123)(cid:122)
weak signals that can not
be cancelled

· · · ≤ (cid:13)
(cid:13)¯hK+N
,
(cid:124)
(cid:125)
(cid:123)(cid:122)
strong signals that can
be partially cancelled

(cid:13)
(cid:13)¯hn

∀k, n.

≤ (cid:13)

(cid:13)
2
(cid:13)

(cid:13)
2
(cid:13)

(cid:13)
2
(cid:13)

(cid:13)
2
(cid:13)

(52)
Accordingly, a generic SINR representation of the imperfect

SIC receiver can be given by
|pn|2 (cid:13)

¯γn =

|pk|2 (cid:13)

(cid:13)¯hk

(cid:13)
2
(cid:13)

+ (cid:15)b

n−1
(cid:80)
k=1

(cid:13)
2
(cid:13)¯hn
(cid:13)
N +K
(cid:80)
i=n+1

|pi|2 (cid:13)

(cid:13)¯hi

, ∀n ∈ N ,

(cid:13)
2
(cid:13)

+ σ2

(53)
where (cid:15)b ∈ [0, 1] denotes the imperfect SIC coefﬁcient
that characterizes the residual interference from strong users.
Speciﬁcally, (cid:15)b = 0 is the ideal case of perfect SIC, while
(cid:15)b = 1 represents the situation without SIC. Based on (53),
the sum rate of all NOMA users is given by

¯RNOMA =

(cid:88)K+N

n=K+1

B log2 (1 + ¯γn) .

(54)

(cid:15)b

(cid:80)K+N

model aggregation is given by ˆy = (cid:80)K
√

Due to the imperfect SIC, the residual signal for AirFL
¯hkpksk +
¯hnpnsn + z0. By applying the receive vector
a to the residual signal ˆy, we get the reconstructed AirFL
signal as ¯s = aˆy/K. Then, the MSE in the multi-antenna BS
and imperfect SIC scenario is given by

n=K+1

k=1

MSE(¯s, s) (cid:44) E(|¯s − s|2)

=

1
K 2

K
(cid:88)

k=1

(cid:12)
(cid:12)a¯hkpk − 1(cid:12)
(cid:12)

2

+

(cid:15)b
K 2

K+N
(cid:88)

n=K+1

(cid:12)
(cid:12)a¯hnpn

(cid:12)
(cid:12)

2

+

(cid:107)a(cid:107)2σ2
K 2

.

(55)

Similar to (12) in Deﬁnition 1, the computation rate of
AirFL users is given in (56) at the top of the next page. Finally,
substituting (52)-(56) into problem (15), we can obtain the
optimization problem for the multi-antenna BS and imperfect
SIC scenario. Due to the problem similarity, the decomposition
method of Section III and the iterative algorithms of Section

¯RAirFL = B log2

(cid:32) (cid:80)K

2

(cid:12)
(cid:12)

(cid:12)
(cid:12)a¯hkpk
k=1
(cid:12)a¯hkpk − 1(cid:12)
(cid:12)
(cid:12)

+ (cid:15)b
2

+ (cid:15)b

(cid:80)K+N

n=K+1
(cid:80)K+N

n=K+1

2

(cid:12)
(cid:12)
(cid:12)a¯hnpn
(cid:12)
(cid:12)
(cid:12)a¯hnpn

(cid:80)K

k=1

(cid:33)

+ (cid:107)a(cid:107)2σ2
(cid:12)
2
(cid:12)

+ (cid:107)a(cid:107)2σ2

12

(56)

Fig. 4. Simulation setup of the RIS-aided hybrid network (3D view).

IV can be extended to solve it efﬁciently, details of which are
omitted for simplicity.

V. NUMERICAL RESULTS

A. Simulation Settings

The simulation setup is shown in Fig. 4, we consider that
there are I = 6 users and one BS in the RIS-aided hybrid
network, where K = 4 AirFL users and N = 2 NOMA users
are randomly and uniformly distributed in a circle centered at
(5, 50, 0) (in meters) with radius 3 m. In the three-dimensional
(3D) Cartesian coordinates, the BS and RIS are located at
(5, 0, 15) and (0, 40, 15), respectively. Moreover, the reference
pass loss is set as ς0 = −30 dBm, and the Rician factor
is 2. The power budget of the i-th user is Pi = Pmax =
23 dBm, ∀i ∈ I, and the noise power is σ2 = −80 dBm. The
transmission bandwidth is set as B = 1 MHz, the minimum
rate requirement of the n-th NOMA user is assumed to be
Rmin
n = Rmin = 2 Mbps, ∀n ∈ N , and the aggregation
error tolerance of the AirFL users is ε0 = 0.01. The number
of reﬂecting elements is set as M = 20, the quantization
resolution is b = 2, and the default weight parameter is
λ = 0.5, unless otherwise stated.

In order to validate the effectiveness of our proposed al-
gorithms for the hybrid network with non-ideal phase shifts
(labeled ‘Discrete RIS’), the following schemes are considered
as benchmarks:

i. Continuous RIS: The phase shift of each reﬂecting ele-
ment can be tuned with arbitrary continuous value from
0 to 2π, i.e., b → ∞. In this way, the combinatorial con-
straint in (15d) can be relaxed as θm ∈ [0, 2π), ∀m ∈ M.
As a result, the subproblem of phase shifts design is
directly solved by the SDR method, and the Gaussian
randomization approach can be recalled if the obtained
solution is not rank-one.

Fig. 5. Hybrid rate versus the number of iterations.

ii. Random RIS: The phase shift of each reﬂecting element
is initialized with random value from 0 to 2π, and then
set to discrete value in A via the method proposed in
(48). By doing so, only the transceiver design problem
(16) needs to be optimized at each iteration.

iii. Relaxed QoS: By setting Rmin = 0, the QoS require-
ments requested in constraints (15b) can be ignored. In
this case, the optimal transmit power at NOMA users
is the full power transmission (refer to Proposition 1),
which also can be deemed as the upper bound of the
communication rate that can be obtained by the NOMA
users with other variables ﬁxed.

iv. Relaxed MSE: By setting ε0 → ∞, the MSE require-
ments requested in constraints (15c) can be ignored. In
this case, the optimal receive scalar for AirFL users can
be obtained in (31) (refer to Proposition 2), which also
can be deemed as the upper bound of the computation
rate that can be achieved by AirFL users with optimized
transmit power and phase shifts.

The convergence accuracy of the proposed algorithms is
set as 10−6 for striking a balance between performance and
complexity. All presented results have been averaged over
2000 independent trials of the user positions and the channel
realizations.

B. Performance Evaluation

1) Convergence of the proposed algorithm: In Fig. 5, the
convergence performance of the proposed algorithm versus
the iteration number is depicted, which illustrates that the
proposed AO-based algorithm can converge under different
number of users, reﬂecting elements and quantization resolu-
tion. Furthermore, it is observed that the hybrid rate grows
quickly with the number of iterations, which also increases

OxyzBSObstacleUser 5User 2User 3User 6User 4User 1RISHybrid users50 m5 m(5, 0, 15)(0, 40, 15)Number of iterations135791113151719Hybrid rate (bps)×10600.511.522.533.54K=4, M=40, b=2K=4, M=40, b=1K=2, M=20, b=2K=2, M=20, b=1K=2, M=20K=4, M=4013

Fig. 6. Hybrid rate versus the location of RIS coordinate.

Fig. 7. Hybrid rate versus the number of AirFL users.

with the number of users and reﬂecting elements, owing to
the fact that there are more variables to be optimized over
iterations. To be speciﬁc, when K = 2 and M = 20,
the proposed algorithm needs only 9 iterations to satisfy
the convergence accuracy, while it converges with around 13
iterations when K = 4 and M = 40. From this ﬁgure,
it also can be seen that with higher quantization resolution,
the conﬁguration of the RIS becomes more ﬂexible and thus
achieves better convergence performance.

2) Impact of the RIS location: In Fig. 6, the impact of the
RIS location on the achievable hybrid rate is evaluated. In this
ﬁgure, the locations of the BS and RIS are reset as (0, 0, 0) and
(0, yRIS, 0), respectively, and the users are randomly placed
in a circle centered at (0, 60, 0) with radius 5 m. By moving
the RIS from yRIS = 10 m (BS side) to yRIS = 50 m (user
side), it is interesting to observe that the hybrid rate achieved
by the proposed algorithm ﬁrst decrease with yRIS (10 m ≤
yRIS ≤ 30 m) and then increase with yRIS (30 m ≤ yRIS ≤
50 m) after achieving their minimum values at yRIS = 30 m
(midpoint). This is mainly because the double fading effect
experienced by the reﬂective link. Similar to the analysis in
[33], we focus on the large-scale path loss of the combined
0 (d0di)−α , ∀i ∈ I. Note that
channel gain, i.e., L0Li = ς 2
d0 + di (cid:39) 60, ∀i ∈ I, thus the minimal value of the combined
channel gain can be obtained at d0 = di (cid:39) 30. Namely, it
is harmful for hybrid rate maximization to deploy the RIS
at the midpoint between the BS and the users. Therefore, the
system performance can be signiﬁcantly improved by carefully
selecting the location of the RIS, which provides guidance for
the practical deployment of the RIS.

3) Impact of the number of AirFL users: In Fig. 7, we
investigate the performance of the proposed RIS-aided hybrid
network versus different number of AirFL users in the uniﬁed
framework. Here the number of NOMA users is ﬁxed as
we focus on the impact of AirFL users. One can observe
from Fig. 7, for all considered schemes, the achievable hybrid
rate will rise steadily as the number of AirFL users grows
gradually in the system. This veriﬁes that the remarks still

Fig. 8. Hybrid rate versus the imperfect SIC coefﬁcient.

hold true when the number of users increases. Not sur-
prisingly, the schemes of ‘Continuous RIS’ are capable of
outperforming other benchmarks with/without QoS and MSE
constraints. This shows the great strength of high-resolution
RIS in mitigating communication interference and enhancing
function aggregation in the integrated network, despite this
may increase the production cost of RIS. To be more speciﬁc,
when K = 8 in the ‘Discrete RIS’ scheme, we ﬁnd that the
setting of b = 2 can achieve about 5.3% higher hybrid rate
than that of b = 1, which also validates the effectiveness of
the proposed relaxation-then-quantization scheme in tackling
reﬂection design problem.

4) Impact of the imperfect SIC: In Fig. 8, we show the
achievable hybrid rate under different values of the imperfect
SIC coefﬁcient. In order to compare the different effects of
increasing the SIC coefﬁcient and the number of AirFL users
on the hybrid rate, the starting points in Fig. 8 are the same
as that in Fig. 7. From Fig. 8, we observe that the achievable
hybrid rate of all considered schemes decreases with the
imperfect SIC coefﬁcient (cid:15)b. This matches our intuition that

RIS location, yRIS (m)1020304050Hybrid rate (bps)×10633.23.43.63.84Continuous RIS: Rmin = 2, ǫ0 = 0.01, b → ∞Discrete RIS: Rmin = 2, ǫ0 = 0.01, b = 2Discrete RIS: Rmin = 2, ǫ0 = 0.01, b = 1Random RIS: Rmin = 2, ǫ0 = 0.01, b = 1Minimum value5678910Number of AirFL users, K2.533.54Hybrid rate (bps)106Continuous RIS: Rmin = 0, 0  , b  Continuous RIS: Rmin = 2, 0 = 0.01, b  Discrete RIS: Rmin = 2, 0 = 0.01, b = 2Discrete RIS: Rmin = 2, 0 = 0.01, b = 1Random RIS: Rmin = 0, 0  , b = 2Random RIS: Rmin = 2, 0 = 0.01, b = 1Continuous RISRandom RISDiscrete RIS00.020.040.060.080.1Imperfect SIC coefficient, b22.533.54Hybrid rate (bps)106Continuous RIS: Rmin = 0, 0  , b  Continuous RIS: Rmin = 2, 0 = 0.01, b  Discrete RIS: Rmin = 2, 0 = 0.01, b = 2Discrete RIS: Rmin = 2, 0 = 0.01, b = 1Random RIS: Rmin = 0, 0  , b = 2Random RIS: Rmin = 2, 0 = 0.01, b = 1Random RISContinuous RISDiscrete RIS14

uniﬁed design are simultaneously served in a non-orthogonal
manner with the objective of max RNOMA +RAirFL. One can
notice that the achievable rates of both separate and uniﬁed
designs grow with the number of AirFL users. Speciﬁcally,
for (cid:15)b = 0 (perfect SIC) and (cid:15)b = 0.01 (nearly perfect SIC),
we see that the hybrid rate of uniﬁed design is always higher
than the sum rate of separate design. However, if we increase
(cid:15)b to a larger value, an interesting point is that the hybrid rate
of uniﬁed design will be lower than the sum rate of separate
design, e.g., (cid:15)b = 0.2 (imperfect SIC) and (cid:15)b = 1 (no SIC).
This is because both NOMA and AirFL users in the uniﬁed
design will experience more severe inter-user interference as
the increase of (cid:15)b. Whereas, AirFL users in the separate
design do not experience any interference from NOMA users
due to time division. This also validates the importance of
efﬁcient interference management for the proposed uniﬁed
design. In Fig. 10, considering K = 10 AirFL users with
perfect SIC, we compare the achievable rate of separate design
and uniﬁed design versus the number of reﬂecting elements.
It can be found that the proposed uniﬁed design outperforms
separate design under different RIS settings. Speciﬁcally, for
the discrete RIS with M = 20, the hybrid rate of uniﬁed
design has a 15.4% increment compared to the sum rate of
separate design.

6) Impact of the number of reﬂecting elements: In Fig. 11,
the hybrid rate performance versus the number of reﬂecting
elements at the RIS and the power budget at the users are
the following three cases are
illustrated. For comparison,
considered, i.e., i) λ = 0, i.e., there are only 2 NOMA users;
ii) λ = 0.5, i.e., there are 4 hybrid users; iii) λ = 1, i.e.,
there are only 2 AirFL users. Speciﬁcally, the ﬁrst row of Fig.
11 evaluates the impact of the number of reﬂecting elements
on the achievable rate under three cases. On the whole, the
following two insights can easily be drawn. The ﬁrst one is
that the achievable rate under all cases grows with the number
of reﬂecting elements M , which reveals the effectiveness of
having more reﬂecting elements at the RIS. Besides, it is
observed that for hybrid rate of 3×106 bps, we need to deploy
around 20 reﬂecting elements with b = 2. In contrast, with
the same hybrid rate performance, we can alternatively use
about 25 reﬂecting elements with b = 1 at the RIS. Therefore,
another interesting insight is that the RIS-aided hybrid network
provides more ﬂexibility to balance the trade-off between the
number of passive elements and their quantization resolution.
7) Impact of the power budget: The second row of Fig. 11
plots the achievable rate versus the maximum transmit power
at users. Similar insights mentioned above are omitted here for
brevity. Distinctively, one can notice that the achievable rate
of all considered schemes grows linearly with Pmax, which
is an attractive trend. But the available power is limited in
practice, especially for these low-cost devices. Additionally,
the achievable rate can be signiﬁcantly improved by jointly
optimizing the transceiver and the phase shifts at the RIS,
regardless of the values of λ and Pmax. More particularly,
when Pmax = 25 dBm and b = 1, it can be obtained that
the RIS-aided wireless networks are capable of providing up
to 22.3%, 16.9% and 20.6% higher achievable rate than the
random RIS schemes under three cases (i.e., λ = 0, 0.5, 1).

Fig. 9. Achievable rate comparison of separate design and uniﬁed design
with different values of the imperfect SIC coefﬁcient and different numbers
of AirFL users.

Fig. 10. Achievable rate comparison of separate design and uniﬁed design
versus the number of reﬂecting elements under different RIS settings.

imperfect SIC leads to a higher residual interference than
perfect SIC, thus reducing the achievable rate. This is because
when the value of (cid:15)b increases, both NOMA users and AirFL
users experience serious interference, which degrades the
communication rate and the computation rate at the same time,
resulting in the decrease of hybrid rate.

5) Separate design versus uniﬁed design:

In Fig. 9, we
compare the achievable rate of separate design and uniﬁed
design with different values of the imperfect SIC coefﬁcient
and different numbers of AirFL users. For a fair comparison of
two diametrically opposite paradigms, both designs occupy the
same time slot length and utilize the whole system bandwidth.
In the separate design, two types of users are alternatively
scheduled and the associated rates are independently maxi-
mized. To be speciﬁc, half of the time slot is only used to
serve NOMA users for the purpose of max RNOMA, while
the remaining AirFL users are served by the rest time slot with
the aim of max RAirFL. In contrast, all hybrid users in the

66.57Achievable rate (bps)106Hybrid rate of unified design: b = 0Sum rate of separate design: b = 0Hybrid rate of unified design: b = 0.01Sum rate of separate design: b = 0.015678910Number of AirFL users, K246Achievable rate (bps)106Hybrid rate of unified design: b = 0.2Sum rate of separate design: b = 0.2Hybrid rate of unified design: b = 1Sum rate of separate design: b = 1b = 0.01b = 0Separate designUnified design51015202530468Continuous RIS: Rmin = 2, 0 = 0.01, b  Hybrid rate of unified designSum rate of separate design51015202530468Achievable rate (Mbps)Discrete RIS: Rmin = 2, 0 = 0.01, b = 2Hybrid rate of unified designSum rate of separate design51015202530Number of reflecting elements, M46Random RIS: Rmin = 2, 0 = 0.01, b = 2Hybrid rate of unified designSum rate of separate design15

(a) Communication rate versus M

(b) Hybrid rate versus M

(c) Computation rate versus M

(d) Communication rate versus Pmax

(e) Hybrid rate versus Pmax

(f) Computation rate versus Pmax

Fig. 11. Achievable rate under different settings: communication rate (λ = 0), hybrid rate (λ = 0.5) and computation rate (λ = 1) versus the number of
reﬂecting elements (M ∈ [5 30]) and the power budget (Pmax ∈ [21 26]).

This is because that the RIS is beneﬁcial to enhance the
channel quality for NOMA users and reduce the aggregation
error for AirFL users by carefully adjusting the decoding order
of all users.

VI. CONCLUSION

In this paper, we proposed a novel RIS-aided hybrid network
to effectively integrate AirFL and NOMA into an elastic
framework. The role of RIS is twofold: i) efﬁciently enhance
the channel condition and networking coverage that may be
unfavorable due to complete blockage, and ii) ﬂexibly change
the channel gains of hybrid users to achieve an on-demand
decoding order that is efﬁcient for NOMA, for AirFL, and for
the combination of both. Speciﬁcally, we investigated an in-
tractable resource allocation problem of the RIS-aided hybrid
network by jointly optimizing the transmit power, the receive
scalar, and the phase shifts for hybrid rate maximization
while meeting QoS requirements as well as MSE tolerance.
To address this challenging mixed-combinatorial optimization
problem, we devised an alternating optimization algorithm to
tackle the decoupled non-convex subproblems by iteratively
adopting approximation techniques such as DC programming,
SCA, and SDR methods. Besides, regarding the reduced
subproblems of transmit power allocation and receive scalar
design, the optimal solutions were derived in closed form.
Furthermore, the complexity and convergence performance
were analyzed. Finally, simulation results demonstrated that
the proposed RIS-aided network can simultaneously serve
hybrid users on the entire bandwidth effectively, and the

achievable hybrid rate can be signiﬁcantly enhanced by tuning
the RIS judiciously.

APPENDIX A
PROOF OF LEMMA 1

According to (35), with given α = 2, the combined channel

gain can be expanded as

2

(cid:12)
(cid:12)¯hi

(cid:12)
(cid:12)

= vH (cid:101)Φi (cid:101)Φ

H
i v = vHΛiv, ∀i ∈ I.

(57)

Note that vHΛiv = tr (cid:0)ΛivvH(cid:1) , ∀i ∈ I, we thus have

2

(cid:12)
(cid:12)¯hi

(cid:12)
(cid:12)

= tr (cid:0)ΛivvH(cid:1) = tr

(cid:16)

Λi (cid:101)V

(cid:17)

, ∀i ∈ I,

(58)

where Λi = (cid:101)Φi (cid:101)Φ
completed.

H
i , (cid:101)V = vvH and (cid:101)V (cid:23) 0. The proof is

APPENDIX B
PROOF OF LEMMA 2

When (cid:98)Φk = aς0Φkpk
(37) can be expanded as

d0dk

, ∀k ∈ K, the left-hand-side (LHS) in

(cid:12)
(cid:12)a¯hkpk

(cid:12)
2
(cid:12)

=

2

(cid:12)
(cid:12)vH (cid:98)Φk
(cid:12)

(cid:12)
(cid:12)
(cid:12)

H
= vH (cid:98)Φk (cid:98)Φ
k v, ∀k ∈ K.

(59)

Since (cid:101)Λk = (cid:98)Φk (cid:98)Φ
(cid:12)
(cid:12)a¯hkpk

H
k , ∀k ∈ K, then we can obtain
(cid:16)
(cid:101)ΛkvvH(cid:17)
which completes the proof.

(cid:101)Λk (cid:101)V

= tr

= tr

(cid:12)
2
(cid:12)

(cid:17)

(cid:16)

, ∀k ∈ K,

(60)

Number of reflecting elements, M51015202530Communication rate (bps)×1060123456789Weight parameter: λ = 0Continuous RIS: Rmin = 0, b → ∞Continuous RIS: Rmin = 2, b → ∞Discrete RIS: Rmin = 2, b = 2Discrete RIS: Rmin = 2, b = 1Random RIS: Rmin = 0, b = 2Random RIS: Rmin = 2, b = 1Random RISContinuous RISDiscrete RISNumber of reflecting elements, M51015202530Hybrid rate (bps)×10611.522.533.54Weight parameter: λ = 0.5Continuous RIS: Rmin = 0, ǫ0 → ∞, b → ∞Continuous RIS: Rmin = 2, ǫ0 = 0.01, b → ∞Discrete RIS: Rmin = 2, ǫ0 = 0.01, b = 2Discrete RIS: Rmin = 2, ǫ0 = 0.01, b = 1Random RIS: Rmin = 0, ǫ0 → ∞, b = 2Random RIS: Rmin = 2, ǫ0 = 0.01, b = 1Continuous RISDiscrete RISRandom RISNumber of reflecting elements, M51015202530Computation rate (bps)×1061234567Weight parameter: λ = 1Continuous RIS: ǫ0 → ∞, b → ∞Continuous RIS: ǫ0 = 0.01, b → ∞Discrete RIS: ǫ0 = 0.01, b = 2Discrete RIS: ǫ0 = 0.01, b = 1Random RIS: ǫ0 → ∞, b = 2Random RIS: ǫ0 = 0.01, b = 1Discrete RISContinuous RISRandom RISPower budget, Pmax (dBm)212223242526Communication rate (bps)×10644.555.566.577.588.5Weight parameter: λ = 0Continuous RIS: Rmin = 0, b → ∞Continuous RIS: Rmin = 2, b → ∞Discrete RIS: Rmin = 2, b = 2Discrete RIS: Rmin = 2, b = 1Random RIS: Rmin = 0, b = 2Random RIS: Rmin = 2, b = 1Power budget, Pmax (dBm)212223242526Hybrid rate (bps)×10622.533.54Weight parameter: λ = 0.5Continuous RIS: Rmin = 0, ǫ0 → ∞, b → ∞Continuous RIS: Rmin = 2, ǫ0 = 0.01, b → ∞Discrete RIS: Rmin = 2, ǫ0 = 0.01, b = 2Discrete RIS: Rmin = 2, ǫ0 = 0.01, b = 1Random RIS: Rmin = 0, ǫ0 → ∞, b = 2Random RIS: Rmin = 2, ǫ0 = 0.01, b = 1Power budget, Pmax (dBm)212223242526Computation rate (bps)×10633.544.555.566.57Weight parameter: λ = 1Continuous RIS: ǫ0 → ∞, b → ∞Continuous RIS: ǫ0 = 0.01, b → ∞Discrete RIS: ǫ0 = 0.01, b = 2Discrete RIS: ǫ0 = 0.01, b = 1Random RIS: ǫ0 → ∞, b = 2Random RIS: ǫ0 = 0.01, b = 1(62)

(63)

APPENDIX C
PROOF OF LEMMA 3

Similarly, the LHS in (39) can be rewritten as

(cid:12)a¯hkpk − 1(cid:12)
(cid:12)
(cid:12)

2

=

(cid:12)
(cid:12)
(cid:12)vH (cid:98)Φk − 1
(cid:12)
(cid:12)
(cid:12)

2

, ∀k ∈ K.

(61)

Then, it can be expanded as

(cid:12)a¯hkpk − 1(cid:12)
(cid:12)
(cid:12)

2

H
H
k v − vH (cid:98)Φk − (cid:98)Φ
k v + 1

= vH (cid:98)Φk (cid:98)Φ
= ¯vH (cid:98)Λk ¯v + 1, ∀k ∈ K,

where

(cid:34)

(cid:98)Λk =

(cid:35)

and ¯v =

(cid:20) v
1

(cid:21)

.

H
(cid:98)Φk (cid:98)Φ
k − (cid:98)Φk
H
− (cid:98)Φ
k
(cid:16)

0
(cid:98)Λk ¯v¯vH(cid:17)

Note that ¯vH

k (cid:98)Λk ¯v = tr

, ∀k ∈ K, we thus have

(cid:16)

(cid:98)Λk ¯v¯vH(cid:17)

(cid:12)a¯hkpk − 1(cid:12)
(cid:12)
(cid:12)

2

= tr

+ 1, ∀k ∈ K,
(64)
where V = ¯v¯vH, while V (cid:23) 0 and rank(V ) = 1. This
completes the proof.

+ 1 = tr

(cid:98)ΛkV

(cid:16)

(cid:17)

REFERENCES

[1] W. Ni, Y. Liu, Z. Yang et al., “Over-the-air federated learning and non-
orthogonal multiple access uniﬁed by reconﬁgurable intelligent surface,”
in Proc. IEEE INFOCOM Workshops, Virtual, May 2021.

[2] M. Chen, U. Challita, W. Saad et al., “Artiﬁcial neural networks-based
machine learning for wireless networks: A tutorial,” IEEE Commun.
Surveys Tut., vol. 21, no. 4, pp. 3039–3071, Fourthquarter 2019.
[3] Y. Liu, S. Bi, Z. Shi et al., “When machine learning meets big data: A
wireless communication perspective,” IEEE Veh. Technol. Mag., vol. 15,
no. 1, pp. 63–72, Mar. 2020.

[4] X. Lyu, C. Ren, W. Ni et al., “Optimal online data partitioning for geo-
distributed machine learning in edge of wireless networks,” IEEE J. Sel.
Areas Commun., vol. 37, no. 10, pp. 2393–2406, Oct. 2019.

[5] B. Nazer and M. Gastpar, “Computation over multiple-access channels,”
IEEE Trans. Inf. Theory, vol. 53, no. 10, pp. 3498–3516, Oct. 2007.
[6] K. Yang, T. Jiang, Y. Shi et al., “Federated learning via over-the-air
computation,” IEEE Trans. Wireless Commun., vol. 19, no. 3, pp. 2022–
2035, Mar. 2020.

[7] W. Ni, Y. Liu, Z. Yang et al., “Federated learning in multi-RIS
aided systems,” IEEE Internet of Things J., 2021, early access, doi:
10.1109/JIOT.2021.3130444.

[8] Z. Zhang, Y. Xiao, Z. Ma et al., “6G wireless networks: Vision,
requirements, architecture, and key technologies,” IEEE Veh. Technol.
Mag., vol. 14, no. 3, pp. 28–41, Sept. 2019.

[9] Y. Liu, Z. Qin, M. Elkashlan et al., “Nonorthogonal multiple access for
5G and beyond,” Proc. IEEE, vol. 105, no. 12, pp. 2347–2381, Dec.
2017.

[10] G. Zhu, Y. Wang, and K. Huang, “Broadband analog aggregation for
low-latency federated edge learning,” IEEE Trans. Wireless Commun.,
vol. 19, no. 1, pp. 491–506, Jan. 2020.

[11] Q. Qi, X. Chen, C. Zhong et al., “Integrated sensing, computation
and communication in B5G cellular Internet of Things,” IEEE Trans.
Wireless Commun., vol. 20, no. 1, pp. 332–344, Jan. 2021.

[12] Z. Yang, M. Chen, W. Saad et al., “Energy efﬁcient federated learning
over wireless communication networks,” IEEE Trans. Wireless Com-
mun., vol. 20, no. 3, pp. 1935–1949, Mar. 2021.

[13] M. Mohammadi Amiri and D. G¨und¨uz, “Machine learning at

the
wireless edge: Distributed stochastic gradient descent over-the-air,” IEEE
Trans. Signal Process., vol. 68, no. 1, pp. 2155–2169, Mar. 2020.
[14] G. Zhu, Y. Du, D. G¨und¨uz et al., “One-bit over-the-air aggregation for
communication-efﬁcient federated edge learning: Design and conver-
gence analysis,” IEEE Trans. Wireless Commun., vol. 20, no. 3, pp.
2120–2135, Mar. 2021.

[15] Y. Liu, X. Li, F. R. Yu et al., “Grouping and cooperating among access
points in user-centric ultra-dense networks with non-orthogonal multiple
access,” IEEE J. Sel. Areas Commun., vol. 35, no. 10, pp. 2295–2311,
Oct. 2017.

16

[16] J. Zhao, Y. Liu, K. K. Chai et al., “Spectrum allocation and power
control for non-orthogonal multiple access in HetNets,” IEEE Trans.
Wireless Commun., vol. 16, no. 9, pp. 5825–5837, Sept. 2017.

[17] J. Cui, Y. Liu, Z. Ding et al., “QoE-based resource allocation for multi-
cell NOMA networks,” IEEE Trans. Wireless Commun., vol. 17, no. 9,
pp. 6160–6176, Sept. 2018.

[18] M. Chen, Z. Yang, W. Saad et al., “A joint learning and communications
framework for federated learning over wireless networks,” IEEE Trans.
Wireless Commun., vol. 20, no. 1, pp. 269–283, Jan. 2021.

[19] L. Chen, X. Qin, and G. Wei, “A uniform-forcing transceiver design
for over-the-air function computation,” IEEE Wireless Commun. Lett.,
vol. 7, no. 6, pp. 942–945, Dec. 2018.

[20] T. Jiang and Y. Shi, “Over-the-air computation via intelligent reﬂecting
surfaces,” in Proc. IEEE GLOBECOM, Waikoloa, HI, USA, Dec. 2019.
[21] X. Mu, Y. Liu, L. Guo et al., “Exploiting intelligent reﬂecting surfaces
in NOMA networks: Joint beamforming optimization,” IEEE Trans.
Wireless Commun., vol. 19, no. 10, pp. 6884–6898, Oct. 2020.

[22] W. Ni, X. Liu, Y. Liu et al., “Resource allocation for multi-cell IRS-
aided NOMA networks,” IEEE Trans. Wireless Commun., vol. 20, no. 7,
pp. 4253–4268, Jul. 2021.

[23] X. Liu, Y. Liu, Y. Chen et al., “RIS enhanced massive non-orthogonal
multiple access networks: Deployment and passive beamforming de-
sign,” IEEE J. Sel. Areas Commun., vol. 39, no. 4, pp. 1057–1071,
2021 Apr.

[24] T. Gafni, N. Shlezinger, K. Cohen et al., “Federated learning: A signal
processing perspective,” IEEE Signal Process. Mag., vol. 39, no. 3, pp.
14–41, May 2022.

[25] B. Di, H. Zhang, L. Song et al., “Hybrid beamforming for reconﬁgurable
intelligent surface based multi-user communications: Achievable rates
with limited discrete phase shifts,” IEEE J. Sel. Areas Commun., vol. 38,
no. 8, pp. 1809–1822, Aug. 2020.

[26] Q. Wu and R. Zhang, “Beamforming optimization for wireless network
aided by intelligent reﬂecting surface with discrete phase shifts,” IEEE
Trans. Commun., vol. 68, no. 3, pp. 1838–1851, Mar. 2020.

[27] H. Zhang, B. Di, L. Song et al., “Reconﬁgurable intelligent surfaces
assisted communications with limited phase shifts: How many phase
shifts are enough?” IEEE Trans. Veh. Technol., vol. 69, no. 4, pp. 4498–
4502, Apr. 2020.

[28] C. Huang, A. Zappone, G. C. Alexandropoulos et al., “Reconﬁgurable
intelligent surfaces for energy efﬁciency in wireless communication,”
IEEE Trans. Wireless Commun., vol. 18, no. 8, pp. 4157–4170, Aug.
2019.

[29] X. Mu, Y. Liu, L. Guo et al., “Joint deployment and multiple access
design for intelligent reﬂecting surface assisted networks,” IEEE Trans.
Wireless Commun., vol. 20, no. 10, pp. 6648–6664, Oct. 2021.

[30] C. Huang, R. Mo, and C. Yuen, “Reconﬁgurable intelligent surface as-
sisted multiuser MISO systems exploiting deep reinforcement learning,”
IEEE J. Sel. Areas Commun., vol. 38, no. 8, pp. 1839–1850, Aug. 2020.
[31] Z. Wang, L. Liu, and S. Cui, “Channel estimation for intelligent reﬂect-
ing surface assisted multiuser communications: Framework, algorithms,
and analysis,” IEEE Trans. Wireless Commun., vol. 19, no. 10, pp. 6607–
6620, Oct. 2020.

[32] H. Liu, X. Yuan, and Y. J. A. Zhang, “Matrix-calibration-based cas-
caded channel estimation for reconﬁgurable intelligent surface assisted
multiuser MIMO,” IEEE J. Sel. Areas Commun., vol. 38, no. 11, pp.
2621–2636, Nov. 2020.

[33] J. Zuo, Y. Liu, Z. Qin et al., “Resource allocation in intelligent reﬂecting
surface assisted NOMA systems,” IEEE Trans. Commun., vol. 68, no. 11,
pp. 7170–7183, Nov. 2020.

[34] G. Zhu and K. Huang, “MIMO over-the-air computation for high-
mobility multimodal sensing,” IEEE Internet Things J., vol. 6, no. 4,
pp. 6089–6103, Aug. 2019.

[35] Y. Hu, M. Chen, M. Chen et al., “Energy minimization for federated
learning with IRS-assisted over-the-air computation,” in Proc. IEEE
ICASSP, Toronto, Canada, Jun. 2021, pp. 3105–3109.

[36] M. Grant and S. Boyd, “CVX: Matlab software for disciplined
convex programming, version 2.1,” Mar. 2014. [Online]. Available:
http://cvxr.com/cvx

[37] M. Zeng, X. Li, G. Li et al., “Sum rate maximization for IRS-assisted
uplink NOMA,” IEEE Commun. Lett., vol. 25, no. 1, pp. 234–238, Jan.
2021.

[38] Z. Luo, W. Ma, A. M. So et al., “Semideﬁnite relaxation of quadratic
optimization problems,” IEEE Signal Process. Mag., vol. 27, no. 3, pp.
20–34, May 2010.

