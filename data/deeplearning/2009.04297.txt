0
2
0
2

p
e
S
9

]
h
p
-
t
n
a
u
q
[

1
v
7
9
2
4
0
.
9
0
0
2
:
v
i
X
r
a

Breaking Adiabatic Quantum Control with Deep Learning

Yongcheng Ding,1, 2, ∗ Yue Ban,2, 3 Jos´e D. Mart´ın-Guerrero,4, † Enrique Solano,1, 2, 5, 6 Jorge Casanova,2, 5, ‡ and Xi Chen1, 2, §
1International Center of Quantum Artiﬁcial Intelligence for Science and Technology (QuArtist)
and Department of Physics, Shanghai University, 200444 Shanghai, China
2Department of Physical Chemistry, University of the Basque Country UPV/EHU, Apartado 644, 48080 Bilbao, Spain
3College of Materials Science and Engineering, Shanghai University, 200444 Shanghai, China
4IDAL, Electronic Engineering Department, University of Valencia,
Avgda. Universitat s/n, 46100 Burjassot, Valencia, Spain
5IKERBASQUE, Basque Foundation for Science, Plaza Euskadi 5, 48009 Bilbao, Spain
6IQM, Nymphenburgerstr. 86, 80636 Munich, Germany
(Dated: September 10, 2020)

In the era of digital quantum computing, optimal digitized pulses are requisite for eﬃcient quantum control.
This goal is translated into dynamic programming, in which a deep reinforcement learning (DRL) agent is
gifted. As a reference, shortcuts to adiabaticity (STA) provide analytical approaches to adiabatic speed up by
pulse control. Here, we select single-component control of qubits, resembling the ubiquitous two-level Landau-
Zener problem for gate operation. We aim at obtaining fast and robust digital pulses by combining STA and DRL
algorithm. In particular, we ﬁnd that DRL leads to robust digital quantum control with operation time bounded
by quantum speed limits dictated by STA. In addition, we demonstrate that robustness against systematic errors
can be achieved by DRL without any input from STA. Our results introduce a general framework of digital
quantum control, leading to a promising enhancement in quantum information processing.

Introduction.– For many decades, quantum control is con-
cerned with eﬃcient manipulation of physical and chemical
processes on the atomic and molecular scale, with various ap-
plications ranging from photochemistry to quantum informa-
tion sciences [1, 2]. Speciﬁcally, how to implement fast and
robust qubit gates with externally controllable parameters is
required for realizing universal fault-tolerant quantum com-
puting in the physical platforms based on superconducting
qubits and trapped ions [3]. Quantum error correction, for in-
stance, has been developed to reduce the noise or imperfection
coming from environment and control parameters themselves,
in the implementation of applications for noisy intermediate-
scale quantum (NISQ) gate-based computers [4–6].

Two-level systems, called hereafter qubit systems, are the
basic units of digital quantum computing. Thus, several stud-
ies have been devoted to produce distinct methods for pre-
cise quantum control of qubits with external ﬁelds. These in-
clude resonant pulses [7], adiabatic passages [8], composite
pulses [9–12], pulse-shape engineering [13–15], and further
optimizations [2, 16–21]. Among these frameworks, “Short-
cuts to adiabaticity” (STA) [22, 23] shares the concept that
break the adiabatic regime, and it leads to fast non-adiabatic
state evolution by combining both merits of resonant pulses
and adiabatic passages. Speciﬁcally, inverse engineering, as
one of the STA techniques, is applied to design the superadi-
abatic state evolution along the dynamical modes, emanated
from the Lewis-Riesenfeld invariant, with appropriate bound-
ary conditions [24]. Thus, the freedom left in the inverse en-
gineering further allows suppressing the inevitable systematic
errors such as amplitude noise and dephasing noise, by in-
corporating other techniques of optimal control [15, 25, 26],
dynamical decoupling [27], and supervised machine learn-
ing [28, 29].

At the same time, along with the development of deep
learning in many areas [30–33], deep reinforcement learning

(DRL) has been used for diﬀerent applications in physics [34–
38]. DRL works as a promising method for searching opti-
mal control pulses for fast and robust quantum state prepa-
ration [39, 40], gate operation [41], and quantum Szilard en-
gine [42]. More speciﬁcally, DRL enhances reinforcement
learning, which is a key branch of classical machine learn-
ing widely applied to control tasks; this enhancement comes
from the use of deep learning in key aspects of reinforce-
ment learning. Recent works have studied the application of
DRL to quantum control [43–47]. Therefore, we ﬁnd that it
is meaningful to compare DRL with STA for a better under-
standing of both. We believe that this study will lead to more
feasible applications in manipulating superconducting trans-
mon qubits [48], Bose-Einstein condensates [49], and quan-
tum dots [50], in which systematic errors, stochastic noise,
and experimental constraint are of signiﬁcance.

To this aim, we explore fast and robust quantum control
for qubit operation by combining STA and DRL methods.
Strictly, we focus on single-component control of qubits, be-
ing similar to the two-level Landau-Zener (LZ) problem [48–
50], with the designed time-dependent frequency sweep. We
show the ﬁrst salient result: The smooth pulses of STA are
analytically engineered with clariﬁed quantum speed limit
(QSL), and further optimised with respect to various types of
noises, imperfections, and physical constraints, particularly in
the feasible experiments when lacking ﬂexibility. More im-
portantly, we look for such quantum control with DRL, bench-
marking it by connecting STA. We ﬁnd that DRL agent ex-
plores digital shortcuts for the same task, resulting in similar
characteristics of robustness, when the operation time of STA
is used as a hint. As an extension, we train the agent, which
is the part of DRL in charge of taking control actions, without
any input from STA for the eﬃcient control by suppressing
various systematic errors. In our numerical simulations, we
further observe that DRL agent is capable of achieving ef-

 
 
 
 
 
 
ﬁcient quantum control with satisfying features. We reckon
that one can improve the performance of the framework by
ﬁne-tuning in an interactive DRL environment with quantum
noise, resulting in the potential applications in Noisy Interme-
diate Scale Quantum (NISQ) systems.

Inverse engineering and optimization of STA.– Consider the
coherent manipulation of a single qubit, whose the Hamilto-
nian reads

H(t) =

(cid:126)

2

[Ωσx + ∆(t)σz],

(1)

where the Rabi frequency Ω is ﬁxed, while the detun-
ing ∆(t) is time-varying. Equation (1) appears in, e.g.,
the Xmon transmon qubit [48],
in Bose-Einstein conden-
sates within accelerated optical lattices [49], and in quan-
tum dot charge qubits [50]. According to the Lewis-
Riesenfeld (LR) theory [51], one can construct a dynami-
(cid:80)
cal invariant I(t) = (cid:126)
± |φ±(t)(cid:105)(cid:104)φ±(t)|, where its eigen-
2
2 )e−i β
2 )ei β
2 )T, and |φ−(t)(cid:105) =
states are |φ+(t)(cid:105) = (cos( θ
2 )T, with Ω0 being an arbitrary constant
2 , − cos( θ
(sin( θ
frequency that keeps I(t) in units of energy. Here the time-
dependent angles θ ≡ θ(t) and β ≡ β(t) parametrise the tra-
jectory of an evolving state on the Bloch sphere. The so-
lution of time-dependent Schr¨odinger equation is described
by the superposition of |φ±(t)(cid:105). More speciﬁcally, |Ψ(t)(cid:105) =
(cid:80)
± c± exp(iγ±)|φ±(t)(cid:105), with cn being constants, and the LR

2 )e−i β

2 , sin( θ

2 )ei β

Ω0

phases γ± are calculated as

γ±(t) = ±

(cid:90) t

(cid:32) ˙θ cot β
sin θ

1
2

(cid:33)

dt(cid:48).

(2)

0
The condition, dI(t)/dt ≡ ∂I(t)/∂t + (1/i(cid:126))[I(t), H(t)] = 0,
yields the following auxiliary equations:

˙θ = −Ω sin β,
˙β = −Ω cot θ cos β + ∆(t),

(3)

(4)

which enables the desired state to evolve along the dynamical
mode, |φ±(t)(cid:105). In previous works, a STA control framework
facilitates optimization over errors and noise under symmet-
rical constraints [25, 26] with two tunable parameters – i.e.
Rabi frequency Ω and detuning ∆ – that hold Eqs. (3) and (4).
However, in certain quantum platforms tunability on Ω and
∆ is not available. For instance, in superconducting Xmon
transmon qubits [48] control on the detuning is preferred.

To adapt these requirements, we shall apply the inverse en-
gineering method to design the angle parameter θ for tailoring
the time-dependent detuning ∆(t). Accordingly, we substitute
Eq. (4) and its derivative into Eq. (4), leading to the following
expression:

∆(t) = −

Ω

(cid:113)

¨θ

1 −

(cid:115)

+ Ω cot θ

1 −

(cid:33)2

.

(cid:32) ˙θ
Ω

(5)

(cid:17)2

(cid:16) ˙θ
Ω

with constant Rabi frequency Ω. This allows us to drive the
state evolution along one of dynamical mode, |φ+(t)(cid:105), by sin-
gle component within ﬁnite short time T , constrained by QSL.

2

First of all, the following boundary conditions are imposed

θ(0) = 0,

θ(T ) = π.

(6)

These determine a qubit ﬂip from |0(cid:105) to |1(cid:105). Secondly, the
protocol can be optimised for cancelling systematic errors, as
environmental ﬂuctuations and deviations on the control pa-
rameters unavoidable in experimental scenario. To this end,
we consider the errors in Rabi frequency and detuning, i.e.
Ω → Ω(1 + δΩ) and ∆(t) → ∆(t) + δ∆, and write down the
transition probability, keeping the ﬁrst-order term in the time-
dependent perturbation theory [52],

P =

(cid:126)2

4

(cid:12)(cid:12)(cid:12)(cid:12)(cid:12)(cid:12)

(cid:90) T

0

(cid:104)Ψ−(t)|(δΩΩσx + δ∆σz)|Ψ+(t)(cid:105)

2

(cid:12)(cid:12)(cid:12)(cid:12)(cid:12)(cid:12)

,

(7)

with |Ψ±(t)(cid:105) = eiγ±(t)|φ±(t)(cid:105) being the two orthogonal dynam-
ical modes of the invariant. Plugging Eqs. (3) and (4) into
Eq. (7), we obtain the following condition for error cancella-
tion:

(cid:12)(cid:12)(cid:12)(cid:12)(cid:12)(cid:12)

(cid:90) T

0

dteiη(t) (cid:16)

δ∆ sin θ − i2δΩ ˙θ sin2 θ

(cid:17)

(cid:12)(cid:12)(cid:12)(cid:12)(cid:12)(cid:12)

= 0,

(8)

where η(t) = 2γ+(t), yielding ˙η = ˙θ cot β/ sin θ by combining
with Eq. (2).

Inspired by Ref. [15], a global phase η(t) = 2γ+(t) in the

integral (8) is expanded as

η(t) = 2θ + α1 sin(2θ) + α2 sin(4θ) + ... + αn sin(2nθ),
(cid:112)

such that we get sin β = −1/
1 + 4M2 sin2 θ, with M = 1 +
(cid:80)
n nαn cos(2nθ). As a result, by solving Eq. (3) with given
coeﬃcients αn and the initial condition θ(0) = 0, one obtains
the corresponding θ that evolves to θ(T ) = π, with T bounded
by QSL time as (see [18, 21]),

(9)

ΩT =

(cid:90) π

dθ

0

(cid:112)

1 + 4M2 sin2 θ ≥ π.

(10)

This protocol allows robust qubit ﬂipping from |0(cid:105) to |1(cid:105) with
arbitrary series coeﬃcients for pulse engineering. In principle,
by introducing the free parameters αn in Eq. (9), one can nul-
lify the above integral (8), such that the errors in both σx and
σz terms can be simultaneously suppressed. For simplicity,
here we may set δΩ = 0 or δ∆ = 0, to independently discuss
each error source, without presuming the ratio of error ampli-
tudes. We ﬁnd out that Ω-error and ∆-error can be eliminated
with only ﬁrst-order expansion of η(t), resulting in α1 = −1
and α1 = −1.74, respectively.

While robust quantum control can be achieved within the
preceding framework, we notice that one can hardly predict
the shape of the detuning as well as its adjustable range. For
example, the detuning against ∆-error has the maximum am-
plitude of more than 3Ω with abrupt changes at the edges of
the operation (see Supplementary Material [52]). For more
feasible implementations, we prefer smooth controls with a

3

FIG. 2. (a) Scheme of DRL approach to quantum control with LZ
scheme for one time step in training. An ANN (Agent) of three hid-
den layers observes a state, which encodes physical information of
the qubit. An action is outputted, evolving the system for one time
step, resulting in its state of next time step. Environment rewards or
punishes the agent by artiﬁcially designed reward function, enabling
the agent to learn by accumulation of them. (b) State evolution of the
qubit on Bloch spheres, driven by digital pulses from DRL within
20 time steps, where the parameters are the same as those in Fig. 1.
(c) Renormalized detuning pulses after pre-training for control of LZ
type, and ﬁne-tuning according to systematic errors and populations.
Following Fig. 1(c), ∆max are set to 1.5Ω and 1.7Ω for ∆/Ω-error, re-
spectively. (d) Final population of state |1(cid:105) versus relative systematic
errors. Protocols designed by STA and obtained from DRL are both
robust against systematic errors with similar feature, comparing to
resonant ﬂat π-pulse as time-optimal solution.

cept of DRL. Actually, when one talks about DRL two main
approaches arise. The ﬁrst one is based on the use of deep
learning to approximate the dynamic programming solution.
The second approach deals with the so-called deep policy net-
works, i.e., the ability to test many diﬀerent control systems in
parallel. We focus on the former approach. In this framework,
the assumption of DRL is that, there exists an optimal policy
π, giving an action a(ti) for any observable state s(ti) to com-
plete a certain task in a system. This state-action relation can
be characterized by a function π(a|s), which can be approxi-
mated by a deep ANN. State s(ti) is encoded in input variables
within zero to one, being observed by the agent ANN. After

FIG. 1. (a) STA of qubits on Bloch spheres, where the continuous
pulses of LZ type are designed from Eq. (5) by using the Ans¨atz of
θ(t) (11). With a = 0.604 (red curve) and 0.728 (blue curve), the
qubit without any errors (gray sphere) is ﬂipped from |0(cid:105) to |1(cid:105), be-
ing robust against ∆- and Ω-errors, respectively, which is proved by
numerical simulations under the amplitudes of λ∆ = ±0.1∆max (red
and blue curves on red sphere) and λΩ = ±0.1Ω (red and blue curves
(b) Evolution of expectations on diﬀerent direc-
on blue sphere).
tions, corresponding to the trajectory on gray sphere, by minimizing
∆-error (red curve) or Ω-error (blue curve). We ﬁx Rabi frequency
Ω = 20 × 2π MHz, resulting in operation time T = 60.6 ns and
T = 48.8 ns for STA protocols canceling previous errors. (c) The
corresponding smooth pulses are depicted as well.

detuning ∆(t) that does not oscillate drastically. Thus, we pro-
pose the following Ans¨atz for θ
(1 − s)2 + π2
3

(cid:35)
(1 − s)3 + cos(πs) + A

ΩT
a

θ(t) =

π2
2

as −

(cid:34)

,

(11)

where s = t/T , A = π2/6 − 1, and T = −πa/[(2 − a − π2/6)Ω]
are found by using the boundary conditions (6), while a >
2 − π2/6 being a free parameter. This Ans¨atz leads to a detun-
ing ∆(t) that grows almost linearly during the operation time,
resembling the original LZ scheme, but with ﬁnite values at
t = 0 and t = T (see Fig. 1 and Supplementary Material [52]).
Accordingly, this protocol provides with a = 0.604 and 0.728
for robust qubit ﬂipping against ∆- and Ω-errors, respectively,
resulting in the operation time T = 60.6 ns and T = 48.8 ns, of
the same order of characteristic gate time for superconducting
Xmon transmon qubit [48].

Deep reinforcement learning.– Even though STA has en-
abled the fast and robust control, we consider other numeri-
cal methods for more complicated cases, e.g., if we are only
allowed to drive the quantum states with a given number N
of detuned pulses within a ﬁxed time. This task is indeed
combinational optimization (i.e. maximizing robustness with
optimal conﬁguration of discretized pulses) which is equiv-
alent to dynamic programming, namely, a decision problem
of multiple steps. Although the complexity of dynamic pro-
gramming grows exponentially with the number of steps, one
can still approximately solve it, e.g., with an artiﬁcial neural
network (ANN) approach, which naturally leads us to the con-

0.000.250.500.751.00t/T 101 (t)/⌦0.000.250.500.751.00t/T 1.0 0.50.00.51.0h iixy|0i|1ixy|0i|1ixy|0i|1i⟨σx⟩⟨σy⟩⟨σz⟩T=0.606T=0.488|Δmax|=1.5Ω|Δmax|=1.7Ω(a)(b)(c)Input LayerHidden Layer 1Hidden Layer 2Hidden Layer 3Output LayerStates(ti):|ρ22(ti)|˜Δ(ti−1)i/NActiona(ti):˜Δ(ti)AgentEnvironment: 1.Pre-train, 2.Fine-tuning with systematic errors, constant reward if      r(ti)=˜Δ(ti)−i−1N−1|ρ22(tN)|≥0.997Real-time evolution by Liouville-von Neumann EquationNext time steps(ti+1) 1.0 0.50.00.51.0 ⌦0.000.250.500.751.00P 1.0 0.50.00.51.0  / max0.000.250.500.751.00P0.000.250.500.751.00ti/tN0.00.20.40.60.81.0˜ (ti)0.000.250.500.751.00ti/tN0.00.20.40.60.81.0˜ (ti)(a)xy|0i|1ixy|0i|1ixy|0i|1i(b)(c)Pre-trainLinearΔ-robustΩ-robust(d)STADRL-pulseπSTADRL-pulseπ4

ness. Thus, the performance of DRL can be easily bench-
marked. We ﬁnd out that the DRL agent manages to ﬂip the
qubit against systematic errors by digital pulses [see Fig. 2(b)
and (c)], which are not the coarse-grained analog controls.

In Fig. 2(d), we compare the robustness of STA, DRL and
ﬂat π-pulse against ∆/Ω-errors. The agent discovers digi-
tal quantum control with the same feature of STA, which is
quite satisfying for approaching the theoretical maximum of
robustness.
Inspired by this preliminary result, we further
employ DRL for the sake of searching robust digital control
against both Ω- and ∆-errors. In this scenario, DRL is more
straightforward since the inverse engineering from STA does
not work perfectly even with more free parameters, depend-
ing on the certain proportion of δ∆ and δΩ. With the same
training strategy, we educate the DRL agent for qubit ﬂipping
against both types of errors, which is shown in Fig. 3. It is
worthwhile to mention that, we set operation time and tun-
able range of detuning without any knowledge from STA. The
agent learns its goal, resulting in populations exceeding 0.99
within δ∆/∆max, δΩ ∈ [−0.1, 0.1].

Discussion.– We deem the research presented here as novel
and impacting. Although one may argue that other numerical
algorithms like GRAPE and CRAB are also capable of com-
pleting similar tasks, in our practice, we perceive that these
gradient algorithms have their limitations. Some of them eas-
ily get stuck to local minima, being far from optimal solutions
because of initial conﬁgurations. By contrast, it is proved that
the global minimum can be achieved in ANN with gradient
descent [53, 54]. Studies also verify that any complex ANN
can be reduced to one with much smaller sizes without loss of
performance [55], massively saving training time. These the-
oretical researches will continuously improve DRL, widening
its application in quantum control. We also emphasize the crit-
ical issue that we are far from exploiting the power of DRL in
this work because of physical constraints. In other scenarios
of applied DRLs, states for agents are easily to be observed.
For example, states of Go, RTS games, and automatic driving
are already digitized during information collection processes.
However, precise observation of states in quantum control de-
structs the system immediately, requiring enormous copies for
learning by real devices or controlling an unknown system by
trained agents. Therefore, we use digital pulses given by the
agent in an ideal environment for all systematic errors.
In
other words, we forbid the agent to observe any state dur-
ing evaluation, which is also for a fair comparison between
ﬁxed-STA and DRL. In spite of the constraint we imposed, the
cost of observing the state for DRL agent in quantum control
can be reduced by experimental strategies inspired by machine
learning [56–58]. If an agent is allowed to observe the state
before each time step, it should dynamically change the ac-
tion according to optimized policies as it does for other tasks.
This improvement also requires a precise measurement of the
quantum state. Otherwise, the performance can even be worse
than ﬁxed quantum control.

Conclusion.– By comparison, we ﬁgure out that STA pro-
vides a well-optimized analytical method for designing fast

FIG. 3. (a) State evolution during an arbitrary time tN = 55 ns in
an ideal system. (b) Digital pulses given by DRL, ∆max is chosen as
1.6Ω without knowledge of STA. (c) Deviation of population under
both Ω- and ∆-errors.

propagations between layers and nonlinear activations of the
ANN nodes, output layer gives an action a(ti), which evolves
the system to next state s(ti+1) within one timestep.

An environment consists of these equations, governing the
evolution, as well as rewarding the agent. Optimizers tune pa-
rameters of the ANN according to rewards, leading to a well-
trained agent to provide optimized actions for completing the
task. Thus, we notice that the concept of inverse engineering
from STA, i.e., choosing an Ans¨atz to procure the protocol via
auxiliary equations, is similar to DRL. One should design a
reward function r(s, ti) to educate the agent. An adequate re-
ward function accelerates the convergence of DRL algorithm,
preventing the agent from getting stuck into trivial solutions
or cheating by repetitive actions.

In our practice of DRL, we renormalize the tunable detun-
ing range [−∆max, ∆max] into ˜∆ ∈ [0, 1], which is the encoded
action at time step ti: ˜∆(ti) = (∆(ti) + ∆max)/2∆max. The state
consists of the element of the density matrix |ρ22(ti)|, renor-
malized detuning ˜∆(ti−1) as the action of last time step, and
the current system time i/N. Here we use the Liouville-von
Neumann equation instead of Schr¨odinger equation for further
generalization to the Lindblad master equation with quantum
noise involved elsewhere. The training strategy of the agent
is shown in Fig. 2(a), where extensive details regarding this
strategy can be found in the Supplementary Material [52]. We
ﬁnd that DRL agents converge to (sub-)optimal solutions by
approximating the policy that maximizes the artiﬁcial reward.
This enables DRL to explore various types of quantum con-
trol, requiring adequate reward function for our task. For ex-
ample, we notice that Proximal Policy Optimization (PPO)
resonant ﬂat
rapidly learns the time-optimal solution, i.e.
π pulse, with a trivial reward function r(ti) = |ρ22(ti)| − 1.
However, for LZ-type control, we pre-train the agent with
r(ti) = −| ˜∆(ti) − i−1
N−1 |, rewarding linear growth of detuning.
Pre-training can ﬁlter other strategies and accelerate the con-
vergence as well. Later, we reward the agent by a constant for
ﬁne-tuning, if |ρ22| > 0.997 at the ﬁnal time step with random
systematic errors.

We ﬁrstly investigate if the DRL agent learns digital quan-
tum control resembling STA, [see Fig. 1(c)], with operation
time T = 60.6 ns and 48.8 ns split equally by using 20 pulses
as the only hint. The control calculated by STA eliminates
the error transition, which bounds the upper limit of robust-

 10 50510 ⌦(%) 10 50510  / max(%) log10(1 P)1.01.52.02.53.0xy|0i|1i0.000.250.500.751.00ti/tN0.00.20.40.60.81.0˜ (ti)(b)(a)(c)and robust quantum control, in terms of inverse engineering
with parameter variations. Beyond that, it enhances the per-
formance of DRL, providing knowledge of optimal evolving
time, accelerating its convergence as well. On the other hand,
DRL also shows its capability of learning physics with arti-
ﬁcially designed reward functions. The agent obtains digital
pulses with complex constraints, which prominently eliminate
systematic errors. Pulses designed for more complicated cases
are also satisfying even without ﬁeld knowledge. Last but not
least, our DRL framework can be extended to multiqubit sys-
tems [59, 60] and quantum noise without many eﬀorts, for
the application of robust control optimization in quantum al-
gorithms [61, 62] based on NISQ devices. Moreover, agent-
training in interactive environment with real quantum devices
as ﬁne-tuning can lead to a signiﬁcant enhancement, if exper-
imental time cost is acceptable.

18010500400

This work is partially supported from NSFC (11474193),
STCSM (2019SHZDZX01-ZX04,
and
18ZR1415500), Program for Eastern Scholar, QMiCS
the EU Flag-
(820505) and OpenSuperQ (820363) of
ship on Quantum Technologies, EU FET Open Grant
Quromorphic, Spanish Government PGC2018-095113-B-
I00 (MCIU/AEI/FEDER, UE), and Basque Government
IT986-16. X. C. acknowledges Ram´on y Cajal program
(RYC-2017-22482). J. C. also acknowledges the Ram´on y
Cajal program (RYC2018-025197-I) and support from the
UPV/EHU through the grant EHUrOPE.

∗ jonzen.ding@gmail.com
† jose.d.martin@uv.es
‡ jcasanovamar@gmail.com
§ xchen@shu.edu.cn

[1] D. D’Alessandro Introduction to Quantum Control and Dynam-

ics (Boca Raton, FL: Chapman & Hall/CRC) 2007.

[2] S. J. Glaser, U. Boscain, T. Calarco, C. P. Koch, W.
K¨ockenberger, R. Kosloﬀ, I. Kuprov, B. Luy, S. Schirmer, T.
Schulte-Herbr¨uggen, D. Sugny and F. K. Wilhelm, Eur. Phys. J.
D 69, 279 (2015).

[3] M. A. Nielsen and I. L. Chuang, Quantum Computation and
Quantum Information, (Cambridge University Press) 2010.
[4] J. Kelly, R. Barends, A. G. Fowler, A. Megrant, E. Jeﬀrey, T. C.
White, D. Sank, J. Y. Mutus, B. Campbell, Yu Chen, Z. Chen, B.
Chiaro, A. Dunsworth, I.-C. Hoi, C. Neill, P. J. J. O’Malley, C.
Quintana, P. Roushan, A. Vainsencher, J. Wenner, A. N. Cleland,
and J. M. Martinis, Nature 519, 66-69 (2015).

[5] M. Takita, A. W. Cross, A. D. C´orcoles, J. M. Chow, and J. M.

Gambetta, Phys. Rev. Lett. 119, 180501 (2017).

[6] S. Rosenblum, P. Reinhold, M. Mirrahimi, L. Jiang, L. Frunzio,

R. J. Schoelkopf, Science 361, 266-270 (2018).

5

106, 23 (2011).

[12] X. Rong, J. Geng, F. Shi, Y. Liu, K. Xu, W. Ma, F. Kong, Z.

Jiang, Y. Wu, and J. Du, Nat. Commun. 6 8748 (2015).
[13] M. Steﬀen and R. H. Koch, Phys. Rev. A 75, 062326 (2007)
[14] E. Barnes, S. D. Sarma, Phys. Rev. Lett. 109, 060401 (2012).
[15] D. Daems, A. Ruschhaupt, D. Sugny, and S. Gu´erin, Phys. Rev.

Lett. 111, 050404 (2013).

[16] T. Caneva, M. Murphy, T. Calarco, R. Fazio, S. Montangero,
V. Giovannetti, and G. E. Santoro, Phys. Rev. Lett. 103, 240501
(2009).

[17] S. Gu´erin, V. Hakobyan, and H. R. Jauslin, Phys. Rev. A 84,

013423 (2011).

[18] G. C. Hegerfeldt, Phys. Rev. Lett. 111, 260501 (2013).
[19] A. Garon, S. J. Glaser, and D. Sugny, Phys. Rev. A 88, 043422

(2013).

[20] L. Van Damme, Q. Ansel, S. J. Glaser, and D. Sugny, Phys. Rev.

A 95, 063403 (2017).

[21] C. Arenz, B. Russell1, D. Burgarth, and H. Rabitz, New J. Phys.

19, 103015 (2017).

[22] D. Gu´ery-Odelin, A. Ruschhaupt, A. Kiely, E. Torrentegui, S.
Mart´ınez-Garaot, and J. G. Muga, Rev. Mod. Phys. 91, 045001
(2019).

[23] E. Torrontegui, S. Ib´anez, S. Mart´ınez-Garaot, M. Modugno, A.
del Campo, D. Gu´ery-Odelin, A. Ruschhaupt, X. Chen, and J. G.
Muga, Advances in atomic, molecular, and optical physics 62,
117 (2013).

[24] X. Chen, A. Ruschhaupt, S. Schmidt, A. del Campo, D. Gu´ery-
Odelin, and J. G. Muga, Phys. Rev. Lett. 104, 063002 (2010).
[25] A. Ruschhaupt, X. Chen, D. Alonso, and J. G. Muga, New J.

Phys. 14, 093040 (2012).

[26] X.-J. Lu, X. Chen, A. Ruschhaupt, D. Alonso, S. Gu´erin, and J.

G. Muga, Phys. Rev. A 88, 033406 (2013).

[27] C. Munuera-Javaloy, Y. Ban, X. Chen, and J. Casanova,

arXiv:2007.15394.

[28] E. Zahedinejad, J. Ghosh, and B. C. Sanders, Phys. Rev. Ap-

plied 6, 054005 (2016).

[29] B.-J. Liu, X.-K. Song, Z.-Y. Xue, X. Wang, and M.-H. Yung,

Phys. Rev. Lett. 123, 100501 (2019).

[30] V. Mnih, K. Kavukcuoglu, D. Silver, A. A. Rusu, J. Veness, M.
G. Bellemare, A. Graves, M. Riedmiller, Andreas K. Fidjeland,
G. Ostrovski, S. Petersen, C. Beattie, A. Sadik, I. Antonoglou,
H. King, D. Kumaran, D. Wierstra, S. Legg, and D. Hassabis,
Nature 518, 529-533(2015).

[31] V. Mnih, K. Kavukcuoglu, D. Silver, A. Graves, I. Antonoglou,

D. Wierstra, and M. Riedmiller, arXiv:1312.5602.

[32] D. Silver, A. Huang, C. J. Maddison, A. Guez, L. Sifre, G.
Driessche, J. Schrittwieser, I. Antonoglou, V. Panneershelvam,
M. Lanctot, S. Dieleman, D. Grewe, J. Nham, N. Kalchbrenner,
I. Sutskever, T. Lillicrap, M. Leach, K. Kavukcuoglu, T. Graepel,
and D. Hassabis, Nature 529, 484 (2016).

[33] D. Silver, T. Hubert, J. Schrittwieser, I. Antonoglou, M. Lai, A.
Guez, M. Lanctot, L. Sifre, D. Kumaran, T. Graepel, T. Lillicrap,
K. Simonyan, D. Hassabis, arXiv. 1712.01815 (2017).

[34] G. Carleo and M. Troyer, Science 355, 602 (2017).
[35] A. Nagy and V. Savona, Phys. Rev. Lett. 122, 250501 (2019).
[36] M. J. Hartmann and G. Carleo, Phys. Rev. Lett. 122, 250502

[7] L. Allen and J. H. Eberly, Optical Resonance and Two-Level

(2019).

Atoms, Wiley, New York (1975).

[37] F. Vicentini, A. Biella, N. Regnault, and C. Ciuti, Phys. Rev.

[8] P. Kr´al, I. Thanopulos, and M. Shapiro, Rev. Mod. Phys. 79, 53

Lett. 122, 250503 (2019).

(2007).

[9] M. H. Levitt, Prog. Nucl. Magn. Reson. Spectrosc. 18, 61 (1986).
[10] K. R. Brown, A. W. Harrow, and I. L. Chuang, Phys. Rev. A 70,

052318 (2004).

[11] B. T. Torosov, S. Gu´erin, and N. V. Vitanov, Phys. Rev. Lett.

[38] R. Iten, T. Metger, H. Wilming, L del Rio, and R. Renner, Phys.

Rev. Lett. 124, 010508 (2020).

[39] B. M. Henson, D. K. Shin, K. F. Thomas, J. A. Ross, M. R.
Hush, S. S. Hodgman, and A. G. Truscott, Proceedings of the
National Academy of Sciences, 115, 13216-13221 (2018).

6

[40] X.-M. Zhang, Z. Wei, R. Asad, X.-C. Yang, and X. Wang, npj

Quantum Information 5, 85 (2019).

[41] Z. An and D. L. Zhou, EPL 126, 60002 (2019).
[42] V. B. S ˜Aˇzrdal and J. Bergli, Phys. Rev. A 100, 042314 (2019).
[43] M. Bukov, A. G. R. Day, D. Sels, P. Weinberg, A. Polkovnikov,

lisher] for further explanations and details of the calculation.
[53] S. S. Du, J. D. Lee, H. Li, L. Wang, and X. Zhai, arXiv:

1811.03804.

[54] Z. A. Zhu, Y. Li, and Z. Song, arXiv: 1811.03962.
[55] H. Yu, S. Edunov, Y. Tian, and A. S. Morcos, arXiv:

and P. Mehta, Phys. Rev. X 8, 031086 (2018).

1906.02768,

[44] R. Porotti, D. Tamascelli, M. Restelli, and E. Prati, Comm.

[56] M. Krenn, M. Malik, R. Fickler, R. Lapkiewicz, and A.

Phys. 2, 1 (2019).

[45] M. Y. Niu, S. Boixo, V. N. Smelyanskiy, and H. Neven, npj

Quantum Information 5, 33 (2019).

[46] X.-M. Zhang, Z.-W. Cui, X. Wang, and M.-H. Yung, Phys. Rev.

A 97, 052333 (2018).

[47] R.-B. Wu, H. Ding, D. Dong, and X. Wang, Phys. Rev. A, 99,

042327 (2019).

[48] J. M. Martinis and M. R. Geller, Phys. Rev. A 90, 022307

(2014).

[49] M. G. Bason, M. Viteau, N. Malossi, P. Huillery, E. Arimondo,
D. Ciampini, R. Fazio, V. Giovannetti, R. Mannella, and O.
Morsch, Nat. Phys. 8, 147-152 (2012).

Zeilinger, Phys. Rev. Lett. 116, 090405 (2016).

[57] M. Krenn, M. Erhard, and A. Zeilinger, arXiv: 2002.09970.
[58] Y. Ding, J. D. Mart´ın-Guerrero, M. Sanz, R. Magdalena-
Benedicto, X. Chen, and E. Solano, Phys. Rev. Lett. 124, 140504
(2020).

[59] Y. Chen, C. Neill, P. Roushan, N. Leung, M. Fang, R. Barends,
J. Kelly, B. Campbell, Z. Chen, B. Chiaro, A. Dunsworth, E. Jef-
frey, A. Megrant, J. Y. Mutus, P. J. J. O’Malley, C. M. Quintana,
D. Sank, A. Vainsencher, J. Wenner, T. C. White, Michael R.
Geller, A. N. Cleland, and J. M. Martinis, Phys. Rev. Lett. 113,
220502 (2014).

[60] J. Ghosh, A. Galiautdinov, Z. Zhou, A. N. Korotkov, J. M. Mar-

[50] X. Wang, L. S. Bishop, J. P. Kestner, E. Barnes, K. Sun, and S.

tinis, and M. R. Geller, Phys. Rev. A 87, 022309 (2013).

D. Sarma, Nat. Comm. 3, 1 (2012).

[61] Z.-C. Yang, A. Rahmani, A. Shabani, H. Neven, and C. Cha-

[51] H. R. Lewis and W. B. Riesenfeld, J. Math. Phys. 10, 1458

mon, Phys. Rev. X 7, 021027 (2017).

(1969).

[62] Y. Dong, X. Meng, L. Lin, R. Kosut, and K. B. Whaley,

[52] See Supplemental Material at [URL will be inserted by pub-

arXiv:1911.00789.

Supplemental Material:
Breaking Adiabatic Quantum Control with Deep Learning

I. OPTIMIZATION OF SHORTCUTS TO ADIABATICITY

We have a qubit described by a two-level system

with Landau-Zener (LZ) scheme, where only-σz-control is allowed due to experimental constraints. Parameterized Lewis-
Riesenfeld (LR) invariant gives [S1]

H(t) =

(cid:126)

2

[Ωσx + ∆(t)σz],

(1)

I(t) =

(cid:126)

2

Ω0(sin θ cos βσx + sin θ sin βσy + cos θσz),

where its eigenstates read

|φ+(t)(cid:105) =


cos( θ

sin( θ

2

2 )e−i β
2 )ei β

2


 ,

|φ−(t)(cid:105) =


sin( θ

− cos( θ

2 )e−i β
2 )ei β

2

2


 .

The solution of time-dependent Schr¨odinger equation can be described by the superposition of dynamical modes

|Ψ(t)(cid:105) =

(cid:88)

±

c± exp(iγ±)|φ±(t)(cid:105),

where the LR phases are

γ±(t)

1
(cid:126)

(cid:90) t

0

(cid:104)φ±(t(cid:48))|i(cid:126) ∂
∂t(cid:48)

− H(t(cid:48))|ψ±(t(cid:48))(cid:105)dt(cid:48) = ±

(cid:90) t

0

1
2

(cid:33)

(cid:32) ˙θ cot β
sin θ

dt(cid:48).

In this case, the time evolution operator is represented as

ˆU(T, t) = |Ψ−(T )(cid:105)(cid:104)Ψ+(t)| + |Ψ−(T )(cid:105)(cid:104)Ψ−(t)|,

(2)

(3)

(4)

(5)

(6)

with |Ψ±(t)(cid:105) = exp(iγ±)|φ±(t)(cid:105). Next, we consider a general systematic errors H(cid:48), and write down the perturbated state evolution
at t = T , keeping second-order perturbation theory up to O(λ2),

| ˜Ψ(T )(cid:105) = |Ψ(T )(cid:105) −

i
(cid:126)

(cid:90) T

0

ˆU(T, t)H(cid:48)(t)|Ψ(t)(cid:105) −

1
(cid:126)2

(cid:90) T

(cid:90) t

dt

0

0

dt(cid:48) ˆU(T, t)H(cid:48)(t) ˆU(t, t(cid:48))H(cid:48)(t(cid:48))|Ψ(t(cid:48))(cid:105) + · · · .

Thus, after neglecting the higher-order perturbative terms, the ﬁnal probability to be in |1(cid:105) is calculated as,

7

P ≈ 1 −

1
(cid:126)2

(cid:12)(cid:12)(cid:12)(cid:12)(cid:12)(cid:12)

(cid:90) T

0

dt(cid:104)Ψ−(t)|H(cid:48)|Ψ+(t)(cid:105)

(cid:12)(cid:12)(cid:12)(cid:12)(cid:12)(cid:12)

2

.

As a consequence, we can specify the transition probability induced by the systematic errors,

P = 1
4

(cid:12)(cid:12)(cid:12)(cid:12)(cid:12)(cid:12)

(cid:90) T

0

dteiη(t)(δ∆ sin θ − i2δΩ ˙θ sin2 θ)

2

(cid:12)(cid:12)(cid:12)(cid:12)(cid:12)(cid:12)

,

(7)

(8)

with η(t) = 2γ+, when we consider the errors in Rabi frequency and detuning, i.e. Ω → Ω(1 + δΩ) and ∆(t) → ∆(t) + δ∆,
respectively. The simultaneous error cancellation requires the presumption of ratio of error amplitudes, i.e. δ∆/δΩ. Therefore,
one can simple consider the individual systematic error in Rabi frequency and detuning, by imposing δ∆ = 0 or δΩ = 0 in Eq.
(8).

In order to suppress the systematic errors by nullifying the integral (8), we expand the global phase, η(t) [S2],

By taking the ﬁrst derivative on both sides of η(t) and combining with Eq. (5), we obtain

η(t) = 2θ + α1 sin(2θ) + α2 sin(4θ) + ... + αn sin(2nθ).

where

with M = 1 + (cid:80)

˙η = ˙θ cot β/ sin θ,

sin β = −

(cid:112)

1
1 + 4M2 sin2 θ

,

n αn cos(2nθ) (n = 1, 2, 3...). Thus, the QSL time T is determined by integrating Eq. (3):
(cid:112)

(cid:90) π

ΩT =

dθ

1 + 4M2 sin2 θ ≥ π,

with a lower bound of π as given by resonant π-pulse. In this way, we solve Eq. (3) with initial condition θ(0) = 0:

0

˙θ =

Ω

(cid:112)

1 + 4M2 sin2 θ

,

(9)

(10)

(11)

(12)

(13)

ensuring θ(T ) = π because of QSL time (12). The evolution of θ and operation time T is only determined by the series coeﬃcients
αn, which are numerically optimized to minimize error cancellation condition for suppressing ∆/Ω-error or both of them. By
transforming Eq. (11), we get the following expression of β:

with its derivative being

β = −arccot(2M sin θ),

−4˙θ sin θ

(cid:104)(cid:80)

˙β =

(cid:105) + 2M ˙θ cos θ

n n2αn sin (2nθ)
1 + 4M2 sin2 θ

.

We calculate the expression of detuning pulses by substituting Eq. (15) and (11) into Eq. (4):
(cid:104)(cid:80)

(cid:105) + 2M ˙θ cos θ

−4˙θ sin θ

∆(t) =

n n2αn sin (2nθ)
1 + 4M2 sin2 θ

+

(cid:112)

2MΩ
1 + 4M2 sin2 θ

(14)

(15)

(16)

.

As we mentioned in the main text, one can obtain the robust quantum control against the individual systematic error, see
Fig. S1(a), e.g., α1 = −1.74 for ∆-error and α1 = −1 for Ω-error.

8

FIG. S1. (a) Detuning pulses derived from Eq. (16), with maximal detuning amplitude of 3Ω and abrupt changes at the edges. Thus, we
introduce the Ans¨atz (18) for more feasible detuning pulses in Fig. 1(c) The operation time of quantum control via series expansion gives
T = 60.2 ns and 53.9 ns, being around those in the manuscript as T = 60.6 ns and 48.8 ns. (b) and (c) Population versus relative systematic
errors, with the same deﬁnition and parameters of the manuscript.

However, the shape of pulses given by Eq. (16) changes abruptly, requiring a larger amplitude as well. Although pulse shape
can be further optimized by introducing higher-order expansion, the search of optimal series coeﬃcients that minimize the error
cancellation condition is notorious since it grows in dimension. Meanwhile, it is also impossible to choose the optimal smooth
pulse automatically from inﬁnite sets of series coeﬃcients which all cancel the transition.

For a more feasible experimental implementation, we prefer smooth control so that the detuning does not oscillate drastically.

The way out is to construct an Ans¨atz of θ for satisfying boundary conditions of higher order:

˙θ(0) = Ω, ˙θ(T ) = Ω, ¨θ(0) = 0, ¨θ(T ) = 0,

by combining polynomial and trigonometric functions as

θ(t) =

(cid:34)
as −

ΩT
a

π2
2

(1 − s)2 + π2
3

(cid:35)
(1 − s)3 + cos(πs) + A

,

(17)

(18)

where s = t/T , A = π2/6 − 1 and T = −πa/[(2 − a − π2/6)Ω] ≥ π/Ω with a > 2 − π2/6 being a free parameter. By searching
a that nulliﬁes Eq. (8), one obtains the robust smooth detuning pulses with a = 0.604 and a = 0.728 in Fig 1, featuring similar
robustness as those given by series expansion [see Fig S1(b) and (c)].

II. OPTIMAL CONTROL AND QUANTUM SPEED LIMIT

Now we focus on the time-optimal control and QSL time for the two-level qubit system with LZ scheme. In general, the

fastest protocol is given by bang-oﬀ-bang pulse, in the unconstrained case when ∆max is suﬃcient, i.e.

∆(t) =





−∆max,
0,
∆max,

t = 0
0 < t < T
t = T

,

(19)

such that the QSL time can be founded by [S3]

ΩTQS L = arccos(| f0i0| + | f1i1|) ≥ π,
when the initial and ﬁnal state are |Ψ(0)(cid:105) = i0|0(cid:105) + i1|1(cid:105) and |Ψ(T )(cid:105) = f0|0(cid:105) + f1|1(cid:105), yielding TQS L = π/Ω for the ideal qubit
ﬂipping. However, the sudden change of detuning makes the experimental implementation diﬃcult or unfeasible. Here we
investigate the minimal time bounded by QSL time, see Eq. (12), with various order expansion of the global phase η(t). We
notice that the minimum of QSL converges to π with the growth of n as follows: (1, 4.33), (2, 3.96), (3, 3.76), (4, 3.64), (5,
3.56), (6, 3.5), (7, 3.45), (8, 3.42), (9, 3.39), (10, 3.37)..., where we show the time-optimal control in Fig. S2. Here, the required
detuning range is much larger than those for nullifying error sensitivity, which clariﬁes the cost of STA optimization, and the
trade-oﬀ between time and robustness.

(20)

Moreover, we also implement GRadient Ascent Pulse Engineering (GRAPE) algorithm which is considered as the state-of-

the-art algorithm for designing digital pulses. GRAPE formulates the quantum control problem

H(t) = Hd +

M(cid:88)

j=1

u j(t)H j,

(21)

 1.0 0.50.00.51.0  / max0.40.60.81.0P0.000.250.500.751.00t/T 202 (t)/⌦ 1.0 0.50.00.51.0 ⌦0.000.250.500.751.00P(b)(a)(c)Δ-robustΩ-robustSeries ExpansionAnsätzSeries ExpansionAnsätz9

FIG. S2. (a) QSL time versus n. (b) Detuning with quasi-time-optimal scheme, when α1 = 1.06 minimizes QSL time, T = 34.5 ns, by
(cid:112)Ω2 + ∆(t)2/Ω. (d)
ﬁrst-order expansion, for n = 1. (c) Rescaled dimensionless instantaneous eigenvalues of energy deﬁned by ˜E±(t) = ±
Expectations on diﬀerent directions versus evolving time. (e) Evolution of quantum state on the Bloch sphere.

where Hd is the drift Hamiltonian, H j is the control Hamiltonian. The algorithm drives the quantum system to a target state with
M digital pulses, where amplitudes are denoted by u j(t). Unitary operator reads as

U(T, 0) = exp

(cid:34)
−

i
(cid:126)

(cid:90) T

0

(cid:35)

,

H(t)
(cid:126) dt

(22)

(cid:105)
, evolving the system for a timestep of ∆t = T/M.
which is discretized by U(T, 0) = ΠM
Amplitudes are expressed by an M-dimensional vector |ur(cid:105), updating by the gradient of ﬁgure-of-merit f with learning rate of (cid:15)

k=1U(tk), with U(tk) = exp

(cid:104)
−i∆t H(tk)
(cid:126)

|ur+1(cid:105) = |ur(cid:105) + (cid:15)H −1|∇ fr(cid:105),

(23)

with H to be the Hessian matrix. This formalism can be approximated since calculating inversion of Hessian matrices is too time-
consuming. In our practice, we design pulses with LZ-type scheme by initializing amplitudes of each pulse linearly. However,
we ﬁnd out that GRAPE is highly sensitive to initial conﬁgurations of pulses like other gradient algorithms (see Fig. S3).
Moreover, GRAPE requires more quantum resources for discovering pulses in systems with unknown systematic errors. One
cannot include these errors by codes, but giving feedbacks from the quantum device iteratively, practicing a quantum-classical
training. By contrast, a DRL agent can be trained classically, saving quantum resources, giving pulses without observations of
quantum states.

III. PROXIMAL POLICY OPTIMIZATION AND ITS IMPLEMENTATION

In our practice, we construct an ANN made up of three hidden layers with 32 neurons each and ReLU as activation function.
There are only three neurons in the input layer, which characterize the element of density matrix at time step ti by |ρ22(ti)|,
renormalized detuning of last time step by ˜∆(ti−1), and the current system time by i/N. Output of the ANN is a renormalized
detuning ˜∆(ti) = (∆(ti) + ∆max)/2∆max at time step i, by assuming that detuning is tunable between [−∆max, ∆max]. We notice that
introducing current system time into ANN accelerates the learning process, since agents should be aware of how long has the
system been evolving in a task for transporting within a ﬁxed duration for deciding the action for the next time step.

We implement Proximal Policy Optimization (PPO) [S4] for our DRL approach since it performs comparably or better than
state-of-the-art algorithms. For example, Trust Region Policy Optimization (TRPO) [S5] performs well in continuous control
problem, being robust against hyper-parameters. However, it requires a larger batch size for sampling, being more time consum-
ing or even breaking down in high-dimensional problems. It also meets the diﬃculties when policy and reward function share
parameters. Instead of TRPO, PPO ﬁnds a balance between sample complexity and ease of tuning, updating the policy by a
relative small deviation from the previous one. We notice that PPO rapidly learns the time-optimal solution of single-component
control with a trivial reward function of r(ti) = |ρ22(ti)| − 1 if we do not constrain the evolving time to a certain value, resulting
in a constant zero solution, i.e., conventional ﬂat π-pulse. For verifying if DRL can explore desired pulses against systematic
errors, we start from retrieving digital pulses within evolving time calculated by STA in Fig. 1. We constrain the tunable range
of detuning within the same region of those calculated by STA, as well as the evolving time. Diﬀerent from continuous detuning

12345678910n1.01.11.21.31.4⌦T/⇡0.00.20.40.60.81.0t/T 8.50 4.250.004.258.50 (t)/⌦0.00.20.40.60.81.0t/T 8.50 4.250.004.258.50˜E±(t)0.000.250.500.751.00t/T 1.0 0.50.00.51.0h ii(b)(a)(c)(d)xy|0i|1i(e)⟨σx⟩⟨σy⟩⟨σz⟩10

FIG. S3. Time-optimal solutions with LZ scheme found by GRAPE, where the initial |∆|max = (a) 8.24 (the maximal detuning when n = 1 in
Eq. (12)), and (b) 2.5, we notice that the result of GRAPE is unpredictable, being too sensitive to initialization.

sequence from STA, here we allow 20 discretized detuning pulses for driving the system to its target quantum state. In each
episode, the agent initializes the state, choosing an action after a time step, driving the state to the next time step by master equa-
tion, rewarded/punished by the environment iteratively, and evaluating the accumulated reward at the end. Parameters of the
ANN updates by a given learning rate after several episodes, known as batch size. We pre-train the agent by r(ti) = −| ˜∆(ti) − i−1
N−1 |
for the digital pulses of LZ type , accelerating the learning process, and avoiding local optimal solutions. After the pre-training,
we reward the agent by a constant value at the end of each episode if |ρ22| is larger than a threshold of 0.997, where a uniformly
randomized systematic error within [−0.2, 0.2] is included in the environment within each episode as ﬁne-tuning. We show how
DRL is applied in studying only-σz-control by Fig. 2, ﬁnding out that either STA or DRL can lead to robust only-σz-control
by continuous/discrete detuning. Now we look into discovering control protocols for more general cases via DRL without any
knowledge of STA. In Fig. 3, we show how the eﬀect of hybrid systematic error is minimized during an arbitrary evolving time
by digital pulses. λ∆ and λΩ are randomized uniformly within [−0.1, 0.1] in the ﬁne-tuning process. We achieve a minimal
population of 0.97 in these area, and larger than 0.999 in the center. We reckon that this model is well-trained, especially with
the assumption that systematic errors follow Gaussian distributions.

Instead of reviewing the PPO algorithm by technical details, we here brieﬂy introduce PPO’s enhancement among others.
Policy gradient methods meet convergence problems which can be solved by natural policy gradient, requiring enormous com-
putational resources for calculating the second-order derivative matrix. PPO deals with constraints by introducing a penalty
in the objective function, allowing only ﬁrst-order derivative calculation for optimization. Even though it breaches constraints
during training, computation is simpliﬁed with negligible damage. With clipped objective, its performance can even be better,
although this argument is questioned by a recent research [S6]. In one word, PPO is a quick and valid DRL algorithm for our
application in quantum control.

We used a DRL toolbox called TensorForce [S7] for our quick implementation. The toolbox is based on TensorFlow, which
is a well-known framework for deep learning, supporting GPU acceleration. We customize a DRL environment of our two-level
energy system with the combination of QuTiP [S8]. During both pre-training and ﬁne-tuning processes, we set a batch size of
20, and the learning rate to be 1e-4. Other hyperparameters are the default of PPO agent provided by Tensorforce. Agent learns
LZ-type as our constraint faster during our pre-training with extra constant reward in the ﬁrst and ﬁnal timestep [see Fig. S4(a)].
However, one should be very careful when these tricks are used, since these extra rewards (also known as reward shaping) change
the expectation of total rewards. This might change the optimal policy, resulting in cheating for more reward by repetitive action
[see Fig. S4(c)].

Codes are compatible with both CPU and GPU version of TensorFlow 1.13.1., in Mac OS with 8-core Intel Xeon W processor

and Ubuntu with Tesla P100. Codes and data are available from corresponding authors upon reasonable request.

0.000.250.500.751.00t/T 1.0 0.50.00.51.0h ii0.000.250.500.751.00t/T 1.0 0.50.00.51.0h iixy|0i|1ixy|0i|1i0.000.250.500.751.00t/T 10010 (t)/⌦0.000.250.500.751.00t/T 202 (t)/⌦(b)(a)⟨σx⟩⟨σy⟩⟨σz⟩⟨σx⟩⟨σy⟩⟨σz⟩11

FIG. S4. (a) Reward of each episode (b) The agent for ﬁne-tuning after pre-training. (c) Scheme of cheating by repetitive actions.

∗ jonzen.ding@gmail.com
† jose.d.martin@uv.es
‡ jcasanovamar@gmail.com
§ xchen@shu.edu.cn

[S1] X.-J. Lu, X. Chen, A. Ruschhaupt, D. Alonso, S. Gu´erin, and J. G. Muga, Phys. Rev. A 88, 033406 (2013).
[S2] D. Daems, A. Ruschhaupt, D. Sugny, and S. Gu´erin, Phys. Rev. Lett. 111, 050404 (2013).
[S3] G. C. Hegerfeldt, Phys. Rev. Lett. 111, 260501 (2013).
[S4] J. Schulman, F. Wolski, P. Dhariwal, and A. Radford, arXiv: 1707.06347.
[S5] J. Schulman, S. Levine, P. Moritz, M. Jordan, and P. Abbeel, Trust Region Policy Optimization, International conference on machine

learning (2015).

[S6] L. Engstrom, A. Ilyas, S. Santurkar, D. Tsipras, F. Janoos, L. Rudolph, and A. Madry, Implementation Matters in Deep RL: A Case Study

on PPO and TRPO, International Conference on Learning Representations (2019).

[S7] M. Schaarschmidt, A. Kuhnle, and K. Fricke, Tensorforce: a TensorFlow library for applied reinforcement learning, see: https://

github.com/tensorforce/tensorforce

[S8] J. R. Johansson, P. D. Nation, and F. Nori, Comput. Phys. Comm. 183, 1760 (2012).

05000100001500020000Episodes 7.5 5.0 2.50.0Reward(a)State 0State 1State 2Reward += 1Reward += 10ExpectedCheating05101520i/timestep0.000.250.500.751.00|⇢22|and˜ (b)(c)