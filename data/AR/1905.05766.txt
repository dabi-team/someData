9
1
0
2

l
u
J

2
2

]

O
C
.
h
p
-
o
r
t
s
a
[

2
v
6
6
7
5
0
.
5
0
9
1
:
v
i
X
r
a

Predicting the density proﬁles of the ﬁrst halos

M. Sten Delos,1,

∗ Margie Bruﬀ,1 and Adrienne L. Erickcek1,

†

1Department of Physics and Astronomy, University of North Carolina at Chapel Hill,
Phillips Hall CB3255, Chapel Hill, North Carolina 27599, USA

The ﬁrst dark matter halos form by direct collapse from peaks in the matter density ﬁeld, and
evidence from numerical simulations and other analyses suggests that the dense inner regions of
these objects largely persist today. These halos would be the densest dark matter structures in the
Universe, and their abundance can probe processes that leave imprints on the primordial density
ﬁeld, such as inﬂation or an early matter-dominated era. They can also probe dark matter through its
free-streaming scale. The ﬁrst halos are qualitatively diﬀerent from halos that form by hierarchical
In this work, we present and
clustering, as evidenced by their ρ ∝ r−
tune models that predict the density proﬁles of these halos from properties of the density peaks
3/2 small-radius
from which they collapsed. These models predict the coeﬃcient A of the ρ = Ar−
asymptote of the density proﬁle along with the maximum circular velocity vmax and associated
radius rmax. These models are universal; they can be applied to any cosmology, and we conﬁrm
this by validating them using six N -body simulations carried out in wildly disparate cosmological
scenarios. We ﬁnd that these models can even predict the full population of halos with reasonable
accuracy in scenarios with narrowly supported power spectra, although for broader power spectra,
an understanding of the impact of halo mergers is needed. With their connection to the primordial
density ﬁeld established, the ﬁrst dark matter halos will serve as probes of the early Universe and
the nature of dark matter.

3/2 inner density proﬁles.

I.

INTRODUCTION

Decades of work have been devoted to understand-
ing the halos that form by the gravitational collapse
of collisionless dark matter.
In the cold dark matter
(CDM) model, N -body simulations have demonstrated
that the radial density proﬁles ρ(r) of these halos are
well described by a remarkably universal form, known
as the Navarro-Frenk-White (NFW) proﬁle [1, 2], which
1
r−
is a double power law that transitions from ρ
3 at large radii. This proﬁle
at small radii to ρ
r−
has received only minor corrections since its introduction
(e.g., Ref. [3]). In the CDM picture, all halos form by
hierarchical clustering of smaller halos, and the NFW
proﬁle appears to be the generic consequence.

∝

∝

CDM represents an idealized scenario, however.
In
reality, dark matter particles are expected to have a
nonzero temperature, and the corresponding random
particle motions wash out density ﬂuctuations smaller
than a characteristic free-streaming scale. The ﬁrst halos
form by direct collapse of overdense regions at this scale,
and N -body simulations with suﬃcient resolution show
that these halos possess a markedly diﬀerent density
3/2 at small radii [4–
proﬁle that asymptotes to ρ
9]. This proﬁle is stable; it does not relax to the NFW
proﬁle, at least in the absence of halo mergers.

r−

∝

The ﬁrst halos subsequently merge to produce suc-
cessively larger halos, and Refs. [9, 10] ﬁnd that these
mergers gradually drive the halos’ density proﬁles toward
the NFW form. As these works argue, the shallowing
of the inner density proﬁle is likely a consequence of

∗ Electronic address: delos@unc.edu
† Electronic address: erickcek@physics.unc.edu

violent relaxation [11] during merger events. However,
there are multiple lines of evidence suggesting that such
relaxation does not erase the memory of prior states.
For nearly equal-mass mergers, the density proﬁle of the
merger remnant depends sensitively on the proﬁles of its
progenitors [7, 9]. Successive mergers either raise or leave
unaltered a halo’s characteristic density [9, 10, 12]; since
the ﬁrst halos are the densest, this trend preserves them.
Finally, for highly unequal-mass mergers, the smaller
halo is generally expected to survive as a subhalo of the
larger [13]. The smaller halo’s central density proﬁle may
even be mostly unaﬀected by the merger [14–16].

In this way,

it is broadly plausible that the dense
central regions of the ﬁrst halos survive the hierarchical
clustering process. These halos, forming during a denser
epoch, should be the densest dark matter objects in
the Universe, and such density leads to observational
prospects. Signals from dark matter annihilation are dra-
matically enhanced by the high density within these halos
(e.g., Refs. [17–22]). Gravitational signatures, whether
through microlensing (e.g., Refs.
[23–26]), timing delays
(e.g., Ref. [27]), or stellar dynamics (e.g., Refs. [28–30]),
are also enhanced. Meanwhile, since these halos form
by direct collapse from overdense patches, they carry
sensitive information about the primordial density ﬁeld
on scales that are inaccessible to other probes. Our goal
is to develop a model that extracts this information; we
aim to connect the properties of the ﬁrst halos to the
statistics of the primordial matter density ﬁeld.

The matter density ﬁeld is intimately connected to
some of the most fundamental questions of cosmology.
(k), which quantiﬁes the power
The power spectrum
in density ﬂuctuations at scale wave number k, has been
precisely measured at scales above approximately 1 Mpc
using the cosmic microwave background [31] and the

P

 
 
 
 
 
 
P

Lyman-α forest [32]. However, with a few exceptions
[33, 34],
it is largely unconstrained at submegaparsec
scales. Since density ﬂuctuations are thought to have
been seeded during inﬂation,
(k) serves as a valuable
probe of inﬂationary models [35]. The power spectrum
is also sensitive to the thermal history of the Universe
after inﬂation. An early matter-dominated era (EMDE),
driven by an unstable heavy relic, would amplify small-
scale density ﬂuctuations [36–39], as would a period of
domination by a fast-rolling scalar ﬁeld [40]. The power
spectrum
(k) thereby supplies one of the few windows
into the Universe prior to big bang nucleosynthesis. Sep-
arately, its sensitivity to the free-streaming scale makes
it a probe of the nature of dark matter.

P

∝

r−

Numerous previous works have explored the prospects
of using the ﬁrst dark matter halos to probe the small-
scale primordial power spectrum [41–49]. However, most
treatments assumed that these halos, if they form suﬃ-
9/4
ciently early, possess a particularly compact ρ
density proﬁle [50] derived from self-similar theory [51].
References [52] and [53] (Paper I) used N -body sim-
ulations to show that this proﬁle does not arise from
a realistic formation scenario.
In Ref. [54], hereafter
Paper II, we showed that, despite possessing shallower
3/2 density proﬁles, the ﬁrst halos can still supply
ρ
competitive constraints on the power spectrum through
nondetection of their observable signals. In that work,
we used scaling arguments to model the population of
the ﬁrst halos given a particular family of power spectra.
Each peak in the density ﬁeld was mapped to a collapsed
halo at later time.

r−

∝

Our present work represents a natural extension of
It is based on
that model to arbitrary power spectra.
the notion that the density proﬁle of a halo forming
by direct collapse is uniquely related to the properties
of its precursor density peak. Numerous prior works
have explored the problem of explaining a halo’s density
proﬁle in terms of the structure of the density peak
whence it collapsed.
In work that pioneered the so-
called spherical infall model, Refs. [55, 56] approximated
the density proﬁle of a collapsed halo by employing the
simplifying assumption that particle orbits are unaltered
after accretion. Subsequent works extended this model
by including the contraction of orbiting material due to
new accretion [51, 57–63], relaxing the assumption of
spherical symmetry [64, 65], and modeling nonradial mo-
tions [66–72]. Because of the diﬃcult, nonlinear nature
of the matter infall problem, every treatment employs
simplifying assumptions. Exact solutions only exist for
the self-similar case [51, 58, 64, 65], in which the primor-
dial mass excess is a power law in radius. More general
treatments employ Ans¨atze related to angular momenta
and orbital contraction. As an alternative to tracking
each orbit, other works have employed an Ansatz related
to virialization [73, 74].

Whereas spherical infall models relate halo density pro-
ﬁles to the precursor mass distribution, a complementary
paradigm empirically studies the distribution of halo den-

2

sity proﬁles as a function of cosmology and redshift. In
this paradigm, cosmological N -body simulations are used
to tune a parametric model that describes the density
proﬁle of a halo as a function of its mass, and models
built in this paradigm are known as concentration-mass
relations.1 The distribution of halo masses can be subse-
quently obtained using Press-Schechter theory [75–77], so
these models can predict the full population of halos and
their density proﬁles. Concentration-mass relations have
been studied extensively. The simplest models describe
the halo distribution in a particular cosmological scenario
and at a particular time of interest [78–95]. Other works
have framed a halo’s density proﬁle in terms of its age or
assembly history [1, 2, 96–106], and progress has been
made in isolating the physical variables most directly
relevant for predicting density proﬁles [107–110]. Never-
theless, due to their empirical nature, concentration-mass
relations do not readily extend beyond the cosmological
scenarios, times, and halo-mass ranges over which they
are tuned.

Broadly, spherical infall models attempt to explain
the structures of halos from ﬁrst principles, while
concentration-mass relations endeavor to predict these
structures pragmatically. Our analysis constitutes a hy-
brid between these two procedures that is specialized to
the ﬁrst halos. Forming by direct collapse, these halos
are well suited to the spherical infall description. At
the smallest radii, we use ellipsoidal collapse arguments
3/2
[76, 77, 111] to predict the coeﬃcient of the ρ
inner proﬁle. Beyond the inner asymptote, we employ
the simplest spherical infall models to predict the larger
proﬁle, parametrized by the maximum circular velocity
vmax and the radius rmax at which it is attained [112]. By
building from such ﬁrst-principles descriptions, our pre-
dictive models are valid in any cosmological scenario; we
demonstrate this by validating and tuning the models us-
ing six high-resolution cosmological N -body simulations
carried out in wildly disparate cosmological scenarios.
Our models nominally predict a halo’s density proﬁle
from the density peak whence it collapsed. However,
modulo the inﬂuence of halo mergers (which we discuss),
the statistics of peaks [113] may be applied to thereby
predict the full halo population at a given time.

r−

∝

This paper is structured as follows. In Sec. II, we detail
our simulations and the procedure we use to connect
halos with density peaks. Section III develops a model
3/2 of
that predicts the small-radius asymptote ρ
a halo’s density proﬁle, while Sec. IV compares models
that predict the proﬁle at larger radii.
In Sec. V, we
discuss prospects for predicting whole populations of
halos, including discussion of halo mergers in Sec. V B.
Section VI concludes and discusses avenues for future
work. Appendixes A and B further detail how we extract

r−

∝

1 The concentration is a parameter in the NFW proﬁle (and
extended to other proﬁles) describing how centrally distributed
the halo’s mass is.

simulation data. Finally, in Appendix C, we present a
procedure to directly sample halos from a power spec-
trum using our model.

II. SIMULATIONS

3

We ﬁrst build a halo catalogue on which to test our
model. For this purpose, we simulated six diﬀerent sim-
ulation boxes drawn from diﬀerent initial power spectra.
These power spectra are shown in Fig. 1. Three of these
power spectra are constructed as “spikes” centered at the
1 with the form
scale ks = 6.8 kpc−
(cid:34)

(k) = A

√2πw

P

exp

−

(cid:19)2(cid:35)

(cid:18) ln(k/ks)
w

1
2

(1)

for diﬀerent values of w. These spectra are primarily
intended as artiﬁcial test beds for halo formation, but
they do have qualitative motivations in inﬂationary phe-
nomenology [114–123]. A fourth power spectrum repre-
sents the impact of an EMDE with reheat temperature
TRH = 100 MeV and ratio kcut/kRH = 20 between the
free-streaming cutoﬀ and the largest scale aﬀected by the
EMDE (see Ref. [39]). Finally, the last two power spectra
include only the free-streaming cutoﬀs associated with
cold dark matter with mass mχ = 100 GeV and kinetic
decoupling temperature Tkd = 33 MeV (corresponding to
a typical weakly interacting massive particle [124]) and
warm dark matter (WDM)2 with mass mχ = 3.5 keV
(close to lower bounds from the Lyman-α forest [126]),
respectively. The particular parameter choices for these
power spectra are intended to represent very diﬀerent
cosmological scenarios so that we can test the broad
applicability of our models.

×

∼

= 2

10−

10−

We generate the three spiked power spectra from
Eq. (1) at a starting redshift of z = 104, normalizing
7 at this time in order to eﬀect abundant halo
A
×
formation by z
100. To generate the latter three power
spectra, we begin with a primordial curvature power
9 and spectral
spectrum of amplitude
As = 2.142
index ns = 0.9667 [127]. We then use the Boltzmann
solver Camb Sources [128, 129] to produce a matter
power spectrum at z = 500 in a scenario with no thermal
dark matter motion. Next, we apply transfer functions
from Refs.
[39], [130], and [125] to create, respectively,
the EMDE, CDM, and WDM spectra. Finally, we use
linear theory [131] to evolve these power spectra to their
initial redshifts. Note that we include radiation in our
simulations, and the linear evolution accounts for this;
see Paper II for details.3 We also include a cosmological
constant, although it is of minimal relevance.

2 For WDM, we also take the dark matter particle to be fermionic

with 2 degrees of freedom (so, gX = 1.5 in Ref. [125]).

3 Modes that were subhorizon during an EMDE grow in an altered
way during radiation domination [39], and we modify the linear
growth function for this scenario accordingly.

FIG. 1.
Top: The (linear-theory) dimensionless matter
power spectra of our six simulations during matter domina-
tion. In linear theory, P(k, a) ∝ a2 when matter dominates,
which motivates the y-axis scaling (with a = 1 today).
Bottom: The same power spectra, but each is scaled to its
density variance and characteristic correlation length (see the
text). The shaded region marks the range of box sizes for the
larger modes (smaller k) have wavelengths
six simulations:
longer than the simulation box, so they are not sampled.

The starting redshift zinit, ending redshift zﬁnal, and
periodic box size of each simulation are listed in Table I.
Also listed are the rms density variance σ0 and comoving
characteristic correlation length R
associated with each
power spectrum in linear theory. These spectral param-
eters are deﬁned as [113]

∗

(cid:18)(cid:90) ∞

σj =

0
σ1
= √3
σ2

R
∗

(cid:19)1/2

dk
k P

(k)k2j

.

(2)

(3)

To illustrate the signiﬁcance of these quantities, Fig. 1
also shows the correspondingly rescaled power spectra.
This rescaling is useful because it factors out the scale
diﬀerences between the spectra, leaving only their shapes.
For this reason, we will use these spectral parameters as
, where ¯ρ0 is the
our units. The mass unit is munit ≡
background matter density today. Meanwhile, the phys-
ical distance unit is runit ≡
, where σ0(a) is
evaluated using linear theory during matter domination
a) and a = 1 today. For each simulation, the
(so σ0 ∝
3 (in linear theory)
ending redshift is tuned so that σ0 ∼

[a/σ0(a)]R
∗

¯ρ0R3
∗

10−310−1101103105comovingk(kpc−1)100101102103104105P(k,a)/a2w=0.1w=0.3w=0.5EMDE100GeV3.5keV10−210−1100101kR∗10−310−210−1100P(k)/σ20w=0.1w=0.3w=0.5EMDE100GeV3.5keVTABLE I. The simulation list with basic parameters. Also
listed are σ0, the rms density variance, and R
, the comoving
characteristic correlation length, both calculated in linear
theory. When matter dominates, σ(a) ∝ a, which motivates
the scaling in this column (with a = 1 today).

∗

Simulation
w = 0.1
w = 0.3
w = 0.5
EMDE
100 GeV
3.5 keV

zinit
104
104
104
3 × 104
500
150

(kpc)

zﬁnal Box (kpc) σ0(a)/a R
50
50
50
100
9
2

7.4
7.4
7.4
3
1.5 × 10−
0.15
4.4 × 103

164
164
164
330
30
7.6

∗
0.25
0.19
0.12
5
4.1 × 10−
3
1.9 × 10−
66

≡

−

at simulation termination, and the comoving box size
is tuned to be roughly 30 to 80 times R
. The initial
redshift is chosen so that the largest fractional density
excesses δ

¯ρ)/¯ρ are of order 0.2 or smaller.

(ρ

∗

For each simulation, we draw a random density ﬁeld
from the matter power spectrum at zinit and gener-
ate initial conditions using the Zel’dovich approximation
modiﬁed to account for radiation as described in Paper
II.4 Finally, we carry out the simulations using a version
of the cosmological simulation code Gadget-2 [132, 133]
that we modiﬁed to include the eﬀects of radiation (see
Paper II). All simulations employed 10243 particles and a
comoving force softening length set at 3% of the initial in-
terparticle spacing (with forces becoming non-Newtonian
at 2.8 times this length).

Figure 2 shows the initial and ﬁnal density ﬁelds for
three of these simulations. This sample illustrates the
characteristic diﬀerences between the density ﬁelds and
halo populations that result from the diﬀerent power
spectra. The w = 0.1 spectrum produces ﬂuctuations
only on a characteristic scale, and the resulting halo
population is relatively uniform in size and separation.
Meanwhile, the w = 0.5 spectrum produces ﬂuctuations
on a wider range of scales, yielding very small halos as
well as larger halo clusters and voids. Finally, the 100
GeV power spectrum includes ﬂuctuations at scales up
to and exceeding the box size.5 Accordingly, the bulk
of the halos in the box reside within a few clusters, and
some halos are growing exceedingly large.

At the ﬁnal redshift of each simulation, we use the
Rockstar halo ﬁnder [134] to identify every halo with
max ¯ρ0, where
mass larger than a cutoﬀ Mcut = (4π/3)k−

3

4 For the EMDE, the methods in Paper II were adapted to the

post-EMDE growth function.

5 In fact, the entire boxes of the 100 GeV and 3.5 keV simulations
should be collapsing by the ﬁnal redshift, a fact that cannot be
reﬂected in these simulations. Thus, we do not expect these two
simulations to accurately capture the large-scale dynamics; for
example, halo mergers are probably under-represented. We focus
on understanding the halos that form by direct collapse from
peaks in the density ﬁeld, so we do not expect this shortcoming
to impact our main results.

4

TABLE II. For each simulation, we list the halo count Nhalo
above the mass cutoﬀ at the ﬁnal redshift, the number of
peaks Npeak in the linear density ﬁeld, and the number Nmatch
of successful halo-peak matches. Of these matches, also listed
are the number NA with density proﬁles resolved at small
radii, the number Nr with rmax < rvir, and the subsets
N <3MM
that also underwent fewer than three
major mergers.

and N <3MM
r

A

Simulation Nhalo Npeak Nmatch NA N <3MM

439
696
w = 0.1
933
801
w = 0.3
1011 3896
w = 0.5
730
EMDE
610
6108
100 GeV 216
4401
581
3.5 keV

411
565
795
424
157
463

408
561
790
416
153
455

A
350
481
683
366
141
430

Nr N <3MM
r
347
404
457
537
634
738
339
388
73
82
303
322

P

kmax is the wave number k at which
(k) is maximized.
This cutoﬀ is intended to exclude most of the artiﬁcial
fragments [135, 136] that are normally expected to ap-
pear in simulations with a small-scale cutoﬀ in density
ﬂuctuations. Roughly speaking, ﬂuctuations at the scale
kmax are the ﬁrst to collapse, so we do not expect to
ﬁnd many real halos at smaller scales. Table II lists the
number Nhalo of such halos found in each simulation.

Next, we wish to associate each halo with the density
peak whence it collapsed. To do this, we use Rockstar
to generate halo catalogues at intervals of roughly 5%
in the scale factor, and we use the Consistent Trees
merger tree code [137] to improve the consistency of halo
tracking through time. Starting at the ﬁnal redshift, we
trace each halo back to its formation time, deﬁned as
In case
the time when its mass ﬁrst exceeded Mcut.
of a merger, we follow the larger progenitor. We then
identify all particles in the halo at its formation time,
ﬁnd their positions in the initial particle grid at zinit,
and compute the center of mass xCM and rms spread
rCM of these positions. Finally, we consider the initial
grid δ(x) of fractional density contrasts and ﬁnd the
largest value of δ(x) within a sphere of radius rCM about
xCM . If this maximum is also a local maximum in δ(x)
(a condition that could fail if the maximum lies at the
sphere’s boundary), we take it to be the initial density
peak for this halo. Otherwise, we discard the halo from
further consideration, suspecting it to be an artiﬁcial
fragment.6 Moreover, when this procedure associates
multiple halos in the ﬁnal box with the same initial peak,
we discard all but the most massive halo. Table II lists
both the number Npeak of peaks in the initial density
ﬁeld and the number Nmatch of peak-halo identiﬁcations
made through this procedure.

To test our models, we must still make further cuts to
the halo-peak population. For the small-radius asymp-

6 We explored the alternative procedure of following the density
gradient to a local maximum, but the only consequence was the
introduction of unphysically distant halo-peak associations.

5

FIG. 2. The projected initial (top) and ﬁnal (bottom) density ﬁelds for the w = 0.1 (left), w = 0.5 (middle), and mχ = 100 GeV
(right) simulations. The color scale is logarithmic; lighter is denser.

tote of the density proﬁle (Sec. III), we consider the
subset of our peak-matched halos that have well-resolved
inner density proﬁles7. The number NA of such halos in
each simulation is listed in Table II. Moreover, Ref. [10]
found that successive major mergers alter the inner
asymptote of a halo’s density proﬁle, and we conﬁrm
this eﬀect in Sec. V B. We aim to model the initial
density proﬁle of a halo before it undergoes any disrup-
tive dynamics, leaving a treatment of mergers for future
work.8 Thus, we also restrict our sample to halos that
underwent fewer than three major mergers, which we
deﬁne to be mergers between two halos with a mass ratio
smaller than 3. The number N <3MM
of these halos is also

A

7 In particular, we require that at least 100 particles reside within
the simulation softening length. Otherwise, the central density is
small, usually implying that the density proﬁle was not centered
on the halo’s cusp, which is only true of a handful of halos not
found by Rockstar but ﬁlled in by Consistent Trees. Due to
the minuscule fraction of halos aﬀected, we did not make further
eﬀorts to ﬁnd the true center.

8 We prefer to exclude the impact of mergers in this work because
mergers are a continuing process, so their impact is sensitive to
the arbitrarily chosen simulation termination redshift.

listed in Table II. The particular threshold of three major
mergers is chosen as a compromise between minimizing
the impact of mergers on our results and maximizing the
sample of halos from which our results are drawn. As
we will see in Sec. V B, the ﬁrst two major mergers only
marginally alter halo density proﬁles.

for

the

Meanwhile,

larger-radius density proﬁle
(Sec. IV), we consider the subset of our peak-matched
halos that have rmax, the radius at which the circular
velocity is maximized, inside their virial radius, deﬁned
as the radius rvir enclosing average density 200 times the
background.9 The number Nr of these halos is listed for
each simulation in Table II. Mergers only minimally alter
rmax (see Sec. V B), so when testing models for rmax,
it is not necessary to restrict to halos that underwent
few mergers. However, mergers can signiﬁcantly alter

9 The requirement rmax < rvir culls a signiﬁcant fraction of the
halo population in the 100 GeV simulation, but this is not a
serious concern. It turns out that the models we discuss predict
very large rmax for these halos as well, and rmax > rvir only
implies that the halo’s outermost proﬁle has not yet steepened
to the point that d ln M/d ln r < 1.

6

The radial proﬁle of a density peak drawn from
FIG. 3.
the w = 0.3 power spectrum at redshift z = 106. The peak
is ellipsoidal, and the shading indicates the variation in the
proﬁle along diﬀerent axes. The vertical line marks qmax
computed using the turnaround model (Sec. IV A).

r

the mass M (rmax) enclosed within rmax (or equivalently
vmax), so to test our mass predictions, we restrict the
sample to the subset N <3MM
of halos that underwent
fewer than three major mergers. This number is also
listed in Table II. Altogether, it is evident from Table II
that only a small fraction of the full peak and halo pop-
ulations is used to test our models. Section V explores
the impact of these restrictions by returning to the full
peak and halo populations.

We now have a catalogue that matches peaks in an
initial density ﬁeld to collapsed halos at a much later
time. All that remains is to collect the halo density
proﬁles and the parameters of each peak, and we detail
these processes in Appendixes A and B, respectively.
With these data, we are now prepared to test any model
relating the structure of a dark matter halo to its precur-
sor density peak. In the following sections, we develop
such a model.

III. DENSITY PROFILE AT SMALL RADII

3/2

∝

∝

r−

r−

We ﬁrst study the coeﬃcients A of the ρ = Ar−
asymptotes of the density proﬁles of the ﬁrst halos. It
is of prime importance to accurately predict the den-
sity proﬁles in this regime because these radii source
the bulk of the prospective signal from dark matter
annihilation, and this remains true even if these halos
1 proﬁles due to mergers. Moreover,
relax toward ρ
there is another reason to study small radii separately:
3/2 inner density proﬁle is established almost
the ρ
immediately after collapse. To illustrate this fact, we
simulate10 the collapse of the isolated density peak shown
in Fig. 3. This peak represents a typical 3σ peak drawn
from the w = 0.3 power spectrum using the statistics
of peaks as described in Ref. [113]. The shallowing of
this proﬁle toward r = 0 is associated with the absence
of small-scale ﬂuctuations, and this is the single feature
common to density peaks drawn from all of the power
spectra we are studying. Indeed, it has been suggested
that this feature is responsible for the development of the
ρ

∝
Figure 4 shows the halo resulting from this initial peak
in the moments after collapse. We also compute the
expected collapse time from the initial peak using both
the spherical collapse model, δ(asc) = 1.686, and the
ellipsoidal collapse model described in Ref. [76]. The
redshifts zsc and zec of spherical and ellipsoidal collapse,
respectively, are indicated in Fig. 4. The critical ob-
3/2 asymptote of the den-
servation is that the ρ
r−
sity proﬁle develops almost immediately after collapse,
matching closely the late-time density proﬁle as early as
1.15aec. Subsequently, the proﬁle grows outward in
a

3/2 proﬁle [8].

r−

∝

(cid:39)

FIG. 4. The density proﬁle of the resulting halo during and
after collapse of the peak in Fig. 3. The numbers denote the
redshifts z at which the density proﬁle is plotted, while zsc
and zec are the redshifts of spherical and ellipsoidal collapse,
respectively, computed from the initial peak. The black curve
shows the density proﬁle long after collapse.

(cid:39)

radius alone, gradually steepening as accretion of new
material slows. The interval ∆a/a
0.15 over which
the proﬁle develops is not arbitrary. The characteristic
3π/(16Gρ) [138] of a virial-
dynamical time ∆t =
ized region with density 200 times the background is
∆t = 0.16/H, where H is the Hubble rate. This interval
corresponds to ∆a/a = 0.16, implying that the inner
density proﬁle develops over a single dynamical time
interval.

(cid:112)

A. Spherical collapse

10 This simulation employed about 9 million particles in a comoving
vacuum-bounded sphere of radius 1.5 kpc. The starting redshift
was z = 106.

The rapid development of a halo’s inner ρ = Ar−
proﬁle implies that the coeﬃcient A can only be inﬂu-
enced by the immediate neighborhood of the precursor

3/2

0.00.20.40.60.81.0r(comovingkpc)0.000.020.040.06δ(r)qmax10−410−3r(kpc)105ρr3/2(M(cid:12)kpc−3/2)z=50z=311282255231209zsc=292zec=2667

3/2 density proﬁle asymptote, plotted against the prediction from our models. Top:
FIG. 5. The coeﬃcient A of the ρ = Ar−
The spherical model, Eq. (5). Bottom: The ellipsoidal model, Eq. (7). The left panels plot all of the halos, while the right
panels plot a density estimate: the color scale indicates the density f (ln A, ln Apred) of the distribution, where Apred is the
x-axis quantity. We also plot the line corresponding to the median proportionality constant for each model.

density peak. To make this argument precise, we deﬁne11

˜δ(x)

≡

δ(x, a)/a,

(4)

∝

|∇

r−

where δ(x, a) is evaluated using linear theory during
a). Here, x is a comoving
matter domination (when δ
∝
coordinate, and we deﬁne a = 1 today. We now claim
3/2 asymptote is only sensitive to
that the inner ρ
the local properties ˜δ and ∂i∂j ˜δ of the precursor density
peak. If we neglect deviations from spherical symmetry,
the peak reduces to two parameters: its amplitude ˜δ and
2˜δ
curvature
. During matter domination, spherical
|
1. Meanwhile,
collapse theory implies that asc ∝
2˜δ
)1/2
|
|∇
associated with the peak. At the time of collapse, this
comoving length corresponds to the physical length scale
2˜δ
(˜δ
1/2. There is also a physical density
)−
ascqpk ∝
|
|∇
¯ρ0˜δ3, i.e., the cosmological background
3
scale ¯ρ0a−
sc ∝
density at collapse. If these are the only scales, then up
to a constant coeﬃcient, there is a unique prediction for
3/2 asymptote of the
the coeﬃcient A of the ρ = Ar−
density proﬁle,

deﬁnes a comoving length scale qpk ≡

2˜δ
|

(˜δ/

˜δ−

|∇

A = α¯ρ0δ9/4

2δ

−
|

|∇

3/4,

(5)

11 After this section, we will omit the tilde, and any quantity related
to the linear density ﬁeld should be understood to be evaluated
on the scaled linear density ﬁeld ˜δ(x) unless otherwise speciﬁed.

where α is a proportionality constant. We omit the
tildes in Eq. (5), but all quantities related to the linear
density ﬁeld are understood to be evaluated on ˜δ(x).
This convention applies to the remainder of this work.
The parameter α must be calibrated by simulations, but
this calibration is only necessary once; it should be the
same for any power spectrum.

A

We test this model on the N <3MM

peak-matched halos
in each simulation that have well-resolved inner density
proﬁles and underwent fewer than three major mergers
(see Sec. II). For these halos, Fig. 5 plots the left-hand
side against the right-hand side of Eq. (5) in order to
test the model. Evidently, our model works well for how
simple it is, predicting the asymptotes with reasonable
success in all six simulations. There does, however,
appear to be a correlated eﬀect wherein halos with the
densest predicted asymptotes tend to exceed that predic-
tion, and vice versa at the less dense end. In fact, this
eﬀect is caused by the assumption of spherical collapse.
Peaks of smaller amplitude tend to be less spherical,
thereby collapsing later and forming less dense halos than
their amplitude would suggest. We next account for this
eﬀect.

100101δ9/4|∇2δ|−3/4¯ρ0(munitr−3/2unit)100101102A(munitr−3/2unit)w=0.1w=0.3w=0.5EMDE100GeV3.5keV100101δ9/4|∇2δ|−3/4¯ρ0(munitr−3/2unit)A=αδ9/4|∇2δ|−3/4¯ρ0α=8.76sphericalcollapse0.00.51.010−1100101δ9/4|∇2δ|−3/4f−3/2ec¯ρ0(munitr−3/2unit)100101102A(munitr−3/2unit)w=0.1w=0.3w=0.5EMDE100GeV3.5keV10−1100101δ9/4|∇2δ|−3/4f−3/2ec¯ρ0(munitr−3/2unit)A=αδ9/4|∇2δ|−3/4f−3/2ec¯ρ0α=12.1ellipsoidalcollapse0.00.51.08

nonspherical peak shapes by altering the time of collapse.
The sensitivity of the asymptotic coeﬃcient A to the
shape of the peak may be more complicated.

Nevertheless,

it is a signiﬁcant success to obtain a
mere approximately 30% scatter across such a broad
range of cosmologies from a model as simple as the one
presented here. The proportionality coeﬃcients and their
statistics for our models are summarized in Table III.
Thus calibrated, the model developed in this section may
be employed to predict the inner asymptotes of the ﬁrst
halos’ density proﬁles in any cosmological scenario.

IV. DENSITY PROFILE AT LARGE RADII

∝

r−

We next study the density proﬁle beyond the inner
3/2 asymptote. These larger radii, containing
ρ
the bulk of the halo mass, are relevant to gravitational
lensing signatures as well as to the dynamical evolution
of the halo through mergers and tidal stripping. In this
section, we discuss and validate models that can predict
the density proﬁle at large radii. We focus on three
physical models:

(1) a “turnaround” model, tracing back to Ref. [55],
in which each mass shell freezes at a fraction of its
turnaround radius, or the radius of ﬁrst apocenter;

(2) a “contraction” model, expressed most concisely
by Ref. [63], that accounts for contraction of halo
particle orbits due to subsequent infall;

(3) a “virialization” model, put forward by Ref. [73], in
which the ﬁnal radius of a mass shell is determined
by enforcing that the shell’s enclosed energy be
distributed according to the virial theorem.

∝

r−

All of these models rely on the assumption that mate-
rial is accreted gradually. Hence, they are not applicable
to the density proﬁles at small radii, and none of them
3/2 asymptote. We will explore in
predicts the ρ
Sec. IV D precisely where these models are accurate. In
the meantime, we validate and tune the models by using
them to predict the radius rmax at which the halo’s circu-
lar velocity is maximized along with the mass M (rmax)
within this radius. The maximum circular velocity itself
follows as vmax =
GM (rmax)/rmax.
The radius rmax characterizes where the proﬁle bends
away from its inner asymptote.12 It is more common in
the literature to study the scale radius rs, often deﬁned
to be where d ln ρ/d ln r =
2, instead of rmax, which is
−
where d ln M/d ln r = 1. However, we favor rmax over
rs for several reasons. First, rmax can be read from a
simulation more robustly than rs, since the mass proﬁle
is less noisy than the density proﬁle. Second, rmax turns

(cid:112)

12 For example,

if ρ(r) = ρs(r/rs)−

3/2(1 + r/rs)−

3/2 [53, 139]

(where ρs and rs are scale parameters), rmax = 1.055rs.

FIG. 6. A comparison of the scatter from the two asymptote
models. For each model, we plot a histogram of the coeﬃcient
α between the asymptote A and its model prediction, scaled
to the mean coeﬃcient for all halos. Vertical lines mark 1σ
deviations from the mean, computed in log space.

B. Ellipsoidal collapse

∝

3/2

a−
sc

Equation (5) neglects deviations from spherical sym-
metry. However, it can be immediately generalized in
, we can use the
the following way. Since A
theory of ellipsoidal collapse [76, 77, 111] to predict how
the three-dimensional shape of a peak alters its collapse
time. In particular, ellipsoidal collapse occurs later than
spherical collapse by a factor fec(e, p)
aec/asc, which
is a function of the ellipticity e and prolateness p of the
gravitational potential φ in the vicinity of the peak (see
Appendix B for deﬁnitions). To compute fec, we use the
approximation [76]

≡

fec(e, p) = 1 + 0.47 (cid:2)5(e2

)f 2
|
Accounting for ellipsoidal collapse,

p
p
|

−

ec(e, p)(cid:3)0.615

.

(6)

A = α¯ρ0δ9/4

2δ

|

|∇

3/4f −
ec

−

3/2

(e, p),

(7)

where α is a proportionality constant.

Figure 5 compares the predicted asymptotes in the
ellipsoidal collapse model to their measured values. The
correlated scatter associated with the spherical model is
no longer apparent, conﬁrming that the spherical collapse
assumption was the source. Figure 6 compares the overall
scatter between these two models; the ellipsoidal collapse
model is clearly superior. We remark that not all of the
scatter depicted is physical; there is numerical noise in
our simulated density proﬁles and ﬁnite density grids.
Nevertheless, there are still clear sources of physical
3/2
scatter. Absent an understanding of why the ρ
proﬁle develops, we constructed our model using purely
scaling arguments, and these arguments can break down
in two ways. First, the inner proﬁle does not develop
instantly, so it is sensitive to a small region about the
density peak instead of only its immediate neighborhood.
Also, as depicted in Fig. 4, the inner asymptote is not
completely static but instead grows marginally after it
develops, implying that it exhibits some sensitivity to
the larger density ﬁeld. Second, we only accounted for

r−

∝

0.40.6123α/¯α012f(lnα)sphericalellipsoidalout to be cleaner to predict from the linear density ﬁeld.
Finally, since rmax characterizes the total mass rather
than the local density, it is the more relevant quantity
for understanding halo dynamics [112] and for predicting
gravitational lensing signatures. The combination of A
and rmax serves to mostly characterize the density proﬁle
of a halo, and the mass M (rmax) (or velocity vmax)
supplies an additional constraint.

A. Turnaround

To develop a model that can predict the full density
proﬁle of a collapsed halo, we must relate this proﬁle
to the spherically averaged fractional density excess pro-
ﬁle δ(q), where q is the comoving radius, about the
corresponding peak in the linear density ﬁeld. Follow-
ing the convention established in Sec. III, we deﬁne
δ(q)
δ(q, a)/a evaluated in linear theory during matter
domination (with a = 1 today). We will also use

≡

∆(q) =

3
q3

(cid:90) q

0

δ(q(cid:48))q(cid:48)

2dq(cid:48),

(8)

the fractional enclosed mass excess deﬁned under the
same convention. As in Ref. [55], we consider the simpli-
ﬁed spherical infall model in which each spherical shell
freezes at a ﬁxed fraction of its turnaround radius. A
mass shell initially at comoving radius q turns around
at physical radius rta = (3/5)q/∆(q). Hence, the ﬁnal
physical radius r of this shell is

r = βq/∆(q),

(9)

where β is a proportionality constant to be measured in
simulations. But in this model, mass shells never cross,
so the mass enclosed within this shell, now at r, is still

M (q) = βM

4π
3

q3 ¯ρ0

(10)

(at zeroth order in ∆) with βM = 1. This equation gives
the mass proﬁle M (r) of the collapsed halo if q is obtained
from r by inverting Eq. (9).

To ﬁnd rmax (up to the proportionality constant β),

we may maximize M (r)/r. Alternatively, we can write

d ln M
d ln r

=

3
1 + 3(cid:15)(q)

,

where we deﬁne13

(cid:15)(q)

1
3

d ln ∆
d ln q

= 1

δ(q)
∆(q)

.

−

≡ −

(11)

(12)

13 We deﬁne (cid:15)(q) as a generalization of the index (cid:15) of δM/M

(cid:15)
M −
in the self-similar theory [58]. Consequently, Eq. (11) has exactly
the same form as its analogue in the self-similar theory.

∝

9

FIG. 7. For the turnaround model, this ﬁgure plots the val-
ues of rmax measured in our simulations against the predicted
values. For visual reference, an example proportionality curve
is plotted (not a ﬁt). The model dramatically overpredicts
rmax for a subpopulation of the halos, a problem that we
attribute to the ﬁnite time at which the simulated density
proﬁles are measured (see the text).

In this case, rmax is obtained as the solution to
d ln M/d ln r = 1 or, equivalently, (cid:15)(qmax) = 2/3 with
rmax computed from qmax using Eq. (9).

This model, at ﬁrst glance, seems to be far divorced
from a realistic description. However, it turns out to
be a reasonable approximation of late accretion. At late
times, halo density proﬁles are stable in time; see, e.g.,
Papers I and II. This observation is explained by noting
that once the halo is established and accretion begins to
slow, newly accreted mass only contributes signiﬁcantly
to the outskirts of the halo; there is too little new matter,
spending too small a fraction of its orbital period at small
radii, to substantially raise the interior density. Since the
density proﬁle is static, a newly accreted particle settles
into a stable orbit with time-averaged radius proportional
to its orbital apocenter, the turnaround radius.14 The
ﬁnal radius in this model is to be understood as that
orbital average.

We test this model on the Nr peak-matched halos for
which rmax < rvir (see Sec. II). In the top panel of Fig. 7,
we plot the measured rmax against the prediction from
this model. The model appears to work well for the bulk
of the halos. However, there is a signiﬁcant population of
halos, especially coming from the broader 100 GeV, 3.5
keV, EMDE, and w = 0.5 power spectra, for which the
predicted rmax is much larger than the measured value.
In fact, in these simulations, there are many peaks for
which the mass shell with (cid:15) = 2/3 has not yet accreted
onto the halo by the ﬁnal redshift.
In these cases, it
makes no sense to use the properties of this shell to
predict rmax.

A minimal correction, for these halos, is to instead
relate rmax to the outer boundary of the halo.
In the
spherical collapse model, a mass shell virializes when it

14 The orbital apocenter actually decays over time, an eﬀect for

which the contraction model accounts.

100101102qmax/∆(qmax)(runit)10−1100rmax(runit)turnaroundw=0.1w=0.3w=0.5EMDE100GeV3.5keV10

FIG. 8. For the corrected turnaround model, we plot the values of rmax measured in our simulations against the predicted
values. At the top, we show the turnaround model with halos with qmax > qv excluded, while at bottom, we use qv to predict
rmax for the previously excluded halos. This separation corrects the discrepancy seen in Fig. 7. The left panels plot all of
the halos, while the right panels show density estimates; the color scale indicates the density f (ln rmax, ln rmax,pred) of the
distribution, where rmax,pred is the x-axis quantity. The solid line corresponds to the median proportionality constant.

falls to half of its turnaround radius; at this point, its
energy is distributed according to the virial theorem. The
halo’s outer boundary may be taken to be the physical
radius of the last shell to virialize in this way, and we
deﬁne qv to be the Lagrangian radius of this shell. If we
are considering the halo population at scale factor a, then
qv is the smallest q that satisﬁes ∆(q, a) = a∆(q)
δv,
where δv = 1.583.
If rmax is proportional to the halo
boundary so deﬁned, then

≤

rmax = β(cid:48)qv/∆(qv),

(13)

where β(cid:48) is another proportionality constant, and this
model is understood to apply only to the halos of which
the (cid:15) = 2/3 mass shells have not yet virialized,
i.e.,
qmax > qv.
In Fig. 8, we plot the turnaround model
for only those halos of which the (cid:15) = 2/3 shells have viri-
alized, separately plotting the qv model for the remainder
of the halos. Evidently, the halos of which the (cid:15) = 2/3
shells had not yet virialized were indeed the population
of which the rmax was severely overpredicted, and the
(cid:15) = 2/3 model exhibits signiﬁcantly less scatter with
them excluded. Meanwhile, using qv to predict rmax for
these halos works reasonably well, although the scatter
here is signiﬁcantly larger. The top panel of Fig. 9 depicts
these diﬀerences in scatter more transparently.

Finally, we test how well this model predicts M (rmax)
in similar fashion by using Eq. (10) and allowing βM to
ﬂoat.
halos with
rmax < rvir that also underwent fewer than three major

In this case, we employ the N <3MM

r

mergers (see Sec. II). As above, we set q = qmax when
qmax < qv and q = qv otherwise. The bottom panel of
Fig. 9 shows the scatter in these predictions. For both
rmax and M (rmax), Table III lists the tuned coeﬃcients
β and βM and their statistics.

B. Contraction

The turnaround model assumed that each new shell
freezes at a ﬁxed fraction of its turnaround radius, con-
tributing mass to that radius alone.
In reality, a shell
contributes mass to a large range of radii. Figure 10
shows the density proﬁles15 laid down by a range of initial
mass shells. These shells consist of successive factors
of 1.5 in initial radius, so that the lowest shell contains
the mass initially in the comoving radius band 0.044 to
0.066 kpc; the second shell contains the mass initially
in the band 0.066 to 0.10 kpc; and so on. Notably,
each shell has a characteristic radius within the ﬁnal halo
below which it contributes roughly constant density. As
Ref. [63] argues, the constant-density contribution follows
from the notion that particles from large-radius mass

15 This ﬁgure depicts a halo that collapsed from an isolated 3σ
peak drawn from the w = 0.3 power spectrum. This peak was
simulated with about 70 million particles in a comoving vacuum-
bounded sphere of radius 1 kpc.

100101qmax/∆(qmax)(runit)10−1100rmax(runit)qmax<qvw=0.1w=0.3w=0.5EMDE100GeV3.5keV100101qmax/∆(qmax)(runit)rmax=βqmax/∆(qmax)β=0.131turnaround;qmax<qv01100101qv/∆(qv)(runit)10−1100rmax(runit)qmax>qvw=0.1w=0.3w=0.5EMDE100GeV3.5keV100101qv/∆(qv)(runit)rmax=β0qv/∆(qv)β0=0.088turnaround(qvcorrection);qmax>qv0.00.511

FIG. 10. The density proﬁle of a halo (black curve) along
with the density proﬁles contributed by diﬀerent initial mass
shells (colored curves). The lowest shell contains the mass
initially in the comoving radius band 0.044 to 0.066 kpc, the
second shell corresponds to the band 0.066 to 0.10 kpc, and
so on. The dashed vertical line marks rmax.

the factor

X(q)

1 +

≡

3
q3

(cid:90) qv

q

q(cid:48)

2dq(cid:48)f [r(q), r(q(cid:48))] .

(14)

due to the contribution of shells with q(cid:48) > q. As before,
qv is the Lagrangian radius of the latest shell to virialize;
it is the smallest q that satisﬁes a∆(q)
δv, where a
is the scale factor at which we wish to characterize the
halo population (and a = 1 today). If orbital apocenters
shrink according to r

1/M , then

≤

∝

r(q) = β

q
∆(q)

1
X(q)

(15)

describes the apocenter of the q shell after contraction,
with β = 3/5.

let us assume that each shell
As a simple model,
s below its apocenter radius
contributes density ρ(r)
and 0 above it, so f (r, r(cid:48)) = (r/r(cid:48))3
s. With this shell
proﬁle, Eq. (14) yields the ordinary diﬀerential equation

r−

∝

−

FIG. 9. Comparisons of the scatter in the rmax (top) and
M (rmax) (bottom) predictions. For each model, we plot the
distribution of the coeﬃcient β or βM between the halo quan-
tity and its model prediction, scaled to the mean coeﬃcient for
all halos. “t.a. (qmax)” and “t.a. (qv)” denote the turnaround
models using qmax and qv and applied only to halos with
qmax < qv and qmax > qv, respectively. “s = 0” and “s = 1”
denote the respective contraction models. “vir. (qmax)” and
“vir. (qv)” denote the virialization models using qmax and qv
and applied only to halos with qmax < qta and qmax > qta,
respectively. Note that the contraction models have more
scatter than the turnaround and virialization (qmax) models
only because the latter describe a smaller range of halos; see
the footnotes in Table III.

shells cross the lower radii at such high velocity that their
motions are eﬀectively unaccelerated.

d ln X
d ln q

=

−

3

−

[3(3

s)(cid:15)(q)

−
1 + (4

−
s)(X

−

1)

−

s] (X
1)

−

(16)

Consider a halo particle initially orbiting with apocen-
ter radius r that encloses halo mass M (r). As time goes
on, newly accreted shells contribute to the enclosed mass,
In a spherically symmetric and self-
increasing M (r).
similar system, the quantity (cid:72) vrdr
[M (r)r]1/2 is an
adiabatic invariant, implying that as the enclosed mass
1/M (r). While the quantity M r
grows r shrinks as r
need not be conserved in a more general picture, Ref. [65]
found that it remains nearly invariant for each particle
even with spherical symmetry relaxed.

∝

∝

For a mass shell with apocenter r(cid:48),

let f (r, r(cid:48)) be
the fraction of the shell’s mass that is within r.
It is
readily seen that the mass enclosed within a shell with
Lagrangian radius q and ﬁnal apocenter r(q) increases by

with initial condition X(qv) = 1. This equation is
equivalent to the simpler expression in Ref. [63], but
since it is expressed with respect to the variable q, it
is more straightforward to integrate over a numerically
tabulated peak proﬁle (cid:15)(q). The enclosed mass proﬁle
after contraction is now

M (q) = βM (4π/3)q3 ¯ρ0X(q)

(17)

(to zeroth order in ∆) with βM = 1. Note that X ranges
from 1 (at qv) to
(10). Using these equations, one may
maximize M (q)/r(q) to obtain qmax, after which rmax
and M (rmax) are obtained immediately. Alternatively,

O

d ln M
d ln r

=

3 + d ln X/d ln q

1 + 3(cid:15)(q)

−

d ln X/d ln q

(18)

0.512β/¯β0.00.51.01.5f(lnβ)t.a.(qmax)t.a.(qv)s=0s=1vir.(qmax)vir.(qv)0.20.5125βM/¯βM0.00.51.0f(lnβM)t.a.(qmax)t.a.(qv)s=0s=1vir.(qmax)vir.(qv)10−410−3r(kpc)107108109101010111012ρ(M(cid:12)kpc−3)12

FIG. 11. For the s = 0 (top) and s = 1 (bottom) contraction models, this ﬁgure plots the values of rmax measured in our
simulations against the predicted values. The left panels plot all of the halos, while the right panels show density estimates;
the color scale indicates the density f (ln rmax, ln rmax,pred) of the distribution, where rmax,pred is the x-axis quantity. The solid
line corresponds to the median proportionality constant.

with d ln X/d ln q given in Eq. (16), so one may solve
d ln M/d ln r = 1 to obtain qmax. Finally, since we do
not expect to employ the correct form of f (r, r(cid:48)), we will
allow β and βM to vary, tuning them to simulations.

We test the contraction model using s = 0 as well as
s = 1. While Fig. 10 suggests that s = 0 at small radii,
a nonzero choice of s is motivated by noting that for a
given mass shell q most of the enclosed mass contributed
by higher shells comes from shells just slightly above
q. Meanwhile, Fig. 10 shows that the density proﬁle
contributed by a mass shell does not level oﬀ to a constant
value until well below its apocenter radius. Therefore, the
bulk of the mass contribution comes from shell density
s with s > 0. The particular choice s = 1
proﬁles ρ
is partly arbitrary, but it is roughly the slope of the shell
proﬁles in Fig. 10 slightly below their apocenters.16

r−

∝

all of the halos in a single model requiring just one tuned
parameter. Adiabatic contraction can produce a bend
in the density proﬁle, and hence an rmax, near the halo
outskirts because the outskirts are uncontracted while
the rest of the halo is contracted. Other than this, there
is no signiﬁcant advantage to the contraction models for
predicting rmax, as the top panel of Fig. 9 shows.

We also use the s = 0 and s = 1 contraction models
to predict M (rmax) using Eq. (17) with βM allowed to
ﬂoat. For this test, we employ the N <3MM
halos with
rmax < rvir that underwent fewer than three major
mergers. The scatter in these predictions is depicted in
the bottom panel of Fig. 9. The tuned values of β and
βM and their statistics are listed in Table III.

r

Figure 11 plots rmax against its model prediction
for both contraction models using the Nr halos with
rmax < rvir. Both models successfully predict, with some
scatter, the values of rmax for the halos in all six simula-
tions. In fact, both models work equally well, as Fig. 9
demonstrates. Moreover, comparing the results of these
models to those of the turnaround models, which used
the (cid:15) = 2/3 or qv shells to predict rmax, we see that the
main diﬀerence is that the contraction models can handle

C. Virialization

Reference [73] developed a model for halo density
proﬁles in which a mass shell freezes where its enclosed
energy is virialized.17 In this model, the ﬁnal radius of
(3/10)GM (q)2/E(q), where M (q)
the q shell is r(q) =
and E(q) are, respectively, the mass and energy enclosed
within the q shell in the linear density ﬁeld. This model

−

16 The choice s = 1 also corresponds roughly to the ρ1/2 model
2 at
in Ref. [63], since ρ is approximately proportional to r−
r = rmax.

17 Note that a model in which a shell freezes where its own energy

is virialized is equivalent to the turnaround model above.

100101qmax/[∆(qmax)X(qmax)](runit)10−1100rmax(runit)w=0.1w=0.3w=0.5EMDE100GeV3.5keV100101qmax/[∆(qmax)X(qmax)](runit)rmax=βqmax/(∆X)β=0.414s=0contraction0110−1100qmax/[∆(qmax)X(qmax)](runit)10−1100rmax(runit)w=0.1w=0.3w=0.5EMDE100GeV3.5keV10−1100qmax/[∆(qmax)X(qmax)](runit)rmax=βqmax/(∆X)β=0.846s=1contraction01TABLE III. A summary of the predictive models along with their simulation-tuned coeﬃcients.
In each model, the halo
quantity is proportional to the peak quantity with the given coeﬃcient between them. The mean and rms deviation σ in the
proportionality coeﬃcient are computed in log space. We express the spread as a ratio: in particular, the middle 50% spread
is the ratio between the 75th and 25th percentiles, while the 1σ spread is the ratio corresponding to the log-space σ. We also
list the number of halos contributing to the coeﬃcient statistics.

13

Halo
quantity

A
A
rmax
rmax
rmax
rmax
rmax
rmax
M (rmax)
M (rmax)
M (rmax)
M (rmax)
M (rmax)
M (rmax)

Peak quantity
¯ρ0δ9/4|∇2δ|−
3/4
3/4f −
ec

3/2

¯ρ0δ9/4|∇2δ|−

(e, p)

qmax/∆(qmax)
qv/∆(qv)
qmax/[∆(qmax)X(qmax)]
qmax/[∆(qmax)X(qmax)]
qmax/κ(qmax)
qv/∆(qv)

(4π/3)q3
(4π/3)q3

(4π/3)q3
(4π/3)q3

max ¯ρ0
v ¯ρ0
max ¯ρ0X(qmax)
max ¯ρ0X(qmax)
max ¯ρ0
v ¯ρ0

(4π/3)q3
(4π/3)q3

Model

Spherical collapse
Ellipsoidal collapse
Turnaround, qmax < qv
Turnaround, qmax > qv
s = 0 contraction
s = 1 contraction
Virialization, qmax < qta
Virialization, qmax > qta
Turnaround, qmax < qv
Turnaround, qmax > qv
s = 0 contraction
s = 1 contraction
Virialization, qmax < qta
Virialization, qmax > qta

Median
coeﬃcient

Middle 50%
spread

Mean
coeﬃcient

1σ
spread

Sample
size

Section
ref.

8.76
12.1
0.131
0.088
0.414
0.846
0.042
0.092
0.273
0.134
0.441
0.658
0.150
0.143

1.43
1.31
1.34
2.18
1.40b
1.39c
1.36
1.95
1.64
2.97
1.76
1.73
1.59
2.79

8.50
12.2
0.132
0.085
0.406
0.848
0.042
0.087
0.258
0.123
0.396
0.619
0.145
0.129

1.44
1.36
1.39
1.75
1.52
1.49
1.37
1.70
1.84
3.13
2.30
2.23
1.71
2.98

2451
2450a
1759
712
2471
2471
1578
893
1514
639
2153
2153
1341
812

III A
III B
IV A
IV A
IV B
IV B
IV C
IV C
IV A
IV A
IV B
IV B
IV C
IV C

a One peak is so ellipsoidal that Eq. (6) has no solution, so this peak is discarded from analysis.
b The s = 0 coeﬃcient has spread 1.33 and 1.74 over halos for which the turnaround model predicts qmax < qv and qmax > qv,

respectively, implying that the contraction model is superior or comparable to the turnaround model in both cases.

c Similarly, the s = 1 coeﬃcient has spread 1.33 and 1.68 in these two cases.

performs similarly to the turnaround model. Again, there
is a multitude of halos of which the qmax shells have not
yet accreted, leading to dramatically overpredicted values
of rmax. In this case, the qmax < qv condition turns out to
be too restrictive; it eliminates too many halos. Instead,
we require qmax < qta, where qta is Lagrangian radius of
In particular, qta is the
the last shell to turn around.
smallest q satisfying a∆(q)
δta, where δta = 1.062 and
≤
a is the scale factor at which we are studying the halo
population. If qmax < qta, we use qmax to predict rmax
using Eq. (19); otherwise, we use qv to predict rmax using
Eq. (13). We also use this model to predict M (rmax) in a
similar fashion (again using the N <3MM
halos that also
underwent fewer than three major mergers), allowing βM
to ﬂoat. The scatter and statistics of these predictions18
are shown in Fig. 9 and Table III, and we ﬁnd that this
model’s scatter is comparable to that of the turnaround
model.

r

D. Discussion

Table III summarizes the rmax and M (rmax) models
and the statistics of their simulation-tuned parameters.
Evidently, all of these models exhibit similar scatter. For
instance, when qmax < qv or qta, each model’s predicted
rmax exhibits about 30% scatter in the middle half of its

18 We remark that the optimal β

0.042 is much smaller than the

exact value 3/10 claimed in Ref. [73].

(cid:39)

FIG. 12.
For the virialization model, this ﬁgure plots
the values of rmax measured in our simulations against their
predicted values. For visual reference, an example proportion-
ality curve is plotted (not a ﬁt). Like the turnaround model,
this model dramatically overpredicts rmax for a subpopulation
of the halos, a discrepancy that can be corrected in a similar
fashion (see the text).

may be expressed as

r(q) = β

q
κ(q)

, κ(q)

2
q5

≡

(cid:90) q

0

q(cid:48)

4dq(cid:48)∆(q(cid:48))

(19)

with β = 3/10 and M (q) deﬁned as in Eq. (10). For
this model, d ln M/d ln r = 3/[6
2∆(q)/κ(q)]. As
before, qmax is obtained by maximizing M (q)/r(q) or
by solving d ln M/d ln r = 1. We test this model in a
similar fashion, allowing β to ﬂoat and plotting in Fig. 12
the simulated rmax against the model prediction (using
the Nr halos with rmax > rvir). Evidently, this model

−

100101102qmax/κ(qmax)(runit)10−1100rmax(runit)virializationw=0.1w=0.3w=0.5EMDE100GeV3.5keVpredictions. These similarities suggest there may be a
statistical ﬂoor limiting the precision of all three models
equally. We propose two sources of such a ﬂoor. The
ﬁrst is artiﬁcial discreteness noise in our simulations. As
noted in Paper II, there is discreteness noise in each radial
bin of the density proﬁle that is signiﬁcantly larger than
Poisson noise and may be associated with the accretion
of artiﬁcial fragments. Our procedure of averaging radial
proﬁles over a ﬁnite time interval (see Appendix A)
mitigates but does not eliminate this noise.19

The other probable source of a statistical ﬂoor is
physical and owes to a simplifying assumption common
to all three models:
spherical symmetry. Observe in
Fig. 3 that at the initial radius of the qmax shell the
density proﬁle of the peak that is depicted—a typical
peak drawn from the w = 0.3 power spectrum—is highly
ellipsoidal.
It is likely that a substantial fraction of
the approximately 30% scatter in rmax results from de-
viations from spherical symmetry in the initial density
peaks. To correct this, models must be employed that
move beyond the assumption of spherically symmetric
initial conditions, perhaps employing ellipsoidal collapse
arguments [76, 77, 111] or drawing from nonspherical
self-similar infall theory [64, 65]. The principal diﬃculty
in moving beyond spherical symmetry is that the three-
dimensional shape of a peak is diﬀerent at each radius,
an eﬀect for which no model has accounted (to our
knowledge). However, the spherical models presented
here exhibit just approximately 30% scatter in rmax and
approximately 60% scatter in M (rmax) over the full range
of cosmologies we simulated, a success that should not
be understated. As we will see in Sec. V, halo mergers
present a larger source of error.

∝

r−

Beyond predicting rmax and M (rmax) (or equivalently
vmax), we may ask how well the spherical infall models
can predict the full density proﬁles of the ﬁrst halos. No
3/2 at small radii20,
model successfully predicts ρ
and this is not surprising because in the moments after
halo collapse the accretion of new material is not adi-
abatic with respect to the orbits of the already bound
material. Nevertheless, we may explore the radial range
over which the spherical infall models do accurately pre-
dict the density proﬁles. Figure 13 compares the mass
proﬁles of a small halo sample to their predicted proﬁles
using the median proportionality coeﬃcients in Table III.
Evidently, the turnaround and virialization models do

19 There are other sources of discreteness noise in our analysis, but
they are minor. The binning of our density proﬁles in factors of
1.1 introduces artiﬁcial scatter, but this scatter does not exceed
5% in rmax and is further reduced by our use of interpolation
(see Appendix A). There is also noise in the predicted values of
rmax because they arise from a ﬁnite density grid, but since qmax
is typically much larger than a grid cell [so δ(qmax) averages over
a large number of cells], the resulting scatter is small.

20 An s = 3/2 contraction model predicts ρ

3/2 at small radii,
but only in a contrived way; the adiabatic approximation is not
valid when this part of the proﬁle develops.

r−

∝

14

FIG. 13. The mass proﬁles (thick, dark lines) of a few halos in
the w = 0.3 (top) and EMDE (bottom) simulations compared
to their model predictions (thin lines). This ﬁgure is intended
to depict how the shapes of the proﬁles compare, so the
sample was selected to have little discrepancy in the overall
normalization of M/r. The simulated proﬁles are plotted out
to their virial radii. The turnaround and virialization model
predictions largely overlap.

not accurately predict the density proﬁle below rmax,
although they may succeed at larger radii. The s = 0 and
s = 1 contraction models, and especially the latter, more
accurately capture the shape of the proﬁle at smaller
radii. However, as shown in Fig. 10, the true density
s,
proﬁle of a mass shell is more complicated than ρ
so a more sophisticated model for a shell’s density proﬁle
should yield still better results.

r−

∝

In this section, we presented models that can predict
the outer portions of the density proﬁles of the ﬁrst halos
in any cosmology. While the models themselves are not
new, our calibrations enable their use as predictive tools.
Moreover, our simulations demonstrate the universality
of these models by showing that they succeed across

10−1100r(runit)100101102M(r)/r(munit/runit)w=0.3s=0contractions=1contractionturnaroundvirialization10−210−1100r(runit)101102M(r)/r(munit/runit)EMDEs=0contractions=1contractionturnaroundvirializationwildly dissimilar cosmological scenarios.

V. PREDICTING HALO POPULATIONS

So far, we have studied the relationship between a
density peak and its resulting halo. However, our ul-
timate goal is to study the larger populations. Recall
from Sec. II that not all peaks matched to halos in our
simulations and not all halos matched to peaks. These
discrepancies are reﬂected in Table II and may arise from
physical processes, such as halo mergers, or numerical
artifacts in our simulations. We have shown that if we
know that a peak developed into a halo that persisted to
some later redshift then we can predict the properties of
that halo from the properties of the peak. Ultimately,
however, we wish to predict an entire population of halos
directly from a population of peaks. In light of the halo-
and peak-count discrepancies, can our models proceed in
this way?

A. Population comparisons

We ﬁrst study the population of halos distributed in
the asymptote A. In Fig. 14, we compare the entire halo
population found in our simulations to the population
predicted by accounting for every peak in the initial
density ﬁelds that would have collapsed by simulation
termination. We use the ellipsoidal collapse model.
Generally, we see that for the narrower w = 0.1, w =
0.3, and EMDE power spectra the predicted population
matches the simulated population reasonably well.
In
these scenarios, our model underpredicts halos at the
low-density end, a surprising result that may be due to
artiﬁcial fragmentation. In simulations with a small-scale
power-spectrum cutoﬀ (like ours; see Fig. 1), discreteness
noise causes ﬁlamentary structures to fragment into halos
even below the scales of the smallest density ﬂuctuations.
These halos have been shown to be unphysical simulation
artifacts [135, 136], but they could contribute to the
excess of less-dense halos in our simulations relative to
model predictions in the cases of the narrower power
spectra.

Otherwise, Fig. 14 shows a tendency for the model to
overpredict halos at the middle-density range and under-
predict at the highest-density range. This discrepancy
can be attributed to mergers, for which our model does
not account. Halo mergers reduce the number of halos
while raising the central density of the merger remnants.
For the broader w = 0.5, 100 GeV, and 3.5 keV power
spectra (bottom panel of Fig. 14), the merger-based
discrepancy is ampliﬁed: the model underpredicts the
densest halos and dramatically overpredicts the rest. Ev-
idently, while our model can predict the density proﬁles
of individual halos, an understanding of halo mergers
is necessary to accurately predict halo populations in

15

FIG. 14. A comparison between the simulated halo popu-
lation, as solid lines, and the population predicted from the
peaks in the linear density ﬁeld, as dashed lines, distributed
in the inner asymptotic coeﬃcient A. We use the ellipsoidal
collapse model to predict A. Top: The three simulations with
narrower power spectra. Bottom: The three simulations with
broader power spectra. The vertical axis is logarithmic here to
accommodate the diﬀerences in scale. We ﬁnd that our model
can capture halo populations arising from more narrowly
supported power spectra, but it does not describe well the
populations arising from broader power spectra because of
the predominance of halo mergers in those scenarios.

scenarios with more broadly supported power spectra.
We will return to this point.

We next study the distribution in the radius rmax.
Many of the simulated halos had rmax > rvir, and while
we discarded those halos from previous analyses, doing so
now would alter the populations. Instead, we account for
this problem here by substituting rvir for rmax in those
cases. As Fig. 15 shows, the s = 0 contraction model
predicts the rmax distribution reasonably well for the
narrow power spectra, with the bulk of the discrepancy
arising from overprediction of the total halo count due to
halo mergers. The predicted distributions are also more
sharply peaked, an eﬀect that may owe to the model’s
neglect of spherical asymmetry (see Sec. IV D). For the
broader power spectra, the halo count discrepancy is
magniﬁed due to the much larger frequency of mergers.

100101102A(munitr−3/2unit)0.000.010.020.030.04R3∗dn/dlnAw=0.1w=0.3EMDE100101102A(munitr−3/2unit)10−510−410−310−2R3∗dn/dlnAw=0.5100GeV3.5keV16

TABLE IV. This table shows how accurately our models pre-
dict aggregate halo signals. We consider simpliﬁed aggregate
signals (cid:80) A2 for annihilation and (cid:80) M (rmax)rmax for lensing,
each summed over the population of predicted or simulated
halos. In each case, we list the ratio of the signal predicted
from the linear density ﬁeld to the signal aggregated over
halos in the simulation box. We use the ellipsoidal collapse
and s = 0 contraction models.
(cid:80) A2
0.91
0.89
0.91
0.78
1.15
1.16

(cid:80) M (rmax)rmax
0.56
0.69
2.2
0.66
33
14

Simulation
w = 0.1
w = 0.3
w = 0.5
EMDE
100 GeV
3.5 keV

signal (see Paper II).

We also consider an aggregate microlensing signal.
The apparent image of a background star is deﬂected
by an angle proportional to M2D(ξ)/ξ, where M2D(ξ)
is the projected mass enclosed within impact parameter
ξ. As an approximation, we claim that the deﬂection
due to a halo is proportional to M (rmax)/rmax and a
Integrating
function related to the impact parameter.
over impact parameters introduces a factor r2
max, the
characteristic area of the halo. Hence, for a halo pop-
ulation, the aggregate lensing signal, considered as the
expected deﬂection of a given image, is proportional to
(cid:80) M (rmax)rmax summed over all halos.

In Table IV, we show how accurately the s = 0 contrac-
tion model predicts this signal. We ﬁnd that our models
predict the lensing signal signiﬁcantly worse than the
annihilation signal, although in four of the simulations,
the prediction still agrees to about a factor of 2. For the
simulations drawn from the 3.5 keV and 100 GeV power
spectra, however, the model overpredicts the lensing
signal by an order of magnitude. These power spectra
yield the greatest prevalence of halo mergers, and unlike
in the case of annihilations, mergers do not suﬃciently
boost the remnant’s lensing signal relative to its model
prediction to compensate for the loss of halo count in
mergers. Hence, the lensing signal in the simulations is
much smaller than that predicted from the linear density
ﬁeld. We remark, however, that the story may change if
instrument sensitivities are taken into account. Mergers
predominantly destroy smaller halos, and their signals
may have been beyond sensitivity limits regardless.

It is clear from these results that an accurate ac-
counting of halo mergers is necessary to predict a halo
population in any generality. However,
for narrower
power spectra such as our w = 0.1, w = 0.3, or EMDE
cases, mergers are subdominant, and our models can
predict the populations reasonably well. Moreover, when
considering aggregate annihilation signals, halo mergers
may not have a signiﬁcant impact beyond altering the
γ inner density proﬁles. For these
slope γ of the ρ
uses, we describe in Appendix C a method to sample the

r−

∝

FIG. 15. Similar to Fig. 14, but studying the halo population
distributed in the radius rmax instead. We use the s = 0
contraction model. As in Fig. 14, we ﬁnd that our model
describes the halo populations arising from more narrowly
supported power spectra with reasonable success, although
the predicted distributions tend to be more sharply peaked.
However, halo mergers greatly alter the halo populations in
scenarios with broader power spectra.

However, unlike in the case of the asymptote A, we
will soon see that the radius rmax does not signiﬁcantly
increase due to mergers beyond what the models already
predict. Hence, there is no signiﬁcant underprediction of
the largest-radius halos.

∝

We can also ask how well our models predict aggre-
If we assume that all halos
gate observational signals.
3/2 inner density proﬁles, then the total
have ρ
r−
dark matter annihilation rate in halos is proportional to
the sum (cid:80) A2 over all halos.21
In Table IV, we show
how accurately the ellipsoidal collapse model predicts
the aggregate annihilation signal. Remarkably, despite
not accounting for halo mergers, we successfully predict
the annihilation signal to within a factor of 1.3 for all
simulations. The increased central density within merger
remnants has compensated for the drop in halo count.
One caveat is that in this calculation, we did not account
γ inner proﬁle re-
for changes in the slope γ of the ρ
sulting from mergers. This change must be accounted for
separately and will signiﬁcantly reduce the annihilation

r−

∝

21 There is a logarithmic sensitivity to rmax, which we neglect.
Also, note that there is a density cap imposed by annihilations
[140], so the signal converges even for ρ

3/2.

r−

∝

10−1100rmax(runit)0.0000.0250.0500.0750.100R3∗dn/dlnrmaxw=0.1w=0.3EMDE10−1100101rmax(runit)10−510−410−310−210−1R3∗dn/dlnrmaxw=0.5100GeV3.5keVhalo population directly from the matter power spectrum
(k), bypassing the step of drawing a density ﬁeld δ(x).
P
Halo populations predicted using this method are slightly
diﬀerent from those predicted using our density ﬁelds,
but we propose that they are more accurate; the method
we describe can easily sample a much larger number of
peaks, and it is not subject to errors related to the ﬁnite
size and ﬁnite grid spacing of a sampled density ﬁeld.22

B. Halo mergers

A full treatment of mergers is beyond the scope of this
work, but we are poised to make some observations. Our
procedure for matching a halo to its predecessor density
peak involved tracking each halo backward through time.
During this process, we counted the number of major
mergers this halo underwent, which we deﬁne to be a
merger between two halos with mass ratio smaller than
3. Over half of our halos with well-resolved asymptotes
experienced at least one major merger, and 12% experi-
enced at least three.

In an eﬀort to ﬁnd a simple way to cull halos that
end up merging, we explored cutting out density peaks
that were too close to an earlier-collapsing density peak.
We considered two characteristic comoving length scales
below which to make these cuts: the scale qpk associated
with the density peak (see Sec. III) and the scale qmax
where (cid:15)(qmax) = 2/3 (see Sec. IV A). Unfortunately, nei-
ther of these cuts produced sensible results. The qpk cut
culled far too few halos, while the qmax cut culled far too
many. Ultimately, we expect that a more sophisticated
accounting of mergers will be necessary, possibly follow-
ing along the lines of extended Press-Schechter theory
[141] or the Peak Patch algorithm [111, 142, 143].

Another question is how halo density proﬁles change
due to mergers. Reference [10] found that successive
mergers cause the slope γ of the small-radius asymptote
γ, to become shallower than
of the density proﬁle, ρ
r−
its initial value of γ = 3/2. The same work also found
that successive mergers increase the central density. Fig-
ure 16 shows that both of these results are borne out
in our own simulations as well. There is a clear trend
wherein more major mergers lead to successively denser23
but shallower inner structures. On the other hand, we
also see in Fig. 16 that major mergers do not signiﬁcantly

∝

22 If sampling directly from the power spectrum is more accurate,
one may wonder why we chose to compare our simulation results
to those predicted from the less-accurate ﬁnite density ﬁelds
(Figs. 14 and 15). The reason for this choice is that it leads to a
more explicit test of our model. Since we compare a simulation’s
results to model predictions using the same simulation’s initial
density ﬁeld, any discrepancy that is not a simulation artifact
can be attributed to the model.

23 While the coeﬃcient A is only well deﬁned if γ = 3/2, our proce-
dure for measuring A (see Appendix A) obtains a logarithmically
averaged value of ρr3/2 over the inner density proﬁle regardless.

17

FIG. 16.
The impact of major mergers on the density
proﬁles in our simulations. Top: The eﬀect on the power-
γ inner asymptote. Since we do
law index γ of the ρ ∝ r−
not resolve these radii well, much of the scatter likely arises
from numerical noise. Middle to bottom: The eﬀects on the
asymptote A, radius rmax, and mass M (rmax), respectively,
plotted as the ratio between the measured value and the
prediction using our models. For the asymptote, we use the
ellipsoidal collapse model, while for rmax and M (rmax), we
use the s = 0 contraction model. The color scale, which is
logarithmic, represents a density estimate (in log space for α,
β, and βM ; darker is denser), while the lines mark the median
and the 25th and 75th percentiles at each merger count.

increase rmax beyond what our models already predict,
although they do increase M (rmax).

VI. CONCLUSION

The ﬁrst halos form by direct collapse of peaks in the
primordial density ﬁeld. If some of these halos survive the

1.001.251.501.752.00γasymptoteslope61020αasymptotecoeﬃcientA0.20.41.0βradiusrmax0123456numberofmajormergers0.20.41.0βMmassM(rmax)subsequent hierarchical clustering process, as evidence
suggests [7, 9, 10, 12–16], then they would be the densest
In this work, we
dark matter objects in the Universe.
presented models that predict the density proﬁles of these
halos directly from the properties of the density peaks
that formed them, and we used high-resolution cosmolog-
ical simulations in a variety of diﬀerent scenarios to tune
and validate these models. The models are described in
Secs. III and IV and summarized in Table III. They have
simulation-tuned parameters, but these parameters are
independent of cosmology and do not need to be retuned
to accommodate diﬀerent scenarios.

We treated small and large radii separately, with the
understanding that these regimes form under radically
diﬀerent circumstances. At small radii, the ﬁrst halos
3/2 density proﬁles [4–9, 53, 54], and
develop ρ = Ar−
our model predicts the coeﬃcient A with remarkable
success. Over the full range of cosmologies we explored,
the scatter from our model is only in the vicinity of 30%-
40%, and it is likely that a signiﬁcant fraction of that
scatter arises from numerical noise in our simulations.
The density proﬁles at large radii are more varied, but we
parametrize them using the radius rmax at which the cir-
cular velocity is maximized along with the mass M (rmax)
enclosed within that radius. For this regime, we employ
models already present in the literature [55, 63, 73], but
we supply calibrations that enable their use as predictive
tools applicable to any cosmology. The scatter from our
models is roughly 40%-50% in rmax and a factor of 2 in
M (rmax), and, similarly, not all of this scatter is physical.
In this way, the models we presented can predict the
halo arising from a given density peak. Our goal, how-
ever, is to predict populations of halos. For a power spec-
trum of density ﬂuctuations that is narrowly supported,
such as the spectrum imprinted by an EMDE [36–39] or
certain inﬂationary models [114–123], our models repli-
cate the entire halo population reasonably well. Thus,
our models can serve as a tool to predict the observational
signals of such cosmologies. However, for more broadly
supported power spectra, such as those arising from a
scale-invariant initial spectrum, halo mergers dramati-
cally alter the halo population, causing the populations
that arise in our simulations to diﬀer substantially from
the populations our models predict. Interestingly, mod-
γ inner density
ulo changes in the slopes γ of the ρ
proﬁles, dark matter annihilation signals seem to be
suﬃciently close to additive in halo mergers that our
models still predict the aggregate annihilation signal to
within 30% in every cosmology we tested.

r−

∝

18

mergers, the most prominent of which is the extended
Press-Schechter theory [141]. The Peak Patch algo-
rithm [143] represents a method that may be easier to
adapt, among other advantages, if more computationally
expensive to apply. Meanwhile, the larger challenge
is to predict how halo mergers alter density proﬁles.
References [9, 10, 12] (for major mergers) and [14–16]
(for minor mergers) represent steps toward this goal, but
there is not, as yet, a suﬃciently general model.

Moreover, there is room for improvement in our models
In predicting the density proﬁles at large
themselves.
radii, we assume that each mass shell contributes density
in a proﬁle that is a single power law up to a maximum
radius. In reality, shell proﬁles follow more complicated
forms that are sensitive to the total density proﬁle; see
Fig. 10 and Refs [63, 65]. Utilizing more accurate shell
proﬁles would likely improve the model predictions for
the density proﬁle, especially in predicting its broader
shape rather than only rmax and M (rmax). Also, our
model for the density proﬁle at large radii completely
discounts any deviations from sphericity in the initial
peak. Another avenue for improvement may be to in-
corporate ellipsoidal collapse. At small radii, the reason
3/2 proﬁle arises is not well understood, and its
the ρ
accuracy has only been conﬁrmed down to the resolution
limits of N -body simulations. A physical understanding
must be developed of the mechanism by which this pro-
ﬁle arises in order to conﬁrm whether the proﬁle truly
extends to arbitrarily small radii.

r−

∝

The primordial density ﬁeld and its power spectrum
of density ﬂuctuations comprise a valuable window into
the early Universe and the nature of dark matter. Our
work in this paper was carried out as part of an eﬀort to
use the observational signatures of dark matter halos to
probe these ﬂuctuations. Further research is still needed
to understand the impact of mergers on halo populations
before these signatures, or their nonobservation, can be
employed to robustly constrain cosmology. Nevertheless,
the models presented in this work, which predict the
initial halo population, represent a step forward in our
capacity to use this probe.

ACKNOWLEDGMENTS

Nevertheless, it is not clear that this additivity in the
annihilation signal should extend beyond the timescales
spanned by our simulations. More broadly, our models
predict the initial halo population, but a proper under-
standing of halo mergers is needed in order to robustly
It is necessary
connect it to the population today.
to understand both how mergers are distributed across
halos and time and how they impact halo density pro-
ﬁles. Methods exist that can predict the distribution of

The authors thank Dragan Huterer for bringing
Ref. [63] to their attention. The simulations for this work
were carried out on the KillDevil and Dogwood comput-
ing clusters at the University of North Carolina at Chapel
Hill. M. S. D. and A. L. E. were partially supported by
NSF Grant No. PHY-1752752. Several key ﬁgures in
this work employ the cube-helix color scheme developed
by Ref. [144].

19

∝

r−

We also wish to accommodate deviations

from
3/2 at small radii. Unlike those of Paper II, our
ρ
simulations do not have the resolution to clearly resolve
the power-law index of the small-radius asymptote, but
we may still hope to see statistical correlations in our
large sample. For each halo, we measure the slope γ of
γ by considering the
the small-radius asymptote ρ
radius range from rsoft to 3rsoft and ﬁtting a line in log
space to the density proﬁle within this range.

r−

∝

To test the models presented in Sec. IV, we also need
to compute the radius rmax at which the circular velocity
is maximized along with the mass M (rmax). Since we
already obtained the enclosed mass proﬁle M (r) for each
halo, we simply ﬁnd the maximum value of M (r)/r. The
parameters rmax and M (rmax) are then deﬁned to be the
radius and enclosed mass at which M (r)/r is maximized.

FIG. 17. The density proﬁles of three random halos from
each simulation’s ﬁnal box.

Appendix B: Collecting peak parameters

Appendix A: Collecting halo data

In Sec. II, we carried out six simulations and cata-
logued all halos present at the ﬁnal redshift of each. The
models we present in Secs. III and IV require data on
the density proﬁles of these halos, and in this section, we
detail our methods for collecting these data.

We ﬁrst need to obtain the density proﬁle and en-
closed mass proﬁle of each halo at the ﬁnal redshift of
each simulation. To reduce random noise, we use the
procedure described in Paper II, wherein the proﬁles are
averaged over a time interval. The proﬁles are binned
at successive factors of 1.1 in radius, but to mitigate
noise associated with the binning scheme, we use a cubic
spline to smoothly interpolate them. These proﬁles are
only valid down to the radius rsoft corresponding to the
separation below which simulation forces become non-
Newtonian; for Gadget-2, rsoft is 2.8 times the force
softening length. At large radii, we cut oﬀ the density
proﬁle at the radius rvir inside which the mean enclosed
density is 200 times the background density. Figure 17
shows a random sample of halo density proﬁles from each
simulation.

The model developed in Sec. III predicts the coeﬃcient
3/2 asymptote of the density proﬁle
A of the ρ = Ar−
at small r. Thus, we wish to extract A from each
density proﬁle. Starting at rsoft, we ﬁnd the cumulative
(logarithmic) average of ρr3/2 across radial bins, and we
set A to be the maximum of this cumulative average.
The averaging procedure is intended to minimize noise
resulting from employing a narrow range of radii while
at the same time minimizing the inﬂuence of any bend in
the density proﬁle at larger radii. However, we also tested
the alternative procedure of simply ﬁnding the average of
ρr3/2 within a factor of 3 in radius above rsoft and found
it to yield similar results.

The models we present in Secs. III and IV employ data
on the peaks in the linear density ﬁeld δ(x)
δ(x, a)/a
(evaluated during matter domination). We obtain these
data using Fourier methods, deﬁning

≡

(cid:90)

δ(k)

≡

d3x e−

ik

xδ(x).
·

(B1)

The derivatives of δ at a peak located at x immediately
follow as

∂i∂jδ =

(cid:90) d3k

(2π)3 eik

−

xkikjδ(k).

·

(B2)

Similarly, using Poisson’s equation, the derivatives of the
(peculiar) gravitational potential are

∂i∂jφ = 4πG¯ρ0

(cid:90) d3k

(2π)3 eik

x kikj
·

k2 δ(k).

(B3)

The ellipsoidal reﬁnement described in Sec. III B requires
the three-dimensional shape parameters eφ and pφ for the
λ3 to be
potential φ about the peak. Taking λ1 ≥
the eigenvalues of ∂i∂jφ, these parameters are deﬁned

λ2 ≥

eφ ≡

λ3

λ1 −
2(λ1 + λ2 + λ3)

and pφ ≡

2λ2
λ1 + λ3 −
2(λ1 + λ2 + λ3)

. (B4)

Our model in Sec. IV requires the density proﬁle δ(r)
and mass proﬁle ∆(r) about the peak. For a peak
centered at x, these proﬁles are computed as






δ(r)
∆(r)
ζ(r)






=

(cid:90) d3k

(2π)3 eik

xδ(k)
·






sinc(kr)
W (kr)
cos(kr)






,

(B5)

sin(x)/x and W is the top-hat window
where sinc(x)
≡
function, W (x)
x cos x). The third
proﬁle ζ(r) is useful because it is related to the derivative
of δ(r). In particular, to numerically integrate Eq. (16),

(3/x3)(sin x

−

≡

10−210−1100r(runit)100101102ρr3/2(munitr−3/2unit)w=0.1w=0.3w=0.5EMDE100GeV3.5keVdensity of peaks in a Gaussian random ﬁeld, in terms of
parameters ν

δ/σ0 > 0 and x

2δ/σ2 > 0, is

≡

≡ −∇

20

d2n
dνdx

=

ν2/2

e−
(2π)2R3
∗

exp(cid:2)

−

f (x)

σ2
1/(σ0σ2), σj and R
where γ
∗
and (3), and

≡

1
2 (x
−
[2π(1

γν)2/(1
γ2)]1/2

−

γ2)(cid:3)

,

−

(C1)
are deﬁned in Eqs. (2)

f (x)

x3

≡

(cid:114)

+

−
2
2
5π

3x

(cid:104)
erf
(cid:20)(cid:18) 31
4

x2 +

(cid:16)(cid:112)

(cid:17)

5/2x

+ erf

(cid:16)(cid:112)

5/8x

(cid:17)(cid:105)

(cid:19)

8
5

5

8 x2

e−

+

(cid:18) x2

2 −

(cid:19)

2 x2 (cid:21)

5

.

e−

8
5

(C2)

FIG. 18.
The density proﬁles of three peaks from each
simulation’s initial box. These peaks are chosen to match the
halos of which the density proﬁles are depicted in Fig. 17.

we interpolate δ(r) and ∆(r) with piecewise polynomials,
using the relations

dδ
d ln r

= ζ(r)

−

δ(r) and

d∆
d ln r

= 3 [δ(r)

−

∆(r)] (B6)

to ﬁx their derivatives.

Figure 18 shows the density proﬁles δ(r) of three peaks
from each of the six simulations. The peaks displayed are
those that later collapse into the halos depicted in Fig. 17.

Appendix C: Predicting the halo population from
the power spectrum

P

A primary goal of this work is to enable a prediction
of the halo population given a power spectrum
(k) of
density ﬂuctuations. One option is to sample a density
ﬁeld from the power spectrum, use the methods described
in Appendix B to characterize the peaks, and then apply
the models developed in this work. However, it is possible
to exploit the statistics of a Gaussian random ﬁeld to
compute the halo distribution more directly.
In this
section, we outline a practical procedure to perform this
computation by sampling from the peak distribution.
(k, a)/a2,
Similarly to earlier sections, we deﬁne
where
(k, a) is the dimensionless matter power spec-
trum evaluated using linear theory during matter domi-
nation. All quantities derived therefrom, such as σj and
δ(x), inherit similar scaling.

≡ P

(k)

P

P

The ν integral can be carried out analytically, leading to

dn
dx

=

f (x)
8π2R3
∗

x2/2

e−

(cid:34)

(cid:32)

1 + erf

(cid:112)

(cid:33)(cid:35)

,

(C3)

xγ

2(1

−

γ2)

and this equation can be integrated numerically over
x

0 to obtain n.

≥

2. Asymptote A

Next, we use Monte Carlo methods to compute the dis-
3/2 small-radius
tribution of coeﬃcients A of the ρ = Ar−
asymptote. The model described in Sec. III predicts this
asymptote from the amplitude δ and curvature
of
the density peak along with the shape parameters24 e and
p associated with the potential about the peak. Equa-
δ/σ0 and
tion (C1) supplies the peak distribution in ν
2δ/σ2. Meanwhile, the conditional distribution
x
of e and p for a peak of height ν, derived in Ref. [76], is

≡ −∇

|∇

2δ

≡

|

ν) =
f (e, p
|

1125
√10π

e(e2

−

p2)ν5 exp

(cid:21)
ν2(3e2 + p2)

.

(cid:20)

5
2

−

(C4)
To compute the distribution of A, we now employ a
Monte Carlo procedure. We use rejection methods to
sample x from Eq. (C3) and then sample ν from Eq. (C1).
Next, we employ the cumulative distributions of e and p,

ν) = e−

F (e
|

−

15

2 e2ν2 (cid:0)1
(cid:112)

−

3

10/πeνe−

15e2ν2(cid:1) erf

(cid:16)(cid:112)

5/2eν

10e2ν2

(cid:16)

√10eν

+ erf

(cid:17)

(cid:17)

(C5)

1. Number density of peaks

The ﬁrst step is to ﬁnd the total number density n of
peaks. As derived in Ref. [113], the diﬀerential number

24 Since these parameters describe the potential, they are diﬀerent

from the parameters e and p in Ref. [113].

0123456q/R∗−0.50.00.51.01.52.02.53.0δ(q)/σ0w=0.1w=0.3w=0.5EMDE100GeV3.5keVand

e, ν) =
F (p
|

(cid:40)
(cid:0)5e2ν2

1
2

−

(cid:32)(cid:114)

(cid:34)
1(cid:1)

erf

5
2

(cid:33)

(cid:32)(cid:114)

eν

+ erf

(cid:112)

+

10/πν

(cid:16)

5

2 p2ν2

pe−

+ ee−

5

2 e2ν2(cid:17)

(cid:33)(cid:35)

pν

5
2
(cid:41)

(cid:34)
(cid:0)5e2ν2

1(cid:1) erf

−

(cid:32)(cid:114)

(cid:33)

(cid:114)

eν

+

5
2

10
π

×

eνe−

5

2 e2ν2

(cid:35)−
1

,

(C6)

numerically inverting them to inverse transform sample e
and p. This procedure yields a sample of peaks with pa-
rameters ν, x, e, and p. Finally, we use Eqs. (6) and (7)
to convert this sample into a halo sample distributed in
the asymptote A, and we multiply the distribution by the
total number density n to obtain the diﬀerential number
density dn/d ln A.

As a test, we sample 400,000 density peaks from each of
our six power spectra, and for each peak, we compute its
predicted asymptote A (without the proportionality con-
stant) using the ellipsoidal collapse model of Sec. III B.
We plot the resulting distributions in Fig. 19 superposed
with the distributions we ﬁnd in the randomly generated
simulation boxes. We ﬁnd that the two distributions
match well for all of our power spectra except for the
100 GeV spectrum. For this power spectrum, directly
sampling the power spectrum yields halos of higher pre-
dicted density that we ﬁnd in the box. This discrepancy
is explained by noting that the simulation box only
samples ﬂuctuation modes up to the size of the box.
The 100 GeV power spectrum has suﬃcient power at
larger scales that neglecting it signiﬁcantly reduces the
amplitudes of ﬂuctuations and therefore the density of
the resulting halos. In this way, sampling peaks directly
from the power spectrum is more accurate than using the
intermediate step of sampling a density ﬁeld.

3. Outer proﬁle: rmax and M (rmax)

So far, we have obtained the halo population dis-
tributed in the small-radius asymptote A. The next step
is to extend this computation to ﬁnd the multivariate
distribution in A and the outer proﬁle parameters rmax
and M (rmax) using the models discussed in Sec. IV. This
calculation is more diﬃcult because, instead of the ﬁnite
number of Gaussian variables relevant to the neighbor-
hood of each peak, we must now handle a Gaussian dis-
tribution in the inﬁnitely many variables corresponding
to the density proﬁle about the peak at each radius q.
Nevertheless, a numerical computation is tractable.

The idea is to Monte Carlo sample the full density
proﬁle δ(q) about the peak. To accomplish this, we must
discretize the radial coordinate such that

q1 < q2 < ... < qN

0

≤

(C7)

21

FIG. 19. A test of the Monte Carlo halo-sampling method
of Appendix C. This ﬁgure plots the peaks drawn from our
six power spectra distributed in the predictions for A from
Sec. III B (with simulation-tuned parameter α factored out).
The solid lines show the distributions in the initial density
ﬁeld used for our simulations, while the dashed lines show the
distributions computed using the Monte Carlo method.

R
∗

for some large N . The maximum radius may be initially
set at some qN >
and raised as needed. For short-
∼
hand, we will write δi = δ(qi) and use δ to represent
the full vector of δis. We now seek the distribution of
δ conditioned on the data we already used to ﬁnd the
asymptote A. In fact, δ has vanishing covariance with
the three-dimensional shape of the peak, so we need only
the conditional distribution f (δ
ν, x). This distribution
|
is Gaussian with mean

¯δi =

δiν

(
(cid:104)

(cid:105) −

γ

δix
(cid:104)

) ν + (
δix
(cid:104)
(cid:105)
γ2
1

−

γ

δiν
(cid:104)

(cid:105)

) x

(cid:105) −

(C8)

(recalling γ

≡

σ2
1/[σ0σ2]) and covariance matrix

Cij =

δiδj(cid:105) −
(cid:104)

1

(cid:2)

γ2

1

−

(cid:105)

δiν
(cid:104)

δjν

(cid:105) (cid:104)
δiν
γ (
(cid:104)

−

(cid:105) (cid:104)

+

δix
(cid:104)
δjx

+

(cid:105)

δjx

(cid:105) (cid:104)

(cid:105)

δix

(cid:104)

δjν

(cid:105) (cid:104)

with the necessary covariances given by




σ0 (cid:104)
δiν
(cid:105)
σ2 (cid:104)
δix
(cid:105)
δiδj(cid:105)
(cid:104)




(cid:90) ∞

=




(k)

dk
k P

sinc(kqi)
k2 sinc(kqi)
sinc(kqi) sinc(kqj)

0








(C10)
It is helpful to diagonalize C = P DP T so that P
is an orthogonal matrix and D = diag(λ1, ..., λN ) is
¯δ), then
diagonal. If we deﬁne a new vector κ

P T (δ

≡

−

) (cid:3)
(cid:105)
(C9)




.

0.0000.0050.010R3∗dn/dlnAw=0.1w=0.3w=0.510−1100101A/α(munitr−3/2unit)0.00000.00250.00500.0075R3∗dn/dlnAEMDE100GeV3.5keV22

FIG. 21. The peaks drawn from the 3.5 keV power spectrum
distributed in the predictions for A and rmax from Secs. III B
and IV B, respectively (with simulation-tuned parameters α
and β factored out). Top: The distribution computed using
the Monte Carlo method of Appendix C. Bottom: The dis-
tribution in the initial density ﬁeld used for our simulation.
This ﬁgure shows that the Monte Carlo method accurately
reproduces the correlations between A and rmax found in the
density ﬁeld. The color scale indicates the diﬀerential number
3
density d2n/(d ln A d ln rmax) in units of R−
∗

.

FIG. 20. Same as Fig. 19, but distributed in the predictions
for rmax from Sec. IV B using s = 0. Here, the simulation-
tuned parameter β is factored out. The solid lines show the
distributions in the initial density ﬁeld used for our simula-
tions, while the dashed lines show the distributions computed
using the Monte Carlo method.

κ is distributed as

f (κ
ν, x) =
|

N
(cid:89)

i=1

1

(2πλi)1/2 exp

(cid:18)

κ2
i
2λi

−

(cid:19)

.

(C11)

We then sample each κi from its respective univariate
Gaussian distribution, and the density proﬁle δ immedi-
ately follows using δ = ¯δ + P κ. From the density proﬁle
δ
δ(q), we can ﬁnd the mass proﬁle ∆(q) using Eq. (8).
With these proﬁles in hand, it is now a simple matter to
apply any of the models detailed in Sec. IV.

→

To test this procedure, we sample density proﬁles for
the same 400,000 peaks from each power spectrum for
which we already sampled the peak parameters. Us-
ing the s = 0 contraction model in Sec. IV B, Fig. 20
compares the rmax distributions binned from our initial
density ﬁelds to those computed using the Monte Carlo
method. As before, the distributions from the 100 GeV
likely owing again to
power spectrum are discrepant,
the ﬁnite size of the random density ﬁelds. Also, there
is a tendency for the random density ﬁelds to produce
less sharply peaked distributions than the Monte Carlo
method, especially for the w = 0.1, w = 0.3, and EMDE
power spectra. It is unclear where this discrepancy arises,
but it could be connected to the ﬁnite grid resolution of
the random density ﬁelds. For a second test, we also plot
the combined A-rmax distribution for the 3.5 keV power
spectrum in Fig. 21. The Monte Carlo method proposed
in this section accurately reproduces the correlations
between A and rmax found in the density ﬁeld.

0.000.010.020.030.04R3∗dn/dlnrmaxw=0.1w=0.3w=0.50.312rmax/β(runit)0.000.010.020.03R3∗dn/dlnrmaxEMDE100GeV3.5keV10−1100A/α(munitr−3/2unit)100101rmax/β(runit)fromMonteCarlo0.0000.0020.0040.00610−1100A/α(munitr−3/2unit)100101rmax/β(runit)fromdensityﬁeld0.0000.0020.0040.00623

[1] J. F. Navarro, C. S. Frenk,

and S. D. M. White,

Astrophys. J. 462, 563 (1996), astro-ph/9508025.

[2] J. F. Navarro, C. S. Frenk,

and S. D. M. White,

Astrophys. J. 490, 493 (1997), astro-ph/9611107.

[3] J. F. Navarro, A. Ludlow, V. Springel, J. Wang, M. Vo-
gelsberger, S. D. M. White, A. Jenkins, C. S. Frenk, and
A. Helmi, Mon. Not. R. Astron. Soc. 402, 21 (2010).
[4] T. Ishiyama, J. Makino, and T. Ebisuzaki, Astrophys.

Mon. Not. R. Astron. Soc. 463, 102 (2016), 1606.04946.
[30] M. Buschmann, J. Kopp, B. R. Safdi, and C.-L. Wu,
Phys. Rev. Lett. 120, 211101 (2018), 1711.03554.
[31] R. Hlozek et al., Astrophys. J. 749, 90 (2012),

1105.4887.

[32] S. Bird, H. V. Peiris, M. Viel, and L. Verde, Mon. Not.

R. Astron. Soc. 413, 1717 (2011), 1010.1519.

[33] A. S. Josan, A. M. Green, and K. A. Malik, Phys. Rev.

J. Lett. 723, L195 (2010), 1006.3392.

D 79, 103520 (2009), 0903.3184.

[5] D. Anderhalden and J. Diemand, J. Cosmol. Astropart.

[34] J. Chluba, A. L. Erickcek, and I. Ben-Dayan, Astro-

Phys. 04, 009 (2013), 1302.0003; 08, E02 (2013).
[6] T. Ishiyama, Astrophys. J. 788, 27 (2014), 1404.1650.
[7] E. Polisensky and M. Ricotti, Mon. Not. R. Astron. Soc.

450, 2172 (2015), 1504.02126.

phys. J. 758, 76 (2012), 1203.2681.

[35] J. E. Lidsey, A. R. Liddle, E. W. Kolb, E. J. Copeland,
T. Barreiro, and M. Abney, Rev. Mod. Phys. 69, 373
(1997), astro-ph/9508078.

[8] G. Ogiya and O. Hahn, Mon. Not. R. Astron. Soc. 473,

[36] A. L. Erickcek and K. Sigurdson, Phys. Rev. D 84,

4339 (2018), 1707.07693.

083503 (2011), 1106.0536.

[9] R. E. Angulo, O. Hahn, A. D. Ludlow,

and
S. Bonoli, Mon. Not. R. Astron. Soc. 471, 4687 (2017),
1604.03131.

[10] G. Ogiya, D. Nagai, and T. Ishiyama, Mon. Not. R.

Astron. Soc. 461, 3385 (2016), 1604.02866.

[37] G. Barenboim and J. Rasero, J. High Energy Phys.

2014, 138 (2014), 1311.4034.

[38] J. J. Fan, O. ¨Ozsoy, and S. Watson, Phys. Rev. D 90,

043536 (2014), 1405.7373.

[39] A. L. Erickcek, Phys. Rev. D 92, 103505 (2015),

[11] D. Lynden-Bell, Mon. Not. R. Astron. Soc. 136, 101

1504.03335.

(1967).

[40] K. Redmond, A. Trezza, and A. L. Erickcek, Phys. Rev.

[12] N. E. Drakos, J. E. Taylor, A. Berrouet, A. S.

D 98, 063504 (2018), 1807.01327.

Robotham, and C. Power, 1811.12844.

[41] A. S. Josan and A. M. Green, Phys. Rev. D 82, 083527

[13] V. Berezinsky, V. Dokuchaev, and Y. Eroshenko, Phys.

(2010), 1006.4970.

Rev. D 77, 083519 (2008), 0712.3499.

[14] E. Hayashi, J. F. Navarro, J. E. Taylor, J. Stadel,
and T. Quinn, Astrophys. J. 584, 541 (2003), astro-
ph/0203004.

[15] J. Penarrubia, A. J. Benson, M. G. Walker, G. Gilmore,
and L. Mayer, Mon. Not. R.

A. W. McConnachie,
Astron. Soc. 406, 1290 (2010), 1002.3376.

[16] G. Ogiya, F. C. Van den Bosch, O. Hahn, S. B. Green,
T. B. Miller, and A. Burkert, Mon. Not. R. Astron.
Soc. 485, 189 (2019).

[17] J. Diemand, M. Kuhlen, and P. Madau, Astrophys. J.

657, 262 (2007), 1507.08656.

[18] L. E. Strigari, S. M. Koushiappas, J. S. Bullock, and
M. Kaplinghat, Phys. Rev. D 75, 083526 (2007), astro-
ph/0611925.

[19] L. Pieri, G. Bertone, and E. Branchini, Mon. Not. R.

Astron. Soc. 384, 1627 (2008), 0706.2101.

[42] T. Bringmann, P. Scott, and Y. Akrami, Phys. Rev. D

85, 125027 (2012), 1110.2484.

[43] F. Li, A. L. Erickcek, and N. M. Law, Phys. Rev. D

86, 043519 (2012), 1202.1284.

[44] Y. Yang, G. Yang, and H. Zong, Phys. Rev. D 87,

103525 (2013), 1305.4213.

[45] Y.-P. Yang, G.-L. Yang, and H.-S. Zong, Europhys.

Lett. 101, 69001 (2013), 1210.1409.

[46] Y. Yang, Int. J. Mod. Phys. A 29, 1450194 (2014),

1501.00789.

[47] H. A. Clark, G. F. Lewis, and P. Scott, Mon. Not. R.
Astron. Soc. 456, 1402 (2016), 1509.02941; 464, 955
(2017).

[48] Y. Yang and Y. Qin, Phys. Rev. D 96, 103509 (2017),

1711.00993.

[49] T. Nakama, T. Suyama, K. Kohri, and N. Hiroshima,

Phys. Rev. D 97, 023539 (2018), 1712.08820.

[20] T. E. Jeltema and S. Profumo, Astrophys. J. 686, 1045

[50] M. Ricotti and A. Gould, Astrophys. J. 707, 979 (2009),

(2008), 0805.1054.

[21] R. Bartels and S. Ando, Phys. Rev. D 92, 123508 (2015),

1507.08656.

[22] S. Ando, T. Ishiyama, and N. Hiroshima, 1903.11427.
[23] A. Boden, M. Shao, and D. Van Buren, Astrophys. J.

502, 538 (1998), astro-ph/9802179.

[24] M. Dominik and K. C. Sahu, Astrophys. J. 534, 213

(2000), astro-ph/9805360.

[25] A. L. Erickcek and N. M. Law, Astrophys. J. 729, 49

(2011), 1007.4228.

0908.0735.

[51] E. Bertschinger, Astrophys. J. Suppl. Ser. 58, 39 (1985).
and
[52] M. Gosenca, J. Adamek, C. T. Byrnes,
S. Hotchkiss, Phys. Rev. D 96, 123519 (2017),
1710.02055.

[53] M. S. Delos, A. L. Erickcek, A. P. Bailey, and M. A. Al-
varez, Phys. Rev. D 97, 041303(R) (2018), 1712.05421.
[54] M. S. Delos, A. L. Erickcek, A. P. Bailey, and M. A.

Alvarez, Phys. Rev. D 98, 063527 (2018), 1806.07389.

[55] J. E. Gunn and J. R. Gott III, Astrophys. J. 176, 1

[26] K. Van Tilburg, A.-M. Taki, and N. Weiner, J. Cosmol.

(1972).

Astropart. Phys. 2018, 041 (2018), 1804.01991.

[27] E. R. Siegel, M. Hertzberg, and J. Fry, Mon. Not. R.
Astron. Soc. 382, 879 (2007), astro-ph/0702546.
[28] D. Erkal and V. Belokurov, Mon. Not. R. Astron. Soc.

450, 1136 (2015), 1412.6035.

[56] J. R. Gott, Astrophys. J. 201, 296 (1975).
[57] J. Gunn, Astrophys. J. 218, 592 (1977).
[58] J. A. Fillmore and P. Goldreich, Astrophys. J. 281, 1

(1984).

[59] Y. Hoﬀman and J. Shaham, Astrophys. J. 297, 16

[29] D. Erkal, V. Belokurov, J. Bovy, and J. L. Sanders,

(1985).

24

[60] B. S. Ryden and J. E. Gunn, Astrophys. J. 318, 15

1007.0438.

(1987).

[61] S. Zaroubi and Y. Hoﬀman, Astrophys. J. 416, 410

(1993).

[89] S. Bhattacharya, S. Habib, K. Heitmann,

and
A. Vikhlinin, Astrophys. J. 766, 32 (2013), 1112.5479.
[90] A. A. Dutton and A. V. Macci`o, Mon. Not. R. Astron.

[62] E. L. (cid:32)Lokas and Y. Hoﬀman, Astrophys. J. Lett. 542,

Soc. 441, 3359 (2014), 1402.7073.

L139 (2000), astro-ph/0005566.

[63] N. Dalal, Y. Lithwick, and M. Kuhlen, 1010.2539.
[64] B. S. Ryden, Astrophys. J. 418, 4 (1993).
[65] Y. Lithwick and N. Dalal, Astrophys. J. 734, 100 (2011),

1010.3723.

[66] S. D. White and D. Zaritsky, Astrophys. J. 394, 1

(1992).

[67] A. Nusser, Mon. Not. R. Astron. Soc. 325, 1397 (2001).
[68] Y. Ascasibar, G. Yepes, S. Gottl¨ober, and V. M¨uller,
Mon. Not. R. Astron. Soc. 352, 1109 (2004), astro-
ph/0312221.

[69] Y. Lu, H. J. Mo, N. Katz,

and M. D. Weinberg,
Mon. Not. R. Astron. Soc. 368, 1931 (2006), astro-
ph/0508624.

[70] Y. Ascasibar, Y. Hoﬀman, and S. Gottl¨ober, Mon. Not.
R. Astron. Soc. 376, 393 (2007), astro-ph/0609713.
[71] P. Zukin and E. Bertschinger, Phys. Rev. D 82, 104044

(2010), 1008.0639.

[72] P. Zukin and E. Bertschinger, Phys. Rev. D 82, 104045

(2010), 1008.1980.

[73] E. Salvador-Sol´e, J. Vi˜nas, A. Manrique, and S. Serra,
Mon. Not. R. Astron. Soc. 423, 2190 (2012), 1104.2334.
[74] E. Juan, E. Salvador-Sol´e, G. Dom`enech, and A. Man-
rique, Mon. Not. R. Astron. Soc. 439, 719 (2014),
1401.7335.

[75] W. H. Press and P. Schechter, Astrophys. J. 187, 425

(1974).

[91] K. Heitmann, N. Frontiere, C. Sewell, S. Habib,
A. Pope, H. Finkel, S. Rizzi, J. Insley, and S. Bhat-
tacharya, Astrophys. J. Suppl. Ser. 219, 34 (2015),
1411.3396.

[92] A. Klypin, G. Yepes, S. Gottl¨ober, F. Prada,

and
S. Hess, Mon. Not. R. Astron. Soc. 457, 4340 (2016),
1411.4001.

[93] W. A. Hellwing, C. S. Frenk, M. Cautun, S. Bose,
J. Helly, A. Jenkins, T. Sawala, and M. Cytowski, Mon.
Not. R. Astron. Soc. 457, 3492 (2016), 1505.06436.
[94] P. W. Angel, G. B. Poole, A. D. Ludlow, A. R. Duﬀy,
P. M. Geil, S. J. Mutch, A. Mesinger, and J. S. B.
Wyithe, Mon. Not. R. Astron. Soc. 459, 2106 (2016),
1512.00560.

[95] H. L. Child, S. Habib, K. Heitmann, N. Frontiere,
and V. Morozov, Astrophys. J.

H. Finkel, A. Pope,
859, 55 (2018), 1804.10199.

[96] J. S. Bullock, T. S. Kolatt, Y. Sigad, R. S. Somerville,
A. V. Kravtsov, A. A. Klypin, J. R. Primack,
and
A. Dekel, Mon. Not. R. Astron. Soc. 321, 559 (2001),
astro-ph/9908159.

[97] V. R. Eke, J. F. Navarro, and M. Steinmetz, Astrophys.

J. 554, 114 (2001), astro-ph/0012337.

[98] R. H. Wechsler, J. S. Bullock, J. R. Primack, A. V.
Kravtsov, and A. Dekel, Astrophys. J. 568, 52 (2002),
astro-ph/0108151.

[99] D.-H. Zhao, Y. Jing, H. Mo, and G. B¨orner, Astrophys.

[76] R. K. Sheth, H. Mo, and G. Tormen, Mon. Not. R.

J. Lett. 597, L9 (2003), astro-ph/0309375.

Astron. Soc. 323, 1 (2001), astro-ph/9907024.

[100] D. Zhao, Y. Jing, H. Mo, and G. B¨orner, Astrophys. J.

[77] R. K. Sheth and G. Tormen, Mon. Not. R. Astron. Soc.

707, 354 (2009), 0811.0828.

329, 61 (2002), astro-ph/0105113.

[101] C. Giocoli, G. Tormen, and R. K. Sheth, Mon. Not. R.

[78] V. Avila-Reese, C. Firmani, A. Klypin,

and A. V.
Kravtsov, Mon. Not. R. Astron. Soc. 310, 527 (1999),
astro-ph/9906260.

[79] Y. Jing, Astrophys. J. 535, 30 (2000), astro-

ph/9901340.

[80] P. Colin, A. Klypin, O. Valenzuela, and S. Gottl¨ober,

Astrophys. J. 612, 50 (2004), astro-ph/0308348.

[81] K. Dolag, M. Bartelmann, F. Perrotta, C. Baccigalupi,
L. Moscardini, M. Meneghetti, and G. Tormen, Astron.
Astrophys. 416, 853 (2004), astro-ph/0309771.

[82] V. Avila-Reese, P. Col´ın, S. Gottl¨ober, C. Firmani, and
C. Maulbetsch, Astrophys. J. 634, 51 (2005), astro-
ph/0508053.

[83] A. F. Neto, L. Gao, P. Bett, S. Cole, J. F. Navarro, C. S.
Frenk, S. D. White, V. Springel, and A. Jenkins, Mon.
Not. R. Astron. Soc. 381, 1450 (2007), 0706.2919.
[84] A. R. Duﬀy, J. Schaye, S. T. Kay, and C. Dalla Vec-
chia, Mon. Not. R. Astron. Soc. Lett. 390, L64 (2008),
0804.2486; 415, L85 (2011).

[85] L. Gao, J. F. Navarro, S. Cole, C. S. Frenk, S. D. White,
V. Springel, A. Jenkins, and A. F. Neto, Mon. Not. R.
Astron. Soc. 387, 536 (2008), 0711.0746.

[86] A. V. Macci`o, A. A. Dutton, and F. C. Van Den Bosch,
Mon. Not. R. Astron. Soc. 391, 1940 (2008), 0805.1926.
and J. Primack,

[87] A. A. Klypin, S. Trujillo-Gomez,

Astrophys. J. 740, 102 (2011), 1002.3660.
[88] J. Mu˜noz-Cuartas, A. Macci`o, S. Gottl¨ober,

and
A. Dutton, Mon. Not. R. Astron. Soc. 411, 584 (2011),

Astron. Soc. 422, 185 (2012), 1111.6977.

[102] A. D. Ludlow, J. F. Navarro, M. Boylan-Kolchin, P. E.
Bett, R. E. Angulo, M. Li, S. D. White, C. Frenk,
and V. Springel, Mon. Not. R. Astron. Soc. 432, 1103
(2013), 1302.0288.

[103] A. D. Ludlow, J. F. Navarro, R. E. Angulo, M. Boylan-
Kolchin, V. Springel, C. Frenk, and S. D. White, Mon.
Not. R. Astron. Soc. 441, 378 (2014), 1312.0945.
[104] F. C. v. d. Bosch, F. Jiang, A. Hearin, D. Campbell,
D. Watson, and N. Padmanabhan, Mon. Not. R. As-
tron. Soc. 445, 1713 (2014), 1409.2750.

[105] C. A. Correa, J. S. B. Wyithe, J. Schaye, and A. R.
Duﬀy, Mon. Not. R. Astron. Soc. 452, 1217 (2015),
1502.00391.

[106] A. D. Ludlow, S. Bose, R. E. Angulo, L. Wang, W. A.
Hellwing, J. F. Navarro, S. Cole, and C. S. Frenk, Mon.
Not. R. Astron. Soc. 460, 1214 (2016), 1601.02624.
[107] F. Prada, A. A. Klypin, A. J. Cuesta, J. E. Betancort-
Rijo, and J. Primack, Mon. Not. R. Astron. Soc. 423,
3018 (2012), 1104.5130.

[108] C. Okoli and N. Afshordi, Mon. Not. R. Astron. Soc.

456, 3068 (2016), 1510.03868.

[109] B. Diemer and A. V. Kravtsov, Astrophys. J. 799, 108

(2015), 1407.4730.

[110] B. Diemer and M. Joyce, Astrophys. J. 871, 168 (2019),

1809.07326.

[111] J. Bond and S. Myers, Astrophys. J. Suppl. Ser. 103, 1

(1996).

25

[112] Y. Ascasibar and S. Gottl¨ober, Mon. Not. R. Astron.

Soc. 386, 2022 (2008), 0802.4348.

[113] J. M. Bardeen, J. R. Bond, N. Kaiser, and A. S. Szalay,

Astrophys. J. 304, 15 (1986).

(2007), astro-ph/0702600.
[130] A. M. Green, S. Hofmann,

and D. J. Schwarz,
Mon. Not. R. Astron. Soc. 353, L23 (2004), astro-
ph/0309621.

[114] D. S. Salopek, J. R. Bond, and J. M. Bardeen, Phys.

[131] W. Hu and N. Sugiyama, Astrophys. J. 471, 542 (1996),

Rev. D 40, 1753 (1989).

astro-ph/9510117.

[115] A. A. Starobinskij, JETP Lett. 55, 489 (1992).
[116] P. Ivanov, P. Naselsky, and I. Novikov, Phys. Rev. D

50, 7173 (1994).

[132] V. Springel, Mon. Not. R. Astron. Soc. 364, 1105

(2005), astro-ph/0505010.
[133] V. Springel, N. Yoshida,

and S. D. M. White, New

[117] L. Randall, M. Soljaˇci´c, and A. H. Guth, Nucl. Phys.

Astron. 6, 79 (2001), astro-ph/0003162.

B472, 377 (1996), hep-ph/9512439.

[134] P. S. Behroozi, R. H. Wechsler, and H.-Y. Wu, Astro-

[118] A. A. Starobinsky, Grav. Cosmol. 4, 489 (1998), astro-

phys. J. 762, 109 (2013), 1110.4372.

ph/9811360.

[135] R. E. Angulo, O. Hahn, and T. Abel, Mon. Not. R.

[119] J. Martin, A. Riazuelo, and M. Sakellariadou, Phys.

Astron. Soc. 434, 3337 (2013), 1304.2406.

Rev. D 61, 083518 (2000), astro-ph/9904167.

[120] D. J. H. Chung, E. W. Kolb, A. Riotto,

and
I. I. Tkachev, Phys. Rev. D 62, 043508 (2000), hep-
ph/9910437.

[121] N. Barnaby and Z. Huang, Phys. Rev. D 80, 126018

(2009), 0909.0751.

[122] N. Barnaby, Phys. Rev. D 82, 106009 (2010), 1006.4615.
[123] E. Bugaev and P. Klimai, J. Cosmol. Astropart. Phys.

11, 028 (2011), 1107.3754.

[124] G. Jungman, M. Kamionkowski, and K. Griest, Phys.

Rep. 267, 195 (1996), hep-ph/9506380.

[136] M. R. Lovell, C. S. Frenk, V. R. Eke, A. Jenkins, L. Gao,
and T. Theuns, Mon. Not. R. Astron. Soc. 439, 300
(2014), 1308.1399.

[137] P. S. Behroozi, R. H. Wechsler, H.-Y. Wu, M. T. Busha,
A. A. Klypin, and J. R. Primack, Astrophys. J. 763,
18 (2013), 1110.4370.

[138] J. Binney and S. Tremaine, Galactic Dynamics (Prince-

ton University Press, Princeton, NJ, 1987).
[139] B. Moore, T. Quinn, F. Governato, J. Stadel,

and
G. Lake, Mon. Not. R. Astron. Soc. 310, 1147 (1999),
astro-ph/9903164.

[125] P. Bode, J. P. Ostriker, and N. Turok, Astrophys. J.

[140] V. S. Berezinsky, A. V. Gurevich, and K. P. Zybin,

556, 93 (2001), astro-ph/0010389.
[126] M. Viel, G. D. Becker, J. S. Bolton,

and M. G.
Haehnelt, Phys. Rev. D 88, 043502 (2013), 1306.2314.
[127] P. A. R. Ade et al. (Planck Collaboration), Astron.

Phys. Lett. B 294, 221 (1992).

[141] C. Lacey and S. Cole, Mon. Not. R. Astron. Soc. 262,

627 (1993).

[142] J. Bond and S. Myers, Astrophys. J. Suppl. Ser. 103,

Astrophys. 594, A13 (2016), 1502.01589.

41 (1996).

[128] A. Challinor and A. Lewis, Phys. Rev. D 84, 043516

[143] G. Stein, M. A. Alvarez, and J. R. Bond, Mon. Not. R.

(2011), 1105.5292.

Astron. Soc. 483, 2236 (2019), 1810.07727.

[129] A. Lewis and A. Challinor, Phys. Rev. D 76, 083005

[144] D. A. Green, Bull. Astron. Soc. India 39, 289 (2011),

1108.5083.

