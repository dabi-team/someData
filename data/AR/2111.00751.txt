Research Article

Applied Optics

1

1
2
0
2

v
o
N
1

]

M

I
.
h
p
-
o
r
t
s
a
[

1
v
1
5
7
0
0
.
1
1
1
2
:
v
i
X
r
a

Method for tilt correction of calibration lines in high
resolution spectra

TANYA DAS1,2,* AND RAVINDER K. BANYAL1

1Indian Institute of Astrophysics, Bangalore, India
2University of Calcutta, JD-2 Salt Lake, Kolkata 750098, India
*Corresponding author: tanya@iiap.res.in

Compiled November 2, 2021

Technological advancement has led to improvement in the design capabilities of astronomical spectro-
graphs, allowing for high precision spectroscopy, thereby expanding the realms of observational astron-
omy. High-resolution spectrographs use Echelle grating that operates in higher orders, giving more de-
tailed spectra. Often, curvature and tilted lines are observed in the spectra, arising due to the design
trade-offs of the respective spectrographs. Removal of these artifacts can help avoid wrong ﬂux calcula-
tion and line centroid position misinterpretation, which can aid in a better prediction of the wavelength
calibration model. In this paper we present a post-processing technique that we developed to correct the
observed curvature and tilt in the spectra. We have demonstrated the correction technique on Fabry-Perot
and Th-Ar calibration spectra obtained from Hanle Echelle Spectrograph (HESP), Magellan Inamori Ky-
ocera Echelle (MIKE) spectrometer and X-shooter spectrograph. © 2021 Optical Society of America

http://dx.doi.org/10.1364/ao.XX.XXXXXX

1. INTRODUCTION

Spectroscopy is a key method for monitoring and analyzing the
physical and chemical properties of astronomical objects. Mea-
surement of the dark matter content of galaxies and their clusters
[1], estimation of the mass of stellar systems [2], determination
of the age of stars [3], identiﬁcation of chemical composition,
temperature and other parameters by studying the strength of
spectral features [4] and radial velocity measurements to deter-
mine the presence of planets around stars [5] are the primary
ﬁelds of application for spectroscopy.

Spectrographs are instruments used to observe the spectrum
of astrophysical objects. Usually, conventional low-resolution
spectrographs are compact and light weight. They are directly
attached to Cassegrain focus of the telescope behind the primary
mirror. The direct interface with telescope makes it easier to
focus the star light directly onto the spectrograph slit. However,
high-resolution Echelle spectrographs (typically R (cid:38) 50, 000)
tend to be bulky and require larger space. In such cases, spec-
trograph is decoupled from the main telescope and placed on
a stable Nasmyth platform or sometimes housed in a separate
room. A tertiary mirror can be used to steer the telescope beam
onto the Nasmyth focus. Alternatively, ﬁbers are deployed to
collect the light from telescope focal plane and deliver it to the
spectrograph slit. A diverging beam from the slit is collimated
and then passed onto the dispersing element. A diffraction grat-
ing is used in most spectrographs to disperse the light from
the target object into its component wavelengths. A collimated

beam incident on the grating ensures that different wavelengths
are dispersed at distinct angles. The camera optics then focuses
the dispersed light on to a charged coupled device (CCD), where
it is recorded for further analysis.

In contrast to their low-resolution counterparts, high-
resolution spectrographs employ Echelle grating for use in
higher diffraction order, thereby providing more details about
spectral features and giving resolution up to R = 150,000. Echelle
gratings have large blaze angles, typically between 50◦-75◦, pro-
viding dispersion at higher angles, and optimized to concentrate
maximum efﬁciency in a speciﬁc direction. At higher orders,
they offer substantial overlap, causing the longer wavelength
of a higher order to overlap with the following order’s shorter
wavelength. A cross disperser, like a prism or a grating, is used
to separate the overlapping orders in spatial direction to achieve
a wider spectral coverage.

Stellar spectra consist of both absorption and emission lines,
whose precise position is determined by converting the pixels
into the wavelength scale. This step is described as wavelength
calibration, which utilizes known laboratory sources such as
Th-Ar or advanced techniques such as Fabry-Perot (FP) etalon
[6], Iodine cell [7], and laser frequency comb [8].

The beneﬁts provided by echelle spectrographs also come
with some shortcomings and design constraints. In order to
accommodate the spectra effectively on the detector, optical
components, such as slit or camera, are often adjusted, leading
to the introduction of artifacts and aberration like distortion,

 
 
 
 
 
 
Research Article

Applied Optics

2

defocus and tilted lines. The grating also introduces an out-of-
plane gamma angle, along with cross disperser prism, which
induces tilt in the spectral lines [9]. Neglecting these factors may
lead to addition of errors.

The tilt in calibration and spectral lines is also introduced by
imperfections resulting from various trade offs in the spectro-
graph design. Curvature in the spectrograph orders can arise
due to the cross disperser, whose dispersion direction is per-
pendicular to the Echelle grating. The tilt in individual lines in
the spectrum are caused due to the cross disperser and Echelle
grating working on two different planes (operating in quasi-
Littrow mode). Generally, the binning of data is done normal to
the dispersion axis, and hence if the tilt in spectral lines is not
considered, the resulting 1D data may show an increase in the
FWHM of the lines and also cause blending in some cases. This
is because, in the case of tilted lines, the intensity is distributed
over several pixels, which, when binned along the slit direction,
gives a broadened line and wrong ﬂux values, as shown in ﬁgure
1. The broadened spectral line also results in the degradation of
spectral resolution. The tilt in the slit image at the detector is a
function of wavelength [10]. It also compromises the attainable
accuracy in RV measurements if not adequately taken care of
or modelled out by the extraction software [11]. Disentangling
the tilt related shifts in line centroid position from the RV shift
is essential for RV studies. The point spread function (PSF) is
predominantly the response of the instrument to a monochro-
matic light or a point source. The instrumental aberrations of the
system already broaden the energy distribution in the PSF. The
tilt is an artifact of the system, which causes further broadening
of the line. Removal of this artifact can hence facilitate the effort
of predicting instrument PSF by removing one of the dependent
factors, in cases where it is necessary to generate a PSF map
of the instrument and its variation during an observation run.
Measuring the tilt can also help in the study and estimation
of instrument aberrations, for example, a better prediction of
distortion in the system.

Fig. 1. A cartoon depicting the effect of tilt on the FWHM of
the lines.

In this paper, we are using FP and Th-Ar calibration data to
assess and remove the tilt and curvature being introduced by the
instrument. Since FP is a stable source that provides several con-
tinuous lines of equal intensity, it helps in better estimation and

elimination of these artifacts, thereby resulting in a better pre-
diction of the wavelength calibration model. We have designed
and developed an FP based wavelength calibration system [12].
The system was tested on Hanle Echelle Spectrograph (HESP),
where the artifacts of the instrument often show up in the FP
spectra. Spectrographs like Magellan Inamori Kyocera Echelle
(MIKE) spectrometer [13] and X-shooter [14] show highly tilted
spectral lines due to the quasi-Littrow conﬁguration. The tilt
removal algorithm developed as part of this study has been
tested on X-Shooter and MIKE Th-Ar calibration data. A general
review of the existing methods adopted for curvature and tilt
correction in Echelle spectra is presented in 2. The proposed
methodology and algorithm are described in section 3. Results
from the correction algorithm have been presented in section 4
followed by a summary of this work in section 5.

2. REVIEW OF EXISTING TECHNIQUES FOR TILT AND

CURVATURE REMOVAL

In order to obtain calibrated science quality data, the two-
dimensional spectrograms obtained from the spectrograph have
to be processed and the spectrum extracted. Software like IRAF
[15, 16] can be used for general reduction purpose. Many spec-
trographs have dedicated state of the art pipeline for prepara-
tion and reduction of the 2D spectra. A brief description of
the method adopted in X-Shooter and MIKE pipeline will be
discussed in this section, along with a new algorithm called
PyReduce developed for the same purpose.

Fig. 2. Zoomed in Th-Ar calibration spectra from X-shooter
showing highly curved orders along with large tilt in spectral
lines.

X-Shooter is a single target spectrograph of medium resolu-
tion (R∼ 4000-17000), installed at the Cassegrain focus of ESO’s
Very Large Telescope (VLT) [17]. The output of this spectro-
graph consists of highly curved orders with tilted spectral lines,
shown in ﬁgure 2. Due to this, special measures are taken for
wavelength calibration and optimal extraction of the spectra,
as described in [18, 19]. X-Shooter pipeline is written in ANSI
C. Separate pinhole mask arc frames are taken for computation
of initial guess for wavelength solution and determine spatial
and wavelength scale calibrations. A polynomial interpolation,
constructed using multi-pinhole frame, is used for transforming
detector coordinates into a function of wavelength (determined
by the guess solution), order number and position on the slit
that allows the removal of order curvature and line tilts. The
physical model of the instrument can also be used to determine
the wavelength position on detector. Finally, the detector pixels
are oversampled in 2D and linear interpolation is used to ﬁnd
the slit proﬁle which is then collapsed over user deﬁned slits. A
detailed description of the entire pipeline can be found in [20].
The Magellan Inamori Kyocera Echelle (MIKE) is a high reso-
lution, double echelle spectrograph installed on the Magellan II
telescope at Las Campanas Observatory, Chile. Figure 3 shows

Research Article

Applied Optics

3

the Th-Ar calibration spectra as captured in the red arm for a
slit size of 0.7 inches. A dedicated pipeline is available for data
reduction [21] using IDL with a Python alternative. After the
standard image processing involving overscan removal and ﬂat
ﬁelding, a 2D wavelength image is generated by using Th-Ar
arc frame to derive a 1D wavelength solution along the center of
each order. For each order, the high SNR arc lines are identiﬁed
and their tilt is measured as a function of wavelength and echelle
order. The centroid of each line is traced across the order and
best ﬁt line for each arc line is used to calculate the slope. A
2D Legendre polynomial is ﬁt to the calculated slopes for every
order and the slope values interpolated from the solution for
areas with less density of Th-Ar lines. A unique wavelength is
assigned to the center of all the pixels falling within the echelle
order by using the derived wavelength solution and the arc line
tilts. This is done across full CCD pixels and a wavelength image
is generated which is ﬁnally used in the optimal extraction of
the orders. A similar method is adopted by MAGE Spectral
Extractor (MASE) [22].

Fig. 3. Zoomed in Th-Ar calibration spectra from red channel
of MIKE at 0.7" slit setting, showing tilted lines.

The new REDUCE package [23] adds to the earlier version of
the developed package [24] by incorporating tilted and curved
slit images. The method follows a slit decomposition algorithm,
where the 2D image of the spectral order is represented by slit il-
lumination and spectrum, sampled on the detector. The shape of
slit image is modelled by taking strong and unblended emission
lines in a wavelength calibrated spectrum and ﬁtting a 2D Gaus-
sian to each of the line image. The tilt and curvature variations
across the order is combined by ﬁtting a polynomial and interpo-
lating to all the columns. Optimal extraction is then performed
keeping in mind the calculated tilt and curvature.

HESP is a high-resolution general purpose spectrograph in-
stalled on the 2m Himalayan Chandra Telescope (HCT), located
at Indian Astronomical Observatory (IAO), Hanle, at an altitude
of 4500 m above sea level. HESP covers a wavelength range of
350-1000 nm and has been designed to carry out a wide variety
of scientiﬁc studies, including the ability to conduct RV studies
of exoplanet host stars [25]. It provides two modes of operation,
low-resolution mode offering a resolution of R=30000 and high-
resolution mode, which uses an image slicer, giving a resolution
of R=60000. A passively stabilized FP based wavelength cali-
bration system has been installed on HESP spectrograph [26].
The FP spectra obtained in high-resolution mode (R=60,000), is
shown in ﬁgure 4. IRAF and a Python based pipeline, which
does not incorporate tilt correction, is used for reduction of data
obtained from the spectrograph.

3. METHODOLOGY AND ALGORITHM

Fig. 4. FP spectra observed at R=60000.The FP setup operates
at a temperature of 19◦C ± 0.05◦C and under a presure of
0.025 mbar. Top panel: Full two dimensional spectra. Bottom
panel: Zoomed-in version showing part of the spectra and the
slicer image.[27]

A. Aperture Tracing

The ﬁrst step in the process is to identify the position of all the
apertures in the spectra. The position of all these apertures are
saved as higher-order polynomials (2 or above), depending on
which, the apertures are then extracted. This is called tracing of
the apertures, and a continuous spectrum like that of a ﬂat lamp
is used for this purpose. Tracing of apertures was performed
following the routines described in CERES [30].

B. Order extraction

After all the apertures were traced, the apertures are extracted in
the next step. The aperture size (apsize) was chosen based on the
extent of every aperture in the cross dispersion direction. While
choosing the aperture size, the inter-order separation in the
spectra is kept in mind in order to avoid any overlapping of the
mask with consequent orders. Intensity values in the aperture
were extracted by creating a mask using Bivariate Spline [31]
and sampling at every 0.5 pixels. Mask extent was decided from
(y0 − apsize/2) to (y0 + apsize/2) in step size of 0.5, where y0 is
the traced polynomial. An example of the traced mask is shown
in ﬁgure 5.

Fig. 5. Aperture extraction mask, in red, over plotted on the
spectra, for one particular aperture. There is no overlap of the
mask with neighbouring orders.

C. Curvature removal

Correction of the tilt in individual spectral lines should be pre-
ceded by curvature and global tilt removal, if any. For removing
the curvature and straightening the new array, extracted points
were stored in a separate array row-wise. The intensity data
extracted from the ﬁrst row was stored in the ﬁrst row of the
new array and so on. Stacking each straightened aperture in
order of their extraction reproduced the entire spectra without
the curvature as shown in ﬁgure 6.

We have developed a routine that corrects the curvature in spec-
tra and removes the tilt of the individual spectral lines. Im-
age processing tools in Python, namely, Scikit-Image [28] and
OpenCV [29] were used for this purpose.

D. Tilt calculation and removal

The tilt is now computed in curvature removed results. Routine
was tested on both FP and Th-Ar calibration frames (in X-Shooter
and MIKE). Since the spectra have lines with distinguishable

Research Article

Applied Optics

4

Fig. 6. Section of the stacked apertures to show the curvature
correction.

edges, we have used the Canny edge detection technique [32] for
determining the boundaries of each tilted line. The correction
was performed individually on each aperture. The selection, tilt
calculation and correction procedures are entirely automated.
The algorithm for tilt correction is as follows:

• Load the required aperture and take a central y-cut through

the middle of the aperture.

• Smoothen the data obtained from y-cut using Gaussian
smoothening. Detect the peak values in smoothened data
and save the x-position corresponding to the peaks. This
generates position information for all the lines present.

• Calculate the difference between adjacent peak positions.
This gives the separation between two peaks. Take the
median value of differences obtained. Construct a boundary
array with xpeakposition ± median/2 being edge positions.
This is done to avoid overlapping of each FP line boundary
when the ﬁnal corrected array is reconstructed.

• Use the boundary array to construct a box and isolate the
region of interest in a separate array. Calculate the y-extent
of the separated box to include areas with FP data present
and avoid background noise.

• Since Th-Ar spectra does not have equally spaced lines of
uniform intensity, mean thresholding is performed, and a
binary image is generated, example of which is shown in
ﬁgure 7. The transitions from 0 to 1 and vice versa deter-
mine the boundary array values mentioned in the previous
step.

Fig. 7. Binary thresholding performed on one of the apertures
of X-Shooter Th-Ar calibration frame. This is done to detect
medium SNR lines. Top: Original extracted aperture. Bottom:
Result of binary thresholding.

bottom panel shows the effect of correction on the FWHM of
the line. The corrected line is stitched into the reconstructed
main array using the boundary values determined before.
This is done to make sure that the FSR of the data is not
altered.

(a) Tilt correction for single line

(b) 1D binned plot

Fig. 8. Representation of tilt correction. (a) Correction algo-
rithm performed on one Th-Ar line to show how the tilt is
removed. Original line shows the tilted line and corrected line
is the result after correcting for tilt. (b) Binning done across
y-axis to generate 1D plot for both the lines. It can be observed
that the tilt correction drastically reduces the line-width from
12.44 before correction to 6.14 after correction.

• The centroid and tilt angle are determined using function
region prop in Scikit processing package on each calibration
line. The centroid value is taken as the reference position
(x0,y0).

• Every pixel is shifted with respect to the reference position
(x0, y0) determined above, using Eq. 1 [33, 34]. Function
warp in the scikit-image processing tool is used for shifting
pixels according to the calculated xs value.

xs = x(cid:48) − (y(cid:48) − y0) × slope ,

(1)

• The result of the algorithm applied on one tilted line is
shown in ﬁgure 8. Top panel shows the corrected image and

4. RESULTS

The developed method has been tested on Fabry-Perot calibra-
tion spectra of HESP. For X-shooter and MIKE, Th-Ar calibration
spectra were used.

A. HESP

The FP calibration frame of HESP has been shown in ﬁgure 4.
Tilt calculation is preceded by curvature removal and global
tilt correction described in the previous section. FP lines exist
across 22 orders of the spectra, and in ﬁgure 9 we show the
representative plots for six orders: two top orders, two central
orders and two bottom orders. The calculated tilt for FP lines is
plotted along with a linear ﬁt to the points. In HESP, we do not
see a smooth variation in tilt angle after removal of curvature.

01020010203040506070Original line01020Corrected lineResearch Article

Applied Optics

5

As illustrated in ﬁgure 9, the weak trend in the data, however,
is still visible from small but non-zero slopes of the best ﬁt
lines seen in different orders. The wavelength dependence of
tilt is indicated by the slope of the linear ﬁt to the tilt values,
which increases from lower-order (7.75 × 10−6 for order 25) to
higher order (1.46 × 10−5 for order 46). The tilt values are more
scattered because the HESP design does not introduce a large
tilt in the individual lines, causing the noise level in the spectra
to come into the picture. For spectrographs in which it is known
that the design introduces appreciable tilt, the scatter in the tilt
angles are less, as will be seen in forthcoming sections.

each FP line across the order is plotted in ﬁgure 11 before and
after the correction. The number of lines that show a decrease
in FWHM is determined and the ﬁnesse is calculated. Not all
the FP lines show a decrease in FWHM, especially the lines
at edges, which can show an increase. This is because of low
SNR at the edges due to the non-uniform illumination of the
detector. Hence the correction is not performed effectively at
these regions. The FWHM and ﬁnesse values for the six plotted
orders are tabulated in table 1.

Table 1. Summarised result from tilt correction on HESP
data.

Order
no.

Original
mean
ﬁnesse

Corrected
mean
ﬁnesse

Total
peaks

Peaks
with in-
creased
FWHM

Peaks
with
de-
creased
FWHM

25

26

34

35

44

46

2.161

2.250

2.053

2.057

2.291

2.257

2.175

2.300

2.151

2.115

2.326

2.387

360

355

309

304

254

243

75

45

2

14

11

0

285

310

307

290

243

243

Fig. 9. Tilt angle variation of FP lines across several spectro-
graph orders. The solid black line shows a linear ﬁt to the data,
and the dotted line shows a two sigma clipping boundary.
Any point outside this boundary is rejected as an outlier dur-
ing the ﬁt. The scatter in the plot indicates the low tilt value in
HESP spectra.

Figure 10 shows the uncorrected and corrected orders, plot-
ted along with their similarity and difference image for one
order. Structural Similarity Index (SSIM) is used to determine
the similarity between two images, +1 indicating the most simi-
lar images and -1 indicating the images are very different [35].
SSIM image and difference image are computed between the
original order and corrected order.

Fig. 10. Zoomed in view of one tilt corrected FP spectral or-
der, taken with HESP. Original order is the image before tilt
correction. Corrected order is the image after correction. SSIM
image shows the similarity image, 1 being the parts where the
images are similar. The similarity index for the order shown is
0.987469. The difference image shows the normalized mathe-
matical difference computed between two images, 0 being no
difference regions.

Since HESP does not show any visible tilt, the FWHM of

Fig. 11. Comparison of FWHM of FP lines across an order
before and after tilt correction. Values marked with blues stars
show the FWHM of lines before correction. Values marked
with red circles show the FWHM values of the same lines after
correction.

B. X-shooter

Th-Ar calibration frames have been used to test the tilt correction
algorithm. Unlike FP, Th-Ar does not provide equispaced lines
of uniform intensity, which makes line detection across the order
tricky. The method applies well on high to medium SNR arc
lines. Figure 12 shows the images of uncorrected and corrected
orders, plotted along with their similarity image and difference

0.060.040.020.000.020.040.06Slope in radiansOrder 25Order 26Order 34075015002250CCD row (Pixels)0.060.040.020.000.020.040.06Slope in radiansOrder 35075015002250CCD row (Pixels)Order 44075015002250CCD row (Pixels)Order 463.03.54.04.55.0FWHM (Pixels)Order 253.03.54.04.55.0Order 263.54.04.55.05.56.0Order 34075015002250Peak position (Pixels)3.54.04.55.05.56.0FWHM (Pixels)Order 35075015002250Peak position (Pixels)4.04.55.05.56.0Order 44075015002250Peak position (Pixels)4.04.55.05.56.0Order 46Research Article

Applied Optics

6

image calculated between the original order and the corrected
order.

(a) Order 9:SSIM=0.778193

We have performed the analysis on both blue and red channels of
the spectrograph and data with slit settings of 2", 0.7" and 0.35"
and will be presenting results of all the settings mentioned for
the top, middle and bottom order. Figure 14 shows the corrected
and difference images for the mentioned slit settings of spectra
in the red channel. The tilt in lines before and after correction
is visible in the ﬁgure. Figure 15 shows the slope values before
correction and after correction for spectra with 2" slit width. Fig-
ure 16 shows the corrected slope values for 0.7” slit data. The
corrected slope values for 0.35” slit setting is plotted in ﬁgure
17. All the corrected slope plots are shown for both blue and red
channels.

(b) Order 10: SSIM=0.749655

Fig. 12. Tilt correction of Th-Ar spectra taken with X-Shooter.
(a) Original spectrum before the tilt correction. (b) Th-Ar spec-
trum after tilt correction. (c) SSIM image showing the similar-
ity image. The regions with highest similarity in the images
corresponds to 1. (d) Difference image shows the normalized
mathematical difference computed between two images, 0 be-
ing no difference regions. The similarity index is mentioned
for each order.

X-shooter introduces visible tilts in the spectra, with the tilt
amplitude being ∼ 1.5-2 times the HESP tilt values. Hence
the calculated tilt shows less scatter than in HESP. Figure 13
shows the comparison between the slope values before and after
correction. Most of the outliers in the data coincide with low
SNR lines.

(a) 2" slit width Order 21:SSIM=0.933707

(b) 0.7" slit width Order 21: SSIM=0.946387

(c) 0.35" slit width Order 21: SSIM=0.944193

Fig. 14. Tilt correction of Th-Ar spectra for different slit width
setting of MIKE in red channel. (a) The image of order before
tilt correction. (b) The image of same order after correction.
(c) SSIM image shows the similarity image, 1 being the areas
with maximum similarity. (d) Difference image shows the
normalized mathematical difference computed between two
images, 0 being no difference regions.

Fig. 13. Slope values plotted for the uncorrected (black stars)
Th-Ar lines and the corrected lines (red circles) for X-Shooter.
The uncorrected slope values follow a clear trend. The scatter
arises due to the attempt to calculate slopes of low SNR lines.
The slope of the Th-Ar lines has been reduced after correction,
the only deviation arising around the low SNR lines.

C. MIKE

Since Th-Ar spectra do not share the same properties as FP spec-
tra, only high to medium SNR lines are detected and corrected.

Fig. 15. Slope values plotted for the uncorrected (black stars)
Th-Ar lines and the corrected lines (red circles) for 2" slit set-
ting of MIKE. The uncorrected slope values show a clear trend.
The slope of the Th-Ar lines has been reduced after correc-
tion. The scatter in data is due to the attempt to calculate and
correct for the low SNR lines.

0.100.080.060.040.020.000.02Slope in radiansOrder 8Order 9Order 1001000200030004000Peak position (Pixels)0.100.080.060.040.020.000.02Slope in radiansOrder 1101000200030004000Peak position (Pixels)Order 1201000200030004000Peak position (Pixels)Order 130.150.100.050.000.050.100.15Slope in radiansBlue channelOrder 12Blue channelOrder 18Blue channelOrder 280500100015002000Peak position (Pixels)0.150.100.050.000.050.100.15Slope in radiansRed channelOrder 130500100015002000Peak position (Pixels)Red channelOrder 210500100015002000Peak position (Pixels)Red channelOrder 29Research Article

Applied Optics

7

Figure 18 shows comparison between the FWHM of extracted
Th-Ar lines by MIKE pipeline (lw1) and by the discussed algo-
rithm (lw2). The difference between lw1 and lw2 has also been
plotted, a positive difference obtained when lw1 is greater than
lw2. The values have been calculated for one order of Th-Ar
spectrum obtained in red channel using slit widths of 0.35”, 0.7”
and 2”. For 0.35” and 0.7” slit widths, the pipeline gives 19% ±
7% and 11% ± 4% mean reduction in the FWHM of the Th-Ar
lines respectively. For the same slit widths, the discussed algo-
rithm gives 20% ± 7% and 10% ± 4% mean reduction in the
FWHM respectively.

Fig. 16. Slope values plotted for the uncorrected (black stars)
Th-Ar lines and the corrected lines (red circles) for 0.7" slit
setting of MIKE. The uncorrected slope values show a clear
trend. The slope of the Th-Ar lines has been reduced after
correction. The scatter in data is due to the attempt to calculate
and correct for the low SNR lines.

Fig. 17. Slope values plotted for the uncorrected (black stars)
Th-Ar lines and the corrected lines (red circles) for 0.35" slit
setting of MIKE. The uncorrected slope values show a clear
trend. The slope of the Th-Ar lines has been reduced after
correction. The scatter in data is due to the attempt to calculate
and correct for the low SNR lines.

Fig. 18. Performance of the developed algorithm with respect
to MIKE pipeline. The blue triangles represent the FWHM of
uncorrected tilted lines. The black crosses indicate FWHM of
lines obtained after reduction with MIKE pipeline. The red cir-
cles indicate the FWHM of lines obtained after reduction with
our algorithm. The green stars indicate the FWHM differences
between the MIKE pipeline and our algorithm.

5. SUMMARY

Analysis of the FP spectra acquired through HESP led us to
the observation of discrepancies between the expected FP line
FWHM (obtained with FTS) and the FWHM of the lines obtained
with the spectrograph. This motivated us to examine the factors
that can cause the increase in line-width. Performance of the
FP degrades over the years due to deterioration of the optical
coating. An additional reason for the increase in line-width was
found to be the tilt in the FP lines, caused due to curvature in
the orders. The HESP design does not introduce any signiﬁcant
tilt in the data. Hence it is not visually discernible in the spectra.
Although the amount of the tilt is small, it is important to take
care of this artifact in post-processing in order to maintain the
performance of FP.

Tilted lines in echelle spectra are artifacts often introduced by
the curvature in spectra or due to the design of the spectrograph
itself. It is essential to eliminate this artifact in order to avoid the
introduction of any errors in the data while post-processing. A
possible way is to avoid binning the data and analyzing the ﬂux
at a single-pixel location. However, this technique will result in
lesser ﬂux values and hence less SNR in the data. Binning the 2D

0.100.050.000.050.10Slope in radiansBlue channelOrder 12Blue channelOrder 19Blue channelOrder 280500100015002000Peak position (Pixels)0.100.050.000.050.10Slope in radiansRed channelOrder 110500100015002000Peak position (Pixels)Red channelOrder 200500100015002000Peak position (Pixels)Red channelOrder 280.100.050.000.050.10Slope in radiansBlue channelOrder 10Blue channelOrder 19Blue channelOrder 270500100015002000Peak position (Pixels)0.100.050.000.050.10Slope in radiansRed channelOrder 130500100015002000Peak position (Pixels)Red channelOrder 210500100015002000Peak position (Pixels)Red channelOrder 290123Slit width 0.35"0123Slit width 0.7"02505007501000125015001750CCD row pixel0246Slit width 2"FWHM (pixel)Research Article

Applied Optics

8

spectrum in the usual way is done vertically, i.e. along the slit di-
rection. When a tilted line is binned vertically, it results in wrong
ﬂux values at each binned pixel as well as a decrease in spectral
resolution due to broadening of the line, and hence wrong wave-
length when the ﬁnal calibration is performed. The tilt is not
constant and varies as a function of wavelength across the spec-
tra. This also affects the accuracy with which we can determine
the centroid positions of spectral lines, which is crucial in the
case of high precision RV studies. To avert the miscalculations
arising from binning a tilted line vertically, either the binning
could be performed along an oblique axis or a simpler way is to
ﬁnd out the obliquity of each spectral line and correct for it. We
employ the latter method to remove the tilt by automating the
detection of each spectral line, computing the line’s slant, and
then compensating for it, so that the standard post-processing
techniques can be applied as usual.

We present in this paper a simple algorithm for curvature
and tilt correction in high-resolution spectra. The algorithm
is written in Python and uses image processing techniques for
ﬁnding individual line slant values and correcting for them. We
have demonstrated the algorithm on FP calibration spectra from
HESP. A total of 6624 FP lines were detected across 22 orders,
and a reduction in FWHM of 5417 lines was observed after using
the tilt correction algorithm along with an overall improvement
in the ﬁnesse value from 2.167 to 2.208. In order to ascertain
the capability of the algorithm, we looked into spectrographs
with highly tilted lines and performed the tilt corrections on the
Th-Ar calibration spectra from X-shooter and MIKE. We noticed
visual improvement in tilts of the lines after the application of the
algorithm. We also calculated the tilt values of each line before
and after correction and found a reduction in the absolute value
of the slope after correction, thereby indicating the efﬁcacy of
the algorithm. The main limitation of the algorithm is the ability
to deal with low SNR/faint lines (SNR<6) and blended lines in
Th-Ar spectra since it has been developed, keeping in mind the
uniform line density provided by FP or LFC. We are looking into
it as part of a future upgrade. Authors can be contacted to avail
the code.

Funding. This project is supported by Science and Engineering Re-
search Board (SERB), Department of Science and Technology (DST),
India, under grant no. EMR/2014/000941.

Acknowledgments. The authors want to acknowledge Mr S. Sriram
for the advice and technical support provided by him. The authors also
thank Dr. Martin Dubs for his help and suggestions and Dr. Rebecca
Bernstein for providing us with MIKE data. X-shooter study is based
on data obtained from the ESO Science Archive Facility under request
number 609319.

Disclosures. The authors declare no conﬂicts of interest.

Data Availability Statement. Data underlying the results pre-
sented in this paper for X-shooter are publicly available on ESO Archive.
The data for HESP and MIKE is not publicly available at this time but
may be obtained from the authors upon reasonable request.

REFERENCES

1.

2.

N. R. Napolitano, A. J. Romanowsky, and C. Tortora, “The central dark
matter content of early-type galaxies: scaling relations and connections
with star formation histories,” Mon. Notices Royal Astron. Soc. 405,
2351–2371 (2010).
D. D. Kelson, G. D. Illingworth, P. G. van Dokkum, and M. Franx, “The
evolution of early-type galaxies in distant clusters iii M/Lv ratios in the
z=0.33 cluster cl 1358+62,” The Astrophys. J. 531, 184–199 (2000).

3.

4.

5.

6.

A. Bik, T. Henning, A. Stolte, W. Brandner, D. A. Gouliermis,
M. Gennaro, A. Pasquali, B. Rochau, H. Beuther, N. Ageorges,
W. Seifert, Y. Wang, and N. Kudryavtseva, “AGE SPREAD IN w3
MAIN: LARGE BINOCULAR TELESCOPE/LUCI NEAR-INFRARED
SPECTROSCOPY OF THE MASSIVE STELLAR CONTENT,” The
Astrophys. J. 744, 87 (2011).
A. Bhowmick, G. Pandey, and D. L. Lambert, “Detection of Fluorine in
Hot Extreme Helium Stars,” The Astrophys. J. 891, 40 (2020).
A. P. Hatzes, “The radial velocity method for the detection of exoplan-
ets,” in Methods of Detecting Exoplanets: 1st Advanced School on
Exoplanetary Science, V. Bozza, L. Mancini, and A. Sozzetti, eds.
(Springer International publishing, 2016).
F. Wildi, F. Pepe, B. Chazelas, G. L. Curto, and C. Lovis, “A Fabry-Perot
calibrator of the HARPS radial velocity spectrograph: performance re-
port,” in Ground-based and Airborne Instrumentation for Astronomy III,
vol. 7735International Society for Optics and Photonics (SPIE, 2010),
pp. 1853 – 1863.

7. G. W. Marcy and R. P. Butler, “Precision radial velocities with an iodine

absorption cell,” Publ. Astron. Soc. Pac. 104, 270 (1992).

8. M. T. Murphy, T. Udem, R. Holzwarth, A. Sizmann, L. Pasquini,
C. Araujo-Hauck, H. Dekker, S. D’Odorico, M. Fischer, T. W. Hänsch,
and A. Manescau, “High-precision wavelength calibration of astronom-
ical spectrographs with laser frequency combs,” Mon. Notices Royal
Astron. Soc. 380, 839–847 (2007).
S. Chamarthi, R. K. Banyal, S. Sriram, and G. Pandey, “Stability anal-
ysis of vbt echelle spectrograph for precise radial velocity measure-
ments,” J. Opt. 47, 195–201 (2018).

9.

10. L. B. Robinson and D. W. Latham, “Present and future the ninth santa
cruz summer workshop in astronomy and astrophysics, july 13–july 24,
1987, lick observatory,” in Instrumentation for Ground-Based Optical
Astronomy, L. B. Robinson, ed. (Springer-Verlag New York, 1988).
11. M. J. Ireland, M. White, J. P. Bento, T. Farrell, K. Labrie, L. Luvaul, J. G.
Nielsen, and C. Simpson, “Data reduction software for the Gemini high
resolution optical spectrograph,” in Software and Cyberinfrastructure for
Astronomy V, vol. 10707 J. C. Guzman and J. Ibsen, eds., International
Society for Optics and Photonics (SPIE, 2018), pp. 864 – 873.

12. T. Das, R. K. Banyal, S. Kathiravan, T. Sivarani, and R. B., “Devel-
opment of a stabilized Fabry-Perot based wavelength calibrator for
precision Doppler spectroscopy,” in Ground-based and Airborne Instru-
mentation for Astronomy VII, vol. 10702International Society for Optics
and Photonics (SPIE, 2018), pp. 1899 – 1909.

13. R. Bernstein, S. A. Shectman, S. M. Gunnels, S. Mochnacki, and
A. E. Athey, “MIKE: a double-echelle spectrograph for the Magellan
Telescopes at Las Campanas Observatory,” in Instrument Design and
Performance for Optical/Infrared Ground-based Telescopes, vol. 4841
M. Iye and A. F. M. Moorwood, eds., International Society for Optics
and Photonics (SPIE, 2003), pp. 1694 – 1704.

14. S. D’Odorico, H. Dekker, R. Mazzoleni, J. Vernet, I. Guinouard, P. Groot,
F. Hammer, P. K. Rasmussen, L. Kaper, R. Navarro, R. Pallavicini,
C. Peroux, and F. M. Zerbi, “X-shooter UV- to K-band intermediate-
resolution high-efﬁciency spectrograph for the VLT: status report at the
ﬁnal design review,” in Ground-based and Airborne Instrumentation
for Astronomy, vol. 6269International Society for Optics and Photonics
(SPIE), pp. 993 – 1002.

15. D. Tody, “The IRAF Data Reduction and Analysis System,” in Instru-
mentation in astronomy VI, vol. 627 of Society of Photo-Optical Instru-
mentation Engineers (SPIE) Conference Series D. L. Crawford, ed.
(1986), p. 733.

16. D. Tody, “IRAF in the Nineties,” in Astronomical Data Analysis Software
and Systems II, vol. 52 of Astronomical Society of the Paciﬁc Confer-
ence Series R. J. Hanisch, R. J. V. Brissenden, and J. Barnes, eds.
(1993), p. 173.

17. Vernet, J., Dekker, H., D´Odorico, S., Kaper, L., Kjaergaard, P., Ham-
mer, F., Randich, S., Zerbi, F., Groot, P. J., Hjorth, J., Guinouard, I.,
Navarro, R., Adolfse, T., Albers, P. W., Amans, J.-P., Andersen, J.
J., Andersen, M. I., Binetruy, P., Bristow, P., Castillo, R., Chemla, F.,
Christensen, L., Conconi, P., Conzelmann, R., Dam, J., De Caprio, V.,
De Ugarte Postigo, A., Delabre, B., Di Marcantonio, P., Downing, M.,

Research Article

Applied Optics

9

33. M. Dubs and P. Schlatter, “A practical method for the analysis of meteor

spectra,” WGN, J. Int. Meteor Organ. 43, 94–101 (2015).

34. M. Dubs and K. Maeda, “Calibration of meteor spectra,” in Interna-
tional Meteor Conference Egmond, the Netherlands, 2-5 June 2016,
A. Roggemans and P. Roggemans, eds. (2016), p. 65.

35. Z. Wang, A. Bovik, H. Sheikh, and E. Simoncelli, “Image quality assess-
ment: from error visibility to structural similarity,” IEEE Transactions on
Image Process. 13, 600–612 (2004).

Elswijk, E., Finger, G., Fischer, G., Flores, H., François, P., Goldoni,
P., Guglielmi, L., Haigron, R., Hanenburg, H., Hendriks, I., Horrobin,
M., Horville, D., Jessen, N. C., Kerber, F., Kern, L., Kiekebusch, M.,
Kleszcz, P., Klougart, J., Kragt, J., Larsen, H. H., Lizon, J.-L., Lucuix,
C., Mainieri, V., Manuputy, R., Martayan, C., Mason, E., Mazzoleni, R.,
Michaelsen, N., Modigliani, A., Moehler, S., Møller, P., Norup Sørensen,
A., Nørregaard, P., Péroux, C., Patat, F., Pena, E., Pragt, J., Reinero,
C., Rigal, F., Riva, M., Roelfsema, R., Royer, F., Sacco, G., Santin,
P., Schoenmaker, T., Spano, P., Sweers, E., Ter Horst, R., Tintori,
M., Tromp, N., van Dael, P., van der Vliet, H., Venema, L., Vidali, M.,
Vinther, J., Vola, P., Winters, R., Wistisen, D., Wulterkens, G., and
Zacchei, A., “X-shooter, the new wide band intermediate resolution
spectrograph at the eso very large telescope,” A & A 536, A105 (2011).
18. P. Goldoni, F. Royer, P. François, M. Horrobin, G. Blanc, J. Vernet,
A. Modigliani, and J. Larsen, “Data reduction software of the X-shooter
spectrograph,” in Ground-based and Airborne Instrumentation for As-
tronomy, vol. 6269 I. S. McLean and M. Iye, eds., International Society
for Optics and Photonics (SPIE, 2006), pp. 822 – 832.

19. P. Goldoni, F. Royer, M. Horrobin, P. François, L. Guglielmi, R. Haigron,
J. Vernet, A. Modigliani, and P. Bristow, “Results of X-shooter data re-
duction software on laboratory frames,” in Ground-based and Airborne
Instrumentation for Astronomy II, vol. 7014 I. S. McLean and M. M.
Casali, eds., International Society for Optics and Photonics (SPIE,
2008), pp. 2004 – 2014.

20. A. Modigliani, P. Goldoni, F. Royer, R. Haigron, L. Guglielmi, P. François,
M. Horrobin, P. Bristow, J. Vernet, S. Moehler, F. Kerber, P. Ballester,
E. Mason, and L. Christensen, “The X-shooter pipeline,” in Observa-
tory Operations: Strategies, Processes, and Systems III, vol. 7737 of
Society of Photo-Optical Instrumentation Engineers (SPIE) Conference
Series D. R. Silva, A. B. Peck, and B. T. Soifer, eds. (2010), p. 773728.
21. R. M. Bernstein, S. M. Burles, and J. X. Prochaska, “Data reduction
with the MIKE spectrometer,” Publ. Astron. Soc. Pac. 127, 911–930
(2015).

22. J. J. Bochanski, J. F. Hennawi, R. A. Simcoe, J. X. Prochaska, A. A.
West, A. J. Burgasser, S. M. Burles, R. A. Bernstein, C. L. Williams,
and M. T. Murphy, “MASE: A New Data-Reduction Pipeline for the
Magellan Echellette Spectrograph,” Publ. Astron. Soc. Pac. 121, 1409
(2009).

23. N. Piskunov, A. Wehrhahn, and T. Marquart, “Optimal extraction of
echelle spectra: Getting the most out of observations,” A@AND@A
646, A32 (2021).

24. Piskunov, N. E. and Valenti, J. A., “New algorithms for reducing cross-
dispersed echelle spectra*,” A@AND@A 385, 1095–1106 (2002).
25. S. Sriram, A. Kumar, A. Surya, T. Sivarani, S. Giridhar, S. Kathiravan,
M. N. Anand, D. Jones, D. Grobler, R. Jakobsson, A. Chanumolu,
A. Unni, A. Dorje, T. Dorje, and T. Gyalson, “Hanle echelle spectrograph:
design and performance,” in Proc. SPIE, vol. 10702 (2018), pp. 2007 –
2021.

26. T. Das, R. K. Banyal, T. Sivarani, and B. Ravindra, “Development
of a stabilized fabry–perot etalon based calibrator for hanle echelle
spectrograph,” Appl. Opt. 59, 5464–5472 (2020).

27. T. Das, R. K. Banyal, T. Sivarani, and S. Sriram, “Using a passively
stabilized Fabry-Perot etalon for determining instrumental artifacts in
a spectrograph,” in Ground-based and Airborne Instrumentation for
Astronomy VIII, vol. 11447 C. J. Evans, J. J. Bryant, and K. Motohara,
eds., International Society for Optics and Photonics (SPIE, 2020), pp.
901 – 911.

28. S. Van der Walt, J. L. Schönberger, J. Nunez-Iglesias, F. Boulogne,
J. D. Warner, N. Yager, E. Gouillart, and T. Yu, “scikit-image: image
processing in python,” PeerJ 2, e453 (2014).

29. G. Bradski, “The OpenCV Library,” Dr. Dobb’s J. Softw. Tools (2000).
“Ceres: A set of automated routines for echelle spectra,” Publ. Astron.
30.
Soc. Pac. 129, 1–18 (2017).

31. T. Zhou and M.-J. Lai, “Scattered data interpolation by bivariate splines
with higher approximation order,” J. Comput. Appl. Math. 242, 125 –
140 (2013).

32. J. Canny, “A computational approach to edge detection,” IEEE Trans-
actions on Pattern Analysis Mach. Intell. PAMI-8, 679–698 (1986).

