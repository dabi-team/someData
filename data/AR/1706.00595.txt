DRAFT VERSION NOVEMBER 5, 2018
Preprint typeset using LATEX style emulateapj v. 12/16/11

7
1
0
2

n
u
J

2

]

R
S
.
h
p
-
o
r
t
s
a
[

1
v
5
9
5
0
0
.
6
0
7
1
:
v
i
X
r
a

COMPARISON OF TWO CORONAL MAGNETIC FIELD MODELS FOR RECONSTRUCTING A SIGMOIDAL SOLAR
ACTIVE REGION WITH CORONAL LOOPS

AIYING DUAN 1,2,4, CHAOWEI JIANG 3,2,4, QIANG HU 4,5, HUAI ZHANG 1, G. ALLEN GARY 4, S. T. WU 4, JINBIN CAO 6
Draft version November 5, 2018

ABSTRACT
Magnetic ﬁeld extrapolation is an important tool to study the three-dimensional (3D) solar coronal magnetic
ﬁeld which is difﬁcult to directly measure. Various analytic models and numerical codes exist but their results
often drastically differ. Thus a critical comparison of the modeled magnetic ﬁeld lines with the observed
coronal loops is strongly required to establish the credibility of the model. Here we compare two different
non-potential extrapolation codes, a non-linear force-free ﬁeld code (CESE–MHD–NLFFF) and a non-force-
free ﬁeld (NFFF) code in modeling a solar active region (AR) that has a sigmoidal conﬁguration just before a
major ﬂare erupted from the region. A 2D coronal-loop tracing and ﬁtting method is employed to study the 3D
misalignment angles between the extrapolated magnetic ﬁeld lines and the EUV loops as imaged by SDO/AIA.
It is found that the CESE–MHD–NLFFF code with preprocessed magnetogram performs the best, outputting
a ﬁeld which matches the coronal loops in the AR core imaged in AIA 94 Å with a misalignment angle of
∼ 10◦. This suggests that the CESE–MHD–NLFFF code, even without using the information of coronal loops
in constraining the magnetic ﬁeld, performs as good as some coronal-loop forward-ﬁtting models. For the loops
as imaged by AIA 171 Å in the outskirts of the AR, all the codes including the potential-ﬁeld give comparable
results of mean misalignment angle (∼ 30◦). Thus further improvement of the codes is needed for a better
reconstruction of the long loops enveloping the core region.
Subject headings: Magnetic ﬁelds; Magnetohydrodynamics (MHD); Methods: numerical; Sun: corona; Sun:

ﬂares

1. INTRODUCTION
The observed solar explosive events (e.g., ﬂares and coronal
mass ejections) within the corona is attributed to an energy re-
lease in the coronal magnetic ﬁeld. Hence understanding the
dynamics and physics of these eruptions is centered on under-
standing the structure and evolution of the magnetic ﬁeld. The
coronal ﬁeld can evolve from reconnection and photospheric
variations. However, direct measurement of the coronal mag-
netic ﬁeld from emissions of the extremely tenuous plasma
of the corona by spectropolarimetric methods still proves to
be difﬁcult (Lin et al. 2004; Lin 2016). Currently, the routine
measurement of solar magnetic ﬁeld that we can rely on is
restricted to only a single layer of solar surface, i.e., the pho-
tosphere. Most recently, chromospheric polarimetry is begin-
ning to show promising results, however the height of forma-
tion is problematic (Quintero et al. 2017).

Due to the lack of measurement data, the three-dimensional
magnetic ﬁeld in the solar corona is usually “extrapolated” or
“reconstructed” in numerical ways from the photosphere sur-
face data based on particular assumptions or models. Such
techniques of modeling the coronal magnetic ﬁeld have been
developed (e.g., see review papers of Sakurai 1989; Mc-

duanaiying@ucas.ac.cn, hzhang@ucas.ac.cn, chaowei@hit.edu.cn

1 Key Laboratory of Computational Geodynamics, University of Chi-

nese Academy of Sciences, Beijing 100049, China

2 SIGMA Weather Group, State Key Laboratory for Space Weather,
National Space Science Center, Chinese Academy of Sciences, Beijing
100190, China

3 HIT Institute of Space Science and Applied Technology, Shenzhen,

518055, China

4 Center for Space Plasma and Aeronomic Research, The University of

Alabama in Huntsville, Huntsville, AL 35899, USA

5 Department of Space Science, The University of Alabama in

Huntsville, Huntsville, AL 35899, USA

6 School of Space and Environment, Beihang University, Beijing

100191, China

Clymont et al. 1997; Solanki et al. 2006; Wiegelmann 2008;
Wiegelmann & Sakurai 2012; Régnier 2013). Three mag-
netic ﬁeld models often used include the potential ﬁeld, lin-
ear force-free ﬁeld (LFFF), and nonlinear force-free ﬁeld
(NLFFF). All these models are derived from a basic as-
sumption that the Lorentz force in the corona vanishes in
the case of extremely low plasma β (β is the ratio of the
plasma pressure to the magnetic pressure) and quasi-static
equilibrium of the coronal ﬁeld. Consequently the electric
current J = ∇ × B must be parallel to the magnetic ﬁeld,
i.e., J = αB where α is called the force-free parameter.
In
the potential ﬁeld model, α = 0; in the LFFF, α is a con-
stant; and in the NLFFF, α is variable in space. The earliest
models were based on potential ﬁeld (Altschuler & Newkirk
1969; Sakurai 1982) and LFFF (Seehafer 1978) that are ex-
trapolated from only the data of line-of-sight (LoS) com-
ponent of the photospheric ﬁeld since the transverse com-
ponents were not measured. Now both the LoS and trans-
verse components of the photospheric magnetic ﬁeld can be
measured (e.g., Hoeksema et al. 2014) and information of
the electric current passing through the photosphere can de-
rived. Nonlinear force-free ﬁeld (NLFFF) reconstructions,
which are based on the vector magnetograms, are more ro-
bust than those earlier models, and employ several numeri-
cal schemes (Sakurai 1981; Yang et al. 1986; Wu et al. 1990;
Amari et al. 1997; Yan & Sakurai 2000; He & Wang 2006;
Wiegelmann & Neukirch 2006; Wheatland 2006; Valori et al.
2010; Jiang & Feng 2012a). Existing NLFFF codes include
the optimization method (Wheatland et al. 2000; Wiegelmann
2004; Wiegelmann & Neukirch 2006; Wiegelmann 2008),
the magneto-frictional method (Valori et al. 2007, 2010; Guo
et al. 2016), the Grad-Rubin method (Amari et al. 2006;
Wheatland 2007; Amari et al. 2014), and the MHD-relaxation
code based on conservation-element/solution-element space-

 
 
 
 
 
 
2

Duan et al.

time scheme (CESE-MHD-NLFFF: Jiang et al. 2011; Jiang
& Feng 2012a, 2013). Now NLFFF models are widely used
in the solar physics community for exploring the 3D coro-
nal structure prior to and post solar eruptions and for under-
standing the inﬂuence of the magnetic topology on solar erup-
tions (e.g., Guo et al. 2008; Sun et al. 2012; Jiang et al. 2013;
Cheng et al. 2014; Liu et al. 2014; Xue et al. 2016).

An alternative to NLFFF extrapolation is an approach based
on a magnetic ﬁeld model of the corona derived from the vari-
ational principle of minimum energy dissipation rate (Hu &
Dasgupta 2008; Hu et al. 2008, 2010). The formula govern-
ing the coronal magnetic ﬁeld is more complex, and the solu-
tion, expressed as the superposition of three LFFFs (one being
potential), is in general not force-free. Such a non-force-free
ﬁeld (NFFF) extrapolation was presented in Hu & Dasgupta
(2008) and was shown to be applicable to NLFFF conﬁgura-
tion given by Low & Lou (1990) analytic solutions. It was
also tested on numerical MHD simulation data for an active
region (Hu et al. 2008). Later it was further developed for
practical applications to photospheric vector magnetograms
obtained within an active region (Hu et al. 2010). The im-
plementation of the algorithm is relatively simple and the full
code written in Interactive Data Language (IDL) can handle
the magnetograms of 1024×1024 pixels on a desktop PC.
However extensive testing and application of the NFFF al-
gorithm have yet to be performed.

A critical assessment of the reliability of coronal magnetic-
ﬁeld extrapolation modeling is to examine the goodness-of-
matching of the geometry of the simulated magnetic ﬁeld
lines with that of the observed EUV coronal loops. This is
because the plasma emission in the corona reﬂects the geom-
etry of the invisible magnetic ﬁeld, as in most parts of the
corona the plasma is “frozen” with the magnetic ﬁelds. While
earlier studies compared theoretical models with observed im-
ages in a rather qualitative way, recent studies go into quanti-
tative measurements of the agreement between modeled ﬁeld
lines and observed coronal loop geometries. In an assessment
of a variety of popular NLFFF codes for modeling AR 10953,
DeRosa et al. (2009) compared the model ﬁeld lines to 3D
trajectories of coronal loops, which are observed stereoscop-
ically by the twin Solar Terrestrial Relations Observatory
(STEREO) spacecraft (Aschwanden et al. 2008). It was found
that the misalignment angle between the ﬁeld lines and the
loops amounts to rather large values of 24◦–44◦, and unex-
pectedly, none of the examined NLFFF models improved sig-
niﬁcantly upon the value found for the potential ﬁeld model.
Another method employs a slight variation by measuring the
distance between a loop and a projected ﬁeld line (Chae &
Moon 2005; Lim et al. 2007; Malanushenko et al. 2011). The
same idea of a “distance” has also been used in 3D, with
STEREO data (Wiegelmann & Neukirch 2002). Without trac-
ing the trajectories of coronal loops, Wiegelmann et al. (2012)
compared the model ﬁeld lines with SDO/AIA images by cal-
culating the sum of gradient of the AIA image intensity along
each projected ﬁeld lines, and the result is assumed to reach
its minimum if all the ﬁeld lines are co-aligned with the corre-
sponding loops. The LFFF parameter α, derived from visual
ﬁt to loops has been compared to that derived from a vector
magnetogram (Burnette et al. 2004) providing an additional
goodness metric.

Recently, Gary et al. (2014b) developed a new method of
deriving the 3D structure of observed 2D coronal loops inde-
pendent of heliostereoscopy, and suggested that it can deter-
mine the matching of extrapolated magnetic ﬁelds with coro-

nal loops.
In that method, an automated loop recognition
scheme (OCCULT-2, Aschwanden et al. 2013) is ﬁrst used
to extract 2D loop structures from EUV images and then the
extracted loops are ﬁtted with 2D cubic Bézier splines that are
based on 4 control points (Gary et al. 2014a). The 2D splines
are further extended to 3D with the heights of all 4 control
points set as free parameters. The heights are determined by
minimizing the misalignment angles of the 3D splines with
ﬁeld lines of a given model of coronal magnetic ﬁeld, and the
resulting 3D splines are regarded as the trajectories of the cor-
responding coronal loops in 3D. So the image of these loops
represents a 2D projection of these 3D structures. Naturally,
different magnetic ﬁeld models will result in different sets of
misalignment angles, and a perfect matching model can pre-
sumably yield a misalignment angle of zero. Thus this method
provides a powerful tool of comparing different magnetic-
ﬁeld models of the corona by using EUV images obtained
from one single viewpoint.

Other coronal magnetic ﬁeld models with forward ﬁtting
of coronal loops has been developed for better reproducing
the geometry of the loops (Malanushenko et al. 2012, 2014;
Aschwanden 2013a,b). For instance, unlike the traditional
NLFFF codes that extrapolate the coronal ﬁeld from the vec-
tor ﬁeld at the photosphere, the coronal-loop forward-ﬁtting
quasi-NLFFF models of Aschwanden (2013a) use only the
LoS magnetic ﬁeld component and the non-potentiality of the
ﬁeld (characterized by the force-free parameter α) is deter-
mined by minimization of misalignment of the ﬁeld lines with
the traced loops from observed images. Aschwanden (2013b)
shows that their code can be applied to either 3D loops deter-
mined stereoscopically or simply 2D from LoS observations.
In the latter case, the 3D height of the loops is used as a free
parameter and a 2D misalignment angle is minimized. The
forward-ﬁtting method strongly depends on the recognition of
coronal loops from the image, which has been automated by
Aschwanden et al. (2013). We should note that even in such
forward-ﬁtting of the coronal loops, the misalignment angles
of the ﬁeld line with the loops are signiﬁcant. For example,
the misalignment angle resulted in Aschwanden (2013b) is
about 20◦ in the forward-ﬁtting of TRACE loops.

In this paper, we will evaluate our extrapolation results from
the NLFFF (CESE–MHD–NLFFF) and the NFFF codes, by
introducing a critical comparison of the modelled magnetic
ﬁeld lines with the coronal loop geometry. In particular, we
will employ Gary et al. (2014b)’s method to compute the mis-
alignment angles of the model ﬁeld lines and identiﬁed loops.
The target region used in this examination is AR 12158 prior
to its major eruption on 2014 September 10, which exhibits a
well-shaped sigmoid that indicates a non-potential ﬁeld. Em-
ploying the SDO AIA 94 Angstroms images, we ﬁnd that one
NLFFF solution ﬁts the best (misalignment angle of ∼ 10◦)
the AR core loops, but not so well the loops that correspond to
large overlying ﬁeld lines (misalignment angle of ∼ 30◦) near
the side boundaries. Our results are similar to those of DeRosa
et al. (2009). In addition to the comparison of ﬁeld lines with
coronal loops, we also evaluate quantitatively the extrapolated
ﬁelds by other means including the magnetic energy, helic-
ity contents, magnetic twist and squashing degree (Demoulin
et al. 1996; Titov et al. 2002). The paper is organized as fol-
lows. We ﬁrst brieﬂy describe the CESE–MHD–NLFFF code
and the NFFF code in Sections 2 and 3, respectively. Then
in Section 4 we give a short review of the coronal loop trac-
ing and ﬁtting method developed by Gary et al. (2014b). The
results of assessing the extrapolated coronal magnetic ﬁelds

Comparison of Coronal Magnetic Field Models

3

for AR 12158 are given in Section 5, and ﬁnally discussions
appear in Section 6.

2. THE CESE–MHD–NLFFF CODE
The CESE–MHD–NLFFF code (Jiang & Feng 2013) be-
longs to the class of MHD relaxation methods. It solves a set
of modiﬁed zero-β MHD equations with frictional force using
an advanced conservation-element/solution-element (CESE)
spacetime scheme on an non-uniform grid with parallel com-
puting (Jiang et al. 2010). The modiﬁed MHD equations are
written as
∂ρv
∂t

= (∇ × B) × B − νρv, ρ = |B|2,

= ∇ × (v × B)(1)

∂B
∂t

where ν is the frictional coefﬁcient. The initial condition
for the computation sequence is a potential ﬁeld extrapolated
from the vertical component of the vector magnetogram. To
drive the evolution of the ﬁeld, we change the horizontal mag-
netic components at the bottom boundary gradually until they
match the vector magnetogram, after which the system will
be relaxed to a new equilibrium. Details of this code can
be found in (Jiang & Feng 2012a; Jiang et al. 2012).
It is
well tested by different benchmarks including the Low & Lou
(1990)’s analytic force-free solutions and the Titov & Dé-
moulin (1999)’s magnetic ﬂux rope model, and recently ap-
plied to the SDO/HMI vector magnetograms (Jiang & Feng
2013; Jiang et al. 2014). Here we use the code in exactly the
same way as Jiang & Feng (2013), without any parameter op-
timization for the present modeling.

Unlike the coronal ﬁeld, the photospheric ﬁeld is not nec-
essarily force-free because of much higher plasma β, thus it
is usually required to remove the Lorentz force in the vector
magnetogram for a boundary ﬁeld consistent with the force-
free assumption of NLFFF extrapolations (Wiegelmann &
Neukirch 2006). Meanwhile, smoothing of original magne-
togram is needed to reduce the data noise and smooth the
very small-scale structures that cannot be properly resolved
by the discretized grid. Such process of removing force and
smoothing is called preprocessing and here we use the pre-
processing code developed by Jiang & Feng (2014). Differ-
ent from other preprocessing codes (Wiegelmann & Neukirch
2006; Fuhrmann et al. 2007, 2011), this code is unique in
that it splits the vector magnetogram into a potential ﬁeld part
and a non-potential ﬁeld part and handles the two parts sep-
arately. The potential part, as it is already force-free, only
needs smoothing, which is simply performed by taking the
data sliced at a plane one pixel (of an HMI magnetogram)
above the photosphere from the 3D extrapolated potential
ﬁeld. Then the non-potential part is modiﬁed and smoothed
by an optimization method to fulﬁll the constraints of total
magnetic force-freeness and torque-freeness. One advantage
of using such a splitting is that the preprocessing of the non-
potential ﬁeld part can be guided by the extents of force-
freeness and smoothness of the smoothed potential-ﬁeld part.
This is because in the practical computation, particular atten-
tion needs to be paid on what extent the force needs to be
removed and the smoothing can be performed. In practical
computation based on numerical discretization, an accurate
satisfaction of force-free constraints is apparently not neces-
sary. Also the extent of the smoothing for the data needs to
be carefully determined, if we want to mimic the expansion
of the magnetic ﬁeld from the photosphere to some speciﬁc
heights. Over-smoothing of the data may smear the basic
structures while insufﬁcient smoothing cannot ﬁlter the small-

scale noise sufﬁciently. A careful choice of the weighting fac-
tors µ is required to deal with these problems. In Jiang & Feng
(2014) the values of force-freeness and smoothness calculated
from the preprocessed potential-ﬁeld part are used as a refer-
ence, and the target magnetogram is required to have the same
level of force-freeness and smoothness as its potential part in
numerical precision. It is found that these requirements can
restrict well the free parameters, i.e., the weighting factors µ
in the optimization function.

3. THE NON-FORCE-FREE EXTRAPOLATION CODE
The non-force-free ﬁeld is governed by the following equa-

tion (Hu & Dasgupta 2008; Hu et al. 2010):

∇ × ∇ × ∇ × B + a∇ × ∇ × B + b∇ × B = 0.

(2)

One solution is written B = B1 + B2 + B3, where each sub-ﬁeld
Bi satisﬁes the standard LFFF equation with distinct parame-
ters αi, i = 1, 2, 3, such that a = −(α1 + α3) and b = α1α3. To
obtain a solution of this form, taking advantage of the rela-
tively simple solutions to LFFFs, it turns out that α2 = 0, and
α1 (cid:54)= α3 (cid:54)= 0. Therefore, one of the sub-ﬁelds, B2, becomes
potential ﬁeld solution for the boundary conditions.

For completeness, we give below a brief description of the
algorithm of deriving an NFFF solution to equation (2) via the
superposition of three LFFFs of distinct α parameters. It can
be shown that the result is the following equation,

(cid:32) B1
B2
B3

(cid:33)

(cid:32)

= V −1

B
∇ × B
∇ × ∇ × B

(cid:33)

.

(3)

j

Here the matrix V is composed of elements αi−1
, i, j = 1, 2, 3,
which is a Vandermonde matrix and is guaranteed invertible
as long as the α’s are distinct (Hu & Dasgupta 2008). There-
fore each LFF sub-ﬁeld can be solved for the known α pa-
rameter, and the given normal boundary condition by using a
standard LFFF solver (Alissandrakis 1981). Ideally the bot-
tom boundary condition, as given by the right-hand side of
Equation (3), has to be derived by utilizing two or more than
two layers of vector magnetograms since the vertical gradient
as well as the transverse gradients of magnetic ﬁeld have to be
calculated. If multiple layer vector magnetograms are avail-
able, then the right-hand side of Equation (3) can provide the
boundary conditions (vertical components) for each sub-ﬁeld,
given known α parameters. So the optimal pair of (α1, α3) pa-
rameters, while keeping α2 ≡ 0, is determined by a trial-and-
error process by ﬁnding a pair which minimizes the average
deviation between the observed (Bt) and the calculated (bt)
transverse ﬁeld, as indicated by the following metric (Hu &
Dasgupta 2008):

En =

M
(cid:88)

i=1

|Bt,i − bt,i|/

M
(cid:88)

i=1

|Bt,i|.

(4)

However, since most vector magnetograms are only available
on the photosphere, which only allows for an evaluation of
(∇ × B)z, the boundary conditions for each sub-ﬁeld cannot
be provided by the third-order system of Equation (3). An al-
gorithm was devised by Hu et al. (2010) to work with the sin-
gle layer vector magnetogram by adding an additional round
of iteration over successive correction to the potential sub-
ﬁeld B2. Starting with an initial guess, e.g., the simplest be-
ing B2 = 0, the system of Equation (3) is reduced to 2nd-order
which allows for the determination of boundary conditions

4

Duan et al.

for B1 and B3, and thus the normal trial-and-error process as
If the resulting minimum En value is not
described above.
satisfactory, then a corrector potential ﬁeld to B2 is derived
from the difference transverse ﬁeld, i.e., Bt − bt, and added to
the previous B2, in anticipation of improved match between
the transverse ﬁelds, as measured by En. The positive effect
of such successive corrections is generally demonstrated by a
monotonic decrease in En from an initial value around 1.0 to
less than 0.3, after 10,000 steps (Hu et al. 2010).

The algorithm relies on the implementation of fast calcu-
lations of the LFFFs including the potential ﬁeld, such as
the classic algorithm of Alessandrakis via Fast Fourier Trans-
form (FFT) for an active region in a Cartesian box with peri-
odic boundary conditions. It is highly desirable to extend the
scheme to the whole solar sphere, by taking advantage of the
recently developed fast algorithm of Jiang & Feng (2012b)
for global LFFF (including potential) extrapolation based on
FFT as well. This extension also overcomes the limitation of
ﬂux imbalance intrinsic to the LFFF within a ﬁnite AR. This
would contribute to the errors in our current NFFF extrapola-
tion of AR magnetic ﬁeld, which is based on LFFF solutions.

4. CORONAL LOOP TRACING AND FITTING
Here we brieﬂy review the procedures of tracing and ﬁt-
ting the coronal loops developed by Gary et al. (2014b). First,
an automated loop recognition scheme (the code OCCULT-2)
is employed to trace the loop structures from the EUV images
taken by SDO/AIA in 171 Å. The OCCULT-2 code was devel-
oped by Aschwanden et al. (2013) and is included in the So-
larSoftWare (SSW), named as “looptracing_auto4.pro”, and
here we use the version dated 8-Dec-2015. The code provides
a group of input parameters to control the tracing, which are
given here respectively following Aschwanden et al. (2014):
the low-pass-ﬁlter constant nsm1 = 5, the minimum loop cur-
vature radius rmin = 30, the minimum loop length lmin = 20,
nloop = 50 and the base level factor qmed = 5. The code outputs
a number of 2D curves corresponding to the 2D loop identi-
ﬁed from the EUV images. Then each of the traced 2D loops
is ﬁtted by a 2D cubic Bézier spline, which is deﬁned by four
control points as (Gary et al. 2014a,b)

R(u) = [(1 − u)3x1 + 3u(1 − u)2x2 + 3u2(1 − u)x3 + u3x4,
(1 − u)3y1 + 3u(1 − u)2y2 + 3u2(1 − u)y3 + u3y4,
(1 − u)3z1 + 3u(1 − u)2z2 + 3u2(1 − u)z3 + u3z4]

(5)

where u ∈ [0, 1] is a parameter along the curve, (x j, y j, z j) with
j = 1, 2, 3, 4 are the coordinates of the four control points, and
here z j = 0 and so z = 0 as for a 2D curve. The ﬁtting is realized
by minimizing the RMS distances of 10 equally-spaced points
along the loop curve and the Bézier spline. It was proven that
generally there is no need to use a higher-order curve than cu-
bic Bézier curve (of 3rd order), which can sufﬁciently ﬁt the
EUV loops (Gary et al. 2014a,b). After this, the 2D Bézier
splines are extended to 3D by determining the four non-zero
z j coordinates for which the curve (Equation 5) has minimal
misalignment angle with the ﬁeld vector along it. In partic-
ular, at a given point R of a Bézier curve, the misalignment
angle µ(R) between the direction of the 3D spline (or the 3D
coronal loop) L(R) and the magnetic ﬁeld model B(R) at the
same point is deﬁned as

µ(R) = arccos

(cid:20) B(R) · L(R)
|B(R)||L(R)|

(cid:21)

,

(6)

Thus for a single loop, a mean misalignment angle can be
deﬁned by

Γ
(cid:88)

µ(Rk),

(7)

ξ =

1
Γ

k=1
where k is node index of the curve, and here we use an evenly-
spaced 100 points (Γ = 100) along the loop length. As ξ is a
function of the four altitudes z j, the best-ﬁt altitudes z∗
j are de-
termined by minimizing ξ. After applying the minimization
program to all the loops, statistical assessments of misalign-
ment of the model ﬁeld lines and loops can then be performed.

5. RESULTS
AR 12158 on 2014 September 10 is selected as our tar-
get of study because of its clear sigmoidal conﬁguration im-
aged by SDO/AIA in 171 Å channel as well as its near disk-
center location. Figure 1 shows that AR 12158 was passing
the central meridian on 2014 September 10, and moreover,
the region appears to be isolated from neighboring ARs, al-
though there are relatively long coronal loops reaching far
from the core region. An eruptive ﬂare of X1.6 class oc-
curred in the core of this region, which began at 17:21 UT,
reached its peak at 17:45 UT, and ended at 18:20 UT. This
sigmoid and its ﬂare have been studied by several authors.
From observations of SDO/AIA and interface region imag-
ing spectrograph (IRIS), Cheng et al. (2015) suggested that
prior to the major eruption a magnetic ﬂux rope is under for-
mation by tether-cutting reconnection (Moore et al. 2001) be-
tween two groups of sheared arcades driven by the shearing
and converging ﬂows in the photosphere near the polarity in-
version line. Li & Zhang (2015) reported slipping reconnec-
tion of ﬂaring loop during the ﬂare process, which was also
carefully studied by Dudík et al. (2016) in the context of the
3D standard ﬂare model (Aulanier et al. 2012; Janvier et al.
2013). NLFFF extrapolation of the coronal magnetic ﬁeld
about 2 hours before the ﬂare has been carried out by Zhao
et al. (2016) using a Grad-Rubin code implemented in spheri-
cal coordinates (Gilchrist & Wheatland 2014). By computing
a map of the magnetic ﬁeld squashing factor (Titov & Dé-
moulin 1999), Zhao et al. (2016) suggested that the locations
of QSLs agrees to some extent with the observed ﬂare ribbons,
which are predicted by the 3D standard ﬂare model. They
found a strongly twisted and complex magnetic ﬂux rope in
the extrapolation, the shape of which, however, is not seen in
AIA images.

Here we perform extrapolations of the coronal magnetic
ﬁeld immediately before the X-class ﬂare onset. Speciﬁ-
cally we use the HMI vector magnetogram at 17:00 UT on
September 10, and the extrapolations are to be compared with
the AIA observations at 17:10 UT. The reason for selecting
AIA observations at 17:10 UT is that the sigmoid-shaped
emission appears to be most distinctive in the 94 Å channel
when we inspect the AIA images before the ﬂare beginning
time of 17:21 UT (see Figure 2). As can be seen in Fig-
ure 2, the loop-tracing code OCCULT-2 identiﬁes a bundle
of loops forming an inverse S shape, which looks most ap-
parent at the selected time. The Space weather HMI Active
Region Patches (SHARP) vector magnetogram data product
‘hmi.sharp_cea_720s’ (Hoeksema et al. 2014; Bobra et al.
2014) is used for our extrapolation. It includes vector magne-
tograms projected and re-mapped onto the cylindrical equal
area (CEA Snyder 1987) Cartesian coordinate system cen-
tred on the tracked AR, which is well-suited for the Cartesian

Comparison of Coronal Magnetic Field Models

5

FIG. 1.— Observations of AR 12158 at the time 17:10 UT on 2014 September 10. (a) AIA 171 Å full-disk image with location of AR 12158 marked by the

box. (b) Close view of the boxed region. (c) Same as (b) but in AIA 94 Å channel. (d) SHARP CEA remapped LoS magnetogram.

version of our code. For comparing the coronal loops with
the modeled ﬁeld, we realign the AIA images using the same
CEA remapping to assure that the AIA images are co-aligned
with the magnetogram. We note this is reasonable only when
the target region is located near the disk center and should
be small enough, such that the solar radial direction is nearly
co-aligned with the line of sight and the 2D loops in the AIA
image correspond to projection of 3D loops along the radial
direction. Otherwise, comparison of the magnetic ﬁeld lines
with traced loops from EUV images should be performed di-
rectly in spherical geometry (Aschwanden et al. 2014) using
a spherical version of the Gary et al. (2014b)’s loop-ﬁtting
code, and thus extrapolation in spherical coordinates is re-
quired (e.g., Jiang et al. 2012; Tadesse et al. 2014; Gilchrist &
Wheatland 2014).

For the given SHARP vector magnetogram at the selected
time, we apply three magnetic ﬁeld models with different nu-
merical method and different boundary conditions. The ﬁrst

one (NLFFF1) is CESE–MHD–NLFFF modeling using the
original vector magnetogram. The second one (NLFFF2) is
CESE–MHD–NLFFF with the preprocessed magnetogram.
The third model is NFFF extrapolation, which also uses the
vector magnetogram without preprocessing as in NLFFF1.
All the extrapolations use the same resolution of 1 arcsec, and
the results are compared within the same effective volume of
282 × 266 × 200 arcsec3.

In the following sections, we assess and compare the mag-
netic ﬁeld models in different ways including the magnitude
of the Lorentz force and the quality of divergence-freeness,
the magnetic conﬁguration and topology features by comput-
ing the magnetic ﬁeld lines and squashing degree, misalign-
ment of the magnetic ﬁeld lines with the traced loops, and
ﬁnally the magnetic energy and helicity content of the ﬁelds.

5.1. Lorentz force and magnetic ﬁeld divergence

(a)2014-09-10T17:10:12.34Z(b)-100-50050100X (Mm)-50050Y (Mm)(d)-100-50050100X (Mm)-50050(c)-100-50050100X (Mm)-50050Y (Mm)6

Duan et al.

FIG. 2.— Top: AIA 94 Å images of the sigmoid around the ﬂare time. Middle: Same AIA data as the top but is bandpass ﬁltered with a low-pass-ﬁlter boxcar
of nrmsm1 = 5 pixels and a high-pass-ﬁlter boxcar of nsm2 = 7 pixels. Bottom: Automated loop tracing of the bandpass-ﬁltered images using the code OCCULT-2.

To check the quality of force-freeness and divergence-
freeness of the reconstructed ﬁelds, two metrics are routinely
used (e.g., Schrijver et al. 2006; DeRosa et al. 2009; Jiang &
Feng 2013): the mean sine of the angle between current J and
B weighted by J, named as CWsin and deﬁned by
(cid:82)
V JσdV
(cid:82)
V JdV

|J × B|
JB

CWsin ≡

; σ =

(8)

,

where B = |B|, J = |J| and V is the computational volume; and
a normalized divergence error measured by

(cid:104)| fi|(cid:105) =

1
V

(cid:90)

V

∇ · B
6B/∆x

dV.

(9)

These two metrics are equal to zero for an exact or a perfect
force-free ﬁeld; hence, the smaller the metrics are, the bet-
ter the extrapolation is for a force-free ﬁeld. However, for
a ﬁeld with very small current, the CWsin does not neces-
sarily give a reliable or meaningful value because of random
numerical errors. As an example, value of CWsin could be
close to 1 for a potential ﬁeld solution computed by Green’s
function method or other numerical realization. The reason is
that the numerical ﬁnite difference, used for computing the
current J = ∇ × B from B, gives small but ﬁnite currents,
whose directions are randomly from 0◦ to 180◦, thus the an-
gle between J and B should have an average value of ∼ 90◦.
Consequently, the distribution of CWsin for a NLFFF is ‘con-
taminated’ by this if a substantial portion of the volume is
current-free. The issue has been previously noted (Jiang &
Feng 2012a; Malanushenko et al. 2014). Small-scale struc-

tures (mainly in the weak ﬁeld regions) in the solar magne-
tograms, as are not sufﬁciently resolved, also might increase
the value of CWsin. This is because in these regions, although
the magnetic ﬁeld strength is small, the derived current by nu-
merical difference might not be small and their directions are
often random. It seems to explain why usually many NLFFF
extrapolations from real magnetograms give CWsin values,
for example, ∼ 0.30 (DeRosa et al. 2009), which is much
larger than results of benchmark tests with “idealized magne-
togram” (which are ∼ 0.1 or even smaller, see Jiang & Feng
2012a). As demonstrated by Jiang & Feng (2013), the CWsin
value decreases signiﬁcantly in the regions of AR core or with
strong currents where the inﬂuence of random errors is sup-
pressed.

Metrics of measuring the force-freeness and divergence-
freeness can be deﬁned in another way by analyzing the
residual
force in extrapolations (Jiang & Feng 2012a;
Malanushenko et al. 2014). We note that the residual force
actually consists of two parts, the Lorentz force and a force
induced by non-zero divergence of the ﬁeld. This is because a
nonzero ∇ · B can be assumed as being a magnetic monopole,
and analogous to a charge in electric ﬁeld, it introduces a force
F = B∇ · B parallel to the ﬁeld line (Dellar 2001). Of course
this force is un-physical and only results from numerical error.
To deﬁne a reference value for these forces, we decompose the
Lorentz force, (∇ × B) × B, into two components,

(∇ × B) × B = (B · ∇)B − ∇(B2/2)

(10)

where the two terms on the right hand side are called, respec-
tively, magnetic tension force and magnetic pressure force.

16:50:02nloop=21-100-50050100X (Mm)-50050Y (Mm)17:00:02nloop=34-100-50050100X (Mm)   17:10:02nloop=37-100-50050100X (Mm)   17:20:02nloop=40-100-50050100X (Mm)   Comparison of Coronal Magnetic Field Models

7

These two components should be balanced in a force-free
ﬁeld, but each is in general nonzero except in an uniform mag-
netic ﬁeld. Thus a metric of Lorentz force-freeness can be de-
ﬁned by the average ratio of the Lorentz force to the sum of
the magnitudes of the two component forces, namely,

E∇×B =

1
V

(cid:90)

V

|B × (∇ × B)|
|(B · ∇)B| + |∇(B2/2)|

dV.

(11)

This is identical to Equation (10) of Malanushenko et al.
(2014), and is similar to Equation (26) of Jiang & Feng
(2012a) which only used the magnitude of magnetic-pressure
force as denominator. Similarly, we measure the magnitude
of the other force B∇ · B by

E∇·B =

1
V

(cid:90)

V

|B(∇ · B)|
|(B · ∇)B| + |∇(B2/2)|

dV.

(12)

These two metrics E∇×B and E∇·B are meaningful in partic-
ular if the extrapolation ﬁeld is used as initial condition for
MHD simulations (e.g., Jiang et al. 2013; Kliem et al. 2013;
Amari et al. 2014; Inoue et al. 2014), because they directly re-
ﬂect the inﬂuence of the residual force on the numerical MHD
system. Thus we recommend to check these two metrics be-
fore using NLFFF (or any other) solutions to initialize MHD
code, and examine carefully the the related inﬂuence. For a
typical plasma β ∼ 0.01 in the lower corona (Gary 2001), the
residual force that can be balanced by the gas pressure should
be accordingly ∼ 0.01 of the magnetic-pressure force, thus
the two metrics should be as small as ∼ 0.01 if the residual
force can be considered as negligible.

TABLE 1
METRICS OF FORCE-FREENESS AND DIVERGENCE-FREENESS FOR THE
THREE EXTRAPOLATION MODELS AND THE POTENTIAL FIELD MODEL

Model
NLFFF1
NLFFF2
NFFF
Potential

CWsin
0.40
0.32
0.80
0.86

(cid:104)| fi|(cid:105)
4.6 × 10−4
3.9 × 10−4
1.2 × 10−5
6.0 × 10−6

E∇×B
0.22
0.16
0.31
1.2 × 10−4

E∇·B
4.3 × 10−2
3.6 × 10−2
1.4 × 10−4
2.5 × 10−4

The results for the aforementioned metrics are given in Ta-
ble 1 for all the three extrapolation models as well as a po-
tential ﬁeld model that matches the magnetogram. From the
results, we ﬁnd that all the metrics decrease from NLFFF
models 1 to 2, showing that the NLFFF extrapolations are
improved by the preprocessing of the vector magnetogram,
and their values are close to the results in our previous work
for extrapolation of AR 11158 and AR 11283 (Jiang & Feng
2013), suggesting that the performance of CESE–MHD–
NLFFF code is not sensitive to different ARs. The divergence
metric (cid:104)| fi|(cid:105) is on the order of 10−4, which is consistent with
previous results (e.g., Metcalf et al. 2008; Valori et al. 2013;
DeRosa et al. 2015). The value is smaller by one order for the
NFFF as it is a superposition of three constant-alpha ﬁelds,
and it is close to the value for the potential ﬁeld model. Com-
paring E∇·B and E∇×B shows that the force induced by the
divergence are signiﬁcantly smaller than the Lorentz force.
We note that the residual force as measured by these two met-
rics is larger than what can be neglected if the extrapolated
ﬁeld is input to an MHD model as a force-free state . On
the other hand, the Lorentz force as measured by both CWsin
and E∇×B is much larger in the NFFF extrapolation than the
NLFFFs, as it should be, although the numerical and measure-

ment uncertainties would still contribute to this value as de-
scribed earlier. The divergence-freeness condition is fulﬁlled
much better in the NFFF solution, which is close to the values
of that for the potential ﬁeld model. This is because the NFFF
solution is the sum of three LFFF’s for which the divergence
is guaranteed to be as small as the numerical scheme would
allow. Finally we note that CWsin for the potential ﬁeld is in-
deed close to 1, which fails to indicate the force-freeness of a
current-free ﬁeld, as we have discussed, while the E∇×B gives
a reasonable value of ∼ 10−4, which is as small as the value
of E∇·B.

5.2. Magnetic ﬁeld lines, current, and topology
In Figure 3 we compare the magnetic lines, electric current
distributions, and magnetic topology for three magnetic ﬁelds.
The columns from left to right are respectively for NLFFF1,
NLFFF2, and NFFF. The magnetic ﬁeld lines are sampled
and shown in the ﬁrst row of the ﬁgure. Each ﬁeld line is
color-coded by the mean value of the electric current density
(J = |∇ × B| in G arcsec−1) along the line. The second row of
the ﬁgure shows a vertical integration of the current density
((cid:82)
z Jdz with unit of G). Overall an inverse-S shape of strong
current can be seen, especially in the NLFFFs, which is very
roughly consistent with the AIA 94 Å image (Figure 1c). The
strongest current are associated with the magnetic ﬁeld lines
in the core region, which corresponds to the brightest loops
in AIA 94 Å image. The magnetic ﬁeld lines of all the mod-
els here are mostly sheared arcades rather than fully S shapes,
and show no presence of the strongly twisted magnetic ﬂux
rope that is found in the extrapolation by Zhao et al. (2016).
Our results seem to agree with the observations of AIA, from
which the loop tracing code identiﬁes approximately formed
S-shaped loops. From a visual inspection of the magnetic
ﬁeld lines of the models, it appears that in the core region
the NLFFFs possess stronger shear than the NFFF, contrarily,
in the enveloping ﬁeld region, the latter has slightly stronger
sheared ﬁeld lines than the former ones. Consistently, the cur-
rent distribution of the NFFF is more diffused than that of the
NLFFF models.

To further compare the magnetic topology, we compute the
magnetic squashing degree at the bottom surface. The squash-
ing degree, or Q factor, is a quantity measuring shape dis-
tortions of elemental ﬂux tubes based on the ﬁeld-line map-
ping (Demoulin et al. 1996; Titov et al. 2002). Speciﬁcally,
starting at footpoint (x, y), the other footpoint of a closed mag-
netic ﬁeld line is denoted by (X(x, y),Y (x, y)) for a given coro-
nal ﬁeld model. Then Q(x, y) is given by

Q =

a2 + b2 + c2 + d2
|ad − bc|

where

a =

∂X
∂x

, b =

∂X
∂y

, c =

∂Y
∂x

, d =

∂Y
∂y

.

(13)

(14)

Thus a small value of Q indicates that a inﬁnitesimal circle
at one foot-point is mapped to a circle at the other foot-point,
while a very high value (e.g., > 100) indicates extreme distor-
tion of the circle, which indicates steep gradient of the ﬁeld-
line mapping that occurs in magnetic quasi-separatrix layers
(QSLs). Thus the Q factor is useful for searching for impor-
tant topological structures like separatrices and QSLs. They
prove to be relevant to the studies of reconnection sites in the
corona and thus physics of ﬂares. For computing Q, we use

8

Duan et al.

FIG. 3.— Comparison of the three extrapolation models (columns from left to right corresponding to NLFFF1, NLFFF2 and NFFF, respectively) by magnetic
ﬁeld lines, electric current distributions, magnetic squashing degree and twist degree (rows from top to bottom). In the plot of magnetic ﬁeld lines, each ﬁeld line
is color-coded by the mean value of the electric current density (J = |∇ × B| with unit of G arcsec−1) along the line; the backgrounds show the map of Bz. The
current distribution is shown by the vertical integration of the current density ((cid:82)
z Jdz with unit of G). The distributions of the magnetic squashing degree log(Q)
and the twist degree are computed at a horizontal slice one pixel above the bottom surface of the extrapolation box. Their ﬁeld of view is denoted by the white
box in the top panels.

the approach recently proposed by Pariat & Démoulin (2012),
which is computationally efﬁcient and can be used to compute
Q inside the 3D domain. The third row of Figure 3 shows the
maps of Q factor. Comparing these three models, we ﬁnd
limited difference between them, and there appears to be no
well-shaped QSL deﬁning the boundary of the shear core and
the enveloping ﬂux.

In the last row of Figure 3 we show the map of twist (Tn) of
magnetic ﬁeld lines (e.g., Inoue et al. 2011; Liu et al. 2016),
which is deﬁned by

Tn =

1
4π

(cid:90)

L

(∇ × B) · B
B2

dl.

(15)

where the integral is taken along each closed ﬁeld line. The
magnetic twist Tn measures number of turns two inﬁnitesi-
mally close ﬁeld lines make about each other (Berger & Prior
2006). Both signs of twist are seen in the whole region, and
the majority of the core ﬁeld has a negative value of twist,
i.e., a left-handed twisting, and with a relatively small value
Tn ≤ 1. This is consistent with the absence of strongly-twisted
ﬂux rope in the models. Comparison of the two NLFFF mod-
els shows that the preprocessing also results in clear increase
of the magnetic twist. The non-force-free model gives a much
more weakly twisted ﬁeld than the NLFFF models, and the
distribution of twist degree appears much more even. A fur-

010203040501001000012345        log(Q)-0.8-0.40.00.40.8Twist degreeComparison of Coronal Magnetic Field Models

9

ther study of the magnetic topology and distribution of twist
degree and their relation with the eruption is left to a future
paper.

5.3. Misalignment of the magnetic ﬁeld lines and AIA loops
Now we report the results of loop ﬁtting to the magnetic
ﬁeld models as described in Section 4. Here we apply the
procedures of Gary et al. (2014b) to two AIA channels, i.e.,
94 Å and 171 Å, which represent two separate features of the
AR ﬁeld. The 94 Å shows loops at the AR core that are pre-
sumably associated with signiﬁcantly non-potential magnetic
ﬁeld, and they are usually compact and short, while the 171 Å
loops correspond to the enveloping ﬁeld that is often close
to a potential state. As described in Section 4, the OCCULT-2
traced loops from the AIA images are ﬁrst ﬁtted by 2D 4-point
Bézier splines. The results are shown in Figure 4. As can be
seen, although the 4-point Bézier ﬁtting is previously only ap-
plied to AIA 171 Å loops, here it works also pretty well for
the AIA 94 Å loops, some of which exhibit slightly S shapes.
Then, using the method described in Section 4, the Bézier
splines (or loops) are extended to 3D by minimizing the mis-
alignment angle between the loops and the 3D magnetic ﬁeld.
Figures 5 and 6 give the results of such a minimization of the
misalignment angle for each loop, and the different panels in
the ﬁgures are for different extrapolation models of magnetic
ﬁeld. For convenience of comparison, the loops are shown by
the thick curves color-coded by value of corresponding mis-
alignment angle with the magnetic ﬁeld, and for each loop, a
magnetic ﬁeld line is traced passing through the mid-point of
the loop, which are shown by the thin curves. The median and
mean values of all the misalignment angles for each magnetic
ﬁeld model are also shown in the ﬁgures.

We ﬁnd that model NLFFF2 gives the best results in ﬁt-
ting to the AIA 94 Å loops as it has the smallest values for
both the median and mean of the misalignment angles. For
the AIA 171 Å loops, NLFFF2 also gives the smallest me-
dian value, while the smallest average value is given by the
potential ﬁeld model. Comparing the results for the two AIA
channels, we notice that the ﬁtting of the modeled ﬁeld lines
to loops is much better for the 94 Å than for 171 Å. In partic-
ular in the best model (NLFFF2), the misalignment angles for
the 94 Å loops, which have median value of ∼ 10◦ and mean
value of ∼ 15◦, are less than half of those for the 171 Å loops
(∼ 30◦). For 94 Å loops, all the non-potential models give
signiﬁcantly smaller value of misalignment than the potential
ﬁeld model, which conﬁrms that these loops are associated
with magnetic ﬁeld of signiﬁcant non-potentiality. Improve-
ment from preprocessing of the magnetogram for NLFFF ex-
trapolation is also conﬁrmed by the decrease of the misalign-
ment angles.

It is worthy noting that our best results for the AIA 94 Å
loops are on the order of the results using coronal loop
forward-ﬁtting NLFFF code shown in Aschwanden (2013b),
who found that the 3D misalignment angle amounts to an av-
erage value of 19◦ ± 3◦ for their studied ARs. However, for
the 171 Å loops, our extrapolation models perform, at the
best, only close to the potential ﬁeld model (with misalign-
ment of ∼ 30◦). Such value is comparable to the misalign-
ment angles (24◦ − 44◦) as resulted from a comparison of var-
ious NLFFF models for AR 10953 by DeRosa et al. (2009),
who also found that those NLFFF models perform no bet-
ter than potential model. The NLFFF1 without preprocess-

ing gives even larger misalignment angle than the potential
model, and it is slightly improved from the preprocessing.
The different values for 94 Å and 171 Å show that the CESE–
MHD–NLFFF code can reconstruct much more reliably the
AR core ﬁeld (which is signiﬁcantly non-potential) than the
envelope ﬁeld (which is presumably close to potential). The
large misalignment of the extrapolated ﬁeld with the 171 Å
loops is because the ﬁeld lines corresponding to the long loops
do not relax sufﬁciently during the MHD-relaxation process.
Since in the code the relaxation speed is uniform and the re-
laxation time is thus proportional to the ﬁeld line length, the
long ﬁeld lines need more time to relax than the short ones.
Moreover, the long ﬁeld lines often extend close to or reach
side and top boundaries of the computational volume and are
subject to the boundary effects, as all these boundaries are
ﬁxed with the initial potential ﬁeld (however note that the
computational volume is larger than the ﬁeld-of-view of the
magnetogram). Another factor which might be partially re-
sponsible for this effect is the departure from the Cartesian
coordinates assumption further away from the core. Thus a
further optimization of the relaxation process with realization
of spherical geometry is needed for a better reconstruction of
the enveloping ﬁeld.

TABLE 2
MAGNETIC FLUX, ENERGY CONTENTS AND RELATIVE HELICITY OF THE
EXTRAPOLATION MODELS. UNITS ARE RESPECTIVELY, 1022 MX FOR
MAGNETIC FLUX, 1032 ERG FOR MAGNETIC ENERGY, AND 1043 MX2 FOR
MAGNETIC HELICITY.

Model
NLFFF1
NLFFF2
NFFF

Φ
3.41
3.18
3.41

Etot
11.5
11.1
14.8

Epot
11.7
10.0
11.8

Efree
-0.18
1.10
3.02

Efree/Epot H
-1.5%
10.9%
25.6%

-1.60
-2.03
-2.36

H/Φ2
−1.38 × 10−2
−2.00 × 10−2
−2.04 × 10−2

5.4. Magnetic energy and helicity
In Table 2 we list the magnetic energy contents and relative
helicity for the extrapolation solutions. Both the total mag-
netic energy Etot and the corresponding reference potential-
ﬁeld energy Epot are computed, from which the free magnetic
energy Efree = Etot − Epot can be derived. The reference poten-
tial ﬁelds are computed numerically by solving the Laplace
equation for the potential with Neumann boundary conditions
based on the normal component of B on all six boundaries
of the analysis volume. As a consequence of each solution
ﬁeld having its own boundary value, there are separate refer-
ence potential ﬁelds for each of the solution ﬁelds, and thus
the potential-ﬁeld energy contents are different among the
models. The relative magnetic helicity H is deﬁned follow-
ing Berger & Field (1984)

H =

(cid:90)

V

(A + Apot)(B − Bpot)dV

(16)

where A is vector potential of the magnetic ﬁeld, i.e., B =
∇ × A and Bpot is the reference potential ﬁeld and also Bpot =
∇ × Apot. The calculation of H is made using a rapid method
developed by Valori et al. (2012). For reference, we also list
values of the total unsigned magnetic ﬂux Φ in the table.

Clearly the free energy increases from NLFFF1 to NLFFF2.
Such an increase of non-potentiality of the solutions is due to
the improvement of the NLFFF extrapolations. Here the free
energy for NLFFF1 is even un-physically negative. We note

10

Duan et al.

FIG. 4.— Fitting of the OCCULT-2 traced loops (thick green curves) by 2D Bézier splines (dashed red curves). The background are bandpass ﬁltered AIA

images, left for AIA 171 Å and right for AIA 94 Å.

that energy of the extrapolated ﬁeld being lower than the po-
tential ﬁeld energy has been reported previously, for instance,
some solutions given in Table 3 of Metcalf et al. (2008) and
Table 1 of Schrijver et al. (2008). Valori et al. (2013) shows
that such problematic extrapolation actually reﬂects the viola-
tion of Thomson’s theorem (that the total energy of a system
can be expressed as the sum of its potential energy and its
free energy) due to the ﬁnite divergence of the extrapolation
ﬁeld rather than the non-zero Lorentz force. The ﬁnite diver-
gence is unavoidably induced in the course of seeking a force-
free ﬁeld with an inconsistent boundary condition (i.e., the un-
preprocessed photospheric ﬁeld). Since the MHD-relaxation
code attempts to construct force-free solution by reducing the
Lorentz forces in the computing volume, while the bound-
ary condition is incompatible with the force-free equation,
the reduction of the Lorentz forces is at the expense of the
solenoidal condition. In such case, the more inconsistent the
boundary is, the higher the divergence of the solution will be,
and Thomson’s theorem will be more severely violated, which
could result in a total energy lower than the potential energy.
The inconsistency of the photospheric ﬁeld can be partly re-
duced by preprocessing. After preprocessing, the code out-
puts free energy on the order of 1032 erg, which could energize
a major ﬂare. Interestingly, the NFFF model outputs a signif-
icantly larger free energy content, which is about three times
of that from NLFFF2, This might be due to the fact that NFFF
is a combination of LFFFs whose current is distributed more
evenly and result in a ﬁeld much more non-potential than the
NLFFFs.

All the models have negative helicity, which complies with
the hemispheric chirality-rule (Seehafer 1990; Pevtsov et al.
1995), i.e., active regions in southern and northern hemi-
spheres tend to have negative and positive helicities respec-
tively. A negative helicity indicates a left-handed twisting
of the magnetic ﬁeld lines, and can be easily conﬁrmed by
inspecting the magnetic ﬁeld lines and their directions (see
Figure 3) and also in the twist degree map (Figure 3), which
shows that the majority of the values is negative. Consistent
with the increasing of free energy from NLFFF1, NLFFF2 to
NFFF, the relative helicity contents also increase.

6. DISCUSSION
Due to the absence of direct measurements, to determine
the coronal magnetic ﬁeld one has to extrapolate the photo-
spheric ﬁeld. Critically assessing and comparing the results
for different extrapolation codes is an important task for de-
veloping a reliable coronal magnetic ﬁeld model consistent
with observations and physics. In this paper, we have made
a comprehensive assessment and comparison of an NLFFF
code (CESE–MHD–NLFFF) and a non-force-free code. For
this, we extrapolated the coronal magnetic ﬁeld for a sig-
moidal AR near its central meridian passage immediately be-
fore a major ﬂare. Vector magnetograms of the HMI SHARP
dataset are used, and three ﬁeld models are calculated includ-
ing the CESE–MHD–NLFFF extrapolations using the magne-
togram with and without preprocessing and the NFFF extrap-
olation. The extrapolation solutions are evaluated and com-
pared in different ways including the residual Lorentz force
and divergence, the magnetic topology and energy/helicity
contents. In particular, we use a method recently proposed by
Gary et al. (2014b) to compute the misalignment angle of the
model ﬁeld lines with the 3D traces of coronal loops identi-
ﬁed from two AIA images (wave lengths of 94 Å and 171 Å),
respectively, which previously have not been tested for these
codes.

The extrapolations show that the magnetic ﬁeld lines in the
AR’s core is consistent with sheared arcades forming a sig-
moidal shape in agreement with the observed AIA 94 Å loops.
Twist of the ﬁeld lines are mostly below one full turn, and
also there seems to be no QSL that marks a clear presence
of magnetic ﬂux rope. It is found that the best extrapolated
ﬁeld matches the AIA 94 Å loops with misalignment angles
of mean value ∼ 15◦ and median value 9◦, which are much
smaller than that for the 171 Å loops (mean value of ∼ 32◦
and median value of ∼ 19◦).
Interestingly, the misalign-
ment angles for AIA 94 Å loops are even comparable with
those by coronal-loop forward-ﬁtting method (Aschwanden
2013b), suggesting that the CESE–MHD–NLFFF can repro-
duce the magnetic conﬁguration at the core region of an AR.
On the other hand, the 171 Å loops are not well reproduced,

Comparison of Coronal Magnetic Field Models

11

FIG. 5.— Minimum misalignment angles between the magnetic ﬁeld model and the Bézier splines (for AIA 94 Å loops) when extended to 3D. The four panels
clockwise from the top left to the bottom left are results, respectively, for the potential magnetic ﬁeld, the NLFFF1, the NFFF, and the NLFFF2 models. Each
loop, as shown by the thick curves, is color-coded by the value of its misalignment angle (0 − 90◦) as indicated by the colorbar in the ﬁrst panel. Also a magnetic
ﬁeld line (shown by thin curves) is traced from the mid-point of each loop. The contour lines are plotted for Bz at −500 G (colored as black) and 500 G (yellow).
For each model, the median and mean values of the misalignment angles for all the loops are shown.

which means that an improvement of the code is necessary for
further relaxation of the long ﬁeld lines. By comparing the
NLFFF extrapolations made using both preprocessed and not
preprocessed input data, we conﬁrm the preprocessing of vec-
tor magnetogram improves considerably the extrapolation re-
sult. For the best results, the residual Lorentz force is as large
as 15% in normalized units (see above) while the residual di-
vergence is one order of magnitude smaller. When comparing
the NLFFFs and the NFFF results, it is found that the currents
of the ﬁeld by the NFFF is distributed more evenly than in
the NLFFFs for this particular AR. In the future we plan to
extend the comparison study with coronal loops to a number
of AR samples, as well as including the magnetic ﬁeld results
from a data-driven MHD model (Jiang et al. 2016). Experi-
ments by using NFFF solutions as initial conditions to MHD

simulations are also underway.

This work is jointly supported by National Natural Science
Foundation of China (41604140), China Postdoctoral Science
Foundation funded project (119103S277), and the Specialized
Research Fund for State Key Laboratories. C.J. acknowledges
support by National Natural Science Foundation of China
(41531073, 41374176, 41574170, 41231068, and 41574171).
Data from observations are courtesy of NASA SDO/AIA and
the HMI science teams. We thank the anonymous referee for
helpful comments on the manuscript. We were all saddened
by the sudden passing of Dr. S. T. Wu. We dedicate this work
to ST in memory of his life-long achievement, his mentor-
ship, and his vision for numerical modeling of solar coronal
magnetic ﬁeld.

Alissandrakis, C. E. 1981, A&A, 100, 197

Altschuler, M. D. & Newkirk, G. 1969, Sol. Phys., 9, 131

REFERENCES

Minimum misalignment angle (deg)020406080Mean:    39.09Median: 46.35Mean:    16.76Median: 12.62Mean:    15.15Median:  9.28Mean:    21.86Median: 18.4512

Duan et al.

FIG. 6.— Same as Figure 5 but for AIA 171 Å loops.

Amari, T., Aly, J. J., Luciani, J. F., Boulmezaoud, T. Z., & Mikic, Z. 1997,

Sol. Phys., 174, 129

Amari, T., Boulmezaoud, T. Z., & Aly, J. J. 2006, A&A, 446, 691
Amari, T., Canou, A., & Aly, J. J. 2014, Nature, 514, 465
Aschwanden, M., De Pontieu, B., & Katrukha, E. 2013, Entropy, 15, 3007
Aschwanden, M. J. 2013a, Sol. Phys., 287, 323
—. 2013b, ApJ, 763, 115
Aschwanden, M. J., Sun, X., & Liu, Y. 2014, The Astrophysical Journal,

785, 34

39, 8321

Aschwanden, M. J., Wulser, J.-P., Nitta, N. V., & Lemen, J. R. 2008, The

Astrophysical Journal, 679, 827

Aulanier, G., Janvier, M., & Schmieder, B. 2012, A&A, 543, A110
Berger, M. A. & Field, G. B. 1984, Journal of Fluid Mechanics, 147, 133
Berger, M. A. & Prior, C. 2006, Journal of Physics A Mathematical General,

Bobra, M. G., Sun, X., Hoeksema, J. T., Turmon, M., Liu, Y., Hayashi, K.,

Barnes, G., & Leka, K. D. 2014, Sol. Phys., 289, 3549

Burnette, A. B., Canﬁeld, R. C., & Pevtsov, A. A. 2004, ApJ, 606, 565
Chae, J. & Moon, Y.-J. 2005, ApJ, 629, 1110
Cheng, X., Ding, M. D., & Fang, C. 2015, ApJ, 804, 82
Cheng, X., Ding, M. D., Zhang, J., Sun, X. D., Guo, Y., Wang, Y. M., Kliem,

B., & Deng, Y. Y. 2014, The Astrophysical Journal, 789, 93

Dellar, P. J. 2001, J. Comput. Phys., 172, 392
Demoulin, P., Henoux, J. C., Priest, E. R., & Mandrini, C. H. 1996, A&A,

308, 643

DeRosa, M. L., Schrijver, C. J., Barnes, G., Leka, K. D., Lites, B. W.,

Aschwanden, M. J., Amari, T., Canou, A., McTiernan, J. M., Régnier, S.,
Thalmann, J. K., Valori, G., Wheatland, M. S., Wiegelmann, T., Cheung,
M. C. M., Conlon, P. A., Fuhrmann, M., Inhester, B., & Tadesse, T. 2009,
ApJ, 696, 1780

DeRosa, M. L., Wheatland, M. S., Leka, K. D., Barnes, G., Amari, T.,

Canou, A., Gilchrist, S. A., Thalmann, J. K., Valori, G., Wiegelmann, T.,
Schrijver, C. J., Malanushenko, A., Sun, X., & Régnier, S. 2015, ApJ,
811, 107

Dudík, J., Polito, V., Janvier, M., Mulay, S. M., Karlick`y, M., Aulanier, G.,

Del Zanna, G., Dzifˇcáková, E., Mason, H. E., & Schmieder, B. 2016, The
Astrophysical Journal, 823, 41

Fuhrmann, M., Seehafer, N., & Valori, G. 2007, A&A, 476, 349
Fuhrmann, M., Seehafer, N., Valori, G., & Wiegelmann, T. 2011, A&A, 526,

A70

289, 3703

Gary, G. A. 2001, Sol. Phys., 203, 71
Gary, G. A., Hu, Q., & Lee, J. K. 2014a, Sol. Phys., 289, 847
Gary, G. A., Hu, Q., Lee, J. K., & Aschwanden, M. J. 2014b, Sol. Phys.,

Gilchrist, S. A. & Wheatland, M. S. 2014, Sol. Phys., 289, 1153
Guo, Y., Ding, M. D., Wiegelmann, T., & Li, H. 2008, ApJ, 679, 1629
Guo, Y., Xia, C., Keppens, R., & Valori, G. 2016, ApJ, 828, 82
He, H. & Wang, H. 2006, MNRAS, 369, 207
Hoeksema, J. T., Liu, Y., Hayashi, K., Sun, X., Schou, J., Couvidat, S.,

Norton, A., Bobra, M., Centeno, R., Leka, K. D., Barnes, G., & Turmon,
M. 2014, Sol. Phys., 289, 3483

Hu, Q. & Dasgupta, B. 2008, Sol. Phys., 247, 87
Hu, Q., Dasgupta, B., Choudhary, D. P., & Büchner, J. 2008, ApJ, 679, 848

Minimum misalignment angle (deg)020406080Mean:    27.42Median: 26.83Mean:    37.88Median: 35.06Mean:    32.10Median: 19.04Mean:    32.97Median: 25.84Comparison of Coronal Magnetic Field Models

13

Jiang, C. W., Wu, S. T., Feng, X. S., & Hu, Q. 2016, Nature Comm., 7,

Thalmann, J. 2012, ApJ, 748, 77

Kliem, B., Su, Y. N., van Ballegooijen, A. A., & DeLuca, E. E. 2013, ApJ,

Pevtsov, A. 2014, Solar Physics, 289, 831

463

11522

779, 129

Hu, Q., Dasgupta, B., Derosa, M. L., Büchner, J., & Gary, G. A. 2010,

Journal of Atmospheric and Solar-Terrestrial Physics, 72, 219

Inoue, S., Hayashi, K., Magara, T., Choe, G. S., & Park, Y. D. 2014, The

Astrophysical Journal, 788, 182

Inoue, S., Kusano, K., Magara, T., Shiota, D., & Yamamoto, T. T. 2011, ApJ,

738, 161

Janvier, M., Aulanier, G., Pariat, E., & Démoulin, P. 2013, A&A, 555, A77
Jiang, C. & Feng, X. 2013, ApJ, 769, 144
—. 2014, Sol. Phys., 289, 63
Jiang, C., Feng, X., & Xiang, C. 2012, ApJ, 755, 62
Jiang, C., Wu, S. T., Feng, X., & Hu, Q. 2014, ApJ, 786, L16
Jiang, C. W. & Feng, X. S. 2012a, ApJ, 749, 135
—. 2012b, Sol. Phys., 281, 621
Jiang, C. W., Feng, X. S., Fan, Y., & Xiang, C. 2011, ApJ, 727, 101
Jiang, C. W., Feng, X. S., Wu, S. T., & Hu, Q. 2013, ApJ, 771, L30
Jiang, C. W., Feng, X. S., Zhang, J., & Zhong, D. K. 2010, Sol. Phys., 267,

Li, T. & Zhang, J. 2015, ApJ, 804, L8
Lim, E.-K., Jeong, H., Chae, J., & Moon, Y.-J. 2007, ApJ, 656, 1167
Lin, H. 2016, Frontiers in Astronomy and Space Sciences, 3, 9
Lin, H., Kuhn, J. R., & Coulter, R. 2004, ApJ, 613, L177
Liu, C., Deng, N., Lee, J., Wiegelmann, T., Jiang, C., Dennis, B., Su, Y.,

Donea, A., & Wang, H. 2014, ApJ, 795, 128

Liu, R., Kliem, B., Titov, V. S., Chen, J., Wang, Y., Wang, H., Liu, C., Xu,

Y., & Wiegelmann, T. 2016, ApJ, 818, 148
Low, B. C. & Lou, Y. Q. 1990, ApJ, 352, 343
Malanushenko, A., Schrijver, C. J., DeRosa, M. L., & Wheatland, M. S.

2014, ApJ, 783, 102

Malanushenko, A., Schrijver, C. J., DeRosa, M. L., Wheatland, M. S., &

Gilchrist, S. A. 2012, ApJ, 756, 153

Malanushenko, A., Yusuf, M. H., & Longcope, D. W. 2011, ApJ, 736, 97
McClymont, A. N., Jiao, L., & Mikic, Z. 1997, Sol. Phys., 174, 191
Metcalf, T. R., DeRosa, M. L., Schrijver, C. J., Barnes, G., van Ballegooijen,
A. A., Wiegelmann, T., Wheatland, M. S., Valori, G., & McTtiernan, J. M.
2008, Sol. Phys., 247, 269

Moore, R. L., Sterling, A. C., Hudson, H. S., & Lemen, J. R. 2001, ApJ,

552, 833

Pariat, E. & Démoulin, P. 2012, A&A, 541, A78
Pevtsov, A. A., Canﬁeld, R. C., & Metcalf, T. R. 1995, ApJ, 440, L109
Quintero , C., Shimizu, T., Katsukawa, Y., de la Cruz Rodríguez, J.,

Carlsson, M., Anan, T., Oba, T., Ichimoto, K., & Suematsu, Y. 2017,
MNRAS, 464, 4534

Régnier, S. 2013, Solar Physics, 288, 481

Sakurai, T. 1981, Solar physics, 69, 343
Sakurai, T. 1982, Sol. Phys., 76, 301
—. 1989, Space Sci. Rev., 51, 11
Schrijver, C. J., De Rosa, M. L., Metcalf, T. R., Liu, Y., McTiernan, J.,
Régnier, S., Valori, G., Wheatland, M. S., & Wiegelmann, T. 2006,
Sol. Phys., 235, 161

Schrijver, C. J., DeRosa, M. L., Metcalf, T., Barnes, G., Lites, B., Tarbell, T.,
McTiernan, J., Valori, G., Wiegelmann, T., Wheatland, M. S., Amari, T.,
Aulanier, G., Démoulin, P., Fuhrmann, M., Kusano, K., Régnier, S., &
Thalmann, J. K. 2008, ApJ, 675, 1637

Seehafer, N. 1978, Sol. Phys., 58, 215
—. 1990, Sol. Phys., 125, 219
Snyder, J. P. 1987, Map projections–A working manual, Vol. 1395 (US

Solanki, S. K., Inhester, B., & Schüssler, M. 2006, Reports on Progress in

Government Printing Ofﬁce)

Physics, 69, 563

Sun, X., Hoeksema, J. T., Liu, Y., Wiegelmann, T., Hayashi, K., Chen, Q., &

Tadesse, T., Wiegelmann, T., MacNeice, P., Inhester, B., Olson, K., &

Titov, V. S. & Démoulin, P. 1999, A&A, 351, 707
Titov, V. S., Hornig, G., & Démoulin, P. 2002, J. Geophys. Res., 107, 1164
Valori, G., Démoulin, P., Pariat, E., & Masson, S. 2013, A&A, 553, A38
Valori, G., Green, L. M., Démoulin, P., Vargas Domínguez, S., van

Driel-Gesztelyi, L., Wallace, A., Baker, D., & Fuhrmann, M. 2012,
Sol. Phys., 278, 73

Valori, G., Kliem, B., & Fuhrmann, M. 2007, Sol. Phys., 245, 263
Valori, G., Kliem, B., Török, T., & Titov, V. S. 2010, A&A, 519, A44+
Wheatland, M. S. 2006, Sol. Phys., 238, 29
—. 2007, Sol. Phys., 245, 251
Wheatland, M. S., Sturrock, P. A., & Roumeliotis, G. 2000, ApJ, 540, 1150
Wiegelmann, T. 2004, Sol. Phys., 219, 87
—. 2008, Journal of Geophysical Research (Space Physics), 113, 3
Wiegelmann, T. & Neukirch, T. 2002, Sol. Phys., 208, 233
—. 2006, A&A, 457, 1053
Wiegelmann, T. & Sakurai, T. 2012, Living Reviews in Solar Physics, 9, 5
Wiegelmann, T., Thalmann, J. K., Inhester, B., Tadesse, T., Sun, X., &

Hoeksema, J. T. 2012, Sol. Phys., 67

Wu, S. T., Sun, M. T., Chang, H. M., Hagyard, M. J., & Gary, G. A. 1990,

ApJ, 362, 698

Xue, Z., Yan, X., Cheng, X., Yang, L., Su, Y., Kliem, B., Zhang, J., Liu, Z.,

Bi, Y., Xiang, Y., et al. 2016, Nature Communications, 7

Yan, Y. & Sakurai, T. 2000, Sol. Phys., 195, 89
Yang, W. H., Sturrock, P. A., & Antiochos, S. K. 1986, ApJ, 309, 383
Zhao, J., Gilchrist, S. A., Aulanier, G., Schmieder, B., Pariat, E., & Li, H.

2016, ApJ, 823, 62

