6
1
0
2

y
a
M
3

]

A
G
.
h
p
-
o
r
t
s
a
[

1
v
7
5
0
1
0
.
5
0
6
1
:
v
i
X
r
a

MNRAS 000, 1–21 (2015)

Preprint 26 July 2021

Compiled using MNRAS LATEX style ﬁle v3.0

BOND: Bayesian Oxygen and Nitrogen abundance
Determinations in giant H II regions using strong and
semi-strong lines

N. Vale Asari1(cid:63), G. Stasi´nska2, C. Morisset3, R. Cid Fernandes1
1Departamento de F´ısica–CFM, Universidade Federal de Santa Catarina, C.P. 476, 88040-900, Florian´opolis, SC, Brazil
2LUTH, Observatoire de Paris, PSL Research University, CNRS, Universit´e Paris Diderot, Sorbonne Paris Cit´e,
5 place Jules Janssen, 92195 Meudon, France
3Instituto de Astronom´ıa, Universidad Nacional Aut´onoma de M´exico

Accepted . . . . Received 26 July 2021; in original form . . .

ABSTRACT

We present bond, a Bayesian code to simultaneously derive oxygen and nitrogen
abundances in giant H ii regions. It compares observed emission lines to a grid of pho-
toionization models without assuming any relation between O/H and N/O. Our grid
spans a wide range in O/H, N/O and ionization parameter U, and covers diﬀerent
starburst ages and nebular geometries. Varying starburst ages accounts for variations
in the ionizing radiation ﬁeld hardness, which arise due to the ageing of H ii regions
or the stochastic sampling of the initial mass function. All previous approaches as-
sume a strict relation between the ionizing ﬁeld and metallicity. The other novelty is
extracting information on the nebular physics from semi-strong emission lines. While
strong lines ratios alone ([O iii]/Hβ, [O ii]/Hβ and [N ii]/Hβ) lead to multiple O/H
solutions, the simultaneous use of [Ar iii]/[Ne iii] allows one to decide whether an H ii
region is of high or low metallicity. Adding He i/Hβ pins down the hardness of the
radiation ﬁeld. We apply our method to H ii regions and blue compact dwarf galaxies,
and ﬁnd that the resulting N/O vs O/H relation is as scattered as the one obtained
from the temperature-based method. As in previous strong-line methods calibrated on
photoionization models, the bond O/H values are generally higher than temperature-
based ones, which might indicate the presence of temperature ﬂuctuations or kappa
distributions in real nebulae, or a too soft ionizing radiation ﬁeld in the models.
Key words: H ii regions – galaxies: abundances – ISM: abundances – methods: data
analysis

1 INTRODUCTION

Thanks to their conspicuous emission lines, giant H ii regions
are used as indicators of the chemical composition of the in-
terstellar medium in galaxies, and have permitted important
advances in our understanding of the chemical evolution of
galaxies (see e.g. Esteban et al. 2004 and references therein).
While the so-called temperature-based abundance determi-
nations, which require the measurement of weak auroral lines
to measure the electron temperatures, are commonly con-
sidered the most reliable, strong-line methods have become
increasingly popular since the pioneering studies by Pagel

(cid:63) e-mail:natalia@astro.ufsc.br

c(cid:13) 2015 The Authors

et al. (1979) and Alloin et al. (1979) because they can also
be applied for distant galaxies.

Strong-line methods involve some restrictions, though:
They assume that giant H ii regions form a one (or two)
parameter(s) family and they need to be calibrated. Cal-
ibration can be done via a subsample of objects with
temperature-based abundances or using a grid of photoion-
ization models. The ﬁrst method is potentially biased, since
calibration samples are likely to have diﬀerent properties
than the samples one wishes to study. In particular, they
are biased against objects having intrinsically weak auroral
lines. Calibrations based on grids of photoionization models
do not have this problem (assuming the models cover all the
combinations of important parameters that are encountered
in nature and are realistic enough).

 
 
 
 
 
 
2

Vale Asari et al.

A large number of calibrations have been proposed.
If we label the methods by their abundance indicators
adopting the notation O3N2 for [O iii]/[N ii]1, O23 for
([O ii] + [O iii]S)/Hβ, N2Ha for [N ii]/Hα, etc., the most
popular ones are: O23 (Pagel et al. 1979), O3N2 (Alloin
et al. 1979), O23–O3O2 (McGaugh 1991), N2Ha (Storchi-
Bergmann et al. 1994), S23 (Vilchez & Esteban 1996). All
these methods with their numerous calibrations (here we
have quoted the pioneering ones) give very diﬀerent out-
comes (see e.g. Kewley & Ellison 2008 for a comparison of
the results).

Apart from this problem of leading to discrepant re-
sults, strong-line methods face two important issues. One
is that factors other than just the metallicity and the ion-
ization parameter inﬂuence the strength of the strong lines
emitted by giant H ii regions. This potentially leads to in-
correct inferences when applying the methods to compare
diﬀerent samples (see Stasi´nska 2010). The second issue is
that there are two regimes where the intensities of the strong
oxygen lines used for abundance determinations have the
same value with respect to Hβ: the low-metallicity and the
high-metallicity regimes. To resolve this bimodality, one uses
the intensity of the strong nitrogen line since, in the astro-
physical context, the N/O ratio is a function of metallicity.
This procedure, a priori reasonable, is however not totally
secure since the frontier between the two regimes is fuzzy.
For example, McGaugh (1994) adopts log [N ii]/[O ii] > −1
while Kewley & Ellison (2008) adopt > −1.2 for the high-
metallicity regime. The diﬀerence between these two values
may appear insigniﬁcant but can lead to somewhat diﬀerent
conclusions on metallicity trends within and among galax-
ies. In addition, this procedure does not allow one to pin
down objects with pathological N/O ratios – which may be
particularly interesting for unveiling peculiarities in the star-
forming histories of galaxies (Moll´a & Gavil´an 2010). Apart
from peculiar N/O ratios, the N/O vs O/H relation may be
diﬀerent at high redshifts, which would systematically bias
metallicity measurements based on the local N/O vs O/H
relation for high-redshift galaxies. Of course, methods us-
ing directly N/O as an indicator of the oxygen abundance
(e.g. the [N ii]/Hα method proposed by Storchi-Bergmann
et al. 1994 or the [N ii]/[O ii] method proposed by Kewley
& Dopita 2002) present the same drawback.

In this paper, we show that using the semi-strong lines
[Ne iii], [Ar iii] and He iλ5876, in conjunction with the classi-
cal strong lines, it is possible to estimate with reasonable ac-
curacy both the oxygen and the nitrogen abundance in giant
H ii regions without any prior assumption on the N/O ratio
and without the implicit priors of classical strong line meth-
ods regarding the ionizing radiation ﬁeld. The intensities of
these semi-strong lines have been listed in many papers re-
porting on deep spectroscopy of giant H ii regions, so those
lines must be present in the spectra for which only the most
common strong lines have had their intensities published.

1 In the entire paper the notations [N ii], [O ii], [O iii], [Ne iii],
[S ii], [S iii], [Ar iii], [Ar iv], and He i stand for [N ii]λ6584,
[O ii]λ3726 + λ3729, [O iii]λ5007, [Ne iii]λ3869, [S ii]λ6716 + λ6731,
[S iii]λ9069, [Ar iii]λ7135, [Ar iv]λ4711 + λ4740, and He iλ5876
respectively, [O iii]S for [O iii]λ4959 + λ5007, and [N ii]S for
[N ii]λ6548 + λ6584 (where the subscript S is used to denote a
sum of emission lines).

We construct a ﬁnely meshed grid of photoionization
models varying not only O/H and the ionization parameter
as has been done before (McGaugh 1991; Kewley & Dopita
2002; Blanc et al. 2015), but also N/O (like P´erez-Montero
2014). We use this grid to estimate the abundances of O
and N in giant H ii regions by means of standard Bayesian
inference methods (like Blanc et al. 2015). Unlike Blanc et al.
(2015), we do not assume an N/O vs O/H relation, and
explicitly explore variations in N/O. The main novelties of
our approach are that we consider variations in the hardness
of the ionizing ﬁeld, and that we extract information from
semi-strong emission lines in addition to the commonly used
strong lines.

The paper is organised as follows. In Section 2 we
present the spectroscopic data we have collected from the
literature to develop and test our method. In Section 3 we
show two extreme versions of the N/O versus O/H diagram
obtained from these data using a temperature-based method
and using the strong-line method of Pilyugin, V´ılchez &
Thuan (2010). In Section 4 we present our grid of photoion-
ization models, built using the code Cloudy (Ferland et al.
2013). In Section 5 we present our method, and in Section
6 we show our results for the N/O versus O/H diagram. In
Section 7 we provide a summary and elaborate on future
directions of work. Three appendices complement this pa-
per. The ﬁrst one presents a realistic sample of fake sources
constructed by selecting model nebulae from our grid. The
second one describes a few tests using these fake sources. The
third one compares the abundances derived by bond with
those obtained by other published methods on the same set
of observational data.

2 THE OBSERVATIONAL DATABASE

2.1 Giant H II regions in spiral galaxies

Data on giant H ii regions in spiral galaxies were gath-
ered from recent medium-resolution high-quality observa-
tional studies, mostly with very large telescopes (Keck, VLT)
whose high S/N allowed the measurement of auroral lines in
at least part of the observed samples. Apart from the large
database from van Zee et al. (1998), all the other works in-
volve Bresolin as ﬁrst or second author, which guarantees
a certain homogeneity in the treatment of the data. The
following sources were used (the letters correspond the ref-
erence labels in Table 1):

(a) Bresolin et al. (2005);
(b) Bresolin et al. (2004);
(c) Kennicutt et al. (2003);
(d) van Zee et al. (1998);
(g) Bresolin et al. (2009b);
(i) Bresolin (2007);
(j) Bresolin et al. (2010);
(k) Li et al. (2013);
(l) Zurita & Bresolin (2012);
(m) Bresolin et al. (2012);
(n) Goddard et al. (2011);
(p) Bresolin et al. (2009a).

All these sources give the line ﬂuxes corrected for ex-
tinction and the associated uncertainties. When the inten-
sity of Hα was not given, it was assumed to be equal to 2.86

MNRAS 000, 1–21 (2015)

Table 1. A sample of the data table available for download at http://bond.ufsc.br. Line ﬂuxes, uncertainties and upper limits (F, eF
and limF) are in units of Hβ, and references are labelled in column r as in Sections 2.1 and 2.2.

BOND: Bayesian O & N abundance Determinations

3

id

001
002
003
004
. . .
705
706
707
708

r

a
a
a
a
. . .
z
z
z
z

name

F3727

eF3727

F3869

eF3869

NGC 1232 02
NGC 1232 03
NGC 1232 04
NGC 1232 05
. . .
HSS1809+6612
Mrk259
SBS1428
S1657+575

3.9100
3.3300
2.0700
2.5300
. . .
2.5600
2.3900
1.8800
2.1300

0.3300
0.2500
0.1700
0.1600
. . .
0.1013
0.0615
0.0459
0.0834

–
0.2530
0.2910
0.0480
. . .
0.3150
0.3230
0.1870
0.2430

–
0.0350
0.0240
0.0060
. . .
0.0177
0.0099
0.0059
0.0157

. . .

. . .
. . .
. . .
. . .
. . .
. . .
. . .
. . .
. . .

F7135

eF7135

limF4363

limF5755

0.0610
0.0720
0.0820
0.0650
. . .
–
0.0820
0.0600
0.0740

0.0090
0.0130
0.0090
0.0050
. . .
–
0.0033
0.0022
0.0083

0.0140
0.0260
0.0038
0.0022
. . .
–
–
–
–

0.0140
0.0260
0.0038
–
. . .
–
–
–
–

times that of Hβ. Many sources list only the intensities of
lines that are used in the classical strong lines methods. i.e.
[O iii], [O ii] and [N ii]. For papers giving tables with the
ﬂuxes of all the lines seen in the spectra, we roughly esti-
mated the upper limits for the intensities of the lines that
were not detected, e.g. [Ar iii] or [O iii]λ4363. Upper limits
are estimated by taking twice the lowest uncertainty in mea-
sured lines. This, of course, is a stopgap solution in absence
of any direct information from the observers.

2.2 Blue compact galaxies

To increase the number of objects at low metallicities, we
use the sample of blue compact galaxies with high quality
spectra which were used by Izotov et al. (2007, reference
labelled z in Table 1) to derive the pregalactic helium abun-
dance. The abundances of O and N have been recomputed
in exactly the same way as for the giant H ii regions in spiral
galaxies.

2.3 Subsamples

For the needs of this study, we merge the two samples de-
scribed above, and then constitute several subsamples.

(i) Sample A is constructed from the entire merged sam-
ple by selecting all the objects with [O ii], [O iii] and [N ii]
available. It contains 708 objects. The line intensities and
associated uncertainties are reported in Table 1, available
for download from http://bond.ufsc.br.

(ii) Sample T is the subsample of sample A with available
temperature measurements from [O iii]λ4363/5007 and/or
[N ii]λ5755/6584; it contains 261 objects.

(iii) Sample B is the subsample fulﬁlling the minimum re-
quirements for the use of the bond method, i.e. with avail-
able ﬂuxes for [O ii], [O iii] and [N ii] and for the semi-strong
lines [Ne iii], [Ar iii] and He i. It contains 156 objects.

3 THE OBSERVED N/O VS O/H DIAGRAM

3.1 Computation of temperature-based O and N

abundances

The abundances of O and N were recomputed in a ho-
mogeneous way using 5-level atoms for O+, O++and N+.

MNRAS 000, 1–21 (2015)

The sources for the collision strengths and transition prob-
abilities are the following2. For O ii: Kisielius et al. (2009)
and Zeippen (1982); for O iii: Aggarwal & Keenan (1999),
Galavis, Mendoza & Zeippen (1997), and Storey & Zeippen
(2000); for N ii: Tayal (2011) and Galavis et al. (1997). The
electron densities were computed from the [S ii]λ6731/6717
ratio (when available) using the atomic data from Tayal &
Zatsarinny (2010) and Mendoza & Zeippen (1983). When
the [S ii]λ6731/6717 ratio was not available, it was assumed
that the electron density is equal to 100 cm−3.

The ionic abundances were computed with a two-zone
electron temperature scheme. The temperature derived from
[O iii]λ4363/5007 was used for O++ and the temperature de-
rived from [N ii]λ5755/6584 was used for O+ and N+. When
one of the two line ratios was missing the following classical
relation from Garnett (1992) was used:

T[N ii] = T[O ii] = 0.70 × T[O iii] + 3000K.

(1)

The O and N abundances were obtained using the clas-
sical assumption that oxygen is only in the form of O+ and
O++ in the H ii region and that N/O = N+/O+.

The uncertainties were estimated by a Monte-Carlo pro-
cedure using the uncertainties on the observed line ﬂuxes as
described in detail in Stasi´nska et al. (2013). Uncertainties
due to possible deviations from Eq. 1 as well from the N/O =
N+/O+ equation were not taken into account in the Monte-
Carlo procedure.

3.2 Comparison of N/O vs O/H diagrams

Fig. 1 compares the N/O vs O/H diagram using two diﬀerent
methods for the abundance determination. In the left panel
we used the temperature-based method as described above.
In the right panel we considered the ON method from Pilyu-
gin et al. (2010), which is based on the [O ii]/Hβ, [O iii]S/Hβ,
[N ii]S/Hβ, and [S ii]/Hβ emission line ratios. Both panels
show exactly the same 232 objects: From our sample T we
select only those objects where [S ii] has been measured,
which is necessary for the ON method. This is a strong line
method calibrated on a sample of H ii regions with available
temperature-based abundances. One can see that the two

2 Note that the atomic data used to compute the O and N abun-
dances are the same as the ones entering in the version of Cloudy
used to compute our grid of models.

4

Vale Asari et al.

Figure 1. The observed N/O vs O/H diagram for the objects of our sample T where [S ii] has been measured. (a) Diagram derived
from the temperature-based method. The large dots represent the nominal solution, the small background dots the 200 Monte-Carlo
realisations for each object, and the ellipses the covariances. (b) Diagram calculated by the ON method by Pilyugin et al. (2010) for the
same objects.

panels of Fig. 1 look very diﬀerent, with the left one show-
ing signiﬁcantly more dispersion than the right one. Note
that panel (a) shows some points which are really far away
from the main trend, while their associated uncertainties are
small.

Which of the two diagrams is closer to reality?
Temperature-based methods are often considered the most
reliable. However this assertion must be tempered by sev-
eral considerations. Temperature-based methods assume re-
lations between some parameters (like T[N ii] and T[O iii] or
N/O and N+/O+), whereas in fact some dispersion is ex-
pected (see Appendix A). They are also strongly dependent
on errors in the intensities of the weak lines that serve to de-
termine the temperatures. At the highest metallicities, im-
portant temperature gradients inside the H ii regions may
bias the abundance results, as shown by Stasi´nska (2005).
Shocks may contribute to the intensities of the auroral lines,
and falsify the results on abundances. Finally, if the electron
velocities in the ionized gas are not Maxwellian but rather
follow a κ distribution as suggested by Nicholls, Dopita &
Sutherland (2012), classical temperature-based methods will
result in underestimated abundances with respect to hydro-
gen. Because of all these reasons, it is not unreasonable to
think that part of the scatter observed in Fig. 1 may be ar-
tiﬁcial. On the other hand, the very tight relation between
N/O and O/H seen in Fig. 1 right may be unreal, since
the formulae developed by Pilyugin et al. (2010) tend to
strongly tighten any preexisting correlation (see Appendix
C, Fig. C5).

In what follows, we develop a new method to derive
oxygen and nitrogen abundances in giant H ii regions which
is much less aﬀected by the intensities of auroral lines than
the temperature-based methods and, unlike previous strong
line methods, does not involve any assumption on the N/O
ratio.

4 THE MODEL GRID

4.1 Deﬁnition of the grid

Because we want to avoid any biases in our method, we
need to construct a grid in which we vary all the determi-
nant parameters. If we view a giant H ii region as a nebula
powered by an instantaneous burst of star formation, the
main parameters for our problem are the oxygen and ni-
trogen abundances, the mean ionization parameter and the
age of the burst. The density distribution may also have a
certain importance.

Using Cloudy 13.03 (Ferland et al. 2013), we con-

structed a grid of models deﬁned as follows.

(i) The oxygen abundance on the scale of 12 + log O/H
goes from 6.6 to 9.4 in steps of 0.2 dex (15 values). The abun-
dances of all the heavy elements except nitrogen and carbon
are taken proportional to that of oxygen, as in Stasi´nska
et al. (2015). The helium abundance varies with the oxygen
abundances as in Stasi´nska et al. (2015).

(ii) The N/O ratio

logarithmic values
takes
−2, −1.5, −1, −0.5, 0. The abundance of carbon is linked to
that of nitrogen by log C/H = 0.48 + log N/H.

the

(iii) Dust is included in the models, being related to the
oxygen abundance in exactly the same way as in Stasi´nska
et al. (2015), following the works of R´emy-Ruyer et al. (2014)
and Draine (2011).

(iv) The mean input ionization parameter, deﬁned by
eq. 4 of Stasi´nska et al. (2015), takes the logarithmic val-
ues −1, −1.5, −2, −2.5, −3, −3.5, −4. Note that the real mean
ionization parameter of the computed model is somewhat dif-
ferent from the input value, since it depends on the electron
temperature and on the partial absorption of the ionizing
photons by dust (see ﬁg. B2 of Stasi´nska et al. 2015). In the
remaining of the paper we denote this mean input ionization
parameter as U.

(v) The starburst age takes the values of 1, 2, 3, 4, 5 and
6 Myr. The spectral energy distribution of the ionizing ra-
diation is obtained from the population synthesis code Pop-

MNRAS 000, 1–21 (2015)

7.07.58.08.59.0��+logO/H−1.5−1.0−0.50.0logN/O���a)Te7.07.58.08.59.0��+logO/H−1.5−1.0−0.50.0logN/O���b)ONBOND: Bayesian O & N abundance Determinations

5

Star (Moll´a, Garc´ıa-Vargas & Bressan 2009) for a Chabrier
(2003) stellar initial mass function and for the appropriate
metallicity, obtained by interpolation.

(vi) In order to assess the eﬀect that geometry might
have, we consider two density distributions. One is a ﬁlled
sphere of density n = 100 cm−3, the other is a thin spherical
shell of same density. Roughly, the ﬁrst scenario can corre-
spond to a relatively young H ii region and the second to an
evolved one. Clearly these choices are very simplistic and the
role of the density distribution should be explored further.
The mathematical deﬁnitions of the shell and ﬁlled sphere
are detailed in section 4.1 of Stasi´nska et al. (2015).

All the models are computed from the inner boundary
until the ratio of ionized hydrogen to total hydrogen density
falls below 0.02.

4.2 Some characteristics of the grid

Fig. 2 shows the entire grid of computed models in two
planes frequently used to contemplate observations or mod-
els of H ii regions. One is the [O iii]/Hβ vs [N ii]/Hα plane
often used for excitation diagnostics (commonly called the
BPT diagram after Baldwin, Phillips & Terlevich 1981), and
the other is [O iii]λ5007 + 4959/[O ii]λ3727 vs ([O iii]λ5007 +
4959 + [O ii]λ3727)/Hβ introduced by McGaugh (1991) to de-
rive the oxygen abundance and to which we will refer as the
McG diagram. The models for ﬁlled spheres are displayed
in the left column, while the models for shells are displayed
in the right column. Each row of panels corresponds to a
given starburst age, increasing downwards. Fig. 3 is a zoom
in the BPT and McG planes for the 1 Myr ﬁlled sphere sub-
grid, which serves to better illustrate the coloured lines and
points drawn in Fig. 2. Models joined with full coloured lines
have the same O/H and same N/O (the colour is deﬁned by
the value of O/H and runs from purple to red following the
rainbow colours as O/H increases), while models joined with
thin grey lines have the same input value of the mean ion-
ization parameter. In all the panels the model curves are
superimposed on the observational points.

The ﬁrst thing we can notice is that the entire grid ap-
pears to cover most of the observational points in these two
planes, which is what we were looking for, i.e. the fact that
the observational points are diﬃcult to see in the ﬁgure is
a feature, and not a ﬂaw. However, in the McG diagram, a
small proportion of objects appears slightly to the right of
the grid, at any of the ages considered, meaning that in this
region the electron temperature computed by the models is
probably lower than in real H ii regions. We have explored
several possibilities to reduce the problem by playing with
dust and abundance ratios and density, but we did not suc-
ceed. Anyway, the discrepancy is much smaller than in the
studies of McGaugh (1994) and Dopita et al. (2013, espe-
cially for their grid with a κ distribution of electrons). We
think that the discrepancy we ﬁnd is due to our models still
not reproducing exactly real objects rather than to observa-
tional errors. Nevertheless, the magnitude of the problem is
suﬃciently small to warrant our further use of the grid for
abundance determinations. Indeed, we ﬁnd that excluding
objects that fall oﬀ grid do not change our results.

The two diﬀerent density distributions (ﬁlled sphere and
empty shell) produce only slight apparent diﬀerences in the

MNRAS 000, 1–21 (2015)

grid but, as we will see in Appendix B, this is suﬃcient to
aﬀect the O/H and N/O ratios by up to 0.05 dex. More
realistic density distributions, such as a core-halo density
distribution or a constant pressure distribution may have a
larger impact.

The variations in N/O obviously have an impact on the
BPT diagram but they also aﬀect the McG diagram at high
metallicities, since they aﬀect the cooling rates. In other
words, if the N/O ratio is abnormally high, this would bias
the O/H derived from strong-line methods not accounting
for a possible scatter in N/O.

We also note that at the highest metallicities the curves
of equal chemical composition become ill-behaved. This is
because, at such metallicities, most of the cooling occurs
through the infrared ﬁne-structure lines whose intensity is
not very sensitive to temperature. Therefore a small change
in the physical conditions of the gas may alter the electron
temperature considerably, which, in turn, strongly aﬀects
the intensity of the [O iii]λ5007 line. This means that, for
12+log O/H greater than, say, 9.2, the real error in the abun-
dances derived from optical lines is probably larger than can
be estimated from our grid.

Fig. 2 shows that the starburst age modiﬁes the shape
of the model grid, especially in the McG diagram, so that
assuming the same age for all the H ii regions will produce
signiﬁcant errors in the oxygen abundance determination.
What actually changes from one age to another is the ‘hard-
ness’ of the ionizing radiation ﬁeld, i.e. its capacity of heating
the surrounding medium by photoionization.

The hardness can be viewed as the ratio Q(He0)/Q(H0),
where Q(He0) is the number of photons above 24.6 eV and
Q(H0) is the number of photons above 13.6 eV. Fig. 4 shows
the variations of Q(He0)/Q(H0) as a function of time for
the six PopStar metallicities. Generally, the ionizing radi-
ation ﬁeld softens as metallicity increases. However, during
the Wolf-Rayet phase the radiation ﬁeld hardens and this
eﬀect is higher at high metallicity. As a result, the radia-
tion ﬁeld is the hardest at the highest metallicities and at
ages around 3–5 Myr. This implies that for these ages the
([O iii]S + [O ii])/Hβ ratio can reach quite high values at high
metallicities.

In reality, the process of star formation may not be in-
stantaneous, as in the PopStar models, but extend over a
certain time. In practice, what is important for the line in-
tensities is not so much the age of the ionizing stellar popu-
lation or the regime of star-formation, but rather the hard-
ness of the resulting ionizing radiation ﬁeld. Our models with
diﬀerent ages should thus be viewed as models for spectral
energy distributions of diﬀerent hardness.

Fig. 5 shows the variations of ([O iii]S + [O ii])/Hβ with
respect to O/H for models with log U = −2, the curves
representing the sequences of models being coloured ac-
cording to the value of Q(He0)/Q(H0). It is clear that for
12 + log O/H larger than, say, 7.5, the primary metallic-
ity indicator, ([O iii]S + [O ii])/Hβ, is strongly dependent on
Q(He0)/Q(H0), reinforcing the relevance of considering this
eﬀect in the modelling.

6

Vale Asari et al.

Figure 2. The model grid on [O iii]/Hβ vs [N ii]/Hα (BPT), and [O iii]S/[O ii] vs ([O iii]S +[O ii])/Hβ diagrams for various ages (1 to 6
Myr) and geometries (ﬁlled sphere or empty spherical shell, indicated at the top of the ﬁgure). The aim of the postage-stamp size panels
is twofold. First, one can see at a glance how the diﬀerent parameters change the shape of the model subgrids. Second, the model grid is
overplotted on the observational data, which allows one to judge how well the grid covers the observational points. The fact that most
points are hidden behind the grid is thus a fact to be celebrated. The colour-coding of grid lines is detailed in Fig 3, which zooms into
two panels. A colour version of this ﬁgure is available in the electronic edition.

MNRAS 000, 1–21 (2015)

−4−3−2−10log[N��]/Hα−4−202log[O���]/HβFilledsphere�Myr−2−101log([O��]+[O���]S)/Hβ−202log[O���]S/[O��]�Myr−4−3−2−10log[N��]/Hα−4−202log[O���]/HβSphericalshell�Myr−2−101log([O��]+[O���]S)/Hβ−202log[O���]S/[O��]�Myr−4−3−2−10log[N��]/Hα−4−202log[O���]/Hβ�Myr−2−101log([O��]+[O���]S)/Hβ−202log[O���]S/[O��]�Myr−4−3−2−10log[N��]/Hα−4−202log[O���]/Hβ�Myr−2−101log([O��]+[O���]S)/Hβ−202log[O���]S/[O��]�Myr−4−3−2−10log[N��]/Hα−4−202log[O���]/Hβ�Myr−2−101log([O��]+[O���]S)/Hβ−202log[O���]S/[O��]�Myr−4−3−2−10log[N��]/Hα−4−202log[O���]/Hβ�Myr−2−101log([O��]+[O���]S)/Hβ−202log[O���]S/[O��]�Myr−4−3−2−10log[N��]/Hα−4−202log[O���]/Hβ�Myr−2−101log([O��]+[O���]S)/Hβ−202log[O���]S/[O��]�Myr−4−3−2−10log[N��]/Hα−4−202log[O���]/Hβ�Myr−2−101log([O��]+[O���]S)/Hβ−202log[O���]S/[O��]�Myr−4−3−2−10log[N��]/Hα−4−202log[O���]/Hβ�Myr−2−101log([O��]+[O���]S)/Hβ−202log[O���]S/[O��]�Myr−4−3−2−10log[N��]/Hα−4−202log[O���]/Hβ�Myr−2−101log([O��]+[O���]S)/Hβ−202log[O���]S/[O��]�Myr−4−3−2−10log[N��]/Hα−4−202log[O���]/Hβ�Myr−2−101log([O��]+[O���]S)/Hβ−202log[O���]S/[O��]�Myr−4−3−2−10log[N��]/Hα−4−202log[O���]/Hβ�Myr−2−101log([O��]+[O���]S)/Hβ−202log[O���]S/[O��]�MyrBOND: Bayesian O & N abundance Determinations

7

Figure 3. Zoom into the top left panels of Fig. 2. The lines mark the region covered by a subset of our grid of photoionization models (those
with starburst ages of 1 Myr and a ﬁlled sphere nebular geometry). The small dots mark our observational data, which are mostly hidden
behind the grid. Triangles pointing up, down, and squares mark a few values of O/H, N/O and U, respectively. The colours of the grid lines
change with the value of O/H, going from red for the largest values to purple for the lowest one, following the order of the rainbow. Lines
of the same colour have the same O/H but diﬀerent N/O. Models with the same ionization parameter U are linked by a grey line. Readers
interested in exploring our grid in detail can zoom in the pdf version of the paper or can download an electronic ﬁle with our grid of models
from the BOND website (http://bond.ufsc.br) or the 3MdB database (https://sites.google.com/site/mexicanmillionmodels/).

Figure 4. The values of Q(He0)/Q(H0) as a function of time for
the PopStar models at diﬀerent metallicities. The hardness of the
radiation ﬁeld in an H ii region tends to decrease with age, but
the Wolf-Rayet phases wreaks havoc on this simple view.

5 DESCRIPTION OF THE BOND METHOD

Our grid of models spans a wide range of physical param-
eters: N/O, O/H, U, the hardness of the radiation sources,
and the density proﬁle of the nebula. Although we are only
interested in inferring the nitrogen and oxygen abundances,
we need to constrain the other nuisance parameters. This
section explains our choices of observational constraints and
the formalism for our Bayesian Oxygen and Nitrogen abun-
dance Determinations (bond) method.

MNRAS 000, 1–21 (2015)

Figure 5. ([O iii]S + [O ii])/Hβ vs O/H for log U = −2 and all the
values of N/O, ages and density structures in our grid coloured by
Q(He0)/Q(H0). In order to see the trends better, we have created
a very ﬁne interpolated grid for this ﬁgure (sampled 0.02, 0.05,
0.05 dex in O/H, N/O and U respectively). Note that for high
metallicities the ([O iii]S + [O ii])/Hβ ratio does not pin down the
value of the O/H abundance. A colour version of this ﬁgure is
available in the electronic edition.

5.1 Observational constraints

5.1.1 Uncovering N/O and O/H

Our ﬁrst
extinction-corrected line ratios log [N ii]/Hβ,

observational

constraints

set

the
are
log [O ii]/Hβ

of

−5−4−3−2−10log[N��]/Hα−4−20log[O���]/HβlogU��+logO/HlogN/OFilledsphere-�.�-�.�-�.�-�.�-�.�-�.�-�.��.��.��.��.��.��.��.��.�-�.�-�.�-�.�-�.��.�-�.�-�.�-�.�-�.�−101log([O��]+[O���]S)/Hβ−202log[O���]S/[O��]�Myr-�.�-�.�-�.�-�.�-�.�-�.�-�.��.��.��.��.��.��.��.��.�0246810age[Myr]−4−20logQHe0�QH0�.���Z⊙�.��Z⊙�.�Z⊙�.�Z⊙�.�Z⊙�.�Z⊙678910��+logO/H−2−101log([O��]+[O���]S)/Hβ0.10.20.3QHe0�QH08

Vale Asari et al.

Figure 6. [Ar iii]λ7135/[Ne iii]λ3869 vs [O iii]S/[O ii] for age 2
Myr and ﬁlled sphere of our grid (the same used in Fig. 5). For
each value of N/O and U, we tag a model as being in the high or
low-O/H branch from the ([O iii] + [O ii])/Hβ vs O/H diagram. We
colour the low and high branches in blue and red, respectively.
Note how the two branches are almost cleanly separated in this
diagram, with very little overlap of blue and red points. A colour
version of this ﬁgure is available in the electronic edition.

and log [O iii]/Hβ. The formal assumption is that those log-
arithmic line ratios are Gaussianly distributed and indepen-
dent. Using line luminosities instead of line ratios is mean-
ingless for our models, since the models are not deﬁned by
luminosities but by ionization parameters.

The physical reasoning behind using this set of line ra-
tios is that [N ii]/[O ii], ([O iii] + [O ii])/Hβ, and [O iii]/[O ii]
are proxies for N/O, O/H and U, respectively. Since we are
using only strong lines, there is no constraint on the elec-
tron temperature. That way, because ([O iii] + [O ii])/Hβ vs
O/H is bivalued, this ﬁrst set of constraints ﬁnds bivalued
solutions for O/H.

We believe that using carefully chosen emission lines is
better than using all information available for this problem.
We therefore choose not to include [S ii] for two reasons. [S ii]
comes from the outskirts of the nebula, which do not coincide
with the region where the other strong lines are produced.
Any density structure will change [S ii] in relation to the
other lines. Second, the S/O ratio in H ii regions could be
subject to variations due to diﬀerent production sites of S
and O (e.g. it has recently be proposed by Delgado-Inglada
et al. 2015 that intermediate-mass stars could contribute to
the global oxygen budget in galaxies) and to diﬀerent dust-
depletion schemes.

5.1.2 Eliminating the bimodality

As explained in the introduction, using nitrogen to break
the ([O iii] + [O ii])/Hβ degeneracy with O/H is not satisfac-
tory since the relation between the N/O ratio and O/H is
likely dispersed. It is better to use a physical argument that
does not depend on astrophysical conditions, like one based
on the electron temperature, which will be low in the high
abundance regime and high in the low abundance one.

We need a line ratio that is easy to observe, and

that depends strongly on the electron temperature and
weakly on ionization conditions and abundance ratio. The
[Ar iii]/[Ne iii] ratio fulﬁls these requirements. The [Ar iii]
and [Ne iii] lines have diﬀerent excitation thresholds (1.7
and 3.2 eV, respectively), so diﬀerent dependencies on the
electron temperature. Argon and neon are two primary el-
ements; in addition, they are both rare gases not suspected
of dust depletion, so their abundance ratio is expected to be
constant. The [Ar iii] and [Ne iii] lines do not arise exactly
from the same zone, the ionization potential of Ne++ being
higher than that of Ar++, but we can use the [O iii]/[O ii]
ratio to ﬁgure out what the ionization is.

Fig. 6 shows [Ar iii]/[Ne iii] as a function of [O iii]/[O ii]
for our subsample of models corresponding to an age of
2 Myr and a ﬁlled sphere nebula. The colours indicate
the abundance regime: Blue corresponds to the low metal-
licity branch in the ([O iii] + [O ii])/Hβ vs O/H diagram,
and red to the high metallicity branch. We can see how
using the [Ar iii]/[Ne iii] ratio in conjunction with the
[O iii]/[O ii] one separates the two branches. In practice,
we use log [Ar iii]/Hβ and log [Ne iii]/Hβ separately as our
constraints because they are closer to an ideal Gaussian dis-
tribution than [Ar iii]/[Ne iii]. Also, because the grid was
not designed to closely explain [Ar iii]/[Ne iii], we add an
extra noise e in quadrature to [Ar iii]/Hβ and [Ne iii]/Hβ
and marginalise it away, as explained in Section 5.3.1.

The [Ar iii]/[Ne iii] as a function of [O iii]/[O ii] for all
starburst ages and scenarios is a bit fuzzier, showing some
superposition of high and low metallicity grid points. For
those cases, it is useful to include an extra constraint to
exclude the grid points on the wrong O/H branch. We ﬁnd
that using the [O iii]λ4363 and [N ii]λ5755 upper limits as
additional criteria for the electron temperature improves our
solutions. The reasoning for using upper limits is that, if
the [O iii]λ4363 (or [N ii]λ5755) line is not observed, and
the observational upper limit for its intensity is below the
expected value in the low metallicity regime, this implies
that we are in the high metallicity regime. We include those
upper limits in our inference as discussed in Section 5.3.2.
We check that this does not force our solutions to match the
observed [O iii]λ4363 or [N ii]λ5755.

5.1.3 Characterising the radiation ﬁeld

Line ratios such as ([O iii]/[O ii])/([S iii]/[S ii]) (Vilchez &
Pagel 1988) or ([Ar iv]/[Ar iii])/([O iii]/[O ii]) (Stasi´nska
et al. 2015) can be used to estimate the mean eﬀec-
tive temperature of the radiation ﬁeld. However, [Ar iv]
is often too weak to be measured in giant H ii regions.
([O iii]/[O ii])/([S iii]/[S ii]) does depend on U (see Stasi´nska
et al. 2015), but, because it depends on [S ii], it suﬀers from
the problem that it is aﬀected by the density distribution in
real H ii regions mentioned above (Section 5.1.1).

Another potential indicator is He iλ5876/Hβ which, as
long as helium is not fully ionized in the H ii region, is de-
pendent on the spectral energy distribution of the ionizing
stars. The He i/Hβ ratio, however, depends on the metal-
licity, since the dependence of the He i and Hβ line emis-
sivities with electron temperature is not the same. Fig. 7
shows He i/Hβ as a function of O/H in our grid of models,
coloured according to Q(He0)/Q(H0) with the same colour
scale as in Fig. 5. We see that, with the information on O/H

MNRAS 000, 1–21 (2015)

−2−1012log[O���]S/[O��]−2−1012log[Ar���]/[Ne���]BOND: Bayesian O & N abundance Determinations

9

Figure 7. O/H vs He iλ5876/Hβ coloured by Q(He0)/Q(H0) for
log U = −2 and all the values of N/O, ages and density struc-
tures in our grid (the same used in Fig. 5). For a given O/H,
He iλ5876/Hβ is a good proxy of Q(He0)/Q(H0). For the highest
Q(He0)/Q(H0), however, He iλ5876/Hβ does not change much (blue
and purple points all fall on the same region). The sparsity of the
stellar ages in our grid shows up as the large uncovered parts of
this diagram. A colour version of this ﬁgure is available in the
electronic edition.

given by the other lines used in bond, He i/Hβ allows one to
estimate Q(He0)/Q(H0) up to a value of ∼ 0.2. This is not en-
tirely satisfactory, because Fig. 5 shows that at the highest
metallicities, the value of ([O iii]S +[O ii])/Hβ depends on
Q(He0)/Q(H0) also at values larger than 0.2. In this paper we
restrict ourselves to using He i/Hβ to characterise the hard-
ness of the radiation ﬁeld. In future works, when large data
bases of giant H ii regions with fully described deep spectra
become available, it will be possible to add information on
[Ar iv]/[Ar iii]. We also allow an extra noise e and integrate
it out for log He i/Hβ as described in Section 5.3.1.

5.2 The probabilistic formalism

We aim to ﬁnd the oxygen and nitrogen abundances of an
H ii region by comparing its observed lines O to our grid of
models. A given observed line is characterised by its intensity
and uncertainty (o j, σ j), and an H ii region by its j = 1..J
emission lines:

O ≡ {O j} = {o j, σ j},

(2)

where the curly braces deﬁne a set of values spanning the
rightmost index (i.e. j for the equation above). Each model
M in our grid is deﬁned by its i = 1..I model parameters mi,
and generates a set of computed line intensities {c j}:

M ≡ {{mi}; {c j}}.

(3)

Our grid of models spans a wide range of values not
only for our two parameters of interest (oxygen and nitro-
gen abundances), but also for the ionization parameter, star-
burst ages and nebular geometry. While the latter play an
important role in the photoionization modelling of an H ii
region, we do not wish to infer them. From a pragmatic
point of view, a Bayesian formalism oﬀers a framework to

MNRAS 000, 1–21 (2015)

Figure 8. Comparison between a Gaussian, in orange, centred in
∆ j and dispersion σ j = 0.02 dex (the typical uncertainty of semi-
strong line ratios [Ar iii]/Hβ, [Ne iii]/Hβ and log He iλ5876/Hβ in
our sample B), and a sum of Gaussians, in blue, with dispersions
+ e2)1/2 for e between 0.01 and 0.43 dex (corresponding to 2 to
(σ2
j
100 per cent of the measured line intensity). Both functions are
scaled so that their areas are equal to unity.

marginalise away those nuisance parameters by simply inte-
grating them out. This comes with the cost of writing down
the posterior probability so that the dimensions of our prob-
ability function still make physical sense after those integrals
are performed (see e.g. Hogg 2012). The posterior probabil-
ity density function (PDF) for a model M given the observed
data O and any other relevant background information B is
p(M|O, B) = N p(M|B) p(O|M, B),

(4)

where PDFs are written as p, and N is a normalisation con-
stant so that the posterior integrates to unity over all the
parameter space. The PDFs on the right hand side of the
equation are the prior probability of the model parameters,
and the likelihood of observing O assuming M and B are
true. In what follows we will discuss our generative model
for the likelihood and our choice of the prior.

5.3 Generative model for data points

5.3.1 Partially marginalised likelihoods

We assume Gaussian uncertainties for our constraints, which
are the logarithmic line ﬂuxes with respect to Hβ. This is a
good approximation given that we consider high S/N obser-
vations, so that Hβ is very well determined and the line ratios
noise uncertainties must deviate very little from a Gaussian
distribution. The likelihood of observing an emission line
O j = (o j, σ j) given the model M and the background infor-
mation B, plus an extra source of noise with dispersion e is

p(O j|e, M, B) = N (cid:48)

1

exp





−

(c j − o j)2
+ e2)
2(σ2
j



,

+ e2

(5)

(cid:113)

σ2
j

where N (cid:48) is a normalisation constant.

The term e was introduced in order to account for devi-
ations in emission line ratios not contemplated in our mod-
els. For instance, we use [Ar iii]/Hβ and [Ne iii]/Hβ as con-
straints, but our models were not meant to reproduce the

6810��+logO/H0.00.10.20.3HeI����/Hβ0.10.20.3QHe0�QH0−1.0−0.50.00.51.0∆j05101520LjGaussian(σ=0.02)Sumofgaussians(σ=0.02;e=0.01..0.43)10

Vale Asari et al.

argon and neon abundance dispersions in nature. For con-
straints involving strong lines ([N ii], [O ii], [O iii]) we simply
set e = 0. For constraints based on semi-strong lines ([Ar iii],
[Ne iii], He i), we consider e in a interval of 0.01 to 0.43 dex
(i.e. for an extra noise from 2 to 100 per cent of the measured
line intensity). Since we are not interested in e, we integrate
it out to calculate the marginalised likelihood for O j:

L j = p(O j|M, B) = N (cid:48)(cid:48)

(cid:90)

p(e|M, B) p(O j|e, M, B) de,

(6)

where N (cid:48)(cid:48) is yet another normalisation constant. In practice
we calculate L j as a sum of Gaussians for logarithmically
spaced values of e. Using only 20 Gaussians for this sum
guarantees that the numerical integral with log-spaced e is
equivalent down to ∼ 10−4 to a numerical integral with linear
spacing of 10−6 dex.

Fig. 8 compares a Gaussian with σ j = 0.02 dex (a typical
value for the semi-strong lines in our sample) centred in ∆ j =
c j − o j and e = 0 to a sum of Gaussians with variances σ2
+
j
e2, with e varying from 0.01 to 0.43 dex. The marginalised
likelihood for the sum of Gaussians is much broader than the
likelihood for a single Gaussian, but note that it eventually
drops to zero. This is an eﬀect brought about by the term
+ e2)−1/2 in Eq. 5, which penalises very large values of e.
(σ2
j
Therefore, although we allow e to vary, the likelihood is still
shaped by the data. What happens in practice is that we
probe regions of the emission line space in our model grid
which are far from the nominal observed measurement.

5.3.3 Taking all constraints into account

Assuming that the observed line intensities O j are indepen-
dent, the likelihood for all observed line intensities O for a
given model M is

p(O|M, B) =

(cid:89)

j

p(O j|M, B).

(8)

(cid:80)

ln p(O|M, B)

this down as

j (c j − o j)2/(σ2
j

We usually write

=
j ln p(O j|M, B). Expressing the likelihood in natural loga-
rithmic highlights two points. First, we emphasise that our
code adds up instead of multiplying values to minimise nu-
merical errors. Second, we see that, in the case of a ﬁxed
extra noise source (constant e), the likelihood reduces to
ln[−0.5 (cid:80)
+ e2)] ≡ −0.5χ2 apart from a constant
of proportionality. We warn however that the familiar χ2
minimisation should be looked with suspicion when applied
to abundance determinations. First, when strong and weak
lines are all ﬁtted at the same time, weak lines are pe-
nalised for having larger uncertainties. Albeit formally cor-
rect, this lessens the importance of weak lines while they
may carry important information, for example, [O iii]λ4363
or [N ii]λ5755, which pin down the electron temperature.
Second, the χ2 can compensate one badly ﬁtted line with
one that is extremely well ﬁtted. The correct way to ﬁt pho-
toionization models would be to ﬁt each line within an ap-
propriate error-bar, which is not ensured by calculating the
likelihood by the χ2. To some extent our method is immune
to this problem because we only use strong and semi-strong
lines as constraints that strongly shape the likelihood, while
weak lines are only used as upper limit measurements.

5.3.2 Treating weak lines

5.4 Adaptive octree grids

We do not constrain weak line intensities such as [O iii]λ4363
or [N ii]λ5755, but we use their upper limits as an additional
temperature constraint. The upper limit u j of the weak line
j is deﬁned as the 2-σ detection limit for a given spectrum.
The likelihood for weak lines is a step function that masks
out models whose computed emission lines c j are above the
upper limit u j:

p(O j|M, B) ∝

(cid:40)

1
0

if c j (cid:54) u j,
if c j > u j.

(7)

This constraint is useful when the [Ar iii]/[Ne iii] ratio
alone is unable to distinguish the low and high tempera-
ture branches. Imposing an upper limit on [O iii]λ4363 or
[N ii]λ5755 ﬂags out the solutions for which the tempera-
tures are too high.

This constraint is peculiar, since it is only available for
undetected [O iii]λ4363 or [N ii]λ5755 lines. Increasing the
quality of the observations means that [O iii]λ4363 and/or
[N ii]λ5755 would be detected and we would not be able to
use this constraint any longer. In order to avoid the asym-
metry of having this constraint applied for some objects
and not others, we impose our upper limit criteria even for
sources where [O iii]λ4363 and/or [N ii]λ5755 are detected.
This procedure also guarantees that higher S/N data are
not penalised. We thus assume that the upper limit for a
detected line is its intensity plus its 2-σ uncertainty, which
again helps clear out solutions with too high a temperature.

The missing piece to calculate the posterior is the prior PDF.
Our background knowledge B (hence our prior) is encoded
in the sampling of our model grid. We follow the reasoning
by Blanc et al. (2015) and assume a ﬂat logarithmic prior
on O/H, N/O and U. This is equivalent to a Jeﬀrey’s prior
for a Gaussian distribution with ﬁxed standard deviation.
The age of the ionizing source is linearly sampled, and we
have two nebular geometries (a ﬁlled sphere and a spherical
shell); we assume a ﬂat prior for those.

Our original grid is ﬁnely meshed in O/H (0.2 dex),
but coarse in all other parameters (0.5 dex in U and N/O,
6 starburst ages from 1 to 6 Myr and two nebular geome-
tries). The emission line space is consequently sparsely sam-
pled. When uncertainties in the data are much smaller than
the distance between grid models, very few models will be
near the observed data. Creating a ﬁner grid can mitigate
this problem. Running a suﬃcient number of photoioniza-
tion models to ﬁll in the ionizing source ages and nebula
density structures adequately would however be unneces-
sarily time-expensive. Interpolating our grid solves the grid
sparsity problem quickly and is a good approximation, since
the emission line intensities vary smoothly with those pa-
rameters once the initial grid is dense enough. We thus in-
terpolate our original grid in log O/H, log U and log N/O,
but not in starburst age and geometries, which would be
dangerous and meaningless, respectively. A ﬁner grid in the
latter parameters would require running more photoioniza-
tion models, a time-consuming task both for generating the

MNRAS 000, 1–21 (2015)

BOND: Bayesian O & N abundance Determinations

11

the threshold. This procedure creates a grid that is ﬁner in
the parameter space region where the posterior probability
is higher.

Fig. 9 shows the ﬁnal octree grid for two objects in sam-
ple B, compressed in the N/O vs O/H space. The dots are
the centres of the original 0.1 dex-sampled grid cells, and the
green scale represents the ﬁnal number of subcells. Swathes
of white space stand for grid cells that have been removed
due to contributing too little to the ﬁnal probability. For
our sample B, the median number of cells is ∼ 65, 000 (for
a minimum and a maximum of 31, 604 and 79, 555), and all
the grid cells usually go below the dP threshold after 6 iter-
ations, which yields subcells 8−6 = 1/262, 144 times smaller
than the original cell (i.e. which span 0.0015625 dex in O/H,
N/O and U). The average time to run bond for one source
with the octree sampling algorithm in a 1-core 1.7 GHz CPU
is 20 seconds.

5.5 Summarising the posterior PDF

Having calculated the full posterior p(M|O, B), we can inte-
grate out all parameters we are not interested in and leave
out the PDF as a function of only the oxygen and nitro-
gen abundances. The joint posterior PDF for N/O and O/H
(joint PDF for short) is calculated as

p({z, n}|O, B) =

(cid:88)

i

p({zi = z, ni = n, ui, ti, gi}|O, B) ∆ui,

(9)

where z, n, u, t, g are the model input parameters log O/H,
log N/O, log U, age and geometry, respectively, and the sub-
script i tags each model in the grid. The sum is made over
all models with the same values of log O/H and log N/O,
and ∆ui takes into account the variable octree cell size in
log U. The expectation values for a model input parameter
mi or a computed emission line c j are given respectively by

E({mi}|O, B) = N

(cid:88)

i

{mi} p({zi = z, ni = n, ui, ti, gi}|O, B) ∆ui,

E({c j}|O, B) = N

(cid:88)

i

{c j} p({zi = z, ni = n, ui, ti, gi}|O, B) ∆ui.

(10)

(11)

The bond code computes diﬀerent summaries for the
joint PDF: the maximum a posteriori (MAP, i.e. the point
of highest probability of the joint PDF), the central point
of the credible regions (i.e., the regions on the N/O vs O/H
plane of highest probability) that encompass 5, 50, 68 and 95
per cent of the joint PDF, plus its covariance ellipses (scaled
so that its area is the same as that of the credible region).
We also calculate the marginalised posterior PDF for
several parameters and emission lines. The marginalised pos-
terior PDFs are summarised by their average, median, and
mode (i.e. the peak), plus their dispersion, and the extremes
of their 50, 68 and 95 percent equal-tailed (i.e. calculated
from the percentiles) and highest density intervals.

For the sake of clarity, in what follows we show our re-
sults in three descriptions only: the joint PDF, the maximum
a posteriori (MAP) plus the 68 per cent credibility ellipse,
and the marginalised median plus the 68 equal-tailed inter-
val. Section 6.2 discusses the diﬀerences in the summaries of
the posterior PDF.

Figure 9. Original grid cell centres (dots) and the ﬁnal number
of octree grid cells (green scale) for two sources in our sample.
Panel a is for an H ii region in NGC 1232 (slit number 5 from
Bresolin et al. 2005) and panel b for the blue compact dwarf
HS0837+4717.

grid and running the bond code. We choose to keep ages
and geometries ﬁxed, which pop up as discontinuities and
multimodal solutions in our posterior PDFs (take a sneak
peek at e.g. the ‘islands’ of solutions in Fig. 11).

We create a diﬀerent interpolated grid adapted to each
object using an octree sampling algorithm. Octree grids are
usually applied to sample a Cartesian 3D space, and are
used extensively in video games, computer graphics, hydro-
dynamics simulations, and Monte Carlo radiative transfer
codes (e.g. Saftly et al. 2013 and references therein).

We start oﬀ with a grid containing 226, 548 models sep-
arated by 0.1 dex in O/H, U and N/O. Starburst ages and
nebular geometries are kept ﬁxed. Each grid point represents
a cell of volume dV = d(log O/H) d(log N/O) d(log U). For each
object, we calculate the posterior PDF for all grid points,
and the contribution dP = p(M|O, B) dV of each grid cell to
the total probability.

After this ﬁrst run, we remove grid cells which con-
tribute too little to P to speed up the calculations (the de-
fault option is to remove grid points for which dP < 10−20
considering each age and geometry scenario separately).
Grid cells where dP (cid:62) 10−4 are subdivided into eight sub-
cells, with each subcell corresponding half the size of the
parent cell in O/H, U and N/O. The 10−4 threshold was
chosen as a compromise between the precision of the poste-
rior PDF and the computing time. Smaller thresholds create
very large octree grids, whilst our nominal solutions (i.e. the
posterior summaries, see Section 5.5) for log O/H, log N/O
change by less than 0.02 dex. We recalculate the posterior
with the new octree grid, subdivide the cells where needed,
and reiterate until there is no remaining cell with dP above

MNRAS 000, 1–21 (2015)

7.58.08.59.0−2−10logN/Oa7.58.08.59.0��+logO/H−2−10logN/Ob01234logNpointsc01234logNpointsd12

Vale Asari et al.

5.6 A worked example

Fig. 10 shows an example of the inﬂuence of each set of con-
straints on the PDFs for an H ii region in NGC 1232. Each
row of plots shows the eﬀect of cumulatively adding a set of
constraints to the joint PDF of N/O and O/H and to the
PDF of the emission line ratios included in the likelihood
calculation ([N ii]/Hβ, [O ii]/Hβ, [O iii]/Hβ, [Ar iii]/Hβ,
[Ne iii]/Hβ and He i/Hβ). The joint PDF is represented
by a blue-scale map. The grey bands mark ±1σ of the
temperature-based values for O/H and N/O, and the purple
bands delimit ±1σ of the observed line ratios.

The top row shows the eﬀect of using [N ii]/Hβ,
[O ii]/Hβ, [O iii]/Hβ. A range of solutions pops up in the
N/O vs O/H plane, spread out in the high and low metal-
licity regimes. The second row adds the information on the
upper limit detection of [O iii]λ4363 and [N ii]λ5755. This
selects the high-metallicity solutions. The third row shows
how [Ar iii]/[Ne iii] weighs the four diﬀerent ‘islands’ of so-
lutions. Those islands correspond to diﬀerent starburst ages
and geometries and are a consequence of the sparsity of our
grid in those parameters. The last row shows which solu-
tions are favoured by He i/Hβ, which will be those with the
right hardness for the ionizing source. For the [Ar iii]/Hβ,
[Ne iii]/Hβ and He i/Hβ ratios, we add an extra noise source
and then integrate it out, to account for a dispersion in the
Ar/Ne and He/H abundance ratios in real nebulae with re-
spect to the values adopted in the model grid.

This example shows that there are three solutions of
about the same probability in the N/O vs O/H plane. Fig. 11
is a zoom of the ﬁnal N/O vs O/H plane, showing the joint
and the marginalised PDFs for N/O and O/H. The dots and
lines above the marginalised PDFs are the median and the
interval between the 16 to 84 percentiles of the marginalised
PDF for each age and geometry combination. Those solu-
tions are displaced from the plot axes for clarity. Spherical
shells and ﬁlled spheres appear as open and ﬁlled circles,
respectively, and ages are colour-coded in the rainbow order
with 1 Myr ages farther and 6 Myr closer to the axes.

To compare to the Monte Carlo temperature-based
realisations, we draw its covariance ellipse on the joint
PDF panel, and its ±1, 2 and 3-σ as grey bands on the
marginalised PDFs panels. While the method has not com-
pletely eliminated the multimodal nature of the solutions,
three out of the four islands of probability on the joint PDF
plane are compatible with the temperature-based solution
(i.e. inside its covariance ellipse). The multimodal nature of
the solutions draws attention to the discreteness of our age
grid, as marked by the coloured dots and lines at the edges of
the ﬁgure. The important message from this plot is that as-
suming diﬀerent ionizing ﬁelds one ﬁnds diﬀerent values for
O/H, and, while He i/Hβ helps pinpointing the right ionizing
ﬁeld, we may still end up with a range of acceptable solu-
tions. This should improve when we have better constraints
for the stellar radiation ﬁeld.

6 RESULTS

6.1 The BOND N/O vs O/H diagram

We apply our bond method to sample B, which contains
156 objects. Table 2 shows a sample of the summaries for

the posterior PDF available to download from http://bond.
ufsc.br.

Fig. 12 shows the N/O vs O/H diagram obtained with
bond for those objects. The blue points in both panels are
the maximum a posteriori (MAP) values for each object.
Panel a shows the superposition of the joint PDFs for all
objects, while panel b shows the 68% conﬁdence ellipses.
Note that some points fall a long way from their ellipses;
this is an evidence of multimodal solutions.

We ﬁnd that our N/O vs O/H diagram is much more
dispersed than the one obtained by the ON method of Pi-
lyugin et al. (2010), indicating that in nature this diagram
is not a tight sequence. Points are rather spread out like
when using temperature-based methods. Naturally part of
the spread may be due to imperfections in our models. For
instance, we use a simplistic prescription for the nebular
density proﬁle, which may not be realistic enough.

Because we do not impose any a priori solution for the
N/O vs O/H behaviour, unlike the tight correlation from
the grid by Blanc et al. (2015) or the model selection by
P´erez-Montero (2014), we ﬁnd outliers in the N/O vs O/H
plane. In Fig. 12 there are at least two objects with low O/H
and high N/O in both panels, marked as large red points in
panel b (SBS0335-052E and 0837+4717, id numbers 631 and
700 in Table 2). Those objects are likely interesting from a
chemical evolution perspective.

6.2 The O/H ratio if one is not interested in N/O

Given that we do not get rid of multimodal solutions, it is to
be expected that diﬀerent ways to summarise the posterior
(see Section 5.5) result in diﬀerent solutions for O/H and
N/O. In theory, if one is not interested in N/O, one would be
better advised to use the mode, mean or median of the O/H
PDF marginalised over N/O, and those are not expected to
be exactly the same as the descriptions for the joint PDF.

Fig. 13 compares the O/H from maximum a posteriori
(MAP) value of the joint N/O vs O/H PDF to the median
of the marginalised O/H PDF. For most objects those two
solutions agree to within 0.1 dex: There is no bias between
those two nominal solutions (the average diﬀerence is < 0.02
dex) and the dispersion in small (0.06 dex). Other descrip-
tions of the joint and marginalised PDFs may have a better
or worse agreement, but the important point is to always
test a few of those descriptions plus their credibility regions.

6.3 Comparison to the direct method

Fig. 14 shows a comparison of bond to temperature-based
results for the objects in sample B that have a direct temper-
ature measure. The small black circles are the temperature-
based results and the large coloured dots are the bond re-
sults. The latter are colour-coded according to the diﬀerence
between log [O iii]λ4363/[O iii]λ5007 in the models and the
observed value (blue for extreme positive values to red for
extreme negative values). The bond and temperature-based
results for the same H ii region are joined by a solid line.

We see that the bond results generally migrate towards
higher values of O/H and lower values of N/O. The colour-
coding shows that, for the majority of the points, the bond
models have lower temperatures than the observations. This

MNRAS 000, 1–21 (2015)

BOND: Bayesian O & N abundance Determinations

13

Figure 10. Example of the bond solution for an H ii region in NGC 1232 (slit number 5 from Bresolin et al. 2005). The panels from
left to right show the joint posterior PDFs in blue for N/O vs O/H, [O iii]/Hβ vs [N ii]/Hβ, [O iii]/Hβ vs [O ii]/Hβ, and [Ar iii]/[Ne iii] vs
He i/Hβ. The grey bands delimit ±1σ of the temperature-based values for O/H and N/O, and the purple bands ±1σ of the observed line
ratios. Each row shows the eﬀect of cumulatively adding another set of observational constraints. The top row shows the eﬀect of a χ2
likelihood for [O ii]/Hβ, [O iii]/Hβ and [N ii]/Hβ. The second row applies the upper limit for [O iii]λ4363/Hβ and/or [N ii]λ5755/Hβ, which
selects the solutions on the high-metallicity branch. The third row imposes the constraint on [Ar iii]/Hβ and [Ne iii]/Hβ, that further pins
down the metallicity solution. Finally, the last row shows the eﬀect of adding He i/Hb, which selects all possible ionization sources. Note
that the N/O vs O/H PDF is multipeaked, which means that there is a family of acceptable solutions in our grid (aﬀecting mainly O/H).
Those islands of solutions are a consequence of the discreteness of the starburst ages and nebular geometries in our grid.

Table 2. A sample of the posterior PDF summaries for sample B available for download at http://bond.ufsc.br. For log O/H and log
N/O we report the maximum a posteriori (jmod); the centre, dispersion, covariance term and scaling to construct the 68% credibility
ellipse (jc68 cen, sig, cov, scale); and the marginalised median (mmed) and 68% equal-tailed interval (mp68 low, mp68 upp). See
Section 5.5 for details on how those terms have been deﬁned.

id

name

log O/H log N/O log O/H log O/H . . .

log O/H log N/O

jmod

jmod

jc68 cen

jc68 sig

mmed

mmed

log O/H
log O/H
mp68 low mp68 upp

002 NGC 1232 03
003 NGC 1232 04
004 NGC 1232 05
009 NGC 1232 10
. . .
704
706
707
708

. . .
F1629+205
Mrk259
SBS1428
S1657+575

−3.7168
−2.8035
−3.3440
−2.9860
. . .
−3.7860
−3.8633
−3.7087
−3.8281

−1.0797
−0.9974
−0.8872
−0.8719
. . .
−1.3184
−1.2782
−1.1127
−0.8720

−3.6198
−2.8047
−3.2526
−2.9871
. . .
−3.7247
−3.7037
−3.7678
−3.8408

0.0800
0.0095
0.0807
0.0663
. . .
0.0693
0.1904
0.1419
0.1062

. . .
. . .
. . .
. . .
. . .
. . .
. . .
. . .
. . .

−3.6359
−2.8041
−3.2655
−3.0012
. . .
−3.7279
−3.7960
−3.7127
−3.8013

−1.0949
−0.9897
−0.9034
−0.8691
. . .
−1.3333
−1.2626
−1.1080
−0.8999

−3.7195
−2.8180
−3.3454
−3.0258
. . .
−3.7926
−3.8678
−3.9198
−3.9260

−3.5279
−2.7937
−3.1340
−2.9600
. . .
−3.6240
−3.4639
−3.5843
−3.6710

. . .

. . .
. . .
. . .
. . .
. . .
. . .
. . .
. . .
. . .

MNRAS 000, 1–21 (2015)

7.58.08.59.0��+logO/H−1.5−1.0−0.5logN/O−0.4−0.20.00.2log[N��]/Hβ−0.20.00.2log[O���]/Hβ0.20.40.6log[O��]/Hβ−0.20.00.2log[O���]/Hβ−1.2−1.0−0.8logHeI/Hβ−0.50.00.5log[Ar���]/[Ne���]Gaussianconstraints:log[O��]����/Hβlog[O���]����/Hβlog[N��]����/Hβ7.58.08.59.0��+logO/H−1.5−1.0−0.5logN/O−0.4−0.20.00.2log[N��]/Hβ−0.20.00.2log[O���]/Hβ0.20.40.6log[O��]/Hβ−0.20.00.2log[O���]/Hβ−1.2−1.0−0.8logHeI/Hβ−0.50.00.5log[Ar���]/[Ne���]+upperlimit:log[O���]����/Hβlog[N��]����/Hβ7.58.08.59.0��+logO/H−1.5−1.0−0.5logN/O−0.4−0.20.00.2log[N��]/Hβ−0.20.00.2log[O���]/Hβ0.20.40.6log[O��]/Hβ−0.20.00.2log[O���]/Hβ−1.2−1.0−0.8logHeI/Hβ−0.50.00.5log[Ar���]/[Ne���]+gaussianconstraints(margin.uncertainties):log[Ar���]����/Hβlog[Ne���]����/Hβ7.58.08.59.0��+logO/H−1.5−1.0−0.5logN/O−0.4−0.20.00.2log[N��]/Hβ−0.20.00.2log[O���]/Hβ0.20.40.6log[O��]/Hβ−0.20.00.2log[O���]/Hβ−1.2−1.0−0.8logHeI/Hβ−0.50.00.5log[Ar���]/[Ne���]+gaussianconstraints(margin.uncertainties):logHeI����/Hβ14

Vale Asari et al.

Figure 11. A zoom in on the ﬁnal N/O vs O/H panel for the
same object in Fig. 10, plus the marginalised PDFs for O/H
and N/O. This plot highlights how the discreteness of starburst
ages in our grid of models leads to multipeaked solutions. We
would expect a smoother PDF if the ages were more ﬁnely sam-
pled. Above the marginalised PDFs we mark the median (points)
and the interval between the 16 to 84 percentiles (lines) of the
marginalised PDF for each age and geometry combination. Star-
burst ages are ordered from 1 to 6 Myr from top to bottom and
colour-coded with a rainbow palette, while spherical shells and
ﬁlled spheres are represented by open and ﬁlled circles, respec-
tively. The four islands of solutions on the joint PDF become a
broad PDF in N/O and a multipeaked PDF in O/H. To compare
to the temperature-based method, we plot its covariance ellipse
from the Monte Carlo realisations on the joint PDF, and mark
the nominal temperature-based solution and ±1, 2 and 3-σ as grey
bands on the marginalised PDFs. The nominal temperature-based
solution is marked as a black line on the marginalised PDF panels.

explains why the bond oxygen abundances are higher than
the temperature-based ones (typically by 0.2–0.4 dex). Con-
comitantly, the bond N/O ratios are smaller since the emis-
sivity of the [N ii] line is less dependent on the temperature
than that of the [O ii] line, which has a higher excitation
threshold.

This problem is not unique either to our grid of mod-
els or to our code. P´erez-Montero (2014) only obtains O/H
values that are in agreement with the direct method when
[O iii]λ4363 is ﬁtted (see his ﬁg. 2). His method gives a
huge weight to [O iii]λ4363/Hβ (see his eq. 19); in other
words, it becomes essentially a temperature-based method.
Blanc et al. (2015) compared the results from their code izi
using several photoionization models (Kewley et al. 2001;
Levesque et al. 2010; Dopita et al. 2013), and found oﬀsets
of −0.07 to 0.32 dex with respect to recombination lines,
which translate into 0.17–0.56 dex oﬀsets with respect to
the temperature-based method.

It is a well-known problem that collisionally excited
lead to

lines, when using temperature-based methods,

lower oxygen abundances than recombination lines (see e.g.
Garc´ıa-Rojas & Esteban 2007), typically by 0.2–0.3 dex in
H ii regions. One explanation for this abundance discrep-
ancy problem could be that, in real nebulae, strong tem-
perature ﬂuctuations (Peimbert 1967; more important than
the temperature gradients arising in classical photoioniza-
tion models) or a κ distribution of the free electron velocities
(Nicholls et al. 2012) boost the [O iii]λ4363 line, a fact which
is not taken into account in the classical temperature-based
method nor in the grid of photoionization models we use.

The simplicity of the direct method can be a double-
edged sword: although powerful and straightforward to ap-
ply, it might be holding too simplistic assumptions as to the
production of [O iii]λ4363.

7 SUMMARY, DISCUSSION AND FUTURE

DIRECTIONS

bond determines nitrogen and oxygen gas-phase abundances
by using strong and semi-strong lines and comparing them
to a grid of photoionization models in a Bayesian framework.
The code is written in python and its source is publicly avail-
able at http://bond.ufsc.br. The grid of models presented
here is included in the 3MdB database (Morisset, Delgado-
Inglada & Flores-Fajardo 2015, see https://sites.google.
com/site/mexicanmillionmodels/) under
the reference
‘BOND’. The Bayesian posterior probability calculated by
bond stands on two pillars: our grid of models and our choice
of observational constraints (from which we calculate our
likelihoods). We discuss each of these in turn.

The ideal grid of models should be all-encompassing
and able to describe any emission-line object found in na-
ture. Creating such a grid would be a daunting and nearly
impossible task; therefore we have crafted a set of models
that covers enough physical parameters of H ii regions not to
be plagued by the usual preconceptions that go into making
these grids. Our models span a wide range in N/O and O/H,
without imposing any relation between N/O and O/H. The
only model grid that has so far taken this approach is the
one by P´erez-Montero (2014). Unlike his method, we leave
the starburst age and the nebular density structure as free
parameters. Finally, a crucial step forward in our approach
is taking into account the importance of the hardness of the
ionization ﬁeld. All model grids in the literature consider
only a single type of ionizing sources. If the ionization ﬁeld
of the H ii regions diﬀers from those in the models, the O/H
obtained will be strongly biased (see the discussion in Ap-
pendix B). The hardness of the ionization source may vary
due to a few reasons. In local galaxies, the main eﬀects will
be the ageing of the stellar populations in H ii regions, and
the stochastic sampling of the stellar initial mass function
(e.g. Cervi˜no et al. 2013, and references therein). Our model
grid attacks this by using simple stellar populations (SSPs)
of diﬀerent ages for the ionizing sources to account for vari-
ations in the ionizing ﬁeld.

Constructing the grid with great care is not enough.
Given the strengths and limitations of our set of models, we
need to critically assess which theoretical predictions should
be trusted and which observational constraints should go
into our ﬁtting procedure. We have set out to infer O/H
and N/O, but also to constrain the nuisance parameters U,

MNRAS 000, 1–21 (2015)

8.08.59.0��+logO/H−1.2−1.0−0.8logN/O�Myr�Myr�Myr�Myr�Myr�MyrBOND: Bayesian O & N abundance Determinations

15

Figure 12. Blue points on both panels are the maximum a posteriori (MAP) for each object in sample B. The blue scale on each map
is a diﬀerent description of our results. (a) Superposition of the N/O vs O/H joint posterior PDFs for all objects. The blue gradient is
linear and scaled such than the joint PDF for each object integrates to unity over this diagram. (b) The ellipses are the covariances of
the 68% credibility region, and are scaled to cover the same area as the credibility region. Strong multimodal solutions appear as MAP
points far-ﬂung from their elliptical companions. Large red dots mark the two outliers on the N/O vs O/H plane (blue compact dwarves
SBS0335-052E and 0837+4717).

[S ii]λ6716 + λ6731 line in our procedure, ﬁrst because this
line is emitted in the outskirts of H ii regions so that its in-
tensity in relation with [O ii] or [N ii] is dependent on the
detailed density structure of the nebulae, second because
there might be an intrinsic scatter in the S/O ratio due to
stellar nucleosynthesis and/or to depletion eﬀects not yet
fully documented.

For a set of giant H ii regions and blue compact dwarf
galaxies, we have calculated their gas-phase N/O and O/H
abundances and compared them to the ones obtained by
the temperature-based method and by the Pilyugin et al.
(2010) ON method. We ﬁnd that the N/O vs O/H relation
obtained by bond is as scattered as the one obtained by the
temperature-based method, and that the very tight relation
obtained with the Pilyugin method is a consequence of that
method itself.

We also note that, when using the bond method on ob-
jects which have direct temperature measurements, we sys-
tematically obtain lower values of [O iii]λ4363/[O iii]λ5007
than observed and higher values of the oxygen abundance
than with the temperature-based method. This discrepancy
has been seen in many other strong-line methods calibrated
on photoionization models and might point to too soft an
ionizing spectral energy distribution (SED) in the models.
This is in line with the fact that Stasi´nska et al. (2015),
using a subset of our models, found that the SEDs are
not hard enough to produce the observed [Ar iv]/[Ar iii]
line ratio. It might also indicate that the density distri-
butions of our models are too simplistic to represent real
H ii regions. Alternatively, it might be a sign that impor-
tant temperature ﬂuctuations of unknown origin or a κ dis-
tribution of electron velocities are present in real H ii re-
gions and lead to an overestimate of the temperature indi-
cated by [O iii]λ4363/[O iii]λ5007. Such an explanation has
been suggested by several authors and would at the same
time help resolve the famous abundance discrepancy prob-

Figure 13. Comparison between the maximum a posteriori O/H
and the marginalised median O/H. The identity line is drawn in
grey.

the correct O/H bimodality branch, and the hardness of the
ionizing ﬁeld. The strong lines [O iii]/Hβ, [O ii]/Hβ and
[N ii]/Hβ constrain O/H, N/O and U. To pin down the cor-
rect O/H branch, we use an upper limit in [O iii]λ4363 or
[N ii]λ5755 when at hand, and the ratio of the semi-strong
lines [Ar iii]/[Ne iii], which depends mostly on the electron
temperature (modulo the ionizing structure of the nebula,
already constrained by [O iii]/[O ii]). Indeed [Ar iii] and
[Ne iii] have diﬀerent excitation thresholds while Ar/Ne in
the gas phase is expected to be constant, since both argon
and neon are primary elements and inert. Lastly, another
semi-strong line comes to rescue: He i/Hβ helps constrain the
mean eﬀective temperature of the ionizing radiation ﬁeld.

Unlike several authors (Dopita et al. 2013; P´erez-
Montero 2014; Blanc et al. 2015) we do not use the

MNRAS 000, 1–21 (2015)

7.07.58.08.59.0��+logO/H−1.5−1.0−0.50.0logN/O���a)JointPDF+MAP7.07.58.08.59.0��+logO/H−1.5−1.0−0.50.0logN/O���b)��%credibility+MAP7.58.08.59.0��+logO/HMAP7.58.08.59.0��+logO/Hmed16

Vale Asari et al.

Figure 14. Comparison of N/O vs O/H as obtained with the temperature-based method (small black circles) and with the bond method
(large coloured circles). Solutions for the same object are joined by a line. The large circles are coloured with respect to the diﬀerence
between [O iii]λ4363/[O iii]λ5007 for the ﬁtting models and the measured [O iii]λ4363/[O iii]λ5007. Lines lacking a coloured counterpart
indicate there is no measured [O iii]λ4363 (i.e. the direct method used [N ii]λ5755/[N ii]λ6584 to measure the electron temperature). Note
how points tend to shift to higher O/H with bond, and that the temperature in the models tend to be smaller than the one inferred
from the auroral lines. A colour version of this ﬁgure is available in the electronic edition.

lem (see e.g. Garc´ıa-Rojas & Esteban 2007; Nicholls et al.
2012; Dopita et al. 2013). Since we do not try reproduce the
[O iii]λ4363 line, nitrogen and oxygen abundances inferred
by bond might be more accurate estimates than those of
the temperature-based method. Nevertheless, the accuracy
of bond abundances strongly relies on how well the pho-
toionization model grid represents real objects.

We have shown that bond, when applying our extensive
grid of photoionization models to a well-chosen set of strong
and semi-strong lines, allows one to obtain O/H and N/O
simultaneously, getting rid of the spectre of bimodality with-
out recourse to empirical oxygen and nitrogen abundance
correlations. Our method is very easily extendable and can
accommodate many improvements in the future. In spite of
many issues still to resolve in the determination of nebular
abundances, we hope that bond does oﬀer a quantum of
solace.

ACKNOWLEDGMENTS

We are thankful to Robert Kennicutt and the referee,
Guillermo Blanc,
for their insightful comments, which
led us to rephrase a number of issues to improve clar-
ity. We also thank Guillermo Blanc for the kindness of
running izi
for us in the refereeing process. GS and
NVA acknowledge the support from the CAPES CsF–PVE
project 88881.068116/2014-01. NVA acknowledges the NEB-
ULATOM school held in Choroni, Venezuela, in 2013, and

the support and hospitality for short term visits of the
LUTH, at Observatoire de Paris. GS and RCF acknowledge
the support from the CAPES-COFECUB Te 585/07 project.
The grid of models has been run on computers from the
CONACyT/CB2010:153985, UNAM-PAPIIT-IN107215 and
UNAM Posgrado de Astrof´ısica projects. This research made
use of Astropy, a community-developed core Python package
for Astronomy; matplotlib, a Python library for publication
quality graphics; SciPy; numpy; h5py; and hickle.

REFERENCES

Aggarwal K. M., Keenan F. P., 1999, ApJS, 123, 311
Alloin D., Collin-Souﬀrin S., Joly M., Vigroux L., 1979, A&A, 78,

200

Baldwin J. A., Phillips M. M., Terlevich R., 1981, PASP, 93, 5
Blanc G. A., Kewley L., Vogt F. P. A., Dopita M. A., 2015, ApJ,

798, 99

Bresolin F., 2007, ApJ, 656, 186
Bresolin F., Garnett D. R., Kennicutt R. C., 2004, ApJ, 615, 228
Bresolin F., Schaerer D., Gonz´alez Delgado R. M., Stasi´nska G.,

2005, A&A, 441, 981

Bresolin F., Ryan-Weber E., Kennicutt R. C., Goddard Q., 2009a,

ApJ, 695, 580

Bresolin F., Gieren W., Kudritzki R.-P., Pietrzy´nski G., Urbaneja

M. A., Carraro G., 2009b, ApJ, 700, 309

Bresolin F., Stasi´nska G., V´ılchez J. M., Simon J. D., Rosolowsky

E., 2010, MNRAS, 404, 1679

MNRAS 000, 1–21 (2015)

7.07.58.08.59.0��+logO/H−1.5−1.0−0.50.0logN/O−0.5−0.4−0.3−0.2−0.10.00.1log[O���]����/����BOND−log[O���]����/����obsBresolin F., Kennicutt R. C., Ryan-Weber E., 2012, ApJ, 750,

van Zee L., Salzer J. J., Haynes M. P., O’Donoghue A. A., Balonek

122

T. J., 1998, AJ, 116, 2805

BOND: Bayesian O & N abundance Determinations

17

Cervi˜no M., Rom´an-Z´u˜niga C., Luridiana V., Bayo A., S´anchez

N., P´erez E., 2013, A&A, 553, A31

Chabrier G., 2003, PASP, 115, 763
Delgado-Inglada G., Rodr´ıguez M., Peimbert M., Stasi´nska G.,

Morisset C., 2015, MNRAS, 449, 1797

Dopita M. A., Sutherland R. S., Nicholls D. C., Kewley L. J.,

Vogt F. P. A., 2013, ApJS, 208, 10

Draine B. T., 2011, ApJ, 732, 100
Esteban C., Garc´ıa L´opez R., Herrero A., S´anchez F., eds, 2004,

Cosmochemistry. The melting pot of the elements

Ferland G. J., et al., 2013, Rev. Mex. Astron. Astroﬁs., 49, 137
Galavis M. E., Mendoza C., Zeippen C. J., 1997, A&AS, 123, 159
Garc´ıa-Rojas J., Esteban C., 2007, ApJ, 670, 457
Garnett D. R., 1992, AJ, 103, 1330
Goddard Q. E., Bresolin F., Kennicutt R. C., Ryan-Weber E. V.,

Rosales-Ortega F. F., 2011, MNRAS, 412, 1246

Hogg D. W., 2012, preprint
Izotov Y. I., Thuan T. X., Stasi´nska G., 2007, ApJ, 662, 15
Kennicutt R. C., Bresolin F., Garnett D. R., 2003, ApJ, 591, 801
Kewley L. J., Dopita M. A., 2002, ApJS, 142, 35
Kewley L. J., Ellison S. L., 2008, ApJ, 681, 1183
Kewley L. J., Dopita M. A., Sutherland R. S., Heisler C. A.,

Trevena J., 2001, ApJ, 556, 121

Kisielius R., Storey P. J., Ferland G. J., Keenan F. P., 2009,

MNRAS, 397, 903

Levesque E. M., Kewley L. J., Larson K. L., 2010, AJ, 139, 712
Li Y., Bresolin F., Kennicutt R. C., 2013, ApJ, 766, 17
Maiolino R., et al., 2008, A&A, 488, 463
McGaugh S. S., 1991, ApJ, 380, 140
McGaugh S. S., 1994, ApJ, 426, 135
Mendoza C., Zeippen C. J., 1983, MNRAS, 202, 981
Moll´a M., Gavil´an M., 2010, Mem. Soc. Astron. Italiana, 81, 992
Moll´a M., Garc´ıa-Vargas M. L., Bressan A., 2009, MNRAS, 398,

451

Morisset C., Delgado-Inglada G., Flores-Fajardo N., 2015, Rev.

Mex. Astron. Astroﬁs., 51, 103

Nicholls D. C., Dopita M. A., Sutherland R. S., 2012, ApJ, 752,

148

Pagel B. E. J., Edmunds M. G., Blackwell D. E., Chun M. S.,

Smith G., 1979, MNRAS, 189, 95

Peimbert M., 1967, ApJ, 150, 825
P´erez-Montero E., 2014, MNRAS, 441, 2663
Pilyugin L. S., V´ılchez J. M., Thuan T. X., 2010, ApJ, 720, 1738
Pilyugin L. S., V´ılchez J. M., Mattsson L., Thuan T. X., 2012,

MNRAS, 421, 1624

R´emy-Ruyer A., et al., 2014, A&A, 563, A31
Saftly W., Camps P., Baes M., Gordon K. D., Vandewoude S.,

Rahimi A., Stalevski M., 2013, A&A, 554, A10

Stasi´nska G., 2005, A&A, 434, 507
Stasi´nska G., 2010, in G. Bruzual & S. Charlot ed., IAU Sympo-

sium Vol. 262, IAU Symposium. pp 93–96

Stasi´nska G., Cid Fernandes R., Mateus A., Sodr´e L., Asari N. V.,

2006, MNRAS, 371, 972

Stasi´nska G., Pe˜na M., Bresolin F., Tsamis Y. G., 2013, A&A,

552, A12

Stasi´nska G., Izotov Y., Morisset C., Guseva N., 2015, A&A, 576,

A83

Storchi-Bergmann T., Calzetti D., Kinney A. L., 1994, ApJ, 429,

572

Storey P. J., Zeippen C. J., 2000, MNRAS, 312, 813
Tayal S. S., 2011, ApJS, 195, 12
Tayal S. S., Zatsarinny O., 2010, ApJS, 188, 32
Vilchez J. M., Esteban C., 1996, MNRAS, 280, 720
Vilchez J. M., Pagel B. E. J., 1988, MNRAS, 231, 257
Zeippen C. J., 1982, MNRAS, 198, 111
Zurita A., Bresolin F., 2012, MNRAS, 427, 1463

MNRAS 000, 1–21 (2015)

APPENDIX A: A FAKE SAMPLE FOR TESTS

To assess some of the recipes used in temperature-based
methods and to test the bond method on objects with
known abundances, we construct a ‘fake’ sample by select-
ing from our grid of models a subsample that roughly follows
the expected properties of our observational sample.

To limit the size of our fake sample, we have created an
interpolated grid having a resolution of 0.1 dex in O/H and
N/O, and 0.5 dex in U. We then perturb each cell point in
the grid with uniform noise (setting its maximum amplitude
to be the size of the cell) in those three input parameters, so
that the fake sources are not superimposed in our plots. Our
‘fake’ sources are then chosen to fall roughly in the same loci
as observed data, as Fig. A1 shows. We select models in the
vicinity of the observed N/O and O/H relation as expressed
by eq. 2 of Pilyugin et al. 2012, around the U vs O/H relation
found by P´erez-Montero (2014), and below the Stasi´nska
et al. (2006) line delimiting pure H ii regions in the BPT
diagram. For a given age and geometry we have around ∼
350–400 fake sources (except for the 6 Myr scenarios, which
fail to cover a large part of the observational data and thus
have ∼ 160 fake sources).

Fig. A2a shows the relation between the temperatures in
the high and in the low excitation zones and Fig. A2b shows
the relation between the ionic fractions of N+and O+. The
temperatures and ionic fractions come directly from the pho-
toionization models for our fake source sample. The contin-
uous lines indicate the relations we used in the temperature-
based method. We see that they represent well the trends
shown by the models. We also see that the models show some
dispersion about these lines. For the temperature the disper-
sion is of 600 K, while for the logarithm of ionic abundances
it is of 0.06 dex.

APPENDIX B: TESTS OF THE ACCURACY OF
THE BOND METHOD

Here we run a suite of tests ﬁtting models with models, using
the same code and the same assumptions as for the sources
in sample B. The aim of this exercise is twofold. First, we
show that our method works when the input and the output
are the same, which is the zeroth test of reliability of any
method. Second, we check how the diﬀerent ionizing source
ages and density structures aﬀect our results, since this is
the main novelty of our model grid.

The model grid considered is the octree sampled grid.
For the tests in this section we select subgrids of single ages
and density structures to highlight the eﬀects of those pa-
rameters. For all the tests presented here, we assume that
the uncertainties in the intensity ratios [O iii]/Hβ, [O ii]/Hβ,
[N ii]/Hβ, [Ar iii]/Hβ, [Ne iii]/Hβ, and He i/Hβ are of 10%.
The results of our tests are shown in Fig. B1, where
the diﬀerent rows correspond to diﬀerent choices of age and
geometry. The ﬁrst row shows 2-Myr starburst and spheri-
cal shell fake sources modelled with a grid of the same age
and geometry. For O/H and N/O, we show the diﬀerence

18

Vale Asari et al.

Figure A1. Fake sources chosen from the grid with age 2 Myr and ﬁlled sphere. The grid is ﬁner than our original grid, but not as ﬁne
as the interpolated one we use as our initial octree grid. The panels show our selection of grid models on the N/O vs O/H, U vs O/H
and BPT planes.

APPENDIX C: COMPARISON WITH OTHER
STRONG LINE METHODS

Here we compare our bond method to several other strong
line methods. Fig. C1 shows the comparison to the O/H
measured by McGaugh (1991), using eqs. A1 and A2 from
Kewley & Ellison (2008). The two panels show the eﬀect
of choosing diﬀerent criteria to separate the low and high-
metallicity solutions: On the right we use log [N ii]/[O ii] =
−1 (as in McGaugh 1994), and on the left −1.2 (as in Kewley
& Ellison 2008). The separation between the two branches is
fuzzy, and the eﬀect of choosing a slightly diﬀerent frontier
is seen when comparing one panel to the other. Focusing on
the comparison of McGaugh (1991) to bond, we see a good
agreement between the results from bond and those from
the much simpler McGaugh recipe, but there are important
diﬀerences for a non negligible number of sources at high
metallicities. There are, as expected, huge diﬀerences around
12 + log O/H = 8.5, where the O23 ratio is insensitive to
metallicity while bond is aided by using the [Ar iii]/[Ne iii]
ratio, which steadily increases with increasing metallicity.

McGaugh (1991) was the ﬁrst to take into account the
eﬀect of the ionization parameter when measuring abun-
dances. Fig. C2 shows the comparison of bond results with
those using a simple O23 calibration (we have used the one
by Maiolino et al. 2008 as an example). The systematics
with this simple O23 calibrator are of the order of 0.2–0.5
dex over the whole O/H range.

Fig. C3 compares the bond results obtained with our
full grid of models to those from the izi code by Blanc et al.
(2015) with their default grid (Levesque et al. 2010, 6 Myr
constant star formation). Blanc et al. (2015), like McGaugh
(1991), assume a N/O vs O/H relation and consider a unique
family of ionizing stellar energy distributions. Panel a shows
the comparison between the values of O/H derived by bond
and izi for the 151 objects in sample B (see Sec. 2.3) which
have the izi quality ﬂags npeakZ and limZ equal to one (this
removes only 5 objects from sample B). For log O/H (cid:46) 8.4, izi
metallicities are systematically larger than bond by 0.1–0.2
dex. For log O/H (cid:38) 8.4, the O/H from bond can be 0.3–0.8
dex larger izi for a few objects, while for other objects the
codes agree quite well (diﬀering by (cid:46) 0.02 dex). Panel b of
Fig. C3 shows the values of N/O vs O/H derived by bond
linked by a straight line to the values obtained by Blanc et al.
for the same objects (actually, Blanc et al. determines only

MNRAS 000, 1–21 (2015)

Figure A2.
(a) Comparison between the temperatures in the
high and low excitation zones for the fake sources. The grey line
is the classical relation from Garnett (1992) given by Eq. 1. (b)
Comparison between the ionic fractions of N+and O+. The one-
to-one line is in grey.

∆ between the output and the input as a function of the
input parameter. The results shown are for the maximum
a posteriori values. N/O and O/H are well recovered (the
dispersion is 0.007 dex).

The second and third rows of Fig. B1 show the eﬀect of
using the wrong density structure and age, respectively. The
second row shows the 2 Myr ﬁlled sphere fake sources ﬁtted
with 2 Myr spherical shell models. The residuals for O/H and
N/O are very dispersed (0.02 and 0.06 dex respectively) and
slightly biased (0.006 and 0.02 dex). The third row shows
the eﬀect of using the wrong hardness for the ionization
source. Here we have 4 Myr fake sources ﬁtted with a 2 Myr
grid, both modelled as ﬁlled spheres. This is a very worrying
scenario: O/H is underestimated by ∼ 0.1 dex (and up to 0.4
dex) for the high-metallicity branch, while N/O is slightly
overestimated (0.04 dex) and rather dispersed (0.05 dex).

The last row shows how our 2-Myr ﬁlled sphere fake
sources are modelled using our entire grid, i.e. without any
a priori knowledge of the geometry and the age of the ioniz-
ing source. The results are quite encouraging, and the code
seems to choose the right age and geometry combination; or,
at least in practice, the right O/H and N/O solution. O/H
and N/O are recovered to within better than 0.05 dex (0.02
dex of dispersion).

789��+logO/H−2−10logN/Oa789��+logO/H−4−3−2−1logUb−2−10log[N��]/Hβ−2−101log[O���]/Hβc05101520T[O���][103K]05101520T[N��][103K]a−1.5−1.0−0.50.0logO+�O−1.5−1.0−0.50.0logN+�NbBOND: Bayesian O & N abundance Determinations

19

Figure C1. Comparison between O/H from bond and from
McGaugh (1991) for our sample B. The panel on the right
shows O/H from McGaugh by choosing the O/H according to
log [N ii]/[O iii] = −1 (McGaugh 1994), and on the left according
to log [N ii]/[O ii] = −1.2 (Kewley & Ellison 2008).

Figure C2. As Fig. C1, but for O/H derived with the O23 cali-
bration from Maiolino et al. (2008).

O/H, since the N/O values lie on the relation assumed by
them). We see that some objects are actually quite far from
the tight N/O vs O/H relation assumed, and that for those
objects the O/H values derived by bond diﬀer substantially
from those derived by Blanc et al.. This illustrates that, for
a number of objects (which are not the majority but are not
known a priori) it is necessary to simultaneously derive N/O
and O/H to obtain a reliable oxygen abundance.

Fig. C4 shows the comparison between bond and the
hii-chi-mistry code by P´erez-Montero (2014) for our sam-
ple B. We do not show objects that the P´erez-Montero
(2014) code ﬂags as bad, i.e. when his grid output is either
2 or 3. From the original 156 objects in sample B, we are
left with 129 objects. We use the version 1.2 of his code. The
ﬁgure shows N/O vs O/H as obtained by the P´erez-Montero
(2014) code on the left, and the comparison of the O/H and
N/O values to ones obtained by bond on the middle and
right panels. The two rows correspond to two diﬀerent runs
of the P´erez-Montero (2014) code. On the top row, we have
withheld the [O iii]λ4363 line from the code, to see how it
would behave using only strong lines. This is not the recom-
mended way of running the P´erez-Montero (2014) code, but
this exercise shows that it cannot be used as a strong line
method. The bottom row shows the results from the P´erez-
Montero (2014) code when asking it to ﬁt the [O iii]λ4363
line as well (with a very strong weight as resulting from
his eq. 19). Note that the P´erez-Montero (2014) code ﬁnds
systematically lower values of O/H than the bond method,

Figure B1. Results from modelling the grid fake sources with
bond. The panels show the residual parameters (input minus out-
put) for O/H and N/O. The top row shows that we recover O/H
and N/O quite well when we ﬁt sources from the 2 Myr ﬁlled
sphere grid with a grid of the same age and geometry. The sec-
ond row swaps the ﬁlled sphere by a shell in the ﬁtting grid. The
third row ﬁts 4 Myr fake sources with a grid of the same geometry
but 2 Myr ionizing sources. We see that O/H is highly biased for
the high-O/H solutions. The last row shows 2 Myr ﬁlled spheres
ﬁtted with our entire grid. The results for O/H are very good,
with a dispersion of only 0.02 dex.

MNRAS 000, 1–21 (2015)

789��+logO/H−0.50.00.5∆logO/Ha)Sources:�Myr,sphere/Grid:�Myr,sphere−2−10logN/O−0.50.00.5∆logN/O789��+logO/H−0.50.00.5∆logO/Hb)Sources:�Myr,sphere/Grid:�Myr,shell−2−10logN/O−0.50.00.5∆logN/O789��+logO/H−0.50.00.5∆logO/Hc)Sources:�Myr,sphere/Grid:�Myr,sphere−2−10logN/O−0.50.00.5∆logN/O789��+logO/H−0.50.00.5∆logO/Hd)Sources:�Myr,sphere/Grid:�–�Myr,allgeom.−2−10logN/O−0.50.00.5∆logN/O789��+logO/HBOND789��+logO/HM91a)N�O�<−1.2789��+logO/HBONDb)N�O�<−1.0789��+logO/HBOND789��+logO/HO23a)N�O�<−1.2789��+logO/HBONDb)N�O�<−1.020

Vale Asari et al.

Figure C3. How the assumption of a relation between N/O and
O/H aﬀects the derived O/H. Panel a compares the values of O/H
obtained by bond to those by izi (Blanc et al. 2015) with their
default grid, which assumes a relation between N/O and O/H.
We show the results for 151 objects in our sample B that have
also been ﬂagged as having reliable results by izi. Panel b shows
N/O as a function of O/H for bond and izi. The results using
the Blanc et al. (2015) code and grid are the small orange points,
and those with bond are large blue points. Results for the same
object are linked by a grey line.

exactly like the temperature-based method. The N/O is also
rather scattered.

Finally, we use the fake sample of Fig. A1 to show how
the ON strong-line method of Pilyugin et al. (2010) biases
the abundance results in the N/O vs O/H diagram. As seen
in Fig. C5, the ON calibration from Pilyugin et al. (2010)
has considerably squeezed the broad input relation.

This paper has been typeset from a TEX/LATEX ﬁle prepared by
the author.

MNRAS 000, 1–21 (2015)

789��+logO/HBOND789��+logO/HIZIa789��+logO/H−1.5−1.0−0.50.0logN/ObBOND: Bayesian O & N abundance Determinations

21

Figure C4. Results for applying the hii-chi-mistry code by P´erez-Montero (2014) to our sample B. Top and bottom rows respectively
show results excluding or including [O iii]λ4363 from the hii-chi-mistry ﬁts. From left to right, the N/O vs O/H diagram, and the
comparison between the O/H and N/O values to bond.

Figure C5. (a) The original N/O vs O/H diagram for our fake
sources, and (b) the N/O vs O/H diagram for our fake sources as
calculated by the ON calibration from Pilyugin et al. (2010).

MNRAS 000, 1–21 (2015)

789��+logO/H−1.5−1.0−0.50.0logN/Oa789��+logO/HBOND789��+logO/HPM14b−2.0−1.5−1.0−0.5logN/OBOND−2.0−1.5−1.0−0.5logN/OPM14c789��+logO/H−1.5−1.0−0.50.0logN/Od789��+logO/HBOND789��+logO/HPM14e−2.0−1.5−1.0−0.5logN/OBOND−2.0−1.5−1.0−0.5logN/OPM14f789��+logO/H−2−10logN/Oa789��+logO/H−2−10logN/Ob