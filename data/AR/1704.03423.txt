Draft version May 29, 2018
Typeset using LATEX manuscript style in AASTeX61

8
1
0
2

y
a
M
8
2

]

R
S
.
h
p
-
o
r
t
s
a
[

2
v
3
2
4
3
0
.
4
0
7
1
:
v
i
X
r
a

RELATIONSHIPS BETWEEN CHARACTERISTICS OF THE LINE-OF-SIGHT MAGNETIC

FIELD AND SOLAR FLARE FORECASTS

Viacheslav M Sadykov1, 2 and Alexander G Kosovichev1, 2, 3

1Center for Computational Heliophysics, New Jersey Institute of Technology, Newark, NJ 07102, USA
2Department of Physics, New Jersey Institute of Technology, Newark, NJ 07102, USA
3NASA Ames Research Center, Moﬀett Field, CA 94035, USA

ABSTRACT

We analyze the relationship between the ﬂare X-ray peak ﬂux, and characteristics of the Polarity

Inversion Line (PIL) and Active Regions (AR), derived from line-of-sight (LOS) magnetograms. The

PIL detection algorithm based on a magnetogram segmentation procedure is applied for each AR with

1 hour cadence. The PIL and AR characteristics are associated with the AR ﬂare history and divided

into ﬂaring and non-ﬂaring cases. Eﬀectiveness of the derived characteristics for ﬂare forecasting is

determined by the number of non-ﬂaring cases separated from ﬂaring cases by a certain threshold,

and by their Fisher ranking score. The Support Vector Machine (SVM) classiﬁer trained only on the

PIL characteristics is used for the ﬂare prediction. We have obtained the following results: (1) the

PIL characteristics are more eﬀective than global characteristics of ARs, (2) the highest True Skill

Statistics (TSS) values of 0.76

0.03 for

±

M1.0 ﬂares and 0.84

≥

0.07 for

±

X1.0 ﬂares are obtained

≥

using the “Sigmoid” SVM kernel, (3) the TSS scores obtained using only the LOS magnetograms

are slightly lower than the scores obtained using vector magnetograms, but signiﬁcantly better than

current expert-based predictions, (4) for prediction of

M1.0 class ﬂares 74.4% of all cases, and

≥
X1.0 class, can be pre-classiﬁed as negative with no signiﬁcant eﬀect on the results,

91.2% for

≥

Corresponding author: Viacheslav M Sadykov
vsadykov@njit.edu

 
 
 
 
 
 
2

Sadykov and Kosovichev

(5) the inclusion of global AR characteristics does not improve the forecast. The study conﬁrms

the unique role of the PIL region characteristics in the ﬂare initiation process, and demonstrate

possibilities of ﬂare forecasting using only the line-of-sight magnetograms.

Keywords: methods: statistical — Sun: activity — Sun: ﬂares — Sun: magnetic ﬁelds

LOS Characteristics and Flares

3

1. INTRODUCTION

Usually lasting from several minutes to several hours, solar ﬂares can release more than 1032 erg

of energy, and cause harmful eﬀects to the terrestrial environment. The only possible source to

accumulate such large amounts of energy is magnetic ﬁeld of active regions. Emslie et al. (2012)

demonstrated for a sample of 38 ﬂares that the free (non-potential) energy of magnetic ﬁeld was

suﬃcient to explain the ﬂare energy release including Coronal Mass Ejections (CMEs), energetic

particles, and hot plasma emission and dynamics. For understanding the ﬂare physical mechanism

and developing ﬂare prediction methods it is important to ﬁnd critical magnetic ﬁeld characteristics

that are linked to the ﬂare initiation and strength.

There have been two types of such study. The ﬁrst approach is to focus on global characteristics of

active regions, and the second approach is to search for local critical properties of magnetic ﬁelds. For

instance, in the ﬁrst type studies, Mandage & McAteer (2016) demonstrated a diﬀerence between the

magnetic ﬁeld power spectrum slopes of ﬂaring and non-ﬂaring active regions. Kors´os et al. (2014)

found several promising preﬂare signatures using the SOHO/MDI-Debrecen Data sunspot catalog.

Kors´os et al. (2015) introduced the weighted horizontal magnetic gradient, W GM , which allowed

them to predict the onset time for

M5.0 class ﬂares, and conclude whether or not a ﬂare is likely be

≥

followed by another event in the next 18 hours. The daily averages of W GM together with a separation

parameter Sl−f of magnetic polarities were used by Kors´os and Erd´elyi (2016) to obtain some con-

ditional probabilities of ﬂare and CME characteristics. Bobra & Couvidat (2015); Bobra & Ilonidis

(2016); Nishizuka et al. (2017); Liu et al. (2017) have used vector magnetograms from the Space-

weather HMI Active Region Patches (SHARP) and applied machine-learning techniques (Support

Vector Machine, Random Forest, and Nearest-Neighbor classiﬁers) for ﬂare and CME predictions.

Also, a recent study of Raboonik et al. (2017) used the Zerneke moments as characteristics of the

active region magnetic ﬁeld for ﬂare prediction.

Many observational studies of the second type found that the magnetic ﬁeld Polarity Inversion

Line (PIL) in regions of strong ﬁeld plays an important role in the ﬂare activity (e.g. Severny

1964; Hagyard et al. 1990; Wang et al. 1994; Falconer et al. 1997; Kosovichev and Zharkova 2001;

4

Sadykov and Kosovichev

Jing et al. 2006; Schrijver 2007; Kumar et al. 2015; Barnes et al. 2016; Schrijver 2016; Sharykin et al.

2016; Toriumi et al. 2017; Bamba et al. 2017; Zimovets et al. 2017). Kusano et al. (2012) demon-

strated from three-dimensional magnetohydrodynamic simulations that ﬂare eruptions can be ini-

tiated by emergence of certain small magnetic structures near PIL, as evident from observations.

Toriumi et al. (2013, 2014) pointed out an important role of highly-sheared magnetic ﬁeld in the

vicinity of PILs in the ﬂare development process. Guennou et al. (2017) found from simulations that

the PIL parameters measuring the total non-potentiality of active regions present a signiﬁcant ability

to distinguish between eruptive and non-eruptive cases. From magnetograms one can extract several

descriptors representing the local ﬁeld in the PIL vicinity. For example, Falconer et al. (2003) showed

that the length of the PIL with a strong ﬁeld gradient and sheared transverse ﬁeld correlates with

the CME and ﬂare productivity. Mason & Hoeksema (2010) introduced the Gradient-Weighted PIL

length as a characteristic for solar ﬂare forecasts. Falconer et al. (2011, 2012, 2014) found that this

characteristic is a good proxy for the free magnetic energy. Leka & Barnes (2003a,b, 2007) suggested

to use a shear angle between the observed and reconstructed magnetic ﬁelds. Chernyshov et al.

(2011) used the PIL length, the area of strong magnetic ﬁeld in the PIL vicinity, and the total ﬂux

in this area, as well as the rates of change of these characteristics.

In this paper, we perform a critical analysis of various line-of-sight (LOS) magnetic ﬁeld char-

acteristics (derived for the entire active region and for the PIL vicinity), their relationship to the

ﬂaring activity, and importance for ﬂare forecast. Such analysis based on the LOS magnetograms

is important because these observations can be performed more easily and accurately than the full

vector magnetic ﬁeld measurements in near-real time by various space-based and ground-based ob-

servatories.

In Section 2, we describe automatic procedures for identiﬁcation of PIL, calculation

of various magnetic ﬁeld characteristics, association of the derived characteristics with ﬂare events,

and construction of “train” and “test” data sets. In Section 3, we estimate the eﬀectiveness in the

separation of ﬂaring and non-ﬂaring cases for diﬀerent LOS characteristics. Section 4 describes the

application of Support Vector Machine (SVM) classiﬁer for prediction of M- and X-class ﬂares. The

LOS Characteristics and Flares

5

results are summarizes in Section 5. The comparison with previous results, expert-based scores and

following conclusion are presented in Section 6.

2. DATA PREPARATION

2.1. Magnetogram Segmentation

For analysis we used the Line-of-Sight (LOS) magnetograms of Active Regions (AR), obtained

by the Helioseismic and Magnetic Imager onboard the Solar Dynamics Observatory (SDO/HMI,

Scherrer et al. 2012). The active region data were represented in the form of 30o

30o data cubes

×

with 1 h cadence, remapped onto the heliographic coordinates using the Postel’s projection, and

tracked with the solar diﬀerential rotation during the whole passage of active regions on the solar

disk, employing the standard SDO software. To avoid projection eﬀects, following Bobra & Couvidat

(2015) we consider ARs only when they are located within

68deg from the disk center.

±

By deﬁnition, the Polarity Inversion Line (PIL) is the line where the LOS magnetic ﬁeld changes

its sign. For the automatic robust detection of the PIL of strong ﬁelds in active regions we use

the algorithm initially introduced by Chernyshov et al. (2011) and Laptev (2011). This algorithm is

based on a magnetogram segmentation process formulated as an optimization task. The goal is to

divide the magnetogram into regions with strong positive ﬁeld (“positive” segments), strong negative

ﬁeld (“negative” segments), or weak ﬁeld (“neutral” segments). We describe the algorithm in detail

in Appendix A. An example of the segmentation and PIL detection for AR 11158 is illustrated in

Fig. 1.

To isolate the active region area, we use the following two algorithms. The ﬁrst one is based

on the segmentation result: we apply one morphological dilation (inclusion of neighboring pixels)

to the positive/negative segments (see Appendix A), combine them, choose the largest segment

containing the active region center, and determine the minimum bounding box around it. The

second algorithm is implemented following the procedure of Stenﬂo and Kosovichev (2012). The

magnetogram is smoothed, and for each strong magnetic ﬁeld island the bounding box with a margin

of ﬁxed width (18′′) on all sides is deﬁned. Then, the intersecting bounding boxes are replaced by

6

Sadykov and Kosovichev

a larger bounding box. The solution represents the largest bounding box intersecting the center of

the data cube (the center of AR). We have found that by applying both algorithms and selecting

the smallest bounding box almost all ARs can be eﬀectively separated from their neighbors. The

bounding box extracted for AR 11158 is presented in Fig. 1.

2.2. Derivation of PIL and AR Characteristics

After performing the segmentation and bounding procedures, we calculate the following descriptors

(characteristics) using the derived PIL and the tracked and remapped magnetogram:

1. The PIL length deﬁned as the number of pixels occupied by the PIL.

2. The PIL area obtained after 10 morphological dilations of the PIL.

3. The unsigned magnetic ﬂux in the PIL area.

4. The unsigned horizontal gradient in the PIL area deﬁned as the sum of

over the PIL area pixels.

hBz =

∇

∂Bz
∂x

s(cid:18)

2

+

(cid:19)

(cid:18)

∂Bz
∂y

2

(cid:19)

5. The maximum gradient of the LOS magnetic ﬁeld across the PIL.

6. The gradient-weighted PIL length (Mason & Hoeksema 2010) calculated as the sum of the PIL

pixels multiplied by the unsigned horizontal gradient in each pixel.

7. The R-value (Schrijver 2007) representing the unsigned magnetic ﬂux weighted with the inverse

distance from the PIL.

Also, we calculate the following characteristics of the entire AR (“global” characteristics):

8. The AR area deﬁned as the total area of the positive and negative segments.

9. The unsigned magnetic ﬂux in the AR area.

10. The maximum strength of magnetic ﬁeld in AR.

11. The unsigned horizontal gradient in the AR area.

LOS Characteristics and Flares

7

2.3. Deﬁnition of Positive and Negative Classes, and Construction of “Train” and “Test” Data Sets

The next important step is to associate the magnetic ﬁeld characteristics derived for each AR with

the ﬂare events detected by the GOES satellite. Following Nishizuka et al. (2017), we classify a set of

magnetic ﬁeld characteristics as a “positive” case if a

M1.0 ﬂare occurred in the corresponding AR

≥

within 24 h after the last ﬁeld measurement. This means that for each ﬂare there can be 24 positive

cases (sets of measured LOS magnetic ﬁeld characteristics) or less. For the period from April, 2010

to June, 2016, 521 M-class and 31 X-class ﬂares were associated with at least one positive case.

Ahmed et al. (2013) introduced two ways to determine the negative cases, described by so-called

“operational” and “segmented” associations of active region characteristics and ﬂares. According

to the operational association, the negative cases are deﬁned to be exactly opposite to the positive

cases, i.e. are assigned if there was no ﬂare of

M1.0 X-ray class within 24 h after the magnetic ﬁeld

≥

measurement. For the segmented association, the case is deﬁned as negative if no ﬂares occurred

48 h before and after the case time moment. In the following we will use the operational association

for the “test” subset while keeping the segmented association for the “train” subset. The segmented

association better separates the positive and negative cases (by neglecting negative cases occurring

very close to the ﬂare time), while the operational association is needed for real-time predictions.

The same procedure was applied also for

X1.0 class ﬂares.

≥

For the operational-type real-time ﬂare forecasts, the classiﬁer is deﬁned for future cases based on

the previously observed classiﬁed cases. To simulate the real-time operational forecast, we constructed

the “train” and “test” datasets to be sequential in time. We assign all the cases belonging to ARs

with the NOAA numbers 11059-12158 to the “train” data set, and AR 12159-12559 to the “test”

data set. The ratio of the “train” and “test” datasets is approximately 70% to 30% (following

Bobra & Couvidat 2015; Nishizuka et al. 2017). We also assume that we have just one attempt to

classify a “test” dataset for prediction of

M1.0 or

≥

tuning should be done on the “train” dataset only.

X1.0 ﬂares, which means that the classiﬁer

≥

3. EFFECTIVENESS OF CHARACTERISTICS

8

Sadykov and Kosovichev

In this Section, we analyze the eﬀectiveness of the derived magnetic ﬁeld characteristics to separate

the positive and negative (ﬂaring and non-ﬂaring) cases. One of the simplest ways to illustrate the

separation ability of magnetic ﬁeld characteristics is to construct combined histograms for positive

and negative cases. The examples of such histograms are presented in Fig. 2. The upper two panels

correspond to two PIL characteristics: the unsigned magnetic ﬂux in the PIL area and the gradient-

weighted PIL length; and the lower two panels correspond to two AR characteristics: the unsigned

magnetic ﬂux in the AR area and the unsigned horizontal gradient in the AR area.

One can notice that for the PIL characteristics there are more ﬂaring than non-ﬂaring cases in

the tails of the histograms (light color areas). We found such situation for all PIL characteristics

that we computed. For the global AR characteristics, we found a slight dominance of positive cases

in the distribution tail only for the unsigned magnetic ﬂux, and did not observe it for other three

characteristics.

There is one common feature in the histograms. The positive cases occur only if the characteristics

reach some critical (threshold) value. For some LOS characteristics the existence of the critical values

is more prominent in the normal-scaled histogram, but for others in the logarithmic-scaled histogram.

This feature is used to simplify the classiﬁcation (prediction) problem by reduction of the amounts of

data considered for the classiﬁcation. The red dashed (for

M1.0 ﬂares) and green dashed (for

≥

X1.0

≥

ﬂares) lines in Fig. 2 represent the threshold values, above which 95% of positive cases are observed.

Note that the threshold values are determined using the “train” data set. At the same time, the

mean values of the positive cases are shown by solid lines of the same color. The threshold and mean

values for the positive cases, as well as the mean value for the negative cases, are summarized in

Table 1.

There are many ways to quantitatively determine which characteristics are most eﬀective for a

classiﬁcation problem. The inclusion of characteristics that are not discriminative leads to a high

computational cost without improvement of the result, and may even decrease the performance of the

SVM (Bobra & Couvidat 2015). Breiman (2001) proposed to evaluate feature importance by using

the Random Forest classiﬁcation, which was also used by Nishizuka et al. (2017). Al-Ghraibah et al.

LOS Characteristics and Flares

9

(2015) employed the univariate True Skill Statistics (TSS) score as a measure of feature importance.

Ahmed et al. (2013) used the Correlation-Based Feature-Selection (CFS) and Minimum Redundancy

Maximum Relevance (MRMR) methods. Leka & Barnes (2003b) suggested the Mahalanobis distance

between classes and Hotelling’s T2-test to measure statistical diﬀerences between ﬂaring and non-

ﬂaring cases. Bobra & Couvidat (2015) calculated the Fisher Ranking score (or F-score) as a measure

of a univariate eﬀectiveness of the separation ability.

In this work, we calculated two simple univariate scores for the obtained magnetic ﬁeld character-

istics. Firstly, for each characteristic we derived the threshold separating 5% of the positive cases.

As seen from Table 1, these threshold values (for both

M1.0 and

≥

X1.0 ﬂares) are comparable or

≥

even greater than the mean values for the negative cases for most characteristics. Thus, the frac-

tion of negative cases which could be cut oﬀ by this threshold is used as a measure of eﬀectiveness

of characteristics in separating the “train” and “test” data sets. Secondly, we calculate the Fisher

ranking score (or F-score, Bobra & Couvidat 2015; Chang & Lin 2008):

F (i) =

1

n+

n+

1

−

k=1
P

(¯x+

i −

¯xi)2 + (¯x−
i −
1

¯xi)2
n−

(x+

k,i −

¯x+
i )2 +

n−

1

−

k=1
P

,

¯x−
i )2

(x−

k,i −

where ¯xi is the mean value of characteristic i; ¯x+

i and ¯x−

i are the mean values of characteristic i for

the positive and negative cases; and n+ and n− are the total numbers of the positive and negative

cases. We calculated the F-score for all the characteristics for the train dataset. Sometimes, the

F-score is higher if calculated for the logarithms of the parameters. Therefore, we also calculated the

F-scores of decimal logarithms of each parameter and used it if the score was higher than the one for

the normal-scaled characteristic.

The results for both estimates of eﬀectiveness are combined and summarized in Tables 2 and 3 for

the

M1.0 and

≥

X1.0 class ﬂares respectively. The cases for which the logarithmic scale was used

≥

in the F-score calculation are labeled as (log) in Tables 2 and 3. The SVM training and testing were

also done in the logarithmic scale for such parameters. One can notice from Tables 2 and 3 that

for every considered univariate test the PIL characteristics have higher scores than the global AR

parameters.

10

Sadykov and Kosovichev

4. METHODOLOGY OF FLARE PREDICTION

Currently most operational ﬂare forecasts are based on expert decision. However, many recent

works (Bobra & Couvidat 2015; Shin et al. 2016; Hada-Muranushi et al. 2016; Anastasiadis et al.

2017; Liu et al. 2017; Raboonik et al. 2017; Nishizuka et al. 2017) demonstrated that the Machine-

Learning algorithms can be successfully applied for ﬂare prediction.

In this Section, we test if it

is possible to forecast

M 1.0 and

≥

≥

X 1.0 ﬂares, using Machine-Learning algorithms based solely

on the LOS magnetic ﬁeld characteristics. Our approach is to utilize the Support Vector Machine

(SVM, Cortes & Vapnik 1995) classiﬁer for ﬂare forecasting using the Python module “Scikit-Learn”

(Pedregosa et al. 2011). The description of SVM can be found in Bobra & Couvidat (2015), and in

Appendix B.

The computational cost of the SVM classiﬁer scales with the number of cases in the “train” data

set and the number of features (characteristics, descriptors) as O(N 2

M) if N >> M. On one

×

hand, a large number of training samples should positively aﬀect the classiﬁer performance. On the

other hand, the SVM classiﬁer has many parameters that should be optimized, and the computing

time quadratically increases with the size of “train” dataset. Thus, any possibility to reduce the

number of cases which need to be classiﬁed should be utilized.

In the previous Section we have

found that the ﬂaring cases mostly occur if a speciﬁc characteristic exceeds a certain threshold. We

have also obtained that the PIL descriptors are more eﬀective in the separation of the positive and

negative cases. Thus, we ﬁrst performed the classiﬁcation based on the PIL characteristics only. We

automatically classiﬁed a case as negative if any of its PIL characteristics was below the corresponding

threshold. It was found that this procedure allows us to reduce the amount of data for the SVM

classiﬁcation by 74.4% (leaving about 1/4 of all cases) for the

≥
X1.0 class ﬂares. Only about 11.6% of positive cases for the

the

M1.0 class ﬂares and by 91.2% for

M1.0 and 14.0% for the

≥

X1.0

≥

≥

class ﬂares were misclassiﬁed as negative at this stage. To check the validity of this approach, we

repeated the training procedure with the threshold values decreased by a factor of two that led to

exclusion of 52.2% of cases (two times more cases need to be classiﬁed) for the

M1.0 class and

≥

72.8% (three times more cases need to be classiﬁed) for the

X1.0 class cases. We have also checked

≥

LOS Characteristics and Flares

11

how the inclusion of the global AR parameters (AR area, unsigned magnetic ﬂux, maximum strength

of magnetic ﬁeld, and unsigned horizontal gradient) aﬀect the forecasting result by repeating the

training procedure with all 11 parameters.

For the SVM training, we normalize the “train” dataset following Nishizuka et al. (2017): Z =

(X

−

µ)/σ, where X is a non-normalized data set, µ is the mean, and σ is the standard deviation.

We use the same µ and σ parameters to normalize the “test” data set. To ﬁnd the optimal SVM kernel

(among the Linear, RBF, Polynomial, and Sigmoid available in the Python Scikit-Learn package)

and its parameters, we perform a cross-validation procedure on the “train” dataset: divide it into

two subsets (one simulating the train data set, and another simulating the test data set) ten times,

and then average the SVM results. As a measure of the SVM performance, we use the True Skill

Statistics (TSS) metrics deﬁned as:

T SS =

T P

T P + F N −

F P
F P + T N

,

where T P is the true positive prediction (number of positive cases predicted as positive), T N is the

true negative prediction (number of negative cases predicted as negative), F P is the false positive

prediction (number of negative cases predicted as positive), F N is the false negative prediction

(number of positive cases predicted as negative). The T SS score is not sensitive to the class imbalance

ratio (the relative number of positive and negative cases), and is zero for a pure negative prediction

(when all cases are predicted as negative). The standard deviation of the T SS was estimated from

the scores obtained during the cross-validation procedure with the optimal parameters.

5. RESULTS

In Section 3 it was pointed out that the PIL characteristics separate ﬂaring and non-ﬂaring cases

more eﬀectively than the global (integrated) characteristics obtained for the whole ARs. The results

in Tables 2 and 3 demonstrate that all PIL characteristics give approximately the same scores in both

tests for both, the

M1.0 and

≥

X1.0 ﬂare predictions. Among the global AR characteristics, the

≥

12

Sadykov and Kosovichev

highest score is obtained for the unsigned magnetic ﬂux in the AR area, but still it does not exceed

the scores for any PIL parameter.

The results of prediction tests based on the PIL parameters only are summarized in the second

column of Table 4. For the

M1.0 class solar ﬂares, we found that the best score of T SS = 0.76

≥

0.03

±

can be obtained using the “sigmoid” SVM kernel (described in Appendix B) with parameters C = 0.1,

γ = 0.01 and r = 0.001, and the negative/positive class weights of 1/20. Description of these

parameters can be found in Appendix B. The score was derived from the following classiﬁcation

results: T P = 1932, T N = 42382, F P = 6654, F N = 234 (including all cases in the test dataset).

For the

X1.0 class solar ﬂares, we obtained T SS = 0.84

≥

0.07 for the same “sigmoid” SVM kernel

±

but with diﬀerent parameters: C = 0.0001, γ = 10.0 and r = 0.0001, and the negative/positive

classes weights of 1/100. This T SS was derived from the following classiﬁcation results: T P = 194,

T N = 44991, F P = 6009, F N = 8.

Interestingly, the ﬂare forecasts performed using only the PIL characteristics have almost the same

TSS scores as the forecasts based on the full set of characteristics (including both the PIL and global

AR characteristics). The TSS scores for the full set of characteristics are summarized in the third

column of Table 4. For prediction of

M1.0 solar ﬂares, the inclusion of global characteristics even

≥
decreased the TSS score from T SS =0.76 to T SS =0.74. For prediction of

X1.0 ﬂares, we have

≥

obtained the same T SS =0.84 score.

The last column of Table 4 summarizes the results of the classiﬁcation using the PIL parameters

with the pre-classiﬁcation threshold decreased by a factor of two. The 50% decrease of the threshold

(which results in a smaller number of pre-classiﬁed samples) leads to an insigniﬁcant increase of

TSS for the

X1.0 ﬂare prediction (from T SS =0.84 to T SS =0.85) and gives the same TSS for

≥

the

M1.0 ﬂare prediction. Thus, we can conclude that it is possible to pre-classify a signiﬁcant

≥

number of cases (74.4% for the

M1.0 class ﬂares and 91.2% for the

≥

X1.0 class ﬂares) by applying

≥

thresholds to the PIL parameters without a signiﬁcant decrease of the prediction TSS score.

6. DISCUSSION AND CONCLUSION

LOS Characteristics and Flares

13

In this paper, we have developed a machine-learning procedure solely based on the line-of-sight

(LOS) magnetic ﬁeld observations that are available in near-real time from space-based and ground-

based observatories. The procedure is based on analysis of characteristics of the magnetic ﬁeld Polar-

ity Inversion Line (PIL) which is automatically identiﬁed by performing the magnetogram segmen-

tation formulated as an optimization task. The PIL characteristics were derived from the SDO/HMI

magnetograms for each AR with 1 h cadence. We estimated the eﬀectiveness of these characteristics

for forecasting

M1.0 and

≥

X1.0 solar ﬂares, and trained the Support Vector Machine (SVM) to

≥

maximize the True Skill Statistics (TSS) metrics. Interestingly, the univariate eﬀectiveness scores

are similar for all PIL characteristics, probably, because the PIL characteristics (except, possibly, the

Maximum gradient across PIL) correlate with each other (depend on the same PIL length or the PIL

area that depends on the PIL length).

The obtained True Skill Statistics scores T SS = 0.76 for prediction of

M1.0 class ﬂares, and

≥

T SS = 0.84 for prediction of

X1.0 class ﬂares, can be compared with the scores mentioned in

≥

other works. For example, Anastasiadis et al. (2017) reported T SS

0.5 for the prediction of

≈

C1.0 class ﬂares, Shin et al. (2016) received a maximum of T SS = 0.371 for

≥
Hada-Muranushi et al. (2016) — the T SS = 0.295 for

M1.0 class ﬂares,

≥

M1.0 class ﬂares, Liu et al. (2017) — T SS =

≥

0.50 for

M1.0 class ﬂares. On the other hand, our T SS score for

≥

M1.0 is lower than ones in

≥

the works of Bobra & Couvidat (2015, T SS =0.817), Nishizuka et al. (2017, T SS =0.88 for SVM

classiﬁer), Raboonik et al. (2017, T SS =0.856). Also, Nishizuka et al. (2017) reported a higher TSS

score for

X1.0 class ﬂares (T SS = 0.88 for SVM classiﬁer). Our results solely based on the line-of-

≥

sight magnetic ﬁeld observations are lower than those obtained with the use of vector magnetograms,

but still comparable.

The score for

M1.0 class ﬂares received in our work is higher than the known expert predictions

≥

quoted by Nishizuka et al. (2017): T SS = 0.50 for the NICT Space Weather Forecasting Center

and T SS = 0.34 for the Royal Observatory of Belgium (Devos et al. 2014). It is also higher than

the T SS = 0.53 of the National Oceanic and Atmospheric Administration (NOAA) Space Weather

Prediction Center (SWPC) deduced from Table 4 of Crown (2012). For the

X1.0 ﬂares, again, our

≥

14

Sadykov and Kosovichev

result is higher than the expert prediction with T SS = 0.21 (the NICT Space Weather Forecasting

Center, Nishizuka et al. 2017) and with T SS = 0.49 (SWPC NOAA, deduced from Table 4 of Crown

2012). We can conclude that the accurately-tuned machine-learning technique, even if it is solely

based on the LOS magnetic ﬁeld measurements, can compete with the expert-based predictions.

It is necessary to discuss the inﬂuence of the data set construction on the prediction results. First,

the way of the division of the data set into the “train” and “test” subsets can change the prediction

scores. For example, the shuﬄed division (when the “train” and “test” subsets are not consequent

in time, but all cases from one AR are kept in one subset) reduces the scores from T SS = 0.76 to

T SS = 0.70 for

M1.0 class ﬂares, and from T SS = 0.84 to T SS = 0.63 for

≥

X1.0 class ﬂares. The

≥

strong diﬀerence in the TSS score for

X1.0 class ﬂares is caused by a low number of X-class ﬂares

≥

in the data set. In this work, we relied on the NOAA AR detection and considered every case with

the detectable PIL, which already makes the data set to be subjective to the PIL detection method.

Nishizuka et al. (2017) used their own method to detect ARs, which deﬁnitely leads to another data

set with larger number of cases. Bobra & Couvidat (2015) reduced the actual data set by cutting out

some randomly-selected portion of negative cases. Thus, to guarantee the accurate comparison of

diﬀerent prediction methods, one should unify the starting data set and its division into the “train”

and “test” subsets. Such attempts were done previously (Barnes et al. 2016), and hopefully will be

continue in the future.

The important role of PIL in the ﬂare development process was pointed out in many observations,

simulations and forecasts of solar ﬂares. Generally, the PILs are characterized by highly-sheared

magnetic ﬁelds, strong ﬁeld gradients and complicated topology of neighboring magnetic ﬁeld struc-

tures. These properties result in a substantial amount of free magnetic energy that can be released

in ﬂares. It is not surprising that many ﬂares are developed locally in the PIL vicinity. Our study

statistically conﬁrms the importance of the PIL characteristics for ﬂare forecasting. In particular, it

demonstrated that the PIL characteristics obtained just from the line-of-sight magnetic ﬁeld compo-

nent can be used to obtain ﬂare predictions compatible with expert-based forecasts and comparable

to the predictions that are based on full vector magnetic ﬁeld observations. However, our results are

LOS Characteristics and Flares

15

accompanied by a signiﬁcant number of false positive predictions. Generally, a more accurate com-

parison of machine-learning-based and expert-based predictions is required. Despite the promising

results, we should always keep in mind that the prediction is metrics-dependent. In this work, we

maximize the True Skill Statistics in a single parameter setup. Maximizing other metrics can result

in other optimal SVM parameters and prediction scores (Bobra & Couvidat 2015). Further work is

needed to develop algorithms for quantitative prediction of the ﬂare class and physical properties

(eruptive or non-eruptive nature, geo-eﬀectiveness etc).

Authors thank the anonymous referee for the helpful and detailed review of the paper. Authors

thank the GOES and SDO/HMI teams for the availability of high-quality scientiﬁc data. Authors

also thank D. Laptev for valuable discussions of the magnetogram segmentation algorithm. The

research was partially supported by the NASA Grants NNX14AB68G and NNX16AP05H.

APPENDIX

A. MAGNETOGRAM SEGMENTATION AND PIL DETECTION ALGORITHM

Suppose B is a magnetic ﬁeld strength map (magnetogram), Zi is a class of pixel i of the magne-

togram (i.e. “positive”, “negative” or “neutral”), N is the total number of pixels in the magnetogram,

ε(i) is a neighborhood (e.g. the closest 8 pixels) of pixel i. The magnetogram segmentation can be

formulated as the following optimization procedure to maximize function p(Z, B) for a given B by

ﬁnding optimal classiﬁcation Zmax (Laptev 2011):

p(Zmax, B) = max

Z

p(Z, B)

N

∝

i=1
Y

φi(Zi, Bi)

φ(Zi, Zj)

Yj∈ε(i)

Here φi(Zi, Bi) and φ(Zi, Zj) are the scoring functions for each pixel depending on the magnetic

ﬁeld strength and assumed classes of pixels. The choice of the scoring function deﬁnes segmentation

characteristics and, in fact, should do the following: separate the segments of positive and negative

magnetic ﬁeld polarity, and avoid very small segments with weak ﬁeld probably coming from noise

in the data. We use the scoring functions suggested by Chernyshov et al. (2011):

φi(Zi, Bi) = e−C1√|B0−Bi|, for Zi “positive”

16

Sadykov and Kosovichev

φi(Zi, Bi) = e−C1√|B0+Bi|, for Zi “negative”

φi(Zi, Bi) = e−C2|Bi|, for Zi “neutral”

φ(Zi, Zj) = eCpair[Zi6=Zj],

where parameters C1 = 1.0, C2 = 1.0, Cpair = 20, B0 = 1000 G are chosen to obtain a stable

segmentation of magnetic polarities in strong ﬁeld regions. Here [Zi

= Zj] is equal 1 if Zi

= Zj, and

zero otherwise. Following Laptev (2011), the function p(Z, B) is interpreted as conditional probability

density function p(Z

|

B), and is approximated by the factorized probability density function q(Z) =

n
i=1 qi(Zi). To measure how strongly the factorized distribution deviates from the actual, one can

Q
use the Kullback-Leibler (KL) divergence (Bishop 2006). In order to ﬁnd the best approximating

factorized distribution, q(Z), one can minimize the KL divergence:

min
q(Z)

KL(q

p) =

||

−

Z

q(Z)log

p(Z

B)

|
q(Z)

dZ

Here we keep the original notation for KL-divergence KL(q

p) between distributions q and p

||

introduced in Bishop (2006). The optimal q(Z) is given by solution of the equation (following

Chernyshov et al. 2011):

qi(Zi) =

1
C

exp(log(φi(Zi))

Cpair

−

qj(Zj))

j6=i
Xt∈ε(i) X

which can be found iteratively:

qnew
i

(Zi) =

1
C

exp(log(φi(Zi))

Cpair

−

qold
j (Zj))

j6=i
Xt∈ε(i) X

Using this equation, one can calculate the factorized distribution multiplier qi for each pixel i

and its assumed class Zi (“positive”, “negative”, or “neutral”). Because the factorized distribution

represents the product of multipliers for each pixel, one can simply maximize qi(Zi) for each pixel i

separately and obtain Zmax.

For identiﬁcation of PIL in active regions, we smooth the original HMI magnetogram using the

Gaussian ﬁlter with width σ =1.5′′, and apply the segmentation algorithm. Then, we apply a

morphological dilation procedure separately for positive and negative segments (i.e. expand each

6
6
LOS Characteristics and Flares

17

segment to include neighboring pixels), and ﬁnd the PIL as an intersection of the dilated positive

and negative segments. Finally, we ﬁlter all small islands of the PIL with the number of pixels less

than 3% of the total number of pixels occupied by PIL. This approach is quite robust, and allows us

to automatically identify the PIL and calculate magnetic ﬁeld properties.

B. DESCRIPTION OF THE SVM CLASSIFIER

The Support Vector Machine (SVM, Cortes & Vapnik 1995) classiﬁer is the widely-used supervised-

learning classiﬁcation algorithm. The SVM ﬁnds a plane in the descriptor space, which optimally

separates the positive and negative cases by solving the following functional minimization problem:

min
ω,ǫ

L =

1
2 ||

ω

||

m

2 + C

Wiǫi,

i=1
X

ω, xi

yi(

h

i

+ b)

1

−

≥

ǫi,

ǫi

0,

≥

where ω is a vector normal to the separating plane; i is case number in the “train” dataset, varying

from 0 to m; C is a soft margin parameter; Wi is the weight of the group which the case i belongs

to, ǫi is a measure of misclassiﬁcation of case i; yi is a constant equal to 1 for positive cases, and

-1 for negative cases. After some transformations, this problem becomes a quadratic minimization

problem: the functional depends only on scalar products of vectors of characteristics

xi, xj

h

i

. To

achieve better separation between the positive and negative cases, very often the so-called Kernel

trick is used. The scalar product of characteristics in the functional is replaced by a function of the

characteristics:

xi, xj

h

i →

k(xi, xj).

In this work, we have tested several kernels available in the Python Scikit-Learn package:

k(xi, xj) =

xi, xj

h

i

(Linear),

k(xi, xj) = (γ

xi, xj

h

i

)d (P olynomial),

k(xi, xj) = exp(

γ

−

xi
|

−

xj

2) (RBF ),
|

k(xi, xj) = tanh(γ

xi, xj
h

i

+ r) (Sigmoid),

18

Sadykov and Kosovichev

where γ, r and d are tuning parameters. The other SVM parameters are the soft margin parameter

and weights for both classes (multipliers of the soft-margin parameter). One needs to optimize all

these parameters during the cross-validation procedure.

REFERENCES

Ahmed, O.W., Qahwaji, R., Colak, T. et al. 2013,

Devos, A., Verbeeck, C., & Robbrecht, E. 2014,

SoPh, 283, 157

JSWSC, 4, A29

Al-Ghraibah, A., Boucheron, L.E., McAteer,

Emslie, A.G., Dennis, B.R., Shih, A.Y. et al. 2012,

R.T.J. 2015, A&A, 579, A64

ApJ, 759, 71

Anastasiadis, A., Papaioannou, A., Sandberg, I. et

Falconer, D.A., Moore, R. L., Porter, J. G. et al.

al. 2017, SoPh, 292, 134

1997, ApJ, 482, 519

Bamba, Y., Inoue, S., Kusano, K., and Shiota, D.

Falconer, D.A., Moore, R.L. and Gary, G.A. 2003,

2017, ApJ, 838, 134

Journal of Geophysical Research (Space

Barnes, G., Leka, K.D., Schrijver, C.J. et al. 2016,

Physics), 108, 1380

ApJ, 829, 89

Falconer, D., Barghouty, A.F., Khazanov, I. and

Bishop, C. 2006, “Pattern Recognition and

Moore, R. 2011, Space Weather, 9, S04003

Machine Learning”, Springer, 55

Falconer, D.A., Moore, R.L., Barghouty, A.F. and

Bobra, M.G. and Couvidat, S. 2015, ApJ, 798, 135

Khazanov, I. 2012, ApJ, 757, 32

Bobra, M.G. and Ilonidis, S. 2016, ApJ, 821, 127

Falconer, D.A., Moore, R.L., Barghouty, A.F. and

Breiman, L. 2001, Machine Learning, 45, 5

Khazanov, I. 2014, Space Weather, 12, 306

Chang, Yin-Wen, & Lin, Chih-Jen 2008, in JMLR:

Guennou, C., Pariat, E., Leake, J.E. and Vilmer,

Workshop and Conf. Proc. 3, WCCI 2008

N. 2017, Journal of Space Weather and Space

Workshop on Casuality (Brookline, MA:

Climate, 7, 17

Microtone Publishing), 53

Hada-Muranushi, Y., Muranushi, T., Asai, A. et

Chernyshov, V., Laptev, D. and Vetrov, D. 2011,

al. 2016, ArXiv e-prints, 1606.01587

The 21st International Conference on Computer

Hagyard, M.J., Venkatakrishnan, P. and Smith,

Graphics and Vision, Russia, Moscow,

Jr., J.B. 1990, ApJS, 73, 159

September 26-30

Jing, J., Song, H., Abramenko, V. et al. 2006,

Cortes, C., & Vapnik, V. 1995, Mach. Learn., 20,

ApJ, 644, 1273

273

Kors´os, M.B., Baranyi, T. and Ludm´any, A. 2014,

Crown, M.D. 2012, Space Weather, 10, S06006

ApJ, 789, 107

LOS Characteristics and Flares

19

Kors´os, M.B., Ludm´any, A., Erd´elyi, R. and

Pedregosa, F., Varoquaux, G., Gramfort, A., et al.

Baranyi, T. 2015, ApJL, 802, 21

2011, J. Mach. Learn. Res., 12, 2825

Kors´os and Erd´elyi, R. 2016, ApJ, 823, 153

Raboonik, A., Safari, H., Alipour, N., Wheatland,

Kosovichev, A.G. and Zharkova, V.V. 2001, ApJL,

M. 2017, ApJ, 834, 11

550, L105

Scherrer, P.H., Schou, J. and Bush, R.I. 2012,

Kumar, P., Yurchyshyn, V., Wang, H. and Cho,

SoPh, 275, 207

K.-S. 2015, ApJ, 809, 83

Schrijver, C.J. 2007, ApJL, 655, L117

Kusano, K., Bamba, Y., Yamamoto, T.T. et al.

Schrijver, C.J. 2016, ApJ, 820, 103

2012, ApJ, 760, 31

Severny, A.B. 1964, ARA&A, 2, 363

Laptev, D. 2011, Specialist Dissertation “Search

Sharykin, I.N., Sadykov, V.M., Kosovichev, A.G.

for Informative features on Solar

et al. 2016, ArXiv e-prints, 1604.05380

Magnetograms”, Department of Computational

Shin, S., Lee, J.Y., Moon, Y.J. et al. 2016, SoPh,

Mathematics and Cybernetics, Moscow State

291, 897

University, Moscow, Russia

Stenﬂo, J. O. and Kosovichev, A. G. 2012, ApJ,

Leka, K.D. and Barnes, G. 2003, ApJ, 595, 1277

745, 129

Leka, K.D. and Barnes, G. 2003, ApJ, 595, 1296

Toriumi, S., Iida, Y., Bamba, Y. et al. 2013, ApJ,

Leka, K.D. and Barnes, G. 2003, ApJ, 656, 1173

773, 128

Liu, C., Deng, N., Wang, J.T.L. and Wang, H.

2017, ApJ, 843, 104

Mandage, R. S. and McAteer, R. T. J. 2016,

ArXiv e-prints, 1611.00830

Mason, J.P. and Hoeksema, J.T. 2010, ApJ, 723,

634

Nishizuka, N., Sugiura, K., Kubo, Y. 2017, ApJ,

835, 156

Toriumi, S., Iida, Y., Kusano, K. et al. 2014,

SoPh, 289, 3351

Toriumi, S., Schrijver, C.J., Harra, L.K. et al.

2017, ApJ, 834, 56

Wang, H., Ewell, Jr., M.W., Zirin, H. and Ai, G.

1994, ApJ, 424, 436

Zimovets, I.V., Wang, R., Liu, Y.D. et al. 2017,

ArXiv e-prints, 1708.01869

20

Sadykov and Kosovichev

Figure 1. Illustration of the PIL automatic identiﬁcation procedure: a) The magnetogram of AR 11158

obtained by the SDO/HMI at 2011-02-16 20:00:00 UT. b) The magnetogram segmentation and identiﬁcation

of PIL: red, green, and blue areas correspond to negative, neutral and positive segments. The PIL identiﬁed

by the algorithm described in Appendix A is shown by white curves.

LOS Characteristics and Flares

21

Figure 2. 1D-histograms of a) unsigned magnetic ﬂux in the PIL area; b) gradient-weighted PIL length;

c) unsigned magnetic ﬂux in the AR area; d) unsigned horizontal gradient in the AR area. The negative

cases are shown in grey, the positive

≥

M1.0 class cases are shown in red, and the positive

X1.0 class cases

≥

are shown in green. The darker areas represent the intersections of the histograms. The red and green solid

lines represent the average values of the positive

M1.0 and

≥

≥

X1.0 cases, the corresponding dashed lines

show the thresholds corresponding to 5% of positive cases.

Table 1. Relationship between magnetic ﬁeld characteristics and solar ﬂares of the GOES X-ray classes greater than M1.0 and X1.0.

Columns 2 and 3 show the average values of the parameters for the

M1.0 and

X1.0 class ﬂares correspondingly. Columns 4 and 5 show

Average value

Average value

5% threshold

5% threshold

(negative cases)

(positive ≥M1.0 cases)

(positive ≥X1.0 cases)

(positive ≥M1.0 cases)

(positive ≥X1.0 cases)

the thresholds, above which 95% of all

Characteristic

PIL length [m]

PIL area [m

2

]

M1.0 and

≥
Average value

≥

(1.7±1.8)·10

7

(6.8±4.0)·10

7

(8.3±3.6)·10

7

(7.3±5.5)·10

14

(19.3±7.9)·10

14

(21.8±7.6)·10

14

≥
X1.0 class ﬂares were observed.

≥

Unsigned magnetic ﬂux in the PIL area [G · m

2

]

(1.14±1.15)·10

17

(4.68±2.98)·10

17

(5.96±2.98)·10

17

Unsigned horizontal gradient in the PIL area [G · m]

(0.81±0.75)·10

11

(2.93±1.67)·10

11

(3.40±1.34)·10

11

Maximum gradient across the PIL [G/m]

(3.8±2.3)·10

−4

(9.0±4.4)·10

−4

(10.3±3.4)·10

−4

Gradient-weighted PIL length [m · G/m]

(3.1±4.1)·10

3

(19.4±16.4)·10

3

(24.1±13.2)·10

3

R-value [G · m

2

]

AR area [m

2

]

(2.4±3.2)·10

15

(14.2±11.7)·10

15

(19.1±10.7)·10

15

(4.8±4.0)·10

15

(10.1±4.9)·10

15

(11.9±4.7)·10

15

Unsigned magnetic ﬂux in the AR area [G · m

2

]

(7.7±7.1)·10

17

(21.1±13.0)·10

17

(29.2±13.0)·10

17

Maximum strength of magnetic ﬁeld in the AR [G]

(1.31±0.41)·10

3

(1.66±0.48)·10

3

Unsigned horizontal gradient in the AR area [G · m]

(6.1±5.4)·10

11

(13.4±7.4)·10

11

(1.84±0.52)·10

3

(16.5±8.2)·10

11

7

1.7·10

14

7.9·10

1.20·10

17

0.89·10

11

−4

3.7·10

3

2.8·10

15

2.0·10

15

3.2·10

17

5.6·10

1.06·10

3

11

3.9·10

7

3.2·10

14

9.6·10

1.57·10

17

1.47·10

11

−4

5.3·10

3

6.2·10

15

4.8·10

15

3.7·10

17

7.1·10

1.20·10

3

11

4.3·10

v
e
h
c
i
v
o
s
o
K
d
n
a

v
o
k
y
d
a
S

2
2

LOS Characteristics and Flares

23

Table 2. Importance of magnetic ﬁeld characteristics for the forecast of

M1.0 class solar ﬂares.

≥

Characteristic

Fraction of negative

F-score

cases below threshold, %

PIL length (log)

PIL area

Unsigned magnetic ﬂux in the PIL area (log)

Unsigned horizontal gradient in the PIL area (log)

Maximum gradient across the PIL (log)

Gradient-weighted PIL length (log)

R-value (log)

AR area (log)

Unsigned magnetic ﬂux in the AR area (log)

Maximum strength of magnetic ﬁeld in the AR (log)

Unsigned horizontal gradient in the AR area

0.63

0.60

0.63

0.64

0.56

0.62

0.61

0.44

0.49

0.29

0.44

1.41

1.46

1.41

1.48

1.15

1.45

1.35

0.66

0.86

0.30

0.69

24

Sadykov and Kosovichev

Table 3. Importance of magnetic ﬁeld characteristics for the forecast of

X1.0 class solar ﬂares.

≥

Characteristic

Fraction of negative

F-score

cases below threshold, %

PIL length

PIL area

Unsigned magnetic ﬂux in the PIL area

Unsigned horizontal gradient in the PIL area

Maximum gradient across the PIL

Gradient-weighted PIL length (log)

R-value (log)

Total AR area

Unsigned magnetic ﬂux in the AR area (log)

Maximum strength of magnetic ﬁeld in the AR (log)

Unsigned horizontal gradient in the AR area (log)

0.84

0.71

0.74

0.83

0.79

0.84

0.84

0.51

0.60

0.41

0.49

2.68

2.36

2.51

2.81

2.46

2.62

2.47

1.32

1.91

0.68

1.29

LOS Characteristics and Flares

25

Table 4. Comparison of TSS scores for diﬀerent methods of prediction of

M1.0 and

≥

≥

X1.0 class solar

ﬂares. The standard deviations are estimated using a cross-validation procedure.

PIL characteristics only PIL + global characteristics

50% decreased cutoﬀ values

Prediction of

Prediction of

M1.0 ﬂares

≥

X1.0 ﬂares

≥

0.76

0.84

±

±

0.03

0.07

0.74

0.84

0.03

0.07

±

±

0.76

0.85

0.03

0.04

±

±

