Uncertainty amplification due to density/refractive-
index gradients in volumetric PTV and BOS 
experiments 

Lalit K. Rajendran1, Sally P. M. Bane1 and Pavlos P. Vlachos2* 

1Purdue University, School of Aeronautics and Astronautics, West Lafayette, USA. 

2 Purdue University, School of Mechanical Engineering, West Lafayette, USA. 

*pvlachos@purdue.edu 

Abstract 

We  theoretically  analyze  the  effect  of  density/refractive-index  gradients  on  the  measurement 
precision  of  Volumetric  Particle  Tracking  Velocimetry  (V-PTV)  and  Background  Oriented 
Schlieren  (BOS)  experiments  by  deriving  the  Cramer-Rao  lower  bound  (CRLB)  for  the  2D 
centroid estimation process. A model is derived for the diffraction limited image of a particle or 
dot  viewed  through  a  medium  containing  density  gradients  that  includes  the  effect  of  various 
experimental  parameters  such  as  the  particle  depth,  viewing  direction  and  f-number.  Using  the 
model we show that non-linearities in the density gradient field lead to blurring of the particle/dot 
image. This blurring amplifies the effect of image noise on the centroid estimation process, leading 
to an increase in the CRLB and a decrease in the measurement precision. The ratio of position 
uncertainties  of  a  dot  in  the  reference  and  gradient  images  is  a  function  of  the  ratio  of  the  dot 
diameters  and  dot  intensities.  We  term  this  parameter  the  Amplification  Ratio  (AR),  and  we 
propose  a  methodology  for  estimating  the  position  uncertainties  in  tracking-based  BOS 
measurements. The theoretical predictions of the particle/dot position estimation variance from the 
CRLB  are  compared  to  ray  tracing  simulations  with  good  agreement.  The  uncertainty 
amplification  is  also  demonstrated  on  experimental  BOS  images  of  flow  induced  by  a  spark 
discharge, where we show that regions of high amplification ratio correspond to regions of density 
gradients. This analysis elucidates the dependence of the position error on density and refractive-
index gradient induced distortion parameters, provides a methodology for accounting its effect on 
uncertainty quantification and provides a framework for optimizing experiment design. 

 
 
 
 
 
Nomenclature 

𝐼 
𝐼#,%  

𝑟 
𝑁* 

Image intensity 
Peak image intensity for a single light 
ray 
Light ray index 
Number of light rays 

𝑋, 𝑌 

Spatial  co-ordinates  on  the  camera 
sensor/image space 
Point spread function 
𝜏 
Gray Level 
𝑔 
Pixel indices 
𝑘, 𝑙 
𝑀  Magnification 

𝜖 

𝑡 

𝜃 
𝜂 

𝑍E 

𝛿 
𝑓 

Angular Deflection 

Spatial  co-ordinate  on  the  density 
field 
Light Ray angle 
Standard  deviation  of  the  Gaussian 
intensity profile on the image plane 
Distance from dot pattern to density 
gradient field 
Dirac delta function 
Signal 

Expectation operator 
𝑬 
Blurring Coefficient 
𝛽 
𝜆  Wavelength of light 
𝛼 
𝐴𝑅 

Image exposure 
Amplification Ratio 

𝐾 
𝜌 

Gladstone-Dale constant 
Density 

𝑛# 
𝑥, 𝑦, 𝑧 

𝐽12 

𝛾 
𝑑% 
𝑛9 
𝑝 

𝒇 

𝒂 

𝑎1 
𝜎 

𝑵 

𝑓# 
𝜁 

𝑚 
𝑢 
𝑅12 
Δ𝜃# 
𝑇U⃗	 

Ambient refractive index 
Coordinates    in  the  object 
space 
Fisher Information matrix 

Gray value per unit exposure 
Pixel Pitch 
Thermal Noise 
Probability Density Function 
(PDF) 
Signal/Measurement 

Model Parameter vector 

Model Parameter 
Standard Deviation 

Normal distribution 

F-number 
Particle  depth  in  the  density 
gradient field 
Model 
Measurement 
Rotation matrix 
Angle of the ray cone 
Translation vector 

 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
1  Introduction 

Particle Image Velocimetry (PIV)/Particle Tracking Velocimetry (PTV) and Background Oriented 
Schlieren (BOS) are widely used flow diagnostic techniques. PIV/PTV are used to measure the 
local velocity of a fluid flow by tracking the displacement of tracer particles over time. BOS is 
used to measure density gradients in a fluid by measuring the apparent distortion of a target dot 
pattern. These techniques have been applied to a wide variety of  small and large scale flow fields 
in both laboratory and industrial facilities [1]–[4]. 

However, all three techniques suffer from distortions due to density/refractive-index gradients that 
are present in a wide variety of fluid flow experiments, such as compressible flows, multiphase 
flows, flows in facilities with curved windows etc.  This is because changes in density/refractive 
index cause refraction of light rays emanating from the light source (particles for PIV/PTV and 
dots  or  speckle  patterns  for  BOS).  These  distortions  affect  the  final  image,  and  since  the 
measurements rely on processing this image, their effect on measurement accuracy and precision 
is an important concern.  

Past work by Elsinga et. al. [5]–[7] analyzed this problem for 2D planar PIV and showed that the 
effect of aero-optical distortions due to density/refractive-index gradients can be divided into three 
categories.  First,  the  refraction  of  light  rays  emerging  from  a  particle  results  in  an  apparent 
displacement of the particle when viewed on the camera and leads to a bias error in the position. 
Second,  when  the  particle  moves  to  a  different  location  in  the  next  time  instant,  the  refraction 
experienced  by  the  light  rays,  the  corresponding  apparent  displacement  of  the  particle,  and  the 
resulting position error will be different, and the difference in the two position errors between the 
two time instants leads to a bias error in the velocity. Finally, in a situation with very strong spatial 
variations in the density/refractive index (such as shock waves), the refraction experienced by two 
light rays emerging from the same particle can be very different, leading to a blurring of the particle 
image. This blurring is asymmetric and is in the direction of decreasing density. Elsinga et. al. also 
found that this blur leads to a broadening of the cross-correlation plane leading to increased random 
error and a decrease in measurement precision [6]. 

The impact of distortions due to density/refractive-index gradients has not been analyzed for multi-
camera volumetric PTV experiments, which is the current state of the art in three-dimensional, 
three-component (3D3C) velocity measurement [8]–[10]. The additional challenges introduced in 
these experiments are (1) varying depth of particles within the laser sheet and (2) varying angle 
between  the  direction  of  the  density  gradient  field  and  the  viewing  direction  for  the  different 
cameras. Another challenge is the need to use small apertures (large f-numbers) in order to keep a 
thick laser in focus, which can reduce the illumination across the field of view and increase the 
effect  of  image  noise  on  the  measurement.  Similarly,  these  issues  are  of  importance  for  BOS 
experiments, where the deflections of the light rays and the apparent displacement of the dots now 

 
comprise a signal and not an error, and in these cases, the effect of image blur on the centroid 
estimation is most important.  

For  both  measurement  techniques,  tracking-based  displacement  estimation  methods  have  been 
shown  to  be  more  accurate  and  precise  than  correlation-based  methods.  In  volumetric  PTV, 
Lagrangian  tracking  as  proposed  in  the  Shake-The-Box  algorithm  by  Schanz  et.  al.  [10] 
significantly  increases  accuracy  and  spatial  resolution,  suppresses  the  identification  of  ghost 
particles,  and  reduces  reconstruction  time  even  at  high  seeding  densities,  as  the  temporal 
information is used to improve particle reconstruction. In BOS, the dot locations on the target are 
known  from  the  time  of  manufacture,  and  this  information  can  be  used  to  improve  the  spatial 
resolution and enable the method to be applied even in images with high dot densities [11].  

In tracking-based methods, the centroid estimation process from the particle/dot image controls 
the  measurement  accuracy  and  precision.  Therefore,  the  primary  effect  of  distortions  due  to 
density/refractive-index  gradients  is  to  increase  the  2D  position  error  due  to  the  apparent 
displacement of the particle (bias error) and the particle image blur (random error). In volumetric 
PTV,  this  2D  position  error  from  the  images  will  in  turn  also  affect  the  3D  position  error  of 
triangulating  a  particle’s  location  in  the  measurement  volume.  In  BOS,  the  2D  position  error 
increases the noise floor and reduces the dynamic range of the measurement, especially since the 
displacements in a typical BOS experiment are generally low (< 1 pix.).  

We investigate these issues using a theoretical analysis on the effect of density/refractive-index 
gradients on the measurement precision of the centroid estimation of a particle/dot. The analysis 
is  performed  using  an  established  theoretical  framework  called  the  Cramer-Rao  Lower  Bound 
(CRLB), a concept borrowed from the field of parameter estimation [12].  

1.1  Cramer-Rao Lower Bound (CRLB) 

In  any  experiment,  the  recorded  measurement  is  a  combination  of  the  signal,  which  is  the 
deterministic aspect of the measurement based on a physical model, and stochastic noise. Given 
the  measurement,  one  would  like  to  use  a  model  for  the  measurement  process  to  calculate  a 
parameter  of  interest,  where  the  particular  method/algorithm  used  to  calculate  the  parameter  is 
called an estimator and the result obtained is the estimate. Based on the choice of the measurement 
and estimator, the estimates can have a bias (a systematic deviation from the true result) and a 
variance  (due  to  the  presence  of  noise),  where  a  higher  variance  implies  a  lower  measurement 
precision. The CRLB represents the lowest possible variance (or the highest possible precision) 
that can be achieved in the unbiased estimation of a parameter from a noise- and resolution-limited 
measurement.  In  the  case  of  a  biased  estimation,  the  CRLB  provides  the  lower  bound  on  the 
random  component  of  the  error.  It  is  a  useful  tool  to  study  the  scaling  of  error  with  respect  to 
parameters in an experimental setup [12], [13]. 

Consider a signal/measurement 𝐟, which is composed of a known model signal 𝒎 defined by a 
parameter 𝑎, and a noise component 𝒏 such that f\ 	 = 	 𝑚\ 	 + 	 𝑛\, ∀	𝑘, where 𝑘 represents the 
index of the temporal/spatial location at which the measurement is acquired. Further, let the signal 

be defined by a joint Probability Density Function (PDF) 𝑝(𝐟, 𝑎). Then the CRLB for the estimate 
of 𝑎 is defined as: [13] 

																						𝜎b

c 	 = 	 −

1
𝜕c ln 𝑝(𝐟, 𝑎)
𝜕	𝑎c

𝑬 f

																. 
j

(1) 

If the model is defined by a vector of parameters 𝒂, then the CRLB is defined as the inverse of the 
diagonal element of the Fisher Information Matrix 𝐽12 which is defined as 

𝐽12 	 = 	 −𝑬 l

𝜕c ln 𝑝(𝐟, 𝐚)
𝜕𝑎1𝜕𝑎2

n 

(2) 

with the CRLB for a parameter 𝑎1 being given by 𝜎bo

c = 	 (𝐽11)pq  [13]. 

In the present context, the intensity of the particle/dot recorded on the camera is the measurement, 
contaminated  by  the  thermal  noise  in  the  camera,  and  the  sub-pixel  fitting  procedure  is  the 
estimator, to obtain the particle/dot centroid which is the estimate. We further assume that the only 
random process in the measurement chain is the thermal noise added to the sensor. In experiments, 
the true sub-pixel location of the particle/dot can also be a random variable, but this factor will be 
ignored in the current analysis and the true centroid of the particle/dot is assumed to be a constant 
value. 

The CRLB has been derived for 2D PIV/PTV measurements in the past by Wernet and Pline [14], 
and Westerweel [15]. In both previous analyses, the CRLB was derived for locating the centroid 
of a Gaussian particle image discretely sampled on a CCD sensor in the presence of noise, but the 
two approaches differed in their assumptions about the probability density function (PDF) of the 
noise and thus provide different but complementary results. Wernet and Pline [14] considered the 
case of low illumination intensity where the noise is dominated by the photon count per pixel, 
which follows a Poisson distribution. Under this assumption, the CRLB was found to be linearly 
proportional to the particle diameter and inversely proportional to the photon count. Westerweel 
[15] considered the case of more recent PIV experiments with high-energy pulsed lasers, where 
the noise is primarily governed by the thermal noise in the CCD sensor, as well as the resolution 
and digitization noise, all of which are normally distributed. This assumption resulted in the lower 
bound being proportional to the square of the particle diameter and inversely proportional to the 
pixel pitch and illumination intensity. 

Our  work  extends  the  analysis  of  Elsinga  et.  al.  [5]–[7]  using  the  theoretical  framework  of 
Westerweel [15] to characterize the effect of density/refractive-index gradients on a volumetric 
PTV/BOS  experimental  measurement.  The  analysis  will  be  confined  to  the  CRLB  of  the  2D 
position error, as the propagation of the 2D position error through the measurement chain of a 
volumetric PTV setup accounting for the calibration and reconstruction procedures is the subject 
of  ongoing  research.  It  will  be  seen  that  the  effect  of  density/refractive-index  gradients  is  to 

 
 
increase  the  lower  bound  (or  decrease  the  precision)  of  the  centroid  estimation  process,  thus 
decreasing  the  precision  of  the  overall  measurement. The  increase  in  the  CRLB  is  due  to  non-
linearities in the density gradient field which result in blurring of the particle/dot image.  

In the following sections, we first construct a comprehensive model for the particle/dot pattern 
image by considering the propagation of light rays through a medium with density/refractive-index 
gradients in a volumetric setup at an arbitrary viewing direction. We formulate the image model 
in terms of the experimental parameters: (1) particle depth, (2) viewing direction, (3) aperture f-
number,  and  (4)  image  noise.  We  then  construct  the  Fisher  information  matrix  for  the  case  of 
normally distributed noise due to the camera sensor and derive the CRLB. Finally, we compare 
the  model  predictions  to  ray-tracing  simulations  and  demonstrate  the  uncertainty  amplification 
using experimental BOS images.  

2  Theory 

2.1  Image Model 

The overall imaging process can be represented using a transfer function approach as shown in 
Figure 1.. Each particle/dot acts as a point source of several light rays which travel through the 
density gradient field and the optical train and form an image on the camera sensor. The image 
due to a single light ray can be represented by the convolution of a Dirac delta function centered 
at the location of the geometric image 𝑋⃗% and the point spread function of the optical system 𝜏(𝑋⃗). 
The collective image of the particle/dot formed by all light rays is given by, 

vw

															𝐼r𝑋⃗s = 𝜏r𝑋⃗s ∗ u 𝐼#,%𝛿r𝑋⃗ − 	 𝑋⃗%s

										. 

(3) 

%xq

Figure 1. Illustration of the imaging process using a transfer function model. 

The final location of the light ray 𝑋⃗% depends on the density gradients and the optical layout. For 
simplicity,  we  will  first  consider  a  head-on  viewing  configuration  in  the  presence  of  density 

 
 
                    
 
 
gradients, and subsequently generalize it to a case with an arbitrary viewing direction, and then 
model the effect of the aperture. 

2.1.1  Head-on viewing and effect of particle depth 
For the optical setup shown in Figure 2., the final location of a light ray 𝑋⃗	% originating from a 
particle with initial conditions of 𝑥⃗%, 𝜃⃗
%, can be expressed as  

𝑋⃗% 	 = 	𝑀𝑥⃗% + 𝛥𝑋⃗% 

(4) 

where the first term is due to magnification of the imaging system, and the second term is the 
apparent displacement caused by the density gradients. We further use lower case symbols for co-
ordinates in the object space and upper case symbols for co-ordinates in the image space on the 
camera. 

Figure 2. Schematic showing the imaging of a particle located in a three-dimensional 
measurement volume in the presence of density gradients. 

The magnification 𝑀 is a function of the object distance and the focal length of the camera lens 𝑓, 
as given by, 

𝑀 = z1 −

pq

𝑍{ + 𝜁
𝑓

|

(5) 

and the apparent displacement of the light ray as it traverses a density gradient field is given by 
[2], 

															𝛥𝑋⃗% =

𝑀𝐾
𝑛#

(cid:127)(cid:128)

} 𝛻𝜌	𝑑𝑧	
(cid:127)o

≈ 	

𝑀𝐾
𝑛#

𝜁c(𝛻𝜌)b(cid:130)(cid:131),%														. 

(6) 

 
 
 
 
 
 
where  the  integral  is  replaced  by  a  path  averaged  value  of  the  density  gradient  (𝛻𝜌)b(cid:130)(cid:131),% 
experienced by each light ray. In the subsequent analysis, the subscript 𝑎𝑣𝑔 will be dropped, with 
the understanding that the gradient field is always the path averaged value. 

We have thereby modeled the effect of the particle depth in the measurement volume, 𝜁, on the 
imaging process. While the magnification of the particle decreases with increasing depth, the depth 
appears as a quadratic term in the apparent displacement equation, and therefore, particles located 
deeper in the measurement volume will experience a larger apparent displacement of rays due to 
density gradients. 

Finally,  the  point  spread  function  of  the  optical  system  𝜏(𝑋⃗)  is  the  intensity  field  created  by 
Fraunhofer diffraction due to a circular aperture and is given by the Airy function. Typically, this 
is approximated by a Gaussian profile, 

𝜏r𝑋⃗s = 𝐼# exp (cid:136)−

c

(cid:137)𝑋⃗(cid:137)
2𝜂c (cid:139)	 

(7) 

where  𝐼#  is  the  peak  intensity  and  𝜂  is  related  to  the  diffraction  diameter  and  is  given  by  𝜂	 =
	 √c
q
(cid:140)
(cid:142)
a single particle formed by all the light rays originating from the particle is given by, 

𝑓#(1 + 𝑀)𝜆 , where 𝜆 is the wavelength of light [16]. Therefore, the model for the image of 

vw
			𝐼r𝑋⃗s = u 𝐼#,% exp
%	x	q

⎡
⎢
−
⎢
⎣

(cid:146)𝑋⃗	– (cid:148)𝑀	𝑥⃗% +

𝑀𝐾
𝑛#
2𝜂c

c

𝜁c𝛻𝜌|%(cid:150)(cid:146)

⎤
⎥
.					 
⎥
⎦

(8) 

Here 𝐼#,% is the peak image intensity, and is defined as 𝐼#,% = (cid:154)(cid:155)
exposure due to a single light ray. 

c(cid:142)(cid:156)(cid:157), where 𝛼% is the total image 

2.1.2  Generalization to an arbitrary viewing direction 

The effect of viewing direction on the imaging can be modeled using a rotation matrix to specify 
the camera orientation in three-dimensional space, and by expressing the relationship between the 
object and image space using a linear transformation [17], 

															𝑋⃗ = 𝑅𝑥⃗ + 𝑇U⃗														. 

(9) 

Here 𝑅 = 𝑅(cid:158)𝑅(cid:159)𝑅(cid:160) is the rotation matrix and is a function of the pitch (𝜙), yaw (𝜃), and roll (𝜓) 
angles  of  the  camera,  and  𝑇U⃗  is  the  translation,  which  is  a  function  of  the  object  distance.  The 
viewing configuration is illustrated in Figure 3.. 

 
 
	
 
Figure 3. Illustration of the imaging layout for an arbitrary viewing direction. 

The linear transformation can also be used to relate the density gradients in the two co-ordinate 
systems, and the equation for the apparent displacement can then be expressed in index notation 
as, 

															𝛥𝑋%,2 =

𝑀𝐾
𝑛#

𝜁£𝜁£

1
𝑅2\

𝛻\𝜌														 

(10) 

where 𝑗, 𝑘 and 𝑙 are tensor indices. Thus, we see that the apparent displacement is now a function 
of  the  angle  between  the  viewing  direction  of  the  camera  and  the  orientation  of  the  density 
gradients in object space. Also, the case with the head-on viewing discussed previously becomes 
a special case when one of the camera angles is 90o and the other angles are zero.  

2.1.3  Effective image model and the role of the f-number 

To  simplify  further  analysis,  we  rewrite  Equation  (8)  to  represent  the  intensity  field  due  to  an 
“effective  Gaussian”  with  a  centroid  located  at  (𝑋#, 𝑌#)  and  diameter  (4𝜂#,ƒ, 4𝜂#,§),  under  the 
assumption that the intensity field formed by several Gaussian distributions will also be a Gaussian 
distribution, 

 
 
 
														𝐼¤''r𝑋⃗s 	 = 	 𝐼# exp l− “

(𝑋 − 𝑋#)c
c
2𝜂#,ƒ

+

(𝑌 − 𝑌#)c
c
2𝜂#,§

«n												. 

(11) 

The effective centroid and diameters can be estimated by equating the moments of the Gaussian 
distributions  expressed  in  Equations  (8)  and  (11).  The  main  assumption  that  enables  this 
simplification is that the viewing angle Δ𝜃# subtended by the particle on the lens is small, and 
therefore the density gradient field experienced by any arbitrary light ray can be expressed using 
a Taylor series expansion about the angular bisector of the ray cone, as illustrated in Figure 4. The 
viewing angle is a function of the object distance and the f-number, and for volumetric PTV/BOS 
applications, the f-number is generally high to provide a large depth of field. For volumetric PTV 
experiments,  large  f-numbers  are  required  to  keep  a  thick  laser  sheet  in  focus,  and  in  BOS 
experiments, they are required to keep both the dot target and the density gradient field in focus. 
These requirements result in a very small viewing angle, on the order of 1-2 degrees, which makes 
the small angle assumption reasonable. 

Figure 4. Illustration of the Taylor series approximation for the density gradient field showing 
the ray cone (bounded by the blue rays), the angular bisector (red) and an arbitrary light ray 
(black). The dashed lines are the light ray trajectories in the absence of a density gradient field. 

The effective centroid is described as the first moment of the intensity distribution of the image 
and is given by, 

𝑋⃗# 	 =

›ﬁ
›ﬁ
∫
∫
pﬁ
pﬁ
›ﬁ
›ﬁ
∫
∫
pﬁ
pﬁ

𝑋⃗	𝐼r𝑋⃗s𝑑𝑋	𝑑𝑌
𝐼r𝑋⃗s𝑑𝑋	𝑑𝑌

							. 

 (12) 

The  above  equation  will  be  simplified  for  the  x  component  in  the  following  analysis,  and  the 
procedure for the y component is identical. We have, for 𝑋⃗# = 𝑋#𝚤̂ + 𝑌#𝚥̂, 

 
 
 
 
 
›ﬁ
∫
pﬁ

›ﬁ
∫
pﬁ

𝑋	 ∑

vw
%	x	q

	𝐼#,% exp ‡−

c

(cid:137)𝑋⃗	– 𝑋⃗%(cid:137)
2𝜂c

	·

𝑑𝑋	𝑑𝑌

›ﬁ
∫
pﬁ

›ﬁ
∫ ∑
pﬁ

vw
%	x	q

	𝐼#,% exp ‡−

c
(cid:137)𝑋⃗	– 𝑋⃗%(cid:137)
2𝜂c

	·

𝑑𝑋	𝑑𝑌

∑

vw
%	x	q

𝐼#,% ∫

›ﬁ
pﬁ

›ﬁ
∫
pﬁ

𝑋	 exp ‡−

c

(cid:137)𝑋⃗	– 𝑋⃗%(cid:137)
2𝜂c

	· 𝑑𝑋	𝑑𝑌

∑

vw
%	x	q

𝐼#,% ∫

›ﬁ
pﬁ

›ﬁ
∫
pﬁ

exp ‡−

c
(cid:137)𝑋⃗	– 𝑋⃗%(cid:137)
2𝜂c

	· 𝑑𝑋	𝑑𝑌

∑

vw
%	x	q

∑

vw
%	x	q

∑

vw
%	x	q
vw
∑
%	x	q

𝐼#,% ∫

𝐼#,% ∫

›ﬁ
pﬁ

›ﬁ
pﬁ

𝑋 exp f−

(𝑋	– 𝑋%)c
2𝜂c
(𝑋	– 𝑋%)c
2𝜂c
𝐼#,%r√2π𝑋%𝜂sr√2π𝜂s
𝐼#,%r√2π𝜂sr√2π𝜂s	

exp f−

	j 𝑑𝑋

›ﬁ
∫
pﬁ

exp f−

	j 𝑑𝑋

›ﬁ
∫
pﬁ

exp f−

(𝑌	– 𝑌%)c
2𝜂c
(𝑌	– 𝑌%)c
2𝜂c

	j 𝑑𝑌

	j 𝑑𝑌

(13)  

									𝑋# =

=

=

=

where  we  have  used  the  result  for  Gaussian  integrals,  that  ∫

›ﬁ
pﬁ

exp ¶−

(ƒ	–b)(cid:157)
c•(cid:157) 	‚ 𝑑𝑥

= √2𝜋𝑏  and 

(ƒ	–b)(cid:157)
c•(cid:157) 	‚ 𝑑𝑥

𝑥 exp ¶−

= √2𝜋𝑎𝑏. Further, under the assumption of a small angle of the ray cone, 

›ﬁ
∫
pﬁ
we expect that 𝐼#,% ≈ 𝐼# = 𝑐𝑜𝑛𝑠𝑡𝑎𝑛𝑡 for all light rays emerging from a particle. Note however, 
that 𝐼# can still be different for a particle viewed from different cameras, as well as particles at 
different locations in the laser sheet due to Mie scattering. If the cone angle is very small, then all 
rays  in  the  cone  will  travel  approximately  in  the  same  direction  and  the  variation  of  the  Mie 
scattering coefficients over the solid angle of the ray cone for the same camera can be neglected. 

Further, for a small cone angle, it is also expected that all light rays travel approximately the same 
distance from the particle to the edge of the density gradient field (𝜁% ≈ 𝜁 = 𝑐𝑜𝑛𝑠𝑡𝑎𝑛𝑡). Based on 
these assumptions, we obtain that 

𝑋# =

=

1
𝑁*

1
𝑁*

vw

u 𝑋%
%	x	q
vw

	 u z𝑀	𝑥# +
%	x	q

𝑀𝐾
𝑛#

c 𝜕𝜌
𝜁%
𝜕𝑥

|

(cid:190)
%

= 𝑀𝑥# +

𝑀𝐾𝜁c
𝑛#𝑁*

vw

	 u

%	x	q

𝜕𝜌
𝜕𝑥

(cid:190)

					. 

%

(14) 

 
	
	
	
	
	
	
	
												 
 
 
	
	
The second term in the above equation represents the average deflection of all light rays originating 
from the particle, and it can be simplified further by using a Taylor series expansion of the density 
gradient field about the angular bisector of the ray cone. Consider a straight line connecting the 
particle,  the  center  of  the  lens  and  a  point  on  the  camera  sensor,  which  represents  the  case  of 
pinhole imaging. Let the intersection point of this line with the end-plane of the density gradient 
field be 𝑡⃗# = 𝑥⃗# + 𝜁𝜃⃗
# and the density gradient at this intersection point be defined as ∇𝜌|(cid:192)`. Then 
the density gradient along the x-direction at an arbitrary intersection point 𝑡⃗% can be expressed to 
first order as 

𝜕𝜌
𝜕𝑥

(cid:190)

(cid:192)⃗(cid:155)

= 	

𝜕𝜌
𝜕𝑥

(cid:190)
(cid:192)⃗`

+

𝜕c𝜌
𝜕𝑥c´

(cid:192)⃗`

r𝑡%,ƒ − 𝑡#,ƒs +

𝜕c𝜌
𝜕𝑥𝜕𝑦

´
(cid:192)⃗`

r𝑡%,§ − 𝑡#,§s + 𝑂(|𝑡% − 𝑡#|c)		.	

(15) 

The parameter (𝑡⃗% − 𝑡⃗#) can be expressed in terms of the optical setup as  

𝑡⃗% − 𝑡⃗# 	 = r𝑥⃗# + 𝜁𝜃⃗
% − 𝜃⃗
= 𝜁r𝜃⃗

%s − r𝑥⃗# + 𝜁𝜃⃗
#s	

#s	

(16) 

with 𝜃⃗

% being the angle of propagation of a light ray, and 𝜃⃗

# = q
vw

∑

vw
%xq

𝜃⃗
%

 being the angle between 

the bisector of the cone and the horizontal. 

Using  Equations  (15)  and  (16)  in  Equation  (14)  and  simplifying,  we  obtain  for  the  effective 
centroid along x, 

𝑋# 	 = 𝑀𝑥# +

𝑀𝐾𝜁c
𝑛#𝑁*

vw

	 u ˜

%	x	q

𝜕𝜌
𝜕𝑥

+

(cid:190)
#

𝜕c𝜌
𝜕𝑥c´

#

𝜁r𝜃%,ƒ − 𝜃#,ƒs +

𝜕c𝜌
𝜕𝑥𝜕𝑦

´
#

𝜁r𝜃%,§ − 𝜃#,§s¯

= 𝑀𝑥# +

𝑀𝐾𝜁c
𝑛#

	˜

𝜕𝜌
𝜕𝑥

(cid:190)
#

+

𝜕c𝜌
𝜕𝑥c´

𝜁

1
𝑁*

#

vw

u r𝜃%,ƒ − 𝜃#,ƒs
%	x	q

+

𝜕c𝜌
𝜕𝑥𝜕𝑦

´

𝜁

1
𝑁*

#

vw

u r𝜃%,§ − 𝜃#,§s
%	x	q

¯	

= 𝑀𝑥# +

𝑀𝐾𝜁c
𝑛#

𝜕𝜌
𝜕𝑥

(cid:190)
#

								. 

(17) 

where the summations evaluate to zero due to the definition of 𝜃#,ƒ and 𝜃#,§ as the angles of the 
bisectors.  The  y  component  of  the  centroid  can  be  evaluated  in  a  similar  manner,  and  the  2D 
centroid of the particle/dot image is given by, 

𝑋⃗# 	 = 𝑀𝑥⃗#	+

|𝑀|𝐾𝜁c	
𝑁*𝑛#

	∇𝜌|# 

(18) 

where the first term on the right hand side is the image location for a particle without the density 
gradients and the second term is the average displacement of light rays due to the density gradient 

 
 
 
	
 
field,  with  ∇𝜌|#  representing  the  depth-averaged  density  gradient  experienced  by  the  angular 
bisector of the ray cone. 

The  effective  particle/dot  diameter  can  be  computed  by  equating  the  second  moment  of  the 
Gaussian distributions. Again, just considering the x-component, the standard deviation (a measure 
of the diameter) is given by: 

c =
𝜂#,ƒ

›ﬁ
∫
pﬁ

›ﬁ
∫
pﬁ
›ﬁ
∫
pﬁ

(𝑋 − 𝑋#)c	𝐼r𝑋⃗s𝑑𝑋	𝑑𝑌
›ﬁ
𝐼r𝑋⃗s𝑑𝑋	𝑑𝑌
∫
pﬁ

∑

vw
%	x	q

𝐼#,% ∫

›ﬁ
pﬁ

(𝑋 − 𝑋#)c exp f−

(𝑋	– 𝑋%)c
2𝜂c

	j 𝑑𝑋

›ﬁ
∫
pﬁ

exp f−

(𝑌	– 𝑌%)c
2𝜂c

	j 𝑑𝑌

∑

vw
%	x	q

𝐼#,% ∫

›ﬁ
pﬁ

exp f−

(𝑋	– 𝑋%)c
2𝜂c

	j 𝑑𝑋

›ﬁ
∫
pﬁ

exp f−

(𝑌	– 𝑌%)c
2𝜂c

	j 𝑑𝑌

=

=

∑

vw
%	x	q

𝐼#,%r√2π𝜂(𝜂c + (𝑋% − 𝑋#)c)	sr√2π𝜂s
𝐼#,%r√2π𝜂sr√2π𝜂s	

vw
%	x	q

∑
vw
u (𝑋% − 𝑋#)c
%	x	q

= 𝜂c +

1
𝑁*

(19) 

again using the previously mentioned results for the Gaussian integrals in addition to a new result, 

that ∫

›ﬁ
pﬁ

(𝑥 − 𝑐)c exp ¶−

(ƒ	–b)(cid:157)
c•(cid:157) 	‚ 𝑑𝑥

= √2𝜋𝑏{(𝑎 − 𝑐)c + 𝑏c}. 

The second term in the summation can again be simplified using the Taylor series expansion as 
follows, 

𝑋% − 𝑋# =	𝑀𝑥# +

𝑀𝐾𝜁c
𝑛#
𝜕𝜌
z
𝜕𝑥

(cid:190)

%

𝜕𝜌
𝜕𝑥

(cid:190)
%
𝜕𝜌
𝜕𝑥

−

|	

(cid:190)
#

=	

𝑀𝐾𝜁c
𝑛#

− ¨𝑀𝑥# +

𝑀𝐾𝜁c
𝑛#

𝜕𝜌
𝜕𝑥

(cid:190)

(cid:201)	

#

=	

𝑀𝐾𝜁c
𝑛#

˜

𝜕c𝜌
𝜕𝑥c´

=	

𝑀𝐾𝜁c
𝑛#

˜

𝜕c𝜌
𝜕𝑥c´

#

#

r𝑡%,ƒ − 𝑡#,ƒs +

𝜕c𝜌
𝜕𝑥𝜕𝑦

´
#

r𝑡%,§ − 𝑡#,§s¯	

𝜁r𝜃%,ƒ − 𝜃#,ƒs +

𝜕c𝜌
𝜕𝑥𝜕𝑦

´
#

𝜁r𝜃%,§ − 𝜃#,§s¯				. 

(20) 

The summation then becomes, 

 
	
	
	
	
	
 
 
 
 
1
𝑁*

vw
u (𝑋% − 𝑋#)c
%	x	q

=¨

𝑀𝐾𝜁c
𝑛#

=¨

𝑀𝐾𝜁c
𝑛#

c

(cid:201)

c

(cid:201)

𝜁c 1
𝑁*

vw

u ˜
%	x	q

𝜕c𝜌
𝜕𝑥c´

#

r𝜃%,ƒ − 𝜃#,ƒs+

c

r𝜃%,§ − 𝜃#,§s¯

𝜕c𝜌
𝜕𝑥𝜕𝑦

´
#

𝜁c ˜¨

𝜕c𝜌
𝜕𝑥c´

c
(cid:201)

1
𝑁*

vw

c
u r𝜃%,ƒ − 𝜃#,ƒs
%	x	q

#

+ ¨

𝜕c𝜌
𝜕𝑥𝜕𝑦

c
(cid:201)

1
𝑁*

´

#

vw

c
u r𝜃%,§ − 𝜃#,§s
%	x	q

+ 	

𝜕c𝜌
𝜕𝑥c´

#

𝜕c𝜌
𝜕𝑥𝜕𝑦

2
𝑁*

´
#

vw

u r𝜃%,ƒ − 𝜃#,ƒsr𝜃%,§ − 𝜃#,§s
%	x	q

¯ 

(21) 

The summations of the angles can be simplified further by modeling the angular distribution of 
light rays as a uniform random variable, where the angle of propagation of any given light ray is 
randomly distributed within the total angle of the ray cone Δ𝜃#,ƒ.  That is, 

𝑃¸(cid:204)r𝜃%,ƒs = ˝

1
Δ𝜃#,ƒ
0

𝜃#,ƒ −

Δ𝜃#,ƒ
2

≤ 𝜃%,ƒ ≤ 𝜃#,ƒ +

Δ𝜃#,ƒ
2

otherwise

(22) 

with a similar expression for the random variable Θ§ corresponding the distribution of the angle 
of propagation along y, 𝜃%,§, which would depend on the component of the cone angle along y, 
Δ𝜃#,§.  Except  for  highly  astigmatic  viewing  configurations,  the  components  of  the  cone  angle 
along  the  two  directions  will  be  equal  (Δ𝜃#,ƒ = 	Δ𝜃#,§ = Δ𝜃#).  By  further  assuming  that  the 
random variables along the two components Θƒ and Θ§ are independent, it can be shown that  

a)  q
vw
b)  q
vw
c)  q
vw

∑

vw
%	x	q

∑

∑

vw
%	x	q
vw
%	x	q

(cid:157)

c

r𝜃%,ƒ − 𝜃#,ƒs

= 𝜎¸(cid:204) = (cid:216)(cid:159)`
= 𝜎¸(cid:217) = (cid:216)(cid:159)`
qc
r𝜃%,ƒ − 𝜃#,ƒsr𝜃%,§ − 𝜃#,§s

r𝜃%,§ − 𝜃#,§s

qc
(cid:157)

c

= 0 

and the summation simplifies to, 

1
𝑁*

vw
u (𝑋% − 𝑋#)c
%	x	q

=

c

1
12

¨

𝑀𝐾𝜁c
𝑛#

(cid:201)

𝜁cΔ𝜃#

c(cid:136)¨

𝜕c𝜌
𝜕𝑥c´

c
(cid:201)

+ ¨

𝜕c𝜌
𝜕𝑥𝜕𝑦

c

´

(cid:201)

(cid:139). 

#

(23) 

#

The angle of the ray cone 𝛥𝜃# can be expressed in terms of the parameters of the optical setup as 

		Δ𝜃# =

1
𝑓#

z1 +

pq

1
𝑀

|

−

𝐾𝜁
2𝑛#

¨

𝜕𝜌
𝜕𝑥

(cid:190)

+

#

𝜕𝜌
𝜕𝑦

(cid:190)

(cid:201)	 

#

(24) 

 
	
 
 
 
 
 
 
where the second term accounts for the mean deflection of the ray cone due to density gradients. 
The standard deviation ( = ¼ diameter) along the x direction is then given by, 

c = 𝜂c +
𝜂#,ƒ

1
12

¨

𝑀𝐾𝜁c
𝑛#

c
(cid:201)

𝜁cΔ𝜃#

c(cid:136)¨

𝜕c𝜌
𝜕𝑥c´

c

(cid:201)

#

+ ¨

𝜕c𝜌
𝜕𝑥𝜕𝑦

´
#

c
(cid:201)

(cid:139) 

with a similar analysis to yield the standard deviation along the y direction, 

c = 𝜂c +
𝜂#,§

1
12

¨

𝑀𝐾𝜁c
𝑛#

c

(cid:201)

𝜁cΔ𝜃#

c(cid:136)¨

c

𝜕c𝜌
𝜕𝑥𝜕𝑦

´

(cid:201)

#

+ ¨

𝜕c𝜌
𝜕𝑦c´

#

c
(cid:201)

(cid:139)		 

(25) 

(26) 

Equations (25) and (26) show that non-linearities in the density gradient field increase the effective 
diameter of the dot leading to blurring, consistent with earlier observations by Elsinga et. al. [5] 
for  2D  PIV  from  experimental  data.  Also,  using  the  effective  image  model,  we  have  thereby 
modeled the effect of the f-number, which is the third parameter of interest. It is to be noted that 

in the case of BOS experiments, the term 

(cid:218)(cid:219)(cid:220)(cid:157)
(cid:221)`

= (cid:218)(cid:219)(cid:222)(cid:223)(cid:216)(cid:127)
(cid:221)`

, where 𝑍E is the distance between the 

dot pattern and the density gradient field and Δ𝑧 is the depth of the gradient field.  

Finally, the peak image intensity of the effective model can be expressed in terms of the image 
exposure 𝛼# defined as, 

›ﬁ

›ﬁ
𝛼# = } } 𝐼(𝑋, 𝑌)𝑑𝑋	𝑑𝑌
pﬁ

pﬁ

›ﬁ
= 𝐼# } exp l−
pﬁ

(𝑋	 − 	 𝑋#)c
c
2𝜂#,ƒ

›ﬁ

n } exp l−

pﬁ

(𝑌	 − 	 𝑌#)c
c
2𝜂#,§

n

𝑑𝑋	𝑑𝑌	

(27) 

= 2𝜋𝐼#𝜂#,ƒ𝜂#,§								.	 

Further,  since  the  exposure  for  the  effective  model  should  be  equal  to  that  formed  by  all  the 
individual light rays, 

›ﬁ

›ﬁ
𝛼# = } } 𝐼(𝑋, 𝑌)𝑑𝑋	𝑑𝑌
pﬁ

pﬁ

vw

›ﬁ

›ﬁ
= } } u 𝐼%(𝑋, 𝑌)

	𝑑𝑋	𝑑𝑌

pﬁ

%xq

pﬁ
vw

›ﬁ

›ﬁ
= u } } 𝐼%(𝑋, 𝑌)	𝑑𝑋	𝑑𝑌

pﬁ

pﬁ

%xq
vw

			, 

= u 𝛼%
%xq

(28) 

 
 
 
	
 
 
	
	
	
 
Thus, the peak intensity for the effective image model is given by 

																									𝐼# =

𝛼#
2𝜋𝜂#,ƒ𝜂#,§

			,					

(29) 

thereby completing the formulation of the effective image model. 

The final image of the particle/dot sampled on a discrete set of pixels and with a finite number of 
gray levels is given by, 

																																				𝑔\£ = 𝛾𝑑%

c𝐼(𝑋\, 𝑌£)				.														

(30) 

Here 𝑘, 𝑙 are the pixel indices along the 𝑋, 𝑌 directions respectively, 𝛾 is the pixel to gray level 
conversion factor, and 𝑑%is the pixel pitch. In addition, all CCD/CMOS sensors have some amount 
of noise added to the signal due to thermal noise and finite number of gray levels. This will be 
modeled in the next section when constructing the Fisher Information Matrix. 

2.2  Noise Model and Fisher Information  

The  final  image  of  the  particle/dot  recorded  on  the  sensor  is  the  sum  of  the  sampled  intensity 
profile 𝑔\£ as given by Equation (30) with some additive noise 𝑛9\£: 

																															𝑔9\£ = 𝛾𝑑%

c𝐼(𝑋\, 𝑌£) + 𝑛9\£																	.	

(31) 

Following Westerweel [15], the fluctuations due to thermal noise and finite number of gray levels 
are  assumed  to  be  normally  distributed,  signal-independent  and  uncorrelated,  with  a  standard 
deviation of 𝜎(cid:221). The joint pdf of the measurement then becomes 

													𝑝(𝑔9, 𝒂) = z

(cid:218)v
c

1
c|
2𝜋𝜎(cid:221)

exp ‡−

c u u(𝑔9\£ − 𝑔\£)c

·		

(32) 

1
2𝜎(cid:221)

(cid:218)

v

\x#

£x#

where 𝒂 is the parameter vector and 𝑀, 𝑁 are the number of pixels along 𝑋 and 𝑌, respectively.   

The Fisher information matrix defined earlier represents the total amount of information available 
about the particle/dot from its intensity profile that can be used to estimate its centroid. For the 
present  scenario,  the  Fisher  Information  available  to  estimate  the  𝑋  component  of  the  centroid 
becomes [13], [15]:  

 
 
 
 
 
 
𝐽(cid:224)`(cid:224)` =

(cid:218)

v

1
c u u z
𝜎(cid:221)
£x#
\x#
c
c
𝛾𝐼#𝑑%
c (cid:201)
𝜎(cid:221)𝜂#,ƒ

= ¨

= 	 ¨

= z

c

𝛾𝐼#𝑑%
c (cid:201)
𝜎(cid:221)𝜂#,ƒ
𝛾𝐼#𝑑%
𝜎(cid:221)

c 𝜋
|
2

c

|

𝜕𝑔\£
𝜕𝑋#
(cid:218)
u(𝑋\ − 𝑋#)c exp l−
\x#
›ﬁ

} (𝑋\ − 𝑋#)c exp l−
pﬁ
𝜂#,§
𝜂#,ƒ

	.	

(𝑋\ − 𝑋#)c
c
2𝜂#,ƒ

(𝑋\ − 𝑋#)c
c
2𝜂#,ƒ

v

n

u exp l−

£x#

›ﬁ

(𝑌£ − 𝑌#)c
c
2𝜂#,§

n

n 𝑑𝑋\

	} exp l−

pﬁ

(𝑌£ − 𝑌#)c
c
2𝜂#,§

n 𝑑𝑌£

(33) 

where the summations are converted into integrals under the assumption that the extent of the dot 
is small compared to the size of the whole camera sensor. 

2.3  Cramer-Rao Lower Bound 

The Cramer-Rao lower bound for the variance is defined as the inverse of the diagonal elements 
of the Fisher Information matrix, and therefore the standard deviation for the estimation of the 
centroid is given by 

									𝜎(cid:224)`(cid:224)` = Æ

1
𝐽(cid:224)`(cid:224)`

= Æ

2
𝜋

𝜂#,ƒ
𝜂#,§

𝜎(cid:221)
𝛾𝐼#𝑑%

										.	

(34) 

Further, the peak intensity 𝐼# can be related to the particle/dot diameter using Equation (29) to 
obtain 

														𝜎(cid:224)`(cid:224)` =

2√2𝜋𝜎(cid:221)
𝛾𝛼#𝑑%

{
c 𝜂#,§
𝜂#,ƒ

q
c 		.	

In the absence of blurring, 𝜂#,ƒ = 𝜂#,§ = 𝜂 and the result simplifies to 

									𝜎(cid:224)`(cid:224)` =

2√2𝜋𝜎(cid:221)
𝛾𝛼#𝑑%

𝜂c								

(35) 

(36) 

thereby recovering a result similar to Westerweel [15], that the lower bound increases with the 
square  of  the  particle/dot  diameter.  Further,  since  it  was  shown  previously  that  the  diameter 
increases due to nonlinearities in the density gradient field, the effect of the density gradients is to 
increase the variance in the measurement of the centroid. For a linear density gradient field, there 

 
	
	
	
 
 
 
 
 
 
 
	
 
 
 
 
is a uniform translation of the particle/dot and the CRLB is then identical to the result obtained by 
Westerweel for PIV. 

In  summary,  the  Cramer-Rao  lower  bound  associated  with  the  estimation  of  a  2D  particle/dot 
centroid from the image in the presence of density gradients and thermal noise in a volumetric 
setup, is given by Equation (35), and is a function of: 

1)  Exposure (𝛼#) which is a function of the viewing direction in the case of Mie scattering 
2)  Noise level (𝜎(cid:221))  
3)  Diffraction Diameter (4𝜂) 
4)  Magnification (𝑀) 
5)  Particle Depth (𝜁) 
6)  Non-linearities in the density field and viewing direction (∇c𝜌, 𝑅12) 
7)  Camera Aperture (𝑓#) 

In the case of a 2D planar PIV experiment, the magnification, viewing direction, and particle depth, 
are constants for a given experiment, and we obtain the result that the variance is only a function 
of the aperture setting and the nonlinearities in the density field, consistent with the experimental 
result obtained by Elsinga et. al. [5]  

In the case of a BOS experiment, the depth variable represents the distance between the dot target 
and the density gradient field (𝜁 = 𝑍E), and the blurring is only present for the image with the 
density gradients, and is absent for the reference image. Further, the parameter 𝑀𝑍E is defined as 
the sensitivity of a BOS setup, with a larger value being considered better for resolving small scale 
features  in  the  flow  field  [18].  However,  since  it  also  increases  the  variance  and  lowers  the 
precision of the measurement in the presence of blur, an optimal trade-off between sensitivity and 
precision  should  be  considered  when  designing  an  experiment.  Further,  increasing  𝑓#  tends  to 
reduce the blur and increase the measurement precision, and a large 𝑓# also helps to keep both the 
dot  pattern  and  the  density  gradient  field  in  focus.    Therefore,  small  aperture  settings  must  be 
favored  when  designing  BOS  experiments,  which  generally  requires  the  use  of  high  power 
illumination. 

2.4  Uncertainty Amplification Ratio 

The direct application of Equation (35) to calculate the CRLB for a given experiment is limited by 
the accuracy in the estimation of the image noise level which can vary across the field of view. In 
order  to  isolate  the  uncertainty  amplification  due  to  density  gradients  on  the  CRLB,  an 
amplification ratio metric is proposed for BOS experiments that removes the effect of properties 
that are common to both the reference and gradient images. The amplification ratio, 𝐴𝑅, is defined 
as the ratio of the CRLBs for the same dot in the reference and the gradient images, and it can be 
shown that this ratio is purely a function of the ratios of the peak intensities and ratios of the dot 
diameters, 

																											𝐴𝑅(cid:224) = 	

𝜎(cid:224)`(cid:224)`(cid:226)(cid:155)ª(cid:228)
𝜎(cid:224)`(cid:224)`(cid:155)(cid:229)(cid:128)

= Æ

𝜂#,ƒ(cid:226)(cid:155)ª(cid:228)
𝜂#,ƒ%¤'

𝜂#,§(cid:155)(cid:229)(cid:128)
𝜂#,§(cid:226)(cid:155)ª(cid:228)

𝐼#%¤'
𝐼#(cid:131)%b(cid:230)

																											𝐴𝑅(cid:231) = 	

𝜎(cid:231)`(cid:231)`(cid:226)(cid:155)ª(cid:228)
𝜎(cid:231)`(cid:231)`(cid:155)(cid:229)(cid:128)

= Æ

𝜂#,§(cid:226)(cid:155)ª(cid:228)
𝜂#,§%¤'

𝜂#,ƒ(cid:155)(cid:229)(cid:128)
𝜂#,ƒ(cid:226)(cid:155)ª(cid:228)

𝐼#%¤'
𝐼#(cid:131)%b(cid:230)

						.								 

(37) 

In addition, the proposed amplification ratio metric can also be used to report position uncertainties 
in  tracking-based  processing  for  BOS,  as  these  processing  methods  are  shown  to  significantly 
improve the accuracy, precision and spatial resolution [19]. First, the position uncertainty for the 
reference  image  can  be  calculated  by  recording  several  (e.g.  1000)  images  of  the  dot  pattern 
without any flow and estimating the standard deviation of the dot centroids from the subpixel fits. 
Then,  the  position  uncertainty  for  a  given  dot  in  the  gradient  image  can  be  calculated  by 
multiplying  the  position  uncertainty  for  the  corresponding  dot  in  the  reference  image  and  the 
amplification ratio. The uncertainty in the density field can then be obtained by propagating the 
displacement uncertainties through the BOS measurement chain [20], [21].  

3  Comparison of the model with simulations  

The theoretical result for the CRLB obtained in the previous section was then compared with ray 
tracing  simulations.  We  have  developed  a  ray  tracing-based  synthetic  image  generation 
methodology  for  PIV/BOS  experiments  in  variable  density  environments,  for  the  purpose  of 
simulating  general  optical  setups  as  well  as  for  error  and  uncertainty  analysis  [22].  Using  this 
methodology, synthetic images of particles under diffraction limited imaging and viewed through 
a known density field were generated by randomly varying four parameters (1) non-linearities in 
, Ł(cid:157)Ø
the density field (cid:148)Ł(cid:157)Ø
Ł§(cid:157)(cid:150), (2) particle depth, (3) f-number and (4) viewing direction. The 
parameters  were  drawn  from  a  uniform  distribution  and  the  ranges  of  values  considered  were 
selected based on typical experimental setups, as listed in Table 1. In particular, the range of values 
of the second gradient of density was taken from experimental results of Elsinga et. al [23] for a 
Prandtl-Meyer expansion fan at a 11o corner. A total of 1000 images were generated using this 
parameter range. 

Łƒ(cid:157) , Ł(cid:157)Ø

ŁƒŁ§

Table 1. Range of parameters used to generate particle images in the Monte-Carlo simulations. 

,

Parameter 
𝜕c𝜌
𝜕c𝜌
𝜕c𝜌
𝜕𝑥c ,
𝜕𝑦c 
𝜕𝑥𝜕𝑦
Particle Depth 
F-number 
Viewing direction (x and y) 

Range 

0 to 5000 kg/m^5 

-2 mm to +2 mm 
8, 11, 16 
-10 to 10 deg. 

 
	
														 
 
 
	
For each realization of the Monte-Carlo simulation, the particle image was corrupted with noise 
modeled as a random variable drawn from a zero-mean normal distribution. For the simulations 
reported in this paper, the standard deviation of the normal distribution was set to be 5% of the 
peak intensity of the particle image.  

The particle/dot centroids in the noisy image were located using a Least Squares Gaussian (LSG) 
subpixel fitting scheme, which involves fitting a Gaussian curve to the intensity map of a particle, 
under  the  assumption  that  the  diffraction  limited  image  can  be  approximated  by  a  Gaussian 
distribution [16], [24]. The Gaussian curve is described by five parameters: (1) X location of the 
centroid  (𝑋#),  (2)  Y  location  of  the  centroid  (𝑌#),  (3)  peak  intensity  (𝐼#),  (4)  diameter/standard 
deviation along x, (𝜂#,ƒ) and (5) standard deviation along y (𝜂#,ƒ) where the particle diameter is 
defined as four times of the standard deviation, consistent with PIV literature [24], [25]. In this 
method, the parameters are obtained by minimizing the residual between the predicted intensity 
from the fit and the actual intensity of the pixels using a non-linear least squares method. The least 
squares method is initialized by the three-point Gaussian (TPG) fit, which calculates the centroid, 
peak  intensity  and  standard  deviation  of  a  Gaussian  curve  by  fitting  it  to  the  intensity  values 
recorded at three points/pixels on the dot intensity map [26]. The three points are taken to be the 
pixel with maximum intensity and one pixel on either side of the maximum. The centroid estimates 
are then compared with the ground truth obtained from the final positions of the light rays traced 
in the simulation to compute the position error. For each case of the Monte-Carlo simulation, the 
noise  addition  and  centroid  estimation  procedure  was  performed  1000  times  to  calculate  the 
variance of the position error. 

The LSG fit is the Maximum Likelihood Estimate (MLE) for the centroid estimation in the case 
of normally distributed image noise. Since the MLE approaches the CRLB in the limit of large 
number of observations, it is expected that the variance of the centroid estimates from the LSG 
method would approach the result for the CRLB derived in the previous section [13]. 

It can be shown that the LSG is the MLE for the centroid estimation problem as follows. For a 
probability  density  function  defined  as  𝑝(cid:159)(𝑥)  where  𝑥  is  the  signal,  and  𝜃  is  the  parameter 
governing the pdf, the likelihood function is defined as 

																									𝐿(𝜃|𝑥) = 𝑝(cid:159)(𝑥)					.	

Typically, the likelihood function is replaced by the log likelihood given by 

																									𝑙(𝜃|𝑥) = ln 𝐿(𝜃|𝑥)					.	

(38) 

(39) 

The maximum likelihood estimate for the parameter 𝜃 given a set of measurements 𝑥 obeying a 
known pdf 𝑝(cid:159)(𝑥) is defined as the value that maximizes the likelihood function for the given set 

 
 
 
of measurements. Since the log function is monotonic, maximizing the log likelihood function is 
equivalent to maximizing the likelihood function. 

																𝜃º 	 ∈ 	 argmax

𝑙(𝜃|𝑥)								.	

(cid:159)∈(cid:240)

(40) 

The example we consider here is the Gaussian image of a dot on a camera sensor corrupted with 
zero-mean noise that is normally distributed with standard deviation 𝜎(cid:221). It was shown earlier that 
the joint PDF of the image intensity over a M x N pixel region is given by 

																				𝑝(𝑔9, 𝒂) = z

1
c|
2𝜋𝜎(cid:221)

(cid:218)v
c

exp ‡−

1
2𝜎(cid:221)

(cid:218)

v

\x#

£x#

c u u(𝑔9\£ − 𝑔\£)c

·	.	

(41) 

Therefore,  the  log  likelihood  function  for  the  parameter  𝒂  given  an  intensity  measurement  𝑔9 
becomes 

																									𝑙(𝒂|𝑔9) = −

𝑀𝑁
2

ln 2𝜋𝜎(cid:221)

c −

1
2𝜎(cid:221)

(cid:218)

v

c u u(𝑔9\£ − 𝑔\£)c

\x#

£x#

and the MLE becomes 

																𝒂æ 	 ∈ 	 argmax

𝑙(𝒂|𝑔9)	

(cid:159)∈(cid:240)

																					∈ 	 argmin

(cid:159)∈(cid:240)

v

(cid:218)
u u(𝑔9\£ − 𝑔\£)c
\x#

£x#

(42) 

(43) 

which is a Least Squares solution. Since 𝑔\£ is modelled to be a Gaussian, the MLE is a Least 
Squares Gaussian fit. 

The results obtained from the Monte-Carlo simulations are shown in Figure 5 where the model 
prediction for the standard deviation of the position error (CRLB) are compared to the results from 
the simulations. We show that while there is a reasonable match between the model predictions 
and the simulations, the model under-predicts the variance from the simulation by about 0.005 pix. 
This mismatch could be attributed to two possible reasons. First, the MLE is expected to converge 
to  the  CRLB  in  the  limit  of  an  infinite  number  of  observations,  so  it  is  possible  that  the  finite 
number of observations could result in a slight over-estimation of the MLE. Second, the image 
model derived in the paper is a simplified description of the full non-linear trajectory of light rays 
propagating through the density gradient medium, and hence it is expected to under-predict the 
blurring of the particle images. Therefore, a combination of the over-estimation of the standard 
deviation from the simulation due to the finite number of observations and an under-prediction 
due to the simplifications in the model derivations is most likely the reason for the disagreement 
between the results. However, even with the large number of simplifications, the model is able to 

 
 
 
	
 
	
reasonably  predict  the  trend  of  the  position  estimation  variance,  and  hence  can  provide  useful 
scaling rules in the design of experiments. 

0.05

0.04

0.03

)
.
x
p
(

i

n
o

i
t

l

a
u
m
S

i

,

0

X

0.02

0.01

0.01

0.02

0.03

0.04

0.05

, Theory (pix.)

X

0

Figure 5. Comparison of standard deviation of the position error between model predictions 
(CRLB) given by Equation (35) and results from Monte-Carlo simulations 

4  Demonstration with Experimental Images 

The proposed CRLB estimation methodology and the uncertainty amplification is demonstrated 
on experimental BOS images of flow induced by a nanosecond spark discharge reported by Singh 
et. al. [27], [28]. The spark discharge leads to rapid heating of the gas in the electrode gap resulting 
in a complex three-dimensional flow field. The BOS measurements were performed by recording 
images of a target dot pattern containing a regular grid of dots in the presence of the spark induced 
flow field. The images with the flow can be compared to a reference image recorded prior to the 
discharge to estimate the displacement field and to measure the blurring of the dots in the presence 
of density gradients. More details of the experimental setup can be found in Singh et. al. [27], [28].  

For the experimental images, the Uncertainty Amplification Ratio AR defined in Section 2.4 was 
calculated for all the identified dots in both the reference and gradient images using an elliptical 
c) is shown 
Least Square Gaussian fit, and the magnitude of the amplification ratio (= (cid:242)𝐴𝑅ƒ
in Figure 6.. Also shown are the displacement field which corresponds to the projected density 
gradients as given by Equation (6) and a histogram of the position uncertainty magnitude for the 
gradient image calculated using the uncertainty quantification methodology outlined in Section 
2.4. The dot identification and displacement estimation is performed using a newly developed dot 
tracking methodology for BOS measurements that has been shown to significantly improve the 
accuracy, precision and spatial resolution of the displacement estimation process [11]. The method 

c + 𝐴𝑅§

 
 
 
utilizes  prior  knowledge  of  the  positions  and  sizes  of  the  dots  on  the  target  to  improve  the 
identification and centroid estimation process. 

The  figures  show  that  regions  corresponding  to  the  displacement  gradients  are  coincident  to 
regions with large values of the ratio metric. A value of the ratio metric greater than 1 implies that 
the CRLB for the gradient image will be higher than the reference image in this region. While the 
regions  greater  than  1  mostly  occur  in  regions  with  large  second  gradients  of  the  density  (first 
derivative of displacement), there are still some stray values in regions without density gradients, 
that are most likely due to intensity fluctuations between the reference and gradient images from 
the Xenon arc lamp light source used for the experiments. 

(a) 

(b) 

(c) 

(d) 

(e) 

(f) 

Figure 6. Snapshots of the displacements (a), (d), amplification ratios (b), (e), and histogram 
of position uncertainties for the gradient image (c), (f) for two time instants of the spark 
induced flow field.  

5  Conclusions 

The  effect  of  density/refractive-index  gradients  on  the  precision  of  volumetric  PTV/BOS 
experiments  was  theoretically  analyzed  using  the  Cramer-Rao  lower  bound  of  the  2D  centroid 
estimation process. To perform the analysis, we derived a model for the diffraction limited image 
of a particle/dot viewed through a non-linear density gradient field under the assumption of a small 
ray cone angle which is expected to be reasonable given the requirement of ensuring a thick laser 
sheet in volumetric PTV experiments and for keeping both the target and the flow field in focus 

 
 
 
 
 
 
for  BOS  experiments.  Under  the  further  assumption  that  the  effective  model  of  a  particle/dot 
imaged  through  density  gradients  can  be  described  by  a  Gaussian  profile,  we  showed  that  the 
effective centroid is given by the original centroid of the image in addition to a shift corresponding 
to the average deflection of light rays, and that the effective diameter is a root mean squared sum 
of the diffraction diameter and a blurring due to the second derivatives of the density field. Further, 
we also showed that the relative angle between the viewing direction and the density gradient field 
can also have an effect on the particle image. As a result of the increase in the diameter due to 
blurring, the effect of density gradients is to increase the Cramer-Rao lower bound and to lower 
the measurement precision in the centroid estimation process. For BOS, it was also seen that the 
ratio  of  the  CRLBs  of  the  dots  in  the  reference  and  gradient  images,  termed  the  Uncertainty 
Amplification  Ratio  (𝐴𝑅),  is  a  function  of  the  ratio  of  their  diameters  and  the  peak  intensities. 
Based on this ratio, a methodology was proposed to report position uncertainties for tracking-based 
BOS measurements.  

The  Cramer-Rao  lower  bound  predicted  by  the  imaging  model  was  then  compared  with  the 
position estimation variance obtained from ray tracing simulations for diffraction limited imaging 
of a particle in a thick laser sheet viewed through a density gradient field from different directions. 
The rendered particle images were corrupted with Gaussian noise and the centroid was estimated 
using  a  Least  Square  Gaussian  fit,  and  the  corresponding  position  error  was  calculated.  The 
variance of this position error from 1000 trials was then compared to the CRLB for a particular 
parameter set. This procedure was repeated for 1000 random combinations of the experimental 
parameters. The results show that the model, given the various assumptions and simplifications, is 
able to predict the position estimation variance from the ray tracing simulations, though there is a 
slight under-prediction. The implications of the model of the CRLB were also demonstrated with 
experimental  BOS  images  of  flow  induced  by  a  nanosecond  spark  discharge.  Analysis  of  the 
images showed that the CRLB for the gradient image is amplified with respect to the reference 
image particularly in regions of strong density gradients. 

The CRLB for the 2D centroid estimation process derived in this work can also be propagated 
through the measurement chain of a volumetric PTV setup accounting for uncertainties introduced 
in  the  calibration  and  reconstruction  procedures  to  elucidate  the  effect  of  distortions  due  to 
density/refractive-index gradients on the 3D centroid estimation process [29]. Further, the possible 
utility of the uncertainty amplification factor for uncertainty quantification for correlation-based 
PIV/BOS similar to the peak-to-peak ratio and signal to noise ratio metrics [30]–[32] is an avenue 
for further work.  

6  Acknowledgement 

This material is based upon work supported by the U.S. Department of Energy, Office of Science, 
Office  of  Fusion  Energy  Sciences  under  Award  Number  DE-SC0018156.  Bhavini  Singh  is 
acknowledged for help with the spark discharge experiment. Jiacheng Zhang, Javad Eshragi and 
Adib Ahmadzadegan are acknowledged for reviewing the manuscript. 

7  References 

[1]  M. Raffel, C. E. Willert, S. T. Wereley, and J. Kompenhans, Particle image velocimetry: a 

practical guide. Springer, 2013. 

[2]  M. Raffel, “Background-oriented schlieren (BOS) techniques,” Exp. Fluids, vol. 56, no. 3, 

pp. 1–17, 2015. 

[3]  R. J. Adrian, “Twenty years of particle image velocimetry,” Exp. Fluids, vol. 39, no. 2, pp. 

159–169, Jul. 2005. 

[4] 

J. Westerweel, G. E. Elsinga, and R. J. Adrian, “Particle Image Velocimetry for Complex 
and Turbulent Flows,” Annu. Rev. Fluid Mech., vol. 45, no. 1, pp. 409–436, Jan. 2013. 

[5]  G.  E.  Elsinga,  B.  W.  Van  Oudheusden,  and  F.  Scarano,  “Evaluation  of  aero-optical 

distortion effects in PIV,” Exp. Fluids, vol. 39, no. 2, pp. 246–256, 2005. 

[6]  G. E. Elsinga, B. W. van Oudheusden, and F. Scarano, “The effect of particle image blur on 
the correlation map and velocity measurement in PIV,” in Proceedings of SPIE, 2005, vol. 
5880, p. 588010. 

[7]  G.  E.  Elsinga,  B.  W.  van  Oudheusden,  and  F.  Scarano,  “Modeling  of  particle  imaging 
through  shock  waves,”  Opt.  Model.  Perform.  Predict.  II,  vol.  5867,  no.  May  2010,  pp. 
58670M-58670M–11, Aug. 2005. 

[8] 

S. Discetti and F. Coletti, “Volumetric velocimetry for fluid flows,” Meas. Sci. Technol., 
vol. in press, 2018. 

[9]  B.  Wieneke,  “Iterative  reconstruction  of  volumetric  particle  distribution,”  Meas.  Sci. 

Technol., vol. 24, no. 2, p. 024008, 2013. 

[10]  D. Schanz, S. Gesemann, and A. Schröder, “Shake-The-Box: Lagrangian particle tracking 

at high particle image densities,” Exp. Fluids, vol. 57, no. 5, p. 70, May 2016. 

[11]  L.  K.  Rajendran,  S.  P.  M.  Bane,  and  P.  P.  Vlachos,  “Dot  tracking  methodology  for 

background-oriented schlieren (BOS),” Exp. Fluids, vol. 60, no. 11, p. 162, Nov. 2019. 

[12]  A. van den Bos, Parameter estimation for scientists and engineers. Wiley and Sons, 2007. 

[13]  H. Nobach and C. Tropea, “Fundamentals of Data Processing,” in Springer Handbook of 
Experimental Fluid Mechanics, Berlin, Heidelberg: Springer Berlin Heidelberg, 2007, pp. 
1399–1417. 

[14]  M.  P.  Wernet  and  A.  Pline,  “Particle  displacement  tracking  technique  and  Cramer-Rao 
lower bound error in centroid estimates from CCD imagery,” Exp. Fluids, vol. 15, no. 4–5, 
pp. 295–307, 1993. 

[15]  J.  Westerweel,  “Theoretical  analysis  of  the  measurement  precision  in  particle  image 

velocimetry,” Exp. Fluids, vol. 29, no. 7, pp. S003-S012, 2000. 

[16]  R. J. Adrian and C. S. Yao, “Pulsed laser technique application to liquid and gaseous flows 

and the scattering power of seed materials.,” Appl. Opt., vol. 24, no. 1, pp. 44–52, 1985. 

[17]  R. Y. Tsai, “A Versatile Camera Calibration Technique for High-Accuracy 3D Machine 
Vision Metrology Using Off-the-Shelf TV Cameras and Lenses,” IEEE J. Robot. Autom., 
vol. 3, no. 4, pp. 323–344, 1987. 

[18]  E.  Goldhahn  and  J.  Seume,  “The  background  oriented  schlieren  technique:  Sensitivity, 
accuracy, resolution and application to a three-dimensional density field,” Exp. Fluids, vol. 
43, no. 2–3, pp. 241–249, 2007. 

[19]  L.  K.  Rajendran,  S.  P.  M.  Bane,  and  P.  P.  Vlachos,  “Dot-Tracking  Methodology  for 

Background Oriented Schlieren (BOS),” arXiv:1812.10870, Dec. 2018. 

[20]  L. K. Rajendran, S. Bhattacharya, J. Zhang, S. P. M. Bane, and P. P. Vlachos, “Assessment 
of Uncertainty Quantification methods for density estimation from Background Oriented 
Schlieren  (  BOS  )  measurements,”  in  13th  International  Symposium  on  Particle  Image 
Velocimetry, 2019, pp. 377–395. 

[21]  L. K. Rajendran, J. Zhang, S. Bhattacharya, S. P. . M. Bane, and P. P. Vlachos, “Uncertainty 
Quantification  in  density  estimation  from  Background  Oriented  Schlieren  (BOS) 
measurements,” arxiv:1909.06643, 2019. 

[22]  L. K. Rajendran, S. P. M. Bane, and P. P. Vlachos, “PIV/BOS synthetic image generation 
in  variable  density  environments  for  error  analysis  and  experiment  design,”  Meas.  Sci. 
Technol., pp. 11–14, Apr. 2019. 

[23]  G.  E.  Elsinga,  B.  W.  Van  Oudheusden,  F.  Scarano,  and  D.  W.  Watt,  “Assessment  and 
application of quantitative schlieren methods: Calibrated color schlieren and background 
oriented schlieren,” Exp. Fluids, vol. 36, no. 2, pp. 309–325, 2004. 

[24]  M. R. Brady, S. G. Raben, and P. P. Vlachos, “Methods for Digital Particle Image Sizing 
(DPIS): Comparisons and improvements,” Flow Meas. Instrum., vol. 20, no. 6, pp. 207–
219, 2009. 

[25]  M. Willert, C.E. and Gharib, “Digital Particle Image Velocimetry”, Experiments in Fluids,” 

Exp. Fluids, vol. 3, pp. 181–193, 1991. 

[26]  C. Willert and M. Gharib, “Digital particle image velocimetry,” Exp. Fluids, vol. 193, pp. 

181–193, 1991. 

[27]  B.  Singh,  L.  K.  Rajendran,  P.  Gupta,  C.  Scalo,  P.  P.  Vlachos,  and  S.  P.  M.  Bane, 
“Experimental and Numerical Study of Flow Induced by Nanosecond Repetitively Pulsed 
Discharges,” AIAA Scitech 2019 Forum, no. January, pp. 1–15, 2019. 

[28]  B. Singh, L. K. Rajendran, S. P. M. Bane, and P. P. Vlachos, “Characterization of Fluid 
Motion  Induced  by  Nanosecond  Spark  Plasmas:  Using  Particle  Image  Velocimetry  and 
Background  Oriented  Schlieren,”  in  2018  AIAA  Aerospace  Sciences  Meeting,  2018,  no. 
210059. 

[29]  S.  Bhattacharya  and  P.  P.  Vlachos,  “Uncertainty  Quantification  in  Volumetric  PTV,”  in 

13th International Symposium on Particle Image Velocimetry, 2019. 

[30]  J. J. Charonko and P. P. Vlachos, “Estimation of uncertainty bounds for individual particle 
image velocimetry measurements from cross-correlation peak ratio,” Meas. Sci. Technol., 
vol. 24, no. 6, p. 065301, Jun. 2013. 

[31]  Z. Xue, J. J. Charonko, and P. P. Vlachos, “Particle image velocimetry correlation signal-
to-noise  ratio  metrics  and  measurement  uncertainty  quantification,”  Meas.  Sci.  Technol., 
vol. 25, no. 11, 2014. 

[32]  Z. Xue, J. J. Charonko, and P. P. Vlachos, “Particle image pattern mutual information and 
uncertainty estimation for particle image velocimetry,” Meas. Sci. Technol., vol. 26, no. 7, 
2015. 

 
