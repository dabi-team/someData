Astronomy & Astrophysics manuscript no. aa_2020_38921_r1_submit
October 13, 2020

©ESO 2020

Deducing the reliability of relative helicities from nonlinear
force-free coronal models

Julia K. Thalmann1, X. Sun2, K. Moraitis3, 4, and M. Gupta1

1 University of Graz, Institute of Physics/IGAM, Universitätsplatz 5, 8010 Graz, Austria e-mail: julia.thalmann@uni-graz.at
2 Institute for Astronomy, University of Hawaii at Manoa, Pukalani, HI 96768-8288, USA
3 LESIA, Observatoire de Paris, Université PSL, CNRS, Sorbonne Université, Université de Paris, 5 place Jules Janssen, 92195

Meudon, France

4 University of Ioannina, Department of Physics, Section of Astrogeophysics, Ioannina, Greece

Received July 15, 2020 / Accepted October 12, 2020

ABSTRACT

Aims: We study the relative helicity of active region (AR) NOAA 12673 during a ten-hour time interval centered around a preceding
X2.2 ﬂare (SOL2017-09-06T08:57) and also including an eruptive X9.3 ﬂare that occurred three hours later (SOL2017-09-06T11:53).
In particular, we aim for a reliable estimate of the normalized self-helicity of the current-carrying magnetic ﬁeld, the so-called helicity
ratio, |HJ|/|HV|, a promising candidate to quantity the eruptive potential of solar ARs.
Methods: Using Solar Dynamics Observatory Helioseismic and Magnetic Imager vector magnetic ﬁeld data as an input, we employ
nonlinear force-free (NLFF) coronal magnetic ﬁeld models using an optimization approach. The corresponding relative helicity, and
related quantities, are computed using a ﬁnite-volume method. From multiple time series of NLFF models based on diﬀerent choices
of free model parameters, we are able to assess the spread of |HJ|/|HV|, and to estimate its uncertainty.
Results: In comparison to earlier works, which identiﬁed the non-solenoidal contribution to the total magnetic energy, Ediv/E, as
selection criterion regarding the required solenoidal quality of magnetic ﬁeld models for subsequent relative helicity analysis, we
propose to use in addition the non-solenoidal contribution to the free magnetic energy, |Emix|/EJ,s. As a recipe for a reliable estimate
of the relative magnetic helicity (and related quantities), we recommend to employ multiple NLFF models based on diﬀerent com-
binations of free model parameters, to retain only those that exhibit smallest values of both Ediv/E and |Emix|/EJ,s at a certain time
instant, to subsequently compute mean estimates, and to use the spread of the individually contributing values as an indication for the
uncertainty.

Key words. Sun: corona – Sun: ﬂares – Sun: magnetic ﬁelds – Methods: data analysis – Methods: numerical

1. Introduction

Based on the Gauss linking number, magnetic helicity is a mea-
sure of the level of entanglement of magnetic ﬁeld lines within a
magnetized plasma (Moﬀatt 1969). It is strictly conserved within
the ideal magneto-hydrodynamic paradigm (Woltjer 1958), and
its dissipation is relatively weak even in non-ideal magneto-
hydrodynamics (Taylor 1974), the latter even in the presence of
strong non-ideal eﬀects (Pariat et al. 2015). In the context of so-
lar eruptivity, this favorable property can explain the existence
of plasma ejecta in order to prevent inﬁnite accumulation within
the solar atmosphere (Rust 1994; Low 1996).

The basic formulation of magnetic helicity lacks gauge trans-
form invariance for magnetically open systems, i.e., it is not di-
rectly applicable to studies of the solar corona since magnetic
ﬂux is continuously penetrating the coronal volume through
the solar surface. To circumvent this limitation, Berger & Field
(1984) and Finn & Antonsen (1984) deﬁned the so-called rela-
tive magnetic helicity as

HV =

(cid:90)

V

(A + A0) · (B − B0) dV,

(1)

a gauge-invariant quantity related to the magnetic helicity within
a volume, V, bounded by a surface, ∂V. Here B and B0 are the
3D magnetic ﬁeld under study and a reference ﬁeld, respectively,

while A and A0 are the vector potentials satisfying B = ∇ × A
and B0 = ∇ × A0, respectively.

As its name implies, the relative helicity expresses the he-
licity of a magnetic ﬁeld with respect to a reference ﬁeld, B0,
which shares the normal component of the studied ﬁeld B on
∂V. Generally, B0 is chosen to be a potential (current-free) ﬁeld
(see Prior & Yeates 2014, for an alternative choice). For practical
cases, Valori et al. (2012) demonstrated the validity and physical
meaningfulness to compute (and track in time) HV by evaluat-
ing Eq. (1) in order to characterize (the evolution of) a magnetic
system.

Berger (1999) decomposed HV into two separately gauge-

invariant quantities

(cid:90)

HJ =

HPJ = 2

(A − A0) · (B − B0) dV,

V
(cid:90)

A0 · (B − B0) dV,

V

(2)

(3)

so that HV = HJ + HPJ. Here HJ is the magnetic helicity in the
volume associated with the electric current, and HPJ is the helic-
ity associated with the component of the ﬁeld that is threading
∂V. Since B0 is designed to share the normal component with
B on ∂V, consequently HV, HJ, and HPJ are all independently
gauge invariant. For a pilot study of the time evolution of these

Article number, page 1 of 10

0
2
0
2

t
c
O
2
1

]

R
S
.
h
p
-
o
r
t
s
a
[

2
v
7
8
2
5
0
.
9
0
0
2
:
v
i
X
r
a

 
 
 
 
 
 
A&A proofs: manuscript no. aa_2020_38921_r1_submit

quantities in the solar context see Moraitis et al. (2014). For com-
pleteness we note that, unlike HV in Eq. (1), HJ and HPJ are not
conserved quantities as a gauge-invariant transfer term between
them dominates their dynamics (Linan et al. 2018).

In particluar, HJ in Eq. (2) attracts attention as it provides
additional information compared to HV. More precisely, the so-
called helicity ratio, |HJ|/|HV|, appeared as a promising can-
didate in characterizing the eruptive potential of the underly-
ing magnetic structure. This was noted not only from numeri-
cal simulations (e.g., Pariat et al. 2017; Zuccarello et al. 2018;
Linan et al. 2018), but also from application to solar observa-
tions (James et al. 2018; Moraitis et al. 2019; Thalmann et al.
2019b).

Magnetic helicity studies of solar observations are often per-
formed based on nonlinear force-free (NLFF) coronal magnetic
ﬁeld extrapolations, i.e., the numerical solution of

(∇ × B) × B = 0,
∇ · B = 0,

(4)
(5)

where B represents the 3D coronal magnetic ﬁeld, subject to
the measured surface magnetic ﬁeld as a boundary condition
(for a review see, e.g., Wiegelmann & Sakurai 2012). For in-
stance, James et al. (2018) used a magneto-frictional method
to solve Eqs. (4) and (5) , while the works of Moraitis et al.
(2019) and Thalmann et al. (2019b) were based on an optimiza-
tion approach. Whatever method used, unavoidable numerical
errors prevent the exact fulﬁllment of Eqs. (4) and (5). In partic-
ular, the level of solenoidality of the obtained NLFF solution is
highly important for relative helicity computations (Valori et al.
2013; and see Sect. 2.3 for details).

Recently, Moraitis et al. (2019) (hereafter M19) studied the
eruptivity of NOAA 12673 which produced the two strongest
ﬂares of Solar Cycle 24 on 6 September 2017. A conﬁned X2.2
ﬂare started at 08:57 UT (SOL2017-09-06T08:57), and an erup-
tive X9.3 ﬂare followed three hours later (start time 11:53 UT;
SOL2017-09-06T11:53). In their study a ten-hour time inter-
val centered around the X2.2 ﬂare of 6 September that also in-
cludes the X9.3 ﬂare was used. Their analysis used a mix of
NLFF solutions, based on the optimization method of Wiegel-
mann et al. (2012), a specialization of the method originally de-
scribed in Wiegelmann & Inhester (2010) for the application to
Solar Dynamics Observatory Helioseismic and Magnetic Imager
data (hereafter W12), and on its original predecessor (Wiegel-
mann 2004, hereafter W04), using standard (free) model param-
eter settings. They argued that employing NLFF models based
on diﬀerent code versions optimizes the ﬁnal NLFF time se-
ries used to compute the coronal relative helicity, when retaining
only those that perform best in terms of solenoidality. Thus, at
each time instant within the studied time series, they checked the
solenoidal quality of the W04 and W12 solutions, and used the
particular NLFF solution of highest solenoidal quality, i.e., that
with the smallest value of ∇ · B. Time instances where none of
the employed models were providing an acceptably small level
of solenoidality were discarded entirely. The time evolution of
|HJ|/|HV| that resulted based on this pre-selection of NLFF mod-
els depicts an increase in |HJ|/|HV| to values > 0.15 prior to the
X-class ﬂares, as well as corresponding decreases in the course
of the ﬂares (see their Fig. 7).

DeRosa et al. (2015) delivered, although as a secondary re-
sult, the ﬁrst comparative analysis of relative helicity compu-
tations based on diﬀerent NLFF methods, picturing consistent
relative helicity estimates as a challenging yet achievable task.
In that work the W12-based NLFF solutions were found to de-

Article number, page 2 of 10

liver distinctly diﬀerent values for the relative helicity in com-
parison to those deduced from other NLFF methods (a magneto-
frictional and three Grad-Rubin methods), which was explained
by the insuﬃcient solenoidal quality of the NLFF model. This is-
sue was found to be linked to the use of standard choices of (free)
model parameters, as suggested in W12, which resulted in NLFF
solutions with non-solenoidal errors on the order of the inherent
free magnetic energy (see their Fig. 7b). It was also shown, how-
ever, that an alternative W12-based NLFF solution based on an
adjusted set of model parameters resulted in a signiﬁcant im-
provement of the solenoidal quality, and hence the correspond-
ing relative helicity computation (see Appendix of their work).

The above works suggests that there is great potential for
improving the accuracy of relative helicity estimates, based on
diﬀerent model parameter choices and/or particular versions of
the optimization approach. Since it has been shown that the W12
method delivers NLFF solutions with a higher degree of force-
freeness and lower solenoidal level in comparison to the W04
method (see Table 2 in Wiegelmann et al. 2012), we restrict our-
selves to making use of the W12 method and employ a number
of NLFF solutions based on diﬀerent choices for the adjustable
(free) model parameters. In order to make our results comparable
to the previous study of M19, we use the same vector magnetic
ﬁeld data as input to NLFF modeling. We attempt to assess the
resulting spread of the relative helicity and related quantities,
most importantly that of |HJ|/|HV|, for this particular AR and
time interval in relation to the particular NLFF model parame-
ters used. On that basis, we aim to provide a recipe for a realistic
computation of the relative helicity, including an appropriate es-
timation of related uncertainties.

2. Data and methods

2.1. Vector magnetic ﬁeld data

In our study we use the data set originally designed to study
the eruptivity of NOAA AR 12673 in M19, originally based on
the 12-min cadence hmi.sharp_720s data product, constructed
from polarization measurements of the Solar Dynamics Obser-
vatory Helioseismic and Magnetic Imager (SDO/HMI; Scherrer
et al. 2012). A ﬁeld of view covering 320 × 320 pixels was
extracted from the full-disk hmi.sharp_720s data, centered at
the Carrington coordinates (118.4◦,−9.2◦). A cylindrical equal
area (CEA) projection was applied to the chosen subﬁeld of
the hmi.sharp_720s data vector ﬁeld data, following the descrip-
tion in Sun (2013). The resulting CEA-remapped ﬁeld vector
(Br,Bθ,Bφ) was binned by a factor of two to a resolution of
0.06 degree (∼720 km at disk center). In this way a total of 17
CEA vector magnetic ﬁeld maps were constructed, covering the
time span 2017-Sep-06 04:00 UT – 13:00 UT, around two major
ﬂares hosted by NOAA 12673 (a conﬁned X2.2 ﬂare that peaked
at 09:10 UT, and an eruptive X9.3 ﬂare that peaked at 12:02 UT).

2.2. NLFF modeling

Based on the vector magnetic ﬁeld data described in Sect. 2.1,
we compute a series of NLFF equilibria for each of the 17 time
instances. NLFF modeling involves one computational task at
least (optimization; see Sect. 2.2.2), and two computational tasks
at most (a preprocessing step, see Sect. 2.2.1, followed by sub-
sequent optimization). Preprocessing is necessary, because the
vector magnetic ﬁeld data deduced from polarization measure-
ments at photospheric levels does not conform with the force-
free criteria (Aly 1989).

Julia K. Thalmann et al.: Reliability of relative helicities

2.2.1. Preprocessing

During preprocessing, the measured 2D vector magnetic ﬁeld
data is modiﬁed in order to obtain a vector ﬁeld that is (more)
force-free consistent. The preprocessing method of Wiegelmann
et al. (2006) minimizes a function of the form

Lpp = µ1Lpp,1 + µ2Lpp,2 + µ3Lpp,3 + µ4Lpp,4,

(6)

L =

of Wiegelmann & Inhester (2010) and a multiscale approach
(Wiegelmann 2008). In our work we apply a three-level mul-
tiscale approach to the (non-)preprocessed vector magnetic ﬁeld
data. The optimization approach is designed such that the func-
tion

(cid:90)

(cid:32)

+ ν

V
(cid:90)

S

w f

| (∇ × B) × B|2
B2

+ wd |∇ · B|2

(cid:33)

dv

(B − Bin) · W · (B − Bin) ds,

(7)

is minimized yielding the volume-integrated Lorentz force and
divergence to become small.

The surface term in Eq. (7) allows deviations between the
NLFF solution, B, and the magnetic ﬁeld information at the
lower boundary, Bin, in order to ﬁnd a more force-free solution.
The deviation from Bin is controlled by the diagonal error ma-
trix (i.e., the non-diagonal elements are zero), W , which allows
it to account for the uncertainties on each component of the mag-
netic ﬁeld, and in each pixel, separately. Here Bin may be either
a directly measured and force-free consistent or a preprocessed
vector magnetic ﬁeld. The following model parameters can be
freely assigned in Eq. (7):

– Separate weightings of the volume-integrated force (w f ) and
divergence (wd). In the original notation of W12 they are set
as w f = wd = 1.

– The injection speed of the lower boundary, i.e., the relative
importance of the surface term in Eq. (7), is controlled by ν.
W12 tested ν in the range 10−4–10−1 and found ν = 10−3 to
represent a most qualiﬁed choice for the application to HMI
data. This is because higher values yield a lower force-free
and solenoidal quality of the resulting NLFF solution, while
lower values yield little corresponding improvement, despite
drastically increased computation times. Therefore, we use a
value of ν = 10−3 in our study, as has also been used as in
the work of M19.

– The components w(cid:107) (controlling the weighting of the hori-
zontal ﬁeld components Bx and By) and w⊥ (controlling the
weighting of the vertical ﬁeld component Bz) of the diag-
onal error matrix, W , can be deﬁned in diﬀerent ways; in
the most sophisticated of which each individual pixel may
be weighted based on the actual HMI measurement uncer-
tainties. Only recently such an attempt has been presented in
M19, who chose

w(cid:107) = w⊥ =

(cid:40)

0.01 + 0.99 exp
0.01,

(cid:16)

− σB
0.03B

(cid:17)

,

if B ≥ 200 G
if B < 200 G

,

(8)

where B denotes the magnetic ﬁeld strength and σB is the
total magnetic ﬁeld variance from inversion ﬁtting. The au-
thors thus assumed a typical noise threshold of 200 G and
a typical value of 0.03 for σB/B. This particular weighting
was designed in order to compensate for low-quality inver-
sion results, covering regions of strong magnetic ﬁeld and
spreading out in the later frames of the time series. Hereafter
we refer to this choice of parameters w(cid:107) and w⊥ as WHMI.
When measurement uncertainties are not known, a reason-
able choice is to set

(cid:40)

w =

w(cid:107)
w⊥

(cid:41)

(cid:40)

=

|Bh|/|Bh,max|
1.0

(cid:41)

(9)

where the individual contributions Lpp,i are summed over all grid
points of the 2D photospheric grid, and are weighted individually
by the corresponding pre-factors µi. In discretized form, Lpp,1
is the square of the total magnetic force, and Lpp,2 the square
of the total magnetic torque; Lpp,3 measures the diﬀerence be-
tween the preprocessed and original input ﬁeld, and Lpp,4 reduces
small-scale variations in the measured ﬁeld (applying a Lapla-
cian smoothing).

In the solar context, preprocessing aims to approximate the
chromospheric magnetic ﬁeld, assumed to be more force-free
consistent than the photospheric magnetic ﬁeld. In Wiegelmann
et al. (2008) a realistic model active-region is used to test
the eﬀect of preprocessing. In addition to the original scope
of that study, the preprocessing has been shown to remove
non-magnetic forces in the model photosphere and to yield a
chromospheric-like model ﬁeld (see their Table 1 and Fig. 2).
In particular, the smoothing term, Lpp,4, in Eq. (6) is physically
motivated by the desire to approximate the characteristic spatial
scales at a chromospheric level, i.e., to remove all scales below
super-granular diameter (Wiegelmann et al. 2006). The smooth-
ing term naturally competes with the changes to the data due to
the terms assigned to enforce force-free compatibility (Lpp,1 and
Lpp,2). Since Lpp,1 and Lpp,2 are weighted distinctly stronger (usu-
ally, µ1 = µ2 = 1 and µ4 (cid:28) µ1), Lpp,4 may have only a limited
eﬀect. As a consequence, small spatial scales might actually be
enhanced (see corresponding remarks in Sect. 8.1 of Valori et al.
2013).

The application of preprocessing prior to optimization has
the desired eﬀect of delivering NLFF solutions of higher qual-
ity, independent of the particular NLFF method used, but ap-
peared advantageous especially for NLFF methods that rely on
numerical diﬀerentiation (see Sect. 7.3 of Metcalf et al. 2008). It
improves the ﬁnal NLFF solution, both in terms of force- and
divergence-freeness, naturally because of the more force-free
consistent nature of the preprocessed data (see Table 2 in W12
and also Table 2 in Wiegelmann et al. 2008).

The recommended (standard) relative weightings suggested
in W12 are (µ1, µ2, µ3, µ4) = (1, 1, 10−3, 10−2), with the weight-
ings µ1 and µ2 set several orders of magnitude larger than µ3 and
µ4. This is because meeting the (nearly) vanishing total mag-
netic force and torque is essential, while the nearness to the
actually observed data and its smoothness are desired (but sec-
ondary) requirements. In our work, we use the suggested setting
µ1 = µ2 = 1, and inspect separately the eﬀect of enforcing near-
ness to the observed data (µ3 = 10−3 versus µ3 = 0) and that
of smoothing (µ4 = 10−2 versus µ4 = 0). Though the advanta-
geous eﬀect of smoothing onto the quality of the resulting NLFF
solution is known, its impact on relative helicity computation is
still unclear. Using the just presented extreme choices of corre-
sponding relative weightings, we are able to clarify the relative
inﬂuences of the actually observed data and smoothing.

2.2.2. Optimization

In order to perform the NLFF optimization, we apply the method
of W12, i.e., we combine the improved optimization scheme

for each pixel separately. This choice was put forward by
W12, based on a comparison of diﬀerent deﬁnitions of W .

Article number, page 3 of 10

A&A proofs: manuscript no. aa_2020_38921_r1_submit

With this particular choice the vertical ﬁeld is empirically
measured at the highest accuracy level, and that the accuracy
of the measured horizontal ﬁeld increases with its strength.
Hereafter we refer to this choice of parameters w(cid:107) and w⊥
as WEMP. To date, with the sole exception of M19, this set-
ting has often been applied when performing coronal NLFF
modeling with the W12 method. This motivates us to test the
performance of this type of error matrix, by comparison to
the corresponding application of WHMI.

Successful NLFF modeling involves ﬁnding a combination
of the free model parameters for the optimization function L and,
if applied, for the preprocessing step (µ3, µ4) that delivers opti-
mized results, in terms of force- and divergence-freeness. In or-
der to quantify the force-free consistency of the obtained NLFF
solutions for a certain choice of the free model parameters, a fre-
quently used metric is the current-weighted angle between the
modeled magnetic ﬁeld and electric current density, θJ, (Schri-
jver et al. 2006). Ideally, for an entirely force-free solution we
would ﬁnd θJ = 0◦.

As noted by Wiegelmann et al. (2012), for the application to
long-term HMI data series it is not practical to carry out NLFF
modeling based on several diﬀerent model parameter sets. For
a short time span, as in our analysis, it is doable, and may be
used to study the uncertainty of physical quantities based on the
diﬀerent model parameter choices.

2.3. Helicity computation

We use the ﬁnite-volume (FV) method of Thalmann et al. (2011)
to compute the relative helicity based on Eqs. (1)–(3). It solves
systems of partial diﬀerential equations to obtain the vector po-
tentials A and A0, using the Coulomb gauge, ∇·A = ∇·A0 = 0.
The method deﬁnes the reference ﬁeld as B0 = ∇φ, with φ be-
ing the scalar potential, subject to the constraint ∇nφ = Bn on
∂V, where n denotes the normal component with respect to the
boundaries of V.

The method has been tested in the framework of an ex-
tended proof-of-concept study on FV helicity computation meth-
ods (Valori et al. 2016), where it has been shown that for vari-
ous test setups the methods deliver helicity values in line with
each other, diﬀering by only small percentage points. It has also
been used in Thalmann et al. (2019a) to show that the computed
helicity is highly dependent on the level to which the underly-
ing NLFF magnetic ﬁeld solution satisﬁes the divergence-free
condition. A metric for quantifying the divergence-free consis-
tency of an obtained NLFF solution, as introduced by (Wheat-
land et al. 2000) and often used in literature is the fractional
ﬂux, (cid:104)| fi|(cid:105) (for an recent in-depth analysis of this measure see
Gilchrist et al. 2020). Though not shown explicitly in our work,
we note for completeness that in all studied NLFF models, we
ﬁnd (cid:104)| fi|(cid:105) (cid:46) 4 × 10−4.

Alternatively, in order to test the level of solenoidality of
the magnetic ﬁeld used as an input for helicity computation,
the ratio Ediv/E has been put forward by Valori et al. (2013)
as a useful criterion. The value of Ediv/E expresses the non-
solenoidal fraction of the total (NLFF) energy. The quantity Ediv
is derived from the solenoidal and non-solenoidal parts of the
potential ﬁeld (B0 = B0,s + B0,ns) and current-carrying ﬁeld
(BJ = BJ,s + BJ,ns), which stem from the initial decomposition
of the (NLFF) magnetic ﬁeld into its potential (B0) and current-
carrying (BJ) component. Then the total energy of a given mag-
netic ﬁeld may be written as the sum of the corresponding energy

Article number, page 4 of 10

budgets in the form

E = E0,s + E0,ns + EJ,s + EJ,ns + Emix,

(10)

with Emix being the energy corresponding to all cross terms (see
Eq. (8) in Valori et al. 2013, for details), and EJ,s being a measure
for the free energy. All contributions to E in Eq. (10), except
for Emix, are positive deﬁnite. In the case that the input ﬁeld is
perfectly solenoidal, we would ﬁnd E0,ns = EJ,ns = Emix = 0,
thus Ediv = 0. The energy associated with all non-solenoidal
components can then be deﬁned as

Ediv = E0,ns + EJ,ns + |Emix|,

(11)

which represents an upper limit, as the absolute value of Emix is
involved. Usually, E0,s > EJ,s > Emix > EJ,ns > E0,ns (see, e.g.,
DeRosa et al. 2015).

In the proof-of-concept study by Valori et al. (2016), based
on solar-like numerical experiments, it was suggested that only
Ediv/E (cid:46) 0.08 is suﬃcient for a reliable helicity computation.
In a follow-up study, Thalmann et al. (2019a) suggested an even
lower threshold (Ediv/E (cid:46) 0.05) for solar applications.

Based on the energy decomposition above, we can also use
the non-solenoidal contribution to the free energy |Emix|/EJ,s
to reﬁne the quantiﬁcation of the acceptable degree of non-
solenoidality in an underlying NLFF model ﬁeld. As shown
in the comparative study of DeRosa et al. (2015), the applica-
tion of the W12 method, using standard choices for the (free)
model parameters, may result in NLFF solutions with non-
solenoidal errors on the order of the inherent free magnetic en-
ergy (|Emix| (cid:39) EJ,s, see their Fig. 7b). It was also shown, how-
ever, that an alternative W12-based NLFF solution based on
an adjusted set of model parameters (more precisely in setting
wd > w f ; see Sect. 2.2.2) resulted in a signiﬁcant improvement
of the solenoidal quality (see Appendix of their work). A re-
ﬁned quantiﬁcation of the solenoidal quality of the NLFF mag-
netic ﬁelds in context with relative helicity computation, based
on |Emix|/EJ,s has not been attempted so far.

2.4. Choice of free model parameters

The solenoidality of a NLFF solution obtained by minimizing
L in Eq. (7) naturally depends on Bin (thus, the free parameter
choices of µ3 and µ4 in the preprocessing step, if applied), and
on the choice of the diagonal elements of W (either WHMI or
WEMP in the present study).

For any combination of the above quantities, the divergence-
freeness of the obtained NLFF solution can be enhanced by as-
signing a stronger relative importance of the divergence term,
i.e., by choosing wd > w f (see explanation of the free model
parameters of L in Sect. 2.2.2 for details). As a consequence,
a NLFF solution based on a certain choice of the other free
parameters may not qualify to be used as an input to helic-
ity computation when choosing wd = 1, but may do so when
choosing an enhanced weight wd > w f . This has been found in
DeRosa et al. (2015), where the application of the standard set-
ting (w f , wd) = (1, 1) was found to deliver an NLFF solution,
but without the solenoidal quality required for relative helicity
computation, as the relative contribution of the mixed terms was
comparable to that of the free energy (|Emix| ≈ EJ,s; see Fig. 7b
in their work). The NLFF model solution based on the choice
(w f , wd) = (1, 1.5), however, resulted in a signiﬁcant decrease
in the contribution Emix to the total energy, thus represented a
valid input for relative helicity computation (with |Emix| < EJ,s;
see Fig. 11 in the Appendix of their work). In order to test the

Julia K. Thalmann et al.: Reliability of relative helicities

Table 1. Synoptic view model parameters for the employed NLFF models and their appearance in the manuscript (plot symbol and ﬁgure or
appearance), if applicable.

Case

Model parameters

Preprocessing
µ3

µ4

Optimization
wd W

Appearance
(Figure)

Symbol

Special cases

Comment

–
–
–

1
–
–
–

(light blue circle)

–
– “ –
– “ –
– “ –

–
– “ –
– “ –
– “ –

1 WHMI
1 WEMP
2 WHMI
2 WEMP

Sp1a
Sp1b
Sp1c
Sp1d
. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
Sp2a
Sp2b
Sp2c
Sp2d
. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
Sp3a

No preprocessing applied. Input data is force-free inconsistent.
Not explicitly shown. Similar in behavior as Sp1a.
– “ –
– “ –

Preprocessing applied. Input data is force-free consistent.
Not explicitly shown. Similar in behavior as Sp2a.
– “ –
– “ –

1 WHMI
2 WHMI
1 WEMP
2 WEMP

0
– “ –
– “ –
– “ –

0
– “ –
– “ –
– “ –

(light blue bullet)

1
–
–
–

10−2

–
–
–

0

–

–

1 WHMI

–
–
–

– “ –
– “ –
– “ –

– “ –
– “ –
– “ –

2 WHMI
1 WEMP
2 WEMP

Sp3b
Sp3c
Sp3d
. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
Sp4a
Sp4b
Sp4c
Sp4d

Preprocessing applied, including nearness to observed data.
Same as Sp4a but wd = 2 used.
Same as Sp4a but W = WEMP used.
Same as Sp4c but wd = 2 used.

(dark blue bullet)
(dark blue square)
(orange bullet)
(orange square)

1 WHMI
2 WHMI
1 WEMP
2 WEMP

1, 3, 5a
1, 3, 5a
4, 5b
4, 5b

10−3
– “ –
– “ –
– “ –

0
– “ –
– “ –
– “ –

–
–
–

Preprocessing applied, including smoothing.
Excluded from analysis due to insuﬃcient solenoidal quality.
– “ –
– “ –
– “ –

St1a
St1b
St1c
St1d

10−3
– “ –
– “ –
– “ –

10−2
– “ –
– “ –
– “ –

1 WHMI
2 WHMI
1 WEMP
2 WEMP

1, 2, 3, 5a
1, 2, 3, 5a
4, 5b
4, 5b

(violet bullet)
(violet square)
(red bullet)
(red square)

Preprocessing applied, including smoothing and nearness to observed data.
Same as St1a but wd = 2 used.
Same as St1a but W = WEMP used. (W12 default parameter set.)
Same as St1b but W = WEMP used.

Standard preprocessing cases

eﬀect of an improved solenoidal quality of the NLFF model on
the relative helicity computation, we therefore use the choices
(w f , wd) = (1, 1) and (w f , wd) = (1, 2) in our work.

Table 1 summarizes the tested NLFF time series regarding
the speciﬁc parameter choices used to for their realization, their
appearance throughout the manuscript, and the corresponding
plotting symbols used. The inﬂuence of the distinct choice of
preprocessing parameters has not been tested yet. Therefore,
we use the speciﬁc combinations (µ3, µ4) = (0, 0), (µ3, µ4) =
(10−3, 0), (µ3, µ4) = (0, 10−2), and (µ3, µ4) = (10−3, 10−2), the
last representing the preferred standard choice suggested by
W12 (“Standard preprocessing cases”). In combination with dif-
ferent combinations of optimization parameters wd = (1, 2) and
W = (WHMI, WEMP), 16 NLFF model time series can be em-
ployed in total. Four additional NLFF time series are employed
based on the non-preprocessed (original) data. This is motivated
by the fact that the minimization of the surface term in Eq. (7)
might still yield a high-quality NLFF solution, despite the force-
free incompatibility of the measured vector magnetic ﬁeld. In
this context, it should also be noted that the input magnetic
ﬁeld data (preprocessed or not) necessarily diﬀers from the ﬁ-
nal NLFF lower boundary data due to the eﬀect of the surface
term. We note here that we do not explicitly show the results
of all of the “special cases” NLFF time series, as their relative
performance is comparable to that of respective exemplary cases
presented hereafter (see comments in the last column). Further-
more, we exclude all SP3 cases from the analysis, due to their
insuﬃcient solenoidal quality (Ediv/E > 0.1).

As in M19, all NLFF computations were carried out for a
computational volume of dimensions 320 × 320 × 320 pixels,

containing a buﬀer layer towards the lateral and top boundaries
of nd = 32 pixels, within which the NLFF solution drops in the
form of a cos-proﬁle to the ﬁeld prescribed on the boundaries
(for details see W04). For relative helicity computation only the
inner physical volume (excluding the buﬀer layer) was kept, and
further cut in height at roughly two-thirds of the total height,
yielding a size of the ﬁnally analyzed model coronal ﬁeld of
256 × 256 × 203 pixels.

3. Results

3.1. Effect of preprocessing

the eﬀect of preprocessing, we minimize
In order to test
Eq. (6) once using the standard relative weighting (µ3 = 10−3,
µ4 = 10−2; hereafter “standard preprocessing”), once omitting
smoothing (µ3 = 10−3, µ4 = 0), and once neglecting both
(µ3 = µ4 = 0). For the subsequent minimization of Eq. (7), we
apply the error matrix for optimization of the lower boundary as
used in M19 (WHMI) and use standard settings for the remain-
ing model parameters, as suggested in W12 (see Sect. 2.2.2). As
a kind of non-ideal reference we also run the optimization on
the non-preprocessed data and compare the resulting NLFF time
series in the following.

From Fig. 1a,b it can be seen that the application of pre-
processing clearly lowers the contribution of solenoidal errors.
For the NLFF models based on non-preprocessed data (light
blue circles) Ediv/E and |Emix|/EJ,s are the highest at all con-
sidered times. Corresponding values are, on average, lowest for
the NLFF solutions based on standard preprocessing (violet bul-
lets). The eﬀect of smoothing can be seen by comparison to

Article number, page 5 of 10

A&A proofs: manuscript no. aa_2020_38921_r1_submit

Fig. 1. Evolution of (a) Ediv/E and (b) |Emix|/EJ,s and (c) (cid:15)force for diﬀer-
ent NLFF models based on diﬀerent input data: not preprocessed (light
blue circles), standard preprocessed (violet bullets), preprocessed with-
out smoothing (dark blue bullets), preprocessed without smoothing and
no nearness to observed data enforced (light blue bullets). (d) Corre-
sponding time evolution of |HJ|/|HV|. The horizontal dashed line in (a)
indicates the nominal threshold of Ediv/E = 0.08, an upper limit for
the accepted solenoidality of the input magnetic ﬁeld. The vertical bars
show the time span between the nominal GOES start and peak time of
the X2.2 (peak time 08:57 UT) and X9.3 ﬂare (peak time 11:53 UT).

the corresponding values of the “no smoothing” cases (dark and
light blue bullets versus violet bullets). Overall, the application
of smoothing causes a decrease in both Ediv/E and |Emix|/EJ,s,
though more pronounced at later instances of the considered time
period. It also appears that there is no distinct diﬀerence for the
non-smoothed cases, whether or not enforcing a certain degree
of nearness to the actually observed data (compare light and dark
blue bullets).

It is noteworthy that all NLFF time series show a deteriorat-
ing quality as a function of time, i.e., the values of Ediv/E and
|Emix|/EJ,s are increasing, supposedly due to the corresponding
decrease in the inversion quality of the underlying vector mag-
netic ﬁeld measurement (see Eq. (8) and corresponding notes),
but is least pronounced for the NLFF solutions based on the
standard preprocessed input. It is also noteworthy that all except
those solutions exhibit values Ediv/E (cid:38) 0.08 for the considered
time instances after 08:48 UT.

In terms of θJ the volumetric parameter usually used to quan-
tify the force-free consistency of a NLFF model, there is no
distinct diﬀerence between the cases when preprocessing is ap-
plied or not. For completeness we note that θJ is below ≈ 7◦
prior to the X2.2 ﬂare and 7◦ (cid:46) θJ (cid:46) 12◦ afterwards. In or-
der to picture the eﬀect of preprocessing more clearly, we there-
fore show the force-balance parameter, (cid:15)force, in Fig. 1c, which is
normally used to quantify the force-free consistency of a given
vector magnetogram prior to NLFF modeling (see explanation
in Sect. 2 of Wiegelmann et al. 2006). Here we use (cid:15)force not
only to quantify how force-free consistent the input data is,
but also how force-free the ﬁnal 2D NLFF lower boundary is.
We know from previous studies that non-preprocessed vector
magnetograph data is inconsistent with a force-free approach
((cid:15)force (cid:38) 0.1; gray circles) and should not be used for force-free
modeling. If used nevertheless, the optimization procedure will
still deliver a NLFF solution, with its 2D lower boundary be-
ing more force-free consistent ((cid:15)force (cid:38) 0.08; light blue circles).
The application to preprocessed data clearly improves the NLFF
model results ((cid:15)force (cid:46) 0.08; bullets) without any obvious depen-
dencies on the particular parameter setting for preprocessing.

Article number, page 6 of 10

Fig. 2. Evolution of (a) Ediv/E and (b) |Emix|/EJ,s and (c) θJ for diﬀerent
NLFF models, based on standard preprocessed input data, with diﬀer-
ent weighting of the volume-integrated divergence: wd = 1 (bullets),
and wd = 2 (squares); (d) Corresponding time evolution of |HJ|/|HV|.
Vertical bars as in Fig. 1.

The corresponding trends of |HJ|/|HV| (Figure 1d) suggest a
clear segregation between NLFF time series based on smoothed
(violet bullets) or non-smoothed (other symbols) input data. For
completeness, we note that for all of the considered cases the rel-
ative helicities, HV, based on smoothed data are systematically
higher, as are their individual contributions (more pronounced in
HJ than in HPJ). We discuss the possible reasons in Sect. 4.

For completeness we note that the results presented above
also hold when using WEMP instead of WHMI. For simplicity,
and motivated by the the similarity of performance of the spe-
cial cases (µ3,µ4)=(0,0) and (µ3,µ4)=(10−3,0), respectively la-
beled Sp2i and Sp4i in Table 1, we do not explicitly show the
Sp2 cases in the remaining analysis.

3.2. Effect of preferring solenoidality over force-freeness

As explained in Sect. 2.4, for any choice of combination of other
model parameters the divergence-freeness of the obtained NLFF
solution may be enhanced by assigning a stronger relative impor-
tance of the divergence term, i.e., by choosing wd > w f . For sim-
plicity, here we restrict ourselves to analyzing the correspond-
ing eﬀect based on standard preprocessed data (using µ3 = 10−3
and µ4 = 10−2 in Eq. (6)). For completeness, we note that the
results presented in the following are similar for application to
non-smoothed data (µ4 = 0; compare Sect. 3.3 and Fig. 3), and
also in the cases that the empirical error matrix, WEMP, is used
(see Sect. 3.4 and Fig. 4).

In Fig. 2 we compare the results based on the standard set-
ting, where the Lorentz force and divergence term in Eq. (7) are
weighted equally (w f = wd = 1; bullets) to that with an enhanced
enforcement of solenoidality (wd = 2; squares). The stronger en-
forcement of solenoidality leads to lower values of Ediv/E and
|Emix|/EJ,s (Figs. 2a and 2b, respectively), and is at the expense
of the force-freeness of the obtained NLFF solutions (compare
θJ in Fig. 2c). Instead, for the standard weighting, θJ (cid:46) 10◦ for
the entire time series, the values are about a factor of two higher
if wd = 2 is applied.

Both NLFF time series satisfy Ediv/E < 0.08 (Fig. 2a), i.e.,
qualify for subsequent relative helicity computation. Though the
obtained trend of |HJ|/|HV| in Fig. 2d is similar for most of the
time instances, the NLFF series based on the standard setting
(wd = 1; bullets) depicts a decrease in |HJ|/|HV| prior to and an
increase during the conﬁned X2.2 ﬂare, while the solutions based
on wd = 2 (squares) indicate a pre-ﬂare increase and subsequent

Julia K. Thalmann et al.: Reliability of relative helicities

Fig. 3. Evolution of (a) Ediv/E and (b) |Emix|/EJ,s and (c) θJ for diﬀerent
NLFF models, using the empirical error matrix WHMI, and based on dif-
ferently preprocessed input data (including smoothing: violet symbols;
omitting smoothing: blue symbols), and with diﬀerent weighting of the
volume-integrated divergence (wd = 1: bullets; wd = 2: squares); (d)
Corresponding time evolution of |HJ|/|HV|. The horizontal dashed line
in (a) indicates the nominal threshold of Ediv/E = 0.08, an upper limit
for the accepted solenoidality of the input magnetic ﬁeld. The horizontal
dashed line in (b) indicates a suggested upper limit for the acceptable
non-solenoidal error to the free magnetic energy (|Emix|/EJ,s = 0.35).
Vertical bars as in Fig. 1.

helicity relaxation. Both time series agree on a helicity accumu-
lation to values |HJ|/|HV| (cid:38) 0.15 prior to the eruptive X9.3 ﬂare,
and a pronounced helicity relaxation in correspondence to the
eruptive ﬂare.

3.3. Combined effects

There is an interplay between particular choices of model param-
eters for the preprocessing and optimization, as individually dis-
cussed in Sects. 3.1 and 3.2, respectively. Therefore, we describe
combined eﬀects for the WHMI-based models in the following,
and those for the WEMP-based models in Sect. 3.4.

The choice wd = 2 (squares) during optimization has a sim-
ilar eﬀect on the ﬁnal NLFF solution, regardless of whether
smoothed (violet symbols) or non-smoothed (blue symbols)
input data are used. On average, this value lowers the non-
solenoidal energy contributions (Figs. 3a and 3b) and simulta-
neously increases θJ to a comparable level (compare Fig. 3c).
The eﬀective increase in solenoidality, however, is stronger for
the NLFF models based on non-smoothed data (blue symbols),
yielding the improved NLFF series to fulﬁll Ediv/E < 0.08 at all
times (blue squares). It also appears that NLFF solutions with a
smaller value of Ediv/E also exhibit on overall smaller values of
|Emix|/EJ,s.

It is also evident that NLFF series of comparable solenoidal
quality do not necessarily deliver similar helicity ratios (com-
pare blue and violet squares in Figs. 3b and 3d). Instead, the val-
ues of |HJ|/|HV| retrieved from non-smoothed boundaries (blue
symbols) are found to be systematically lower for most time in-
stances. Even so, all of the tested solutions depict a decrease in
|HJ|/|HV| during both ﬂares with the sole exception of the NLFF
solutions based on the standard preprocessed data (violet bul-
lets), which suggest a decrease in |HJ|/|HV| during the preceding
conﬁned X2.2 ﬂare. All of the tested solutions show a rise in
|HJ|/|HV| prior to the X9.3 ﬂare to values close to those prior to
the X2.2 ﬂare.

Fig. 4. As in Fig. 3, but using the empirical error matrix WEMP.

3.4. Effect of the particular choice of error matrix W

As noted by W12, a reasonable approximation of the accu-
racy of the measured vector magnetogram data may be such
that it weights the vertical magnetic ﬁeld measurement strongest
(based on its empirically known highest measurement accuracy),
followed by the strong horizontal ﬁeld, and with weak horizon-
tal ﬁelds being weighted least strong (see WEMP as deﬁned in
Eq. (9) in Sect. 2.2.2). In the following we test the performance
of this empirical weighting, and repeat the model experiments
applied to the measurement-based error matrix WHMI as pre-
sented in Sect. 3.3.

Trends common to those presented in Sect. 3.3 for the WHMI-
based models include that the choice wd = 2 (squares) dur-
ing optimization lowers the non-solenoidal energy contributions
(Figs. 4a and 4b), while θJ is systematically higher (Fig. 4c).
In addition, systematically lower values of |HJ|/|HV| are found
for all time instances from the NLFF models that are based
on non-smoothed input data (orange symbols). For the WEMP-
based models the individual relative helicity contributions, HPJ
and especially HJ, are also systematically higher based on non-
smoothed input data, and more pronounced than for the WHMI-
based models. The increase in |HJ|/|HV| between the two consec-
utive ﬂares is less pronounced than for the WHMI-based models.
Finally, all of the tested WEMP-based models consistently pic-
ture a decrease in |HJ|/|HV| during both X-class ﬂares, as well
as periods of helicity accumulation prior to both ﬂares (though
rather weak for most of the NLFF series).

Other ﬁndings are diﬀerent from those of the WHMI-based
models. For instance, the WEMP-based solutions show a dete-
riorating quality as a function of time, more pronounced than
the WHMI-based solutions (compare Figs. 4a,b and 3a,b). Fur-
thermore, a lower value of Ediv/E does not necessarily imply a
lower value of |Emix|/EJ,s for the WEMP-based models, and thus
NLFF solutions that satisfy Ediv/E < 0.08 may exhibit large
non-solenoidal contributions to the free magnetic energy.

3.5. Putting everything together: a recipe

Not all of the analyzed NLFF models presented in Sects. 3.3
and 3.4 satisfy the nominal threshold of Ediv/E < 0.08 (as sug-
gested by Valori et al. 2016) at all considered times, i.e., not
all do qualify for relative helicity computation. Besides, based
on the time evolution of the relative helicity in NOAA 11158,
computed with diﬀerent FV helicity computation methods, Thal-
mann et al. (2019a) argued for an even more restrictive threshold
in solar applications (Ediv/E (cid:46) 0.05). This is approximately ful-
ﬁlled for the WHMI-based models that satisfy the nominal thresh-

Article number, page 7 of 10

A&A proofs: manuscript no. aa_2020_38921_r1_submit

old Ediv/E < 0.08, inherently including a small non-solenoidal
contribution to the free magnetic energy (|Emix|/EJ,s (cid:46) 0.25).

For the WEMP-based models, however, values of Ediv/E <
0.08 do not necessarily imply small values of |Emix|/EJ,s (see or-
ange and red squares at the last two time instances in Fig. 4b, for
which |Emix|/EJ,s (cid:38) 0.5). Thus, NLFF solutions with high levels
of non-solenoidal energy compared to their free energy would
enter the relative helicity computation. As mentioned before, it
appears crucial for applications of the W12 method to minimize
the non-solenoidal contribution to the free magnetic energy (see
corresponding remarks in Sect. 2.3). We thus suggest, in addition
to respecting the nominal threshold of Ediv/E = 0.08, to keep
only the best-performing snapshots in terms of smallest non-
solenoidal contribution to the free magnetic energy from each
NLFF time series, namely those for which |Emix|/EJ,s < 0.35.

In order to place the contribution of Emix into context, we
note here that the free magnetic energy during the analyzed time
interval is in the range (cid:38) 20% of the total magnetic energy (i.e.,
EJ,s/E (cid:38) 0.2). Since Emix comprises a small percentage of E only
((cid:46) 10%), we may safely assume that it is rooted in numerical
reasons, and that a corresponding thresholding has the desired
eﬀect of sorting out NLFF solutions with a related undesirably
high contribution.

Based on the above reasoning, we can then compute a mean
value, (cid:104)|HJ|/|HV|(cid:105), from all of the accepted NLFF solutions at
each time instant, and also deduce an uncertainty estimate based
on the spread of the contributing solutions. For time instances
when only one contributing NLFF solution remains based on the
above selection criteria, no mean value can be retrieved and the
respective value of |HJ|/|HV| has to be assumed as indicative of
the true coronal relative helicity.

Figure 5a shows the time evolutions of |HJ|/|HV|, computed
from all qualifying WHMI-based NLFF models (colored sym-
bols), together with the mean value (cid:104)|HJ|/|HV|(cid:105) (black solid line)
and the standard deviation as an indication of the correspond-
ing uncertainty (gray shaded area). The corresponding time evo-
lutions for the WEMP-based NLFF models are shown in Fig-
ure 5b. Overall, the WHMI-based estimates show less variation
of (cid:104)|HJ|/|HV|(cid:105) as a function of time, though the trend is very
similar to that of the WEMP-based estimates. A period of rather
monotonic helicity accumulation prior to the conﬁned X2.2 ﬂare
terminates in values of (cid:104)|HJ|/|HV|(cid:105) (cid:39) 0.13. The subsequent ﬂare-
related helicity relaxation (apparently more pronounced in the
WEMP-based estimates) is followed by a period of relative he-
licity replenishment between ∼10:00 UT and 11:30 UT, peaking
shortly before the eruptive X9.3 ﬂare ((cid:104)|HJ|/|HV|(cid:105) (cid:38) 0.12). Fi-
nally, the X9.3 ﬂare-related helicity relaxation shows a decrease
to values of (cid:104)|HJ|/|HV|(cid:105) (cid:46) 0.1.

4. Summary

We studied the coronal magnetic ﬁeld and helicity of AR 12673,
a ten-hour time interval centered around a preceding X2.2 ﬂare
(SOL2017-09-06T08:57) that also includes an eruptive X9.3
ﬂare that occurred three hours later (SOL2017-09-06T11:53).
Our aim was to assess the spread of the relative helicities com-
puted from Eqs. (1) and (3), using the ﬁnite-volume (FV) method
of Thalmann et al. (2011) when based on diﬀerent time se-
ries of NLFF coronal magnetic ﬁelds. The corresponding NLFF
coronal magnetic ﬁelds were modeled using an optimization ap-
proach (Wiegelmann et al. 2012, hereafter W12) based on diﬀer-
ent choices of (free) model parameters, consequently diﬀering
in their solenoidal quality. The solenoidal quality of an under-
lying NLFF model, however, is a highly important factor if one

Article number, page 8 of 10

Fig. 5. Time evolution of |HJ|/|HV|, computed from the best-performing
NLFF models using the error matrix (a) WHMI or (b) WEMP. At each
time instance, only contributions from NLFF solutions are shown that
satisfy |Emix|/EJ,s ≤ 0.4. The black solid line represents the mean value,
computed from all qualifying solutions at each time instant. The gray
shaded area represents the respective standard deviation. Vertical bars
as in Fig. 1.

attempts a reliable relative helicity computation, and diﬀerent
thresholds have been suggested in the past (Valori et al. 2016;
Thalmann et al. 2019a).

The aim of our study was to gain insight into the eﬀects of
particular choices of (free) model parameters on the ﬁnal W12
NLFF solutions and subsequent relative helicity computation.
Based on the in-depth analysis of the solenoidal quality of the
underlying NLFF solutions, in context with the subsequently
computed relative helicity ratio, |HJ|/|HV| (a promising indicator
for the eruptivity of solar ARs; see Pariat et al. 2017, for a pio-
neering work), our goal was to provide a recipe for successful
and reliable relative helicity computation (including uncertain-
ties).

The W12 method involves two computational tasks. In the
ﬁrst preprocessing step, individual weights can be assigned to the
nearness to the actually observed data and the degree of smooth-
ing applied to the 2D vector magnetic ﬁeld data (controlled by µ3
and µ4, respectively, see Sect. 2.2.1 for details). In our work we
tested the standard choices µ3 = 10−3 and µ4 = 10−2, and also
the limiting values µ3 = 0 and µ4 = 0. In the subsequent opti-
mization step (see Sect. 2.2.2 for details), the volume-integrated
Lorentz force and divergence can be weighted individually (via
w f and wd, respectively), and the handling of the (preprocessed)
vector magnetic ﬁeld data can be deﬁned. The latter is realized
by a diagonal error matrix where we tested two options. First,
an error matrix originally deﬁned in the study of Moraitis et al.
(2019) (hereafter M19), based on the actual measurement uncer-
tainties of HMI (WHMI as deﬁned in Eq. (8)), and then a com-
monly used empirical one (WEMP as deﬁned in Eq. (9); see also
W12) which assumes that vertical ﬁelds are measured with high-

Julia K. Thalmann et al.: Reliability of relative helicities

est accuracy, and that the reliability of the measured horizontal
ﬁeld decreases with decreasing strength.

The volumetric force-freeness of the realized NLFF mod-
els was estimated using the current-weighted angle between the
modeled magnetic ﬁeld and electric current density, θJ, (Schri-
jver et al. 2006). For the quantiﬁcation of their solenoidal qual-
ity, we used the normalized non-solenoidal energy ratio Ediv/E,
as suggested by (Valori et al. 2013). Moreover, since it appears
crucial to minimize the non-solenoidal contribution to the free
magnetic energy (see corresponding remarks in Sect. 2.3), we
analyzed the energy ratio |Emix|/EJ,s in detail in our work, which
has not been studied before.

Regarding the impact of particular choices of (free) model
parameters, independent of the particular error matrix used
(WHMI or WEMP), on the solenoidal quality of the ﬁnal NLFF
solutions we found the following:

– The application of preprocessing prior to optimization con-
siderably lowers the non-solenoidal contributions in the ﬁ-
nal NLFF solution, with the NLFF solution being also more
force-free (Fig. 1a–c).
A crucial ingredient in lowering the solenoidal errors ap-
pears to be the application of smoothing (µ4 (cid:44) 0). Thus,
the solenoidal quality of NLFF solutions based on the pre-
processing as suggested in W12 (µ1 = µ2 = 1, µ3 = 10−3,
µ4 = 10−2) is highest overall and can be safely recommended
as a standard setting.

– The enhanced weighting of the volume-integrated diver-
gence over the force-freeness (wd > w f ) also lowers the non-
solenoidal contributions in the ﬁnal NLFF solution (Figs. 2a
and 2b), though at the expense of force-freeness (compare
Fig. 2c).
The eﬀective increase in solenoidal quality is more drastic
for the NLFF models based on non-smoothed data (blue and
orange symbols in Figs. 3a,b and 4a,b, respectively), under-
lining the corresponding desired eﬀect of using smoothed
data as input to NLFF modeling.

Diﬀerent choices of the (free) model parameters during pre-
processing and optimization allow the computation of multiple
values for the relative helicities (HV, HPJ, HJ), and consequently
for the helicity ratio, |HJ|/|HV|, at a certain time instant for a
particular error matrix (for WHMI- and WEMP-based models see
Fig. 3d and Fig. 4d, respectively). In this context, we found the
following causal impacts:

– Using smoothed data as input to NLFF modeling yields sys-
tematically higher values of |HJ|/|HV| (blue and orange sym-
bols in Figs. 3d and 4d, respectively), and similarly for the
individual contributions, HPJ and HJ, (independent of the er-
ror matrix used).
Although HJ has a clear physical meaning, namely the link-
ing of the current-carrying ﬁeld with itself, an enhanced level
of HJ does not necessarily imply the presence of systemati-
cally stronger electric currents (Régnier 2009). And indeed,
we do not ﬁnd a systematically higher total unsigned cur-
rent in the NLFF models based on smoothed data. Instead,
we ﬁnd higher total magnetic energies, E, and lower poten-
tial ﬁeld energies, E0, in those models. Thus, we suspect that
the origin of the overall higher helicities for the NLFF mod-
els is based on smoothed data in the systematically enhanced
current-carrying magnetic ﬁeld.

– For those NLFF models that satisfy the originally suggested
threshold of Ediv/E < 0.08, the non-solenoidal contributions
to the free energy, |Emix|/EJ,s, are distinctly diﬀerent. While

the WHMI-based NLFF solutions satisfying Ediv/E (cid:46) 0.05
(a reﬁned threshold for solar applications suggested by Thal-
mann et al. 2019a) also satisfy |Emix|/EJ,s (cid:46) 0.25, this is not
true for the WEMP-based models.
Therefore, and motivated by minimizing non-solenoidal er-
rors in the free magnetic energy, an additional threshold
based on |Emix|/EJ,s appears useful in order to (dis-)qualify
NLFF solutions for subsequent relative helicity computation.
– Using an upper limit of |Emix|/EJ,s = 0.35, we obtain simi-
lar trends for the mean time evolution, (cid:104)|HJ|/|HV|(cid:105), from the
two types of NLFF series (based on either WHMI or WEMP,
see Fig. 5a and 5b, respectively). Then, the empirical er-
ror matrix WEMP may be validly used as an alternative to
a measurement-based deﬁnition (such as WHMI).

Based on the above ﬁndings, we are able to provide a recipe
to obtain a reliable estimate of the coronal relative helicity to-
gether with a corresponding uncertainty estimate. In particular,
we recommend employing a mean estimate of the relative helic-
ity (and of any related quantity such as (cid:104)|HJ|/|HV|(cid:105)) at any par-
ticular time instant, computed from a number of NLFF models
based on diﬀerent (free) model parameter choices that individ-
ually satisfy Ediv/E < 0.08 and |Emix|/EJ,s < 0.35. Using this
approach we found a consistent estimate of (cid:104)|HJ|/|HV|(cid:105) from the
two types of NLFF model series (WEMP- and WHMI-based). This
includes an increase in (cid:104)|HJ|/|HV|(cid:105) prior to the conﬁned X2.2
ﬂare and between the preceding X2.2 and following X9.3 ﬂare,
together with helicity (ratio) relaxation in correspondence to the
occurrences of the ﬂares.

However, the spread of the contributing values of |HJ|/|HV|
is quite variable over the time series, about (cid:46) 0.04 before the oc-
currence of the X2.2 ﬂare and (cid:38) 0.06 prior to the eruptive ﬂare.
Overall it appears that the spread of |HJ|/|HV| scales with the
quality of the underlying NLFF time series. We recall that all of
the employed NLFF time series show a deteriorating quality, i.e.,
the values of Ediv/E and |Emix|/EJ,s increase with time, suppos-
edly due to the corresponding decrease in the inversion quality
of the underlying vector magnetic ﬁeld measurement (see corre-
sponding notes in Sect. 2.2.2).

5. Discussion

Multiple attempts were made to model and interpret the coro-
nal magnetic ﬁeld conﬁguration of AR 12673, focused on the
approximation of the self-helicity of a coronal model ﬂux rope
recovered from NLFF modeling. We note here for completeness
that in all of the ﬁnally qualifying NLFF time series, a mag-
netic ﬂux rope is present prior to the conﬁned X2.2 ﬂare, of dif-
fering morphology but in overall agreement with earlier model
attempts. Therefore, we assume that our NLFF model ﬁelds re-
alistically represent the active-region corona of AR 12673. An
in-depth comparison of the distinct model magnetic ﬁeld conﬁg-
urations, including the extent of recovering a possibly existing
“double-decker” system (see discussion below), is left for a fu-
ture work.

Based on an magneto-hydrodynamic relaxation method, Zou
et al. (2020) pictured the formation and gradual growing of a
magnetic ﬂux rope prior to the conﬁned X2.2 ﬂare, covering the
time span 00:00 UT to 11:48 UT on 2017 September 6. The ex-
isting magnetic ﬂux rope was found to grow in an accelerated
manner after the occurrence of the conﬁned ﬂare, along with
a (mild) increase in the ﬂux rope twist (an approximation for
its self-helicity). In agreement, though not explicitly shown, we

Article number, page 9 of 10

A&A proofs: manuscript no. aa_2020_38921_r1_submit

note that all our tested NLFF model series depict rather mono-
tonically increasing relative helicity HV (and its individual con-
tributions HPJ and HJ) before the X2.2 ﬂare, and show another
increase between the preceding X2.2 and following X9.3 ﬂare.
Based on a series of optimization-based NLFF models, Liu et al.
(2018) pictured the pre-X2.2 ﬂare coronal magnetic ﬁeld con-
ﬁguration in the form of a system of multiple ﬂux ropes, over-
lying each other and composed of ﬁeld of opposite handedness
(double-decker; see also Hou et al. 2018). In particular, using
the twist number method, they pictured a considerable increase
in the ﬂux rope twist during the conﬁned ﬂare. Based on the
same method, Zou et al. (2020) pictured a rather weakly increas-
ing self-helicity during the X2.2 ﬂare (see their Fig. 4c). In this
context we note that only one of our tested NLFF model series
depicts a weak increase in |HJ|/|HV| during the X2.2 ﬂare (vi-
olet bullets in Fig. 2d). All the other NLFF series, and conse-
quently (cid:104)|HJ|/|HV|(cid:105), depict a corresponding relative helicity re-
laxation. This does not necessarily conﬂict with a ﬂare’s con-
ﬁned nature, since a corresponding variation in HJ may be sim-
ply due to the exchange with HPJ (Linan et al. 2018). Finally,
all of our tested NLFF series suggest a relative helicity relax-
ation (and also of (cid:104)|HJ|/|HV|(cid:105)) during the eruptive X9.3 ﬂare. In
agreement with Liu et al. (2018), among others, this is expected
since the current-carrying magnetic structure (i.e., the coronal
ﬂux rope) was physically ejected from the corona.

In M19 the relative helicity of NOAA 12673 was studied
in detail, based on a mix of NLFF models computed using ei-
ther the W04 or W12 method (using standard model parameter
choices), depending on which of the NLFF ﬁelds had a lower
value Ediv/E, and necessarily Ediv/E < 0.08 (see their Fig. 4).
In particular, the W12 models at 08:36 UT and 08:48 UT were
of lower solenoidal quality than the corresponding W04 solu-
tions and were thus dropped from the analysis. For the remaining
time instances the W12 solutions were retained due to their rel-
atively lower solenoidal errors. The resulting time evolution of
|HJ|/|HV| depicted an increase in |HJ|/|HV| to values (cid:38) 0.15 prior
to the X-class ﬂares, corresponding decreases in the course of the
ﬂares, and the replenishment of relative the helicity ratio before
the X9.3 ﬂare (see their Fig. 7). In comparison, we ﬁnd a similar
time evolution of |HJ|/|HV|, though indicating lower character-
istic pre-ﬂare values of (cid:39) 0.13 (violet bullets in Fig. 2d). Only
the pronounced pre-X2.2 ﬂare peak of |HJ|/|HV| > 0.15 found in
M19 is not recovered in our NLFF solutions. It should be noted
that their estimates at 08:36 UT and 08:48 UT were based on
two W04-based solutions with values of Ediv/E marginally be-
low the nominal threshold of Ediv = 0.08. For NLFF models with
Ediv/E (cid:38) 0.05, however, estimates of |HJ|/|HV| may vary consid-
erably among diﬀerent helicity computation methods, even when
based on the same sequence of NLFF models (compare Figs. 2c
and 4c in Thalmann et al. 2019a). We therefore may explain our
lower pre-X2.2 ﬂare values as the inherent uncertainty of rela-
tive helicity estimates for a solenoidal quality of the underlying
NLFF models in the regime 0.05 (cid:46) Ediv/E (cid:46) 0.08.

6. Conclusion

In conclusion, reliable estimations of the relative helicity budget
(and that of related quantities) based on NLFF coronal magnetic
ﬁeld models remain a challenging task. The extended analysis of
the various NLFF model parameters in this work and the com-
parison with the analysis presented in M19 showed that ﬁnite-
volume relative helicity computation is highly sensitive to the
details of the underlying magnetic ﬁeld modeling.

Article number, page 10 of 10

A way to compensate for related issues is to employ multi-
ple NLFF time series based on diﬀerent (free) model parameter
choices and to employ mean estimates based on the subset of
NLFF models that satisfy Ediv/E < 0.08 and |Emix|/EJ,s < 0.35
at a particular time instant. In this way, it is possible to obtain
reliable estimates of the relative helicity (and related quantities)
along with corresponding uncertainty estimates. This involves a
large computational eﬀort and time, but it substantially increases
the understanding and the reliability of the obtained results. As
noted by W12, this might not be doable for long time series, but
might be a favorable approach around the times of the occurring
ﬂares.

Acknowledgements. We thank the anonymous referee for careful consideration
of the manuscript and insightful comments. J. K. T. and M. G. were supported
by the Austrian Science Fund (FWF): P31413-N27. X. S. is partially supported
by NSF awards #1848250, #1854760, and NASA award #80NSSC190263.
K. M. acknowledges support of the French Agence Nationale pour la Recherche
through the HELISOL project ANR-15-CE31-0001. SDO data are courtesy of
the NASA/SDO AIA and HMI science teams. This article proﬁted from discus-
sions during the meetings of the ISSI International Team Magnetic Helicity in
Astrophysical Plasmas.

References

Aly, J. J. 1989, Sol. Phys., 120, 19
Berger, M. A. 1999, Plasma Physics and Controlled Fusion, 41, B167
Berger, M. A. & Field, G. B. 1984, Journal of Fluid Mechanics, 147, 133
DeRosa, M. L., Wheatland, M. S., Leka, K. D., et al. 2015, ApJ, 811, 107
Finn, J. & Antonsen, T. J. 1984, Comments Plasma Phys. Controlled Fusion, 9,

111

Gilchrist, S. A., Leka, K. D., Barnes, G., Wheatland , M. S., & DeRosa, M. L.

2020, arXiv e-prints, arXiv:2008.08863

Hou, Y. J., Zhang, J., Li, T., Yang, S. H., & Li, X. H. 2018, A&A, 619, A100
James, A. W., Valori, G., Green, L. M., et al. 2018, ApJ, 855, L16
Linan, L., Pariat, É., Moraitis, K., Valori, G., & Leake, J. 2018, ApJ, 865, 52
Liu, L., Cheng, X., Wang, Y., et al. 2018, ApJ, 867, L5
Low, B. C. 1996, Sol. Phys., 167, 217
Metcalf, T. R., De Rosa, M. L., Schrijver, C. J., et al. 2008, Sol. Phys., 247, 269
Moﬀatt, H. K. 1969, Journal of Fluid Mechanics, 35, 117
Moraitis, K., Sun, X., Pariat, É., & Linan, L. 2019, A&A, 628, A50
Moraitis, K., Tziotziou, K., Georgoulis, M. K., & Archontis, V. 2014, Sol. Phys.,

289, 4453

Pariat, E., Leake, J. E., Valori, G., et al. 2017, A&A, 601, A125
Pariat, E., Valori, G., Démoulin, P., & Dalmasse, K. 2015, A&A, 580, A128
Prior, C. & Yeates, A. R. 2014, ApJ, 787, 100
Régnier, S. 2009, A&A, 497, L17
Rust, D. M. 1994, Geophys. Res. Lett., 21, 241
Scherrer, P. H., Schou, J., Bush, R. I., et al. 2012, Sol. Phys., 275, 207
Schrijver, C. J., De Rosa, M. L., Metcalf, T. R., et al. 2006, Sol. Phys., 235, 161
Sun, X. 2013, arXiv e-prints, arXiv:1309.2392
Taylor, J. B. 1974, Phys. Rev. Lett., 33, 1139
Thalmann, J. K., Inhester, B., & Wiegelmann, T. 2011, Sol. Phys., 272, 243
Thalmann, J. K., Linan, L., Pariat, E., & Valori, G. 2019a, ApJ, 880, L6
Thalmann, J. K., Moraitis, K., Linan, L., et al. 2019b, ApJ, 887, 64
Valori, G., Démoulin, P., & Pariat, E. 2012, Sol. Phys., 278, 347
Valori, G., Démoulin, P., Pariat, E., & Masson, S. 2013, A&A, 553, A38
Valori, G., Pariat, E., Anﬁnogentov, S., et al. 2016, Space Sci. Rev., 201, 147
Wheatland, M. S., Sturrock, P. A., & Roumeliotis, G. 2000, ApJ, 540, 1150
Wiegelmann, T. 2004, Sol. Phys., 219, 87
Wiegelmann, T. 2008, Journal of Geophysical Research (Space Physics), 113,

A03S02

Wiegelmann, T. & Inhester, B. 2010, A&A, 516, A107
Wiegelmann, T., Inhester, B., & Sakurai, T. 2006, Sol. Phys., 233, 215
Wiegelmann, T. & Sakurai, T. 2012, Living Reviews in Solar Physics, 9, 5
Wiegelmann, T., Thalmann, J. K., Inhester, B., et al. 2012, Sol. Phys., 281, 37
Wiegelmann, T., Thalmann, J. K., Schrijver, C. J., De Rosa, M. L., & Metcalf,

T. R. 2008, Sol. Phys., 247, 249

Woltjer, L. 1958, Proceedings of the National Academy of Science, 44, 833
Zou, P., Jiang, C., Wei, F., et al. 2020, ApJ, 890, 10
Zuccarello, F. P., Pariat, E., Valori, G., & Linan, L. 2018, ApJ, 863, 41

