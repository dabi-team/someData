DRAFT VERSION APRIL 16, 2021
Preprint typeset using LATEX style AASTeX6 v. 1.0

1
2
0
2

r
p
A
5
1

]

R
S
.
h
p
-
o
r
t
s
a
[

1
v
9
2
2
7
0
.
4
0
1
2
:
v
i
X
r
a

MHD MODELING OF SOLAR CORONAL MAGNETIC EVOLUTION DRIVEN BY PHOTOSPHERIC FLOW

CHAOWEI JIANG1, XINKAI BIAN1, TINGTING SUN1, XUESHANG FENG1

1Institute of Space Science and Applied Technology, Harbin Institute of Technology, Shenzhen 518055, China; chaowei@hit.edu.cn

ABSTRACT

It is well known that magnetic ﬁelds dominate the dynamics in the solar corona, and new generation of nu-
merical modelling of the evolution of coronal magnetic ﬁelds, as featured with boundary conditions driven
directly by observation data, are being developed. This paper describes a new approach of data-driven mag-
netohydrodynamic (MHD) simulation of solar active region (AR) magnetic ﬁeld evolution, which is for the
ﬁrst time that a data-driven full-MHD model utilizes directly the photospheric velocity ﬁeld from DAVE4VM.
We constructed a well-established MHD equilibrium based on a single vector magnetogram by employing an
MHD-relaxation approach with sufﬁciently small kinetic viscosity, and used this MHD equilibrium as the ini-
tial conditions for subsequent data-driven evolution. Then we derived the photospheric surface ﬂows from a
time series of observed magentograms based on the DAVE4VM method. The surface ﬂows are ﬁnally inputted
in time sequence to the bottom boundary of the MHD model to self-consistently update the magnetic ﬁeld at
every time step by solving directly the magnetic induction equation at the bottom boundary. We applied this
data-driven model to study the magnetic ﬁeld evolution of AR 12158 with SDO/HMI vector magnetograms.
Our model reproduced a quasi-static stress of the ﬁeld lines through mainly the rotational ﬂow of the AR’s
leading sunspot, which makes the core ﬁeld lines to form a coherent S shape consistent with the sigmoid struc-
ture as seen in the SDO/AIA images. The total magnetic energy obtained in the simulation matches closely the
accumulated magnetic energy as calculated directly from the original vector magnetogram with the DAVE4VM
derived ﬂow ﬁeld. Such a data-driven model will be used to study how the coronal ﬁeld, as driven by the slow
photospheric motions, reaches a unstable state and runs into eruptions.
Keywords: Magnetic ﬁelds; Magnetohydrodynamics (MHD); Methods: numerical; Sun: corona; Sun: ﬂares

1. INTRODUCTION

Magnetic ﬁelds dominate the dynamics in the Sun’s up-
per atmosphere, the solar corona. On the solar surface, i.e.,
the photosphere, magnetic ﬁelds are seen to change contin-
uously; magnetic ﬂux emergence brings new ﬂux from the
solar interior into the atmosphere, and meanwhile the ﬂux is
advected and dispersed by surface motions such as granula-
tion, differential rotation and meridional circulation. Conse-
quently, the coronal ﬁeld evolves in response to (or driven
by) the changing of the photospheric ﬁeld, and thus complex
dynamics occur ubiquitously in the corona, including the in-
teraction of newly emerging ﬁeld with the pre-existing one,
twisting and shearing of the magnetic arcade ﬁelds, magnetic
reconnection, and magnetic explosions which are manifested
as ﬂares and coronal mass ejections (CMEs).

As we are still not able to measure directly the three-
dimensional (3D) coronal magnetic ﬁelds, numerical mod-
elling has long been employed to reconstruct or simulate
the coronal magnetic ﬁelds based on different assumption
of the magnetohydrodynamic (MHD) equations, such as the
most-frequently used force-free ﬁeld model (Wiegelmann
& Sakurai 2012), which has been developed for over four
decades. However, the force-free ﬁeld assumption is only

valid for the equilibrium of the corona, and it cannot be used
to follow a continual and dynamic evolution of the mag-
netic ﬁelds. In recent years, with vector magnetogram data
in the photosphere measured routinely with high resolution
and cadence, data-driven modelling is becoming a viable tool
to study coronal magnetic ﬁeld evolution, which can self-
consistently describe both the quasi-static and the dynamic
evolution phases (e.g., Wu et al. 2006; Feng et al. 2012; Che-
ung & DeRosa 2012; Jiang et al. 2016; Leake et al. 2017; In-
oue et al. 2018; Hayashi et al. 2019; Guo et al. 2019; Pomoell
et al. 2019). Still, due to the limited constraint from obser-
vation, data-driven models are developed with very different
settings from each other (Toriumi et al. 2020). For simplicity,
some used the magneto-frictional model (Cheung & DeRosa
2012; Pomoell et al. 2019), in which the Lorentz force is
balanced by a ﬁctional plasma friction force. As such, the
magnetic ﬁeld evolves mainly in a quasi-static way (Yang
et al. 1986), although in some case an eruption can be repro-
duced but it evolves in a much slower rate than the realistic
one (Pomoell et al. 2019), because the dynamic is strongly
reduced by the frictional force. Some used the so-called zero-
β model (Inoue 2016; Inoue et al. 2018; Guo et al. 2019), in
which the gas pressure and gravity are neglected. The zero-β

 
 
 
 
 
 
2

model might fail when there is fast reconnection in the ﬁeld,
in which the thermal pressure could play an important role in
the dynamics in weak-ﬁeld region of magnetic ﬁeld dissipa-
tion. Therefore, it is more realistic and accurate to solve the
full MHD equations to deal with the nonlinear interaction of
magnetic ﬁelds with plasma.

To drive the full MHD model, one needs to specify all
the eight variables (namely plasma density,
temperature,
and three components of velocity and magnetic ﬁeld, re-
spectively) in a self-consistent way at the lower bound-
ary.
Previously, with only the magnetic ﬁeld obtained
from observations, we employed the projected-characteristic
method (Nakagawa 1980; Nakagawa et al. 1987; Wu & Wang
1987; Hayashi 2005; Wu et al. 2006) to specify the other vari-
ables according to the information of characteristics based
on the wave-decomposition principle of the full MHD sys-
tem (e.g., Jiang et al. 2016; Jiang et al. 2016). Speciﬁcally,
the full MHD equations are a hyperbolic system that can be
eigen-decomposed into a set of characteristic wave equations
(i.e., compatibility equations), which are independent with
each other; on the boundary, these waves may propagate in-
ward or outward of the computational domain because the
wave speeds (the eigenvalues) of both signs generally exist
at the boundary. If the wave goes out of the computational
domain through the boundary, it carries information from the
inner grid to the boundary, and thus the corresponding com-
patibility equation should be used to constrain the variables
on the boundary surface. Thus if there are ﬁve waves going
out, and with three components of magnetic ﬁeld speciﬁed
by observed data, the eight variables are fully determined.
Ideally and in principle, the projected-characteristic method
is the most self-consistent one with inputting data that is par-
tially available (for example, in our case, only the data of
magnetic ﬁeld). However, such conditions, i.e., exactly ﬁve
waves going out, are often not satisﬁed in the whole bound-
ary and other assumptions are still necessary. Even worse, in
areas near the magnetic polarity inversion line (PIL) where
the normal magnetic ﬁeld component is small, the Alfv´en
wave information goes mainly in the transverse direction
rather than the normal one, and the projected-characteristic
approach may fail. Another shortcoming of the method lies
in its difﬁculty in code implementation, which needs to per-
form eigen-decomposition and solve a linear system of the
compatibility equations on every grid point on the bound-
ary to recover the primitive variables from the characteristic
ones.

In this paper we test another way of specifying the bottom
boundary conditions, which uses the surface velocity derived
by the DAVE4VM method (Schuck 2008) to drive the MHD
model. The differential afﬁne velocity estimator (DAVE)
was ﬁrst developed for estimating velocities from line-of-
sight magnetograms, and was then modiﬁed to directly in-
corporate horizontal magnetic ﬁelds to produce a differen-
tial afﬁne velocity estimator for vector magnetograms (thus

called DAVE4VM). It is generally accepted that the coronal
magnetic ﬁelds are line tied in the dense photosphere and
are advected passively by the surface motions of the pho-
tosphere, such as the shearing, rotational, and converging
ﬂows (Priest & Forbes 2002). Thus, with the surface veloc-
ity in hand, we can solve the magnetic induction equation
on the bottom boundary to update self-consistently the mag-
netic ﬁeld to implement such a line-tying boundary condi-
tion, which is a much simpler way than using the projected-
characteristic method. To illustrate the approach, we take the
solar AR 12158 as an example to simulate its two-day evo-
lution from 2014 September 8 to 10 during its passage of
the solar disk. This AR is of interest since it produced an
X1.6 eruptive ﬂare accompanied with a fast CME with speed
of ∼ 1300 km s−1, which is well documented in the liter-
ature (Vemareddy et al. 2016; Zhao et al. 2016; Zhou et al.
2016). The AR is well isolated from neighboring ARs, thus
is suited for our modelling focused on a single AR. Within
a few days prior to this major eruption, the AR developed
from a weakly sheared magnetic arcade into a distinct sig-
moidal conﬁguration, indicating a continual injection of non-
potential magnetic energy into the corona through the pho-
tospheric surface motion. Indeed, prior to the eruption, the
major sunspot of the AR showed a signiﬁcant rotation of
over 200◦ in ﬁve days (Vemareddy et al. 2016). Based on
the sigmoidal hot coronal loop seen immediately before the
ﬂare, many authors have interpreted it as a pre-existing mag-
netic ﬂux rope which erupted and resulted in the ﬂare and
CME (e.g., Vemareddy et al. 2016; Zhao et al. 2016; Zhou
et al. 2016), while some nonlinear force-free ﬁeld extrapo-
lations appear not to support this (Duan et al. 2017; Lee &
Magara 2018). Thus a fully data-driven MHD simulation can
provide valuable insight in addressing this issue by following
the dynamic evolution of the coronal magnetic ﬁeld, although
the main objective of this paper is to describe the methods.

In the following we ﬁrst describe our model equation
in Section 2. The data-driven simulation consists of three
steps, and ﬁrst we constructed an MHD equilibrium based
on a single vector magnetogram observed for the start time
of our simulation, which is described in Section 3. Then
in Section 4 we calculated the surface ﬂow ﬁeld using the
DAVE4VM code with the time series of vector magne-
tograms. Finally, we input the ﬂow ﬁeld in the model to drive
the evolution of the MHD system, as described in Section 5.
Summary and discussion are given in Section 6.

2. MHD EQUATIONS

We numerically solve the full MHD equations in a
3D Cartesian geometry by an advanced conservation ele-
ment and solution element (CESE) method (Jiang et al.
2010). Before describing the model equations in the code,
it
is necessary to specify the quantities used for non-
dimensionalization. Here we use typical values at the base
of the corona for non-dimensionalization as given in Table 1.

Variable

Density

Temperature

Length

Pressure

Velocity

Time

Gravity

Expression

ρs = nm
Ts
Ls = 16 arcsec
ps = 2nkBTs
√
µ0ps
vs = (cid:112)ps/ρs
ts = Ls/vs
gs = vs/ts

Value
2.29 × 10−15 g cm−3
1 × 106 K
11.52 Mm
2.76 × 10−2 Pa
1.86 G
110 km s−1
105 s
1.05 km s−2

Magnetic ﬁeld Bs =

Table 1. Parameters used for non-dimensionalization. n is a typical
value of electron number density in the corona given by n = 1 ×
109 cm−3 and m is the mean atomic mass.

In the rest of the paper all the variables and quantities are
written in non-dimensionalized form if not mentioned spe-
cially.

In non-dimensionalized form, the full set of MHD equa-

tions are given as

∂ρ
∂t

+ ∇ · (ρv) = −νρ(ρ − ρ0),

= −∇p + J × B + ρg + ∇ · (νρ∇v),

ρ

Dv
Dt

∂B
∂t

= ∇ × (v × B),

∂T
∂t

+ ∇ · (T v) = (2 − γ)T ∇ · v.

(1)

where J = ∇ × B, ν is the kinetic viscosity, and γ is the
adiabatic index.

Note that we artiﬁcially add a source term −νρ(ρ − ρ0)
to the continuity equation, where ρ0 is the density at the
initial time t = 0 (or some prescribed form), and νρ is a
prescribed coefﬁcient. This term is used to avoid a ever-
decreasing of the density in the strong magnetic ﬁeld region,
which we often encounter in the very low-β simulation. It
can maintain the maximum Alfv´en speed in a reasonable
level, which may otherwise increase and make the iteration
time step smaller and smaller and the long-term simulation
unmanageable. Speciﬁcally, this source term is a Newton re-
laxation of the density to its initial value by a time scale of

τρ =

1
νρ

= 20τA,

(2)

where τA = 1/vA is the Alfv´en time with length of 1 (the
length unit) and the Alfv´en speed vA = B/
ρ. Thus it is
sufﬁciently large to avoid its inﬂuence on the fast dynamics
of Alfv´enic time scales. As a result, we used νρ = 0.05vA in
all the simulation in this paper.

√

No explicit resistivity is used in the magnetic induction
equation, but magnetic reconnection is still allowed through
numerical diffusion when a current layer is sufﬁciently nar-
row such that its width is close to the grid resolution.
In
the energy (or temperature) equation, we set γ = 1 for sim-

3

plicity, such that the energy equation describes an isothermal
process. 1 The kinetic viscosity ν will be given with differ-
ent values when needed, which is described in the following
sections.

3. CONSTRUCTION OF AN INITIAL MHD

EQUILIBRIUM

We ﬁrst constructed an initial MHD equilibrium based on
a single vector magnetogram taken for time of 00:00 UT on
2014 September 8 by SDO/HMI. Such an equilibrium is as-
sumed to exist when the corona is not in the eruptive stage,
and is crucial for starting our subsequent data-driven evolu-
tion. The vector magnetogram is preprocessed to reduce the
Lorentz force and is further smoothed to ﬁlter out the small-
scale structures that are not sufﬁciently resolved in our simu-
lation. Reduction of the Lorentz force is helpful for reaching
a more force-free equilibrium state (e.g., Wiegelmann 2004),
and smoothing is also necessary to mimic the magnetic ﬁeld
at the coronal base rather directly the photosphere, because
the lower boundary of our model is placed at the base of the
corona (Jiang & Toriumi 2020). The preprocessing is done
using a code developed by Jiang & Feng (2014), which is
originally designed for NLFFF extrapolation using the HMI
data (Jiang & Feng 2013). Speciﬁcally, the total Lorentz
force and torque are quantiﬁed by two surface integrals asso-
ciated with three components of the photospheric magnetic
ﬁeld, and an optimization method is employed to minimize
these two functions by modifying the magnetic ﬁeld compo-
nents within margins of measurement errors. Then Gaussian
smoothing with FWHM of 8 arcsec is applied to all the three
components of the magnetic ﬁeld. Figure 1 compares the
original HMI vector magnetogram with the preprocessed one
as well as the ﬁnal smoothed version. Using the vertical com-
ponent Bz of this preprocessed and smoothed magnetogram,
a potential ﬁeld is extrapolated and used as the initial condi-
tion of the magnetic ﬁeld in the MHD model.

In addition to the magnetic ﬁeld, an initial plasma as the
background atmosphere is also needed to start the MHD sim-
ulation. We used an isothermal plasma in hydrostatic equi-
librium. It is stratiﬁed by solar gravity with a density ρ = 1
at the bottom and a uniform temperature of T = 1. Us-
ing this typical coronal plasma, we did not directly input the
magnetic ﬁeld into the model but multiplies it with a factor
of 0.05 such that the maximum of magnetic ﬁeld strength in
normalized value is approximately 50 ∼ 100 in the model.
If using the original values of magnetic ﬁeld, its strength
(and the characteristic Alfv´en speed) near the lower surface
is too larger, which will be a too heavy burden on compu-
tation as the time step of our simulation is limited by the

1 Although in this case we can simply discard the energy equation by
setting the temperature as a constant, we still keep the full set of equations in
our code which can thus describe either the isothermal or adiabatic process
by choose different value of γ.

4

Figure 1. Comparison of the original HMI vector magnetogram for time of 00:00 UT on 2014 September 8 (top panels), the preprocessed one
(middle) and the ﬁnal smoothed one (bottom). From left to right are shown for magnetic ﬁeld components Bx, By, and Bz, respectively.

CFL condition. With the reduced magnetic ﬁeld, we fur-
ther modiﬁed the value of solar gravity to avoid an unreal-
istic large plasma β (and small Alfv´en speed) in the corona.
This is because if using the real number of the solar gravity
(g(cid:12) = 274 m s−2/gs = 0.26), it results in a pressure scale
height of Hp = 3.8, by which the plasma pressure and den-
sity decay with height much slower than the magnetic ﬁeld.
With the weak magnetic ﬁeld strength we used, the plasma
β will increase with height very fast to above 1, which is not
realistic in the corona. To make the pressure (and density)
decrease faster in the lower corona, we modiﬁed the gravity
as

g =

1.5Hpg(cid:12)
(1 + 0.15z)2 .

(3)

By this, we got a plasma with β < 1 mainly within z < 10
and the smallest value is 5 × 10−3.

Then we input the transverse ﬁeld of the smoothed mag-
netogram to the model. This is done by modifying the trans-
verse ﬁeld on the bottom boundary incrementally using lin-
ear extrapolation from the potential ﬁeld to the vector mage-
togram in time with a duration of 1 ts until it matches the
vector magnetogram. This will drive the coronal magnetic
ﬁeld to evolve away from the initial potential state, since

the change of the transverse ﬁeld will inject electric currents
and thus Lorentz forces, which drive motions in the com-
putational volume. Note that in this phase all other vari-
ables on the bottom boundary are simply ﬁxed, thus the ve-
locity remaining zero. This is somewhat un-physical since
the Lorentz force will introduce nonzero ﬂows on the bottom
boundary, but it provides a simple and ‘safe’ way (avoiding
numerical instability) to bring the transverse magnetic ﬁeld
into the model. Once the magnetic ﬁeld on the bottom sur-
face is identical to that of the vector magnetogram, the sys-
tem is then left to relax to equilibrium with all the variables
(including the magnetic ﬁeld) on the bottom boundary ﬁxed.
To avoid a too large velocity in this phase such that the sys-
tem can relax faster, we set the kinetic viscosity coefﬁcient as
ν = 0.5∆x2/∆t, where ∆x is the local grid spacing and ∆t
the local time step, determined by the CFL condition with
the fastest magnetosonic speed. Actually this is the largest
viscosity one can use with given grid size ∆x and time step
∆t, because the CFL condition for a purely diffusive equa-
tion with diffusion coefﬁcient ν requires ∆t ≤ 0.5∆x2/ν.

For the purpose of minimizing the numerical boundary in-
ﬂuences introduced by the side and top boundaries of the
computational volume, we used a sufﬁciently large box of

-100-50050100y (arcsec)-100-50050100BxBy-1000-50005001000Bx, By, Bz (G)Bz-100-50050100x (arcsec)-100-50050100y (arcsec)-100-50050100-100-50050100Bx-100-50050100x (arcsec)-100-50050100By-100-50050100x (arcsec)-100-50050100-1000-50005001000Bx, By, Bz (G)Bz-100-50050100x (arcsec)-100-50050100y (arcsec)-100-50050100-100-50050100Bx-100-50050100x (arcsec)-100-50050100By-100-50050100x (arcsec)-100-50050100-1000-50005001000Bx, By, Bz (G)Bz5

where the indices k and k − 1 refer to the two consecutive
time steps and i goes through all the mesh points. It can be
seen that the magnetic energy increases sharply in a few time
units2, reaching ∼ 1.4 of the potential ﬁeld energy E0 (here
E0 = 1.2 × 1033 erg when scaled to the realistic value in the
corona), and then keeps almost constant during the relaxing
phase with bottom boundary ﬁxed. Very similar, the kinetic
energy ﬁrst increases and later keeps on the level of 3 × 10−3
of E0. The residual of the magnetic ﬁeld increases in the
ﬁrst ts as we continually modiﬁed the transverse ﬁeld at the
bottom boundary which drives quickly the evolution of the
ﬁeld in the corona. Then it decreases to below 10−5 with a
time duration of 20 ts, which indicates that the magnetic ﬁeld
reaches a quasi-equilibrium state.

To make the ﬁeld even closer to equilibrium, we carried out
a ‘deeper’ relaxation by running the model again, which is
started with the relaxed magnetic ﬁeld obtained at t = 20 ts
and the initially hydrostatic plasma. Now we reduce the ki-
netic viscosity to ν = 0.05∆x2/∆t, i.e., an order of mag-
nitude smaller than the previously used one, which will let
the magnetic ﬁeld relax further. Furthermore, the magnetic
ﬁeld at the boundary boundary is allowed to evolve in a self-
consistent way by assuming the bottom boundary as a per-
fectly line-tying and ﬁxed (i.e., v = 0) surface of magnetic
ﬁeld lines. However, such a line-tying condition does not in-
dicate that all magnetic ﬁeld components on the boundary are
ﬁxed, because even though the velocity v is given as zero on
the bottom boundary, it is not necessarily zero in the neigh-
boring inner points. To self-consistently update the magnetic
ﬁeld, we solve the magnetic induction equation on the bot-
tom boundary. Slightly different from the one in the main
equations (1), the induction equation at the bottom surface is
given as

∂B
∂t

= ∇ × (v × B) + ηstable∇2

⊥B,

(5)

⊥ = ∂2

∂x2 + ∂2

where we added a surface diffusion term deﬁned by using a
surface Laplace operator as ∇2
∂y2 with a small
resistivity for numerical stability near the PIL ηstable = 1 ×
10−3e−B2
z , since the magnetic ﬁeld often has the strongest
gradient on the photosphere around the main PIL. The sur-
face induction Equation (5) in the code is realized by second-
order difference in space and ﬁrst-order forward difference
in time. Speciﬁcally, on the bottom boundary (we do not use
ghost cell), we ﬁrst compute v × B, and then use central dif-
ference in horizontal direction and one-sided difference (also
2nd order) in the vertical direction to compute the convec-
tion term ∇ × (v × B). The surface Laplace operator is also

2 Note that at the very beginning the magnetic energy actually decreases
shortly for about 0.5 ts, which is unphysical as the potential ﬁeld energy is
in principle the lowest energy with a given magnetic ﬂux distribution on the
bottom boundary. Such an unphysical evolution is a result of the fact that
we modiﬁed directly the transverse magnetic ﬁeld on the bottom boundary
in an unphsyical way.

Figure 2. Evolutions of the total magnetic energy, kinetic energy,
and residual of magnetic ﬁeld in the process of the constructing the
initial MHD equilibrium. The black curves show the results for the
ﬁrst evolution phase, and the blue ones show that for the second,
‘deeper’ evolution phase.

(−32, −32, 0) < (x, y, z) < (32, 32, 64) embedding the
ﬁeld of view of the magnetogram of (−8.75, −8.25) <
(x, y) < (8.75, 8.25). The full computational volume is re-
solve by a non-uniform block-structured grid with adaptive
mesh reﬁnement (AMR), in which the highest and lowest
resolution are ∆x = ∆y = ∆z = 1/16 (corresponding
to 1 arcsec or 720 km, matching the resolution of the vector
magnetogram) and 1/2, respectively. The AMR is controlled
to resolve with the smallest grids the regions of strong mag-
netic gradients and current density. The magnetic ﬁeld out-
side of the area of the magnetograms on the lower boundary
is given as zero for the vertical component and simply ﬁxed
as the potential ﬁeld for the transverse components. On the
side and top boundaries, we ﬁxed the plasma density, temper-
ature and velocity. The horizontal components of magnetic
ﬁeld are linearly extrapolated from the inner points, while the
normal component is modiﬁed according to the divergence-
free condition to avoid any numerical magnetic divergence
accumulated on the boundaries.

In Figure 2, the curves colored in black show the evolution
of the magnetic and kinetic energies integrated for the com-
putational volume, and the residual of the magnetic ﬁeld of
two consecutive time steps which is deﬁned as

ResB =

(cid:118)
(cid:117)
(cid:117)
(cid:116)

1
3

(cid:88)

(cid:80)

i

δ=x,y,z

(cid:0)Bk
(cid:80)
i

iδ − Bk−1
(cid:0)Bk

iδ
(cid:1)2

iδ

(cid:1)2

,

(4)

       0.91.01.11.21.31.41.5EM/E0       0123456EK/E0 × 1030102030405060Time (ts)10-610-510-410-310-2ResB6

Figure 3. 3D magnetic ﬁeld of the MHD equilibrium based on the magnetogram taken for 00:00 UT on 2014 September 8. The thick lines are
magnetic ﬁeld lines and are pseudo-colored by value of the force-free parameter α. The background is shown with the magnetic ﬂux distribution
(i.e., Bz) on the bottom surface of the model.

realized by central difference.

The curves colored in blue in Figure 2 show the evolu-
tion of different parameters during this relaxation phase 3.
Initially one can see a fast decrease of the magnetic energy
because the magnetic ﬁeld becomes more relaxed. As the
viscosity is reduced signiﬁcantly, the kinetic energy ﬁrst in-
creases, as driven by the residual Lorentz force of the mag-
netic ﬁeld, to almost 5 × 10−3 E0. Then as the magnetic
ﬁeld relaxed, the kinetic energy decreases fast to eventually
less than 10−3 E0, which is a very low level. The residual of
magnetic ﬁeld of two consecutive time steps also decreases
to 10−5. These values show that the magnetic ﬁeld reaches
an excellent equilibrium.

Figure 3 shows the 3D magnetic ﬁeld lines of the ﬁnal re-
laxed MHD equilibrium. Note that the ﬁeld lines are false-
colored by the values of the force-free factor deﬁned as
α = J · B/B2, which indicates how much the ﬁeld lines
are non-potential. For a force-free ﬁeld, this parameter is
constant along any given ﬁeld line. As can be seen, the mag-
netic ﬁeld is close to a perfect force-free one since the color is
nearly the same along any single ﬁeld line. In the core of the
conﬁguration, the ﬁeld lines are sheared signiﬁcantly along
the PIL, and thus have large values of α and current den-
sity. On the other hand, the overlying ﬁeld is almost current-
free or quasi-potential ﬁeld with α ∼ 0, which plays the role
of strapping ﬁeld that conﬁnes the inner sheared core. Such

3 Note that the initial values of the blue curves (the deeper relaxation
phase) do not equal to the values of the black curves at t = 20ts although
the deeper relaxation phase starts from that time point. This is because in
the deeper relaxation process, there are three ways different from the initial
relaxation one: (1) the velocity is reset to zero and the plasma is reset to
hydrostatic state, thus the kinetic energy is reset to zero; (2) the viscosity is
abruptly reduced by an order of magnitude; (3) the boundary condition is
changed. Furthermore, not data of every time step in the run is recorded,
thus small difference is shown in the magnetic energy of the initial value
of the blue line (which is not exactly for the time of t = 20ts) from the
t = 20ts of the black line.

a conﬁguration is typical for eruption-productive ARs (e.g.,
Schrijver et al. 2008; Sun et al. 2012; Jiang et al. 2016; Tori-
umi & Wang 2019; Duan et al. 2019).

Figure 4. Evolution of Poynting ﬂux (black line) and the accumu-
lated energy (red line) which is time integration of the Poynting ﬂux.
The gray bars denote the data gaps of the vector magnetograms for
which a simple linear interpolation in time is used to ﬁll.

4. DERIVE THE SURFACE FLOW FIELD

Based on the time sequence of vector magnetograms, it
is straightforward to derive the surface velocity by employ-
ing the DARE4VM code developed by Schuck (2008). The
differential afﬁne velocity estimator (DAVE) was ﬁrst de-
veloped for estimating velocities from line-of-sight magne-
tograms, and was then modiﬁed to directly incorporate hori-
zontal magnetic ﬁelds to produce a differential afﬁne veloc-
ity estimator for vector magnetograms (DAVE4VM). We use
the SHARP data with cadence of 12 minutes and pixel size
of 1 arcsec (by rebinning the original data with pixel size of
0.5 arcsec), and ﬁrst of all, we ﬁll the data gap using a lin-
ear interpolation in the time domain to generate a complete
time series of three days from 00:00 UT on 2014 September
8 to 24:00 UT on September 10 with cadence of 12 min-
utes. Then we input the time series of vector magnetogram

0122436486072Time (hour)-10-50510dE/dt (1027 erg s-1)0123456Eacc (1032 erg)7

Figure 5. Four snapshots of the surface ﬂows (the ﬁnal smoothed version) as derived using the DAVE4VM code.

(rebinned as 1 arcsec per pixel) in the DAVE4VM code. A
key parameter needed by the DAVE4VM code is the window
size, and here we use 19 pixels, following Liu et al. (2012)
and Liu et al. (2014). After obtaining the surface velocity, we
ﬁrst reset those in the weak-ﬁeld region (with total magnetic
ﬁeld strength below 100 G) as zero, because there are large
errors and unresolved scales in these regions. Figure 4 shows
evolution of the Poynting ﬂux dE/dt, which is deﬁned by

dE
dt

=

1
µ0

(cid:90)

S

(cid:2)(B2

x + B2

y)vz − (Bxvx + Byvy)Bz

(cid:3) dxdy,

(6)
where S is the photospheric surface, and its time accumula-
tion Eacc, as computed by using the surface ﬂow (vx, vy, vz)
and the magnetic ﬁeld. It can be seen that, except the data
gap intervals4, the magnetic energy is continually injected in
the corona through the photosphere, and in the three days, it
gains ∼ 5 × 1032 erg.

Before being input into the model, the ﬂow data are also
needed to be smoothed. We smoothed the time series of

4 During the data gaps the Poynting ﬂux is found to become negative
adruptly, which might be a result of our simple linear interpolation in ﬁlling
the gaps of the magnetograms. More optimized method for ﬁlling the data
gaps will be considered to recover a more consistent evolution of Poynting
ﬂux.

ﬂow maps in both the time and space domains, with a Gaus-
sian FWHM of 6 hours (i.e., 30 time snapshots) and 8 arc-
sec, respectively, which is ﬁnally input to the data-driven
model. Figure 5 shows 4 snapshots of the surface velocity
after smoothing. The speed of the ﬂow is generally a few
hundreds of meters per second and the main feature is a clear
and persistent rotation of the main sunspot. Note that dur-
ing the three days the basic conﬁguration of the photospheric
magnetic ﬂux distribution is rather similar with only some-
what dispersion. So the magnetic energy injection should
come mainly from the transverse rotational ﬂows. In addi-
tion to the rotational ﬂow, we can see very evident diverging
ﬂow existing persistently near the boundary of the sunspot.

5. DATA-DRIVEN SIMULATION

We input the surface velocity at the bottom boundary to
drive the evolution of the model, by starting the simulation
from the solution obtained from the time point of t = 58
in the relaxation phase (see Figure 2) as described in Sec-
tion 3. Here to save computing time, the cadence of the in-
put ﬂow maps, which is originally 12 min, was increased by
68.6 times when inputting into the MHD model. As a result,
an unit of time in the simulation, ts, corresponds to actually
ts × 68.6 = 7200 s, i.e., 2 hours, in the HMI data. Com-
pressing of the time in HMI data is justiﬁed by the fact that

400 m s-1-100-50050100y (arcsec)2014-09-08 04:00 UT400 m s-1-744-3720372744Bz (G)2014-09-08 20:00 UT400 m s-1-100-50050100x (arcsec)-100-50050100y (arcsec)2014-09-09 12:00 UT400 m s-1-100-50050100x (arcsec)-744-3720372744Bz (G)2014-09-10 04:00 UT8

Figure 6. Magnetic energy (top) and kinetic energy (bottom) evolu-
tion of the MHD system as driven by the photospheric ﬂows. The
black lines represent the values of the volume-integrated energies.
The blue line in the top panel shows the time integration of the to-
tal Poynting ﬂux on the bottom surface from the simulation. The
red line shows the accumulated magnetic energy from directly the
observation data, i.e., the same one shown in Figure 4.

the speed of photospheric ﬂows is often a few 100 m s−1. So
in our model settings, the evolution speed of the boundary
ﬁeld, even enhanced by a factor of 68.6, is still smaller by
two orders of magnitude than the coronal Alfv´en speed (on
the order of 103 km s−1), and the quick reaction of the coro-
nal ﬁeld to the slow bottom changes should not be affected.
The implementation of the bottom boundary conditions is the
same as that for the deeper relaxation phase described in Sec-
tion 3. That is, on the bottom surface, we solved the equa-
tion (5) to update all the three components of magnetic ﬁeld
with the ﬂow ﬁeld prescribed by those derived in Section 4,
while the plasma density and temperature are simply ﬁxed. In
the driven-evolution phase, the kinetic viscosity is also used
as the smaller one ν = 0.05∆x2/∆t, which corresponds to
a Reynolds number of 10 for the length of a grid cell ∆x.

We show an approximately two-day (a duration of 26 ts
or 52 hours in reality) evolution of the MHD system as
an example, while the further evolution associated with an
eruption and the physical mechanisms will be left for fu-
ture study. Figure 6 presents the global energy evolutions.
It can be seen the magnetic energy (the black line in the
top panel) increases monotonously as driven by the surface
ﬂows. By the end of our simulation, it reaches approx-
imately 1.8 times of the initial potential energy, and thus
the total magnetic energy obtained in this driving phase is
(1.8 − 1.4) × E0 ≈ 4.8 × 1032 erg. On the other hand, the
kinetic energy (bottom panel of Figure 6) keeps below the
level of 1 × 10−3E0 with a mild increase, which indicates
that the system remains a stable, quasi-static evolution. In
the top panel of Figure 6 we also plots the time integration
of total Poynting ﬂux (the blue line), using the magnetic ﬁeld
and the ﬂow ﬁeld on the bottom boundary of the simulation,

which is the energy injected into the volume from the bottom
boundary through the surface ﬂow. If our boundary condi-
tion is accurately implemented, the energy injected from the
bottom surface should match the magnetic energy obtained in
the computational volume, since other energies are negligible
if compared with the magnetic energy. As can be seen, the
trend of magnetic energy evolution (the black line) matches
rather well that of the energy input by the surface ﬂow (the
blue line), albeit a small numerical error that increases slowly
the total magnetic energy, which is also seen in the relaxation
phase as shown in Figure 2. It is worthy noting that the mag-
netic energy evolution is also in good agreement with the ac-
cumulated magnetic energy as derived from directly the ob-
servation data (the red line, which is the same value shown
in Figure 4 but multiplied by a factor of 0.052 because the
ﬁeld input to the model is multiplied by 0.05) as calculated in
Section 4, which suggests that our data-driven model can reli-
ably reproduce the magnetic energy injection into the corona
through the photospheric motions. The small difference be-
tween the observation-derived and simulated energies might
be due to the smoothing of the velocity since it ﬁlters out the
small-scale ﬂows that also contribute to the total Poynting
ﬂux.

Figure 7 (and its attached animation) shows the 3D mag-
netic ﬁeld lines and their evolution in comparison with
SDO/AIA image of coronal loops in the 94 ˚A wavelength
which highlights the hot, core coronal loops in the AR. Over-
all, we can see a slow stressing of the ﬁeld lines mainly
through the sunspot rotational ﬂow. It renders the core ﬁeld
lines to form a more and more coherent S shape, which re-
sembles the observed sigmoid structure in the core of the AR.
The increase of non-potentiality can also be seen from the in-
crease of the force-free factor α in the core region. Figure 8
shows evolution of the surface magnetic ﬂux distribution (see
also the animation attached to Figure 7). The four snapshots
are taken for the same times given in Figure 5, and thus com-
paring Figure 8 with Figure 5 shows the difference between
the simulated magnetograms and the observed ones. In ad-
dition to the rotation of the main sunspot, an evident feature
is the enhancement of the ﬁeld strength along the PIL. This
is owing to the divergence ﬂow from the edge of the sunspot,
which continually convect the magnetic ﬂux to the PIL. Such
pileup of magnetic ﬂux near the PIL, however, is not seen in
the observed magnetograms (Figure 5), which rather show
ﬁeld decaying. Such decaying of magnetic ﬂux is likely
due to the global turbulent diffusion of photospheric mag-
netic ﬁeld by granular and supergranular convection (Wang
et al. 1989) and other small-scale turbulence and ﬂux cancel-
lations in the photosphere, which is not being recovered by
the DAVE4VM code and thus not reproduced in our simula-
tion.

6. CONCLUSIONS

      1.41.51.61.71.8EM/E00510152025Time (ts)0.00.20.40.60.81.0EK/E0 × 1039

Figure 7. Evolution of the magnetic ﬁeld lines (shown in different view angles in the left and middle columns) and their comparison with
observed coronal loops observed in EUV wavelength of 94 ˚A by SDO/AIA (right column). The ﬁeld lines are shown in the same format in
Figure 3. An animation of the magnetic ﬁeld evolution is attached for this ﬁgure.

2014-09-08 04:00 UT2014-09-08 04:00 UT2014-09-08 20:00 UT2014-09-08 20:00 UT2014-09-09 12:00 UT2014-09-09 12:00 UT2014-09-10 04:00 UT2014-09-10 04:00 UT10

Figure 8. Evolution of magnetic ﬂux distribution on the bottom sur-
face in the simulation, shown for 4 snapshots of the same times
shown in Figure 5.

This paper is devoted to the description of a new approach
of data-driven modelling of solar AR magnetic ﬁeld evolu-
tion, in which, we have for the ﬁrst time utilized directly
the photospheric velocity ﬁeld from DAVE4VM to drive a
full-MHD model. To setup the initial conditions, we used a
special MHD relaxation approach with sufﬁciently small ki-
netic viscosity to construct a true MHD equilibrium based on
a single vector magnetogram. Then we derived the photo-
spheric surface ﬂows from a time series of observed magen-
tograms based on the DAVE4VM method. The surface ﬂows
were ﬁnally inputted, again in time sequence, to the bottom
boundary of the MHD model to self-consistently update the
magnetic ﬁeld at every time step, which is implemented by
solving directly the magnetic induction equation at the bot-
tom boundary using ﬁnite difference method.

We applied this data-driven model to study the magnetic
ﬁeld evolution of AR 12158 with SDO/HMI vector magne-
tograms. The initial MHD equilibrium is calculated using
magnetogram observed for 00:00 UT on 2014 September 8,
and a two-day duration of the AR evolution is then simulated
using the data-driven MHD model. Overall, the evolution
is characterized by a slow stress of the ﬁeld lines mainly
through the rotational ﬂow of the AR’s leading sunspot,
which makes the core ﬁeld lines to forms an coherent S shape
consistent with the sigmoid structure as seen in the AIA im-
ages. Such evolution proceeds in a quasi-static way since
the kinetic energy of the system remains less than its mag-
netic energy by three orders of magnitude, while the mag-
netic energy increases monotonously as driven by the surface
ﬂow, and reaches approximately double of the initial poten-

tial energy by the end of the simulation. The magnetic energy
obtained in the simulation during the surface driving phase
matches closely the accumulated magnetic energy as calcu-
lated directly from the original vector magnetogram with the
DAVE4VM derived ﬂow ﬁeld.

With the surface ﬂow speciﬁed at the bottom boundary, the
magnetic ﬁeld can be updated self-consistently by solving
the induction equation at the surface boundary. However, our
simulation shows that discrepancy arises between the sim-
ulated magnetic ﬁeld at the bottom surface with the origi-
nal magnetograms. That is, in the simulation, magnetic ﬂux
are signiﬁcantly enhanced along the PIL, owing to the di-
vergence ﬂow from the edge of the sunspot, whereas in the
observed magnetograms such pileup of magnetic ﬂux near
the PIL is not seen, which rather shows ﬁeld decaying. In the
next step, we will try to use some ad-hoc ﬂux cancellation
near the PIL, for which a straightforward way is to increase
the value of ηstable in equation (5), such that the ﬂux diffu-
sion speed is comparable to that of the ﬂux pileup. In the
future, we will consider to include the global diffusion of
photospheric magnetic ﬁeld by granular and supergranular
convection to simulate more realistically the magnetic ﬁeld
evolution. On the other hand, the discrepancy might result
from errors in the vector magnetograms, since these errors
can introduce spurious ﬂows with the DAVE4VM code and
thus inﬂuences our simulation. To elucidate this, we will test
our model with error-free magnetograms from recent convec-
tive ﬂux-emergence simulations (e.g., Chen et al. 2017; Che-
ung et al. 2019; Toriumi & Hotta 2019) as the ground-truth
data.

Our ultimate purpose is to use the model to study how
the coronal ﬁeld, as driven by the slow photospheric mo-
tions, reaches a unstable state and runs into eruption. From
this, we will be able to investigate in details the topology of
the evolving magnetic ﬁeld leading to the eruption, to see
whether it forms a magnetic ﬂux rope and becomes ideally
unstable (e.g., Kliem & T¨or¨ok 2006; Aulanier et al. 2010),
or, a simply sheared arcade with a interally-formed current
sheet to trigger ﬂare reconnection (Moore et al. 2001), which
would be helpful for resolving the long-standing debates on
the triggering mechanism of solar eruptions (Chen 2011).

for

41574170,

41531073),

This work is

the Central Universities

jointly supported by National Natu-
ral Science Foundation of China (NSFC 41822404,
the Fundamental
41731067,
Research Funds
(Grant
No.HIT.BRETIV.201901) and Shenzhen Technology Project
JCYJ20190806142609035. Data from observations are
courtesy of NASA SDO. The computational work was
carried out on TianHe-1(A), National Supercomputer Center
in Tianjin, China. We are grateful to the reviewers for
helping to improve the paper.

Aulanier, G., T¨or¨ok, T., D´emoulin, P., & DeLuca, E. E. 2010, ApJ, 708, 314
Chen, F., Rempel, M., & Fan, Y. 2017, ApJ, 846, 149
Chen, P. F. 2011, Living Reviews in Solar Physics, 8, 1
Cheung, M. C. M. & DeRosa, M. L. 2012, The Astrophysical Journal, 757,

Liu, C., Deng, N., Lee, J., Wiegelmann, T., Jiang, C., Dennis, B., Su, Y.,

Donea, A., & Wang, H. 2014, ApJ, 795, 128
Liu, Y., Zhao, J., & Schuck, P. W. 2012, SoPh, 195
Moore, R. L., Sterling, A. C., Hudson, H. S., & Lemen, J. R. 2001, ApJ,

147

552, 833

REFERENCES

11

Cheung, M. C. M., Rempel, M., Chintzoglou, G., Chen, F., Testa, P.,

Mart´ınez-Sykora, J., Sainz Dalda, A., DeRosa, M. L., Malanushenko, A.,
Hansteen, V., De Pontieu, B., Carlsson, M., Gudiksen, B., & McIntosh,
S. W. 2019, Nature Astronomy, 3, 160

Duan, A., Jiang, C., He, W., Feng, X., Zou, P., & Cui, J. 2019, The

Astrophysical Journal, 884, 73

Duan, A., Jiang, C., Hu, Q., Zhang, H., Gary, G. A., Wu, S. T., & Cao, J.

2017, The Astrophysical Journal, 842, 119

Feng, X., Jiang, C., Xiang, C., Zhao, X., & Wu, S. T. 2012, The

Astrophysical Journal, 758, 62

Guo, Y., Xia, C., Keppens, R., Ding, M. D., & Chen, P. F. 2019, The

Astrophysical Journal, 870, L21
Hayashi, K. 2005, ApJS, 161, 480
Hayashi, K., Feng, X., Xiong, M., & Jiang, C. 2019, The Astrophysical

Journal, 871, L28

Inoue, S. 2016, Progress in Earth and Planetary Science, 3, 19
Inoue, S., Kusano, K., B¨uchner, J., & Sk´ala, J. 2018, Nature

communications, 9, 174

Jiang, C. & Feng, X. 2013, ApJ, 769, 144
—. 2014, SoPh, 289, 63
Jiang, C. & Toriumi, S. 2020, The Astrophysical Journal, 903, 11
Jiang, C., Wu, S. T., Yurchyshyn, V. B., Wang, H., Feng, X., & Hu, Q.

2016, ApJ, 828, 62

Jiang, C. W., Feng, X. S., Zhang, J., & Zhong, D. K. 2010, SoPh, 267, 463
Jiang, C. W., Wu, S. T., Feng, X. S., & Hu, Q. 2016, Nature Comm., 7,

11522

Kliem, B. & T¨or¨ok, T. 2006, Physical Review Letters, 96, 255002
Leake, J. E., Linton, M. G., & Schuck, P. W. 2017, The Astrophysical

Journal, 838, 113, arXiv: 1702.06808

Lee, H. & Magara, T. 2018, The Astrophysical Journal, 859, 132

Nakagawa, Y. 1980, ApJ, 240, 275
Nakagawa, Y., Hu, Y. Q., & Wu, S. T. 1987, A&A, 179, 354
Pomoell, J., Lumme, E., & Kilpua, E. 2019, Solar Physics, 294, 41
Priest, E. R. & Forbes, T. G. 2002, A&A Rv, 10, 313
Schrijver, C. J., DeRosa, M. L., Metcalf, T., Barnes, G., Lites, B., Tarbell,
T., McTiernan, J., Valori, G., Wiegelmann, T., Wheatland, M. S., Amari,
T., Aulanier, G., D´emoulin, P., Fuhrmann, M., Kusano, K., R´egnier, S.,
& Thalmann, J. K. 2008, ApJ, 675, 1637

Schuck, P. W. 2008, The Astrophysical Journal, 683, 1134
Sun, X., Hoeksema, J. T., Liu, Y., Wiegelmann, T., Hayashi, K., Chen, Q.,

& Thalmann, J. 2012, ApJ, 748, 77

Toriumi, S. & Hotta, H. 2019, The Astrophysical Journal, 886, L21
Toriumi, S., Takasao, S., Cheung, M. C. M., Jiang, C., Guo, Y., Hayashi,

K., & Inoue, S. 2020, The Astrophysical Journal, 890, 103

Toriumi, S. & Wang, H. 2019, Living Reviews in Solar Physics, 16, 3
Vemareddy, P., Cheng, X., & Ravindra, B. 2016, The Astrophysical

Journal, 829, 24

Wang, Y., Nash, A. G., & Sheeley, Jr., N. R. 1989, Science, 245, 712
Wiegelmann, T. 2004, SoPh, 219, 87
Wiegelmann, T. & Sakurai, T. 2012, Living Reviews in Solar Physics, 9, 5
Wu, S. T., Wang, A. H., Liu, Y., & Hoeksema, J. T. 2006, ApJ, 652, 800
Wu, S. T. & Wang, J. F. 1987, Computer Methods in Applied Mechanics

and Engineering, 64, 267

Yang, W. H., Sturrock, P. A., & Antiochos, S. K. 1986, ApJ, 309, 383

Zhao, J., Gilchrist, S. A., Aulanier, G., Schmieder, B., Pariat, E., & Li, H.

2016, The Astrophysical Journal, 823, 62, arXiv: 1603.07563

Zhou, G. P., Zhang, J., & Wang, J. X. 2016, The Astrophysical Journal,

823, L19

