7
1
0
2

v
o
N
0
2

]
h
c
e
m

-
t
a
t
s
.
t
a
m
-
d
n
o
c
[

4
v
1
8
3
1
0
.

6
0
7
1
:
v
i
X
r
a

Accurate thermal conductivities from optimally short
molecular dynamics simulations

Loris Ercole1, Aris Marcolongo2, and Stefano Baroni1,*

1SISSA – Scuola Internazionale Superiore di Studi Avanzati, via Bonomea 265, 34136 Trieste, Italy
2Theory and Simulations of Materials (THEOS) and National Centre for Computational Design and Discovery of
Novel Materials (MARVEL), ´Ecole Polytechnique F ´ed ´erale de Lausanne, 1015 Lausanne, Switzerland
*baroni@sissa.it

ABSTRACT

The evaluation of transport coefﬁcients in extended systems, such as thermal conductivity or shear viscosity, is known to require
impractically long simulations, thus calling for a paradigm shift that would allow to deploy state-of-the-art quantum simulation
methods. We introduce a new method to compute these coefﬁcients from optimally short molecular dynamics simulations,
based on the Green-Kubo theory of linear response and the cepstral analysis of time series. Information from the full sample
power spectrum of the relevant current for a single and relatively short trajectory is leveraged to evaluate and optimally reduce
the noise affecting its zero-frequency value, whose expectation is proportional to the corresponding conductivity. Our method is
unbiased and consistent, in that both the resulting bias and statistical error can be made arbitrarily small in the long-time limit.
A simple data-analysis protocol is proposed and validated with the calculation of thermal conductivities in the paradigmatic
cases of elemental and molecular ﬂuids (liquid Ar and H2O) and of crystalline and glassy solids (MgO and a-SiO2). We ﬁnd
that simulation times of one to a few hundred picoseconds are sufﬁcient in these systems to achieve an accuracy of the order
of 10% on the estimated thermal conductivities.

1 Introduction

Our microscopic understanding of heat and mass transport in extended systems is rooted in the Green-Kubo (GK) theory of
linear response,1, 2 as applied to the Navier-Stokes equations for the densities of the conserved extensive variables,3, 4 which
include energy, momentum, and the particle numbers for each molecular species. Transport coefﬁcients are determined by the
equilibrium ﬂuctuations of the relevant currents and are in fact proportional to their autocorrelation times. Notwithstanding
its beauty, rigor, and broad scope, the practical implementation of the GK theory is known to require very long molecular
dynamics (MD) simulations, much longer in fact than the current autocorrelation times one is required to evaluate.5–9 Even
though a number of expedients have been devised to cope with this problem,7, 9, 10 none of them is fully satisfactory in that in
some cases they fail to provide rigorous criteria to estimate the accuracy resulting from a given MD trajectory, and in all cases
the length of the required simulations is unaffordable with accurate but expensive quantum simulation techniques.11

It has long been believed that the GK theory of heat transport could not be combined with modern simulation methods
based on electronic-structure theory because energy densities and currents are inherently ill-deﬁned at the quantum-mechanical
level.12 This misconception has been recently challenged by a couple of papers showing that, while energy densities and currents
are actually ill-deﬁned classically no less than they are quantum-mechanically, the heat conductivity resulting from the GK
formula is indeed well deﬁned by virtue of a kind of gauge invariance stemming from energy extensivity and conservation.13, 14
This ﬁnding spurred a renewed interest in the quantum simulation of thermal conduction,11, 15 and made it urgent to devise a
data-analysis technique to make these simulations affordable, thus paving the way to the ab initio simulation of heat transport.
In this paper we propose a data-analysis protocol leading to an asymptotically unbiased and consistent estimate of transport
coefﬁcients (i.e. the bias and the statistical error can be made both arbitrarily small in the limit of long simulation times) and
requiring shorter simulations than used so far. This protocol avoids any ad-hoc ﬁtting procedure and naturally provides an
accurate estimate of the statistical error, thus lending itself to an easy implementation and automated use. While motivated
by heat transport applications, our approach naturally applies to any other transport properties that can be expressed, in a GK
framework, in terms of time integrals of suitable autocorrelation functions, such as, e.g., ionic conductivities, viscosities, and
tracer diffusivity, to name but a few. We test our procedure in the speciﬁc case of heat transport and we ﬁnd that simulation
times of one to a few hundred picoseconds are sufﬁcient to achieve an accuracy of the order of 10% on the estimated thermal
conductivities in a wide range of systems at typical physical conditions. In Sec. 2 we present the general theory of our approach;
in Sec. 3 we validate it with extensive benchmarks performed on the calculation of thermal conductivities in the paradigmatic
cases of elemental and molecular ﬂuids (liquid Ar and H2O) and of crystalline and glassy solids (MgO and a-SiO2). Sec. 4

1

 
 
 
 
 
 
ﬁnally contains our conclusions.

2 Theory

Heat transport in insulators is determined by the dynamics of atoms, the electrons following adiabatically in their ground state,
and the GK theory of linear response1, 2 allows one to derive the thermal conductivity from an analysis of equilibrium, possibly
ab initio, MD trajectories. According to this theory, the thermal conductivity of a macroscopic and isotropic system is given by:

κ =

1
V kBT 2

(cid:90) ∞

0

(cid:104) ˆJ(t) ˆJ(0)(cid:105) dt,

(1)

where V and T are the system volume and temperature, ˆJ is one Cartesian component of the macroscopic heat ﬂux,14, 16 kB is
the Boltzmann constant, and the brackets (cid:104)·(cid:105) indicate ensemble averages over initial conditions. Here and in the following
a caret, as in “ ˆJ”, denotes a realization of a random variable, whereas properties of the underlying stochastic process, such
as time correlation functions, are indicated without carets. According to Eq. (1), the heat conductivity is proportional to the
zero-frequency component of the power spectrum (aka the power spectral density) of the heat ﬂux: κ = 1

2V kBT 2 S( f = 0),

S( f ) =

(cid:90) ∞

−∞

e−i2π f t G(t) dt,

(2)

where G(t) = (cid:104) ˆJ(t) ˆJ(0)(cid:105) is the equilibrium time-correlation function of the heat-ﬂux process.

In practice, MD gives access to a discrete sample of the process, ˆJn = ˆJ(nε), where 0 ≤ n ≤ N − 1, ε is the sampling period
of the current, and N the length of the time series, that we assume to be even. The Wiener-Khintchine theorem17, 18 states
that, for large N, the power spectrum of the heat-ﬂux process evaluated at fk = k
Nε is proportional to the expected value of the
squared modulus of the discrete Fourier transform of the corresponding time series:

S( fk) = (cid:104) ˆSk(cid:105),
(cid:12)
ˆSk =
(cid:12) ˆFk

(cid:12)
2 ,
(cid:12)

ε
N
N−1
∑
n=0

ˆFk =

e−2πi kn

N ˆJn,

(3)

(4)

(5)

for 0 ≤ k ≤ N − 1. The sample spectrum ˆSk is thus an estimator of the power spectrum of the process; in the statistics literature
N−k and ˆSk = ˆSN−k, so that periodograms
it is usually referred to as the periodogram. The reality of the ˆJ’s implies that ˆFk = ˆF ∗
are usually reported for 0 ≤ k ≤ N

2 and their Fourier transforms evaluated as discrete cosine transforms.

The heat ﬂux is an extensive quantity whose density autocorrelations are usually short-ranged. In the thermodynamic limit
it can therefore be seen as the sum of (almost) independent identically distributed stochastic variables, so that, according to the
central-limit theorem, its equilibrium distribution is Gaussian. A slight generalization of this argument allows us to conclude
that the heat-ﬂux process is Gaussian as well. The heat-ﬂux time series is in fact a multivariate stochastic variable that, in the
thermodynamic limit, results from the sum of (almost) independent variables, thus tending to a multivariate normal deviate.
This implies that at equilibrium the real and imaginary parts of the ˆFk’s deﬁned in Eq. (5) are zero-mean normal deviates that,
in the large-N limit, are uncorrelated among themselves and have variances proportional to the power spectrum evaluated at fk.
For k = 0 or k = N
2ε S( fk). We conclude that in
the large-N limit the sample spectrum of the heat-ﬂux time series reads:

(cid:9), var(Re ˆFk) = var(Im ˆFk) = N

2 , ˆFk is real and var( ˆFk) = N

ε S( fk); for k /∈ (cid:8)0, N

2

ˆSk = S ( fk) ˆξk,

(6)

where the ˆξ ’s are independent random variables distributed as a χ 2
2 variate,
otherwise. For the sake of simplicity, we make as though all the ˆξk’s were identically distributed as one half a χ 2
2 variate for all
values of k, thus making an error of order O(1/N), which vanishes in the long-time limit that is being assumed in most of the
arguments presented in this paper. In many cases of practical interest, multiple time series are available to estimate the power
spectrum of a process. For instance, in equilibrium MD, a same trajectory delivers one independent time series per Cartesian

1 variate for k = 0 or k = N

2 and as one half a χ 2

2/12

component of the heat ﬂux, all of which are obviously equivalent in isotropic systems. In these cases it is expedient to deﬁne a
mean sample spectrum by averaging over (cid:96) different realizations:

(cid:96) ˆSk =

1
(cid:96)

(cid:96)
∑
i=1

ˆSi
k,

(7)

where the index “i” enumerates the realizations. For k /∈ {0, N
distributed as in Eq. (6), with the ˆξ ’s being χ 2

2(cid:96) variates, divided by the number of degrees of freedom:

2 } the ordinates of the mean sample spectrum are therefore

(cid:96) ˆξk ∼

1
2(cid:96)

χ 2
2(cid:96).

(8)

Eq. (6) brings both good and bad news. The good news is, the expectation of the periodogram of the time series is the power
spectrum of the process, i.e. the former is an unbiased estimator of the latter. The bad news is, this estimator is not consistent,
i.e. its variance does not vanish in the large-N limit. This is so because a longer time series increases the number of discrete
frequencies at which the power spectrum is sampled, rather than its accuracy at any one of them. A consistent estimate of the
zero-frequency value of the power spectrum (or the value at any other frequency, for that matter) can be obtained by segmenting
a time series into several blocks of equal length and then averaging over the sample spectra computed for each of them. When
the length of the trajectory grows large, so does the number of blocks, thus making the variance of the average arbitrarily small.
In practice, the determination of the optimal block size is a unwieldy process that leads to an inefﬁcient determination of the
length of the trajectory needed to achieve a given overall accuracy. We adopt a different approach that allows us to obtain a
consistent estimate of the zero-frequency value of the power spectrum from the statistical analysis of a single trajectory sample
(i.e. no block analysis is needed) and such that the estimate of the trajectory length necessary to achieve a given accuracy is
optimal.

Spectral density estimation from ﬁnite empirical time series is the subject of a vast literature in the statistical sciences,
embracing both parametric and non-parametric methods.19 In the following we propose a semi-parametric method to estimate
the power spectrum of a stochastic process, based on a Fourier representation of the logarithm of its power spectrum (the
“log-spectrum”). The advantage of dealing with the log-spectrum, instead of with the power spectrum itself, is twofold. First
and foremost, the noise affecting the former is additive, instead of multiplicative, thus making it simple and expedient to apply
linear ﬁlters: limiting the number of components of the Fourier representation of the log-spectrum acts as a low-pass ﬁlter that
systematically reduces the power of the noise and yields a consistent estimator of the log-spectrum at any given frequency.
Second, as a bonus, the logarithm is usually smoother than its argument. Therefore, the Fourier representation of the logarithm
of the power spectrum is more parsimonious than that of the spectrum itself.

Let (cid:96) ˆLk = log((cid:96) ˆSk) be the “sample log-spectrum” of our time series. By taking the logarithm of Eq. (6), (cid:96) ˆLk can be expressed

as:

where

(cid:96) ˆLk = log (S( fk)) + log

(cid:17)

(cid:16)(cid:96) ˆξk

= log (S( fk)) + λ(cid:96) + (cid:96) ˆλ k,

λ(cid:96) =

(cid:90) ∞

0

log

(cid:19)

(cid:18) ξ
2(cid:96)

Pχ 2

2(cid:96)

(ξ ) dξ = ψ((cid:96)) − log((cid:96))

(9)

(10)

is the probability density of a

is the expected value of the logarithm of the (cid:96) ˆξ stochastic variables deﬁned in Eq. (8), Pχ 2
2(cid:96) variate, (cid:96) ˆλk = log
χ 2
digamma function.20 The variance of the (cid:96) ˆλ variables is:

(cid:16)(cid:96) ˆξk

(cid:17)

2(cid:96)

− λ(cid:96) are zero-mean identically distributed independent stochastic variables, and ψ(z) and is the

σ 2
(cid:96) =

(cid:90) ∞

0

log

(cid:19)2

(cid:18) ξ
2(cid:96)

Pχ 2

2(cid:96)

(ξ ) dξ − λ 2

(cid:96) = ψ (cid:48)((cid:96)),

where ψ (cid:48)(z) is the tri-gamma function.20

(11)

3/12

Eq. (9) explicitly shows that the sample log-spectrum of a time series is equal to the logarithm of the power spectrum one
wishes to evaluate (modulo a constant), plus a (non-Gaussian) white noise. In order to eliminate the high-frequency components
of the noise, and thus reduce its total power, we deﬁne the “cepstrum” of the time series as the inverse Fourier transform of its
sample log-spectrum:21

(cid:96) ˆCn =

1
N

N−1
∑
k=0

(cid:96) ˆLke2πi kn
N ,

(12)

and its coefﬁcients as the cepstral coefﬁcients. According to a generalized central-limit theorem for Fourier transforms of
stationary time series,22 in the large-N limit, the (inverse) Fourier transform of the (cid:96) ˆλ ’s, appearing in Eq. (9) and implicitly in
Eq. (12), is a set of independent (almost) identically distributed zero-mean normal deviates. It follows that:

(cid:96) ˆCn = λ(cid:96)δn0 +Cn + (cid:96) ˆµ n,
N−1
∑
k=0

Cn =

1
N

log(cid:0)S( fk)(cid:1)e2πi kn
N ,

(13)

(14)

where (cid:96) ˆµn are independent zero-mean normal deviates with variances (cid:10)(cid:96) ˆµ 2
(cid:96) otherwise.
This result can be easily checked explicitly by using the deﬁnition of the discrete Fourier transform; the non-trivial extra
information provided by the central-limit theorem is the asymptotic independence and normality of the (cid:96) ˆµ’s. Similarly to the
sample power spectrum, the cepstral coefﬁcients are real, periodic, and even: ˆCn = ˆCN−n. If the log-spectrum, log(cid:0)S( fk)(cid:1), is
smooth enough, the number of non-negligible Cn coefﬁcients in Eq. (14) is much smaller than N. Let us indicate with P∗ the
smallest integer such that Cn ≈ 0 for P∗ ≤ n ≤ N − P∗, and let us restrict the discrete Fourier transform of the cepstrum deﬁned
in Eq. (12) to n < P∗ or n > N − P∗. The k = 0 component of this restricted Fourier transform reads:

(cid:96) for n /∈ (cid:8)0, N

(cid:9) and (cid:10)(cid:96) ˆµ 2
n

(cid:11) = 1

(cid:11) = 2

N σ 2

N σ 2

2

n

(cid:96) ˆL∗

0 = (cid:96) ˆC0 + 2

P∗−1
∑
n=1

(cid:96) ˆCn

= λ(cid:96) + log(S0) + (cid:96) ˆµ0 + 2

P∗−1
∑
n=1

(cid:96) ˆµn.

We conclude that (cid:96) ˆL∗

0 is a normal deviate with expectation and variance

(cid:104)(cid:96) ˆL∗

0(cid:105) ≡ L∗

(cid:96) = log(S0) + λ(cid:96),

(cid:96) (P∗, N)2 = σ 2
σ ∗
(cid:96)

4P∗ − 2
N

.

(15)

(16)

(17)

(18)

Eqs. (17) and (18) are the main results of our method: they show how the logarithm of the transport coefﬁcient can be estimated
from the (inverse) Fourier coefﬁcients of the sample log-spectrum, Eq. (17), and how the resulting statistical error only depends
on the number of Fourier coefﬁcients retained and the total simulation length, Eq. (18).

tends to zero in the large-N limit, and (cid:96) ˆL∗

The value of P∗ is a property of the stochastic process underlying the time series, and is therefore independent of N: for
any given value of P∗ the variance σ ∗2
0 − λ(cid:96) is thus a consistent estimator of log(S0).
(cid:96)
Notice that the absolute error on L∗
(cid:96) directly and nicely yields the relative error on S0, which is proportional to the transport
coefﬁcient we are looking for. In general, all the cepstral coefﬁcients are different from zero and assuming that many of them
actually vanish introduces a bias. The optimal value of P∗ is the one for which the bias, which is a decreasing function of it, is
of the order of the statistical error, which instead increases with P∗. Its choice is the subject of model selection theory, another
vast chapter in the statistical sciences.23 Among the several tests that have been devised to perform this task, we choose the
optimization of the Akaike’s information criterion (AIC),23, 24 as described below.

Given a model depending on P parameters, θ = {θ1, θ2, · · · θP}, the AIC is a sample statistic deﬁned as

AIC(P) = −2 max

θ

log L (θ , P) + 2P,

(19)

4/12

where L (θ , P) is the likelihood of the parameters. The optimal number of parameters is then determined as the argument of
the AIC minimum:

P∗
A ≡ arg min
P

AIC(P).

(20)

In the present case the parameters of the model are the P coefﬁcients C = {C0,C1, · · ·CP−1} as deﬁned in Eq. (14), and the
log-likelihood reads, up to additive terms independent of P and C:

2 log L (C, P) = −

N
2σ 2
(cid:96)

(cid:0)C0 + λ(cid:96) − ˆC0

(cid:1)2

−

N
σ 2
(cid:96)

P−1
∑
n=1

(cid:0)Cn − ˆCn

(cid:1)2

−

N
2

∑
n=P

N
σ 2
(cid:96)

ˆC2
n.

(21)

Evidently, the above expression is maximized, for given P, by Cn = ˆCn − δn0λ(cid:96) for n = 0, 1, · · · P − 1, and the corresponding
value of the maximum is: 2 maxC log L (C, P) = − N
σ 2
(cid:96)

n. We conclude that the value of the AIC is:

N
2
n=P

ˆC2

∑

AIC(P) =

N
2

∑
n=P

N
σ 2
(cid:96)

ˆC2

n + 2P.

(22)

The value of P that minimizes this expression is the optimal number of parameters in the Akaike sense, P∗
(20).

A, as deﬁned in Eq.

The maximum frequency available for spectral/cepstral analysis is the Nyqvist frequency,25 determined by the sampling
period ε as fNy = 1
2ε . Transport coefﬁcients only depend on the low-frequency behavior of the spectrum, which is independent
of ε, as long as the latter is small enough as to avoid aliasing effects. For this reason it may prove convenient to eliminate the
high-frequency portion of the spectrum ( f > f ∗) by applying a low-pass ﬁlter to the time series (e.g. a moving average26)
and then resample the latter with a sampling period ε ∗ = 1
time steps. The
optimal number of cepstral coefﬁcients resulting from Eqs. (20) and (22), as well as the error in the estimate of the transport
coefﬁcients resulting from Eq. (18), depends in general on the choice of the cutoff frequency, f ∗. The smaller f ∗, the smaller
will presumably be the number of cepstral coefﬁcients necessary to describe the log-spectrum to any given accuracy over such
a shorter frequency range. However, the shorter length of the ﬁltered time series, N∗, results in an increased variance of the
estimator (cid:96) ˆL∗
0 deﬁned in Eq. (15), according to Eq. (18). Numerical experiments performed on the MD data reported in Sec.
3 show that both the estimated value of (cid:96) ˆL∗
0 and its variance are actually fairly insensitive to the value chosen for the cutoff
frequency, f ∗, provided that the power spectrum of the re-sampled time series faithfully features the ﬁrst band of the original
spectrum (i.e. the ﬁrst prominent feature) and that this band is not too peaked at the origin.

2 f ∗ , thus resulting in a time series of N∗ = N f ∗
fNy

Data analysis based on the theory presented above is straightforward. Given a current time series from a MD trajectory, the
sample spectrum (cid:96) ˆSk is ﬁrst determined from Eqs. (4), (5), and (7) and smoothed out using e.g. a moving average26 performed
over a narrow frequency window, so as to reduce the statistical noise to a level where the shape of the power spectrum of the
underlying process can be appreciated. A cutoff frequency, f ∗, is then determined so as to encompass the ﬁrst band of the
smoothed power spectrum. The cepstrum (cid:96) ˆCn is computed by Fourier analyzing the logarithm of the sample spectrum up the
cutoff frequency thus estimated, as in Eq. (12), and the optimal number of cepstral coefﬁcients is determined using Eqs. (20)
and (22). The logarithm of the zero-frequency value of the power spectrum is ﬁnally estimated from Eqs. (15) and (17) as
(cid:96) ˆL∗

0 − λ(cid:96), and its variance from Eq. (18).
Mind the difference between the moving average performed in the frequency domain to smooth out the power spectrum and
that performed in the time domain, as suggested before, and acting as a low-pass ﬁlter. Spectral smoothing using a moving
average in the frequency domain is common practice in the analysis of time series, and it actually provides a consistent estimator
of the power spectrum. In fact, the number of frequencies falling within a window of given width increases linearly with the
length of the series, so that the variance of the average decreases as the inverse of the product of the length of the series times
the width of the window. The resulting spectral estimate is however biased by the variation of the signal within the window,
thus strongly reducing the width of the windows that can be afforded. Moreover, both the bias and the statistical error are
difﬁcult to estimate, due to the multiplicative nature of the noise; therefore neither the plain periodogram nor a running average
thereof are adequate for a quantitative estimate of the zero-frequency value of the power spectrum, which is proportional to the
transport coefﬁcient we are looking for.

5/12

3 Applications and benchmarks

In order to benchmark the methodology described above, we have applied it to the calculation of the thermal conductivity in
four systems representative of different classes of materials, spanning from elemental and molecular ﬂuids (Ar and H2O) to
crystalline and glassy solids (MgO and a-SiO2). Classical MD simulations were run using the LAMMPS package27 with the
setup described below. For liquid Ar we used a Lennard Jones potential as described in Ref. 28 at a temperature T ≈ 220 K
and density ρ = 1.55 g/cm3, in a cubic supercell containing 864 atoms, with a time step ∆t = 4 fs. For liquid H2O we used
a ﬂexible model as in Ref. 29 at a temperature T ≈ 300 K and density ρ = 1.0 g/cm3, in a cubic supercell containing 180
molecules, with a time step ∆t = 0.5 fs. For crystalline (FCC) MgO we used a Buckingham-plus-Coulomb potential as in Ref.
30 at a temperature T ≈ 1000 K and density ρ = 3.61 g/cm3, in a 4 × 4 × 4 simple cubic conventional supercell with 512 atoms,
and a time step ∆t = 0.3 fs. For a-SiO2 we used the potential proposed by van Beest, Kramer, and van Santen31 as implemented
by Shcheblanov et al.,32 at a temperature T ≈ 1000 K and density ρ = 2.29 g/cm3, in a supercell containing 216 atoms with a
time step ∆t = 1 fs. The glass model was obtained from a quench from the melt (T ≈ 6500 K) at a constant quenching rate of
5.5 × 1012 K/s. Each system was equilibrated in the NVT ensemble at the target temperature for several hundred picoseconds;
data were then collected in the NVE ensemble for trajectories whose length was chosen so as to represent realistic simulation
runs that could be afforded using ab initio MD (T = 100 ps for Ar, H2O, and a-SiO2, and T = 500 ps for MgO). In order to
compare our estimates of the transport coefﬁcients and their statistical errors with reliable and statistically signiﬁcant reference
data, in all cases we ran much longer (≈ 50 ns) simulations. This allowed us to compare our predicted conductivities with
accurate values estimated from the direct integration of the time auto-correlation function in Eq. (1), as obtained from a block
average33 performed over the long trajectory. In addition, we could collect abundant statistics of our estimator for the transport
coefﬁcients, Eq. (15), and validate its normal distribution speciﬁed by Eqs. (17), (18).

Figure 1. Sample power spectra of the heat ﬂux computed from MD trajectories for Ar, H2O, a-SiO2 (100 ps) and MgO (500 ps) (gray
line, see text). The solid lines in color correspond to a moving average performed over a narrow frequency window. The vertical arrows
indicate the cutoff frequencies, f ∗, used for the subsequent cepstral analysis (see text). The inset in the MgO panel is a magniﬁcation
of the low-frequency region of the spectrum.

In Fig. 1 we report the sample periodograms of the heat ﬂuxes computed for the four systems considered in this paper and
averaged over the three Cartesian components, as described above. The solid lines in color indicate a further moving average26
computed over a narrow frequency window, as explained at the end of Sec. 2. The values of the cutoff frequencies used for
cepstral analysis, f ∗, are chosen so as to encompass the ﬁrst prominent feature of the (smoothed) power spectrum. For instance,
in H2O and a-SiO2 we choose f ∗ ≈ 29 THz and f ∗ ≈ 28 THz, respectively. In MgO we assume f ∗ ≈ 0.6 THz, just at the upper
edge of the ﬁrst narrow peak, whereas in Ar there is just one band, corresponding to a purely diffusive behavior of a simple
ﬂuid, and we assume f ∗ ≈ 7 THz, where the spectrum has exhausted most of the available power, but its value is not yet too

6/12

0.02.55.07.5f [THz]SAr050100150f [THz]SH2O05101520f [THz]SMgO010203040f [THz]Sa-SiO2012small (see Fig. 1). The corresponding average numbers of cepstral coefﬁcients given by the optimization of the AIC are: P∗
A = 5
(Ar), 7 (H2O), 4 (MgO), and 31 (a-SiO2). Later we will display the dependence of the number of optimal cepstral coefﬁcients
and of the resulting estimate of the thermal conductivity on the choice of f ∗, and show that this choice is not critical.

In order to validate our data-analysis protocol, we ﬁrst computed the heat conductivities from a direct integration of the
current autocorrelation function, Eq. (1), combined with standard block analysis over the 50 ns long trajectory, that will be
taken as a reference, obtaining: κref = 0.1965 ± 0.0015, 0.970 ± 0.009, 19.2 ± 0.4, and 2.115 ± 0.025 W/mK, for Ar, H2O,
MgO, and a-SiO2, respectively. Although our simulations were meant for benchmarking purposes only, and no particular care
was paid to exactly match the simulation conditions of previous work, these data are in fair agreement with the foregoing
theoretical results: ≈ 0.19 W/mK (Ar),28 ≈ 0.85 W/mK (H2O),34 ≈ 12 W/mK (MgO),30 and ≈ 2.1 W/mK (a-SiO2).35

In Fig. 2 we display the distributions of the values of log(κ/κref) estimated by applying our protocol to multiple MD
segments of 100 ps (for Ar, H2O, a-SiO2) and 500 ps (for MgO), extracted from the 50 ns long trajectory. The optimal numbers
of cepstral coefﬁcients, P∗, have been redetermined for each segment independently, while the values of the cutoff frequency,
f ∗, which only depends on the qualitative features of the spectrum, have been determined once for all for one of them.
The distribution of the resulting number of cepstral coefﬁcients is reported in Fig. 3. The observed distributions of log(κ)
successfully pass the Shapiro-Wilk normality test36 (i.e. they do not fail it) and the observed sample standard deviations closely
match the theoretical values estimated from Eq. (18) (sample/theory): 0.104/0.079 (Ar), 0.053/0.045 (H2O), 0.17/0.11
(MgO), and 0.114/0.095 (a-SiO2). Remember that the error on log(κ) is the relative error on κ: the corresponding absolute
errors achievable with a short trajectory of 100 (Ar, H2O, and a-SiO2) or 500 (MgO) ps, not to be confused with the long
trajectory used to establish the reference data above, are therefore: σκ ≈ 0.015 (Ar), 0.045 (H2O), 2 (MgO), and 0.2 (a-SiO2)
W/mK. This indicates that a single and short sample trajectory, such as one that is affordable with ab initio MD, is sufﬁcient to
achieve and accurately estimate a very decent relative error on the computed transport coefﬁcient. In an attempt to evaluate the
thermal conductivity from the direct computation of the GK integral, Eq. (1), and standard block analysis using similarly short
MD trajectories, our best estimate of the resulting statistical error was 2-3 times larger than using our protocol (meaning 5 − 10×
longer trajectories to achieve a comparable accuracy) in all cases but liquid Ar, where only a marginal improvement is achieved
using our methodology. Much more than this, the standard analysis of MD data depends on a number of hidden parameters,
such as the upper limit of the GK integral, Eq. (1), or the width of the blocks for error analysis, that are hard to determine
and keep under control. Our method, instead, only depends on a single parameter, the number of cepstral coefﬁcients, whose
optimal value can be easily determined from the Akaike’s information criterion, or other more sophisticated model-selection
methods,23, 37 as appropriate.

In order to estimate the bias introduced by limiting the number of cepstral coefﬁcients, we examined the sample mean
computed over the distributions displayed in Fig. 2, (cid:104)κ(cid:105), obtaining: (cid:104)κ(cid:105) = 0.1878 ± 0.0007, 0.969 ± 0.002, 16.7 ± 0.2, and
2.131 ± 0.009 W/mK, for Ar, H2O, MgO, and a-SiO2, respectively. Comparing these data with the reference data obtained
from the direct evaluation of the GK integral, we see that the bias is negligible for H2O and a-SiO2, very small for Ar, and
small but not negligible for MgO. In Fig. 4 we display the dependence of log(κ/κref) on the number of cepstral coefﬁcients,
P∗, as estimated from Eq. (15). We observe that when the number of cepstral coefﬁcients, P∗, is larger than the optimal value
determined from the AIC, P∗
A, the estimated value of κ seems not to depend on P∗ for all systems but MgO, for which a slight
bias seems to persist, and to a much lesser extent for Ar. Also, Eq. (18) seems to slightly underestimate the sample variance
for small P∗ in these cases. In the case of MgO this behavior is likely due to the difﬁculty of the AIC to cope with the sharp
low-frequency peak in the power spectrum, due to the highly harmonic character and slow decay of the vibrational heat carriers
in periodic crystals,11 thus requiring longer simulation times. In the case of Ar the very small bias observed for P∗ = P∗
A may
be due to the difﬁculty of choosing a suitable cutoff frequency when only a single diffusive band is present in the spectrum,
and to the divergence of the log-spectrum at high frequency. In all cases, use of the Aikake’s information criterion results in a
bias that is smaller than the statistical error estimated from an individual short sample trajectory and that can be systematically
removed by increasing the value of P∗, at the price of increasing the statistical error, if and when needed.

Finally, in Fig. 5 we report the dependence of the optimal number of cepstral coefﬁcients, P∗

A, as a function of the cutoff
frequency, f ∗, along with the dependence of the resulting estimate of log(κ/κref). P∗
A increases with f ∗. Notwithstanding,
the estimated value of the heat conductivity, as well as its variance, is fairly insensitive on the precise value of f ∗ as long as
the latter is large enough as to encompass the lowermost prominent feature of the spectrum. Some more comments are in
order for MgO. In this case the high thermal conductivity, due to the strong harmonic character of slowly decaying phonon
modes, manifests in the form of a narrow peak centered at f = 0, followed by a broad plateau that carries little spectral weight.
This feature determines a more pronounced increase in the number of signiﬁcant cepstral coefﬁcients as f ∗ increases and a
corresponding increase of the bias when keeping P∗ at the value given by the AIC. The AIC is a less reliable indicator of the
number of cepstral coefﬁcients necessary to keep the bias low, in this case. By increasing this number by a factor of two or
more, the bias decreases, as indicated by the results reported in lighter colors in Fig. 5, and eventually vanishes, as shown in
Fig. 4.

7/12

Figure 2. Distributions of the logarithm of the thermal conductivities, log(κ), estimated over multiple MD segments (100 ps for Ar,
H2O, and a-SiO2, and 500 ps for MgO) extracted from a 50 ns long trajectory. The reported data are referred to κref, which is the value
obtained from the direct integration of the current autocorrelation function in Eq. (1), combined with standard block analysis over the
50 ns trajectory, and represented by the vertical gray bands. The Gaussian curves represent the distributions predicted by the theory,
centered at the sample mean. Remember that the absolute error on log(κ) is the relative error on κ.

Figure 3. Distribution of the optimal numbers of cepstral coefﬁcients, P∗
A, as determined by optimizing the Akaike’s information
criterion, Eqs. (20) and (22), for each segment of the 50 ns long MD trajectory, as described in the text. The vertical dashed lines
indicate the average value of P∗
A.

8/12

0.40.20.00.20.4log(/ref)Ar0.40.20.00.20.4log(/ref)H2O0.40.20.00.20.4log(/ref)MgO0.40.20.00.20.4log(/ref)a-SiO2051015P*AAr051015P*AH2O051015P*AMgO15202530354045P*Aa-SiO2Figure 4. Dependence of log(κ), as estimated from Eq. (15), on the number of cepstral coefﬁcients P∗. P∗
A is the optimal number of
coefﬁcients estimated from the AIC using Eqs. (20) and (22). The black dots represent the mean values of log(κ) computed over
multiple MD segments (100 ps for Ar, H2O, and a-SiO2, and 500 ps for MgO) extracted from a 50 ns long trajectory; the colored
bands and dashed lines represent one standard deviation as estimated from the empirical statistics and from Eq. (18), respectively.
The reported data are referred to κref, which is the value of thermal conductivity obtained from direct integration of the current
autocorrelation function in Eq. (1), combined with standard block analysis over the 50 ns trajectory, and represented by the horizontal
gray bands. Remember that the absolute error on log(κ) is the relative error on κ.

4 Conclusions and perspectives

We believe that the methodology introduced in this paper will ﬁnally open the way to the quantum simulation of heat transport,
which has been considered out of its scope until very recently, particularly for strongly anharmonic and/or disordered systems.
Its implementation is straightforward and its use robust, as the only parameter to be determined is the optimal number of
cepstral coefﬁcients, using e.g. the Akaike’s information criterion. Our methodology performs best when a low conductivity
results from large cancellations in the integral of a highly oscillatory time auto-correlation function, such as in molecular
liquids or amorphous solids, where simulation times of the order of 100 ps seem sufﬁcient to obtain accuracies of the order of
10% in the estimated thermal conductivities. The performance is less spectacular in periodic crystals, where slowly-decaying
strongly-harmonic phonon modes require longer simulation times and the ensuing sharp peak in the low-frequency region of
the power spectrum requires a larger number of cepstral coefﬁcients than predicted by the optimization of the AIC. Even so,
simulation times of the order of a few hundred picoseconds seem sufﬁcient to achieve a comparable accuracy. In the latter
case, it is possible that a combination of the methodology introduced here with specialized techniques based on normal-mode
analysis, such as that presented in Ref. 11, will result in further improvements. Replacing the optimization of the AIC with
more sophisticated and possibly more efﬁcient approaches, such as e.g. weighted multi-model inference techniques,23, 37 may
also assist in this and other difﬁcult cases. Finally, we expect that our methodology will impact on the simulation of any
transport phenomena to which the Green-Kubo theory applies, such as ionic conduction, viscosity, and many others.

Acknowledgments

This work was partially supported by the European Union through the MAX Centre of Excellence (Grant No. 676598). We are
grateful to Dario Alfè and Giovanni Ciccotti for a critical reading of the ﬁrst version of the manuscript. LE is grateful to Nicola
Marzari for hospitality at MARVEL-EPFL, where this work took its ﬁnal shape.

9/12

0.51.01.52.02.5P*/P*A0.40.20.00.2log(/ref)Ar0.51.01.52.02.5P*/P*A0.40.20.00.2log(/ref)H2O0.51.01.52.02.5P*/P*A0.40.20.00.2log(/ref)MgO0.51.01.52.02.5P*/P*A0.40.20.00.2log(/ref)a-SiO2Figure 5. Triangles: average optimal number of cepstral coefﬁcients, P∗
A, as determined by the AIC, Eqs. (20) and (22), as a function
of the cutoff frequency used for cepstral analysis, f ∗ (see discussion just after Eq. (22)). Squares: log(κ) resulting from a given choice
of f ∗ and of the corresponding value of P∗
A. All the values are averages performed over multiple 100 ps long segments (500 ps for
MgO) extracted from a 50 ns long MD trajectory, as discussed in the text. The colored bands indicate the sample standard deviation
and the dashed lines that resulting from our theoretical analysis (see Eq. (18)). The vertical arrows indicate the cutoff frequencies, f ∗,
used for the cepstral analysis in this paper (see Fig. 1 and text). In the case of MgO, the data indicated with lighter colors are obtained
using a number of cepstral coefﬁcients twice as large as that provided by the AIC, P∗ = 2P∗
A. The data are referred to κref, which is
the value of thermal conductivity obtained from direct integration of the current autocorrelation function in Eq. (1), combined with
standard block analysis over the 50 ns trajectory, and represented by the horizontal gray bands. Remember that the absolute error on
log(κ) is the relative error on κ.

Author contributions statement

LE contributed to the development of the theory, ran most of the simulations, wrote the data-analysis software, performed
the data analysis, and contributed to write the manuscript. AM contributed to the development of the theory, ran some of the
simulations, and contributed to write the manuscript. SB developed the theory, supervised the project, and wrote the manuscript.

Additional information

Competing ﬁnancial interests: The authors declare no competing ﬁnancial interests.

References

1. Green, M. S. Markoff Random Processes and the Statistical Mechanics of Time-Dependent Phenomena. II. Irreversible

Processes in Fluids. J. Chem. Phys. 22, 398–413 (1954). DOI 10.1063/1.1740082.

2. Kubo, R. Statistical-Mechanical Theory of Irreversible Processes. I. General Theory and Simple Applications to Magnetic

and Conduction Problems. J. Phys. Soc. Jpn. 12, 570–586 (1957). DOI 10.1143/JPSJ.12.570.

3. Kadanoff, L. P. & Martin, P. C. Hydrodynamic equations and correlation functions. Ann. Phys. 24, 419–469 (1963). DOI

10.1016/0003-4916(63)90078-2.

4. Forster, D. Hydrodynamic ﬂuctuations, broken symmetry, and correlation functions (Reading, Mass., W. A. Benjamin, Inc.,

1975).

5. Schelling, P. K., Phillpot, S. R. & Keblinski, P. Comparison of atomic-level simulation methods for computing thermal

conductivity. Phys. Rev. B 65, 1–12 (2002). DOI 10.1103/PhysRevB.65.144306.

10/12

0.02.55.07.5f* [THz]0.40.20.00.2log(/ref)Ar050100150f* [THz]0.40.20.00.2log(/ref)H2O05101520f* [THz]0.40.20.00.2log(/ref)MgO010203040f* [THz]0.40.20.00.2log(/ref)a-SiO212345050100150P*A0204060010203040P*A6. Nevins, D. & Spera, F. J. Accurate computation of shear viscosity from equilibrium molecular dynamics simulations. Mol.

Simul. 33, 1261–1266 (2007). DOI 10.1080/08927020701675622.

7. Jones, R. E. & Mandadapu, K. K. Adaptive Green-Kubo estimates of transport coefﬁcients from molecular dynamics based

on robust error analysis. J. Chem. Phys. 136, 154102 (2012). DOI 10.1063/1.3700344.

8. Zhang, Y., Otani, A. & Maginn, E. J. Reliable Viscosity Calculation from Equilibrium Molecular Dynamics Simulations:

A Time Decomposition Method. J. Chem. Theory Comput. 11, 3537–3546 (2015). DOI 10.1021/acs.jctc.5b00351.

9. Oliveira, L. d. S. & Greaney, P. A. Method to manage integration error in the Green-Kubo method. Phys. Rev. E 95,

023308 (2017). DOI 10.1103/PhysRevE.95.023308.

10. Chen, J., Zhang, G. & Li, B. How to improve the accuracy of equilibrium molecular dynamics for computation of thermal

conductivity? Phys. Lett. A 374, 2392–2396 (2010). DOI 10.1016/j.physleta.2010.03.067.

11. Carbogno, C., Ramprasad, R. & Schefﬂer, M. Ab initio Green-Kubo Approach for the Thermal Conductivity of Solids.

Phys. Rev. Lett. 118, 175901 (2017). DOI 10.1103/PhysRevLett.118.175901.

12. Stackhouse, S., Stixrude, L. & Karki, B. B. Thermal Conductivity of Periclase (MgO) from First Principles. Phys. Rev.

Lett. 104, 208501 (2010). DOI 10.1103/PhysRevLett.104.208501.

13. Marcolongo, A., Umari, P. & Baroni, S. Microscopic theory and ab initio simulation of atomic heat transport. Nat. Phys.

12, 80–84 (2016). DOI 10.1038/nphys3509.

14. Ercole, L., Marcolongo, A., Umari, P. & Baroni, S. Gauge Invariance of Thermal Transport Coefﬁcients. J. Low Temp.

Phys. 185, 79–86 (2016). DOI 10.1007/s10909-016-1617-6.

15. Kang, J. & Wang, L. First-principles green-kubo method for thermal conductivity calculations. Phys. Rev. B 96, 020302

(2017). DOI 10.1103/PhysRevB.96.020302.

16. Hansen, J.-P. & McDonald, I. R. Theory of Simple Liquids with Applications to Soft Matter (Academic Press, Oxford,

2013), 4th edn.

17. Wiener, N. Generalized harmonic analysis. Acta Math. 55, 117–258 (1930). DOI 10.1007/BF02546511.

18. Khintchine, A. Korrelationstheorie der stationären stochastischen Prozesse. Math. Ann. 109, 604–615 (1934). DOI

10.1007/BF01449156.

19. Stoica, P. S. & Moses, R. Spectral Analysis of Signals (Prentice Hall, Upper Saddle River, 2005).

20. Weisstein, E. W. Polygamma Function, from MathWorld – a Wolfram Web Resource, http://mathworld.wolfram.

com/PolygammaFunction.html.

21. Childers, D. G., Skinner, D. P. & Kemerait, R. C. The Cepstrum: A Guide to Processing. Proc. IEEE 65, 1428–1443

(1977). DOI 10.1109/PROC.1977.10747.

22. Peligrad, M. & Wu, W. B. Central limit theorem for fourier transforms of stationary processes. Ann. Prob. 38, 2009–2022

(2010). DOI 10.1214/10-AOP530.

23. Claeskens, G. & Hjort, N. L. Model Selection and Model Averaging (Cambridge University Press, 2008).

24. Akaike, H. A New Look at the Statistical Model Identiﬁcation. IEEE Trans. Autom. Control. 19, 716–723 (1974). DOI

10.1109/TAC.1974.1100705.

25. Oppenheim, A. V., Schafer, R. W. & Buck, J. R. Discrete-Time Signal Processing (2nd Edition) (Prentice-Hall Signal

Processing Series) (Prentice Hall, 1999).

26. Weisstein, E. W. Moving Average, from MathWorld – a Wolfram Web Resource, http://mathworld.wolfram.

com/MovingAverage.html.

27. Plimpton, S. Fast parallel algorithms for short-range molecular dynamics. J. Comp. Phys. 117, 1 – 19 (1995). DOI

10.1006/jcph.1995.1039.

28. Tretiakov, K. V. & Scandolo, S. Thermal conductivity of solid argon from molecular dynamics simulations. J. Chem. Phys.

120, 3765–3769 (2004). DOI 10.1063/1.1642611.

29. Alejandre, J., Chapela, G. A., Bresme, F. & Hansen, J. P. The short range anion-H interaction is the driving force for

crystal formation of ions in water. J. Chem. Phys. 130 (2009). DOI 10.1063/1.3124184.

30. Shukla, P., Watanabe, T., Nino, J. C., Tulenko, J. S. & Phillpot, S. R. Thermal transport properties of MgO and Nd2Zr2O7
pyrochlore by molecular dynamics simulation. J. Nucl. Mat. 380, 1–7 (2008). DOI 10.1016/j.jnucmat.2008.06.043.

11/12

31. van Beest, B. W. H., Kramer, G. J. & van Santen, R. A. Force ﬁelds for silicas and aluminophosphates based on ab initio

calculations. Phys. Rev. Lett. 64, 1955 (1990). DOI 10.1103/PhysRevLett.64.1955.

32. Shcheblanov, N. S., Mantisi, B., Umari, P. & Tanguy, A. Detailed analysis of plastic shear in the Raman spectra of SiO2

glass. J. Non-Cryst. Solids 428, 6–19 (2015). DOI 10.1016/j.jnoncrysol.2015.07.035.

33. Frenkel, D. & Smit, B. Understanding Molecular Simulation: From Algorithms to Applications (Computational Science

Series, Vol 1) (Academic Press, 2001).

34. Römer, F., Lervik, A. & Bresme, F. Nonequilibrium molecular dynamics simulations of the thermal conductivity of
water: A systematic investigation of the SPC/E and TIP4P/2005 models. J. Chem. Phys. 137, 074503 (2012). DOI
10.1063/1.4739855.

35. Larkin, J. M. & McGaughey, A. J. H. Thermal conductivity accumulation in amorphous silica and amorphous silicon.

Phys. Rev. B 89, 144303 (2014). DOI 10.1103/PhysRevB.89.144303.

36. Shapiro, S. S. & Wilk, M. B. An Analysis of Variance Test for Normality (Complete Samples). Biom. 52, 591 (1965). DOI

10.2307/2333709.

37. Burnham, K. P. & Anderson, R. P. Multimodel Inference: Understanding AIC and BIC in Model Selection. Soc. Meth. Res.

33, 261–304 (2004). DOI 10.1177/0049124104268644.

12/12

