Ares: A Mars model retrieval framework for ExoMars Trace Gas Orbiter NOMAD solar
occultation measurements

George Canna,b,, Ahmed Al-Refaieb, Ingo Waldmannb, Dave Waltona, Jan-Peter Mullera

aImaging Group, Mullard Space Science Laboratory, Department of Space and Climate Physics, University College London, Holmbury St. Mary, Surrey, RH5
6NT, UK. Email: george.cann.15@ucl.ac.uk.
bAstrophysics Group, Department of Physics and Astronomy, University College London, Gower Street, WC1E 6BT, UK.

Abstract

Ares is an extension of the TauREx 3 retrieval framework for the Martian atmosphere. Ares is a collection of new atmospheric
parameters and forward models, designed for the European Space Agency’s (ESA) Trace Gas Orbiter (TGO) Nadir and Occultation
for MArs Discovery (NOMAD) instrument, Solar Occultation (SO) channel. Ares provides unique insights into the chemical
composition of the Martian atmosphere by applying methods utilised in exoplanetary atmospheric retrievals, Waldmann et al.
(2015), Al-Refaie et al.
(2019). This insight may help unravel the true nature of CH4 on Mars. The Ares model is here
described. Subsequently, the components of Ares are deﬁned, including; the NOMAD SO channel instrument function model,
Martian atmospheric molecular absorption cross-sections, geometry models, and a NOMAD noise model. Ares atmospheric priors
and forward models are presented, (i.e., simulated NOMAD observations), and are analysed, compared and validated against the
Planetary Spectrum Generator, Villanueva et al. (2018).

Keywords:
Mars, CH4, Ares, TauREx, NOMAD.

1. Introduction

In 2003, methane, CH4, was tentatively detected in the Mar-
tian atmosphere, at 10 ppbv ± 5, varying by up to 30 ppbv glob-
ally, Formisano et al. (2004), and 10 ppbv ± 3 Krasnopolsky et
(2004). CH4 has, at most, a predicted photochemical life-
al.
time of 300 years according to Summers et al. (2002). This im-
plies that CH4 in the Martian atmosphere should be uniformly
distributed over Mars. However, non-uniform distributions of
CH4 have been observed, Mumma et al.
(2009). This raises
questions with regard to the source(s) and/or sink(s) of CH4.
Abiotic and biotic sources have been suggested to explain the
detection, ranging from olivine serpentinization, Morozova et
al. (2007), to methanogenesis by methanogenic archaea, Allen
et al. (2006).

(2015), Robert et al.

The Nadir and Occultation for MArs Discovery (NOMAD)
instrument, Vandaele et al.
(2016), on-
board the European Space Agency’s Exomars Trace Gas Or-
biter (TGO) was designed to investigate the nature of methane,
CH4, on Mars, Liuzzi et al.
(2009).
However, the arrival of TGO and subsequent science mission
has detected no CH4, with an upper limit of 0.05 ppbv, Ko-
In contrast, NASA’s Curiosity Sam-
rablev et al.
ple Analysis at Mars Tunable Laser Spectrometer instrument

(2019), Mumma et al.

(2019).

Email addresses: george.cann.15@ucl.ac.uk (George Cann),

ahmed.al-refaie.12@ucl.ac.uk (Ahmed Al-Refaie),
ingo.waldmann@ucl.ac.uk (Ingo Waldmann), d.walton@ucl.ac.uk
(Dave Walton), j.muller@ucl.ac.uk (Jan-Peter Muller)

(SAM-TLS), Mahaﬀy et al.
(2012), has made multiple mea-
surements of CH4, including measuring an elevated CH4 back-
ground of 7.2 ± 2.1 ppbv CH4 over a 60-sol period in 2013,
(2015). Subsequently, using SAM-TLS, Web-
Webster et al.
ster et al.
(2018), determined a mean CH4 abundance of 0.41
± 0.16 ppbv, as well as a repeatable seasonal variation from
0.24 to 0.65 ppbv. Moreover, on 19th June 2019 it was reported
that SAM-TLS measured a spike of 21 ppbv at Teal Ridge in
Gale Crater, NASA (2019). Furthermore, the Planetary Fourier
(1997), onboard Mars
Spectrometer (PFS), Formisano et al.
Express measured 15.5 ± 2.5 ppbv of CH4, above Gale Crater
on 16th June 2013, one day after SAM-TLS independently de-
tected a CH4 spike of 5.78 ± 2.27 ppbv, Giuranna et al. (2019).
Since then PFS has detected no CH4, ESA (2019). The dis-
crepancy between surface measurements by SAM-TLS and or-
bital measurements from NOMAD and PFS, combined with the
independent conﬁrmation of detection of CH4 by PFS, signif-
icantly constrains the mechanisms to corroborate the measure-
ments.

Here we present a new retrieval scheme called Ares, an
extension to the TauREx framework designed for TGO NO-
MAD Solar Occultation (SO) channel solar occultation mea-
surements. Ares allows atmospheric sounding of the Martian
atmosphere by applying methods developed originally for ex-
tracting tiny signals from noisy measurements of in exoplane-
tary atmospheric retrievals. This insight could help unravel the
nature of CH4 on Mars.

This paper is organized into distinct sections; ﬁrstly, the
Ares model is described; subsequently, the components of Ares

0
2
0
2

l
u
J

7
2

]
P
E
.
h
p
-
o
r
t
s
a
[

1
v
8
5
4
3
1
.
7
0
0
2
:
v
i
X
r
a

Preprint submitted to Elsevier

November 13, 2021

 
 
 
 
 
 
and associated classes are deﬁned, including; the NOMAD in-
strument function model, HITRAN 2016, Gordon et al. (2016),
Martian absorption cross-sections, the geometry modules. Sec-
ondly, simulated NOMAD observations with Ares, are anal-
ysed, compared, and validated against the Planetary Spectrum
Generator, Villanueva et al. (2018).

2. Ares outline

(2006); Feroz et al.

Ares is an extension of TauREx3, Al-Refaie et al.

(2019),
the 3rd generation of TauREx. TauREx, (Tau Retrieval for Ex-
oplanets), Waldmann et al.
(2015), is a fully Bayesian atmo-
spheric retrieval framework that uses Nested Sampling, Skilling
et al.
(2009), and Markov chain Monte
Carlo (MCMC) methods to sample the full likelihood space of
possible solutions. This allows TauREx to produce marginalised
and conditional posterior distributions of forward model pa-
rameters, which can be used to map correlations between for-
ward model parameters. This is advantageous over other plan-
etary atmospheric retrieval frameworks that only ﬁnd the maxi-
mum a posteriori (MAP) solution through Optimal Estimation,
Rodgers (2000). The work presented here focuses on extend-
ing the TauREx3 radiative transfer forward models for Mars re-
trievals. We have named this TauREx 3 Mars extension module
Ares.

Figure 1: A ﬂow diagram of Ares, modiﬁed from Al-Refaie et al. (2019). Red
boxes represent TauREx3 modules. Blue boxes represent Ares modiﬁcations to
TauREx3.

The NOMAD SO channel blaze function, acousto-optic tun-
able ﬁlter (AOTF) modules have been incorporated into the
Ares forward model. Furthermore, Martian ellipsoidal and spher-
ical geometry modules have been included in order to calculate
the atmospheric layer line-of-sight (LOS) intersection points
and corresponding path lengths, Thomas et al. (2018). A Mars
Climate Database (MCD) Python library, pymcd, has been writ-
ten and linked to the RTM, providing access to Martian verti-
cal temperature, pressure and volume-mixing-ratio (VMR) pro-
ﬁles, Forget et al.
(2018). Moreover,
(1999), Millour et al.
Martian absorption cross-sections have been generated using
(2016), molecular line lists and
HITRAN 2016, Gordon et al.
(2018), accounting for expected
ExoCross, Yurchenko et al.

2

Martian pressures, temperatures and CO2 broadening, due to
the CO2-rich Martian atmosphere. Overall this enables Ares to
produce simulated NOMAD SO channel transmission spectra.

2.1. NOMAD instrument

NOMAD is a high-resolution echelle grating spectrome-
ter suite consisting of three channels; namely the Ultraviolet
and Visible Spectrometer (UVIS), Solar Occultation (SO) and
Limb, Nadir and Occultation (LNO), Robert et al.
(2016).
Each channel can operate in diﬀerent geometry modes. UVIS
functions in nadir and solar occultation mode geometries from
0.2-0.65 µm, SO functions in solar occultation geometry from
2.3-4.3 µm and LNO is dedicated to operating in limb and nadir
geometries also from 2.3-4.3 µm. NOMAD is dedicated to in-
vestigate the composition of trace gas species in the Martian
atmosphere, which can provide insights into present day ge-
ological and biological processes. NOMAD targets trace gas
species including molecules such as, CO, HDO, C2H2, C2H4,
H2CO, H2S, HCl, HCN, HO2, NH3, N2O, NO2, OCS and O3.
Additionally, NOMAD should be capable of determining the
abundances of the isotopologues of the aforementioned species,
that are of particular relevance to determining the biotic or abi-
otic nature of CH4, Vandaele et al.
(2016). These include the isotopologues of the Martian at-
mospheric carbon sources CO2, CO, and CH4, namely 13CO2,
17OCO, 18OCO, 18CO2, 13CO, 18CO, 12CH4, 13CH4 and CH3D.
Furthermore, NOMAD should be capable of determining the
abundances of hydrocarbons such as C2H6 and sulfur sources,
such as SO2, Yung et al. (2018).

(2015), Robert et al.

2.1.1. SO channel

This study will predominately focus on the NOMAD SO
channel. NOMAD’s SO channel covers 2.3-4.3 µm, for diﬀrac-
tion orders 96-225, with a resolving power of ≈ 20,000 and a
radio frequency input to the SO AOTF ranging between 12,300-
31,100 kHz. For comparison, the LNO channel covers diﬀrac-
tion orders 108-220, with a resolving power of ≈ 10,000 and
a radio frequency input to the LNO AOTF ranging between
14,200-32,100 kHz. The NOMAD SO channel detector con-
sists of a grid of 320 columns and 256 rows, along the spectral
and spatial dimensions, respectively.

(2015), Robert et al.

For NOMAD’s SO channel, typically 24 rows of the detec-
tor range over an interval of approximately 7.5 km along the
tangent height path, with a vertical sampling of 500 m, with the
number of rows illuminated dependent on the Mars-Sun dis-
tance. Whilst extensive deﬁnitions of the instrument are given
in Neefs et al.
(2016) and Liuzzi et al.
(2019), the temperature dependence of the AOTF and blaze
functions are not reported. We obtained the requisite details
on how to deﬁne the AOTF and blaze functions accounting
for their temperature dependencies from the NOMAD Exper-
iment to Archive Interface Document (EAICD), Thomas et al.
(2018), and the NOMAD Datasets and Calibration Steps docu-
ment, Thomas et al. (2019).

2.1.2. Calibration

(2019), Thomas et al.

NOMAD SO channel calibrations have been performed by,
Liuzzi et al.
(2018), and include the
conversion of detector pixel number and diﬀraction order to
wavenumber, i.e. instrument spectral calibration, as well as in-
strument spectral resolution determination and thermal eﬀects
quantiﬁcation. Moreover, measurements of the tuning relation
have been performed to determine the relationship between the
radio frequency applied to the SO channel AOTF and wavenum-
ber at which the SO channel AOTF transfer function peaks.

The main product derived from the NOMAD instrument
calibrations is an accurate model for NOMAD SO channel spec-
(2018) note that
(2019) and Thomas et al.
tra. Liuzzi et al.
diﬀerent diﬀraction orders mix to produce the observed spectra,
where between 15 - 50 % in a target order is contributed to by
nearby orders, a property that increases with order number and
AOTF frequency. Liuzzi et al. (2019) gives the functional rela-
tionship between pixel number p (from 0 to 319) wavenumber
ν and order number m being modelled by a 2nd order polyno-
mial. The retrieved coeﬃcients for the aforementioned spectral
calibration are given by,

ν
m

= F0 + F1 p + F2 p

2

.

(1)

Similarly the tuning relation is given by the following 2nd

order polynomial,

2

,

ν = G0 + G1A + G2A

(2)
where A is the AOTF frequency. The retrieved coeﬃcients,
G0, G1, G2, F0, F1 and F2 for the spectral calibration can be
found in Table 1. and 2. of Liuzzi et al.
(2019). Spectral
calibration of NOMAD’s SO channel is challenging due to the
presence of a blaze function, an AOTF and the eﬀects of tem-
perature variation on these functions.

2.1.3. AOTF Transfer Function

NOMAD’s SO channel AOTF is fundamentally a ﬁlter, as
without it associating a particular absorption line to a particular
wavelength would be challenging, as more than 100 diﬀraction
orders would simultaneously fall on the detector, Liuzzi et al.
(2019). The AOTF transfer function is given by the following
equation.

T F(ν, ν0, w, IG, ρG, q, n) = Fsinc + Fgauss + Fcntmn,

(3)

where Fsinc, Fgauss and Fcntmn are given by,

Fsinc(ν, ν0, I0, w) = I0w2

(cid:16)

(cid:17)2

sin π(ν−ν0)
w
π2(ν − ν0)2






(4)

(5)

(6)

Fgauss(ν, ν0, IG, σG) = IG exp

−(ν − ν0)2
σ2
G
Fcntnm(ν, ν0, q, n) = q + n(ν − ν0),

Figure 2: Ares derived plot of NOMAD SO channel AOTF transfer function
intensity against wavenumber for diﬀraction order 134.

Figure 3: Ares derived map of NOMAD SO channel blaze function relative
intensity against diﬀraction order and pixel number. For comparison see Figure
11. in Liuzzi et al. (2019). The red line corresponds to diﬀraction order 134.

and ν = G0 + G1A + G2A2 , ν0 can be determined. w is the
location of the ﬁrst zero-crossing of the sinc-squared function.
IG is the Gaussian amplitude and σG the Gaussian standard de-
viation, q and n are the continuum oﬀset parameters. Finally
the relationship between w and the sinc-squared full-width half
maximum (FWHM) is given by, FWHM ≈ 0.886w. The set
of coeﬃcients G0, G1, and G2 are the wavenumber-AOTF fre-
quency calibration coeﬃcients. These terms are included in
the NOMAD EAICD with the same notation and can be found
in Level 2 partially processed SO HDF5 ﬁles under WnAOTF
Coefficients.

2.1.4. Blaze Function

A blaze function is included in Ares. Liuzzi et al.

(2019)

give the blaze function as,

(cid:19)2

(cid:18)
sin π(p−p0)

wp
π2(p − p0)2

(7)

where ν0 is the AOTF transfer function centre in cm−1. I0 is
the sinc-squared function amplitude. Using prior coeﬃcients

Fblaze(p, p0, wp) = w2
p

3

where p is the pixel number (from 0 to 319), p0 is the centre
of the function in pixel units and wp is the width of the blaze
function. Note that in pixels wp is equivalent to the free spectral
range. This is deﬁned by the properties of the grating and is
equivalent to F0 in equation 1. The blaze function p0 is deﬁned
in the NOMAD EAICD by the following equation,

p0(m) = I0 + I1m,

(8)

where the coeﬃcients I0 and I1 have been given as 150.80 and
0.22, respectively.

Figure 4: Ares derived plot of NOMAD SO channel blaze function intensity
against wavenumber for diﬀraction order 134.

2.1.5. Spectral Continuum

The continuum in the NOMAD SO channel spectra is the
result of the incoming continuum of the Sun, modiﬁed by the
SO channel AOTF transfer function and the blaze function, Li-
uzzi et al. (2019). Subsequently, the intensity of each NOMAD
SO channel pixel is modulated by the intensity of the SO chan-
nel AOTF transfer function and the blaze function. The con-
tinuum in NOMAD SO channel spectra, for a particular AOTF
frequency, A, takes the form of the Partial Elements Contin-
uum, PEC(A), Liuzzi et al.
(2019). Where PEC(A), is given
by,

PEC(A) =

m+∆m(cid:88)

j=m−∆m

PE(A, j).

(9)

PEC(A) =

m+∆m(cid:88)

j=m−∆m

AOT F(A, νj) · Fblaze( j, νj) · gain( j),

(10)

where PE(A,j) represents a Partial Element of the PEC(A). The
Partial Elements for diﬀraction order 134 are shown in Figure
5 and Figure 6.

Figure 5: Ares derived relative ﬂux contributions, Partial Elements, PE(A, j)
of the Partial Elements Continuum, PEC(A), for j ∈ [130, 138], for diﬀraction
order 134, with Thomas et al. (2019) updated coeﬃcients.

2.1.6. Observed Radiance

The radiance as observed by the NOMAD SO channel is

given by Liuzzi et al. (2019) as,

R(A, νm) =

m+∆m(cid:88)

j=m−∆m

AOT F(A, νj) · Fblaze( j, νj) · gain( j) · R( j, νj),

(11)
where AOT F(A, νj) is the AOTF transfer function at the AOTF
frequency A, for spectral grid νj of diﬀraction order j. Fblaze( j, νj)
is the blaze function of diﬀraction order j and the gain( j) is
the spectral average throughput in order j. NOMAD SO chan-
nel throughput has been characterised by NASA PSG team at
NASA Goddard and is available on the PSG website. Liuzzi
et al.
(2019) states that by considering only orders close to
the central order m, the gain( j) ≈ 1 for all orders and therefore
R(A, νm) can be rewritten as,

R(A, νm) =

m+∆m(cid:88)

j=m−∆m

AOT F(A, νj) · Fblaze( j, νj) · R( j, νj).

(12)

R( j, νj) encompasses all the signal terms, e.g. depending on
observation type, planetary surface temperature, reﬂectance of
the surface, aerosol extinction (in particular Martian dust and
water ice) and scattering. With regard to CH4 retrievals NO-
MAD SO channel diﬀraction order 134 is the order of most in-
terest here, and so in this we are most interested in calculating
R(A, ν134). As a side note, it is important to distinguish R( j, νj)
from R(A, νm).

2.2. Geometry

In order to model NOMAD SO observations correctly, a
module for computing a set of atmospheric-layer line of sight
(LOS) intersection lengths is included in Ares. Thomas et al.
(2016) use three types of Mars shape models to calculate the

4

In order to calculate the set of atmospheric-layer LOS in-
tersection lengths, an altitude referencing system is employed.
Again, maintaining EAICD nomenclature, the TGO altitude
variables are given by,

1. SurfaceRadius, is the height of the surface model above

the centre of Mars.

2. SurfaceAltAreoid, is the height of the surface above

the reference areoid.

3. ObsAlt, is the range of the spacecraft from the centre of

Mars.

The altitude of TGO above Mars’ centre, is referenced in
the NOMAD EAICD as ObsAlt, with the ellipsoidal, areoid
and surface shape models sharing a common centre. For all
geometry cases the following geometric attributes are set.

1. Assign the Geometry attribute for the TGO’s observa-

tional altitude using ObsAlt.

2. Assign the Point0 attribute for the tangent point altitude
to the Martian surface using TangentAltSurface.
3. Assign the Point0 attribute for the radius of the Martian

surface relative to Mars’ centre SurfaceRadius.

4. Assign the Geometry attribute for the TGO’s

sub-observation latitude point using SubObsLat.

5. Assign the Geometry attribute for the TGO’s

sub-observation longitude point using SubObsLon.

6. Assign the Point0 attribute for the sub-latitude point for

the tangent point, Lat.

7. Assign the Point0 attribute for the sub-longitude point

for the tangent point, Lon.

Point0 corresponds to the centre of the entire ﬁeld of view
of a NOMAD SO bin. A longitude and latitude grid of nlat-lon
points is set; in this study nlat-lon = 10, 000. A ﬁxed number
of atmospheric layers, nlayers is also set such that nlayers = 100.
Subsequently, the spacecraft’s coordinates, relative to the centre
of Mars, are calculated from,

xs = rs cos(ϕs) sin(θs),
ys = rs sin(ϕs) sin(θs),
zs = rs cos(ϕs).

(13)

(14)

(15)

rs is the TGO’s observation altitude, ObsAlt, relative to
Mars’ centre, ϕs is the TGO’s SubObsLon and θs is the TGO’s
SubObsLat. Similarly the tangent point coordinates, xt, yt and
zt, relative to Mars’ centre, are calculated as, xt = rt cos(ϕt) sin(θt),
yt = rt sin(ϕt) sin(θs), and zt = rt cos(ϕt). rt is the tangent point’s
altitude, (TangentAltSurface + SurfaceRadius), relative
to the centre of Mars, ϕt is the tangent point’s sub-longitude,
Lon, and θt is the tangent point’s sub-latitude, Lat. Using Ares,
a linear array of nlat-lon coordinates (xi, yi, zi) are calculated us-
ing the tangent point and spacecraft coordinates (xt, yt, zt) and
(xs, ys, zs). A linear array of distances from the centre of Mars
are calculated ∀ i as,

(cid:113)

ri =

x2
i

+ y2
i

+ z2
i .

(16)

5

Figure 6: Ares derived relative ﬂux contributions, Partial Elements, PE(A, j)
of the Partial Elements Continuum, PEC(A), for j ∈ [130, 138], for diﬀraction
(2019) updated coeﬃcients and AOTF transfer
order 134, with Thomas et al.
function temperature dependence.

aforementioned geometric parameters, these shape models in-
clude Ellipsoidal, Areoid and Surface. The ellipsoidal
model is the most basic shape model used. Here, Mars is mod-
elled as a tri-axial ellipsoid of radii: 3396.19 km×3396.19km×
3376.2 km. The areoidal model is not yet employed in Ares,
due to the challenge of calculating the geodesic of the Areoid
between (SubObsLat, SubObsLon) and (Point0,Point0).

For the areoid model, Mars is modelled to a sea level, where
the gravitational and rotational potential is constant across the
entire surface. This zero level is deﬁned by MGS/MOLA (Mars
Global Surveyor)/(Mars Orbiter Laser Altimeter) at a resolution
of 4 pixels per degree (around 1.6km). The surface model is the
real surface elevation, calculated from a Digital Shape Kernel
(DSK) by MGS/MOLA, again, at a resolution of 4 pixels per
degree using Lemoine et al. (2001).

In solar occultation mode, the geometry is deﬁned at the
tangent point. The tangent point is the point on the Mars el-
lipsoid closest to the line of sight vector of each point. Each
NOMAD shape model has a diﬀerent tangent height variable,
the following variables maintain NOMAD EAICD nomencla-
ture, and are given by,

1. TangentAlt, is the height above the reference ellipsoid.
2. TangentAltAreoid, is the height above the areoid.
3. TangentAltSurface, is the height above the surface

shape model.

Given the sublatitudes and sublongitudes of the TGO and
tangent height, we are able to deﬁne an array of sublatitude and
sublongitude points that deﬁne the path of solar irradiance to
NOMAD. The shortest path on a spheroid, oblate spheroid, tri-
axial ellipsoid and an areoidal surface will be diﬀerent from one
another. This said, we are not trying to ﬁnd the shortest path on
these surfaces, instead we are trying to ﬁnd the intersection of
the tangent point to spacecraft LOS with a set of spheroidal,
oblate spheroidal, triaxial ellipsoidal and an areoidal surfaces.

The complexity of this challenge depends on the geome-
try assumed for the atmospheric layers. The following sections
consider spherical, ellipsoidal and areoidal models.

2.2.1. Spherical

For the spherical case, the radius of Mars is set to rMars =
3376.20 km. Iterating over nlayers atmospheric layers, the goal
becomes ﬁnding the points at which the LOS of NOMAD SO,
deﬁned by (xt, yt, zt) and (xs, ys, zs) intersects with the set of
spherically deﬁned atmospheric layers, (x j, y j, z j), and sub-
sequently the distances between these points, dl j. The path
lengths, dl j are then found by implementing an intersection cri-
teria. These dl j are subsequently passed to the Ares forward
model to perform the radiative transfer integral.

2.2.2. Ellipsoidal

The ellipsoid, also called a tri-axial ellipsoid is a quadratic

surface, which has a general equation given by,

x2
a2

+ y2
b2

+ z2
a2

= 1.

(17)

where for NOMAD a = 3396.19km, b = 3396.19km and c =
3376.20km. For the ellipsoidal case, the Mars’ polar radius is
set to rMars,p = 3376.20 km and its equatorial radius to rMars,e =
3396.19 km. Analytically, we can deﬁne a set of ellipsoidal
atmospheric layers, however the ﬂattening ratio of the ellipsoid,
of which the ellipsoidal atmospheric layers are a subset, should
be maintained. The ﬂattening ratio of the ellipsoid is given by,

rMars,e − rMars,p
rMars,e
Therefore the set of ellipsoids that deﬁne the ellipsoidal at-

(18)

f =

.

mospheric layers are given by,

ai = 3.39619 × 106 + ∆zi,
bi = 3.39619 × 106 + ∆zi,
ci = (3.39619 × 106 + ∆zi)(1 − f ).

(19)

(20)

(21)

∆zi is derived from Ares altitudeProfile and represents
the height of atmospheric layer i above the surface ellipsoid. It-
erating over nlayers atmospheric layers, the goal becomes ﬁnding
the points at which the LOS of NOMAD SO, deﬁned by (xt, yt,
zt) and (xs, ys, zs) intersects with the set of ellipsoidal deﬁned
atmospheric layers, (x j, y j, z j), and subsequently the distances
between these points, dl j. The dl j are then found by implement-
ing an intersection criteria and then passing this to the Ares
forward model. Ares uses the geographiclib package (Kar-
ney , 2013) to calculate the ellipsoidal geodesic between (xt,
yt, zt) and (xs, ys, zs), utilising Geodesic, InverseLine and
Position.

As stated previously, for the Areoid shape model, Mars
can be modelled to a sea level, where the gravitational and
rotational potential is constant across the entire surface. The
areoidal model is not yet employed in Ares, due to the challenge
of calculating the geodesic of the Areoid between (SubObsLat,

6

SubObsLon) and (Point0,Point0). This requires utilising
TangentAltAeroid, TangentAltAeroid, SurfaceRadius
and SurfaceAltAreoid attributes, with MGS/MOLA data.
An approximation of the geodesic required could be achieved
by calculating the geodesic, as is the case for Spherical or
Ellipsoidal shape models and then mapping those latitude
and longitude points to the Areoid.

2.3. Chemistry

2.3.1. Opacities

Ares utilises the spectroscopic line lists from the HI-
TRAN 2016 (High Resolution Transmission) database (Gor-
, 2016) to generate Martian absorption cross-
don et al.
sections. Through the Hitran Application Programming In-
terface (HAPI) (Kochanov , 2019) , high resolution absorp-
tion cross-sections with WavenumberStep = 0.001 cm−1, have
been generated for the Martian atmosphere for a range of NO-
MAD target species. Ares absorption cross-sections include,
C2H4, H2CO, H2S,, HO2, NH3, NO2, OCS, O3, 12CH4, 13CH4,
H2O, 13CO2 and 12CO2. These absorption cross-sections ac-
count for expected Martian pressures, temperatures and CO2
broadening, due to the CO2-rich Martian atmosphere. Using
HAPI, we generate absorption cross-sections as a function for
each molecule, isotopologue, pressures and temperatures for
the required wavenumber range. Ares absorption cross-sections
range in temperature and pressure from 100-300 K, increasing
in increments of 10 K, and 0-600 Pa, increasing in increments
of 10 Pa, respectively.

2.3.2. Mars Climate Database

The Mars Climate Database (MCD) is an output dataset de-
rived from Global Climate Model (GCM) simulations of the
Martian atmosphere using Mars orbiter data assimilation (For-
get et al. , 1999; Millour et al. , 2018). In this study, the MCD,
is used to provide atmospheric priors for use in Ares forward
model simulations. In this study these atmospheric priors con-
sist of constant vertical mixing ratio proﬁles for CO2, and H2O.
The MCD does not yet provide atmospheric data for CH4, and
so the vertical mixing ratio proﬁle for CH4 is obtained for two
cases provided by SAM-TLS. 7.2 ± 2.1 ppbv, from Webster et
al. (2015), and has been adopted for the high methane concen-
tration case and 0.41 ± 0.16 ppbv, from Webster et al. (2018),
and for the low methane concentration case, representing the
background concentration at Gale Crater.

3. Forward Modelling

In this section, we introduce the Ares transmission forward
model, based on Waldmann et al.
(2015) and the Tau model
(2013). We link the Ares forward model to
of Hollis et al.
the aforementioned models; the NOMAD Instrument model,
including blaze and AOTF functions, NomadNoise, NOMAD
Geometry and the Mars Chemistry components, namely Mar-
tian absorption cross-sections and MCD atmospheric priors.

Forward modelling, is used with Inverse Modelling to ob-
In the ﬁeld

tain the best estimate of atmospheric properties.

of atmospheric sciences, these best estimates are known as at-
mospheric retrievals. With regard to atmospheric retrievals, the
forward model solves the Radiative Transfer Equation (RTE),
Chandrasekar (1960), and deﬁnes the relationship between the
so called state vector, x, and measurement vector, y, given by,

y = F(x, b) + (cid:15).

(22)

In the aforementioned equation b is a parameter vector that
includes all the forward model parameters that we do not seek to
optimize. In the case of Ares, this could include Mars’ surface
emissivity, or H2O and CO2 ice cloud densities. (cid:15) is the forward
model error and deﬁnes the error in a simulated measured signal
due to the forward model, F(x,b).

Inversion of F(x,b), can then be used to obtain a statisti-
cal estimate of the state vector, x, given measurement vector y.
Where x represents the atmospheric priors and the measurement
vector y, represents a set of NOMAD SO channel transmission
spectra.

If (cid:15) (cid:44) 0, then there exists an error in the Ares forward
model, the model parameters or the observations. Under all
realistic scenarios (cid:15) (cid:44) 0, and so the best estimate of the state
vector that can be obtained, is a statistical estimate.

3.1. Beer-Bouguer-Lambert Law

The monochromatic intensity of radiation passing through
a gas, Iλ(z), is given by the Beer-Bouguer-Lambert Law as a
function of atmospheric altitude z,

Iλ(z) = Iλ(0)e−τλ(z).

(23)

where λ is the wavelength of the radiation, Iλ(0) the radiation
intensity at the top of the atmosphere and τλ(z) the optical depth
of the medium. For a given absorbing molecular species m we
can deﬁne the optical depth to be the integral of the absorption
cross-section ζm(λ), the column density χm(z), and ρN(z) the
number density, over the optical path length l(z), given by,

τλ,m(z) = 2

(cid:90) l(z)

0

ζm(λ)χm(z)ρN(z)dl.

(24)

The optical path length l(z) is deﬁned by the geometry of the
transmission of radiation through the atmosphere. In the case of
Mars l(z) is provided by the Ares Geometry module. The total
optical depth is given by the sum of the individual molecular
species optical depths,

Nm(cid:88)

τλ(z) =

τλ,m(z),

(25)

m=1
Nm being the total number of absorbing molecular species. The
monochromatic transmittance Tλ is therefore given by,

Tλ = eτλ(z).

(26)

Therefore calculating Tλ for all λ points in the spectral re-
the bandwidth of NOMAD SO chan-
gion of interest, e.g.
nel diﬀraction order 134, with a transmittance equivalent of

R(A, νm) enables the simulation of NOMAD SO channel trans-
mission spectra,

T (A, νm) =

(cid:80)m+∆m

j=m−∆m AOT F(A, νj)Fblaze( j, νj)gain( j)T ( j, νj)
PEC(A)

.

(27)
For further details on forward modelling we refer the reader

to Waldmann et al. (2015) and Hollis et al. (2013).

4. Analysis of simulated NOMAD observations with Ares

4.1. Bayesian analysis of planetary atmospheres

The Ares framework allows the user to select a range of
optimisation routines to ﬁt the atmospheric forward model to
the data.
In planetary science retrievals, the use of optimal
estimation (Rodgers , 2000) is commonplace. Optimal Esti-
mation (OE) calculates the maximum likelihood (ML) through
a regularised matrix inversion of a Gaussian likelihood given
prior constraints. OE methods yield excellent results in high
signal-to-noise data regimes with good a priori knowledge of
expected atmospheric forward-model parameters. However, in
the case of low signal measurements and poorly constrained
prior ranges, ML methods often insuﬃciently capture possible
correlations in the likelihood surface for under-constrained re-
trievals. A typical example is atmospheric retrieval of extra-
solar planet atmospheres where low-resolution data leads to sig-
niﬁcant correlations between measured trace-gas abundances.
In these cases, it is necessary to solve for the full posterior prob-
ability distribution of the Bayesian argument.

Similarly, measuring trace-gas abundances at the detection
limits of current instrumentation in the Martian atmosphere will
require a complete understanding of possible correlations in the
posterior distributions of the retrieval solution.

Following the deﬁnition of equation 22, we can state Bayes’

Theorem as,

P(y|x, M) = P(x|y, M)P(y, M)

P(x, M)

.

(28)

x is the observed spectrum (e.g. the NOMAD SO channel
measurement), y is the vector of atmospheric forward model
parameters, and M is the atmospheric forward model used.
Hence, we want to compute the posterior distribution P(y|x, M),
describing the probability distribution of forward model param-
eters for a given spectrum and forward model. By default, we
assume the likelihood, P(x|y, M) to follow a Normal distribu-
tion,

P(x|y, M) =

1
√

2π

ε

exp





−

1
2

(cid:32)

N(cid:88)

ν

xν − Fλ(y, b)
εν

(cid:33)2
 ,

(29)

though other distirbutions can be speciﬁed in Ares. The prior
distribution P(y, M) encapsulates the prior information for a
given parameter and atmospheric model. In the case of Opti-
mal Estimation, this prior must be Gaussian. In the Ares frame-
work, the prior distribution can be any continuous probability

7

distribution, allowing for informative as well as uninformative
priors (e.g. Jeﬀrey’s priors). By default, we utilise uninfor-
mative log-uniform prior distributions over retrieved trace-gas
abundances to ensure a maximally data driven retrieval solu-
tion. Finally, we deﬁne the Bayesian Evidence as the integral
of the likelihood and prior:

(cid:90)

P(x, M) =

P(y, M)P(x|y, M)dy.

(30)

The evidence allows for Bayesian model selection, i.e. the
statistical comparison of the atmospheric with that of another.
A commonly used scale for model signiﬁcance is given by Kass
and Raftery (1995).

4.4. Nested Sampling

Nested Sampling (NS) algorithms Skilling et al. (2006) are
frequently used in exoplanetary science for performing atmo-
spheric retrievals and constitute the standard sampling method
in Ares, Nestle, Barbary (2015) and MultiNest, Feroz et al.
(2009). Whilst MCMC methods explore the entire likelihood
space by means of a Markov chain, NS applies a general Monte
Carlo analysis to periodically constrain ellipsoids that encom-
pass spaces of highest likelihood. Through NS, the Bayesian
partition function (i.e. the Bayesian evidence, E) can be calcu-
lated, allowing for exact model selection and a complete sam-
pling of the likelihood. NS is the default sampler for the Ares
framework.

4.2. Maximum a posteriori (MAP) Solution

The maximum a posteriori (MAP) solution is given by the

maximum possible value of P(y|x, M). The maximum of
P(y|x, M) is given by,

∇yP(y|x, M) = ∂
∂y

P(y|x, M) = 0.

(31)

∇y = ∂

∂y is the gradient operator in the state vector space
and 0 is the zero vector in the state vector space. For uniform
prior distributions, the MAP is equivalent to the maximum like-
lihood, and hence the result of Optimal Estimation. Whilst the
MAP solution is informative, it does not reﬂect the full inter-
parameter correlation possible in under constrained likelihoods.
Similarly, by their deﬁnition, MAPs do not carry possibly diag-
nostic information on local maxima in the posterior distribution.
By mapping the full posterior, we are able to derive a more ro-
bust understanding of the retrievability of trace gases at very
low volume mixing ratios.

4.3. MCMC

Monte Carlo Markov Chain (MCMC) methods are often

implemented in the ﬁeld of exoplanetary science, whereby
MCMC routines explore the likelihood space by means of a
Markovian chain. TauREx3 provides an implementation of de-
layed rejection (DR) Adaptive MCMC (DRAM, Haario et al.
(2006)). For further details we refer the reader to the literature;
for brevity we provide a brief overview here. DRAM diﬀers
from the classical Metropolis-Hastings sampler Metropolis et
al. (1953), Hastings (1970), Brooks et al. (2011), in that a DR
algorithm is implemented and that an adaptive proposal distri-
bution is calibrated using the co-variance of the sample path of
the MCMC chain. MCMC does not typically sample the full
likelihood volume and hence does not allow us to calculate the
Bayesian evidence. Hence equation 28 is approximated as

P(y|x, M) ∝ P(x|y, M)P(y, M).

(32)

For implementation we refer the reader to Appendix A of
Waldmann et al. 2015. TauREx3 runs several parallelised MCMC
chains, in order to check convergence and increase the sampling
of the likelihood space of possible solutions.

8

5. Ares - Planetary Spectrum Generator Comparison

5.1. Validation

In order to validate Ares, the Ares forward model has been
compared against NASA Goddard’s Planetary Spectrum Gen-
erator (PSG), Villanueva et al.
(2018). The PSG is an exten-
sive online radiative transfer suite that is capable of synthesising
Martian NOMAD SO channel spectra. Like Ares, the PSG can
utilise atmospheric priors from the MCD, Forget et al. (1999),
Millour et al. (2018). Ares Martian transmittance and spectral
radiance spectra, have been simulated using NOMAD observa-
tion metadata and compared against the PSG; running Ares and
PSG forward models with mutual input variables.

This comparison is achieved through ﬁrstly populating PSG
API conﬁg ﬁles with the same NOMAD observation metadata
and priors, as is used for the Ares forward model simulations,
such as tangent height, TGO observation altitude and atmo-
spheric mixing ratio proﬁles. Following the population of the
PSG conﬁguration ﬁles a set of curl commands using the afore-
mentioned conﬁg ﬁles are sent to the PSG API, for example:

curl -d type=rad -d whdr=n --data-urlencode
file@config.txt https://psg.gsfc.nasa.gov/api.php
-o config_output.txt

Setting type=trn in the curl command, with the radiation
unit in the conﬁg ﬁle set to rif, returns the PSG transmittance
simulation. Similarly, setting type=rad with the radiation unit
in the conﬁg ﬁle set to Wsrm2cm returns the PSG spectral radi-
ance simulation. Ares, unlike the PSG, does not yet correct for
Instrument Line Shape (ILS) ghosts, this is left to future work.
The conﬁg ﬁles and conﬁg-generator associated with this com-
parison will be available in the Supplementary Material.

In all simulations, the vertical mixing ratio and tempera-
ture proﬁles are assumed to be constant and isothermal respec-
tively.
In Ares, the Sun is assumed to be a blackbody, with
T(cid:12) = 5778 K. The wavenumber range of all simulations covers
νmin = 2945 cm−1 to νmin = 3130 cm−1, focusing on νmin =
3011 cm−1 to νmin = 3035 cm−1, in order to cover NOMAD SO
channel diﬀraction order 134, containing the CH4 ν3 band. The
minimum and maximum atmospheric pressures are set to pmin
= 1 Pa and pmax = 600 Pa respectively. In this initial comparison
we do not include scattering or collision induced absorption.

Figure 7: Ares PSG NOMAD SO channel solar occultation transmittance simulation comparison, covering the spectral range of diﬀraction order 134, 3011-3035
cm−1, using mutual input variables, such as geometry and atmospheric priors. NOMAD AOTF and blaze function are not applied in this ﬁgure. Atmospheric priors
and prior limits are provided in the top section of Table 1.

Figure 8: Ares PSG NOMAD SO channel solar occultation transmittance simulation residuals for Figure 7.

5.2. AOTF and Blaze function comparison

Whilst a transmittance simulation comparison between the
PSG and Ares is possible, see Figure 7 and 8, a direct trans-
mittance comparison with the NOMAD SO channel AOTF and
blaze function applied is not. This is due to the PSG AOTF and
blaze function transformations being inapplicable to transmit-
tance simulations. Therefore, in order to correctly compare and
validate Ares against the PSG, with and without the AOTF and
blaze function applied, a conversion of Ares simulated transmit-
tance to spectral radiance is required, or alternatively a conver-
sion of the simulated PSG spectral radiance simulations, Figure
14, back to a transmittance simulation, Figure 11, after the PSG
AOTF and blaze function transformations have been applied.
In order to enable the AOTF and blaze function in the PSG, the
generator telescope is set to AOTF. To disable the AOTF and
blaze function the generator telescope is set to Single Dish,
Villanueva et al. (2018).

5.3. Geometry comparison

For Ares, we observed that the simulated Ares transmittance
spectra with the Ellipsoidal and Spherical geometry mod-
ules matches the PSG well with the same input variables. We
observe, that the residuals between the Ellipsoidal and the
PSG are smaller than when utilising the Spherical module.
There are minor diﬀerences in the transmittance simulation ab-
sorption depths between, Ares and PSG, which could be due
to using diﬀerent absorption cross-sections or due to the diﬀer-
ences in the Ares and PSG geometry module implementations.

9

Table 1: Ares - PSG forward model parameters and priors.

Parameter
H2O
CO2
T
CH4,high
13CH4
OCS
PH3
NH3

Prior Unit
ppbv
ppbv
K
ppbv
ppbv
ppbv
ppbv
ppbv

105
9.65 × 108
230
7.2
0.072
1.0
1.0
1.0

Prior limits
[1.0 × 10−3, 1.0 × 107]
[9.0 × 108, 9.8 × 108]
[130.0,330.0]
[1.0 × 10−3, 1.0 × 102]
[1.0 × 10−3, 1.0 × 107]
[1.0 × 10−3, 1.0 × 107]
[1.0 × 10−3, 1.0 × 107]
[1.0 × 10−3, 1.0 × 107]

6. Results and Observations

Validating Ares through comparison to other established for-
ward models is critical prior to progressing to perform Ares re-
trievals. The results of the Ares PSG forward model compar-
isons show that both models are generally in good agreement.

6.1. AOTF and Blaze function comparison

Figure 7, shows the Ares PSG NOMAD SO channel so-
lar occultation transmittance simulation comparison, without
applying AOTF and blaze function. We generally note minor
diﬀerences in the absorption line depths. Figure 8, shows the
transmittance residuals of Figure 7, with a maximum residual
of 0.217 at 3012.59 cm−1 and a minimum residual of -0.123
at 3012.51 cm−1. Whilst these residuals are signiﬁcant, the

301030153020302530303035Wavenumber(cm−1)0.750.800.850.900.951.00TransmittancePSGTransmittance-NoAOTFandBlazefunctionAresTransmittance-NoAOTFandBlazefunction301030153020302530303035Wavenumber(cm−1)−0.10−0.050.000.050.100.150.20TransmittanceResidualsPSG-AresTransmittanceResidualsFigure 9: Ares NOMAD SO channel solar occultation transmittance simulation comparison, with and without AOTF and blaze function applied, covering the
spectral range of diﬀraction order 134, 3011-3035 cm−1.

Figure 10: Ares NOMAD SO channel solar occultation transmittance simulation residuals for Figure 9.

Figure 11: Ares PSG NOMAD SO channel solar occultation transmittance simulation comparison, with NOMAD SO channel AOTF and blaze function applied,
covering the spectral range of diﬀraction order 134, 3011-3035 cm−1.

Figure 12: Ares PSG NOMAD SO channel solar occultation transmittance simulation residuals for Figure 11.

10

30153020302530303035Wavenumber(cm−1)0.800.850.900.951.00TransmittanceAres-AOTFandBlazeFunctionAres-NoAOTFandBlazeFunction30153020302530303035Wavenumber(cm−1)−0.10−0.050.000.050.10TransmittanceResidualsAres-AOTFandBlazeFunctionResiduals30153020302530303035Wavenumber(cm−1)0.840.860.880.900.920.940.960.981.00TransmittanceAresTransmittance-AOTFandBlazeFunctionPSGTransmittance-AOTFandBlazefunction30153020302530303035Wavenumber(cm−1)−0.10−0.050.000.050.10TransmittanceResidualsAres-PSGTransmittanceResidualsFigure 13: PSG NOMAD SO channel solar occultation simulated transmittance measurement for 2945-3130 cm−1, showing molecular contributions of CO2, H2O
and CH4.

Figure 14: A graph of a PSG simulated spectral radiance measurement for NOMAD SO channel solar occultation for 2945 - 3130 cm−1, with and without NOMAD
SO channel AOTF and blaze function applied.

close proximity of the maximum and minimum residual, cou-
pled with the similarity of absorption depths in Figure 7, sug-
gests that these diﬀerences are due to minor discrepancies in the
spectral line positions.

Figure 9, shows Ares NOMAD SO channel solar occulta-
tion simulated transmittance, with and without the AOTF and
blaze function applied. Figure 10, shows the transmittance resid-
uals of Figure 9, with a maximum residual of 0.115 at 3035.21
cm−1 and a minimum residual of -0.105 at 3012.56 cm−1. Fig-
ure 11, shows the Ares PSG NOMAD SO channel solar oc-
cultation transmittance simulation comparison with the AOTF
and blaze function applied. Figure 12, shows the transmittance
residuals of Figure 11, with a maximum residual of 0.063 at
3035.11 cm−1 and a minimum residual of -0.067 at 3030.74
cm−1. We observe that applying the AOTF and blaze function,
the PSG and Ares, introduces absorption features, that are not
present prior to AOTF and blaze function transformations. This
exercise establishes that Ares and the PSG produce comparable
results when the NOMAD SO channel AOTF and blaze func-
tion are applied.

6.2. Geometry comparison

We note a slight diﬀerence in absorption line depth between
using Ares Spherical and Ellipsoidal geometry modules.
However, this slight variation is dependent on the tangent height.
The residuals between Ares geometry modules, across the sim-
ulated waveband, appears to decrease with increasing altitude.

This is to be expected, as the lower the altitude of the tangent
point (or atmospheric LOS intersection point), the greater the
diﬀerence between the calculated ellipsoidal and spherical path
lengths. This diﬀerence, in turn is exacerbated by the increase
in atmospheric density at lower altitudes. The residuals be-
tween Ares and PSG transmission spectra, across the simulated
waveband, decrease with increasing altitude. This conﬁrms the
expectation, that the most challenging observations are those at
lower altitudes Liuzzi et al. (2019).

6.3. Retrievals

Following the Ares PSG comparison, Ares marginalised and
conditional posterior distributions have been generated for the
aforementioned Ares simulated spectra Figure 11, shown in
Figures 15 and 16. We have assigned uncertainties for each
wavelength bin to give a signal-to-noise ratio of the maximum
(2019) of 1000 and utilised
value expected by Liuzzi et al.
Nested Sampling, with Nestle set as the optimizer, with 200
live points.

Figure 15, shows an example of a set of Ares posterior
distributions, retrieved using Ares, from a simulated NOMAD
SO channel transmittance measurement. This retrieval cov-
ers diﬀraction order 134, using TGO observation 20180430-
154925-1p0a-SO-A-I-134 metadata, with index (78,1), with tan-
gent height 20.504 km. The jet colour scheme of the joint
distributions is used to represent diﬀerences in probability den-
sity, whereby regions of high and low probability density are

11

29502975300030253050307531003125Wavenumber(cm−1)0.00.20.40.60.81.0TransmittancePSG-TotalTransmittancePSG-CO2contributionPSG-H2OcontributionPSG-CH4contribution29502975300030253050307531003125Wavenumber(cm−1)050100150200250300350SpectralRadiance(Wsr−1m−2(cm−1)−1)PSG-SpectralRadiancePSG-AOTFandBlazefunctionPSG-SpectralRadianceSingleDishPSG-SingleDishFigure 15: Posterior distributions of simulated NOMAD spectrum retrieved using Ares, for diﬀraction order 134, using observation: 20180430-154925-1p0a-SO-A-
I-134 metadata, index (78,1), tangent height 20.504 km. Contours represent regions of high (red) and low (blue) probability density. Ares priors are represented by
the red line in the marginalised distributions and as white cross hairs in the joint distributions. Dashed lines in the marginalised distributions represent are within σ1
of the MAP estimate. We observe that the retrievals for OCS, PH3 and 13CH4 are poorly constrained. As expected, we note that retrievals of H2O and temperature
are correlated. Figure 15 was produced using the corner.py package, Foreman-Mackey (2016).

12

Figure 16: A schematic diagram of the TGO, Martian atmospheric layers and corresponding Ares a posterior distributions, mapping the exact statistical correlations
between atmospheric parameters. Shown is a layer-by-layer retrieved atmosphere using simulated NOMAD spectra, for diﬀraction order 134, at three tangent
heights, in the lower, middle and upper Martian atmosphere. We observe that the retrievals for lower tangent heights are strongly noise dominated while middle
atmosphere retrievals produce tighter constraints.

represented within red and blue regions respectively. Ares pri-
ors are represented by the red line in the marginalised distri-
butions and as white cross hairs in the joint distributions. As
expected, we note that retrievals of H2O and temperature are
correlated. For this particular observation we ﬁnd an upper
limit of methane at log10(χ) = −10.82+0.87
−0.76 and no constraint
of OCS, PH3, NH3 and 13CH4 beyond their prior bounds. We
note that the tight prior bounds of CO2 eﬀectively constrain its
abundance given the data and no further constraint within these
priors is retrieved. The retrieved parameters are shown in Table
2.

Figure 16, visualises the advantages of utilising Ares to per-
form retrievals of forward model parameters, showing the TGO,
Martian atmospheric layers and corresponding Ares a posterior
distributions, for a set of NOMAD SO channel solar occulta-
tion measurements, xj. The set of probability density functions
produced, P(y|x, M), map the statistical correlations between
atmospheric forward model parameters as function of altitude.
Figure 16 shows a layer-by-layer retrieved atmosphere using
simulated NOMAD spectra, for diﬀraction order 134, at three
tangent heights, in the lower, middle and upper Martian atmo-
sphere. We observe that retrievals for middle atmosphere tan-
gent heights produce tighter constraints of probability density.
This is expected as the optical depth is too high close to the
surface and too low in the upper atmosphere. Whilst Ares is
a simpliﬁed model of complex atmospheric phenomena, cover-
ing only a small subset of possible atmospheric conditions and
TGO viewing geometries, it is nonetheless capable of gaining
unique insight into the Martian atmosphere.

7. Conclusions

This research has described a novel retrieval framework,
, 2019),
Ares, the Mars branch of TauREx 3 (Al-Refaie et al.
designed for TGO NOMAD SO channel solar occultation mea-
surements, the ﬁrst in a series of papers. This research has char-
acterised the instrument capabilities of the NOMAD instrument
and the TauREx 3 based Ares model. In this research, Ares has
been used to simulate transmittance and spectral radiance mea-
surements and perform retrievals of typical Martian mixing ra-
tio vertical proﬁles of CH4, H2O, and CO2. The Ares forward
model can simulate NOMAD spectra, including instrumental
eﬀects due to the blaze function, AOTF, as well as AOTF tem-
perature dependence.

Ares and PSG simulated transmittance and spectral radi-
ance measurements have been compared and are generally in
good agreement, with marginalised and conditional posterior
distributions of simulated and real data presented. We hope
that Ares will help accelerate the use of advanced statistical
sampling techniques, such as MCMC and Nested Sampling to
fully explore the atmospheric forward model degeneracies en-
countered in low signal regimes where trace-gas abundances
approach the instrument sensitivity ﬂoor. The work presented
here will provide a new open-source tool to the planetary sci-
ence community to study very faint spectral signatures in plan-
etary atmospheres using a statistically robust framework.

Future forward model comparisons, made against the PSG,
NEMESIS, Irwin et al. (2008), and ASIMUT-ALVL, Vandaele
(2006), will be used to further validate and reﬁne Ares.
et al.
Beyond Mars, Ares ﬁnds applications in the spectral analysis of
Titan, Bellucci et al. (2009), the middle atmosphere of Venus,

13

Table 2: Ares forward model priors and retrieved parameters for Figure 16.

Parameter
H2O
CO2
T
CH4,high
13CH4
OCS
NH3
PH3

Prior
105
9.65 × 108
230
7.2
0.072
1.0
1.0
1.0

Unit
ppbv
ppbv
K
ppbv
ppbv
ppbv
ppbv
ppbv

Prior limits
[1.0 × 10−3, 1.0 × 107]
[9.0 × 108, 9.8 × 108]
[130.0, 330.0]
[1.0 × 10−3, 1.0 × 102]
[1.0 × 10−3, 1.0 × 107]
[1.0 × 10−3, 1.0 × 107]
[1.0 × 10−3, 1.0 × 107]
[1.0 × 10−3, 1.0 × 107]

Retrieved log(Parameters)
−5.69+0.07
−0.10
−0.03+0.01
−0.01
288.61+28.26
−25.17
−10.82+0.87
−0.76
−9.63+1.63
−1.54
−7.08+3.34
−3.13
−9.30+1.36
−1.78
−6.73+3.06
−3.20

Limaye et al. (2018), and the plumes of Enceladus, Waite et al.
(2006).

8. Acknowledgements

We would like to thank the UK Space Agency for their sup-
port of this studentship through the Aurora Science Programme,
STFC number 535385. We would like to thank The Royal Bel-
gian Institute for Space Aeronomy (BIRA-IASB) for provid-
ing test NOMAD spectra, in particular Ian Thomas for help in
understanding the intricacies of NOMAD. The NOMAD ex-
periment is led by BIRA-IASB and assisted by Co-PI teams
from Spain (IAA-CSIC), Italy (INAF-IAPS), and the United
Kingdom (Open University). We would like to thank the LMD
for providing the MCDv5.3 and Ehouarn Millour for installa-
tion help. This project has received funding from the European
Research Council (ERC) under the European Union’s Horizon
2020 Research and Innovation Programme (Grant agreement
No. 758892, ExoAI). Furthermore, we acknowledge funding
by the Science and Technology Funding Council (STFC) grants:
ST/K502406/1, ST/P000282/1, ST/P002153/1 and ST/S002634/1.

9. Declaration of Interest Statement

The authors declare no competing ﬁnancial interests.

10. Supplementary Material

Following publication of this work supplementary material
associated with Ares and the Ares code will be provided open
source, licensed under a BSD license, available at:
https://github.com/ucl-exoplanets/ares.

References

Allen, M., Sherwood Lollar, B., Runnegar, B., Oehler, D.Z., Lyons, J.R., Man-
ning, C.E., Summers, M.E., 2006. Is Mars alive. Eos. Trans. Am. Geophys.
Union 87, 433-439. https://doi.org/10.1029/2006EO410001.

Al-Refaie, A.F., Changeat, Q., Waldmann, I.P., Tinetti, G., 2019. TauREx III:
A fast, dynamic and extendable framework for retrievals. Submitted to The
Astrophysical Journal. https://arxiv.org/abs/1912.07759v1.

Barbary, K. 2015. Nestle, GitHub. https://github.com/kbarbary/

nestle.

Bellucci, A., Sicardy, B., Drossart, P., Rannou, P., Nicholson, P.D., Hed-
man, M., Baines, K.H., Burrati, B., 2009. Titan solar occultation ob-
served by Cassini/VIMS: Gas absorption and constraints on aerosol com-
position, Icarus, Vol 201, Issue 1, 198-216. https://doi.org/10.1016/
j.icarus.2008.12.024.

Bohren, C. F., Huﬀman, D. R., 2007. Appendix A: Homogeneous Sphere (John
Wiley and Sons), 477-482. https://onlinelibrary.wiley.com/doi/
pdf/10.1002/9783527618156.app2.

Brooks, S.P., Gelman, A., Jones, G.L., Meng, X.-L. eds, 2011. Handbook
of Markov Chain Monte Carlo. Boca Raton, FL: Chapman and Hall/CRC
Press.

Chandrasekar, H. 1960. Radiative Transfer

(New York: Dover Publi-
cations). https://ui.adsabs.harvard.edu/abs/1960ratr.book...
..C/abstract

ESAs Mars orbiters did not see latest Curiosity methane burst, 2019. ESA.

http://www.esa.int/Science_Exploration/.

F. Feroz, M.P. Hobson, M. Bridges, 2009. MultiNest: an eﬃcient and ro-
bust Bayesian inference tool for cosmology and particle physics, Monthly
Notices of the Royal Astronomical Society, Vol 398, 1601-1614. http:
//dx.doi.org/10.1111/j.1365-2966.2009.14548.x.

D. Foreman-Mackey, 2016. corner.py: Scatterplot matrices in Python, Journal
of Open Source Software, 1(2), 24. https://doi.org/10.21105/joss.
00024.

Forget, F., Hourdin, F., Fournier, R., Hourdin, C., Talagrand, O., Collins,
M., Lewis, S.R., Read, P.L., Huot, J-P., 1999. Improved general circula-
tion models of the Martian atmosphere from the surface to above 80 km.
Journal of Geophysical Research, Volume 104, Issue E10, 24155-24176.
https://doi.org/10.1029/1999JE001025.

Formisano, V., Moroz, V.I., Angrilli, F., Bianchini, G., Bussoletti, E., Cafaro,
N., Capaccioni, F., Capria, M.T., Cerroni, P., Chionchio, G., Colangeli,
L., Coradini, A., di Lellis, A., Fonti, S., Orfei, R., Palomba, E., Piccioni,
G., Saggin, B., Ekonomov, A., Grigoriev, A., Gnedykh, V., Khatuntsev,
I., Kiselev, A., Matsygorin, I., Moshkin, B., Nechaev, V., Nikolsky, Y.,
Patsaev, D., Russakov, A., Titov, D., Zasova, L., Blecka, M.I., Jurewicz,
A., Michalska, M., Novosielski, W., Orleanski, P., Arnold, G., Hirsch,
H., Driesher, H., Lopez-Moreno, J., Rodrigo, R., Rodriguez-Gomez, J.,
Michel, G., 1997. PFS: a fourier spectrometer for the study of martian at-
mosphere. Adv. Space Res. 19, 1277-1280. https://doi.org/10.1016/
S0273-1177(97)00282-2.

Formisano, V., Atreya, S., Encrenaz, T., Ignatiev, N., Giuranna, M., 2004. De-
tection of methane in the atmosphere of Mars. Science 306, 1758-1761.
https://doi.org/10.1126/science.1101732.

Giuranna, M., Viscardy, S., Daerden, F., Neary, L., Etiope, G., Oehler, D.,
Formisano, V., Aronica, A., Wolkenberg, P., Aoki, S., Cardes ˜An-Moinelo,
A., Mar ˜An-Yaseli de la Parra, J., Merritt, D., Amoroso, M., 2019. Inde-
pendent conﬁrmation of a methane spike on Mars and a source region east
of Gale Crater, Nature Geoscience, 12, 326-332. https://doi.org/10.
1038/s41561-019-0331-9.

Gordon, I.E., Rothman, L.S., Hill, C., Kochanov, R.V., Tan, Y., Bernath,
P.F., Birk, M., Boudon, V., Campargue, A., Chance, K., Drouin, B.J.,
Flaud, J.-M., Gamache, R.R., Hodges, J.T., Jacquemart, D., Perevalov,
V.I., Perrin, A., Shine, K.P., Smith, M.A.H., Tennyson, J., Toon, G.C.,
Tran, H., Tyuterev, V.G., Barbe, A., Cszszar, A.G., Devi, V.M., Furten-
bacher, T., Harrison, J.J., Hartmann, J.-M., Jolly, A., Johnson, T.J., Kar-
man, T., Kleiner, I., Kyuberis, A.A., Loos, J., Lyulin, O.M., Massie, S.T.,
Mikhailenko, S.N., Moazzen-Ahmadi, N., Muller, H.S.P., Naumenko, O.V.,

14

Nikitin, A.V., Polyansky, O.L., Rey, M., Rotger, M., Sharpe, S.W., Sung, K.,
Starikova, E., Tashkun, S.A., Vander Auwera, J., Wagner, G., Wilzewski,
J., Wcislo, P., Yu, S., Zak, E.J., 2017. The HITRAN2016 molecular spec-
troscopic database. J. Quant. Spectrosc. Radiat. Transf. 203, 3-69. https:
//doi.org/10.1016/j.jqsrt.2017.06.038.

Haario, H., Laine, M., Mira, A., Saksman, E. 2006. DRAM: Eﬃcient adaptive
MCMC, Statistics and Computing, 16, 339. https://doi.org/10.1007/
s11222-006-9438-0.

Hastings, W.K., 1970. Monte Carlo Sampling Methods Using Markov Chains
and Their Applications, Biometrika, Vol. 57, No. 1, 97-109, 1970. https:
//www.jstor.org/stable/2334940.

Hollis, M. D. J., Tessenyi, M., Tinetti, G., 2013. Computer Physics Communi-
cations, 184, 2351. https://doi.org/10.1016/j.cpc.2013.05.011.
Irwin, P. G. J., Teanby, N. A., de Kok, R., Fletcher, L. N., Howett, C. J. A.,
Tsang, C. C. C., Wilson, C. F., Calcutt, S. B., Nixon, C. A., Parrish, P. D.
(2008). The NEMESIS planetary atmosphere radiative transfer and retrieval
tool. JQSRT, 109(6), 1136-1150. https://doi.org/10.1016/j.jqsrt.
2007.11.006.

Jacob, D.J., 2007. Models of Atmospheric Transport and Chemistry, Lectures
on Inverse Modeling, Harvard, 1-24. http://acmg.seas.harvard.edu/
education/jacob_lectures_inverse_modeling.pdf

Karney, C.F.F. Algorithms for geodesics. J Geod 87, 43-55 (2013). https:

//doi.org/10.1007/s00190-012-0578-z.

Kass, R.E. and Raftery, A.E., 1995. Bayes factors. Journal of the American
Statistical Association, Vol 90, No. 430, 773-795, (1995). http://www.
jstor.org/stable/2291091.

Kochanov, R.V., 2019. HITRAN Application Programming Interface (HAPI),
Harvard-Smithsonian Center for Astrophysics. https://hitran.org/
static/hapi/hapi_manual.pdf

Korablev, O., Vandaele, A.C., Montmessin, F., Fedorova, A.A., Trokhimovskiy,
A., Forget, F., Lef ˜A¨vre, F., Daerden, F., Thomas, I.R., Trompet, L., Er-
win, J.T., Aoki, S., Robert, S., Neary, L., Viscardy, S., Grigoriev, A.V.,
Ignatiev, N.I., Shakun, A., Patrakeev, A., Belyaev, D.A., Bertaux, Olsen,
K.S., Baggio, L., Alday, J., Ivanov, Y.S., Ristic, B., Mason, J., Willame,
Y., Depiesse, C., Hetey, L., Berkenbosch, S., Clairquin, R., Claudio, Q.,
Beeckman, B., Neefs, E., Patel, M.R., Bellucci, G., L ´opez-Moreno, J-J.,
Wilson, C.F., Etiope, G., Zelenyi, L., Svedhem, H., Vago, J.L., The ACS
and NOMAD Team, 2019. No detection of methane on Mars from early
ExoMars Trace Gas Orbiter observations. Nature, 568, 517-520. https:
//doi.org/10.1038/s41586-019-1096-4.

Krasnopolsky, V.A., Maillard, J.P., Owen, T.C., 2004. Detection of methane
in the martian atmosphere: evidence for life. Icarus 172, 537-547. https:
//doi.org/10.1016/j.icarus.2004.07.004.

Lee, J.-M., Heng, K., Irwin, P. G. J., 2007. Atmospheric retrieval analysis of
the directly imaged exoplanet HR 8799b, The Astrophysical Journal, 778,
97. https://doi.org/10.1088/0004-637x/778/2/97.

Lemoine, F., Smith, D., Rowlands, D., Zuber, M.T., Neumann, G.A., Chinn,
D.S., Pavlis, D.E., 2001. An Improved Solution of the Gravity Field of Mars
(GMM-2B) from Mars Global Surveyor. Journal of Geophysical Research
E: Planets. 106. https://doi.org/10.1029/2000JE001426.

Limaye, S.S., Mogul, R., Smith, D.J., Ansari, A.H., Slowik, G.P., Vaisham-
payan, P., 2018. Venus’ Spectral Signatures and the Potential for Life in the
Clouds, Astrobiology, Vol 18, Issue 9,1181-1198. https://doi.org/10.
1089/ast.2017.1783.

Liuzzi, G., Villanueva, G.L., Mumma, M.J., Smith, M.D., Daerden, F., Ris-
tic, B., Thomas, I., Vandaele, A.C., Patel, M.R., Lopez-Moreno, J-J., the
NOMAD team. Methane on Mars: New insights into the sensitivity of CH4
with the NOMAD/ExoMars spectrometer through its ﬁrst in-ﬂight calibra-
tion. Icarus 321, 671-690. https://10.1016/j.icarus.2018.09.021.
Mahaﬀy, P.R., Webster, C.R., Cabane, M., Conrad, P.G., Coll, P., Atreya, S.K.,
Arvey, R., Barciniak, M., Benna, M., Bleacher, L., Brinckerho , W.B.,
Eigenbrode, J.L., Carignan, D., Cascia, M., Chalmers, R.A., Dworkin, J.P.,
Errigo, T., Everson, P., Franz, H., Farley, R., Feng, S., Frazier, G., Freissinet,
C., Glavin, D.P., Harpold, D.N., Hawk, D., Holmes, V., Johnson, C.S.,
Jones, A., Jordan, P., Kellogg, J., Lewis, J., Lyness, E., Malespin, C.A., Mar-
tin, D.K., Maurer, J., McAdam, A.C., McLennan, D., Nolan, T.J., Noriega,
M., Pavlov, A.A., Prats, B., Raaen, E., Sheinman, O., Sheppard, D., Smith,
J., Stern, J.C., Tan, F., Trainer, M., Ming, D.W., Morris, R.V., Jones, J., Gun-
dersen, C., Steele, A., Wray, J., Botta, O., Leshin, L.A., Owen, T., Battel,
S., Jakosky, B.M., Manning, H., Squyres, S., Navarro-Gonzalez, R. McKay,
C.P., Raulin, F., Sternberg, R., Buch, A., Sorensen, P., Kline-Schoder, R.,

Coscia, D., Szopa, C., Teinturier, S., Ba es, C., Feldman, J., Flesch, G.,
Forouhar, S., Garcia, R., Keymeulen, D., Woodward, S., Block, B.P., Arnett,
K., Miller, R., Edmonson, C., Gorevan, S., Mumm, E., 2012. The Sample
Analysis at Mars Investigation and Instrument Suite. Space Sci. Rev. 170,
401-478. https://doi.org/10.1007/s11214-012-9879-z.

Metropolis, N., Rosenbluth, A.W., Rosenbluth, M.N., and Teller, A.H., 1953.
Equation of State Calculations by Fast Computing Machines, J. Chem. Phys.
21, 1087, 1953. https://doi.org/10.1063/1.1699114.

Millour, E., Forget, F., Spiga1, A., Vals, M., Zakharov, V., Montabone,
L., Lef ˜A¨vre, F., F. Montmessin, Chaufray,. J.-Y., L ´opez-Valverde, M.A.,
Gonz´alez-Galindo, F., Lewis, S.R., Read, P.L., Desjean, M.-C., Cipriani,
F., the MCD development team, 2018. The Mars Climate Database (Version
5.3). Scientiﬁc Workshop: From Mars Express to ExoMars. https://www.
cosmos.esa.int/documents/1499429/1583871/Millour_E.pdf.
Morozova, D., Mohlmann, D., Wagner, D., 2007. Survival of Methanogenic
Archaea from Siberian Permafrost under Simulated Martian Thermal Con-
ditions. Orig Life Evol Biosph 37, 189-200, 2007. https://doi.org/10.
1007/s11084-006-9024-7.

Mumma, M.J., Villanueva, G.L., Novak, R.E., Hewagama, T., Bonev, B.P., DiS-
anti, M.A., Mandell, A.M., Smith, M.D., 2009. Strong release of Methane
on Mars in northern summer 2003. Science 323, 1041-1045. https://doi.
org/10.1126/science.1165243.
Unusually

Curiosity
2019.
curiosity-detects-unusually-high-methane-levels.

Levels,
https://www.nasa.gov/feature/jpl/

Methane

Detects

NASA.

High

Neefs, E., Vandaele, A.C., Drummond, R., Thomas, I.R., Berkenbosch, S.,
Clairquin, R., Delanoye, S., Ristic, B., Maes, J., Bonnewijn, S., Pieck,
G., Equeter, E., Depiesse, C., Daerden, F., Ransbeeck, E.V., Nevejans, D.,
Rodriguez-Gomez, J., Lopez-Moreez, J.- J., Sanz, R., Morales, R., Can-
dini, G.P., Pastor-Morales, M.C., Aparicio del Moral, B., Jeronimo-Zafra,
J.-M., Gomez-Lopez, J.M., Alonso-Rodrigo, G., ,Perez-Grande I., Cubas,
J., Gomez-Sanjuan, A.M., Navarro-Medina, F., Thibert, T., Patel, M.R., Bel-
lucci, G., De Vos, L., Lesschaeve, S., Vooren, N.V., Moelans, W., Aballea,
L., Glorieux, S., Baeke, A., Kendall, D., De Neef, J., Soenen, A., Puech,
P.-Y., Ward, J., Jamoye, J.-F., Diez, D., Vicario-Arroyo, A., Jankowski, M.,
2015. NOMAD spectrometer on the ExoMars trace gas orbiter mission: part
1-design, manufacturing and testing of the infrared channels. Appl. Opt. 54,
8494. https://doi.org/10.1364/AO.54.008494.

Robert, S., Vandaele, A.C., Thomas, I., Willame, Y., Daerden, F., Delanoye,
S., Depiesse, C., Drummond, R., Neefs, E., Neary, L., Ristic, B., Mason, J.,
Lopez-Moreno, J.-J., Rodriguez-Gomez, J., Patel, M.R., Bellucci, G., 2016.
Expected performances of the NOMAD/ExoMars instrument. Planet. Space
Sci. 124, 94-104. https://doi.org/10.1016/j.pss.2016.03.003.
Rodgers, C.D., 2000. Inverse Methods for Atmospheric Sounding, Vol. 2,

World Scientiﬁc.

Skilling, J., 2006. Nested sampling for general Bayesian computation. Bayesian
Anal. 1, no. 4, 833-859. https://projecteuclid.org/euclid.ba/
1340370944

Summers, M.E., Lieb, B.J., Chapman, E., et al., 2002. Atmospheric biomarkers
ofsubsurface life on Mars. Geophys. Res. Lett. 29, 2171. https://doi.
org/10.1029/2002GL015377.

Thomas, I.R., Vandaele, A.C., Robert, S., Neefs, E., Drummond, R., Daerden,
F., Delanoye, S., Ristic, B., Berkenbosch, S., Clairquin, R., Maes, J., Bon-
newijn, S., Depiesse, C., Mahieux, A., Trompet, L., Neary, L., Willame,
Y., Wilquet, V., Nevejans, D., Aballea, L., Moelans, W., De Vos, L., Less-
chaeve, S., Van Vooren, N., Lopez-Moreno, J.-J., Patel, M.R., Bellucci, G.,
the NOMAD Team, 2016. Optical and radiometric models of the NOMAD
instrument part II: the infrared channels - SO and LNO. Opt. Express 24,
3790. https://doi.org/10.1364/OE.24.003790.

Thomas, I., Vandaele, A.C., Neefs, E., 2018. NOMAD Experiment to Archive
Interface Control Document, EXM-NO-ICD-AER-00001, Issue 1, Re-
vision 11. BIRA-IASB. http://mars.aeronomie.be/en/exomars/
observations/pages/EXM-NO-ICD-AER-00001-iss1rev11-EAICD_
NOMAD_181026.pdf.

Thomas, I., Vandaele, A.C., Neefs, E., 2019. HDF5 data pipeline, NO-
MAD Datasets and Calibration Steps. BIRA-IASB. https://nomad.
aeronomie.be/ProjectDir/data/nomad_hdf5_datasets.pdf.

Vandaele, A.C., Kruglanski, M., De Maziere, M., 2006. Modeling and re-
trieval of Atmospheric spectra using ASIMUT. European Space Agency,
(Special Publication) ESA SP. http://earth.esa.int/workshops/
EPS-MetOp-RAO-2006proceedings/papers/p-vande.pdf.

15

Vandaele, A.C., Neefs, E., Drummond, R., Thomas, I.R., Daerden, F., Lopez-
Moreno, J.- J., Rodriguez, J., Patel, M.R., Bellucci, G., Allen, M., Altieri,
F., Bolsee, D., Clancy, T., Delanoye, S., Depiesse, C., Cloutis, E., Fedorova,
A., Formisano, V., Funke, B., Fussen, D., Geminale, A., Gerard, J.-C., Giu-
ranna, M., Ignatiev, N., Kaminski, J., Karatekin, O., Lefevre, F., Lopez-
Puertas, M., Lopez-Valverde, M., Mahieux, A., McConnell, J., Mumma,
M., Neary, L., Renotte, E., Ristic, B., Robert, S., Smith, M., Trokhimovsky,
S., Vander Auwera, J., Villanueva, G., Whiteway, J., Wilquet, V., Wolﬀ,
M., and The NOMAD Team, 2015. Science objectives and performances of
NOMAD, a spectrometer suite for the ExoMars TGO mission. Planet. Space
Sci. 119, 233-249. https://doi.org/10.1016/j.pss.2015.10.003
Villanueva, G.L., Smith, M.D., Protopapa, S., Faggi, S., Mandell, A.M.,
2018. Planetary Spectrum Generator: An accurate online radiative trans-
fer suite for atmospheres, comets, small bodies and exoplanets. J. Quant.
Spectrosc. Radiat. Transf. 217, 86-104. https://doi.org/10.1016/j.
jqsrt.2018.05.023.

Vispoel, B., Fissiauxa, L., Lep`ere, M., 2019. CO2-broadening coeﬃcients in
the ν3 fundamental band of methane. Journal of Molecular Spectroscopy,
Vol. 360, 1-6. https://doi.org/10.1016/j.jms.2018.12.004.

J. H. Waite Jr., Combi, M.R., Ip, W.H., Cravens, T.E., McNutt, R.L. Jr.,
Kasprzak, W., Yelle, R., Luhmann, J., Niemann, H., Gell, D., Magee,
B., Fletcher, G., Lunine, J., Tseng, W.L., 2006. Science 311, 1419-1422.
https://doi.org/10.1126/science.1121290.

Waldmann, I.P., Tinetti, G., Rocchetto, M., Barton, E.J., Yurchenko, S.N.,
Tennyson, J., 2015. Tau-REx I: A next generation retrieval code for exo-
planetary atmospheres, The Astrophysics Journal, Volume 802, Number 2.
https://doi.org/10.1088/0004-637X/802/2/107

Webster, C.R., Maha y, P.R., Atreya, S.K., Flesch, G.J., Mischna, M.A., Meslin,
P.-Y., Farley, K.A., Conrad, P.G., Christensen, L.E., Pavlov, A.A., Martin-
Torres, J., Zorzano, M.-P., McConnochie, T.H., Owen, T., Eigenbrode, J.L.,
Glavin, D.P., Steele, A., Malespin, C.A., Archer, P.D., Sutter, B., Coll, P.,
Freissinet, C., McKay, C.P., Moores, J.E., Schwenzer, S.P., Bridges, J.C.,
Navarro-Gonzalez, R., Gellert, R., Lemmon, M.T., Team, theM.S., 2015.
Mars methane detection and variability at Gale crater. Science 347, 415-417.
https://doi.org/10.1126/science.1261713.

Webster, C.R., Maha y, P.R., Atreya, S.K., Moores, J.E., Flesch, G.J., Male-
spin, C., McKay, C.P., Martinez, G., Smith, C.L., Martin-Torres, J., Gomez-
Elvira, J., Zorzano, M.-P., Wong, M.H., Trainer, M.G., Steele, A., Archer,
D., Sutter, B., Coll, P.J., Freissinet, C., Meslin, P.-Y., Gough, R.V., House,
C.H., Pavlov, A., Eigenbrode, J.L., Glavin, D.P., Pearson, J.C., Keymeulen,
D., Christensen, L.E., Schwenzer, S.P., Navarro-Gonzalez, R., Pla-Garcia J.,
Rafkin, S.C.R., Vicente-Retortillo, A., Kahanpaa, H., Viudez- Moreiras, D.,
Smith, M.D., Harri, A.-M., Genzer, M., Hassler, D.M., Lemmon, M., Crisp,
J., Sander, S.P., Zurek, R.W., Vasavada, A.R., 2018. Background levels of
methane in Mars atmosphere show strong seasonal variations. Science 360,
1093-1096. https://doi.org/10.1126/science.aaq0131.

Yung, Y.L., Chen, P., Nealson, K., Atreya, S., Beckett, P., Blank, J.G., Ehlmann,
B., Eiler, J., Etiope, G., Ferry, J.G., Forget, F., Gao, P., Hu, R., Klein-
bohl, A., Klusman, R., Lefevre, F., Miller, C., Mischna, M., Mumma,
M., Newman, S., Oehler, D., Okumura, M., Oremland, R., Orphan, V.,
Popa, R., Russell, M., Shen, L., Lollar, B.S., Staehle, R., Stamenkovic, V.,
Stolper, D., Templeton, A., Vandaele, A.C., Viscardy, S., Webster, C.R.,
Wennberg, P.O., Wong, M.L., Worden, J., 2018. Methane on Mars and
Habitability: Challenges and Responses, Astrobiology, Vol 18, 1221-1242.
http://doi.org/10.1089/ast.2018.1917.

Yurchenko, S.N., Al-Refaie, A.F., Tennyson, J., 2018. EXOCROSS: a general
program for generating spectra from molecular line lists. Astronomy and
Astrophysics, Vol. 614, A131. https://doi.org/10.1051/0004-6361/
201732531.

Appendix A. NOMAD Noise Model

Real NOMAD SO channel data will include noise, therefore
in order to test the ability of Ares to perform retrievals on sim-
ulated NOMAD SO observations, a module for computing the
expected noise is included. A fundamental component of Ares
is the NomadNoise class. This class considers all the sources of
noise present within NOMAD observations. As stated in Neefs

et al. (2015), the noise of the channels is the sum of the diﬀer-
ent noise contributions, given by the following,

N = Ndark + Nro + Nquant + Nshot + Ntb.

(A.1)

The following list explains in detail the aforementioned

sources of noise:

1. The dark current noise, Ndark, is a ﬁxed source of noise,
measured in electrons per pixel per second. The assumed
value of the dark current for NOMAD IR channels is
6000 e−pixels−1s−1. Ndark is given by,

Ndark =

√

6000∆t.

(A.2)

where ∆t is the integration time. Integration time meta-
data is given with NOMAD observations.

2. The readout noise, Nro, is a ﬁxed source of noise due
to the detector readout, measured in pixels per second
per observation. For the MARS-MW detector, in SO and
LNO channels, Nro is given by,

Nro ≈ 1000 e−pixel−1.

(A.3)

3. The thermal background noise, Ntb, is the noise in the de-
tector produced by the thermal background. Ntb is given
by,

Ntb(i) = (cid:112)

S tb(i).

(A.4)

where S tb(i) represents the electrons generated in detec-
tor pixel i due to thermal emission coming from the in-
strument. Whilst Ntb is challenging to simulate, Liuzzi
et al.
(2019), provides a set of expected thermal back-
ground noise values given a set of NOMAD instrument
temperatures. At 263K Ntb = 1.5 × 107 e−s−1, at 273K
Ntb = 3.0 × 107 e−s−1 and at 283K Ntb = 4.0 × 107 e−s−1.
4. The quantization noise, Nquant, is due to the ﬁnite number
of bits used for analogue-to-digital encoding of the signal
detected by the detector chip. Nquant is calculated as,

Nquant =

√

S FWC(i)

12 · 2nbits

(cid:16) ∆VADC,usable
∆VADC,max

(cid:17) .

(A.5)

S FWC(i) is the full well capacity of the detector pixel
i. ∆VADC,usable corresponds to the usable voltage range
of the analogue-to-digital converter and ∆VADC,max is the
converters maximum voltage range. For NOMAD S FWC(i) =
3.7 × 107, ∆VADC,max = 5 V, ∆VADC,usable = 3.78 V and
nbits = 14. As all terms are deﬁned, Nquant can be calcu-
lated as,

Nquant =

√

3.7 × 107
12 · 214

(cid:16) 3.78
5.0

(cid:17) = 862.3 e−pixel−1 (1d.p.).

(A.6)
5. The shot noise, Nshot, is the noise resulting from the sig-
nal photons impacting the detector. Nshot is given by,

Nshot = (cid:112)

S electrons(i).

(A.7)

16

In the model applied, Thomas et al.
(2016), ﬂux is cal-
culated one diﬀraction order at a time. Flux outside the
gratings full spectral range are ignored as they are ac-
counted for by the adjacent orders. The number of elec-
trons S (i) generated in a detector pixel during integration
time ∆t is given by,

S electrons(i) = λi
hc

τdet(λi)EQ(λi)S (λi)∆t

(A.8)

.
λi is the wavelength corresponding to pixel i, EQ(λi) is
the quantum eﬃciency of the detector and τdet is the sen-
sitivity of the detector of the given wavelength, including
responsivity, cold ﬁlter transmission and detector win-
dow transmission.

S (λ) =

apπ
4(F/#)

∆λWslitτopt(λ)R(λ).

(A.9)

F/# is the channels’s F-number and ap is the area of one
detector pixel, ∆λ is the pixel spectral bandwidth, Wslit
is the slit width, R(λ) is the incoming radiance, τopt(λ) is
transmission of the optics, which is the product of the
transmission properties of all the optics, including the
mirrors, lenses, AOTF (τopt(AOT F)), angular dependency
and the echelle grating blaze function.
Although stated earlier, a clear distinction should be made
between S electrons,n and S electrons(i), both are diﬀerent
sources of electrons. S (λ) and subsequently S electrons are
used to simulate the shot noise, Nshot.

Appendix A.0.1. Thermal emission model

The thermal emission model employed in Ares follows that
of Thomas et al.
(2016). The total thermal background is dif-
ﬁcult to calculate give that all components of NOMAD act as a
blackbody radiation source, emitting thermal photons. Whilst
no distinction is made in the thermal background estimation
section of Thomas et al.
(2016) it is stated that all the com-
ponents are assumed to be at the same temperature as the in-
strument. Optical components within NOMAD are attached to
a thermally conductive baseplate away from the heat generating
central electronics board. Because of this the temperature of the
optical parts, should not deviate more than a few degrees from
the main instrument body. The calculation of the thermal back-
ground estimation is split into three ordered sections and is run
for each detector pixel individually in the following manner:

1. From the optical components before the AOTF.
2. From the AOTF to the slit.
3. From the slit to the detector.

The thermal background contribution is modelled using the
Planck function, and expressed as the power emitted per unit
area per solid angle of NOMAD’s component surface, at a given
wavelength λ and temperature T :

B(λ, T ) = 2hc
λ5





1
exp( hc
λkbT ) − 1



 .

(A.10)

17

The number of emission generated electrons per wavelength,

λ, from surface n is therefore given by,

S e−,n(λ, Tn) = εn(λ)B(λ, Tn)

(cid:19)

(cid:18) λ
hc

AΩ





m(cid:89)

j=n+1





τ j(λ)

ER(λ)∆t,

(A.11)
is the energy of a pho-

(cid:17)

(cid:16) λ
hc

where εn(λ) is the surface emissivity,
ton of wavelength λ. AΩ is the instrument entendue. (cid:81)m
is the cumulative transmission of all m optical elements be-
tween the surface and the pixel, EQ(λ) is the quantum eﬃciency
of the detector and ∆t is the observation time.

j=n+1 τ j(λ)

Firstly, the signal in electrons in the detector pixel i by ther-
mal emission before the AOTF can be calculated as follows,
summed over the n optical components, before the AOTF, and
is given by,

(cid:88)

S tb1(i) =

n

(cid:32) S electrons,n(λi+1, Tn) + S electrons,n(λi, Tn)
2

(cid:33)

(λi+1−λi).

(A.12)
Secondly, for components between the AOTF and the slit,
the calculation becomes more complex, as all diﬀraction orders
x need to be accounted for. For components between the AOTF
and the slit, the thermal background noise is given by,

(cid:88)

∞(cid:88)

S tb2(i) =

n

x=0
× (λx,i+1 − λx,i).

(cid:32) S electrons,n(λx,i+1, Tn)S electrons,n(λx,i, Tn)
2

(cid:33)

(A.13)
Thirdly, for the grating and components after the slit the

signal in electrons is given by,

S tb3(i) =

(cid:90) ∞

(cid:88)

λ=0

n

S electrons,n(λ, Tn).

(A.14)

Therefore, the total number of electrons generated in detec-
tor pixel i due to the thermal emission from NOMAD is given
by,

S tb(i) =

3(cid:88)

j=1

S tbj(i).

(A.15)

The optical design of the NOMAD SO channel is such that
it is composed of 7 elements, namely, the entrance optics, the
AOTF ﬁlter, the spectrometer entrance slit, the collimating /
imaging parabolic mirror, the echelle grating, the folding mirror
and the detector. Returning to the problem of simulating Nshot
and Ntb, we are faced with the challenge of deﬁning all of the
aforementioned terms.

As stated earlier, the signal arriving on the detector can be

expressed as,

S (λ) =

apπ
4(F/#)

∆λWslitτopt(λ)R(λ).

(A.16)

The term R(λ) is the incoming radiance from the Sun at
Mars distance. This term is simulated with the Ares forward

model. τopt is the transmission of the optics, and is a product of
the optics, mirrors, lenses, AOTF (τAOTF), the angular depen-
dency and the echelle grating blaze function, given by,

τopt(λ) =

m(cid:89)

j=n+1

τ j(λ).

(A.17)

shield aperture as f /3.936. a is the area of one detector pixel,
which Neefs et al. (2015) gives as 30 × 30 µm2. ∆λ is the pixel
spectral bandwidth, which can be determined from Equation 1
of Liuzzi et al. (2019). The size of the slit in the NOMAD SO
channel is 60 µm × 900 µm, therefore Wslit = 60 µm.

F/# is the channel’s F-number, the F-number of an optical
system is the ratio of the system’s focal length to the diameter
of the entrance aperture. The F-number is commonly indicated
with the f /N format where N is the F-number. For NOMAD
SO the limiting F-number is f /5.12, Neefs et al. (2015). Note
that in Table 10 of Neefs et al. (2015) this is given for the cold

Appendix B. Glossary

Appendix C. Abbreviations

Appendix D. Chemical Species

18

Variable
m
p
ν
F0,F1, F2
G0,G1, G2
A
T F
ν0
w
IG
ρG
q,n
I0
Fsinc
Fgauss
Fcntmn
Fblaze
p0
wp
I0,I1
PEC
PE
δm
AOT F

R(A, νm)
R( j, νj)
νj
nlat-lon
nlayers
rs
ϕs
θs
(xs,ys,zs)
(xt,yt,zt)
∈
∀
rMars
y
x
b
F(x, b)
(cid:15)
λ
kB
τ
P(x, M)
P(y, M)
P(y|x, M)
P(x|y, M)
0
∇x
l(z)
Nm
Tλ

Appendix B. Glossary

Description
AOTF diﬀraction order number.
Pixel number, p ∈ [0, 319].
Wavenumber in cm−1
NOMAD SO p, ν, m relation coeﬃcients.
NOMAD SO tuning relation coeﬃcients.
AOTF frequency.
AOTF transfer function.
AOTF transfer function centre in cm−1.
First zero crossing of sinc-squared function.
Gaussian amplitude of the AOTF transfer function.
Gaussian standard deviation of the AOTF transfer function.
AOTF transfer function continuum oﬀset parameters.
Sinc-squared amplitude of the AOTF transfer function.
AOTF transfer function sinc-squared contribution.
AOTF transfer function Gaussian contribution.
AOTF transfer function continuum contribution.
Blaze function.
Blaze function pixel centre in pixel units.
Blaze function width.
Blaze function p0 relation coeﬃcient.
Partial Elements Continuum.
A Partial Element of the PEC.
A discrete change in diﬀraction order m.
AOTF transfer function at the AOTF frequency A, for spectral grid
ν j of diﬀraction order j.
Observed Radiance by the NOMAD SO channel.
Signal terms.
Spectral grid of diﬀraction order j
Ares Geometry module grid point number.
Number of atmospheric layers.
TGO observation altitude.
TGO sub-observation longitude.
TGO sub-observation latitude.
TGO Cartesian coordinate.
Tangent point Cartesian coordinates.
Set membership, read as is an element of.
Universal quantiﬁer, read as for all.
Mars radius in km.
Measurement vector.
State vector.
Parameter vector.
Forward model.
Error vector in the forward model
Wavelength.
Boltzmann constant.
Optical depth.
pdf of x for atmospheric forward model M.
pdf of y for atmospheric forward model M.
pdf of y given x for atmospheric forward model M.
a posteriori pdf of x given y for atmospheric forward model M.
Zero vector.
Gradient operator for x.
Optical path length.
Total number of absorbing species.
Monochromatic transmittance at wavelength λ.

19

Example Equation(s)
1
1
1
1
1
2
3
3
3
3
3
3
4
4
5
6
7
7
7
8
9
9
9
10

11
11
10,11,12

13,14,15
13,14,15
13,14,15
13,14,15

18
22,28,29,30,31,32
22,28,29,30,31,32
22
22
22
23,24,25,26,29
A.10

28,30
28,30
28
29
31
31
24
25
26

Variable
dl j
a,b,c
rMars,p
rMars,e
f
∆zi
N
Ndark
Nshot
Nro
Nquant
Ntb
∆t
S tb(i)

S FWC(i)
∆VADC,usable
∆VADC,max
S electrons(i) = S (i)

λi
EQ(λi)
τdet(λi)
F/#
ap
∆λ
Wslit
R(λ)
τopt(λ)
τopt(AOT F)
S electrons,n = S e−,n

(cid:81)m

j=n+1 τ j(λ)

EQ(λ)
∆t
S tb1(i)

S tb2(i)

S tb3(i)

Iλ(z)
Iλ(0)

τλ(z)
εn(λ)
AΩ
T
h
c
B(λ, T )
ζm(λ)
χm(z)
τλ(z)

Appendix B. Glossary (Continued)

Description
Atmospheric path lengths.
Ellipsoid coeﬃcients.
Mars polar radius in km.
Mars equatorial radius in km.
Ellipsoid ﬂattening ratio.
Height of atmospheric layer i above the surface ellipsoid.
NOMAD total noise contributions.
Dark noise.
Shot noise.
Readout noise.
Quantisation noise.
Thermal background noise.
Integration time in seconds.
Total number of electrons generated in detector pixel i due to in-
strument thermal emission.
Detector pixel i full-well-capacity.
Usable voltage range of the analogue-to-digital converter.
Maximum voltage range of the analogue-to-digital converter.
Number of electrons generated in detector pixel i during integra-
tion time, associate with calculating Nshot.
Wavelength corresponding to pixel i.
Detector quantum eﬃciency at lambdai.
Detector sensitivity at wavelength λi.
Channel F-number.
Area of one detector pixel.
Pixel spectral bandwidth.
Detector slit width.
Incoming radiance.
Detector optics transmission.
AOTF optics transmission.
The number of emission generated electrons per wavelength λ
from surface n.
Cumulative transmission of all m optical elements between the
surface and the pixel.
Quantum eﬃciency of the detector.
Observation time.
Detector pixel i thermal emission signal in electrons before the
AOTF.
Detector pixel i thermal emission signal in electrons between
AOTF and slit.
Detector pixel i thermal emission signal in electrons between slit,
grating and components.
The monochromatic intensity of radiation passing through a gas.
The monochromatic intensity of radiation at the top of the atmo-
sphere.
Medium optical depth at altitude z.

Example Equation(s)

17
18
18
18
19,20,21
A.1
A.1,A.2
A.1,A.7
A.1,A.3
A.1,A.5,A.6
A.1
A.2
A.4

A.5
A.5
A.5
A.7

A.8
A.8
A.8
A.9

A.9

A.9

A.11

A.11

A.11
A.11
A.12

A.13

A.14

NOMAD instrument entendue.
Temperature in Kelvin (K).
Planck constant.
Speed of light in a vacuum.
Planck function.
Absorption cross-section at wavelength λ.
Atmospheric column density for molecule m.
Total optical depth. 25

20

A.11

A.8,A.10,A.11
A.8,A.10,A.11
A.10
24
24

Variable
NOMAD
TGO
ESA
ppmv
ppbv
pptv
RTM
MSL
SAM
TLS
FTS
RTE
MAP
MCD
PSA
GCM
NASA
BIRA-IASB
ILS
HDF
SNR
XML
AOTF
EAICD
SO
LNO
PFS
MCMC
LOS
VMR
UVIS
FWHM
PSG
MGS
MOLA
DSK
API
HAPI
NEMESIS

Appendix C. Abbreviations

Description
Nadir and Occultation for MAars Discovery
Trace Gas Orbiter
European Space Agency
parts per million per unit volume
parts per billion per unit volume
parts per trillion per unit volume
Radiative Transfer Model
Mars Science Laboratory
Sample Analysis at Mars
Tunable Laser Spectrometer
Fourier Transform Spectrometer
Raditive Transfer Equation
Maximum A Posteriori
Mars Climate Database
Planetary Science Archive
Global Climate Model
National Aeronautics and Space Administration
The Royal Belgian Institute for Space Aeronomy
Instrument Line Shape
Hierarchical Data Format
Signal to Noise Ratio
Xtensible Markup Language
Acousto Optic Tunable Filter
Experiment to Archive Interface Document
Solar Occultation
Limb Nadir Occultation
PFlanetary Fourier Spectrometer
Markov Chain Monte Carlo
Line Of Sight
Volume Mixing Ratio
Ultra Violet Infrared Spectrometer
Full Width Half Maximum
Planetary Spectrum Generator
Mars Global Surveyor
Mars Orbiter Laser Altimeter
Digital Shape Kernel
Application Programming Interface
Hitran Application Programming Interface
Non-linear Optimal Estimator for MultivariatE Spectral.
AnalySIS.

21

Symbol
HCN
OCS
SO2
NH3
HO2
HCl
H2S
H2CO
N2O
NO2
C2H4
C2H2
HDO
CH4
C2H6
C3H8
δ13C
δ2H
CO
CO2
H2O
O3

Appendix D. Chemical Species

Description
Hydrogen Cyanide
Carbonyl Sulﬁde
Sulfur Dioxide
Ammonia
Hydroperoxyl
Hydrogen Chloride
Hydrogen Sulﬁde
Formaldehyde
Nitrous Oxide
Nitrogen Dioxide
Ethylene (Ethene)
Acetylene (Ethyne)
Deuterium Oxide (Heavy water)
Methane
Ethane
Propane
Delta Carbon Thirteen
D/H ratio
Carbon Monoxide
Carbon Dioxide
Water
Ozone

22

