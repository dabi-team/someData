Astronomy & Astrophysics manuscript no. main
July 14, 2022

©ESO 2022

2
2
0
2

l
u
J

3
1

]

R
S
.
h
p
-
o
r
t
s
a
[

1
v
0
0
9
5
0
.
7
0
2
2
:
v
i
X
r
a

Bayesian approach for modeling solar active region global
magnetic parameters

M. Poisson1, F. Grings1, C.H. Mandrini1, M. López-Fuentes1, and P. Démoulin2, 3

1 Instituto de Astronomía y Física del espacio (CONICET-UBA), Buenos Aires and CC. 67, Suc. 28, 1428, Argentina. e-mail:

mpoisson@iafe.uba.ar

2 LESIA, Observatoire de Paris, Université PSL, CNRS, Sorbonne Université, Univ. Paris Diderot, Sorbonne Paris Cité, 5 place Jules

Janssen, 92195 Meudon, France.

3 Laboratoire Cogitamus, rue Descartes, 75005 Paris, France.

Received date / Accepted date

ABSTRACT

Context. Active regions (ARs) appear in the solar atmosphere as a consequence of the emergence of magnetic ﬂux tubes. The presence
of elongated magnetic polarities in line-of-sight (LOS) magnetograms indicates the existence of twist in the ﬂux tubes forming them.
These polarity elongations, called magnetic tongues, bias the measurement of AR characteristics obtained during their emergence
phase (e.g. their tilt angle and magnetic ﬂux, among others). In particular, obtaining a good estimation of the tilt angle evolution plays
a key role in constraining ﬂux-transport dynamo models.
Aims. In this work we aim to estimate the intrinsic properties of the twisted ﬂux tubes, or ﬂux ropes, that form ARs by quantitatively
comparing observed LOS magnetograms with synthetic ones derived from a toroidal magnetic ﬂux tube model.
Methods. For this reason, we develop a Bayesian inference method to obtain the statistical distributions of the inferred model param-
eters. As an example, we apply the method to NOAA AR 10268. Next, we test the results using a synthetic-AR generator to quantify
the eﬀect of small scale perturbations over the inferred parameter distributions.
Results. We conclude that this method can signiﬁcantly remove the eﬀects of magnetic tongues on the derived AR global character-
istics, providing a better knowledge of the intrinsic properties of the emerging ﬂux rope.
Conclusions. These results provide a framework for future analysis of the physical properties of emerging ARs using Bayesian
statistics.

Key words. Sun: magnetic ﬁelds – Sun: photosphere – methods: statistical

1. Introduction

Active regions (ARs) appear in the solar photosphere as concen-
trated and compact magnetic ﬁeld distributions. Their origin can
be explained by a dynamo mechanism acting at the bottom of
the convective zone (CZ), where the magnetic ﬂux is ampliﬁed
and its structure is distorted (Fan 2009). Magnetohydrodynamic
(MHD) numerical simulations show that a buoyant instability
process can create coherent magnetic ﬂux tubes that rise from
the deep layers of the CZ out to the solar atmosphere (Weber
et al. 2013). These simulations proved that the magnetic ﬂux
tubes should be twisted, forming ﬂux ropes (FRs), in order to
maintain their cohesion against the plasma vortexes that develop
in their wakes (Emonet & Moreno-Insertis 1998; Abbett et al.
2001; Martínez-Sykora et al. 2015).

In general, the photospheric line-of-sight (LOS) magnetic
ﬁeld of ARs displays a bipolar conﬁguration. Several asymme-
tries are observed in the AR polarities as a consequence of the
emergence process and the twist of the FRs. The so-called mag-
netic tongues observed in LOS magnetograms are an evidence
of the twist of the emerging FRs. They are characterized by the
elongation of the magnetic polarities and the inclination of the
polarity inversion line (PIL) with respect to the perpendicular
direction to the bipole axis (an axis pointing from the follow-
ing to the leading polarity centers). The magnetic ﬂux distribu-
tion observed in LOS magnetograms is a combination of both

the axial and the azimuthal ﬁeld components projected in the
LOS direction. During the emergence of the FR, the axial ﬁeld
component is associated to the formation of two main magnetic
polarities which separate as the AR evolves. The azimuthal com-
ponent, which is orthogonal to the axial component, introduces
an asymmetric extension of the magnetic polarities which re-
ceive the name of magnetic tongues. They are longer and they
have a larger magnetic ﬂux as the emerging ﬂux tube is more
twisted (López Fuentes et al. 2000; Luoni et al. 2011). This pro-
jection eﬀect is stronger during the emergence phase of the AR
and has been reported in many diﬀerent works (see, e.g., Luoni
et al. 2011; Mandrini et al. 2014; Valori et al. 2015; Yardley et al.
2016; Vemareddy & Démoulin 2017; Dacie et al. 2018; López
Fuentes et al. 2018). Tongues are also present in MHD simula-
tions of FR emergence (Archontis & Hood 2010; Cheung et al.
2010; MacTaggart 2011; Jouve et al. 2013; Rempel & Cheung
2014; Takasao et al. 2015).

Another important property of the emerging FRs is their tilt
angle, deﬁned as the inclination of the bipole axis with respect
to the east-west direction. Observations show a tendency of the
leading polarity of ARs to be located closer to the solar equator
relative to the following polarity, the so-called Joy’s Law (Hale
et al. 1919). The latitudinal distribution of the tilt (see the review
by van Driel-Gesztelyi & Green 2015, and references therein)
plays a central role in ﬂux-transport dynamo models as a fun-

Article number, page 1 of 14

 
 
 
 
 
 
A&A proofs: manuscript no. main

damental ingredient for the formation and evolution of the polar
ﬁeld (see the review by Wang 2017, and references therein).

There has been an important eﬀort over the past few years
to characterize the tilt of ARs with a variety of results (Li & Ul-
rich 2012; McClintock & Norton 2013; McClintock et al. 2014;
Wang et al. 2015; Tlatova et al. 2018). Tilt angles can be de-
rived with diﬀerent methods depending on the available obser-
vations. The longest databases correspond to white-light (WL)
photographic observations (see e.g., Howard et al. 1984; Sivara-
man et al. 1993; Baranyi et al. 2016). The WL tilt can be ob-
tained by grouping sunspot umbrae (penumbrae) as leading or
following polarities, according to their east-west position, and
then computing the area-weighted center of each group. Due to
the fact that sunspots and pores are present in the strongest mag-
netic ﬁelds, strong magnetic tongues are also expected to modify
WL images (Poisson et al. 2020).

The use of LOS magnetograms provides a more precise sep-
aration between leading and following polarities than WL data.
The mean location of each main magnetic polarity can be ob-
tained by computing the ﬂux-weighted center of each polar-
ity distribution (i.e., the magnetic barycenters). During the AR
emergence, the elongation of the magnetic polarities produces
an asymmetry of the ﬂux concentrations on each polarity that
shifts the location of the magnetic barycenters towards the PIL,
modifying therefore the tilt-angle measurements done directly
on LOS magnetograms. In other words, the azimuthal ﬁeld com-
ponent, responsible of the magnetic tongues, systematically af-
fect the estimation of the tilt angle in the early stages of the AR
evolution. In Poisson et al. (2020) we developed a method, called
Core Field Fit Estimator (CoFFE) that succeeds to remove most
of the eﬀect of magnetic tongues on the computation of the lo-
cation of the magnetic barycenters and, hence, allows to obtain
an AR tilt-angle that better represents the FR intrinsic tilt.

In this work we aim to obtain AR global magnetic parame-
ters by modeling LOS magnetograms of an emerging AR with
synthetic magnetograms generated from a half-torus model. The
inferred parameters can provide a better estimation of the FR in-
trinsic properties, reducing the eﬀect of the magnetic tongues,
since the elongation of the polarities produced by the presence
of twist is inherent to our model.

In Sect. 2 we describe the LOS magnetograms used, the
AR selection criteria, and the AR example selected. Sect. 3
summarizes the half-torus model and describes how the syn-
thetic magnetograms are built. In Sect. 4 we ﬁrst introduce the
Bayesian probabilistic method and describe the tools used to
sample the model parameter space. Next, we apply this method
to infer model parameters from AR 10268 observed magne-
tograms. Sect. 5 presents an AR simulator used to explore the
limitations of the proposed method. Finally, we discuss and con-
clude on the method implications and its applicability to solar
data in Sect. 6.

2. Data description and processing

We use full-disk LOS magnetograms obtained with the Michel-
son Doppler Imager (MDI) on board the Solar and Heliospheric
Observatory (SOHO). These magnetograms are constructed on
board SOHO by measuring the Zeeman eﬀect in right and
left circularly polarized light. The magnetograms from the 96-
minute series, obtained from 5-minute averaged magnetograms,
have a lower noise level than the 1-hour series and an error per
pixel of ≈ 9 G (Liu et al. 2004). These magnetograms have
a spatial resolution of 1.98(cid:48)(cid:48) and are obtained using a CCD of
1024 × 1024 pixels.

Article number, page 2 of 14

Fig. 1. LOS magnetograms corresponding to AR 10268 at four diﬀerent
stages of its emergence. The red- and blue-shaded areas represent the
positive and the negative LOS magnetic ﬁeld component. The red (blue)
contours correspond to positive (negative) magnetic ﬁeld with a strength
of 20 G (−20 G) and 500 G (−500 G). The magnetograms are limited
to square regions adjusted to the evolution of the AR extension.

From the full-disk magnetograms we select the area contain-
ing NOAA AR 10268, covering its full observed emergence cor-
responding to 66 magnetograms along 5 days of observations.
We limit the latitudinal and longitudinal range of the selected
AR within −35◦ to 35◦ from disk center to reduce the projection
eﬀect of the LOS magnetic ﬁeld component when the observa-
tions are close to the solar limb. Panel (a) of the movie mov-
ﬁg3.mp4 in the supplementary material shows the evolution of
the AR with a cadence of 192 minutes between January 22 and
26, 2003.

AR 10268 presents a long persistent emergence and it main-
tains its bipolar conﬁguration along its full evolution. Along
the analyzed time span the AR is classiﬁed mainly as a β−type
AR. On January 25 a diﬀerent classiﬁcation is provided by the
NOAA/USAF Active Region Summary,
indicating a βδ−type
AR; this does not agree with the observed magnetograms be-
cause AR 10268 maintains its simple bipolar conﬁguration. A
direct comparison between magnetograms and MDI white light
images shows that all the regions where umbrae share the same
penumbra have the same polarity sign, therefore they not corre-
spond to a δ−type classiﬁcation.

Despite the asymmetry between the leading and following
polarities, the tongues are clearly identiﬁed with an elongated
pattern associated with the emergence of a negative twisted FR
(Fig. 1). We also see a sustained rotation of the bipole, suggest-
ing a consistent variation of the intrinsic tilt angle or/and the ef-
fect of the continued contraction of the magnetic tongues along
the emergence (see movie mov-ﬁg3.mp4).

We process the AR magnetograms to construct a data cube
using a time step of 192 minutes (that is, we use one third
of the available magnetograms). We decrease the number of
magnetograms to reduce the computational time required for
each method. This is admissible, since the data cadence has a

050100x (arcsec)020406080100120y (arcsec)(a)Mag 2050100x (arcsec)020406080100120y (arcsec)(b)Mag 10050100x (arcsec)020406080100120y (arcsec)(c)Mag 15050100x (arcsec)020406080100120y (arcsec)(d)Mag 2120001000010002000Bz (G)Poisson et al.: Modeling solar active region global magnetic parameters

weak/negligible eﬀect on the results of the method described in
Sect. 4. Using standard SolarSoftWare (SSW) tools, we trans-
form the LOS component of the magnetic ﬁeld to the solar radial
direction. Since we limit the longitudinal and latitudinal span of
the observations, the latter approximation produces no signiﬁ-
cant eﬀect on the resulting magnetic ﬂux density (Green et al.
2003). Finally, we rotate the set of magnetograms to the time
when the AR was located at the central meridian. This proce-
dure corrects for the solar diﬀerential rotation using the coeﬃ-
cients derived by Howard et al. (1990). As a ﬁnal step, we select
a sub-region which encompasses the AR reducing as much as
possible the surrounding magnetic ﬁeld.

3. Half-torus analytical model

The FR model, developed by Luoni et al. (2011), and brieﬂy
described here in Appendix A, provides an approximate repre-
sentation of the global photospheric magnetic ﬁeld distribution
observed during the emergence of bipolar ARs. It consists of
a half-torus ﬁeld structure with uniform twist (both along and
across its axis) that is set to progressively emerge through the
photosphere without distortion (see Fig. A.1 and the Appendix
in Poisson et al. 2016). For its simplicity, the model does not
include the deformations and reconnections occurring during its
emergence, or any interaction between the magnetic ﬁeld and the
plasma. Still, it was shown that this model is a powerful and fast
tool to represent the global properties of bipolar ARs (Poisson
et al. 2015b, 2020).

The model is strictly sub-photospheric and its application
is limited to reproduce only global aspects of the photospheric
magnetic ﬂux distribution of β-type ARs. More complex ARs
(e.g., those including δ-spots) cannot be reproduced with a sin-
gle toroidal FR deﬁned by the half-torus model, unless the par-
ticular characteristics of the AR allow a separation in diﬀerent
individual bipoles. This work aims to analyze global aspect of
simple bipolar ARs (β-type ARs), which correspond to the most
commonly observed ones during any stage of the solar cycle
(Nikbakhsh et al. 2019).

The FR model construction is based on a set of free param-
eters. The half-torus model has three dimensional and one non-
dimensional parameters, as follows. The small radius a and the
large radius R are associated with the size of the main polari-
ties and the distance between their barycenters, respectively. The
maximum ﬁeld strength (at the axis of the torus) is deﬁned by
B0 in Gaussian units. The sign and amount of magnetic twist is
given by imposing the non-dimensional parameter Nt, or twist
number, corresponding to the number of turns of magnetic ﬁeld
lines around half of the torus axis (see Figure 2 in Luoni et al.
2011). For a better understanding of these parameters, we add
a sketch in Appendix A together with the equations of the axial
and azimuthal ﬁeld components of the model.

In order to produce synthetic magnetograms we cut the half
torus with successive planes, each of which corresponds to the
relative position of the photospheric plane as the FR emerges.
We deﬁne the z axis as the normal to the photospheric planes.
For each particular magnetogram, z = 0 corresponds to the lo-
cation of the photospheric plane. The torus axis of revolution
(i.e., the half-torus base) is set at a depth z = −d (see Fig. A.1
in Appendix A). The computation of the ﬁeld component Bz
at z = 0, for diﬀerent values of d, produces a series of mag-
netograms that are determined by the values of the ﬁve model
parameters: (a,R,Nt,B0,d). Moreover, since the model applies to
observed ARs, we need three additional parameters to deﬁne the
position and the orientation of the FR within the magnetogram.

Therefore, we include the parameters xc and yc, which indicate
the mean point between the main polarities in Cartesian coor-
dinates in the magnetogram frame (x and y for the east-west
and the south-north directions, respectively). The last parame-
ter is the FR tilt φ, deﬁned as the inclination of the polarities
with respect to the east-west direction. Finally, we deﬁne Mpi
as the synthetic magnetogram obtained with the set of parame-
ters pi = [a(i), R(i), N(i)
c , y(i)
0 , d(i), x(i)
c , φ(i)], where the index i
t
corresponds to a given set of parameters.

, B(i)

The depth d can be normalized using the torus size as fol-
lows. We use the apex distance, R + a, to introduce the non-
dimensional parameter d0 as:

d = (1 − d0) (R + a) .

(1)

Here the parameter d0 ranges between 0 and 1, and corresponds
to the fraction of the FR that has already emerged.

4. Data modeling

In this section we summarize the main characteristics of the
modeling approach. The inference scheme was implemented
using the open source library PyMC3, which provides all the
needed tools for probabilistic analysis (e.g., sampling and varia-
tional ﬁtting algorithms, Salvatier et al. 2016). PyMC3 relies on
the Theano package for tensor algebra support, automatic diﬀer-
entiation, optimization and dynamic C compilation.

4.1. Bayesian probabilistic analysis

The aim of the Bayes inference scheme is to obtain an estimation
of the posterior probability P(p|Mo), that provides the probabil-
ity with which a certain combination of the model parameters
p replicates the observed magnetogram Mo. We can obtain the
posterior probability distribution, or simply, the “posterior”, us-
ing the Bayes theorem expression:

P(p|Mo) =

L(Mo; Mpi, σ) P(p)
P(Mo)

,

(2)

where L(Mo; Mpi, σ) is the conditional probability or likelihood
(where the parameter σ is the standard deviation between the
model and the observations, deﬁned later on Sect. 4.3), P(p)
deﬁnes the prior probability distribution of model parameters
(or simply, the “prior”), and P(Mo) is the model evidence or
marginal likelihood.

The posterior, P(p|Mo), for our model is an 8-dimensional
distribution in which covariance elements are present. However,
given the nature of the present problem, statistical independence
between model parameters is assumed for this ﬁrst application
(the removal of this hypothesis is left for a future development).
Therefore, we are not considering a priori correlations between
the parameters (ﬁrst order approximation of L) and we limit our
analysis to the marginal posteriors. The marginal posterior for
each parameter is obtained by integrating the full posterior in
Eq. (2) over the remaining 7 parameters within the prior bounds.
Therefore, each parameter will have a marginal posterior distri-
bution.

The model evidence, P(Mo) in Eq. (2), is the same for all
combinations of p, so this factor does not aﬀect the relative prob-
abilities of diﬀerent parameters. The evidence P(Mo) describes
the probability distribution of observing Mo with all the possible
parameters pi as deﬁned with the prior probabilities. This factor

Article number, page 3 of 14

A&A proofs: manuscript no. main

is useful for model comparisons but it is generally costly to de-
rive as it requires to numerically integrate the whole probability
distributions.

P(p) introduces into the inference the information we have
about the model parameters. In this sense, the prior comprises
our knowledge of the physical system we aim to model (i.e., we
guarantee that some values are correctly deﬁned in speciﬁc phys-
ically reasonable ranges). Despite the relevance of the prior in
Eq. (2), we will see that if the model provides a good approxi-
mation to the observations, the information provided by the prior
will be washed away from the posterior distribution.

In a Bayesian framework, the likelihood function L models
the probability of the observed data given the set of model pa-
rameters. Assuming that the magnetogram is well calibrated, i.e.
without bias, and characterized by an observational error σ, the
maximum entropy distribution for the likelihood is a normal or
Gaussian distribution N(0, σ), where the mean is zero since we
assume the absence of systematic errors, and σ is the standard
deviation.

Then, for an observed magnetogram Mo with ﬁeld values Bo, j
and a model magnetogram Mpi with ﬁeld values Bi, j computed
with the set i of parameters pi, the likelihood function is deﬁned
as

L(Mo; Mpi, σ) =

1
√

σ

2π

(cid:32)

exp

−

1
2σ2

(cid:88)

(Bo, j − Bi, j)2

(cid:33)

,

(3)

j

where j is indexing the magnetogram pixels, then the summation
over j indicates a summation over all these pixels. The exponen-
tial expression in Eq. (3) can take extremely low and large val-
ues, therefore the PyMC3 tools use the logarithm of L to avoid
truncation errors.

The posterior distribution obtained will be conditioned by
the selection of L, in this case a Gaussian-like likelihood. This
will produce the same function-like distribution for the posterior.
The selection of a normal distribution is accompanied by the hy-
pothesis that the error between the model and the observation is
due to an aleatory process and, as a consequence of this selec-
tion, the width of the posterior is directly proportional to σ. Still,
a second order deviance can be present on the posterior due to
the correlation between parameters which aﬀects the symmetry
of the distribution.

For simplicity we assume that no a priori information can be
obtained from the magnetograms, so we explore a broad param-
eter space deﬁned by uniform prior distributions (except for Nt
as explained below). In this sense each prior distribution is de-
ﬁned by two values, the lower and the higher limits. This kind of
distribution assigns equal probability within the deﬁned ranges
and zero outside this interval. We use the same selection of prior
ranges for all the magnetograms.

In Poisson et al. (2015b), we obtained the distribution of
Nt values computed from the polarity inversion line (PIL) in-
clination of 41 ARs. The distribution has a strong skewness to-
wards small values, with a mean of 0.3 and a standard deviation
of 0.2. These results were extended over 168 ARs in Poisson
et al. (2016) with similar statistical conclusions. Therefore, for
the prior of |Nt| we use a Gamma distribution with the above
mean and standard deviation values. This distribution is deﬁned
strictly positive, meaning that we allow only one twist sign for
the FR and we do not limit the upper-bound for the twist. This
Gamma distribution only reduces the probability of having larger
values of |Nt|, which are not observed in ARs. Additionally, the
information of the twist sign has to be set using the criteria pre-
sented in Luoni et al. (2011), which rely on the tongue pattern

Article number, page 4 of 14

Fig. 2. Marginal posteriors obtained for the model parameters of mag-
netogram number 10 of AR 10268 (see Fig. 1b). Colors correspond to
the four diﬀerent chains (indicated in the inset of panel a) having 2000
samples each. The panels correspond to the parameters: (a) a , (b) B0,
(c) R, (d) d0, (e) φ, (f) Nt, (g) xc, and (h) yc. The ˆr value is written at the
bottom left of each panel. ˆr is the normalized rank factor used to quan-
tify the convergence between diﬀerent MC Markov chains to a single
distribution. ˆr tends to unity when convergence is achieved.

that is independent of the polarity signs and require the compu-
tation of the acute angle formed by the PIL and the bipole axis.
In the case of AR 10268, we found a negative twist sign (Poisson
et al. 2015a).

4.2. Sampling the parameter space

Finding the parameters of maximum likelihood entails an opti-
mization problem that can be solved using several methods, e.g.
Powell’s conjugate direction method among them. Most of these
methods are fast but can be trapped in local maxima depend-
ing on the selected initial point. In particular, they provide the
location of the maxima of L, being the path by itself of little
interest and how L behaves around its maximum value not con-
sidered. Therefore, most of these methods give no information
on the precision of the results, unless the second order deriva-
tives of L are also evaluated. In contrast, the formalism given
by Eq. (2) presents an statistical approach in which a probability
distribution can be sampled, allowing a deeper analysis of the
model parameters (e.g., mean, median and variance). But this
approach needs speciﬁc algorithms to eﬃciently explore the pa-
rameter space to reconstruct P(p|Mo) in a feasible number of
iterations.

Monte Carlo methods provide a more comprehensive de-
scription of the posterior distribution, not just single point esti-
mates, by producing a set of random samples within the deﬁned
parameter space. More generally, Markov Chain Monte Carlo
(MCMC, Neal 1993) algorithms provide a more eﬃcient way

4.624.634.644.65a [pixels]020406080100Density(a)r= 1.00chain 1chain 2chain 3chain 44200440046004800B0 [G]0.0000.0020.0040.0060.0080.010Density(b)r= 1.2513.3513.5013.65R [pixels]02468Density(c)r= 1.180.1260.1320.1380.144d0 050100150200250Density(d)r= 1.2424.9024.7524.60 [deg]0246Density(e)r= 1.001.231.221.211.20Nt 020406080100Density(f)r= 1.0435.02035.03535.050xc [pixels]020406080Density(g)r= 1.0034.99035.005yc [pixels]020406080100Density(h)r= 1.00Magnetogram 10Poisson et al.: Modeling solar active region global magnetic parameters

to explore broad parameter spaces with less computations. Nev-
ertheless, sampling distributions with multiple peaks cannot be
completely described using general common MC algorithms, as
they often get stuck in one of the secondary maxima (e.g., as
with Hamiltonian Monte Carlo methods).

Since our model is complex and non-linear, the posterior can
in principle have multiple secondary maxima. Hence, we imple-
ment a Sequential Monte Carlo (SMC) sampler (see e.g., Kantas
et al. 2009). This sampler, included in the PyMC3 package, is a
well established Monte Carlo algorithm based on a Simulated
Annealing approach combining important sampling, tempering,
and MCMC kernels (Chopin & Papaspiliopoulos 2020). In this
case, the posterior is expressed as:

P(p|Mo)β ∝ (L(Mo; Mpi, σ))β P(p) ,

(4)

where β is an auxiliary temperature-like parameter to control the
sampling sequences. In the zero stage, β = 0, the algorithm
initializes directly sampling the priors. PyMC3 optimizes this
sampler by setting a number of steps in which the value of β
is progressively increased. Every two successive β steps an im-
portance sampling stage is initialized. In each stage, weights are
computed as the ratio of the tempered posterior of the respective
sample between two successive β steps. These weighted samples
are then used by an importance sampling algorithm with which
new MCMC draws are obtained. Samples are then used as seed
for the next β step. Iteration is complete once β reaches unity
producing the ﬁnal sample collection.

We perform four independent chain samples, with 2000 sam-
ples each. Each chain has diﬀerent random seeds for the initial
points, meaning that no correlation is imposed between chains.
Fig. 2 shows an example of the marginal posterior for the model
parameters obtained for magnetogram number 10 of AR 10268.
The distributions are constructed with the Kernel Density Esti-
mator (KDE, Parzen 1962). In this case the standard deviation
between model and observations (σ) is set to be 10 G, assuming
the instrumental error is the only contribution to σ. Each color
indicates diﬀerent MC Markov chains.

The normal-like posterior distributions and the progressive
convergence of consecutive chains indicate that optimal model
parameters for the analyzed observed magnetogram can be ob-
tained from the mean value of the posterior. Convergence is guar-
anteed for an inﬁnite number of samples. In practice we cannot
prove that the posterior obtained from a ﬁnite number of samples
has converge to the real one. That is why it has been accepted
that independent chains, with scattered initial points, converging
to the same distribution is the best we can use to say we have
achieved convergence. The normalized rank, ˆr, diagnostic tests
(Vehtari et al. 2021) provides a way to quantify the degree of
convergence by comparing the variance between multiple chains
with the variance within each chain. If convergence has been
achieved, the between-chain and within-chain variances should
be identical, hence ˆr = 1. Values of ˆr above 1.4 indicate prob-
lematic distributions and convergence is not guaranteed. In the
present example, ˆr values are below 1.25, and often close to 1
(see ˆr values in the panels of Fig. 2).

4.3. Inference error

L is a function of the parameter σ, which corresponds, in princi-
ple, to the standard instrumental deviation of the observed data.
However, in practice the standard deviation between the model
and the observations is unknown and larger than the instrumen-
tal error, because the model is not exact, as it represents, at best,

Fig. 3. (a) Magnetogram number 10 for AR 10268. (b) Most probable
model for the same magnetogram obtained with σ = 10 G. (c) Mag-
netogram number 10 limited to the AR ﬁeld deﬁned using the most
probable model shown in panel (b), fulﬁlling the condition |B+,j| ≥ 1
G. (d) Most probable model for panel (c) data obtained with σ = 300
G. The color and contour conventions are the same as in Fig. 1. The
movie mov-ﬁg3.mp4, from the supplementary material, shows the mag-
netograms and their associated models during the full emergence.

only the global aspect of the ﬂux distribution and does not re-
produce the small scale variations correctly. In the case of MDI
magnetograms the typical instrumental noise level is 9 G, while
the standard deviation between model and observations is ex-
pected to be much larger (in view of the simplicity of the model).
Therefore, even for the most probable ﬁt, σ is expected to be
dominated by the diﬀerence between observations and model.
For this reason, we propose to estimate its value based on the
computation of the residuals between the most probable ﬁtted
model and the observed magnetograms.

At ﬁrst, we can obtain a most probable ﬁt by conducting an
inference assuming the ideal modeling, in this sense σ is set to
10 G. But a more appropriate value can be found, once the most
probable model is approximately known, by computing

σest =

(cid:115)

1
Nd

(cid:88)

j

(Bo, j − B+,j)2 ,

(5)

where Nd is the number of pixels in (cid:80)
j and the subscript "+"
indicates the most probable model with parameters p+ derived
from the mean values of the marginal posteriors (e.g., Fig. 2).

4.4. Model of AR 10268

As mentioned in the previous section, a ﬁrst estimation of the
most probable parameters of the model is obtained using σ = 10
G. The posterior obtained is extremely narrow compared with
the bandwidth deﬁned for the priors (see Fig. 2), so the real un-
certainties of the parameters (posterior variance) are not well
represented. Still, the mean of each marginal posterior can be
used to compute the most probable ﬁt to the observed magne-
tograms.

Article number, page 5 of 14

050100x (arcsec)020406080100120y (arcsec)(a)Mag 10050100x (arcsec)020406080100120y (arcsec)(b) = 10 G050100x (arcsec)020406080100120y (arcsec)(c)AR field050100x (arcsec)020406080100120y (arcsec)(d)est = 300 G20001000010002000Bz (G)A&A proofs: manuscript no. main

the most probable model magnetograms with the AR ﬁeld we
obtain an estimation of what we now call σest for each polarity
using Eq. (5). Fig. 4b shows how this estimation varies during
the emergence. We ﬁnd an expected asymmetry (e.g., Lites et al.
1998) between the leading (negative) and following (positive)
polarities. This indicates not only the limitation of the model to
ﬁt the more disperse ﬂux of the following polarity, but also that
the existence of this asymmetry introduces greater uncertainties
on the parameters since the half-torus model is strictly symmet-
ric. In this sense the model will try to ﬁt both polarities with the
same parameters despite their diﬀerences. A development of the
model to take into account this asymmetry is postponed for a
future study.

In the present set up and the testing of the statistical method,
we select the maximum value of σest in Fig. 4b. This introduces
an upper bound for the statistical errors, especially in the ear-
lier phase of emergence. This uniform value allows us to test the
sensitivity of the parameters of the model during the emergence
phase from the broadness of the posteriors. Therefore, our sec-
ond inference run is done over the AR ﬁeld using σest = 300 G
(the largest value achieved during the evolution). Fig. 3d shows
the best magnetogram obtained with this second inference. There
are no clear diﬀerences between panels (b) and (d), implying
that the ﬁrst approach is good enough to mimic the ﬁeld distri-
bution of the AR. Still, there are signiﬁcant diﬀerences between
the posterior distributions obtained with both estimations. They
are analyzed below.

We extend the above analysis of the posteriors to 22 magne-
tograms covering the full emergence of AR 10268. The movie
mov-ﬁg3.mp4 in the supplementary material includes the evolu-
tion of the magnetograms for the AR 10268, the AR ﬁeld, and
the respective models. We model each magnetogram individu-
ally without imposing any temporal correlation on the param-
eters. In Fig. 5 we plot the evolution of the marginal posteri-
ors using box and whisker plots. The segments in the boxes in-
dicate the mean values. We compare models obtained with the
ﬁrst inference procedure (σ = 10 G, blue), and second inference
(σest = 300 G, orange) including background ﬁltering. Some of
the peaks of the ﬁrst inference posterior are so narrow that the
corresponding boxes are not visible in the plots.

The ﬁrst part of the emergence (up to magnetogram number
10) is characterized by a broader distribution in some parame-
ters, especially d0, which presents the greatest dispersion. The
limited information provided by the magnetogram pixels at the
beginning of the emergence is expected to produce broader pos-
teriors induced by a stronger correlation between the parameters
of the model. In particular, diﬀerent combinations of the param-
eters d0, R, and B0 can produce similar synthetic magnetograms,
e.g. a FR almost fully emerged with low axial ﬁeld and a FR deep
down the photosphere with large axial ﬁeld can produce similar
ﬁeld distributions with σest = 300 G.

In the second half, the marginal posteriors for most of the pa-
rameters become narrow and the mean value of both estimations
(σ = 10 G and σest = 300 G) converge. At that point the model
is well constrained by observations. Nevertheless, B0 is the most
sensitive parameter, having the greatest dispersion up to the end
of the emergence.

For most of the analyzed magnetograms, the parameters a, φ,
xc, and yc converge to similar values independently of taking σ
or σest. This implies that along the direction of these parameters
the L function has a narrow and steep main peak. Moreover, the
plot of the posterior (as in Fig. 2) indicates that other secondary
peaks are shallow.

Fig. 4. (a) Evolution of AR 10268 magnetic ﬂux. The dotted-red (blue)
line shows the evolution of the positive (negative) magnetic ﬂux of the
square selection of the magnetogram (as shown in Fig. 1). Solid-red
and dashed-blue lines are the positive and negative ﬂux, respectively,
computed over the AR ﬁeld (see Fig. 3c as example). The black line
shows the evolution of the most probable model magnetic ﬂux (positive
plus absolute value of the negative ﬂuxes divided by two). (b) Estimated
value for the standard deviation between model and observations using
Eq. (5) over the AR ﬁeld. The red-solid (blue-dashed) line corresponds
to σest for the positive (negative) polarity. The black line corresponds to
σest for points within the AR region (|B+,j| ≥ 1 G).

Fig. 3b shows the most probable model of magnetogram
number 10 using σ = 10 G. Comparing it with the observa-
tions, we see a good agreement with the shape and size of the
magnetic tongues, the inclination of the PIL, the tilt angle and
the ﬁeld strength in the core of each polarity (inner contours).
Still, diﬀerences are evident by looking at the small scales and
lower ﬁeld pixels surrounding the AR core.

To remove the contribution of the background ﬁeld, i.e. not
belonging to the AR, we reduce the magnetogram to those pix-
els in which |B+,j| ≥ 1 G. Fig. 3c shows this restricted mag-
netogram, henceforth called simply AR ﬁeld. This allows us to
derive parameters for the model which are more representative
of the studied real AR ﬁeld (i.e., the FR intrinsic ﬁeld). Fig. 4a
shows the evolution of the AR positive magnetic ﬂux, with a
solid-red line and the negative ﬂux with a dashed-blue line. The
AR ﬁeld selection signiﬁcantly reduces the ﬂux unbalance due
to the contribution of the background positive ﬁeld.

The value of σ needs to incorporate the fact that the model
cannot reproduce all the complex features of the AR emergence,
and therefore we perform a second inference in which a more
realistic value is used. As a consequence of this new estimated
value, we will obtain broader posterior distributions from which
the uncertainty of the parameters can be estimated. Comparing

Article number, page 6 of 14

123456 [Mx2]1e23(a)|Bi,j| 1 GPositive fluxNegative fluxModel flux05101520Magnetogram100150200250300est [G](b)est(B+,j1) Gest(B+,j1) Gest(|B+,j|1) GPoisson et al.: Modeling solar active region global magnetic parameters

Fig. 5. Box plots showing the evolution of the marginal posteriors inferred for 22 magnetograms along the emergence of AR 10268. Each panel
shows the evolution of the model parameters: (a) a , (b) B0, (c) R, (d) d0, (e) φ, (f) Nt, (g) xc, and (h) yc. Blue and orange boxes compare the
marginal posteriors obtained using σ = 10 G and σest = 300 G, respectively. The boxes represent the three-quartile values of the distribution (so
boxes contain the 50% central part of the distribution) and the whisker extensions are ﬁxed by a factor 1.5 of the inter-quartile range. The blue and
orange lines mark the evolution of the mean value of the marginal posteriors for either σ or σest. In panel (e) the tilt values obtained using two
diﬀerent methods are added (see inset). The black line in panel (f) corresponds to the estimation of Nt,c obtained comparing the inclination of the
PIL with respect to the direction of the AR bipole. Black lines in panels (g) and (h) correspond to the AR barycenter.

Fig. 5f shows the estimation of Nt. The values obtained with
σ = 10 G and σest = 300 G depart during the ﬁrst half of the
emergence indicating a possible anti-correlation with d0. In this
sense the elongation of a polarity can be represented by the num-
ber of turns but also by the stage of the emergence, i.e. increas-
ing d0 above 0.6 reduces the extension of the tongues despite the
large values of |Nt| (see the diﬀerence between the orange and
blue boxes in panels (d) and (f) until magnetogram number 8).
The evolution of Nt is associated to the variation of the polarity
elongations. The maximum elongation of the positive polarity
is reached around the maximum value of Nt (see movie mov-
ﬁg3.mp4, or Figure 6d in Poisson et al. (2015b)). Moreover, Nt
can be correctly estimated only when the elongation of the po-
larities is signiﬁcant, therefore its determination is limited along
the emergence, i.e. Nt tends to zero once the tongues have re-
tracted. Finally, the estimation obtained with σest = 300 G is in
good agreement with the parameter Nt,c (black line in Fig. 5f)
obtained for this AR in Poisson et al. (2015b) with a diﬀerent
method (i.e., using the relative orientation of the PIL with re-
spect to the direction of the AR bipole axis).

The tilt angle obtained from the inference (Fig. 5e) indicates
a sustained 20◦ clockwise rotation. This estimation of φ provides
a correction of the eﬀect of the magnetic tongues on its determi-

nation using the magnetic barycenters (black line). The diﬀer-
ence between both methods proves the signiﬁcant eﬀect of the
tongues over this quantity during the emergence. We see that the
correction provided by CoFFE (Poisson et al. 2020) partially im-
proves the estimation of φ.

The evolution of the AR center, xc and yc, indicates a drift
of AR towards the east-north direction. This drift is towards the
north pole since AR 10268 is located in the northern hemisphere
(12o) (see Fig. 5g,h). This northern drift is plausibly associated
with the Sun’s meridional ﬂow. The AR center can also be esti-
mated from the computation of the barycenters of the main po-
larities (black line). This estimation is in good agreement with
the obtained xc and yc, with diﬀerences within the magnetogram
spatial resolution.

5. Effect of perturbations

In this section we test the statistical method by applying it to a
series of magnetograms obtained with the FR emergence model
(i.e., synthetic magnetograms). We also study the eﬀect of in-
cluding a series of non-linear perturbations to the synthetic mag-
netograms to mimic small scale magnetic structures, as well as
asymmetries observed between the polarities of the ARs, without

Article number, page 7 of 14

0123456789101112131415161718192021Magnetogram23456a [pixels](a)=10 Gest=300 G0123456789101112131415161718192021Magnetogram10002000300040005000B0 [G](b)=10 Gest=300 G5.07.510.012.515.017.5R [pixels](c)0.00.20.40.60.8d0 (d)20020 [deg](e)BarycentersCoFFE3210Nt (f)Nt,c0123456789101112131415161718192021Magnetogram30323436xc [pixels](g)Barycenters0123456789101112131415161718192021Magnetogram323436yc [pixels](h)BarycentersA&A proofs: manuscript no. main

emergence, corresponding to magnetograms (Mag) 2 and 7, are
shown in Fig. 6a,b. The magnetic tongues are clearly visible in
Mag 2 and more retracted in Mag 7. The results of the inference
procedure are shown in Fig. 7 in the same format as in Fig. 5. The
marginal posteriors obtained for the test model are indicated with
blue boxes and whiskers, while the red-dashed lines correspond
to the input parameters of the model. Results shown with other
colors are described in Sect. 5.3.

The marginal posteriors for the parameters of each magne-
togram are Gaussian-like distributions (not shown, but compati-
ble with the symmetry observed in the quartile boxes). In Fig. 7,
the marginal posteriors have a mean value (blue lines) very close
to the half-torus model input parameters (red lines in Fig. 7).
This basic test shows that the sampler algorithm works ﬁne to
recover the original parameters. The broadness of these posteri-
ors change during emergence. Since we set the value of the stan-
dard deviation between the model and the observations (called
σ from now on) to a constant that we take to be 300 G, as our
previously computed σest, the change in the broadness includes
the eﬀect of overestimating σ on the sampled posterior during
the early phases of emergence (in particular, for parameters B0
and R). In future applications of the method to observed ARs,
the expected lower values of σ in this early phase (as in Fig. 4b)
will attenuate this eﬀect.

The broadness of the marginal posteriors decreases along the
simulated emergence for all the parameters except Nt. Indeed,
this is the only parameter which fully depends on the extension
of the magnetic tongues (for other parameters the presence of the
tongues rather perturbs their determination). Since tongues tend
to disappear by the time the half-torus has emerged, the infor-
mation of Nt reﬂected in the magnetogram also decreases during
the emergence. Furthermore, not only the marginal posterior of
Nt for each magnetogram will become broader, but also its mean
value will tend to depart from the input parameters. This indi-
cates that Nt is not well constrained after 70% (d0 ≥ 0.7) of the
total FR has emerged.

5.2. AR generator

In this section we develop an AR generator to simulate a large
variety of small scale magnetic features, comparable to the ones
observed in AR 10268 (see Fig. 1), in order to explore how per-
turbations aﬀect the posterior. For that we follow a four-step
procedure that perturbs the magnetograms of our previous test
model (Fig. 6a-b), which we then use as a seed for the AR gen-
erator.

In the ﬁrst step the AR generator makes a random selection
(S) over a fraction of the pixels that comply |B(x j, y j)| ≥ 1 G.
We choose a diﬀerent number for the positive ( fp) and negative
( fn) ﬂux pixels to mimic the observed asymmetry between the
leading and the following polarities. For smaller values of fp,
the positive polarity becomes less homogeneous. Selected pixel
coordinates (x j, y j) are obtained for each magnetogram of the
cube. The output of the ﬁrst step, M1, is deﬁned by the condition
B¯S = 0 outside the pixel selection.

In the second step, we multiply each pixel of the S selection
by a constant factor in order to maintain the total magnetic ﬂux
of the original seed model. We compute a factor for each polarity
to make sure that the magnetic ﬂux balance is conserved (in this
step). In other words, we redistribute the ﬂux in magnetic nodes
where the ﬂux is more concentrated producing a new version of
the magnetogram cube, M2 (see Fig. 6c-d).

In a third step, we apply a Gaussian smoothing ﬁlter of 1
pixel width to the magnetograms. The aim is to smooth discon-

Fig. 6. Example of the model generator: (a)-(b) Magnetogram 2 and
7 of the seed model (M0). (c)-(d) Random selection of pixels for each
magnetogram (M2). (e)-(f) Simulated data generated from panels (c)
and (d), after applying a Gaussian-smooth ﬁlter and normal noise (M4).
The color convention is the same as in Fig. 1.

the need of including complex interactions between the magnetic
ﬁeld and the plasma.

5.1. Simple test

Using the half-torus model we generate a cube of 10 magne-
tograms (indexed from 0 to 9) to which we apply the already de-
veloped statistical method. This number of magnetograms pro-
vides enough resolution for the simulated AR emergence. The
obtained magnetograms cover the same ﬁeld of view and spatial
resolution as the observations of AR 10268, so simulated data
has the same pixel size as the MDI instrument. We tested the
inference dependence on the spatial resolution (not shown here)
reducing by a factor two and a factor three the original resolution
of the MDI magnetograms for AR 10268. For both tests, we ﬁnd
no signiﬁcant diﬀerences with the results shown in Fig. 5.

The emergence is modeled by the increase of d0 from 0.1 to
1. The intrinsic parameters of the torus, a, R, B0, Nt, xc and yc,
are set as constants during the emergence, for simplicity (a = 4.5
pixels, R = 12 pixels, B0 = 3000 G, Nt = −0.6, xc = 32 pixels
and yc = 33.5 pixels). The tilt angle φ linearly evolves with a
clockwise rotation of 15o (within a range of −5o to −20o) which
is typically observed in some emerging bipolar ARs (Poisson
et al. 2015b), including AR 10268. Two steps of the simulated

Article number, page 8 of 14

050100x (arcsec)020406080100120y (arcsec)Mag 2(a)050100x (arcsec)020406080100120y (arcsec)Mag 7(b)020406080100120y (arcsec)Selected pixels(c)020406080100120y (arcsec)Selected pixels(d)050100x (arcsec)020406080100120y (arcsec)Smooth(e)050100x (arcsec)020406080100120y (arcsec)Smooth(f)20001000010002000Bz(G)Poisson et al.: Modeling solar active region global magnetic parameters

Fig. 7. Box plots showing the evolution of sampled marginal posteriors for the parameters of the seed model (blue), 100 generated ARs (orange),
and one individual AR as example (green). For the orange boxes, each marginal posterior is constructed by 200000 samples concatenated from
the 2000 samples for each of the 100 generated ARs. Each panel shows the evolution of the model parameters: (a) a , (b) B0, (c) R, (d) d0, (e) φ,
(f) Nt, (g) xc, and (h) yc. The inference is made assuming σ = 300 G. The blue, orange, and green lines show the evolution of the corresponding
marginal posterior means. The red-dashed line shows the seed model input parameters. The gray and red boxes of panel (e) show the evolution of
the tilt angle obtained using the magnetic barycenters and CoFFE for 100 generated ARs, respectively.

tinuities in the ﬁeld distribution and produce more realistic mag-
netograms (called M3).

tions which are comparable with the ones we observed for AR
10268.

Finally, the fourth step introduces noise and ﬂux unbalance
to M3, adding a random normal noise with a mean of 5 G and
standard deviation of 10 G to each pixel. Two examples of the
ﬁnal simulated magnetograms M4 are shown in Fig. 6e,f.

The evolution of the positive (red-solid line) and negative
(blue-dashed line) magnetic ﬂux of a generated AR (M4) is
shown in Fig. 8a. The excess of positive ﬂux emulates the con-
tribution of the background ﬁeld as in AR 10268. The black line
corresponds to the ﬂux of the seed model, M0. Its diﬀerence with
the blue and red lines characterizes the imposed ﬂux unbalance.
fp and fn are the main parameters of the AR generator, since
they produce strong ﬁeld perturbations that determine how far
the output will be from the seed model (i.e. the value of σ).
If we consider that the seed model is the most probable model
for the generated AR, then we can compute σest from Eq. (5)
comparing the magnetograms of the generated AR (M4) and the
seed model (M0). Therefore, a selection of fp and fn will deter-
mine how σest evolves during the emergence. We ﬁnd that using
fp = 0.35 and fn = 0.75, we obtain an evolution of σest for every
generated AR that is comparable with the one observed for AR
10268 (see Fig. 4b and Fig. 8b). Therefore, using these values
for the AR generator parameters, we are introducing perturba-

5.3. Inference for generated ARs

We ﬁrst compare the marginal posteriors obtained with the seed
model and one generated AR (blue and green boxes, respec-
tively, in Fig. 7). The perturbations incorporated with the 4-step
generator can modify signiﬁcantly the deduced AR parameters
with respect to the input. As expected from the results found
from the seed model, the changes are dominantly present dur-
ing the earlier emergence phase for a, B0, d0, R, Nt, and φ. The
Nt estimation is also aﬀected at the end of the emergence. This
implies that the information lost during the non-linear transfor-
mations of the magnetograms cannot be recovered using our in-
ference method. Still we ﬁnd the converge of the parameters,
except Nt and B0, to the model input during the last part of the
emergence.

The analysis of a single case is not representative of all the
possible perturbations and their eﬀects on the inferred posteriors.
Indeed, random selections of points produce diﬀerent patterns
for the ﬁeld distributions. By trying diﬀerent random selections
in the ﬁrst step of our AR generator, we can statistically explore
how the introduced perturbations aﬀect the inference at diﬀerent

Article number, page 9 of 14

0123456789Magnetogram456a [pixels](a)inputSeed Model100 ARs1 AR0123456789Magnetogram10002000300040005000B0 [G](b)5.07.510.012.515.017.5R [pixels](c)0.00.20.40.60.81.0d0 (d)20020 [deg](e)BarycentersCoFFE1.251.000.750.500.250.00Nt (f)0123456789Magnetogram31323334xc [pixels](g)0123456789Magnetogram323334yc [pixels](h)A&A proofs: manuscript no. main

relatively large dispersion. Nt has the largest deviation from the
mean, also with a strong standard deviation. Its estimated val-
ues are better determined in the central phase of the emergence,
when the magnetic tongues are extended and the axial ﬁeld is
strong. The dispersion of Nt has a great impact on the estima-
tion of R at the ﬁrst half of the emergence (there, the magnetic
tongues modify the bipole size observed in the magnetogram).

The estimated tilt angle, φ, departs from the input value only
at the ﬁrst magnetogram with largest departure being around
6.5o. This initial departure is also observed on other parameters
and is due to the largest impact of the perturbations when the
AR mean ﬁeld is weak and comparable to the mean perturbation
in terms of σ. Later on, the mean φ of the 100 AR distributions
agrees with the input parameter of the seed model reducing also
the broadness of the distributions along with the AR emergence.
The obtained values during the full emergence are signiﬁcantly
better than those found from the direct measure of the magnetic
barycenters (see white boxes in Fig. 7e). This implies that the
Bayesian inference method provides a clear correction of the ef-
fect of the tongues on the tilt during the emergence phase. We
also include the comparison with CoFFE in Fig. 7e. Though at
the beginning of the emergence and up to its ﬁrst half, a de-
parture from the input values is evident, the results found with
CoFFE are much closer than those determined with the barycen-
ter method and clearly converge to the input values during the
second half of the emergence phase. Although CoFFE achieves
a partial correction of the tilt, these results show the strength of
CoFFE compared to less sophisticated methods, as concluded by
Poisson et al. (2020).

Finally, the central position parameters, xc and yc are well
constrained and estimated in all the analyzed cases. As expected,
these two parameters are not correlated with the rest of the FR
intrinsic parameters.

6. Discussion and Conclusions

In this work we test a new method based on a Bayesian statis-
tical approach to derive active region global parameters from
LOS magnetograms. We use a synthetic half-torus model suc-
cessfully employed in previous works to interpret the magnetic
tongues and their evolution during the emergence of bipolar ARs
(Luoni et al. 2011; Poisson et al. 2015b). This model depends
on eight free parameters. Their most probable values and sta-
tistical distributions (called posteriors) are derived applying this
new Bayesian approach to observed magnetograms. The magne-
tograms are treated independently during the AR emergence, so
the eﬀect of the statistical procedure on the determination of the
eight-model parameters can be tested at diﬀerent stages of the
analyzed evolution.

Despite the simplicity of the half-torus model, we are able to
determine the large-scale properties of AR 10268 from its LOS
magnetic ﬁeld. More precisely, we reproduce its global charac-
teristics, such as the elongation of the polarities and the incli-
nation of the PIL on the bipole axis. Moreover, the evolution
of both observed and modeled magnetograms are comparable at
any stage of the AR emergence (see movie mov-ﬁg3.mp4 from
the supplementary material). Using this model we are also able
to reduce the contribution of the background ﬂux, not belonging
to the AR, ﬁnding a more balanced evolution of the AR main
positive and the negative ﬂux. We establish an upper bound for
the observed standard deviation (σ) between the model and the
observations that ranges between 100 G and 300 G. This large
standard deviation is partly due to the asymmetry that exists be-

Fig. 8. (a) Evolution of magnetic ﬂux for the generated AR shown in
Fig. 6e,f. Solid-red and dashed-blue lines are the positive and negative
ﬂux, respectively. The black line shows the seed model magnetic ﬂux.
(b) Estimated σ using Eq. (5) applied to the seed model and the gen-
erated AR. The red-solid (blue-dashed) line corresponds to σ for the
positive (negative) polarity. The black line corresponds to σ estimated
with all the pixels within the generated AR ﬁeld.

stages of the emergence. For each magnetogram, we sample the
posteriors for 100 generated ARs. This means that we apply 100
diﬀerent patterns that may aﬀect the inferred parameters in vari-
ous ways. The only condition we impose for the generated ARs,
is that σ must reach values of at least 200 G for the negative po-
larities and 300 G for the positive ones at some stage of the emer-
gence to guarantee that they diﬀer enough from the seed model.
The orange boxes in Fig. 7 are constructed as concatenated dis-
tributions of these 100 posteriors, therefore each of these boxes
and whiskers contains 200000 samples (2000 for each generated
AR).

Most of the distributions of the 100 cases present a Gaussian-
like proﬁle (not shown) implying that the generated perturba-
tions have a random eﬀect on the 8-dimensional posteriors found
for each magnetogram. We show the means of the 100 AR dis-
tributions in Fig. 7 with orange curves. The comparison with the
original values of the parameters of the seed model (red curves)
indicates systematic deviations.

Looking at the distributions at diﬀerent stages, parameters a
and B0 are well estimated only during the last half of the emer-
gence. During the ﬁrst half the radius a is slightly overestimated
while B0 is well underestimated, therefore the FR axial ﬂux (pro-
portional to πB0a2 for the half-torus model) is also underesti-
mated during this phase. The radius R is well estimated but with
a larger uncertainty earlier in the emergence. d0 is nearly fol-
lowing the linear evolution present in the seed model, but with a

Article number, page 10 of 14

1.01.52.02.53.03.54.0[Mx2]1e23(a)Positive fluxNegative fluxModel flux02468Magnetogram100150200250300[G](b)(Bseed,j1) G(Bseed,j1) G(|Bseed,j|1) GPoisson et al.: Modeling solar active region global magnetic parameters

tween the leading and following polarities, both in their exten-
sion and small scale ﬁeld perturbations.

To determine the eﬀect of the small scale perturbations on the
posterior we create an AR generator to mimic realistic ﬁeld ob-
servations starting from a smooth seed model. The aim is to ap-
ply strong modiﬁcations at small scales while keeping the global
properties almost unchanged. For the generated ARs we use the
same σ value obtained for AR 10268 to maintain the modiﬁ-
cations introduced to the magnetic ﬁeld at a reasonable level.
The inference is made over 100 generated AR emergences using
the same method applied to AR 10268 magnetograms. This test
shows that the introduced perturbations could be large enough
to shift the posterior distributions of the parameters for one sim-
ulated AR by more than one inter-quartile range from the input
seed model parameters.

The marginal posteriors are deﬁned for each model param-
eter by integrating the full posterior over the remaining 7 pa-
rameters. Such marginal posteriors, shown in Fig. 5 as boxplots,
display a large variation (both in their mean and standard devi-
ation) from the parameters of the model during the AR 10268
emergence. Despite these temporal variations are not included
within the half-torus model, most of them are compatible with
small scale random perturbations of the ﬁeld distribution, as seen
for the generated AR marginal posteriors of Fig. 7.

Comparing the results derived from the analysis using the
AR generator to those coming directly from the application of
the Bayesian inference method to AR 10268, we ﬁnd a good
correspondence that can we summarized as:

– The FR cross-section radius, i.e. the parameter a in Fig. 5a,
has a strong variation and large dispersion during the ﬁrst
third of the emergence and then it converges to a constant
value for the rest of its evolution. The ﬁrst variation is char-
acterized by a fast expansion reaching values above the later
convergence value. There is also an overestimation, though
milder, of a during the ﬁrst half of the emergence for the gen-
erated AR selected (green line, Fig. 7a). This eﬀect is weaker
when a set of 100 ARs is selected (orange line). Later on, a
uniformly converges to the input value. We conclude that the
evolution of a observed for AR 10268 has a contribution in-
duced by the sensitivity of the half-torus model to small scale
perturbations.

– The ﬁrst small values of the axial ﬁeld strength, B0 in Fig. 5b,
could, at least partly, be a bias of the method, since a similar,
although less important, behavior is present on the posterior
of the seed model (blue boxes in Fig. 7b). Moreover, this
bias becomes stronger once the small scale perturbations are
introduced to the seed model (orange boxes in Fig. 7b). The
diﬃculty to determine both a and B0 during the ﬁrst half of
the emergence is due to the partial emergence of the FR and
the projection of the axial ﬁeld on the LOS direction. The
anti-correlation between a and B0, obtained for AR 10268
and the generated ARs, suggest that the axial ﬂux can be a
less biased parameter than B0. In other words, despite a and
B0 are not well estimated separately, the combination of B0a2
might be a more robust parameter for the FR model.

– The evolution of the main FR radius, R in Fig. 5c, can po-
tentially be an artifact of the method, since an increase of the
distance between the main polarities can be reproduced with
an increase of R at constant d0. Indeed, although the width of
the distributions of R remains mostly constant during emer-
gence for the 100 generated ARs, the marginal posteriors of
the single generated AR example shown in Fig. 7c presents
similar temporal variation as the one obtained for AR 10268

(green boxes). This implies that the variation of R for AR
10268 is potentially within the framework of the torus model
considering the eﬀect of the small scale ﬁeld perturbations.
– The evolution of the bipole tilt, φ in Fig. 5e, shows a clear
clockwise rotation of AR 10268, which could well be asso-
ciated to the torsion (or writhe) of the FR axis. The estima-
tion obtained is also close to the results obtained with CoFFE
(Poisson et al. 2020) and signiﬁcantly diﬀerent from the tilt
obtained by computing the magnetic barycenters, which are
aﬀected by the magnetic tongues. Fig. 7e shows the improve-
ment due to the removal of the eﬀect of the tongues on the es-
timation of the tilt. Moreover, the Bayesian approach proves
to be more stable and with a more robust estimation than
CoFFE at the ﬁrst half of the emergence. We conclude that
the clockwise rotation of AR 10268 is not due to the evolu-
tion of the magnetic tongues but the actual measure of the
full AR rotation.

– The evolution of the twist number, Nt in Fig. 5f, has a simi-
lar behavior to the simulated ARs in Fig. 7f, with lower val-
ues near the beginning and the end of the emergence. For
the generated ARs the best estimations of Nt are obtained
around the middle of the emergence phase when the elonga-
tion of the polarities is maximum. The observed variation is
consistent with the value of the twist number computed for
AR 10268 by Poisson et al. (2015b).

– Finally the estimation of the AR center, corresponding to pa-
rameters xc and yc, provides the most robust result for both
AR 10268 and the generated ARs (Fig. 5g,h and Fig. 7g,h
respectively). This is expected because these parameters are
not intrinsic FR quantities, therefore their correlations with
the other model parameters is negligible.

The PYMC3 software, used in this work, is shown to be
eﬃcient and versatile to be adapted to the problem needs
(high model dimension) with diverse tools for tensor compu-
tation, sampling and Bayesian inference. Other samplers, e.g.
Hamiltonian Monte Carlo algorithms, and diﬀerent prior con-
structions including parameter correlations (LKG distributions;
Lewandowski et al. 2009), also available within the software
package, are worth to be tested in future works. On the other
hand, the present Bayesian analysis implementation allows us
to explore the half-torus model, obtaining a ﬁrst description of
the parameters and their correlations. Moreover, this method
also quantiﬁes the statistical distributions of the output param-
eters, allowing us to better characterize its limitations, which are
mainly present during the early emergence phase.

The direct comparison of a model with observations intro-
duces a new method to derive the temporal evolution of the
global parameters of an emerging AR to a precision level sur-
passing previous methods. In particular, the tilt angle obtained
from the model for AR 10268 in the early emergence phase cor-
rects substantially the eﬀect of the magnetic tongues. The in-
trinsic tilt of ARs is an important observational constraint for
ﬂux-transport dynamo models, since the AR tilt is linked, via
diﬀusion and meridional circulation, to the formation and evolu-
tion of the polar ﬁeld during solar cycles (e.g. Wang 2017). Then,
the application of the Bayesian method presented here to a large
set of ARs, in the spirit of the work of Poisson et al. (2020), is
expected to improve our knowledge of the tilt angle dependence
with latitude.

As a FR emerges, the magnetic tongues evolve producing an
apparent rotation of the magnetic bipole. By removing this ef-
fect, the Bayesian method provides a better estimation of the
actual intrinsic rotation of the bipole. This rotation is around

Article number, page 11 of 14

A&A proofs: manuscript no. main

Poisson, M., López Fuentes, M., Mandrini, C. H., & Démoulin, P. 2015a,

Sol. Phys., 290, 3279

Poisson, M., López Fuentes, M. C., Mandrini, C. H., Démoulin, P., & MacCor-

mack, C. 2020, A&A, 633, A151

Poisson, M., Mandrini, C. H., Démoulin, P., & López Fuentes, M. 2015b,

Sol. Phys., 290, 727

Rempel, M. & Cheung, M. C. M. 2014, ApJ, 785, 90
Salvatier, J., Wiecki, T., & Fonnesbeck, C. 2016, PeerJ Computer Science
Sivaraman, K. R., Gupta, S. S., & Howard, R. F. 1993, Sol. Phys., 146, 27
Takasao, S., Fan, Y., Cheung, M. C. M., & Shibata, K. 2015, ApJ, 813, 112
Tlatova, K., Tlatov, A., Pevtsov, A., et al. 2018, Sol. Phys., 293, 118
Valori, G., Romano, P., Malanushenko, A., et al. 2015, Sol. Phys., 290, 491
van Driel-Gesztelyi, L. & Green, L. M. 2015, Living Reviews in Solar Physics,

12, 1

Vehtari, A., Gelman, A., Simpson, D., Carpenter, B., & Bürkner, P.-C. 2021,

Bayesian Analysis, 16, 667

Vemareddy, P. & Démoulin, P. 2017, A&A, 597, A104
Wang, Y. M. 2017, Space Sci. Rev., 210, 351
Wang, Y.-M., Colaninno, R. C., Baranyi, T., & Li, J. 2015, ApJ, 798, 50
Weber, M. A., Fan, Y., & Miesch, M. S. 2013, Sol. Phys., 287, 239
Yardley, S. L., Green, L. M., Williams, D. R., et al. 2016, ApJ, 827, 151

20◦ for AR 10268, a factor two smaller than the tilt evolution
observed with the eﬀect of the magnetic tongues included. The
amount of rotation and its direction has a broad distribution in
ARs (López Fuentes et al. 2003), but its physical origin is still a
matter of debate. For example, the tilt angle evolution obtained
for AR 10268 (clockwise rotation) suggests a deformation of the
FR axis consistent with a negative writhe, but the origin of this
writhing remains unexplained. We expect that the application of
the just developed and tested method to a larger set of bipolar
ARs will help to understand the physical origin of the rotation of
AR bipoles.

Acknowledgments

CHM, MLF and MP acknowledge grants PICT-2020-SERIEA-
03214 (ANPCyT), PIP 11220200100985 (CONICET) and
UBACyT 20020170100611BA. CHM, FG, MLF and MP are
members of the Carrera del Investigador Cientíﬁco of the Con-
sejo Nacional de Investigaciones Cientíﬁcas y Técnicas (CON-
ICET). We thank MDI team for providing the magnetograms
used in this study. We recognize the collaborative and open na-
ture of knowledge creation and dissemination under the control
of the academic community, as expressed by Camille Noûs at
http://www.cogitamus.fr/indexen.html.

References

Abbett, W. P., Fisher, G. H., & Fan, Y. 2001, ApJ, 546, 1194
Archontis, V. & Hood, A. W. 2010, A&A, 514, A56
Baranyi, T., Gy˝ori, L., & Ludmány, A. 2016, Sol. Phys., 291, 3081
Cheung, M. C. M., Rempel, M., Title, A. M., & Schüssler, M. 2010, ApJ, 720,

233

Chopin, N. & Papaspiliopoulos, O. 2020, Importance Sampling. (New York, NY:

Springer, Cham), 81–103

Dacie, S., Török, T., Démoulin, P., et al. 2018, ApJ, 862, 117
Emonet, T. & Moreno-Insertis, F. 1998, ApJ, 492, 804
Fan, Y. 2009, ApJ, 697, 1529
Green, L. M., Démoulin, P., Mandrini, C. H., & Van Driel-Gesztelyi, L. 2003,

Sol. Phys., 215, 307

Hale, G. E., Ellerman, F., Nicholson, S. B., & Joy, A. H. 1919, ApJ, 49, 153
Howard, R., Gilman, P. I., & Gilman, P. A. 1984, ApJ, 283, 373
Howard, R. F., Harvey, J. W., & Forgach, S. 1990, Sol. Phys., 130, 295
Jouve, L., Brun, A. S., & Aulanier, G. 2013, ApJ, 762, 4
Kantas, N., Doucet, A., Singh, S., & Maciejowski, J. 2009, IFAC Proceedings

Volumes, 42, 774, 15th IFAC Symposium on System Identiﬁcation

Lewandowski, D., Kurowicka, D., & Joe, H. 2009, Journal of Multivariate Anal-

ysis, 100, 1989

Li, J. & Ulrich, R. K. 2012, The Astrophysical Journal, 758, 115
Lites, B. W., Skumanich, A., & Martinez Pillet, V. 1998, A&A, 333, 1053
Liu, Y., Zhao, X., & Hoeksema, J. T. 2004, Solar Physics, 219, 39
López Fuentes, M., Mandrini, C. H., Poisson, M., et al. 2018, Sol. Phys., 293,

166

López Fuentes, M. C., Démoulin, P., Mandrini, C. H., Pevtsov, A. A., & van

Driel-Gesztelyi, L. 2003, A&A, 397, 305

López Fuentes, M. C., Démoulin, P., Mandrini, C. H., & van Driel-Gesztelyi, L.

2000, ApJ, 544, 540

Luoni, M. L., Démoulin, P., Mandrini, C. H., & van Driel-Gesztelyi, L. 2011,

Sol. Phys., 270, 45

MacTaggart, D. 2011, A&A, 531, A108
Mandrini, C. H., Schmieder, B., Démoulin, P., Guo, Y., & Cristiani, G. D. 2014,

Sol. Phys., 289, 2041

Martínez-Sykora, J., Moreno-Insertis, F., & Cheung, M. C. M. 2015, The Astro-

physical Journal, 814, 2

McClintock, B. H. & Norton, A. A. 2013, Sol. Phys., 287, 215
McClintock, B. H., Norton, A. A., & Li, J. 2014, ApJ, 797, 130
Neal, R. M. 1993, Probabilistic Inference Using Markov Chain Monte Carlo

Methods, Tech. rep., University of Toronto

Nikbakhsh, S., Tanskanen, E. I., Käpylä, M. J., & Hackman, T. 2019, A&A, 629,

A45

Parzen, E. 1962, The Annals of Mathematical Statistics, 33, 1065
Poisson, M., Démoulin, P., López Fuentes, M., & Mandrini, C. H. 2016,

Sol. Phys., 291, 1625

Poisson, M., Démoulin, P., Mandrini, C. H., & Fuentes, M. C. L. 2020, The

Astrophysical Journal, 894, 131

Article number, page 12 of 14

Poisson et al.: Modeling solar active region global magnetic parameters

Appendix A: Half-torus model

We summarize below the ﬂux rope (FR) model used in this paper
and developed by Luoni et al. (2011). The model was designed to
be the simplest possible while being able to describe the key fea-
tures of emerging ARs, in particular magnetic tongues. A visu-
alization of the model and its parameters is shown in Figure A.1.
The magnetic ﬁeld has a toroidal geometry with an invariance set
along the FR axis. The magnetic twist is set uniform both along
and across the FR axis. The axial ﬁeld Bα and the azimuthal ﬁeld
Bθ are deﬁned as

Bα = B0 exp(−(ρ/a)2) ,

Bθ =

2ρNt
R + ρ cos(θ)

B0 exp(−(ρ/a)2) ,

(A.1)

(A.2)

where {ρ, α, θ} are the coordinates for the torus, in which ρ is
the distance to the torus axis, α is the location along the torus
axis, and θ corresponds to the rotation angle around the torus
axis. a is the typical small radius of the ﬂux rope and B0 is the
ﬁeld strength on the axis. The FR axis has a radius R, and the
center of the torus is located at a depth d below the plane where
we compute the magnetic ﬁeld to simulate magnetograms. The
number of ﬁeld line turns (twist) along the half-torus is noted
as Nt. Next, the horizontal position of the torus center is deﬁned
with the parameters xc and yc and the orientation of the FR with
the tilt φ. Finally, the model is fully deﬁned by 8 parameters.

Article number, page 13 of 14

A&A proofs: manuscript no. main

Fig. A.1. Diagram of the ﬁeld morphology of the half-torus model described in Sect. 3. This diagram corresponds to the test model presented in
Sect. 5.1. The dotted line corresponds to the torus axis with a ﬁeld strength B0 = 3000 G. The light green surface shows the tube isosurface deﬁned
by a small radius a = 4.5 and large radius R = 12, both in pixel units. The xc and yc parameters correspond to the torus central position in pixel
units in the xy−plane. φ is the tube tilt angle with respect to x−axis. The photospheric plane is located at a height d = 6.5 with respect to the torus
center. The red and blue contours over this plane indicates the projection of the torus ﬁeld in the z−direction with a ﬁeld strength of 500 G and
−500 G, respectively.

Article number, page 14 of 14

