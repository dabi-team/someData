1

Optimal Allocation of ESSs in Active Distribution
Networks to achieve their Dispatchability

Ji Hyun Yi, Student Member, IEEE, Rachid Cherkaoui, Senior Member, IEEE, and Mario Paolone, Senior
Member, IEEE

0
2
0
2

r
p
A
4
1

]

Y
S
.
s
s
e
e
[

2
v
7
6
6
2
1
.
9
0
9
1
:
v
i
X
r
a

Abstractâ€”This paper presents a method for the optimal siting
and sizing of energy storage systems (ESSs) in active distribution
networks (ADNs) to achieve their dispatchability. The problem
formulation accounts for the uncertainty inherent to the stochas-
tic nature of distributed energy sources and loads. Thanks to the
operation of ESSs, the main optimization objective is to minimize
the dispatch error, which accounts for the mismatch between
the realization and prediction of the power proï¬le at the ADN
connecting point to the upper layer grid, while respecting the grid
voltages and ampacity constraints. The proposed formulation
relies on the so-called Augmented Relaxed Optimal Power Flow
(AR-OPF) method: it expresses a convex full AC optimal power
ï¬‚ow, which is proven to provide a global optimal and exact
solution in the case of radial power grids. The AR-OPF is coupled
with the proposed dispatching control resulting in a two-level
optimization problem. In the ï¬rst block, the site and size of the
ESSs are decided along with the level of dispatchability that
the ADN can achieve. Then, in the second block, the adequacy
of the ESS allocations and the feasibility of the grid operating
points are veriï¬ed over operating scenarios using the Benders
decomposition technique. Consequently, the optimal size and site
of the ESSs are adjusted. To validate the proposed method,
simulations are conducted on a real Swiss ADN hosting a large
amount of stochastic Photovoltaic (PV) generation.

Index Termsâ€”Energy storage systems, optimal power ï¬‚ow,
active distribution networks, resource planning, dispatchability

I. INTRODUCTION

P OWER balancing is becoming an increasingly challenging

task due to growing volatility in power systems introduced
by the high penetration penetration of non-dispatchable and
stochastic generation. The spinning reserve requirement
is
growing to tackle not only the peak demand but also the
stochasticity of prosumption, which is deï¬ned as the load con-
sumption minus the generated power, causing signiï¬cant cost
increases for both transmission system operators (TSOs) and
distribution system operators (DSOs). In the distribution grid,
the prosumption forecast uncertainties are originated not only
by the load consumption but also by the distributed RES. Thus,
the deviation of the network infeed from the prescheduled
power intake from the grid, called dispatch error, should be
compensated by the system operating reserve, exposing DSOs
to high imbalance cost. There has been increasing interest
in using ESSs as a ï¬‚exible resource to compensate for the
dispatch error, thereby enhancing the dispatchability of the
ADNs and mitigate the aforementioned ï¬nancial risk. The
dispatchability identiï¬es the capability of a resource, or a
network, to control the realized active power ï¬‚ow through
the resource, or the network, to follow a pre-deï¬ned power
schedule with high ï¬delity. Thanks to the ADN dispatchability,
the responsible DSO ensures its proï¬t by mitigating imbalance
penalties [1]. In this respect, the optimal control strategies of
ESSs to improve the dispatchability of the stochastic resource
[2], [3], or distribution feeder [4] has been addressed.

However, the efï¬cient deployment of ESSs signiï¬cantly
depends on the investment planning. The work in [5] proposed
sizing of a wind farm ESS to achieve its dispatchability. The
ESS dispatch strategy is coupled with the assessment of its
capacity and expected lifetime based on the conï¬dence level
of the power output w.r.t the predeï¬ned schedule. To ensure

the economic optimality of decision-making, it is worth inves-
tigating the economic value of ESSs investments by taking into
account their operational beneï¬ts and installation costs. The
work in [6] proposed a method for the optimal allocation of
ESSs through a cost-beneï¬t analysis considering mitigating the
distribution utilitiesâ€™ risk for compensating the gap between
the actual prosumption and the purchased energy from the
forward market. [7] is an extension of [6], where different
agents, such as DSOs, wind farms, solar power stations and
demand aggregators in ADNs, determine the capacity of ESSs
based on the game theory approach to reduce the transaction
costs risk due to the resourcesâ€™ forecast errors.

It is also worth observing that the capacity and placement
of ESSs should comply with the characteristics of the chosen
control strategy and the subsequent operational conditions of
the system. In this regard, the optimal power ï¬‚ow (OPF) that
accurately models operation and control of the ADN, should
be embedded in the ESS planning tool. However, OPF-based
ESSs planning is inherently burdensome to solve due to its
non-convexity. There exists meta-heuristic methods such as
fuzzy PSO algorithm used in [6] and [7]. However, these
solution approaches cannot guarantee the global optimum or
even a feasible solution. To tackle the non-convexity of the
OPF problem, convexiï¬cation approaches, such as the semi-
deï¬nite programming (SDP) [8] or the second-order cone
programming (SOCP) relaxation [9]â€“[12], have emerged as a
solid and rigorous alternative. The SOCP relaxation proposed
in [13] has been implemented for the optimal ESS allocation
in radial grids due to its superior computational efï¬ciency
referring to the SDP relaxation. In [10], an ESS planning
strategy was developed relying on the SOCP-OPF model with
the objective of providing ancillary services to the TSO, and
to cope with the wind variability. Authors of [11] further
utilized the SOCP relaxed model for the ESSs allocation and
operation to minimize the grid losses and imported power in
the ADN. The work in [12] tackled the ESS planning and
operation problem by decomposing it into two stages: ï¬rst
stage determines the total ESS size to prevent grid constraints
violations due to PV power imbalance, and the second stage
allocates ESSs with optimal sizes by employing SOCP-OPF to
minimize the energy cost. Meanwhile, the Authors addressed
that the objective function and constraints should satisfy some
necessary conditions to guarantee the exactness of the SOCP-
OPF solution, and suggested a formula to verify the exactness
a-posteriori. The main drawbacks were explicitly underlined
in [14] by the fact that the exactness of the solution cannot be
guaranteed especially in the presence of reverse line power
ï¬‚ows and for the cases where the upper bound of nodal
voltage and the line ampacity constraints are binding.This
brings signiï¬cant limitations on the applicability of the method
to ADNs hosting distributed generation units with large capac-
ities. Moreover, the model neglects the transverse elements
of the lines, which can bring an infeasibility of the solution
especially when ADNs are composed of coaxial underground
cables. The work in [15] solves this problem and proposed
the Augmented Relaxed OPF (AR-OPF) to convexify the AC-
OPF for radial grids. Their contribution demonstrates that, in

 
 
 
 
 
 
the AR-OPF problem comprising an objective function strictly
increasing with the grid losses, the conditions for the exactness
of the solution are mild and hold for realistic distribution
networks. The AR-OPF was implemented in the subsequent
works on the optimal ESS planning problem while embedding
grid reconï¬guration with the objective of minimizing grid
losses, voltage deviation and the line congestion [16].

In this paper, we propose an operation-driven planning strat-
egy of ESS to achieve the dispatchability of the ADN based on
the AR-OPF model. The objective of achieving disatchability
requires a substantial and non-trivial modiï¬cation on the AR-
OPF as well as on the solution approach proposed in [16] in
order to reach the exactness of the relaxed OPF. Moreover, we
formulated the sizing problem into two blocks by modifying
the objective term, constraints and variables related to the dis-
patch error. Meanwhile, we apply the Benders decomposition
to handle the multi-layered decisions with numerous scenarios
[17]. The contributions of the paper are two as follows.

1) The optimal allocation of ESS is determined based on
an exact convex model of the OPF to address the dis-
patchability of the ADN in the presence of prosumption
uncertainty, while accurately reï¬‚ecting the operational
condition of the ADN.

2) The structure of the planning problem and the objective
functions are formulated accounting for the necessary
conditions to guarantee the optimality and the exactness
of the OPF relaxation.

The paper is organised as follows: in Section II, we introduce
the structure of the optimization problem and explain the key
parts in detail. In Section III, the proposed problem formula-
tion and solution approach are described. Section IV contains a
detailed application example referring to the planning of ESSs
into a real ADN. Finally, Section V concludes the paper.

II. PROBLEM STRUCTURE

A. System description

Buses excluding the slack bus in an ADN are indexed
with lâˆˆL. Lines whose downstream bus is bus l is are also
indexed with lâˆˆL. In this paper, optimal allocation of ESS
is determined based on the operation of the ADN over the
planning horizon Y , assuming that
there is no change in
system conditions over years. Each year, we classify days into
day-types indexed with dâˆˆD. The uncertainty in prosumption
in each day-type is represented by operating scenarios indexed
with Ï†âˆˆÎ¦d with probability Î»Ï†d for each scenario. The dis-
patch interval is identiï¬ed by the index tâˆˆ{1, ..., T }=T , where
T corresponds to the scheduling horizon of the problem. Time
indices are separated by a constant timestep âˆ†t. The dispatch
problem at day d accounts only for the active power. Each node
of the ADN has a non-dispatchable aggregated prosumption
(slÏ†t) deï¬ned at each scenario and time interval. The aggre-
gated ADN active powers through the grid connecting point
(GCP) to an upper layer grid in all scenarios (P1Ï†t, âˆ€Ï†âˆˆÎ¦d)
are expected to follow a day-ahead determined daily dispatch
plan at each time interval (DPtd) derived with the support of a
forecasting tool. Then, at each node where an ESS is allocated
(i.e., Ul=1, where Ulâˆˆ{0, 1} is installation status of the ESS
at bus l), it is dispatched at each scenario and time interval
according to active power (pE
lÏ†t).
The dispatched active power compensates for the gap between
active power infeed and the dispatch plan, which results from
the deviation of realized prosumption from the prosumption
prediction. Consequently, the observed dispatch error at GCP
can be minimized. In summary, the ESS allocation problem

lÏ†t) and reactive power (qE

2

to achieve the dispatchability of the ADN under study is a
two-stage decision process: the ï¬rst stage which deals with
the binary decision variables on the location of the ESS (Ul)
and the continuous decision variables on the capacity of the
ESSs energy reservoirs (Cl) and their power rating (Rl), and
the second stage which deals with daily dispatch problems,
determining the decision variables on the ESSs active and
reactive power for all operating scenarios.

B. Dispatch plan of the distribution feeder

The operational beneï¬t of ESSs allocation for the ADN
dispatchability is evaluated with sets of operationg scenarios,
where each set refers to a typical day. The set of day-types is
supposed to be pre-selected by the modeler.

The advantage of using scenarios is related to the use of
generic parametric and non-parametric distributions of pro-
sumptions. In this paper, the active and reactive prosumption
scenarios for each day are generated with the assumption
that
the prosumption proï¬le follow a normal distribution.
Therefore, the average of the prosumption over the scenarios
is equal to the given prosumption prediction, and the losses
predictions are calculated by averaging the losses over the
scenarios [4]. It is understood that the variables with subscript
l, Ï†, t are deï¬ned for lâˆˆL, Ï†âˆˆÎ¦d, tâˆˆT , respectively. plÏ†t is
aggregated active prosumption at bus l, scenario Ï†, time t,
and flÏ†t is square of current magnitude causing losses in line
l, scenario Ï†, and time t. rl is the total longitudinal resistance
of line l. Ëœpltd and Ëœfltd are avereage of the active load and
squared current causing losses over all scenarios at bus l, time
t, and day d, respectively. âˆ†plÏ†t and âˆ†flÏ†t are deviation (we
would call it as error hereafter) of prosumption and squared
current causing losses for scenario Ï† and time t from Ëœpltd and
Ëœfltd, respectively. (1) and (2) express the prosumption at each
bus l and the line losses of the line l by these variables. In
(3), a daily dispatch plan DPtd follows the predicted point of
the total prosumption considering the losses.

plÏ†t=Ëœpltdâˆ’âˆ†plÏ†t, âˆ€l, âˆ€Ï†, âˆ€t
rlflÏ†t=rl

Ëœfltdâˆ’rlâˆ†flÏ†t, âˆ€l, âˆ€Ï†, âˆ€t
(Ëœpltd+rl

Ëœfltd), âˆ€t

DPtd=

(cid:88)

(1)

(2)

(3)

lâˆˆL

In this context, the dispatch error with no dispatchable re-
sources in ADN is formally deï¬ned as the total error of
prosumption plus the line losses over the buses/lines as shown
in the left-hand side of (4). The installed ESSs in ADN can
be dispatched with acive power (pE
lÏ†t) to compensate for the
error. (cid:15)lÏ†t represents the residual dispatch error that cannot
be covered at bus l, scenario Ï†, and time t. To quantify the
covered or not covered error by the ESSs, we say that the sum
of the two parts, shown in the right-hand side of (4), is equal
to the dispatch error in case of no dispatchable resources.

(cid:88)

lâˆˆL

(âˆ†plÏ†t+rlâˆ†flÏ†t)=

(cid:88)

((cid:15)lÏ†t+pE

lÏ†t), âˆ€Ï†, âˆ€t

(4)

lâˆˆL

Finally, the objective term to minimize the power deviation
from the daily dispatch plan for all scenarios and time intervals
is expressed as follows.

minimize
pE

(cid:88)

(cid:88)

tâˆˆT

Ï†âˆˆÎ¦d

Î»Ï†d|

(cid:88)

lâˆˆL

(cid:15)lÏ†t|

(5)

Once the OPF problem including the constraints related to the
dispatchability is solved, we can calculate the capability of
ADN with the allocated ESS sizes to reduce the dispatch error.
In this context, we introduce a dispatchability index called

leftover dispatch error rate (LDER), and deï¬ned as Î¸Ï†td. It
represents the ratio between the resulting dispatch error and
the anticipated dispatch error in case of no ESS at scenario Ï†
and time t for the daily operation on day d, as expressed in (6)
(* here indicates that it is the identiï¬ed optimal solution). In
the denominator, indicating the dispatch error without ESS, the
error regarding the grid losses is ignored because its magnitude
is negligible compared to that of the prosumption error.

Î¸Ï†td=

| (cid:80)
| (cid:80)

lâˆˆL (cid:15)âˆ—
lÏ†t|
lâˆˆL âˆ†plÏ†t|

, âˆ€Ï†, âˆ€t

(6)

C. Augmented Relaxed Optimal power ï¬‚ow

l =P t

l =P b

l + jQt

For a radial power network, the power ï¬‚ow equations are
given in (7)-(10). The variables with subscript l are deï¬ned
for lâˆˆL. The upstream bus of bus l is notated as up(l). G is
the adjacency matrix of the network, where Gk,l is deï¬ned
for k, lâˆˆL and Gk,l=1 if k=up(l) or 0 if not. St
l + jQt
l
indicates the complex power injected into line l from node
up(l). Sb
b is the complex power injected into node
l from line l. sl=pl + jql represents the given prosumption
at node l. vup(l) and vl represents the nodal voltages at
node up(l) and l, respectively, whereas fl is the square of
the longitudinal (i.e., internal) current through line l which
produces grid losses through the line longitudinal impedance
zl=rl +jxl. bl indicates the shunt susceptance of line l. St
l and
Sb
l are determined by (7), and (8), respectively. (9) determines
the magnitude of nodal voltages, where R(.) represents the
real parts of a complex number. The current that produces
losses at line l is originally deï¬ned to be equal to the right-
hand side of (10). However, the equality is replaced with an
inequality, as shown in (10) by applying the SOCP relaxation
[13]. It is noteworthy that the equality of (10) only holds when
the terms in the objective function are strictly increasing with
respect to the internal current fl.
(cid:88)

Gl,mSt

l +zl flâˆ’j(vup(l)+vl)bl, âˆ€l

St

l =sl+

(7)

mâˆˆL
(cid:88)

Sb

l =sl+

mâˆˆL

Gl,mSt

l , âˆ€l

(8)

vl=vup(l)âˆ’2R

(cid:18)

(cid:16)

zâˆ—
l

St

l +jvup(l)bl

(cid:17)(cid:19)

+|zl|2fl, âˆ€l

(9)

flvup(l) â‰¥ |St

l +jvup(l)bl|2, âˆ€l

(10)

In order to avoid any inexact solution (i.e., any solution that
makes the left-hand side of (10) strictly greater than the right-
hand side, and thus without physical meaning), the Authors of
[15] introduced auxiliary variables to formulate the AR-OPF
model. These are Â¯fl, Â¯Sl= Â¯Pl+j Â¯Ql, Â¯vl and Ë†Sl= Ë†Pl+j Ë†Ql, which
stand for the upper bounds for internal current, complex power,
voltage and lower bounds for the complex power, respectively.
vmax and vmin are upper bounds and lower bounds of the
squared nodal voltage magnitude, respectively. I max
indicates
upper limit on the squared current of line l. P max
and Qmax
are upper limits of active and reacitve power ï¬‚ows for line l,
respectively. The branch power ï¬‚ow, nodal voltage, and current
equations are deï¬ned as well with the set of the auxiliary
variables, as shown in (11)-(17). (11) and (12) indicate the
lower bound of branch power ï¬‚ow at the sending end and
the receiving end of line l. The upper bound nodal voltage is
determined correspondingly with (13). Likewise, the branch
power ï¬‚ow equations for upper bound power ï¬‚ow variables
are shown as (14) and (15). (16) and (17) express that the upper
bound of the current fl should be decided by the maximum
of absolute complex power ï¬‚ow from both sides of line l. The

l

l

l

(18)
l|(cid:9)|2, âˆ€l
(19)
l |(cid:9)|2, âˆ€l (20)
(21)

3

voltage constraint, the ampacity constraint from the sending
end and the receiving end are modeled as in (18)-(20). Finally,
(21) are added to complete the set of equations required to
guarantee the exactness.
(cid:88)
Gl,m Ë†St

l âˆ’j(Â¯vup(l)+Â¯vl)bl, âˆ€l

Ë†St
l =sl+

(11)

Ë†Sb
l =sl+

mâˆˆL
(cid:88)

mâˆˆL

Gl,m Ë†St

l , âˆ€l

(cid:16)

Â¯vl=Â¯vup(l)âˆ’2R
Â¯St
l =sl+

(cid:88)

l ( Ë†St
zâˆ—
Gl,m Â¯St

Â¯Sb
l =sl+

mâˆˆL
(cid:88)

mâˆˆL

Gl,m Â¯St

l , âˆ€l

l +jÂ¯vup(l)bl)

(cid:17)

, âˆ€l

l +zlflâˆ’j(vup(l)+vl)bl, âˆ€l

l âˆ’jvlbl|(cid:9)|2, âˆ€l

l |(cid:9)|2
l |, | Â¯P b
l âˆ’jÂ¯vlbl|, | Â¯Qb
l |(cid:9)|2
l |, | Â¯P t
l+jÂ¯vup(l)bl|, | Â¯Qt

Â¯flvlâ‰¥| max (cid:8)| Ë†P b
+| max (cid:8)| Ë†Qb
Â¯flvup(l)â‰¥| max (cid:8)| Ë†P t
+| max (cid:8)| Ë†Qt
vmin â‰¤ vl, Â¯vl â‰¤ vmax, âˆ€l
vup(l)â‰¥| max (cid:8)| Ë†P t
I max
l

l |, | Â¯P t

l |(cid:9)|2+| max (cid:8)| Ë†Qt

l|, | Â¯Qt

l+jvup(l)bl|(cid:9)|2, âˆ€l

(12)

(13)

(14)

(15)

(16)

(17)

I max
l
Â¯P t
l â‰¤ P max
l

vlâ‰¥| max (cid:8)| Ë†P b
l |, | Â¯P b
Â¯Qt
lâ‰¤ Qmax
,
l

, âˆ€l

l |(cid:9)|2+| max (cid:8)| Ë†Qb

l |, | Â¯Qb

For the sake of readability, the equations mentioned above
are grouped and represented by Î˜(Ï•, Îº)â‰¥0 where Ï•=
{St, v, f, Ë†St, Â¯v, Â¯f , Â¯St, s} is the set of variables and Îº=
{G, z, b, vmax, vmin, I max, P max, Qmax} is the set of param-
eters. The notation without subscript corresponds to the vector
of variables and parameters for all buses/lines.

As already quantiï¬ed in [15], the set of grid constraints
employing the auxiliary variables slightly shrinks the original
feasible solution space, removing solution space related to
undesirable or extreme operation points of the network near
the upper bound of nodal voltage or linesâ€™ ampacity limits.1

D. Energy storage systems
The ESS investment

l

l

/Cmin
l

is modeled through (22)-(24).
Cmax
is maximum/minimum possible ESS energy reser-
l
voir capacity at bus l. Rmax
and Rmin
represent maximum
and minimum possible ESS power rating capacity at bus l.
In reality, available power ratings and energy capacities are
often restrained as seen in (22) and (23) due to various
physical constraints involving, for instance, manufactural or
geographical factors. CRmin is the minimum value for the rate
at which ESS is discharged relatively to its maximum energy
capacity. The power rating and energy reservoir is determined
considering this relationship as shown in (24).

Rmin
l Ulâ‰¤Rlâ‰¤Rmax
l Ulâ‰¤Clâ‰¤Cmax
Cmin

Ul, âˆ€l
Ul, âˆ€l

l

l

Rlâ‰¤

Cl
CRmin

, âˆ€l

(22)

(23)

(24)

1We show that

the compression of the solution space caused by the
augmented constraints is small by following the steps of numerical analysis
reported in [15]. Under the case study shown in Sec. IV, We make one of two
operating constraints (voltage upper bound constraint and ampacity constraint)
binding at one node or line and relax the other one to ï¬nd the difference
between the physical state variables (nodal voltage-magnitudes and original
current ï¬‚ow) and corresponding auxilary variables. The difference between
the nodal voltage-magnitude and the auxillary one is 0.001%. The difference
between the original current ï¬‚ow and the auxillary one is equal to 0.2%.

l

/Emin
l

The operational characteristic of ideal ESS is modeled with
equations (25)-(27). The variables with subscript l are deï¬ned
for lâˆˆL. EE
lt is state-of-energy (SoE) of ESS installed at bus
l for time t. Emax
is maximum/minimum allowed SoE
level. The capability curve of a given ESS is linearized by
constructing an inscribed square within the original circular
capability curve deï¬ned by the maximum complex power
of the ESS (see (25)). The SoE level of ESS changes with
the charge/discharge of the ESS at every time interval, as
described in (26). Also, (27) indicates that the SoE of the
ESS should be within the SoE limits.

âˆ’

Rlâˆš
2

â‰¤pE

lt â‰¤

EE
Emin

l(t+1)=EE
l Clâ‰¤EE

lt â‰¤

â‰¤qE

, âˆ’

Rlâˆš
2
lt +âˆ†t âˆ— pE
lt â‰¤Emax
l

Rlâˆš
2
lt , âˆ€l, âˆ€t
Cl, âˆ€l, âˆ€t

Rlâˆš
2

, âˆ€l, âˆ€t

(25)

(26)

(27)

In the interest of brevity, (25)-(27) are indicated by Î(Î·t, Î¾)â‰¥
0, âˆ€tâˆˆT where Î·={pE, qE, EE, U, R, C} is the set of vari-
ables and Î¾={âˆ†t, Emin, Emax} is the set of parameters.
The notation without subscript corresponds to the vectors of
variables and parameters for all buses/lines.

III. PROBLEM FORMULATION

The objective of the problem is to determine the optimal
sizes and sites of ESSs so that the active power through
the GCP follows the dispatch plan with minimal deviation.
However, it is clear that the dispatch error described as (5)
in Sec. II-B does not increase while the total grid losses
increase (a necessary condition of the AR-OPF). Therefore, the
exactness of the solution cannot be guaranteed if the objective
value that corresponds to the objective term (5) is signiï¬cant
in magnitude compared to objective term regarding the total
grid losses in the objective function of the AR-OPF model.

Therefore, we propose to decompose the problem into two
blocks each consisting of an OPF problem. In this way, we
can exclude (5) from the AR-OPF problem and convey it
to another, approximated, OPF problem (the so-called 1st
block problem), which aims to ï¬nd the optimal
level of
dispatchability based on the ESSs investment cost and the
imbalance penalty. The determined dispatchability level, de-
ï¬ned as LDER, is then introduced to an AR-OPF model-based
problem (the so-called 2nd block problem) as an index with
which the ADN has to comply with.

The whole algorithm of the proposed approach is illustrated
in Fig. 1. In the 1st block problem, the optimal ESSs alloca-
tion, the daily dispatch plans, and the corresponding LDER are
calculated employing linear approximated OPF ignoring the
grid losses. Only the nodal voltage constraints are considered
regarding the operational constraints, ignoring the ampacity
limits to reduce the computational burden. Afterward,
the
outputs of the 1st block, which are the ESS allocation and
the LDER, are used as inputs for the 2nd block problem.

In the 2nd block problem, the objective is to reï¬ne the
optimal allocation of the ESSs, considering several operating
scenarios and achieving the same level of LDER calculated in
the 1st block problem. In this respect, LDER is implemented as
an additional constraint to an AR-OPF model, which considers
the full AC-OPF as well as voltage constraints and line am-
pacity limits. Then, the size and site of the ESSs are iteratively
adjusted thanks to the Benders decomposition technique. This
iterative process starts initially with a feasibility check of the
ESS allocation resulting from the 1st block problem.

4

Fig. 1. Full algorithm of the proposed method.

A. 1st block problem

We minimize the investment and total penalty costs over
the planning horizon to ï¬nd out the optimal allocation of
the ESSs and the optimal dispatchability level. We embed an
approximated OPF constraints for all operating scenarios into a
two-stage mixed-integer linear programming problem (see Sec.
II-A). The OPF is formulated by the linear Distï¬‚ow model in
which shunt elements are considered, whereas the grid losses
are neglected. In this way, the reactive power generated by
the shunt impedance of the lines is accounted for in the nodal
voltage constraints. Meanwhile, neglecting the formulation of
the squared current (fl) (i.e., losses) is less likely to affect the
feasible solutions in this stage since the ampacity constraint is
ignored. The dispatch plan follows the prosumption prediction,
as shown in (28), while the prosumption deviation at node
l is expressed as shown in (29). We substitute (1) into the
active power balance equation, resulting in (30). The lossless
Distï¬‚ow power ï¬‚ow at both sides of line l including the ESS
power are expressed via (30)-(32). (33) calculates the nodal
voltage, which is governed by voltage constraint as shown
in (34). All the variables within (29)-(34) are deï¬ned for
lâˆˆL, Ï†âˆˆÎ¦d, tâˆˆT , and dâˆˆD.

DPtd=

(cid:88)

lâˆˆL

Ëœpltd, âˆ€t, âˆ€d

(cid:88)

âˆ†pl=

(cid:88)

((cid:15)l+pE

l ), âˆ€Ï†, âˆ€t, âˆ€d

(28)

(29)

lâˆˆL

lâˆˆL
l =P b
P t

l =Ëœplâˆ’âˆ†pl+pE

l +

(cid:88)

mâˆˆL

Gl,m P t

l , âˆ€l, âˆ€Ï†, âˆ€t, âˆ€d

(30)

Gl,m Qt

lâˆ’(vup(l)+vl)bl, âˆ€l, âˆ€Ï†, âˆ€t, âˆ€d

Qt

l=ql+qE

l +

Qb

l =ql+qE

l +

(cid:88)

mâˆˆL

(cid:88)

Gl,mQt

l, âˆ€l, âˆ€Ï†, âˆ€t, âˆ€d

mâˆˆL
(cid:16)
l (St
zâˆ—

vl=vup(l)âˆ’2R
l +jvup(l)bl)
vmin â‰¤ vl â‰¤ vmax, âˆ€l, âˆ€Ï†, âˆ€t, âˆ€d

(cid:17)

, âˆ€l, âˆ€Ï†, âˆ€t, âˆ€d

(31)

(32)

(33)

(34)

2ndBlock Problem1stBlock Problem :Solve MILP withObj:minimizeinvestment cost + penalty cost regarding dispatchabilityMaster Problem :Solve MILP withObj: minimize investment cost+âˆ‘ğ‘‘ğ‘‘ğ›¼ğ›¼ğ‘‘ğ‘‘Subproblems:Solve SOCPwithObj: minimize grid losses + unserved energy to satisfy the LDER constraints|UB-LB|<Îµ?SolutionUpdate LB, ESS allocationDaily OPF(Day 1) with Alg.1Daily OPF(Day 2) with Alg.1Daily OPF(Day D) with Alg.1â€¦FormBenders cutsESS allocation,LDER(ğœƒğœƒğœ™ğœ™ğœ™ğœ™ğ‘‘ğ‘‘)noyesESS allocationUpdate UB,  dual valuesDual values, subproblemcostsInitialization of  : LBâ†âˆ’âˆâ€¢UB: Upper boundâ€¢LB:Lowerboundâ€¢ğ›¼ğ›¼ğ‘‘ğ‘‘:approximated objective value of the subproblem for typical day ğ‘‘ğ‘‘â€¢ğœ€ğœ€:tolerance valueâ€¢:Input/OutputThe objective function is deï¬ned as to minimize the investment
cost (the ï¬rst line of (35)) of ESSs and the annual penalty cost
(the second line of (35)) regarding the uncovered dispatch error
over the planning horizon Y . The penalty cost of day d is
the uncovered dispatch error over the operating scenarios for
day d multiplied by Ï‰d, which is the cost coefï¬cient for the
imbalance. Nd stands for the number of days in a year that
have the same prosumption proï¬le as that of typical day d. â„¦1
and â„¦2 represents the set of control variables in the ï¬rst and
second stage decision process, respectively. The constraints
regarding the ESS allocation and operation explained in Sec.
II-D are included (i.e., (22)-(24), (36)), along with the linear
approximated lossless OPF constraints ((28)-(34)). By solving
the problem, the optimal allocation of ESSs along with the
dispatch plan is obtained, and the daily LDERs are calculated
by (6) concerning all days with the index dâˆˆD.

minimize
âˆ€U,C,Râˆˆâ„¦1;
âˆ€St,v,sE âˆˆâ„¦2

(cid:88)

(IcUl+IpRl+IeCl)

lâˆˆL

+Y

(cid:88)

dâˆˆD

Ndwd

(cid:88)

(cid:88)

tâˆˆT

Ï†âˆˆÎ¦d

Î»Ï†d|

(cid:88)

lâˆˆL

(cid:15)lÏ†t|

subject to: (22)-(24), (28)-(34),

(35)

Î(Î·Ï†td, Î¾)â‰¥0, âˆ€Ï†, âˆ€t, âˆ€d

(36)

B. 2nd block problem

The dispatchability level is incorporated into the 2nd block
problem as a constraint governed by the dispatchability in-
dex LDER. The objective of the 2nd block problem is to
adjust the ESS allocation from the 1st block problem to the
optimal site and size that can minimize the grid losses and
unserved load. The system condition during the operation
horizon is evaluated through solving the AR-OPF problem.
Therefore, the 2nd block problem is formulated as a Mixed-
integer second-order cone programming (MISOCP) problem.
A convex SOCP model can be obtained from the non-convex
MISOCP problem by using solution approaches that tackle
the integer variables, such as the Branch and bound algorithm.
However, the solution approach becomes computationally bur-
densome with the increase of integer variables. In this respect,
we apply the Benders decomposition technique to decompose
the 2nd block problem into a master problem and several
parallel subproblems that each represents a daily OPF problem.
The master problem determines the ESSs allocation, followed
by the ï¬tness evaluation of the determined allocations in the
subproblems in terms of grid losses and unserved load. The
unserved load takes values to ensure the feasibility of the
subproblem regardless of the ESS allocation.

The initial step of the 2nd block is to solve parallel subprob-
lems, checking the operational condition of ADN under the
ESS allocation and the corresponding LDER calculated from
the 1st block. The objective of the subproblem and the dual
values of ESS allocation are computed and sent to the master
problem to construct the ï¬rst Benderâ€™s cut. Through multiple
iterations between the master problems and the subproblems,
the convergence is reached when the gap between the lower
bound of the total cost (LB) and the upper bound of the total
cost (UB) becomes less than a tolerance (i.e., 0.01% of UB).
LB is determined from the master problem, whereas UB is
determined after solving subproblems.

1) Master problem: The formulation of the master problem
is given in (37). The master problem computes the lower
bound of the planning problem by summing the investment
cost and the lower approximation of the subsequent expected
subproblem costs. Each Î±d represents the subproblem cost for

5

days classiï¬ed into each day type. It is initially bounded by
Î±, which is the parameter given as the lower bound for the
subproblem cost. nâˆˆN is the index of benders iterations. In
every nth iteration, Benders cuts represented by Î“(n)
(see (51))
are added as additional constraints for days dâˆˆD, as shown
in (38). The lowerbound of the total cost, so-called LB, is
determined by the optimal solution of the master problem (i.e.,
LB=IcU âˆ—

l +IpRâˆ—

l +IeC âˆ—

dâˆˆD Î±âˆ—
d).

l + (cid:80)

d

minimize
âˆ€,U,C,R,Î±

IcUl+IpRl+IeCl+

(cid:88)

dâˆˆD

Î±d

subjected to : (22)-(24),
Î±dâ‰¥Î±, Î±dâ‰¥Î“(n)

d , âˆ€d, âˆ€n

(37)

(38)

2) Subproblem: In the subproblem associated with day d,
a daily AR-OPF model with the time-step discretization of 15
minutes evaluates the operational advantages of ESSs while
considering real operational conditions. The variables with
subscript l, Ï†, t are deï¬ned for lâˆˆL, Ï†âˆˆÎ¦d, tâˆˆT , respectively.
The sufï¬ciency of the ESS allocation is assessed by checking
if the uncovered dispatch error (see (4)) satisï¬es the LDER
for day d as shown in (39). As indicated in (40) and (41),
we introduce positive and negative unserved active load terms
lÏ†tâˆˆR+) and positive and negative unserved reac-
(ulp+
lÏ†tâˆˆR+) to the active prosumption
tive load terms (ulq+
and reactive prosumption at bus l, scenario Ï† and time t,
respectively. They correspond to the amount that should be
curtailed from the prosumption to primarily comply with the
LDER constraint along with other operational constraints, even
in the case of insufï¬cient capacity of ESSs.

lÏ†t, ulpâˆ’

lÏ†t, ulqâˆ’

(cid:88)

|

(cid:15)lÏ†t|â‰¤Î¸Ï†td|

(cid:88)

lâˆˆL

âˆ†plÏ†t|, âˆ€Ï†, âˆ€t

lâˆˆL
lÏ†t=plÏ†t+ulp+
p(cid:48)
lÏ†t=qlÏ†t+ulq+
q(cid:48)
lÏ†t= Ëœp(cid:48)
lÏ†tâˆ’âˆ†p(cid:48)
p(cid:48)
(cid:88)
( Ëœp(cid:48)
DPtd=

lÏ†tâˆ’ulpâˆ’
lÏ†tâˆ’ulqâˆ’
lÏ†t, âˆ€l, âˆ€Ï†, âˆ€t
Ëœfltd), âˆ€t

ltd+rl

lÏ†t, âˆ€l, âˆ€Ï†, âˆ€t
lÏ†t, âˆ€l, âˆ€Ï†, âˆ€t

(cid:88)

lâˆˆL
lÏ†t+rlâˆ†flÏ†t)=

(âˆ†p(cid:48)

(cid:88)

((cid:15)lÏ†t+pE

lÏ†t), âˆ€Ï†, âˆ€t

(39)

(40)

(41)

(42)

(43)

(44)

lâˆˆL

lâˆˆL

l to build (44). Similarly, p(cid:48)

The AR-OPF problem embedding the dispatchability for
the subproblem is formulated by replacing (1) with (42).
In other words, we replace the prosumption pl by p(cid:48)
l in the
relevant equations. Ëœp(cid:48)
l is employed in place of Ëœpl to determine
the daily dispatch plan, as shown in (43). âˆ†pl of (4) is
substituted with âˆ†p(cid:48)
l replace
pl and ql in the active power balance equations formulated
with the state variables (i.e., (7), (8)) and the auxiliary
(15)). The equations of
(14),
variables (i.e.,
AR-OPF model with ESSs are re-deï¬ned as (45), where Ï•(cid:48)=
{St, v, f, Ë†St, Â¯v, Â¯f , Â¯St, s(cid:48)=(p(cid:48)+pE)+j(q(cid:48)+qE), ulp+, ulpâˆ’, ulq+,
ulqâˆ’} is the set of variables and Îº={G, z, b, vmax, vmin,
I max, P max, Qmax} is the set of parameters. The ESS power
is governed by the set of operational constraints as (46).

l and q(cid:48)

(11),

(12),

Î˜(cid:48)(Ï•(cid:48)
Ï†t, Îº)â‰¥0, âˆ€Ï†, âˆ€t
Î(Î·Ï†t, Î¾)â‰¥0, âˆ€Ï†, âˆ€t.

(45)
(46)

However, we can intuitively expect that having (44) can-
not be compliant with the mathematical formulation of the
power ï¬‚ow equations (i.e., (7)-(10)) in the case of insufï¬cient
capacity of ESS to satisfy the LDER constraint (39). The
insufï¬cient power rating of ESS means that possible pE
is
l

small, making (cid:15)l too large to comply with LDER constraint
(see (44)). However, instead of making the problem infeasible,
LDER constraint and (44) are both satisï¬ed by reducing the
total dispatch error (left-hand side of (44)). This leads to the
violation of the physical law of power ï¬‚ow because the grid
losses error should take an unrealistic value that has the same
order of magnitude as the prosumption deviation. In this way,
the prosumption error and grid losses error cancel out each
other to make the overall value of the left-hand side as small as
the right-hand side of (44). It would induce the increase of the
current fl such that the left-hand side of (10) becomes strictly
greater than the right-hand side, which leads to the inexactness
of the solution. Therefore, we introduce an iterative algorithm,
Alg. 1, comprising two additional slack variables, Î³m
Ï†t and
Î¶Ï†t, to replace (44) by (47) and (48) such that the value of
the internal current would never deviate away from the real
value (i.e., the exactness of the solution is guaranteed). Î³m
Ï†t
represents the realized grid losses deviation at mth iteration for
scenario Ï† and time t, where mâˆˆM is the index of iterations
of the algorithm. Î¶Ï†t indicates the unrealized part of the grid
losses that should be updated to Î³m
Ï†t after each iteration for
scenario Ï† and time t. Î³m
Ï†t achieves the accurate value of grid
losses deviation, as the absolute value of Î¶Ï†t reaches value
below the deï¬ned tolerance (i.e., 1e-5 pu.).

6

IV. SIMULATION
We validate the performance of the proposed methods
with an existing Swiss distribution network with 55 bus and
large capacity of renewable generation, as shown in Fig. 2.
The base voltage is 21kV and the base 3 phase power is
6MVA. 2.7MWp of PV generation capacity and 805kVA of
hydropower generation capacity is installed. The planning
horizon is set as 10 years, and we assume that the load con-
sumption does not grow over the planning horizon. According
to the indications of the operator of this grid, the number of
candidate nodes for ESS installation is set as 5 out of 55 nodes
(see Table I). To make sure to achieve the dispatchability, the
penalty cost for the dispatch error is assumed as $700/MWh,
which is signiï¬cantly higher than a typical price settled in
energy markets. The optimization problems are solved using
the solver MOSEK via the MATLAB interface YALMIP.

TABLE I
ESS PARAMETER AND CANDIDATE NODES FOR SIMULATION

3MW

Maximum power
rating per site
Installation cost
for energy reservoir
Capital investment cost per site
Candidate nodes for ESS

$300/kWh

Maximum energy
reservoir per site
Installation cost
for power rating

4MWh

$200/kVA

$0.1M
4, 16, 27, 41, 45

(cid:88)

(âˆ†p(cid:48)

lÏ†t+rlâˆ†flÏ†t)=

((cid:15)lÏ†t+pE

lÏ†t)+Î¶Ï†t, âˆ€Ï†, âˆ€t

(47)

(cid:88)

lâˆˆL
(cid:88)

lâˆˆL

âˆ†p(cid:48)

lÏ†t+Î³m

Ï†t=

(cid:88)

lâˆˆL

lâˆˆL
((cid:15)lÏ†t+pE

lÏ†t), âˆ€Ï†, âˆ€t

(48)

Algorithm 1 Iterative realization of grid losses deviation
Input : Î¸d(LDER), Îº, s=p+jq, Râˆ—, C âˆ— (see (50))
1: Initialization : m=1, Î³1=0, Î¶=1;
2: while |Î¶|â‰¥tolerance do
3:
4:
5: mâ†m+1
6: end while

Solve a subproblem including (47) and (48)
Î³m+1â†Î³m+Î¶

Finally, the subproblem is described with an objective of
minimization of the total grid losses and unserved load to
satisfy the LDER constraint, and the operation period spans
all days grouped into each day-type over the planning horizon.

minimize
âˆ€Ï•(cid:48),Î·,U L

: SCd=Y Nd

(cid:88)

(cid:88)

Î»Ï†d(wl

(cid:88)

lâˆˆL

rlflÏ†t

(ulp+

lÏ†t + ulpâˆ’

tâˆˆT

Ï†âˆˆÎ¦d
lÏ†t + ulq+

lÏ†t + ulqâˆ’

lÏ†t))

+wu

(cid:88)

lâˆˆL

(49)

subject to: (39), (40), (41) (43), (45)-(48),

Rl=Râˆ—
d =(cid:2)SCâˆ—
Î“(n)

l :Âµld, Cl=C âˆ—
dâˆ’

l :Ï‘ld, âˆ€l.
(Âµld(Rlâˆ’Râˆ—

(cid:88)

l )âˆ’Ï‘ld(Clâˆ’C âˆ—

(50)
l ))(cid:3), âˆ€d, âˆ€n (51)

lâˆˆL

where U L={ulp+, ulpâˆ’, ulq+, ulqâˆ’} is the set of variables
related to the unserved load. wl and wu are the weight
coefï¬cients associated with the grid losses minimization and
unserved load, respectively. (50) describes that the ESS power
ratings and the energy reservoirs are ï¬xed to the optimal solu-
tion values of the master problem. Âµl,d and Ï‘l,d are the duals
of constraints related to the ï¬xed ESS capacities, and are used
to form the benders cuts for the master problems as shown in
(51). UB is calculated summing the optimal investment cost
and the subproblem costs (i.e., U B=IC âˆ—+ (cid:80)

dâˆˆD SCâˆ—
d).

Fig. 2. Considered real 55 bus distribution feeder.

We have considered 8 typical day-types to cover the sea-
sonal variation of the prosumption over the year. For each day-
type, we assumed that prosumption forecasts for the simulation
have been given from a reliable forecasting methodology. 1000
prosumption scenarios for each day are generated with equal
probabilities based on the assumption that the prosumption
proï¬le follows a normal distribution as discussed in Sec. II-B.
Then, we applied a K-medoids clustering [18] based scenario
reduction technique to mitigate the computational burden. The
number of reduced number of scenarios is determined by an
algorithm explained in Sec. A.

A. Planning with 1 day under hourly dispatch

To illustrate the role of the 1st and 2nd block of the
problem, we demonstrate the result of the simpliï¬ed simulation
considering an hourly dispatch for 1 representative day in
two cases: case 1 with the original ampacity of the lines
speciï¬ed for the given grid and case 2 with the ampacity of line
between node 4 and 20 reduced from the original value (see
Fig. 2). 32 representative scenarios obtained from the scenario
reduction algorithm in Sec. A are used as operating scenarios.
Table II indicates the optimal allocation result of ESS. The
optimal result from the 1st block speciï¬es the capacity in
size of power rating and energy reservoir of ESS. However,
the determined allocation of ESS cannot be guaranteed to be
feasible and optimal to satisfy the LDER for the real operation

PVPVPVPVPVPVPVPVPVPVPVPVPVPVPVPVPVPVPVPVPVPVPVPV2272313226742351105015281430554494853342112313247464333199202643917164511444155252440382983518373652Solar PV unit21 kV nodeNon-candidate node1Hydro power plant1ESS candidate node1Line of which ampacity limit is reducedof the grid, since the grid losses and the ampacity constraint
were neglected in the 1st block problem. After the 2nd block
of the problem, as shown in the result of case 1 in Table
II, the optimal site of the ESS considering the objective of
minimization of the grid losses is determined as node 4 and
27, resulting in the reduction of the grid losses and unserved
energy compared to the result of the 1st block problem.

In case 2, we can observe that a part of the load consump-
tion was unserved to satisfy the LDER in the condition of
restrained ampacity limit with the determined ESS allocation
from the 1st block. In this regard, the result of the 2nd block
shows the change in the allocation of the ESS due to the
bottleneck of the line. The power rating and energy reservoir
of the ESS on Node 4 is reduced, and those of the ESS on
Node 27 is increased. Table III shows that the unserved energy
decreased to near zero after re-allocating the ESS.

TABLE II
ESS ALLOCATION RESULT

Case

1

2

Problem
1st Block

2nd Block

2nd Block

Location
41
4
27
4
27

Power rating
712 kVA
372 kVA
338 kVA
360 kVA
350 kVA

Energy reservoir
1.958 MWh
803 kWh
1.176 MWh
732 kWh
1.247 MWh

TABLE III
COMPARISON BETWEEN THE RESULT OF 1ST BLOCK AND 2ND BLOCK

Case

Horizon

Type of cost

case1

case2

10 years

1 year

10 years

1 year

Investment cost
Penalty cost
Unserved energy
to satisfy the LDER
Grid losses
Investment cost
Penalty cost
Unserved energy
to satisfy the LDER
Grid losses

Allocation
of 1st block
$0.830M
$0.708M

Allocation
of 2nd block
$0.935M
$0.708M

13.53kWh

8.68kWh

41.736MWh
$0.830M
$0.708M

39.708MWh
$0.936M
$0.708M

17.407MWh

8.11kWh

41.623MWh

39.714MWh

B. Planning with full scenarios under 15 min dispatch

The proposed planning procedure is applied to the full set of
scenarios with 8 typical days under 15 min interval dispatch.
We apply scenario reduction technique to 1000 scenarios of
each day-type based on the algorithm in Sec. A. The largest
number of reduced scenarios over all day-types is determined
as 39 scenarios. Table IV shows the optimal ESS locations
and sizes. We exhibit the results for two cases corresponding to
case with no ESS installed and case with the optimal allocation
of ESS. Fig. 3 illustrates the operation result for day-type 1,
showing the prosumption prediction considering 39 scenarios
of the prosumption proï¬les, the dispatch plan, and the active
power infeed through GCP corresponding to each scenario
in the case of no ESS (see Fig. 3.(a)) and the optimal ESS
allocation (see Fig. 3.(b)). The dispatch result without ESS
shows that the dispatch error is signiï¬cant, especially in the
time where the production from PV is high. On the other hand,
in the case with the optimal ESS allocation, the active power
infeed of every prosumption scenario follows the dispatch plan
with small error. The cost analysis between the case with
ESS and without ESS in Table V demonstrates quantitatively
the capability of ESS to handle uncertainties within the grid.
The annual dispatch error of the case without ESS is about
22 times of that in the case with ESS. The difference in
the dispatch error is translated into the signiï¬cant gap in
the total cost for 10 years of operation: $9.09 Million with
the default system conï¬guration, and $1.41 Million with the

optimal ESS allocation. Consequently, this result demonstrates
the advantages for the DSO to invest on ESS in view of their
technical and economical proï¬t.

7

TABLE IV
ESS ALLOCATION RESULT

Problem
1st Block

2nd Block

Location
16
4
27

Power rating
1.312MVA
544.55kVA
764.42kVA

Energy reservoir
1.816MWh
908.82kWh
921.65kWh

TABLE V
COST AND OPERATIONAL ADVANTAGE COMPARISON

Horizon

10 years

1 year

Total cost
Investment cost
Penalty cost
Uncovered error
Grid losses
Total energy consumed

Without ESS
$9.09M
-
$9.09M
1.299GWh
59.578MWh
8.101GWh

With ESS
$1.41M
$1.01M
$0.40M
57.38MWh
53.879MWh
8.139GWh

(a)

(b)
Fig. 3. Prosumption prediction, dispatch plan and active power through GCP
in each scenario: (a) Day 1(No ESS), (b) Day 1(With ESS).

V. DISCUSSION ON THE LIMITATION OF THE RESEARCH
Modeling the prosumption uncertainty can affect the ï¬delity
of the optimal solution regarding the allocation of ESS and
the dispatchabiliy level of an ADN. However, as modeling of
prosumption stochasticity is not the scope of this paper, the
prosumption scenarios are generated simply assuming that the
prosumption follows a normal distribution. Nevertheless, when
a modeler is equiped with a robust scenario generater which
models accurately the prosumption uncertainty, the proposed
approach can guarantee the reliable performance. Another
limitation of the proposed approach relates to the condition
on the objective function for guaranteeing the exactness of
the solution. This condition may limit the extendibility of the
application for various control objectives of DSOâ€™s interest.
For example, the minimization of the voltage deviation or
control on ESS energy level may not satisfy the condition
for the exactness, and having these objective terms within
the objective function may affect the quality of the solution.
Therefore, appropriate modiï¬cation on the AR-OPF model
would be necessary corresponding to such control objectives.

VI. CONCLUSION
In this study, we have presented a tool for the optimal
planning of ESSs within a distribution network to achieve

0102030405060708090100Timestep (15 min interval)-3000-2000-10000100020003000Active Power(kW)sc1sc2sc3sc4sc5sc6sc7sc8sc9sc10PredictionDispatch Plan0102030405060708090100Timestep (15 min interval)-3000-2000-10000100020003000Active Power(kW)sc1sc2sc3sc4sc5sc6sc7sc8sc9sc10PredictionDispatch Planits dispatchability. We have shown that the uncertainty of
the prosumption can be compensated sufï¬ciently with the
allocation and exploitation of ESS. The non-approximated and
convex OPF model, or the AR-OPF model is implemented
to account for the operational conditions of the distribution
network accurately. The planning problem is decomposed into
two blocks to satisfy the condition for the exactness of the
solution via the AR-OPF model. In the 1st block, the allocation
of ESS is determined along with the corresponding LDER by
implementing the linearly approximated OPF model. The AR-
OPF is used in the 2nd block of the problem to check the
compatibility of the allocated capacity for the real operation
of the grid to satisfy the LDER and to determine the optimal
location of the ESS to minimize the grid losses. We validated
the effectiveness of the proposed method for a real Swiss
ADN of 55 nodes by demonstrating that the allocation of ESS
successfully reduced the dispatch error.

APPENDIX A
SCENARIO REDUCTION ALGORITHM

Ï†, ..., Î½H

Each of the generated scenarios is expressed as vector

lâˆˆL(T AL(l)+T RL(l)

Ï† }, âˆ€Ï†âˆˆÎ¦d where H=(cid:80)

Ï†=cdf (Î½h
Ï†), yh

Î½Ï†={Î½1
+T P V . T AL(l), T RL(l), and T P V are the time duration of the
daily active, reactive load at node l, and PV irradiation proï¬les,
respectively. Firstly, we construct a cumulative distribution
function (CDF) for each random variable Î½h with scenario
Ï† )=P (Î½hâ‰¤Î½h
set Î¦d, which is given by yh
Ï† ), âˆ€Ï†âˆˆ
Î¦d, hâˆˆ{1, ..., H}=H. cdf âˆ’1(yh
Ï†âˆˆ[0, 1] represents its in-
verse function. The obejctive of the algorithm is to ï¬nd the
minimal number of reduced scenarios such that the average
distance between the CDF of the initial scenario set and that of
the reduced scenario set over number of check points becomes
smaller than a given tolerance. We deï¬ne the check points for
caclulating the distance between the CDF curve of scenario
set Î¦d with another CDF curve as cdf âˆ’1(yÎ¦d (q)), yÎ¦d (q)âˆˆ
[0, 1], âˆ€qâˆˆ{1, ..., Nq}. In this paper, we selected Nq=5, with
quantiles ranging [0.05, 0.95]. The scenario reduction process
is initialized by applying K-Medoids clustering method [18]
based on the Euclidean distance between each scenario pairs
to reduce the original scenario set into set Î¦(cid:48)
d with a single
representative scenario. The average distance between CDFs
of different scenario set Î¦d and Î¦(cid:48)
d is calculated by index de-
(cid:19)2
(q))âˆ’cdf âˆ’1(yh
Î¦(cid:48)
d

(cid:115)

(q))

ï¬ned by âˆ†=(cid:80)

(cid:18) cdf âˆ’1(yh
Î¦d
cdf âˆ’1(yh

1
H

(cid:80)
h

q Ï‰q

,

(q))

Î¦d

where Ï‰q is the weight coefï¬cient assigned to qth check
point. As the distance is bigger than a threshold value, the
scenario reduction is re-applied to produce a scenario set with
incremented number of scenarios than the previous iteration.
Fig. 4(a) shows a CDF of original scenario set with the
CDFs of different reduced scenario sets regarding a single
random variable. The proposed algorithm determines that the
minimum number of scenarios required is 39. Fig. 4(b) shows
the evlolution of âˆ† w.r.t the number of reduced scenarios.

8

(a)

(b)

Fig. 4. (a) CDF of initial scenario set and reduced scenario sets with different
number of reduced scenarios, (b) Average of normalized distance between
initial and reduced scenario sets with different number of reduced scenarios
Algorithm 2 Scenario reduction
1: Generate NÎ¦d scenarios for Î½
2: Draw CDF graphs of Î½h, âˆ€hâˆˆH with scenario set Î¦d.
3: Initialization: NÎ¦(cid:48)
=0, âˆ†=âˆ
4: while |âˆ†|â‰¥tolerance do
+ 1
â†NÎ¦(cid:48)
5: NÎ¦(cid:48)
scenarios for Î½ via K-medoids clustering
Obtain NÎ¦(cid:48)
6:
Draw CDF graphs of Î½h, âˆ€hâˆˆH with scenario set Î¦(cid:48)
d.
Compute âˆ† between the two CDFs of set Î¦d and Î¦(cid:48)
d.

d

d

d

d

7:
8:
9: end while
10: return NÎ¦(cid:48)

d

, Î½Ï†(cid:48)

d

, âˆ€Ï†(cid:48)

dâˆˆÎ¦(cid:48)
d

REFERENCES

[1] G. Koeppel and M. KorpËšas, â€œImproving the network infeed accuracy of
non-dispatchable generators with energy storage devices,â€ Electr. Pow.
Syst. Res., vol. 78, no. 12, pp. 2024â€“2036, 2008.

[2] E. Perez, H. Beltran, N. Aparicio, and P. Rodriguez, â€œPredictive power
control for pv plants with energy storage,â€ IEEE Trans. Sustain. Energy,
vol. 4, no. 2, pp. 482â€“490, April 2013.

[3] R. R. Appino et al., â€œOn the use of probabilistic forecasts in scheduling
of renewable energy sources coupled to storages,â€ Applied energy, vol.
210, pp. 1207â€“1218, 2018.

[4] F. Sossan, E. Namor, R. Cherkaoui, and M. Paolone, â€œAchieving the
dispatchability of distribution feeders through prosumers data driven
forecasting and model predictive control of electrochemical storage,â€
IEEE Trans. Sustain. Energy, vol. 7, no. 4, pp. 1762â€“1777, Oct 2016.
[5] Q. Li, et al., â€œOn the determination of battery energy storage capacity
and short-term power dispatch of a wind farm,â€ IEEE Trans on Sustain.
Energy, vol. 2, no. 2, pp. 148â€“158, April 2011.

[6] Y. Zheng et al., â€œOptimal allocation of energy storage system for risk
mitigation of discos with high renewable penetrations,â€ IEEE Trans.
Power Syst., vol. 29, no. 1, pp. 212â€“220, Jan 2014.

[7] Y. Zheng, D. J. Hill, and Z. Y. Dong, â€œMulti-agent optimal allocation of
energy storage systems in distribution systems,â€ IEEE Trans on Sustain.
Energy, vol. 8, no. 4, pp. 1715â€“1725, 2017.

[8] A. Giannitrapani et al., â€œOptimal allocation of energy storage systems
for voltage control in lv distribution networks,â€ IEEE Trans. Smart Grid,
vol. 8, no. 6, pp. 2859â€“2870, 2016.

[9] M. Nick, R. Cherkaoui, and M. Paolone, â€œOptimal allocation of dis-
persed energy storage systems in active distribution networks for energy
balance and grid support,â€ IEEE Transs on Power Syst., vol. 29, no. 5,
pp. 2300â€“2310, Sep. 2014.

[10] M. Qin et al., â€œOptimal planning and operation of energy storage systems
in radial networks for wind power integration with reserve support,â€ IET
Gener. Transm. Distrib., vol. 10, no. 8, pp. 2019â€“2025, 2016.

[11] E. Grover-Silva et al., â€œOptimal sizing and placement of distribution
grid connected battery systems through an socp optimal power ï¬‚ow
algorithm,â€ Applied Energy, vol. 219, pp. 385â€“393, 2018.

[12] Q. Li, R. Ayyanar, and V. Vittal, â€œConvex optimization for des planning
and operation in radial distribution systems with high penetration of
photovoltaic resources,â€ IEEE Trans. Sustain. Energy, vol. 7, no. 3, pp.
985â€“995, 2016.

[13] R. A. Jabr, â€œRadial distribution load ï¬‚ow using conic programming,â€

IEEE Trans. Power Syst., vol. 21, no. 3, pp. 1458â€“1459, 2006.

[14] K. Christakou, D.-C. Tomozei, J.-Y. L. Boudec, and M. Paolone, â€œAc
opf in radial distribution networks part i: On the limits of the branch
ï¬‚ow convexiï¬cation and the alternating direction method of multipliers,â€
Electr. Pow. Syst. Res., vol. 143, pp. 438 â€“ 450, 2017.

[15] M. Nick, R. Cherkaoui, J. L. Boudec, and M. Paolone, â€œAn exact convex
formulation of the optimal power ï¬‚ow in radial distribution networks
including transverse components,â€ IEEE Trans. Autom. Control, vol. 63,
no. 3, pp. 682â€“697, March 2018.

00.511.52Sample value00.51Probability100010203039010203040Number of scenarios0.10.150.20.250.3[16] M. Nick, R. Cherkaoui, and M. Paolone, â€œOptimal planning of dis-
tributed energy storage systems in active distribution networks embed-
ding grid reconï¬guration,â€ IEEE Trans. Power Syst., vol. 33, no. 2, pp.
1577â€“1590, March 2018.

[17] A. M. Geoffrion, â€œGeneralized benders decomposition,â€ J. Optimiz.

Theory App., vol. 10, no. 4, pp. 237â€“260, 1972.

[18] A. K. Jain, R. C. Dubes et al., Algorithms for clustering data. Prentice

hall Englewood Cliffs, NJ, 1988, vol. 6.

9

