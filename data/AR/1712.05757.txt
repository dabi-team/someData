7
1
0
2
c
e
D
5
1

]

R
S
.
h
p
-
o
r
t
s
a
[

1
v
7
5
7
5
0
.
2
1
7
1
:
v
i
X
r
a

Solar Physics
DOI: 10.1007/•••••-•••-•••-••••-•

Optimization of photospheric electric ﬁeld estimates
for accurate retrieval of total magnetic energy
injection
Solar Physics

E. Lumme1
E. K. J. Kilpua1

· J. Pomoell1

·

c(cid:13) Springer ••••

Abstract Estimates of the photospheric magnetic, electric and plasma veloc-
ity ﬁelds are essential for studying the dynamics of the solar atmosphere, for
example through the derivative quantities of Poynting and relative helicity ﬂux
and by using of the ﬁelds to obtain the lower boundary condition for data-
driven coronal simulations. In this paper we study the performance of a data
processing and electric ﬁeld inversion approach that requires only high-resolution
and high-cadence line-of-sight or vector magnetograms – which we obtain from
Helioseismic and Magnetic Imager (HMI) onboard Solar Dynamics Observatory
(SDO). The approach does not require any photospheric velocity estimates,
and the lacking velocity information is compensated using ad hoc assumptions.
We show that the free parameters of these assumptions can be optimized to
reproduce the time evolution of the total magnetic energy injection through the
photosphere in NOAA AR 11158, when compared to the recent state-of-the-art
estimates for this active region. However, we ﬁnd that the relative magnetic he-
licity injection is reproduced poorly reaching at best a modest underestimation.
We discuss also the eﬀect of some of the data processing details on the results,
including the masking of the noise-dominated pixels and the tracking method
of the active region, both of which have not received much attention in the
literature so far. In most cases the eﬀect of these details is small, but when the
optimization of the free parameters of the ad hoc assumptions is considered a
consistent use of the noise mask is required. The results found in this paper imply
that the data processing and electric ﬁeld inversion approach that uses only the
photospheric magnetic ﬁeld information oﬀers a ﬂexible and straightforward way
to obtain photospheric magnetic and electric ﬁeld estimates suitable for practical
applications such as coronal modeling studies.

(cid:66) E. Lumme

erkka.lumme@helsinki.ﬁ

1 Department of Physics, University of Helsinki, P.O. Box 64, 00014 Helsinki, Finland

SOLA: paper_draft.tex; 16 September 2021; 10:10; p. 1

 
 
 
 
 
 
Keywords: Corona, Active; Corona, Models; Helicity, Magnetic; Helicity, Ob-
servations; Magnetic ﬁelds, Photosphere; Magnetic ﬁelds, Corona

E. Lumme et al.

1. Introduction

Determination of the photospheric magnetic, electric and plasma velocity ﬁelds
is central for understanding many of the dynamical processes in the solar at-
mosphere. These ﬁelds are required for quantifying the transport of magnetic
ﬂux, energy and helicity from the solar interior through the photosphere to the
chromosphere and corona (Liu and Schuck, 2012; Tziotziou, Georgoulis, and Liu,
2013; Kazachenko et al., 2015). They also form the essential input for data-driven
modeling of the corona (Wiegelmann, Petrie, and Riley, 2015; Inoue, 2016; Leake,
Linton, and Schuck, 2017), in which the ﬁelds are used to specify the boundary
condition at the lower radial boundary of the simulations. Due to the sparsity of
direct observations of many of the key quantities that characterize the coronal
plasma – most prominently the magnetic ﬁeld – data-driven simulations oﬀer
currently the most feasible and often the only way to quantify the dynamics of
the corona. Consequently, data-driven modeling is the key for studying a variety
of coronal phenomena, including coronal mass ejections (CMEs) (e.g., Chen,
2011; Pagano, Mackay, and Poedts, 2013) and ﬂares (e.g., Shibata and Magara,
2011; Jiang et al., 2016), and the formation of the solar wind (e.g., Riley et al.,
2011).

Remote sensing measurements of the photospheric magnetic ﬁeld vector and
the line-of-sight (LOS) component of the plasma velocity are routinely made
at high resolution by both space-based (Tsuneta et al., 2008; Scherrer et al.,
2012) and ground-based instruments (e.g., Mickey et al., 1996; Keller, Harvey,
and Giampapa, 2003). However, the available data does not directly provide the
photospheric plasma velocity vector and/or the electric ﬁeld, as a result making
it necessary to employ rather complex inversion methods to fully retrieve these
ﬁelds. A variety of methods exists for this task (Welsch et al., 2007; Ravindra,
Longcope, and Abbett, 2008; Schuck, 2008; Kazachenko, Fisher, and Welsch,
2014; Tremblay and Vincent, 2015), all sharing similar basic building blocks:
The photospheric velocity/electric ﬁelds are constrained to be consistent with
the available time series of the magnetic ﬁeld measurements and the (ideal)
magnetohydrodynamic induction equation (or Faraday’s law). Moreover, most of
the methods employ optical ﬂow methods (e.g., Schuck, 2006) to acquire a proxy
for the transverse plasma velocity component, for which no direct remote sensing
observations exist. Some of the methods additionally employ the LOS velocity
estimates from Dopplergrams (i.e., full-disk photospheric Doppler images) as an
additional constraint.

In the face of the incomplete input data that inherently includes noise as well
as calibration issues (Welsch, Fisher, and Sun, 2013; Lagg et al., 2015; Schuck
et al., 2016), it is clear that any given inversion method can only yield results up
to a certain degree of accuracy. So far the performance of the methods has been
evaluated using synthetic photospheric data extracted from a magnetohydrody-
namics (MHD) simulation in which the true plasma velocity and electric ﬁelds are

SOLA: paper_draft.tex; 16 September 2021; 10:10; p. 2

Optimization of photospheric electric ﬁeld estimates

known (Abbett et al., 2004; Welsch et al., 2007). The best-performing methods
in these tests include the PDFI method of Kazachenko, Fisher, and Welsch
(2014) and DAVE4VM by Schuck (2008). In addition to quantifying the degree
to which the velocity and electric ﬁelds of the simulation are reproduced, the
tests of the methods have focused also on the correct reproduction of the ﬂuxes
of magnetic energy (i.e., Poynting ﬂux) and relative magnetic helicity through
the photosphere, as both of these quantities are central for coronal dynamics.
Suﬃcient amount of magnetic energy, and more speciﬁcally free magnetic energy
– energy in excess of that of the potential magnetic ﬁeld conﬁguration – is pivotal
for solar eruptions (Aly, 1991; Chen, 2011; Shibata and Magara, 2011). Relative
magnetic helicity – the helicity in excess of the helicity of the potential magnetic
ﬁeld conﬁguration – may have a signiﬁcant role at least in some solar eruptions
though its signiﬁcance is still under debate (D´emoulin, 2007). For example,
Tziotziou, Georgoulis, and Raouaﬁ (2012) found, using non-linear force-free ﬁeld
modeling for a large number of active regions, that eruptive active regions tend
to accumulate large budgets of both free magnetic energy and signed relative
helicity. On the other hand, Pariat et al. (2017) recently found, using and a set
of coronal MHD simulations in an idealized settings, that a large signed relative
helicity budget does not provide a reliable eruptivity proxy. Instead they found
that it is the ratio between the relative helicity in the current-carrying part
of the ﬁeld and the total relative helicity that best diﬀerentiates eruptive from
non-eruptive coronal conﬁgurations.

The accurate estimation of the Poynting and helicity ﬂuxes is of signiﬁcant
practical value when the photospheric velocity/electric ﬁelds are used to derive
the photospheric boundary condition for data-driven coronal modeling, in which
case the boundary condition controls the injection of these quantities to the
simulation domain. Such data-driven models vary in complexity ranging from
simple static (non-linear) force-free ﬁeld models employing only the magnetic
ﬁeld as the boundary condition (see e.g., Wiegelmann and Sakurai, 2012) to full
time-dependent MHD models employing fully consistent photospheric boundary
conditions (e.g., Jiang et al., 2016, Leake, Linton, and Schuck, 2017). In terms
of complexity there exists a model between these extremes called the Time-
dependent MagnetoFrictional method (which we henceforth abbreviate as the
TMF method). The TMF method approximates the evolution of the coronal
magnetic ﬁeld as an interplay between two competing processes: relaxation
towards a force-free state and a constantly evolving photospheric boundary
condition (Yang, Sturrock, and Antiochos, 1986; van Ballegooijen, Priest, and
Mackay, 2000; Cheung and DeRosa, 2012; Pomoell, Lumme, and Kilpua, 2017).
Due to the simpliﬁed coronal physics the method oﬀers a computationally in-
expensive way for coronal modeling, while still having suﬃcient accuracy for
time-dependent simulations of the formation and possibly also of the ejection of
CME ﬂux ropes (Mackay and van Ballegooijen, 2006; Gibb et al., 2014; Fisher
et al., 2015; Weinzierl et al., 2016). The TMF method employs the photospheric
electric ﬁeld as its only data-driven boundary condition thereby oﬀering a direct
application for the photospheric electric ﬁeld estimates. In addition, coronal
TMF simulations oﬀer an additional way for evaluating the performance of the
inversion methods through studying the realism of the simulation feedback to

SOLA: paper_draft.tex; 16 September 2021; 10:10; p. 3

E. Lumme et al.

the electric ﬁeld boundary condition (e.g., Cheung and DeRosa, 2012; Cheung
et al., 2015).

In this paper we study how the ﬂuxes of magnetic energy and relative helicity
depend on the choice of the electric ﬁeld inversion method using a data processing
and electric ﬁeld inversion approach that requires only high-resolution and high-
cadence (vector) magnetograms as an input and does not use any photospheric
velocity estimates. The approach is ﬂexible to use, but the accuracy of the electric
ﬁeld estimates is restricted as the missing photospheric velocity information must
be completed using ad hoc assumptions. We show that, despite these limitations,
we are able to optimize the free parameters of the applied electric ﬁeld inversion
methods to yield accurate estimates for the total (and implicitly also the free)
magnetic energy injected through the photosphere. Our study focuses on the
active region NOAA AR 11158, which has been studied extensively by several
authors (Schrijver et al., 2011; Cheung and DeRosa, 2012; Jing et al., 2012; Liu
and Schuck, 2012; Tziotziou, Georgoulis, and Liu, 2013; Kazachenko et al., 2015).
The paper is organized as follows: In Section 2 we present the data processing
and electric ﬁeld inversion methods used in the study and how we apply these
methods to NOAA AR 11158. In Section 3 we present the main ﬁndings of our
study and discuss also some of the data processing details that may aﬀect the
results, but which have not garnered much attention in the previous works. These
include the masking threshold used in removing the noise-dominated pixels and
the method of tracking the active region as it traverses across the solar disk. In
Section 4 we discuss the implications of the results on the general applicability
of our data processing and electric ﬁeld inversion methods, particularly from the
viewpoint of providing the photospheric boundary condition for coronal (TMF)
simulations.

2. Data and methods

In this section we ﬁrst describe the methods that we use to create time series
of photospheric magnetic ﬁeld and electric ﬁeld maps, and how we estimate the
magnetic energy and relative helicity injection through the photosphere from
these maps. We then present the application of these methods to NOAA AR
11158, and how we optimize our electric ﬁeld estimates for accurate retrieval of
total magnetic energy injection in this active region.

2.1. Data analysis and computation tools

In this study we employ two tools to invert the photospheric electric ﬁeld, ELEC-
TRICIT and DAVE4VM. ELECTRIC ﬁeld Inversion Toolkit (ELECTRICIT) is
our newly developed software toolkit that handles all steps from downloading
and processing of magnetogram data to the inversion of the photospheric electric
ﬁeld (explained in detail in Sections 2.2 and 2.3). This paper employs the entire
pipeline of the toolkit. The toolkit is written in Python and its functionality relies
heavily on SunPy (Mumford et al., 2015) and SciPy libraries (Jones, Oliphant,
and Peterson, 2001) as well as the FISHPACK code (Swarztrauber and Sweet,

SOLA: paper_draft.tex; 16 September 2021; 10:10; p. 4

Optimization of photospheric electric ﬁeld estimates

1975), which we call from Python. Currently, the toolkit is limited to electric
ﬁeld inversion based on vector or LOS magnetograms only.

Diﬀerential Aﬃne Velocity Estimator For Vector Magnetograms (DAVE4VM)
is a velocity inversion code developed by Schuck (2008). When fed with a time
series of photospheric vector magnetograms, the toolkit determines the photo-
spheric velocity vector ﬁeld by minimizing the vertical component of the ideal
induction equation,

∂Bz
∂t

+ ∇h · (BzVh − VzBh) = 0,

(1)

in the neighborhood of each magnetogram pixel. Here z refers to the direc-
tion perpendicular to the photosphere and the subscript h corresponds to the
components parallel to the photosphere in a local Cartesian system where the
curvature of the solar surface is neglected. The output velocity ﬁeld can be used
to determine the electric ﬁeld through the ideal Ohm’s law:

E = −V × B

(2)

In this paper we apply DAVE4VM using vector magnetograms processed by
ELECTRICIT (see Section 2.3 for details).

2.2. Processing of vector magnetograms

Our photospheric data input consists of full-disk disambiguated vector mag-
netograms provided by the Helioseismic and Magnetic Imager (HMI) instru-
ment (Scherrer et al., 2012) onboard the Solar Dynamics Observatory (SDO)
spacecraft (Pesnell, Thompson, and Chamberlin, 2012) described in detail by
Hoeksema et al. (2014). The magnetograms are provided with spatial resolution
of 0.5” per pixel in the plane of sky and a cadence of 720 seconds. In each pixel
the magnetic ﬁeld is inverted from the full Stokes vector observations made at
a cadence of 135 seconds averaged over a tapered time window of 1350 seconds.
We use ELECTRICIT to download these magnetograms from the Joint Science
Operations Center (JSOC) under the dataset title hmi.B_720s using a modiﬁed
version of the download functionality of the SunPy library.

As explained by Hoeksema et al. (2014) the vector magnetogram data product
includes four diﬀerent options for the disambiguation of the magnetic ﬁeld vector.
Strong ﬁeld pixels (nominally pixels where B > 150 Mx cm−2) are disambiguated
using the minimum energy method (Metcalf, 1994) whereas for weak ﬁeld pixels
the user can decide between three disambiguation methods: the potential ﬁeld
acute angle method, radial acute angle method or a randomly chosen disam-
biguation. We choose to use the potential ﬁeld acute angle method for the
weak ﬁeld pixels. We recognize the fact that the method can produce unphysical
artifacts (Liu et al., 2017). However, the approach constrains the azimuth using
a physically justiﬁable condition (unlike the randomly chosen disambiguation),
and it is applicable over the entire solar disk (unlike the radial acute angle
method that in practice yields a random disambiguation near the disk center,
see e.g., Gosain and Pevtsov, 2013). Since we mask the noise-dominated weak

SOLA: paper_draft.tex; 16 September 2021; 10:10; p. 5

E. Lumme et al.

ﬁeld pixels to zero before the inversion of the electric ﬁeld the choice of the weak
ﬁeld disambiguation method is not signiﬁcant for the results presented in this
paper (see further discussion in Section 3.3.2).

The HMI vector magnetograms exhibit spurious bad pixels in regions where
the Stokes inversion code fails. Since bad pixels can be recognized by exception-
ally high formal errors given by the Stokes inversion module (Hoeksema et al.,
2014), we use a ﬁxed threshold for the error of the total ﬁeld strength σB = 750
Mx/cm2, above which we label each pixel as bad. This threshold recognized all
bad pixels in the strong ﬁeld region for the test cases we considered (see e.g.,
Hoeksema et al., 2014), but seems to be slightly oversensitive in the weak ﬁeld
region. We substitute the vector components of the bad pixels (in the HMI image
basis, Sun, 2013) by the median of the good pixels in the nearest symmetric
neighborhood of each bad pixel that contains at least one good pixel.

After processing the full-disk magnetograms ELECTRICIT tracks the user-
speciﬁed region and creates a time series of re-projected vector magnetograms
centered at the given region and projected to local Cartesian coordinates, simi-
larly to the Space weather HMI Active Region Patches (SHARPs) (Bobra et al.,
2014; Hoeksema et al., 2014). The tracking of the active regions is done similarly
to SHARP data (Sun, 2013; Hoeksema et al., 2014) with a few modiﬁcations
discussed further in Appendix A.1. As an additional processing step we remove
the spurious temporal ﬂips in the azimuth of the magnetic ﬁeld using a slightly
modiﬁed version of the method presented by Welsch, Fisher, and Sun (2013)
(see Appendix A.2 for details).

Finally, before using the time series of processed and re-projected magnetic
ﬁeld vector data in the electric ﬁeld inversion we mask the noise-dominated weak
ﬁeld pixels to zero in order to avoid introducing noise to the solution. Since our
electric ﬁeld inversion methods use three subsequent magnetograms at t − ∆t, t
and t + ∆t to compute the electric ﬁeld at time t (Section 2.3), we demand the
total magnetic ﬁeld strength to be over the noise threshold in all three frames.
We employ a noise threshold of B = 250 Mx/cm2 from Kazachenko et al. (2015),
which is 2.5 times the nominal noise level σB = 100 Mx cm−2 in HMI vector
magnetograms (Hoeksema et al., 2014). We reproduced the determination of the
noise level in the local Cartesian magnetic ﬁeld components from Kazachenko
et al. (2015) for our data (see Section 3.3), and due to the use of diﬀerent data
processing and disambiguation methods our noise levels turned out to be smaller.
However, as it will be shown in Section 3.3, the noise threshold of the mask has
a notable eﬀect on the results, and hence, to enable optimal compatibility to
the results of Kazachenko et al. (2015), we use the same noise threshold. For
DAVE4VM input we do not mask the data since DAVE4VM cannot handle
input data that has large regions of uniform (zero) values. Instead, we mask the
data after the velocity inversion has been performed.

2.3. Electric ﬁeld inversion

Currently, the electric ﬁeld inversion within ELECTRICIT is based on a com-
bination of the PTD part from the PTD-Doppler-FLCT-Ideal (PDFI) method
(Kazachenko, Fisher, and Welsch, 2014) and ad hoc assumptions proposed by

SOLA: paper_draft.tex; 16 September 2021; 10:10; p. 6

Optimization of photospheric electric ﬁeld estimates

Cheung and DeRosa (2012) and Cheung et al. (2015). The PDFI approach has
yielded good results in tests using synthetic data and it is also ﬂexible allowing
an inversion in the case when only part of the required input data is available
(as in our case). At the core of the method is the decomposition of the electric
ﬁeld into inductive EI and non-inductive −∇ψ components:

E = EI − ∇ψ.

(3)

The inductive component is completely constrained by a times series of vector
magnetograms (from which ∂B/∂t can be estimated) and Faraday’s law:

∇ × EI = −

∂B
∂t

,

(4)

which in the PDFI method is uncurled using a Poloidal-Toroidal Depomposition
(PTD). We solve the inductive component similarly to Kazachenko, Fisher, and
Welsch (2014) with some modiﬁcations to the applied numerical methods (see
Appendix B). Our electric ﬁeld estimates are exactly consistent with Faraday’s
law and the evolution of Bz in our time series of magnetograms.

The inversion of the non-inductive component is more challenging. In PDFI
method this is done using the ideal Ohm’s law (Eq. 2) and three constraints from
measurements: Dopplergram velocities near PILs, optical ﬂow velocities obtained
using the FLCT method (Fisher and Welsch, 2008) and the ideal constraint
E · B = 0 (giving the Doppler-FLCT-Ideal part of the method title). Although
this method provides the state-of-the-art inversion results in tests, we use a more
simpliﬁed approach because velocity data processing including the calibration of
Dopplergrams and determination of FLCT velocity is yet to be implemented in
the ELECTRICIT pipeline. Instead, we use one of the following three (ad hoc)
assumptions to determine the non-inductive potential ψ:

0. ∇ψ = 0
1. ∇2
2. ∇2

hψ = −∇h · Eh = −ΩBz
hψ = −U jz = −U (∇ × B) · ˆz,

where Ω and U are freely chosen constants. The zeroth assumption simply sets
the non-inductive component to zero. Fisher et al. (2010) studied the perfor-
mance of such an inversion in reproducing the electric ﬁeld from simulated
photospheric data, and found that the assumption reproduces the known electric
ﬁeld poorly, i.e., the contribution from −∇ψ is signiﬁcant and cannot be approx-
imated to zero. Nevertheless, we retain this assumption in this study as a point
of reference and due to the fact that there are simulation studies which have
reported realistic coronal evolution despite the use of the assumption in deriving
the photospheric boundary condition (e.g., Gibb et al., 2014). Thus it is useful
to quantify how large the deviations in the magnetic energy and relative helicity
ﬂuxes are when this assumption is used in inverting the electric ﬁeld from real
magnetograms. Assumption 1 was conceived by Cheung and DeRosa (2012) who
found that Assumption 0 did not produce enough free magnetic energy for their
data-driven TMF simulation of ﬂux rope ejections. Assumption 1 was introduced
as an ad hoc method to increase the free energy budget to more realistic values

SOLA: paper_draft.tex; 16 September 2021; 10:10; p. 7

E. Lumme et al.

without making the electric ﬁeld inversion too complicated. As noted by the
authors, the assumption imposes uniform vortical motions to the photospheric
plasma. Indeed, using the ideal Ohm’s law one can show that Assumption 1 is
obtained for the case of a vertical axisymmetric ﬂux tube rotating at a constant
angular velocity ω = −Ω/2. Assumption 2 was presented by Cheung et al.
(2015) for their TMF simulation study of recurrent homologous helical jets.
They proposed that the jets were driven by an emergence of a twisted current-
carrying magnetic structure, and consequently, Assumption 2 is obtained for the
case of a uniform emergence (V = U ˆz) of an axisymmetric ﬂux tube, the axis
of which is parallel to the z direction, and which is invariant along its axis. In
ELECTRICIT we solve the Poisson equations of Assumptions 1 and 2 using the
same numerical machinery as in solving the inductive component (see Appendix
B for details). Determination of the optimal values for the free parameters Ω
and U is discussed in Section 2.6.

In the DAVE4VM-based inversion we calculate the electric ﬁeld from the out-
put velocity ﬁeld of DAVE4VM using the ideal Ohm’s law (Eq. 2). For each time
t the input to DAVE4VM consists of a vector magnetogram at time t, estimates
for the horizontal derivatives of the vector components at that time (estimated
using the 5-point optimized derivatives as in Schuck, 2008), and an estimate for
∂Bz/∂t calculated from the magnetograms at time t + ∆t and t − ∆t using a
central diﬀerence scheme. Deﬁning the input in this way gives the output velocity
ﬁeld estimate also at time t. The window size in DAVE4VM is 19 × 19 pixels, the
same as used by Liu and Schuck (2012), and it maximizes the Pearson correlation
between the two terms of the induction equation for the vector magnetogram
data that we use in this study (Section 2.5). The correlation is not very good
(∼0.6) due to the large noise levels in the input vector magnetograms (Y. Liu,
2017, private communication), and thus DAVE4VM-based electric ﬁelds fulﬁll
Faraday’s law poorly. Consequent discrepancies introduced to the time evolution
of Bz prevent using these electric ﬁelds directly as the data-driven boundary
condition of coronal simulations (as already discussed by Schuck, 2008).

2.4. Calculation of magnetic energy and relative helicity injections

through the photosphere

The magnetic energy injected through the photosphere Em to the upper solar
atmosphere can be calculated by integrating the Poynting ﬂux over each mag-
netogram and integrating this total energy ﬂux in time (e.g., Kazachenko et al.,
2015):

Em(t) =

(cid:90) t

0

dt(cid:48) dEm
dt

(cid:90) t

(cid:90)

dt(cid:48)

=

0

dA Sz =

1
µ0

(cid:90) t

(cid:90)

dt(cid:48)

0

dA (E × B) · ˆz (5)

The relative helicity HR injected through the photosphere can be calculated

similarly (Berger and Field, 1984; D´emoulin, 2007):

HR(t) =

(cid:90) t

0

dt(cid:48) dHR
dt

(cid:90) t

(cid:90)

dt(cid:48)

= −2

0

dA (Ap × E) · ˆz

(6)

SOLA: paper_draft.tex; 16 September 2021; 10:10; p. 8

Optimization of photospheric electric ﬁeld estimates

= −2

(cid:90) t

(cid:90)

dt(cid:48)

0

dA (Ax

pEy − Ay

pEx)

(7)

Here Ap is the vector potential that corresponds to the potential ﬁeld extrapo-
lation derived from the Bz component. Similarly as in Kazachenko et al. (2015)
we calculate Ap in ELECTRICIT using the PTD formalism for the (masked)
magnetic ﬁeld using exactly the same numerical machinery as in solving the
inductive electric ﬁeld (Appendix B).

2.5. Implementation of the analysis pipeline for NOAA AR 11158

In this paper we employ the analysis pipeline described in Sections 2.1 - 2.4 to
the active region NOAA AR 11158. The active region emerged on February 10,
2011 on the southern hemisphere of the Sun, and its strongest manifestation of
activity was the X2.2 ﬂare (onset on February 15 at 01:44 UT) and the associated
halo CME (Schrijver et al., 2011). The magnetic energy and helicity budgets of
this active region have been studied extensively using photospheric estimates
(Liu and Schuck, 2012; Tziotziou, Georgoulis, and Liu, 2013; Kazachenko et al.,
2015) and force-free extrapolations (e.g., Jing et al., 2012; Sun et al., 2012;
Aschwanden, Sun, and Liu, 2014). The results of both approaches have been
reviewed by Kazachenko et al. (2015). Cheung and DeRosa (2012) did also a
series of illustrative data-driven simulations for the active region using semi ad
hoc electric ﬁeld inversion from LOS magnetic ﬁeld data as the photospheric
boundary condition. They employed Assumption 1 from Section 2.3 and tested
two values for the free Ω parameter (discussed further in Section 4).

For this study we created our own time series of re-projected vector magne-
tograms for NOAA AR 11158 using the data processing functionality of ELEC-
TRICIT as described in Section 2.2. The time series started on February 10 00:00
UT well before the emergence of the active region when the active region was
at Stonyhurst longitude E53 and lasted until February 20 00:00 UT when the
center of the active region was approximately at Stonyhurst longitude W77. The
region was tracked at a ﬁxed heliographic latitude S21.0769◦. The re-projected
vector magnetograms in the series are centered at the active region and they are
projected to the Mercator projection with a projection pixel size of 0.03◦ × 0.03◦
matching the spatial resolution of HMI full-disk vector magnetograms at the
disk center. We scaled the vertical component of Bz by cos2 λ(cid:48) – where λ(cid:48) is
the latitude of the pixel in heliographic coordinates where the center of the
re-projected magnetogram patch is at the equator – in order to account for the
distortion of the pixel scale in the Mercator projection (Kazachenko et al., 2015).
The size of the re-projected magnetograms is 744 × 610 pixels, large enough to
include the entire active region. An example magnetogram from the time series
is shown in Figure 1.

For the energy and helicity injection studies we inverted the photospheric
electric ﬁeld for each frame from February 10 14:00 UT until February 18 00:00
UT. We created three electric ﬁeld time series using ELECTRICIT and each of
the ad hoc assumptions 0 – 2 and one time series from the DAVE4VM velocity
inversion using the ideal Ohm’s law (see Section 2.3 for details). We exclude the

SOLA: paper_draft.tex; 16 September 2021; 10:10; p. 9

E. Lumme et al.

Figure 1. Snapshot from the time series of re-projected vector magnetograms used in this
paper. The plot illustrates the Bz component of the magnetic ﬁeld on February 15 01:36 UT
when the center of the active region was at (S21,W13).

data starting from February 18, as from this date onwards the active region was
already so far at the limb that the degrading temporal stability of the azimuth
disambiguation introduces spurious signals to the electric ﬁelds inverted using
ELECTRICIT (similar to the ”halos” detected by Weinzierl et al., 2016).

2.6. Optimization of the free parameters of the electric ﬁeld

inversion

We optimize the free parameters of our electric ﬁeld inversion (Ω or U , Section
2.3) so that the optimal values reproduce as close as possible the time evolution of
the total magnetic energy injected through the photosphere Em(t) (Section 2.4,
Eq. 5) as provided by the reference estimate (explained below). We focus on the
optimization of the magnetic energy, because, as discussed in the introduction,
the (free) magnetic energy injected through the photosphere is central for the
initiation of solar eruptions. We consider the total magnetic energy instead of the
free part of the energy for simplicity and because, in our case, the optimization
of the total magnetic energy injection in fact includes the optimization of the
free energy. It can be shown that modifying the non-inductive component does
not aﬀect the injection of magnetic energy to the potential ﬁeld Epot
m (t) and thus,
by optimizing the total magnetic energy through the non-inductive component
Em(t) = Epot
m (t) we actually simultaneously optimize the free energy
part Ef ree
m (t). Intuitively this argument seems obvious because the potential
magnetic ﬁeld conﬁguration and the energy within it are determined solely by

m (t) + Ef ree

SOLA: paper_draft.tex; 16 September 2021; 10:10; p. 10

    0  100  200  300  400  500  600  700X pixels [364 km/pixel]    0  100  200  300  400  500  600Y pixels [364 km/pixel]−1000−750−500−25002505007501000Bz [Mx cm−2]Optimization of photospheric electric ﬁeld estimates

the photospheric distribution of Bz, which is in no way aﬀected by the choice of
−∇ψ. This applies also when the electric ﬁeld time series is used to drive a TMF
simulation, since it is the inductive component EI (independent from the choice
of −∇ψ) that determines the evolution of the photospheric Bz, and thus also
the evolution of the potential ﬁeld. However, this result can be shown also more
formally using the decomposition of the the vertical Poynting ﬂux into potential
and free energy contributions (Welsch, 2006):

Sz = Spot

z + Sf ree

z

=

1
µ0

(cid:2)E × Bpot + E × (cid:0)B − Bpot(cid:1)(cid:3) · ˆz,

(8)

where Bpot corresponds to the magnetic ﬁeld of the potential ﬁeld in the pho-
tosphere:

Bpot = −∇χ(cid:12)

(cid:12)z=0

(9)

Here χ is the scalar potential that fulﬁlls the Laplace equation ∇2χ = 0 in
the corona with the Neumann boundary condition ∂χ/∂z|z=0 = −Bz at the
photosphere. Welsch (2006) showed that the ﬂux of potential-ﬁeld energy Spot
in the decomposition above gives the photospheric energy injection rate to the
potential part of the coronal magnetic ﬁeld dEpot
m /dt. Using similar arguments
it is straightforward to show that dEpot
m /dt is independent from the choice of the
non-inductive component:

z

dEpot
m
dt

=

=

=

=

(cid:90)

1
µ0
1
µ0
1
µ0

(cid:90)

(cid:90)

(cid:90)

dA Spot

z =

(cid:90)

1
µ0

dA (cid:0)E × Bpot(cid:1) · ˆz

dA [(EI − ∇ψ) × (−∇χ)] · ˆz

dA [EI × (−∇χ) − ∇ψ × (−∇χ)] · ˆz

dA Spot,I
z

+

(cid:90)

1
µ0

dA (∇ψ × ∇χ) · ˆz

(10)

(11)

(12)

(13)

Now the latter term that depends on the non-inductive component is zero:

(cid:90)

dA (∇ψ × ∇χ) · ˆz =

=

=

(cid:90)

(cid:90)

(cid:73)

dA [∇ × (ψ∇χ) − ψ∇ × ∇χ] · ˆz

(14)

dA [∇ × (ψ∇χ)] · ˆz =

(cid:73)

ψ∇χ · dl

(15)

(cid:73)

ds =

ψ

∂χ
∂s

ψBpot
s

ds = 0.

(16)

The ﬁnal line integral over the boundary of the photospheric region vanishes
if we assume that the ﬁelds are suﬃciently localized and we can approximate
the ψBpot
to be small at the boundary (Welsch, 2006). Moreover, depending on
the method used to compute the potential ﬁeld, Bpot
s = 0 at the boundary may
apply by deﬁnition (e.g., Seehafer, 1978).

s

In order to optimize the total (and free) magnetic energy Em(t), an a priori
estimate for it is required. For our NOAA AR 11158 dataset (Section 2.5) used

SOLA: paper_draft.tex; 16 September 2021; 10:10; p. 11

E. Lumme et al.

in this paper, we extract a reference estimate for the magnetic energy injection
Em(t) from the dataset of Kazachenko et al. (2015) (hereafter K2015). K2015
used the PDFI electric ﬁeld inversion method, which – as discussed in the in-
troduction and Section 2.3 – is one of the best-performing inversion methods
when tested against simulation data in which the true electric ﬁeld is known.
Therefore, in this work, we consider it as the state-of-the-art reference, but any
other estimate could be used as well. We downloaded the dataset of K2015 from
http://cgem.ssl.berkeley.edu/ and calculated Em(t) using the Poynting ﬂux maps
and the mask provided in the dataset. We then created an ensemble of electric
ﬁeld inversion time series using ELECTRICIT (as explained in Section 2.5) and
manually searched for optimal values of Ω and U that visually matched best
the time evolution of Em(t) extracted from the K2015 data. After ﬁnding the
visually best-matching set of values we optimized U and Ω further by minimizing
the root-mean-square error (RMSE) between Em(t) from K2015 and our data.

3. Results

3.1. Injection of magnetic energy

As detailed in Section 2.6 the free parameters of our electric ﬁeld inversion
methods (Ω and U , Section 2.3) were optimized so that the time evolution of
the total magnetic energy injection through the photosphere Em(t) follows as
closely as possible the reference result of K2015. The optimal values searched in
this were found to be:

(cid:26) Ω = (21 ± 0.5)/256 × 2π day−1 ≈ (0.082 ± 0.002) × 2π day−1

U = (42 ± 0.5) m s−1,

(17)

where the error bars correspond to half of the grid spacings of Ω and U discrete
interval used for the ﬁnal minimization of RMSE between our energy injection
estimate and the K2015 result.

In addition to these two optimized estimates, we also created an electric ﬁeld
time series using Assumption 0 as well as the DAVE4VM velocity inversion
(Sections 2.3 and 2.5). The evolution of the energy injection for all four estimates
and the reference K2015 result are plotted in Figure 2 for the period February
11–18, 2011. As seen from the ﬁgure, the magnetic energy evolution follows a
general trend, in which ﬁrst, a clear increase in the energy injection rate occurs
around February 13 (which coincides with the steepest ﬂux emergence rate of the
active region). The increase continues until the X-class ﬂare (onset on February
15 01:44 UT) after which the K2015 estimate (purple curve) shows a slight
decrease in the energy injection rate, which is discernible also in some of our own
estimates. The estimate with vanishing non-inductive component (Assumption
0, blue curve) clearly underestimates the energy injection when compared to
the other estimates (e.g., underestimation of K2015 by 36% at the time of the
ﬂare), but reproduces quite well the overall trend of the energy injection rate
before and after the ﬂare. Assumptions 1 and 2 (green and orange curves) for
the non-inductive component give a roughly similar time evolution for Em(t)

SOLA: paper_draft.tex; 16 September 2021; 10:10; p. 12

Optimization of photospheric electric ﬁeld estimates

Figure 2. The time evolution of the total magnetic energy Em(t) injected through the pho-
tosphere in AR 11158 based on diﬀerent electric ﬁeld estimates. The black solid line marks the
reference value from K2015 on February 15 01:36 UT (denoted by the vertical dashed line),
which was the closest time before the onset of the strongest ﬂare of the active region at 01:44
UT. The dashed and dotted purple lines represent the lower and upper error bars of the K2015
dataset, respectively (see text for details).

when compared to each other, and they are also consistent with the DAVE4VM
(red curve) and K2015 results. There are, however, some obvious diﬀerences.
The energy injection rate based on Assumption 1 does not decrease as in the
other estimates which causes a clear overestimation of the energy injection from
February 16 onwards. On the other hand the energy injection is underestimated
between February 14 and 16. The estimate based on Assumption 2 is more
consistent with the results of K2015 underestimating its result only slightly near
the time of the ﬂare and overestimating it slightly near the end of the K2015
time series (February 16 23:36 UT). There is also a good consistency between
Assumption 2 and the DAVE4VM estimate despite the very diﬀerent electric
ﬁeld inversion methods.

K2015 provides two estimates for the relative error in the vertical Poynting
ﬂux Sz and consequently also in the energy injection Em(t): the ﬁrst, lower
estimate is ±14% and includes only the error arising from the noise in the input
vector magnetograms, whereas the second, nominal estimate ±29% includes also
the method-related uncertainties of their PDFI electric ﬁeld inversion method
(Kazachenko, Fisher, and Welsch, 2014). We consider the lower estimate more
important, since the method-related uncertainties can be assumed to be larger
for our electric ﬁeld estimates, which are partly based on ad hoc assumptions. As
illustrated in Figure 2 from February 14 00:00 UT until February 16 23:36 UT
(the end of the K2015 time series) our energy injection estimates falls well inside
the bounds of the upper error estimate and almost within the lower estimate as
well. More precisely, the relative diﬀerence between any of our estimates and the
K2015 estimate is less than 15% over this interval. Before February 14 larger
relative diﬀerences are found, but since the values of injected energy are small

SOLA: paper_draft.tex; 16 September 2021; 10:10; p. 13

1112131415161718February 2011 [days]0.000.250.500.751.001.251.501.752.00Total ener y injection Em[1033 er s]0. ∇ψ=01. ∇2hψ=0.Bz2. ∇2hψ=0U(∇×B)zDAVE4VMPDFI method of K2015E. Lumme et al.

before this time, these corresponds to small absolute diﬀerences. Hereafter we
mostly disregard this interval and discuss results only after February 14 00:00
UT.

Aside from Assumption 0 our energy injection estimates (Assumptions 1 and
2, and DAVE4VM) diﬀer less than 19% from each other from Days 14 until the
end of the time series (February 18 00:00 UT).

Our results also reproduce the consistency between the K2015 and DAVE4VM
estimates (within both error bounds of K2015) already found by K2015, who
compared their Em(t) estimate to the DAVE4VM estimates of Liu and Schuck
(2012) and Tziotziou, Georgoulis, and Liu (2013). Our DAVE4VM estimate is
completely independent from these previous studies with diﬀerences both in the
input vector magnetograms fed to DAVE4VM and in the way DAVE4VM is ex-
ecuted (Section 2.3). From the two previous DAVE4VM studies of AR 11158 the
one by Liu and Schuck (2012) is more consistent with ours, whereas Tziotziou,
Georgoulis, and Liu (2013) used a very diﬀerent approach in projecting the data
to a local Cartesian coordinate system. Our estimate of the energy injection
overestimates the result of Liu and Schuck (2012) (see their Figure 14) by 5%
at reference times February 15 00:00 UT and February 16 ∼18:00 UT (the end
of the Liu and Schuck, 2012 time series), and the diﬀerence is well within the
error bounds ±23% reported by the authors. We overestimate the values of
Tziotziou, Georgoulis, and Liu (2013) (see their Figure 5) by 20% and 54% at
the reference times above. To make a consistent comparison to these previous
studies we started the time integration of the energy injection on February 12,
00:00 UT when calculating the diﬀerences above.

3.2. Injection of relative magnetic helicity

We studied also the injection of relative magnetic helicity through the pho-
tosphere HR(t) (see Section 2.4) using all four of our electric ﬁeld series and
the optimized values of Ω and U for the electric ﬁelds based on Assumptions
1 and 2 (Section 2.3). The results are plotted in Figure 3 with one reference
data point from K2015. As clearly seen from the ﬁgure the helicity injection has
much larger diﬀerences between the diﬀerent electric ﬁeld estimates than in the
case of energy injection (Figure 2). Assumption 0 again clearly underestimates
the result when compared to the K2015 helicity injection estimate (by ∼90 %
at the time of the ﬂare) as well as to the other estimates. Despite success in
optimizing the magnetic energy injection for Assumptions 1 and 2 (Section 3.1)
the relative helicity injection is not reproduced well for either of the assumptions.
Assumption 1 overestimates the K2015 helicity injection estimate coarsely (by a
factor of 6 at the time of the ﬂare and by a factor of 8 on February 16 00:00 UT).
Assumption 2 matches much better the output of K2015 and our DAVE4VM
inversion result. The overall trends are similar, but there is now a consistent
underestimation (by 34% at the time of the ﬂare and by 13% on February 16 at
00:00 UT). DAVE4VM produces again results similar to K2015: our DAVE4VM
estimate is only 4% larger than the result of K2015 at the time of the ﬂare and
on February 16 00:00 UT 20% larger. Comparison to the results of previous
DAVE4VM studies by Liu and Schuck (2012) and Tziotziou, Georgoulis, and

SOLA: paper_draft.tex; 16 September 2021; 10:10; p. 14

Optimization of photospheric electric ﬁeld estimates

Figure 3. The time evolution of the relative magnetic helicity HR(t) injected through the
photosphere in AR 11158 based on diﬀerent electric ﬁeld estimates. The black dotted line
marks the reference value from K2015 at February 15 01:36 UT (denoted by the dashed line)
near the onset time of the strongest ﬂare of the active region.

Liu (2013) on February 15 00:00 UT and February 16, 00:00 UT reveals a 45%
and a 37% overestimation for the former (see their Figure 12), and a 8% and
a 4% overestimation for the latter (see their Figure 5). Larger diﬀerences than
the ones obtained in the case of magnetic energy injection (Section 3.1) are not
surprising, considering that now, in addition to the diﬀerences in the input data
and DAVE4VM setup (Section 2.3), also the computation methods of the vector
potential Ap are diﬀerent: these authors employ FFT-based method to solve Ap
directly from the Bz distribution whereas we employ PTD of the magnetic ﬁeld
solved using a ﬁnite diﬀerence method similarly to K2015 (see Appendix B for
details).

3.3. Eﬀects of masking and the tracking method of the active region

3.3.1. Eﬀect of masking of the noise-dominated pixels

As discussed in Section 2.2 we mask pixels to zero if B < 250 Mx cm−2 in the
pixel for any of the three frames that participate in the electric ﬁeld inversion.
The threshold was taken from K2015 to ensure maximal compatibility to their
results. On the other hand, according to the noise mask of the SDO/HMI vector

SOLA: paper_draft.tex; 16 September 2021; 10:10; p. 15

1112131415161718February 2011 [days]0.00.51.01.52.02.53.01020300. ∇ψ=01. ∇2hψ=−ΩBz2. ∇2hψ=−U(∇×B)zDAVE4VMTotal relative helicity injection HR[1043 Mx2]E. Lumme et al.

magnetograms (Hoeksema et al., 2014) the noise level of the total magnetic ﬁeld
strength in vector magnetograms may be as low as 60 Mx cm−2 depending on
the orbital velocity of the SDO spacecraft and the position of the observation on
the solar disk. Moreover, our noise estimate for the magnetic ﬁeld components
(Bx,By,Bz) in the AR 11158 time series created in ELECTRICIT (Section 2.5)
gives maximum noise levels of (σBx, σBy , σBz ) ≈ (65, 85, 65) Mx cm−2 for the
time interval February 10 14:00 UT – February 18 00:00 UT. We determined the
noise levels for each magnetogram in the series by ﬁtting a Gaussian to the weak
ﬁeld core (B < 300 Mx cm−2, Hoeksema et al., 2014) of the magnetogram pixels
(Kazachenko et al., 2015; Welsch, Fisher, and Sun, 2013; DeForest et al., 2007).
These noise estimates imply that the ”pure noise” magnetic ﬁeld value is B ∼125
Mx cm−2. Therefore, when using the threshold of 250 Mx cm−2 in masking we are
removing also pixels which carry a signiﬁcant signal, particularly in the relatively
low-noise Bz component. Thus, it is natural to ask whether changing the mask
threshold aﬀects our results, particularly the magnetic energy injection estimate
used in the optimization of the free parameters Ω and U . In order to quantify
this, we re-ran our analysis for AR 11158 using two diﬀerent masking thresholds:
(1) 150 Mx cm−2, and (2) 300 Mx cm−2. The ﬁrst threshold corresponds to the
nominal threshold used to diﬀerentiate between strong and weak ﬁeld pixels in
HMI vector magnetogram pipeline (Liu et al., 2017), and it is slightly above our
own noise estimate of 125 Mx cm−2. Thus, we can assume that the threshold
masks at least all pure noise pixels away. The second case corresponds to the
noise threshold used by Liu and Schuck (2012) in their DAVE4VM study of AR
11158 (Y. Liu 2017, private communication).

Changes in the injection of the magnetic energy with the alternative masks
are illustrated in Figure 4a. We ﬁnd a consistent trend that the lower the mask-
ing threshold, the larger the energy injection. When the value of the masking
threshold is varied the energy injection for the three ELECTRICIT inversions
(Assumption 0 – 2, Section 2.3) increases/decreases as much as 21% between
February 14 and 17, the maximum median diﬀerence being 15%. The estimate
based on Assumption 0 is aﬀected more than the ones based on Assumptions
1 and 2, for which both the maximum and median relative diﬀerences to the
default case are ∼20% and ∼12%. The strongest change (increase) is found
when the mask threshold of 150 Mx cm−2 is used. Varying the mask changes the
optimized estimates of the energy injection (Assumptions 1 and 2) just within
the maximal error bounds of Em(t) of K2015 (±29%), but not within the lower
error bounds (±14%).

The estimate based on the DAVE4VM inversion is practically independent
from the choice of the masking threshold. When the mask is varied – or even
removed entirely – the maximum relative diﬀerence between the energy esti-
mates is 4% for the whole investigated interval (median relative diﬀerence being
less than 2%). Therefore, the DAVE4VM estimate is not included in Figure
4a. It is important to note that the magnetograms are not masked when fed
into DAVE4VM, but the mask is applied only afterwards. Thus, the fact that
DAVE4VM gives practically the same result with and without masking implies
that the velocity inversion in DAVE4VM cannot retrieve any signiﬁcant vertical

SOLA: paper_draft.tex; 16 September 2021; 10:10; p. 16

Optimization of photospheric electric ﬁeld estimates

Poynting ﬂux signal (negative or positive) from the pixels with low signal-to-
noise ratio. The same does not apply to ELECTRICIT inversions: removing
the mask entirely increases the (time-integrated) energy injection even as much
as 80%. A part of this energy ﬂux signal arises from the use of the potential
acute angle disambiguation in the weak ﬁeld region (Section 2.2), since using
the alternative methods (radial acute angle or random disambiguation) results
in a smaller increase (< 40%) when the mask is removed entirely. Still, as already
argued in Section 2.2 the choice of the weak ﬁeld disambiguation method does
not aﬀect the results when any of the three masking thresholds considered
above are applied. The reason for the spurious energy injection signal arising
from the use of the potential acute angle disambiguation is likely the large-
scale ”shadow-like patterns” (Liu et al., 2017) introduced to the azimuth by the
method, which somehow interplay with the large-scale electric ﬁeld producing a
signiﬁcant vertical Poynting ﬂux signal. Nevertheless, removing the mask entirely
introduces a clear increase in the energy injection regardless of the weak ﬁeld
disambiguation method, which implies that there are also other method-related
factors in ELECTRICIT inversions that enable retrieval of a signiﬁcant vertical
Poynting ﬂux signal from the noise-dominated pixels. The fact that this is not
seen in DAVE4VM output implies that the signal is at least partly spurious,
thus emphasizing the need for using the mask.

For the relative helicity injection we ﬁnd similar trends when varying the
masking thresholds as for the energy injection: i.e., lowering the threshold in-
creases the injected relative helicity. Relative changes between the estimates
using the alternative masking thresholds are strongest for the estimate based on
Assumption 0 (maximum and median diﬀerences to the default are 118% and
41% between February 14 and 17), but the absolute changes are small and the
large relative changes are simply due to the small absolute values of HR(t). For
Assumptions 1 and 2 the maximum and median relative changes are 10% and
8%, and 19% and 10%. For the DAVE4VM estimate the maximum and median
relative changes are: 13% and 8%, respectively. These changes do not alter the
basic ﬁndings made in Section 3.2 where the default mask was used.

3.3.2. Eﬀect of tracking speed of the active region

Another data processing parameter that likely aﬀects the results is the speed
at which the active region is tracked during its solar disk passage. Our choice
for the tracking speed is based on the ”2 day lag” diﬀerential rotation proﬁle of
Snodgrass (1983), but other options are also possible. In the SDO/HMI SHARP
data product the active regions are tracked using a diﬀerent proﬁle (Hoeksema
et al., 2014), which gives a 0.27 deg day−1 (∼2 km s−1) faster speed for the center
of AR 11158 along the line of constant latitude. On the other hand Kazachenko
et al. (2015) and Welsch, Fisher, and Sun (2013) track the active region using a
coalignment procedure that minimizes the whole-frame shifts between successive
frames of the magnetogram time series (in the local Cartesian coordinate sys-
tem). In practice this approach results in a temporally variable tracking speed
and includes also motions along the meridional direction. Due to the velocity in
the ideal Ohm’s law it is expected that changing the tracking speed, and thus

SOLA: paper_draft.tex; 16 September 2021; 10:10; p. 17

E. Lumme et al.

Figure 4. Total magnetic energy Em(t) injected through the photosphere in AR 11158 and
the variations arising from changes in the a) masking threshold and b) tracking speed of the
active region (see text for details). The shaded region around each curve covers the variation
in the energy injection due to the respective changes in the data processing. Dashed purple
lines give the upper and lower error bars of the K2015 result. Track 1 refers to the tracking
made using the same diﬀerential rotation proﬁle as in the SHARP data and Track 2 refers to
our default tracking reinforced with coalignment. The black dotted line marks the reference
value from K2015 at February 15 01:36 UT (denoted by the dashed line) near the onset time
of the strongest ﬂare of the active region.

also the velocity of the rest frame, has an eﬀect on the electric ﬁeld and thus
also on the energy and relative helicity injections.

In order to quantify how sensitive our results are to the choice of the track-
ing speed we re-ran our analysis for AR 11158 using two alternative tracking
schemes: (1) using the diﬀerential rotation proﬁle employed for the SHARP
data product and (2) using our default diﬀerential rotation proﬁle reinforced
by coalignment which minimizes the whole-frame shifts between the successive
frames. For the coalignment we used the method presented by Welsch, Fisher,
and Sun (2013) in which the coalignment is done using low-noise LOS mag-
netograms. For each time step we interpolated an SDO/HMI full-disk LOS
magnetogram to the local Cartesian grid determined by our default tracking
procedure (Section 2.2 and Appendix A.1). Then the whole-frame shift to the
previous interpolated LOS data frame was evaluated, and the local Cartesian
grid was shifted so that it cancels the measured whole-frame shift. This shifted

SOLA: paper_draft.tex; 16 September 2021; 10:10; p. 18

Optimization of photospheric electric ﬁeld estimates

grid was then used as the ﬁnal grid to which the vector (and LOS) magnetograms
were interpolated at that time. For our 11158 time series the coalignment results
in a tracking speed which is on average 0.28 deg day−1 faster than our default
case (with standard deviation of 0.21 deg day−1).

As illustrated in Figure 4b the eﬀect of changing the tracking speed has only
a small eﬀect on the estimate of the energy injection when the three ELEC-
TRICIT inversions (Assumptions 0 – 2) are considered, and the changes are
most of the time within the lower error bars (±14%) of the K2015 estimate.
The ﬁrst tracking scheme (SHARP rotation proﬁle) produced a small increase
towards the end of the time series for all three estimates, the maximum and
the median relative changes being 11% and 4% for Assumption 0, and 6% and
3% for Assumptions 1 and 2 between February 14 and 17. The second tracking
scheme (default rotation proﬁle and coalignment) caused only a marginal change:
the maximum and the median relative diﬀerences to the default cases being at
most 6% and 2% over all three assumptions. When the DAVE4VM estimate is
considered the tracking speed has a more signiﬁcant eﬀect. Using the SHARP
rotation proﬁle the default energy injection is ﬁrst underestimated but then
overestimated towards the end of the time series (the maximum and median
relative diﬀerences are 10% and 3%), whereas for the coaligned case there is a
consistent decrease in the injection throughout the time series (the maximum
and median relative diﬀerences: 19% and 7%). Despite the relatively large eﬀect
on the energy injection the DAVE4VM estimates are still most of the time within
the lower error bars of K2015. The coalignment brings the DAVE4VM estimate
closer to the one by Liu and Schuck (2012) (see Section 3.1): now the estimates
diﬀer only by 1% near the time of the ﬂare on February 15 00:00 UT (but still
by 5% on February 16 18:00 UT).

The eﬀect of the tracking speed on the estimate of relative helicity injection
does not aﬀect the main ﬁndings made in Section 3.2 where the default track-
ing speed was used. When the tracking speed is varied the estimate based on
Assumption 0 exhibits large relative changes (>100%) due to its small absolute
values, but the other estimates change by at most 8%.

4. Summary and discussion

In this study we examine the magnetic energy and relative helicity injection
through the photosphere in NOAA AR 11158 using an ensemble of estimates
for the photospheric electric ﬁeld. We employ our own data processing and
electric ﬁeld inversion toolkit, ELECTRICIT, to create a vector magnetogram
time series centered at the active region. We further create four time series
of photospheric electric ﬁeld maps from this data. One series is created using
the DAVE4VM velocity inversion code, and the three other series are created
within ELECTRICIT. In latter approach we decompose the electric ﬁeld into
inductive and non-inductive components. We constrain the inductive component
to be exactly consistent with Faraday’s law and the time evolution of Bz in
our vector magnetogram time series. Since constraining the non-inductive com-
ponent properly from the measurements requires advanced techniques not yet

SOLA: paper_draft.tex; 16 September 2021; 10:10; p. 19

E. Lumme et al.

implemented in our toolkit, we use three alternative ad hoc assumptions instead.
This approach enables also a straightforward inversion procedure without the
need of acquiring and calibrating any photospheric plasma velocity estimates.
Our zeroth assumption simply neglects the non-inductive component (setting it
to zero), whereas the other two constrain it by setting the horizontal divergence
of the electric ﬁeld proportional either to the vertical magnetic ﬁeld Bz or the
current density jz. The proportionality constants in the latter two assumptions
are free parameters, and we optimize them so that the resulting electric ﬁeld time
series reproduce as closely as possible the time evolution of the total injection
of magnetic energy from the photosphere to the corona Em(t) (computed as the
area- and time-integrated vertical Poynting ﬂux). Using analytical arguments
one can show that this approach implicitly optimizes also the injection of the
free magnetic energy. The reference for the optimal Em(t) is extracted from
the results of Kazachenko et al. (2015) (here abbreviated as K2015), who used
state-of-the-art methods to constrain the non-inductive component.

Using the optimization scheme for the free parameters of the two semi ad
hoc electric ﬁelds above we are able to reproduce the time evolution of the
injected magnetic energy Em(t) well within the upper error bounds of the result
of Kazachenko et al. (2015), and almost (exceeding only by 1%) the lower error
bounds for the time period when photospheric energy injection had reached
signiﬁcant values (more than half of the values at the time of the strongest
X-class ﬂare of the active region). We consider the lower error bounds more
important here, since they include only the error arising from the noise in the
vector magnetograms, whereas the upper estimate includes also method-related
uncertainties, which can be safely assumed to be much higher for our (semi
ad hoc) estimates. Our DAVE4VM study of the energy injection is consistent
with the results of Kazachenko et al. (2015) and with the previous DAVE4VM-
based results for NOAA AR 11158 by Liu and Schuck (2012) within their error
bounds. However, the fourth electric ﬁeld time series of our ensemble, derived
setting the non-inductive component to zero (our zeroth ad hoc assumption)
clearly underestimates both the total (and thus also the free) magnetic energy
injection. This is in line with previous simulation studies by Fisher, Welsch, and
Abbett (2012) and Kazachenko, Fisher, and Welsch (2014) who showed that
by assuming a vanishing non-inductive component one clearly underestimates
the vertical Poynting ﬂux. We also ﬁnd that the assumption underestimates the
relative helicity injection, which is again consistent with the previous results
(e.g., Kazachenko, Fisher, and Welsch, 2014). However, the positive sign of the
total relative helicity injection is reproduced correctly.

The underestimation of both magnetic energy and relative helicity injection
implies that TMF simulations studies in which the photospheric boundary con-
dition directly or indirectly employs Assumption 0, likely underestimates the
budgets of these quantities in the simulation domain (though one should keep in
mind that the coronal budget of these quantities cannot be deduced solely from
the photospheric ﬂuxes, as discussed further below). Despite this implication
Gibb et al. (2014) managed to successfully simulate the formation of a ﬂux rope
in NOAA AR 10977 yielding results consistent with the observed X-ray sigmoid,
even though the photospheric boundary condition was based on Assumption 0.

SOLA: paper_draft.tex; 16 September 2021; 10:10; p. 20

Optimization of photospheric electric ﬁeld estimates

However, their simulation did not include the eruption of the ﬂux rope. Due to
the central role of (free) magnetic energy and possibly also relative helicity in ﬂux
rope ejections, underestimating these quantities may be important only when the
lift-oﬀ and subsequent eruption dynamics are considered. This is implied by the
results of Cheung and DeRosa (2012), whose TMF simulation of NOAA AR
11158 gave only ”quiescent” coronal evolution when Assumption 0 was used,
whereas the use of Assumption 1 resulted in a series of ﬂux rope ejections.

The fact that we are able to reproduce well the time evolution of the magnetic
energy injection using Assumptions 1 and 2 implies that both of these semi ad
hoc electric ﬁeld inversion methods are ﬂexible enough for estimation of the
total (and free) magnetic energy injection. However, our approach requires a
reference estimate for optimization of these assumptions through the energy
injection (such as the one by K2015, used here), and for an arbitrary active
region such estimates are not readily available. One straightforward way to
acquire such an estimate is to use DAVE4VM: for AR 11158 it would give almost
the same optimization result as the K2015 estimate. If one cannot acquire an
estimate for the whole time evolution of the energy injection, the reference for
the optimization procedure could include an energy estimate only at some given
time(s). For instance, for AR 11158 an estimate of the coronal energy content just
before the strongest (X-class) ﬂare of the active region could be used. Such an
instantaneous estimate could be acquired e.g., from a non-linear force-free ﬁeld
(NLFFF) extrapolation. Though we know that the energy injection through the
photosphere is not equivalent with the energy stored in the simulated coronal do-
main, Kazachenko et al. (2015) found that the (ordinary) NLFFF extrapolation
estimates of the coronal energy content were consistent with the photospheric
injection within error bounds in AR 11158.

Our optimal values of the free parameters Ω and U are smaller than the values
used by the original authors who proposed these semi ad hoc estimates (Section
2.3). Cheung and DeRosa (2012) tested two non-zero values for Ω, 1/8 × 2π
and 1/4 × 2π day−1, from which the latter was primarily used. The values are,
respectively, 50% and 200% larger than our value Ω = 21/256 × 2π day−1.
Cheung et al. (2015) tested two values for U , 1100 and 2200 m s−1, from which
the former was primarily used in the paper. Both values are almost two orders of
magnitude larger than our value U = 42 m s−1. When we run our analysis using
the nominal values of the previous authors Ω = 1/4 × 2π day−1 and U = 1100
m s−1 the magnetic energy and relative helicity injection are overestimated by
factors 1.4 and 18 for the former case and by 9 and 15 for the latter at the
time of the strongest X-class ﬂare (when compared to the best reference values
considered in this paper). Thus, our results imply that the TMF simulation of AR
11158 by Cheung and DeRosa (2012) possibly had slightly overestimated total
and free magnetic energy budgets and heavily overestimated relative helicity
budget. As opposed to the TMF simulation of Cheung and DeRosa (2012) that
included the entire AR 11158, the simulation of Cheung et al. (2015) focused on
homologous helical jets emanating from a small subregion of NOAA AR 11793.
Thus, further conclusions about the realism of their magnetic energy and relative
helicity budgets would require an additional study of the particular subregion
of AR 11793. Moreover, as mentioned a few times already, we must be careful

SOLA: paper_draft.tex; 16 September 2021; 10:10; p. 21

E. Lumme et al.

when drawing conclusions from the photospheric injections on the realism of the
magnetic energy and relative helicity budgets in the simulated coronal domain.
This is because part of the photospheric injection may be removed through the
other boundaries of the simulation domain or may be transformed into other
forms in processes within the domain. Moreover, for the special case of the mag-
netic energy injection in TMF simulations, not even the photospheric injections
are equivalent between our estimate and the corresponding TMF simulation: we
derive the photospheric Poynting ﬂux using the horizontal components of the
magnetic ﬁeld from a vector magnetogram, whereas in a TMF simulation these
components are determined by the magnetofrictional evolution in the coronal
domain.

A more comprehensive analysis of the relationship between the photospheric
ﬂuxes and coronal budgets would require additional (TMF) simulation studies
beyond the scope of this paper. For NOAA AR 11158 we can make some further
conclusions by comparing our ﬂuxes to the simulation energy budgets reported
by Cheung and DeRosa (2012). Their re-projected magnetograms and the re-
sulting electric ﬁeld inversion were very similar to that of this study except for
the fact that they used LOS magnetograms. Using the functionality in ELEC-
TRICIT we created an additional Bz magnetogram time series from full-disk
LOS magnetograms to the same grid as our nominal vector magnetogram time
series (Section 2.5), inverted the horizontal electric ﬁeld Eh using Assumption
1 and Ω = 1/4 × 2π day−1, and estimated the energy injection using Bh from
our nominal vector magnetogram series. Near the time of the X-class ﬂare our
photospheric injection estimate was only 13 % larger than the total energy
content reported by Cheung and DeRosa (2012), so at least in terms of energy
the photospheric injection seems to match the coronal budget. Using this LOS
magnetogram dataset we can also estimate the relative helicity injection, which
is still overestimated by a factor of ∼16 at the time of the strongest ﬂare of the
active region. Even though the dissipation of relative helicity in the corona can be
considered negligible (e.g., Pariat et al., 2015) part of the helicity injected from
the photosphere can and will be removed through the boundaries of the domain,
particularly during CME ﬂux rope ejections (e.g., Pariat et al., 2017), in which
case the ﬂux rope also carries part of the helicity away from the domain. Jing
et al. (2012) found in their NLFFF extrapolation study of AR 11158 that the
total coronal relative helicity content was substantially lowered in tandem with
the strongest M6.6 and X2.2 class ﬂares (and the related ﬂux rope ejections)
in the active region. However, the magnitude of helicity removals (altogether
∼ 5 × 1042 Mx2) is not suﬃcient to remove the overestimated photospheric
relative helicity injection in Cheung and DeRosa (2012) simulation implied by
our results. This ﬁnding poses an interesting question whether the strong activity
in the simulation (several ﬂux rope ejections over 2 days) is partly driven by this
heavy overestimation of the relative helicity budget in the corona.

Despite the relatively good optimization of the magnetic energy injection
the optimal values of Ω and U reproduce the injection of relative magnetic
helicity through the photosphere poorly. Even with energy-optimized value of Ω
Assumption 1 results in a heavy overestimation of the relative helicity injection.
This is no surprise when one takes a closer look at the calculation of the electric

SOLA: paper_draft.tex; 16 September 2021; 10:10; p. 22

Optimization of photospheric electric ﬁeld estimates

ﬁeld and the vector potential Ap. First, let’s write the total ﬂux of relative
helicity arising from the non-inductive component dH N I
R /dt for a given time
using the poloidal potential P and the non-inductive potential ψ:

dH N I
R
dt

= −2

(cid:90)

= 2

(cid:90)

dA [Ap × (−∇ψ)] · ˆz = −2

(cid:90)

dA [(∇ × P ˆz) × (−∇ψ)] · ˆz

dA [∂xP ∂xψ + ∂yP ∂yψ]

(18)

From the deﬁnition of Assumption 1 (Section 2.3) and PTD of the magnetic ﬁeld
(Appendix B) we get:

∇2

hP = −Bz = Ω−1∇2

hψ

(19)

Since we employ the same grid, numerical solver and homogeneous Neumann
boundary conditions for solving both the P and ψ potentials, they are the same
potential up to a constant scale factor ψ = ΩP . Thus we get:

dH N I
R
dt

(cid:90)

= 2Ω

dA (cid:2)(∂xP )2 + (∂yP )2(cid:3) ≥ 0

(20)

We can immediately see that the for any non-zero Ω we always get a positive
contribution to the relative helicity injection from the non-inductive component
of the electric ﬁeld. On the other hand, when we use Assumption 2 to estimate
the non-inductive component the ψ and P potentials decouple and thus no
immediate positive bias is introduced to the relative helicity injection. Indeed,
Assumption 2 with the energy-optimized value of U reproduces the time evolu-
tion of the relative helicity injection much better, having a similar temporal trend
as the K2015 and our DAVE4VM estimates (however, exhibiting a consistent
underestimation, see Section 3.2).

It is not a surprise that neither of the ad hoc assumptions 1 or 2 are able
to reproduce the injection of both the magnetic energy and relative helicity
accurately. Still, the results clearly show that Assumption 2 succeeds much
better than Assumption 1 in this sense. This implies that Assumption 2 is
more suitable for practical use, for example when the electric ﬁelds are used
as a boundary condition in coronal modeling. On the other hand, Assumption 1
oﬀers an interesting way to study the eﬀect of overestimating the photospheric
helicity injection while still producing approximately correct energy injection
in data-driven (TMF) simulations. For example, a comparative TMF simulation
study using electric ﬁeld boundary conditions based on (optimized) Assumptions
1 and 2 would be revealing in this sense.

Finally, we study also the eﬀect of some of the data processing methods on
the results, in particular on the magnetic energy injection. These include the
masking threshold used in removal of noise-dominated pixels from the data and
the tracking speed of the active region, both of which have so far been poorly
covered in the literature. We test three masking thresholds that correspond to ap-
proximately 1.5, 2.5 and 3 times the nominal noise level of the total magnetic ﬁeld
B in SDO/HMI vector magnetograms (100 Mx cm−2), from which the second one

SOLA: paper_draft.tex; 16 September 2021; 10:10; p. 23

E. Lumme et al.

was the default used in this paper. We ﬁnd that the lower the threshold the larger
the magnetic energy and relative helicity injections are. The changes introduced
to the energy injection by varying the mask are within the upper error bars of our
reference energy injection estimates, but clearly above the lower error estimate
mainly considered in this paper. Thus, if one wishes to reach a consistency with
K2015 (or with some other similar reference estimate of the energy injection)
approximately within the ±14% error bounds (as we do) the mask threshold
should be chosen consistently with the reference. However, the choice of the
mask does not aﬀect the main ﬁndings made above. The DAVE4VM estimate
for the energy injection is completely insensitive to the choice of mask, even
when the mask is removed entirely, implying that DAVE4VM cannot retrieve
any signiﬁcant vertical Poynting ﬂux signal from the noise-dominated weak ﬁeld
pixels. Energy estimates based on ELECTRICIT inversions, in turn, increase
signiﬁcantly when the mask is removed. The fact that this increase is only seen
in the ELECTRICIT output but not in the DAVE4VM inversions implies that
this increase is a spurious result arising from the method-related properties of
ELECTRICIT inversion, thus emphasizing the need for using a mask.

For the tracking speed of the active region we tested three alternatives and
found that our three ELECTRICIT estimates are insensitive to the choice of the
tracking speed. However, the tracking speed had a more considerable eﬀect on the
DAVE4VM estimate, particularly when the tracking of the active region in vec-
tor magnetograms was reinforced using additional coalignment that minimized
the whole-frame-shifts between successive frames. However, the change was still
within the previously reported error bars of the DAVE4VM inversion, and the
resulting DAVE4VM energy injection estimate was still most of the time within
the lower error bars of K2015 estimate discussed above. The stronger eﬀect on
DAVE4VM likely arises from the fact that the method explicitly tracks the image
motions in vector magnetograms, which is more sensitive to the tracking speed
and to the related changes in the velocity of the rest frame. Overall, despite
the considerable eﬀects that we found when varying the mask threshold and the
tracking speed, none of the eﬀects were suﬃciently large to conclusively allow
preferring some of the options over others.

5. Conclusions

By studying the area- and time-integrated Poynting ﬂux we are able to show that
the data processing and electric ﬁeld inversion approach presented in this paper,
which employs only photospheric magnetic ﬁeld estimates is capable of repro-
ducing the time evolution of the total – and implicitly also the free – magnetic
energy injected through the photosphere, when compared to recently published
state-of-the-art estimates. The lack of the photospheric velocity estimates in the
approach is compensated using ad hoc assumptions whose free parameters allow
optimization of the magnetic energy injection. Despite the good reproduction of
the magnetic energy injection the ad hoc assumptions reproduce the injection
of relative helicity poorly reaching at best a modest underestimation of the
reference values from previous studies. The ad hoc assumption that constrains

SOLA: paper_draft.tex; 16 September 2021; 10:10; p. 24

Optimization of photospheric electric ﬁeld estimates

the non-inductive potential by setting the horizontal divergence of the electric
ﬁeld proportional to the vertical current density performs the best in this sense,
implying that it is the most suitable assumption for practical applications. Fi-
nally, we show that our results are not very sensitive to the choice of the masking
threshold for removing the noise-dominated pixels and the tracking speed of
the active region. However, we ﬁnd that our inversion requires some mask for
the weak ﬁeld pixels, and that this mask should be chosen consistently with
the reference when optimizing the free parameters of the inversion using the
magnetic energy injection. The main datasets used in this paper can be found
from https://zenodo.org/record/1034404.

Acknowledgments We thank the HMI team for providing us with the LOS and vector mag-

netic ﬁeld SDO/HMI data. EL acknowledges the doctoral programme in particle physics and

universe sciences (PAPU) of the University of Helsinki and the Magnus Ehrnrooth Foundation

for ﬁnancial support. EK and JP acknowledge the European Research Council (ERC) under

the European Union’s Horizon 2020 Research and Innovation Programme Project SolMAG

4100103. This research has made use of SunPy, an open-source and free community-developed

solar data analysis package written in Python (Mumford et al., 2015). This is a pre-print of

an article published in Solar Physics. The ﬁnal authenticated version is available online at:

https://doi.org/10.1007/s11207-017-1214-0.

Disclosure of Potential Conﬂicts of Interest The authors declare that they have no

conﬂicts of interest.

References

Abbett, W.P., Miki´c, Z., Linker, J.A., McTiernan, J.M., Magara, T., Fisher, G.H.: 2004, The
photospheric boundary of Sun-to-Earth coupled models. Journal of Atmospheric and Solar-
Terrestrial Physics 66, 1257. DOI. ADS. [Abbett2004]

Aly, J.J.: 1991, How much energy can be stored in a three-dimensional force-free magnetic

ﬁeld? Astrophys. J. Lett. 375, L61. DOI. ADS. [Aly1991]

Aschwanden, M.J., Sun, X., Liu, Y.: 2014, The Magnetic Field of Active Region 11158 dur-
ing the 2011 February 12-17 Flares: Diﬀerences between Photospheric Extrapolation and
Coronal Forward-Fitting Methods. Astrophys. J. 785, 34. DOI. ADS. [Aschwanden2014]
Berger, M.A., Field, G.B.: 1984, The topological properties of magnetic helicity. Journal of

Fluid Mechanics 147, 133. DOI. ADS. [Berger1984]

Bobra, M.G., Sun, X., Hoeksema, J.T., Turmon, M., Liu, Y., Hayashi, K., Barnes, G., Leka,
K.D.: 2014, The Helioseismic and Magnetic Imager (HMI) Vector Magnetic Field Pipeline:
SHARPs - Space-Weather HMI Active Region Patches. Solar Phys. 289, 3549. DOI. ADS.
[Bobra2014]

Chen, P.F.: 2011, Coronal Mass Ejections: Models and Their Observational Basis. Living

Reviews in Solar Physics 8, 1. DOI. ADS. [Chen2011]

Cheung, M.C.M., DeRosa, M.L.: 2012, A Method for Data-driven Simulations of Evolving

Solar Active Regions. Astrophys. J. 757, 147. DOI. ADS. [Cheung2012]

Cheung, M.C.M., De Pontieu, B., Tarbell, T.D., Fu, Y., Tian, H., Testa, P., Reeves, K.K.,
Mart´ınez-Sykora, J., Boerner, P., W¨ulser, J.P., Lemen, J., Title, A.M., Hurlburt, N., Kleint,
L., Kankelborg, C., Jaeggli, S., Golub, L., McKillop, S., Saar, S., Carlsson, M., Hansteen,
V.: 2015, Homologous Helical Jets: Observations By IRIS, SDO, and Hinode and Magnetic
Modeling With Data-Driven Simulations. Astrophys. J. 801, 83. DOI. ADS. [Cheung2015]
DeForest, C.E., Hagenaar, H.J., Lamb, D.A., Parnell, C.E., Welsch, B.T.: 2007, Solar Magnetic
Tracking. I. Software Comparison and Recommended Practices. Astrophys. J. 666, 576.
DOI. ADS. [DeForest2007]

SOLA: paper_draft.tex; 16 September 2021; 10:10; p. 25

E. Lumme et al.

D´emoulin, P.: 2007, Recent theoretical and observational developments in magnetic helicity

studies. Adv. Space Res. 39(11), 1674. [Demoulin2007]

Fisher, G.H., Welsch, B.T.: 2008, FLCT: A Fast, Eﬃcient Method for Performing Local
Correlation Tracking. In: Howe, R., Komm, R.W., Balasubramaniam, K.S., Petrie, G.J.D.
(eds.) Subsurface and Atmospheric Inﬂuences on Solar Activity, Astronomical Society of
the Paciﬁc Conference Series 383, 373. ADS. [Fisher2008]

Fisher, G.H., Welsch, B.T., Abbett, W.P.: 2012, Can We Determine Electric Fields and Poynt-
ing Fluxes from Vector Magnetograms and Doppler Measurements? Solar Phys. 277, 153.
DOI. ADS. [Fisher2012]

Fisher, G.H., Welsch, B.T., Abbett, W.P., Bercik, D.J.: 2010, Estimating Electric Fields from

Vector Magnetogram Sequences. Astrophys. J. 715, 242. DOI. ADS. [Fisher2010]

Fisher, G.H., Abbett, W.P., Bercik, D.J., Kazachenko, M.D., Lynch, B.J., Welsch, B.T., Hoek-
sema, J.T., Hayashi, K., Liu, Y., Norton, A.A., Dalda, A.S., Sun, X., DeRosa, M.L., Cheung,
M.C.M.: 2015, The Coronal Global Evolutionary Model: Using HMI Vector Magnetogram
and Doppler Data to Model the Buildup of Free Magnetic Energy in the Solar Corona.
Space Weather 13, 369. DOI. ADS. [Fisher2015]

Gibb, G.P.S., Mackay, D.H., Green, L.M., Meyer, K.A.: 2014, Simulating the Formation of a
Sigmoidal Flux Rope in AR10977 from SOHO/MDI Magnetograms. Astrophys. J. 782,
71. DOI. ADS. [Gibb2014]

Gosain, S., Pevtsov, A.A.: 2013, Resolving Azimuth Ambiguity Using Vertical Nature of Solar

Quiet-Sun Magnetic Fields. Solar Phys. 283, 195. DOI. ADS. [Gosain2013]

Hoeksema, J.T., Liu, Y., Hayashi, K., Sun, X., Schou, J., Couvidat, S., Norton, A., Bobra, M.,
Centeno, R., Leka, K.D., Barnes, G., Turmon, M.: 2014, The Helioseismic and Magnetic
Imager (HMI) Vector Magnetic Field Pipeline: Overview and Performance. Solar Phys.
289, 3483. DOI. ADS. [Hoeksema2014]

Inoue, S.: 2016, Magnetohydrodynamics modeling of coronal magnetic ﬁeld and solar eruptions
based on the photospheric magnetic ﬁeld. Progress in Earth and Planetary Science 3, 19.
DOI. ADS. [Inoue2016]

Jiang, C., Wu, S.T., Feng, X., Hu, Q.: 2016, Data-driven magnetohydrodynamic modelling of
a ﬂux-emerging active region leading to solar eruption. Nature Communications 7, 11522.
DOI. ADS. [Jiang2016]

Jing, J., Park, S.-H., Liu, C., Lee, J., Wiegelmann, T., Xu, Y., Deng, N., Wang, H.: 2012,
Evolution of Relative Magnetic Helicity and Current Helicity in NOAA Active Region
11158. Astrophys. J. Lett. 752, L9. DOI. ADS. [Jing2012]

Jones, E., Oliphant, T., Peterson, P.: 2001, SciPy: Open source scientiﬁc tools for Python.

http://www. scipy. org/. [Jones2001]

Kazachenko, M.D., Fisher, G.H., Welsch, B.T.: 2014, A Comprehensive Method of Estimating
Electric Fields from Vector Magnetic Field and Doppler Measurements. Astrophys. J. 795,
17. DOI. ADS. [Kazachenko2014]

Kazachenko, M.D., Fisher, G.H., Welsch, B.T., Liu, Y., Sun, X.: 2015, Photospheric Electric
Fields and Energy Fluxes in the Eruptive Active Region NOAA 11158. Astrophys. J. 811,
16. DOI. ADS. [Kazachenko2015]

Keller, C.U., Harvey, J.W., Giampapa, M.S.: 2003, SOLIS: an innovative suite of synoptic
instruments. In: Keil, S.L., Avakyan, S.V. (eds.) Innovative Telescopes and Instrumentation
for Solar Astrophysics, Proceedings of SPIE 4853, 194. DOI. ADS. [Keller2003]

Lagg, A., Lites, B., Harvey, J., Gosain, S., Centeno, R.: 2015, Measurements of Photospheric

and Chromospheric Magnetic Fields. Space Sci. Rev.. DOI. ADS. [Lagg2015]

Leake, J.E., Linton, M.G., Schuck, P.W.: 2017, Testing the Accuracy of Data-driven MHD

Simulations of Active Region Evolution. Astrophys. J. 838(2), 113. [Leake2017]

Liu, Y., Schuck, P.W.: 2012, Magnetic Energy and Helicity in Two Emerging Active Regions

in the Sun. Astrophys. J. 761, 105. DOI. ADS. [Liu2012]

Liu, Y., Hoeksema, J.T., Sun, X., Hayashi, K.: 2017, Vector Magnetic Field Synoptic Charts
from the Helioseismic and Magnetic Imager (HMI). Solar Phys. 292, 29. DOI. ADS.
[Liu2017]

Mackay, D.H., van Ballegooijen, A.A.: 2006, Models of the Large-Scale Corona. I. Forma-
tion, Evolution, and Liftoﬀ of Magnetic Flux Ropes. Astrophys. J. 641, 577. DOI. ADS.
[Mackay2006]

Metcalf, T.R.: 1994, Resolving the 180-degree ambiguity in vector magnetic ﬁeld measure-
ments: The ’minimum’ energy solution. Solar Phys. 155, 235. DOI. ADS. [Metcalf1994]

SOLA: paper_draft.tex; 16 September 2021; 10:10; p. 26

Optimization of photospheric electric ﬁeld estimates

Mickey, D.L., Canﬁeld, R.C., Labonte, B.J., Leka, K.D., Waterson, M.F., Weber, H.M.:
1996, The Imaging Vector Magnetograph at Haleakala. Solar Phys. 168, 229. DOI. ADS.
[Mickey1996]

Mumford, S.J., Christe, S., P´erez-Su´arez, D., Ireland, J., Shih, A.Y., Inglis, A.R., Liedtke, S.,
Hewett, R.J., Mayer, F., Hughitt, K., Freij, N., Meszaros, T., Bennett, S.M., Malocha, M.,
Evans, J., Agrawal, A., Leonard, A.J., Robitaille, T.P., Mampaey, B., Campos-Rozo, J.I.,
Kirk, M.S.: 2015, SunPy – Python for solar physics. Computational Science and Discovery
8(1), 014009. DOI. ADS. [Mumford2015]

Pagano, P., Mackay, D.H., Poedts, S.: 2013, Magnetohydrodynamic simulations of the ejection

of a magnetic ﬂux rope. Astron. Astrophys. 554, A77. DOI. ADS. [Pagano2013]

Pariat, E., Valori, G., D´emoulin, P., Dalmasse, K.: 2015, Testing magnetic helicity conservation
in a solar-like active event. Astron. Astrophys. 580, A128. DOI. ADS. [Pariat2015]
Pariat, E., Leake, J.E., Valori, G., Linton, M.G., Zuccarello, F.P., Dalmasse, K.: 2017, Relative
magnetic helicity as a diagnostic of solar eruptivity. A&A 601, A125. DOI. https://doi.org/
10.1051/0004-6361/201630043. [Pariat2017]

Pesnell, W.D., Thompson, B.J., Chamberlin, P.C.: 2012, The Solar Dynamics Observatory

(SDO). Solar Phys. 275, 3. DOI. ADS. [Pesnell2012]

Pomoell, J., Lumme, E., Kilpua, E.K.J.: 2017, Modeling the eruption of coronal ﬂux ropes using
the time-dependent magnetofrictional method. Solar Phys.. in preparation. [Pomoell2017]
Ravindra, B., Longcope, D.W., Abbett, W.P.: 2008, Inferring Photospheric Velocity Fields
Using a Combination of Minimum Energy Fit, Local Correlation Tracking, and Doppler
Velocity. Astrophys. J. 677, 751. DOI. ADS. [Ravindra2008]

Riley, P., Lionello, R., Linker, J.A., Mikic, Z., Luhmann, J., Wijaya, J.: 2011, Global MHD
Modeling of the Solar Corona and Inner Heliosphere for the Whole Heliosphere Interval.
Solar Phys. 274, 361. DOI. ADS. [Riley2011]

Scherrer, P.H., Schou, J., Bush, R.I., Kosovichev, A.G., Bogart, R.S., Hoeksema, J.T., Liu, Y.,
Duvall, T.L., Zhao, J., Title, A.M., Schrijver, C.J., Tarbell, T.D., Tomczyk, S.: 2012, The
Helioseismic and Magnetic Imager (HMI) Investigation for the Solar Dynamics Observatory
(SDO). Solar Phys. 275, 207. DOI. ADS. [Scherrer2012]

Schrijver, C.J., Aulanier, G., Title, A.M., Pariat, E., Delann´ee, C.: 2011, The 2011 February 15
X2 Flare, Ribbons, Coronal Front, and Mass Ejection: Interpreting the Three-dimensional
Views from the Solar Dynamics Observatory and STEREO Guided by Magnetohydrody-
namic Flux-rope Modeling. Astrophys. J. 738, 167. DOI. ADS. [Schrijver2011]

Schuck, P.W.: 2006, Tracking Magnetic Footpoints with the Magnetic Induction Equation.

Astrophys. J. 646, 1358. DOI. ADS. [Schuck2006]

Schuck, P.W.: 2008, Tracking Vector Magnetograms with the Magnetic Induction Equation.

Astrophys. J. 683, 1134. DOI. ADS. [Schuck2008]

Schuck, P.W., Antiochos, S.K., Leka, K.D., Barnes, G.: 2016, Achieving Consistent Doppler
Measurements from SDO/HMI Vector Field Inversions. Astrophys. J. 823, 101. DOI. ADS.
[Schuck2016]

Seehafer, N.: 1978, Determination of constant alpha force-free solar magnetic ﬁelds from

magnetograph data. Solar Phys. 58, 215. DOI. ADS. [Seehafer1978]

Shibata, K., Magara, T.: 2011, Solar Flares: Magnetohydrodynamic Processes. Living Reviews

in Solar Physics 8, 6. DOI. ADS. [Shibata2011]

Snodgrass, H.B.: 1983, Magnetic rotation of the solar photosphere. Astrophys. J. 270, 288.

DOI. ADS. [Snodgrass1983]

Sun, X.: 2013, On the Coordinate System of Space-Weather HMI Active Region Patches

(SHARPs): A Technical Note. ArXiv e-prints. ADS. [Sun2013]

Sun, X., Hoeksema, J.T., Liu, Y., Wiegelmann, T., Hayashi, K., Chen, Q., Thalmann, J.:
2012, Evolution of Magnetic Field and Energy in a Major Eruptive Active Region Based
on SDO/HMI Observation. Astrophys. J. 748, 77. DOI. ADS. [Sun2012]

Swarztrauber, P., Sweet, R.: 1975, Eﬃcient FORTRAN subprograms for the solution of elliptic

partial diﬀerential equations. [Swarztrauber1975]

Tremblay, B., Vincent, A.: 2015, A Minimum Energy Fit Method to Reconstruct Photospheric
Velocity and Magnetic Diﬀusivity in Active Regions from Observed Magnetograms and
Dopplergrams. Solar Phys. 290, 437. DOI. ADS. [Tremblay2015]

Tsuneta, S., Ichimoto, K., Katsukawa, Y., Nagata, S., Otsubo, M., Shimizu, T., Suematsu, Y.,
Nakagiri, M., Noguchi, M., Tarbell, T., Title, A., Shine, R., Rosenberg, W., Hoﬀmann, C.,
Jurcevich, B., Kushner, G., Levay, M., Lites, B., Elmore, D., Matsushita, T., Kawaguchi,
N., Saito, H., Mikami, I., Hill, L.D., Owens, J.K.: 2008, The Solar Optical Telescope for the
Hinode Mission: An Overview. Solar Phys. 249, 167. DOI. ADS. [Tsuneta2008]

SOLA: paper_draft.tex; 16 September 2021; 10:10; p. 27

E. Lumme et al.

Tziotziou, K., Georgoulis, M.K., Liu, Y.: 2013, Interpreting Eruptive Behavior in NOAA AR
11158 via the Region’s Magnetic Energy and Relative-helicity Budgets. Astrophys. J. 772,
115. DOI. ADS. [Tziotziou2013]

Tziotziou, K., Georgoulis, M.K., Raouaﬁ, N.-E.: 2012, The Magnetic Energy-Helicity Diagram

of Solar Active Regions. Astrophys. J. Lett. 759, L4. DOI. ADS. [Tziotziou2012]

van Ballegooijen, A.A., Priest, E.R., Mackay, D.H.: 2000, Mean Field Model

for the
Formation of Filament Channels on the Sun. Astrophys. J. 539, 983. DOI. ADS.
[vanBallegooijen2000]

Weinzierl, M., Yeates, A.R., Mackay, D.H., Henney, C.J., Arge, C.N.: 2016, A New Technique
for the Photospheric Driving of Non-potential Solar Coronal Magnetic Field Simulations.
Astrophys. J. 823, 55. DOI. ADS. [Weinzierl2016]

Welsch, B.T.: 2006, Magnetic Flux Cancellation and Coronal Magnetic Energy. Astrophys. J.

638, 1101. DOI. ADS. [Welsch2006]

Welsch, B.T., Fisher, G.H., Sun, X.: 2013, A Magnetic Calibration of Photospheric Doppler

Velocities. Astrophys. J. 765, 98. DOI. ADS. [Welsch2013]

Welsch, B.T., Abbett, W.P., De Rosa, M.L., Fisher, G.H., Georgoulis, M.K., Kusano, K.,
Longcope, D.W., Ravindra, B., Schuck, P.W.: 2007, Tests and Comparisons of Velocity-
Inversion Techniques. Astrophys. J. 670, 1434. DOI. ADS. [Welsch2007]

Welsch, B.T., Li, Y., Schuck, P.W., Fisher, G.H.: 2009, What is the Relationship Be-
tween Photospheric Flow Fields and Solar Flares? Astrophys. J. 705, 821. DOI. ADS.
[Welsch2009]

Wiegelmann, T., Sakurai, T.: 2012, Solar Force-free Magnetic Fields. Living Reviews in Solar

Physics 9, 5. DOI. ADS. [Wiegelmann2012]

Wiegelmann, T., Petrie, G.J.D., Riley, P.: 2015, Coronal Magnetic Field Models. Space Sci.

Rev.. DOI. ADS. [Wiegelmann2015]

Yang, W.H., Sturrock, P.A., Antiochos, S.K.: 1986, Force-free magnetic ﬁelds - The magneto-

frictional method. Astrophys. J. 309, 383. DOI. ADS. [Yang1986]

Yeates, A.R.: 2017, Sparse Reconstruction of Electric Fields from Radial Magnetic Data.

Astrophys. J. 836, 131. DOI. ADS. [Yeates2017]

Yee, K.: 1966, Numerical solution of inital boundary value problems involving maxwell’s equa-
tions in isotropic media. IEEE Transactions on Antennas and Propagation 14, 302. DOI.
ADS. [Yee1966]

Appendix

A. Modiﬁcations to the existing data processing methods

A.1. Tracking scheme of active regions in SHARP data

As explained by Bobra et al. (2014) and Hoeksema et al. (2014) re-projected
vector magnetograms in SHARP time series are created by tracking each HMI
Active Region Patch (HARP) using a ﬁxed rotation rate for the center point of
the patch. The rotation rate is determined from the latitude of the center point
using a diﬀerential rotation proﬁle. Instead of the diﬀerential rotation proﬁle
described in Hoeksema et al. (2014) we employ the ”2 day lag” proﬁle from
Snodgrass (1983). For the NOAA 11158 vector magnetogram time series used
in this paper our tracking speed is ∼2 km s−1 (0.27 deg per day) slower than
the SHARP tracking speed. We observe that when using this method the center
of the active region remains slightly better ﬁxed to the center of the patch. As
explained by Sun (2013) the ﬁnal re-projected SHARP magnetogram is created
for each frame so that the disambiguated full-disk vector magnetogram is re-
projected on the solar surface, i.e., interpolated from image pixels to a new grid

SOLA: paper_draft.tex; 16 September 2021; 10:10; p. 28

Optimization of photospheric electric ﬁeld estimates

that corresponds to Lambert CEA projection of the solar surface covering the
predescribed active region size. The CEA projection is done so that the active re-
gion is ”viewed directly from above”, i.e. using a heliographic coordinate system
where the center of the active region is at the intersection of the central meridian
and the equator. The grid spacing is 0.03◦ in projected heliographic coordinates
corresponding to the SDO/HMI resolution at the disk center. We have modiﬁed
this procedure so that instead of a CEA projection we employ Mercator projec-
tion, since conformal mappings are preferred when optical ﬂow methods (such
as DAVE4VM) are used (Welsch et al., 2009; Kazachenko et al., 2015). After re-
projecting the full-disk magnetogram data we rotate the interpolated magnetic
ﬁeld vectors from SDO/HMI image basis (Bξ, Bη, Bζ) (uniquely deﬁned by the
orthogonal image axes and LOS direction) to the heliographic basis (Br, Bθ, Bφ).
The heliographic basis is chosen consistently with the Mercator map projection
so that the center point of the active region is at the intersection of the central
meridian and the equator. Transformation from the default heliographic basis
(Br, Bθ, Bφ) where the true solar equator has latitude λ = 0 to the patch-
centered basis (B(cid:48)
φ) can be be done using the following transformation
(which is not included in the references listed above):

θ, B(cid:48)

r, B(cid:48)



 =









B(cid:48)
r
B(cid:48)
θ
B(cid:48)
φ

0

0

1
0 cos α − sin α
0 sin α cos α













Br
Bθ
Bφ

(21)

α(λ, φ, λc, φc) = sgn(λc)sgn(φ − φc) ×

cos−1 [(cos λc cos λ + sin λc sin λ cos(φ − φc)) / cos λ(cid:48)] (22)
(23)

λ(cid:48) = sin−1 [sin λ cos λc − sin λc cos λ cos (φ − φc)] ,

c) = (0, 0).

is the latitude in heliographic coordinates where the patch center

where λ(cid:48)
c, φ(cid:48)
(λ(cid:48)
This is diﬀerent from SHARP data in which the heliographic basis corresponds
to Carrington coordinates in which the equator is the true solar equator (Sun,
2013). Finally, we further transform into local Cartesian basis where we treat
the projected active region patch as a ﬂat surface:



 =





Bx
By
Bz









B(cid:48)
φ
−B(cid:48)
θ
B(cid:48)
r,

(24)

where we drop the apostrophes to simplify notation.

A.2. Algorithm for removal of spurious ﬂips in azimuth of the

magnetic ﬁeld

Welsch, Fisher, and Sun (2013) deﬁne spurious ﬂips of the azimuth of the
magnetic ﬁeld φ as sudden jumps where φ jumps approximately from one dis-
ambiguation to the other φ → φ + 180◦ and then quickly back. In a time
series this ﬂipping can be seen as rapid blinking in the transverse magnetic
ﬁeld components. The authors proposed a temporal smoothing algorithm to

SOLA: paper_draft.tex; 16 September 2021; 10:10; p. 29

E. Lumme et al.

recognize and remove such spurious ﬂips. The algorithm detects these ﬂips using
two conditions. First, the change in azimuth between successive frames must be
signiﬁcant enough (over 120◦):

||φ(xm, yn, tk) − φ(xm, yn, tk−1)|| > 120◦.

where ||x|| refers to the absolute acute angle of x:

(cid:26)

||x|| =

|x|, |x| ≤ 180◦
360◦ − |x|, |x| > 180◦

(25)

(26)

Second, if a spurious azimuth ﬂip candidate at tk is removed by ﬂipping the
azimuth back to the ”correct” value (φ → φ+180◦), the procedure must decrease
the sum of unsigned azimuth diﬀerences over the nearby frames:

S =

R
(cid:88)

l=−R

||φ(xm, yn, tk+l) − φ(xm, yn, tk)||,

(27)

i.e., the procedure must smooth the azimuth in the time domain. Here R is
the expected length of that spurious ﬂip in time, and it gives the upper limit
for the number of frames the spurious ﬂip may last in order to be recognized
by the algorithm. R is the only free parameter in the algorithm and Welsch,
Fisher, and Sun (2013) suggested two values for it: R = 2 or R = 4, from
which they used the former. We have chosen to use R = 4 instead, since it
produces more stable evolution of the azimuth in visual inspection. Another
major qualitative departure from the work of Welsch, Fisher, and Sun (2013)
is that we applied the ﬂip removal procedure after interpolating the SDO/HMI
data to local Cartesian system in Mercator projection (Appendix A.1), whereas
they applied the procedure in native HMI pixels. Thus, in our approach the
erroneous values of pixels where the azimuth had a spurious ﬂip propagated in
the interpolation. Due to this we employ an additional step after recognizing and
ﬁxing the spurious ﬂips: we smooth each ﬁxed pixel and all of its 8 neighboring
pixels using a Gaussian smoother with σ = 1 pixel truncated at 1σ as a way
to mitigate the eﬀect of propagating the erroneous azimuth to the neighboring
pixels in the interpolation. An additional motivation for this smoothing is that it
removes some of the artifacts of the ﬂip removal procedure itself: the procedure
leaves some ragged structures and singular pixels of inconsistent azimuth values
to the data, which we consider spurious, particularly when taking into account
that the minimum energy disambiguation tries to reduce currents, i.e. to smooth
the azimuth spatially.

B. Numerical implementation of the electric ﬁeld inversion

methods in ELECTRICIT

In the PDFI method Faraday’s law (Eq. 4) is uncurled using the Poloidal-
Toroidal Depomposition of the magnetic ﬁeld (Fisher et al., 2010):

A = ∇ × P ˆz + T ˆz

(28)

SOLA: paper_draft.tex; 16 September 2021; 10:10; p. 30

Optimization of photospheric electric ﬁeld estimates

EI = −∇ × ˙P ˆz − ˙T ˆz,

(29)

where A is the magnetic vector potential ∇ × A = B, and ˙P and ˙T are the
partial time derivatives of two-dimensional poloidal and toroidal potentials, re-
spectively. They can be solved from the Poisson equations of which source terms
are determined by the ∂B/∂t ﬁeld. The time derivative of the poloidal potential
can be solved from:

∇2
h

˙P = −

∂Bz
∂t
x + ∂2

,

(30)

x, EI

h = (EI

h is the horizontal Laplacian ∂2

where ∇2
y. In this paper we employ only the
horizontal components of the inductive electric ﬁeld EI
y ) which are
determined solely from ˙P . We solve the Equation 30 using the same homogeneous
Neumann boundary conditions and the numerical solver (FISHPACK, Swarz-
trauber and Sweet, 1975) as Kazachenko, Fisher, and Welsch (2014). As noted
by Kazachenko, Fisher, and Welsch (2014), FISHPACK modiﬁes the source
term of a Poisson equation by adding a constant value to it, if it is found
to be inconsistent with the homogeneous Neumann boundary conditions. As
a result of this correction the output electric ﬁeld is slightly inconsistent with
Faraday’s law. To remove this inconsistency we add post facto correction to the
horizontal electric ﬁeld components as done by Fisher et al. (2010). To further
ensure the consistency with Faraday’s law we have also decided to use diﬀerent
ﬁnite diﬀerence approximation for Equations 28 and 29 than Kazachenko, Fisher,
and Welsch (2014). The FISHPACK solver employs the 5-point stencil for the
Laplacian, which implicitly assumes that the ﬁrst order spatial derivatives of
the solution of the Poisson equation are determined in half-grid points. Thus,
if the ﬁrst order derivatives in Equation 29 and Faraday’s law (Eq. 4) for the
horizontal components of EI are calculated using a typical central diﬀerence
scheme, ∂Bz/∂t is not reproduced exactly. Kazachenko, Fisher, and Welsch
(2014) argue that the error introduced by this is small and employ a central
diﬀerence scheme also for the ﬁrst order derivatives. However, we wish to re-
produce ∂Bz/∂t from Faraday’s law exactly, and therefore employ the following
consistent ﬁnite diﬀerence formulas for the spatial derivatives (used in a similar
fashion also by Yeates, 2017):

EI

x(xm, yn+1/2) = −

∂ ˙P
∂y

(xm, yn+1/2) = −

˙P (xm, yn+1) − ˙P (xm, yn)
∆y

EI

y (xm+1/2, yn) =

∂ ˙P
∂x

(xm+1/2, yn) =

˙P (xm+1, yn) − ˙P (xm, yn)
∆x

(31)

(32)

∂Bz(xm, yn)
∂t

= −(∇ × EI )z(xm, yn) =

(xm, yn) −

∂EI
x
∂y
x(xm, yn−1/2)

∂EI
y
∂x

(xm, yn)(33)

EI

x(xm, yn+1/2) − EI

=

∆y

−

EI

y (xm+1/2, yn) − EI

y (xm−1/2, yn)

∆x

.

SOLA: paper_draft.tex; 16 September 2021; 10:10; p. 31

E. Lumme et al.

As one can implicitly read from the equations above the spatial derivatives
consistent with the 5-point stencil give the electric ﬁeld components in a stag-
gered grid (Yee mesh, Yee, 1966) with respect to Bz and ∂Bz/∂t at (xm, yn).
Since many of the TMF simulations employ such a staggered grid (e.g., van
Ballegooijen, Priest, and Mackay, 2000; Cheung and DeRosa, 2012), this makes
the electric ﬁeld inversions of ELECTRICIT instantly suitable to be used as
the boundary condition data of such simulations, while being simultaneously
consistent with the observed time evolution of Bz.

The numerical approach described above is used to solve also the P potential
p (see
p is determined in a staggered grid

from Bz and the resulting horizontal components of the vector potential Ah
Fisher et al., 2010 for details). Thus, our Ah
being also exactly consistent with Bz.

The non-inductive component ψ is solved similarly as the ˙P potential in
Equation 30 (including the post facto corrections) for each Assumption 1 and
2 (Section 2.3). When calculating the current density jz for Assumption 2 the
spatial derivatives of Bx and By are calculated using a central diﬀerence scheme,
since we wish to keep jz and thereby also ψ cospatial with the magnetogram data.
However, since EI is deﬁned on a staggered grid the gradients ∇xψ and ∇yψ
are not cospatial with EI
y . This can be ﬁxed by interpolating ψ(xm, yn)
to ψ(xm+1/2, yn+1/2), after which the gradients:

x and EI

∇xψ(xm, yn+1/2) =

∇yψ(xm+1/2, yn) =

ψ(xm+1/2, yn+1/2) − ψ(xm−1/2, yn+1/2)
∆x
ψ(xm+1/2, yn+1/2) − ψ(xm+1/2, yn−1/2)
∆y

,

(34)

(35)

are cospatial with EI
ensures that (∇ × E)z in Faraday’s law is unaﬀected by −∇hψ.

y in Equations 31 and 32. Moreover, this approach

x and EI

Finally, it should be noted that the use of staggered grid in the ELECTRICIT
solutions of E and Ap requires also (linear) interpolation back to a centered grid
whenever Poynting or relative helicity ﬂuxes are calculated.

SOLA: paper_draft.tex; 16 September 2021; 10:10; p. 32

