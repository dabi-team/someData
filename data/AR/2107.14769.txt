1
2
0
2

l
u
J

0
3

]

M

I
.
h
p
-
o
r
t
s
a
[

1
v
9
6
7
4
1
.
7
0
1
2
:
v
i
X
r
a

Optimization of EMCCD operating parameters for the acquisition
system of SPARC4

Denis Varise Bernardesa,b, Eder Martiolic,d, Danilo Henrique Spadotia
aUniversidade Federal de Itajub´a, Laborat´orio de Telecomunicac¸ ˜oes - LabTel, Av. BPS, 1303 - Pinheirinho,
Itajub´a-MG, Brazil
bInstituto Nacional de Pesquisas Espaciais, Avenida dos Astronautas, 1758, S˜ao Jos´e dos Campos-SP, Brazil
cSorbonne Universit´e, CNRS, UMR 7095, Institut d’Astrophysique de Paris, 98 bis bd Arago, 75014 Paris, France
dLaborat´orio Nacional de Astrof´ısica, Rua Estados Unidos, 154, Itajub´a-MG, Brazil

Abstract. We present the Optimization Method for the Electron Multiplying Charge Coupled Devices (EMCCDs)
of the Acquisition System of the SPARC4 (OMASS4). The OMASS4 uses as ﬁgures of merit the signal-to-noise
ratio (SNR) and the acquisition rate (AR) as a function of the operation mode of the CCDs. Three different modes
of optimization are included in the OMASS4: (1) optimization of SNR only; (2) optimization of AR only; and (3)
optimization of both SNR and AR simultaneously. The ﬁrst two modes calculate an analytical maximization of the cost
function whereas the third mode uses the bayesian optimization method to determine the optimum mode of operation.
We apply the OMASS4 to ﬁnd the optimum mode for observations obtained at the Pico dos Dias Observatory, Brazil,
and compare the delivered modes of operation and its performance with the ones adopted by the observer. If the
OMASS4 had been used as a tool to optimize the CCDs in all of these nights, it would be possible to improve their
efﬁciency in 97.17 %, 65.08 %, and 77.66 % for the optimization modes 1, 2, and 3, respectively.

Keywords: CCD; Bayesian optimization; Simultaneous Polarimeter and Rapid Camera in Four Bands..

*Denis Varise Bernardes: denis.bernardes@inpe.br
*Eder Martioli: emartioli@lna.br
*Danilo Henrique Spadoti: spadoti@unifei.edu.br

1 Introduction

The Astrophysics Division of the Instituto Nacional de Pesquisas Espaciais (INPE) in collabora-
tion with the Laborat´orio Nacional de Astrof´ısica (LNA) is developing a new astronomical instru-
ment, the Simultaneous Polarimeter and Rapid Camera in Four Bands (SPARC4).1 SPARC4 will
be installed on the 1.6 m Perkin-Elmer telescope at Observat´orio Pico dos Dias, Brazil, and it will
allow image acquisition in the four Sloan Digital Sky Survey (SDSS) photometric bands: g, r, i and
z.2 The synchronization of the acquisition of these photometric bands (channels) will be done by
using a digital pulse generator developed by the Highland Technology Company.3 Different syn-
chronization modes for the four channels can be implemented by programming the pulses created
by the pulse generator. Also, the SPARC4 will allow image acquisition using the photometric or
polarimetric mode. In the polarimetric mode, two wave plates are introduced in the light path that
allow measurements with linear and circular polarimetry.

For the acquisition in each channel, there is a dedicated iXon Ultra EMCCD, produced by
Andor Technology.4 These devices have an optical window and coating optimized for the spec-
tral range in which they were designed to operate.1 These cameras also have frame transfer and
electron-multiplying capabilities, allowing acquisition rates (AR) of up to 26 fps full-frame (1024 x
1024 pixels) even on faint astronomical objects, which requires high sensitivity for short exposure
times.

1

 
 
 
 
 
 
The quality of photometric measurements in astronomical observations can be quantiﬁed by the
signal-to-noise ratio (SNR). Another important constraint concerning many scientiﬁc applications
expected with SPARC4, especially those requiring fast time-series photometry or polarimetry, is
the AR. Either the SNR or AR or both can change depending on the conﬁguration of the opera-
tional mode of the CCD. Therefore, an optimal selection of the operational mode for each CCD is
important to obtain the best performance of the instrument. The CCDs provide a set of parameters
to control the operational modes, such as the horizontal and vertical shift speed, the CCD gain, and
the electron multiplying on/off mode. In addition, one may consider other parameters to obtain
an optimal performance such as the spatial binning, exposure time, and sub-imaging, all of which
may or may not have their values restricted by the scientiﬁc requirements. These parameters affect
the SNR and AR in different ways, with non-linear dependencies, and with additional restrictions.
Therefore, an optimal parameters choice for all four CCDs to obtain the highest performance in
observations may be a difﬁcult task for a human, even for experienced and skillful observers. A
solution to this problem concerns the main objective of this work.

In this scenario, Ref. 5 derived the SNR for EMCCDs to estimate the resolution of a micro-
scope as a function of the EM gain Gem. The authors state that there is a critical value of Gem for
which the SNR starts to degrade. The authors in Ref. 6 presented a method to auto-adjust the expo-
sure time texp to optimize the information acquired by the cameras in different lighting conditions.
This method was based on the calculation of a gradient for a series of images taken at different
brightness intensities. The optimum texp is the one that maximizes the gradient. The methodol-
ogy presented in Ref. 7, and Ref. 8 was based on the maximization of the Shannon entropy. To
accomplish this, Ref. 7 adjust the texp of the cameras. Ref. 8, in turn, acquire a sequence of images
with different combinations of texp and gain. With these experiments the authors stated that there
was an optimum combination for both parameters and the optimum values varying according to
the illumination conditions. In Ref. 9 the authors presented a metric that assesses the image quality
according to the texp and gain values. The optimum conﬁgurations for both parameters were found
through the application of the Bayes optimization method to this metric. In this way, Ref. 10 pre-
sented a methodology to optimize a 32-dimensional (including discrete and continuous variables)
Deep Belief Networks using the Bayes optimization method with the Tree-structured Parzen Es-
timator (TPE) algorithm. The authors obtained the best result in hyper-parameter optimization of
Deep Belief Networks, outperforming previous results obtained by using human-guided search,
brute-force random search, and the Gaussian Process algorithm. Among the authors, only Ref. 10
have presented a methodology to optimize several parameters simultaneously, which are discrete
and continuous. In our case, there is also a mix of discrete and continuous parameters for the
conﬁguration of the SPARC4 cameras.

Inspired on the above methodologies we consider using the Bayes Optimization Method, which
is designed for black-box derivative-free global optimization11 to ﬁnd the optimal values of rele-
vant conﬁguration parameters of the CCDs that provides the highest SNR and/or AR. This is the
ﬁrst step to optimize the performance of SPARC4. This paper is organized as follows. Section
2 presents the Bayes optimization method used in this work. Section 3 presents the considera-
tions adopted for the SNR calculation. Section 4 presents the SPARC4 acquisition system and the
characterization of one of the detectors. Section 5 describes the OMASS4. Section 6 presents the
results and discussion, and Sec. 7 presents the conclusion.

2

2 Bayes optimization method

The Bayes optimization method is a statistical free derivative method to search the maximum or
minimum of a non-linear objective function f (x) using a small data set,11.12 The execution of the
Bayes optimization method can be divided into two parts: the estimation of the objective function
through a bayesian statistical model and the application of an acquisition function to determine the
next best point to evaluate.13

In estimating the objective function one obtains a noisy sample for each iteration of the Bayes
optimization method. These samples provide a prior distribution for the objective function, which
are combined with a likelihood function for the samples obtained until that moment, resulting in
a posterior distribution. This step can be interpreted as estimating the objective function through
a surrogate function13.14 Some of the most known surrogate functions are the Gaussian Process
(GP),11 the Random Forest Regression,15 and the TPE.10 Between them, the TPE was chosen to be
used in OMASS4, allowing the optimization of continuous and discrete parameters simultaneously.
Also, the objective function used by the OMASS4 is presented in the Eq. 22 and it will be discussed
later.

In execution of the acquisition function part, the goal is to determine the next value to evaluate
that is the most likely optimum point of the objective function. Thus, one must look for points
with high probability to be the next optimal point, points with high uncertainty, or both at the same
time13.14 This step is known as the exploitation/exploration balance. The acquisition function used
in Ref. 10 to implement the TPE is the Expected Improvement, as described in the next section.

2.1 Tree-Structured Parzen Estimator Algorithm (TPE)

The TPE algorithm was ﬁrstly presented by Ref. 10, and it was used to obtain the minimum of a
function through an interactive ﬁt of a probability density function p(y|x), where y is the value of
the evaluation of objective function in x.16 The TPE uses the Bayes rule in the form

p(y|x) =

p(x|y) × p(y)
p(x)

,

(1)

where p(x|y) is the probability of x to be chosen as the next evaluation point.17 In turn, p(x|y) can
be expressed as

(cid:40)

p(x|y) =

l(x),
g(x),

if y < y∗
if y ≥ y∗.

(2)

l(x) is the density probability function given by those points which f (x) < y∗ and g(x) is the
probability density function given by the other points. The value of y∗ is ﬁt by the algorithm over
the iterations, so that a percentage γ of the data accomplish the condition p(y < y∗) = γ15.17
Thus, the expression for the expected improvement EI for the TPE acquisition function is given as
follows

EI =

γy∗l(x) − l(x) (cid:82) y∗

∞ p(y)dy

γl(x) + (1 − γ)g(x)

(cid:34)

∝

γ +

g(x)
l(x)

(cid:35)

(1 − γ)

−1.

(3)

3

The deduction of the Equation 3 can be found in Ref. 10. This function demonstrates that the
maximization of the EI occurs for those points x in the domain of objective function with high
probabilities for l(x) and low probabilities for g(x).

3 Signal-to-noise ratio

In this scope it will be considered as a signal the photon ﬂux measured by the CCD integrated
over time and space. Figure 1 illustrates an example of the ﬂux of a point-like source (e.g., a star)
acquired by a CCD distributed over the pixels, where the three concentric circles have radius of
13, 26, and 39 pixels. Only pixels lying within the inner circle are considered for the calculation
of the star ﬂux S. Pixels lying within the outer annulus are considered for the calculation of the
background ﬂux Sf. The radius of these circles was obtained by modeling the star ﬂux distribution
as a Gaussian distribution, so the star radius was calculated through the full width at half maximum
(FWHM)18 parameter. The star radius equals 3× the circle radius at FWHM. The second and the
third circles have two and three times the radius of the inner circle, respectively.

Fig 1 Counts distribution over the pixels of the CCD. The image presents three concentric circles: with 13 pixels
radius, 26 pixels radius, and 39 pixels radius. Pixels in the inner circle are those considered for calculation of the
star ﬂux. Pixels between circles with radius 26 pixels and 39 pixels are those considered for the calculation of the
background ﬂux.

Eq. 4 presents the SNR S calculation of the Fig. 1

S =

S
N

,

(4)

where N , in electrons, is the total noise of the image. S, in electrons, is given by the sum of the
pixels values Si in the inner circle, in the analogical-to-digital unit (ADU), subtracted by Sf,19 as
follows:

S =

np
(cid:88)

i=1

(Si − Sf) × G.

4

(5)

np is the number of pixels considered to calculate the star ﬂux, Sf is given by the median, in ADU,
of the pixels in the annulus and G is the conversion factor, or gain, of the CCD, in e-/ADU.

According to Ref. 20, it can be said that N is composed by the read noise (RN) σr, the dark
current (DC) noise σdc, the noise of sky measurement σsky and the noise of star ﬂux measurement
σs. There are other noise sources in the CCD, but, for simpliﬁcation, they will not be considered
in this scope. σr is the standard deviation, given in e- rms, around the bias level of the CCD. σdc is
given in electrons and can be calculated through the mean of the electrons per pixel Sdc generated
by the DC as a function of the texp, where Sdc is given as

where DC is the dark current, given in e-/pixel/s, for the respective CCD temperature.21 σsky is
given in photons and can be obtained through the mean of the photon ﬂux per pixel of the sky Ssky:

Sdc = DC × texp,

(6)

Ssky = (Sf − B) × G − Sdc,

(7)

where B is the bias level of the image, in ADU. σs is given in number of photons, and it can be
calculated through the star ﬂux S. σdc, σsky, σs can be calculated assuming a Poisson distribution.20
Thus, the expression for each noise source is

σr =

np
(cid:88)

i=1

(σADU(i) × G)

σ2
dc =

σ2
sky =

np
(cid:88)

i=1

np
(cid:88)

i=1

Sdc(i) × G2

em × N 2
F

Ssky(i) × G2

em × N 2
F

s = S × G2
σ2

em × N 2
F,

(8)

(9)

(10)

(11)

where σADU(i), Sdc(i), Ssky(i) represent the counts’ distribution per pixel, the mean thermoelectrons
per pixel, and the photons number per pixel of the sky, for the i-th pixel of the star, respectively.
Gem is the ampliﬁcation gain provided by the EM mode of the CCD. For the conventional mode,
Gem = 1. NF is the noise factor and represents and extra noise added to the image because of the
use of the EM ampliﬁer. For an Andor EMCCD, NF = 1.41.22 However, it will be considered that
these parameters are constant over the pixels, so

σr = np × σADU × G

dc = np × Sdc × G2
σ2

em × N 2
F

sky = np × Ssky × G2
σ2

em × N 2
F.

5

(12)

(13)

(14)

By considering uncorrelated noise sources,23 it is possible to express N as follows

s + σ2
Replacing the Eq. 11 - 14 on Eq. 15, we ﬁnd

N 2 = σ2

sky + σ2

dc + σ2
r .

N 2 = S × G2

em × N 2

F + np × [ Ssky + Sdc × G2

em × N 2

F] + np × (σADU × G)2.

Replacing equation Eq. 16 on Eq. 4, and dividing the fraction by Gem, the SNR will be

S =

(cid:112)S N 2

F + np [ (Ssky + Sdc) N 2

F + (σADU G/Gem)2]

S

.

(15)

(16)

(17)

Thus, we ﬁnd an expression for the SNR that is adopted in the OMASS4. Given the information
of the star ﬂux and the image noise, this equation was used to estimate the SNR values for different
operation modes of the CCDs and then to determine the optimum mode.

4 Acquisition System

For the control of the SPARC4 acquisition system, a software prototype was developed in Labview
language24 using the Software Development Kit25 developed by Andor Technology for communi-
cation with the CCDs. This software will allow simultaneous and synchronized acquisition for the
four SPARC4 channels. The synchronization will be made by a digital pulse generator3 developed
by the Highlands Technology with a resolution of 10 ps between pulses. For each channel it is
possible to acquire cubes with up to 70 full-frame images with a delay of approximately 1.7 ms
between exposures. It is also possible to concatenate cubes with a delay between 160 ms to 980 ms
depending on the size of the cube. Thus, this system will allow the acquisition of synchronized
image cubes for the four channels, a feature that is not available on the control software delivered
by the manufacturer, the Andor Solis.26

The critical parameters that are employed in our system to control the cameras are: CCD
temperature, Gem mode, sub-image (SI), and binning of the pixels (Bin). Their allowed values are
constrained either by the scientiﬁc application or to ensure the safety of the system. The CCD
temperature, for instance, is constrained in the interval between -80 ºC and 20 ºC.4 The Gem is
limited to the range between 2× and 300×, which is the safe operational range advised by the
manufacturer.22 The SI is limited to the same set of options available in the Andor Solis, i.e.,
squared windows with sizes of 256 pixels, 512 pixels, and 1024 pixels. Finally, the electronic
binning was limited to the values of 1 × 1 pixel and 2 × 2 pixels. Given that the SPARC4 plate
scale is 0.35 arcsec/pixel27 and the median seeing at Observat´orio Picos dos Dias is 1.5 arcsec,28
the choice of using only these two options for binning values is to ensure that the spatial resolution
of the instrument will not be affected. Table 1 presents all the control parameters of the acquisition
system and their respective ranges. Based on these criteria, we characterized the read noise and
the acquisition rate of one of the SPARC4 CCDs for all of the allowed operation modes.

6

Table 1 Control parameters of the operation mode of the CCDs made available by the acquisition system. For each
parameter, the unit and allowed values are provided

.

Parameter
Exposure time
Images in cube
CCD cooler
CCD temperature
Horizontal Shift Speed
Pre-ampliﬁcation
EM mode
EM gain
Sub-image
Binning

Unit
(s)

(ºC)
(MHz)

(pixels)
(pixels)

Allowed values
> 1×10−5
> 1, and < 70
on/off
from -80 to 20
0,1; 1; 10; 20 and 30
1 and 2
on/off
from 2x to 300x
256, 512, and 1024
1 and 2

4.1 Characterization of the CCDs

This section presents the experimental procedures and results obtained in the determination of the
RN and the AR for all available modes of operation for one of the SPARC4’s detectors, the I
channel, an EMCCD iXon Ultra 888, serial number 9916. Based on these results, two packages
were developed using Python language. One package was developed using the characterization of
the read noise presented in Sec. 4.1.1 to calculate the SNR as a function of the operation mode of
the CCD. The other one was developed using the results presented in Table 3 of the Sec. 4.1.2 for
the calculation of the AR as a function of the operation mode. These packages, in turn, are used
by the OMASS4 to determine the optimum operation mode of the CCDs.

4.1.1 Read Noise

This section presents the characterization of the RN, implemented based on the methodology pre-
sented in Ref. 21 for the SPARC4 cameras. The characterization was performed for all combi-
nations of the allowed values for the parameters Horizontal Shift Speed (HSS), pre-ampliﬁcation
(PA), and Bin. For the EM mode, the following Gem values were used: 2x; the range 10x to 50x,
in steps of 10x; and the range 50x to 300x, in steps of 50x. For each evaluation, we calculated
the standard deviation of the counts for each pixel, for a series of 100 bias images. This procedure
resulted in an image of the spatial distribution of the EMCCD noise for the respective operation
mode. From this image noise, we calculated the probability distribution function of the pixels.
Therefore, the RN presented in this characterization is the median of this probability distribution,
multiplied by the CCD gain, for the conversion from counts to electrons. The RN error is calcu-
lated by the absolute standard deviation of the probability distribution, also, multiplied by the CCD
gain.

We estimated the DC for the used EMCCD using the model presented in Ref. 21 for the

SPARC4 cameras:

DC9916 = 9.67 e0.0012T 2+0.25T ,
where DC9916 is the model that estimates the DC of the 9916 camera for the temperature range
-30 ºC to -70 ºC. T = -60 ºC is the used temperature for the EMCCD. Therefore, the calculated DC
is 3.93 × 10−8 e-/pix/s. In the worst scenario, for the minimum exposure time of 1 × 10−5 s and

(18)

7

the maximum Gem value of 300x, the DC noise is ∼1.18 × 10−10 e-/pix. For this reason, the DC
noise was neglected in this analysis.

The RN values obtained for the conventional mode are presented in Table 2. Values without
errors were obtained from the camera data sheet.29 Figure 2 presents the RN values obtained for
the EM mode characterization. Each point in the plot represents the mean and standard variation
of three measurements. From a given Gem value, the noise for the 1 MHz mode is greater than
the noise for the modes 10 MHz (Figure 2c and 2d) and 20 MHz (Figure 2d). This is unexpected
behavior. We believe that it would be a noise created by the electronic of this speciﬁc device, but
further investigations involving the other SPARC4 cameras are needed to conﬁrm this statement.
For now, this noise was taken into account, and it decreases, in some cases, the real value of the
SNR. However, the OMASS4 operation does not depend on the SNR proﬁle, and it still manages
to ﬁnd the optimum operation mode, as presented in Section 6.1.2.

Table 2 Read noise values obtained for the characterization of the conventional mode of the EMCCD. Column Error
presents the standard deviation of the read noise measurements in electrons. The read noise values without error were
obtained from the camera datasheet29

PA Binning RN Error
(e-)

.

HSS
(MHz)
1
1
1
1
0.1
0.1
0.1
0.1

1
1
2
2
1
1
2
2

1
2
1
2
1
2
1
2

(e-)
6.67
6.94
4.76
4.79
8.78
8.84
3.46
3.27

0.22

0.93

0.22

0.93

4.1.2 Acquisition Rate characterization

A characterization of the AR for every mode allowed by the SPARC4 for parameters texp, HSS,
Bin, and SI was performed. For each mode, the AR was calculated as a function of the texp. For
each texp value, measurements were made by acquiring a cube with 10 images. Thus, the AR was
calculated by dividing the number of images by the time taken to acquire the cube. Measurements
were repeated three times and the AR represents the mean value. Figure 3 presents, as an example,
the result obtained for the mode HSS = 1 MHz, Bin = 1 pixel, for all SI values. According to Fig.
3, it is possible to notice two regimes for the AR: a linear regime and a decaying regime. This
occurs because of the frame transfer option of the CCD, in which an image is read in parallel with
the acquisition of the next image.4 Linear regime occurs for texp values smaller than the critical
time tc for that mode. The decaying regime occurs for texp values larger than the tc, where the
AR is given by the inverse of texp. tc is composed of the image readout time plus internal delays.
The inﬂection points presented in Fig. 3 provide an estimate of the tc. Thus, a linear and a 1/texp
function ﬁt were performed for each of the two regimes, and tc was obtained at the intersection of
these two. This procedure was repeated for every mode of the SPARC4, and the result is presented
in Table 3.

8

Fig 2 Read noise of the CCD as a function of the EM gain. In panels, it is presented the results obtained for the
Horizontal Shift Speed modes 1 MHz (blue), 10 MHz (red), 20 MHz (green), and 30 MHz (black). The used values
for pre-ampliﬁcation (PA) and binning (Bin) for each panel are (a) PA = 1, Bin = 1 pixel; (b) PA = 1, Bin = 2 pixel; (c)
PA = 2, Bin = 1 pixel; (d) PA = 2, Bin = 2 pixels

.

Fig 3 Acquisition rate as a function of the exposure time for the mode Horizontal Shift Speed of 1 MHz and Binning
of 1 pixel. The colour code of curves are: Sub-images 256x256 pixels (green), 512x512 pixels (red), and 1024x1024
pixels (blue)

.

9

Table 3 Critical time values tc of the CCD, for each operation mode given by the Horizontal Shift Speed (HSS),
Sub-image (SI) and Binning parameters.

HSS
(MHz)
30
20
30
30
20
20
10
30
30
10
20
10
20
30
10
10
20
10
1
1
1
1
1
1
0.1
0.1
0.1
0.1
0.1
0.1

SI
(pixels)
x256
x256
x256
x512
x256
x512
x256
x512
x1024
x256
x512
x512
x1024
x1024
x512
x1024
x1024
x1024
x256
x256
x512
x1024
x512
x1024
x256
x512
x256
x1024
x512
x1024

Binning
(pixels)
2
2
1
2
1
2
2
1
2
1
1
2
2
1
1
2
1
1
2
1
2
2
1
1
2
2
1
2
1
1

tc
(s)
0.0059
0.0083
0.011
0.011
0.015
0.015
0.015
0.020
0.020
0.029
0.029
0.029
0.029
0.039
0.057
0.057
0.057
0.11
0.14
0.28
0.28
0.56
0.56
1.11
1.24
2.14
2.79
2.97
5.53
10.93

5 Optimization Method for the EMCCDs of the Acquisition System of SPARC4

An algorithm was developed using the Python Language 3.7.4 to determine the optimum operation
mode of the SPARC4 CCDs. This algorithm was structured into three parts: the initialization, the
star ﬂux calculation, and the CCD optimization. For the initialization step, it requires to provide to
the software all the information related to the astronomical object, i.e.: an image of the object, its
x, y coordinates, the maximum star radius, a bias image with the respective used CCD operation
mode, the SNR, the AR, allowed SI and Bin modes, CCD temperature, and the iterations number
of the Bayes optimization method. Then, the star ﬂux is calculated for the optimal star radius
given by the FWHM parameter, as described in Sec. 3. The OMASS4 uses a set of packages to

10

calculate the SNR and the AR values according to the CCD operation mode. The code developed
to execute the Bayes optimization method is based on the library provided by Ref. 30. The TPE
algorithm was used to model the objective function of the Bayes optimization method. The SNR
package operation is based on the methodology presented in Sec. 3. The star ﬂux, sky ﬂux, and the
number of star pixels are obtained in the previous step. The DC noise is calculated according to
the model presented by Ref. 21 for the four SPARC4 cameras. The read noise is obtained through
the characterization presented in Sec. 4.1.1. For conventional modes, the values in Table 2 were
used. For EM modes, an interpolation of the data presented in Fig. 2 was made. The G value was
obtained from the camera datasheet.29

The performance of the EM mode is better than the conventional mode until a maximum value
of 100 photons per pixel.22 So, the texp of each EM mode is limited to accomplish this requirement.
Also, the maximum value allowed for the Gem is 300x. Values larger than 300x would deteriorate
the device.26 Furthermore, the Gem must be such that the CCD will not saturate. For this reason,
the maximum EM gain allowed was arbitrarily conﬁgured to provide a signal up to 80 % of the
pixel well depth. For an image with 16 bits per pixel, this value is 216 × 0.8 ≈ 52429 ADU. Given
that a pixel value is composed by the star, sky and, dark current signals, and the bias level, the
maximum value for the Gem is

Gem =

(52429 − B) × G
(S/np + Ssky + Sdc)

.

(19)

The AR package operation is based on the characterization presented in Sec. 4.1.2. For each
mode, the AR value is calculated using linear interpolation if texp < tc, and 1/texp, if texp ≥ tc.
The value of tc is given in Table 3.

Therefore, the OMASS4 was implemented using the aforementioned packages, being applied
for three different optimization modes: optimize SNR (mode 1), optimize AR (mode 2), and opti-
mize both SNR and AR (mode 3).

Mode 1: in this mode, the SNR is optimized, keeping the AR ﬁxed. First, it is selected those
modes that meet the AR requirement. Then, it is calculated the SNR value for each selected
mode, using the maximum values for the texp and Gem. The optimum mode is given by that
one with the highest SNR.

Mode 2: in this mode, the AR is optimized, keeping the SNR ﬁxed. Initially, for each mode, it is
calculated the minimum texp value that meet the SNR requirement, for the maximum Gem
allowed. For this calculation, it is considered the values s = S/texp, in photons/s of the star;
the ssky = Ssky/texp, in photons/pixel/s of the sky; and the sdc = Sdc/texp, in e-/pixel/s of
the DC. So, the Eq. 17 can be rewritten as follows

S =

{s texp N 2

F + np[ (ssky + sdc) texp N 2

F + (σADU G/Gem)2] }1/2 .

s × texp

Rearranging the terms of the Eq. 20 and isolating texp,

s2 t2

exp − S 2 N 2

F [ s + np(ssky + sdc)] texp − S 2 np (σADU G/Gem)2 = 0

11

(20)

(21)

The minimum texp of Eq. 21 is given by its smallest non-negative root. Therefore, the
optimum mode is given through the calculation of the AR of the selected modes for the
minimum texp.

Mode 3: in this mode, both SNR and AR are optimized. Initially, it is selected those modes which
meet the SNR and AR at the same time. The resulting list of modes is used to create the
space of states of the Bayes optimization method. Then, it is calculated the maximum values
S M and AM and the minimum values S m and Am of the SNR and AR respectively. They are
used in normalization of both parameters into the range between 0 and 1. So, the function
to be optimized is given by the multiplication of the normalized SNR and AR A values for
each operation mode:

f =

S − S m
S M − S m ×

A − Am
AM − Am .

(22)

Therefore, the optimum mode for the CCD will be given by the set of parameters obtained
through the Bayes optimization method that maximizes the function given by Eq. 22.

5.1 Artiﬁcial images simulator

An artiﬁcial image simulator was developed to perform the evaluation of the OMASS4. This
simulator reproduces a star image that would be acquired by a CCD camera. It uses a Gaussian
2D, implemented in Python Language by the Astropy library,31 as the star point spread function:

fp(X , Y) = Ce−a(X −X0)2 − b(X −X0)×(Y−Y0) − c(Y−Y0)2,

where

a =

cos(Θ)2
2δ2
x

b =

sin(2Θ)2
2δ2
x

c =

sin(Θ)2
2δ2
x

+

−

+

sin(Θ)2
2δ2
y

,

sin(2Θ)2
2δ2
y

,

cos(Θ)2
2δ2
y

.

(23)

(24)

(25)

(26)

fp(X , Y) is the star intensity in ADU, C represents the maximum amplitude in ADU, X and Y are
the coordinates over the image in pixels, X0 and Y0 are the star coordinates in pixels, δx and δy are
the standard deviation of the Gaussian in the directions X and Y, respectively; Θ is the rotation
angle of the Gaussian.

The images created by the simulator have 200 x 200 pixels, the center coordinates of the star
was ﬁxed in (X0, Y0) = (100, 100) pixels; it uses values δx = δy = 3/Bin pixels, and Θ = 0. The
maximum amplitude C for each mode is calculated using

C =

β × texp × Gem × B2
in
G

,

(27)

12

where β simulates a constant photon ﬂux over the CCD, and Bin is the pixels binning parameter. It
uses β = 2000 photons/s. Over this image, another image was added with a background level Lb,
in ADU, and a Gaussian noise Nb, in ADU/pixel. The Lb is calculated by

Nb is calculated by

Lb = B + (Sdc + Ssky) × Gem × B2

in/G.

(cid:113)

Nb =

(Ssky + Sdc) × (NF Gem Bin)2/G + σ2

ADU.

(28)

(29)

The values Sdc, Gem, σADU, Bin, and G are obtained as a function of the operation mode of the
CCD; the B value is obtained through a bias image; an arbitrary value for the ssky of 12.3 pho-
tons/pixel/s was used.

6 Results

In order to facilitate the representation of the CCD operation modes, a codiﬁcation for the pa-
rameters controlled by the OMASS4 was developed. This codiﬁcation is presented in Table 4.
Therefore, an operation mode can be represented by a sequence of 5 digits, organized in the same
sequence as the parameters presented in Table 4. Thus, sequence 11111, for example, corresponds
to the operation mode conventional, HSS = 0.1 MHz, PA = 1, Bin = 1 pixel, and SI = 256 x 256
pixels. However, to represent the operation modes of the images created through the simulator, a
sequence with 4 digits was used. The last digit for the SI parameter was omitted, given that these
images have a ﬁxed size of 200 x 200 pixels.

Table 4 Codiﬁcation used to represent the operation mode of the CCDs.

Parameter

Unit

EM Mode
HSS
PA
Bin
SI

(MHz)

(pixels)
(pixels)

1

2

Conv EM
0.1
1
1
256

1
2
2
512

Code
3

4

5

6

3

10

20

30

1024

6.1 Testing the OMASS4

The tests presented in this section aim to evaluate the convergence of the OMASS4 to the op-
timum operation mode, the validity of the mode obtained, and the performance of the optimum
mode concerning a mean performance of the objective function. These tests were executed for the
optimization modes 1, 2, and 3. In addition, the accuracy of the SNR calculation was evaluated.

13

6.1.1 Convergence

This test aims to evaluate if the OMASS4 converges to the same optimum operation mode for a
series of images acquired with different operation mode for a constant light source. This series of
images was generated using the simulator presented in Sec. 5.1. For each image, the OMASS4 was
run using the minimum values for the AR, and SNR of 2 fps and 100, respectively. 170 iterations
were used in the Bayes optimization method execution and a maximum value for the star radius
of 20 pixels. Table 5 presents the values for the optimization of the SNR, AR, and SNR × AR, as
well as, the modes used to generate each image. For each optimization mode, the operation mode
of the CCD was the same for the entire series. Table 6 presents the optimum operation modes
obtained for each optimization mode, as well as, the mean value of the objective function for the
results presented in Table 5. So, it was possible to demonstrate that the OMASS4 converges to
the same optimum mode for an image series acquired with different operation modes, but for a
constant light source.

Table 5 Optimum values obtained by the optimization of the SNR, AR and SNR × AR for a series of images generated
with different operation modes.

Operation Mode

1111
1211
1211
1211
1212
1221
2211
2211
2211
2211
2211
2411
2511
2611

texp Gem
(s)
20
15
20
30
20
20
20
20
20
20
20
20
20
20

1
1
1
1
1
1
2
5
10
15
20
2
2
2

SNR AR SNR × AR

(fps)
6.77
6.77
6.78
6.77
6.76
6.77
6.78
6.77
6.77
6.77
6.78
6.77
6.76
6.78

207.7
207.6
207.7
207.6
207.5
207.6
207.9
207.6
207.6
207.6
207.8
207.6
207.5
207.8

0.15
0.15
0.15
0.15
0.15
0.15
0.15
0.15
0.15
0.15
0.15
0.15
0.15
0.15

Table 6 Optimum operation modes obtained through the execution of the OMASS4 for a series of images generated
with different operation modes, for each optimization mode. The ﬁfth column contains the mean values obtained for
the objective function calculated using the values presented in Table 5
texp
Optimization Mode Operation Mode
(s)
0.5
0.1477 ± 1e-4
0.1481 ± 1e-4

Objective
Function
207.64 ± 0.07
6.771 ± 4e-3
0.15241 ± 4e-5

12222
12221
12221

Gem

1
1
1

1
2
3

.

14

6.1.2 Validation of the optimum mode

This test aims to evaluate if the operation mode returned by the OMASS4 corresponds to the global
maximum. For this reason, an image was generated using the simulator with the operation mode
2211, texp = 1 s, and Gem = 20. The OMASS4 was run on this image. The values for the AR and
the SNR of 2 fps and 100 were respectively used. Again, 170 iterations were used in the BOM
execution and a maximum value for the star radius of 20 pixels. Table 7 presents the optimum mode
obtained for each optimization mode. For the validation of the optimization mode 1, an image was
generated with the optimum mode. The SNR calculated for this image is 208. Then, a series of
images was generated with all operating modes that meet the AR requirement, for the maximum
values of texp and Gem. For each image, the SNR value was calculated. For the validation of the
optimization mode 2, the AR was calculated for all modes that meet the SNR requirement, for the
minimum texp value. For the validation of the optimization mode 3, the objective function was
evaluated for 500 iterations for all modes that meet both SNR and AR requirements, for random
values of texp and Gem. Tables 8 to 10 presents the 10 best values for the objective function for the
optimization mode 1, 2, and 3, respectively. None of the presented modes achieved a better result
than its respective optimum mode. For the optimization mode 2, 3 modes were obtained with the
same AR. In this case, the OMASS4 selected the one with the larger SI. Figure 4 presents the SNR
× AR values obtained as a function of the texp, Gem and HSS over the Bayes optimization method
iterations. Examining this ﬁgure, it is possible to see a maximum point for the HSS = 1 MHz.
However, it should be highlighted that the proﬁle of the SNR × AR function varies as a function
of the scientiﬁc requirements for SNR and AR. Therefore, there may be some cases where the
optimum point would not be so deﬁned as presented in Figure 4.

Table 7 Optimum modes of the CCD obtained through the execution of the OMASS4 over an image generated with
the operation mode 2211, for each optimization mode.

Optimization Mode Operation Mode

1
2
3

12211
12221
12221

texp Gem Objective function
(s)
0.50
0.15
0.25

208
6.78
0.152

1
1
1

6.1.3 Optimization Performance

This test aims to evaluate the performance obtained by the optimum mode in comparison with a
mean performance of the objective function over the allowed operation modes of the CCD. Ini-
tially, a series of images was created with the operation mode 1211, varying the incident light ﬂux
from β = 2000 photons/s to β = 3000 photons/s with steps of β = 100 photons/s. The OMASS4
was run on each of the images. The used values for the AR and the SNR was 0.05 fps and 100,
respectively. 170 iterations were used for the Bayes optimization method and a maximum value
for the star radius of 20 pixels. The mean value of the objective function was calculated for 500
random iterations over the operation modes that meet the requirements of SNR and/or AR. Ta-
ble 11 presents the results obtained for this experiment. ROMASS4 is the maximum value of the
objective function obtained by running the OMASS4 over the images. ROF represents the mean
value of the objective function for 500 random iterations. Both ROMASS4 and ROF are presented

15

Table 8 10 best values obtained for the SNR for all operation modes that meet the AR requirement. The Gem and texp
values were ﬁxed in 300x (for the EM modes) and 0.5 s, respectively.

Operation Mode

12123
12213
12113
26123
24123
22113
24213
26223
25223
22123

texp Gem SNR
(s)
0.5
0.5
0.5
0.5
0.5
0.5
0.5
0.5
0.5
0.5

194
179
156
156
156
156
156
156
156
156

1
1
1
300
300
300
300
300
300
300

Table 9 10 best values obtained to the AR for all operation modes that meet the SNR requirement.

Operation Mode

12121
24221
24223
24222
25222
25223
25221
22221
22121
24213

texp Gem AR
(s)
0.18
0.20
0.20
0.20
0.20
0.20
0.20
0.20
0.20
0.20

5.56
4.91
4.91
4.91
4.91
4.91
4.91
4.91
4.91
4.91

1
300
300
300
300
300
300
300
300
300

Table 10 10 best values for the SNR × AR obtained for all modes that meet both SNR and AR requirement. Note
results were obtained after 500 iterations. Random values were selected for Gem and texp.

Operation Mode

12221
12222
12221
12222
12221
12222
12121
12122
12221
12121

texp Gem SNR × AR
(s)
0.23
0.30
0.30
0.26
0.34
0.34
0.29
0.29
0.19
0.32

0.145
0.141
0.141
0.130
0.120
0.120
0.109
0.109
0.106
0.104

1
1
1
1
1
1
1
1
1
1

16

Fig 4 Optimization of the SNR × AR as a function of the texp and the Gem, over the Bayes optimization method
iterations. Modes HSS 1 MHz (purple), 10 MHz (green), 20 MHz (red), and 30 MHz (blue) are shown

.

for the three optimization modes. Also, tabulated is the relative percentage difference R, where
R = (ROMASS4/ROF − 1) × 100. Using these results, it is possible to conclude that the perfor-
mance obtained through the OMASS4 was better than the performance for a mean value of the
objective function. This result presents the usefulness of the OMASS4 for an observer with no
knowledge about the CCDs operation. The best results obtained for the optimization modes 1, 2,
and 3 were R = 265 %, R = 428 %, and R = 165 %, respectively.

Table 11 Objective function values obtained for a series of images with different incident light ﬂux, for each optimiza-
tion mode. The results ROMASS4 obtained by running the OMASS4 over the images
and the mean value of the objective function ROF for 500 iterations, over the allowed operation
modes, are presented. Additionally shown is the the relative percentage difference R, in %, where
R = (ROMASS4/ROF − 1) × 100.
AR (fps)

SNR × AR

SNR

β
(f/s) ROMASS4 ROF
402
1395
2000
416
1434
2100
433
1472
2200
435
1509
2300
442
1546
2400
464
1582
2500
472
1616
2600
470
1651
2700
461
1684
2800
489
1717
2900
503
1749
3000

R
(%) ROMASS4 ROF
1.3
6.8
247
1.3
6.8
245
1.4
6.9
240
1.4
7.1
247
1.5
7.1
250
1.4
7.1
241
1.6
7.2
242
1.7
7.2
251
1.7
7.2
265
1.7
7.4
251
1.7
7.7
248

R
(%) ROMASS4 ROF
0.01
0.024
417
0.01
0.025
429
0.01
0.025
385
0.01
0.025
396
0.01
0.025
390
0.01
0.026
402
0.01
0.026
361
0.01
0.027
322
0.01
0.027
336
0.01
0.027
336
0.01
0.027
353

R
(%)
140
150
150
150
150
160
160
170
145
145
170

17

6.1.4 SNR calculation

This test aims to evaluate the accuracy of the SNR calculated by the OMASS4 for an image of the
object. Initially, the theoretical value was calculated for an image series created using the simulator.
For each image, the radius and the number of the pixels of the star were calculated, according to
the FWHM of the star, as presented in Sec. 3. The signal S of the star was obtained by the sum
of the pixels with coordinates (x,y) within the star radius, given by the Eq. 23. The values of Sdc,
σADU, G, Gem, and Bin were obtained using the operation mode of the CCD. The same values for
the ssky presented in Sec. 5.1 were used. Table 12 presents the used operation mode of the image
series, the calculated value of the SNR by the OMASS4, and the theoretical value of the SNR.
Thus, it is possible to conclude that the model used to calculate the SNR can represent the SNR
value that would be obtained by acquiring an image of a star for different conﬁgurations of the
CCD. The greatest difference between the theoretical and the calculated values was 1.05 %.

Table 12 Comparation between the SNR values calculated (Calc) by the OMASS4 and the theoretical (Theor) for a
series of images with different operation modes. Presented are the operation mode of each image, the obtained SNR
values and the difference between them.
Operation Mode

SNR

texp Gem
(s)
20
20
20
20
1
1
1
1
1
1
1
1

1
1
1
1
20
20
20
20
25
20
20
20

Calc
1377.6
1389.7
1386.3
1392.8
220.2
220.6
221.6
221.3
221.1
210.5
187.1
147.0

Theor
1378.0
1393.9
1385.3
1394.5
219.8
221.0
220.7
221.2
221.2
210.2
188.0
148.6

Difference
(%)
0.03
0.30
-0.08
0.12
-0.18
0.17
-0.38
-0.05
0.07
-0.16
0.50
1.04

1211
1212
1221
1222
2211
2212
2221
2222
2222
2411
2511
2611

6.2 Optimization of the observation nights

This section presents the use of the OMASS4 introduced in this paper to optimize the performance
of the CCDs in public data from observations obtained at the Observat´orio Pico dos Dias. The data
from nights between April 2017 and April 2018 were analyzed. More recent observations could not
be used due to the proprietary time of 2 years.32 The selected nights were those with observations of
photometric time series of point-like sources carried out on the 1.6 m Perkin-Elmer telescope, and
with the use of an iXon EMCCD. Nights which observed extended objects like clusters, nebulae,
and galaxies were excluded. Table 13 presents the information for all selected nights. For all data
sets, the astronomical objects were matched from their information in SIMBAD.33 The duration
of the time series for each night was obtained using the time interval between the ﬁrst image and
the last image of the series. The sum of the duration of all time series is 49 hours and 41 minutes.
It is known that the scientiﬁc subject in the night of 03-06-2017 was stellar occultations. As we

18

do not know what star in the ﬁeld of view was the target, we just selected the brightest one to be
optimized. The values of the SNR presented in Table 13 represent the mean calculated for the 10
highest values found in the series. The AR for each night was calculated by the duration of the
time series divided by the number of exposures.

For each night, the OMASS4 was run for each optimization mode. The SNR and AR values
presented in Table 13 were used. The SI and Bin were set to the same values as the ones used
by the observer. 170 iterations for the Bayes optimization method were used. Tables 14 to 16
present the results obtained for the optimization of the SNR, AR and SNR × AR, Tables 14 and
15 present the the relative percentage difference R between the value of the objective function and
the respective value obtained by the observer. Table 16 presents both the SNR and AR obtained
by the OMASS4 and their respective relative percentage differences, RSNR and RAR, compared to
the observer’s values. The AR values presented in Tables 15 and Table 16 take into account the
overhead time between image cubes of the acquisition system presented in Sec. 4. This overhead
time is 980 ms for each cube with 70 images. This overhead was added to the observation time
needed to acquire each image series with the optimum AR. The ARs correspond to the total time
calculated divided by the number of images in the series.

Table 13 Information related to the selected observation nights performed at the Observat´orio Picos dos Dias for the
execution of the OMASS4. Tabulated are the date of the observation, the used operation mode, the type of observed
object (TOO), the number of exposes in the series Ne, the mean SNR, the AR and the observation time. The following
abbreviation for the objects are used: EB = eclipsing binary, WD = white dwarf, ST = star, and EX = exoplanet. The
type of objected was found using the astronomical data bank SIMBAD.33

SNR

Night1 Operation Mode
(d-m-y)
22-03-17
23-03-17
24-03-17
14-04-17
15-04-17
16-04-17
03-06-17
02-07-17
13-07-17
08-08-17
24-11-17
06-03-18
1 The dates presented in this table are formatted in the same format used by the observatory, and
they correspond to the start of the observation night.

texp Gem TOO Ne
(s)
3
2
2
40
20
41
100
45
30
10
15
180

1234
EB
1
1692
EB
1
1
1319
EB
1 WD 134
1 WD 414
1 WD 341
20
ST
1
221
ST
1
EX
1
811
EX 1150
1
209
1
ST
63
1 WD

52.6 ± 1.3
34.6 ± 0.6
35.6 ± 1.5
49.9 ± 1.7
67.8 ± 2.6
94.5 ± 3.4
3964.4 ± 53.6
110.6 ± 8.9
1257.6 ± 1.6
1097.0 ± 2.5
88.8 ± 4.3
63.8 ± 4.1

Duration
(h)
4.5
5.1
3.3
2.7
6.2
5.0
0.6
3.0
7.1
6.0
1.0
5.0

AR
(fps)
0.076
0.091
0.11
0.014
0.019
0.019
0.01
0.02
0.032
0.053
0.056
0.0035

12213
12213
12213
11223
11223
22123
22113
22123
12113
12113
13123
22123

Based on these results, it is possible to conclude that we were able to obtain the optimum mode
of the CCDs, according to the scientiﬁc requirements of SNR and AR, for each night, for each
optimization mode. For the optimization of the SNR, it was possible to obtain an improvement
of up to 207.3 % in the SNR. In many cases, the exposure times given by the OMASS4 were
longer than those set by the observer. This occurs because the overhead time between image

19

Table 14 Operation modes of the CCDs obtained through the SNR optimization of the observation nights at the
Observat´orio Picos dos Dias. Tabulated is the SNR obtained by the OMASS4 and its relative percentage difference R
with respect to the SNR of the operation mode used by the observer.

Night
(d-m-y)
22-03-17
23-03-17
24-03-17
14-04-17
15-04-17
16-04-17
03-06-17
02-07-17
13-07-17
08-08-17
24-11-17
06-03-18

Operation Mode

12213
11213
12213
11223
11223
11223
11213
11223
11213
11213
11223
11223

texp Gem
(s)
13
11
9
73
54
53
104
49
31
19
18
283

1
1
1
1
1
1
1
1
1
1
1
1

SNR

131.6
106.3
96.4
102.1
168.3
196.0
7073.2
165.8
1297.0
2189.7
139.1
114.6

R
(%)
145.3
207.3
170.9
104.5
148.4
107.5
78.4
49.9
3.1
99.6
56.8
79.5

Operation Mode

Table 15 Optimum operation modes of the CCDs obtained through the AR optimization of the observation nights at
the Observat´orio Picos dos Dias. Tabulated is the AR value calculated by the OMASS4 and its relative percentage
difference R with respect to the AR obtained by the observer.
Nights
(d-m-y)
22-03-17
23-03-17
24-03-17
14-04-17
15-04-17
16-04-17
03-06-17
02-07-17
13-07-17
08-08-17
24-11-17
06-03-18

texp Gem AR
(fps)
(s)
0.3
3
0.5
2
0.5
2
0.1
17
0.1
9
0.1
13
0.03
33
0.04
22
0.03
29
0.2
5
0.1
8
0.01
88

R
(%)
324.1
419.7
361.7
316.1
513.1
318.1
217.8
124.3
6.3
295.3
133.8
222.0

12213
12213
24213
11223
11223
11223
11213
11223
11213
11213
11223
11223

1
1
300
1
1
1
1
1
1
1
1
1

cubes given by the acquisition system allows the use of a greater texp, keeping the same AR of
the observations. In this analysis, it was possible to observe different operation modes used by the
observer, in contrast with the same operation mode returned by the OMASS4. This shows how the
observers have different criteria in choosing the operation mode of the CCD. It was noticed that
in some cases the EM mode is used without setting a Gem ampliﬁcation greater than one. This
results in a noisier performance of the CCD without the advantage of signal ampliﬁcation given
by the EM mode. Also, it was noticed some cases where it would be possible to use an HSS with
a greater readout time (therefore, with a smaller read noise) without reducing the AR. For the AR
optimization, an improvement in the AR was obtained of up to 513.1 % for one of the cases. It

20

Table 16 Operation modes of the CCDs obtained through the SNR × AR optimization of the observation nights at
the Observat´orio Picos dos Dias. Tabulated are the SNR and AR values calculated by the OMASS4 and their relative
percentage difference RSNR, and RAR with respect to the values obtained by the observer.

Night
(d-m-y)
22-03-17
23-03-17
24-03-17
14-04-17
15-04-17
16-04-17
03-06-17
02-07-17
13-07-17
08-08-17
24-11-17
06-03-18

Operation Mode

12213
12213
12213
11223
11223
11223
11213
12223
11213
11213
11223
12123

texp Gem
(s)
6
4
2
33
19
24
55
31
30
9
11
150

1
1
267
1
1
1
1
1
1
1
1
1

SNR

79.6
57.7
57.4
68.7
100.1
131.1
5168.7
133.8
1277.0
1498.4
109.7
83.47

RSNR
(%)
48.3
66.9
61.3
37.6
47.8
38.8
30.4
20.9
1.5
36.6
23.6
30.8

AR
(fps)
0.17
0.23
0.25
0.03
52.0
42.0
18.0
31.0
33.0
0.11
88.0
0.007

RAR
(%)
124.3
152.2
123.7
120.6
181.9
121.0
87.1
53.5
3.1
112.7
57.5
88.4

was noticed that several optimum modes given by the OMASS4 results in a smaller HSS, despite
having a higher AR. This occurs because the use of higher HSSs results in higher read noises. A
greater texp is needed to achieve the same SNR given by the OMASS4. A suggestion in using the
cameras is to consider the use of a Bin = 2 pixels whenever possible. This option improves both
the SNR and the AR, allowing the use of HSSs with larger readout times. For the optimization of
the SNR and the AR, it was possible to improve both parameters for each night. In this result, an
improvement was obtained of up to 66.9 % for the SNR and up to 181.9 % for the AR,

6.2.1 Telescope time saving

The amount of telescope time that would be saved was analyzed using the optimum mode sug-
gested by the OMASS4 for each night presented in Sec. 6.2.
It is important to note that this
analysis assumes that observation times can be reduced indeﬁnitely, which is probably not true in
case of studies of stellar variability.

This analysis was divided into the improvement obtained in the SNR and the AR. For the SNR
case, it was calculated the texp needed for a CCD with the observer’s operation mode achieves the
same SNR obtained by the optimum mode. The texp value was calculated using the Eq. 21. The
values adopted for the star and sky ﬂuxes are those to match the SNR presented in Table 13. Thus,
the time saving was calculated by the difference between the texp of both cases, multiplied by the
number of exposures in the series. The calculation of the time saving for the AR can be done more
directly. The operation mode given by the OMASS4 is the one with the best AR and the same
SNR. So, the time saving can be calculated from the difference between the texp of these cases,
multiplied by the number of exposures. Table 17 presents the results obtained for this analysis. The
texp in optimization mode 1 and 3 represents the time needed for the observer’s operation mode to
achieve the SNR of the optimum mode. The time saved in optimization mode 3 is given by the sum
of the texp needed for the observer’s mode to achieve the SNR of the optimum mode with the time
saving related to the AR difference. At the bottom of the Table 17, it is presented the percentage

21

of the total time that would be saved if the OMASS4 was used as a tool to determine the optimum
operation mode of the CCDs. Figure 5 depicts the values, the telescope time saved, presented in
Table 17.

Table 17 Telescope time saving (TTS) analysis obtained from the optimum mode suggested by the OMASS4 in
comparison with the observer’s mode. Presented are the texp for the optimization modes 1 and 3 needed for one image
acquired with the observer’s mode which meet the same SNR obtained by the optimum mode. The time saving of the
optimization mode 3 represents the sum of the time saved with the improvement of both the AR and the SNR. At the
bottom of the table are presented the percentage of the total time that would be saved if the OMASS4 was used as a
tool to determine the optimum operation mode of the CCDs.

TTS
Night
(%)
(d-m-y)
81.3
22-03-17
86.9
23-03-17
24-03-17
75.8
14-04-17 150.5 152.6
15-04-17 110.2 166.8
16-04-17 128.2 164.8
03-06-17 251.4 145.4
109.4
02-07-17
6.0
13-07-17
47.3
08-08-17
24-11-17
68.2
06-03-18 564.6 134.6
97.2

Opt. Mode 1 Opt. Mode 2 Opt. Mode 3
texp
texp
TTS
TTS
(%)
(%)
(s)
(s)
76.2
76.4
13.8
5.8
80.3
80.8
11.5
4.2
76.3
78.3
8.9
3.9
71.4
75.8
97.9
40.8 103.1
83.8
67.1 104.2
76.1
150.5 95.1
69.0
74.9
64.6
55.7
6.0
30.9
6.2
96.3
18.2
74.7
19.4
57.2
61.1
300.4 89.9
68.2
77.7
65.1

98.6
31.9
18.9
27.3

Total

Fig 5 Telescope time saving values presented in Table 17. Each triplet in the graph presents the value obtained for the
optimization modes SNR (blue), AR (orange), and SNR x AR (green), respectively.

22

For the optimization mode 1, it would be needed 97.2 % more time, i.e. 48.8 h, to obtain the
same SNR for all nights keeping the same observer’s operation mode. The use of this optimization
mode would improve the data quality obtained by the observers for each night. For the optimization
mode 2, the time saving would be 65.1 % (32.3 h), if the mode with the best AR was used keeping
the same SNR. The use of this optimization mode would allow the observer to acquire the same
number of exposures, for smaller observation time. This fact would allow a higher number of
projects to be allocated at the Observat´orio Picos dos Dias. For optimization mode 3, the time
saving would be 77.7 % (38.6 h) if both parameters were optimized at the same time. So, image
acquisition would be done with better quality, in a smaller time.

6.2.2 Maximum Acquisition Rates provided by the SPARC4

In this section, it is presented an estimate of the maximum ARs that the EMCCDs of the SPARC4
will provide considering stars with different magnitudes. This analyses helps understanding the
possible scientiﬁc applications with the SPARC4, based on the limitations of acquisitions rates
as a function of stellar magnitude. For each magnitude, the photon ﬂux of the star was obtained
through the Pogson Equation34

m − mh = −2.5log

S
Sh

.

(30)

m and S represents the magnitude and the photon ﬂux of the observed star. For this experiment,
reference values of mh = 12.2533 and Sh = 56122.30 photon/s were used. These are the magnitude
and the star ﬂux obtained for an arbitrarily selected image of the star HATS2435 in the I-ﬁlter,
acquired using the 1.6 m telescope of the Observat´orio Pico dos Dias. In our analysis, magni-
tude values ranging from 5 to 20 were considered. Thus, the maximum ARs were obtained by
executing the OMASS4 for each magnitude, for the SNR values of 1, 10, 100, and 1000. The
OMASS4 execution was divided into two groups of operation modes: (1) SI = (256, 512) pixels
and Bin = 2 pixels; and (2) SI = 1024 pixels and Bin = 1 pixel. Figure 6 presents the result ob-
tained for this analysis. Solid lines represent the maximum values for the AR obtained for group
1; dashed lines represent the maximum values obtained for group 2. It can be seen a region with an
AR of 189 fps, which is the highest AR allowed by the SPARC4 acquisition system. For the same
value of SNR, there is a magnitude from which the AR of group 1 equals to the AR of group 2.
At this point, it is indifferent to use modes with a smaller spatial resolution to achieve higher ARs.
This happens when the texp required to maintain the SNR constant is larger than the readout time of
a full-frame image. However, it should be highlighted that this result was done using the star mag-
nitude in the ﬁlter I. Although, it is still advised to use an image of the object previously acquired
(pre-image) to obtain the real performance of the CCD for the observed object in the observed
band pass.

7 Conclusion

We have presented the OMASS4 to optimize the parameters of an EMCCD to obtain the highest
possible SNR and/or the fastest possible acquisition rate in astronomical observations. Our method
is based on an empirical characterization of the CCD read noise and of the acquisition rate using
a custom control system designed for the SPARC4 instrument. We applied the OMASS4 for the
optimization of selected real observation nights, where we obtained an improved performance

23

Fig 6 Acquisition rate of the CCD as a function of the star magnitude. Presented are the curves obtained for SNR 1
(blue), 10 (red), 100 (green), and 1000 (black). Solid lines represent the maximum values obtained for the acquisi-
tion rate for the operation modes SI = (256, 512) pixels and Bin = 2 pixels; dashed lines represented the maximum
acquisition rate for the mode SI = 1024 pixels and Bin = 1 pixel.

compared to that obtained with the operation mode selected by the observers. For the optimization
modes 1 and 2, it was possible to obtain an improvement of up to 207.3 %, and 513.1 % for the
SNR and AR, respectively. For the optimization mode 3, it was possible to obtain an improvement
up to 66.9 % for the SNR, and up to 181.9 % for AR. We have also noticed that there would be a
signiﬁcant amount of telescope time saving if an optimization mode was used, with the assumption
that observation times can be reduced indeﬁnitely. For optimization mode 1, it was found that it
would require 97.2 % more time for the programs of the selected nights to achieve the same SNR
obtained by the OMASS4. For optimization mode 2, it would be possible to save 65.1 % of the
total observation time, keeping the same SNR and number of exposures. For optimization mode 3,
the optimization of both parameters would save 77.7 % of the total observation time.

Among the selected nights it was not found a case that requires high sensitivity (SNR > 100)
and high acquisition rates (AR > 10 Hz) at the same time. This would happen because of the
lack of projects that use the Observat´orio Pico dos Dias’s telescopes for this purpose. However,
the SPARC4 instrument was designed to allow not only for the scientiﬁc subjects of the selected
nights but also for other potential subjects involving the observation of objects that require high
sensitivity and high ARs.1 So, the use of the OMASS4 becomes even more important to help the
observer in these situations. This fact contributes to the use of the observatory in carrying out
research in subjects that was not possible until now.

In this project, the measurement of the characterization of the read noise and the AR was made
only for one of the SPARC4 cameras. Although, these measurements would be repeated to the
other SPARC4 cameras, as well as, for the iKon cameras of the observatory. Beyond the SI modes
allowed by the SPARC4, a possible improvement would be to allow continuous SI values over
the CCD chip. This change would allow optimizing the AR with a greater degree of freedom. A
possible application for the presented method would be to integrate it with the acquisition system
of the SPARC4. This implementation would allow the re-execution of the method during the
night as a method to readjust the performance of the cameras, according to the climatic variations.
Besides, the use of the OMASS4 is not restricted for the SPARC4 instrument. This method would
be of great advantage for other CCD based instrumentation, like microscopy, with the appropriated

24

adjust of the input parameters.

Acknowledgments

We want to acknowledge Janderson de Oliveira for providing us with the HATS-24 b data. We
also want to thank Fapesp (Proc. 2013/26258-4), CNPq (Proc. 303444/2018-5), Finep (Proc.
0/1/16/0076/00), FAPEMIG (Proc. APQ-00193-15), for their ﬁnancial support, and CAPES (Proc.
88882.430116/2019-01) for the internship funding. E.M. acknowledges funding from the French
National Research Agency (ANR) under contract number ANR-18-CE31-0019 (SPlaSH).

References

1 C. V. Rodrigues, F. J. Jablonski, K. Taylor, et al., “SPARC4 A simultaneous polarimeter and
rapid camera in 4 bands,” in American Institute of Physics Conference Series, J. L. Hoffman,
J. Bjorkman, and B. Whitney, Eds., American Institute of Physics Conference Series 1429,
252–255 (2012).

2 J. E. Gunn, M. Carr, C. Rockosi, et al., “The sloan digital sky survey photometric camera,”

The Astronomical Journal 116, 3040–3081 (1998).

3 Highland Technology, T560 DIGITAL DELAY GENERATOR, Technical Manual (2019).
4 Andor Technology, iXon Ultra 888 Hardware Guide, 1 ed. (2015).
5 P.-H. Wu, N. Nelson, and Y. Tseng, “A general method for improving spatial resolution by
optimization of electron multiplication in ccd imaging,” Optics express 18(5), 5199–5212
(2010).

6 I. Shim, J.-Y. Lee, and I. S. Kweon, “Auto-adjusting camera exposure for outdoor robotics us-
ing gradient information,” in 2014 IEEE/RSJ International Conference on Intelligent Robots
and Systems, 1011–1017, IEEE (2014).

7 G. Wang, “Active entropy camera,” Machine Vision and Applications 23(4), 713–723 (2012).
8 H. Lu, H. Zhang, S. Yang, et al., “Camera parameters auto-adjusting technique for robust
robot vision,” in 2010 IEEE International Conference on Robotics and Automation, 1518–
1523, IEEE (2010).

9 J. Kim, Y. Cho, and A. Kim, “Generic camera attribute control using bayesian optimization,”

arXiv preprint arXiv:1807.10596 (2018).

10 J. S. Bergstra, R. Bardenet, Y. Bengio, et al., “Algorithms for hyper-parameter optimization,”

in Advances in neural information processing systems, 2546–2554 (2011).

11 P. I. Frazier, “A tutorial on bayesian optimization,” arXiv preprint arXiv:1807.02811 (2018).
12 J. Berk, V. Nguyen, S. Gupta, et al., “Exploration enhanced expected improvement for
bayesian optimization,” in Machine Learning and Knowledge Discovery in Databases,
M. Berlingerio, F. Bonchi, T. G¨artner, et al., Eds., 621–637, Springer International Pub-
lishing, (Cham) (2019).

13 E. Brochu, M. W. Hoffman, and N. de Freitas, “Portfolio allocation for bayesian optimiza-

tion,” arXiv preprint arXiv:1009.5419 (2010).

14 E. Brochu, V. M. Cora, and N. De Freitas, “A tutorial on bayesian optimization of expen-
sive cost functions, with application to active user modeling and hierarchical reinforcement
learning,” arXiv preprint arXiv:1012.2599 (2010).

15 I. Dewancker, M. McCourt, and S. Clark, “Bayesian optimization primer,” (2015).

25

16 M. Kastner, N. Nellen, and C. Jahn, “Model-based optimisation with tree-structured parzen
estimation for discrete event simulation at container terminals: Modellbasierte optimierung
mit baumstrukturierter kerndichtesch¨atzung f¨ur ereignisdiskrete simulation auf container-
terminals,” in Simulation : In Produktion und Logistik, M. Putz and A. Schlegel, Eds., 489–
498, Wissenschaftliche Scripten, Auerbach /Vogtl., 1 ed. (2019).

17 P. Singh, “Bayesian optimization for machine learning.” Math 693 A - Project Report (2018).
18 N. Markevich and I. Gertner, “Comparison among methods for calculating fwhm,” Nuclear
Instruments and Methods in Physics Research Section A: Accelerators, Spectrometers, De-
tectors and Associated Equipment 283(1), 72 – 77 (1989).

19 E. Martioli, K. D. Col´on, D. Angerhausen, et al., “A survey of eight hot jupiters in secondary
eclipse using wircam at cfht,” Monthly Notices of the Royal Astronomical Society 474(3),
4264–4277 (2018).

20 W. Merline and S. Howell, “A realistic model for point-sources imaged on array detectors:

The model and initial results,” Experimental Astronomy 6, 163–210 (1995).

21 D. V. Bernardes, E. Martioli, and C. V. Rodrigues, “Characterization of the SPARC4 CCDs,”

Publications of the Astronomical Society of the Paciﬁc 130, 095002 (2018).
22 Andor Technology, Comparing EMCCD, ICCD and CCD Cameras (2020).
23 M. V. Newberry, “Signal-to-noise considerations for sky-subtracted CCD data,” Publications

of the Astronomical Society of the Paciﬁc 103, 122 (1991).

24 National Instruments, What Is LabVIEW? (2020).
25 Andor Technology, User’s Guide to Andor Technology SDK (2009).
26 Andor Technology, Software Guide, Andor’s camera control and analysis software platform

(2001).

27 C. V. Rodrigues, K. Taylor, F. J. Jablonski, et al., “Concept of SPARC4: a simultaneous
polarimeter and rapid camera in 4 bands,” in Ground-based and Airborne Instrumentation
for Astronomy IV, I. S. McLean, S. K. Ramsay, and H. Takami, Eds., 8446, 773 – 785,
International Society for Optics and Photonics, SPIE (2012).

28 J. B. de Carvalho, “Estudo dos componentes ´opticos do espectr´ografo coud´e do observat´orio
do pico dos dias e proposta para sua melhoria,” mathesis, Universidade Federal de Itajub´a
(2011).

29 Andor Technology, System Performance Booklet - iXon Ultra X-9916 performance sheet

(2014).

30 W. Koehrsen,

“Introduction:

Bayesian optimization using hyperopt.” https:

//github.com/WillKoehrsen/hyperparameter-optimization/blob/
master/Introduction%20to%20Bayesian%20Optimization%20with%
20Hyperopt.ipynb (2018).

31 A. M. Price-Whelan, B. M. Sip˝ocz, H. M. G¨unther, et al., “The astropy project: Building
an open-science project and status of the v2.0 core package,” The Astronomical Journal 156,
123 (2018).

32 A. Bruch, “O banco de dados observacionais do lna,” (2001).
33 M. Wenger, F. Ochsenbein, D. Egret, et al., “The simbad astronomical database,” Astronomy

and Astrophysics Supplement Series 143, 9–22 (2000).

26

34 S. O. F. Kepler and M. De Fatima Oliveira Saraiva, Astronomia e astroﬁsica, Ed. Universi-

dade/UFRGS (2000).

35 J. M. Oliveira, E. Martioli, and M. Tucci-Maia, “First observation of a planetary transit with
the SPARC4 CCD: Improved parameters for HATS-24b,” Research Notes of the AAS 3, 35
(2019).

8 Biographies

• Denis Varise Bernardes: graduated in Physics Engineering, Lorena School of Engineering
(EEL - USP) from 2012 to 2017. Master student at the Federal University of Itajub´a, from
2018 to 2020, with the project of the determination of the optimal modes of operation of
the SPARC4 acquisition system. Ph.D. student in the Astrophysics course of the National
Space Research Institute (INPE), with the project of the acquisition system of the SPARC4
instrument: acquisition software and image simulator.

• Eder Matioli: graduated in physics from the S˜ao Carlos Institute of Physics of the University
of S˜ao Paulo in 2003. He completed his master’s in 2006 and his Ph.D. in 2010 in astro-
physics from the National Institute for Space Research, partially hosted at the University of
Texas at Austin. He was a resident astronomer at the Canada-France-Hawaii Telescope from
2010 to 2013. Since 2013 he has been a Research Scientist at the Laborat´orio Nacional de
Astrof´ısica and is currently a visiting postdoctoral researcher at the Institut d’Astrophysique
de Paris. He has experience in optical and near-infrared astronomy, with an emphasis on
exoplanets, brown dwarfs, and low-mass binaries.

• Danilo Henrique Spadoti: graduated in Electrical Engineering from the University of Itajub´a
(2002). Completed the Masters (2004) and Ph.D. (2008) in Electrical Engineering, with a
major telecommunications at USP -University of S˜ao Paulo. In 2009, did postdoctoral stud-
ies abroad, in Nanophotonics Group’s, at Cornell University, Ithaca, USA. In 2010 receive
a FAPESP post-doctoral scholarship at Mackenzie University. He is currently an Associate
Professor in the area of telecommunications systems and applied electromagnetics at the
Federal University of Itajub´a-UNIFEI.

27

