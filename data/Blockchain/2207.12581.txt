2
2
0
2

l
u
J

6
2

]

N
G
.
n
o
c
e
[

1
v
1
8
5
2
1
.
7
0
2
2
:
v
i
X
r
a

TRADING UNDER THE PROOF-OF-STAKE PROTOCOL
– A CONTINUOUS-TIME CONTROL APPROACH

WENPIN TANG AND DAVID D. YAO

Abstract. We develop a continuous-time control approach to optimal trading in a Proof-
of-Stake (PoS) blockchain, formulated as a consumption-investment problem that aims to
strike the optimal balance between a participant’s (or agent’s) utility from holding/trading
stakes and utility from consumption. We present solutions via dynamic programming and
the Hamilton-Jacobi-Bellman (HJB) equations. When the utility functions are linear or
convex, we derive close-form solutions and show that the bang-bang strategy is optimal
(i.e., always buy or sell at full capacity). Furthermore, we bring out the explicit connection
between the rate of return in trading/holding stakes and the participant’s risk-adjusted
valuation of the stakes. In particular, we show when a participant is risk-neutral or risk-
seeking, corresponding to the risk-adjusted valuation being a martingale or a sub-martingale,
the optimal strategy must be to either buy all the time, sell all the time, or ﬁrst buy then sell,
and with both buying and selling executed at full capacity. We also propose a risk-control
version of the consumption-investment problem; and for a special case, the “stake-parity”
problem, we show a mean-reverting strategy is optimal.

Key words: Consumption-investment, Proof of Stake (PoS) protocol, cryptocurrency, dy-
namic programming, HJB equations, continuous-time control, risk control.

1. Introduction

As a digital exchange vehicle, blockchain technology has been successfully deployed in many
applications including cryptocurrency [17], healthcare [8], supply chain [7], electoral voting
[26], and non-fungible tokens [25]. A blockchain is a growing chain of accounting records,
called blocks, which are jointly maintained by participants of the system using cryptography.
Consider for instance Bitcoin – a peer to peer decentralized payment system. In contrast to
traditional payment processing networks, Bitcoin provides a permissionless environment in
which everyone is free to participate. At the core of Bitcoin is the consensus protocol known
as Proof of Work (PoW), in which “miners” compete with each other by solving a hashing
puzzle so as to validate an ever-growing log of transactions (the “longest chain”) to update
a distributed ledger; and the miner who solves the puzzle ﬁrst receives a reward (a number
of coins). Thus, while the competition is open to all participants, the chance of winning is
proportional to a miner’s computing power.

Despite its popularity, the PoW protocol has some obvious drawbacks. Competition among
miners has led to exploding levels of energy consumption in Bitcoin mining, [16, 19]. [1, 3, 6]
pointed out that PoW mining will lead to centralization, violating the core tenet of decen-
tralization. To solve the problem of energy eﬃciency, [13, 27] introduced another consensus
protocol – Proof of Stake (PoS), which is a bidding mechanism to select a miner to validate
the new block. Participants who choose to join the bidding process are required to commit

Date: July 27, 2022.

1

 
 
 
 
 
 
2

WENPIN TANG AND DAVID YAO

certain stakes (coins they own), and the winning probability is proportional to the stakes
committed. Hence, a participant in a PoS blockchain is a “bidder”, and only the winning
bidder becomes the miner who does the validation. As yet the PoS protocol has not been as
popular as PoW. However, it is catching up quickly, and blockchain developers have strong
incentives to switch from a PoW to a PoS ecosystem. A prominent case in this direction
is Ethereum 2.0, where two parallel chains – Mainnet (PoW) and Beacon Chain (PoS) are
expected soon to merge into one uniﬁed PoS blockchain [9].

There has been an active stream of recent studies on PoS in the research literature; and
here we brieﬂy mention several that relate closely to our study.
In [21] it is shown that
the PoS protocol is “without waste” from an economic standpoint. Issues of stability and
decentralization of the PoS protocol are examined in [20, 23]. Speciﬁcally, it is shown in [20]
that for large owners of initial wealth in a PoS system their shares of the total wealth will
remain stable in the long run (i.e., proportions to the total wealth will remain constant),
[23] further extends this to
and hence the rich-get-richer phenomenon will not happen.
medium and small participants, and reveals a phase transition in share stability among those
diﬀerent types of participants. In [20, 24], various aspects of the consumption-investment
problem in PoS are examined, and certain conditions are identiﬁed under which a participant
may have no incentive to trade with others. This leads to the complementing question, given
a participant does prefer to trade, what is the optimal trading strategy?

Motivated by the above question, the objective of our study here is to develop a continuous-
time control approach to optimal trading in a PoS blockchain. While the control (or game)
approach has been proposed in previous studies [4, 5, 14], they are all for the PoW protocol.
To the best of our knowledge, ours is the ﬁrst control model developed for optimal trading
under the PoS protocol.

Here is an overview of our main results. We ﬁrst formulate the consumption-investment
problem, which aims to strike a balance between a participant’s utility from holding/trading
stakes and utility from consumption. It takes the form of a deterministic control problem with
the real-time trading strategy being the control variable. We start with a detailed analysis on
a special case that we call the “stake-hoarding” problem (Proposition 3.1), where we bring out
the possible scenario of monopoly. We then solve the general consumption-investment prob-
lem via dynamic programming and the Hamilton-Jacobi-Bellman (HJB) equations (Theorem
3.4).

When the utility functions are linear or convex, more explicit solutions can be obtained,
and we show that the bang-bang control is optimal, i.e., always buy or sell at full capacity
(Propositions 4.1 and 4.3). Along with the optimal trading strategy, we are also able to
bring out the explicit connection between the rate of return in trading/holding stakes and
the participant’s risk-adjusted valuation of the stakes. In other words, the participant’s risk
sensitivity is explicitly accounted for in the trading strategy. In particular, when a participant
is risk-neutral or risk-seeking, corresponding to the risk-adjusted valuation being a martingale
or a sub-martingale, the optimal strategy must be either buy all the time, sell all the time,
or ﬁrst buy then sell (with both buying and selling executed at full capacity).

Finally, we propose a risk control version of the consumption-investment problem, by
adding a penalty term to control the level of stake holding so as to reduce the level of
concentration risk (Theorem 5.1). A special case is a “stake-parity” problem, where the
participant’s holding is controlled at a level that tries to track the system-wide average. We

TRADING UNDER POS

3

show that the “mean-reverting” strategy is the optimal solution to the stake-parity problem
(Proposition 5.2).

The rest of the paper is organized as follows. Section 2 details the formulation of the
consumption-investment problem under the PoS protocol. Section 3 presents the optimal
solution to the problem, and Section 4 focuses on the special case of linear and convex utility
functions. Section 5 presents extensions to risk-control objectives. Concluding remarks are
summarized in Section 6.

2. Model Formulation

This section introduces the problem of trading under the PoS protocol in continuous time,
and formulate a control model to solve the problem. First, collected below are some conven-
tions that will be used throughout this paper.

– R denotes the set of real numbers, and R+ denotes the set of nonnegative real num-

bers.

– For x, y ∈ R, x ∧ y denotes the smaller number of x and y; x ∨ y denotes the larger

number of x and y.

– The symbol x = o(y) means x
y decays towards zero as y → ∞.
– For a random variable X, E(X) denotes the expectation of X.
– Let Ω be a subset of R. A function f ∈ Ck(Ω) if it is k-time continuously diﬀerentiable

in Ω.

– For f ∈ C1([0, T ]), f (cid:48)(t) denotes the derivative of f . For f ∈ C1([0, T ] × Ω), ∂tf (resp.

∂xf ) denotes the partial derivative of f with respect to t (resp. x).

Time is continuous, indexed by t ∈ [0, T ], for a ﬁxed T > 0 representing the length
of a ﬁnite horizon. Let {N (t), 0 ≤ t ≤ T } (with N (0) := N ) denote the process of the
total volume of stakes, which are issued over time by the PoS protocol, and can either be
deterministic or stochastic. For ease of presentation, we consider a deterministic process N (t),
which is increasing in time and suﬃciently smooth, with the derivative N (cid:48)(t) representing
the instantaneous rate of “reward” — additional stakes (or “coins”) injected into the system
speciﬁed (exogenously) by the PoS protocol. For instance, we will consider below, as a special
case, the process N (t) of a polynomial form:
1

Nα(t) = (N

α + t)α,

t ≥ 0.
1

(2.1)

Then, N (cid:48)
(2.1) covers diﬀerent rewarding schemes according to the values of α.

α(t) = α(α − 1)(N

α + t)α−1, and N (cid:48)(cid:48)

α(t) = α(N

1

α + t)α−2, so the parametric family

• For 0 < α < 1, we have N (cid:48)(cid:48)

α(t) < 0 so the process Nα(t) corresponds to a decreasing

reward (e.g. Bitcoin);

• For α = 1, the process N1(t) = N +t gives a rate one constant reward (e.g. Blackcoin);
• For α > 1, we get N (cid:48)(cid:48)
α(t) > 0 and hence, the process Nα(t) amounts to an increasing
reward (e.g. EOS).

Let K ∈ N+ denote the total number of participants in the system, who are indexed by
k ∈ [K] := {1, . . . , K}. For each participant k, let {Xk(t), 0 ≤ t ≤ T } (with Xk(0) = xk)
denote the process of the number of stakes that participant k holds, with Xk(t) ≥ 0 and

4

WENPIN TANG AND DAVID YAO

(cid:80)K

k=1 Xk(t) = N (t) for all t ∈ [0, T ]. Under the PoS protocol, each participant commits
stakes so as to be selected to validate the block and then receive a reward. The winning
probability is proportional to the number of stakes committed. Thus, in the inﬁnitesimal
time interval [t, t + dt] participant k receives (on average) Xk(t)
N (t) N (cid:48)(t)dt stakes, where Xk(t)
N (t)
is participant k’s winning probability, and N (cid:48)(t)dt is the reward issued by the blockchain in
[t, t + dt].

Participants are allowed to trade (buy or sell) their stakes. Participant k will buy νk(t)dt
stakes in [t, t + dt] if νk(t) > 0, and sell −νk(t)dt stakes if νk(t) < 0. This leads to the
following dynamics of participant k’s stakes under trading:

X (cid:48)

k(t) = νk(t) +

N (cid:48)(t)
N (t)

Xk(t)

for 0 ≤ t ≤ τk ∧ T := Tk,

(2.2)

where τk := inf{t > 0 : Xk(t) = 0} is the ﬁrst time at which the process Xk(t) reaches zero.
It is reasonable to stop the trading process if a participant runs out of stakes, or gets all
available stakes:

• If Tk = τk, then participant k liquidates all his stakes by time τk, and Xk(Tk) = 0;
• If Tk = maxj(cid:54)=k τj, then participant k gets all issued stakes by time maxj(cid:54)=k τj, and

hence Xk(Tk) = N (Tk).

We set Xk(t) = Xk(Tk) for t > Tk.

The problem is for each participant k to decide how to trade stakes with others under the
PoS protocol. Let {P (t), 0 ≤ t ≤ T } be the price process of each (unit of) stake, which is a
stochastic process assumed to be independent of the dynamics in (2.2). Here, the price P (t)
of each stake is measured in terms of an underlying risk-free asset (referred to as “cash” for
simplicity); and let bk(t) denote the (units of) risk-free asset that participant k holds at time t,
and let r > 0 denote the risk-free (interest) rate. Also note that all K participants are allowed
to trade stakes (with cash) only internally among themselves, whereas each participants can
only exchange cash with an external source (say, a bank).

The decision for each participant k at t is hence a tuple (νk(t), bk(t)). Let {ck(t), 0 ≤ t ≤ T }
be the process of consumption, or cash ﬂow of participant k, the dynamics of which, over
[t, t + dt] is:

dck(t) = rbk(t)dt − dbk(t) − P (t)νk(t)dt,

0 ≤ t ≤ Tk;

(C1)

with

bk(0) = 0,

bk(t) ≥ 0 for 0 ≤ t ≤ Tk,

0 ≤ Xk(t) ≤ N (t) for 0 ≤ t ≤ Tk.

(C2)

Set bk(t) = bk(Tk) and νk(t) = 0 for t > Tk.

In (C1), the term rbk(t)dt − dbk(t) represents the changes in value of holding the risk-
free asset; while the term −P (t)νk(t)dt accounts for the amount used to trade stakes. The
requirements in (C2) are all in the spirit of disallowing shorting on either the risk free asset
bk(t) or the stakes Xk(t). We also require that the trading strategy be bounded: there is
νk > 0 such that

|νk(t)| ≤ νk.

(C3)

The objective of participant k is:

TRADING UNDER POS

5

J(νk, bk) := E

(cid:26)(cid:90) Tk

e−βkt [dck(t) + (cid:96)k(Xk(t))dt] + e−βkTk [bk(Tk) + hk(Xk(Tk)]

(cid:27)

sup
{(νk(t),bk(t))}

0
subject to (2.2), (C1), (C2), (C3),

(2.3)
where βk > 0 is a discount factor, a parameter measuring the risk sensitivity of participant
k; (cid:96)k(·) and hk(·) are two utility functions, representing, respectively the running proﬁt and
the terminal proﬁt.

Throughout below, the following conditions will be assumed:

Assumption 2.1.

(i) N : [0, T ] → R+ is increasing with N (0) = N > 0, and N ∈ C2([0, T ]).
(ii) (cid:96) : R+ → R+ is increasing and (cid:96) ∈ C1(R+).
(iii) h : R+ → R+ is increasing and h ∈ C1(R+).

3. The Consumption-Investment Problem

Here we study the consumption-investment problem for participant k in (2.3). To lighten
notation, omit the subscript k, and write out the problem in full as follows, where (C0) is a
repeat of the state dynamics in (2.2):

U (x) :=

sup
{(ν(t),b(t))}

J(ν, b) := E

(cid:26)(cid:90) T

0

e−βt [dc(t) + (cid:96)(X(t))dt] + e−βT [b(T ) + h(X(T )]

(cid:27)

subject to X (cid:48)(t) = ν(t) +

N (cid:48)(t)
N (t)
dc(t) = rb(t)dt − db(t) − P (t)ν(t)dt,

X(t), X(0) = x,

b(0) = 0, b(t) ≥ 0 and 0 ≤ X(t) ≤ N (t),

|ν(t)| ≤ ν.

(3.1)

(C0)

(C1)

(C2)

(C3)

where T := inf{t > 0 : X(t) = 0 or N (t)} ∧ T .

Note that the expectation in the objective function is with respect to P (t), which is involved

in dck(t) via (C1). Denote

(cid:101)Pβ(t) := e−βtEP (t),

t ∈ [0, T ].

(3.2)

Substituting the constraint (C1) into the objective function, and taking into account

rb(t)dt − db(t) = −ertd(e−rtb(t)),

6

WENPIN TANG AND DAVID YAO

along with (3.2), we have

J(ν, b) = −

(cid:90) T

0

e(r−β)td(e−rtb(t)) + e−βT b(T )

+

(cid:90) T

0

(cid:124)

(cid:2) − (cid:101)Pβ(t)ν(t) + e−βt(cid:96)(X(t)(cid:3)dt + e−βT h(X(T ))
(cid:125)

(cid:123)(cid:122)
J2(ν)

(cid:90) T

= (r − β)

e−βtb(t)dt

+ J2(ν),

(cid:124)

0

(cid:123)(cid:122)
:=J1(b)

(cid:125)

where b(0) = 0 is used in the last equality. Hence,

U (x) := sup
{(ν,b)}

J(ν, b) = sup

b

J1(b) + sup

ν

J2(ν).

(3.3)

(3.4)

Next, suppose β ≥ r, a condition that will be assumed below (and readily justiﬁed as the
risk premium associated with the valuation of any stake over the risk-free asset). Then, from
the J1(b) expression in (3.3), and taking into account b(t) ≥ 0 as constrained in (C2), we
have supb J1(b) = 0 with the optimality binding at b∗(t) = 0 for all t. Consequently, the
problem in (3.1) is reduced to

U (x) = sup

ν

J2(ν)

subject to (C0), (C2’), (C3),

(3.5)

where (C2’) is (C2) without the constraints on b(·).

In summary, the key fact here is that the objective U (x) is separable in the control variables
(ν(t), b(t)); hence the problem in (3.1) is decomposed into two optimal control problems, one
on the risk-free asset b(t), and the other on the trading of stakes ν(t), as speciﬁed in (3.3) and
(3.4). Moreover, under the condition β ≥ r, the consumption-investment problem is reduced
to the one in (3.5), where the objective function J2(ν) – refer to (3.3) – takes the form of a
tradeoﬀ between the utility from holding stakes ((cid:96)(X(t)) and h(X(T ))) and the dis-utility
of reducing consumption (− (cid:101)Pβ(t)ν(t)). Thus, the optimal trading strategy needs to strike a
balance between these two opposing terms.

Before we present the optimal solution to the consumption-investment problem in (3.5),
we make a digression to ﬁrst study a simple degenerate case of (cid:101)Pβ(t) ≡ 0, corresponding
to the case of β → ∞. This special case removes the tradeoﬀ mentioned above, so the
solution becomes a one-sided strategy of always accumulating (or “hoarding”) the stakes at
full capacity (ν). Yet, as the analysis below will show, there are still some interesting (and
subtle) issues involved. More importantly, this special case provides a very accessible path
to ﬁnding the optimal solution via dynamic programming and the HJB equation.

3.1. Stake-hoarding. As motived above, here the problem for participant k is reduced to
the following (again, omit the subscript k):

U (x) := sup
ν(t)

(cid:90) T

e−βt (cid:96)(X(t))dt + e−βT h(X(T ))

(3.6)

0
subject to

(C0), (C2’), (C3).

TRADING UNDER POS

7

Below, we denote ν∗(t) for the optimal control process, X∗(t) for the corresponding state
process, and T∗ := inf{t > 0 : X∗(t) = N (t)} ∧ T for the exit time.

Proposition 3.1. Denote

γ(t) := νN (t)

(cid:90) t

0

ds
N (s)

+

xN (t)
N

for 0 ≤ t ≤ T.

(3.7)

We have:

(i) If ν (cid:82) T
0

dt

N (t) ≤ N −x

N , then T∗ = T . The optimal control is ν∗(t) = ν for 0 ≤ t ≤ T ,
the optimal state process is X∗(t) = γ(t) for 0 ≤ t ≤ T , and U (x) = e−βT h(X∗(T )) +
(cid:82) T
0 e−βt(cid:96)(X∗(t))dt.
(ii) If ν (cid:82) T
dt
N (t) > N −x
0

N , set

(cid:26)

t0 := inf

t > 0 : ν

(cid:90) t

0

ds
N (s)

=

N − x
N

(cid:27)

< T.

Assume further that

h(N (t))(cid:48) + (cid:96)(N (t)) ≤ βh(N (t))

for all 0 ≤ t ≤ T.

(3.8)

Then, T∗ = t0. The optimal strategy is ν∗(t) = ν for 0 ≤ t ≤ t0 (and ν∗(t) = 0 for
t > t0), the optimal state process is X∗(t) = γ(t) for 0 ≤ t ≤ t0 (and X∗(t) = N (t0)
for t > t0), and U (x) = e−βt0h(X∗(t0)) + (cid:82) t0

0 e−βt(cid:96)(X∗(t))dt.

Figure 1. Optimal stake trading: concentration and monopoly.

Deferring the proof, we ﬁrst make a few comments on the above proposition. Note that
γ(t) as speciﬁed in (3.7) is identiﬁed as the optimal state process X∗(t), which is the number
of stakes given ν∗(t) = ν. It is easy to see that the participant’s share of stakes, X∗(t)/N (t),
is increasing in t, leading to centralization regardless of how the rewarding scheme is designed
(although large rewards may slow down the speed towards concentration). The interesting
point of the above theorem is in its part (ii), where the required condition (3.8) is a technical
one, to ensure the optimality of ν∗(t) = ν. The more substantive fact is T∗ = t0 < T , when
X(T∗) = N (T∗), i.e., the participant has accumulated all stakes available in the system,
leading to the extreme situation of monopoly (or “dictatorship”); and this is done before the
end of the horizon, i.e., forcing a pre-matured exit time. See Figure 1 for an illustration.

(3.9)

(3.10)

(cid:3)

8

WENPIN TANG AND DAVID YAO

The following corollary illustrates further this extreme phenomenon, with the polynomial

family Nα(t) deﬁned by (2.1), and with a long time horizon (T → ∞).
Corollary 3.2. Let (Nα(t), 0 ≤ t ≤ T ) be deﬁned by (2.1), (Xα,∗(t), 0 ≤ t ≤ T ) be the opti-
mal state process deﬁned by (3.7) corresponding to Nα(t), and Tα,∗ := inf{t > 0 : Xα,∗(t) =
Nα(t)} be the exit time. Assume that the condition (3.8) holds for Nα(t). Then, as T → ∞,
we have

(i) For α > 1,

– if ν ≤ (α − 1)(N − x)N − 1

α , then Xα,∗(t) < Nα(t) for all t. Moreover,
x
N

ν
α − 1

1−α
α +

N

=

.

Xα,∗(t)
Nα(t)

lim
t→∞

– if ν > (α − 1)(N − x)N − 1
(ii) For α ≤ 1, we have Tα,∗ < ∞.

α , then Tα,∗ < ∞.

Proof. Note that

(cid:90) T

0

dt
Nα(t)

=






(cid:16)

1
1−α
(cid:16)

log

As T → ∞, the dominant term in 1
1−α

(cid:17)

(T + N
1 + T N − 1
(cid:16)

α

(T + N

1

α )1−α − N

(cid:17)

1−α
α

for α (cid:54)= 1

for α = 1.

1
1−α T 1−α if α < 1; and the dominant term in log
compare ν (cid:82) T
0

Nα(t) to N −x

dt

N , and the rest of the corollary is immediate.

1

α )1−α − N

(cid:17)

1−α
α

(cid:16)

1 + T N − 1

α

(cid:17)

is

1
α−1 N

1−α
α

if α > 1, and is

is log T . It then suﬃces to

This corollary shows a sharp phase transition towards monopoly in terms of the rewarding
schemes. For α > 1 (increasing reward), there is a threshold for ν, only above which monopoly
may occur, and below which the share of stakes increases towards the value on the right side
of (3.9). For α ≤ 1 (constant or decreasing reward), monopoly always occurs. Thus, these
results have practical implications in the design of the PoS protocol. For instance, if/when
certain participants have large capacities, adopting a suitable increasing reward scheme will
counter the eﬀect of concentration.

Now, returning to the proof of Proposition 3.1, we use the standard machinery of dynamic
programming and the HJB equation. Consider the following problem, where V (t, x) is the
“value-to-go” function, for 0 ≤ t ≤ T and 0 ≤ x ≤ N (t):

V (t, x) := max

{ν(s),s≥t}

(cid:90) T

t

e−βs (cid:96)(X(s))ds + e−βT h(X(T ))

subject to X (cid:48)(s) = ν(s) +

N (cid:48)(s)
N (s)

X(s), X(t) = x,

0 ≤ X(s) ≤ N (s),

|ν(s)| ≤ ν.

Clearly, the solution to the above problem concerning V (t, x), for all t ∈ [0, T ] and x ∈
[0, N (t)], will yield the desired solution to U (x) in (3.6), since U (x) = V (0, x). The following
lemma identiﬁes an HJB equation (with terminal and boundary conditions), to which. V (t, x)
is a solution.

TRADING UNDER POS

9

Lemma 3.3. Let Q := {(t, x) : 0 ≤ t < T, 0 < x < N (t)}. Then V is the (unique) viscosity
solution to the following HJB equation:
∂tv + e−βt(cid:96)(x) + xN (cid:48)(t)
v(T, x) = e−βT h(x),
v(t, 0) = e−βth(0), v(t, N (t)) = e−βth(N (t)).

N (t) ∂xv + sup|ν|≤ν{ν ∂xv} = 0

(t, x) ∈ Q,

(3.11)






Proof. Write the HJB equation as ∂tv + H(t, x, ∂xv) = 0, where

H(t, x, p) := e−βt(cid:96)(x) +

xN (cid:48)(t)
N (t)

p + sup
|ν|≤ν

{νp}.

The fact that V as speciﬁed in (3.11) is a viscosity solution follows a standard dynamic
programming argument, see [10, Chapter II, Section 7].
Moreover, from the conditions in Assumption 2.1, we have,

|H(t, x, p) − H(s, y, q)| ≤ C(|t − s| + |x − y| + |p − q| + |x − y||p| + |t − s||p|),

(3.12)

for 0 ≤ s, t ≤ T and 0 ≤ x, y ≤ N (t), and for some C > 0. By [10, Chapter II, Corollary 9.1],
the HJB equation in (3.11) has a unique viscosity solution, which then must be none other
(cid:3)
than V .

What remains is to pin down the term sup|ν|≤ν{ν ∂xv} in the HJB equation, i.e., to identify
the maximizing ν. Given the intuitive solution that ν = ν > 0 (a “conjecture,” so far), the
HJB equation in 3.11 is expected to be






(cid:16)

(cid:17)

∂tv + e−βt(cid:96)(x) +
v(T, x) = e−βT h(x),
v(t, 0) = e−βth(0), v(t, N (t)) = e−βth(N (t)),

∂xv = 0 in Q,

ν + xN (cid:48)(t)
N (t)

(3.13)

which is a transport equation with variable coeﬃcients. Now we solve the transport equation
(3.13) by the method of characteristics. For 0 ≤ t ≤ T and 0 ≤ x ≤ N (t), let γt,x(s) be the
solution to the following equation:

γ(cid:48)
t,x(s) = ν +

N (cid:48)(s)
N (s)

γt,x(s),

s > t;

γt,x(t) = x.

(3.14)

A direct computation yields

γt,x(s) = νN (s)

(cid:90) s

t

du
N (u)

+

xN (s)
N (t)

,

s ≥ t.

(3.15)

Under the regularity conditions in Assumption 2.1, it is standard that (see e.g. [2, 11])

v(t, x) = e−βTt,xh(γt,x(Tt,x)) +

(cid:90) Tt,x

t

e−βs(cid:96)(γt,x(s))ds,

(3.16)

where Tt,x := inf{s > t : γt,x(s) = N (s)} ∧ T . We will next show that v(t, x) given by (3.16)
indeed solves the HJB equation (3.11), which then proves Proposition 3.1.

Proof of Proposition 3.1. From the expression of γt,x(s) in (3.15), we have

∂xγt,x(s) =

N (s)
N (t)

> 0

and ∂xTt,x ≤ 0.

(3.17)

10

WENPIN TANG AND DAVID YAO

Note that γt,x(s)/N (s) is increasing in s. There are two cases.
Case 1:
(cid:82) T
t e−βs(cid:96)(γt,x(s))ds. By the regularity conditions in Assumption 2.1, we get

If γt,x(T )/N (T ) ≤ 1, then Tt,x = T and hence, v(t, x) = e−βT h(γt,x(T )) +

∂xv = e−βT N (T )
N (t)

h(cid:48)(γt,x(T )) +

(cid:90) T

t

e−βs N (s)
N (t)

(cid:96)(cid:48)(γt,x(s))ds ≥ 0,

where the non-negativity follows from the fact that N (t) > 0 and (cid:96), h are increasing.
Case 2:
(cid:82) Tt,x
t

If γt,x(T )/N (T ) > 1, then Tt,x < T , and hence v(t, x) = e−βTt,xh(N (Tt,x)) +

e−βs(cid:96)(γt,x(s))ds. As a result,

∂xv = −βe−βTt,x(∂xTt,x)h(N (Tt,x)) + e−βTt,x(∂xTt,x)(h ◦ N )(cid:48)(Tt,x)

(cid:90) Tt,x

+

t

e−βs N (s)
N (t)

(cid:96)(cid:48)(γt,x(s))ds + e−βTt,x(∂xTt,x)(cid:96)(N (Tt,x))

(cid:90) Tt,x

=

t

e−βs N (s)
N (t)

(cid:96)(cid:48)(γt,x(s))ds − e−βTt,x

(∂xTt,x)
(cid:124) (cid:123)(cid:122) (cid:125)
≤0 by (3.17)

(−(cid:96) ◦ N − (h ◦ N )(cid:48) + βh ◦ N )
(Tt,x)
(cid:125)
(cid:123)(cid:122)
(cid:124)
≥0 by (3.8)

≥ 0.

So, in both cases, we have ∂xv(t, x) ≥ 0. Thus, v(t, x) deﬁned by (3.16) is a classical solution
and hence, a viscosity solution to the HJB equation in (3.11). By Lemma 3.3, we conclude
V (t, x) = v(t, x), and the optimal control is ν∗(s) = ν for s ≥ t. Specializing to t = 0 yields
(cid:3)
the results in Proposition 3.1 (and γ(t) deﬁned by (3.7) is just γ0,x(t)).

3.2. Main theorem and proof. We are now ready to present the main result of this section,
the optimal solution to U (x) in (3.5) and hence to U (x) in (3.1).

Theorem 3.4. Assume that r ≤ β, and (cid:101)Pβ(t) in (3.2) satisﬁes the Lipschitz condition:

| (cid:101)Pβ(t) − (cid:101)Pβ(s)| ≤ C|t − s|

for some C > 0.

(3.18)

Then, U (x) = v(0, x) where v(t, x) is the unique viscosity solution to the following HJB
equation, where Q := {(t, x) : 0 ≤ t < T, 0 < x < N (t)}:






∂tv + e−βt(cid:96)(x) + xN (cid:48)(t)
v(T, x) = e−βT h(x),
v(t, 0) = e−βth(0), v(t, N (t)) = e−βth(N (t)).

N (t) ∂xv + sup|ν|≤ν{ν(∂xv − (cid:101)Pβ(t))} = 0

in Q,

(3.19)

Moreover, the optimal strategy is b∗(t) = 0 and ν∗(t) = ν∗(t, X∗(t)) for 0 ≤ t ≤ T∗, where
ν∗(t, x) achieves the supremum in (3.19), and X∗(t) solves X (cid:48)
N (t) X∗(t)
with X∗(0) = x, and T∗ := inf{t > 0 : X∗(t) = 0 or N (t)} ∧ T .

∗(t) = ν∗(t, X∗(t)) + N (cid:48)(t)

TRADING UNDER POS

11

Proof. Similar to the dynamic programming/HJB approach that proves Lemma 3.3 and
Proposition 3.1 above, here we consider

V2(t, x) := max
ν(s)

(cid:90) T

t

(− (cid:101)Pβ(s)ν(s) + e−βs(cid:96)(X(s))ds + e−βT h(X(T ))

subject to X (cid:48)(s) = ν(s) +

N (cid:48)(s)
N (s)

X(s), X(t) = x,

0 ≤ X(s) ≤ N (s),

|ν(s)| ≤ ν,

so that U (x) = V2(0, x). By the same dynamic programming argument as above, V2 solves in
the viscosity sense the HJB equation in (3.19), which can be expressed as ∂tv +H(t, x, ∂xv) =
0, with

H(t, x, p) := e−βt(cid:96)(x) +

xN (cid:48)(t)
N (t)

p + sup
|ν|≤ν

{ν(p − (cid:101)Pβ(t))}.

It is readily checked that under Assumption 2.1 and the Liptschiz condition in (3.18), the
inequality in (3.12) holds. Thus, V2 as identiﬁed above is the unique viscosity to the HJB
(cid:3)
equation in (3.19). The rest of the theorem is straightforward.

Comparing the HJB equations in (3.11) and in (3.19), we see the nonlinear term changes
from sup|ν|≤ν{ν∂xv} in the stake-hoarding problem, to sup|ν|≤ν{ν(∂xv − (cid:101)Pβ(t))} in the stake-
trading problem, the latter being the general consumption-investment problem. The more
general HJB equation in (3.19) does not have a closed-form solution, and neither does the
optimal trading strategy ν∗(t). This calls for numerical methods; see e.g. [18, 22].

4. Linear and Convex Utilities

4.1. Linear utility.
Consider the special case of linear utility, (cid:96)(x) = (cid:96)x and h(x) = hx,
for some given (positive) constants (cid:96) and h. In this case we can derive a closed-form solution
to the HJB equation in (3.19), and then derive the optimal strategy ν∗(t) (in terms of (cid:101)Pβ(t)).
To start with, the HJB equation in (3.19) now specializes to the following, with Q :=

{(t, x) : 0 ≤ t < T, 0 < x < N (t)} (as before, refer to Lemma 3.3):






∂tv + (cid:96)e−βtx + xN (cid:48)(t)
v(T, x) = hx,
v(t, 0) = 0, v(t, N (t)) = hN (t).

N (t) ∂xv + sup|ν|≤ν{ν(∂xv − (cid:101)Pβ(t))} = 0

(t, x) ∈ Q,

(4.1)

For the nonlinear term sup|ν|≤ν{ν(∂xv − (cid:101)Pβ(t))}, we have ν∗(t, x) = ν if ∂xv(t, x) ≥ (cid:101)Pβ(t),
and ν∗(t, x) = ν if ∂xv(t, x) < (cid:101)Pβ(t).

Next, presuming that ∂xv ≥ (cid:101)Pβ(t), and ignoring the boundary conditions, the HJB equa-

tion in (4.1) becomes

∂tv + (cid:96)e−βtx − ν (cid:101)Pβ(t) +

(cid:18)

ν +

(cid:19)

xN (cid:48)(t)
N (t)

∂xv = 0,

v(T, x) = hx,

12

WENPIN TANG AND DAVID YAO

which has the (classical) solution

where

v+(t, x) := he−βT γ+

t,x(T ) +

(cid:90) T

(cid:104)

t

(cid:96)e−βsγ+

(cid:105)
t,x(s) − ν (cid:101)Pβ(s)

ds,

γ+
t,x(s) := νN (s)

(cid:90) s

t

du
N (u)

+

xN (s)
N (t)

,

s ∈ [t, T ].

(4.2)

(4.3)

Similarly, presuming that ∂xv < (cid:101)Pβ(t) and neglecting the boundary conditions turns the HJB
equation in (3.19) into the following form:

∂tv + (cid:96)e−βtx + ν (cid:101)Pβ(t) +

(cid:18)

−ν +

(cid:19)

xN (cid:48)(t)
N (t)

∂xv = 0,

v(T, x) = hx,

which has the solution

where

v−(t, x) := he−βT γ−

t,x(T ) +

(cid:90) T

t

(cid:104)
(cid:96)e−βsγ−

(cid:105)
t,x(s) + ν (cid:101)Pβ(s)

ds,

γ−
t,x(s) := −νN (s)

(cid:90) s

t

du
N (u)

+

xN (s)
N (t)

,

s ∈ [t, T ].

The key observation is that

∂xv+(t, x) = ∂xv−(t, x) =

1
N (t)
(cid:124)

(cid:18)

he−βT N (T ) + (cid:96)

(cid:123)(cid:122)
:=Ψ(t)

(cid:90) T

t

e−βsN (s)ds

(cid:19)
;

(cid:125)

(4.4)

(4.5)

(4.6)

and Ψ(t), notably independent of x, is decreasing in t ∈ [0, T ]:

Ψ(0) = he−βT N (T )

N

+

(cid:96)
N

(cid:90) T

0

e−βtN (t)dt ↓ (≥) Ψ(t) ↓ (≥) Ψ(T ) = he−βT .

(4.7)

This suggests that ν∗(t) = ν (buy all the time) if sup[0,T ] (cid:101)Pβ(t) ≤ Ψ(T ); and ν∗(t) = −ν (sell
all the time) if inf [0,T ] (cid:101)Pβ(t) ≥ Ψ(0). Various other scenarios are also possible, such as ﬁrst
buy then sell, or ﬁrst sell then buy, and so forth.

The following proposition classiﬁes all possible optimal strategies corresponding to (cid:101)Pβ(t)

decreasing in t as speciﬁed above, which we will comment on later.

Proposition 4.1. Let (cid:96)(x) = (cid:96)x and h(x) = hx with (cid:96), h > 0, and N (t) satisfy Assumption
2.1 (i). Assume that (cid:101)Pβ(t) satisﬁes the Lipschitz condition in (3.18), and that ν satisﬁes the
following:

(cid:90) T

ν

dt
N (t)

≤

x
N

∧

N − x
N

.

(4.8)

Then, the following results hold:

0

(i) Suppose (cid:101)Pβ(t) stays constant, i.e., for all t ∈ [0, T ], (cid:101)P (t) = (cid:101)P (0) = P (0).

(a) If P (0) ≥ Ψ(0), then ν∗(t) = −ν for all 0 ≤ t ≤ T . That is, the participant sells

at all time at full capacity.

(b) If P (0) ≤ Ψ(T ), then ν∗(t) = ν. That is, the participant purchases at all time at

full capacity.

TRADING UNDER POS

13

(c) If Ψ(T ) < P (0) < Ψ(0), then

ν∗(t) =

(cid:26) ν

for t ≤ t0,
−ν for t > t0,

where t0 is the unique point in [0, T ] such that P (0) = Ψ(t0) with Ψ(t) deﬁned
in (4.6). That is, the participant ﬁrst buys and after some time sells, both at full
capacity.

(ii) Suppose that (cid:101)Pβ(t) is increasing in t ∈ [0, T ].

(a) If P (0) ≥ Ψ(0), then ν∗(t) = −ν for all 0 ≤ t ≤ T . That is, the participant sells

all the time at full capacity.

(b) If (cid:101)Pβ(T ) ≤ Ψ(T ), then ν∗(t) = ν. That is, the participant purchases all the time

at full capacity.

(c) If P (0) < Ψ(0) and (cid:101)Pβ(T ) > Ψ(T ), then

ν∗(t) =

(cid:26) ν

for t ≤ t0,
−ν for t > t0,

where t0 is the unique point of intersection of (cid:101)Pβ(t) and Ψ(t) on [0, T ]. That is,
the participant ﬁrst buys and after some time sells, both at full capacity.

(iii) Suppose that (cid:101)Pβ(t) is decreasing in t ∈ [0, T ].

(a) If P (0) ≥ Ψ(0), then the participant ﬁrst sells, and may then buy, etc, always
(buy or sell) at full capacity, according to the crossings of (cid:101)Pβ(t) and Ψ(t) in
[0, T ].

(b) If P (0) < Ψ(0), then the participant ﬁrst buys, and may then sell, etc, always
(buy or sell) at full capacity, according to the crossings of (cid:101)Pβ(t) and Ψ(t) in
[0, T ].

Proof. Recall that X∗(t) is the state process (number of stakes) corresponding to the optimal
strategy ν∗(t), which, as stipulated in the rest of the proposition, will be equal to either ν or
−ν. The condition in (4.8) then ensures that 0 ≤ X∗(t) ≤ N (t) for all t ∈ [0, T ], so T∗ = T
(i.e., there will no forced early exit).
Thus, it suﬃces to ﬁnd the optimal strategy ν∗(t) from

sup
|ν|≤ν

{ν[∂xv − (cid:101)Pβ(t)]} = sup
|ν|≤ν

{ν[Ψ(t) − (cid:101)Pβ(t)]}.

(i) and (ii). Since Ψ(t) is decreasing and (cid:101)P (t) is either constant or increasing, Ψ(t) − P (t) is
decreasing. Hence, we have the following cases (for both (i) and (ii)).
(a) If (cid:101)P (0) = P (0) ≥ Ψ(0), then (cid:101)P (t) ≥ Ψ(t) for all t ∈ [0, T ]; hence, ν∗(t) = −ν, and
U (x) = v−(0, x).
(b) Similarly, if P (0) ≤ Ψ(T ), then (cid:101)P (t) ≤ Ψ(t) for all t ∈ [0, T ]; hence, ν∗(t) = ν, and
U (x) = v+(0, x).
(c) Otherwise, there will be a unique point for Ψ(t) − P (t) (which is decreasing in t) to cross
0 from above, and let t0 ∈ [0, T ] denote the crossing point. This implies that ν∗(t) = ν for
t ≤ t0, and ν∗(t) = −ν for t > t0; and

U (x) = v+(0, x) − v+(t0, γ+

0,x(t0)) + v−(t0, γ+

0,x(t0)).

14

WENPIN TANG AND DAVID YAO

Part (iii) is similarly argued, the only complication is that Ψ(t) − P (t) is now non-monotone,
(cid:3)
and hence, there will be multiple points when it crosses 0.

Several remarks are in order. First note that the condition in (4.8) is to guarantee the
constraint (C2’) not activated prior to T ; that is, to exclude the possibility of monop-
oly/dictatorship that will trigger a forced early exit. This condition may well be removed,
but then we would expect another condition similar to the one in (3.8) to guarantee the
optimality of a strategy when an early exit occurs.

Second, (cid:101)Pβ(t) = E(cid:2)e−βtP (t)(cid:3) combines β, which measures the participant’s sensitivity
towards risk, with the stake price P (t). Thus, the monotone properties of (cid:101)Pβ(t), which classify
the three parts (i)-(iii) in Proposition 4.1, naturally connect to martingale pricing: (cid:101)Pβ(t)
being a constant in (i) makes the process e−βtP (t) a martingale; whereas (cid:101)Pβ(t) increasing
or decreasing, respectively in (ii) and (iii), makes e−βtP (t) a sub-martingale or a super-
martingale.

On the other hand, the function Ψ(t) = ∂xv+(t, x) = ∂xv−(t, x) represents the rate of
return of the participant’s utility (from holding of stakes, x); and interestingly, in the linear
utility case, this return rate is independent of x while decreasing in t. Thus, the trading
strategy is completely determined by comparing this return rate Ψ(t) with the participant’s
risk-adjusted stake price (or, valuation) (cid:101)Pβ(t): if Ψ(t) ≥ (resp. <) (cid:101)Pβ(t), then the participant
will buy (resp. sell) stakes.

Speciﬁcally, following (i) and (ii) of Proposition 4.1, for a constant or an increasing (cid:101)Pβ(t)
(corresponding to a risk-neutral or risk-seeking participant), there are only three possible
optimal strategies: buy all the time, sell all the time, or ﬁrst buy then sell. (The ﬁrst-buy-
then-sell strategy echoes the general investment practice that an early investment pays oﬀ in
a later day.) See Figure 2 for an illustration.

Figure 2. Optimal stake trading with linear (cid:96)(·), h(·) when (cid:101)Pβ(t) is constant
(left) and (cid:101)Pβ(t) is increasing (right).

4.2. A special case. In part (iii) of Proposition 4.1, when (cid:101)Pβ(t) is decreasing in t, like Ψ(t),
the multiple crossings between the two decreasing functions can be further pinned down
when there’s more model structure. Consider, for instance, when P (t) follows a geometric

TRADING UNDER POS

15

Brownian motion (GBM):

dP (t)
P (t)

= µdt + σdBt,

or P (t) = P (0)e(µ−σ2/2)t+σBt;

t ∈ [0, T ],

(4.9)

where {Bt} denotes the standard Brownian motion; and µ > 0 and σ > 0 are the two
parameters of the GBM model, representing the rate of return and the volatility of {P (t)}.
From the second equation in (4.9), we have EP (t) = P (0)eµt; hence, (cid:101)Pβ(t) = P (0)e−(β−µ)t.
Then, a decreasing (cid:101)Pβ(t) corresponds to β > µ. From (4.6), we can derive

Ψ(cid:48)(t) = −

N (cid:48)(t)
N (t)

Ψ(t) − (cid:96)e−βt,

and hence,

(cid:16)

Ψ(t) − (cid:101)Pβ(t)

(cid:17)(cid:48)

= −

N (cid:48)(t)
N (t)

Ψ(t) − (cid:96)e−βt + (β − µ)P (0)e−(β−µ)t.

(4.10)

Let Ψα(t) denote Ψ(t) for N (t) = Nα(t) deﬁned by (2.1). The following proposition gives
the conditions under which Ψα(t) − (cid:101)Pβ(t) is monotone in the regime N → ∞, and optimal
strategies are derived accordingly.

Proposition 4.2. Suppose the assumptions in Proposition 4.1 hold, with N (t) = Nα(t) and
{P (t)} speciﬁed by (4.9) with β > µ. As N → ∞, we have the following results:

• If for some ε > 0,

P (0) >

1
β − µ

(cid:32)

αhe−µT (N

1

α + T )α

N 1+ 1

α

+

α(cid:96)β−1

1
α

N

(cid:33)

+ (cid:96)

+

ε

1
α

N

,

then Ψα(t) − (cid:101)Pβ(t) is increasing on [0, T ].

• If for some ε > 0,

P (0) <

1
β − µ

(cid:18) αhe−βT
1
α + T

N

+ (cid:96)e−µT

(cid:19)

−

ε

1
α

N

,

(4.11)

(4.12)

then Ψα(t) − (cid:101)Pβ(t) is decreasing on [0, T ].

Consequently, we have:

(a) If P (0) > e(β−µ)T Ψα(T ) and (4.11) holds, or P (0) > Ψα(0) and (4.12) holds, then
ν∗(t) = −ν for all t. That is, the participant sells all the time at full capacity.
(b) If Ψα(0) ≤ P (0) < e(β−µ)T Ψα(T ) and (4.11) holds, then ν∗(t) = −ν for t ≤ t0 and
ν∗(t) = ν for t > t0, where t0 is the unique point of intersection of (cid:101)Pβ(t) and Ψα(t)
on [0, T ]. That is, the participant ﬁrst sells (before t0) and then buys (after t0), both
at full capacity.

(c) If e(β−µ)T Ψα(T ) ≤ P (0) < Ψα(0) and (4.12) holds, then ν∗(t) = ν for t ≤ t0 and
ν∗(t) = −ν for t > t0, where t0 is the unique point of intersection of (cid:101)Pβ(t) and Ψα(t)
on [0, T ]. That is, the participant ﬁrst buys (before t0) and then sells (after t0), both
at full capacity.

(d) If P (0) < e(β−µ)T Ψα(T ) and (4.12) holds, or P (0) < Ψα(0) and (4.11) holds, then

ν∗(t) = ν for all t. That is, the participant buys all the time at full capacity.

16

WENPIN TANG AND DAVID YAO

Proof. Note that N (cid:48)

α(t)
Nα(t) = α(N

1

α + t)−1, and

(cid:90) T

t

e−βsNα(s)ds = eβN

1

α β−α−1 (cid:16)

Γ(α + 1, β(N

1
α + t)) − Γ(α + 1, β(N

1
α + T ))

(cid:17)

,

where Γ(a, x) := (cid:82) ∞

x ta−1e−tdt is the incomplete Gamma function. As N → ∞, we have

(cid:90) T

t

e−βsNα(s)ds = β−1 (cid:16)

(cid:17)
e−βtNα(t) − e−βT Nα(T )

+ o(N ),

which together with (4.6) and (4.10) implies that

(cid:16)

Ψα(t) − (cid:101)Pβ(t)

(cid:17)(cid:48)

= −

α
1
α + t

N

(cid:20) he−βT Nα(T )
Nα(t)

+ (cid:96)β−1

(cid:18)
e−βt − e−βT Nα(T )
Nα(t)

(cid:19)

(cid:21)

+ o(1)

(4.13)

− (cid:96)e−βt + (β − µ)P (0)e−(β−µ)t.

Multiplying the RHS of (4.13) by e(β−µ)t, we get

α
1
α + t

−

N

(cid:34)

he−β(t−T )−µtNα(T )
Nα(t)
− (cid:96)e−µt + (β − µ)P (0).

+ (cid:96)β−1

(cid:18)
e−µt − e−β(t−T )−µt Nα(T )
Nα(t)

(cid:19)

(cid:35)

+ o(1)

Clearly, the sum of all the terms above is lower bounded by

−

(cid:18) αhe−µT Nα(T )
N 1+ 1
(cid:16)

α

+ α(cid:96)β−1N − 1

α + (cid:96)

(cid:19)

+ (β − µ)P (0)

(4.11)

> 0,

which implies that inf [0,T ]
Ψα(t) − (cid:101)Pβ(t)
Moreover, the term is upper bounded by

> 0, and hence, Ψα(t) − (cid:101)Pβ(t) is increasing.

(cid:17)(cid:48)

(cid:17)(cid:48)

(cid:19)

+ (cid:96)e−µT

+ (β − µ)P (0)

(4.12)

< 0,

−

(cid:18) αhe−βT
1
α + T

N
(cid:16)

Ψα(t) − (cid:101)Pβ(t)

which implies that sup[0,T ]
(a) If P (0) > e(β−µ)T Ψα(T ) and (4.11) holds, then Ψα(T ) < (cid:101)Pβ(T ) and Ψα(t) − (cid:101)Pβ(t) is
increasing.
If P (0) > Ψα(0) and (4.12) holds, then Ψα(0) < (cid:101)Pβ(0) and Ψα(t) − (cid:101)Pβ(t) is
decreasing. In both cases, we have Ψα(t) − (cid:101)Pβ(t) < 0 for all t.
(b) (c) (d) follow the same argument as (a).

< 0, and hence, Ψα(t) − (cid:101)Pβ(t) is decreasing.

(cid:3)

See Figure 3 below for an illustration of the results in the above proposition. Also note
that the connection to the participant’s risk sensitivity as remarked at the end of §4.1 can
also be made more explicit when the price process P (t) follows the GBM model in (4.9), for
which we have (cid:101)Pβ(t) = P (0)e−(β−µ)t. Then, the three cases in Proposition 4.1 correspond
to β = µ (martingale), β < µ (sub-martingale), and β > µ (super-martingale). According
to the three ranges of β, they can be viewed as representing the participant as risk-neutral,
risk-seeking and risk-averse.

TRADING UNDER POS

17

Figure 3. Optimal stake trading with linear (cid:96)(·), h(·) when (cid:101)Pβ(t) =
P (0)e(µ−β)t and N (t) = Nα(t).

4.3. Convex utility.
It is possible to extend the above results to more general, non-linear
utility functions (cid:96)(·) and h(·), by following the same approach as above that leads to v+(t, x)
and v−(t, x) in (4.2) and (4.4).

Speciﬁcally, considering the two cases of ∂xv ≥ (cid:101)Pβ(t), and ∂xv < (cid:101)Pβ(t), we can derive

v+(t, x) := e−βT h(cid:0)γ+

v−(t, x) := e−βT h(cid:0)γ−

(cid:104)

t,x(T )(cid:1) + (cid:82) T
t,x(T )(cid:1) + (cid:82) T

t

t

e−βs(cid:96)(cid:0)γ+
(cid:104)

e−βs(cid:96)(cid:0)γ−

t,x(s)(cid:1) − ν (cid:101)Pβ(s)
t,x(s)(cid:1) + ν (cid:101)Pβ(s)

(cid:105)

ds,

(cid:105)

ds;

(4.14)

(4.15)

whereas γ+

t,x and γ−

t,x remain the same as in (4.3) and (4.5).

The Ψ function in (4.6) now splits into two functions: for (t, x) ∈ Q := {(t, x) : 0 ≤ t <

T, 0 < x < N (t)}, we have

∂xv+(t, x) =

1
N (t)
(cid:124)

(cid:18)

e−βT N (T )h(cid:48)(cid:0)γ+

(cid:90) T

t,x(T )(cid:1) +
(cid:123)(cid:122)
:=Ψ+(t,x)

t

and

∂xv−(t, x) =

(cid:18)

1
N (t)
(cid:124)

e−βT N (T )h(cid:48)(cid:0)γ−

(cid:90) T

t,x(T )(cid:1) +
(cid:123)(cid:122)
:=Ψ−(t,x)

t

e−βsN (s)(cid:96)(cid:48)(cid:0)γ+

(cid:19)
t,x(s)(cid:1)ds

,

(4.16)

(cid:125)

e−βsN (s)(cid:96)(cid:48)(cid:0)γ−

(cid:19)
t,x(s)(cid:1)ds

.

(4.17)

(cid:125)

Note that both Ψ+ and Ψ− depend on x (as well as on t), via γ+

makes it necessary to take a closer look at γ+
depends on the control ν before (and up to) t. We have the following cases: for s ≥ t,

t,x and γ−

t,x and γ−

t,x. This dependence
t,x, since the x = x(t) involved in both

if x = γ+

0,x(t), then

γ+
+ (s) := γ+

if x = γ−

0,x(t), then γ−

− (s) := γ−

t,x(s) =

(cid:16)

t,x(s) =
(cid:16)

ν (cid:82) s
t
−ν (cid:82) s
t

du

N (u) + ν (cid:82) t
N (u) − ν (cid:82) t

du

0

0

N

du

N (u) + x
N (u) + x

du

N

N (s),
(cid:17)

N (s).

(cid:17)

(4.18)

(4.19)

18

WENPIN TANG AND DAVID YAO

+ corresponds to ν = ν both before and after t, whereas γ−

In other words, γ+
ν = −ν both before and after t. The other two cases are similar:
N (u) + ν (cid:82) t
N (u) − ν (cid:82) t

−ν (cid:82) s
t
(cid:16)
ν (cid:82) s
t

0,x(t), then γ−

− (s) := γ+
γ+

+ (s) := γ−

0,x(t), then

if x = γ+

if x = γ−

t,x(s) =

t,x(s) =

N (u) + x
N
(cid:17)
N (u) + x

du

du

du

du

(cid:16)

(cid:17)

N

0

0

− corresponds to

N (s),

(4.20)

N (s);

(4.21)

where γ−
to the other way around.

+ corresponds to ν = ν before (and up to) t and ν = −ν after t, and γ+

− corresponds

Substituting these four cases into Ψ+ and Ψ− in (4.16) and (4.17) further splits the latter

two into four cases:

+(t) := Ψ+(t, γ+
Ψ+
+(t) := Ψ−(t, γ+
Ψ−

0,x(t)), Ψ−
0,x(t)), Ψ+

−(t) := Ψ−(t, γ−
−(t) := Ψ+(t, γ−

0,x(t));
0,x(t)).

(4.22)

(4.23)

All four are now functions of t only, as x has been replaced by either γ+

0,x(t) or γ−

0,x(t).

Clearly, from (4.18)-(4.21) above, we have

∂tγ+

+ (s) = ∂tγ−

− (s) = 0,

∂tγ−

+ (s) =

2νN (s)
N (t)

> 0,

∂tγ+

− (s) = −

2νN (s)
N (t)

< 0.

(4.24)

Now, suppose (cid:96)(·) and h(·) are both smooth, convex (and increasing) functions. Hence,

(cid:96)(cid:48)(·) ≥ 0 and h(cid:48)(·) ≥ 0, and both are increasing functions. Then, it is readily veriﬁed:

(i) Both Ψ+

+(t) and Ψ−

−(t) are decreasing in t ∈ [0, T ], and so is Ψ+

−(t); whereas Ψ−

+(t)

could be both increasing and decreasing (i.e., non-monotone).

(ii) Furthermore, Ψ+

−(t) for all t ∈ [0, T ].

For instance, for Ψ+

+(t) ≥ Ψ−
+(t) in (i), consider
(cid:32)

∂tΨ+

+(t) = e−βT N (T )

h(cid:48)(cid:48)(γ+

+ (T ))∂tγ+
N (t)

+ (T )

−

h(cid:48)(γ+

+ (T ))N (cid:48)(t)
N 2(t)

(cid:33)

e−βsN (s)(cid:96)(cid:48)(γ+

+ (s))ds − e−βt(cid:96)(cid:48)(γ+

+ (t))

e−βsN (s)(cid:96)

(cid:48)(cid:48)

(γ+

+ (s))∂tγ+

+ (s)ds ≤ 0,

(4.25)

where ≤ 0 follows from ∂tγ+
two cases, ∂tΨ−

−(t) ≤ 0 and ∂tΨ+

+ (·) = 0 in both the ﬁrst and last terms on the RHS. The other

−(t) ≤ 0, are similarly veriﬁed.
As in the case of linear utility, the properties above can be used to compare against
(cid:101)Pβ(t) to identify the optimal trading strategy. Consider the case of (cid:101)Pβ(t) being a constant,
(cid:101)Pβ(t) = P (0) for all t ∈ [0, T ], as in part (i) of Proposition 4.1. If Ψ+
−(t) ≥ P (0)
for all t ∈ [0, t], then the optimal strategy is to buy all the time and at rate ν. If P (0) ≥
Ψ+

−(t) for all t ∈ [0, t], then it is optimal to sell all the time, at full capacity.

+(t) ≥ Ψ−

cannot be optimal, as it is impossible for Ψ+
Ψ+
can be optimal provided if Ψ−

− is decreasing in t. Similarly, Ψ−

+(t) is decreasing in t.

− corresponds to sell ﬁrst (before t) and then buy, this clearly
− ≥ P (0) after t, since
+ corresponds to buy ﬁrst (before t) and then sell, which

− ≤ P (0) before t and Ψ+

+(t) > Ψ−
On the other hand, since Ψ+

(cid:90) T

−

+

N (cid:48)(t)
N 2(t)
1
N (t)

t
(cid:90) T

t

TRADING UNDER POS

19

The details are stated in the following proposition; and see Figure 4 for an illustration.

Proposition 4.3. Assume that (cid:96)(·) and h(·) are twice continuously diﬀerentiable, convex,
and satisfy the conditions in Assumption 2.1. Assume that (cid:101)Pβ(t) stays constant, i.e. (cid:101)Pβ(t) =
P (0) for all t ∈ [0, T ]. Further assume the condition (4.8), and that t → Ψ−
+(t) is decreasing
then

(a) If P (0) ≥ Ψ+

+(T ) ∨ Ψ−(0, x), then ν∗(t) = −ν for all 0 ≤ t ≤ T . That is, the

participant sells at all time at full capacity.

(b) If P (0) ≤ Ψ−

+(T ), then ν∗(t) = ν for all 0 ≤ t ≤ T . That is, the participant buys at

all time at full capacity.

(c) If Ψ+

+(T ) < Ψ−(0, x) and Ψ−

+(T ) < P (0) < Ψ−(0, x), then

for t ≤ t0,
−ν for t > t0,
where t0 is the unique point in [0, T ] such that Ψ−
ﬁrst buys and after some time sells, both at full capacity.

ν∗(t) =

(cid:26) ν

(d) If Ψ−(0, x) < Ψ+

+(T ), then

(1) if Ψ−(0, x) < P (0) < Ψ+

participant sells at all time at full capacity.
+(T ) < P (0) ≤ Ψ−(0, x), then then

(2) if Ψ−

+(t) = P (0). That is, the participant

+(T ), then ν∗(t) = −ν for all 0 ≤ t ≤ T . That is, the

ν∗(t) =

(cid:26) ν

for t ≤ t0,
−ν for t > t0,

where t0 is the unique point in [0, T ] such that Ψ−
participant ﬁrst buys and after some time sells, both at full capacity.

+(t) = P (0). That is, the

Figure 4. Optimal stake trading with convex (cid:96)(·), h(·) when (cid:101)Pβ(t) is con-
stant, and Ψ+

+(T ) < Ψ−(0, x) (left) and Ψ+

+(T ) > Ψ−(0, x) (right).

5. Extension: Risk Control

In the previous sections, we have focused on proﬁt seeking objectives in which a participant
is more satisﬁed if he gets more stakes, or consumes more. In the modern ﬁnance literature,
Markowitz [15] pioneered the idea of balancing return and risk in any investment. This is
particularly important for cryptocurrency trading, as their volatility is often large. One basic

20

WENPIN TANG AND DAVID YAO

idea is that each participant’s holding of stakes are not too far away from others, so that
he will not bear a major level of risk caused by price ﬂuctuation/drawdown. Following [12]
(on stochastic games), it is reasonable to require that each participant k’s holding Xk(t) is
of all others. Since (cid:80)K
close to the the average
k=1 Xk(t) = N (t), this amounts to
requiring |Xk(t) − N (t)
K | as small as possible. In the consumption-investment setting, we add
a penalty term to control the level of stake holding of each participant:

j(cid:54)=k Xj (t)
K−1

(cid:80)

U (x) := sup

(cid:26) (cid:90) T

J(ν, b) := E

{ν(t),b(t)}

0

e−βt(dc(t) + (cid:96)(X(t))dt) + e−βT (b(T ) + h(X(T ))

−

(cid:90) T

0

e−δtg

(cid:18)

X(t) −

subject to X (cid:48)(t) = ν(t) +

N (t)
K
N (cid:48)(t)
N (t)

(cid:19)

dt − e−δT q

(cid:18)

X(T ) −

(cid:19) (cid:27)

N (T )
K

X(t), X(0) = x,

dc(t) + db(t) − rb(t)dt + P (t)ν(t)dt = 0,

b(0) = 0, b(t) ≥ 0 and 0 ≤ X(t) ≤ N (t),

|ν(t)| ≤ ν,

(5.1)

(C0)

(C1)

(C2)

(C3)

where δ > 0 is a discount factor (which may or may not be equal to β), and g : R → R+
and q : R → R+ are symmetric, and increasing on R+ (a typical example is g(x) = gx2 and
q(x) = qx2 with g, q > 0).

The theorem below follows the same argument as Theorem 3.4.

Theorem 5.1. Let the assumptions in Theorem 3.4 hold for the problem (5.1). Assume that
g, q ∈ C1(R) are symmetric, and increasing on R+. Then U (x) = v(0, x) where v(t, x) is the
unique viscosity solution to the following HJB equation:





∂tv + e−βt(cid:96)(x) − e−δtg
v(T, x) = e−βT h(x) − e−δT q

x − N (t)
K
(cid:16)
x − N (T )
K

(cid:16)

(cid:17)

,

+ xN (cid:48)(t)
N (t) ∂xv + sup|ν|≤ν{ν(∂xv − (cid:101)Pβ(t))} = 0
(cid:17)

in Q,

v(t, 0) = e−βth(0) − e−δtq

, v(t, N (t)) = e−βth(N (t)) − e−δtq

(cid:17)

(cid:16) N (t)
K

(cid:16) (K−1)N (t)
K

(cid:17)

.

(5.2)
Moreover, the optimal strategy is b∗(t) = 0 and ν∗(t) = ν∗(t, X∗(t)) for 0 ≤ t ≤ T∗
(if it exists), where ν∗(t, x) achieves the supremum in (3.19), and X∗(t) solves X (cid:48)
∗(t) =
ν∗(t, X∗(t)) + N (cid:48)(t)
N (t) X∗(t) with X∗(0) = x, and T∗ := inf{t > 0 : X∗(t) = 0 or N (t)} ∧ T .

In general, the HJB equation (5.2) does not have a closed-form solution even when (cid:96), h
are linear, and g, q are quadratic. Again it requires numerical methods to solve the HJB
equation, and then ﬁnd the optimal strategy ν∗. Nevertheless, there is one exception where
the participant is only concerned with the risk entailed by the stakes. The objective is to

solve the stake parity problem:

TRADING UNDER POS

U (x) := inf
ν(t)

J(ν) :=

e−δtg

(cid:18)

X(t) −

(cid:90) T

0

subject to X (cid:48)(t) = ν(t) +

N (t)
K
N (cid:48)(t)
N (t)

(cid:19)

dt + e−δT q

(cid:18)

X(T ) −

(cid:19)

N (T )
K

X(t), X(0) = x,

b(0) = 0, b(t) ≥ 0 and 0 ≤ X(t) ≤ N (t),

|ν(t)| ≤ ν.

21

(5.3)

(C0)

(C2’)

(C3)

Since g, h attain the minimum at 0, if x ≥ N/K, then the participant sells at full capacity until
hitting the average N (t)/K; if if x < N/K, then the participant purchases at full capacity
until hitting the average N (t)/K. We record this simple fact in the following proposition.

Proposition 5.2. Assume that g, q ∈ C1(R) are symmetric, and increasing on R+ for the
stake parity problem (5.3). Let γ+(t) be deﬁned by (3.7), and

γ−(t) := −νN (t)

(cid:90) t

0

ds
N (s)

+

xN (t)
N

for 0 ≤ t ≤ T,

(5.4)

and

(cid:26)

t± := inf

t > 0 : ν

(cid:90) t

0

ds
N (s)

= ±

(cid:18) 1
K

−

x
N

(cid:19)(cid:27)

.

(5.5)

Then, the following results hold.

(i) If x > N

and U (x) = (cid:82) T

(ii) If N

K < x ≤ N

(cid:17)

dt
N (t)
(cid:16)

(cid:16) 1
K + ν (cid:82) T
0
0 e−δtg
(cid:16) 1
K + ν (cid:82) T

0

, then the optimal strategy is ν∗(t) = −ν for all 0 ≤ t ≤ T ,
γ−(T ) − N (T )
K

dt + e−δT q

γ−(t) − N (t)
K

(cid:17)

(cid:17)

(cid:16)

.

(cid:17)

dt
N (t)

, then the optimal strategy is

and U (x) = (cid:82) t−
(cid:16) 1
K − ν (cid:82) T

0 e−βtg
(cid:17)
dt
N (t)

0

(iii) If N

ν∗(t) =

(cid:26) −ν for t ≤ t−,
for t > t−,

0

(cid:16)

γ−(t) − N (t)
K

(cid:17)

dt + g(0)
δ

(cid:0)e−δt− − e−δT (cid:1) + e−δT q(0).

≤ x < N

K , then the optimal strategy is

ν∗(t) =

(cid:26) ν for t ≤ t−,
0 for t > t−,
(cid:17)

and U (x) = (cid:82) t+

(cid:16)

γ−(t) − N (t)
K

dt + g(0)
δ

(cid:0)e−δt− − e−δT (cid:1) + e−δT q(0).

(iv) If x < N

and U (x) = (cid:82) T

0 e−βtg
(cid:16) 1
K − ν (cid:82) T
0
0 e−δtg

(cid:17)

dt
N (t)
(cid:16)
γ+(t) − N (t)
K

, the the optimal strategy is ν∗(t) = ν for all 0 ≤ t ≤ T ,
γ+(T ) − N (T )
K

dt + e−δT q

(cid:17)

(cid:16)

(cid:17)

.

Proof. (i) If x > N
, we have γ−(t) > N (t)/K for all 0 ≤ t ≤ T . By a
comparison argument, we get X(t) ≥ γ−(t) for all 0 ≤ t ≤ T given any feasible strategy ν(t).

0

(cid:16) 1
K + ν (cid:82) T

(cid:17)

dt
N (t)

22

WENPIN TANG AND DAVID YAO

Since g, q are increasing on R+, we obtain
(cid:90) T

(cid:18)

e−δtg

X(t) −

N (t)
K

(cid:19)

dt + e−δT q

(cid:18)

X(T ) −

(cid:19)

N (T )
K

0
(cid:90) T

0

≥

e−δtg

(cid:18)

γ−(t) −

(cid:19)

N (t)
K

dt + e−δT q

(cid:18)

γ−(T ) −

(cid:19)

,

N (T )
K

which yields the desired result.
K < x ≤ N

(cid:16) 1
K + ν (cid:82) T

(ii) If N

(cid:17)

dt
N (t)

, we have γ−(t) > N (t)/K for 0 ≤ t < t− and
γ−(t−) = N (t−)/K. Again by the comparison argument, X(t) ≥ γ−(t) for 0 ≤ t ≤ t− given
any strategy. Thus,

0

(cid:90) T

e−δtg

(cid:18)

X(t) −

(cid:19)

N (t)
K

dt + e−δT q

(cid:18)

X(T ) −

(cid:19)

N (T )
K

0
(cid:90) t−

0
(cid:90) t−

0

=

≥

e−δtg

(cid:18)

X(t) −

(cid:19)

N (t)
K

dt +

(cid:90) T

t−

(cid:18)

e−δtg

X(t) −

(cid:19)

N (t)
K

dt + e−δT q

(cid:18)

X(T ) −

(cid:19)

N (T )
K

e−δtg

(cid:18)

γ−(t) −

(cid:19)

N (t)
K

dt + g(0)

(cid:90) T

t−

e−δtdt + eδT g(0),

which permits to conclude.

(iii) and (iv) follow the same argument as (1) and (2).

(cid:3)

6. Conclusion

We have developed in this paper a continuous-time control approach to the optimal trad-
ing under the PoS protocol, formulated as a consumption-investment problem. We present
general solutions to the optimal control via dynamic programming and the HJB equations,
and in the case of linear and utility functions, close-form solutions in the form of bang-bang
controls. Furthermore, we bring out the explicit connections between the rate of return in
trading/holding stakes and the participant’s risk-adjusted valuation of the stakes, such that
the participant’s risk sensitivity is explicitly accounted for in the trading strategy. We have
also studied a risk-control version of the consumption-investment problem, and for a special
case, the “stake-parity” problem, we show a mean-reverting strategy is the optimal solution.
While our focus here is entirely on an individual participant’s trading strategy in a PoS
protocol, it is possible to study the interactions among the participants, and formulate the
problem of trading in a PoS protocol as a game (deterministic or stochastic), and to study
issues such as equilibrium, social welfare, and the inclusion of a trusted third party (or market
maker). This will be our focus of a follow-up paper.

Acknowledgement: W. Tang gratefully acknowledges ﬁnancial support through an NSF
grant DMS-2113779 and through a start-up grant at Columbia University.

[1] H. Alsabah and A. Capponi. Pitfalls of Bitcoin’s Proof-of-Work: R&D arms race and mining centraliza-

tion. 2020. SSRN:3273982.

References

TRADING UNDER POS

23

[2] L. Ambrosio. Transport equation and Cauchy problem for non-smooth vector ﬁelds. In Calculus of vari-
ations and nonlinear partial diﬀerential equations, volume 1927 of Lecture Notes in Math., pages 1–41.
Springer, Berlin, 2008.

[3] N. Arnosti and S. M. Weinberg. Bitcoin: A natural oligopoly. Management Science, 2022.
[4] C. Bertucci, L. Bertucci, J.-M. Lasry, and P.-L. Lions. Mean ﬁeld game approach to Bitcoin mining. 2020.

arXiv:2004.08167.

[5] C. Bertucci, L. Bertucci, J.-M. Lasry, and P.-L. Lions. How resilient is the Bitcoin protocol? 2022.

SSRN:3907822.

[6] J. Chiu and T. V. Koeppl. The economics of cryptocurrencies–Bitcoin and beyond. 2017. SSRN:3048124.
[7] J. Chod, N. Trichakis, G. Tsoukalas, H. Aspegren, and M. Weber. On the ﬁnancing beneﬁts of supply

chain transparency and blockchain adoption. Management Science, 66(10):4378–4396, 2020.

[8] F. Donovan. Healthcare

blockchain

HIT
healthcare-blockchain-could-save-industry-100b-annually-by-2025.

Infrastructure,

2019.

could
Available

save
at

industry

2025.
https://hitinfrastructure.com/news/

annually

by

$100b

[9] W. Duggan and F. Powell. What is Ethereum 2.0? understanding the merge. Avalialbe at https://www.

forbes.com/uk/advisor/investing/cryptocurrency/what-is-ethereum-2/, year=2022,.

[10] W. H. Fleming and H. M. Soner. Controlled Markov processes and viscosity solutions, volume 25 of

Stochastic Modelling and Applied Probability. Springer, New York, second edition, 2006.

[11] F. Golse. Mean ﬁeld kinetic equations. 2013. Available at http://www.cmls.polytechnique.fr/perso/

golse/M2/PolyKinetic.pdf.

[12] X. Guo, W. Tang, and R. Xu. A class of stochastic games and moving free boundary problems. SIAM J.

Control Optim., 60(2):758–785, 2022.

[13] S. King and S. Nadal. Ppcoin: Peer-to-peer crypto-currency with proof-of-stake. 2012. Available at

https://decred.org/research/king2012.pdf.

[14] Z. Li, A. M. Reppen, and R. Sircar. A mean ﬁeld games model for cryptocurrency mining. 2019.

arXiv:1912.01952.

[15] H. M. Markowitz. Portfolio selection: Eﬃcient diversiﬁcation of investments. Cowles Foundation for

Research, Monograph 16. John Wiley & Sons, Inc., New York, 1959.

[16] C. Mora, R. L. Rollins, K. Taladay, M. B. Kantar, M. K. Chock, M. Shimada, and E. C. Franklin. Bitcoin

emissions alone could push global warming above 2 c. Nat. Clim. Change, 8(11):931–933, 2018.

[17] S. Nakamoto. Bitcoin: A peer-to-peer electronic cash system. Decentralized Business Review, page 21260,

2008.

[18] S. Osher and C.-W. Shu. High-order essentially nonoscillatory schemes for Hamilton-Jacobi equations.

SIAM J. Numer. Anal., 28(4):907–922, 1991.

[19] M. Platt, J. Sedlmeir, D. Platt, P. Tasca, J. Xu, N. Vadgama, and J. I. Iba˜nez. Energy footprint of

blockchain consensus mechanisms beyond proof-of-work. 2021. arXiv:2109.03667.

[20] I. Ro¸su and F. Saleh. Evolution of shares in a proof-of-stake cryptocurrency. Manag. Sci., 67(2):661–672,

2021.

[21] F. Saleh. Blockchain without waste: Proof-of-stake. The Review of Financial Studies, 34(3):1156–1190,

2021.

[22] P. E. Souganidis. Approximation schemes for viscosity solutions of Hamilton-Jacobi equations. J. Diﬀer-

ential Equations, 59(1):1–43, 1985.

[23] W. Tang. Stability of shares in the Proof of Stake protocol – concentration and phase transitions. 2022.

arXiv:2206.02227.

[24] W. Tang and D. D. Yao. Polynomial voting rules. 2022. arXiv:2206.10105.
[25] Q. Wang, R. Li, Q. Wang, and S. Chen. Non-fungible token (NFT): Overview, evaluation, opportunities

and challenges. 2021. arXiv:2105.07447.

[26] A. Wood. West Virginia

2018

in
west-virginia-secretary-of-state-reports-successful-blockchain-voting-in-2018-midterm-elections.

elections.

midterm

at

secretary
2018.

of

state
Avalialbe

reports

successful

voting
https://cointelegraph.com/news/

blockchain

[27] G. Wood. Ethereum: A secure decentralised generalised transaction ledger. Ethereum Project Yellow

Paper, 151:1–32, 2014.

24

WENPIN TANG AND DAVID YAO

Department of Industrial Engineering and Operations Research, Columbia University.

Email address: wt2319@columbia.edu

Department of Industrial Engineer and Operations Research, Columbia University.

Email address: yao@columbia.edu

