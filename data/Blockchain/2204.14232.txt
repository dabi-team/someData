2
2
0
2

r
p
A
7
2

]

R
P
.
n
i
f
-
q
[

1
v
2
3
2
4
1
.
4
0
2
2
:
v
i
X
r
a

Panoptic: a perpetual, oracle-free options protocol

Guillaume Lambert1, 2, ∗ and Jesper Kristensen2, †
1The School of Applied and Engineering Physics,
Cornell University - Ithaca NY
2Advanced Blockchain Research

(Dated: April 27, 2022, v1.2)

Panoptic is a perpetual, oracle-free, instant-settlement options trading protocol on the
Ethereum blockchain. Panoptic enables the permissionless trading of options on top of
any asset pool in the Uniswap v3 ecosystem and seeks to develop a trustless, permission-
less, and composable options product, i.e., do for decentralized options markets what
x·y=k automated market maker protocols did for spot trading.

I. INTRODUCTION

Options are a foundational

infrastructure for any
healthy ﬁnancial system, both in Traditional and Decen-
tralized Finance. Options trading volumes for crypto-
graphic assets like BTC and ETH have grown signiﬁ-
cantly in the last years (Khatri, 2021) on centralized ex-
changes such as Deribit (Deribit, 2022), and on-chain op-
tions protocols have also recently gained signiﬁcant trac-
tion.

According to DeFi Llama data (Llama, 2022), there
are already more than 30 on-chain options protocols with
a Total Value Locked (TVL) exceeding $830 million.
While most of these options protocols emulate Tradi-
tional/Legacy Financial Markets (TradFi), the reliance
on Call and Put options with ﬁxed expiration dates and
pre-speciﬁed strike prices fragments liquidity and makes
adjusting positions expensive and cumbersome. More-
over, accurate pricing of options via the Black-Scholes
model might not be readily achievable since all the oper-
ations that occur on-chain come with signiﬁcant technical
limitations. Finally, on-chain option protocols are funda-
mentally limited by the quality and availability of their
oracles, which rules out a large number in the long-tail
of assets traded on decentralized exchanges.

This whitepaper introduces the Panoptic protocol,
a “DeFi-native” perpetual options protocol that aims
to overcome the technical
limitations and challenges
that plague other on-chain options protocols. Panoptic
achieves this by relying on trading activity on Uniswap
v3 (Adams et al., 2021) to disintermediate the settlement
of options contracts. Speciﬁcally, the Panoptic protocol
utilizes Uniswap v3 Liquidity Provider (LP) positions as
a core primitive for trading long and short options (Lam-
bert, 2021b). The Panoptic protocol consists of smart
contracts that can directly interact with any Uniswap v3

∗ guillaume@advancedblockchain.com
† jesper@advancedblockchain.com

pool contract to handle the minting, trading, and market-
making of perpetual put and call options in a permission-
less, trustless, and capital-eﬃcient manner.

The Panoptic protocol implements the following key

innovations:

1. Permissionless options: All options in Panop-
tic are based on relocating liquidity within Uni v3
pools: moving liquidity closer to the spot price is a
short option position, and moving it away from the
spot price corresponds to a long option position.

2. Oracle-less Black-Scholes pricing: Options
pricing is based on a streaming premium model,
where the premium initially starts at zero and in-
creases over time according to a path-dependent
pricing formula that converges to the Black-Scholes
pricing model.

3. Distinct user roles: Buyers and sellers will mint
long and short options by directly interacting with
the Panoptic smart contracts. Liquidity Providers
(LPs) will provide fungible liquidity to the Panoptic
pool without risking their capital.

4. Disentanglement of trading fees and LP re-
wards: LPs will accumulate yields by “lend-
ing” their liquidity to options sellers and buyers
for a small fee. Options buyers and sellers will
pay/receive a premium proportional to the fees gen-
erated by their Uni v3 options position.

5. Risk Management: Options sellers will bear
most of the risk in the protocol. Options sellers
will be able to sell undercollateralized options (up
to 5x capital eﬃciency). Multi-leg options instru-
ments with up to four puts/calls can also be de-
ployed in a single transaction.

6. Composability: Multi-legged Panoptic options
with user-deﬁned payoﬀs can be tokenized as
ERC1155 tokens. These tokens will be tradable and
composable with other DeFi/staking protocols.

 
 
 
 
 
 
2

The rest of the whitepaper covers i) Panoptic options
(Panoptions) instrument based on Uni v3 LP positions;
ii) an options premium model that accurately reﬂects the
risk/reward of an option; iii) the Panoptic ecosystem and
strategies for minting options; iv) how the protocol help
its users mitigate risks; v) Panoptic’s key design princi-
ples, applications and network eﬀects.

II. PANOPTIC OPTION INSTRUMENTS

Options in Panoptic—Panoptions—are distinct from
TradFi options: they do not expire, they can be deployed
at any strike, and their value does not decay over time.
Panoptions trace their origin to the simple observation
that providing concentrated liquidity in Uniswap v3 (Uni
v3) is analogous to selling options in traditional ﬁnance
(Lambert, 2021b). From the Uni v3 whitepaper (Adams
et al., 2021):

FIG. 1 Left: Deploying liquidity above the current spot price
S (at origin) creates a range order which converts ETH to
DAI as the price moves between the Lower and Upper ticks.
The abscissa is the price of ETH vs Dai, the ordinate is the
proﬁt earned or the payoﬀ curve, K is the price deployed to
and serves as the strike price in the option-equivalent view.
Right: Building on the left subplot, deploying liquidity to a
narrow, single-tick range creates a “covered call-like” payoﬀ
where the ETH is sold immediately as the spot price crosses
the strike K.

Uniswap v3 is a noncustodial automated mar-
ket maker implemented for the Ethereum Vir-
tual Machine. In comparison to earlier ver-
sions of the protocol, Uniswap v3 provides
increased capital eﬃciency and ﬁne-tuned
control to liquidity providers, improves
the accuracy and convenience of the price or-
acle, and has a more ﬂexible fee structure.

Hence, unlike in Uni v2 where liquidity is distributed
uniformly along the price curve from zero to inﬁnity, con-
centrated liquidity allows LPs to allocate liquidity within
a custom price range and on a set of price ticks (thus, in
Uni v3 the price range is discrete). Concentrated liq-
uidity thus improves capital eﬃciency and oﬀers better
control over where liquidity is deployed within a pool. As
outlined by Lambert (Lambert, 2021b), Uni v3 liquidity
positions eﬀectively behave as two familiar types of op-
tions: cash-secured puts 1 and covered calls (Kristensen
et al., 2022).

For instance, if we consider the value of a DAI-ETH
LP position deployed to a single tick, the position will
be 100% ETH exactly below the tick, and 100% DAI ex-
actly above the tick, as illustrated in Fig. 1. The payoﬀ
of this position is identical to a covered call option. Un-
like regular options, however, LP tokens do not expire
and assignment for Uni v3 options is reversible. Thus,
the token composition of the LP position will shift be-
tween num´eraire (e.g., DAI) and asset (e.g., ETH) every
time the strike price is crossed. Fees will be accumulated
every time this crossing occurs (as shown for DAI-ETH
in Fig. 2), and one could consider these fees as a short
option premium that grows over time.

1 Check the glossary at the end of this whitepaper for deﬁnitions

of all the terms used.

FIG. 2 LP covered calls. Single-tick liquidity accumulates a
ﬁxed 0.3% fee each time the asset price visits the tick value.

Hence, current liquidity providers in Uni v3 are already
deploying short option positions and are already receiv-
ing a premium-like compensation for the risk they take
by collecting fees. Theoretically, enabling the shorting an
LP position would eﬀectively result in the same payoﬀ as
buying a long option. However, implementing a lending
protocol for Uni v3 LP positions is challenging because
each LP position is unique and nonfungible.

The Panoptic protocol solves the constraints by facili-
tating the minting and lending of liquidity from Liquidity
Providers to option sellers, making it possible to create
long and short options based on tokenized concentrated
liquidity positions in Uni v3. The rest of this section
provides more details about how Panoptic options work.

A. Panoptic put options

Panoptic enables the deployment of long and short put
options. The mechanism adopted by Panoptic for deploy-
ing a short put option at price K corresponds to locking K
num´eraire at a strike price K (Fig. 3). Conversely, remov-
ing K num´eraire of liquidity at price K creates a long put
option. In other words, users can create a long option by
“borrowing” a short option.

Let us consider what happens to an ETH-DAI option

LowertickKUppertickK-SCurrentPrice SPriceProfitLoss1 ETHK Daistrike KK-SCurrentPrice SPriceProfitLoss1 ETHK DaiRange OrderLP Covered Call2500PriceProfitLossfees (0.3% per visits)1 ETH2500 Dai2021-06-172021-06-162021-06-152021-06-142021-06-132021-06-122021-06-112021-06-102021-06-092021-06-08220023002400250026002700ETH price1 ETH2500 Dai0.3% fee per visitDeposited 1 ETHSpot price = 2400 DaiBreak-Even Point: 2400 - fees2400Profit: 100 + fees0.3%0.3%>0.3%>0.3%3

FIG. 3 Liquidity is moved away from the current price S for long (i.e., buying) options and moved closer to the current price
for short (i.e., selling) options. In the top row, the x-axis represents the price of ETH in DAI and the y-axis is the liquidity
amount deployed in each given price range. Note that the Panoptic pool represents a contract where funds are sent to and
received from; in the illustration this is represented as a pool of liquidity far away from the price range. The bottom row shows
the resulting payoﬀ, or proﬁt, curves. Left: Puts. Right: Calls.

as the price crosses the strike price K. When the spot
price is above the strike price K, the option is out-the-
money (OTM). This means that the K DAI initially re-
located to the K price tick is still worth K DAI. Thus the
option may be closed by simply moving the K DAI back
to the DAI liquidity pool with no cost.

If the spot price is below the strike price K, the op-
tion is in-the-money (ITM). If the position is a long put,
closing the position would require the user to supply 1
unit of ETH to get K num´eraire back, i.e., the put op-
tion guarantees that the buyer can sell 1 ETH for K DAI,
regardless of the ETH price.

If the position is a short put, the user would close the
position by removing 1 ETH at strike price K and sup-
plying K DAI back to the DAI liquidity pool, i.e., the
option seller is obligated to purchase 1 ETH for K DAI,
irrespective of the ETH price.

Note that an option writer/seller will relocate liquidity
owned by the Panoptic liquidity pool, not their own when
deploying an option. Similarly, the protocol will lock the
relocated liquidity to the Panoptic liquidity pool when
an option is purchased. This ensures that the Panop-
tic protocol can access the relocated funds and enables
undercollateralized options writing (Section V).

B. Panoptic call options

In theory, long call options can be synthetically created
by leveraging the put-call parity and combining a long
put with a long asset position. More details about the
creation of synthetic call positions can be found in (Lam-
bert, 2021c). However, Panoptic avoids the creation of
a short stock position because, at a fundamental level, a
call at strike K in an ETH-DAI pool is identical to a put
at strike 1/K in a DAI-ETH pool (where the num´eraire
is now ETH).

In other words, when minting a short call, a user would

need to remove 1/K ETH from the ETH liquidity pool and
lock it at a strike price K. Similarly, a long call would
remove 1/K ETH at a strike price K and lock it in the
ETH liquidity pool.

Fig. 3 illustrates Panoptic mechanism for call options
and the corresponding proﬁt curve for long and short call
options as a function of the spot price.

If the spot price is above the strike price K, the call
option is in-the-money (ITM). If the position is a long
call, the user would close the position by collecting 1/K
ETH from the ETH liquidity pool at depositing 1 DAI at
strike price K, i.e., a long call guarantees that the buyer
can buy ETH for K DAI/ETH, irrespective of the ETH
price. Closing a short call would require the user to sup-
ply 1/K ETH to the ETH liquidity pool and get 1 unit
DAI back from strike K, i.e., the short call owner is ob-
ligated to sell ETH for K DAI/ETH, irrespective of the
price of ETH.

C. Limiting Gamma exposure

One key advantage of Panoptic options over regular op-
tions is the ability to create options with a ﬁxed range,
resulting in an options with a ﬁxed Gamma.
In other
words, the Gamma of an option can be capped by widen-
ing the range of an options position. Examples of wide-
range positions are shown in Fig. 4.

Speciﬁcally, options traders can utilize the relationship
between the range factor r = (cid:112)priceUpper/priceLower
of a position and its eﬀective days-to-expiration Tr and
an asset volatility σ derived in (Lambert, 2021a) and
given by:

Tr =

(cid:18) √
√

(cid:19)2

.

r − 1
r + 1

2π
σ2

Controlling the range factor r will eﬀectively prevent
options from ever reaching “expiration” and capping its

PanopticPoolKSPanopticPoolLiquidityK DaiBuying a PutKSPremium PProfitPanopticPoolKSPanopticPoolK DaiSelling a PutKSPremium PLossPanopticPoolSKPanopticPoolLiquidity1 ETHBuying a CallSKPremium PProfitPanopticPoolSKPanopticPool1 ETHSelling a CallSKPremium PLoss4

or synthetic equity positions.

III. ORACLES-LESS BLACK-SCHOLES PRICING

Option positions in Panoptic have no expiration. This
makes pricing them quite diﬀerent from vanilla options
whose price can easily be derived from the Black-Scholes
model given a time to expiration. While everlasting op-
tions with a constant funding rate have been proposed
elsewhere (White and Bankman-Fried, 2021), they rely
on oracles and the constant rebalancing may be expen-
sive to execute on-chain. To accurately price options,
the Panoptic protocol will use a novel oracle-free concept
called streaming premium.

A. Streaming premium model

The key diﬀerence between the pricing of regular op-
tions and the streaming premium model is that, instead
of requiring the users to pay for their options upfront,
the pricing of an option is path-dependent and will grow
at each block according to the proximity of the spot price
to the option strike price.

Formally, this corresponds to continuously integrating
the theta of the option. Note that the theta of an option
is deﬁned as the derivative of the option’s value with
respect to time. Assuming a zero risk-free interest rate,
the theta of an option is deﬁned as:



θ =

dV (S, t)
dt

=

√

Sσ
8πt

exp


−

(cid:104)
ln (cid:8) S0

(cid:9) + σ2t
K
2σ2t

2

(cid:105)2






FIG. 5 Structure of a Panoptic composite ERC1155 option
token. Up to four distinct options can be combined in a single
ERC1155 token to facilitate collateral requirement tracking.

FIG. 4 Left: Long OTM call with wide range (ﬁxed-gamma
option) Right: Long ITM call with ﬁxed-gamma.

Gamma to 2/(K ∗ π ∗ ln(r)). Since r > 1, the value
of Gamma will never diverge to inﬁnity as the position
approaches expiration. This will in turn completely elim-
inate pin risk, which manifests itself in TradFi when op-
tions approach expiration and rapidly shift between being
ITM and OTM if the price is near the strike price.

In addition, since pricing of Panoptions relies on a
path-dependent mechanism (see Section III for more de-
tails), widening options also smooths out how quickly the
price of an option increases over time.

D. Panoptic ERC1155 composite option token

Panoptic will allow users to sell undercollateralized op-
tions as a core element of the protocol (section IV). This
is in contrast to all other on-chain option protocols (ex-
cept Opyn v2), which always require all positions to be
100% backed by collateral. Panoptic will allow the cre-
ation of undercollateralized options by using margin ac-
count collateral requirements similar to those developed
by traditional ﬁnancial institutions.

Another way Panoptic can reduce the collateral re-
quirements of an option is by combining many of them
into a single ERC1155 token to create deﬁned-risk posi-
tions. Speciﬁcally, the 256-bit ID of an ERC1155 will
be used to encode information about up to four diﬀerent
options within the same pool. The data encoded within
each ERC1155 token is shown in Fig 5.

Combining several options into a single token allows
the protocol to easily calculate the collateralization re-
quirements of a set of interlinked options. This is espe-
cially important when creating multo-legged options po-
sitions that may have a risk-deﬁned proﬁle even though
each individual option may theoretically be exposed to
inﬁnite losses, e.g., a call spread’s max loss is capped at
the distance between the long and short call even though
the short leg has inﬁnity risk.

In addition, tokenizing complex option strategies could
also facilitate the deployment of vault-like instruments
which could, for instance, allow users to participate in
vault based on short 16∆ strangles, 30∆ Jade Lizards,

2KKSLiquidity1 ETHBuying Ranged CallSK2KPremium P2K-PProfitKS2KK Dai1 ETHBuying ITM Ranged CallKS2KK/S-1 ETH2K-S DaiLossERC1155 ID: 256 bitsUniswap pool:80 bitsOption 4:40 bitsOption 1:40 bitsRatios:16 bitswidth (12 bits)strike (24 bits)Put/Call(1 bit)Long/Short(1 bit)quantity ofoption 4(4 bits)quantity of option 1(4 bits)[...][...][...]Defined risk partner (2 bits)Here, S denotes the underlying asset spot (or current)
price, σ is the asset’s volatility, K is the strike price, and
t is the time to expiration. It is easy to show that one
can recover the option’s value by integrating theta over
time and assuming that the price remains constant (S0):

V (S0 = constant, t) =

(cid:90) T

0

θ(S0, t)dt

= Call option price C(S0, K, T )

If S0 is not constant, however, one could ask whether it
is possible to recover the call option price via integrating
over the asset spot price history S(t), i.e.:

Premium P =

(cid:90)

S(t)

θ(St, K, σ)dt

(1)

This corresponds to integrating θ over the stochastic
price path S(t).

Computing the option premium using Eq. 1 may re-
sults in two unexpected extremal outcomes. First, an
option on an asset whose spot S(t) never comes inside
the price range deﬁned by range of the option will cost
nothing. Second, if the asset price does visit the price
range deﬁned for the strike price, the option premium
will increase according to the time it spends close (i.e.,
inside the price range) to the strike price, which may be
several times larger that the Black-Scholes premium.

B. Convergence to Black-Scholes pricing model

Will “integrating theta over the price S(t)” result in
an fair options pricing? To answer this, we compute the
average value of an option over all possible price paths
S(t) by performing a Monte Carlo simulation to compute
the integral of theta over time for thousands of simulated
price paths based on Geometric Brownian Motion.

Interestingly, the result does converge to the Black-
Scholes price, but the distribution of option price can
be quite large (Fig. 6). Indeed, since pricing depends on
the speciﬁc price path, the option cost may be zero if
the asset spot price never touches the strike price (i.e.,
never stays inside a price range deﬁned by Panoptic), or
it might be much higher in case the spot price touches
the strike price repeatedly. We ﬁnd that approximately
33% of all streaming option premium for a call option
held for 7 days would cost zero (Fig. 6).

On the other hand, the actual cost of the option may
be higher than Black-Scholes’ prediction. Since users will
only have to pay for an option if it is ITM, there is al-
ways a possibility that the asset spot price may touch
the strike price many times and still end up OTM and
have no intrinsic value. Our results show that 16% of
all streaming option premium would be twice as large as
Black-Scholes.

5

FIG. 6 Top: Three simulated price paths accumulate diﬀer-
ent amounts of fee/premium compared with the Black-Scholes
price. Bottom Right: Distribution of the collected premium
agrees with the Black-Scholes price on average. Bottom
Left: Coeﬃcient of variation (deﬁned as standard deviation
/ mean) of the price of a streaming call option as a function
of the time held. Parameters: Implied volatility=100% per
year taking a Monte Carlo step every minute.

Together, the simulation results indicate that the price
of an option will heavily depend on the history of the as-
set price, with many options that spent all their time
OTM being worth exactly zero or hovering around the
strike price and being worth much more than the Black-
Scholes price. Fig. 6 shows that the coeﬃcient of varia-
tion, deﬁned as the ratio of the standard deviation of the
option price to its mean, approaches 82% when held for
more than ten days.

FIG. 7 Left: Theta vs. option price for diﬀerent days to
expiration (DTE). Right: 1-tick wide position as an approx-
imation of a 0.1 DTE option’s theta.

-20%-10%ATM+10%+20%Price0.000.050.100.15theta0.1 DTE1 DTE7 DTE-20%-10%ATM+10%+20%Price0.000.050.100.151-tick0.1DTEC. Option pricing and implied volatility

As described above, the option premium is computed
by directly integrating the price-dependent value of theta
over time. One can think of a streaming premium pricing
model as a series of continuously expiring options that
accumulate a premium θ∆t at every time step ∆t.

When it comes to choosing an appropriate value for ∆t,
let us ﬁrst consult Fig. 7, which shows the theta value of
an option versus price, for 7 Days to Expiration (DTE),
1 DTE, and 0.1 DTE. As the time interval ∆t approaches
zero, the option’s theta starts looking like a Dirac delta
function with a ﬁxed width given by the full-width half
max.

Hence, if we assume that the width of the delta func-
tion is the tick spacing of a Uni v3 pool (i.e., tickSpac-
ing tS = 0.02 for 1%, 0.006 for 0.3%, 0.001 for 0.05%),
then the value of theta can be approximated as the time
spent inside the range multiplied by the height of the
delta function. Since the area under the theta function is
k2σ2/2 and the width is k·tS (prescribed by the tickSpac-
ing tS), then the height will be kσ2/2tS.

This

corresponds

(time spent in range).

k2σ2/2tS ·
ing the
collected by Uni v3 pool per unit
feeRate · (Volume · Time)/tickLiquidity),
plied volatility (IV), σ, can be derived as:

cumulative premium to the actual
time
the

to a cumulative premium of
compar-
fees
(i.e.,
im-

By

IV ≡ σ = 2 · feeRate ·

(cid:114) Volume

tickLiquidity

Interestingly, this value for IV is in perfect agreement
with the one derived using a completely diﬀerent ap-
proach (Lambert, 2021d).
In other words, using the
amount of fees collected as a measure of the option pre-
mium results in IV that depends on the traded volume
and the amount of liquidity at the position’s tick, and
not on the option’s realized volatility derived from ac-
tual market price ﬂuctuations.

IV. PANOPTIC ECOSYSTEM

Panoptic ecosystem participants will include liquidity
providers, options buyers, and options sellers. Their roles
are summarized as follows:

Liquidity Providers: Provide fungible liquidity to the
options market. They will be able to sell options
against their liquidity at favorable rate (ie. zero
commission), provided their collateralization ratio
is larger than 100%.

Option Sellers: Sell options by borrowing liquidity for
a ﬁxed commission fee (initially set at 0.1%) and

6

relocating it to a Uni v3 pool. Sellers have to de-
posit collateral and can sell options with notional
values close to ﬁve times larger than their collateral
balance.

Option Buyers: Buy options by moving liquidity out
of the Uni v3 pool back to the Panoptic smart con-
tract for a ﬁxed commission fee of 0.1%. Buyers
also have to deposit collateral (10% of the notional
value of the option) to cover the potential premium
to be paid to the sellers.

A. Liquidity Providers

Liquidity Providers (LPs) will provide liquidity to the
Panoptic smart contract by depositing assets into the
option pool in the form of a single type (e.g., USDC or
ETH). However, the net goal of LPs is to provide liquidity
that can be borrowed and relocated to a Uni v3 pool
rather than providing liquidity for spot trading directly.
At the time of deposit, the amount of liquidity de-
posited by the LP into the Panoptic pool will be recorded
into the Panoptic smart contract and will be emitted as
an ERC20 tokens tracking the LP’s share of the pool.

As buyers and sellers mint options, the liquidity de-
posited by the LPs in the pool will be deployed to the
Uni v3 core pool contract. Option sellers will borrow the
LPs’ liquidity for a ﬁxed commission fee (initially set to
0.1% of the notional value) to create short put or call op-
tions. LPs would anticipate that option sellers are savvy
market participants that will optimize liquidity alloca-
tion to their beneﬁts. Fees collected from that deployed
position, which will be composed of both token0 and
token1, will be distributed to the option seller minus a
spread that depends on the amount of available liquidity
in the Uniswap pool.

Option buyers will move liquidity from the Uniswap
pool back to the Panoptic liquidity pools. LPs will also
collect a small commission based on the notional value of
all relocated liquidity (initially set to 0.1%).

LPs will also be able to sell options against their liq-
uidity and they will pay zero commission fee as long as
the value of the LP’s collateral is larger than the notional
value of all their options. In other words, the commission
will be waived if LPs sell options that are fully collater-
alized.

When a LP exits their liquidity from the option pool,
Panoptic will burn their ERC20 tokens, and the LP will
receive it share of the option pool, including collected
fees. However, depending on the locked liquidity for open
option positions, some of the LP liquidity might be un-
available. That liquidity will be released/available once i)
the long positions are closed; or ii) LPs force the exercise
of far OTM long options.

B. Option sellers

asset for calls)

7

Short options are minted by moving liquidity from
Panoptic to the Uni v3 pool as long as it is below the spot
price for puts and above the spot price for calls. Sellers
will have to deposit some funds as collateral whenever
selling puts and calls. The amount of collateral needed
for deploying a short option will be less than 100%: when
an options is sold, the collateral requirement will be set to
20% of the exercise value plus the option’s ITM amount.
The option seller will pay a ﬁxed commission fee ini-
tially set to 0.1% when minting an option that will be
proportional to the notional value of the option (i.e., the
amount of liquidity that was relocated). Sellers may mint
several option positions in a single transaction, and the
combination of up to four options will be stored inside
the smart contract as a single ERC1155 as an int256 bit.
Combining options as a single ERC1155 instrument will
greatly simplify collateral requirement computations.

When closing a short option, the user will have to re-
pay the exact amount of tokens that was borrowed to
the liquidity pool. Furthermore, they will receive an op-
tion premium from the liquidity pool that corresponds
to the amount of fees that was collected by the deployed
liquidity.

C. Option buyers

Buyers may also mint several option positions in a sin-
gle transaction, which will be stored inside the smart con-
tract as a single int256 bit. Note that options can only be
bought if option sellers/writers have already minted/sold
them, hence make the options sellers an essential actor
in the Panoptic ecosystem whose role may need to be
incentivized.

The buyer will have to deposit some funds as collateral
to cover future options premium to be paid to the option
seller. The collateral amount equal to 10% of notional
corresponds to the maximum price that would be paid
for a 45 DTE option with IV equal to 75%.

The option buyer will also pay a ﬁxed 0.1% commis-
sion fee when minting option, which will be proportional
to the notional value of the option (i.e., the amount of
liquidity that was relocated).

When exercising a long option, the user will have to
repay the exact amount of tokens that was borrowed to
the liquidity pool. In addition, they will have to pay an
option premium to the liquidity pool as a single asset,
which corresponds to the amount of fees collected by the
deployed liquidity plus a spread that depends on the liq-
uidity in the Uniswap pool when the option was created.
However, since ITM options involve the transfer of both
tokens in a single transaction, the amount of premium
paid will be deducted from the option’s exercise amount
(eg. deducted from the num´eraire for puts and from the

D. Total, Notional, and Locked Liquidity

The amount of

tracked using three

liquidity in a Panoptic pool will
the
storage variables
be
whole pool:
totalLiquidity, totalNotionalValue,
and totalLockedLiquidity. The liquidity for each
account will also be tracked using three storage
userLiquidity(userAddress),
callable
userNotionalValue(userAddress, positionList),
and userLockedLiquidity(userAddress, positionList).

functions:

for

• The totalLiquidity variable tracks the total
amount of liquidity deposited by LPs. The amount
deposited by each user will be tracked using
userLiquidity(userAddress).

• The totalNotionalValue variable will

track
the amount of liquidity that has been moved to
the Uni v3 pool, which is equal to the notional
value of all the sold options. The amount of no-
tional value for each account will be reported using
userNotionalValue(userAddress, positionList,
where the function requires the list of positions as
an input.

• The totalLockedLiquidity variable will track the
amount of liquidity relocated from the Uni v3 pool
to the Panoptic pool by option buyers. Liquidity
needs to be “locked” because, when liquidity
is moved back to the Panoptic pool by option
buyers, it needs to be available when the option
is exercised. The amount of locked liquidity for
each user account will also be computed using the
userLockedLiquidity(userAddress, positionList
call function.

Note: since a user account may own hundreds of options
positions, it is computationally diﬃcult to manipulate an
array of positions if it were stored in the smart contracts.
It is easier to require the user to always supply the posi-
tionList as computed oﬀ-chain and have the smart con-
tract loop through the provided list to check that 1) the
user indeed owns each position, and 2) the number of
positions matches optionBalance(userAddress).

E. Panoptic framework for cost calculation of options

In order to calculate the premium/cost for the op-
tions, Panoptic will consider the total liquidity amount
deployed at a given tick. From the Uni v3 fee calculation
formula, the fees collected are proportional to the amount
of liquidity deployed. Assuming that the position is not
in-range when fees are collected, the amount of fees for
all positions deployed at a speciﬁc range is given by:

totalFees = (cid:0)fgupper − fglower − fginsideLast

(cid:1) · liquidity

and

the
where
fglower
fgupper
feeGrowthOutside0X128 of
the upper and lower
ticks, and fginsideLast = feeGrowthInside0LastX128,
and liquidity is the liquidity owned by the protocol.
The option buyer would pay a premium equal to
totalFees · positionSize/liquidity to the seller.

are

One possible attack on the Panoptic protocol, how-
ever, would be for an options buyer to purchase all the
options available and completely drain the liquidity at
a speciﬁc tick. In that case, the liquidity owned by the
Panoptic protocol is zero (liquidity = 0), no fees will
be collected (totalFees = 0), and the option premium
will also be zero.

We

solve

this by tracking what we

an
effectiveLiquidity for each position. Speciﬁcally, in-
stead of using positionSize/liquidity, the protocol
will compute fees based on the actual amount of liquid-
ity that has been deposited there by the option sellers
before any option is purchased.

call

For example, if 10 ETH worth of liquidity was sold at
a given tick and a call option worth 9.9 ETH was pur-
chased, only 0.1 ETH of liquidity remains in the Uniswap
pool. However, the Panoptic smart contract base the pre-
mium calculation as if 10 ETH of liquidity was present
even though only 0.1 ETH of liquidity is actually de-
ployed.

Using this argument, the cost of an option can be de-
rived using an effectiveLiquidity, which means that
the premium will be given by:

Premium = totalFees ·

positionSize
baseLiquidity − positionSize
(cid:125)
(cid:123)(cid:122)
(cid:124)
effectiveLiquidity

where baseLiquidity is the amount of liquidity ini-
tially present before the options are created. In the ex-
ample above, the amount of fees paid will depend on
effectiveLiquidity = 9.9/(10−9.9) = 99 ETH instead
of positionSize/liquidity = 9.9/10 = 0.99 ETH.

The same argument can be made for short options (i.e.,
selling a new option should not consider the extra liquid-
ity added to the pool at the time of deployment), meaning
that the eﬀective liquidity of a short option position is

option and increases for larger orders according to:
spread = ± positionSize/baseLiquidity.

8

for

store,

Hence, Panoptic will

each option,
a record of
the feeGrowthInside0LastX128 and
feeGrowthInside1LastX128 parameters at the upper
and lower boundary of the LP position and the amount
of baseLiquidity initially owned by LPs in the Uni v3
pool.

In addition, Panoptic will take special consideration for
situations when a user purchases several small options
rather than a large one. For instance, purchasing ten
options each valued at 1 ETH should result in the same
amount of premium as one option valued at 10 ETH.

Therefore,

if a user has already purchased N1 op-
tions when the liquidity was L1 and the user wants
to deploy an additional N2 options at a later time,
then the effectiveLiquidity amount will be based on
baseLiquidity -= N2, which results in and eﬀective liq-
uidity equal to (N1 + N2)/(L1 − N1 − N2) for the com-
bined options, and not N1/(L1 − N1) for the ﬁrst option
and N2/(L2 − N1) for the second one.

V. RISKS

A. Collateralization requirements - option selling

The selling of undercollateralized options is typi-
cally associated with signiﬁcant risks for the Liquidity
Providers: since they lend their liquidity to option sell-
ers, they may lose their capital initially put forward if
the user cannot cover the price of the option.

In traditional ﬁnance (TradFi), undercollateralization
is handled by tuning the buying power requirement of
an asset. For instance, the Cboe rules (CBOE, 2022)
state that the margin account collateral requirements for
a short put or a short call are:

100% of option proceeds plus 20% of un-
derlying security/index value less out-of-the-
money amount, if any, to a minimum of op-
tion proceeds plus 10% of underlying secu-
rity/index value for calls; 10% of the put exer-
cise price for puts. (source: Cboe Rule 10.3)

effectiveLiquidity =

positionSize
baseLiquidity + positionSize

The Financial Industry Regulatory Authority (FINRA)
Rule 4210 (FINRA, 2022) also sets forth similar margin
requirements for options.

The effectiveLiquidity should not diﬀer much from
liquidity present when the positionSize
the actual
is small relative to the amount of baseLiquidity
owned by the Panoptic pool. This slight diﬀerence
could be seen as a spread that is calculated for each

In TradFi,

if an OTM short put option at strike
K = $49 is sold for a premium P = $1.50 while the cur-
rent asset price is S = $50 and each contract corresponds
to 100 units of stock, then the initial amount of collateral
required to sell the option is

Collateral Requirement = P + 0.2 · S · 100 − (K − S)

= $150 + $1000 − $100
= $1050

Therefore, the margin requirement would be approxi-
mately ﬁve times lower than the collateral requirement
for a Non-Margin or Retirement account (collateral re-
quirement = $4900).

As a ﬁrst step, the Panoptic protocol will employ re-
quirements similar to the 20% rule for most assets and
instead compute the collateral requirements as:

20% of the notional value plus max(ITM
amount, 0) minus premiumAccrued.

Hence, a user wishing to sell a 2000 DAI-ETH put
would initially need to provide 2000 * 0.2 = 400 DAI
of collateral. This will be true regardless of the value of
ETH because all puts can only be sold OTM (meaning
that ITM amount is zero). However, if the price were to
move below the 2000 strike price, then the user would
need to provide a “maintenance” margin equal to the
ITM amount = K − S.

As the protocol develops, the 20% requirement may
be a function of the pool utilization rate or the pool’s
implied volatility.
Indeed, while the “20% of underly-
ing security/index value” is what is initially set by the
Cboe and FINRA as a baseline level of collateral require-
ment for most securities, that requirement can and will
be raised for highly volatile assets (up to 100% in the
case of GME in early 2021).

There must therefore be a way to adjust the collateral
requirements “on-the-ﬂy” in response to a higher trading
activity. One way to do this is by linking the collater-
alization ratio to the pool utilization (see section V.C
below).

B. Collateralization requirements - option buying

Long options increase in price over time, so buyers will
need to lock up collateral to ensure that they can still
pay the option premium.

The collateral requirement for long options will also
depend on the exercise value. However, since collateral
requirement only needs to cover premium accrued, the
collateralization ratio for long options will be

10% of the notional value minus max(ITM
amount, 0) plus premiumAccrued.

9

C. Pool utilization target

Pool utilization is deﬁned as the amount of liquidity in
the Panoptic pool that has not been used to buy options.
Speciﬁcally,

PoolUtilization =

totalLockedLiquidity
totalLiquidity − totalNotionalValue

.

The optimal Pool utilization should be low enough to
ensure that new options could be sold, but also high
enough to reﬂect a healthy protocol use.

One way to decrease pool utilization (i.e., disincen-
tivize option selling and buying) is to make the collateral
requirement a monotonically increasing function of the
pool utilization rate.

On the other hand, to increase the pool utilization (i.e.,
incentivize option selling and buying) is to make the com-
mission a monotonically decreasing function of the pool
utilization rate.

Wherever the two functions meet would be the pool
utilization target, where the commission and collateral
requirement stabilized the pool utilization towards an op-
timal level (with 50% seeming like a reasonable target).

VI. PANOPTIC PROTOCOL ADVANTAGES AND
APPLICATIONS

This section discusses the opportunities ushered by the
Panoptic options protocols, focusing on composability
with other projects in the space. We also describe the
several advantages Panoptic options have over regular
options protocols, both in TradFi and DeFi on-chain.

A. Insurance protection for lending protocols

Options can be utilized for protection/insurance
against default by lending protocols. In other words, buy-
ing put options can substitute conventional liquidation
frameworks used by the lending protocols and replace
risk (i.e., liquidations failures) with a cost (i.e., buying
put options).

B. DAO treasury risk management

Native tokens inside a DeFi project treasury might
be ﬁnancial resources. However, as explained in (Hasu,
2021), counting native tokens as assets on a balance sheet
does much more harm than good for a DeFi project,
and is considered poor treasury management. A more
proactive and risk-averse approach for DAOs manage-
ment would be to build treasuries with DeFi stable and

10

FIG. 8 Liquidity deployment and payoﬀs of composite multi-legged options that could be wrapped into a single ERC1155
token. Top: Straddle (short ATM put+call), Strangle (short OTM put+Call), Iron Condor (OTM put+call debit spreads),
Jade Lizard (short OTM put and OTM call credit spread). Bottom: Ratio spread (short put + put debit spread), BATS (put
and call ratio spreads), ZEBRA (ATM short call and 2 ITM long calls), Spiked Lizard.

blue chip assets and put these assets to work in rela-
tively secure and established projects. At the same time,
hedge the risk the DAOs have exposure to (by providing
liquidity) via buying options.

solvent since each position is 100% backed by collat-
eral. Options sellers in Panoptic, however, will be able to
write undercollateralized options that accurately reﬂect
the risks associated with selling options.

C. Tokenized risk positions

G. Governance minimization

Wrapped positions that make impermanent loss disap-
pear: buy both puts to perfectly oﬀset losses for Uni v3
position becoming OTM.

Panoptic aims at limiting governance impact on how
it is structured, i.e., no parameter should be based on
governance decisions but rather function in a market-
driven and responsive manner.

D. Gamma-capped options

Limiting Gamma by using ranged positions: no pin
risk, no Gamma explosion, only Theta (see Section II.c).

E. Composite options

Multi-leg tailored options with directional and/or
strategic payoﬀ structure can be minted via the com-
posability feature of Panoptic. Fig. 8 highlights some of
the composite options that can be created by relocating
liquidity within the Panoptic pool accordingly.

H. Payoﬀ compiler

Panoptic introduced a novel concept called the
Gamma transformation (Lambert, 2022), which can
compile any desirable payoﬀ by composing a set of ticks.
Each tick can be viewed as a “Dirac delta” impulse, which
translates to output being a given payoﬀ. Like in, e.g., a
Fourier transform, we can compose the desirable payoﬀ
via the correct composition of impulses.

I. Greeks compiler

F. Capital eﬃciency

The collateral deposited by the users never leaves the
Panoptic smart contracts, enabling the system to remain

In addition to the payoﬀ compiler, we imagine the
ability to construct any set of desirable Greek proper-
ties of the position. We imagine now a combined multi-
objective optimization still posed as an inverse problem

StraddleStrangleIron CondorJade LizardRatio SpreadBATSZEBRASpiked Lizardtrying to ﬁnd the set of impulses (the liquidity distri-
bution) leading to a given joint payoﬀ-greek distribu-
tion/behavior.

J. Composability with on-chain option protocols

The perpetual and cost-less options instrument oﬀered
by the Panoptic protocol may require seasoned options
traders to reinvent themselves because most of the quan-
titative ﬁnance tools and metrics may not apply to non-
expiring options. Therefore, other protocols may wish
to build a protocol for expiring options on top of each
Panoptic pool. On the ﬂip side, other protocols can tap
into Panoptic to be able to build structured products
such as options vaults.

K. Hedging of oﬀ-chain options

Panoptic options can be minted with a ﬁxed gamma
by specifying a width parameter. But since a ﬁxed-width
options is similar to an options with a perpetual Days to
Expiration, a basket of Panoptic options could be used
to continuously hedge oﬀ-chain options protocols. For
instance, market participants that trades short options
on a centralized exchange like Deribit could purchase a
basket of ﬁxed-width options on Panoptic that replicate
a portfolio of expiring options without the need to rebal-
ance over time.

GLOSSARY

• Cash-secured puts: selling a put option against
cash the seller has set aside for buying the under-
lying asset.

• Covered calls: selling a call option against a long

asset the seller already owns.

• Credit call spread: contain two calls (long and
short) with the same expiration but diﬀerent strike
prices. The strike price of the short call is lower
than the strike price of the long. The short call
main purpose is to generate premium, whereas the
long call helps limit the upside risk.

• Debit call spread: contain two calls (long and
short) with the same expiration but diﬀerent strike
prices. The strike price of the short call is higher
than the strike price of the long call. The short
call main purpose is to reduce the long call upfront
cost.

• Delta: measure of the change in an option price or
premium resulting from a change in the underlying
asset.

11

• Gamma: measure of the rate of change in Delta
over time, as well as the rate of change in the un-
derlying asset. Gamma helps forecast price moves
in the underlying asset.

• Implied Volatility (IV): the expected volatility
of a stock/asset over the life of the option. In this
whitepaper deﬁned as σ.

• In-the-money (ITM): refer to an option that
possesses intrinsic value. A call option is ITM if
the underlying asset spot price is above the strike
price. A put option is ITM if the underlying asset
spot price is below the strike price.

• Out-the-money (OTM): refer to an option that
only contains extrinsic value. A call option is OTM
if the underlying asset spot price is below the strike
price. A put option is OTM if the underlying asset
spot price is above the strike price.

• Pin risk: uncertainty that arises over whether an
option’s contract will be exercised (or assigned)
when the expiration price of the underlying asset
is at or very close to the option’s strike price.

• Put-call parity: require the call price plus the
strike price of both options be equal to the under-
lying asset price plus the put price. When put-call
parity is violated, an arbitrage opportunity exists.
• Put debit spread: contain two puts (long and
short) with the same expiration but diﬀerent strike
prices. The strike price of the long put is higher
than the strike price of the short put. The short
put’s main purpose is to reduce the long put’s up-
front cost.

• Net delta: the sum total of all the delta values of
the options a trader owns. The closer the net delta
position is to zero (delta neutral), the less it will be
aﬀected by changes in the price of the stock.

• Strike price: price at which a put or a call option

can be exercised.

• Theta: measure an option’s sensitivity to time.
Consider an option with value 7.50 and a theta of
0.02. After one day, the option’s value will be re-
duced to 7.48, 2 days to 7.46. etc. Theta loss is
not constant like in this example but increases as
the option approaches expiration.

REFERENCES

H. Adams, N. Zinsmeister, M. Salem, R. Keefer, and
D. Robinson. whitepaper: Uniswap v3 core. 249, March
2021. URL https://uniswap.org/whitepaper-v3.pdf.
CBOE. Strategy-based Margin, 2022. URL https://www.
cboe.com/us/options/strategy based margin. (2022,
March 15).

12

Deribit. Deribit options and futures exchange, 2022. URL

https://www.deribit.com/. (2022, March 15).

FINRA. FINRA Margin Requirements, 2022. URL https:
//www.finra.org/rules-guidance/rulebooks/finra-r
ules/4210. (2022, March 15).

Hasu. A new mental model for deﬁ treasuries. Uncommon
core blog, October 2021. URL https://uncommoncore.c
o/a-new-mental-model-for-defi-treasuries/.

Y. Khatri. Trading volume for bitcoin and ether options grew
443% in 2021. The Block, December 2021. URL https:
//www.theblockcrypto.com/linked/128596/bitcoin-e
ther-options-trading-volume-crypto-derivatives-2
021.

J. Kristensen, P. J. Steﬀensen, and M. Ottina. Automated

market makers. Book to be published, 2022.

G. Lambert. How to create perpetual options in uniswap v3.
Medium blog, August 2021a. URL https://lambert-gu
illaume.medium.com/how-to-create-a-perpetual-opt
ions-in-uniswap-v3-3c40007ccf1.

G. Lambert. Uniswap v3 lp tokens as perpetual put and call

options. Medium blog, June 2021b. URL https://lamber
t-guillaume.medium.com/uniswap-v3-lp-tokens-as-p
erpetual-put-and-call-options-5b66219db827.

G. Lambert. Synthetic options and short calls in uniswap v3.
Medium blog, July 2021c. URL https://lambert-guilla
ume.medium.com/synthetic-options-and-short-calls
-in-uniswap-v3-a3aea5e4e273.

G. Lambert. On-chain volatility and uniswap v3. Medium
blog, November 2021d. URL https://lambert-guillaum
e.medium.com/on-chain-volatility-and-uniswap-v3-
d031b98143d1.

G. Lambert. Gamma transforms: How to hedge squeeth using
uni v3. Medium blog, February 2022. URL https://lamb
ert-guillaume.medium.com/gamma-transforms-how-to
-hedge-squeeth-using-uni-v3-da785cb8b378.

D. Llama. DeFi Llama, 2022. URL https://defillama.co

m/protocols/Options. (2022, March 15).

D. White and S. Bankman-Fried.

Everlasting options.
Paradigm, May 2021. URL https://www.paradigm.x
yz/2021/05/everlasting-options.

