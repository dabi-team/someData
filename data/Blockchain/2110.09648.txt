1
2
0
2

t
c
O
8
1

]

R
P
.
h
t
a
m

[

1
v
8
4
6
9
0
.
0
1
1
2
:
v
i
X
r
a

Data Flow Dissemination in a Network

Aditya Gopalan∗

Alexander Stolyar†

Abstract

We consider the following network model motivated, in particular, by blockchains and peer-to-peer
live streaming. Data packet ﬂows originate at the network nodes and need to be disseminated to all other
nodes. Packets are relayed through the network via links of limited capacity. A packet leaves the network
when it is disseminated to all nodes. The network is stable when it is positive recurrent; and when it is,
the age of the oldest packet, referred to as Age-of-Information (AoI) is stochastically bounded. Under
the Random-Useful (RU) discipline a node u communicates on link (u, v) a randomly chosen available
packet not present at v. RU discipline is known to have the maximum stability region for a single ﬂow; we
show that this extends to arbitrary number of ﬂows. Our main results concern the Oldest-Useful (OU)
discipline, under which a node u communicates on link (u, v) the oldest available packet not present
at v. OU discipline is a natural candidate for reducing the AoI. We show that, surprisingly, OU does
not provide the maximum stability region. As the main result of this paper, we prove that OU does
have the maximum stability region in the important special case of a complete graph network with equal
capacities on all links and equal ﬂow rates originating in all nodes. Simulation results show that, in the
latter special case, OU out-performs RU in terms of AoI.

1 Introduction

Pairwise information exchange forms the basis of content dissemination in many network applications. In
this paper, we consider a model of a network with N nodes. Each node creates new packets at the epochs
of an independent point process. We treat packet creation process at each node as an exogenous packet
arrival process. The nodes interact pairwise via network links. For each link there is an independent
point process, determining the epochs at which the interactions may occur. During each such interaction,
a single packet can be instantly transmitted on the link from one node to the other. Each packet needs to
be disseminated to all other nodes; when this occurs, the packet leaves the network. (In this paper we will
use terms packet ‘dissemination’, ‘propagation’, and ‘replication’ interchangeably.) Under appropriate
assumptions, this model is described as a Markov process.

The foremost question for such model is that of stability (understood as positive recurrence of the
corresponding Markov process). We assume that, at any time, for any directed link (u, v), node u always
knows which of the packets already available at u are not yet available at v – we call such packets useful
(on the link (u, v)). In this paper, we show that the communication discipline, or the order in which
packets are transmitted, can aﬀect stability and performance of the network. We consider the following
three communication disciplines: (1) the Random-Useful discipline, (2) the Oldest-Useful discipline, and
(3) the Selﬁsh discipline, which we now describe.

Absent any application context, a natural discipline is the Random-Useful, in which the sending node
picks a useful packet uniformly at random. This discipline was also studied by Massouli´e and Twigg [8]
for use in peer-to-peer live streaming.

Blockchains are an emerging application which are well-described by our system model; blocks in a
blockchain system are analogous to packets in our model. The Oldest-Useful discipline, in which nodes
transmit the oldest useful packet, plays a key role in the distributed information veriﬁcation in blockchain
systems (see, e.g., Frolkova and Mandjes [2], Gopalan et al. [3]). The Oldest-Useful discipline is also a
natural candidate when one of the goals is to minimize the age of information (the age of the oldest
present packet) in the network. Indeed, it is clearly related to much studied disciplines of the Largest-
Delay-First (LDF) or Earliest-Deadline-First (EDF) type (see, e.g. [16] for an overview). The disciplines
of the latter type are known to be optimal in terms of stability and age-of-information, in a variety of

∗ISE Department, University of Illinois at Urbana-Champaign, gopalan6@illinois.edu
†ISE Department and Coordinated Science Lab, University of Illinois at Urbana-Champaign, stolyar@illinois.edu

1

 
 
 
 
 
 
settings. One of the ﬁndings of this paper is that those optimality properties of LDF/EDF disciplines
do not always extend to data dissemination networks – in particular, Oldest-Useful does not necessarily
have the maximum stability region for our model.

The Selﬁsh discipline is such that each node prioritizes packets that it has created, and sends them in
the oldest-ﬁrst order; other packets are sent only when “own” packets are not available. This discipline
is appropriate for systems in which limited or no information is available about not “own” packets.

In this paper we show that the Random-Useful discipline achieves the maximum stability region on
an arbitrary network H. The main results of the paper concern the Oldest-Useful discipline. We show
that, in general, it does not achieve the maximum stability region. However, for the important special
case when the system is symmetric (H is complete, has equal link capacities, and arrival rates to all
nodes are equal) we prove that Oldest-Useful does provide maximum stability. (This important special
case is a good model for, e.g., overlay networks.) The Selﬁsh discipline is also maximally stable for a
symmetric system (this fact is rather simple). We also show that Oldest-Useful is maximally stable in
networks where there is at most one directed path from any source node to any other node.

1.1 Related Work

Several recent works have focused on the propagation of blocks in a blockchain network. The well-studied
model of Pass, Seeman, and Shelat [10] assumes that every block propagates to all network nodes within
a ﬁnite deterministic time interval after its arrival. Li et al. and Li et al. [6, 7] treat block generation as
a queueing process but do not consider block propagation in a blockchain network. Sankagiri, Gandlur,
and Hajek [13] study only the point-to-point propagation of blocks. Each of these models ignore the
intricacies of pairwise information exchange and instead opt for simpler dynamics with obvious stability
regions. In this paper, we address the nontrivial challenge of stability with pairwise information exchange.
The following three papers all study various formulations and restrictions of the pairwise communi-

cation model in this paper.

Ioannidis, Chaintreau, and Massouli´e [5] study a model with a single source of exogenously arriving
packets, where network nodes communicate only the newest available packet, whenever such a packet is
useful. While this model is based on pairwise information exchange, the restricted context is such that
the system is stable for all positive arrival rates. We focus on the more general setting where stability is
not a priori guaranteed.

Massouli´e and Twigg [8] study the Random-Useful discipline with a single source of exogenous arrivals,
and an arbitrary network topology. They show that in this setting, the Random-Useful discipline achieves
the maximal stability region. We demonstrate that this result extends to general case, with arrivals to
more than one node.

Gopalan et al. [3] study the Oldest-Useful discipline. They obtain bounds on the stability region of
this discipline for arbitrary network topologies. However, these bounds are not of the same order: the
lower bound is O(1/ log N ) of the upper bound, where N is the number of nodes. In the present paper
we use diﬀerent methods to prove that that the Oldest-Useful discipline attains the maximum stability
region for symmetric systems (and also show that, in general, Oldest-Useful is not maximally stable).

In a setting diﬀerent from ours, all packets to be disseminated exist at the beginning of the process.
Then there exists a time T at which all packets have left the network. The main problem of interest
here is to compute moments of T in terms of the network topology. This setting, also called rumor
spreading, has been used to model information propagation in peer-to-peer systems such as Bit-Torrent
(see Shah [14] and the references therein).

While our focus is on systems where packets are created exogenously, for completeness we refer the
reader to a line of work where pairwise interactions are used to share a ﬁxed number of packets among
network nodes that arrive to the system exogenously and leave the system upon collecting a copy of each
packet; see, e.g., Massouli´e and Vojnovi´c [9], Hajek and Zhu [4].

1.2 Contributions of This Paper

1. We extend the result of Massouli´e and Twigg [8] to the case where packets arrive at an arbitrary
number of nodes (as opposed to just one); namely, we show that Random-Useful is maximally stable
in this case. This, in particular, establishes the existence of a distributed discipline (using only the
information available locally at each node) achieving the natural upper bound on the stability region
imposed by the capacities of network cuts.

2. Despite it being a natural discipline in various application contexts, we show that the Oldest-Useful

discipline does not achieve the maximal stability region for some networks.

2

3. For the special case where the network is symmetric (H is complete, all links have equal capacity,
and all nodes have equal exogenous arrival rates of new packets), we show that the Oldest-Useful
discipline does achieve the maximal stability region. This is an important special case as it cap-
tures the communication behavior of many overlay networks. This positive result and the above
negative result provide a signiﬁcant insight for the design of blockchain systems, as they highlight
the importance of the network structure and dissemination algorithm for system performance.

4. We show that when the network has a tree structure, any work-conserving discipline is maximally
stable.
(The “tree structure” means that the network can be constructed as follows: we start
with an undirected tree, and then replace each undirected edge with a pair of links going in both
directions.) We also show that the Oldest-Useful discipline is maximally stable in the somewhat
more general case where there is a unique directed path from any source node to any other node.

5. We compare the Random-Useful, Oldest-Useful, and Selﬁsh disciplines numerically for symmetric
networks. We observe that, as desired, the average age of information is smaller under the Oldest-
Useful discipline than under the Random-Useful discipline. Somewhat surprisingly, the Selﬁsh
discipline achieves both the least average age of information as well as the least packet sojourn time
(which is equivalent to achieving the least average number of packets) in the system, among the
three disciplines.

1.3 Outline of the Rest of the Paper

In Section 2, we introduce the system model and the communication disciplines of interest. In Section
3, we show that the Random-Useful discipline is maximally stable on an arbitrary network topology. In
Section 4, we give a counterexample to the maximal stability of the Oldest-Useful discipline and prove
our main result: the Oldest-Useful discipline is maximally stable for a symmetric system. Section 5 gives
the Selﬁsh discipline maximum stability result for a symmetric system. In Section 6, we show that when
the network has a tree structure, any work-conserving discipline is maximally stable. We also show that
the Oldest-Useful discipline is maximally stable in the more general case where there is a unique directed
path from any source node to any other node. In Section 7, we present simulation results comparing the
performance of Random-Useful, Oldest-Useful, and Selﬁsh disciplines in symmetric systems. Finally, in
Section 8 we discuss generalizations of our results.

2 Model

We consider a network whose structure is given by a ﬁnite directed graph H := (V, E), where V and
E are the sets of nodes and links, respectively. Each node u receives an independent ﬂow of exogenous
packet arrivals (creations), as a point process of rate λu ≥ 0. (For those packets node u is the source,
or origin.) For each link (u, v) ∈ E, there is a point process of rate cuv > 0; at the epochs of this
process node u can instantly communicate (or transmit) one packet to node v. The network goal is to
disseminate (or propagate, or replicate) each arriving packet to all other nodes. A packet disseminated
to all nodes leaves the network.

We now deﬁne the communication disciplines considered in this paper. We assume that, at any time,
for any link (u, v), node u always knows which of the packets already available at u are not yet available
at v – we call such packets useful (on the link (u, v)). A communication discipline is a rule specifying,
for each link (u, v) which useful packet is transmitted at a link (u, v) communication epoch. (If no useful
packet is available, no packet transmission occurs.)

Oldest-Useful – Communicate the oldest useful packet.
Random-Useful – Communicate a useful packet chosen uniformly at random.
Selﬁsh – Communicate the oldest useful packet, originated at u. If no such packet is available, commu-
nicate another useful packet, chosen according to some well-deﬁned rule.

Assume now that all packet arrival processes and all link communication processes are mutually in-
dependent Poisson. Under this assumption, for each of the three communication disciplines, the system
evolution can be described by a continuous-time irreducible Markov chain X(t) with a countable state
space. (The Poisson assumption on the arrival and communication processes is to simplify the exposition.
All our results hold for far more general arrival and communication processes – for example renewal – as
long as the system process is Markov, possibly with more complicated, non-countable state space.)

3

Deﬁnition 2.1. The system is called stable if the corresponding Markov chain X(t) is positive recurrent.
For a given H and link capacities {cuv}, the network stablility region is the set of those arrival rate vectors
{λu}, for which the system is stable.

The system stability implies, in particular, that in steady-state the age-of-information (the age of the
oldest packet) has a proper distribution and that with positive frequency the network reaches “empty”
state (when all arrived packets already left the network). Reaching the empty state is sometimes referred
to as network “synchronization.”

Deﬁnition 2.2. We call a system complete homogeneous if H is complete and cuv = c for all (u, v) ∈ E.
For such networks, without loss of generality, we assume c = 1. A system will be called symmetric if it
is complete homogeneous and, in addition, λu = λ for all u ∈ V .

A complete homogeneous network is a good model, for example, when the pairwise communication

occurs on an overlay network, such as in peer-to-peer protocols.

Deﬁnition 2.3. We call a system unique-path if the graph H is such that it has at most one directed
path (not including any node more than once) from any node u to any other node v. We will say that
a system has tree structure, if it can be constructed as follows: we take an undirected tree on the set of
nodes V , and then replace each undirected edge by the pair of directed links in both directions. (Clearly,
a network with a tree structure is a special case of a unique-path network.

2.1 Basic Notation

We use the notations A ⊆ B and A ⊂ B to denote subsets and strict subsets, respectively. For any set
S, the notation |S| denotes its cardinality. All derivatives in this paper are with respect to time and for
dt f and f ′ interchangably.
any quantity f (t) we use the notations d

3 Random-Useful Discipline

In this section we discuss the maximum stability of the Random-Useful discipline, for arbitrary network
topologies.

First of all, the following condition is easily seen to be necessary for the network stability, under any

discipline:

λu <

cuv

for all S ⊂ V .

(1)

Xu∈S

Xu∈S
v6∈S

Unless this condition holds, there exists an overloaded or exactly critically loaded cut in the network, and
the stability cannot hold. Thus, any discipline under which condition (1) is also suﬃcient for stability,
achieves the maximum stability region.

The following previous result proved that, under Random-Useful, (1) is also suﬃcient for stability,

for an arbitrary network with a single source.

Theorem 3.1 (Massouli´e and Twigg [8]). Under Random-Useful discipline, any network H with a single
source node s is stable iﬀ condition (1) holds. (Thus, Random-Useful has maximum stability region for
single-source networks.)

Examination of the proof of this result in [8] shows that it extends to multi-source networks as well,

so we obtain the following

Proposition 3.2. Under Random-Useful discipline, any network H is stable iﬀ condition (1) holds.
(Thus, Random-Useful has maximum stability region.)

We only comment on the necessary (minor) changes to the proof in [8]. The proof uses the ﬂuid
limit technique, which we discuss later Section 4. The following key estimate is derived in the proof of
Theorem 3 in [8]:

d
dt

y⊆S∗ ≤ λs −

Xu∈S
v6∈S

∗
∗

cuv + max
e∈E

ce|E|2K α.

Here the left-hand side is the derivative of the “amount of ﬂuid” that originated in the subset of
nodes S∗, containing the single source node s, but has not “left the subset S∗ yet.” The right-hand side
has the exact rate λs at which such ﬂuid arrives, and the upper bound on the rate at which such ﬂuid
leaves subset S∗. We observe that the upper bound term holds as is for multi-source networks. Then, in

4

the multi-source case, the above derivative estimate still holds if we replace λs in the right-hand side by

u∈S∗ λu. Given this, the rest of the proof applies.

P
4 Oldest-Useful Discipline

In this section, we discuss the stability of the Oldest-Useful discipline. We ﬁrst give an example of a
network in which the Oldest-Useful discipline does not achieve the maximal stability region. Next, we
show a complete homogeneous network is stable under Oldest-Useful when the arrival rates at all nodes
are less than 1 (which is the capacity of each link); this, in particular, implies the maximum stability for
symmetric networks.

4.1 Oldest-Useful Does Not Achieve Maximum Stability

Recall that condition (1) is necessary for stability. We now show an example demonstrating that condition
(1) is not suﬃcient for stability under the Oldest-Useful discipline; this will prove that, in general, Oldest-
Useful does not achieve maximum stability region. We only sketch the argument here, which highlights
the key “reason” for instability; this sketch can be easily turned into a rigorous proof.

Consider the network of 3 nodes in Figure 1, with the Oldest-Useful discipline. Communications on
any link are attempted at rate 1. We set λ1 = 2 − ε, λ2 = λ3 = 0. Consider the initial state with a

λ1 = 2 − ε

1

1

1

2

λ2 = 0

1

1

3

λ3 = 0

Figure 1: An example of an Oldest-Useful network which does not achieve the maximal stability region.

(large) ﬁxed number Q1(0) of packets at node 1, and suppose they have reached neither node 2 nor 3
yet. All other packets previously created at node 1 have already reached both nodes 2 and 3 and left
the network. Let us refer to a packet available at exactly two nodes (1 plus either 2 or 3) as “in-transit”
packet. We consider the events when the number of in-transit packets drops to 0 as “renewals.” It is
not hard to show that the process that only tracks the in-transit packets is stable, that is the expected
inter-renewal time is ﬁnite. When this process is in steady-state, we claim that the average rate at
which node 1 “produces” in-transit packets is strictly less than 2. Indeed, after node 1 produces a new
in-transit packet by sending it to, say, node 2, then, under the Oldest-Useful discipline, with probability
at least 1/4 the next packet sent by node 1 will be an in-transit packet sent to node 3. (Because with
probability 1/4 the next communication in the entire system will occur on link (1, 3), upon which node
1 will necessarily send an in-transit packet.) This means that a non-zero fraction of packets will be sent
by node 1 on both links (1, 2) and (1, 3). But the total rate at which node 1 sends packets on links (1, 2)
and (1, 3) is the total capacity of those links, which is 2. We conclude that the rate at which node 1
produces in-transit packets is strictly less than 2. This in turn means that if the rate λ1 = 2 − ε at which
new packet are created at node 1 is suﬃciently close to 2, the number of packets Q1(t) at node 1 will
grow to inﬁnity. Thus, such network will be unstable, despite satisfying the condition (1).

4.2 Main Result: Stability of a Complete Homogeneous System and
Maximum Stability of a Symmetric System

Consider a complete homogeneous system. Recall that, without loss of generality, all link capacities are
equal to 1.

We deﬁne the process state X(t) at time t ≥ 0 as follows. At time t, suppose that k packets are
present in the system; we treat any packet which is replicated at all nodes as having departed the system.
We label the packets 1, . . . , k, in the order of exogenous arrival, with the oldest packet labeled 1. If, at
time t, a new packet arrives, it is labeled k + 1. If, instead, the packet labeled j departs the system at
time t, we decrement the labels of the packets j + 1, . . . , k by 1.

5

For (u, v) ∈ E, we denote by xuv(t) the subset of (labeled) packets with source u which at time t are

not available at node v yet. We deﬁne X(t) = (xuv(t))(u,v)∈E.

Our main result is as follows.

Theorem 4.1. Consider a complete homogeneous network under the Oldest-Useful discipline. Then the
process X(t) is stable if λu < 1 for all nodes u. If, in addition, the network is symmetric (λu = λ for all
nodes u), it is stable iﬀ λ < 1.

We remark that the theorem holds for the more general case, when all λu < 1 and all link capacities

are greater than or equal 1. Same proof works with straightforward adjustments.

4.3 Proof of Theorem 4.1

When λu = λ ≥ 1 for all nodes u, the system is overloaded or exactly critically loaded, and the instability
easily follows. So, we only need to prove the ﬁrst statement: the stability in the case when λu < 1 for
all nodes u.

4.3.1 Proof Highlights

We use the ﬂuid limit technique (see, e.g., [1, 11, 15]). This involves considering a sequence of processes,
scaled in both space and time, which converges to a limiting process with trajectories called ﬂuid limits.
Then it suﬃces to show that, there exists a time T > 0 such that, for any ﬂuid limit with “norm” 1 of
the initial state, the state norm reaches 0 by time T and remains at 0 thereafter. To do this, roughly
speaking, we use the arrival time of the currently oldest packet in the system as a Lyapunov function.
We show that, for any ﬂuid limit, this arrival time progresses at rate strictly greater than 1, as long as it
is less than the current time t; thus it reaches t by a ﬁnite time T , and then coincides with t thereafter.
The above Lyapunov function and the argument are related to those used in [16]. There is a
substantial diﬀerence though. In [16] the packet ﬂows of each type follow their own deterministic routes
through the network. For the model in this paper this is not the case – packets with the same origin
propagate through the network in a random fashion. As a result, our argument is substantially diﬀerent
from that in [16].

4.3.2 Fluid Limits

(u,v)∈E |xuv(t)|, where |xuv(t)| is the cardinality of xuv(t). Consider a
Deﬁne the “norm” ||X(t)|| =
sequence of processes (X n(·))n indexed by some sequence n → ∞ such that the norms of the initial states
satisfy ||X n(0)|| = n. To prove Theorem 4.1, it suﬃces to show that for any such sequence and for some
universal time T > 0,

P

E[||X n(nT )||] → 0 as n → ∞.

(2)

1
n

To prove (2), it in turn suﬃces to show that for any subsequence of {n}, there exists a further

subsequence {m} along which

1
m

||X m(mT )|| → 0

a.s..

(3)

Toward this goal, consider some subsequence {n}.

We will interpret an exogenous arrival of a packet at node u as N − 1 copies of this packet simul-
taneously joining N − 1 virtual queues, one per each link (u, v) with v 6= u. A copy joining an (u, v)
virtual queue we will call a (u, v)-packet. The state vector component xuv(t) can be thought of as the
virtual queue of (u, v)-packets that arrived by time t, and are still undelivered to v by t. We note that a
(u, v)-packet departure from the (u, v) virtual queue is not necessarily due to the direct delivery of the
corresponding actual packet from node u to node v – it is possible that the actual packet is delivered by
another link (w, v). That’s why we call these (u, v)-queues virtual.

To prove Condition (3) , we deﬁne the following quantities related to the evolution of the system for

all (u, v) ∈ E and w ∈ V :

• Fuv(t) is the number of (u, v)-packets which have arrived to the system by time t.
• ˆFuv(t1, t2) is the number of (u, v)-packets arrived to the system by time t1 and which are delivered

in the interval [0, t2], where t2 ≥ 0 and t2 ≥ t1.

• ˆFuv,w(t1, t2) is the number of (u, v)-packets arrived to the system by time t1 and which are delivered

on link (w, v) in the interval [0, t2], where t2 ≥ 0 and t2 ≥ t1.

6

• Suv(t) is the number of communication epochs on link (u, v) in the interval [0, t].

We adopt the convention that if there are ℓ packets in the system at time t = 0, they arrived
exogenously at negative time instants −ℓ + 1, −ℓ + 2, . . . , −1, 0. Fuv(t) is deﬁned for t ≥ −ℓ + 1 and
we use the convention that Fuv(t) = 0 for t < −ℓ + 1 for all (u, v) ∈ E. The functions ˆFuv(t1, t2) and
ˆFuv,w(t1, t2) are deﬁned for t2 ≥ 0 and t2 ≥ t1 with ˆFuv(t1, 0) = ˆFuv,w(t1, 0) = 0 for all (u, v) ∈ E, w ∈ V .
We note that the functions Fuv(t) are non-decreasing in t, and ˆFuv(t1, t2), ˆFuv,w(t1, t2) are non-decreasing
in both t1 and t2 for all (u, v) ∈ E, w ∈ V . The functions Suv(t) are deﬁned for t ≥ 0 and are also non-
decreasing, for all (u, v) ∈ E.

The process (Fuv(·), Suv(·))(u,v)∈E uniquely determines the process X(·). Recall that the “norm” of

X(t) is the total number of undelivered (u, v)-packets (for all (u, v)) in the system at time t ≥ 0:

||X(t)|| =

Fuv(t) − ˆFuv(t, t).

X(u,v)∈E

We use the superscript n for the quantities pertaining speciﬁcally to the quantities related to X n(·).

For any n ≥ 1, any (u, v) ∈ E, and any w ∈ V , let

f n
uv(t) :=

1
n

F n

uv(nt),

ˆf n
uv(t1, t2) :=

ˆf n
uv,w(t1, t2) :=

1
n
1
n

ˆF n

uv(nt1, nt2),

ˆF n

uv,w(nt1, nt2),

sn
uv(t) :=

1
n

Suv(nt).

and

Note that for all n ≥ 1, (u, v) ∈ E, w ∈ V , f n

uv(t) = 0 for t ≤ −1, ˆf n

uv(t1, 0) = ˆf n

uv,w(t1, 0) = 0, and

uv(t) the arrival time of the oldest undelivered (u, v)-packet at time t. If there is no such

uv(0) = 1.

(u,v)∈E f n
Denote by Ξn

P
packet, set Ξn

uv(t) = t. Deﬁne

and

τ n
uv(t) :=

1
n

Ξn

uv(nt)

τ n(t) := min

(u,v)∈E

τ n
uv(t).

Note that τ n

uv(0) ≥ −1, and then τ n(0) ≥ −1.

Let (Ω, F, P) be a probability space of independent driving Poisson arrival processes to the nodes
and Poisson service processes on the communication links. We assume that the processes for all n are
constructed on this space, using the same set of driving Poisson processes. We note that the driving
processes satisfy the functional strong law of large numbers: almost surely,

uv(t) − f n
f n

uv(0) → λut and sn

uv(t) − sn

uv(0) → t,

t ≥ 0, u.o.c. as n → ∞ ∀(u, v) ∈ E.

(4)

Lemma 4.2. The subsequence {n} (ﬁxed earlier) has a further subsequence {m} such that lim inf m→∞ τ m(1) ≥
0 almost surely.

Proof. Let us call (u, v)-packets initially (at time 0) present in the system “initial” (u, v)-packets. By
the nature of Oldest-Useful discipline, if there is at least one initial packet in any of the virtual queues
at time t, then for any process state at t, the time until the next initial packet is delivered (and removed
from its virtual queue) is stochastically upper bounded by an exponential random variable with mean 1.
Therefore, the time ∆n at which the network delivers all initial packets is stochastically upper bounded
by the sum of n i.i.d. exponential mean-1 random variables, where recall n is the total number of initial
packets. For the rescaled processes, we see that, for any ε > 0,

P{τ n(1) > −ε} → 1, n → ∞.

By choosing the further subsequence {m} to grow suﬃciently fast, we obtain the lemma statement. We
omit ε/δ formalities.

From this point, we ﬁx a further subsequence along which lim inf n→∞ τ n(1) ≥ 0 a.s., as in Lemma

4.2.

7

Deﬁnition 4.3. A collection of functions

(fuv(·), ˆfuv(·, ·), ˆfuv,w(·, ·), suv(·), τuv(·), τ (·))(u,v)∈E,w∈V

is called a ﬂuid limit if there exists a sequence of process sample paths

(f m

uv(·), ˆf m

uv(·, ·), ˆf m

uv,w(·, ·), sm

uv(·), τ m

uv(·), τ m(·))m∈N,(u,v)∈E,w∈V

such that:

1. Property (4) holds.
2. All of the functions fuv, ˆfuv, ˆfuv,w, suv are Lipschitz and non-decreasing in each argument, and the

functions τuv, τ are non-decreasing for all (u, v) ∈ E, w ∈ V .

3. The following convergences hold for all (u, v) ∈ E, w ∈ V , uniformly on the compact subsets of their

arguments:

lim
m→∞

lim
m→∞

lim
m→∞
lim
m→∞

f m
uv(t) → fuv(t)

uv(t1, t2) → ˆfuv(t1, t2)
ˆf m

ˆf m
uv,w(t1, t2) → ˆfuv,w(t1, t2)

sm
uv(t) → suv(t)

The following convergences hold at all points t ≥ 0 of continuity of τuv, τ for all (u, v) ∈ E:

lim
m→∞

lim
m→∞

τ m
uv(t) → τuv(t)

τ m(t) → τ (t)

(5)

(6)

(7)

(8)

(9)

(10)

4. τ (1) ≥ 0.

Proposition 4.4. Almost surely, every subsequence of the subsequence ﬁxed above has a further subse-
quence {m} such that the convergence of

(f m

uv(·), ˆf m

uv(·, ·), ˆf m

uv,w(·, ·), sm

uv(·), τ m

uv(·), τ m(·)){m},(u,v)∈E,w∈V

to a ﬂuid limit

(fuv(·), ˆfuv(·, ·), ˆfuv,w(·, ·), sij(·), τuv(·), τ (·))(u,v)∈E,w∈V

holds in the sense speciﬁed in Deﬁnition 4.3.

Proof. The proof uses the functional strong law of large numbers (4) and standard arguments, see,
e.g. [1, 11, 12, 15].

Proposition 4.5. A ﬂuid limit satisﬁes the following properties for all (u, v) ∈ E, w ∈ V , t ≥ 0,
t2 ≥ 0, t1 ≤ t2:

fuv(t) − fuv(0) = λut

suv(t) − suv(0) = t
ˆfuv,w(t2, t2) − ˆfuv,w(t1, t1) ≤ (t2 − t1)
ˆfuv(t2, t2) − ˆfuv(t1, t1) =

ˆfuv,w(t2, t2) − ˆfuv,w(t1, t1)

Xw∈V

τ (t) = min

(u,v)∈E

τuv(t)

τ (t) ≤ inf
s≤t
(u,v)∈E

{s : fuv(s) − ˆfuv(s, t) > 0}

(11)

(12)

(13)

(14)

(15)

(16)

Proof. Properties (11) and (12) are part of the deﬁnition of a ﬂuid limit. Property (13) follow from the
strong law of large numbers. Properties (14), (15) and (16) follow from the analogous properties for the
pre-limit trajectories.

8

For (u, v) ∈ E, w ∈ V , denote by µuv,w(t) := d
dt

ˆfuv,w(t, t), whenever this derivative exists. The
quantity µuv,w(t) can be thought of as the “instantaneous service rate for (u, v)-ﬂuid on link (w, v)” at
time t. Obviously,
Deﬁnition 4.6. A time t ≥ 0 is regular if the derivatives τ ′(t), τ ′
and w ∈ V .

w∈V µuv,w(t) ≤ 1 at any time t ≥ 0 such that the requisite derivatives exist.

uv(t), µuv,w(t) exist for all (u, v) ∈ E

P

Since τ (t), τuv(t), ˆfuv,w(t, t) are non-decreasing in each argument for all (u, v) ∈ E, w ∈ V , it follows

that almost all times t ≥ 0 are regular.

4.3.3 Stability of Fluid Limits

Deﬁnition 4.7. Consider a ﬂuid limit. We say that (u, v) ∈ E is a critical link at time t ≥ 0 if
τuv(t) = τ (t).

We denote by L(t) ⊆ E the subset of critical links at time t.

Deﬁnition 4.8. Consider a ﬂuid limit. Suppose that t ≥ 0 is a regular time. We say that the link (w, v)
serves only the oldest (u, v)-ﬂuid at time t if the following condition holds:

If t1 > τuv(t) and a > τ ′

uv(t), then for any suﬃciently small δ > 0,

ˆfuv,w(t1, t + δ) − ˆfuv,w(τuv(t) + aδ, t + δ)

−

ˆfuv,w(t1, t) − ˆfuv,w(τuv(t) + aδ, t)
(cid:16)

(cid:17)

(cid:17)

= 0.

(cid:16)

The interpretation of Deﬁnition 4.8 is that “during the interval (t, t + δ), all (u, v)-ﬂuid served on link

(w, v) arrived before time τuv(t) + aδ.”

Deﬁnition 4.9. Consider a ﬂuid limit. Suppose that t ≥ 0 is a regular time. We say that the link (w, v)
does not serve (u, v)-ﬂuid at time t if µuv,w(t) = 0.

In the proofs of the following Lemmas 4.10 and 4.11, along with a given ﬂuid limit, we consider a ﬁxed
deﬁning sequence of pre-limit sample paths {m} converging to the ﬂuid limit as speciﬁed in Deﬁnition
4.3.

Fix some time t2 ≥ 1; recall from Lemma 4.2 that τ (t2) ≥ 0. Note that the function huv(t1, t2) :=
fuv(t1) − ˆfuv(t1, t2) is λu-Lipschitz in t1 for τuv(t2) ≤ t1 ≤ t2. The function huv(·, ·) can be thought of
as the “amount of (u, v)-ﬂuid” arrived by time t1 and which has not been delivered by time t2.

Lemma 4.10. Consider a ﬂuid limit. Let t ≥ 1 be a regular time and let W ⊆ V . Suppose that for each
w ∈ W , the link (w, v) serves only the oldest (u, v)-ﬂuid. Then

τ ′
uv(t) ≥

1
λu Xw∈W

µuv,w(t).

Proof. Recall that we index the deﬁning sequence by m. Since the links (w, v)w∈W serve only the oldest
(u, v)-ﬂuid at time t, the following condition holds for large enough m in the deﬁning sequence: for any
a > τ ′
uv(t), for all small enough δ > 0 the links (w, v)w∈W do not deliver (u, v)-packets arrived after the
re-scaled time τuv(t) + aδ during the re-scaled interval (t, t + δ). For suﬃciently small δ and as m → ∞,
the Oldest-Useful discipline necessitates that fraction of (u, v)-packets arrived before the re-scaled time
τ m
uv(t) + δ
w∈W µuv,w which are undelivered by re-scaled time t + δ decreases to 0: this follows from
λu
the convergence f m
uv(t1, t2) → huv(t1, t2), which is λu-Lipschitz in t1. Since t is a regular time,
these statements together imply that τ ′
w∈W µuv,w(t) for suﬃciently small δ; the result
follows.

uv(t)δ ≥ δ
λu

uv(t1) − ˆf m

P

P

Lemma 4.11. Consider a ﬂuid limit. Let t ≥ 1 be a regular time such that τ (t) < t. Suppose that
(u, v) ∈ L(t). Then the link (u, v) serves only the oldest (w, v)-ﬂuid at time t for any critical link
(w, v) ∈ L(t) and does not serve (w, v)-ﬂuid if τwv(t) > τ (t). Moreover,

(w,v)∈L(t) µwv,u(t) = 1.

Proof. Let (w, v) ∈ L(t). Fix t1 > τwv(t) and a > τ ′
wv(t). Note that in Deﬁnition 4.8, if equality holds
for some small enough δ > 0, it holds for all 0 < δ′ < δ. We proceed by contradiction: suppose that for
any δ > 0, there exists 0 < δ′ < δ such that

P

ˆfwv,u(t1, t + δ′) − ˆfwv,u(τwv(t) + aδ′, t + δ′)

(cid:16)

ˆfwv,u(t1, t) − ˆfwv,u(τwv(t) + aδ′, t)

> 0.

(cid:17)

−

(cid:17)

(cid:16)

9

It follows that for all suﬃciently large m,

wv,u(t1, t + δ′) − ˆf m
ˆf m

wv,u(τwv(t) + aδ′, t + δ′)

wv,u(t1, t) − ˆf m
ˆf m

wv,u(τwv(t) + aδ′, t)

−

(cid:17)

(cid:16)

> 0.

(cid:17)

(cid:16)

wv(t) ≥ a, which is a contradiction. It follows that the

For the Oldest-Useful discipline, we then have τ ′
link (u, v) serves only the oldest (w, v)-ﬂuid at time t.
If τwv(t) > τ (t), then for large enough m, τ m

uv(t) and for any suﬃciently small re-scaled
interval (t, t + δ), the link (u, v) does not deliver (w, v)-packets. Thus, in the ﬂuid limit, the link (u, v)
does not serve (w, v)-ﬂuid at time t.

wv(t) > τ m

Finally, note that if τuv(t) = τ (t) < t, then for suﬃciently large m, there are undelivered (u, v)-packets
uv(·) during a small enough interval (t, t + ε). Thus, a packet is transmitted from u to
uv(·) during the interval (t, t + ε) and the result follows.

at each epoch of sm
v each epoch of sm

Lemma 4.12. There exists T > 0 such that for any ﬂuid limit, τ (t) = t for all t ≥ T .

Proof. Note that 0 ≤ τ (1) ≤ 1. Recall that τ (·) is non-decreasing and that non-regular times form a
(Lebesgue) null set. Fix some regular time t ≥ 1 such that τ (t) < t. By Lemma 4.11, critical links
(u, v) ∈ L(t) serve only the oldest ﬂuids of each other. Then, by Lemma 4.10, for any (u, v) ∈ L(t),

λuτ ′

uv(t) ≥

µuv,w(t),

X(w,v)∈L(t)

and then

λuτ ′

u,v(t) ≥

X(u,v)∈L(t)

X(u,v)∈L(t) X(w,v)∈L(t)

X(w,v)∈L(t) X(u,v)∈L(t)

µuv,w(t) =

µuv,w(t) = |L(t)|;

the last equality is because
uv(t) = τ ′(t) for each (u, v) ∈ L(t), so that
τ ′

P

(u,v)∈L(t) µuv,w(t) = 1 by the last property in Lemma 4.11. Recall that

X(u,v)∈L(t)

λuτ ′

uv(t) = τ ′(t)

λu ≤ τ ′(t)|L(t)| max

u

λu.

X(u,v)∈L(t)

We conclude that

τ ′(t) ≥ β

.
=

1
maxu λu

> 1.

Recall that τ (t) is non-decreasing, but need not be absolutely continuous or even continuous. Then
in any time interval [s1, s2], s1 ≥ 1, in which τ (t) < t, the increment of τ (t) is lower bounded as follows:

τ (s2) − τ (s1) ≥

s2

Z

s1

τ ′(t)dt ≥ β(s2 − s1).

Recall that, at time 1, 1 − τ (1) ≤ 2. We conclude that the condition τ (t) = t is reached at some time
s ≤ T = 2/(β − 1), and then holds for all t ≥ s.

We can now complete the proof of Theorem 4.1 by verifying property (3). Note that any ﬂuid limit is
(u,v)∈E[fuv(t) − ˆfuv(t, t)] = 0, for all t ≥ T . For any subsequence {n′} of
such that t = τ (t), and then
a given sequence {n}, we have shown the existence of a further subsequence {m}, for which the following
property holds. W.p.1, any subsequence {m′} of {m}, has a further subsequence {m′′} along which

P

lim
m′′→∞

′′

1
m′′ ||X m

(m′′T )|| =

[fuv(T ) − ˆfuv(T, T )] = 0

X(u,v)∈E

for some ﬂuid limit. But this means that, w.p.1, limm→∞
itself, thus verifying (3).

1

m ||X m(mT )|| = 0 for the subsequence {m}

5 Selﬁsh Discipline

The following fact is almost trivial. We present it for completeness.
Lemma 5.1. Consider a complete homogeneous network under the Selﬁsh discipline. Then the process
X(t) is stable if λu < 1 for all nodes u. If, in addition, the network is symmetric (λu = λ for all nodes
u), it is stable iﬀ λ < 1.

Proof. Clearly, the network is stable if each node u communicates only its own packets. If, in addition,
nodes communicate other packets (when own ones are unavailable), a straightforward coupling can be
used to show that each packet’s sojourn time in the network cannot increase.

10

6 Unique-Path Networks

For the networks having tree structure (which is a special case of unique-path networks) the maximum
stability region is achieved under any work-conserving discipline, i.e. such that at any link communication
epoch a useful packet is sent, unless none is available. (Oldest-Useful, Random-Useful and Selﬁsh are
work-conserving disciplines.)

Theorem 6.1. If a network has tree structure, maximum stability region is achieved under any work-
conserving discipline.

Proof. We give only a sketch of the argument as the details are straightforward. Recall that the condition
(1) is necessary for stability. So, it suﬃces to show that, under any given work-conserving discipline,
the network is stable when condition (1) holds. Again, we use the ﬂuid limit technique (see Section 4).
For any ﬂuid limit consider the following. For a ﬁxed link (u, v) ∈ E let Vuv denote the subset of those
nodes which would be in the same graph component as u, if links (u, v) and (v, u) would be removed.
(By the deﬁnition of tree structure, it would be exactly two components.) Denote by yuv(t) the “amount
of ﬂuid” that arrived at nodes w ∈ Vuv, by has not yet “crossed” link (u, v). Then, at any regular time
point t, such that yuv(t) > 0 for at least one link (u, v), we have

d
dt

max
(u,v)

yuv(t)/|Vuv| < 0.

(17)

This is because for any link (u, v) for which the maximum in (17) is attained, there must be a non-zero
amount of ﬂuid included in yuv(t), which is already present at node u; then this ﬂuid crosses link (u, v)
at the rate cuv which, by (1), is strictly greater than the rate
w∈Kuv λw at which this ﬂuid arrives into
the network. We omit further details.

P

For general unique-path networks, we have the following

Theorem 6.2. A unique-path network under Oldest-Useful discipline has maximum stability region.

Proof. In a unique-path network, each packet originating at a node u is disseminated along a ﬁxed tree
rooted at u. (This is unlike the situation with symmetric networks – see the comments in Section 4.3.1.)
Given that, the stability proof in [16] for a Largest-Weighted-Delay-First discipline applies essentially as
is. In fact, the stronger – large deviations – results in [16] apply as well, so that Oldest-Useful is optimal
in the sense of maximizing the decay rate of the tail of stationary distribution of the age-of-information
in the network. We refer reader to [16] for details.

7 Simulation Results for Symmetric Systems

We compare the Oldest-Useful, Random-Useful, and Selﬁsh disciplines via simulation. The version of
Selﬁsh discipline is such that, when a node does not have own useful packets, it sends other useful packets
also in the oldest-ﬁrst order.

We simulate symmetric systems with the number of nodes N = 20, 30, 40, link capacities 1, and
with load values λ = 0.5, 0.7, 0.9. Table 1 gives the steady-state averages for the following performance
measures. The number of distinct packets is the number of packets that arrived in the network, but have
not left yet. (Note that, by Little’s law, the mean number of distinct packets is proportional the mean
network sojourn time of a packet.) If a packet is already present at K < N nodes, we say that it has
N − K undelivered copies. The number of undelivered packet copies is the total number of undelivered
copies of all packets in the network. Age-of-Information (AoI) is the age of the oldest packet in the
network.

We see that, as desired, Oldest-Useful discipline out-performs the Random-Useful discipline in terms
of average AoI. We cannot say that this is necessary expected, because, as we have shown, for some
network topologies Oldest-Useful may not be even maximally stable; however, as we see, this is the case
for symmetric networks.

The Random discipline out-performs the Oldest-Useful discipline both in terms of the average number
of distinct packets (and average packet sojourn time) and in terms of average number of undelivered
packet copies. Surprisingly, the Selﬁsh discipline seems to have the best performance for all metrics, and
especially for the AoI.

We observe that as N grows, with load ﬁxed, the average AoI decreases, while the average numbers of
distinct packets and undelivered packet copies increase; the average number of distinct packets appears

11

to increase sublinearly while the number of undelivered packet copies appears to increase superlinearly.
These trends appear to hold for each discipline.

8 Model Generalizations and Extensions

As we already commented earlier, the packet arrival processes and the link communication processes
can be far more general than Poisson. Basically, as long as, the system evolution can be described by a
Markov process – not necessarily with countable state space – all our results generalize.

Second, our model assumes that packet transmissions across links occur instantly at the epochs of
communication point processes. Our results still apply if packets require some random transmission time
on a link. In this case link capacity cuv = 1/muv, where muv is the mean packet transmission time on
link (u, v).

12

N = 20

Distinct Packets
Oldest-Useful
Random-Useful
Selﬁsh

N = 20

Undelivered Packet Copies
Oldest-Useful
Random-Useful
Selﬁsh

N = 20

N = 30

Age of Information
Oldest-Useful
Random-Useful
Selﬁsh

Distinct Packets
Oldest-Useful
Random-Useful
Selﬁsh

Load 0.5 Load 0.7 Load 0.9
14.13
13.46
12.46

55.25
45.62
42.02

6.26
6.25
5.88

0.5
71.09
56.74
56.13

0.5
0.55
0.60
0.50

0.7
171.03
114.16
111.85

0.9
729.58
341.38
325.73

0.7
0.97
1.21
0.88

0.9
3.07
4.74
2.87

Load 0.5 Load 0.7 Load 0.9
15.95
15.06
13.46

65.58
51.28
45.38

6.98
6.99
6.43

N = 30

Undelivered Packet Copies
Oldest-Useful
Random-Useful
Selﬁsh

0.5
120.54
93.79
93.76

0.7
296.15
186.93
184.94

0.9
1345.93
551.49
514.48

N = 30

N = 40

Age of Information
Oldest-Useful
Random-Useful
Selﬁsh

0.5
0.41
0.45
0.37

0.7
0.73
0.88
0.62

0.9
2.42
3.45
1.94

Distinct Packets
Oldest-Useful
Random-Useful
Selﬁsh

Load 0.5 Load 0.7 Load 0.9
17.27
16.23
14.23

73.52
55.31
47.68

7.49
7.52
6.82

N = 40

Undelivered Packet Copies
Oldest-Useful
Random-Useful
Selﬁsh

0.5
173.98
133.19
134.65

0.7
433.98
264.12
265.48

0.9
2058.66
770.68
718.52

N = 40

Age of Information
Oldest-Useful
Random-Useful
Selﬁsh

0.5
0.33
0.36
0.29

0.7
0.59
0.71
0.49

0.9
2.03
2.74
1.47

Table 1: Simulation results for the Oldest-Useful, Random-Useful, and Selﬁsh disciplines in a symmetric
system.
13

References

[1] Jim G Dai. On positive harris recurrence of multiclass queueing networks: a uniﬁed approach via

ﬂuid limit models. The Annals of Applied Probability, pages 49–77, 1995.

[2] Maria Frolkova and Michel Mandjes. A bitcoin-inspired inﬁnite-server model with a random ﬂuid

limit. Stochastic Models, 35(1):1–32, 2019.

[3] Aditya Gopalan, Abishek Sankararaman, Anwar Walid, and Sriram Vishwanath. Stability and scal-
ability of blockchain systems. Proceedings of the ACM on Measurement and Analysis of Computing
Systems, 4(2):1–35, 2020.

[4] Bruce Hajek and Ji Zhu. The missing piece syndrome in peer-to-peer communication. Stochastic

Systems, 1(2):246–273, 2011.

[5] Stratis Ioannidis, Augustin Chaintreau, and Laurent Massouli´e. Optimal and scalable distribution
of content updates over a mobile social network. In IEEE INFOCOM 2009, pages 1422–1430. IEEE,
2009.

[6] Quan-Lin Li, Jing-Yu Ma, and Yan-Xia Chang. Blockchain queue theory. In International Confer-

ence on Computational Social Networks, pages 25–40. Springer, 2018.

[7] Quan-Lin Li, Jing-Yu Ma, Yan-Xia Chang, Fan-Qi Ma, and Hai-Bo Yu. Markov processes in

blockchain systems. Computational Social Networks, 6(1):1–28, 2019.

[8] Laurent Massouli´e and Andrew Twigg. Rate-optimal schemes for peer-to-peer live streaming. Per-

formance Evaluation, 65(11-12):804–822, 2008.

[9] Laurent Massouli´e and Milan Vojnovi ´C. Coupon replication systems. In Proceedings of the 2005
ACM SIGMETRICS International Conference on Measurement and modeling of computer systems,
pages 2–13, 2005.

[10] Rafael Pass, Lior Seeman, and Abhi Shelat. Analysis of the blockchain protocol in asynchronous
In Annual International Conference on the Theory and Applications of Cryptographic

networks.
Techniques, pages 643–673. Springer, 2017.

[11] A. Rybko and A. Stolyar. Ergodicity of stochastic processes describing the operation of open queue-

ing networks. Problems of Information Transmission, 28:199–200, 1992.

[12] A. Rybko, A. Stolyar, and Y. Suhov. Stability of global lifo networks. Translations of the American

Mathematical Society-Series 2, 207:177–184, 2002.

[13] Suryanarayana Sankagiri, Shreyas Gandlur, and Bruce Hajek. The longest-chain protocol under

random delays. arXiv preprint arXiv:2102.00973, 2021.

[14] Devavrat Shah. Gossip algorithms. Now Publishers Inc, 2009.

[15] Alexander L Stolyar. On the stability of multiclass queueing networks: a relaxed suﬃcient condition

via limiting ﬂuid processes. Markov Processes and Related Fields, 1(4):491–512, 1995.

[16] Alexander L Stolyar. Control of end-to-end delay tails in a multiclass network: Lwdf discipline

optimality. The Annals of Applied Probability, 13(3):1151–1206, 2003.

14

