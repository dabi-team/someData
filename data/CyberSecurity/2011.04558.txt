1
2
0
2

p
e
S
8

]
L
M

.
t
a
t
s
[

3
v
8
5
5
4
0
.
1
1
0
2
:
v
i
X
r
a

Spectral clustering on spherical coordinates under
the degree-corrected stochastic blockmodel

Francesco Sanna Passino1, Nicholas A. Heard1, and Patrick Rubin-Delanchy2

1Department of Mathematics, Imperial College London
2School of Mathematics, University of Bristol

Abstract

Spectral clustering is a popular method for community detection in network graphs: starting from
a matrix representation of the graph, the nodes are clustered on a low dimensional projection obtained
from a truncated spectral decomposition of the matrix. Estimating correctly the number of communities
and the dimension of the reduced latent space is critical for good performance of spectral clustering
algorithms. Furthermore, many real-world graphs, such as enterprise computer networks studied in
cyber-security applications, often display heterogeneous within-community degree distributions. Such
heterogeneous degree distributions are usually not well captured by standard spectral clustering algo-
rithms. In this article, a novel spectral clustering algorithm is proposed for community detection under
the degree-corrected stochastic blockmodel. The proposed method is based on a transformation of the
spectral embedding to spherical coordinates, and a novel modelling assumption in the transformed space.
The method allows for simultaneous and automated selection of the number of communities and the la-
tent dimension for spectral embeddings of graphs with uneven node degrees. Results show improved
performance over competing methods in representing computer networks.

Keywords — degree–corrected stochastic blockmodel, network embeddings, random dot product graph, spectral

clustering.

1 Introduction

Network data are commonly observed in a variety of scientiﬁc ﬁelds, representing, for example, interactions
between neurons in the brain in biology, or connections between computers in communication technologies.
A fundamental problem in the statistical analysis of networks is the task of ﬁnding groups of similar nodes,
known as community detection. Spectral clustering methods (Ng et al., 2001; von Luxburg, 2007) provide
one of the most popular approaches for the community detection task. Such techniques essentially consist
of two steps: (i) spectrally embedding the graph adjacency matrix, or some transformation thereof, into a
low dimensional space, and (ii) apply a clustering algorithm, usually Gaussian mixture modelling (GMM)
or k-means, in the low dimensional space.

Spectral clustering algorithms can be used to obtain estimates of the community structure under a variety
of classical network models. The traditional model for community detection is the stochastic blockmodel
(SBM, Holland et al., 1983): each node in the network is assigned to one of K communities, and the proba-
bility of a connection between two nodes only depends on their community memberships. Asymptotic the-
ory suggests that embeddings arising from SBMs can be modelled using Gaussian mixture models (GMMs)
(Rubin-Delanchy et al., 2017). This article mainly concerns the degree-corrected stochastic blockmodel
(DCSBM, Karrer and Newman, 2011), which extends the SBM, allowing for heterogeneity in the within-
community degree-distribution. In DCSBMs, the probability of a connection depends on the community

1

 
 
 
 
 
 
Spectral clustering on spherical coordinates under the degree-corrected stochastic blockmodel

(a) SBM

(b) DCSBM

(c) ICL2, out-degree

Figure 1: Histogram of within-community degree distributions from three bipartite networks with size 439

60,635,
obtained from (a) a simulation of a SBM, (b) a simulation of a DCSBM, and (c) a real-world computer
network (ICL2, cf. Section 6.2).

×

memberships, but is adjusted by node-speciﬁc degree-correction parameters. However, unlike the SBM,
spectral embeddings under the DCSBM do not adhere to a GMM, since the communities are represented by
rays.

In principle, DCSBMs appear to be particularly suitable for modelling graphs arising from cyber-
security applications, and in particular computer network ﬂow data representing summaries of connec-
tions between Internet Protocol (IP) addresses, since machines within the same organisation tend to have
different levels of activity depending on their purpose. Furthermore, in computer networks, the need for
degree-correction seems most obvious when nodes are observed for different amounts of time, so that their
connection probabilities scale with their “total time on test”. For example, if a new node enters the network,
it would be beneﬁcial to identify its community, despite having very few connections.

The suitability of DCSBMs for community detection in cyber-security, our application of interest, is
demonstrated in Figure 1, where the within-community out-degree distributions arising from two simulated
bipartite SBM (Figure 1a) and DCSBM (Figure 1b), are compared to the out-degree distribution of a real
computer network (Figure 1c). A detailed description of the simulation is given in Section 6.2. The shape of
the degree-distribution of the computer network resembles the simulated DCSBM much more closely than
the SBM, suggesting that a degree-correction is required for correctly estimating the communities.

This article makes two main contributions. First, a novel spectral clustering algorithm for community
detection under the DCSBM is proposed, based on a transformation of the embedding. Second, the proposed
methodology is incorporated within a model selection framework for d, the embedding dimension, and
K, the number of communities, providing a joint estimation method for those two parameters and the
communities. The proposed method is shown to be competitive on simulated and real-world computer
network data.

The article is structured as follows: Section 2 describes the research question and related literature,
followed by a preliminary discussion of spectral embedding techniques. Our proposed model is presented
in Section 3. Parameter estimation and model selection are then discussed in Section 4. The proposed model
is validated in Section 5, and results on simulated and real world computer network data are presented in
Section 6.

2 Background and motivation

A network can be expressed as a graph G = (V, E), consisting of a set of nodes V of cardinality n, and a
V representing the pairs of nodes which have interacted. The graph is summarised by
set of edges E
×
n.
for 1
its adjacency matrix A
0, 1
E, the graph is undirected, implying that A is symmetric; otherwise the graph
E
If (i, j)

n×n, where Aij = 1E

n, with Aii = 0, 1

(i, j)
}

(j, i)

i, j

⊆

≤

≤

≤

≤

V

}

{

i

∈

⇐⇒

∈ {
∈

2

30003500400045005000Out-degree0510152025Frequency010002000300040005000Out-degree0510152025Frequency01000200030004000Out-degree05101520253035FrequencyChemistryCivilEngineeringMathematicsMedicineSpectral clustering on spherical coordinates under the degree-corrected stochastic blockmodel

is directed.

The degree-corrected stochastic blockmodel (DCSBM, Karrer and Newman, 2011) is a popular model
for community detection in graphs. For K communities, the nodes are divided into blocks by random assign-
n, with community probabilities
ment of community membership indicators z = (z1, . . . , zn)
}
ψ = (ψ1, . . . , ψK), (cid:80)K
j=1 ψj = 1. Furthermore, each node is assigned a degree-correction parameter
ρi

[0, 1]. Each entry of the adjacency matrix is then independently modelled as

1, . . . , K

∈ {

∈

where B
×
from community k interacting with a node from community (cid:96).

[0, 1]K×K is a K

∈

Aij

∼

Bernoulli(ρiρjBzizj ),

(2.1)

K matrix of probabilities such that Bk(cid:96) is a baseline probability for a node

∈

Beyond DCSBMs, random dot product graphs (RDPG, Young and Scheinerman, 2007) represent a
wider and more ﬂexible class of models for network data. Each node is assigned a d-dimensional latent
Rd such that x
[0, 1] for i, j
position xi
. The probability of a link between i
∈
(cid:124)
Bernoulli(x
and j is then determined as Aij
i xj). The latent positions can be arranged in a matrix
X = [x1, . . . , xn](cid:124)
Rn×d such that E(A) = XX(cid:124)
. For a positive deﬁnite block connectivity probability
matrix B, DCSBMs can be expressed as RDPGs. If each community is assigned an uncorrected position
µk
V ,
conditional on the communities z and degree-correction parameters ρ = (ρ1, . . . , ρn).

, the DCSBM is obtained by setting xi = ρiµzi, i

(cid:124)
Rd, such that Bk(cid:96) = µ
kµ(cid:96), k, (cid:96)

1, . . . , K

1, . . . , n

(cid:124)
i xj

∈ {

∈ {

∼

∈

∈

∈

}

}

This article is primarily concerned with a novel technique for estimating the underlying node communi-
ties given an adjacency matrix, under a RDPG interpretation of the DCSBM. A joint estimation method is
proposed for the community structure z, the number of communities K, and the latent dimension d of the
latent positions.

2.1 Related literature, shortcomings, and proposed solutions

Community detection based on DCSBMs is an active ﬁeld of research. Zhao et al. (2012) present a theory for
assessing consistency under the DCSBM. Amini et al. (2013) use a pseudo-likelihood approach, providing
consistency results for the estimators. Peng and Carvalho (2016) frame the DCSBM in a Bayesian setting,
using a logistic regression formulation with node correction terms. Chen et al. (2018) propose a convexiﬁed
modularity maximisation approach. Gao et al. (2018) obtain a minimax risk result for community detection
in DCSBMs and propose a two-step clustering algorithm based on k-medians.

Spectral clustering methods have emerged as one of the most popular approaches for community detec-
tion under the DCSBM (Lei and Rinaldo, 2015; Gulikers et al., 2017). A common technique uses k-means
on the normalised rows of the embedding (Qin and Rohe, 2013) obtained from the spectral decomposition
of the regularised Laplacian matrix (Chaudhuri et al., 2012). The row-normalisation of the embedding is a
well-established approach for spectral clustering (Ng et al., 2001) under the DCSBM, but the normalised
1 dimensional manifold, so it is not fully appropriate to ﬁt a model for d-dimensional
rows live in a d
clusters to such an embedding. Alternative methods include the SCORE algorithm of Jin (2015), which pro-
poses to use k-means on an embedding scaled by the leading eigenvector, showing that the effect of degree
heterogeneity can be largely removed.

−

This article proposes a novel methodology for spectral clustering under the DCSBM, interpreted as a
1 directions, or
special case of RDPG: the d-dimensional spectral embedding is reduced to a set of d
angles, changing from a Cartesian coordinate system to a spherical system. This choice of transformation
is carefully motivated by asymptotic theoretical properties of the embeddings arising from DCSBMs.

−

Additionally, many estimation methods commonly require the number of communities K to be known.
Furthermore, spectral clustering methods require the speciﬁcation of the embedding dimension d, and clus-
tering is usually carried out after selecting this parameter. This sequential approach is suboptimal, since the
clustering conﬁguration and the number of communities K would ideally be estimated jointly with d. In

3

Spectral clustering on spherical coordinates under the degree-corrected stochastic blockmodel

practice, selecting d and K is a difﬁcult task. Sanna Passino and Heard (2020) and Yang et al. (2020) in-
dependently proposed an automatic model selection framework for both the number of communities K and
the dimension d of the latent node positions in SBMs, interpreted as RDPGs. In this work, the methodology
is extended to DCSBMs, providing an algorithm for practitioners.

2.2 Spectral embedding

Given a network adjacency matrix, spectral embedding methods provide estimates ˆX of the latent positions
X in RDPGs, from decompositions of the adjacency matrix or its Laplacian. This article will mainly discuss
the adjacency spectral embedding, deﬁned below.

Deﬁnition 1 (Adjacency spectral embedding). Consider a symmetric adjacency matrix A
a positive integer d
}
ˆΛ
where
|
|
eigenvalues of A in magnitude, in decreasing order, and ˆΓ is a n
orthonormal eigenvectors.

n×n and
}
ˆΛ
. The adjacency spectral embedding (ASE) of A in Rd is ˆX = ˆΓ
1/2,
|
|
d matrix containing on the main diagonal the absolute value of the top-d
d matrix containing corresponding

is a diagonal d

1, . . . , n

∈ {

∈ {

0, 1

×

×

For a directed graph, the RDPG model assumes each node i

Rd,
j). The corresponding spectral embedding uses singular value decomposi-
such that Aij
tion. Bipartite graphs can be interpreted as a special case of directed graphs, and therefore are also spectrally
embedded using the same procedure.

V has two latent positions xi, x(cid:48)

(cid:124)
i x(cid:48)
Bernoulli(x

i ∈

∼

∈

n×n, not
Deﬁnition 2 (Directed adjacency spectral embedding). Consider an adjacency matrix A
. The directed adjacency spectral embedding
necessarily symmetric, and a positive integer d
(DASE) of A in Rd is jointly given by ˆX = ˆUˆS1/2 and ˆX(cid:48) = ˆVˆS1/2, where ˆS is a diagonal d
d matrix
containing on the main diagonal the top-d singular values of A in magnitude, in decreasing order, and ˆU
and ˆV are n
d matrices containing corresponding orthonormal left and right singular vectors respectively.

1, . . . , n

∈ {

∈ {

0, 1

×

}

}

×

2.3 Asymptotic properties of spectral embedding of DCSBMs

An important result in the RDPG literature establishes the rows of the ASE as consistent estimators of the
latent positions (Sussman et al., 2014). Furthermore, central limit theorems (ASE-CLTs, Athreya et al.,
2016; Rubin-Delanchy et al., 2017; Tang and Priebe, 2018) provide strong justiﬁcation for estimation of the
latent positions via ASE.

When ASE is applied to DCSBMs, the asymptotic theory (see, for example, Rubin-Delanchy et al.,
2017) predicts that each community is represented as a ray from the origin in the embedding space. An
example is given in Figure 2a, which shows the two-dimensional ASE for a simulated DCSBM with n =
1,000 nodes and K = 4 communities.

To describe each community, let x = ρµk

Rd be the underlying latent position for a node in commu-
nity k. Further, let ˆx(n) be the ASE estimator of x, obtained from a graph with n nodes. For d ﬁxed and
known, the ASE-CLT (for example, Athreya et al., 2016), applied to DCSBMs, establishes that

∈

(cid:16)

(cid:110)

√n

Q(n) ˆx(n)

P

lim
n→∞

(cid:17)

x

−

v

|

≤

(cid:111)

x = ρµk

Φd

v, Σk(ρ)
}

,

{

→

(2.2)

∈

∈

{·

, Σ
}

Rd, Q(n)

Rd×d is an orthogonal matrix, Σk(ρ) is a d

where v
d community-speciﬁc covariance matrix
is the CDF of a d-dimensional Gaussian distribution with zero mean and
depending on ρ, and Φd
covariance Σ. Jones and Rubin-Delanchy (2020) extended the result (2.2) to the DASE (cf. Deﬁnition 2). In
simpler terms, (2.2) implies that, for n large, the estimated latent position ˆxi is normally distributed about
ρiµzi, after a suitable orthogonal transformation has been applied to the embedding (accounting both for the
ambiguity in the choice of eigenvectors or singular vectors within the spectral embedding procedure, and
the latent position identiﬁability in the RDPG). The theorem is exempliﬁed by Figure 2b, which displays the

×

4

Spectral clustering on spherical coordinates under the degree-corrected stochastic blockmodel

(a) K = 4, coloured by community membership

(b) K = 2, with ASE-CLT contours

Figure 2: Scatterplots of the two-dimensional ASE of a simulated DCSBM with (a) K = 4, and (b) K = 2. Figure 2b
also highlights the true and estimated latent position for 6 nodes, with the corresponding 50%, 75% and
90% contours from the ASE-CLT, and the estimated latent positions ˆx1,(cid:96) for x1 from simulated DCSBM
adjacency matrices A(cid:96), (cid:96) = 1, . . . , 1000.

∼

two-dimensional ASE of a simulated DCSBM with n = 1,000 and K = 2 equally probable communities,
with µ1 = [1/4, 3/4], µ2 = [3/4, 1/4], and ρi
Uniform(0, 1). For 6 nodes, the plot highlights the
true and estimated latent positions, and corresponding theoretical Gaussian contours from the ASE-CLT.
Additionally, the simulation of the adjacency matrix is repeated 1,000 times using the same true underlying
latent positions as the ﬁrst simulation. Then, the ASE-estimated latent position for the ﬁrst node is plotted
for each simulation, along with the Gaussian contours estimated from the 1,000 estimates. The empirical
contours (dashed lines) remarkably correspond to the theoretical ASE-CLT contours (solid lines) around the
true latent position x1. Also, Figure 2b shows that, within the same community, the true latent positions
all have the same spherical coordinates, or angle to the origin, whereas their corresponding ASE estimates
are distributed around the line of the true latent positions, forming a community-speciﬁc ray. The ASE-
CLT (2.2) also establishes that estimated latent positions tend to asymptotically concentrate increasingly
tightly around the rays connecting the origin and the unnormalised latent positions µk, k
.
}
Therefore, Figure 2 intuitively motivates the novel modelling choice proposed in this paper: estimating the
node communities from the spherical coordinates, or angles, obtained from the ASE. The use of alternative
coordinate systems for network analysis has been previously shown to have beneﬁcial properties (see, for
example, Krioukov et al., 2010; Braun and Bonfrer, 2011; McCormick and Zheng, 2015; Alanis-Lobato
et al., 2016). Furthermore, a central limit theorem for the spherical coordinates of the latent positions is
proved for d = 2 in Appendix A, further establishing the suitable properties of such a transformation of the
embedding.

1, . . . , K

∈ {

One of the main characteristics of the proposed methodology will be to allow for an initial misspeci-
d, and then recovering the
ﬁcation of the parameter d, choosing an m-dimensional embedding with m
correct latent dimension by proposing a discriminative model for the extended embedding. In the remainder
of the article, the notation ˆX:d denotes the ﬁrst d columns of ˆX, and ˆXd: denotes the m
d remaining
columns. Similarly, ˆxi,:d represents the ﬁrst d components (ˆx1, . . . , ˆxd) of the vector ˆxi, and ˆxi,d: the last
d components (ˆxd+1, . . . , ˆxm). Also, the row-normalised embedding is denoted as ˜X = [ ˜x1, . . . , ˜xn](cid:124)
m
,
where ˜xi = ˆxi/
(cid:107)

. Importantly, the parameter m is always assumed to be ﬁxed.
(cid:107)

ˆxi

−

≥

−

5

−1−0.8−0.6−0.4−0.20−0.6−0.4−0.200.20.4ˆX1ˆX200.20.40.60.800.20.40.60.8X1X2EstimatedlatentpositionsˆxiUncorrectedlatentpositionsµkˆx1,‘fromASEofA‘AdjacencyembeddingofATruelatentpositionsxiASE-CLTcontoursEstimatedcontoursµ1µ2x4x5x6x3x2x1ˆx4ˆx5ˆx6ˆx3ˆx2ˆx1Spectral clustering on spherical coordinates under the degree-corrected stochastic blockmodel

3 Modelling a transformation of DCSBM embeddings

Rm. The m Cartesian coordinates x = (x1, . . . , xm) can be
1 spherical coordinates θ = (θ1, . . . , θm−1) on the unit m-sphere using a mapping fm :

∈

Consider an m-dimensional vector x
converted in m
Rm

[0, 2π)m−1 such that fm : x

−

→

θ, where:
(cid:55)→
(cid:26) arccos(x2/

θ1 =

2π

−

)
x:2
(cid:107)
(cid:107)
arccos(x2/
(cid:107)
), j = 2, . . . , m

0,
x1
) x1 < 0,

x:j+1

x:2

≥

(cid:107)

θj = 2 arccos(xj+1/
(cid:107)

(cid:107)

1,

−

(3.1)

(3.2)

where

is the Euclidean norm.

∈

Consider an (m + 1)-dimensional adjacency embedding ˆX

(cid:107) · (cid:107)
Rn×(m+1) and deﬁne its transformation
∈
ˆΘ = [ ˆθ1, . . . , ˆθn](cid:124)
[0, 2π)n×m, where ˆθi = fm+1( ˆxi), i = 1, . . . , n. The symbols ˆΘ:d and ˆθi,:d will
denote respectively the ﬁrst d columns of the matrix and d elements of the vector, and ˆΘd: and ˆθi,d: will
represent the remaining m

d components.

In this article, a model is proposed for the transformed embeddings ˆΘ. Suppose a latent space dimension
d, K communities, and latent community assignments z = (z1, . . . , zn). The transformed coordinates ˆΘ
are assumed to be generated independently from community-speciﬁc m-dimensional multivariate normal
distributions:

−

ˆθi

d, zi, ϑzi, Σzi, σ2
|

zi ∼

Nm

(cid:18)(cid:20) ϑzi

π1m−d

(cid:21)

(cid:20)Σzi
0

,

(cid:21)(cid:19)

.

0
ziIm−d

σ2

(3.3)

∈

[0, 2π)d, k = 1, . . . , K, represents a community-speciﬁc mean angle, 1m is a m-dimensional
where ϑk
k,m) is a vector of positive
vector of ones, Σk is a d
variances. The model in (3.3) could be also completed in a Bayesian framework using the same prior
distributions chosen in Sanna Passino and Heard (2020). For ﬁxed d and K, consider a set of mixing
proportions ψ = (ψ1, . . . , ψK) such that P(zi = k) = ψk, where ψk
k=1 ψk = 1.
After marginalising out z, the likelihood function is:

d full covariance matrix, and σ2

0, k = 1, . . . , K, and (cid:80)K

k,d+1, . . . , σ2

k = (σ2

×

≥

L( ˆΘ
|

d, K) =




K
(cid:88)

n
(cid:89)

i=1



j=1

ψjφd( ˆθi,:d; ϑj, Σj)φm−d( ˆθi,d:; π1m−d, σ2

j Im−d)






,

(3.4)

; ϑ, Σ) is the density of a q-dimensional normal distribution with mean ϑ and variance Σ. Note
where φq(
·
that, normally, a wrapped normal distribution would be preferred for circular data. On the other hand, in the
context of DCSBMs, it is known that ˆΘ arises from a transformation of the embedding ˆX, and the form of
the transformation can be used to inform the modelling decisions. The arccosine function is monotonically
decreasing, and communities will tend to have similar values in ˆxi,j/
1, see (3.2).
(cid:107)
If two points in ˆΘ reach the extremes 0 and 2π, then they are unlikely to belong to the same community.
Therefore, wrapped distributions do not apply to this context.

for j = 1, . . . , m

ˆxi,:j

−

(cid:107)

The only case that could cause concern is θi,1, where the transformation (3.1) is not monotonic, but has
a discontinuity at 0. The ﬁrst column ˆX1 of the ASE corresponds to the scaled leading eigenvector of the
adjacency matrix, and therefore its elements have all the same sign by the Perron-Frobenius theorem for
non-negative matrices (see, for example, Meyer, 2000). The theorem makes the transformation x:2
θ1 in
(3.1) monotonic, since one of the two conditions in the equation for θ1 is satisﬁed by all the values in ˆX1.

(cid:55)→

The rationale behind the model assumptions in (3.3) is to utilise the method of normalisation to the
unit circle (Qin and Rohe, 2013) but assume normality on the spherical coordinates, not on their Cartesian
counterparts, as discussed in the comments to Figure 2b. The transformed initial components ˆθi,:d are
assumed to have unconstrained mean vector ϑk
d
covariance matrix Σk.

[0, 2π)d, and a positive deﬁnite community-speciﬁc d

×

∈

6

Spectral clustering on spherical coordinates under the degree-corrected stochastic blockmodel

−

In contrast to the structured model for ˆΘ:d, the remaining m

d dimension of the embedding are
modelled as noise, using similar constraints on ˆxi,d: to those imposed in Sanna Passino and Heard (2020) and
Yang et al. (2020): the mean of the distribution is a (m
d)-dimensional vector centred at 2 arccos(0) = π,
and the covariance is a diagonal matrix σ2
kIm−d with positive diagonal entries. The mean value of π reﬂects
the assumption in Sanna Passino and Heard (2020) and Yang et al. (2020) of clusters centred at zero: for
j > d, xi,j is expected to be near 0, which makes the transformed coordinate centre ﬂuctuate around π.
Importantly, the assumption of cluster-speciﬁc variances on ˆΘd: implies that d does not have the simple
interpretation of being the number of dimensions relevant for clustering. This fundamentally differentiates
the proposed modelling framework from traditional variable selection methods within clustering (see, for
example, Raftery and Dean, 2006). The parameter d + 1 in this model represents the dimension of the latent
positions that generate the network, or the rank of the block connectivity matrix B.

−

It must be further remarked that the model (3.3) concerns the distribution of the spherical coordinates of
the ASE estimator of the DCSBM latent positions, and it is not a generative model for DCSBMs. If used as
a generative model, paired with a distributional assumption on the degree-correction parameters, the model
(3.3) would generate a noisy DCSBM, where the underlying latent positions are scattered around the rays,
and not perfectly on the rays as a traditional DCSBM (cf. Figure 2b). Considering the ASE-CLT (2.2), the
estimation procedure proposed in this work would still be applicable also to such a noisy DCSBM.

Finally, note that the method relies on an initial choice of the embedding dimension m

d. The param-
eter should be large enough to avoid potential issues with the case m < d. Choosing m is arguably easier
than choosing d, and in principle one could pick m = n. As a rule of thumb, the parameter could be chosen
d, ˆΘ:d is
as the third or fourth elbow based on the criterion of Zhu and Ghodsi (2006). Note that, for m
invariant to the choice of m: embeddings ˆΘ:d calculated from m-dimensional and m∗-dimensional embed-
= m∗, are identical. This is not the case for the row-normalised embedding: embeddings ˜X:d
dings, with m
obtained from m-dimensional and m∗-dimensional embeddings are in general not equal.

≥

≥

4 Model selection and parameter estimation

For selection of the number of communities K and latent dimension d, a classical approach of model com-
parison via information criteria is adopted, already used by Yang et al. (2020) in the context of simultaneous
model selection in SBMs. Suppose that the maximum likelihood estimate (MLE) of the model parameters
for ﬁxed d and K is

k=1,...,K. The Bayesian Information Criterion (BIC) is deﬁned as:

ˆϑk, ˆΣk, ˆσ2
{

k, ˆψk

}

BIC(d, K) =

n
(cid:88)

i=1

2
−

log




K
(cid:88)



k=1

ˆψjφ( ˆθi,:d; ˆϑk, ˆΣk)

m
(cid:89)

j=d+1

φ(ˆθi,j; π, ˆσ2

k,j)






+ K log(n)(d2/2 + d/2 + m + 1).

(4.1)

.

}

1, . . . , K∗

The ﬁrst term of the BIC (4.1) is the negative log-likelihood (3.4), whereas the second term is a penalty.
The estimates of d and K will correspond to the pair that minimises (4.1), obtained using grid search:
( ˆd, ˆK) = argmin(d,K) BIC(d, K). The latent dimension d has range
.
}
In practice, it is convenient to ﬁx a maximum number of clusters K∗ in the grid search procedure, such that
K

∈ {
From (4.1), it follows that the MLE of the Gaussian model parameters is required for each pair (d, K).
The expectation-maximisation (EM, Dempster et al., 1977) algorithm is typically used for problems involv-
ing likelihood maximisation in model based clustering (for example, Fraley and Raftery, 2002). Finding the
MLE for (3.4) only requires a simple modiﬁcation of the standard algorithm for GMMs, adding constraints
d components. Under the assumption that the model for the
on the means and covariances of the last m
spherical coordinates is correctly speciﬁed, then the same framework described in Theorem 1 in Yang et al.
(2020) could be used to obtain theoretical guarantees on the estimates.

, whereas K

1, . . . , m

1, . . . , n

∈ {

−

{

}

7

(cid:54)
Spectral clustering on spherical coordinates under the degree-corrected stochastic blockmodel

Given the maximum likelihood estimates for (d, K), the communities are estimated as
(cid:110) ˆψjφ ˆd

(cid:16) ˆθi,: ˆd; ˆϑj, ˆΣj

, i = 1, . . . , n,

(cid:17)(cid:111)

ˆzi = argmax
j∈{1,..., ˆK}

(4.2)

where a ˆK-component GMM is ﬁtted to the ˆd-dimensional embedding, and the second Gaussian term in
the likelihood (3.4), accounting for the last m
d components of the embedding, is removed to reduce the
bias-variance tradeoff (Yang et al., 2020).

−

For a given pair (d, K), fast estimation and convergence can be achieved by initialising the EM algorithm
with the MLE of a GMM ﬁtted on the initial d components of the m-dimensional embedding. This approach
It
for initialisation will be followed in Section 6.2. The full procedure is summarised in Algorithm 1.
K∗ EM-
must be remarked that the grid search procedure for estimating (d, K) from (4.1) requires m
algorithms. This is computationally intensive, especially if the number of nodes is large, or m and K∗ are
large. Therefore, the methodology for estimation of (d, K) is not scalable to very large graphs.

×

Algorithm 1: Estimation of the latent dimension d, number of communities K, and community
allocations z, given a graph adjacency matrix A.

n×n, maximum number of communities K∗.
Input: adjacency matrix A
Result: estimated community allocations ˆz and estimated latent dimensionality ˆd.

0, 1
}

∈ {

1 select m as the third or fourth elbow of the scree plot (Zhu and Ghodsi, 2006),
2 calculate the m-dimensional ASE ˆX
Rn×m (or DASE for directed graphs),
3 transform the embedding ˆX
4 for d = 1, 2, . . . , m do
5

Rn×m into spherical coordinates ˆΘ

∈

∈

∈

[0, 2π)n×(m−1),

for K = 1, . . . , K∗ do
ˆψj, ˆϑj, ˆΣj, ˆσ2
calculate MLE
j }
{
calculate BIC(d, K) using (4.1),

6

7

k=1,...,K of model (3.3) using the EM algorithm,

end

8
9 end
10 obtain the estimate ( ˆd, ˆK) = argmin(d,K) BIC(d, K) for the pair (d, K),
11 ﬁt a ˆK-component GMM to ˆΘ: ˆd, and estimate the communities z using (4.2).

5 Empirical model validation

In order to validate the modelling approach in (3.3), a simulation study has been carried out. Additional
results on model validation are also reported in Appendices A and B.

5.1 Gaussian mixture modelling of DCSBM embeddings

First, a simple simulation is used to show that k-means or Gaussian mixtures are not appropriate for mod-
elling an embedding ˆX under the DCSBM, even when the row-normalised embedding ˜X is used. The
ASE was obtained from a simulated DCSBM with n = 1,000 nodes, K = 2 and d = 2, with an equal
number of nodes allocated to each group, and B11 = 0.1, B12 = B21 = 0.05 and B22 = 0.15, corrected
Beta(2, 1). Since the community allocations z are known a priori in the simulation,
by parameters ρi
it is possible to evaluate the community-speciﬁc distributions. The results are plotted in Figure 3, which
shows the scatterplot and histograms of the marginal distributions for the two-dimensional adjacency spec-
tral embedding ˆX and its normalised version ˜X, and for its transformation to spherical coordinates ˆΘ, all
labelled by community. From Figure 3a, it is clear that applying k-means or Gaussian mixture modelling

∼

8

Spectral clustering on spherical coordinates under the degree-corrected stochastic blockmodel

(a) Scatterplot of ˆxi

(b) Scatterplot of ˜xi = ˆxi/
(cid:107)

ˆxi(cid:107)

(c) Histograms of ˆθi = f2( ˆxi)

Figure 3: Plots of ˆxi, ˜xi = ˆxi/

and ˆθi = f2( ˆxi), obtained from the two dimensional ASE of a simulated
DCSBM. Joint (green) and community-speciﬁc (blue and red) marginal distributions with MLE Gaussian
ﬁt are also shown.

ˆxi(cid:107)
(cid:107)

on ˆX is suboptimal, since the joint distribution or cluster-speciﬁc marginal distributions are not normally
distributed, as predicted by the ASE-CLT (2.2). Figure 3b shows that row-normalisation is beneﬁcial, since
the marginal distributions for ˜X2 are normally distributed within each community, but it is not appropriate
for modelling the joint distribution and for at least one of the two marginal distributions for ˜X1. On the other
hand, the transformation ˆΘ in Figure 3c visually meets the assumption of normality. This visual impression
is conﬁrmed in Appendix A, which describes a CLT which strongly supports the normality in ˆΘ for the
two-dimensional case.

5.2 Structure of the likelihood

In order to validate the conjecture on the model likelihood proposed in (3.3), a simulation study has been
carried out. N = 1,000 DCSBMs with n = 2,000 nodes have been simulated, ﬁxing K = 3, and pre-
allocating the nodes to equal-sized clusters. The community-speciﬁc latent positions used in the simulation
are µ1 = (0.7, 0.4, 0.1), µ2 = (0.1, 0.1, 0.5) and µ3 = (0.4, 0.8,
0.1), resulting in the block-probability
matrix:

−

B =





0.66 0.16 0.59
0.16 0.27 0.07
0.59 0.07 0.81



 .

(5.1)

The matrix is positive deﬁnite and has full rank 3, implying that d = 2 in the embedding ˆΘ. For each of
the N simulations, the link probabilities are corrected using the degree-correction parameters ρi sampled
from a Uniform(0, 1) distribution, and the adjacency matrices A are obtained using (2.1). For each of the
simulated graphs ASE is calculated for a large value of m. The results are summarised in Figure 4.

The true underlying cluster allocations are known in the simulation, and can be used to validate the
model assumptions. In this section, the community-speciﬁc mean and covariance matrices obtained from
the embedding ˆΘ of the sampled graph will be denoted as ˆϑk and ˆΣk. Figure 4a shows the boxplots of the
community-speciﬁc estimated means for the ﬁrst two components of ˆΘ. The mean values show minimal
variation across the different simulations, and are clearly different from 0 and differ between clusters. In
Figure 4b, boxplots for the community-speciﬁc estimated variances in ˆΘ:d are plotted. Again, it seems that
having cluster-speciﬁc variances is sensible, and at least one of the covariances is signiﬁcantly different from
0, as expected from the theory. On the other hand, Figure 4c shows the boxplots for the community-speciﬁc
estimated means in ˆΘd:, which are all centred at π. Hence, the assumption on the mean structure in (3.3)
seems to be justiﬁed.

9

−101ˆX2Community1Community2−2−1.5−1−0.50ˆX1−0.500.5˜X2Community1Community2−1−0.9−0.8−0.7−0.6−0.5˜X100.511.53.844.24.44.64.855.25.45.65.860123ˆΘSpectral clustering on spherical coordinates under the degree-corrected stochastic blockmodel

(a) Boxplots of ˆϑk,:2

(b) Boxplots of ˆΣk

(c) Boxplots of ˆϑk,2:

(d) Boxplots of [ ˆΣk]j,j

(e) Boxplots of [ ˆΣk]1,j

(f) Estimated ˆΣ1

(g) Boxplots of KS scores for Gaussian ﬁt in ˆΘd:

Figure 4: Boxplots for N = 1,000 simulations of a degree-corrected stochastic blockmodel with n = 2,000 nodes,
K = 3, equal number of nodes allocated to each group, and B described in (5.1), corrected by parameters
ρi sampled from a Uniform(0, 1) distribution.

10

j=1j=2123ˆϑk,jk=1k=2k=300.511.522.5[ˆΣk]1,1k=1k=2k=30.050.10.150.2[ˆΣk]2,2k=1k=2k=3−0.0500.050.10.150.2[ˆΣk]1,23.103.12π3.163.18ˆϑ1,j3.083.103.12π3.163.18ˆϑ2,j34567893.103.12π3.163.18jˆϑ3,j0.30.40.5[ˆΣ1]j,j0.150.20.25[ˆΣ2]j,j34567890.20.30.4j[ˆΣ3]j,j−0.0500.05[ˆΣ1]1,j−0.0500.05[ˆΣ2]1,j3456789−0.0500.05j[ˆΣ3]1,j0.000.050.100.150.200.250.300.350.40Cluster1Cluster2Cluster3AllCluster1Cluster2Cluster3AllCluster1Cluster2Cluster3AllCluster1Cluster2Cluster3All00.050.100.15d=3d=4d=5d=6KSscoreSpectral clustering on spherical coordinates under the degree-corrected stochastic blockmodel

A potentially more controversial modelling choice is the community-speciﬁc variance for the last m
d
components of the embedding. Figure 4d shows the estimated variances for each community on different
dimensions exceeding 2. It is clear that the variance is different across different communities. This consid-
eration is reinforced by Figure 4g, which shows the boxplots of Kolmogorov-Smirnov (KS) scores obtained
from ﬁtting community-speciﬁc Gaussian distributions on the dimensions exceeding d, compared to the KS
score for a Gaussian ﬁt on all the estimated latent positions for the corresponding dimension. Clearly, a
correct modelling approach must use community-speciﬁc variances. This implies that residual cluster infor-
mation is present also in the last m
d dimensions of the embedding. Finally, Figure 4e plots the boxplots
of estimated covariances between ˆΘ1 and ˆΘ2:. Consistent with the model in (3.3), the correlations are scat-
tered around 0, and the assumption of independence between those components seems reasonable. This is
conﬁrmed by the plot of the average estimated covariance matrix for the ﬁrst community, in Figure 4f.

−

−

5.3 Normality of the spherical coordinates

The most important comparison is to establish whether the embedding ˆΘ is better suited to GMM than the
row-normalised embedding ˜X traditionally used in the literature. To make this comparison, the p-values for
the two Mardia tests for multivariate normality (Mardia, 1970) have been calculated for each community-
speciﬁc distribution, for each simulated graph. The tests are based on multivariate extensions of skewness
Rd, and deﬁne the sample mean and
and kurtosis: assume a sequence of random vectors x1, . . . , x(cid:96)
sample covariance as ¯x = (cid:80)(cid:96)
¯x)(cid:124)/(cid:96) respectively. Mardia (1970)
deﬁnes two test statistics for multivariate skewness and kurtosis:

i=1 xi/(cid:96) and S = (cid:80)(cid:96)

∈
¯x)(xi

i=1(xi

−

−

TS =

1
6(cid:96)

(cid:96)
(cid:88)

(cid:96)
(cid:88)

i=1

j=1

(cid:2)(xi

−

(cid:124)
¯x)

S−1(xj

¯x)(cid:3)3

,

−

TK =

(cid:115)

(cid:96)
8d(d + 2)

(cid:40)

1
(cid:96)

(cid:96)
(cid:88)

i=1

(cid:2)(xi

−

(cid:124)

¯x)

S−1(xi

¯x)(cid:3)2

d(d + 2)((cid:96)
(cid:96) + 1

−

−

−

(cid:41)

1)

.

Under the null hypothesis of multivariate normality, TS
distribution for (cid:96)
→ ∞
calculated from the asymptotic distribution.

N(0, 1) in
(Mardia, 1970). Given observed values of TS and TK, p-values pS and pK can be

d(d + 1)(d + 2)/6
}

and TK

χ2

→

→

{

Under the same setup as the simulation in Section 5.2, p-values are calculated for the two Mardia tests
applied for each community on the spherical embedding ˆΘ:2 and the row-normalised embedding ˜X:3. Then,
binomial sign tests for paired observations are calculated on the differences between the p-values obtained
from ˆΘ:2, and those obtained from ˜X:3, separately for pS and pK, under the null hypothesis that those
are sampled from the same distribution. The alternative hypothesis is that the distribution of the p-values
obtained from ˆΘ:2 is stochastically larger than the corresponding distribution for ˜X:3. The p-value of
the sign test is < 10−10 for both skewness and kurtosis, conﬁrming the impression in Figure 3 that the
transformation (3.2) to ˆΘ tends to Gaussianise the embeddings ˆX and ˜X.

6 Applications and results

In this section, the model selection procedure is assessed on simulated DCSBMs and real-world bipartite
graphs obtained from the network ﬂow data collected at Imperial College London. The DCSBM for bipartite
graphs is a simple extension of the undirected model, and has a similar RDPG-structure to the bipartite
stochastic co-blockmodel (ScBM, Rohe et al., 2016). In bipartite graphs, the nodes are divided into two
V (cid:48). Such networks are conveniently represented by
non-overlapping groups V and V (cid:48) such that E
. Suppose the nodes in V and
rectangular adjacency matrices A
n
V (cid:48) respectively belong to K and K(cid:48) communities, with respective community allocations z
}
n(cid:48). Also, suppose for each of the two sets of communities there are latent positions
and z(cid:48)
}

V
n×n(cid:48), where n =
}

1, . . . , K(cid:48)

and n(cid:48) =

1, . . . , K

V (cid:48)
|

∈ {

V
|

∈ {

∈ {

0, 1

⊆

×

|

|

11

Spectral clustering on spherical coordinates under the degree-corrected stochastic blockmodel

(a) Undirected DCSBM

ˆX

Proportion of correct d
0.788
Proportion of correct K 0.000
0.339

Average ARI

K = 2
˜X

0.796
0.080
0.510

ˆΘ

ˆX

0.972
0.624
0.764

0.740
0.000
0.594

K = 3
˜X

0.736
0.092
0.748

ˆΘ

0.748
0.296
0.858

(b) Bipartite DCScBM

ˆX

Proportion of correct d
0.940
Proportion of correct K 0.000
0.374

Average ARI

K = 2
˜X

0.948
0.056
0.564

ˆΘ

ˆX(cid:48)

K(cid:48) = 3
˜X(cid:48)

0.876
0.580
0.885

0.888
0.000
0.490

0.916
0.096
0.572

ˆΘ(cid:48)

0.896
0.540
0.715

Table 1: Estimated performance for N = 250 simulated DCSBMs and bipartite DCScBMs.

Rd, k
µk
∈
probability

∈ {

1, . . . , K

, and µ(cid:48)
}

(cid:96) ∈

Rd, (cid:96)

1, . . . , K(cid:48)

∈ {

, such that µ

}

(cid:124)
kµ(cid:48)

(cid:96) ∈

[0, 1]. This gives the link

Aij

∼

Bernoulli(ρiρ(cid:48)

(cid:124)
jµ

ziµ(cid:48)
z(cid:48)j

), i

∈

V, j

∈

V (cid:48),

(6.1)

∈

j ∈

[0, 1] and ρ(cid:48)

[0, 1] are degree correction parameters for each of the nodes in V and V (cid:48).
where ρi
From A, it is possible to obtain embeddings ˆX and ˆX(cid:48) using the DASE in Section 2.2, and cluster the two
embeddings jointly or separately. In this work, the quality of the clustering is evaluated using the adjusted
Rand index (ARI, Hubert and Arabie, 1985). Higher values of the ARI correspond to better clustering
performance, reaching a maximum of 1 for perfect agreement between the estimated clustering and the true
labels.

6.1 Synthetic networks

∈ {

2, 3
}

The performance of the model selection procedure described in Section 4 is evaluated on simulated DCS-
BMs. N = 250 undirected graphs with n = 1,000 and K
were simulated, randomly selecting B
from Uniform(0, 1)K×K and sampling the degree correction parameters from Beta(2, 1). The nodes were
allocated to communities of equal size. For each of the graphs, the models of Sanna Passino and Heard
(2020) and Yang et al. (2020) are applied to the ASE ˆX and its row-normalised version ˜X for m = 10,
selecting the estimates of d and K using BIC. The value m = 10 is usually approximately equal in the
simulations to the third elbow of the scree plot using the criterion of Zhu and Ghodsi (2006), considering a
total of 25 eigenvalues or singular values. Also, the model in (3.3) is ﬁtted to ˆΘ, estimating d and K using
the selection procedure in Section 4, with K∗ = 6. The results of the simulations are reported in Table 1a.
A similar simulation has been repeated for bipartite DCScBMs. N = 250 graphs with n = 1,000 and
Uniform(0, 1)K×K(cid:48),

n(cid:48) = 1,500 were generated, setting K = 2, K(cid:48) = 3, communities of equal size, B
and ρi

Beta(2, 1). The results are reported in Table 1b.

∼

The table shows that the transformed embedding sometimes has a slightly inferior performance when
estimating the correct value of the latent dimension d (cf. Table 1b), but outperforms the alternative method-
ologies signiﬁcantly in the ability to estimate the number of communities K. In particular, the Gaussian
mixture model is not well suited to either the standard embedding ˆX nor the row-normalised ˜X, and the
distortion caused by the degree-corrections and row-normalisation does not allow correct estimation of K.
This problem is alleviated when the spherical coordinates estimator is used. The improvement is reﬂected

∼

12

Spectral clustering on spherical coordinates under the degree-corrected stochastic blockmodel

(a) Proportion of correct d

Undirected DCSBM

(b) Average ARI
Undirected DCSBM

(c) Average ARI
Bipartite DCScBM

Figure 5: Estimated performance

250 simulated DCSBMs and DCScBMs,

100, 200, 500, 1000, 2000
}
{

for N
. For bipartite DCScBMs, n(cid:48)

=

150, 300, 750, 1500, 3000

∈ {

.
}

for n

∈

in a signiﬁcant difference in the clustering performance, demonstrated by the average ARI scores for the
three different procedures. The table also shows that estimates of d based on the model of Sanna Passino
and Heard (2020) and Yang et al. (2020) on ˆX and ˆX(cid:48) seem to be slightly more accurate than alternative
methods on the DCScBM. It might be therefore tempting to construct a hybrid model that uses ˆΘ:d for
the top-d embeddings and ˆXd: for the remaining components, and proceed to select the most appropriate d
under such a joint model. Unfortunately, model comparison via BIC is not possible in that setting.

The simulation is also repeated for different values of n, evaluating the asymptotic behaviour of the
proposed community detection procedure. The results are plotted in Figure 5, demonstrating that the per-
formance of the spherical coordinates estimator improves when the number of nodes in the graph increases.
This appears to be consistent with the CLT presented in Appendix A. On the other hand, the results obtained
from the alternative estimators degrade with n, providing further evidence that the proposed model (3.3)
appears to be more appropriate for community detection under the DCSBM.

Also, the boxplots for the paired differences between ARIs are plotted in Figure 6. The clustering
based on ˆΘ consistently outperforms ˆX and ˜X (cf. Figure 6a and 6c). The difference can be quantitatively
evaluated using binomial sign tests for paired observations, similarly to Section 5.3. For both undirected and
bipartite graphs, the p-values of the sign tests are < 10−10, overwhelmingly suggesting that the clustering
based on ˆΘ is superior to the competing methodologies. Furthermore, the difference increases when the
number of nodes increases (cf. Figure 6b). Overall, the simulations suggest that the proposed spectral
clustering procedure for estimation of the DCSBM, based on the spherical coordinates of the ASE estimator
of the latent positions, appears to outperform competing estimators, including spectral clustering on the
row-normalised ASE estimator.

6.2

Imperial College network ﬂow data

The model proposed in this work has been speciﬁcally developed for clustering networks obtained from
the network ﬂow data collected at Imperial College London (ICL). Finding communities of machines with
similar behaviour is important in network monitoring and intrusion detection (Neil et al., 2013). In this
application, the edges relate to all the HTTP (port 80) and HTTPS (port 443) connections observed from
machines hosted in computer labs in different departments at ICL in January 2020. The source nodes V
are computers hosted in college laboratories, and the destination nodes V (cid:48) are internet servers. Intuitively,
computers in a laboratory tend to have a heterogeneous degree distribution of their web connections because
they are not used uniformly: a computer located closed to the entrance of the laboratory might be used more

13

1002005001000200000.20.40.60.81nˆXK=2˜XK=3ˆΘ1002005001000200000.20.40.60.81nˆXK=2˜XK=3ˆΘ100(150)200(300)500(750)1000(1500)2000(3000)00.20.40.60.81+n(n0)ˆX(ˆX0)K=2˜X(˜X0)K0=3ˆΘ(ˆΘ0)Spectral clustering on spherical coordinates under the degree-corrected stochastic blockmodel

(a) Undirected graph
2, 3
K

, n = 1000
}

∈ {

(b) Undirected graph, K = 2

Varying n, ˆΘ vs. ˜X

(c) Bipartite graph, K = 2, K (cid:48) = 3,

n = 1000, n(cid:48) = 1500

Figure 6: Boxplots of differences in ARI for N = 250 simulated DCSBMs and DCScBM.

Name

ICL1
ICL2
ICL3

V

|
|
628
439
1,011

V (cid:48)

|

|

54,111
60,635
84,664

E

|

|

668,155
717,912
1,470,074

K ZG3 ZG4

3
4
5

24
24
27

52
53
51

Table 2: Summary statistics for the Imperial College London computer networks.

than a machine at the back. Therefore, the total time of activity is different across machines in the same
community, which suggests that the DCSBM is an appropriate modelling choice. This is conﬁrmed by the
within-community degree distributions in Figure 1 (Section 1), which compares one of the Imperial College
networks (ICL2, cf. Figure 1c) with a simulated SBM and DCSBM (cf. Figures 1a and 1b)1.

Three real-world computer networks are considered here, and corresponding summary statistics are pre-
sented in Table 2, where ZG(cid:96) denotes the position of the (cid:96)-th elbow of the scree plot according to the method
of Zhu and Ghodsi (2006). For the source nodes, a known underlying community structure is given by the
department to which each machine belongs. ICL1 corresponds to machines hosted in the departments of
Physics, Electrical Engineering, and Earth Science, whereas computers in Chemistry, Civil Engineering,
Mathematics, and Medicine are considered in ICL2. For ICL3, the departments are Aeronautical Engi-
neering, Civil Engineering, Electrical Engineering, Mathematics, and Physics. Students use the computer
laboratories for tutorials and classes, and therefore some variation might be expected in the activities of
different machines across different departments.

Figure 7 shows the scatterplots of the leading 2 dimensions of the m-dimensional embeddings ˆX, ˜X and
ˆΘ for m = 30 for ICL2, showing that the clustering task is particularly difﬁcult in this network, and there
is not much separation between the communities. Despite this, the transformation to spherical coordinates
(cf. Figure 7c) appears to make the communities more Gaussian-shaped, as opposed to the standard and
row-normalised DASE, where the within-community embeddings are curved (cf. Figure 7a and 7b), and
therefore not amenable to Gaussian mixture modelling. This impression is quantitatively conﬁrmed by the
Mardia tests for multivariate normality on each community (cf. Section 5.3): the difference of the log-p-
42
values obtained from the spherical coordinates transformation and the standard DASE is on average
82 for the skewness, further demonstrating that the proposed transformation tends to
for the kurtosis and
Gaussianise the embedding.

≈

≈

1Figure 1a displays the within-community out-degree distribution of a simulated ScBM, see (6.1), with K = K (cid:48) = 4, equal-
sized communities, and block-community matrix B/2 (see below). Figure 1b displays the same distribution for a simulated
DCScBM with block-community matrix 2B, corrected sampling ρi, ρ(cid:48)j ∼ Beta(3, 5). For B: B11 = 0.35, B22 = 0.25,
B33 = 0.15, B44 = 0.1, Bk(cid:96) = 0.1 if k (cid:54)= (cid:96).

14

−0.500.5ˆΘvs.ˆXK=3ˆΘvs.˜XK=3ˆΘvs.ˆXK=2ˆΘvs.˜XK=2PaireddifferencesinARI−1−0.500.520001000500200100PaireddifferencesinARIn−0.500.5ˆΘ0vs.ˆX0ˆΘ0vs.˜X0ˆΘvs.ˆXˆΘvs.˜XPaireddifferencesinARISpectral clustering on spherical coordinates under the degree-corrected stochastic blockmodel

(a) ˆX:2

(b) ˜X:2

(c) ˆΘ:2

Figure 7: ICL2: scatterplot of the leading two dimensions for ˆX, ˜X and ˆΘ.

(a) Estimated (d, K)

m = 30
˜X

ˆX

ˆΘ

ˆX

m = 50
˜X

ˆΘ

ICL1
ICL2
ICL3

(26, 6)
(28, 5)
(24, 10)

(11, 6)
(8, 7)
(17, 5)

(11, 4)
(15, 4)
(15, 5)

(22, 5)
(29, 4)
(25, 6)

(11, 6)
(8, 7)
(13, 6)

(11, 4)
(15, 4)
(16, 5)

(b) ARIs for the estimated clustering

ˆX

0.259
0.441
0.246

ICL1
ICL2
ICL3

m = 30
˜X

ˆΘ

ˆX

m = 50
˜X

0.324
0.736
0.342

0.418
0.938
0.409

0.262
0.359
0.269

0.317
0.743
0.265

ˆΘ

0.418
0.938
0.364

Alternative methods

Louvain

Paris HLouvain

0.107
0.488
0.079

0.082
0.560
0.032

0.152
0.602
0.157

Table 3: Estimates of (d, K) and ARIs for the embeddings ˆX, ˜X and ˆΘ for m

gies.

30, 50
}

∈ {

and alternative methodolo-

For each of the three ICL network graphs, the DASE has been calculated for m = 30 and m = 50,
and the model in Sanna Passino and Heard (2020) and Yang et al. (2020) has been ﬁtted on the source
embeddings ˆX and the row-normalised version ˜X, whereas the model (3.3) is used on the transformation
ˆΘ, setting K∗ = 20. The resulting estimated values of d and K, obtained using the minimum BIC, are
reported in Table 3a. In order to reduce the sensitivity to initialisation, the model was ﬁtted 10 times for
each pair (d, K), and the parameter estimates corresponding to the minimum BIC were retained. The choice
of m
corresponds to values around the third and fourth elbows in the scree plot of singular values,
according to the criterion of Zhu and Ghodsi (2006) (cf. Table 2).

∈ {
Comparing Table 3a for the two different values of m, it seems that the estimates of K based on ˆΘ are
closer to the underlying true number of communities. In particular, K = 3 for ICL1, K = 4 for ICL2, and
K = 5 for ICL3, based on the number of departments.

30, 50
}

Based on the estimates in Table 3a, the estimated community allocations zi were obtained using (4.2),
and the adjusted Rand index was calculated using the department as labels. For further comparisons, the re-
sults were compared to other popular community detection methods: the Louvain algorithm (Blondel et al.,
2008) adjusted for bipartite graphs (Dugué and Perez, 2015), and the hierarchical Louvain (HLouvain) and

15

−2−1.5−1−0.50−1.5−1−0.500.511.52ˆX1ˆX2ChemistryCivilEngineeringMathematicsMedicine−0.7−0.6−0.5−0.4−0.3−0.2−0.8−0.6−0.4−0.200.20.4˜X1˜X23.544.555.51.522.533.544.55ˆΘ1ˆΘ2Spectral clustering on spherical coordinates under the degree-corrected stochastic blockmodel

Paris methods (Bonald et al., 2018), all in their default implementation for bipartite graphs in the python
library scikit-network. The results are reported in Table 3b. Clearly, clustering on the embedding ˆΘ out-
performs the alternatives, including ˆX and ˜X, in all the three networks. In some cases, the improvement is
substantial, for example in ICL2, where the proposed method reaches the score 0.938, corresponding to only
9 misclassiﬁed nodes out of 439, particularly remarkable considering the lack of separation of the clusters
in Figure 7.

The results were conﬁrmed by binomial paired sign tests on the difference between ARI scores for
N = 25 iterations of the community detection algorithms, which returned p-values < 10−4 in favour of the
spherical coordinates estimator over the alternative methodologies.

In terms of network structure, the results could be interpreted as follows: the computers connect to a set
of shared college-wide web servers (for example, the virtual learning environment and the library services),
and to services speciﬁc to the discipline carried out in each department. Furthermore, each machine has
different levels of activity, which leads to heterogeneous within-community degree distributions. The SBM,
corresponding to ˆX, only clusters the nodes based on their degree, whereas the DCSBM is able to uncover
the departmental structure, in particular when the spherical coordinates estimator ˆΘ is used. Under the
assumption that the networks were generated under a DCSBM, the results conﬁrm that the estimate based
on spherical coordinates proposed in this work appears to produce superior results when compared to the
standard or row-normalised ASE.

7 Conclusion

In this article, a novel method for spectral clustering under the degree-corrected stochastic blockmodel has
been proposed. The model is based on a transformation to spherical coordinates of the commonly used
adjacency spectral embedding. Such a transformation seems more suited to Gaussian mixture modelling
than the row-normalised embedding, which is widely used in the literature for spectral clustering. The
proposed methodology is then incorporated within a simultaneous model selection scheme that allows the
model dimension d and the number of communities K to be determined. The optimal values of d and K
are chosen using the popular Bayesian information criterion. The framework also extends simply to include
directed and bipartite graphs. Results on synthetic data and real-world computer networks show superior
performance over competing methods.

References

Alanis-Lobato, G., Mier, P. and Andrade-Navarro, M. A. (2016) Efﬁcient embedding of complex networks to hyper-

bolic space via their Laplacian. Scientiﬁc Reports, 6, 30108.

Amini, A. A., Chen, A., Bickel, P. J. and Levina, E. (2013) Pseudo-likelihood methods for community detection in

large sparse networks. Annals of Statistics, 41, 2097–2122.

Athreya, A., Priebe, C. E., Tang, M., Lyzinski, V., Marchette, D. J. and Sussman, D. L. (2016) A limit theorem for

scaled eigenvectors of random dot product graphs. Sankhya A, 78, 1–18.

Blondel, V. D., Guillaume, J.-L., Lambiotte, R. and Lefebvre, E. (2008) Fast unfolding of communities in large

networks. Journal of Statistical Mechanics: Theory and Experiment, P10008.

Bonald, T., Charpentier, B., Galland, A. and Hollocou, A. (2018) Hierarchical graph clustering based on node pair

sampling. In Proceedings of the 14th International Workshop on Mining and Learning with Graphs (MLG).

Braun, M. and Bonfrer, A. (2011) Scalable inference of customer similarities from interactions data using Dirichlet

processes. Marketing science, 30, 513–531.

Chaudhuri, K., Chung, F. and Tsiatas, A. (2012) Spectral clustering of graphs with general degrees in the extended

planted partition model. In Proceedings of the 25th Annual Conference on Learning Theory, vol. 23.

16

Spectral clustering on spherical coordinates under the degree-corrected stochastic blockmodel

Chen, Y., Li, X. and Xu, J. (2018) Convexiﬁed modularity maximization for degree-corrected stochastic block models.

Annals of Statistics, 46, 1573–1602.

Dempster, A., Laird, N. and Rubin, D. (1977) Maximum likelihood from incomplete data via the EM algorithm.

Journal of the Royal Statistical Society, Series B, 39, 1–38.

Dugué, N. and Perez, A. (2015) Directed Louvain: maximizing modularity in directed networks. Tech. Rep. hal-

01231784, Université d’Orléans.

Fraley, C. and Raftery, A. E. (2002) Model-based clustering, discriminant analysis, and density estimation. Journal of

the American Statistical Association, 97, 611–631.

Gao, C., Ma, Z., Zhang, A. Y. and Zhou, H. H. (2018) Community detection in degree-corrected block models. Annals

of Statistics, 46, 2153–2185.

Gulikers, L., Lelarge, M. and Massoulié, L. (2017) A spectral method for community detection in moderately sparse

degree-corrected stochastic block models. Advances in Applied Probability, 49, 686–721.

Holland, P. W., Laskey, K. B. and Leinhardt, S. (1983) Stochastic blockmodels: First steps. Social Networks, 5,

109–137.

Hubert, L. and Arabie, P. (1985) Comparing partitions. Journal of Classiﬁcation, 2, 193–218.

Jin, J. (2015) Fast community detection by SCORE. Annals of Statistics, 43, 57–89.

Jones, A. and Rubin-Delanchy, P. (2020) The multilayer random dot product graph. arXiv e-prints.

Karrer, B. and Newman, M. E. J. (2011) Stochastic blockmodels and community structure in networks. Physical

Review E, 83.

Krioukov, D., Papadopoulos, F., Kitsak, M., Vahdat, A. and Boguñá, M. (2010) Hyperbolic geometry of complex

networks. Physical Review E, 82.

Lei, J. and Rinaldo, A. (2015) Consistency of spectral clustering in stochastic block models. Annals of Statistics, 43,

215–237.

von Luxburg, U. (2007) A tutorial on spectral clustering. Statistics and Computing, 17.

Mardia, K. V. (1970) Measures of multivariate skewness and kurtosis with applications. Biometrika, 57, 519–530.

McCormick, T. H. and Zheng, T. (2015) Latent surface models for networks using aggregated relational data. Journal

of the American Statistical Association, 110, 1684–1695.

Meyer, C. D. (2000) Matrix analysis and applied linear algebra. SIAM.

Neil, J., Hash, C., Brugh, A., Fisk, M. and Storlie, C. B. (2013) Scan statistics for the online detection of locally

anomalous subgraphs. Technometrics, 55, 403–414.

Ng, A. Y., Jordan, M. I. and Weiss, Y. (2001) On spectral clustering: Analysis and an algorithm. In Proceedings of the

14th International Conference on Neural Information Processing Systems: Natural and Synthetic, 849–856.

Peng, L. and Carvalho, L. (2016) Bayesian degree-corrected stochastic blockmodels for community detection. Elec-

tronic Journal of Statistics, 10, 2746–2779.

Qin, T. and Rohe, K. (2013) Regularized spectral clustering under the degree-corrected stochastic blockmodel. In
Proceedings of the 26th International Conference on Neural Information Processing Systems, vol. 2, 3120–3128.

Raftery, A. E. and Dean, N. (2006) Variable selection for model-based clustering. Journal of the American Statistical

Association, 101, 168–178.

Rohe, K., Qin, T. and Yu, B. (2016) Co-clustering directed graphs to discover asymmetries and directional communi-

ties. Proceedings of the National Academy of Sciences.

17

Spectral clustering on spherical coordinates under the degree-corrected stochastic blockmodel

Rubin-Delanchy, P., Cape, J., Tang, M. and Priebe, C. E. (2017) A statistical interpretation of spectral embedding: the

generalised random dot product graph. arXiv e-prints.

Sanna Passino, F. and Heard, N. A. (2020) Bayesian estimation of the latent dimension and communities in stochastic

blockmodels. Statistics and Computing, 30, 1291–1307.

Sussman, D. L., Tang, M. and Priebe, C. E. (2014) Consistent latent position estimation and vertex classiﬁcation for

random dot product graphs. IEEE Transactions on Pattern Analysis and Machine Intelligence, 36, 48–57.

Tang, M. and Priebe, C. E. (2018) Limit theorems for eigenvectors of the normalized Laplacian for random graphs.

Annals of Statistics, 46, 2360–2415.

Yang, C., Priebe, C. E., Park, Y. and Marchette, D. J. (2020) Simultaneous dimensionality and complexity model

selection for spectral graph clustering. Journal of Computational and Graphical Statistics, 30, 422–441.

Young, S. J. and Scheinerman, E. R. (2007) Random dot product graph models for social networks. In Algorithms and

Models for the Web-Graph, 138–149.

Zhao, Y., Levina, E. and Zhu, J. (2012) Consistency of community detection in networks under degree-corrected

stochastic block models. Annals of Statistics, 40, 2266–2292.

Zhu, M. and Ghodsi, A. (2006) Automatic dimensionality selection from the scree plot via the use of proﬁle likelihood.

Computational Statistics & Data Analysis, 51, 918 – 930.

A A central limit theorem on spherical coordinates

In this section, it is demonstrated that, for d = 2, the spherical coordinates obtained from ASE asymptoti-
cally converge to the spherical coordinates of the true underlying latent positions, with Gaussian error. This
property is particularly important, since points belonging to the same community share the same spherical
coordinates under the DCSBM.

Consider the covariance Σk(ρ) appearing in the ASE-CLT (2.2), which holds under the assumption
of d ﬁxed and known. The covariance matrix Σk(ρ) can be calculated explicitly, and arises as a corol-
lary of the ASE-CLT, taking the RDPG inner product distribution to be the product measure F = Gρ
(cid:80)K

k=1 ψkδµk , (cid:80)K

k=1 ψk = 1, ψk

≥

⊗
0, where Gρ is the distribution of the degree-correction parameters, and
F be a d-dimensional random vector, the k-th community covari-
Rd×d

∆−1, where ∆ = E(ξξ(cid:124))
}

∈

(cid:124)
ρµ

kξ)ξξ(cid:124)

−

δ· is the Dirac’s delta measure. Letting ξ
ance matrix then takes the form Σk(ρ) = ∆−1E
{
is the second moment matrix, assumed to be invertible.

(cid:124)
kξ(1
ρµ

∼

The ASE-CLT (2.2) provides the theoretical framework for establishing a central limit theorem for the
spherical coordinates estimator under the DCSBM for d = 2. Let ˆθ = f2(x) be the spherical coordinates
R2, and ˆθ(n) = f2( ˆx(n)) be the corresponding estimator calculated from
for the true latent position x
O(2), the orthogonal group in two dimensions, which consists in
ˆx(n)
rotation and reﬂection matrices:

R2. Note that for d = 2, Q(n)

∈

∈

∈

Qrot(ϕ) =

(cid:20) cos(ϕ)
sin(ϕ)

−

(cid:21)

,

sin(ϕ)
cos(ϕ)

Qref (ϕ) =

(cid:20)

cos(ϕ)
sin(ϕ)

−

(cid:21)

sin(ϕ)
cos(ϕ)

.

R2 rotates the vector by an angle ϕ (taken clockwise) with
The rotation matrix Qrot(ϕ) applied to x
respect to the second axis, whereas a reﬂection matrix Qref (ϕ) reﬂects the vector with respect to a line
passing through the origin, with angle ϕ/2 (taken clockwise) to the second axis. It follows that any matrix
Q(n)
2π, 2π) such that:

O(2) appearing in the ASE-CLT (2.2) is uniquely mapped to an angle ϕ(n)

∈

[

∈

−
f2(Q(n) ˆx(n)) = (f2( ˆx(n)) + ϕ(n)) mod 2π = (ˆθ(n) + ϕ(n)) mod 2π.

∈

18

Spectral clustering on spherical coordinates under the degree-corrected stochastic blockmodel

(a) Boxplots of ˆϑk,2

(b) Boxplots of [ ˆΣk]1,3

(c) Boxplots of [ ˆΣk]3,4

Figure 8: Boxplots for N = 1,000 simulations of a degree-corrected stochastic blockmodel with varying number of
nodes n, K = 3, equal number of nodes allocated to each group, and B described in (5.1), corrected by
parameters ρi sampled from a Uniform(0, 1) distribution.

The ASE-CLT (2.2) can be extended to spherical coordinates by the multivariate delta method, with trans-
), see (3.2). The multivariate delta method establishes that, conditional on the com-
formation function f2(
·
O(2), the spherical coordinates are
munity allocation, correction parameter and orthogonal matrices Q(n)
asymptotically Gaussian:

∈

(cid:110)

√n

(cid:16)ˆθ(n)

P

lim
n→∞

θ

−

−

ϕ(n)(cid:17)

≤

(cid:12)
(cid:12)
(cid:12) z = k, ρ

(cid:111)

v

Φ1

{

→

v, ∇x(θ)

(cid:124)

Σk(ρ)∇x(θ)

,

}

R, and ∇x(θ) is the gradient of θ with respect to x, under the assumption that (ˆθ(n) + ϕ(n)) mod

∈

where v
2π = ˆθ(n) + ϕ(n). The gradient is:
(cid:18) ∂θ
∂x1

∇x(θ) =

,

∂θ
∂x2

(cid:19)(cid:124)

(cid:18)

=

0,

2
−

·

sign(x1)

(cid:113)
1

x2
2/

2(cid:14)
(cid:107)
(cid:107)

x
(cid:107)

x
(cid:107)

−

(cid:19)(cid:124)

.

B Empirical model validation: additional simulations

B.1 Asymptotic behaviour

The proposed model is further validated by a study with increasing values for the number of nodes n.
N = 1,000 graphs are simulated using the same conﬁguration as the simulation in Figure 4, for n
∈
. Figure 8 reports the boxplots for the different values of n for three of the
100, 200, 500, 1000, 2000
{
}
estimated parameters, suggesting that the asymptotic behaviour of the embedding is consistent with the
modelling choices in (3.3). In particular, three assumptions are checked: means centred at π in the last
d components (cf.
m
Figure 8b), and independence within the last m

d components (cf. Figure 8a), independence between the initial d and last m

d components (cf. Figure 8c).

−

−

−

B.2 Changes in the correlation between blocks

The same model assumptions are also checked with different values of the correlation between blocks.
N = 100 graphs with K = 2 equal-sized communities and n = 500 nodes are simulated from a DCSBM

19

3π3.4ˆϑ1,23π3.4ˆϑ2,2100200500100020003π3.4nˆϑ3,2−0.500.5[ˆΣ1]1,3−101[ˆΣ2]1,310020050010002000−0.500.5n[ˆΣ3]1,3−0.4−0.200.2[ˆΣ1]3,4−0.500.5[ˆΣ2]3,410020050010002000−0.200.2n[ˆΣ3]3,4Spectral clustering on spherical coordinates under the degree-corrected stochastic blockmodel

, corrected by
∈ {
Uniform(0, 1). The results plotted in Figure 9 suggest that the assumptions in model (3.3) are robust

0.05, 0.1, 0.15, 0.2, 0.25, 0.3, 0.35
}

with B11 = 0.5, B22 = 0.35 and B12 = B21 = r, r
ρi
to changes in the correlation between the blocks.

∼

(a) Boxplots of ˆϑk,2

(b) Boxplots of [ ˆΣk]1,3

(c) Boxplots of [ ˆΣk]3,4

Figure 9: Boxplots for N = 100 simulations of a degree-corrected stochastic blockmodel with n = 500, K = 2,
equal number of nodes allocated to each group, B11 = 0.5, B22 = 0.35 and B12 = B21 = r, for different
values of r, corrected by parameters ρi sampled from a Uniform(0, 1) distribution.

20

33.1π3.23.3ˆϑ1,20.050.10.150.20.250.333.1π3.2rˆϑ2,2−0.100.1[ˆΣ1]1,30.050.10.150.20.250.3−0.100.1r[ˆΣ2]1,3−0.100.1[ˆΣ1]3,40.050.10.150.20.250.3−0.100.1r[ˆΣ2]3,4