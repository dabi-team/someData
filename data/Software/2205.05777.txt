EFFICIENTESTIMATIONOFMODIFIEDTREATMENTPOLICYEFFECTSBASEDONTHEGENERALIZEDPROPENSITYSCORENimaS.HejaziDepartmentofBiostatistics,T.H.ChanSchoolofPublicHealth,HarvardUniversitynhejazi@hsph.harvard.eduDavidC.BenkeserDepartmentofBiostatistics&Bioinformatics,RollinsSchoolofPublicHealth,EmoryUniversitybenkeser@emory.eduIv´anD´ıazDivisionofBiostatistics,DepartmentofPopulationHealthSciences,WeillCornellMedicineild2005@med.cornell.eduMarkJ.vanderLaanDivisionofBiostatistics,SchoolofPublicHealth,UniversityofCalifornia,Berkeleylaan@berkeley.eduJune29,2022ABSTRACTContinuoustreatmentshaveposedasigniﬁcantchallengeforcausalinference,bothintheformu-lationandidentiﬁcationofscientiﬁcallymeaningfuleffectsandintheirrobustestimation.Tradi-tionally,focushasbeenplacedontechniquesapplicabletobinaryorcategoricaltreatmentswithfewlevels,allowingfortheapplicationofpropensityscore-basedmethodologywithrelativeease.Effortstoaccommodatecontinuoustreatmentsintroducedthegeneralizedpropensityscore,yetestimatorsofthisnuisanceparametercommonlyutilizeparametricregressionstrategiesthatsharplylimittherobustnessandefﬁciencyofinverseprobabilityweightedestimatorsofcausaleffectparameters.Weformulateandinvestigateanovel,ﬂexibleestimatorofthegeneralizedpropensityscorebasedonanonparametricfunctionestimatorthatprovablyconvergesatasuitablyfastratetothetargetfunctionalsoastofacilitatestatisticalinference.Withthisestimator,wedemonstratetheconstruc-tionofnonparametricinverseprobabilityweightedestimatorsofaclassofcausaleffectestimandstailoredtocontinuoustreatments.Toensuretheasymptoticefﬁciencyofourproposedestimators,weoutlineseveralnon-restrictiveselectionproceduresforutilizingasieveestimationframeworktoundersmoothestimatorsofthegeneralizedpropensityscore.Weprovidetheﬁrstcharacterizationofsuchinverseprobabilityweightedestimatorsachievingthenonparametricefﬁciencyboundinasettingwithcontinuoustreatments,demonstratingthisinnumericalexperiments.Wefurthereval-uatethehigher-orderefﬁciencyofourproposedestimatorsbyderivingandnumericallyexaminingthesecond-orderremainderofthecorrespondingefﬁcientinﬂuencefunctioninthenonparametricmodel.Opensourcesoftwareimplementingourproposedestimationtechniques,thehaldensifyRpackage,isbrieﬂyintroduced.1IntroductionAcrossarangeofscientiﬁcﬁelds,researcheffortsoftenaimtoquantifythecausaleffectsofinterveningoncontinuousorordinaltreatments.Examplesincludeevaluatingtheimpactsofincreasedphysicalexerciseonaging(D´ıaz&vanderLaan,2012),reductionsinsurgicaloperatingtimeonpost-surgicalhealthoutcomes(Haneuse&Rotnitzky,2013),changesinvaccine-inducedimmunologicresponseondiseaserisk(Hejazietal.,2020b),impactofnursehoursperpatientonhospitalreadmissionrisk(McHughetal.,2013),andmortalityreductionfromCOVID-19delay-in-intubationpolicies(D´ıazetal.,2022).Inthesesettings,causaleffectsareoftenquantiﬁedintermsofcausaldose-responsecurves(Imbens,2000;Kennedyetal.,2017).Unfortunately,theestimationofsuchdose-responsecurvesarXiv:2205.05777v3  [stat.ME]  28 Jun 2022JUNE29,2022forcontinuoustreatmentsininﬁnite-dimensionalstatisticalmodelsisexceptionallychallenging.Estimatorsofthesecurvesgenerallydonotenjoyn1/2-rateasymptoticbehaviorandareincompatiblewithmanystandardestimationtechniques.Tocircumventthesechallenges,itiscommoninpracticetodiscretizethetreatmentintocategories,whichenablespractitionerstorecovern1/2-ratebehaviorwithstandardestimationtechniques.However,thisstrategyissubjecttoahostoflimitations,themostfundamentalofwhichisapotentialviolationofthecausalidentiﬁcationassumptionofconsistency.Thisassumptionstipulatesthathypotheticalinterventionsshouldbewell-deﬁned,whichisrarely(ifever)thecasewhenconceptualizinginterventionsthatassignacontinuoustreatmenttoasetof(discrete)values.Morepractically,ifthetreatmentispoorlydiscretized,perhapsduetolimitedsubjectmatterknowledge,theresultantdose-reponsecurveispronetoprovidingapoorapproximationoftheunderlyingcurve.Morerecentworkhasdevelopedasymptotictheoryunderarangeofsemiparametricassumptions.Forexample,Kennedyetal.(2017)proposedestimatorsbasedonlocallylinearsmoothing;vanderLaanetal.(2018a)consideredcross-validatedtargetedminimumlossestimationofageneralclassofnon-standardparameters,includingthedose-responsecurveasanexample;andWestlingetal.(2020)developedestimatorsassumingmonotonicityofthedose-responsecurve.Theseapproachesrepresentvaluablecontributionsinthisarea.However,eachapproachreliesonassumptionsthataredifﬁculttojustifyacrossarangeofsettings.Inparticular,eachpositsapositivityassumptionrequiringcommonsupportofthecovariate-conditionaltreatmentdensityacrossallpossiblecovariatevalues.Thisfundamentallimitationhasmotivatedthestudyofcausaleffectsofstochasticinterventions(Stock,1989;D´ıaz&vanderLaan,2012;Haneuse&Rotnitzky,2013;Youngetal.,2014).Theseinterventionsconsidersettingeachindividual’streatmentleveltoarandomdrawfromaninvestigator-speciﬁeddistribution.Bycarefullyconsideringthecandidatepost-interventiondistributionofthetreatment,practitionerscanavoidmakingunrealisticpositivityas-sumptions.Onepopularapproachdrawstreatmentvaluesfromamodiﬁcationofthenaturallyoccurringtreatmentdistribution.Counterfactualsdeﬁnedinthiswayarebetteralignedwithplausiblefutureinterventionsthatmaybeengineeredbyscientiﬁcorpolicyinitiatives.Recenteffortshaveyieldedseveralcandidateapproaches(e.g.,D´ıaz&vanderLaan,2012;Haneuse&Rotnitzky,2013;Youngetal.,2014;Kennedy,2019)foridentifyingandestimatingthecausaleffectsofstochasticinterventions,includingforlongitudinaltreatmentregimens(D´ıazetal.,2021,2022)andmediationanalysis(e.g.,D´ıaz&Hejazi,2020;D´ıazetal.,2020;Hejazietal.,2022b).Manyestimationapproachesforstochasticinterventionscenteraroundestimationofthegeneralizedpropensityscore(Hirano&Imbens,2004),theconditionaltreatmentdensitygivencovariates.Estimationofthegeneralizedpropensityisacommonproblemincausalinferenceandhasbeenstudiedinthecontextof,forexample,marginalstructuralmodels(Robinsetal.,2000),andcovariatebalancing(Hirano&Imbens,2004).Despiteitsprevalence,mostproposalsrelyonassumptionsimposingrestrictiveparametricformstofacilitateestimationofthisquantity,thoughﬂexibleestimatorsleveragingadvancesinmachinelearninghaveemerged(e.g.,D´ıaz&vanderLaan,2011;Zhuetal.,2015).NumericalstudiesexaminingtheimpactofgeneralizedpropensityscoreestimationontheevaluationofthecausaleffectsofcontinuoustreatmentswerecontributedbyAustin(2018).Inthepresentwork,wedevelopaﬂexible,nonparametricestimatorofthegeneralizedpropensityscorethatisfullycompatiblewithtechniquesforsieveestimation.Thisestimatorisformulatedwiththegoalofevaluatingthecausaleffectsofcontinuoustreatments,usingtheframeworkofstochasticinterventions.Buildinguponthisﬂexiblenuisanceestimator,weformulateandevaluateauniqueclassofnonparametricinverseprobabilityweighted(IPW)estimatorscapableofasymptoticallyachievingasemiparametricanalogoftheefﬁciencybound.Thisrepresents,tothebestofourknowledge,twosigniﬁcanttheoreticalandpracticaladvances:(1)successfullytailoringundersmoothingprinci-plestoconditionaldensityfunctionalsfortheefﬁcientestimationoflow-dimensionalstatisticalparameters,and(2)developingIPWestimatorsofcontinuoustreatmenteffectsthatarebothasymptoticallyefﬁcientandcompetitivewithmoderndoublyrobustestimators.Weadditionallydiscusstheopensourcehaldensify(Hejazietal.,2022a)package,fortheRstatisticalprogramminglanguageandenvironment(RCoreTeam,2022),whichimplementsourgeneralizedpropensityscoreandIPWestimators.Theremainderofthepresentmanuscriptisorganizedasfollows.Section2introducesnotationanddiscussesexistingtheoryonthecausaleffectsofstochasticinterventionsandtheirefﬁcientestimation.Section3outlinesourproposedconditionaldensityestimationprocedureandgoesontodetailitsuseinconstructinganovelclassofnonparametricIPWestimators,proposingseveralproceduresforsieveestimationdesignedtoallowtheseestimatorstoattainasymp-toticefﬁciency.Section4investigatestherelativeperformanceofourproposednonparametricIPWestimatorsinnumericalexperiments.Section5concludeswithadiscussionoffutureavenuesofinvestigation.2JUNE29,20222Preliminaries2.1ProblemformulationandnotationLetW∈Wdenoteavectorofbaselinecovariates,A∈Aareal-valuedcontinuous(orordinal)treatment,andY∈Yanoutcomeofinterest.Toformalizethecausalquestionofinterest,weintroduceastructuralcausalmodel(SCM)todescribethedata-generatingprocess(Pearl,2009).Speciﬁcally,weassumethefollowingsystemofstructuralequationsgeneratestheobserveddataforasingleunit:W=fW(UW);A=fA(W,UA);Y=fY(A,W,UY),where{fW,fA,fY}aredeterministicfunctions,and{UW,UA,UY}areexogenousrandomvariables.Importantly,theSCMimpliesamodelforthedistributionofcounterfactualrandomvariables,whicharegeneratedbyspeciﬁcinterventionsonthedata-generatingprocess.Thestandardidentiﬁcationassumptionsofconsistency(Yd(a,w)=YintheeventA=d(a,w))andlackofinterference(Cox,1958)holdasderivedpropertiesofthisSCM(foradiscussionontheformer,seePearl,2010).Thecomplete(unobserved)dataunit(Neyman,1938)isX=(W,Ya:a∈A),wherethecounterfactualsYaarethepotentialoutcomescorrespondingtothevaluestheoutcomewouldtakeundereachpossiblevalueinthesupportofthetreatmentA.WewillfocusontheestimationofcounterfactualtreatmentparametersthatarefunctionalsofthedistributionofX.WeconsiderthedataonasingleobservationalunitO,denotedO=(W,A,Y),asarisingfromP0,thetruegener-atingdistributionofO.Assumingaccesstoni.i.d.copiesofO,weusePntodenotetheempiricaldistributionofO1,...,On.Attimes,itwillproveconvenienttousestandardnotationfromempiricalprocesstheory;speciﬁcally,wewillwritePnf:=n−1Pni=1f(Oi)and,moregenerally,Pf:=Rf(O)dPonoccasion.AssumingonlythatP0isanelementofthenonparametricstatisticalmodelM,i.e.,P0∈M,westrivetoavoidplacingunduerestrictionsontheformofP0.Weusep0todenotethedensityofO,whichevaluatedonatypicalobservationo,isp0(o)=q0,Y(y|A=a,W=w)g0,A(a|W=w)q0,W(w),whereq0,YdenotestheconditionaldensityofYgiven{A,W}withrespecttosomedominatingmeasure,g0,AtheconditionaldensityofAgivenWwithrespecttodominatingmeasureµ,andq0,WthedensityofWwithrespecttodominatingmeasureν.CounterfactualquantitiesofinterestmaybedeﬁnedbyspeciﬁcinterventionsthatalterthestructuralequationfAand“surgically”insertpost-interventiontreatmentvaluesinplaceofthosenaturallygeneratedbyfA.Staticinterventionsmakeforafamiliarexample:fAismerelyreplacedwithaspeciﬁcvalue,selectedapriori,a∈A.When|A|,thecardinalityofA,issmall,contrastsofthecounterfactualmeansofstaticinterventionsundereacha∈Acanproveinformative.Ontheotherhand,when|A|islargeoruncountable(e.g.,whenA∈R,i.e.,iscontinuous),theevaluationofmanysuchcounterfactualsisbothofquestionablescientiﬁcrelevanceandistheoreticallychallenging.AstochasticinterventionmodiﬁesthevalueAwouldnaturallyassume,replacingitwithadrawfromapost-interventiondistribution˜g0,A(·|W)(n.b.,thenaughtsubscriptemphasizesthatthisdistributionmaydependonthetrue,butunknown,data-generatingdistributionP0).Astochasticinterventionmaybedesignedtocollapseintoastaticinterventionbyselecting˜g0,A(·|W)tobedegenerate,placingallmassonasinglepointa∈A.Thetaxonomyofstochasticinterventionsis,asofyet,unsettled—thetermiswidelyusedtodescribeinterventionregimesexhibitingrandomnessconditionaloncovariatesW.Fromthisperspective,staticinterventionsaredeterministicanddynamicinterventions,whichassigntreatmentbasedonW,aredeterministicconditionalonW.Throughout,wefocusoninterventionregimesmeetingthislatterdeﬁnition.Usingtheformerdeﬁnition,D´ıaz&vanderLaan(2012)describedastochasticinterventionthatdrawsAfromadistri-butionsuchthat˜g0,A(a|W)=g0,A(a−δ(W)|W)foralla∈A.Shortlythereafter,Haneuse&Rotnitzky(2013),takingthelatterdeﬁnition,showedthatestimationofthecausaleffectattributabletothestochasticinterventionofD´ıaz&vanderLaan(2012)isequivalenttotheeffectofaninvestigator-suppliedhypotheticalinterventionmodifyingthevalueAwouldnaturallyassumeaccordingtoaregimed(a,w;δ)=a+δ(w).Theseauthorsgoontocharacterizeabroadclassofinterventionsbyintroducingtheassumptionofpiecewisesmoothinvertibility.A1(Piecewisesmoothinvertibility).Foreachw∈W,assumethattheintervalI(w)=(l(w,),u(w))maybepartitionedintosubintervalsIδ,j(w):j=1,...,J(w)suchthattheregimed(a,w;δ)isequaltosomedj(a,w;δ)inIδ,j(w)anddj(·,w;δ)hasinversefunctionbj(·,w;δ)withderivativeb0j(·,w;δ).AssumptionA1canbeusedtoshowthattheinterventionimpliedbytheregimed(A,W;δ)maybeinterpretedasact-ingontheindividuallevel(Youngetal.,2014),incompatiblewiththedeﬁnitionusedbyD´ıaz&vanderLaan(2012).Importantly,theregimed(A,W;δ)maydependonbothcovariatesWandthetreatmentAthatwouldbeassigned3JUNE29,2022initsabsence(i.e.,thetreatment’snaturalvalue);consequently,suchregimeshavebeentermedmodiﬁedtreatmentpolicies(MTP).RegimesobeyingtheMTPdeﬁnitionconstituteanimportantclassofstochasticinterventionsofthesecondvariety(n.b.,thesearenon-deterministicconditionalonW,sincetheydependonA).BothHaneuse&Rot-nitzky(2013)andD´ıaz&vanderLaan(2018)weremotivatedbycounterfactualquestionsofmodifyinganassignedtreatment,theformerseekingtoevaluatetheeffectonpatienthealthofreducingsurgicaloperatingtimeandthelatterbytheeffectofadjustingprescribedexerciseregimensbasedonexistingathletichabits.Conveniently,bothsetsofauthorsconsideredanMTPoftheform:d(a,w;δ)=(cid:26)a+δ(w)ifa+γ≤u(w)aifa+γ>u(w),whereδ(w)=γ∈R(1)andu(w)isthemaximumvalueintheconditionalsupportofg0,A(·|W=w).WhileanintuitivelyusefulMTP,inmanysettings,anadditivealterationtothenaturalvalueofAmayproveinadequatetoformulateanactionablepolicy.Thisarises,forexample,inenvironmentalhealth,inwhichitisofinteresttoevaluateeffectsofmultiplicativereductionsto,say,pollutants.MTPscanbetailoredtosuchuses-caseseasily:d(a,w;δ)=(cid:26)a×δ(w)ifa×γ≤u(w)aifa×γ>u(w),whereδ(w)=γ∈R.(2)TheMTPsinequations(1)and(2)canbeseenasgeneratingacounterfactualoutcomeYd(A,W;δ):=fY(d(A,W;δ),W,UY)whosedistributionwedenotePδ0.Thegoal,then,istoidentifyandestimateψ0,δ:=EPδ0{Yd(A,W;δ)},themeanofthiscounterfactualoutcome.2.2IdentiﬁcationofthepopulationinterventioneffectUsingthepopulationinterventioneffect(PIE)framework(Hubbard&vanderLaan,2008),D´ıaz&vanderLaan(2012,2018)introducedthePIEforstochasticinterventionsθ0,δ:=ψ0,δ−EY.AsEYistriviallyestimable,theireffortsfocusedonidentifyingandestimatingψ0,δ.FortheMTP(1),theseauthorsshowedψ0,δtobeidentiﬁedbyψ0,δ=ZWZAQ0,Y(a,w)˜g0,A(a|W=w)q0,W(w)dµ(a)dν(w)=ZWZAQd0,Y(a,w)g0,A(a|W=w)q0,W(w)dµ(a)dν(w),(3)whereQ0,Y(a,w):=EP0{Y|A=a,W=w}(conditionalmeanofYgivenA=aandW=w,asimpliedbyP0),Qd0,Y(a,w):=Q0,Y(d(a,w;δ),w),andg0,A(a|W=w)istheconditionaldensityofthetreatment.Westressthattheequivalenceinequation(3)holdsonlywhenthepost-interventiontreatmentdensity˜g0,Aarisesfromaregimed(A,W;δ)adheringtoAssumptionA1,whichfacilitatesuseofthechange-of-variableformulaintheintegralexpressions.Thismathematicalconvenienceallowsidentiﬁcationofψ0,δbyreplacingevaluationoftheexpectationQ0,Y(a,w)underthecounterfactualtreatmentdensity˜g0,Awithevaluationofthepost-modiﬁcationoutcomemecha-nismQd0,Y(a,w)underthenaturaltreatmentdensityg0,A.Thishasproventobeasigniﬁcantsimpliﬁcation,essentialfortheformulationofefﬁcientestimatorsthatarecomputationallyfeasible(e.g.,D´ıaz&vanderLaan,2018;Hejazietal.,2020b).Considerationsnecessaryforappropriatelyexpressing˜g0,Aintermsofg0,AfortheMTPs(1)and(2),whetherAiscontinuousordiscrete-valued,havebeenpreviouslyoutlinedbyHaneuse&Rotnitzky(2013)andD´ıazetal.(2022,seeequations(6)and(7)).Throughout,inaminorabuseofnotation,wewilluse˜g0,Atorefertotheappropriatepost-interventiontreatmentdensityfortheMTPs(1)and(2).Forthestatisticalfunctional(3)tocorrespondtothecausalestimandψ0,δ,severalstandardbutuntestableassumptionsarerequired,includingthefollowing.A2(Nounmeasuredconfounding).AssumeA⊥⊥Yd(a,w;δ)|W=w.A3(Positivity).Assumea∈A=⇒d(a,w;δ)∈A|W=w∀w∈W.ThepositivityassumptionA3,requiredtoestablishequation(3),isunlikeitsanalogforsimpler(i.e.,staticordynamic)interventionregimes.Insteadofrequiringpositivemasstobeplacedacrossalltreatmentlevelsforallcovariatestrataw∈W,thispositivityconditionrequiresonlythatthepost-interventiontreatmentmechanismbebounded,i.e.,PP0{˜g0,A(A|W)/g0,A(A|W)<∞}=1,whichmaygenerallybesatisﬁedbyasuitablechoiceoftheparameterδ(W)inanMTPd(A,W;δ).Importantly,thisassumptionensuresthatthepost-interventiontreatmentdensity˜g0,Adoesnotplacemassatpointsinthesupportatwhichg0,Aplacesnomass,leadingtowell-deﬁnedcounterfactuals.4JUNE29,20222.3EfﬁcientinﬂuencefunctionofthepopulationinterventioneffectBeyondtheircarefulstudyoftheidentiﬁcationofthiscausaleffect,D´ıaz&vanderLaan(2012,2018)derivedtheefﬁcientinﬂuencefunction(EIF),aquantitycentraltosemiparametricefﬁciencytheory,ofψ0,δinthenonparametricmodelM.UsingtheEIF,theseauthorsproposedasymptoticallyefﬁcientdoublyrobustestimatorsconstructedbasedontheformoftheEIF.Whenevaluatedonatypicalobservationo,theEIFisD?(o;P0)=H0(a,w){y−Q0,Y(a,w)}+Qd0,Y(a,w)−ψ0,δ,(4)wheretheauxiliarycovariateH(a,w)takestheformH0(a,w)=˜g0,A(a|w)/g0,A(a|w).TheEIFcharacterizesthebestpossibleasymptoticvariance,ornonparametricefﬁciencybound,ofallregularasymptoticallylinearestimatorsofψ0,δandisthususuallyacriticalingredientinthedevelopmentofefﬁcientestimationstrategies.WhiletheexpressionoftheEIFappearinginequation(4)issuitablefortheconstructionofefﬁcientestimators,itarisesfromavonMisesexpansion(vonMises,1947;Bickeletal.,1993;vanderLaan&Robins,2003)oftheparameterfunctionalΨδ:M→RatthedistributionsP,P0∈M:n1/2(Ψδ(P)−Ψδ(P0))=(5)n−1/2P(D?(P0)−D?(P))+n1/2(P−P0)(D?(P)−D?(P0))−n1/2R2(P,P0).Equation(5)iscriticallyimportanttocharacterizingtheasymptoticbehaviorofregularandasymptoticallylinearestimatorsofΨδ(P0)≡ψ0,δ.Theﬁrsttermcanbeshowntoconvergereadilytoazero-centeredGaussiandistributionwithvarianceequaltothevarianceoftheEIF,i.e.,N(0,P0D?(P0)(O)2),bythecentrallimittheorem.Thesecondterm,whichcorrespondsto“plug-inbias”,generallyfailstovanishasymptotically,motivatingthedevelopmentofspecializedcorrectionstrategiesforthisexpresspurpose(e.g.,thetargetedlearningframeworkofvanderLaan&Rose(2011)).Understandardempiricalprocessconditions(onnuisanceparameterestimators),thethirdandfourthtermscanbeshowntoconvergetozeroinprobability;moreover,cross-validationcanbeusedtocircumventeventheseconditions(Klaassen,1987;Zheng&vanderLaan,2011).ThelasttermR2(P,P0)oftheexpansion(5)isasecond-orderremainderassociatedtothescaleddifferenceofΨδ(P)andΨδ(P0);furthermore,itistypicaltoassumenecessaryratesofnuisanceparameterconvergencesuchthatR2(P,P0)=op(n−1/2).Suchanassumptionwouldbesatisﬁed,forexample,ifallnuisanceestimatorsweretoconvergetotheirtargetfunctionalsatn−1/4–rate.Understandardconditions,theasymptoticefﬁciencyofregularasymptoticallylinearestimatorsmaybedescribedviatheEIF:ψn,δ−ψ0,δ=n−1nXi=1D?(P0)(Oi)+op(n−1/2),whereψn,δ≡Ψδ(Pn)isanasymptoticallylinearestimatorofthetargetparameterψ0,δ.TheformoftheexpansionemphasizesthattheEIFmeasuresthequalityoftheestimatorψn,δ,andthatψn,δmustsolvetheEIFestimatingequationtobeasymptoticallyefﬁcient.2.4EstimationofthepopulationinterventioneffectForestimationofψ0,δ,D´ıaz&vanderLaan(2018)deﬁnedadirect(or,substitution)estimatorbasedontheG-computationformula.ThisestimatorisψSUBn,δ:=ZQdn,Y(a,w)dQn,AW(a,w)=n−1nXi=1Qdn,Y(Ai,Wi),(6)whereQn,AW(a,w)ismerelyanappropriateestimateofthejointdistributionof(A,W).Aninverseprobabilityweighted(IPW)estimatorofψ0,δtakestheformψIPWn,δ=n−1nXi=1Hn(Ai,Wi)Yi(7)=n−1nXi=1˜gn,A(Ai|Wi)gn,A(Ai|Wi)Yi.5JUNE29,2022Popularinpractice,thestabilizedIPWestimator,anadaptationoftheestimatorofequation(7),usesstandardizationtoreducetheimpactofunstableinverseweights:ψIPWn,δ=n−1nXi=1Hn(Ai,Wi)Hn(A,W)Yi,(8)whereHn(A,W)=n−1Pni=1Hn(Ai,Wi).Inequations(6),(7),(8),andinthesequel,thesubscriptndenotesquantitiesestimatedbasedontheempiricaldistributionPninlieuoftheirtruecounterparts(atP0∈M)—thatis,gn,Aisanestimateofg0,A,whileQn,YisanestimateofQ0,Y.Occasionally,subscriptsareomittedentirely,inwhichcaseagivenquantityshouldbetakenasbeingestimatedatanarbitrarydistributionP∈M.RelevanttoourdiscussionofH(A,W),D´ıazetal.(2021),attemptingtoavoidthelaborioustaskofdensityestimation,proposeddirectestimationofthisratioofinverseprobabilityweights,utilizingare-parameterizationbasedontheoddsofavariableinanartiﬁcialdatasetconstructedsoastoincluderecordsforallunitsunderboth˜g0,Aandg0,A.Theirapproachadaptedearlierideasexploitedby,amongothers,Qin(1998),Cheng&Chu(2004),andvanderLaanetal.(2018b)inthecontextofcausalinferenceandexploredindependentlyinthecontextofgeneralmachinelearning(e.g.,Sugiyamaetal.,2010,2012).Recently,Nugent&Balzer(2021,seepage8),indemonstratingcausalinferencewithMTPs,praisedthecomputationalconvenienceofthedirectratioestimationapproach,relativetodirectestimationoftheconditionaldensityg0,A.Yet,thisapproachisonlyapplicableinlimitedsettings.Toseethis,considerthefollowingshortcomingsofthisapproach.Firstly,directratioestimationispronetoproducingbiasedestimatedweights,whicharisefromthedirectestimatetakingnonzerovaluesevenwhen˜g0,Aistrulyzero.Thisamountstoanartiﬁcial(thatis,algorithmicallyinduced)violationofthepositivityassumptionA3,requiringmanualcorrectioneveninstandardsoftwareimplementations.Secondly,therearenumeroussettingsinwhichsuchare-parameterizationcategoricallyfails,includingintheestimationofweightsforstochasticinterventionsthatarenotMTPsorincausalmediationanalysiswithandwithoutMTPs(e.g.,D´ıaz&Hejazi,2020).Thirdly,andperhapsmostcritically,theratioofinverseprobabilityweightsisnotamenabletolikelihood-basedestimationorinference,asitisnotitselfacomponentoftheunderlyinglikelihoodofthedata-generatingprocess.Lastly,sucharepresentationleadsto“artiﬁcial”scoretermsthatareincompatiblewithscoresbasedong0,A,severelycomplicatinganyeffortstoderivesemiparametric-efﬁcientestimatorswithinseveralwell-studiedframeworks.BoththedirectestimatorψSUBn,δandtheIPWestimatorψIPWn,δrequireestimationofonlyasinglenuisanceparameter—theoutcomemechanismandtheconditionaltreatmentdensity,respectively—butarewell-knowntobeirregularwhenthecorrespondingnuisanceparameterisestimatedﬂexibly,sufferfromresidualasymptoticbias,andgenerallyfailtoachievethenonparametricefﬁciencybound.What’smore,neitherestimatorisasymptoticallylinearforψ0,δwhenﬂexibleregressionstrategiesareusedfornuisanceparameterestimation,signiﬁcantlylimitingthereal-worldscenariosinwhichtheseapproachesmaybesuccessfullyapplied.Thesenotableissues,amongothers,havecontributedtotheriseinpopularityofdoublyrobustestimators;accordingly,webrieﬂyreviewtwosuchestimatorsofψ0,δinSectionS4oftheSupplementaryMaterials.Wefocusinsteadonanonparametricestimatorgn,Aofthegeneralizedpropensityscoreg0,A,whichfacilitatesconstructionofnonparametric,asymptoticallyefﬁcientIPWestimatorsofψ0,δ,whencoupledwithsieveestimationandsemiparametricefﬁciencytheory.2.5ThehighlyadaptivelassoestimatorInoursubsequentdevelopments,wemakeuseofanonparametricfunctionestimator,thehighlyadaptivelasso(HAL)(vanderLaan,2017;vanderLaan&Bibaut,2017),whichapproximatesafunctionalparameterofinterest(e.g.,conditionalmean,hazard,density,conditionaldensity)usingalinearcombinationofbasisfunctions.HALre-quiresthatthetargetfunctionalbelongtothesetofc`adl`ag(i.e.,right-handcontinuouswithleft-handlimits)functionswithsectionalvariationnormboundedbyaﬁnite(butunknown)constant,aglobalconstraintthatlimitsthedegreeofvariabilitythatthetargetfunctionalcanexhibit.Similarnonparametricestimationapproachesgenerallymakeuseoflocalsmoothnessassumptions.Whiledevelopmentssimilartooursmaybepossibleunderalternativeassumptions,pursuingsuchacourseofstudyliesoutsideourscopehere.Foranyfunctionf∈D[0,τ],theBanachspaceofd-variatereal-valuedc`adl`agfunctionsonacube[0,τ]∈Rd,thesectionalvariationnormoffmaybeexpressedkfk?ν:=|f(0)|+Xs⊂{1,...,d}Zτs0s|dfs(us)|,wheresaresubsetsof{0,1,...,d},deﬁnedbypartitioning[0,τ]in{0}{∪s(0s,τs]},withthesumtakenoverallsubsetsofthecoordinates{0,1,...,d}.Foragivensubsets⊂{0,1,...,d},deﬁneus:=(uj:j∈s)and6JUNE29,2022u−s:=(uj:j/∈s);then,fs:[0s,τs]→R,deﬁnedasfs(us):=f(us,0−s).Thus,fs(us)isasectionoffthatsetsthecomponentsnotinstozero,thatis,allowingvariationonlyalongthosecomponentsbelongingtous.PerQiuetal.(2021),thisdeﬁnitionofvariationnormcorrespondswiththenotionofHardy-Krausevariation(Owen,2005).vanderLaan(2015,2017)provedthattheHALestimatorconvergestothetargetfunctionalataratefasterthann−1/4,withoutanycontributionfromthedimensionalitydoftheproblemathand,solongasdremainsﬁxed.Subsequenttheoreticalinvestigationsimprovedthisrateofconvergenceton−1/3log(n)d/2(Bibaut&vanderLaan,2019),withongoingworkyieldingpromisingfurtherimprovementsstill(vanderLaan,2022).TheHALestimatorproceedsintwosteps.Tostart,arichsetofindicator(orhigher-order,i.e.,spline)basisfunctionsaregeneratedtorepresentthetargetfunctional;thisstepisamappingofthecovariatespaceintermsoftheHALbasis.Lassoregression(Tibshirani,1996)isthenappliedtoalinearcombinationofthesebasisfunctions,minimizingtheexpectedvalueofanappropriatelossfunctionwhileconstrainingtheL1-normofthevectorofcoefﬁcientstobeboundedbyaﬁniteconstant,itsapproximatesectionalvariationnorm).Benkeser&vanderLaan(2016)demonstratedtheutilityoftheHALestimatorinanextensiveseriesofnumericalexperiments.TheHALestimatorisimplementedinthefreeandopensourcehal9001package(Coyleetal.,2022;Hejazietal.,2020a)fortheRlanguageandenvironmentforstatisticalcomputing(RCoreTeam,2022).Whenanuisanceparameterofinterestistakenasthetargetfunctional,theHALestimatormaybeappliedtogenerateinitialestimates,undertheassumptionthatthetruenuisanceparameterfunctional(e.g.,thegeneralizedpropensityscore)isofﬁnitesectionalvariation.Whenthenuisanceparameterη,witharbitraryinputZ,isreal-valued,itsHALrepresentationmaybeexpressedη(z)=η(0)+Xs⊂{1,...,d}Zzs0sdηs(us)=η(0)+Xs⊂{1,...,d}Zτs0sI(us≤zs)dηs(us),(9)whichcanbeapproximatedbytheuseofadiscretemeasureplacingmassoneachobservedZs,i.Whentherangeofηistheunitinterval,ananalogousapproach,usinginsteadlogit(η),maybeleveragedbasedonarepresentationofGilletal.(1995);notably,Ertefaieetal.(2022)workwiththisrepresentationinusingHALregressionforestimationofthepropensityscoreinthecaseofbinarytreatments.Now,takeZs,itobesupportpointsofηsandletφs,i(cs):=I(Zs,i≤cs),thenηβ=β0+Xs⊂{1,...,d}nXi=1βs,iφs,i,where|β0|+Ps⊂{1,...,d}Pni=1|βs,i|isanapproximationofthesectionalvariationnormofη.Theloss-basedHALestimatorβnmaythenbedeﬁnedβn,λ=argminβ:|β0|+Ps⊂{1,...,d}Pni=1|βs,i|<λn−1nXi=1L(ηβ)(Oi),whereL(·)isanappropriatelychosenlossfunction;seeDudoit&vanderLaan(2005)foranilluminatingdiscussionofappropriatechoicesoflossfunctionforarangeofloss-basedestimationproblems.Salienttoourgoalofestimatingthegeneralizedpropensityscore,thenegativelog-densityloss,L(η)=−log(pη),issuitablefordensityestimation.Finally,theHALestimateofηmaybedenotedηn,λ≡ηβn,λ.EachchoiceoftheregularizationtermλcorrespondstoauniqueHALestimator,thoughmethodsfortheselectionofλmustbetailoredtotheestimationgoalinordertoyieldsuitablecandidateestimators.3EfﬁcientestimationwiththegeneralizedpropensityscoreWenowturntoproceduresforestimationofthegeneralizedpropensityscoreg0,A,fromwhichwemaybeabletosubsequentlydevelopefﬁcient,nonparametricestimatorsofψ0,δ.Forcompatibilitywithoursubsequenttheoreticalresults,wepresentourconditionaldensityestimationprocedureinthecontextoftheHALestimatordiscussedinSection2.5;thisischieﬂyforthreereasons.Firstly,formaltheoreticalresultsguaranteeasuitableconvergencerateforestimatorconstructionwhentheHALestimatorisusedtoapproximatenuisancefunctionals(vanderLaan,2017).Secondly,contemporaneouseffortshavemadeprogressindevelopingefﬁcientdirectandIPWestimatorsoflow-dimensionalparametersincausalinferencesettings(e.g.,vanderLaanetal.,2019;Ertefaieetal.,2022).Thirdly,the7JUNE29,2022HALregressionalgorithmisreadilyavailableandaccessibleviathefreeandopensourcehal9001Rpackage(Coyleetal.,2022;Hejazietal.,2020a).Inconsideringestimationofg0,A,astraightforwardstrategyinvolvesassumingaparametricworkingmodelforafewmomentsofthedensityfunctional,allowingtheuseofstandardregressiontechniquestogeneratesuitableesti-mates(Robinsetal.,2000;Hirano&Imbens,2004).Forexample,onecouldoperateundertheworkingassumptionthatthedensityofAgivenWfollowsaGaussiandistributionwithhomoscedasticvarianceandmeanPpj=1βjφj(W),whereφ=(φj:j)areuser-speciﬁedbasisfunctionsandβ=(βj:j)areunknownregressionparameters.Undersucharegime,adensityestimatecouldbegeneratedbyﬁttingalinearregressionofAonφ(W)toestimateE[A|W],pairedwithmaximumlikelihoodestimationofthevarianceofA.Inthiscase,theestimatedconditionaldensitywouldbegivenbythedensityofaGaussiandistributionevaluatedattheseestimates.Sincesuchstrategiesmakestrongassumptionsabouttheformoftheconditionaldensityfunctional,theyaremorepronetomodelmisspeciﬁcationthanalternativesthatstrivetolimitrelianceonstructuralassumptions.Constructingaﬂexibledensityestimatorisamorechallengingproblem,asthesetofavailabletoolsislimited.Theselimitationsmotivatedourinvestigationofconditionaldensityestimationapproachescapableofhandlingarbitraryregressionfunctions,whichhavebeenformulatedandappliedonlysporadicallyincausalinference(e.g.,vanderLaan,2010;D´ıaz&vanderLaan,2011;Sofryginetal.,2019).Wenextdescribeaﬂexibleclassofnonparametricestimators,implementedinthehaldensifyRpackage(Hejazietal.,2022a);twomorerestrictiveclassesofsemiparametricconditionaldensityestimatorsareoutlinedinSectionS3oftheSupplementaryMaterials.3.1NonparametricestimatorbasedonhazardregressionEstimatorsthateschewanyassumptionsontheformoftheconditionaldensityareararity.Notably,vanderLaan(2010)andD´ıaz&vanderLaan(2011)proposedconstructingestimatorsofthisnuisancefunctionalbyacombina-tionofpooledregressionandexploitationoftherelationshipbetweenthe(conditional)hazardanddensityfunctions.Ourproposalbuildsupontheirs,replacingtheirrecommendationofanarbitrarybinaryregressionmodelwithHALregression.ThisrequiresthekeychangeofadjustingthepenalizationstepofHALregressiontorespecttheuseofalossfunctionappropriatefordensityestimation,namely,L(·)=−log(gn,A)(Dudoit&vanderLaan,2005).Tobuildanestimatorofaconditionaldensity,D´ıaz&vanderLaan(2011)considereddiscretizingtheobservedA∈AbasedonanumberofbinsTandabinningprocedure(e.g.,Tbinsofequallength),wherethechoiceofTcorrespondsconceptuallytothechoiceofbandwidthinkerneldensityestimation.Totakeanexample,aninstantiationofthisprocedurewoulddividetheobservedsupportofAinto,say,T=7,binsofequallength.SuchapartitioningwouldrequireT+1cutpointsalongthissupport,yieldingTbins:[α1,α2),[α2,α3),...,[α6,α7),[α7,α8].Next,areformatted,repeatedmeasuresdatasetwouldbegeneratedbyrepresentingeachobservationalunitbyuptoTrecords(usingonly{Ai,Wi}ni=1),withthenumberofrecordsforagivenunitmatchingtherankofthebinintowhichagivenAifalls.Toclarify,consideranindividualunit{Ai,Wi}forwhichthevalueAifallsintheﬁfthbinofthesevenintowhichthesupporthasbeenpartitioned(i.e.,[α5,α6)).Fivedistinctrecordswouldbeusedtorepresentthedataonthissingleunit:{Aij,Wij}5j=1,where{{Aij=0}4j=1,Ai5=1}andﬁveexactcopiesofWi,{Wij}5j=1.TheresultantrepeatedmeasuresstructureallowsforthehazardprobabilityofAifallinginagivenbinalongitssupporttobeevaluatedviapooledhazardregression(requiringonlybinaryregressionprocedures).Thisproposaleffectivelyreformulatestheproblemintoacorrespondingsetofhazardregressions:P(A∈[αt−1,αt)|W)=P(A∈[αt−1,αt)|A≥αt−1,W)×Qt−1j=1{1−P(A∈[αj−1,αj)|A≥αj−1,W)},wheretheprobabilityofA∈Afallinginbin[αt−1,αt)maybedirectlyestimatedviaabinaryregressionprocedure,byre-expressingthecorrespondinglikelihoodintermsofthelikelihoodofabinaryvariableinarepeatedmeasuresdatasetwiththisstructure.Thehazardestimatesmaythenbemappedtodensityestimatesbyre-scalingthehazardestimatesbythebinsizes|αt−αt−1|,thatis,gn,α(A|W)=P(A∈[αt−1,αt)|W)/|αt−αt−1|,forαt−1≤a<αt.WeformalizethisprocedureinAlgorithm1.Originally,akeyelementofthisproposalwastheﬂexibilitytouseanyarbitrarybinaryregressionproceduretoes-timateP(A∈[αt−1,αt)|W),facilitatingtheincorporationofﬂexibleregressiontechniqueslikeensemblemod-eling(e.g.,Breiman,1996;vanderLaanetal.,2007).Wealterthisproposal,replacingthearbitraryestimatorofP(A∈[αt−1,αt)|W)withHALregression,makingitpossiblefortheresultantconditionaldensityestimatortoachieveaconvergenceratewithrespecttoaloss-baseddissimilarityofn−1/4underglobalsmoothnessassump-tions(vanderLaan,2017;vanderLaan&Bibaut,2017),asdiscussedinSection2.5.Westressthatthisisacriticaladvance—essentialtotheasymptoticpropertiesofournonparametricestimatorsofψ0,δ.8JUNE29,2022Algorithm1:PooledhazardsconditionaldensityestimationResult:EstimatesoftheconditionaldensityofA,givenW.Input:1Anobserveddatavectorofthecontinuoustreatmentfornunits:A2Anobserveddatavectorofthebaselinecovariatesfornunits:W3ThenumberofbinsintowhichthesupportofAistobedivided:T4AproceduretodiscretizethesupportofAintoTbins:ω(·)1Applyω(A,T)todividethesupportofAintoTbins:[α1,α2),...,[αT,αT+1].2Expandtheobserveddatainarepeatedmeasuresdatastructure,expressingeachunitbyuptoTrecords(recordingunitIDwitheach).Foragivenuniti,thesetofrecordsis{Aij,Wij}Tij=1,whereWijareconstantinj,Aijisabinarycountingprocessjumpingto1atTi,andTi≤TindicatesthebininwhichAibelongs.3Estimate,viaHALregression,theconditionalhazardprobabilityofbinmembershipP(Ai∈[αt−1,αt)|W),selectingλnbycross-validatedempiricalriskminimizationofanappropriatelossfunction(Dudoit&vanderLaan,2005).4RescaletheconditionalhazardprobabilityestimatestotheconditionaldensityscalebydividingthecumulativehazardbythebinwidthsforeachAi.Output:gn,A,anestimateofthegeneralizedpropensityscore.3.2NonparametricinverseprobabilityweightedestimationWenowconsidertheconstructionofestimatorsofψ0,δthatrelysolelyonnuisanceestimationofthegeneralizedpropensityscoreg0,A.Dataadaptiveestimatorsofnuisancefunctionalsaregenerallyincompatiblewiththedirect(i.e.,G-computation)andIPWestimators,asconditionsnecessaryforachievingasymptoticdesiderata(e.g.,minimalbias,efﬁciency)areunattainablewithoutimposingstrongsmoothnessassumptionsonthefunctionalformofthenuisanceparameterestimator.Thistheoreticalimpassehas,inpart,fueledtheconsiderablepopularityenjoyedbydoublyrobustestimationmethodologies,suchastheone-stepestimation(Bickeletal.,1993)ortargetedminimumlossestimationframeworks(vanderLaan&Rubin,2006;vanderLaan&Rose,2011,2018),bothofwhichwereviewinthecontextoftheestimationofψ0,δinSectionS4oftheSupplementaryMaterials.Brieﬂy,doublyrobustestimatorsrequireestimationofboththeoutcomemechanismQ0,Yandthepropensityscoreg0,A;moreover,suchestimatorsareconsistentforψ0,δwheneitherofthetwonuisanceparameterestimatorsconvergetotheirtargetsbutasymptoticallyefﬁcientonlywhenbothconvergequicklyenough.WhentheoutcomemechanismQ0,Yproveschallengingtoestimatewell,itistemptingtoconsidertheuseofIPWestimation,whicheschewsestimationofQ0,Yaltogether.TheconstructionofconsistentandasymptoticefﬁcientIPWestimatorscapableofincorporatingdataadaptiveestimationofg0,Ahasbeenconsideredbefore.Forexample,Hiranoetal.(2003)proposedalogisticseriesestimatorofg0,A,whichrequiresfairlystrongsmoothnessassumptions(i.e.,k-timesdifferentiability),whilevanderLaan(2014)investigatedtargeted(parametric)ﬂuctuationofgn,AtoconstructefﬁcientIPWestimators,whichprovedtobeasymptoticallylinearbutirregular.UsingHALtoestimategn,A,Ertefaieetal.(2022)developedundersmoothingstrategiesforasymptoticallylinearandefﬁcientIPWestimation.Alloftheseauthorsexclusivelyconsideredsettingswithbinarytreatments.Wedevelopnonparametric-efﬁcientIPWestimators,leveragingAlgorithm1toconstructgn,A,andbuildpartiallyuponthecontributionsofErtefaieetal.(2022),whodemonstratedthatundersmoothingstrategiescouldbeusedtoselectaHALestimatorofg0,A:=P(A=1|W),ultimatelyyieldingIPWestimators(ofthecausaleffectsofstaticinterventions)thatachievethenonparametricefﬁciencybound.Ertefaieetal.(2022)formulateconditionsunderwhichgn,A,whenestimatedviaHAL,convergestog0,AataratesuitablyfastfortheirnonparametricIPWestimatortoachievetheasymptoticefﬁciencyboundinthenonparametricmodel.TheirmethodsrelyuponundersmoothingtheHAL-estimatedgn,Asoastoincludearichersetofbasisfunctionsthanisrequiredforoptimalestimationofg0,A,whichisachievableviaV-foldcross-validationwithintheframeworkofloss-basedestimation(vanderLaanetal.,2004;Dudoit&vanderLaan,2005;vanderVaartetal.,2006).WeproposetwoclassesofselectionproceduresforundersmoothingHALestimatorsofg0,A.Thesestrategiesshareacommonﬁrststep:constructionofafamilyofHAL-basedconditionaldensityestimatorsgn,Aindexedbytheregularizationtermλ,i.e.,{gn,A,λ:λ1,...,λK}.Forthis,werecommendapplyingAlgorithm1,alteringittousecross-validationonlytoselectthestrictestdegreeofregularizationfromwhichtobeginthecandidatesequenceinλforundersmoothing.Ratherthanreturningasingle9JUNE29,2022estimatorgn,A,thealgorithmoutputs{gn,A,λ:λ1,...,λK},whereλ1≡λCVdenotesthedegreeofregularizationchosenbythecross-validationselectorandλ1>...>λKuniformlyintheindexset.Inthesequel,weassumeaccesstoasequenceofgeneralizedpropensityscoreestimators{gn,A,λ:λ1,...,λK}andacorrespondingsequenceofIPWestimators{ψn,δ,λ:λ1,...,λK}.Then,whatremainsistoselectanIPWestimatorexhibitingdesirableasymptoticpropertiesfromthissequenceofcandidates.Withsimilargoals,Ertefaieetal.(2022)proposetwoundersmoothingcriteria:(1)minimizationofthemeanoftheEIFestimatingequationuptoatheoreticallydesirabledegree,and(2)minimizationofascoreterm(A−gn,A)attributabletothetreatmentmechanism.TheirﬁrstselectorexplicitlyusestheformoftheEIFandmustbederivedanewforanygiveninterventionclass(e.g.,staticvs.stochastic).Weprovidetheﬁrstexplicitre-characterizationoftheEIF(4)inaformsuitableforIPWestimatorselectionbasedonthisstrategy.TheirsecondselectionprocedureisincompatiblewithMTPs,asthereisnoexplicitscoretermforthetreatmentmechanisminthissetting.Intuitively,thisisattributabletothefactthatMTPsdependonthenaturalvalueofA,whichisnotthecaseforsimplerstaticordynamicregimes.Asanalternative,wedevelopaclassofselectionproceduressensitivetochangesalongthesequenceofIPWestimators{ψn,δ,λ:λ1,...,λK}.Aspartoftheseproposals,weprovide,tothebestofourknowledge,theﬁrstdemonstrationofconditionaldensityestimatorundersmoothingincausalinference.TargetedundersmoothingwiththeinﬂuencefunctionToselectanIPWestimatorfromthesequence{ψn,δ,λ:λ1,...,λK}basedontheEIF,itisnecessarytore-expresstheEIFinaformincorporatingtheIPWestimatingfunction,whichcanbedonebyprojectingthisobjectontothespaceofallfunctionsofAthataremean-zeroconditionalonW(Robinsetal.,1994;vanderLaan&Robins,2003).TheIPWmappingdeﬁningtheestimatingfunctionofthestabilizedIPWestimator(8)isU(O;gA,ψ)=˜gA(A|W)gA(A|W)(Y−ψ).(10)NotethattheIPWestimator(8)ismerelyasolutiontotheestimatingfunction(10)(i.e.,obtainedbysettingPnU(gA,ψ)=0).WenextpresentLemma1,whichcharacterizestheformoftheEIFestimatingequationsuit-ableforIPWestimatorselection.Lemma1(IPWrepresentationoftheEIF).LetD?(P)denotetheEIF(4)andletU(gA,ψ)denotetheIPWestimatingfunction(10).ProjectingU(gA,ψ)ontoFCAR={ζ(A,W):P0{ζ(A,W)|W}=0},thespaceofallfunctionsofAthataremean-zero,conditionalonW,yieldsDCAR(P).UsingU(gA,ψ)andDCAR(P),theEIFisD?(P)=U(gA,ψ)−DCAR(P)(Robinsetal.,1994;vanderLaan&Robins,2003),whereDCAR(O;P0)=Q0,Y(A,W)˜g0,A(A|W)g0,A(A|W)−ZAQ0,Y(a,W)˜g0,A(a|W)dµ(a).AmongafamilyofIPWestimators{ψn,δ,λ:λ1,...,λK},anasymptoticallyefﬁcientestimatorminimizes|PnDCAR(gn,A,λ,Qn,Y)|forsomeQn,Y,perTheorem1,whichwewillformallypresentshortly.SuchanIPWestimatorisanapproximatesolutiontotheestimatedEIFasperLemma1.Thelemma’sderivationisprovidedintheSupplementaryMaterials.SinceIPWestimatorsareconstructedasexplicitsolutionstoPnU(gA,ψ)=0,theﬁrsttermoftheEIFrepresentationinthelemmaissolved;thus,selectionofanasymptoticallyefﬁcientIPWestimatorneedonlyconsiderDCAR.EvaluatingDCARrequiresintegrationoverA,whichcanprovecomputationallytaxingonaccountoftheneedtocombinetechniquesfornumericalintegrationwiththoseforconditionaldensityestimation.WhenAisdiscretewithknownbounds,thisintegralexpressioniseasilysimpliﬁed;however,whenAiscontinuous,evaluationofDCARasabasisfordevelopingaselectioncriterioncanbeimpractical.Toresolvethis,weintroducethefollowingalternativeexpressionasapracticalinnovation:eDCAR(O;P)=(cid:20)QdY(A,W)−(cid:18)˜gA(A,W)gA(A,W)(cid:19)QY(A,W)(cid:21)−Ψ(P)(cid:18)gA(A,W)−˜gA(A,W)gA(A,W)(cid:19),whichisobtainedbycombiningDCARwithanotherscoretermappearingintheEIF;detailsaregiveninSectionS1oftheSupplementaryMaterials.Viathissimpliﬁcation,eDCARcanbemadetoservereliablyasasuitablecriterionforbothdiscreteandcontinuousA.Now,atargetedselector,makinguseoftheformofDCAR,isλn=argminλ|PneDCAR(gn,A,λ,Qn,Y)|.(11)ByminimizingtheempiricalmeanoftheestimatedEIFabsolutely,thisselectorrunstheriskofundersmoothingpastthepointatwhichasymptoticefﬁciencyisattained.Anothersuitableselectioncriterion,proposedbyErtefaie10JUNE29,2022etal.(2022),choosestheﬁrstλnatwhich|PneDCAR(gn,A,λ,Qn,Y)|fallsbelow{σn,λCV/log(n)},whereσn,λCVisthestandarderrorestimatebasedontheEIFatthecross-validatedchoiceofλ;thiscriterionbalancesasymptoticbiasagainststandarderrorwhileprioritizingasymptoticefﬁciency.TocharacterizetheefﬁciencyofourproposedIPWestimatorsmorecompletely,weexaminethesecond-orderre-mainderR2oftheEIFexpansion(5).Suchhigher-orderrepresentationsprovideinsightintothebehaviorofefﬁcientestimators,andanexactexpressionforR2canbeusedtostudythedegreetowhichcandidateestimatorsachievehigher-orderformsofefﬁciency.Lemma2providesanexpressionforthissecond-orderterm;aproofisgiveninSectionS2oftheSupplementaryMaterials.Lemma2(Second-orderexpansionoftheEIF).Denoteby{gn,A,Qn,Y}thenuisanceestimatorsof{g0,A,Q0,Y},thetargetnuisancefunctionals;then,R2isR2(gn,A,Qn,Y,g0,A,Q0,Y)=ZWZA(cid:0)Qn,Y(a,w)−Q0,Y(a,w)(cid:1)(cid:18)g0,A(a|w)−gn,A(a|w)gn,A(a|w)(cid:19)˜gn,A(a|w)dµ(a)dν(w).CarefulexaminationofLemma2revealsthattheformofR2isintimatelyrelatedtothatofDCAR,whichappearsintheIPWrepresentationoftheEIFinLemma1—infact,R2(gn,A,Qn,y,g0,A,Q0,y)≡P0DCAR(gn,A,Qn,Y−Q0,Y).Thisremaindertermcharacterizesthecontributionstoasymptoticefﬁciencyofdifferencesbetweenthenuisanceesti-mators{gn,A,Qn,Y}andthecorrespondingnuisancefunctionals{g0,A,Q0,Y}.Assuch,thissecond-ordertermmaybeusedtodeepenourunderstandingofhowimprovednuisanceestimationcanimpactestimatorefﬁciencyinamannerthatstandard(ﬁrst-order)EIFexpansionsarenotequippedtocapture.Notably,thetermR2cannotbeevaluatedinreal-worldsettingsasitrequiresexplicitknowledgeoftheformsof{g0,A,Q0,Y},whichareneveravailableinprac-tice;however,theformofR2itselfcanstillbeusefulin(1)derivinghigher-orderefﬁcientestimators(e.g.,Robinsetal.,2008)and(2)numericallybenchmarkingtherelativeefﬁciencyofbothestablishedandnovelestimators.WenextcharacterizetheasymptoticpropertiesofourundersmoothedIPWestimatorsinTheorem1,whichessentiallydemonstratesthatIPWestimatorsareasymptoticallyefﬁcientunderregularityandrate-convergenceconditionscon-sideredstandardinsemiparametricestimation.Weincludeitsproofbelowsincetherationaleisstraightforward.First,considerthefollowingconditions,necessarytoestablishTheorem1.C1(Donskerclass).D?(gn,A,λ,Qn,Y)∈F?v(M),whereF?v(M)isaDonskerclassandM<∞isauniversalconstantboundingthesectionalvariationnorm.C2(DCARisapproximatelysolved).PneDCAR(gn,A,λn,Qn,Y)=oP(n−1/2).C3(Vanishingremainder).R2(gn,A,λn,Qn,Y,g0,A,Q0,Y)=oP(n−1/2).Theorem1(AsymptoticlinearityandefﬁciencyofundersmoothedIPW).LetλnbeanundersmoothedselectionalongtheHALregularizationpathinλ,e.g.,asinexpression(11),andletψn,δ,λndenotethesolutiontotheestimatingequationPnU(gn,A,λn,ψ)≈0inψ.Then,underConditionsC1–C3,wehaveψn,δ,λn−ψ0,δ=n−1nXi=1D?(Oi;P)+oP(n−1/2).Proof.Deﬁneeψn,δ,λnasthesolutioninψtotheEIFestimatingequationPnD?(gn,A,λn,Qn,Y,ψ).UnderCondi-tionsC1–C3,PnD?(gn,A,λn,Qn,Y,eψn,δ,λn)=oP(n−1/2).Sincegn,A,λnandQn,YareHALestimators,theyarebothofboundedsectionalvariationnormwithuniversalboundM,fulﬁllingConditionC1(vanderLaan,2017).NotethatConditionC3isstandardinsemiparametricestimationandConditionC2issatisﬁedbythedesignofourselectionprocedures.Then,applyingstandardargumentsfordoublyrobustestimation(e.g.,vanderLaan&Rose,2011;Kennedy,2016)yieldseψn,δ,λn−ψ0,δ=n−1nXi=1D?(Oi;P)+oP(n−1/2).TheresultfollowsfromnoticingthatsincebothPneDCAR(gn,A,λn,Qn,Y)=oP(n−1/2)andD?(P)=U(gA,ψ)−DCAR(P),itmustalsoholdthateψn,δ,λn=ψn,δ,λn+oP(n−1/2).11JUNE29,2022TheproofestablishesthatanIPWestimatorselectedbasedonanundersmoothingcriterionlike(11)willbeequivalenttoanasymptoticallyefﬁcientestimatorunderstandardrate-convergenceandentropyconditionsonthenuisanceesti-mators,whichHALhasbeenshowntosatisfy.Eventheentropyconditionscanbefurtherrelaxedbycross-validatingtheIPWestimator(Klaassen,1987;Zheng&vanderLaan,2011).Whilethetheorem’sresultsrequirethattheesti-matingequationPnDCAR(gn,A,λn,Qn,Y)=oP(n−1/2),and,byextension,anestimatingequationbasedonD?,besolvedreasonablywell,wemaynotexplicitlyneedtouseDCARaspartofaselectioncriterion,aswedetailnext.AgnosticundersmoothingwithouttheinﬂuencefunctionExplicit(re)characterizationoftheEIFfortheselectionofanIPWestimatorcanproveachallengingendeavor,re-quiringspecializedandtediousmathematicalmanipulations.Assuch,itisoftenpreferabletoselectanIPWestimatorinamanneragnostictotheEIF’sform.Firstly,suchagnosticselectionproceduresarebetteralignedphilosophicallywithIPWestimation,whichavoidsexplicitmodelingoftheoutcomemechanism(n.b.,theEIFalwayscontainsatermforQ0,Y).Secondly,agnosticproceduresmaysolvescoreequationsbeyondthoseexplicitlyappearingintheEIFexpression,allowingthemtoautomaticallyandblindlysatisfyhigher-orderefﬁciencydesiderata.WeformulatetwoselectionproceduresthatdonotusetheformoftheEIF,insteadconsideringpropertiesoftheIPWestimators{ψn,δ,λ:λ1,...,λK}alongtheirregularizationtrajectory{λ1,...,λK}.Inthecontextofnonparametricsieveesti-mation,suchideaswereformulatedintheseminalworkofLepskii(1992,1993),withsporadicextensionssince(e.g.,Davies&vanderLaan,2014;Mukherjeeetal.,2015;vanderLaanetal.,2018a;Cai&vanderLaan,2020;Qiuetal.,2021).TheaimofformulatingsuchEIF-agnosticundersmoothingselectionproceduresistoproduceselectionssimilarto(orbetterthan)thoseofthetargetedselectors.ForIPWestimatorsbasedontheseagnosticselectorstoasymptoticallyattainthenonparametricefﬁciencybound,theseestimatorsmustsolvetheEIFestimatingequation.Ourﬁrstproposalinthisclassbalanceschangesalongtheregularizationsequence{λ1,...,λK}intheIPWestimatorψn,δ,λagainstchangesinitsestimatedstandarderrorσn,λ.Thisismerelytheﬁrstelementinthesequence{λ1,...,λK}forwhichthecondition|ψn,δ,λj+1−ψn,δ,λj|≤log(n)−1Z(1−α/2)|σn,λj+1−σn,λj|forj={1,...,K−1}(12)ismet.NotethatZ(1−α/2)isthe(1−α/2)thquantileofthestandardGaussiandistribution.Whilewerecom-mendtheuseofthestabilizedIPWestimator(8)forψn,δ,λ,thereareseveralcandidatechoicesforthestandarderrorestimatorσn,λ.WerecommendbasingthisontheempiricalvarianceoftheestimatedIPWestimatingfunc-tionn−1{V[U(gn,A,ψn,δ,λ)]}.WhileHaneuse&Rotnitzky(2013)demonstratedthisvarianceestimatortobeanti-conservative(contrarytonaivetheoreticalexpectations),thischoiceismadeforthesakeofcomputationalease,asonlythesuccessivedifferencesinstandarderrorestimatesalongtheregularizationpatharenecessary.Analternativevarianceestimatecouldbeobtainedviathenonparametricbootstrap,thefunctionalsmoothnessconditionsofwhichHALhasbeenshowntosatisfy(Cai&vanderLaan,2020).Ofcourse,σn,λcouldalsobebasedontheempiricalvarianceoftheEIF,thoughthisobviouslyunderminestheselector’sdesigngoalofEIF-agnosticism.Westressthatourchoiceofvarianceestimatorisimperfect(possiblyfailingtoreﬂectincreasesinvariancethataccompanythere-laxationofregularization),butitprovidesareasonablesurrogateforvariancechangesthatbalancescomputationalexpedienceandinferentialstability.Examinationofequation(12)revealsthatthisselectoridentiﬁesλnastheﬁrstpointinthesequence{λ1,...,λK}atwhichtherelaxationofregularizationimpactstheIPWpointestimateslessthanitaffectstheircorrespondingstandarderrorestimates,indicatingthatadesirablebias-variancetradeoffhasbeenachieved.ThescalingofthestandarderrorestimatebyZ(1−α/2)/log(n)ensuresthatchangesinthepointestimateareweighedagainstchangesinconﬁdenceintervalwidth,asurrogateforinferentialefﬁciency.Apotentialpitfalloftheimmediatelyprecedingproposalisitsrequirementofstandarderrorestimation,whichcanbecomputationallychallenging(e.g.,requiringthebootstrap),resultinunstableorunreliableestimates(e.g.,whenthestandarderrorestimatorisitselfpoor),orrequirenuisanceestimationbeyondg0,A(i.e.,whenthestandarderrorestimatedisbasedontheEIF).Thus,suchanagnosticselectormay,attimes,failtochoosetheoptimalIPWestimatoramongasequence,especiallyinscenariosinwhichstandarderrorestimationproveschallenging.Itispossibletoeschewsuchrequirementsaltogether,relyinginsteadentirelyonthetrajectoryof{ψn,δ,λ:λ1,...,λK}alone.Undersuchastrategy,theselectionλnwouldsimplybetheﬁrstterminthesequence{λ1,...,λK}atwhichthetrajectorytakenby{ψn,δ,λ:λ1,...,λK}encountersaplateau.WeformalizethissecondclassofagnosticselectionproceduresinAlgorithm2.Suchaselectionprocedureconsidersthe“sharpness”ofchangesinthepointestimatesψn,δ,λsequentiallyin{λ1,...,λK}asthedegreeofregularizationisrelaxed.ThisselectoraimstoidentifyavalueλnatwhichthetrajectoryoftheIPWpointestimateψn,δ,λnencountersaninﬂectionpoint,aphenomenonsuggestingthatfurtherrelaxationsoftheregularizationparameteroughtnotcontributemeaningfullytothegoalofdebiasingtheIPWes-12JUNE29,2022Algorithm2:SmoothedplateauselectorfornonparametricIPWestimationResult:Anonparametric-efﬁcientIPWestimatorψn,δ,λnofψ0,δ.Input:1Aregularizationsequenceindecreasingorder:{λ1,...,λK}2AcorrespondingsequenceofIPWestimators:{ψn,δ,λ:λ1,...,λK}3AcorrespondingsequenceofHALestimatorsofg0,A:{gn,A,λ:λ1,...,λK}4ApositivescalarofthemaximummultiplieroftheCV-chosenL1-norm:Kmax5Analgorithmtodetectinﬂectionpointsinasequence:τ(·)1EstimateL1-normforeachIPWestimatorinthegivensequencebysummingthecoefﬁcientsforthenuisanceestimators{gn,A,λ:λ1,...,λK},denotingthis{Mn,λ1,...,Mn,λK}.TheL1-normoftheCV-selectedestimatorgn,A,λ1isMn,λ1.2SelectawindowofcandidateIPWestimatorsanchoredintheneighborhoodoftheCV-selectedestimatorψn,δ,λ1bycomputingaconﬁdenceintervalarounditas{ψn,δ,λ1±Z1−α/2σn,λ1},withσn,λ1beingthestandarderrorestimatebasedonU(gn,A,λn,ψ)andZ1−α/2beingastandardGaussianquantile,and,then,settingtheL1-norm’smaximumallowedvalueasMn,max:=KmaxMn,λ1.Reducetheneighborhoodofcandidateestimatorsto{ψn,δ,λ:λ1,...,λJ}forJ<KfallingwithintheconﬁdenceregionandwithL1-normsnogreaterthanMn,max.3ConstructasmoothedtrajectoryoftheIPWestimators{ψn,δ,λ:λ1,...,λJ}againstthesubsequenceofL1-normsbyapplyingLOESS(orsimilar).4Findaninﬂectionpointalongthesmoothedtrajectorybyapplyingτ(·).Ifthissucceeds,denotetheestimatoratthisindexψn,δ.Ifτ(·)fails,letψn,δ:=ψn,δ,λ1.Output:ψn,δ,anonparametricIPWestimateofψ0,δ.timatorthroughundersmoothing.Asthistrajectorymaybeinsufﬁcientlysmooth(e.g.,when{λ1,...,λK}istoocoarse)torevealsuchinﬂectionpoints,LOESScanbeleveragedtoenforceasufﬁcientdegreeofsmoothness,helpingagiveninﬂection-ﬁndingalgorithmescapefailure.ThisagnosticselectionalgorithmattemptstoﬁndaninﬂectionpointinthetrajectoryoftheIPWestimatorsonlywithinalimitedneighborhoodbeyondtheIPWestimatorchosenbycross-validationgn,A,λCV.ThisformofanchoringservestonarrowthesetofallowableIPWestimatorsconsideredbytheselectorsuchthatthedegreeofdebiasingenforcedbyundersmoothingisnotoverlyextreme,asundersmoothinguncontrollablycouldleadtotheinclusionofHALbasisfunctionsirrelevantforoptimalestimationofψ0,δ.Intuitively,thisformofanchoringensuresthatthisselectionprocedureoperatesinaneighborhoodofL1-normvaluesroughlysimilartothoseconsideredbythetargetedselectionprocedurespreviouslyformulated,aclaiminspiredandcorrobo-ratedbyextensivenumericalexperimentsconductedduringthisalgorithm’sdevelopment.Inthoserareinstancesinwhichaninﬂectionpointcannotbefoundwithinthisneighborhood,theselectionalgorithmsimplyreturnstheIPWestimatorbasedongn,A,λCV.WeconjecturethatanIPWestimatoridentiﬁedbythisselectionalgorithmwillsuitablysolvetheEIFestimatingequationandthusachievedesirableasymptoticproperties,thoughweleavethetheoreticalformalizationofthisclaimasatopicoffutureinvestigation.4NumericalstudiesWeevaluatedourproposedIPWestimatorsinsimulationexperimentsusingtwodistinctdata-generatingprocesses(DGPs)forthetreatmentmechanism.Theseexperimentsaimedtoteaseaparttheimpacttreatmentmechanism’sformontheperformanceofourIPWestimatorsrelativetoanalternativeclassofdoublyrobust(DR)estimatorspopularinmoderncausalinference.Speciﬁcally,wecomparedourIPWestimatorstotargetedminimumlossestimatorsofψ0,δ(reviewedbrieﬂyinSectionS4oftheSupplementaryMaterials),astheseestimatorscanincorporateﬂexibleregressionstrategiesfornuisanceestimation.WeexcludefromourcomparisonclassicalIPWestimatorsbasedonparametricestimationofg0,A,assuchalternativesarepronetomodelmisspeciﬁcationbiasandgenerallyfailtoachievethenonparametricefﬁciencybound(vanderLaan&Robins,2003;Ertefaieetal.,2022).Acrossallreportedexperiments,weconsiderIPWestimatorsoveraregularizationtrajectoryof3000presetcandidatevaluesofλ.Wedemonstratethatundersmoothingofgn,A(basedonAlgorithm1)succeedsindebiasingourIPWestimatorsofψ0,δ,conferringbeneﬁtsintermsofbothbiasandasymptoticefﬁciency.Throughoutourexperiments,wecompareseveralvariantsofourIPWestimatorsψn,δ,λn,differingbythemannerinwhichλnisselected.Weconsideratotalofsixestimatorvariants,including(1)oneinwhichλnisselectedby13JUNE29,2022“global”cross-validation(CV),whichisoptimalforestimationofg0,Abutnotψ0,δ;(2)twobasedonthetargetedcriteriaofLemma1,including(11)anditstolerance-basedalternativeErtefaieetal.(2022);(3)onebasedontheagnosticselectioncriterion(12);(4)anotherbasedontheagnosticselectionapproachofAlgorithm2;and(5)ahybridselectorcombiningtheagnosticselectionapproachofAlgorithm2withatargetedstoppingpoint,whichlimitsitscandidatestoregionsalongtheregularizationgridpriortotheλnselectedbycriterion(11).Fromamongthesesixselectors,two—the“global”CVselectorandthetargetedselector(11)minimizing|PneDCAR(gn,A,λ,Qn,Y)|—areusedascandidatesforgn,AintheDRestimators,whichuseeitherHALregressionora(misspeciﬁed)GLMtoestimateQn,Y.Here,wecompareourestimatorsintermsofscaledbias(multipliedbyn1/2),scaledmean-squarederrorrelativetotheefﬁciencyboundofthegivenDGP,andthedegreetowhichanestimatorsolvestheempiricalmeanoftheEIF.InSectionS5oftheSupplementaryMaterials,weexamineestimatorperformanceintermsof(1)thecoverageoforacleconﬁdenceintervals,whichuseaMonteCarlovarianceestimator(eschewinganyproblemsinvarianceestimation);(2)thecoverageofWald-styleconﬁdenceintervals,whichusetheempiricalvarianceoftheEIF(andmaybepronetopoorvarianceestimation);and(3)anapproximatedsecond-orderremainderR2oftheEIF.ForeachDGP,weconsideracollectionofobserveddataunitsO=(W1,W2,W3,A,Y),whereW1∼Bern(p=0.6),W2∼Unif(min=0.5,max=1.5),andW3∼Pois(λ=2);thegeneratingfunctionsforAandYvaryacrossthetwoscenarios.Foreachsimulationexperiment,inagivenscenario,wesamplen∈{100,200,500}unitsandapplytheIPWandDRestimatorvariantstoestimateψ0,δatδ=1,repeatingeachexperiment300times.Weapproximateψ0,δineachscenariobyapplyingthedirectestimator(6),usingtheknownQ0,Y,inasingle,largesampleofn=1,000,000.Fortheevaluationcriteriaconsidered,thescaledasymptoticbias(i.e.,n1/2(ψ0,δ−ψn,δ,λn))isexpectedtodecreasewithincreasingsamplesizeforconsistentestimators,whilethescaledmean-squarederror(i.e.,n{(ψ0,δ−ψn,δ,λn)2+σ2n,λn}),relativetotheefﬁciencybound,shouldconvergetounityforregularefﬁcientestimators.Allexperimentswereperformedwithversion4.0.3oftheRlanguageandenvironmentforstatisticalcomputing(RCoreTeam,2022).4.1Simulation#1:TreatmentmechanismwithequalmeanandvarianceThissettingisformulatedbasedonatreatmentmechanismgovernedbyaPoissondistribution,inwhichthemeanandvarianceofAarebothequallyimpactedbyasubsetofthebaselinecovariates{W1,W2};theexactformofthetreatmentmechanismresultsinAtakingondiscretevaluesinalargerange.ThisdesignchoiceensuresthatAisincompatiblewithalternative(staticordynamic)interventionschemesbutcompatiblewithMTPs.Forthissce-nario,thetreatmentmechanismtakestheformA|W∼Poisson(cid:0)λ=(1−W1)+0.25W32+2W1W2+4(cid:1)andtheoutcomemechanismisY|A,W∼Bernoulli(p=expit(A+2(1−W1)+0.5W2+0.5W3+2W1W2−7)).Nu-mericalevaluationoftheperformanceofourproposedIPWestimatorsofψ0,δacrossthe300simulationexperimentsissummarizedinFigure1.Intermsofscaledbias,alloftheundersmoothedIPWestimatorvariants(squareanddiamondmarkers)arecomparableatn=200andn=500,withperformanceindistinguishablefromthatofthebetter-performingDRestimators(trianglemarkers).Atn=100,theIPWestimatorsexhibitalimiteddegreemorebiasthantheirDRcounterparts,thoughthisisontheorderofthousandthsontherawbiasscale.TheIPWestimatorbasedonthe“global”CVselector(circlemarker)exhibitsthehighestdegreeofbiasatn=100andn=500,anditsscaledbiasdoesnotappeartobeconvergingtozerowithincreasingsamplesize.Intermsofasymptoticefﬁciency,thetwotargetedundersmoothedIPWestimatorvariants(squaremarkers)outperformtheothersatn=500.AmongthethreeagnosticundersmoothedIPWestimators(diamondmarkers),thetwobasedonvariationsofAlgorithm2outperformtheIPWestimatorbasedonLepski’sselectionapproach(12);however,noneoftheseIPWestimatorsachievetheefﬁciencyboundbyn=500.Notably,theIPWestimatorbasedoncriterion(12)displaysinﬂatedvarianceatn=500,whichweconjecturetobeduetooccasionallypoorselectionsdrivenbyunstablevarianceestimation,asnotedpreviously.Interestingly,andunexpectedbytheory,theIPWestimatorbasedonthe“global”CVselectornearlyachievestheefﬁciencyboundatn=200andn=500butdisplaysnontrivialbiasatthelargersamplesize,suggestingthatitsefﬁciencyarisesfromreducedvariance,ratherthanthedebiasinginducedbyundersmoothing.AlloftheestimatorcandidatesappeartosolvetheempiricalmeanoftheEIFquitewell,suggestingthatalloftheseestimatorsareasymptoticallyefﬁcientbywayoftheirbeingsolutionstotheEIFestimatingequation(uptoareasonabledegree).Overall,theresultsofthissetofnumericalexperimentsspeakinfavorofourproposedestimators,suggestingthatmost,ifnotall,ofournonparametricIPWestimatorsareconsistentandefﬁcientatevenmoderatesamplesizes.Notably,theDRestimatorsachievebetterperformanceatn=100andshouldbepreferredwhenthenumberofstudyunitsavailableissolimited.14JUNE29,20220.00.10.20.30.4100200500n· |y-y^|Scaled bias of candidate IPW and DR estimators1.01.52.02.5100200500[n·((y-y^)2+s^2)]sD*(P0)2Scaled MSE of candidate IPW and DR estimators0.000.010.020.03100200500Mean of |PnEIF|DR: CV global, GLMDR: CV global, HALDR: min |Pn D_CAR|, GLMDR: min |Pn D_CAR|, HALIPW: |Pn D_CAR| < tolIPW: CV globalIPW: min |Pn D_CAR|IPW: Plateau (hybrid)IPW: Plateau (Lepski)IPW: Plateau (smoothing)Mean of |PnEIF| of candidate IPW and DR estimatorsFigure1:NumericalcomparisonsofournonparametricIPWestimatorvariantsandcommonDRestimators.4.2Simulation#2:TreatmentmechanismwithunequalmeanandvarianceThisexperimentalscenariowasconstructedusingatreatmentmechanismgovernedbyaNegativeBinomialdistri-bution,inwhichthemeanµanddispersionνarebothimpactedbyasubsetofthebaselinecovariates{W1,W2}.RecallthatthevarianceofaNegativeBinomialrandomvariableisµ+µ2/ν,sothat,unlikeintheprevi-ousscenario,themeanandvarianceofAneednotmatch.Inthisscenario,thetreatmentmechanismisA|W∼NB(cid:0)µ=(1−W1)+0.25W32+2W1W2+4,ν=5W2+7(cid:1)whiletheoutcomemechanismisY|A,W∼Bernoulli(p=expit(A+2(1−W1)+W2−W3+1.5W1W2−5)).NumericalevaluationoftheperformanceofourproposedIPWestimatorsofψ0,δacrossthe300simulationexperimentsissummarizedinFigure2.Intermsofscaledbias,theundersmoothedIPWestimators(squareanddiamondmarkers)outperformtheIPWesti-matorbasedon“global”CVatn=100andn=200,depictingthedebiasingenforcedbyundersmoothing.ThesenovelIPWestimatorsdisplayperformancecomparabletothatoftheDRestimatorsacrossallofthesamplesizesconsidered(n.b.,thattheunscaledbiasisontheorderofthousandths)andareindistinguishablefromoneanotherbyn=500.Noneoftheestimatorvariantsconsideredappeartoshowanysignofbeingasymptoticallyinconsistent.Asregardsasymptoticefﬁciency,theDRestimatorvariantsoutperformtheirIPWcompetitorsatn=100butshowcom-parableefﬁciencybyn=200;moreover,allestimatorsappeartobeapproachingtheefﬁciencyboundbyn=500,thoughtheIPWestimatorsbasedonthetargetedundersmoothingseemtobeconvergingmorequickly(inn)thantheircounterpartsbasedonagnosticundersmoothingcriteria.Unlikeintheprecedingscenario,theIPWestimatorusingagnosticundersmoothingbasedoncriterion(12)doesnotshowanuptickinefﬁciencyatn=500butinsteadappearstobeconvergingtotheefﬁciencybound.TheIPWestimatorbasedon“global”CVexhibitsinﬂatedbiasandpoorerefﬁciencythanitscounterpartsatn=100andn=200,thoughitsperformancevastlyimproves(tothepointofbeingcomparable)byn=500;westressthatthisisnotexpectedfromtheoryandshouldnotbetakenasageneralpropertyofIPWestimatorsbasedonsuchaselector.AlloftheIPWandDRestimatorvariantsappeartosolvetheempiricalmeanoftheEIFquitewell,suggestingthatallaresolutionstotheEIFestimatingequationand,assuch,capableofachievingasymptoticefﬁciency.Ofnote,withrespecttothismetric,theIPWestimatorsbased15JUNE29,20220.00.10.20.30.4100200500n· |y-y^|Scaled bias of candidate IPW and DR estimators1.01.52.0100200500[n·((y-y^)2+s^2)]sD*(P0)2Scaled MSE of candidate IPW and DR estimators0.000.010.020.030.04100200500Mean of |PnEIF|DR: CV global, GLMDR: CV global, HALDR: min |Pn D_CAR|, GLMDR: min |Pn D_CAR|, HALIPW: |Pn D_CAR| < tolIPW: CV globalIPW: min |Pn D_CAR|IPW: Plateau (hybrid)IPW: Plateau (Lepski)IPW: Plateau (smoothing)Mean of |PnEIF| of candidate IPW and DR estimatorsFigure2:NumericalcomparisonsofournonparametricIPWestimatorvariantsandcommonDRestimators.ontargetedundersmoothingcriteria(squaremarkers)exhibitperformanceclosertothatoftheDRestimatorsthandotheirIPWcounterpartsbasedonagnosticundersmoothing(diamondmarkers).Aswiththeprecedingscenario,theresultsofthissetofnumericalexperimentssuggestthatallofournovelIPWestimatorsareasymptoticallyconsistentandefﬁcient,withperformancecomparabletothatofDRestimatorsinsamplesizesaslowasn=500.WhiletheconclusionmayremainthatDRestimatorsoughttobepreferredwhensamplesizesareverylimited(e.g.,n=100),ournovelIPWestimatorsarecompetitive,asmeasuredbystandarddesideratafromsemiparametricefﬁciencytheory,withaccesstoonlymodestsamplesizes.Furthermore,asevidencedbytheperformanceoftheIPWestimatorsbasedonagnosticundersmoothing,ourproposedestimatorscanachievesuchdesirablelevelsofperformancewithoutanyexplicitknowledgeofsemiparametricefﬁciencytheory.5DiscussionWehavedevelopednonparametric-efﬁcientIPWestimatorsofthecausaleffectsofMTPsbyapplyingtargetedoragnosticsieveestimationtechniquestoﬂexibleestimatorsofthegeneralizedpropensityscore.OurIPWestimatorsrelyentirelyontheaccuracyandrate-convergencepropertiesofthegeneralizedpropensityscoreestimator;moreover,ourtargetedselectorsrelyuponestimationoftheoutcomemechanismaswell,whichplaysaroleinthequalityoftheselection.Thereareseveralavenuesalongwhichourproposedestimatorsandselectionproceduresmaybeevaluated.Forinstance,furtherinvestigationsmayfocusonevaluatingthedegreetowhichselectionofanoptimalundersmoothedestimatorgn,A,λnisimpactedbypossiblypoorestimationofQn,YaswellasthedegreetowhichtheefﬁciencyofourIPWestimatorsdegradesunderpoorestimatesofthelatterquantity.AnanalyticstrategyinthisveincouldleadtoasensitivityanalysisforthisclassofIPWestimators.Examininghowoursuccessfulapplicationofsieveestimationprinciplesinthissettingcouldbeexpandedtootherareasofcausalinferencerevealsfurtheravenuesforpotentialprogress,boththeoreticallyandpractically.16JUNE29,2022Althoughtheformulationanddemonstrationofourproposedmethodologyinthecontextofsingletimepointinter-ventionsappearspromising,extensionstolongitudinalinterventionregimesrequiresigniﬁcantandcarefulattention.D´ıazetal.(2020)havealreadyextendedthetheoreticalunderpinningofMTPstothelongitudinalsetting,thoughtheirestimationeffortsfocusedexclusivelyonsequentiallydoublyrobustestimators.AstheseauthorshavealreadyderivedtheEIFwithrespecttothenonparametricmodelM,oureffortscouldfocusinsteadonderivingtherelevantDCARprojectiontermnecessaryforusingundersmoothingtechniquestoconstructnonparametric-efﬁcientIPWestimatorsofthecausaleffectsoflongitudinalMTPs.Thesuccessfulformulationofsieve-basedestimationstrategiesinthissettingpromisesuniquechallenges,asthegeneralizedpropensityscoreestimatorsateachtimepointwouldneedtobejointlyundersmoothedwiththeaimofsolvingtheEIFadequatelyacrossalltimepoints.NosimilarstrategyappearstohavebeenpreviouslyexploredinthecontextofIPWestimation.Ourexaminationsaimedonlytodevelopnonparametric-efﬁcientIPWestimatorsofthecausaleffectsofMTPs,yetﬂexibleandaccurategeneralizedpropensityscoreestimatorsarecriticalforformulatingdoublyrobustestimatorsaswell.IntheSupplementaryMaterials,wepresentedevidencefromnumericalstudiessuggestingthatouragnosticselectors,andoneofourtargetedselectors,leadtoestimatorsthatminimizethesecond-orderremainderassociatedwiththeEIFjustaswellasconventionaldoublyrobusttechniquesdo.Animportantareaoffutureworkconcernshowtheseselectorscanbecombinedwithdoublyrobustestimatorssoastodevelopproceduresthataredoublyrobust(intermsofconsistency)butthatyetachieveimprovedefﬁciencyandrate-convergencepropertiesviaundersmoothingofthegeneralizedpropensityscore.Whethersuchestimatorscouldbemadetoexhibithigher-orderformsofasymptoticefﬁciency—andthedegreetowhichourselectionprocedureswouldneedtobeadaptedtothisend—remainsanopenquestion,thoughinvestigationsoutsideoftheframeworkofsieveestimationhaveshownpromise(e.g.,Mukherjeeetal.,2017;vanderLaanetal.,2021).AcknowledgementsWethankAlanHubbardandNickJewell,forhelpfulcommentsonanearlydraftofthemanuscript;JeremyCoyle,fordiscussionsandearly-stagecollaborationsonsoftwareimplementations;andTedWestling,forbringingtoouratten-tionsemiparametricconditionaldensityestimationtechniquesforlocation-scalefamilies.NSH’sworkwassupportedinpartbytheNationalScienceFoundation(awardno.DMS2102840),andMJvdLwaspartiallysupportedbyagrantfromtheNationalInstituteofAllergyandInfectiousDiseases(awardno.R01AI074345).ReferencesAUSTIN,P.C.(2018).Assessingtheperformanceofthegeneralizedpropensityscoreforestimatingtheeffectofquantitativeorcontinuousexposuresonbinaryoutcomes.StatisticsinMedicine37,1874–1894.BENKESER,D.&VANDERLAAN,M.J.(2016).Thehighlyadaptivelassoestimator.In2016IEEEInternationalConferenceonDataScienceandAdvancedAnalytics(DSAA).IEEE.BIBAUT,A.F.&VANDERLAAN,M.J.(2019).Fastratesforempiricalriskminimizationwithcadlaglosseswithboundedsectionalvariationnorm.arXivpreprintarXiv:1907.09244.BICKEL,P.J.,KLAASSEN,C.A.,RITOV,Y.&WELLNER,J.A.(1993).EfﬁcientandAdaptiveEstimationforSemiparametricModels.JohnsHopkinsUniversityPress.BREIMAN,L.(1996).Stackedregressions.MachineLearning24,49–64.CAI,W.&VANDERLAAN,M.J.(2020).Nonparametricbootstrapinferenceforthetargetedhighlyadaptiveleastabsoluteshrinkageandselectionoperator(LASSO)estimator.InternationalJournalofBiostatistics16.CHENG,K.F.&CHU,C.-K.(2004).Semiparametricdensityestimationunderatwo-sampledensityratiomodel.Bernoulli10,583–604.COX,D.R.(1958).PlanningofExperiments.Wiley.COYLE,J.R.,HEJAZI,N.S.,PHILLIPS,R.V.,VANDERLAAN,L.W.&VANDERLAAN,M.J.(2022).hal9001:Thescalablehighlyadaptivelasso.Rpackageversion0.4.3.DAVIES,M.M.&VANDERLAAN,M.J.(2014).Sieveplateauvarianceestimators:Anewapproachtoconﬁdenceintervalestimationfordependentdata.Tech.Rep.322,UniversityofCalifornia,Berkeley.UCBerkeleyDivisionofBiostatisticsWorkingPaperSeries.D´IAZ,I.&HEJAZI,N.S.(2020).Causalmediationanalysisforstochasticinterventions.JournaloftheRoyalStatisticalSociety:SeriesB(StatisticalMethodology)82,661–683.D´IAZ,I.,HEJAZI,N.S.,RUDOLPH,K.E.&VANDERLAAN,M.J.(2020).Non-parametricefﬁcientcausalmediationwithintermediateconfounders.Biometrika108,627–641.17JUNE29,2022D´IAZ,I.,HOFFMAN,K.L.&HEJAZI,N.S.(2022).Causalsurvivalanalysisundercompetingrisksusinglongitudi-nalmodiﬁedtreatmentpolicies.arXivpreprintarXiv:2202.03513.D´IAZ,I.&VANDERLAAN,M.J.(2011).Superlearnerbasedconditionaldensityestimationwithapplicationtomarginalstructuralmodels.InternationalJournalofBiostatistics7,1–20.D´IAZ,I.&VANDERLAAN,M.J.(2012).Populationinterventioncausaleffectsbasedonstochasticinterventions.Biometrics68,541–549.D´IAZ,I.&VANDERLAAN,M.J.(2018).Stochastictreatmentregimes.InTargetedLearninginDataScience:CausalInferenceforComplexLongitudinalStudies.Springer,pp.167–180.D´IAZ,I.,WILLIAMS,N.,HOFFMAN,K.L.&SCHENCK,E.J.(2021).Nonparametriccausaleffectsbasedonlongitudinalmodiﬁedtreatmentpolicies.JournaloftheAmericanStatisticalAssociation,1–16.DUDOIT,S.&VANDERLAAN,M.J.(2005).Asymptoticsofcross-validatedriskestimationinestimatorselectionandperformanceassessment.StatisticalMethodology2,131–154.ERTEFAIE,A.,HEJAZI,N.S.&VANDERLAAN,M.J.(2022).Nonparametricinverseprobabilityweightedestima-torsbasedonthehighlyadaptivelasso.Biometrics(justaccepted).GILL,R.D.,VANDERLAAN,M.J.&WELLNER,J.A.(1995).Inefﬁcientestimatorsofthebivariatesurvivalfunctionforthreemodels.InAnnalesdel’IHPProbabilit´esetstatistiques,vol.31.HANEUSE,S.&ROTNITZKY,A.(2013).Estimationoftheeffectofinterventionsthatmodifythereceivedtreatment.StatisticsinMedicine32,5260–5277.HEJAZI,N.S.,BENKESER,D.C.&VANDERLAAN,M.J.(2022a).haldensify:Highlyadaptivelassoconditionaldensityestimation.Rpackageversion0.2.3.HEJAZI,N.S.,COYLE,J.R.&VANDERLAAN,M.J.(2020a).hal9001:ScalablehighlyadaptivelassoregressioninR.JournalofOpenSourceSoftware5,2526.HEJAZI,N.S.,RUDOLPH,K.E.,VANDERLAAN,M.J.&D´IAZ,I.(2022b).Nonparametriccausalmediationanalysisforstochasticinterventional(in)directeffects.Biostatistics(inpress).HEJAZI,N.S.,VANDERLAAN,M.J.,JANES,H.E.,GILBERT,P.B.&BENKESER,D.C.(2020b).Efﬁcientnonparametricinferenceontheeffectsofstochasticinterventionsundertwo-phasesampling,withapplicationstovaccineefﬁcacytrials.Biometrics77,1241–1253.HIRANO,K.&IMBENS,G.W.(2004).Thepropensityscorewithcontinuoustreatments.AppliedBayesianModelingandCausalInferencefromIncomplete-dataPerspectives226164,73–84.HIRANO,K.,IMBENS,G.W.&RIDDER,G.(2003).Efﬁcientestimationofaveragetreatmenteffectsusingtheestimatedpropensityscore.Econometrica71,1161–1189.HUBBARD,A.E.&VANDERLAAN,M.J.(2008).Populationinterventionmodelsincausalinference.Biometrika95,35–47.IMBENS,G.W.(2000).Theroleofthepropensityscoreinestimatingdose-responsefunctions.Biometrika87,706–710.KENNEDY,E.H.(2016).Semiparametrictheoryandempiricalprocessesincausalinference.InStatisticalCausalInferencesandTheirApplicationsinPublicHealthResearch.Springer,pp.141–167.KENNEDY,E.H.(2019).Nonparametriccausaleffectsbasedonincrementalpropensityscoreinterventions.JournaloftheAmericanStatisticalAssociation114,645–656.KENNEDY,E.H.,MA,Z.,MCHUGH,M.D.&SMALL,D.S.(2017).Non-parametricmethodsfordoublyrobustes-timationofcontinuoustreatmenteffects.JournaloftheRoyalStatisticalSociety:SeriesB(StatisticalMethodology)79,1229–1245.KLAASSEN,C.A.(1987).Consistentestimationoftheinﬂuencefunctionoflocallyasymptoticallylinearestimators.AnnalsofStatistics,1548–1562.LEPSKII,O.(1992).AsymptoticallyminimaxadaptiveestimationI—Upperboundsandoptimallyadaptiveesti-mates.TheoryofProbability&ItsApplications36,682–697.LEPSKII,O.V.(1993).AsymptoticallyminimaxadaptiveestimationII—Schemeswithoutoptimaladaptation:Adaptiveestimators.TheoryofProbability&ItsApplications37,433–448.MCHUGH,M.D.,BEREZ,J.&SMALL,D.S.(2013).Hospitalswithhighernursestafﬁnghadloweroddsofreadmissionspenaltiesthanhospitalswithlowerstafﬁng.HealthAffairs32,1740–1747.18JUNE29,2022MUKHERJEE,R.,NEWEY,W.K.&ROBINS,J.M.(2017).Semiparametricefﬁcientempiricalhigherorderinﬂuencefunctionestimators.arXivpreprintarXiv:1705.07577.MUKHERJEE,R.,TCHETGENTCHETGEN,E.J.&ROBINS,J.M.(2015).Lepski’smethodandadaptiveestimationofnonlinearintegralfunctionalsofdensity.Tech.Rep.195,HarvardUniversity.HarvardUniversityBiostatisticsWorkingPaperSeries.NEYMAN,J.(1938).Contributiontothetheoryofsamplinghumanpopulations.JournaloftheAmericanStatisticalAssociation33,101–116.NUGENT,J.R.&BALZER,L.B.(2021).EvaluatingshiftsinmobilityandCOVID-19caseratesinUScounties:Ademonstrationofmodiﬁedtreatmentpoliciesforcausalinferencewithcontinuousexposures.arXivpreprintarXiv:2110.12529.OWEN,A.B.(2005).Multidimensionalvariationforquasi-montecarlo.InContemporaryMultivariateAnalysisAndDesignOfExperiments:InCelebrationofProfessorKai-TaiFang’s65thBirthday.WorldScientiﬁc,pp.49–74.PEARL,J.(2009).Causality:Models,Reasoning,andInference.CambridgeUniversityPress.PEARL,J.(2010).Briefreport:Ontheconsistencyruleincausalinference:“axiom,deﬁnition,assumption,ortheorem?”.Epidemiology,872–875.QIN,J.(1998).Inferencesforcase-controlandsemiparametrictwo-sampledensityratiomodels.Biometrika85,619–630.QIU,H.,LUEDTKE,A.&CARONE,M.(2021).Universalsieve-basedstrategiesforefﬁcientestimationusingma-chinelearningtools.Bernoulli27,2300–2336.RCORETEAM(2022).R:ALanguageandEnvironmentforStatisticalComputing.RFoundationforStatisticalComputing,Vienna,Austria.ROBINS,J.,LI,L.,TCHETGENTCHETGEN,E.&VANDERVAART,A.(2008).Higherorderinﬂuencefunctionsandminimaxestimationofnonlinearfunctionals.InProbabilityandStatistics:EssaysinHonorofDavidA.Freedman.InstituteofMathematicalStatistics,pp.335–421.ROBINS,J.M.,HERN´AN,M.A.&BRUMBACK,B.(2000).Marginalstructuralmodelsandcausalinferenceinepidemiology.Epidemiology11,550–560.ROBINS,J.M.,ROTNITZKY,A.&ZHAO,L.P.(1994).Estimationofregressioncoefﬁcientswhensomeregressorsarenotalwaysobserved.JournaloftheAmericanStatisticalAssociation89,846–866.SOFRYGIN,O.,ZHU,Z.,SCHMITTDIEL,J.A.,ADAMS,A.S.,GRANT,R.W.,VANDERLAAN,M.J.&NEUGE-BAUER,R.(2019).TargetedlearningwithdailyEHRdata.StatisticsinMedicine38,3073–3090.STOCK,J.H.(1989).Nonparametricpolicyanalysis.JournaloftheAmericanStatisticalAssociation84,567–575.SUGIYAMA,M.,SUZUKI,T.&KANAMORI,T.(2012).DensityRatioEstimationinMachineLearning.CambridgeUniversityPress.SUGIYAMA,M.,TAKEUCHI,I.,SUZUKI,T.,KANAMORI,T.,HACHIYA,H.&OKANOHARA,D.(2010).Condi-tionaldensityestimationvialeast-squaresdensityratioestimation.InProceedingsoftheThirteenthInternationalConferenceonArtiﬁcialIntelligenceandStatistics.JMLRWorkshopandConferenceProceedings.TIBSHIRANI,R.(1996).Regressionshrinkageandselectionviathelasso.JournaloftheRoyalStatisticalSociety:SeriesB(StatisticalMethodology)58,267–288.VANDERLAAN,M.J.(2010).Targetedmaximumlikelihoodlearningbasedcausalinference.Tech.Rep.259,UniversityofCalifornia,Berkeley.UCBerkeleyDivisionofBiostatisticsWorkingPaperSeries.VANDERLAAN,M.J.(2014).Targetedestimationofnuisanceparameterstoobtainvalidstatisticalinference.InternationalJournalofBiostatistics10,29–57.VANDERLAAN,M.J.(2015).Agenerallyefﬁcienttargetedminimumlossbasedestimator.Tech.Rep.343,Univer-sityofCalifornia,Berkeley.UCBerkeleyDivisionofBiostatisticsWorkingPaperSeries.VANDERLAAN,M.J.(2017).Agenerallyefﬁcienttargetedminimumlossbasedestimatorbasedonthehighlyadaptivelasso.InternationalJournalofBiostatistics13.VANDERLAAN,M.J.(2022).Furtherimprovementstotheconvergencerateandpropertiesofthehighlyadaptivelassoestimator.Personalcommunication.VANDERLAAN,M.J.,BENKESER,D.&CAI,W.(2019).Efﬁcientestimationofpathwisedifferentiabletargetparameterswiththeundersmoothedhighlyadaptivelasso.arXivpreprintarXiv:1908.05607.19JUNE29,2022VANDERLAAN,M.J.,BIBAUT,A.&LUEDTKE,A.R.(2018a).CV-TMLEfornonpathwisedifferentiabletargetparameters.InTargetedLearninginDataScience:CausalInferenceforComplexLongitudinalStudies.Springer,pp.455–481.VANDERLAAN,M.J.&BIBAUT,A.F.(2017).Uniformconsistencyofthehighlyadaptivelassoestimatorofinﬁnite-dimensionalparameters.arXivpreprintarXiv:1709.06256.VANDERLAAN,M.J.,CHAMBAZ,A.&LENDLE,S.(2018b).Onlinetargetedlearningfortimeseries.InTargetedLearninginDataScience.Springer,pp.317–346.VANDERLAAN,M.J.,DUDOIT,S.&KELES,S.(2004).Asymptoticoptimalityoflikelihood-basedcross-validation.StatisticalApplicationsinGeneticsandMolecularBiology3,1–23.VANDERLAAN,M.J.,POLLEY,E.C.&HUBBARD,A.E.(2007).SuperLearner.StatisticalApplicationsinGeneticsandMolecularBiology6.VANDERLAAN,M.J.&ROBINS,J.M.(2003).UniﬁedMethodsforCensoredLongitudinalDataandCausality.Springer.VANDERLAAN,M.J.&ROSE,S.(2011).TargetedLearning:CausalInferenceforObservationalandExperimentalData.Springer.VANDERLAAN,M.J.&ROSE,S.(2018).TargetedLearninginDataScience:CausalInferenceforComplexLongitudinalStudies.Springer.VANDERLAAN,M.J.&RUBIN,D.(2006).Targetedmaximumlikelihoodlearning.InternationalJournalofBiostatistics2.VANDERLAAN,M.J.,WANG,Z.&VANDERLAAN,L.W.(2021).Higherordertargetedmaximumlikelihoodestimation.arXivpreprintarXiv:2101.06290.VANDERVAART,A.W.,DUDOIT,S.&VANDERLAAN,M.J.(2006).Oracleinequalitiesformulti-foldcrossvalidation.Statistics&Decisions24,351–371.VONMISES,R.(1947).Ontheasymptoticdistributionofdifferentiablestatisticalfunctions.TheAnnalsofMathe-maticalStatistics18,309–348.WESTLING,T.,GILBERT,P.&CARONE,M.(2020).Causalisotonicregression.JournaloftheRoyalStatisticalSociety:SeriesB(StatisticalMethodology)82,719–747.YOUNG,J.G.,HERN´AN,M.A.&ROBINS,J.M.(2014).Identiﬁcation,estimationandapproximationofriskunderinterventionsthatdependonthenaturalvalueoftreatmentusingobservationaldata.EpidemiologicMethods3,1–19.ZHENG,W.&VANDERLAAN,M.J.(2011).Cross-validatedtargetedminimum-loss-basedestimation.InTargetedLearning.Springer,pp.459–474.ZHU,Y.,COFFMAN,D.L.&GHOSH,D.(2015).Aboostingalgorithmforestimatinggeneralizedpropensityscoreswithcontinuoustreatments.JournalofCausalInference3,25–40.20SupplementaryMaterialsforEFFICIENTESTIMATIONOFMODIFIEDTREATMENTPOLICYEFFECTSBASEDONTHEGENERALIZEDPROPENSITYSCORENimaS.HejaziDepartmentofBiostatistics,T.H.ChanSchoolofPublicHealth,HarvardUniversitynhejazi@hsph.harvard.eduDavidC.BenkeserDepartmentofBiostatistics&Bioinformatics,RollinsSchoolofPublicHealth,EmoryUniversitybenkeser@emory.eduIv´anD´ıazDivisionofBiostatistics,DepartmentofPopulationHealthSciences,WeillCornellMedicineild2005@med.cornell.eduMarkJ.vanderLaanDivisionofBiostatistics,SchoolofPublicHealth,UniversityofCalifornia,Berkeleylaan@berkeley.eduJune29,2022WeprovidedetailsonourtheoreticalargumentsinSectionsS1andS2,throughoutwhichwerelyonnotationandquantitiesintroducedwithintheentiretyofthemainmanuscript.Inthesesections,wewill,attimes,makeuseofaconvenientidentityforswapping˜gA(A|W)withQdY(A,W),itselfbasedonthechange-of-variableformulaforintegration.Foranarbitraryfunctionf(A,W)of(A,W),thisidentityisZAf(a,W)˜gA(a|W)dµ(a)=ZAf(d(a,W;δ),W)gA(a|W)b0(a,W;δ)dµ(a),(S1)whered(A,W)isanMTPfollowingAssumptionA1,asinequations(1)and(2),and,inanabuseofnotation,thetermb0(A,W;δ)isthederivativeoftheinverseofd(A,W;δ),meanttorefertotheappropriateinverseofitsprimitive,ford(A,W;δ)deﬁnedpiecewise.Examinationofequation(S1)revealsthattheright-handsideoftheequivalenceisfareasiertoevaluate,sinceitrequiresonlyintegrationwithrespecttogA(A|W),thenaturalconditionaltreatmentdensity,insteadofintegrationwithrespectto˜gA(A|W),thecounterfactualconditionaltreatmentdensity.WhentheMTPisasin(1),theexpressionontheright-handsidefurthersimpliﬁes,asb0(A,W;δ)=1uniformlyinthesupportofd(A,W;δ);however,theexpressionisnotmuchmorecomplicatedwhentheMTPisasin(2),inwhichcaseb0(A,W;δ)=δ−1.Throughouttheremainderofthepresenttreatment,forsimplicityofexposition,wewillassumethatd(A,W;δ)istheMTP(1),thoughsimilarargumentsholdforalternativeMTPdeﬁnitions.S1DevelopingaTargetedUndersmoothingCriterionWenowturntoderivingtheprojectioncomponentDCAR(P0)oftheEIFofψ0,δ,leadingtoLemma1presentedinSection3.2ofthemanuscript.WeusethisformoftheprojectionDCAR(P0)todetailtheconstructionofourpragmaticcriterioneDCAR(P0).RecallthatweconsiderMTPsoftheforms(1)and(2),whichimplydifferingpost-interventionconditionaltreatmentdensities,bothofwhichwedenoteas˜g0,A(A|W).Thesecorrespondtostochasticinterventionsofthesecondvarietydiscussedinthemaintext,inwhichtheMTPd(A,W;δ)shiftsthenaturalvalueofthetreatmentAbyaninvestigator-suppliedscalarδ(W),whichmaydependonbaselinecovariatesW.Tobegin,weremindourselvesthatD?(P)=U(gA,ψ)−DCAR(P)atadistributionP∈MbyarepresentationattributedtoRobinsetal.(1994).arXiv:2205.05777v3  [stat.ME]  28 Jun 2022JUNE29,2022Speciﬁcally,D?(O;P)=(cid:18)Y˜gA(A|W)gA(A|W)−Ψ(P)(cid:19)|{z}U(gA,ψ)−(cid:18)QY(A,W)˜gA(A|W)gA(A|W)−ZAQY(a,W)˜gA(a|W)dµ(a)(cid:19)|{z}scoreforaknownstochasticintervention(DCAR)+(cid:16)QdY(A,W)−E[QdY(A,W)|W](cid:17)|{z}scoreforalearnedstochasticintervention(sg).NotethatthisgeneralrepresentationoftheEIFaccountsforthedependenceofthepost-interventiontreatmentdensity˜gA(A|W)onthedistributionP,thatis,wherethetargetparameteristhecounterfactualmeanofYunderastochasticinterventionoftheﬁrstvarietydiscussedinthemaintext.WhilethisgeneralrepresentationencompassesstochasticinterventionsthatdonotstrictlysatisfyAssumptionA1,requiredofMTPs,itischallengingtoworkwithonaccountofboththesecondterm,whichrequiresintegrationoverA,andthethirdterm,whichinvolvesascorebasedontheoutcomemechanismQY.Fortunately,whenthestochasticinterventionisanMTP(asinthescopeofthismanuscript),asigniﬁcantsimpliﬁcationcanbemade.Namely,whenthepost-interventionconditionaldensityis“known”(i.e.,impliedbyanMTPd(A,W;δ)),thedependenceofthepost-interventiondensity˜g0,A(A|W)onP(i.e.,thethirdtermforlearningastochasticintervention)maybedropped.Inthiscase,theEIFmaybeexpressedD?(O;P)=(cid:18)Y˜gA(A|W)gA(A|W)−Ψ(P)(cid:19)−(cid:18)QY(A,W)˜gA(A|W)gA(A|W)−ZAQY(a,W)˜gA(a|W)dµ(a)(cid:19).Withthisinmind,weneedonlysegregatetheIPWestimatingfunctionU(gA,ψ)fromtheremainingtermsinthisexpressionoftheEIFD?(P)inordertoformulateasuitabletermtobeusedasanobjectiveforundersmoothingoverasequenceofconditionaldensityestimators{gn,A,λ:λ1,...,λK}.RecallingthegeneralexpressionfortheEIFD?(P)asadifferencebetweentheIPWestimatingfunctionU(gA,ψ)andanyremaningterms,wedenotethisexpressionDCAR.ByequivalenceofthesetwoprecedingexpressionsfortheEIF,wenowdeﬁneeDCAR:=DCAR−sg,wherethetwotermsareasdeﬁnedinthegeneralexpressionoftheEIFabove.WestressthateDCARisthedifferencebetweentheprojectionterminthecaseofaknownstochasticintervention˜gAandthescoretermsgarisingfromthedependenceof˜gAonP.Byre-expressingsg,weobtainthefollowingexpressionforeDCAR:eDCAR(O;P)=(cid:18)QY(A,W)˜gA(A|W)gA(A|W)−ZAQY(a,W)˜gA(a|W)dµ(a)(cid:19)|{z}scoreforaknownstochasticintervention(DCAR)−(cid:18)QdY(A,W)−ZAQdY(a,W)gA(a|W)dµ(a)(cid:19)|{z}scoreforalearnedstochasticintervention(sg).UndertheMTPdeﬁnitionandusingAssumptionA1toapplythechange-of-variableformula(perHaneuse&Rot-nitzky(2013))tore-expresstheﬁrstintegralexpressionidenticallytothesecond,thetwointegralexpressionscanbemadetocancelout.ThisresolvesasigniﬁcantpracticalobstacletoworkingwitheDCARasaselectioncriterion.WenowhaveasimpliﬁedexpressionforeDCAR:eDCAR(O;P)=QY(A,W)˜gA(A|W)gA(A|W)−QdY(A,W).ThisprojectiontermeDCARmayserveasasuitablecriterionforundersmoothingofanon-stabilizedIPWestimator(7);however,itdoesnotextendimmediatelytothestabilizedIPWestimator(8).Next,werepeattheanalysisabove,abbreviatingmathematicalmanipulationsforthesakeofconvenience,toderivetheequivalentexpressionforthestabilizedIPWestimator(8).2JUNE29,2022InthecaseofthestabilizedIPWestimator,theformoftheIPWestimatingfunctionanditscorrespondingDCARprojectiontermtakeslightlydifferentformsthantheydointhecaseofthenon-stabilizedIPWestimator.Speciﬁcally,inthiscase,wehaveU(O;gA,ψ)=(cid:18)˜gA(A|W)gA(A|W)(cid:19)(Y−ψ),fortheIPWestimatingfunctionU(gA,ψ)atadistributionP∈M.Then,thecorrespondingtermDCARisDCAR(O;P)=Ψ(P)(cid:18)1−˜gA(A|W)gA(A|W)(cid:19)+(cid:18)QY(A,W)˜gA(A|W)gA(A|W)−ZAQY(a,W)˜gA(a|W)dµ(a)(cid:19).Notably,thescoretermsgforthedependenceof˜gA(A|W)onthedistributionPremainsunaltered.Then,atermappropriateasatargetforundersmoothingofthestabilizedIPWestimator,analogoustothatforthenon-stabilizedIPWestimator,iseDCAR(O;P)=Ψ(P)(cid:18)1−˜gA(A|W)gA(A|W)(cid:19)+(cid:18)QY(A,W)˜gA(A|W)gA(A|W)−QdY(A,W)(cid:19).andmayequivalentlybere-expressedeDCAR(O;P)=Ψ(P)(cid:18)gA(A|W)−˜gA(A|W)gA(A|W)(cid:19)+(cid:18)QY(A,W)˜gA(A|W)gA(A|W)−QdY(A,W)(cid:19).Asperthemaintext,thisprojectionoftheEIFontoFCAR,thespaceoffunctionsofAthataremean-zerocondi-tionalonWcanbeusedinformulatingatargetedundersmoothingcriterionforselectingasymptoticallyefﬁcientIPWestimatorsthatsolvetheEIFestimatingequationasper(11).AnyIPWestimatorsufﬁcientlyminimizing|PnDCAR(gn,A,λ,Qn,Y)|isnecessarilyasolutionof|PnD?(gn,A,λ,Qn,Y)|≈0,giventhatallIPWestimatorsareconstructedassolutionsto|PnU(gA,ψ)|≈0.S2Second-orderremainderoftheefﬁcientinﬂuencefunctionToformallycharacterizetheexactsecond-orderremainderR2oftheEIFexpansion(5),aspresentedinLemma2,weconsidertheEIFexpansionatP,P0∈M:R2(gn,A,Qn,Y,g0,A,Q0,Y)=Ψδ(P)−Ψδ(P0)+P0D?(P),where,perthediscussioninSectionS1,thelasttermP0D?(P)admitstherepresentationP0D?(O;P)=P0QY(A,W)˜gA(A|W)gA(A|W)−Ψδ(P)(S2)−P0Q0,Y(A,W)˜gA(A|W)gA(A|W)+P0,WZAQY(a,W)˜gA(a|W)dµ(a)=P0(QY(A,W)−Q0,Y(A,W))˜gA(A|W)gA(A|W)g0,A(A|W)(S3)+P0,WZAQY(a,W)˜gA(a|W)dµ(a)−Ψδ(P)=P0(QY(A,W)−Q0,Y(A,W))(cid:18)g0,A(A|W)gA(A|W)−1(cid:19)˜gA(A|W)(S4)+P0(QY(A,W)−Q0,Y(A,W))˜gA(A|W)3JUNE29,2022Throughoutthemanipulationsintheexpressionsabove,therearrangementsbetween(S2)and(S3)arestraight-foward,whiletheﬁnalequivalence(S4)isjustiﬁedbyuseofthetruedistributionofW,underwhichtheequiv-alenceP0RAQY(a,W)˜gA(a|W)dµ(a)−Ψδ(P)=0holds.Inordertoobtainanexactexpressionforthesecond-orderremainderterm,oneneedonlycombine(S4)withthedifferencetermΨδ(P)−Ψδ(P0),yieldingR2(gn,A,Qn,Y,g0,A,Q0,Y),perthedeﬁnitionabove.Combiningtheseexpressions,andaftermathematicalsim-pliﬁcationsomittedforbrevity,onearrivesimmediatelyattheformoftheremaindergiveninLemma2:R2(gA,QY,g0,A,Q0,Y)=ZWZA(cid:0)QY(a,w)−Q0,Y(a,w)(cid:1)(cid:18)g0,A(a|w)−gA(a|w)gA(a|w)(cid:19)˜gA(a|w)dµ(a)dν(w).Thisformofthesecond-orderremainderprovidesinsightsintothemechanismbywhichundersmoothingofanesti-matorofg0,A(A|W)canendowanestimatorΨδ(P)ofΨδ(P0)withdesirableasymptoticefﬁciencyproperties.Inthemainmanuscript,shortlyafterpresentingLemma2,itisnotedthatthisremaindertermmaybecharacterizedintermsofDCAR,thatis,R2(gA,QY,g0,A,Q0,Y)≡P0DCAR(gA,QY−Q0,Y).Thisexpressionforthesecond-orderremainderisbasedonre-expressingtheEIFusingthecharacterizationintroducedinLemma1,whichexplicitlystatesthatD?(P)=U(gA,ψ)−DCAR(P).StraightforwardmanipulationofthisexpressionoftheEIFquicklyyields,P0D?(gA,QY)−P0D?(gA,Q0,Y)=P0(cid:18)˜gAgAY(cid:19)−Ψδ(P)−P0(cid:18)˜gAgAY(cid:19)+Ψδ(P0)−P0DCAR(QY,gA)+P0DCAR(Q0,Y,gA)=Ψδ(P0)−Ψδ(P)+P0DCAR(gA,QY−Q0,Y).Withthisequivalenceestablished,itisnoweasiertonoticethatthesecond-orderremainderisitselfonlyascoreofthetreatmentmechanism;thus,undersmoothingofanestimatorofthetreatmentmechanismwouldbeexpectedtosolveR2tosomenontrivialdegree.Indeed,thisexpressionprovidestheinsightthatundersmoothingofaHALestimatorofg0,A(A|W)soastoincludearichersetofbasisfunctions(yieldingamorenonparametricestimator)oughttosolvethissecond-orderremainderbetter.Asnotedinthemainmanuscript,R2itself,unlikeDCAR,cannotbeusedasanundersmoothingtarget,sinceitsformreliesonthetrueoutcomemechanismQ0,Y(A,W),whoseformisneverknowninpractice.Yet,itmaybepossibletomakeuseofR2asadiagnosticforthecomparisonofcandidateestimators.Tothisend,inournumericalexperiments(presentedinSection4andreexaminedinSectionS5),weevaluatetheperformanceofourproposedIPWestimators,alongsidethatofseveralcompetitors,usinganapproximationofR2(aswellasstandardmetrics).Todoso,wedeﬁne˜R2(·):=P0DCAR(gA,QY−Q0,Y),whichcanbeevaluatedinanygivensimulateddatasetO1,...,Onbyestimatingthenuisancequantities(e.g.,withappropriateHALestimators)andcomputingthedifferencesoftheseagainsttheknownformsofthenuisanceparameters,themselvesevaluatedonthegivendataset.Inourexamples,byapplyingtheMTPdirectlytothegivendataset,itispossibletonumericallyevaluatetheintegralexpressions(over˜gA(A|W)))thatappearinthedeﬁnitionoftheremainderterm.Evaluating˜R2acrossmanynumericalexamplesthenallowsapproximationofR2asR2=P0˜R2,wheretheexpectationwithrespecttoP0isevaluatedbyMonteCarlointegration.S3AlternativeconditionaldensityestimatorsS3.1Semiparametriclocation-scaleconditionaldensityestimationArecentlydevelopedfamilyofﬂexiblesemiparametricconditionaldensityestimatorstakesthegeneralformρ(A−µ(W)/σ(W)),whereρisagivenmarginaldensityfunction.Conditionaldensityestimationproceduresfallingwithinthisframeworkmaybecharacterizedasbelongingtoaconditionallocation-scalefamily,i.e.,wheregn,A(A|W)=ρ((A−µn(W))/σn(W));wherewestressthatthemarginaldensitymappingρisselectedapriori,leavingonlytherelevantmomentsµandσtobeestimated.Thoughtherestrictionto(conditional)location-scalefamiliesimposessomelimitationsontheformofthetargetfunctional,thestrategyismadeparticularlyﬂexiblebyitsabilitytoincorporatearbitrary,data-adaptiveregressionstrategiesfortheestimationofµ(W)=E[A|W]and,optionally,oftheconditionalvarianceσ(W)=E[(A−µ(W))2|W].Inparticular,insettingswithlimiteddata,theadditionalstructureimposedbytheassumptionofformofthetargetdensityfunctional(i.e.,inthespeciﬁedkernelfunctionρ)canprovebeneﬁcial,whenthetrue4JUNE29,2022densityfunctionadmitssucharepresentation.Whilewestressthatthisprocedureissurelynotanovelcontributionofthepresentwork,wehavebeenotherwiseunabletoascertainaformaldescriptionofit;thus,weprovidesuchaformalizationinAlgorithmS1,whichsketchestheconstructionofconditionaldensityestimatorsofthisfamily.AlgorithmS1:Location-scaleconditionaldensityestimationResult:EstimatesoftheconditionaldensityofA,givenW.Input:1Anobserveddatavectorofthecontinuoustreatmentfornunits:A2Anobserveddatavector(ormatrix)ofthebaselinecovariatesfornunits:W3Akernelfunctionspeciﬁcationtobeusedtoconstructthedensityestimate:ρ4Acandidateregressionproceduretoestimatetheconditionalmeanµ(W):fµ5Acandidateregressionproceduretoestimatetheconditionalvarianceσ(W):fσ1EstimateE[A|W],theconditionalmeanofAgivenW,byapplyingtheregressionestimatorfµ,yieldingˆµ(W).2EstimateV[A|W],theconditionalvarianceofAgivenW,byapplyingtheregressionestimatorfσ,yieldingˆσ2(W).NotethatthisstepinvolvesonlyestimationoftheconditionalmeanE[(A−ˆµ(W))2|W].3Estimatetheone-dimensionaldensityof(A−ˆµ(W))2/ˆσ2(W),usingkernelsmoothingtoobtainˆρ(A).4Constructtheestimatedconditionaldensitygn,A(A|W)=ˆρ((A−ˆµ(W))/ˆσ(W)).Output:gn,A,anestimateofthegeneralizedpropensityscore.Thesketchofthealgorithmforconstructingestimatorsgn,A(a|w)ofthegeneralizedpropensityscoremaytaketwoforms,whichdivergeatthesecondstepabove.Firstly,onemayelecttoestimateonlytheconditionalmeanµ(W)viaaregressiontechnique,leavingthevariancetobetakenasconstant(estimatedsimplyasthemarginalmeanofE[(A−ˆµ(W))2]).Estimatorsofthisformmaybedescribedashavinghomoscedasticerror,basedonthevarianceassumptionmade.Alternatively,onemayadditionallyestimatetheconditionalvarianceσ2(W)viatheresidualsoftheestimatedconditionalmean,thatis,estimatinginsteadtheconditionalmeanE[(A−ˆµ(W))2|W].Whiletheregressionproceduresfµandfσusedtoestimatetheconditionalmeanµ(W)andtheconditionalvarianceσ2(W),respectively,maybearbitrary,withcandidatesincluding,forexample,regressionensembles(Breiman,1996;vanderLaanetal.,2007),werecommendtheuseofHALregression(Benkeser&vanderLaan,2016;vanderLaan,2017),asitsusewillensureanenhancedrateofconvergence(Bibaut&vanderLaan,2019)oftheestimatorgn,Atoitstargetg0,A.Thedata-adaptivenatureofHALregressionaffordsadegreeofﬂexibilitythatoughttolimitopportunitiesformodelmisspeciﬁcationtocompromiseestimationofg0,A;morever,theirimprovedconvergenceratewillhelptofacilitatetheconstructionofasymptoticallylinearandefﬁcientestimatorsofψ0,δ.S3.2ProportionalhazardshighlyadaptivelassoconditionaldensityestimationNotethataconditionaldensitymaybewrittenintermsofthehazardfunctionandsurvivalfunctionasfollowsgA(a|w)=λ(a|w)exp(cid:18)−Za0λ(s|w)ds(cid:19),(S5)whereλ(a|w)istheconditionalhazardfunctionandthesurvivalfunctionisexp(−Ra0λ(s|w)ds,i.e.,are-scaledcumulativehazard.Usingthehighlyadaptivelasso,theconditionalhazardmaybeestimatedbasedonaCoxproportionalhazardmodel:λ(a|w)=λ0(a)expXjβjφj,(S6)whereanygivenφj=I(a>cj)forsomecutoffcj,essentiallyaknotpointwhensplinebasisfunctionsareusd.Assumingthatthequantityinequation(S6)canbeestimatedusingopensourcesoftware,asavailableinthehal9001(Hejazietal.,2020;Coyleetal.,2022)andglmnet(Friedmanetal.,2009)Rpackages.Inthesequel,wefocusonestimationofthequantityΛ(a|w)=Ra0λ(s|w)ds,thecumulativehazard,assumingaccesstothequantityλ(a|w)sinceitsestimationisstraightforwardinsurvivalanalysis.5JUNE29,2022Notethatthecumulativehazardfunctionismerelytheprimitiveoftheconditionalhazardfunctionλ(a|w);thus,wehaveΛ(a|w)=Za0λ(s|w)ds=Zas=0λ0(s)expXjβjφj(s,w)ds=LXl=1λ0(s)expXjβjφj(al,w)(al+1−al),whereal≤aandthisﬁnalquantityisestimableviastandardtechniquesfornumericalintegration.WithanestimateofΛ(a|w)inhand,anestimatoroftheconditionaldensitymaybeconstructedbytherelationgiveninequation(S5):gA(a|w)=λ(a|w)exp(−Λ(a|w)).Althoughitisnotwithoutassumptions—mostnotably,thatofproportionalhazards—suchanestimatoroftheconditionaldensityismoreﬂexiblethanitsentirelyparametriccounterparts,especiallywhennonparametricregression(e.g.,HAL)isusedforestimationoftheconditionalhazardfunction.AvariantofthisstrategyhasbeenexploredandsuccessfullyutilizedbyRytgaardetal.(2022,AppendixBandC)inthecontextofconditionaldensityestimationinlongitudinalstudiesusinganintensity-basedrepresentationofthehazardbasedonthePoissonlikelihood.S4DoublyrobustestimationTwopopularframeworksforefﬁcientestimation,bothtakingadvantageoftheEIFestimatingequation,includeone-stepestimation(Pfanzagl&Wefelmeyer,1985;Bickeletal.,1993)andtargetedminimumloss(TML)estimation(vanderLaan&Rubin,2006;vanderLaan&Rose,2011).Importantly,boththeone-stepandTMLestimatorsaredoublyrobust(DR),apropertywhichaffordstwoimportantconveniences.Firstly,bothestimatorsareconsistentforψ0,δwheneitheroftheinitialnuisanceestimatesofgn,AandQn,Yareconsistentfortheirrespectivenuisancefunctionals.Whiletheprotectionaffordedbythisformofrobutnessispracticallyuseful,itcarrieswithitadisadvantage:theseestimatorscanonlyachieveasymptoticefﬁciencywhenbothinitialnuisanceestimatesareconsistent.Secondly,asaconsequenceoftheirexplicitconstructionbasedontheEIF,bothreadilyaccommodatetheuseofﬂexible,data-adaptiveestimationstrategiesfortheinitialestimationofnuisanceparameters.ThislatterpropertyprovidestheseestimatorswithadistinctadvantageovertheirdirectandIPWestimatorcounterparts:twoopportunitiestoavoidmisspeciﬁcationbias.Invokingeitherestimationstrategyproceedsﬁrstbyconstructinginitialestimators,gn,AandQn,Y,oftheconditionaltreatmentdensityg0,AandtheoutcomemechanismQ0,Y.ThesetwoDRframeworksdivergeattheirsecondstage,eachofwhichimplementdifferentformsofbiascorrection.Withintheone-stepframework,thisamountstoupdatingtheinitialestimateψn,δ—itselfobtainedsimplyby“pluggingin”theinitialestimateoftheoutcomemechanismQn,Yintothedirectestimator(6)—byaddingtoittheempiricalmeanoftheEIFevaluatedattheinitialnuisanceestimates{gn,A,Qn,Y}.UsingtheEIFD?n,ievaluatedatthenuisanceestimates{gn,A,Qn,Y},theone-stepestimatorisψ+n,δ:=ψn,δ+n−1Pni=1D?n,i.Theone-stepestimatorψ+n,δofψ0,δisbothasymptoticallylinear(onaccountofthebiascorrectionstep)andcapableofasymptoticallyachievingthenonparametricefﬁciencybound;moreover,itiscompatiblewithinitialnuisanceestimates{gn,A,Qn,Y}thatareconstructedfromﬂexible,data-adaptiveregressionstrategies.Onaccountofitsadditivebias-correctionprocedure,theone-stepestimatorisnotguaranteedtorespecttheboundsoftheparameterspaceofψ0,δ.IntheTMLestimationframework,aunivariate(mostoften,logistic)parametrictiltingmodelisusedtoupdatetheinitialestimateQn,YoftheoutcomemechanisminsuchawaythattheEIFestimatingequationissolveduptoatheoreticallydesirabledegree.PluggingthisupdatedinitialestimateQ?n,Yintothedirectestimator(6)yieldsatargetedestimatorψ?n,δofψ0,δ.Speciﬁcally,theTMLestimatormaybeconstructedbyupdatingtheinitialestimatorQn,YtoatiltedvariantQ?n,Y,throughaone-dimensionallogistictiltingmodeloftheformlogitQ?n,Y=logitQn,Y+(cid:15)Hn,inwhichtheinitialestimateQn,Yistakenasanoffset(i.e.,ﬁxedparametervalueknownaprioritobeone)andonlytheparameter(cid:15)needbeestimated.Thistargetedestimatoristhenψ?n,δ:=RQ?n,Y(d(a,w;δ),w)dQn,AW(a,w).Likeitsone-stepestimatorcounterpart,theTMLestimatorψ?n,δisbothasymptoticallylinear(onaccountofthe6JUNE29,2022biascorrectionaffordedbythetiltingstep)andcapableofasymptoticallyachievingthenonparametricefﬁciencybound.Itisalsocompatiblewithinitialnuisanceestimates{gn,A,Qn,Y}thatareconstructedfromﬂexible,data-adaptiveregressionstrategies,and,unliketheone-stepestimator,itisaplug-inestimator,incapableoflyingoutsidetheboundsoftheparameterspaceofψ0,δ.Additionally,numericalstudieshaveshownthattheTMLestimatorgenerallydisplaysbetterﬁnite-sampleperformancethantheone-stepestimator(vanderLaan&Rose,2011).Accordingly,inthenumericalexperimentspresentedinSection4ofthemanuscript,weuseaTMLestimatorunderdifferingnuisanceparameterconﬁgurations.Bothone-stepandTMLestimatorsofψ0,δareimplementedintheopensourcetxshiftRpackage(Hejazi&Benkeser,2020,2022),freelyavailableontheComprehensiveRArchiveNetwork.S5AdditionalnumericalresultsHere,weconsidertheperformanceofthesamesetofsixIPWandfourDRestimatorsacrossthetwoDGPsdiscussedinthemainmanuscript,thoughweassessperformanceintermsofthreealternativemetrics.Thesethreemetricsaretheempiricalcoverageoforacleconﬁdenceintervals(CIs),whichuseaMonteCarlovarianceestimatetoavoidissuesintroducedbyunstablevarianceestimation;theempiricalcoverageofWald-styleconﬁdenceintervals,whichusetheempiricalvarianceoftheestimatedEIFandsomaybepronetoissuesofpoorvarianceestimation;andthemagnitudeofanapproximationofthesecond-orderremainderR2associatedwitheachoftheestimatorvariants.Themannerinwhichthissecond-orderremaindertermisapproximatedisbrieﬂydiscussedinSectionS2.SincethisapproximationoftheremaindertermR2ispronetoasmalldegreeofinstability,wecomputethemetricusingatrimmedmeanthatremovesthelowestandhighest5%ofitsrealizationsacrossthe300simulations.WenotethatthesemetricsaresimilartothoseconsideredinSection4ofthemainmanuscript:performanceintermsofthecoverageoforacleCIsisameasureofbias;thatintermsofthecoverageofWald-styleCIsisameasureofefﬁciency(inthatitaccountsforbothbiasandthequalityofvarianceestimation);andthatintermsofthemagnitudeofR2isameasureofhigher-orderefﬁciency,thatis,howwelltheestimatorsachieveefﬁciencybeyondtheﬁrst-orderEIFapproximation.S5.1Simulation#1:TreatmentmechanismwithequalmeanandvarianceUsingthesameDGPasconsideredinSection4.1,weevaluateeachoftheestimatorvariants,intermsofthethreeal-ternativemetricsdiscussedabove,across300simulationexperiments.TheirperformanceissummarizedinFigureS1.7JUNE29,20220.850.900.951.00100200500CI coverageCoverage of 95% oracle CIs of candidate IPW and DR estimators0.850.900.951.00100200500CI coverageCoverage of 95% Wald CIs of candidate IPW and DR estimators0.0050.0100.0150.0200.025100200500Sample sizeMean of EIF R2DR: CV global, GLMDR: CV global, HALDR: min |Pn D_CAR|, GLMDR: min |Pn D_CAR|, HALIPW: |Pn D_CAR| < tolIPW: CV globalIPW: min |Pn D_CAR|IPW: Plateau (hybrid)IPW: Plateau (Lepski)IPW: Plateau (smoothing)Mean of EIF R2 of candidate IPW and DR estimatorsFigureS1:AlternativenumericalcomparisonsofournonparametricIPWestimatorsandDRestimators.ExaminationofFigureS1quicklyrevealsthatallbutoneoftheestimatorsconsideredperformwellintermsofthecoverageoforacleCIs,indicatingnegligiblebiasforthevastmajorityofestimators.ThisassessmentisgenerallyinagreementwithcorrespondingresultsonbiasappearinginFigure1.Notably,theIPWestimatorbasedon“global”CVselectionshowspoorcoverage(20%lowerthanthenominalrate)atn=100anddegradingcoveragefromn=200(atthenominalrate)andn=500(5%lowerthanthenominalrate);again,thisisconsistentwithconclusionsdrawnbasedonothermetrics.ThecoverageofWald-styleCIsrevealsthattheIPWestimatorvariantsbasedontargetedundersmoothingperformcomparablytothebestvariantamongtheDRestimators.TheIPWestimatorsbasedonagnosticundersmoothingachievecoveragenearthenominalrate,butshowverylimitedcoverageloss(5%lowerthanthenominalrate)byn=500;moreover,theIPWestimatorusingtheagnosticcriterion(12)showssigniﬁcantlossofcoverage(10%lowerthanthenominalrate)byn=500,suggestinginstabilityofthisselector,possiblyonaccountofpoorstandarderrorestimation.TheIPWestimatorbasedonthe“global”CVselectorappearstocovernearthenominalrate,thoughthisislikelyattributabletothemannerinwhichthisselectorprioritiesvarianceestimationoverdebiasing.AmongtheDRestimators,thosebasingthetreatmentmechanismestimateonthe“global”CVselectorachievedesirablecoverageatn=100andn=200,butthevariantusingamisspeciﬁedGLMtoestimatetheoutcomemechanismshowsdegradingcoveragebyn=500.ThoseDRestimatorsusingcriterion(11)forthetreatmentmechanismestimatorexhibitpoorercoverageatn=100andn=200(≈7%lowerthanthenominalrate)butbutappeartobesteadilyimprovingwithgrowingsamplesize.Turningnowtothemetricapproximatingthesecond-orderremainderR2,mostoftheestimatorvariantsdisplaycomparablygoodperformanceuniformlyacrossthethreesamplesizes;however,theDRestimatorsandtheundersmoothedIPWestimatorthatmakeuseofcriterion(11)fortreatmentmechanismestimationresultinaninﬂatedsecond-orderremainderrelativetotheircompetitors(byafactorofthreeatn=100andbyafactorofﬁveatn=500).Thissuggeststhatabsoluteminimizationof|PneDCAR(gn,A,λ,Qn,Y)|carrieswithitatradeoffasregardsstabilityoftheselectedtreatmentmechanismestimator,asrelatedIPWestimatorsexhibitlowbiasandreasonableefﬁciencybutmaybedoingsobycompromisinghigher-orderefﬁciency.Thisisnotnecessarilyatoddswiththeoreticalexpectations.Overall,thepicturepaintedbyexaminingourproposedIPWestimatorsandstandardDRcompetitorsalongthisalternativesetofmetricsspeakstothereliableperformanceof8JUNE29,2022ourundersmoothedIPWestimators,intermsofinferentialbias(capturedbythecoverageofCIs)andhigher-orderefﬁciencycriteria.Inordertogainadegreeofintuitionregardingthechoicesoftreatmentmechanismestimatormadebyeachoftheselectors,weexamine,inasinglenumericalexamplewithsamplesizen=100,alloftheIPWestimatorcandidatesalongtheregularizationpathdeﬁnedbyλ.Initially,thisregularizationpathissettoinclude3000presetvaluesofλ(ﬁxedacrossallofournumericalexperiments),thoughtheλnchosenbythe“global”CVselectorisusedasthestartingpointfortheundersmoothing-basedselectors.FigureS2illustratesthetrajectorytakenbytheIPWestimatorsalongthisgridinλ.IPW: CV globalIPW: |Pn D_CAR| < tolIPW: min |Pn D_CAR|IPW: Plateau (Lepski)IPW: Plateau (smoothing)IPW: Plateau (hybrid)0.50.60.70.80.95.07.510.012.515.0-log(l)IPW estimate ynaaaaaaIPW: |Pn D_CAR| < tolIPW: CV globalIPW: min |Pn D_CAR|IPW: Plateau (hybrid)IPW: Plateau (Lepski)IPW: Plateau (smoothing)Regularization path of candidate IPW estimatorsFigureS2:SolutionpathinλofnonparametricIPWestimatorsinasinglenumericalexample.InFigureS2,thesixcandidateIPWestimatorsgeneratedbyeachoftheselectorsaredisplayed,withthechoicemadebythe“global”CVselectorbeingtheﬁrstinthesolutionpath;allvaluesalongthegridcorrespondingtostricterregularizationthanthisaretruncated.Thetruevalueofψ0,δ,approximatedinaverylargesample,isindicatedbyhorizontaldashedline.Whilethisisonlyasinglenumericalexample,theIPWestimatorschosenbythevariousselectorsmaybesomewhatindicativeofthedegreeofregularizationpreferredbyeach,andonemaygenerallyexpectthatthetargetedundersmoothingselectorbasedoncriterion(11)willpreferfarlessextremelevelsofregularizationthantheothers.Notably,asthedegreeofregularizationisrelaxedtoomuch,thesolutionpathoftheIPWestimatorsdiverges(after−log(λ)≈10)fromthetruevalueψ0,δinanirrecoverablemanner.S5.2Simulation#2:TreatmentmechanismwithunequalmeanandvarianceUsingthesameDGPasconsideredinSection4.2,weevaluateeachoftheestimatorvariants,intermsofthethreeal-ternativemetricsdiscussedabove,across300simulationexperiments.TheirperformanceissummarizedinFigureS3.9JUNE29,20220.850.900.951.00100200500CI coverageCoverage of 95% oracle CIs of candidate IPW and DR estimators0.850.900.951.00100200500CI coverageCoverage of 95% Wald CIs of candidate IPW and DR estimators0.000.050.100.15100200500Sample sizeMean of EIF R2DR: CV global, GLMDR: CV global, HALDR: min |Pn D_CAR|, GLMDR: min |Pn D_CAR|, HALIPW: |Pn D_CAR| < tolIPW: CV globalIPW: min |Pn D_CAR|IPW: Plateau (hybrid)IPW: Plateau (Lepski)IPW: Plateau (smoothing)Mean of EIF R2 of candidate IPW and DR estimatorsFigureS3:AlternativenumericalcomparisonsofournonparametricIPWestimatorsandDRestimators.FigureS3revealsfairlygoodperformance,byn=200orn=500,fromalloftheestimatorvariantsconsidered.ExaminingﬁrstthecoverageoforacleCIs,alloftheDRestimatorsachievecoverageatthenominalrate,irrespectiveofsamplesize,indicatingunbiasednessoftheseestimators.TheIPWestimatorsachievecomparableperformancebyn=500,thoughtheyfareslightlyworseatn=100.IntermsofthecoverageofWald-styleCIs,alloftheIPWestimators,andhalfoftheDRestimators,achievecoverageatorverynearthenominalrateuniformlyacrossthethreesamplesizes.ThetwoDRestimatorsthatbasetheirtreatmentmechanismestimatoroncriterion(11)displaypoorercoverage,worsewhentheoutcomemechanismestimatorismisspeciﬁedbut(predictably)betterwhentheoutcomemechanismestimatorismodeledﬂexibly.Notably,alloftheundersmoothing-basedIPWestimatorsprovidereliablecoverage(atornearthenominalrate),indicatingtheirsimultaneousachievingnegligiblebiasandaccuratevariancees-timation.Cursoryexaminationoftheapproximatesecond-orderremainderR2revealsthatallbutthreeoftheestimatorvariantssucceedinsuccessfullyminimizingthismetric.AlloftheIPWestimatorsbasedonagnosticundersmooth-ingfallinthismajority.Aswiththeprecedingscenario,theDRestimatorsandtheundersmoothedIPWestimatorthatmakeuseofcriterion(11)fortreatmentmechanismestimationstruggletoapproppriatelyminimizethismetric,divergingwithgrowingsamplesize.Thisprovidesfurtherconﬁrmationofthenotionthatabsoluteminimizationof|PneDCAR(gn,A,λ,Qn,Y)|inducesacompromiseintermsofhigher-orderefﬁciency,asmeasuredbythisremaindertermintheEIFexpansion.Thismayproveafruitfulavenueforfuturetheoreticalandnumericalinvestigation.Over-all,theconclusionappearswell-supportedthatourproposedIPWestimatorsfarecomparably(well)tostandardDRcompetitorsintermsofbothinferentialbiasandhigher-ordercontributionstoasymptoticefﬁciency.Aswiththepreviousscenario,weexamineasinglenumericalexampleatsamplesizen=100todevelopsomedegreeofintuitiononthechoicesoftreatmentmechanismestimatormadebyeachoftheselectioncriteria.Here,wevisualizethetrajectoryoftheIPWestimatorsalongtheregularizationpathof3000presetvaluesofλ(ﬁxedacrossallofournumericalexperiments),limitingtheestimatorsdisplayedbytruncatingtheregularizationgridsoastobeginattheλnchosenbythe“global”CVselector.FigureS4depictsthetrajectorytakenbytheIPWestimatorsacrossthisregularizationgrid.10JUNE29,2022IPW: CV globalIPW: |Pn D_CAR| < tolIPW: min |Pn D_CAR|IPW: Plateau (Lepski)IPW: Plateau (smoothing)IPW: Plateau (hybrid)0.50.60.75.07.510.012.515.0-log(l)IPW estimate ynaaaaaaIPW: |Pn D_CAR| < tolIPW: CV globalIPW: min |Pn D_CAR|IPW: Plateau (hybrid)IPW: Plateau (Lepski)IPW: Plateau (smoothing)Regularization path of candidate IPW estimatorsFigureS4:SolutionpathinλofnonparametricIPWestimatorsinasinglenumericalexample.InFigureS4,thesixcandidateIPWestimatorsgeneratedbyeachoftheselectorsaredisplayed,andthe“global”CVselector’schoiceistheﬁrstinthesolutionpath;allstricterregularizationvaluesaretruncated.Thetruevalueofψ0,δ,approximatedinaverylargesample,isindicatedbyhorizontaldashedline.Althoughthisillustrationarisesonlyfromasinglenumericalexample,theIPWestimatorschosenbythevariousundersmoothingselectorscanbetakenassomewhatrepresentativeofthethedegreeofregularizationpreferredbyeach.Forexample,onenotices,aswiththepreviousexampledepictedinFigureS2,thatthetargetedundersmoothingselectorbasedoncriterion(11)prefersthemostrelaxed(leastextreme)degreeofregularization;furthermore,oneshouldnotethattheagnosticundersmoothingselectorsappeartoallreliablychoosethepeakalongthetrajectoryofIPWestimators,whichcorrespondstothepointestimateclosesttothetruevalueofψ0,δ,illustratingthedebiasinginducedbytheseundersmoothingselectors.11JUNE29,2022ReferencesBENKESER,D.&VANDERLAAN,M.J.(2016).Thehighlyadaptivelassoestimator.In2016IEEEInternationalConferenceonDataScienceandAdvancedAnalytics(DSAA).IEEE.BIBAUT,A.F.&VANDERLAAN,M.J.(2019).Fastratesforempiricalriskminimizationwithcadlaglosseswithboundedsectionalvariationnorm.arXivpreprintarXiv:1907.09244.BICKEL,P.J.,KLAASSEN,C.A.,RITOV,Y.&WELLNER,J.A.(1993).EfﬁcientandAdaptiveEstimationforSemiparametricModels.JohnsHopkinsUniversityPress.BREIMAN,L.(1996).Stackedregressions.MachineLearning24,49–64.COYLE,J.R.,HEJAZI,N.S.,PHILLIPS,R.V.,VANDERLAAN,L.W.&VANDERLAAN,M.J.(2022).hal9001:Thescalablehighlyadaptivelasso.Rpackageversion0.4.3.FRIEDMAN,J.,HASTIE,T.&TIBSHIRANI,R.(2009).glmnet:Lassoandelastic-netregularizedgeneralizedlinearmodels.Rpackageversion1.HANEUSE,S.&ROTNITZKY,A.(2013).Estimationoftheeffectofinterventionsthatmodifythereceivedtreatment.StatisticsinMedicine32,5260–5277.HEJAZI,N.S.&BENKESER,D.C.(2020).txshift:Efﬁcientestimationofthecausaleffectsofstochasticinterven-tionsinR.JournalofOpenSourceSoftware5,2447.HEJAZI,N.S.&BENKESER,D.C.(2022).txshift:Efﬁcientestimationofthecausaleffectsofstochasticinter-ventions.Rpackageversion0.3.8.HEJAZI,N.S.,COYLE,J.R.&VANDERLAAN,M.J.(2020).hal9001:ScalablehighlyadaptivelassoregressioninR.JournalofOpenSourceSoftware5,2526.PFANZAGL,J.&WEFELMEYER,W.(1985).Contributionstoageneralasymptoticstatisticaltheory.Statistics&RiskModeling3,379–388.ROBINS,J.M.,ROTNITZKY,A.&ZHAO,L.P.(1994).Estimationofregressioncoefﬁcientswhensomeregressorsarenotalwaysobserved.JournaloftheAmericanStatisticalAssociation89,846–866.RYTGAARD,H.C.,GERDS,T.A.&VANDERLAAN,M.J.(2022).Continuous-timetargetedminimumloss-basedestimationofintervention-speciﬁcmeanoutcomes.AnnalsofStatistics(forthcoming).VANDERLAAN,M.J.(2017).Agenerallyefﬁcienttargetedminimumlossbasedestimatorbasedonthehighlyadaptivelasso.InternationalJournalofBiostatistics13.VANDERLAAN,M.J.,POLLEY,E.C.&HUBBARD,A.E.(2007).SuperLearner.StatisticalApplicationsinGeneticsandMolecularBiology6.VANDERLAAN,M.J.&ROSE,S.(2011).TargetedLearning:CausalInferenceforObservationalandExperimentalData.Springer.VANDERLAAN,M.J.&RUBIN,D.(2006).Targetedmaximumlikelihoodlearning.InternationalJournalofBiostatistics2.12