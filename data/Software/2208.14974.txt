2
2
0
2

g
u
A
1
3

]

A
G
.
h
p
-
o
r
t
s
a
[

1
v
4
7
9
4
1
.
8
0
2
2
:
v
i
X
r
a

MNRAS 000, 1–20 (2022)

Preprint 1 September 2022

Compiled using MNRAS LATEX style ﬁle v3.0

Full spectrum ﬁtting with photometry in ppxf: non-parametric star
formation history, metallicity and the quenching boundary from 3200
LEGA-C galaxies at redshift z ≈ 0.8

Michele Cappellari(cid:63)
Sub-Department of Astrophysics, Department of Physics, University of Oxford, Denys Wilkinson Building, Keble Road, Oxford, OX1 3RH, UK

Submitted to MNRAS on 31 August 2022

ABSTRACT
I start by describing some updates to the ppxf method, which has been used to measure stellar and gas kinematics as well as
the formation history (SFH) and chemical composition of galaxies. I outline the novel linearly-constrained least-squares opti-
mization algorithm used by ppxf and I illustrate the changes I made to be able to include photometric measurements together
with full-spectrum ﬁtting in ppxf. Then I present an application of the revised ppxf method to the study of the non-parametric
SFH and metallicity [M/H] of a sample of 3200 galaxies at redshift 0.6 < z < 1 (median z = 0.76), complete above a stellar
mass M∗ >
∼ 3 × 1010 M(cid:12), with spectroscopy from the LEGA-C survey and 28-bands photometry from two alternative catalogues.
I extract and compare the stellar population using three independent stellar population synthesis (SPS) methods and both pho-
tometric catalogues. I ﬁnd robust trends in the global light-weighted ages and [M/H] consistent and of similar quality as those
from nearby galaxy surveys, with the well-known main dependence on the galaxies’ stellar velocity dispersion σ∗ (or alter-
native measures of central density). The recovered SFH indicate a sharp and strikingly clear boundary from star formation to
quenching at lg(σ∗/km s−1) ≈ 2.3, similar to what is invoked by some models. Equally clear quenching boundaries are seen at
[M/H] ≈ −0.1 and for a Sersic index lg nSer ≈ 0.5. Results are consistent with two SPS methods and both photometric cata-
logues, but the third SPS method displays signiﬁcant diﬀerences, highlighting the importance of comparing model assumptions.
The ppxf software is available from https://pypi.org/project/ppxf/.

Key words: galaxies: evolution – galaxies: formation – galaxies: high-redshift – software: data analysis – techniques: photo-
metric – techniques: spectroscopic

1 INTRODUCTION

The study of the stellar population of galaxies is an essential tool
when trying to uncover how they have assembled. For this reason,
a vast number of papers have tried to infer the galaxies’ star for-
mation history (SFH) and chemical composition from observations.
The earliest results were based on simple galaxy colours as these
were easier to obtain (see e.g. the lectures by Baade 1963). How-
ever, galaxy colours alone cannot strongly constrain both the galax-
ies’ chemical composition and star formation histories. Inferences
from galaxy photometry alone are strongly aﬀected for example by
the age-metallicity (e.g. Worthey 1994) as well as by the SFH-dust
degeneracies (e.g. Silva et al. 1998; Devriendt et al. 1999; Pozzetti
& Mannucci 2000). For this reason, most of our knowledge on both
the star formation and chemical composition of galaxies has been
obtained from the numerous absorption features in their spectra.

1.1 Full spectrum ﬁtting of nearby galaxies

Over the past two decades, libraries of high-resolution (R >
∼ 2000)
empirical stellar spectra were observed, which try to optimally sam-

ple all stages of stellar evolution. Prominent examples in the op-
tical region include the STELIB (Le Borgne et al. 2003), ELODIE
(Prugniel & Soubiran 2001), MILES (S´anchez-Bl´azquez et al. 2006;
Falc´on-Barroso et al. 2011) and recently the MaStar (Yan et al. 2019)
stellar libraries. An exception is the the X-Shooter spectral library
(XSL), which reaches R ≈ 10000 and extends up to 2.5 µm (Chen
et al. 2014; Verro et al. 2022a).

Stellar population synthesis SPS models based on empirical stel-
lar spectra have been developed that can produce synthetic galaxy
spectra at high resolution. Examples of these kind of models are
the galaxev (Bruzual & Charlot 2003), the Vazdekis (Vazdekis et al.
2010, 2015), the fsps (Conroy et al. 2009; Conroy & Gunn 2010), the
Maraston (Maraston 2005; Maraston & Str¨omb¨ack 2011; Maraston
et al. 2020) and most recently the XSL models (Verro et al. 2022b).
Most current SPS models complement empirical stellar spectra with
fully synthetic ones like BaSeL (Westera et al. 2002) or MARCS
(Gustafsson et al. 2008). This allows one to cover stages of stellar
evolution not well sampled by observations and also can extend the
wavelength coverage, especially to the ultraviolet and infrared re-
gions which are poorly covered by observations. Fully synthetic SPS
were also developed like bpass (Stanway & Eldridge 2018; Byrne
et al. 2022) or the MARCS version of the Maraston models.

(cid:63) E-mail: michele.cappellari@physics.ox.ac.uk

Initially, large spectroscopic studies of the stellar population in

© 2022 The Authors

 
 
 
 
 
 
2 M. Cappellari

nearby galaxies were based on line indices of speciﬁc absorption
features, generally using the LICK system (e.g. Worthey et al. 1994).
But the availability of good-quality high-resolution SPS models (see
review by Conroy 2013) motivated a shift to using full-spectrum ﬁt-
ting (see review by Walcher et al. 2011). Various templates-ﬁtting
methods were developed for this task, like ppxf (Cappellari & Em-
sellem 2004; Cappellari 2017), starlight (Cid Fernandes et al.
2005), stecmap (Ocvirk et al. 2006), vespa (Tojeiro et al. 2007),
fit3D (S´anchez et al. 2016; Lacerda et al. 2022) and firefly (Wilkin-
son et al. 2017). These methods and software were extensively used
e.g. to analyse the millions of spectra produced by integral-ﬁeld
spectroscopic surveys in the local Universe like ATLAS3D (Cappel-
lari et al. 2011), CALIFA (S´anchez et al. 2012), SAMI (Bryant et al.
2015) and MaNGA (Bundy et al. 2015).

1.2 Spectral ﬁtting of high-z galaxies

At signiﬁcant redshift (e.g. z >
∼ 1) the cosmological surface bright-
ness dimming (e.g. Hogg 1999) makes good-quality spectra more
diﬃcult to obtain as the contribution of the sky background starts to
dominate. ppxf was used to measure the kinematic and stellar popu-
lation of signiﬁcant samples of galaxies at redshift z ≈ 1 (e.g. Shetty
& Cappellari 2015; Bezanson et al. 2018) but only of individual ob-
jects out to z ≈ 2 (e.g. van de Sande et al. 2013; Belli et al. 2014,
2017) and z ≈ 3 (e.g. Esdaile et al. 2021; Forrest et al. 2022). Most
large studies of distant galaxies still had to rely on photometry alone.
The most essential parameters one wants to extract from high-z
galaxies are their redshift and stellar mass (e.g. Muzzin et al. 2013;
Weaver et al. 2022). Various template-ﬁtting codes were developed
to measure masses and redshift from photometric observations in
multiple bands (I ignore here methods based on machine learning;
see Salvato et al. 2019 for a review). These include Hyperz (Bol-
zonella et al. 2000), bpz (Ben´ıtez 2000), LePhare (Arnouts et al.
2002), zebra (Feldmann et al. 2006) and eazy (Brammer et al. 2008).
These methods are conceptually similar to the template-based spec-
tral ﬁtting ones used for nearby galaxies, however, they all adopt a
Bayesian approach, instead of a least-square ﬁtting one. This makes
the codes simpler and allows for easy inclusion of priors on galaxy
parameters or non-Gaussian uncertainties; e.g. one can assign a
low probability to solutions where the galaxy has an unphysically
large/small stellar mass.

Some of the photometric-redshift methods were subsequently ex-
tended and new software were developed to ﬁt spectra together with
the photometry, while still retaining the same Bayesian approach.
Examples of these are fast (Kriek et al. 2009), beagle (Chevallard &
Charlot 2016), bagpipes (Carnall et al. 2018), the code described by
Mendel et al. (2020) and prospector (Johnson et al. 2021b).

Contrary to what is sometimes stated, both least-squares, or
maximum-likelihood, and Bayesian methods can return model pos-
teriors, when needed. The former uses bootstrapping (e.g. Efron &
Tibshirani 1994) or Monte Carlo approaches. In fact, bootstrapping
can be seen as an eﬃcient way to compute the Bayesian poste-
rior, with non-informative priors (e.g. Rubin 1981; Efron 2011). Al-
though bootstrapping is less ﬂexible than general Bayesian methods,
in many realistic situations, the uncertainties of model parameters
are dominated by data systematic and model assumptions (as I also
ﬁnd later) rather than the details of the adopted statistical approach
or by adopted priors.

MNRAS 000, 1–20 (2022)

1.3 This paper

In this paper, I proceed in a diﬀerent way than existing methods. In-
stead of adopting the standard Bayesian approach to ﬁt photometry
and spectra, I present an extension of a least-squares full-spectrum
ﬁtting method to simultaneously ﬁt photometry. I do this using my
ppxf code. A key diﬀerence of this approach is that it can be a few
orders of magnitude faster than Bayesian methods. The method ap-
pears complementary to existing ones as the extra speed allows for
extra ﬂexibility in the treatment of the stellar population, as shown
later.

I illustrate the characteristics of the approach by ﬁtting the
VIMOS spectra and COSMOS photometry (Muzzin et al. 2013;
Weaver et al. 2022) to study the joint SFH - metallicity distributions
and the stellar population scaling relations of about 3200 galaxies
from the LEGA-C survey (van der Wel et al. 2021) in the redshift
range z = 0.6 – 1.

Readers interested in the ppxf techniques should keep reading how
to measure velocities in Section 2 and the ppxf updates in Section 3.
While those only interested in the scientiﬁc results should skip the
next two sections and go directly to the description of the data in
Section 4 and results in Section 6. In this work I adopt a standard
cosmology with H0 = 70 km s−1Mpc−1, Ωm = 0.3 and ΩΛ = 0.7.

2 MEASURING VELOCITY AND REDSHIFT

In Cappellari (2017, sec. 2) I reviewed general and important facts
that one should know before using any full spectral ﬁtting method
and ppxf in particular. Here I include only some updates, and I heav-
ily refer the reader to my previous paper of this series to avoid du-
plicating material.

2.1 From measured velocity to observed redshift

The physical meaning of the velocity V returned by ppxf or any spec-
trum ﬁtting code is often a source of confusion. As discussed in Cap-
pellari (2017, sec. 2.3), the reason for this is that V has no physical
meaning. Even the recession velocity itself, for a distant galaxy, is an
ill-deﬁned concept with a debated interpretation (e.g. Bunn & Hogg
2009). It should never be used for quantitative work. What is well
deﬁned empirically is the redshift z of a given spectrum:

1 + z ≡

λobsv
λemit

,

(1)

where λobsv and λemit are the observed and rest-frame wavelength of
a given spectral feature. The key formula that is needed to convert
the Vppxf returned by ppxf into redshift is eq. (8) of Cappellari (2017)

Vppxf ≡ c ln(1 + z),

(2)

with c the speed of light. This formula is exact by construction and
it is the only one that should be used to attach a physical meaning to
Vppxf.

2.2 Separating peculiar velocities and cosmological redshift

When observing spectra of distant galaxies from a single aper-
ture, redshift is all one can measure. However, when obtaining
spatially-resolved observations of galaxies e.g. using integral-ﬁeld
spectroscopy (see review by Cappellari 2016) one needs to separate
the cosmological redshift zcosm, which only contains information on

ppxf with spectra and photometry at redshift z ≈ 0.8

3

the galaxy distance, from the peculiar velocity Vpec. The latter is the
one which satisﬁes e.g. Newton’s law of gravitation in a reference
system that moves with the galaxy barycentre. It is the velocity that
has to be used to construct dynamical models of the galaxy.

In Cappellari (2017, sec. 2.4) I suggested using the standard way
of separating peculiar and cosmological redshift. However, there is
a simpler and formally even more accurate way. In fact, the conver-
sion of Vppxf into redshift is unnecessary (see Baldry 2018). One can
directly obtain Vpec using the velocities returned by ppxf as follows
Vpec(x, y) = Vppxf(x, y) − Vppxf(bary).
Here Vppxf(x, y) is the velocity returned by ppxf at the location (x, y)
on the sky, Vppxf(bary) is the velocity returned by ppxf for the galaxy
(or cluster) barycentre and Vpec(x, y) is the peculiar velocity at loca-
tion (x, y). The latter is the only one with a clear physical meaning:
it is the one to use in a dynamical model (e.g. Cappellari 2008), or to
estimate the level of rotation in a galaxy (e.g. Emsellem et al. 2011).
Importantly, equation (3) is always valid, regardless of whether the
spectrum was de-redshifted to the rest-frame or not, before measur-
ing Vppxf. Note that this formula only works because of the way ppxf
deﬁnes the relation between velocity and redshift in equation (2) and
cannot be used with alternative deﬁnitions (e.g. V ≡ cz).

(3)

As an example of a practical application of these formulas, let’s
assume I am ﬁtting a single spectrum of a high-z galaxy for which I
have an estimate of the redshift z(cid:48) (e.g. from photometry). It is gen-
erally convenient to de-redshift the spectrum by dividing each ob-
served wavelength λobs to obtain an estimate of the rest-frame wave-
length with
= λobs

(4)

λ(cid:48)
rest

(1 + z(cid:48))

I then ﬁt the spectrum with ppxf to obtain Vppxf. If the initial guess
z(cid:48) was perfect, I would obtain Vppxf = 0, but in general I will mea-
sure Vppxf (cid:44) 0, with uncertainty ∆Vppxf. An improved estimate of the
galaxy redshift z and its uncertainty ∆z can be obtained using equa-
tion (2) and equation (3) as

V (cid:48) = c ln(1 + z(cid:48)),
Vtot = Vppxf + V (cid:48)
(cid:18) Vtot
c

1 + z = exp

(cid:19)

= (1 + z(cid:48)) exp

(cid:18) Vppxf
c

(cid:19)

(5a)

(5b)

(5c)

.

∆Vppxf
c

≈ ∆ ln(1 + z) ≈

∆z
1 + z
Identical results are obtained without ﬁrst bringing the spectrum to
the restframe and setting z(cid:48) = 0 in equation (5). But one should re-
member to adjust the instrumental resolution as described in sec. 2.4
of Cappellari (2017).

(5d)

3 UPDATES TO THE ppxf PACKAGE

I gave a detailed overview of the ppxf method in Cappellari (2017,
sec. 3). I will not repeat that overview here, but instead, I will refer
the reader to speciﬁc sections of that paper, while trying to keep a
consistent notation. However, I substantially evolved ppxf since then,
driven by the needs of my research and requests from colleagues. I
only describe here the ppxf features that have changed. The descrip-
tion corresponds to the current version 8.2 of the public ppxf Python
package1.

3.1 Well-sampled variable-σ convolution

As discussed in Cappellari (2017, sec. 2.2), when ﬁtting stellar tem-
plates to galaxy spectra, one generally needs to convolve the tem-
plates with a Gaussian having a dispersion σ that varies with wave-
length λ. In a previous version of ppxf, I implemented this step as a
direct summation of the spectrum, weighted by the Gaussian centred
on every pixel (function ppxf util.gaussian filter1d in ppxf).
Given that the Gaussian is typical nonzero only over ngau ∼ 10 pix-
els, while the templates have npix >
∼ 1000 spectral pixels, I limited the
summation only to the nonzero pixels of the Gaussian kernel. In this
way, the computation time of this summation scales as t ∝ npix ×ngau,
which is comparable to that t ∝ npix × ln(npix) achievable using
Fourier convolution using the Fast Fourier Transform (FFT, Cooley
& Tukey 1965).

A limitation of performing a convolution as a summation is that,
when the σ of the Gaussian becomes comparable to the size of
the sampled pixels, the convolution suﬀers from the same under-
sampling problems that motivated the use of an analytic Fourier
Transform for the convolution in ppxf discussed in Cappellari
(2017). For this reason, I now implemented an alternative procedure
ppxf util.varsmooth which performs the variable-σ convolution
using the FFT and uses the same approach of ppxf of using an ana-
lytic Fourier Transform of the kernel, to avoid undersampling issues.
A natural idea to use the FFT for convolution of a vector of val-
ues with a kernel with variable scale is to stretch the coordinate with
the inverse of the scale, via interpolation, in such a way that the
kernel has the same scale in the new coordinates. This idea was dis-
cusses e.g. in 2014 on StackOverﬂow2 and implemented in 2016 by
Janez Kos on GitHub3 in the procedure varconvolve. It was also
discussed in Johnson et al. (2021b). The interpolation approach is
also central for algorithms for the Non-Uniform FFT (NUFFT, e.g.
Greengard & Lee 2004). Here I combine the interpolation approach
with the use of an analytic Fourier Transform as in Cappellari (2017)
to produce Algorithm 1. The algorithm can also be used with a non-
Gaussian kernel (e.g. Cappellari 2017, eq. 38) as long as only its
scale changes with wavelength.

Algorithm 1 varsmooth: well-sampled variable-σ convolution

j=1(σmax/σ j)

Given x, y, σx, xout
σ = σx/∇x
σmax = max(σ) × m
for k = 1, p do
sk = (cid:80)k
n = ceil(sp − s1)
xnew = subdivide(s1, sp, n)
ynew = interpolate(s, y)(xnew)
F (gauss) = exp(−σ2
maxω2/2)/
yconv = F −1[F (ynew)F (gauss)]
if xout is given then

s = interpolate(x, s)(xout)
yconv = interpolate(xnew, yconv)(s)

√

(cid:46) len(x) = len(y) = len(σx) = p
(cid:46) σ in pixels
(cid:46) Optional m = oversampling

(cid:46) σ is constant in s coordinates

(cid:46) Ensures σ > m in new pixels
(cid:46) n equispaced values

2π

(cid:46) Gaussian Analytic FT
(cid:46) Convolution theorem & FFT

This algorithm works well in practice, but one should be aware of
its theoretical limitations. In fact, most interpolation methods can be
described as a convolution with a speciﬁc kernel (e.g. Getreuer 2011)
and one may think it would be better to remove the eﬀect of this ex-
tra convolution as done e.g. in the NUFFT methods. However, this

1 Available from https://pypi.org/project/ppxf/

2 https://stackoverﬂow.com/a/24186800
3 https://github.com/sheliak/varconvolve

MNRAS 000, 1–20 (2022)

4 M. Cappellari

situation is diﬀerent as the spectra have noise and one would have
to perform the interpolation in a Bayesian framework (e.g. MacKay
1992, 2003). One should also consider that the spectra to ﬁt gener-
ally already include additional interpolation and resampling, which
would have to be modelled for rigorous results. But all this is un-
likely to aﬀect scientiﬁc results, and for this reason, is beyond the
scope of this paper.

3.2 CapFit nonlinear least-squares with linear constraints

3.2.1 The problem

When ﬁtting the kinematics of multiple kinematics components with
ppxf, both for the stellar and gas emission components, it is often
useful to be able to set constraints on some parameters as a function
of other parameters. For example, when looking for spectra con-
taining both narrow and broad gas emission lines to study Active
Galactic Nuclei (e.g. Oh et al. 2015), one may want to constrain
the dispersion σbroad of the broad emission component, if present, to
be signiﬁcantly larger than that σnarrow of the narrow one, to avoid
the degeneracy of ﬁtting two similar lines. Or one may want to set
the constraint σbroad > σnarrow + ∆σ, or as a fractional diﬀerence
σbroad > f × σnarrow. Or one may want to constrain the velocity of a
possible broad emission component not to diﬀer more than a certain
value from that of the narrow one |Vbroad − Vnarrow| < ∆V. Eﬃciently
setting this kind of constraint requires solving a constrained non-
linear optimization problem.

For maximum computational eﬃciency and accuracy, one should
exploit the special problem that ppxf has to solve (Cappellari 2017,
sec. 3.4). In particular, the function to minimize f (x) is a sum of
squares and the typical constraints are linear. The problem to solve
can be expressed as

f (x) = (cid:107)r(x)(cid:107)2

minimize
subject to Aeq · x = beq

Aineq · x ≤ bineq.

(6)

I have searched extensively for a specialized algorithm that I could
easily use in ppxf to eﬃciently solve this speciﬁc problem but did
not ﬁnd any. For this reason, I developed my own.

One of the most eﬀective ways of solving nonlinear problems with
general constraints is the sequential quadratic programming (SQP)
method, where at every iteration the algorithm solves a constrained
quadratic problem that approximates the function at the current lo-
cation (e.g. Nocedal & Wright 2006, chap. 18).

In least-squares problems, one can approximate to second order
the function near the current point xk, with p = x − xk (e.g. Nocedal
& Wright 2006, sec. 10.2) as

f (x) ≈ (cid:107)Jk · p + rk(cid:107)2
= p · (JT
k · Jk) · p + 2p · (JT
≈ p · ∇2 f (x) · p + 2p · ∇ f (x) + (cid:107)rk(cid:107)2 ,

k · rk) + (cid:107)rk(cid:107)2 ,

(7a)

(7b)

(7c)

where Jk is the Jacobian, which can be computed by ﬁnite diﬀer-
ences, ∇ f (x) = JT
k · Jk is the
quasi-Newton approximation of the Hessian, whose full form is the
following, but I ignored the second term (e.g. Nocedal & Wright
2006, eq. 10.5)

k · rk is the gradient and ∇2 f (x) = JT

∇2 f (x) = JT · J +

m(cid:88)

j=1

r j∇2r j.

(8)

proximate the Hessian “for free” using J and the reason it is im-
portant to adopt specialized methods for their solution. In the case
of ppxf, the Hessian approximation is always especially good, even
far from the solution, because the algorithm separates the linear and
nonlinear optimization of the templates (sec. 3.3–3.4 of Cappellari
2017) and ensures that (cid:80)
j r j = 0 at every step. This tends to cancel
out the second term in the Hessian of equation (8).

In essence, a specialized SQP algorithm to solve equation (6)
would consist of solving a sequence of quadratic sub-problems as
follows

minimize g(p) = (cid:107)Jk · p + rk(cid:107)2
subject to Aeq · x = beq

Aineq · x ≤ bineq.

(9)

Algorithms for this type of problem are discussed e.g. by Fletcher
(1987, sec. 11.2) or Gill et al. (1981, chapter 5). I implemented those
ideas into a trust-region algorithm (Nocedal & Wright 2006, chap. 4)
but I discovered that the approach is not suﬃciently robust for my
rather special situation.

The diﬃculty of the optimization problem I have to solve consists
of the fact that the Jacobian can sometimes be completely degener-
ate. A common situation where this happens is when ppxf is ﬁtting
for the kinematics of emission lines or multiple stellar kinematic
components. In this situation, the weights associated with a given
emission line or stellar component may become exactly zero, be-
cause the line or component is simply not present in a certain galaxy
spectrum. In other cases, the signal-to-noise ratio S /N may be too
low to give any constraints to some parameters. In these cases, the
gradient (column of J) with respect to the parameters describing the
kinematics of the missing component will be zero.

I tried using the Singular Value Decomposition (SVD, e.g. Press
et al. 2007, sec. 15.4.2) during the iterations required to solve the
quadratic sub-problem. But after extensive testing, e.g. during the
development of the MaNGA Data Analysis Pipeline (Westfall et al.
2019), I was unable to ﬁnd a robust criterion to decide which singular
values must be edited and ﬁnd the eﬀective rank of my Jacobian.

3.2.2 The solution

To solve unconstrained least-squares optimization problems one of
the most widely used techniques is the Levenberg-Marquardt (LM)
method (Levenberg 1944; Marquardt 1963) and its state-of-the-art
implementation in minpack (Mor´e 1978; Mor´e et al. 1980). The suc-
cess of the LM method comes from the fact that the method penal-
izes the J matrix deﬁning the quadratic sub-problem in an adaptive
fashion, in such a way that it always prevents degeneracy. This also
makes the LM method a robust trust-region algorithms, as discussed
in Fletcher (1987, sec. 5.2) or Nocedal & Wright (2006, sec. 10.3).
Press et al. (2007, sec. 15.5.2) provides a less technical description.
In a previous version of ppxf, I used the LM algorithm, as mod-
iﬁed in the mpfit implementation by Markwardt (2009), which
included a very useful but non-optimal treatment of box con-
straints (i.e. upper/lower limits on the parameters). Comparable
box-constrained least-squares methods exist
in Scipy (Virtanen
et al. 2020) as implemented in the trust-region reﬂective algo-
rithm (method=‘trf‘; Branch et al. 1999) and the dogleg
algorithm (method=‘dogbox‘, Voglis & Lagaris 2004, Nocedal
& Wright 2006, chapter 4) in scipy.optimize.least squares.
These methods are available in ppxf but cannot support linear con-
straints.

It is a characteristic of least-squares problems that one can ap-

After extensive experimentation with real-world cases, I imple-

MNRAS 000, 1–20 (2022)

ppxf with spectra and photometry at redshift z ≈ 0.8

5

constrained, the algorithm uses the standard trust-region framework
(e.g. Nocedal & Wright 2006, algorithm 4.1, or Fletcher 1987, algo-
rithm 5.2.7). For the convergence criteria, I follow the description in
Mor´e et al. (1980, sec. 2.3).

3.2.3 Solving the quadratic sub-problem

I implemented two procedures to solve the quadratic programming
sub-problem of equation (10). In both cases, I avoid explicitly con-
structing the Hessian JT
k · Jk as this would degrade the condition-
ing of the system. The ﬁrst procedure (lsq box) is specialized for
the common situation where only box constraints are present. It
solves min (cid:107)A · x − b(cid:107)2 with lb < x < ub. For this, I use the active-
set method adopted in the non-negative least-squares (nnsl) method
(Lawson & Hanson 1995, algorithm 23.10), which was generalized
for box constraints with the Bounded-Variables Least-Squares (bvls)
procedure in the same book and in Stark & Parker (1995). My imple-
mentation closely follows Lawson & Hanson (1995) except for the
important fact that (i) I allow for a starting guess and (ii) I include an
initialization step (Algorithm 3) which generalizes to the box con-
strained case the initialization loop in the fastnnls code4 by Anders-
son & Bro (2000). In realistic ppxf problems, using my new lsq box
with hundreds of spectral templates produced a typical speedup of a
factor four compared to using the scipy.optimize.nnls, which
is a wrapper to the Lawson & Hanson (1995) Fortran code. The
procedure scipy.optimize.lsq linear currently also does not
support passing a starting guess.

Algorithm 3 Initializiation lsq box box-constrained least-squares

Given x, lower lb and upper ub bounds, B (cid:44) ∅
while B (cid:44) ∅ do

B = {x | (x < lb) ∨ (ub < x)}
Set all x ∈ B to the nearest bound
F = {x | lb < x < ub}
x(cid:48) = min (cid:107)A · x − b(cid:107)2 for x ∈ F
Set x = x(cid:48) for x ∈ F

solves general

The second procedure (lsq lin)

linearly-
constrained quadratic programming problems like in equation (9)
using a modiﬁed version of the standard active-set technique de-
scribed by Nocedal & Wright (2006, algorithm 16.3). The approach
consists of solving a sequence of equality-constrained linear least-
squares problems, for which I follow Golub (2013, algorithm 6.2.2),
allowing for degenerate matrices using SVD. If the initial guess is
unfeasible, I ﬁnd a feasible point using the linear programming pro-
cedure scipy.optimize.linprog and the method=’highs’ by
Huangfu & Hall (2017). Alternatively, the quadratic sub-problem
can be solved within ppxf by minimizing the quadratic function in
the form of equation (7b) using a general interior-point quadratic
programming solver within the cvxopt package5 by Andersen et al.
(2011). The latter is much faster for large-scale problems. I have ex-
tensively tested the lsq box and lsq lin procedure described in
this section by constructing batteries of tests using both exact ana-
lytic solutions and comparisons against cvxopt.

mented a novel hybrid between the SCP and LM methods, spe-
cialized for the nonlinear least-squares with linear constraints (both
equality and inequality). The algorithm consists of a trust-region
quasi-Newton SCP method, with linear constraints, in which the ma-
trix deﬁning the quadratic sub-problem is penalized to avoid the risk
of degeneracy, as in the LM method. I achieve this by replacing the
quadratic sub-problem of equation (9) with the following (see No-
cedal & Wright 2006, eq. 10.41)
(cid:33)

(cid:32)

(cid:32)

2

minimize

g(p) =

(cid:13)(cid:13)(cid:13)(cid:13)(cid:13)(cid:13)

Jk√
λk Dk

· p +

(cid:33)(cid:13)(cid:13)(cid:13)(cid:13)(cid:13)(cid:13)

rk
0

subject to Aeq · x = beq

Aineq · x ≤ bineq,

(10)

where Dk is a diagonal matrix, which makes the problem scale in-
variant. By default, the diagonal elements of Dk are initialized with
the norm (cid:107)·(cid:107) of the columns of J and is updated during the iterations
as suggested in Mor´e (1978, eq. 6.3). Close to the solution, when
the quadratic model provides a good approximation of f (x), then λk
becomes small and equation (10) approximates equation (9). In this
limit, the method behaves as an SCP method. When the quadratic
approximation is inaccurate, λk becomes large and the method be-
haves as a trust-region LM method.

My resulting algorithm is rather simple because I did not worry
about the eﬃciency of the solution of the quadratic programming
sub-problem. The latter generally dominates the complexity of other
state-of-the-art algorithms, which devise approximated matrix up-
dates to save computation time (e.g. see the description of LM in
Mor´e 1978). I also did not try to deal with large-scale problems and
sparse matrices which also increase complexity and require special-
ized methods (e.g Gill et al. 2005). Instead, I focused on the ﬁtting of
rather small nonlinear problems (n <
∼ 50 variables) in which comput-
ing the function f (x) involves creating a complex model, as in ppxf.
In this rather common situation, the time to solve the small quadratic
programming sub-problem becomes negligible compared to that of
evaluating f (x). The solution is given in Algorithm 2, which I im-
plemented in the capfit procedure in the ppxf package.

Algorithm 2 CapFit: linearly constrained least-squares trust region

Given x1, λ > 0, η ∈ [0, 1/4)
r1 = f (x1)
J = J(x1)
Compute the scaling matrix D
loop

(cid:46) See text

Obtain p as solution of equation (10) with J, D, r1, λ
x2 = x1 + p
r2 = f (x2)
ract = χ2(r1) − χ2(r2)
rpre = χ2(r1) − χ2(J · p + r1)
ρ = ract/rpre
if convergence test is satisﬁed then

(cid:46) Actual vs predicted reduction

(cid:46) Using χ2(x) ≡ x · x

stop with solution x2

if ρ < 1/4 then
λ = 4λ

else if ρ > 3/4 then

λ = λ/2
if ρ > η then
J = J(x2)
Adjust the scaling matrix D
x1, r1 = x2, r2

(cid:46) Successful step: move on

(cid:46) See text

The capfit procedure has been the default nonlinear optimiza-
tion algorithm in ppxf for about three years and has been used as a
general optimizer independently of ppxf too. During this time ppxf
was used to ﬁt millions of spectra from a variety of surveys (e.g.

Except for the fact that the quadratic sub-problem is linearly-

4 Available from http://www.models.kvl.dk/nwaytoolbox
5 Available from https://cvxopt.org/

MNRAS 000, 1–20 (2022)

6 M. Cappellari

MaNGA Bundy et al. 2015 and SAMI Bryant et al. 2015). This al-
lows me to ﬁx its handling of rare failures in degenerate situations,
which are diﬃcult to encounter in idealized examples. When applied
to unconstrained least-squares problems capfit produces essen-
tially the same iterates as the state-of-the-art LM implementations
in minpack or mpfit, as expected. When used for box-constrained
least-squares problems capfit is generally at least as eﬃcient as
the best algorithms in scipy.optimize.least squares. How-
ever, capfit allows for the extra ﬂexibility of using linear con-
straints, as well as for keeping variables tied to others or ﬁxed.

3.3 Setting linear constraints on the template weights

In the previous section, I discussed the use of linear constraints on
the kinematic parameters during the ppxf ﬁt. Here I note that lin-
ear constraints can be used also during the linear-ﬁtting procedure
in Cappellari (2017, sec. 3.3). These were used for example to con-
strain the sum of weights (e.g. the luminosity) of diﬀerent template
groups to constitute a certain fraction of the total light, e.g. to per-
form kinematic bulge/disks decompositions (e.g. Tabor et al. 2017,
2019; Oh et al. 2020) or to study stellar population of diﬀerent kine-
matic components (e.g. Shetty et al. 2020).

3.4 Multi-dimensional regularization

Considering without loss of generality that stellar population de-
pends only on age, the fundamental equation used to model the spec-
trum of a composite stellar population is (e.g. Cid Fernandes et al.
2005; Ocvirk et al. 2006; Conroy 2013, sec. 2.3)

Gmod(λ) =

(cid:90) t=T

t=0

SSPλ(t, Z) · SFR(T − t) dt,

(11)

where SFR is the star formation rate, SSPλ is a Single Stellar Popula-
tion spectrum per unit mass, with age t and metallicity Z, while T is
the age of the Universe at the redshift of the galaxy. This expression
is generalized in ppxf to study the distribution of more parameters,
like e.g. metallicity, α enhancement or IMF, in addition to the SFR.
I pointed out in Cappellari (2017, sec. 3.5) that equation (11) is
an inhomogeneous Fredholm equation of the ﬁrst kind, with kernel
SSPλ. And the recovery of the SFR(t) from the observed Gmod is a
textbook example of ill-conditioned inverse problem (e.g. Hansen
1998; Kabanikhin 2011; Press et al. 2007, sec. 19.0). This means
that one cannot ﬁnd a unique solution from real data without further
assumptions.

In Cappellari (2017, sec. 3.5) I discussed the implementation of
linear regularization (e.g. Press et al. 2007, sec. 19.5) in ppxf to
address this issue and study the stellar population in galaxies. I
gave a formula for the second-order one-dimensional regularization.
Given that there are alternative ways of generalizing a measure of
smoothness of a function in dimension larger than one (e.g. Brady
& Horn 1983), I clarify here that the second-order regularization
(reg ord=2) in ppxf minimizes the total squared Laplacian (∆w)2
of the weights w distribution, while the ﬁrst-order one (reg ord=1)
minimizes the total squared gradient (∇w)2. Both operators are im-
plemented by standard ﬁnite diﬀerences.

Press et al. (2007, 19.4.1) point out that, under some sensible con-
ditions, the regularized solution has a simple Bayesian interpreta-
tion: it represents the most likely solution for the weights, given an
adjustable prior on the amplitude of the ﬂuctuations. However, the
meaning of the fundamental degeneracy of the stellar population in-
version, as well as of regularization, is best illustrated with an exam-
ple.

MNRAS 000, 1–20 (2022)

Figure 1. Top panel: synthetic input spectrum with Gaussian noise at S /N =
50. Second panel: input distribution of the V-band templates luminosity.
Third panel: recovered weights from a single non-regularized ppxf ﬁt to one
Monte Carlo realization of the noise. Fourth panel: average of the weights
recovered with ppxf by ﬁtting 100 Monte Carlo realizations of the synthetic
spectrum. Bottom panel: weights recovered with a single ppxf ﬁt with regu-
larization regul=30.

I used a grid of 25 logarithmically-spaced ages t and 6 metal-
licities [M/H] from the SPS models by Vazdekis et al. (2015) to
construct a synthetic spectrum in which the distribution of light con-
tributed by each spectrum in the V band follows a bivariate Gaus-
sian distribution N(t, [M/H]) with mean age t0 = 1 Gyr, mean
[M/H]0 = −0.3 and dispersion of 0.25 dex in both age and metal-
licity. I logarithmically sampled the spectrum at a velocity scale
∆V = c ∆ ln λ = 50 km s−1 per spectral pixel.

I show the resulting spectrum in the top panel of Fig. 1 and the in-
put light-weights distribution in the second panel. The third panel
shows a single ppxf ﬁt, which is characterized by discrete sharp
peaks as expected due to the ill-conditioning of the inversion prob-
lem. The fourth panel shows the result of averaging the weights ob-
tained by ﬁtting with ppxf 100 Monte Carlo realizations obtained
by adding Gaussian noise on the same noiseless synthetic spectrum.

0.350.400.450.500.550.600.650.700.75rest(m)0.250.500.751.001.25Relative Flux (f)Synthetic composite-population spectrum with S/N=50lg Age (yr)1.51.00.50.0[M/H]True InputpPXF Light Fractionslg Age (yr)1.51.00.50.0[M/H]Single non-regularized pPXF fitlg Age (yr)1.51.00.50.0[M/H]Average of 100 pPXF fits to Montecarlo realizations8.08.59.09.510.0lg Age (yr)1.51.00.50.0[M/H]Single regularized pPXF fit0.000.020.040.060.080.000.020.040.060.080.000.020.040.060.080.000.020.040.060.08ppxf with spectra and photometry at redshift z ≈ 0.8

7

Here, the average converges towards the true input distribution. Fi-
nally, in the bottom panel I show the result of performing a single
regularized ppxf ﬁt (with reg order=2 and a typical regul=30).
Here the distribution looks comparable to that of the average of mul-
tiple realizations.

Regularization has its limitations, in fact, it is by construction
a trade-oﬀ between agreement with the data and smoothness (e.g.
Press et al. 2007, ﬁg. 19.4.1), which may introduce biases. In gen-
eral, when one is one is obtaining results by averaging many spec-
tra, it may be better not to use regularization, or only use a minimal
amount, to reduce possible biases, while allowing the diﬀerences in
the noise between spectra to act as Monte Carlo realizations. But
regularization is very useful when interpreting individual spectral
ﬁts and even to reduce noise in the SPS models themselves, which
may introduce spurious features in the solutions (as I found later).

One can use bootstrapping of the residuals, while repeating the
ppxf ﬁts multiple times, to obtain averages as well as uncertainties in
the distribution of the weights as done e.g. by Kacharov et al. (2018,
ﬁgs. 8–13). In this case, it is important to perform the initial ppxf ﬁt,
from which the residuals are extracted, using some regularization, to
obtain a less noisy and more representative best ﬁtting spectrum. I
achieved good results perturbing the residuals using the easy-to-use
wild bootstrap method (Davidson & Flachaire 2008).

3.5 Global nonlinear ﬁtting

In the most common situations, e.g. when ﬁtting a single stellar kine-
matic component with emission lines, the spectral ﬁtting problem
has a single global minimum and the local optimization method of
Section 3.2 is guaranteed to eﬃciently converge to it. However, in
more complex situations, like when ﬁtting multiple stellar or gas
kinematic components, the ﬁtting problem may present multiple
minima and a local optimizer is not guaranteed to converge to the
global minimum.

The standard way of dealing with multiple minima in ppxf is to
perform the optimization of the variables in which the χ2 function is
multi-modal outside of ppxf, while calling ppxf with those variables
ﬁxed, from inside a wrapper function. For example, when studying
multiple kinematic components one may sample a grid of velocities
and call ppxf with ﬁxed velocities at every location (e.g. Mitzkus
et al. 2017; Tabor et al. 2017; Bevacqua et al. 2022). If one is in-
terested in the full posterior of certain parameters, and computa-
tion time is not an issue, one may call ppxf with those parameters
ﬁxed from within a Bayesian method like MultiNest (Feroz et al.
2009), emcee (Foreman-Mackey et al. 2013), AdaMet (Cappellari
et al. 2013a) or dynesty (Speagle 2020), assuming the contribution
of the ﬁtted parameters to the posterior can be neglected.

In the current version of ppxf one can also perform the global
optimization within ppxf. This is currently implemented using
the function scipy.optimize.differential evolution, which
uses the Diﬀerential Evolution algorithm by Storn & Price (1997).
The Scipy function allows for linear constraints using the method by
Lampinen (2002). To save computation time, by default I do not run
the global optimization step until convergence, but I use it as starting
point for the usual CapFit procedure.

An example of a situation where using both the global optimiza-
tion and the linear constraints options can be useful, and the corre-
sponding ppxf ﬁt is shown in Fig. 2. The plots show the central spec-
trum of the active galaxy NGC 1386, extracted from the MUSE (Ba-
con et al. 2010) integral-ﬁeld spectroscopic observations presented
in Venturi et al. (2021). The emission line spectrum clearly requires
at least three distinct kinematic components (see also Lena et al.

Figure 2. Fit of a MUSE spectrum of the active galaxy NGC 1386 (thin
black line, mostly hidden by the ﬁt), using the global optimization op-
tion (global search=True) and linear constraints (constr kinem) in ppxf.
Each of the ﬁve emission lines is modelled with three kinematic components
(see text). The orange line is the ppxf total best ﬁt, the red line is the best ﬁt-
ting stellar spectrum alone, while the magenta is for the gas emissions alone,
with individual components shown in blue. The ﬁt residuals are shown with
green diamonds. I only plot the region with the key emissions, but I ﬁtted the
full optical spectrum, which is needed to constrain the stellar contribution.

2015). The deﬁnition of the three kinematics components may ap-
pear ill-deﬁned, due to the extensive blending of the lines. However,
a meaningful decomposition can be obtained with some simple as-
sumptions. Here I required the kinematics (V, σ) of all ﬁve emission
lines to be the same within each of the three kinematic components.
I additionally required the σbroad of the broad component to be at
least 200 km s−1 broader than either of the two narrow components
as follows σbroad > σnarrow,1 and σbroad > σnarrow,2. These are lin-
ear constraints that I enforced using the constr kinem keyword in
ppxf.

3.6 Fitting spectra and photometry

Including photometry in a full-spectrum ﬁtting method is concep-
tually equivalent to simply including in the ﬁt a few extra pixels,
corresponding to the ﬂuxes measured in a set of observed photomet-
ric bands. The two diﬀerences are (i) that the photometric ﬂuxes do
not depend on the line-of-sight velocity-distribution (LOSVD) Ln(v)
like the spectroscopic ones and (ii) the photometry of an individual
galaxy is generally unable to constrain both the calibration inaccura-
cies and the template weights. This implies that one cannot include
polynomials as done for the spectroscopy.

I deﬁne a function that describes an individual template spectrum
Tn(λ) (either stars or gas), convolved ∗ with the LOSVD, which is

MNRAS 000, 1–20 (2022)

0.6520.6540.6560.6580.6600.662rest(m)024681012Relative Flux (f)[NII][NII]HNGC1386: three gas kinematics components0.4940.4960.4980.5000.502rest(m)051015Relative Flux (f)[OIII][OIII]8 M. Cappellari

allowed to be diﬀerent for each template
gn(λ) = Tn(λ) ∗ Ln(v).

(12)

With this notation, the model for the galaxy spectrum becomes

Gspec

mod(λ) =

N(cid:88)

n=1

wn



gn(λ)An(λ)

K(cid:88)

k=1

akPk(λ)


+



L(cid:88)

l=0

J(cid:88)

blPl(λ)+

c jS j(λ),

j=1

(13)

where the Pk and Pl are multiplicative and additive polynomials re-
spectively (of Legendre or trigonometric type) and the S j are op-
tional spectra of the sky. This model is nearly the same as in Cappel-
lari (2017, eq. 11), except for the fact that here each template spec-
trum can have a diﬀerent attenuation function Ak. Moreover, both the
attenuation and multiplicative polynomials can be used at the same
time, rather than being alternatives. This is especially useful when
including photometry in the ﬁt, which removes the degeneracy be-
tween the attenuation curve and the multiplicative polynomials.

The model for the photometric measurements, in linear units, not

magnitudes, is given by the following expression

Gphot

mod(λq) =

N(cid:88)

n=1

wn (cid:104)gn(λ)An(λ)(cid:105)q,

(14)

where (cid:104)·(cid:105)q represents the mean ﬂux in the q-th photometric band with
eﬀective wavelength λq. Unlike the spectroscopic model of equa-
tion (13), the photometric model of equation (14) does not include
polynomials or the sky spectrum.

In the common case of an energy-integrating detector, and assum-
ing ﬂuxes as fλ (e.g. in units of erg cm−2 s−1 Å−1) the mean ﬂux is
given by (e.g. Bessell & Murphy 2012, eq. A11)

(cid:82)

(cid:104) fλ(cid:105)q =

fλ(λ)S q(λ)λdλ
(cid:82)

S (λ)λdλ

,

(15)

where S q(λ) is the system photon response function and the integral
extends over the region where S q is nonzero. Alternative expressions
can be used when the ﬂuxes were measured diﬀerently.

In the common situation in which the covariance between the
spectroscopic Gspec or photometric Gphot measurements are not
known, or ignored, the residuals r from the ﬁt are as in Cappellari
(2017, eq. 22)
Gspec

p = 1, . . . , P

(16a)

rp =

rq =

,

mod(λp) − Gspec(λp)
∆Gspec(λp)
mod(λq) − Gphot(λq)
∆Gphot(λq)

,

Gphot

q = P + 1, . . . , P + Q,

(16b)

with the diﬀerence that the vector of residuals now includes both the
P spectroscopic and the Q photometric values. In other words, the
total χtotal from the ﬁt, which is proportional to the log-likelihood
ln L, now becomes the sum of the spectroscopic and photometric
ones
χtotal = χspec + χphot.

(17)

Both the linear and nonlinear ﬁt, the regularization and the possible
treatment of covariances, proceed unchanged as already described
in Cappellari (2017, sec. 3.3–3.5). The only diﬀerence is one extra
row in the matrix A, deﬁned in (Cappellari 2017, sec. 3.3), for every
photometric measurement.

According to the mean value theorem for integration, for every
q-th band and n-th template there exists a wavelength λq,n which
satisﬁes
An(λq,n) (cid:104)gn(λ)(cid:105)q = (cid:104)gn(λ) An(λ)(cid:105)q.

(18)

MNRAS 000, 1–20 (2022)

When one has a good estimate of the galaxy redshift (e.g. from pre-
vious photometric redshift), or when performing a grid search for
the best-ﬁtting redshift, the redshift of the spectrum changes little.
This makes the quantities (cid:104)gn(λ)(cid:105)q essentially independent of Ln(v)
during a ﬁt. If I rewrite equation (14) as

Gphot

mod(λq) =

N(cid:88)

n=1

wn An(λq,n) (cid:104)gn(λ)(cid:105)q,

(19)

I can precompute the (cid:104)gn(λ)(cid:105)q for all templates before the ﬁt. This
approach can make the computation time when adding photometry
to a ﬁt insigniﬁcant compared to the ﬁtting of the spectrum alone.

A good approximation for the wavelength satisfying equation (18)

is (e.g. Bessell & Murphy 2012, eq. A21)

(cid:82)

(cid:82)

λq,n =

gn(λ)S q(λ)λ2dλ
gn(λ)S q(λ)λdλ

.

3.7 Dust attenuation

(20)

As illustrated in equation (13) and equation (14), in the new ppxf
method each template can be associated with a diﬀerent attenuation
curve. In practice, one is expected to use this feature to vary the
attenuation curve only for speciﬁc groups of templates.

According to our current understanding of the attenuation by dust
in galaxies (see review by Salim & Narayanan 2020), one expects to
be useful to distinguish three groups of attenuation curves (i) for
the very young population of stars (with typical ages t <
∼ 107 yr),
when they are assumed to be still embedded into their birth cloud
(Charlot & Fall 2000; Granato et al. 2000); (ii) for the whole stellar
population (both young and old), due to diﬀuse dust and (iii) for the
gas emission lines produced in star-forming regions.

In ppxf one can adopt a generic function, which can be diﬀerent
for diﬀerent templates and can have an arbitrary number of param-
eters. The parameters can have bounds or can be kept ﬁxed. By de-
fault I currently implemented a four-parameters attenuation function
A(λ) = f (AV , δ, Eb, fnodust) deﬁned by
Eb (λ ∆λ)2

(21a)

D(λ) =

(λ2 − λ2

0)2 + (λ ∆λ)2
(cid:32)
λ
λV

(cid:2)k(cid:48)(λ) + D(λ)(cid:3)

k(λ) = AV
RV

(cid:33)δ

(21b)

(21c)

A(λ) = fnodust + (1 − fnodust) 10−0.4 k(λ).
Here equation (21a) is the Lorentzian-like Drude function adopted
by Noll et al. (2009) to describe the UV bump around λ0 = 0.2175
µm, with a width ∆λ = 0.035 µm. The equation (21b) is the expres-
sion adopted by Kriek & Conroy (2013), which includes the atten-
uation k(cid:48)(λ) and RV = 4.05 from Calzetti et al. (2000, eq. 4 and 5),
and allows for a variable UV slope δ around the pivot V-band wave-
length λV = 0.55 µm. Optionally, one can make Eb a function of δ
as in Kriek & Conroy (2013, eq. 3). Finally equation (21c) allows
one to specify the fraction fnodust of stellar population (for the given
template) that is unattenuated, as suggested by Lower et al. (2022).
The resulting A(λ) is the factor to multiply the template at the given
wavelength to model the attenuation eﬀect.

4 DATA AND SPS MODELS

In the rest of this paper, I present an analysis of the combined photo-
metric and spectroscopic data, for a sample of about 3200 galaxies
at 0.6 < z < 1, making use of various of the new features of ppxf
introduced in the ﬁrst part of the paper.

4.1 Spectroscopy

4.3 Stellar population synthesis models

ppxf with spectra and photometry at redshift z ≈ 0.8

9

I study a subset of the galaxy sample of the LEGA-C survey (van der
Wel et al. 2016). It is an ESO ESO/Very Large Telescope (VLT)
public spectroscopic survey targeting galaxies in the redshift range
0.6 < z < 1, selected based on their observed Ks-band luminosity in
the UltraVista/COSMOS catalogue by Muzzin et al. (2013), with a
small variation of the Ks limit with z. In this work, I use the data from
the LEGA-C third data release (DR3) presented in van der Wel et al.
(2021). This redshift selection results in a mass-complete sample of
3445 galaxies in DR3 (90% completeness above lg(M∗/M(cid:12)) >
∼ 10.3).
The selection, the completeness level, the characteristics of the sam-
ple and the data reduction are discussed extensively in van der Wel
et al. (2016) and Straatman et al. (2018).

For my study, I focused only on the subsample of 3197 galax-
ies in the DR3 catalogue with spectroscopic redshift 0.6 < z < 1
and with measured stellar velocity dispersion σ∗. This a sample has
redshift z = [0.67, 0.76, 0.93] at the 16th (−1σ), 50th (median) and
84th (+1σ) percentiles. However I veriﬁed that all my results are un-
changed if I restrict the sample to the redshift range to 0.7 < z < 0.9.
The survey data consist of spectra observed with the VLT/VIMOS
multi-object spectrograph (Le F`evre et al. 2003) covering the wave-
length range 0.63-0.88 µm with a spectral resolution R ≈ 3500,
equivalent to an instrumental dispersion σinst ≈ 36 km s−1 (van der
Wel et al. 2021). For the ppxf ﬁts I logarithmically rebinned the spec-
tra to a velocity scale ∆V = c∆ ln λ = σinst (Cappellari 2017, eq. 8)
to make sure the spectrum is Nyquist sampled.

4.2 Photometry

I use two large collections of photometric measurements for the
LEGA-C galaxies. The ﬁrst is the UltraVista/COSMOS catalogue
by Muzzin et al. (2013). It includes PSF-matched photometry in
30 bands from 0.15 to 24 µm. The catalogue is based on the
Y JHKs NIR imaging data from UltraVISTA (McCracken et al.
2012). The optical data consist of broad-band Subaru/SuprimeCam
data (g+r+i+z+B jV j), as well as u∗ data from the CFHT/MegaCam
(Taniguchi et al. 2007; Capak et al. 2007). It also includes the 12 op-
tical medium bands (IA427–IA827) from Subaru/SuprimeCam (Ca-
pak et al. 2007). Also included are the GALEX FUV and NUV chan-
nels (Martin et al. 2005), and the 3.6 µm 4.5 µm 5.8 µm 8.0 µm and
24 µm channels from Spitzer’s IRAC+MIPS cameras (Sanders et al.
2007).

The second photometric catalogue is the COSMOS2020 by
Weaver et al. (2022). Highlights of this catalogue, compared to
the one by Muzzin et al. (2013), are much deeper Subaru Hyper
Suprime-Cam grizy broadband photometric measurements (Aihara
et al. 2019) and deeper UltraVISTA DR4 observations Y JHKs. The
extra depth is not an important feature for my study, as the LEGA-C
galaxies were all well-detected in Muzzin et al. (2013) by design.
However, I use the COSMOS2020 to assess the sensitivity of my re-
sults to the use of independent datasets. For this work, I adopt the
catalogue produced with the farmer proﬁle-ﬁtting photometric ex-
traction tool. I still extend that catalogue with the GALEX photom-
etry, properly scaled, which is important to constrain the youngest
component.

For both photometric catalogues, I only included the typically
28 bands which have a transmission FWHM fully contained in the
wavelength range of the adopted stellar population templates (see
later) at the redshift of each galaxy.

I used three independent SPS models to assess the sensitivity of the
results to some of the adopted model assumptions. I selected the
models based on two criteria (i) the ability to generate model spec-
tra from the far UV at 0.1 µm to 2.5 µm, to be able to constrain the
decrease of fλ towards the NIR region of the galaxy spectra and (ii)
to include model spectra down to a young age of 1 Myr, to repro-
duce the many actively star-forming galaxies that are present in the
sample. The age criterion forces me to exclude from this study the
models by Vazdekis and Maraston, which I have extensively used in
the past.

The three SPS models that satisfy my requirement and that I
adopted are (i) the fsps6 (Conroy et al. 2009; Conroy & Gunn 2010),
(ii) the galaxev7 (Bruzual & Charlot 2003) and (iii) the Bpass8 SPS
models (Stanway & Eldridge 2018; Byrne et al. 2022).

For all three models, I tried to select a consistent set of templates.
In all cases, I adopted the same set of 43 ages logarithmically spaced
by 0.1 dex from 1 Myr to 15.85 Gyr, deﬁned as

lg(Age/yr) = 6, 6.1, 6.2, . . . , 10.2.

(22)

The oldest age is much older than the age of the Universe at the
redshift of the sample, which varies in my standard cosmology from
5.75 – 7.75 Gyr between z = 1 – 0.6, but I did not truncate the
models to physical ages, to check how well the data themselves can
constrain the galaxy ages. I also excluded from all models the most
extreme low metallicities [Z/H] < −2. Here is my other setup for
the three SPS:

(i) The fsps models allow one to compute SPS models for a
speciﬁed set of parameters. I used the Python bindings9 (John-
son et al. 2021a) and the latest public v3.2 to compute a set
of spectra with the above ages and 9 equally-spaced metallici-
ties [Z/H] = [−1.75, −1.5, −1.25, −1., −0.75, −0.5, −0.25, 0, 0.25].
I adopted a Salpeter (1955) IMF with an upper mass cut of 100M(cid:12)
for consistency with bpass. But I note that my results are virtually
insensitive to the slope of the IMF at lower masses. I computed
the SPS without including the eﬀect of gas or dust and adopted de-
fault parameters for the other parameters. This returns SPS spectra
computed using the MILES stellar library (S´anchez-Bl´azquez et al.
2006; Falc´on-Barroso et al. 2011) for the optical region, which is the
one I ﬁt in the LEGA-C spectra.

(ii) The galaxev models provide a Fortran code (version 2020)
which I used to produce a set of SPS spectra with the same ages
as above and computed at the provided 5 metallicities [M/H] =
[−2.34, −1.74, −0.73, −0.42, 0, 0.47]. This SPS model also uses the
MILES library to generate spectra of the optical region. Also here I
adopted a Salpeter IMF.

(iii) The bpass models v2.3 are provided as a set of ﬁles pre-
computed at a given set of metallicity. I adopted the 10 metallic-
ities10 [Z/H] = [−1.3, −1, −0.8, −0.7, −0.5, −0.4, −0.3, 0, 0.2, 0.3].
The models are provided for a single IMF having a power slope -2.35
(Salpeter slope) above M > 0.5M(cid:12) and slope -1.3 at lower masses. I
used the version of the SPS for single stars, ignoring binaries, with
[α/Fe] = 0, for consistency with the other two SPS models. These
SPS models are fully synthetic.

6 Available from https://github.com/cconroy20/fsps
7 Available from http://www.bruzual.org/bc03/
8 Available from https://bpass.auckland.ac.nz/
9 Available from https://github.com/dfm/python-fsps
10 The models are speciﬁed in metal mass fraction Z, and I converted it to
[Z/H] with ∼ 10 % accuracy.

MNRAS 000, 1–20 (2022)

10 M. Cappellari

5 SETUP FOR ppxf AND TESTS

In this study, ﬁtting (twice) the VIMOS spectrum (≈ 2800 spec-
tral pixels) and typically 28 photometric bands for a single galaxy
with ppxf takes about 1 min. This compares with the ”roughly 100
CPU hours” reported by Tacchella et al. (2022) in a similar state-
of-the-art study using DEIMOS spectroscopy and the prospector
Bayesian code (Johnson et al. 2021b). This is a computation time
diﬀerence of nearly four orders of magnitude! Of course, the two
methods perform quite diﬀerent tasks and the large computational
cost is a standard feature of Bayesian methods and not a weakness
by itself. However, the execution time of a method aﬀects the kind
of tasks one can address and the variety of modelling choices one
can explore as I outline in this section.

5.1 Non-parametric population model

A key feature made possible by least-squares methods is the abil-
ity to explore non-parametrically the joint distribution of SFH and
chemical composition with high resolution. My setup uses 43 non-
parametric age bins, and each age bin is allowed to have a diﬀer-
ent non-parametric metallicity (5 – 10 bins depending on the SPS
code) for a total of up to 430 bins. This contrast with the 10 non-
parametric age bins and the single parametric metallicity distribu-
tion for the entire galaxy adopted by Tacchella et al. (2022). Cru-
cially, even when using a non-parametric grid of a few hundred
templates the least-squares method guarantees global convergence
to the most likely weights distribution. This is because the con-
strained quadratic-programming problem being solved (Cappellari
2017, eq. 27) is known to possess a unique global minimum (e.g. No-
cedal & Wright 2006). This contrast with Bayesian methods, where
Tacchella et al. (2022, sec. 3.2) reported that ”the ﬁts do not con-
verge within a reasonable amount of time” with 14 non-parametric
bins. The use of non-parametric models is important for a proper
recovery of the stellar population in galaxies (Lower et al. 2020).

5.2 Polynomials

A least-squares method like ppxf allows for a quick exploration of
diﬀerent modelling assumptions. In the course of this study I was
able to easily test diﬀerent options, each with all three SPS models,
for all 3200 galaxies, to test how they aﬀected the ﬁnal results. In
particular, I run models with both multiplicative and additive poly-
nomials degree from mdegree=degree=-1 (i.e. using only attenu-
ation and no polynomials) to degree 4 and found that the solution
changes slightly without polynomials but quickly stabilizes as soon
as one allows for a nonzero degree. Results were similar when only
using additive or only multiplicative polynomial to adjust the spec-
tral stellar continuum. This was a non-obvious result in the present
analysis, given that the LEGA-C spectra were calibrated using SPS
models (van der Wel et al. 2021) and this non-standard calibration
may leave an inﬂuence on the results. The polynomials should eﬀec-
tively remove any memory of possible inaccuracies in the spectral
calibration. I adopted the ppxf keywords mdegree=2, degree=-1
for my standard setup.

5.3 Dust attenuation model

I truncated all three the SPS templates to 0.01 µm < λ < 5 µm (ex-
cept for the bpass SPS which only extend to λ < 2 µm) to remove
the inﬂuence of dust on the spectral shape (e.g. Conroy 2013, ﬁg. 1).
This is because the modelling of dust from the energy balance of

MNRAS 000, 1–20 (2022)

UV light reradiated to the IR requires several further assumptions
and is not implemented in all modelling codes. Moreover, the cur-
rently available bands are included in the ﬁtted range anyway. This
situation is changing rapidly with the James Webb Space Telescope
(JWST) and will soon be revisited.

For the full set of 3200 galaxies, I experimented with three dif-
ferent assumptions for the attenuation: (i) I adopted a single four-
parameters attenuation for all stellar templates as in equation (21);
(ii) I reduced the attenuation curve to two parameters (AV , δ) by as-
suming fnodust = 0 and adopting the Eb − δ relation by Kriek &
Conroy (2013, eq. 3); I still applied this attenuation for all stellar
templates; (iii) I adopted the two-components attenuation model by
Charlot & Fall (2000). For this I used a birth-cloud attenuation of
the form

k(λ) = A(cid:48)
V

(cid:32)

λ
0.55 µm

(cid:33)−1

.

(23)

I apply this only to the stellar templates younger than 10 Myr, while
I used the same attenuation as in (ii) for the diﬀuse dust compo-
nent aﬀecting all stellar templates. In all three cases, I ﬁt a dif-
ferent Calzetti et al. (2000) attenuation curve (equation (21) with
Eb = δ = fnogas = 0) for the gas emission lines templates.

I found that options (i) and (ii) produce an insigniﬁcant diﬀer-
ence in the ﬁnal results, but there is some degeneracy in the attenu-
ation parameters, which makes any trend between dust parameters
less obvious. Option (iii) generates a similar result for the older
and intermediate populations, as expected. However, when allow-
ing the youngest population to have its own attenuation, this be-
comes completely degenerate with the amount of star formation in
that same young component. As a result, one can obtain good ﬁts
with an unlikely large attenuation associated with an equally large
star formation, but with complete degeneracy between the two pa-
rameters. This is the well-known SFR-dust degeneracy mentioned in
Section 1. It can be broken by introducing extra assumptions on the
dust geometry and reradiated UV fraction, combined with rest-frame
IR data, which I do not have.

In conclusion,

I adopted as my standard choice the two-
parameters attenuation function of the option (ii), which applies to
the whole population, as done e.g. by Kriek & Conroy (2013). I en-
forced bounds on the parameters as −1 < δ < 0.4 and 0 < AV < 4.

5.4 Matching photometry and spectra

For every galaxy, I have a spectroscopic redshift from the LEGA-C
catalogue and I only included a photometric band in the ﬁt if the
band FWHM is fully enclosed by the template’s wavelength cover-
age at that redshift. I pre-computed the (cid:104)gn(λ)(cid:105)q and λq,n in equa-
tion (19) before the ﬁts. For all ﬁlters I used the same photonic
throughput ﬁle produced for the eazy code (Brammer et al. 2008)
and kindly made available online11.

The spectroscopy was observed within slits of 1(cid:48)(cid:48), while the pho-
tometric observations are either measured within an aperture of 2.(cid:48)(cid:48)1
(Muzzin et al. 2013) or total magnitudes (Weaver et al. 2022). This
implies that one cannot expect a matching of the ﬂux levels with-
out calibration. One should also keep in mind that in some cases,
with a non-uniform stellar population, the photometric ﬂuxes may
correspond to a signiﬁcantly diﬀerent population that that sampled
by the spectra. With this caveat in mind, for every galaxy, before
the ppxf ﬁt, I computed synthetic photometric ﬂuxes (cid:104) fλ(cid:105)q from the

11 Available from https://github.com/gbrammer/eazy-photoz

ppxf with spectra and photometry at redshift z ≈ 0.8

11

VIMOS spectra using equation (15), for the subset of photometric
bands contained within the VIMOS wavelength range. Then I mul-
tiplied the spectrum by a factor κ to match it to the photometry in a
least-squares sense. The factor κ can be computed with the general
linear-ﬁtting relation (e.g. Cappellari 2008, eq. 51)
κ = d · m
m · m
where the “data” vector d has elements dq = pq/∆pq, the observed
photometric ﬂuxes pq, divided by their uncertainties ∆pq and the
“model” vector m has elements mq = (cid:104) fλ(cid:105)q/∆pq, the synthetic ﬂuxes
also divided by the data uncertainties.

(24)

,

Similarly to Kriek & Conroy (2013), in all my ﬁts I did not use the
formal photometric uncertainties provided by the catalogues, as this
would make the ﬁts completely dominated by the very small error
bars at longer wavelengths. Moreover, after performing numerous
ﬁts, it became clear that uncertainties are dominated by systematic
imperfections in the SSP models assumptions or in the data, rather
than by purely random noise. For this reason, I adopted for all the
photometric uncertainty a constant value per galaxy (in a linear, not
relative sense).

5.5 Outliers removal

Following common practice (e.g. Westfall et al. 2019), I remove out-
liers from the spectra ﬁts by performing a ﬁrst ppxf ﬁt using the
formal uncertainties, for both photometry and spectroscopy. Then I
estimate the rms noise spectrum σspec
noise per pixel from the ﬁt resid-
uals, in a statistically robust way, by computing for every spectral
pixel the interval containing 68% of the residuals, within a moving
window of 100 pixels. Then I mask the pixels deviating more than
3σspec
noise from the best ﬁt. I repeat the masking in a loop, while itera-
tively adjusting the normalization of the best ﬁtting spectrum using
the non-masked pixels with equation (24), until the mask does not
change anymore.

After clipping the spectroscopic outliers, I multiply σspec

noise of every
pixel by k = (χ2/Nspec
pix )1/2, where Nspec
is the number of non-masked
spectral pixels, in such a way that the resulting χ2/Nspec
= 1. I do the
pix
same rescaling for the photometric uncertainties to obtain χ2/Nphot
=
pix
1. After the spectral masking and the rescaling of the uncertainties,
I perform a second ppxf ﬁt, from which I extract the ﬁnal results.

pix

5.6 Gas model and kinematic constraints

Gas emission could be predicted based on the galaxy SFH and could
be included in the models, with some extra assumptions, based on
photoionization models like cloudy (Ferland et al. 1998, 2013). This
feature is implemented in fsps and can be useful when ﬁtting pho-
tometry alone. However, in my case, I have many good quality spec-
tra in addition to photometry and I want to be able to ﬁt the gas more
accurately than a model could predict. For this reason, I ﬁt the gas
emission lines in a model-independent way with ppxf.

With ppxf one can ﬁt many gas emission lines simultaneously to
the stellar continuum. This is especially important when studying the
stellar population of star-forming galaxies or AGNs, where key ab-
sorption lines like the Balmer series are ﬁlled by emission. However,
when ﬁtting gas lines in relatively low S/N spectra, it is essential to
set constraints on the parameters of the gas lines, to prevent possible
degenerate situations. An example of a situation to avoid is when
the spectrum does not have gas emission and the Gaussian describ-
ing an emission line becomes so wide as to become degenerate with
the shape of the stellar continuum.

This is one of the types of situations for which I designed the
linearly constrained algorithm of Section 3.2. For my ﬁts to the
LEGA-C spectra, after some experimentation focusing on the few
problematic ﬁts, I found it suﬃcient to require the dispersion of the
gas emission lines to be smaller than the stellar one σgas < σ∗ and
in addition I required the gas and mean stellar velocities to satisfy
|Vgas − V∗| < 500 km s−1. I enforced these requirements as linear
constraints in ppxf (keyword constr kinem).

The emission lines that I included in the ppxf ﬁts are all the lines
listed in Belﬁore et al. (2019, table 1). In particular, those falling
within the LEGA-C wavelength range for 0.6 < z < 1 are the Balmer
series bluer than Hβ, the [OII]λλ3726,29, [NeIII]λλ3868,69 and
[OIII]λλ4959,5007 doublets, and the HeIIλ4687. I force the kine-
matics of all the gas lines to be the same and I additional ﬁx the
[OIII] doublet to the 1/3 ratio. I ﬁt the Balmer series as single gas
template with decrement for Case B recombination, for temperature
T = 104 K and electron density ne = 100 cm−3 from Storey & Hum-
mer (1995). I allow the gas templates to have their own Calzetti et al.
(2000) attenuation curve. Fixing the intrinsic ratios of the Balmer se-
ries allows me to provide a better extrapolation of the gas ﬁlling the
weakest (higher-order) absorption lines of the series, even when the
S/N of the spectrum is not high enough to constrain them.

Note that, although I do not include theoretical gas emission pre-
dictions in the SPS models, I do include the contribution of the emis-
sion lines that are spectroscopically constrained in the photometry.
In particular, when Balmer lines are present in the spectrum, the line
ﬂuxes of the Balmer series, and in particular of Hα, which is outside
the LEGA-C wavelength range, are included in the photometric ﬁt.
However, I checked that this inclusion has a minimal eﬀect on the
ﬁnal results.

5.7 Velocity dispersion matching

The LEGA-C data have an instrumental dispersion of σinst ≈ 36
km s−1 (Section 4.1), ignoring possible variations within the rather
small wavelength range. The MILES stellar templates used in both
the fsps and galaxev models were observed with an instrumental
resolution of ∆λ ≈ 2.50 Å FWHM (Falc´on-Barroso et al. 2011),
equivalent to R = λ/∆λ ≈ 1600 at the typical wavelength λ ≈ 0.4 µm
covered by LEGA-C. This corresponds to an instrumental dispersion

σinst =

c

4 ln 4

√

R

≈ 80 km s−1.

(25)

+ σ2

Ideally, I would like to use SPS models based on stars with
higher resolution than the galaxy spectra. However, assuming that
the instrumental line spread functions are approximately Gaussian,
one can still use a template with higher instrumental dispersion
σinst,tem than that σinst,gal of the observed galaxy spectrum as long
as (σ2
inst,tem, where σ∗ is the real “astrophysical” dis-
persion of the galaxy stars. After the ppxf ﬁt one can compute the
corrected stellar dispersion with the standard expressions (Cappel-
lari 2017, sec. 2.2)
diﬀ = σ2
σ2
= σ2
σ2
∗

inst,gal − σ2
ppxf − σ2
diﬀ.

∗) > σ2

(26b)

(26a)

instr,tem

inst,gal

∼ |σ2

As σ2
diﬀ is in this case a negative quantity, I can model the dispersion
of galaxies down to σ∗ >
diﬀ|1/2 = 71 km s−1. I compared my ﬁtted
dispersions σ∗ with the values in the LEGA-C DR3 catalogue, which
were measured with ppxf using higher resolution synthetic templates
as described in Bezanson et al. (2018). I found a good agreement as-
diﬀ|1/2 ≈ 48 km s−1, which suggests possible inaccuracies
suming |σ2

MNRAS 000, 1–20 (2022)

12 M. Cappellari

in the quoted relative instrumental dispersion of the galaxies and the
templates. Regardless of the reason for this discrepancy, only 40 of
the 3197 galaxies in the catalogue with measured dispersion have
σ∗ < 48 km s−1, likely due to measurement uncertainties. This im-
plies that I can safely use the SPS based on MILES models to study
the stellar population of LEGA-C galaxies.

of star formation, which happened at diﬀerent times and (ii) galax-
ies requiring multiple discrete star formation events. Star formation
events appear to have a similar extent in ln Age, which seems to im-
ply that events in the past lasted longer than recent ones. This is
likely an artefact of our general ability to more accurately detect age
diﬀerences in recent events.

6 RESULTS

6.1 Spectral ﬁt examples

In this paper, I focus on galaxy observable trends rather than on com-
parisons with models of galaxy formation. For this reason, instead
of converting the SFH recovered by ppxf into stellar masses formed
in a given time interval, I will always show the fraction of bolomet-
ric luminosity contributed by each template, as a function of their
age and metallicity [M/H]. More precisely, I integrate the luminos-
ity from the template spectra only within the region 0.1 < λ < 3 µm
covered by the data. This is to avoid the possibility of interpreting
very young stars, which emit most of their luminosity for λ < 0.1
µm, as contributing signiﬁcantly to my observables, even when their
ﬂux is not detected in the data, but simply extrapolated. I still indi-
cate my luminosity as Lbol because, except for extreme young stars,
it still represents a very good approximation for it.

The advantage of using Lbol rather than SFH, is that one can get
a direct sense of what the data actually show, without strongly non-
linear conversions into masses, due to the large M/L diﬀerences of
diﬀerent stellar populations. In fact, I would argue that comparisons
with models of galaxy formations are generally more meaningful
when the models, for which all quantities are known accurately, are
converted into luminous observables, rather than trying to do the re-
verse by extracting SFH in masses from the data.

In the course of this study, I ﬁtted the 3197 galaxies of my sub-
sample (Section 4.1) with ppxf multiple times with diﬀerent levels of
regularization, or no regularization at all, to test the sensitivity of the
results. In Fig. 3 I illustrate the eﬀect of regularization on some high-
S /N spectra. These ﬁgures, like Fig. 1, illustrate the ill-conditioning
of the stellar population inversion, which prevents one from obtain-
ing a unique solution, even from very good data. Nonetheless, the
ﬁgure also illustrates the ability of the method to distinguish the
striking diﬀerence between (i) galaxies that can only be described,
even at high regularization12 (regul=100) by a single star formation
event at a very localized lg Age (top three panels in Fig. 3) and (ii)
galaxies that require multiple and separated star formation events to
be described (bottom three panels in Fig. 3). The galaxies in the top
panels are essentially described by a single SPS model, from 0.1 µm
to 3 µm, for both spectra and photometry. This highlights the success
of the SPS models in accurately predicting real galaxy spectra.

In Fig. 4 I show additional examples of ppxf ﬁts to good quality
spectra to give a sense of the variety of spectral morphologies and
the corresponding variations in the Lbol weights distributions. I used
in all these cases a high regularization (regul=100). Also here one
can clearly see the striking diﬀerence between (i) the three galax-
ies in the top row, which can only be described as a single burst

12 A given value of the ppxf keyword regul roughly implies that neigh-
bouring weights wi j can diﬀer by ∆wi j ∼ 1/regul. As I normalize all galaxy
spectra to the same average ﬂux (e.g. average=1), setting a given regul value
roughly corresponds to requiring a similar level of smoothness in the weights
distribution.

MNRAS 000, 1–20 (2022)

6.2 Stellar population scaling relations

As I am focusing on observable trends, I deﬁne luminosity-weighted
population quantities, summed over the template weights, as

(cid:80)

(cid:104)lg Age(cid:105) =

(cid:104)[M/H](cid:105) =

(cid:80)

j Lbol, j × lg Age
j Lbol, j
j Lbol, j × [M/H]
j Lbol, j

(cid:80)

(cid:80)

.

(27a)

(27b)

e

e

e σ2

∗, and as half-light radius Rmaj

In Fig. 5 I show the distribution of ages, metallicities and the Ser-
sic (1968) exponent nSer on the (M∗, Rmaj
) plane. Here I adopted
as an approximation of the total stellar masses M∗ the virial mass
Mvir ∝ Rmaj
the semi-major axis of
the isophote containing half of the total light of the Sersic (1968)
ﬁtted to the galaxy photometry. Both quantities, as well as nSer are
tabulated in the LEGA-C catalogue (van der Wel et al. 2021). See
Cappellari et al. (2013a) for a discussion of why the virial mass
is likely to be a better approximation of the total stellar mass than
the corresponding stellar population estimate. I LOESS smoothed
the the measured values using the algorithm by Cleveland & Devlin
(1988) as implement13 by Cappellari et al. (2013b). I used a small
smoothing parameter frac=0.1 in all plots of this paper.

e

e

This ﬁgure shows the well-known fact, in the nearby Universe,
that both ages and metallicities approximately follow lines of con-
stant stellar velocity dispersion σ∗, or equivalently lines where
M∗ ∝ Rmaj
(compare this ﬁgure with ﬁg. 4 of Li et al. 2018). I
also show to guide the eye the local “zone of avoidance” at high
densities (Cappellari et al. 2013b, eq. 4), which I scaled down by
a factor 1.6× in Rmaj
, roughly consistent with the general trends of
decreasing galaxy sizes with redshift (e.g. van der Wel et al. 2014).
The Sersic index nSer also approximately follows the distribution of
ages and metallicity, in the sense that passive galaxies tend to have
ln nSer >
∼ 2.5 (red colour in the right panel of Fig. 5). This
nSer value is the one sometimes adopted to separate early-type from
late-type galaxies (e.g. Bell et al. 2003; Shen et al. 2003). In the lo-
cal Universe, below the stellar mass lg(M∗/M(cid:12)) <
∼ 11.5 the trend of
nSer is due to a sequence of increasing bulge fraction, while above
lg(M∗/M(cid:12)) >
∼ 11.5 is the region of slow rotators with cores (see re-
view by Cappellari 2016, ﬁg. 23).

∼ 0.4 or nSer >

This result has a rather long history, both locally and at z ∼ 1
(Chauke et al. 2018, 2019; Beverage et al. 2021; Barone et al. 2022;
Hamadouche et al. 2022; Tacchella et al. 2022) but had not been
seen so cleanly at this redshift before LEGA-C. For nearby galaxies,
Kauﬀmann et al. (2003) clearly noted that galaxy population corre-
lates better with mass surface density Σ than with M∗. It was later
observed that Σ, or even better the virial predictor σvir ∝ M∗/Re of
the stellar velocity dispersion, inferred from photometry alone, re-
mains a better predictor of galaxy colours out to z ≈ 3 (Franx et al.
2008; Bell et al. 2012). However, it was still unclear at that time how
accurately the photometric estimates were able to predict the actual
stellar masses and the velocity dispersion of the stars. To address this
issue I used high-quality dynamical models, and real good quality

13 Available from https://pypi.org/project/loess/

ppxf with spectra and photometry at redshift z ≈ 0.8

13

Figure 3. Examples of ppxf ﬁts to the LEGA-C galaxy spectra and 28-bands photometry using the fsps models. The top three galaxies require a model with
a single short star formation event, while the bottom three galaxies require multiple discrete star formation events. For each galaxy, the top panel shows the
photometric measurements (blue error bars) and the best ﬁt (green diamonds), while the golden line shows the underlying best ﬁtting template with included
emission lines. The grey vertical band indicates the range where spectroscopy was also ﬁtted. The second panel shows the observed spectrum (black line)
and the best ﬁtting total spectrum (orange line). The best ﬁtting stellar spectrum alone is shown in red and the gas emission one is in magenta. The residuals
(arbitrarily oﬀset) are indicated with green diamonds and the masked pixels with blue lines (and corresponding grey vertical bands). The last three panels show
the distribution of the ppxf weights, indicating the bolometric luminosity Lbol of each stellar population of given age and metallicity. The weights are shown for
(i) no regularization, (ii) regularization regul=10 and (iii) regul=100 as written in the plots.

MNRAS 000, 1–20 (2022)

0.110.20.30.40.623rest(m)0.000.250.500.751.00Relative Flux (f)ID: 215825; fsps; z=0.7542; lgM*=10.4; =186 km s1; S/N=490.400.420.440.460.480.500.52rest(m)0.250.500.751.001.25Relative Flux (f)6.06.57.07.58.08.59.09.510.01.51.00.50.0[M/H]regul = 00.00.10.20.30.4light fraction6.06.57.07.58.08.59.09.510.01.51.00.50.0[M/H]regul = 100.000.020.040.060.080.10light fraction6.06.57.07.58.08.59.09.510.0lg Age (yr)1.51.00.50.0[M/H]regul = 1000.000.020.040.06light fraction0.110.20.30.40.6234rest(m)0.00.51.0Relative Flux (f)ID: 250391; fsps; z=0.8893; lgM*=11.0; =173 km s1; S/N=290.340.360.380.400.420.440.46rest(m)0.00.51.01.5Relative Flux (f)6.06.57.07.58.08.59.09.510.01.51.00.50.0[M/H]regul = 00.00.10.20.30.4light fraction6.06.57.07.58.08.59.09.510.01.51.00.50.0[M/H]regul = 100.000.020.040.060.08light fraction6.06.57.07.58.08.59.09.510.0lg Age (yr)1.51.00.50.0[M/H]regul = 1000.000.010.020.030.040.05light fraction0.110.20.30.40.623rest(m)0.000.250.500.751.001.25Relative Flux (f)ID: 56670; fsps; z=0.6686; lgM*=11.5; =230 km s1; S/N=380.380.400.420.440.460.480.500.52rest(m)0.000.250.500.751.001.25Relative Flux (f)6.06.57.07.58.08.59.09.510.01.51.00.50.0[M/H]regul = 00.00.10.20.30.4light fraction6.06.57.07.58.08.59.09.510.01.51.00.50.0[M/H]regul = 100.0000.0250.0500.0750.1000.125light fraction6.06.57.07.58.08.59.09.510.0lg Age (yr)1.51.00.50.0[M/H]regul = 1000.000.010.020.030.040.05light fraction0.110.20.30.40.623rest(m)0.00.51.01.52.02.5Relative Flux (f)ID: 213036; fsps; z=0.6112; lgM*=10.8; =94 km s1; S/N=410.380.400.420.440.460.480.500.52rest(m)0.40.60.81.01.2Relative Flux (f)6.06.57.07.58.08.59.09.510.01.51.00.50.0[M/H]regul = 00.000.050.100.150.200.25light fraction6.06.57.07.58.08.59.09.510.01.51.00.50.0[M/H]regul = 100.000.010.020.03light fraction6.06.57.07.58.08.59.09.510.0lg Age (yr)1.51.00.50.0[M/H]regul = 1000.0000.0050.0100.015light fraction0.110.20.30.40.623rest(m)0.00.20.40.60.81.0Relative Flux (f)ID: 65508; fsps; z=0.6606; lgM*=11.4; =180 km s1; S/N=330.380.400.420.440.460.480.50rest(m)0.20.40.60.81.01.2Relative Flux (f)6.06.57.07.58.08.59.09.510.01.51.00.50.0[M/H]regul = 00.000.050.100.150.20light fraction6.06.57.07.58.08.59.09.510.01.51.00.50.0[M/H]regul = 100.000.010.020.030.040.05light fraction6.06.57.07.58.08.59.09.510.0lg Age (yr)1.51.00.50.0[M/H]regul = 1000.0000.0050.0100.0150.020light fraction0.110.20.30.40.623rest(m)0.000.250.500.751.001.25Relative Flux (f)ID: 121995; fsps; z=0.7237; lgM*=11.6; =206 km s1; S/N=360.360.380.400.420.440.460.48rest(m)0.250.500.751.001.25Relative Flux (f)6.06.57.07.58.08.59.09.510.01.51.00.50.0[M/H]regul = 00.000.050.100.150.200.25light fraction6.06.57.07.58.08.59.09.510.01.51.00.50.0[M/H]regul = 100.000.020.040.06light fraction6.06.57.07.58.08.59.09.510.0lg Age (yr)1.51.00.50.0[M/H]regul = 1000.0000.0050.0100.0150.020light fraction14 M. Cappellari

Figure 4. More examples of ppxf ﬁts to spectra and photometry. The meaning of the symbols is the same as in Fig. 3, but I show a single regularization
(regul=100). The top three galaxies require a single star formation event, while the rest can only be modelled with multiple discrete star formation events.

stellar kinematics and dynamically determined masses, rather than
photometric estimates. In Cappellari (2011) I clearly concluded that
“σ∗ (not Σ or M∗) is the best predictor of galaxy properties” (see
also Cappellari et al. 2013b). These early results were conﬁrmed by
several papers using larger samples and stellar kinematics of ever-
increasing quality (e.g. Wake et al. 2012; Scott et al. 2017; Li et al.
2018; Barone et al. 2018, 2020). In parallel, Cheung et al. (2012) and
Fang et al. (2013) introduced the use of central surface density from
photometry, within a ﬁxed radius of 1 kpc, to predict quenching. A
review is given in Cappellari (2016, see ﬁg. 22).

Given that in Fig. 5 the main stellar population trends follow σ∗,
in Fig. 6 I show how the luminosity-weighted ages and metallicity

depends on σ∗ in the LEGA-C sample. The trends resemble quite
closely the local results from the best integral-ﬁeld spectroscopy
from both SAMI (Scott et al. 2017) and MaNGA (Li et al. 2018).
However, the top panels of Fig. 6 additionally illustrate the clear de-
pendency between age and [M/H] at ﬁxed σ∗: the population of old
galaxies at large σ∗ is characterized by a larger metallicity than their
younger counterpart at the same σ∗. Very clear is the bend in the
(σ∗, Age) distribution around lg(σ∗/km s−1) ≈ 2.3 (also see Chauke
et al. 2018). The results are very consistent between both the fsps
and galaxev SPS models. It is reassuring to see that the ridge of the
age distribution in the top panels converges towards the age of the
Universe at that redshift (grey horizontal band), while being slightly

MNRAS 000, 1–20 (2022)

0.110.20.30.40.623rest(m)0.000.250.500.751.001.25Relative Flux (f)ID: 86349; fsps; z=0.6713; lgM*=10.9; =156 km s1; S/N=35; regul=1000.360.380.400.420.440.460.48rest(m)0.000.250.500.751.001.25Relative Flux (f)6.06.57.07.58.08.59.09.510.0lg Age (yr)1.51.00.50.0[M/H]0.000.020.040.06light fraction0.110.20.30.40.623rest(m)0.000.250.500.751.001.25Relative Flux (f)ID: 38648; fsps; z=0.6744; lgM*=11.7; =310 km s1; S/N=45; regul=1000.400.420.440.460.480.500.52rest(m)0.250.500.751.001.25Relative Flux (f)6.06.57.07.58.08.59.09.510.0lg Age (yr)1.51.00.50.0[M/H]0.000.010.020.030.04light fraction0.110.20.30.40.623rest(m)0.000.250.500.751.001.25Relative Flux (f)ID: 57389; fsps; z=0.6619; lgM*=11.6; =214 km s1; S/N=39; regul=1000.380.400.420.440.460.480.500.52rest(m)0.000.250.500.751.001.25Relative Flux (f)6.06.57.07.58.08.59.09.510.0lg Age (yr)1.51.00.50.0[M/H]0.000.010.020.030.040.05light fraction0.110.20.30.40.623rest(m)0.00.51.01.5Relative Flux (f)ID: 217632; fsps; z=0.8252; lgM*=10.7; =65 km s1; S/N=19; regul=1000.340.360.380.400.420.440.46rest(m)0.00.51.0Relative Flux (f)6.06.57.07.58.08.59.09.510.0lg Age (yr)1.51.00.50.0[M/H]0.0000.0050.0100.0150.020light fraction0.110.20.30.40.6234rest(m)0123Relative Flux (f)ID: 75921; fsps; z=0.9897; lgM*=10.6; =134 km s1; S/N=17; regul=1000.300.320.340.360.380.40rest(m)0.51.01.5Relative Flux (f)6.06.57.07.58.08.59.09.510.0lg Age (yr)1.51.00.50.0[M/H]0.0000.0050.0100.0150.0200.025light fraction0.110.20.30.40.623rest(m)0.00.51.01.52.0Relative Flux (f)ID: 229359; fsps; z=0.8504; lgM*=10.9; =80 km s1; S/N=25; regul=1000.380.400.420.440.460.48rest(m)0.250.500.751.001.25Relative Flux (f)6.06.57.07.58.08.59.09.510.0lg Age (yr)1.51.00.50.0[M/H]0.00000.00250.00500.00750.01000.0125light fraction0.110.20.30.40.623rest(m)0.000.250.500.751.00Relative Flux (f)ID: 234337; fsps; z=0.6763; lgM*=11.8; =210 km s1; S/N=32; regul=1000.380.400.420.440.460.480.500.52rest(m)0.250.500.751.001.25Relative Flux (f)6.06.57.07.58.08.59.09.510.0lg Age (yr)1.51.00.50.0[M/H]0.0000.0050.0100.0150.0200.025light fraction0.110.20.30.40.623rest(m)0.000.250.500.751.00Relative Flux (f)ID: 216176; fsps; z=0.8599; lgM*=11.4; =154 km s1; S/N=35; regul=1000.380.400.420.440.460.48rest(m)0.250.500.751.001.25Relative Flux (f)6.06.57.07.58.08.59.09.510.0lg Age (yr)1.51.00.50.0[M/H]0.0000.0050.0100.015light fraction0.110.20.30.40.623rest(m)0.00.20.40.60.81.0Relative Flux (f)ID: 65508; fsps; z=0.6606; lgM*=11.4; =180 km s1; S/N=33; regul=1000.380.400.420.440.460.480.50rest(m)0.20.40.60.81.01.2Relative Flux (f)6.06.57.07.58.08.59.09.510.0lg Age (yr)1.51.00.50.0[M/H]0.0000.0050.0100.0150.020light fractionppxf with spectra and photometry at redshift z ≈ 0.8

15

Figure 5. Galaxy properties on the stellar mass vs size (M∗, Rmaj
) plane at z ≈ 0.8. Galaxies are coloured by their luminosity-weighted ages (cid:104)lg Age(cid:105) (left panel),
luminosity-weighted metallicities (cid:104)[M/H](cid:105) (middle panel) and by the Sersic index nSer of a ﬁt to their photometry. I used the values from the galaxev models,
but those from fsps are very similar. All values are LOESS smoothed to show average trends and I used regul=10 in ppxf. The grey contours are a kernel
density estimate of the galaxy distribution (using scipy.stats.gaussian kde). Galaxy properties mainly follow lines of constant stellar velocity dispersion,
which is indicated by the dashed grey lines for σ∗ = 50, 100, 200, 300, 400, 500 km s−1 from left to right, while mass is not a good predictor of their stellar
population. However, above a stellar mass lg(M∗/M(cid:12)) >
∼ 11.5 (blue vertical line), all galaxies are old (quenched), have a high metallicity and large Sersic index.
The thick red line is the “zone of avoidance” for nearby galaxies from Cappellari et al. (2013b), scaled down by a factor 1.6× to account for redshift evolution.

e

Figure 6. Luminosity-weighted ages (cid:104)lg Age(cid:105) and metallicities (cid:104)[M/H](cid:105) vs stellar velocity dispersion σ∗ for the LEGA-C galaxies. The top panels show the
age distribution, coloured by metallicity. The bottom panels show the metallicity distribution coloured by age. In all panels, the grey contours are the kernel
density estimator of the galaxies’ distribution. From left to right I show results using the fsps, galaxev and bpass SPS models, all with regul=10 in ppxf. There
is a clear bend of the (Age, σ∗) trend around lg(σ∗/km s−1) ≈ 2.3. At ﬁxed σ∗ metallicity depends on age with younger galaxies having lower (cid:104)[M/H](cid:105).

younger for galaxev vs fsps. The bpass results are qualitatively in
agreement but show substantial quantitative diﬀerences, especially
in the σ∗ − [M/H] trend. Overall, this ﬁgure conﬁrms the quality
and consistency of these global results compared to local surveys.

Fig. 7 shows the distribution of the two dust attenuation parame-
ters AV and δ coloured by mean stellar age (Section 5.3). One can see
that at every UV slope δ the youngest galaxies have the strongest at-

tenuation, except for the largest δ. Moreover, the largest attenuations
in galaxies are only observed at large δ, close to the Calzetti et al.
(2000) slope δ = 0. Note, however, that there is a degeneracy be-
tween attenuation and continuum normalization near the upper limit
of δ. Results are extremely consistent for the fsps and galaxev SPS
models, but again the bpass results look quite diﬀerent, although they
all qualitatively agree.

MNRAS 000, 1–20 (2022)

9101112lgM(M)0.50.00.51.01.5lgRmaje (kpc)MRe=const.OnlyQuenchedlgAge9101112lgM(M)0.50.00.51.01.5MRe=const.OnlyQuenched[M/H]9101112lgM(M)0.50.00.51.01.5MRe=const.OnlyQuenchedlgnSer9.457.900.15-0.500.600.00 (km/s)78910lgAge (yr)SPS method: fsps1.61.82.02.22.42.6ln (km/s)1.51.00.50.00.5[M/H][M/H]0.04-0.59lgAge (yr)9.638.14 (km/s)78910lgAge (yr)SPS method: galaxev1.61.82.02.22.42.6ln (km/s)1.51.00.50.00.5[M/H][M/H]0.20-0.51lgAge (yr)9.427.90 (km/s)78910lgAge (yr)SPS method: bpass1.61.82.02.22.42.6ln (km/s)1.51.00.50.00.5[M/H][M/H]-0.27-0.77lgAge (yr)9.517.8716 M. Cappellari

Figure 7. Dust properties vs galaxy age. The V band attenuation AV in mag is plotted against the UV slope δ. At every δ the youngest galaxies have larger
attenuation, while the largest AV are only observed around the Calzetti et al. (2000) attenuation curve, which has δ = 0. From left to right I show results using
the fsps, galaxev and bpass SPS models. The ﬁrst two are highly consistent, but the latter, while still qualitatively similar is quantitatively very diﬀerent.

6.3 Non-parametric star formation histories

Fig. 8 shows the non-parametric star formation history of the galax-
ies in the LEGA-C sample as a function of key galaxy parameters.
For this plot I sorted the quantity of interest (e.g. σ∗) and constructed
30 bins in that quantity, each containing the same number of about
100 galaxies, in such a way that diﬀerent bins have the same level of
shot noise. I show the dependency of the SFH, parametrized as dis-
cussed by the light Lbol contributed in the spectrum by stellar popu-
lations of diﬀerent ages, as a function of the following parameters:

∼ 2.3 (or σ∗ >

(i) Stellar velocity dispersion: the plots show a clear trend of
SFH with σ∗ as expected from the trends between σ∗ and age. What
is new is the striking sharpness of the boundary between a regime
lg(σ∗/km s−1) >
∼ 200 km s−1), above which the spectra
are dominated by a population nearly as old as the Universe at that
redshift, without evidence for subsequent star formation events, and
below which suddenly galaxies have star formation at any time until
the present time. Both the fsps and galaxev SPS models indicate that
galaxies still form the bulk of their stars at old times, but this age
increases with σ∗ by roughly a factor between 6–10 for a variation
in σ∗ by a factor of 10. In the case of the galaxev models, the SFH
indicate ongoing star formation at the lowest σ∗ bins, while this is
less so for the fsps models.

(ii) Galaxy mass: contrary to the dependency of SFH with σ∗,
the trend is more gradual as a function of stellar mass. Only galaxies
more massive than lg(M∗/M(cid:12)) >
∼ 11.5 are characterized by a single
event of star formation at old times.

(iii) Galaxy metallicity: this panel shows that [M/H] is as
good as σ∗ at predicting the boundary between the region of fully
quenched galaxies and those that can have multiple star forma-
tion events. Here it happens at [M/H] ≈ −0.2 for the fsps and
[M/H] ≈ 0.0 for the galaxev, which are systematically shifted to
larger values of metallicity.

(iv) Sersic index: This panel show the SFH as a function of the
Sersic (1968) exponent nSer. The boundary between fully quenched
galaxies and galaxies that can have multiple star formation events
happens here at lg nSer ≈ 0.5 or nSer ≈ 3.2. Remarkably this bound-
ary is here nearly as clean as that with σ∗.

In all panels, the results using the bpass SPS models are again quite
diﬀerent from the other two. They show signiﬁcant structure at spe-
ciﬁc ages and a less clear quenching boundary. The structure seen
using the bpass models is likely an artefact of the SPS rather than a
real conspiracy in the star formation events.

MNRAS 000, 1–20 (2022)

The trends for diﬀerent galaxy parameters, and the overall con-
sistency between the four panels, for both the fsps and galaxev SPS
models, can be understood by looking at Fig. 5 and noting that there
is a region lg(M∗/M(cid:12)) >
∼ 11.5 above which all galaxies are quenched,
high metallicity and have large Sersic index. Below that mass galax-
ies follow a trend of increasing bulge fraction, which increases σ∗,
metallicity and makes galaxies more likely to quench. These results
parallel those which have been extensively reported for local galax-
ies (see review by Cappellari 2016). What is new here is the clarity
and sharpness of the empirical evidence of the boundary to quench-
ing and the fact that this can be detected so well at a time when the
Universe was half of its current age.

A rapid cessation of star formation for galaxies above a given crit-
ical value of σ∗, or of some other estimate of the central stellar den-
sity, varying with z, has often been invoked to explain the evolution
of galaxy parameters over time (e.g. van Dokkum et al. 2015). An
excellent review of the empirical evidence and models of a quench-
ing boundary in galaxies is given in Chen et al. (2020, sec. 1). The
physical mechanism for quenching is still under debate. Very brieﬂy,
one can group the main proposed theories into three broad classes:
(i) “halo quenching”, where the gas gets shock-heated when falling
into the gravitational potential of massive dark halos (e.g. Dekel
& Birnboim 2006); (ii) “active galactic nucleus (AGN) feedback”,
where a jet from the supermassive black hole either ejects the gas
from its host galaxy (e.g. Silk & Rees 1998) or prevent it from in-
falling (e.g. Bower et al. 2006; Croton et al. 2006). See review by
Somerville & Dav´e (2015). The panels in Fig. 8 provide a beautiful
empirical conﬁrmation of the theoretical assumptions that are made
in many of those models.

6.4 Non-parametric joint SFH and metallicity distributions

Fig. 9 presents the non-parametric joint luminosity distribution of
the age and metallicities of the stellar populations of galaxies in four
diﬀerent bins of σ∗. As in Fig. 8, also for this ﬁgure I sorted galax-
ies as a function of their σ∗ and constructed four groups, of about
800 galaxies each, to ensure all panels have the same level of shot
noise. Like before, I compare all three SPS models (fsps, galaxev
and bpass). In addition, In the second row of Fig. 9 I show the result
when using the fsps model but adopting the photometric measure-
ments from COSMOS 2020 (Weaver et al. 2022) instead of the Ul-
traVista catalogue (Muzzin et al. 2013). The ﬁrst and second rows
are barely distinguishable and this shows that any possible diﬀer-

0.750.500.250.000.250.00.51.01.52.02.5AVSPS method: fspslgAge (yr)9.258.090.750.500.250.000.250.00.51.01.52.02.5AVSPS method: galaxevlgAge (yr)9.158.020.750.500.250.000.250.00.51.01.52.02.5AVSPS method: bpasslgAge (yr)9.057.74ppxf with spectra and photometry at redshift z ≈ 0.8

17

Figure 8. Star formation history (SFH) vs galaxy properties. In all panels, the colours represent the SFH recovered with ppxf (with regul=100) parametrized by
the bolometric light Lbol fraction contributed by populations of diﬀerent ages. The SFHs are shown as a function of key galaxy parameters: the stellar velocity
dispersion σ∗, the stellar mass M∗, the luminosity weighted metallicity (cid:104)[M/H](cid:105) and the exponent nSer of a Sersic proﬁle ﬁtted to the galaxy photometry (see
text for deﬁnitions). Average values are computed for equal bins in σ∗ (or the other parameters) of 100 galaxies each. Galaxies with largest σ∗, M∗, (cid:104)[M/H](cid:105)
or nSer on average experienced their main star formation event long ago, but the typical age for the bulk of their star formation increases with σ∗ (or the other
parameters) as indicated by the slanted black dashed wavy lines in the left and right panels. For lower σ∗ galaxies can form the stars at any time until the
present. The plots show a beautifully clear and sharp quenching boundary at lg(σ∗/km s−1) ≈ 2.3, or (cid:104)[M/H](cid:105) ≈ −0.2 for fsps and (cid:104)[M/H](cid:105) ≈ 0 for galaxev,
or lg nSer ≈ 0.5, as indicated by the vertical yellow dashed wavy lines. The boundary is more gradual as a function of mass and roughly happens around
lg(M∗/M(cid:12)) ≈ 11.5. Note the generally good agreement between the results from the fsps and galaxev SPS. The results using the bpass models look problematic,
with spurious structures at speciﬁc ages, which are most likely artefacts of the models.

ence in the photometric calibration has a completely insigniﬁcant
eﬀect on the results. The distribution from both fsps and galaxev is
highly consistent, almost at the level of the individual “blobs”, with
the exception of slightly older younger ages and higher metallicities
for the galaxev vs the fsps models.

As expected, the bpass models show again quite diﬀerent results,
with a markedly diﬀerent metallicity distribution. As commented
earlier, the results from this model should be treated with caution as
they are likely dominated by spurious unknown eﬀects in the mod-
els.

The plots indicate that even galaxies with low σ∗ are still domi-
nated by stars with high metallicity, but this is diluted by extra lower-
metallicity populations acquired at diﬀerent times. I should stress
that the relatively smooth distribution in the maps are averages of
many galaxies and should not be interpreted as the evolution of one
individual galaxy, which is generally characterized by discrete star
formation events.

A caveat on these results on the metallicity distribution, which
also aﬀects other similar results on metallicity determinations from
galaxy stellar spectra, is that the signature of metallicity variations
becomes weaker at younger ages, where the S /N of the data also
generally decreases. This can introduce possible systematic eﬀects
on metallicity trends. To exclude the eﬀect of S /N, I veriﬁed that all
results remain unchanged if I restrict the analysis to the 873 galaxies

MNRAS 000, 1–20 (2022)

1.61.82.02.22.4lg (km s1)678910lg Age (yr)Quenching Boundary10.010.511.011.5lgM (M)1.000.750.500.250.00[M/H]0.50.00.5lgnSerMain Star Formation0.000.020.040.060.080.10Light Fraction (Lbol)Star Formation History vs Galaxy Properties (SPS: fsps)1.61.82.02.22.4lg (km s1)678910lg Age (yr)Quenching Boundary10.010.511.011.5lgM (M)0.750.500.250.00[M/H]0.50.00.5lgnSerMain Star Formation0.000.020.040.060.080.10Light Fraction (Lbol)Star Formation History vs Galaxy Properties (SPS: galaxev)1.61.82.02.22.4lg (km s1)678910lg Age (yr)10.010.511.011.5lgM (M)0.80.60.40.2[M/H]0.50.00.5lgnSer0.000.020.040.060.080.10Light Fraction (Lbol)Star Formation History vs Galaxy Properties (SPS: bpass)18 M. Cappellari

Figure 9. Joint star-formation history (SFH) and metallicity distributions. Each panel shows the average distribution of weights recovered with ppxf (with
regul=10) for 4 bins containing 800 LEGA-C galaxies sorted by their stellar velocity dispersion σ∗ (as indicated in the plot titles). The weights represent the
bolometric luminosity Lbol contributed by populations of diﬀerent ages and metallicities. The top row shows the results obtained with the fsps SPS models, the
second row still uses fsps but adopts the COSMOS 2020 (Weaver et al. 2022) instead of the UltraVista photometric catalogue (Muzzin et al. 2013). The third row
is derived using the galaxev SPS models and the bottom one with the bpass models. One can see that the fsps and galaxev SPS provide qualitatively consistent
results even for some of the main “blobs” in the distributions. Using an alternative photometric catalogue has virtually no eﬀect on the results. At large σ∗
galaxies on average quenched long ago and their stars have high metallicity. At progressively lower σ∗ the age of the bulk of the star formation decreases, while
still being dominated by high metallicity stars. However, the population is polluted by fresh accretion events of lower metallicity and a range of accretion times.
As previously noted, the results using bpass SPS models are signiﬁcantly diﬀerent and should not be trusted, without further analysis.

with S /N > 20 and even, at coarser resolution, for the subset of 126
galaxies with S /N > 40. It would still be valuable to compare the
reported metallicity trends e.g. with those inferred from gas tracers
from similar data.

7 SUMMARY

In the ﬁrst half of this paper, I described some modiﬁcations to the
ppxf method (Cappellari 2017), which is used to extract the stel-
lar and gas kinematics, as well as the stellar population of galaxies.
First, I described a novel constrained least-squares optimization al-
gorithm that ppxf has been using for the past few years. Then I out-
lined the changes I made to ppxf to be able to ﬁt photometric data
together with the usual full-spectrum ﬁtting. I also described some
other minor changes.

In the second half of the paper, I presented an application of
ppxf to the extraction of non-parametric star formation histories and
metallicity distributions for a sample of 3200 galaxies at redshift
0.6 < z < 1 with spectroscopy from the LEGA-C survey DR3
(van der Wel et al. 2021), and with 28-bands photometric measure-
ments covering from the far ultraviolet (0.1 µm) to the near-infrared

MNRAS 000, 1–20 (2022)

(3 µm) from either the UltraVista (Muzzin et al. 2013) or the COS-
MOS 2020 catalogues (Weaver et al. 2022).

For this study, I used and compared three spectral population syn-
thesis (SPS) methods satisfying some criteria of age and wavelength
coverage. This led to my selection of the fsps (Conroy et al. 2009;
Conroy & Gunn 2010), galaxev (Bruzual & Charlot 2003) and bpass
(Stanway & Eldridge 2018; Byrne et al. 2022) SPS methods.

I found that ppxf on these data reveals a striking diﬀerence be-
tween galaxies that are only consistent with a single star formation
event from those that require multiple bursts of star formation.

I constructed scaling relations for the global stellar population pa-
rameters and found a remarkable similarity, but even clearer trends,
between these results at z ≈ 0.8 and those from the latest spectro-
scopic surveys in the nearby Universe. This gives some conﬁdence
in the meaningfulness of the results and highlights the quality of the
spectro-photometric data.

Finally, I explored the non-parametric star formation histories
(SFH) and the joint SFH and metallicity [M/H] distributions. I
found that the data indicate, on average over many galaxies, a re-
markably sharp boundary for the cessation of star formation (or
quenching), at a stellar velocity dispersion σ∗ ≈ 200 km s−1, or
equivalently at metallicity [M/H] ≈ −0.1 (with some variation

678910lg Age (yr)1.51.00.50.0[M/H]20<<122 km s1678910lg Age (yr)122<<161 km s1678910lg Age (yr)161<<203 km s1678910lg Age (yr)SPS method fsps203<<486 km s10.20.40.60.81.0Lbol/max(Lbol)678910lg Age (yr)1.51.00.50.0[M/H]20<<122 km s1678910lg Age (yr)122<<161 km s1678910lg Age (yr)161<<203 km s1678910lg Age (yr)SPS method fspsCOSMOS 2020 photometry203<<486 km s10.20.40.60.81.0Lbol/max(Lbol)678910lg Age (yr)210[M/H]20<<122 km s1678910lg Age (yr)122<<161 km s1678910lg Age (yr)161<<203 km s1678910lg Age (yr)SPS method galaxev203<<486 km s10.20.40.60.81.0Lbol/max(Lbol)678910lg Age (yr)1.00.50.0[M/H]20<<122 km s1678910lg Age (yr)122<<161 km s1678910lg Age (yr)161<<203 km s1678910lg Age (yr)SPS method bpass203<<486 km s10.20.40.60.81.0Lbol/max(Lbol)ppxf with spectra and photometry at redshift z ≈ 0.8

19

dependent on the adopted SPS model) or at Sersic (1968) index
lg nSer ≈ 0.5. As expected, the boundary is less sharp as a function
of stellar mass. This abrupt quenching boundary has been invoked
by several models of galaxy formation. These data provide one of
the cleanest empirical evidence to date.

This paper only scratches the surface of what can be done with
this dataset and with similar ones that are being acquired at compa-
rable and higher redshift. I have not explored e.g. obvious dependen-
cies between SFH and stellar kinematics or environment (Cole et al.
2020; Sobral et al. 2022, e.g.). Comparisons with galaxy formation
models should be performed in the space of observable rather than
using stellar masses which are empirically more uncertain. A similar
analysis at higher redshift can reveal the onset and variation of the
quenching boundary, which is a key but still a quite uncertain pa-
rameter in galaxy formation models. James Webb Space Telescope
(JWST) data are ideal to extend this kind of study to higher redshift.

REFERENCES

Cappellari M., 2011, in Paper presented at the conference on Galaxy Forma-
tion held 18–22 July, 2011 at Durham University, Durham, UK. Online
at http://astro.dur.ac.uk/Gal2011/talks.php.

Cappellari M., 2016, ARA&A, 54, 597
Cappellari M., 2017, MNRAS, 466, 798
Cappellari M., Emsellem E., 2004, PASP, 116, 138
Cappellari M., et al., 2011, MNRAS, 413, 813
Cappellari M., et al., 2013a, MNRAS, 432, 1709
Cappellari M., et al., 2013b, MNRAS, 432, 1862
Carnall A. C., McLure R. J., Dunlop J. S., Dav´e R., 2018, MNRAS, 480,

4379

Charlot S., Fall S. M., 2000, ApJ, 539, 718
Chauke P., et al., 2018, ApJ, 861, 13
Chauke P., et al., 2019, ApJ, 877, 48
Chen Y.-P., Trager S. C., Peletier R. F., Lanc¸on A., Vazdekis A., Prugniel P.,

Silva D. R., Gonneau A., 2014, A&A, 565, A117

Chen Z., et al., 2020, ApJ, 897, 102
Cheung E., et al., 2012, ApJ, 760, 131
Chevallard J., Charlot S., 2016, MNRAS, 462, 1415
Cid Fernandes R., Mateus A., Sodr´e L., Stasi´nska G., Gomes J. M., 2005,

MNRAS, 358, 363

Cleveland W. S., Devlin S. J., 1988, Journal of the American Statistical As-

Aihara H., et al., 2019, Publications of the Astronomical Society of Japan,

sociation, 83, 596

71

Andersen M., Dahl J., Liu Z., Vandenberghe 2011, in Lieven Sra S., Nowozin
S., Wright S. J., eds, , Optimization for Machine Learning. MIT Press
Cambridge, MA, pp 55–83, doi:10.7551/mitpress/8996.003.0005
Andersson C. A., Bro R., 2000, Chemometrics and Intelligent Laboratory

Systems, 52, 1

Arnouts S., et al., 2002, MNRAS, 329, 355
Baade W., 1963, Evolution of Stars and Galaxies. Harvard University Press,

doi:10.4159/harvard.9780674280311

Bacon R., et al., 2010, in McLean I. S., Ramsay S. K., Takami H., eds, SPIE
Conference Series Vol. 7735, Ground-based and Airborne Instrumenta-
tion for Astronomy III. p. 8, doi:10.1117/12.856027
Baldry I. K., 2018, arXiv e-prints, p. arXiv:1812.05135
Barone T. M., et al., 2018, ApJ, 856, 64
Barone T. M., D’Eugenio F., Colless M., Scott N., 2020, ApJ, 898, 62
Barone T. M., et al., 2022, MNRAS, 512, 3828
Belﬁore F., et al., 2019, AJ, 158, 160
Bell E. F., McIntosh D. H., Katz N., Weinberg M. D., 2003, ApJS, 149, 289
Bell E. F., et al., 2012, ApJ, 753, 167
Belli S., Newman A. B., Ellis R. S., 2014, ApJ, 783, 117
Belli S., Newman A. B., Ellis R. S., 2017, ApJ, 834, 18
Ben´ıtez N., 2000, ApJ, 536, 571
Bessell M., Murphy S., 2012, PASP, 124, 140
Bevacqua D., Cappellari M., Pellegrini S., 2022, MNRAS, 511, 139
Beverage A. G., Kriek M., Conroy C., Bezanson R., Franx M., van der Wel

A., 2021, ApJ, 917, L1

Bezanson R., et al., 2018, ApJ, 868, L36
Bolzonella M., Miralles J. M., Pell´o R., 2000, A&A, 363, 476
Bower R. G., Benson A. J., Malbon R., Helly J. C., Frenk C. S., Baugh C. M.,

Cole J., et al., 2020, ApJ, 890, L25
Conroy C., 2013, ARA&A, 51, 393
Conroy C., Gunn J. E., 2010, ApJ, 712, 833
Conroy C., Gunn J. E., White M., 2009, ApJ, 699, 486
Cooley J. W., Tukey J. W., 1965, Mathematics of computation, 19, 297
Croton D. J., et al., 2006, MNRAS, 365, 11
Davidson R., Flachaire E., 2008, Journal of Econometrics, 146, 162
Dekel A., Birnboim Y., 2006, MNRAS, 368, 2
Devriendt J. E. G., Guiderdoni B., Sadat R., 1999, A&A, 350, 381
Efron B., 2011, Journal of Biopharmaceutical Statistics, 21, 1052
Efron B., Tibshirani R. J., 1994, An Introduction to the Bootstrap (Mono-
graphs on Statistics and Applied Probability). Chapman & Hall/CRC,
doi:10.1201/9780429246593

Emsellem E., et al., 2011, MNRAS, 414, 888
Esdaile J., et al., 2021, ApJ, 908, L35
Falc´on-Barroso J., S´anchez-Bl´azquez P., Vazdekis A., Ricciardelli E., Cardiel
N., Cenarro A. J., Gorgas J., Peletier R. F., 2011, A&A, 532, A95

Fang J. J., Faber S. M., Koo D. C., Dekel A., 2013, ApJ, 776, 63
Feldmann R., et al., 2006, MNRAS, 372, 565
Ferland G. J., Korista K. T., Verner D. A., Ferguson J. W., Kingdon J. B.,

Verner E. M., 1998, PASP, 110, 761

Ferland G. J., et al., 2013, Rev. Mex. Astron. Astroﬁs., 49, 137
Feroz F., Hobson M. P., Bridges M., 2009, MNRAS, 398, 1601
Fletcher R., 1987, Practical Methods of Optimization. John Wiley & Sons,

Ltd, doi:10.1002/9781118723203

Foreman-Mackey D., Hogg D. W., Lang D., Goodman J., 2013, PASP, 125,

306

Forrest B., et al., 2022, arXiv e-prints, p. arXiv:2208.04329
Franx M., van Dokkum P. G., Schreiber N. M. F., Wuyts S., Labb´e I., Toft S.,

Cole S., Lacey C. G., 2006, MNRAS, 370, 645

2008, ApJ, 688, 770

Brady M., Horn B. K. P., 1983, Computer Vision, Graphics, and Image Pro-

cessing, 22, 70

Brammer G. B., van Dokkum P. G., Coppi P., 2008, ApJ, 686, 1503
Branch M. A., Coleman T. F., Li Y., 1999, SIAM Journal on Scientiﬁc Com-

puting, 21, 1

Bruzual G., Charlot S., 2003, MNRAS, 344, 1000
Bryant J. J., et al., 2015, MNRAS, 447, 2857
Bundy K., et al., 2015, ApJ, 798, 7
Bunn E. F., Hogg D. W., 2009, American Journal of Physics, 77, 688
Byrne C. M., Stanway E. R., Eldridge J. J., McSwiney L., Townsend O. T.,

2022, MNRAS, 512, 5329

Calzetti D., Armus L., Bohlin R. C., Kinney A. L., Koornneef J., Storchi-

Bergmann T., 2000, ApJ, 533, 682

Capak P., et al., 2007, ApJS, 172, 99
Cappellari M., 2008, MNRAS, 390, 71

Getreuer P., 2011, Image Processing On Line, 1, 238
Gill P. E., Murray W., Wright M. H., 1981, Practical Optimization. Society
for Industrial and Applied Mathematics, doi:10.1137/1.9781611975604

Gill P. E., Murray W., Saunders M. A., 2005, SIAM Review, 47, 99
Golub G. H., 2013, Matrix computations, 4th edition. John Hopkins
Granato G. L., Lacey C. G., Silva L., Bressan A., Baugh C. M., Cole S.,

Frenk C. S., 2000, ApJ, 542, 710

Greengard L., Lee J.-Y., 2004, SIAM Review, 46, 443
Gustafsson B., Edvardsson B., Eriksson K., Jørgensen U. G., Nordlund Å.,

Plez B., 2008, A&A, 486, 951

Hamadouche M. L., et al., 2022, MNRAS, 512, 1262
Hansen P. C., 1998, Rank-deﬁcient and discrete ill-posed problems: numeri-
cal aspects of linear inversion. Mathematical Modeling and Computation
Vol. 4, Siam, Philadelphia, doi:10.1137/1.9780898719697

Hogg D. W., 1999, preprint, (arXiv:astro-ph/9905116)

MNRAS 000, 1–20 (2022)

20 M. Cappellari

Huangfu Q., Hall J. A. J., 2017, Mathematical Programming Computation,

10, 119

Johnson B., et al., 2021a, dfm/python-fsps: python-fsps v0.4.1rc1,

doi:10.5281/ZENODO.4737461

Johnson B. D., Leja J., Conroy C., Speagle J. S., 2021b, ApJS, 254, 22
Kabanikhin S. I., 2011, Inverse and Ill-posed Problems. de Gruyter, Berlin,

doi:10.1515/9783110224016

Kacharov N., Neumayer N., Seth A. C., Cappellari M., McDermid R.,

Walcher C. J., B¨oker T., 2018, MNRAS, 480, 1973

Kauﬀmann G., et al., 2003, MNRAS, 341, 33
Kriek M., Conroy C., 2013, ApJ, 775, L16
Kriek M., van Dokkum P. G., Labb´e I., Franx M., Illingworth G. D., March-

esini D., Quadri R. F., 2009, ApJ, 700, 221

Lacerda E. A. D., S´anchez S. F., Mej´ıa-Narv´aez A., Camps-Fari˜na A.,
Espinosa-Ponce C., Barrera-Ballesteros J. K., Ibarra-Medel H., Lugo-
Aranda A. Z., 2022, New Astron., 97, 101895

Lampinen J., 2002, in Proceedings of the 2002 Congress on Evolution-
ary Computation. CEC'02 (Cat. No.02TH8600). IEEE, pp 1468–1473,
doi:10.1109/cec.2002.1004459

Lawson C. L., Hanson R. J., 1995, Solving least squares problems (SIAM
1995 edition). Classics in applied mathematics Vol. 15, Prentice-Hall
Inc., Englewood Cliﬀs, NJ, doi:10.1137/1.9781611971217

Le Borgne J. F., et al., 2003, A&A, 402, 433
Le F`evre O., et al., 2003, in Iye M., Moorwood A. F. M., eds, Society of
Photo-Optical Instrumentation Engineers (SPIE) Conference Series Vol.
4841, Instrument Design and Performance for Optical/Infrared Ground-
based Telescopes. pp 1670–1681, doi:10.1117/12.460959

Lena D., et al., 2015, ApJ, 806, 84
Levenberg K., 1944, Quarterly of Applied Mathematics, 2, 164
Li H., et al., 2018, MNRAS, 476, 1765
Lower S., Narayanan D., Leja J., Johnson B. D., Conroy C., Dav´e R., 2020,

ApJ, 904, 33

Lower S., Narayanan D., Leja J., Johnson B. D., Conroy C., Dav´e R., 2022,

ApJ, 931, 14

MacKay D. J. C., 1992, Neural Computation, 4, 415
MacKay D. J. C., 2003, Information Theory, Inference & Learning Al-
gorithms. Cambridge University Press, http://www.inference.org.uk/
mackay/itila/

Maraston C., 2005, MNRAS, 362, 799
Maraston C., Str¨omb¨ack G., 2011, MNRAS, 418, 2785
Maraston C., et al., 2020, MNRAS, 496, 2962
Markwardt C. B., 2009, in D. A. Bohlender D. Durand . P. D., ed., Astro-
nomical Society of the Paciﬁc Conference Series Vol. 411, Astronomical
Data Analysis Software and Systems XVIII. p. 251 (arXiv:0902.2850)
Marquardt D. W., 1963, Journal of the Society for Industrial and Applied

Mathematics, 11, 431

Martin D. C., et al., 2005, ApJ, 619, L1
McCracken H. J., et al., 2012, A&A, 544, A156
Mendel J. T., et al., 2020, ApJ, 899, 87
Mitzkus M., Cappellari M., Walcher C. J., 2017, MNRAS, 464, 4789
Mor´e J. J., 1978, in , Lecture Notes in Mathematics. Springer Berlin Heidel-

berg, pp 105–116, doi:10.1007/bfb0067700

Mor´e J. J., Garbow B. S., Hillstrom K. E., 1980, User guide for MINPACK-
1. Argonne National Laboratory Argonne, IL, http://cds.cern.ch/record/
126569

Muzzin A., et al., 2013, ApJ, 777, 18
Nocedal J., Wright S., 2006, Numerical Optimization. Springer Series in
Operations Research and Financial Engineering, Springer, New York,
doi:10.1007/978-0-387-40065-5
Noll S., et al., 2009, A&A, 499, 69
Ocvirk P., Pichon C., Lanc¸on A., Thi´ebaut E., 2006, MNRAS, 365, 46
Oh K., Yi S. K., Schawinski K., Koss M., Trakhtenbrot B., Soto K., 2015,

ApJS, 219, 1

Oh S., et al., 2020, MNRAS, 495, 4638
Pozzetti L., Mannucci F., 2000, MNRAS, 317, L17
Press W. H., Teukolsky S. A., Vetterling W. T., Flannery B. P., 2007, Numer-
ical recipes: The art of scientiﬁc computing, 3rd edn. Cambridge Univ.
Press, Cambridge, http://numerical.recipes/book

MNRAS 000, 1–20 (2022)

Prugniel P., Soubiran C., 2001, A&A, 369, 1048
Rubin D. B., 1981, The Annals of Statistics, 9
Salim S., Narayanan D., 2020, ARA&A, 58, 529
Salpeter E. E., 1955, ApJ, 121, 161
Salvato M., Ilbert O., Hoyle B., 2019, Nature Astronomy, 3, 212
S´anchez-Bl´azquez P., et al., 2006, MNRAS, 371, 703
S´anchez S. F., et al., 2012, A&A, 538, A8
S´anchez S. F., et al., 2016, Rev. Mex. Astron. Astroﬁs., 52, 21
Sanders D. B., et al., 2007, ApJS, 172, 86
Scott N., et al., 2017, MNRAS, 472, 2833
Sersic J. L., 1968, Atlas de galaxias australes. Obs. Astron. Univ. Nacional

de C´ordoba, C´ordoba

Shen S., Mo H. J., White S. D. M., Blanton M. R., Kauﬀmann G., Voges W.,

Brinkmann J., Csabai I., 2003, MNRAS, 343, 978

Shetty S., Cappellari M., 2015, MNRAS, 454, 1332
Shetty S., Bershady M. A., Westfall K. B., Cappellari M., Drory N., Law

D. R., Yan R., Bundy K., 2020, ApJ, 901, 101

Silk J., Rees M. J., 1998, A&A, 331, L1
Silva L., Granato G. L., Bressan A., Danese L., 1998, ApJ, 509, 103
Sobral D., et al., 2022, ApJ, 926, 117
Somerville R. S., Dav´e R., 2015, ARA&A, 53, 51
Speagle J. S., 2020, MNRAS, 493, 3132
Stanway E. R., Eldridge J. J., 2018, MNRAS, 479, 75
Stark P. B., Parker R. L., 1995, Computational Statistics, 10, 129
Storey P. J., Hummer D. G., 1995, MNRAS, 272, 41
Storn R., Price K., 1997, Journal of Global Optimization, 11, 341
Straatman C. M. S., et al., 2018, ApJS, 239, 27
Tabor M., Merriﬁeld M., Arag´on-Salamanca A., Cappellari M., Bamford

S. P., Johnston E., 2017, MNRAS, 466, 2024

Tabor M., Merriﬁeld M., Arag´on-Salamanca A., Fraser-McKelvie A., Pe-
terken T., Smethurst R., Drory N., Lane R. R., 2019, MNRAS, 485, 1546

Tacchella S., et al., 2022, ApJ, 926, 134
Taniguchi Y., et al., 2007, ApJS, 172, 9
Tojeiro R., Heavens A. F., Jimenez R., Panter B., 2007, MNRAS, 381, 1252
Vazdekis A., S´anchez-Bl´azquez P., Falc´on-Barroso J., Cenarro A. J., Beasley
M. A., Cardiel N., Gorgas J., Peletier R. F., 2010, MNRAS, 404, 1639

Vazdekis A., et al., 2015, MNRAS, 449, 1177
Venturi G., et al., 2021, A&A, 648, A17
Verro K., et al., 2022a, A&A, 660, A34
Verro K., et al., 2022b, A&A, 661, A50
Virtanen P., et al., 2020, Nature Methods, 17, 261
Voglis C., Lagaris I. E., 2004, in WSEAS International Conference on Ap-

plied Mathematics. Corfu, Greece

Wake D. A., van Dokkum P. G., Franx M., 2012, ApJ, 751, L44
Walcher J., Groves B., Budav´ari T., Dale D., 2011, Ap&SS, 331, 1
Weaver J. R., et al., 2022, ApJS, 258, 11
Westera P., Lejeune T., Buser R., Cuisinier F., Bruzual G., 2002, A&A, 381,

524

Westfall K. B., et al., 2019, AJ, 158, 231
Wilkinson D. M., Maraston C., Goddard D., Thomas D., Parikh T., 2017,

MNRAS, 472, 4297

Worthey G., 1994, ApJS, 95, 107
Worthey G., Faber S. M., Gonzalez J. J., Burstein D., 1994, ApJS, 94, 687
Yan R., et al., 2019, ApJ, 883, 175
van Dokkum P. G., et al., 2015, ApJ, 813, 23
van de Sande J., et al., 2013, ApJ, 771, 85
van der Wel A., et al., 2014, ApJ, 788, 28
van der Wel A., et al., 2016, ApJS, 223, 29
van der Wel A., et al., 2021, ApJS, 256, 44

This paper has been typeset from a TEX/LATEX ﬁle prepared by the author.

