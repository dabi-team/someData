Simulating electron energy-loss spectroscopy and 

cathodoluminescence for particles in arbitrary host medium 

using the discrete dipole approximation 

Alexander A. Kichigin1,2 and Maxim A. Yurkin1,2,* 

1Voevodsky Institute of Chemical Kinetics and Combustion SB RAS,  

Institutskaya Str. 3, 630090, Novosibirsk, Russia 

2 Novosibirsk State University, Pirogova Str. 2, 630090, Novosibirsk, Russia 

*Corresponding author: yurkin@gmail.com 

Abstract 
Electron energy-loss spectroscopy (EELS) and cathodoluminescence (CL) are widely used 

experimental 

techniques  for  characterization  of  nanoparticles.  The  discrete  dipole 

approximation  (DDA)  is  a  numerically  exact  method  for  simulating  interaction  of 

electromagnetic waves with particles of arbitrary shape and internal structure. In this work we 

extend  the  DDA  to  simulate  EELS  and  CL  for  particles  embedded  into  arbitrary  (even 

absorbing)  unbounded  host  medium.  The  latter  includes  the  case  of  the  dense  medium, 

supporting the Cherenkov radiation of the electron, which has never been considered in EELS 

simulations before. We build a rigorous theoretical framework based on the volume-integral 

equation, final expressions from which are implemented in the open-source software package 

ADDA.  This  implementation  agrees  with  both  the  Lorenz-Mie  theory  and  the  boundary-

element method for spheres in vacuum and moderately dense host medium. And it successfully 

reproduces the published experiments for particles encapsulated in finite substrates. The latter 

is shown for both moderately dense and Cherenkov cases â€“ a gold nanorod in SiO2 and a silver 

sphere in SiNx, respectively. 

Keywords:  electron  energy-loss  spectroscopy,  cathodoluminescence,  discrete  dipole 

approximation, Cherenkov radiation, host medium 

1 

 
 
 
1  Introduction 

Optical excitations of small objects have been gaining interest over the past decades. The 

quest  for  the  highest  possible  space-energy  resolution  is  unachievable  by  purely  optical 

methods due to the diffraction limit.[1] This limit can be overcome using fast electrons as a 

probe instead of light â€“ the corresponding experimental technique is called the electron energy-

loss  spectroscopy  (EELS).  EELS  is  a  well-developed  extension  of  the  standard  electron 

microscope,[2] where a particle under study is exposed to a beam of relativistic electrons with 

the same kinetic energies of the order of 100 keV. The energies of transmitted electrons are 

measured  leading  to  the  energy-loss  spectrum  (EELS  spectrum).  Currently,  EELS  provides 

information  about  excitations  with  sub-Ã…  and  few-meV  space-energy  resolution.[3]  While 

exposed  to  an  electron  beam,  the  particle  emits  photons  â€“  this  phenomenon,  called 

cathodoluminescence  (CL),  also  provides  information  about  photonic  properties.[4]  To 

accurately  interpret  the  results  of  an  EELS  or  CL  experiment,  it  is  necessary  to  have  a 

theoretical description of particle interaction with the electromagnetic field of a fast electron, 

complemented by a simulation method. 

There  are  many  methods  capable  of  simulating  EELS,  from  the  analytical  Lorenz-Mie 

theory for spheres[5] to surface-discretization boundary-element method (BEM)[6] and volume-

discretization  methods,  such  as  finite-difference  time-domain[7]  and  the  discrete-dipole 

approximation  (DDA).[8,9]  While  a  theoretical  description  of  EELS  can  be  developed  in  a 

general setting of a particle placed in arbitrary infinite host medium, most of the numerical 

methods apply only to vacuum environment. The notable exception is MNPBEM,[10] which 

seems to support arbitrary infinite host medium by its internal parameters. However, this option 

is poorly documented and the corresponding simulations have been performed only for the case 

of non-absorbing medium with relatively low density.[11,12] 

Thus, the simulation capabilities do not fully support the experimental conditions, where 

the particle is always placed on or inside a substrate, or require discretizing a large chunk of 

substrate  in  addition  to  the  particle  itself.  The  presence  of  a  substrate  affects  the  EELS/CL 

spectra.[13] e.g., by redshifting localized surface plasmon resonances (LSPRs) with increasing 

host-medium refractive index.[14] Although the development of very thin substrates has made 

the  experimental  results  close  to  vacuum  simulations,[15,13]  some  experimental  studies 

intentionally consider particles inside a substrate.[16,12,17] Importantly, sufficiently dense host 

medium may slow down the light below the electron speed, leading to qualitatively different 

2 

case of Cherenkov radiation.[16] This case may become more common with increasing electron 

energy, but has never been considered in numerical simulations of EELS. 

The  goal  of  this  paper  is  to  enhance  the  capabilities  of  EELS/CL  simulations  using  the 

DDA â€“ a numerically exact method for simulating interaction of electromagnetic waves with 

particles  of  arbitrary  shape  and  internal  structure,[18]  based  on  the  volume  integral  equation 

(VIE)  in  the  frequency  domain.[19]  The  popularity  of  the  DDA  is  based  on  conceptual 

simplicity,  combined  with  availability  of  two  open-source  highly-optimized  codes: 

DDSCAT[20] and ADDA.[21] Initially designed for simulating interaction of particles with plane 

waves,[20] the DDA is applicable to arbitrary electromagnetic fields,[18] including the field of a 

fast  electron.  The  latter  has  been  exemplified  by  two  specialized  codes:  DDEELS[8]  and  e-

DDA,[9]  which,  however,  assume  the  vacuum  surrounding.  Moreover,  the  underlying  VIE-

based theory of EELS is available only for this case.[8,9,22] 

In  this  paper  we,  first,  construct  a  general  theoretical  framework  of  EELS  and  CL  for 

particles  in  arbitrary  host  medium  (Section  2),  based  on  the  VIE  and  energy-budget 

considerations.[23] When the host medium is absorbing or incurs Cherenkov radiation, particle-

induced  energy  losses  are  accompanied  by  free-space  ones.  We  discuss  the  feasibility  of 

separating  these  two  losses  in  experimental  signals  in  Sections  2.5  and  2.6.  Moreover,  we 

extend  the  scale  invariance  rule  of  electromagnetics  to  EELS  simulations,  expanding  the 

applicability domain of existing vacuum-based codes in Section 2.7. 

Second, we implement the obtained general expressions in the ADDA code together with 

a dedicated Python library, allowing wide range of EELS and CL simulations in arbitrary host 

medium  out  of  the  box  (Section  3.1).  Next,  we  demonstrate  the  high  accuracy  of  this 

implementation in comparison with the Lorenz-Mie theory and MNPBEM for a test sphere in 

vacuum (Section 3.2) and various host media (Section 3.3). The latter comparison highlights 

the limitations of MNPBEM in Cherenkov case. Finally, Section 3.4 demonstrates the practical 

applicability of the updated ADDA code by accurately reproducing experimental EELS data 

for a silver nanosphere encapsulated in non-absorbing Cherenkov host medium[16] and for a 

nanowire  placed  inside  glass  substrate.[12]  We  use  SI  units  throughout  the  manuscript,  and 

preliminary results of this paper have been presented in [24,25]. 

2  Theory 
2.1  Energy budget for time-harmonic sources 

This section is based on [19,23,26]. Let us define the current density of time-harmonic external 

sources 

  to  be  independent  of  the  resulting  electromagnetic  field  and  consider 

ğ‰ğ‰s(ğ«ğ«)

3 

nonmagnetic (

) isotropic host medium with dielectric permittivity 

 (

 is its 

refractive index). The incident (or â€œsource-generatedâ€) electromagnetic field must satisfy the 

2
ğœ€ğœ€h = ğ‘šğ‘šh

ğœ€ğœ€0

ğ‘šğ‘šh

ğœ‡ğœ‡ = ğœ‡ğœ‡0
Maxwell equations in 

: 

3
â„

Below we consider the cases of non-absorbing (

ğ›ğ› Ã— ğ„ğ„inc(ğ«ğ«) = iğœ”ğœ”ğœ‡ğœ‡0ğ‡ğ‡inc(ğ«ğ«),
ğ›ğ› Ã— ğ‡ğ‡inc(ğ«ğ«) = âˆ’iğœ”ğœ”ğœ€ğœ€hğ„ğ„inc(ğ«ğ«) + ğ‰ğ‰s(ğ«ğ«).

) and absorbing (

(1) 

) host media. In 

both  cases  we  assume 

  (passive  medium)  and  therefore 

ğœ€ğœ€h âˆˆ â„

, 

where 

 is the complex argument, for which we assume the range 

0 â‰¤ arg ğœ€ğœ€h < ğœ‹ğœ‹

A  particle  is  a  nonmagnetic  object  with  finite  volume 

arg

0 â‰¤ arg ğ‘šğ‘šh < ğœ‹ğœ‹ 2â„
  and  complex  isotropic 
(âˆ’ğœ‹ğœ‹, ğœ‹ğœ‹]
 is the particleâ€™s refractive index). Then the 

ğ‘‰ğ‘‰int

permittivity distribution 

 (

dielectric permittivity function in the whole space is 

(ğ«ğ«)ğœ€ğœ€0

ğ‘šğ‘šp(ğ«ğ«)

2
ğœ€ğœ€p(ğ«ğ«) = ğ‘šğ‘šp

ğœ€ğœ€h âˆˆ â„‚
. 

ğœ€ğœ€(ğ«ğ«) â‰ ï¿½
  is  the  refractive  index  relative  to  the  host  medium: 
ğ«ğ« âˆˆ ğ‘‰ğ‘‰int,

ğ‘šğ‘š

ğ«ğ« âˆˆ ğ‘‰ğ‘‰ext,

ğœ€ğœ€h,
2
(ğ«ğ«)ğœ€ğœ€h,

(2) 

where 

, 

3

ğ‘šğ‘šp(ğ«ğ«) ğ‘šğ‘šhâ„
composed of the particleâ€™s volume 

. 
ğ‘‰ğ‘‰ext = â„
ğ‘šğ‘š(ğ«ğ«) â‰
The  presence  of  the  particle  changes  the  electromagnetic  field  in  the  whole  space, 

\ğ‘‰ğ‘‰int

ğ‘šğ‘š(ğ«ğ«)

 and the external volume 

. This field must satisfy 

the following Maxwellâ€™s equations: 

ğ‘‰ğ‘‰int

ğ‘‰ğ‘‰ext

(3) 

and  boundary  conditions  at  the  particle  interface.  These  equations  are  equivalent  to  the 

ğ›ğ› Ã— ğ„ğ„(ğ«ğ«) = iğœ”ğœ”ğœ‡ğœ‡0ğ‡ğ‡(ğ«ğ«),
ğ›ğ› Ã— ğ‡ğ‡(ğ«ğ«) = âˆ’iğœ”ğœ”ğœ€ğœ€(ğ«ğ«)ğ„ğ„(ğ«ğ«) + ğ‰ğ‰s(ğ«ğ«),
following volume integral equation (VIE) for the electric field 

:[19] 

ğ„ğ„(ğ«ğ«)

â€²

)

âˆ’

2

ğ‘šğ‘š

(ğ«ğ«) âˆ’ 1

3

ğ„ğ„(ğ«ğ«),

ğ‘˜ğ‘˜ = ğœ”ğœ”ï¿½ğœ€ğœ€hğœ‡ğœ‡0 = ğ‘šğ‘šhğ‘˜ğ‘˜0
ğ‘˜ğ‘˜0 = ğœ”ğœ” ğ‘ğ‘â„

(4) 

  is  the 

  is  the 

(5) 

(6) 

ğ„ğ„(ğ«ğ«) = ğ„ğ„inc(ğ«ğ«) + ğ‘˜ğ‘˜

d
\ğ‘‰ğ‘‰0 
  is  a  sphere  centered  at 

limğ‘‰ğ‘‰0â†’0 ï¿½
â„

where 

3

[ğ‘šğ‘š

) â‹… ğ„ğ„(ğ«ğ«
ğ«ğ«
  to  exclude  the  singularity, 

) âˆ’ 1]ğ†ğ†ï¿½(ğ«ğ«, ğ«ğ«

(ğ«ğ«

2

3

â€²

2

â€²

â€²

wavenumber  in  the  host  medium  (
ğ«ğ«

ğ‘‰ğ‘‰0

  is  the  speed  of  light  in  vacuum,  and 

vacuum wavenumber), 

ğ†ğ†ï¿½(ğ«ğ«, ğ«ğ«

â€²

)

 is the free-space Greenâ€™s tensor, defined as 

ğ‘ğ‘

where 

 is the identity tensor, and 

 denotes dyadic (tensor) product. 

â€²

ğ†ğ†ï¿½(ğ«ğ«, ğ«ğ«

) â‰ ï¿½ğˆğˆÌ… +

âˆ‡ âŠ— âˆ‡
2 ï¿½
ğ‘˜ğ‘˜

Incident electric field can be expressed in terms of 

âŠ—

ğˆğˆÌ…

â€²

|)
,

exp(iğ‘˜ğ‘˜|ğ«ğ« âˆ’ ğ«ğ«
â€²
|
4ğœ‹ğœ‹|ğ«ğ« âˆ’ ğ«ğ«
 as 

ğ„ğ„inc(ğ«ğ«) = iğœ”ğœ”ğœ‡ğœ‡0 limğ‘‰ğ‘‰0â†’0 ï¿½ d
ğ‘‰ğ‘‰s\ğ‘‰ğ‘‰0

3

â€²

ğ«ğ«

ğ†ğ†ï¿½(ğ«ğ«, ğ«ğ«

â€²

) â‹… ğ‰ğ‰s(ğ«ğ«

â€²

)

âˆ’ i

ğ‰ğ‰s(ğ«ğ«)
3ğœ”ğœ”ğœ€ğœ€h,

ğ‰ğ‰s(ğ«ğ«)

4 

 
 
 
 
 
 
where 

 is the volume enclosing the sources, and the exclusion of the singularity in the volume 

 makes the expression valid in the whole 

ğ‘‰ğ‘‰s

. In this work we assume that the sources are 

  (unless  noted  otherwise).  Let  us  further  define  the 

3

â„

outside  of  the  particle: 
ğ‘‰ğ‘‰0
polarization density of the particle as 
ğ‘‰ğ‘‰s âˆ© ğ‘‰ğ‘‰int = âˆ…

then the scattered electric field is expressed as 

ğğ(ğ«ğ«) = [ğœ€ğœ€(ğ«ğ«) âˆ’ ğœ€ğœ€h]ğ„ğ„(ğ«ğ«),

(7) 

(8) 

ğ„ğ„sca(ğ«ğ«) â‰ ğ„ğ„(ğ«ğ«) âˆ’ ğ„ğ„inc(ğ«ğ«) = ğœ”ğœ”

ğœ‡ğœ‡0 limğ‘‰ğ‘‰0â†’0 ï¿½

Time-averaged  electromagnetic-energy  transfer  per  unit  area  is  given  by  the  Poynting 

ğ‘‰ğ‘‰int\ğ‘‰ğ‘‰0

â€²

3
d

ğ«ğ«

â€²

â€²

ğ†ğ†ï¿½(ğ«ğ«, ğ«ğ«

) â‹… ğğ(ğ«ğ«

)

âˆ’

2

ğğ(ğ«ğ«)
3ğœ€ğœ€h .

vector [27]: 

1
ğ’ğ’(ğ«ğ«) =
Integrating it over the closed surface 
2

âˆ—

Re[ğ„ğ„(ğ«ğ«) Ã— ğ‡ğ‡
 results in the power generated or lost in the volume 

(ğ«ğ«)].

inside the surface (according to the Poynting theorem): 

ğ´ğ´

(9) 

where 

, 

 is the vector normal to the surface, and the sign is chosen such that 

ğ´ğ´

ğ‘Šğ‘Š = ï¿½ dğ€ğ€ â‹… ğ’ğ’(ğ«ğ«),

(10) 

 is 

positive  when  energy  goes  outside  the  surface.  Using  the  divergence  theorem,  the  surface 

ğ‘Šğ‘Š

2

dğ€ğ€ â‰ ğ§ğ§ d

ğ«ğ«

ğ§ğ§

integral is transformed into the volume integral: 

ğ‘Šğ‘Š = âˆ’
This expression is valid only if 

ï¿½ d
ğ‘‰ğ‘‰ğ´ğ´

Im[ğœ€ğœ€(ğ«ğ«)]
 and 

3

2
ğ«ğ«|ğ„ğ„(ğ«ğ«)|

ğœ”ğœ”
2

(ğ«ğ«)]
âˆ’
.
 are square-integrable inside 

âˆ—
ğ«ğ« Re[ğ„ğ„(ğ«ğ«) âˆ™ ğ‰ğ‰s

3
ï¿½ d
ğ‘‰ğ‘‰ğ´ğ´

1
2

(11) 

. Note that the 

dot product of two vectors does not imply conjugation of the second operand. This is consistent 

ğ„ğ„(ğ«ğ«)

ğ‰ğ‰s(ğ«ğ«)

ğ‘‰ğ‘‰ğ´ğ´

with the definition of action of tensor on the vector, as used above. In other words, this dot 

product is not a proper inner product of two complex vectors. 

For the case of non-absorbing host medium (

), let us apply Eq. (11) to 

 in the 

absence of the particle. Substituting 

 for 

 gives us the free-space energy loss power 

ğ‘šğ‘šh âˆˆ â„

ğ‘‰ğ‘‰s

. The first component of Eq. (11) equals zero, and the second one can be rewritten as:[23] 

ğ„ğ„inc(ğ«ğ«)

ğ„ğ„(ğ«ğ«)

ğ‘Šğ‘Š0

ğ‘Šğ‘Š0 =
where we use the notation 

ğœ”ğœ”ğœ‡ğœ‡0
2

3

ï¿½ d
ğ‘‰ğ‘‰s

ğ«ğ« d

3

â€²

âˆ—
 ğ‰ğ‰s

ğ«ğ«

(ğ«ğ«) â‹… ğ†ğ†ï¿½

ğ¼ğ¼

â€²

(ğ«ğ«, ğ«ğ«

) â‹… ğ‰ğ‰s(ğ«ğ«

â€²

)

,

(12) 

(13) 

â€²
) âˆ’ [ğ†ğ†ï¿½(ğ«ğ«
(ğ«ğ«, ğ«ğ«
which is a symmetric (self-adjoint) operator kernel, and 

{ğ†ğ†ï¿½(ğ«ğ«, ğ«ğ«

) â‰

ğ†ğ†ï¿½

ğ¼ğ¼

â€²

â€²

ğ»ğ»

, ğ«ğ«)]

 denotes the Hermitian (conjugate) 

},

1
2i

transpose of a tensor (matrix). In isotropic medium 

ğ»ğ»

5 

 
 
 
 
 
 
 
and in non-absorbing medium 

ğ¼ğ¼

â€²

(ğ«ğ«, ğ«ğ«
â€²

 is always finite,[23] in particular: 
) = Im[ğ†ğ†ï¿½(ğ«ğ«, ğ«ğ«
)],

â€²

ğ†ğ†ï¿½
ğ¼ğ¼
ğ†ğ†ï¿½

(ğ«ğ«, ğ«ğ«

)

(14) 

(15) 

Then, as explained in [23], Eq. (12) is continuous versus 
.

(ğ«ğ«, ğ«ğ«

) =

limğ«ğ«â†’ğ«ğ«

, whenever the latter is integrable. 

â€²

ğ¼ğ¼

â€² ğ†ğ†ï¿½

ğ‘˜ğ‘˜ğˆğˆÌ…
6ğœ‹ğœ‹

Thus, it is also valid for delta-functions although they are not square-integrable. 

ğ‰ğ‰s(ğ«ğ«)

By applying Eq. (11) to 

 and 

 in a similar manner, we obtain the particle-induced 

energy loss power 

, while the integral over 
ğ„ğ„sca
quantity in light scattering problems):[23] 
ğ‘Šğ‘Šenh

ğ‘‰ğ‘‰s

 gives the extinction power (a standard 

ğ‘‰ğ‘‰int

ğ‘Šğ‘Šenh â‰ âˆ’

1
2

ï¿½ d
ğ‘‰ğ‘‰s

3

âˆ—
ğ«ğ« Re[ğ„ğ„sca(ğ«ğ«) â‹… ğ‰ğ‰s

(ğ«ğ«)]

ğœ”ğœ”

2

ğœ‡ğœ‡0
2

= âˆ’

3

ï¿½ d
ğ‘‰ğ‘‰s

ğ«ğ«

ï¿½ d
ğ‘‰ğ‘‰int

3

â€²

âˆ—
Re[ğ‰ğ‰s

ğ«ğ«

(ğ«ğ«) â‹… ğ†ğ†ï¿½(ğ«ğ«, ğ«ğ«

â€²

â€²

) â‹… ğğ(ğ«ğ«

)]

,

ğ‘Šğ‘Šext â‰ âˆ’

3

ï¿½ d
ğ‘‰ğ‘‰int

ğœ”ğœ”
2

ğ«ğ« Im[ğ„ğ„inc(ğ«ğ«) â‹… ğğ

âˆ—

(ğ«ğ«)]

3
ï¿½ d
For completeness, we also provide the expression for absorbed power: [23] 
ğ‘‰ğ‘‰int

(ğ«ğ«) â‹… ğ†ğ†ï¿½(ğ«ğ«, ğ«ğ«

3
ï¿½ d
ğ‘‰ğ‘‰s

Re[ğğ

) â‹… ğ‰ğ‰s(ğ«ğ«

= âˆ’

ğœ”ğœ”

ğ«ğ«

ğ«ğ«

âˆ—

â€²

â€²

â€²

)]

.

2

ğœ‡ğœ‡0
2

(16) 

(17) 

(18) 

Schematically these and other powers are visualized in Fig. 1, with the only caveat that we 

ğ‘Šğ‘Šabs â‰

ï¿½ d
ğ‘‰ğ‘‰int

ğœ”ğœ”
2

3

2
ğ«ğ« Im[ğœ€ğœ€(ğ«ğ«)]|ğ„ğ„(ğ«ğ«)|

.

further  consider  the  current  source  corresponding  to  a  moving  electron,  for  which 

  is  an 

infinite line. 

ğ‘‰ğ‘‰s

Interestingly, Eqs. (16)â€“(18) can also be used in the case of absorbing host medium, but 

their physical meaning is ambiguous. Absorption by the host medium significantly changes the 

whole energy budget, particularly positions of the contours in Fig. 1 cannot be freely moved 

around the particle and the sources. This problem does not have a fully satisfactory solution 

even  for  the  interpretation  of 

  in  the  standard  scattering  problem  for  the  plane 

electromagnetic  waves.[28,29]  A  similar  ambiguity  appears  if  the  source  is  placed  inside  the 

ğ‘Šğ‘Šext

particle, i.e. 

 and 

 overlap. We leave a rigorous analysis of this case for future research, 

but it must include certain assumption that sources and the medium are physically separated, 

ğ‘‰ğ‘‰s

ğ‘‰ğ‘‰int
  is  effectively  excluded  from 

i.e. 

.  In  the  case  of  delta-function  source  (point,  line, or 

surface) this will additionally incur a small exclusion volume, similar to that used in Eq. (8), 

ğ‘‰ğ‘‰int

ğ‘‰ğ‘‰s

but  with  the  shape  corresponding  to  that  of  the  source  (spherical,  cylindrical,  or  planar). 

6 

 
 
 
 
 
Moreover, if the medium around the sources is absorbing, some of the results may depend on 

the  width  of  this  exclusion  volume,  not  having  a  bounded  zero  limit.  The  corresponding 

problem of defining 

 in absorbing host medium is discussed in Section 2.3. 

ğ‘Šğ‘Š0

Fig. 1. Visualization of energy powers in the energy budget framework. Reproduced from [23]. 

It  is  worth  mentioning  that  cross-sections 

  (extinction,  absorption,  scattering)  are 

commonly used in scattering problems for the plane waves. They are expressed in terms of the 

ğ¶ğ¶

corresponding power 

 and the intensity of the incident wave 

:[30] 

ğ‘Šğ‘Š

ğ¼ğ¼0

(19) 

where 

ğ¼ğ¼0 â‰ ğ‘šğ‘šh
ğ¶ğ¶ğ‘‹ğ‘‹ =
  is  a  subscript  of  any  power  from  Fig. 1, 

amplitude  of  the  incident  wave. 

ğ‘‹ğ‘‹

ğ‘Šğ‘Šğ‘‹ğ‘‹
ğ¼ğ¼0 ,
  has  physical  meaning  for  the  plane  waves,  and  can  be 

2
ğ¸ğ¸0
  is  the  real  part  of 

  is  the 

,  and 

,

â€² ğœ€ğœ€0ğ‘ğ‘
2
â€²
ğ‘šğ‘šh

ğ‘šğ‘šh

ğ¸ğ¸0

meaningfully defined for some other shaped beams. Moreover, postulating any constant instead 

ğ¸ğ¸0

of 

, e.g., unity multiplied by appropriate unit, allows one to define all cross-sections for the 

moving electron as well. This can be convenient, since they are expressed in units of area and, 

ğ¸ğ¸0

thus, can be trivially converted between different systems of units. 

2.2  Electric field of a relativistic electron 

We  consider  a  relativistic  electron  as  a  point  charge 

  moving  with  the  speed 

  in  the 

positive direction of the 

-axis. At the time 

The corresponding current density is 

ğ‘§ğ‘§

ğ‘¡ğ‘¡ = 0

 the charge has coordinates 

ğ‘ğ‘

. 

ğœğœ
ğ«ğ«0 = (ğ‘¥ğ‘¥0, ğ‘¦ğ‘¦0, ğ‘§ğ‘§0)
(20) 

where 

 is a unit vector along the 

ğ‰ğ‰s(ğ«ğ«, ğ‘¡ğ‘¡) = ğ‘ğ‘ğœğœğ‘ğ‘(ğ‘¥ğ‘¥ âˆ’ ğ‘¥ğ‘¥0)ğ‘ğ‘(ğ‘¦ğ‘¦ âˆ’ ğ‘¦ğ‘¦0)ğ‘ğ‘(ğ‘§ğ‘§ âˆ’ ğ‘§ğ‘§0 âˆ’ ğœğœğ‘¡ğ‘¡)ğğğ‘§ğ‘§,

-axis. After applying the Fourier transform (defined as 

Eq. (S1) in the Supporting Information) we obtain the current density in the frequency domain 

ğğğ‘§ğ‘§

ğ‘§ğ‘§

7 

 
 
 
To  find  the  incident  electric  field,  we  substitute  Eq. (21)  into  Eq. (6)  for  arbitrary  host 

ğ‰ğ‰s(ğ«ğ«) = ğ‘ğ‘ğ‘ğ‘(ğ‘¥ğ‘¥ âˆ’ ğ‘¥ğ‘¥0)ğ‘ğ‘(ğ‘¦ğ‘¦ âˆ’ ğ‘¦ğ‘¦0) exp ï¿½i

(ğ‘§ğ‘§ âˆ’ ğ‘§ğ‘§0)ï¿½ ğğğ‘§ğ‘§.

ğœ”ğœ”
ğœğœ

medium (

), dependence on which through 

 is implicit in the Greenâ€™s tensor: 

ğ‘šğ‘šh âˆˆ â„‚

ğ‘˜ğ‘˜
â€²

  (22) 

(21) 

ğ„ğ„inc(ğ«ğ«) = iğœ”ğœ”ğœ‡ğœ‡0 ï¿½ğˆğˆÌ… +
where  changing  the  order  of  integration  and  differentiation  eliminates  the  second  term  in 

= iğœ”ğœ”ğœ‡ğœ‡0 ï¿½ğğğ‘§ğ‘§ +

2 ï¿½ â‹… ï¿½ d

ï¿½ ğ¼ğ¼1(ğ«ğ«),

ğ‰ğ‰s(ğ«ğ«

ğ‘‰ğ‘‰s

ğ«ğ«

)

3

â€² exp(iğ‘˜ğ‘˜|ğ«ğ« âˆ’ ğ«ğ«
â€²
|
4ğœ‹ğœ‹|ğ«ğ« âˆ’ ğ«ğ«

|)

â€²

âˆ‡
2
ğ‘˜ğ‘˜

ğœ•ğœ•
ğœ•ğœ•ğ‘§ğ‘§

âˆ‡â¨‚âˆ‡
ğ‘˜ğ‘˜

Eq. (6)  and  makes  the  singularity  of  the  kernel  integrable  (the  exclusion  volume  is  then 

redundant).[31] The remaining integral is evaluated in Section S3 of the Supporting Information: 

â€²

(23) 

ğ¼ğ¼1(ğ«ğ«) â‰ ï¿½ d
where we introduced 

ğ‘‰ğ‘‰s

3

ğ«ğ«

â€² exp(iğ‘˜ğ‘˜|ğ«ğ« âˆ’ ğ«ğ«
â€²
|
4ğœ‹ğœ‹|ğ«ğ« âˆ’ ğ«ğ«
2

|)

ğ½ğ½s,ğ‘§ğ‘§(ğ«ğ«

â€²

)

=

exp ï¿½i

ğ‘ğ‘
2ğœ‹ğœ‹
 and the notation analogous to the one used 
2

(ğ‘§ğ‘§ âˆ’ ğ‘§ğ‘§0)ï¿½ ğ¾ğ¾0 ï¿½

ğœ”ğœ”ğœ”ğœ”
ğ›¾ğ›¾hğœğœ

ğœ”ğœ”
ğœğœ

ï¿½,

in the special relativity theory: 

ğœ”ğœ” â‰ ï¿½(ğ‘¥ğ‘¥ âˆ’ ğ‘¥ğ‘¥0)

+ (ğ‘¦ğ‘¦ âˆ’ ğ‘¦ğ‘¦0)

(24) 

ğ›¾ğ›¾h â‰ ï¿½
The principal branch for the square-root function is chosen such that it continuously depends 

ğ›½ğ›½h â‰

ğ‘šğ‘šh,

1
2.
1 âˆ’ ğ›½ğ›½h

ğœğœ
ğ‘ğ‘

on 

  when 

  (or,  equivalently, 

  which  we  assumed  in 

Section  2.1),  except  for  the  singularity  at 
0 â‰¤ arg ğœ€ğœ€h < ğœ‹ğœ‹

ğœ€ğœ€h

complex plane (

.  Then 
0 â‰¤ arg ğ‘šğ‘šh < ğœ‹ğœ‹ 2â„  
ğ›¾ğ›¾h

) excluding the interval 
ğ›½ğ›½h = 1
) 

  lies  in  the  first  quadrant  of  the 

 Specifically, 

 and 

 lead to real (

0 â‰¤ arg ğ›¾ğ›¾h â‰¤ ğœ‹ğœ‹ 2â„

) and imaginary (

, respectively, corresponding to relatively 
ğ›½ğ›½h >

ğ›½ğ›½h < 1

[0,1).

less and more dense non-absorbing host media. In the case of vacuum, we always have 
Im ğ›¾ğ›¾h > 0
1

ğ›¾ğ›¾h > 1

ğ›¾ğ›¾h

. 

1

We substitute Eq. (23) into Eq. (22) and obtain: 

ğ›½ğ›½h <

ğ„ğ„inc(ğ«ğ«) =

ğ‘ğ‘ğœ”ğœ”
2
2ğœ‹ğœ‹ğœ€ğœ€0ğ‘šğ‘šh

ğœğœ

2

where  we  used 

ğ¾ğ¾1 ï¿½

ğ‘¥ğ‘¥ âˆ’ ğ‘¥ğ‘¥0
ğœ”ğœ”
ğ‘¦ğ‘¦ âˆ’ ğ‘¦ğ‘¦0
ğœ”ğœ”
i
ğ›¾ğ›¾h ğ¾ğ¾0 ï¿½
  (Eq. 10.29.3  of  [32]).  The  behavior  of  the  incident  field  is 

ğœ”ğœ”ğœ”ğœ”
ğ›¾ğ›¾hğœğœ
ğœ”ğœ”ğœ”ğœ”
ğ›¾ğ›¾hğœğœ
ğœ”ğœ”ğœ”ğœ”
ğ›¾ğ›¾hğœğœ

ğ›¾ğ›¾h exp ï¿½i

(ğ‘§ğ‘§ âˆ’ ğ‘§ğ‘§0)ï¿½

â
âŸ
âŸ
âŸ

â›
âœ
âœ
âœ

ğ¾ğ¾1 ï¿½

(25) 

ğœ”ğœ”
ğœğœ

â

âˆ’

ï¿½

ï¿½

ï¿½

.

mostly  determined  by 

â€²
ğ¾ğ¾0
exponentially  with 

(corresponding to 

ğœ”ğœ”

.  When  it  has  a  positive  real  part  (

(ğ“ğ“) = âˆ’ğ¾ğ¾1(ğ“ğ“)
  (Eq. 10.25.3  of  [32]).  By  contrast,  when 
ğ›¾ğ›¾h
), the field oscillates and decays as 

Re ğ›¾ğ›¾h > 0
ğ›¾ğ›¾h

â 
),  the  field  decays 

  is  purely  imaginary 

 similar to the field of a line 

source. 

ğ›½ğ›½h > 1

1 âˆšğœ”ğœ”â„

8 

 
 
 
 
To conclude, we derived the field in the most general case of an arbitrary host medium 

(

).  This  expression  includes  the  case  of  non-absorbing  host  medium  (

)  or 

vacuum as special cases, and allow straightforward quasistatic limit. In all cases the final results 
ğ‘šğ‘šh âˆˆ â„‚
match the ones described in the literature.[33] However, the latter were derived using different 

ğ‘šğ‘šh âˆˆ â„

approaches for solving the Maxwell equations for different cases of the host media. By contrast, 

we used a single VIE framework with only technical differences in evaluating integrals. The 

observed agreement, thus, supports the  universal  applicability of this framework, which  we 

further use to evaluate interaction of the electron field with a nanoparticle. 

2.3  Free-space energy losses 

To find the free-space energy losses of a relativistic electron moving in an infinite non-

absorbing host medium (

), we substitute Eq. (21) into Eq. (12): 

ğ‘Šğ‘Š0 =

2

ğœ”ğœ”ğœ‡ğœ‡0ğ‘ğ‘
8ğœ‹ğœ‹

ğ‘šğ‘šh âˆˆ â„
âˆ

â€²

ï¿½ dğ‘§ğ‘§dğ‘§ğ‘§

âˆ’âˆ

exp ï¿½i

where we used 

 in evaluating 

â‡’

â€²

(ğ‘§ğ‘§

âˆ’ ğ‘§ğ‘§)ï¿½ ï¿½1 +

2

1
2
ğ‘˜ğ‘˜

ğœ•ğœ•
ğœ•ğœ•ğ‘§ğ‘§

2ï¿½

â€²

âˆ’ ğ‘§ğ‘§)]

(26) 

sin[ğ‘˜ğ‘˜(ğ‘§ğ‘§
ğ‘§ğ‘§

â€²

âˆ’ ğ‘§ğ‘§

ğœ”ğœ”ğœ‡ğœ‡0ğ‘ğ‘
, expressed the loss power per unit distance, and 
8ğœ‹ğœ‹

ğ¼ğ¼2(ğ›½ğ›½h),

ğœ”ğœ”
ğœğœ

=

ğœ•ğœ•ğ‘Šğ‘Š0
ğœ•ğœ•ğ‘§ğ‘§
ğ¼ğ¼
ğ†ğ†ï¿½

â€²

(ğ«ğ«, ğ«ğ«

)

2

: 

ğ¼ğ¼2(ğ›½ğ›½h)

ğ‘§ğ‘§

â€²

ğ‘§ğ‘§

denoted the remaining one-dimensional integral as 

. To calculate it we replace 

 with 

ğ‘˜ğ‘˜ âˆˆ â„

in the derivative and substitute 

â€²

ğ‘¢ğ‘¢ â‰ ğœ”ğœ”(ğ‘§ğ‘§

âˆ

âˆ’ ğ‘§ğ‘§) ğœğœâ„
2

ğ¼ğ¼2(ğ›½ğ›½h) â‰ ï¿½ dğ‘¢ğ‘¢ exp(iğ‘¢ğ‘¢) ï¿½1 +

âˆ’âˆ

1
2
ğ›½ğ›½h

ğœ•ğœ•
ğœ•ğœ•ğ‘¢ğ‘¢

2ï¿½

sin(ğ›½ğ›½hğ‘¢ğ‘¢)
ğ‘¢ğ‘¢

= ï¿½1 âˆ’

âˆ

1
2ï¿½ ï¿½ dğ‘¢ğ‘¢ exp(iğ‘¢ğ‘¢)
ğ›½ğ›½h
âˆ

âˆ’âˆ

sin(ğ›½ğ›½hğ‘¢ğ‘¢)
ğ‘¢ğ‘¢

(27) 

dğ‘¢ğ‘¢
ğ‘¢ğ‘¢

{sin[(ğ›½ğ›½h âˆ’ 1)ğ‘¢ğ‘¢] + sin[(ğ›½ğ›½h + 1)ğ‘¢ğ‘¢]}

=

2 ï¿½
0

1
2
ğ›¾ğ›¾h
ğ›½ğ›½h
ğœ‹ğœ‹
2
2ğ›½ğ›½h

where we integrated by parts twice, and used the known limit for the sine integral. Note that 

2 [sgn(ğ›½ğ›½h âˆ’ 1) + 1],
ğ›¾ğ›¾h
the integrals converge at infinity due to the oscillating kernel (since 

) decreasing as 

, 

=

and the integrand is regular at zero (together with its derivatives). 

ğ›½ğ›½h â‰  1

1 ğ‘¢ğ‘¢â„

By substituting the result for 

 into Eq. (26), we obtain that in vacuum or in a medium with 

 the free-space energy loss power is 

ğ¼ğ¼2

ğ›½ğ›½h < 1
which is a known fact: a charge moving slower than the speed of light in the medium does not 

(28) 

ğ‘Šğ‘Š0 = 0,

lose energy. For 

, when the speed of charge exceeds the speed of light in the medium, 

ğ›½ğ›½h > 1

9 

 
 
 
 
 
which  vanish  when 

ğœ•ğœ•ğ‘Šğ‘Š0
.  Hence,  the  validity  of  Eqs. (28)  and  (29)  can  be  extended  by 
ğœ•ğœ•ğ‘§ğ‘§

ğ‘ğ‘
2
ğ‘šğ‘šh

ğœ”ğœ” ï¿½1 âˆ’

ğœ‡ğœ‡0
8

2ï¿½,

=

ğ‘ğ‘

ğœğœ

2

2

(29) 

continuity  to 

  and 
ğ›½ğ›½h â†’ 1

,  respectively.  Finally,  the  free-space  energy  loss  per  unit 

distance, given by Eq. (S6), is 

ğ›½ğ›½h â‰¤ 1

ğ›½ğ›½h â‰¥ 1

Thus, we obtained the well-known Frank-Tamm formula[34] for Cherenkov radiation[35] in any 

ğ‘ğ‘

ï¿½
ğ›½ğ›½h(ğœ”ğœ”)>1 

dğœ”ğœ” ğœ”ğœ” ï¿½1 âˆ’

ğœ•ğœ•
ğœ•ğœ•ğ‘§ğ‘§

âˆ†ğ¸ğ¸0 =

2

ğœ‡ğœ‡0
4ğœ‹ğœ‹

ğ‘ğ‘
2
ğ‘šğ‘šh

2ï¿½

.

ğœğœ

2

(30) 

non-absorbing host medium, which again shows the versatility of our theoretical framework. 

In  an  infinite  absorbing  host  medium  (

)  the  integral  in  the  expression  for 

[Eq. (12)] will become singular due to the divergence of 

. As discussed in 
ğ‘Šğ‘Š0
Section 2.1 the possible workaround is to assume a finite exclusion volume in the host medium 

ğ‘šğ‘šh âˆˆ â„‚

 for 

ğ¼ğ¼

â€²

â€²

ğ†ğ†ï¿½

(ğ«ğ«, ğ«ğ«

)

ğ«ğ« â†’ ğ«ğ«

around  the  electron  trajectory,  which  is  equivalent  to  assuming  a  finite  electron  size.[33]  In 

principle,  the  latter  provides  practically  usable expressions,  but  we  do  not  discuss it  in  this 

paper. 

Note, however, that, conceptually, this singularity indicates the limitation of macroscopic 

Maxwellâ€™s equations. Since the latter are obtained by averaging microscopic ones over the size 

of several atomic scales, they are not expected to be accurate at smaller scales. And it is exactly 

the  latter  scales  that  become  important  for  electron  losses  in  absorbing  medium. 

Microscopically,  the  electron  is  always  moving  in  the  vacuum,  thus  the  losses  (per  unit  of 

length) are always finite. 

2.4  Particle-induced energy losses 

To  express  particle-induced  energy  losses,  we  start  from  Eq. (16)  considering  the  most 

general host medium (

). We use the general property of tensor transposition  

ğ‘šğ‘šh âˆˆ â„‚

and  Greenâ€™s  tensorâ€™s  symmetry  (reciprocity) 

ğ‘‡ğ‘‡
âˆ€ğšğš, ğ›ğ›: ğšğš â‹… ğ€ğ€ï¿½ â‹… ğ›ğ› = ğ›ğ› â‹… ğ€ğ€ï¿½
â€²
ğ†ğ†ï¿½(ğ«ğ«, ğ«ğ«

â‹… ğšğš,
) = [ğ†ğ†ï¿½(ğ«ğ«

integration: 

(31) 

  to  change  the  order  of 

â€²

ğ‘‡ğ‘‡

, ğ«ğ«)]

(32) 

where we introduced the auxiliary electric field 

 equal to the incident field from conjugate 

ğ‘Šğ‘Šenh = âˆ’

ğ«ğ« Im[ğ„ğ„a(ğ«ğ«) â‹… ğğ(ğ«ğ«)]

,

3

ï¿½ d
ğ‘‰ğ‘‰int

ğœ”ğœ”
2

sources [cf. Eq. (22)]: 

ğ„ğ„a(ğ«ğ«)

3
ğ„ğ„a(ğ«ğ«) â‰ iğœ”ğœ”ğœ‡ğœ‡0 limğ‘‰ğ‘‰0â†’0 ï¿½ d
ğ‘‰ğ‘‰s\ğ‘‰ğ‘‰0

ğ«ğ«

â€²

ğ†ğ†ï¿½(ğ«ğ«, ğ«ğ«

â€²

âˆ—
) â‹… ğ‰ğ‰s

â€²

(ğ«ğ«

)

âˆ’ i

âˆ—
ğ‰ğ‰s
(ğ«ğ«)
3ğœ”ğœ”ğœ€ğœ€h.

10 

(33) 

 
 
 
 
 
 
To  calculate  this  field,  we  note  that  the  conjugation  of 

  [Eq. (21)]  is  equivalent  to  the 

inversion of sign of 

âˆ—
, which leads to the same inversion in Eq. (23), since the sign of 
ğ‰ğ‰s

can  be  freely  changed  inside  the  integral  in  the  latter  equation.  Therefore,  analogously  to 
ğ‘§ğ‘§Ìƒ

ğ‘§ğ‘§ âˆ’ ğ‘§ğ‘§0

Eq. (25) we obtain 

ğ„ğ„a(ğ«ğ«) = âˆ’

ğ‘ğ‘ğœ”ğœ”
2
2ğœ‹ğœ‹ğœ€ğœ€0ğ‘šğ‘šh

2

ğ›¾ğ›¾h exp ï¿½âˆ’i

ğœğœ

ğœ”ğœ”
ğœğœ

(ğ‘§ğ‘§ âˆ’ ğ‘§ğ‘§0)ï¿½

ğœ”ğœ”ğœ”ğœ”
ğ›¾ğ›¾hğœğœ
ğœ”ğœ”ğœ”ğœ”
ğ›¾ğ›¾hğœğœ

ğ¾ğ¾1 ï¿½

ğ¾ğ¾1 ï¿½

ğ‘¥ğ‘¥ âˆ’ ğ‘¥ğ‘¥0
ğœ”ğœ”
ğ‘¦ğ‘¦ âˆ’ ğ‘¦ğ‘¦0
ğœ”ğœ”
i
ğ›¾ğ›¾h ğ¾ğ¾0 ï¿½

â›
âœ
âœ
âœ

â

ğœ”ğœ”ğœ”ğœ”
ğ›¾ğ›¾hğœğœ

ï¿½

ï¿½

ï¿½

â
âŸ
âŸ
âŸ

â 

(34) 

âˆ’ğ¸ğ¸inc,ğ‘¥ğ‘¥(ğ«ğ«)
âˆ’ğ¸ğ¸inc,ğ‘¦ğ‘¦(ğ«ğ«)
where the additional minus arises from each derivative with respect to 
ğ¸ğ¸inc,ğ‘§ğ‘§(ğ«ğ«)

(ğ‘§ğ‘§ âˆ’ ğ‘§ğ‘§0)ï¿½,

ï¿½ exp ï¿½âˆ’2i

ğœ”ğœ”
ğœğœ

= ï¿½

. 

Equation (32) is very convenient since the integration is performed over the volume of the 

ğ‘§ğ‘§

particle (rather than that of sources), 

 is easily obtained from the known 

, and 

is efficiently calculated in the DDA. Moreover, the resulting expression (32) for 
ğ„ğ„a(ğ«ğ«)

ğ„ğ„inc(ğ«ğ«)

 is very 
ğğ(ğ«ğ«)

similar to the expression (17) for 

 and can be calculated in a similar way. 

ğ‘Šğ‘Šenh

Previously, the particle-induced energy losses, expressed as an integral over the volume of 

ğ‘Šğ‘Šext

the particle, were known only for the specific case of vacuum as a host medium,[8,9,36] for which 

it  is  known  that 

.  In  our  general  approach  the  equality  of  Eqs. (32)  and  (17) 

follows from the fact that 

ğ‘Šğ‘Šenh = ğ‘Šğ‘Šext

 which is true if and only if 

 (i.e., when 

). Alternatively, the same can be obtained from the total energy budget (Fig. 1) using 

ğ„ğ„a(ğ«ğ«) = âˆ’ğ„ğ„inc
,  where  the  latter  follows  from  the  possibility  of  extending  the 

ğ›¾ğ›¾h âˆˆ â„

  and 

(ğ«ğ«)

âˆ—

 to infinity and the exponential decay of 

. The fast decay of 

 is actually required for any excitation that has 

as the far-field integral. 
ğ„ğ„inc(ğ«ğ«)

ğ‘Šğ‘Š0 = 0

, since 

 can also be computed 

ğ„ğ„inc(ğ«ğ«)
ğ‘Šğ‘Š0

The  major  novelty  of  Eq. (32)  is  its  applicability  to  the  arbitrary  passive  host  medium 

(

) and the Cherenkov case (

, when 

. Although in this case 

 is 

not zero and may even be effectively infinite (see Section 2.3), the expression for (additional) 
ğ‘šğ‘šh âˆˆ â„‚
particle-induced energy losses is well defined. However, the equality 

ğ‘Šğ‘Šenh â‰  ğ‘Šğ‘Šext

ğ‘Šğ‘Š0
 also 

ğ›½ğ›½h > 1)

remains approximately valid in the quasi-static case [cf. Eq. (S15)], especially when 
ğ„ğ„a(ğ«ğ«) = âˆ’ğ„ğ„inc

(ğ«ğ«)
Thus, to notice new effects, predicted by the rigorous theory of this section for the Cherenkov 
ğ›½ğ›½h â‰ˆ 1

. 

âˆ—

case, one needs to consider relatively large particles and 

 significantly larger than 1. 

ğ›½ğ›½h

11 

ğ›½ğ›½h < 1
integration surface for 
ğ‘Šğ‘Š0 = 0

ğ‘Šğ‘Šrad = ğ‘Šğ‘Šsca
ğ‘Šğ‘Šsca

 
 
 
2.5  Electron energy-loss probability 

Total energy loss for the electron will be the sum of free-space and particle-induced energy 

losses. To find it we apply Eq. (S6) to 

 and 

where we introduced the electron energy-loss probability density function 

0

ï¿½ dğœ”ğœ”(ğ‘Šğ‘Š0 + ğ‘Šğ‘Šenh)
0

= ï¿½ d(â„ğœ”ğœ”)Î“EELS(â„ğœ”ğœ”)â„ğœ”ğœ”,

âˆ†ğ¸ğ¸ = âˆ†ğ¸ğ¸0 + âˆ†ğ¸ğ¸enh =

2
ğœ‹ğœ‹

ğ‘Šğ‘Šenh

ğ‘Šğ‘Š0

âˆ

âˆ

of the random variable 

 such that 

Î“EELS(â„ğœ”ğœ”) â‰

 is the expected value of this variable. 

2
ğœ‹ğœ‹

ğ‘Šğ‘Š0 + ğ‘Šğ‘Šenh
2
ğœ”ğœ”
â„

(35) 

(36) 

Strictly speaking, the purely classical theory is deterministic, i.e. each electron should lose 

â„ğœ”ğœ”

âˆ†ğ¸ğ¸

exactly 

 given by Eq. (35). By contrast, the quantum description of EELS predicts that each 

electron loses energy in quanta (0 or some natural number of them), each of them is chosen 

âˆ†ğ¸ğ¸

randomly  from  some  probability  distribution.  However,  it  has  been  shown[37â€“39]  that  the 

phenomenological introduction of probability density by Eq. (36) allows the classical theory 

to correctly reproduce the quantum result in the single-loss (weak-coupling) regime, i.e. when 

at most one energy quanta is assumed to be lost (also called the Born approximation). This 

regime is commonly satisfied in EELS experiments, although the strong-coupling regime is 

gaining increasing interest as well.[40] 

The total (measurable) loss probability 

 is proportional to the sum of 

 and 

and is naturally the simplest, when 

 (i.e. 
Î“EELS

). Otherwise, there are several potential 
ğ‘Šğ‘Šenh
, especially for the absorbing host medium 

ğ‘Šğ‘Š0

issues. First one is related to the definition of 

ğ‘Šğ‘Š0 = 0
(see Section 2.3). Second, any non-zero 

ğ›½ğ›½h < 1
ğ‘Šğ‘Š0
effectively  infinite  for  unbounded  host  media  (as  assumed  in  the  theoretical  derivation).  In 

 has a finite value per unit length, thus becomes 

ğ‘Šğ‘Š0

practical applications the thickness of the host medium can be much larger than the particle 

size, but still finite. In this case, one  can hope that Eq. (32) remains approximately correct, 

while 

 can be computed from Eq. (30) (or another expression for absorbing host medium)[33] 

with possible addition of the transition-radiation losses.[41] Third, the resulting 

ğ‘Šğ‘Š0

 need to be 

sufficiently small for the weak-coupling regime to remain valid. The latter requirement can 

ğ‘Šğ‘Š0

probably be relaxed, assuming that an electron loses at most one energy quantum by interaction 

with particle, but potentially many quanta by interaction with bulk host medium (and these two 

processes are independent). However, in such case the loss probabilities proportional to 

and 

 cannot be added, but rather need to be convoluted as functions of 

 (each including 
ğ‘Šğ‘Š0
the zero-loss peak for normalization). But we are not aware of existing rigorous analysis of 

ğœ”ğœ”

ğ‘Šğ‘Šenh
such option. 

12 

 
 
 
 
 
In  any  case, 

  is  fully  determined  by  the  outer  boundaries  of  the  host  medium  (with 

respect to the electron beam) and is independent from the particle. By contrast, the focus of 

ğ‘Šğ‘Š0

this paper is on calculating the particle-induced energy losses 

, for which one generally 

needs  to  employ  the  DDA  or  other  numerical  method.  To  avoid  confusion,  we  define  the 

ğ‘Šğ‘Šenh

corresponding particle-induced loss probability as 

 and aim to compute only this part. 

When 

,  it  is  exactly  the  measurable  quantity 

ğ‘ƒğ‘ƒEELS

,  otherwise  it  is  a  first  step  in 

ğ‘Šğ‘Š0 = 0
Î“EELS

obtaining 

 with the second step consisting of a separate calculation of 

Î“EELS

. In the case of 

a weak-coupling regime for the whole system (particle + slab of host medium) 
ğ‘Šğ‘Š0

 is equal 

to the difference between the losses in this system and the losses in the same system without a 

ğ‘ƒğ‘ƒEELS

particle (both of which are potentially measurable). The same approach is commonly used, e.g., 

when defining cross sections for light scattering by particles in absorbing host medium.[42,43] 

The explicit expression for 

 follows from Eq. (36): 

ğ‘ƒğ‘ƒEELS

=
where we defined the enhancement cross-section 

ğ‘ƒğ‘ƒEELS(â„ğœ”ğœ”) â‰

2
ğœ‹ğœ‹

ğ‘Šğ‘Šenh
2
ğœ”ğœ”
â„

â€²
ğ‘šğ‘šh
ğœ‹ğœ‹â„

2
ğœ€ğœ€0ğ¸ğ¸0
ğ‘˜ğ‘˜0 ğ¶ğ¶enh,
2

analogously  to 

ğ¶ğ¶enh â‰ âˆ’
Im[ğ„ğ„a(ğ«ğ«
  [cf.  Eqs. (17),  (19)].  In  the  case  of 

ğ«ğ«

) â‹… ğğ(ğ«ğ«

ğ‘˜ğ‘˜0
ğœ€ğœ€0ğ¸ğ¸0

â€²
ğ‘šğ‘šh

3
2 ï¿½ d
ğ‘‰ğ‘‰int

â€²

â€²

(37) 

(38) 

  and 

â€²

)]
,
  we  have 

Eqs. (37),  (38)  simplify  to  a  previously  known  expression  for  the  electron  energy-loss 

ğ¶ğ¶ext
probability.[8] Usually, energy losses 

ğ›½ğ›½h < 1
 are expressed in the units of 

ğ¶ğ¶enh = ğ¶ğ¶ext
, then 

 is 

in the units of 

. 

âˆ’1

ğ‘ğ‘ğ¸ğ¸ = â„ğœ”ğœ”

eV

ğ‘ƒğ‘ƒEELS

2.6  Cathodoluminescence probability 

eV

As discussed in Section 2.4, in vacuum (or more generally when 

) the radiation from 

the particle-electron system 

 is only the one produced by induced currents in the particle 

ğ›½ğ›½h < 1

(

). In arbitrary non-absorbing host medium, the radiated energy is the energy lost by the 

ğ‘Šğ‘Šrad

electron minus the energy absorbed by the particle: 
ğ‘Šğ‘Šsca

âˆ†ğ¸ğ¸ = âˆ†ğ¸ğ¸0 + âˆ†ğ¸ğ¸enh âˆ’ âˆ†ğ¸ğ¸abs =

âˆ

âˆ

2
ğœ‹ğœ‹

ï¿½ dğœ”ğœ”(ğ‘Šğ‘Š0 + ğ‘Šğ‘Šenh âˆ’ ğ‘Šğ‘Šabs)
0

where by analogy to 

tot
= ï¿½ d(â„ğœ”ğœ”)Î“CL

(â„ğœ”ğœ”)â„ğœ”ğœ”,

 we introduce the total light-emission probability density 
0

Î“EELS(â„ğœ”ğœ”)
tot
Î“CL

(â„ğœ”ğœ”) â‰

2
ğœ‹ğœ‹

ğ‘Šğ‘Š0 + ğ‘Šğ‘Šenh âˆ’ ğ‘Šğ‘Šabs
2
ğœ”ğœ”
â„

.

13 

(39) 

(40) 

 
 
 
 
As  discussed  in  Section  2.5, 

  is  potentially  problematic,  but  the  computationally-

intensive method is only needed to calculate the particle-related contribution to 

, which we 

ğ‘Šğ‘Š0

tot
Î“CL

(41) 

further denote as 

: 

tot
ğ‘ƒğ‘ƒCL
ğ‘Šğ‘Šrad âˆ’ ğ‘Šğ‘Š0
2
ğœ”ğœ”
â„

2
ğœ€ğœ€0ğ¸ğ¸0
tot
ğ‘˜ğ‘˜0 (ğ¶ğ¶enh âˆ’ ğ¶ğ¶abs) =
ğ‘ƒğ‘ƒCL
2
=
where the second part prevents the loss of precision when 
decimal places, which is often the case for metallic nanoparticles. In the latter case one may 

2
ğœ€ğœ€0ğ¸ğ¸0
ğ‘˜ğ‘˜0 (ğ¶ğ¶enh âˆ’ ğ¶ğ¶ext + ğ¶ğ¶sca),
2
 and 

 are equal within a few 

â€²
ğ‘šğ‘šh
ğœ‹ğœ‹â„

(â„ğœ”ğœ”) â‰

2
ğœ‹ğœ‹

â€²
ğ‘šğ‘šh
ğœ‹ğœ‹â„
ğ¶ğ¶enh

ğ¶ğ¶abs

calculate 

 by integrating the far field instead of using the relation 

The above definition of 

ğ¶ğ¶sca

 is fundamentally the most natural, since it accounts for the 

ğ¶ğ¶sca = ğ¶ğ¶ext âˆ’ ğ¶ğ¶abs.

total outgoing radiation in all directions (denoted by superscript â€œtotâ€). However, all existing 

tot
ğ‘ƒğ‘ƒCL

measurement modalities for CL collect light only in the upper hemisphere when the electron 

moves  downwards,  this  always  excludes  the  Cherenkov  cone  (directed  in  the  lower 

hemisphere). To be more accurate, one should consider a large but finite chunk of the host 

medium  (as  in  Section  2.5)  and  draw  the  Cherenkov  cone  from  each  point  of  the  electron 

trajectory inside the host medium. First, this solves the problem with potential unboundedness 

of 

, since it does not contribute to the measured signal if we neglect the reflection of the 

Cherenkov radiation from the bottom boundary of the host medium. Second, the interference 

ğ‘Šğ‘Š0

of 

 and 

 in the far-field (also concentrated in the direction of the Cherenkov cone) is 

irrelevant to the measurements as well. But this interference is exactly the one which leads to 

ğ„ğ„inc

ğ„ğ„sca

the difference between 

 and 

. Thus, to exactly reproduce the experimental signal one 

should integrate 

if  one  aims  to  have  a  simple  approximation,  the  integral  of  the  scattered  intensity  over  the 

 over the detector collection angle, which is often not known. However, 
ğ‘Šğ‘Šext
2

ğ‘Šğ‘Šenh

|ğ„ğ„sca|

whole solid angle (proportional to 

) is a reasonable option, at least for particles smaller 

than the wavelength. For the latter case, the angular dependence of 

ğ¶ğ¶sca
2
thus the ratio between the integral over the detector collection angle and 
|ğ„ğ„sca|

 is relatively weak, 

 is expected to 

weakly depend on the loss energy (frequency). Then the simulated spectrum will reproduce the 

ğ¶ğ¶sca

measured  one  semi-quantitatively  up  to  a  constant  factor.  Therefore,  we  postulate  the  CL 

probability to be: 

2
ğœ‹ğœ‹

ğ‘Šğ‘Šsca
2
ğœ”ğœ”
â„

â€²
ğ‘šğ‘šh
ğœ‹ğœ‹â„

2
ğœ€ğœ€0ğ¸ğ¸0
ğ‘˜ğ‘˜0 ğ¶ğ¶sca,
2

=
which agrees with the ones used in other simulation methods (Lorenz-Mie, BEM). Naturally, 

ğ‘ƒğ‘ƒCL(â„ğœ”ğœ”) â‰

we also have 

 for 

. Finally, we stress once again that in the case of 

tot
ğ‘ƒğ‘ƒCL = ğ‘ƒğ‘ƒCL

ğ›½ğ›½h < 1

ğ›½ğ›½h > 1

14 

(42) 

 
 
 
 
 (hence, 

ğ‘ƒğ‘ƒEELS

tot
ğ‘ƒğ‘ƒCL
 and 

the difference between 

 and 

 is important for the electron energy losses (Section 2.5), 

but is not visible in existing CL measurement configurations. 

ğ‘Šğ‘Šext

ğ‘Šğ‘Šenh

The  definition  of 

  becomes  even  more  problematic  in  the  case  of  absorbing  host 

medium, since the absorption of the scattered radiation is generally significant. To accurately 

ğ‘ƒğ‘ƒCL

reproduce the signal at a detector one should account for variation of optical path in the host 

medium with the scattering angle. The corresponding attenuation will depend on variation of 

  with 

.  Still,  we  can  expect  Eq. (42)  to  qualitatively  reproduce  the  measured  CL 

spectra.  Fortunately,  the  far  limit  of  the  incident  electron  field,  which  is  not  negligible  for 
Im ğ‘šğ‘šh

ğœ”ğœ”

, has the same behavior as attenuated Cherenkov radiation. Thus, its contribution to 

detector signal can also be usually neglected. By contrast, 
Re ğ›½ğ›½h > 1
in  this  case,  since  all  underlying  components  of  the  energy  balance  depend  on  the  outer 

 has no practical relevance at all 

tot
ğ‘ƒğ‘ƒCL

boundary of the host-medium and the far-field powers cannot be computed as integrals over 

the particle volume. 

Finally, we stress that neither 

 nor 

 are generally guaranteed to be positive. While 

the relations 

 and 

) always hold, see Eq. (18) and [23], only 

in the case 

 the probabilities 
ğ‘Šğ‘Šsca > 0

ğ‘Šğ‘Šabs â‰¥ 0
ğ›½ğ›½h < 1

ğ‘ƒğ‘ƒCL > 0
ğ‘ƒğ‘ƒCL

respectively, and hence are strictly positive. Negative probabilities, that may be obtained in 
ğ‘Šğ‘Šsca
absorbing or Cherenkov host medium, are analogous to the phenomenon of negative extinction 

ğ‘Šğ‘Šabs + ğ‘Šğ‘Šsca

ğ‘ƒğ‘ƒEELS

 are proportional to 

 and 

, 

[42]. Note, however, that 

 holds in any non-absorbing medium, including the case 

. 

ğ‘Šğ‘Šext > 0

1
2.7  Scale invariance 

ğ›½ğ›½h >

To account for the host medium in the DDA, the Greenâ€™s tensor, the incident electric field, 

and the particle refractive index must be modified according to 

. For the electromagnetic 

codes that do not natively support refractive index of the host medium as an input parameter, 

ğ‘šğ‘šh

this can be done by scaling other input parameters. For the case of the plane-wave excitation 

and 

, it is sufficient to divide both 

 and the vacuum wavelength 

 by 

, resulting 

in the correct values of 

ğ‘šğ‘šh > 0

 and 

.[44] All computed values are then correct, except for scaling 

ğœ†ğœ†

ğ‘šğ‘šh

of cross sections since 

 scales with 

 is fixed [Eq. (19)]. 

In the case of the electron excitation, additional care is required to keep the incident field 
ğ¸ğ¸0

ğ‘šğ‘šh

[Eq. (25)] the same up to a constant factor. Relativistic factors 

 and 

 need to be the same, 

since they differently affect the fields along the transverse and longitudinal coordinates, leading 

ğ›½ğ›½h

ğ›¾ğ›¾h

to the scaling 

. Obviously, this applies only to the case of not very dense host medium 

(

ğ›½ğ›½h < 1

) â€“ this derivation additionally illustrates that this case is fully analogous to the case of 

ğœğœ â†’ ğ‘šğ‘šhğœğœ

15 

ğ‘šğ‘šp
, when 

ğ‘˜ğ‘˜

ğ‘šğ‘š(ğ«ğ«)
ğ¼ğ¼0

vacuum. The scaling of 

 is compensated by scaled 

, corresponding to the above scaling of 

. The resulting 

 in vacuum is then 
ğœğœ

 times the correct field in the host medium. 

ğœ”ğœ”

Let us generalize this analysis to arbitrary scaling of refractive index by 

 combined 

ğ‘šğ‘šh

ğœ‚ğœ‚ âˆˆ â„
classical scale-invariance rule in electromagnetic scattering.[45] Formally, we have 

 (and inverse scaling of 

). The latter corresponds to the 

ğœ‰ğœ‰ âˆˆ â„

ğ‘˜ğ‘˜

ğœ†ğœ†
with scaling of all lengths by 

ğ„ğ„inc(ğ«ğ«)

ğ‘šğ‘šp â†’ ğ‘šğ‘šp ğœ‚ğœ‚â„ ,
Which,  after  straightforward  algebraic  analysis  [Eqs. (7),(17)â€“(19),(25),(26),(32),(37),(41)], 

ğ‘šğ‘šh â†’ ğ‘šğ‘šh ğœ‚ğœ‚â„ ,

ğœğœ â†’ ğœ‚ğœ‚ğœğœ,

 ğ«ğ« â†’ ğ«ğ« ğœ‰ğœ‰â„ ,

ğ«ğ«0 â†’ ğ«ğ«0 ğœ‰ğœ‰â„ ,

ğ‘˜ğ‘˜ â†’ ğœ‰ğœ‰ğ‘˜ğ‘˜.

(43) 

leads to 

ğœ”ğœ” â†’ ğœ‰ğœ‰ğœ‚ğœ‚ğœ”ğœ”,

ğ¼ğ¼0 â†’ ğ¼ğ¼0 ğœ‚ğœ‚â„ ,

ğ„ğ„inc â†’ ğœ‰ğœ‰ğœ‚ğœ‚ğ„ğ„inc,
ğœ•ğœ•ğ‘Šğ‘Š0
ğœ•ğœ•ğ‘§ğ‘§

â†’ ğœ‰ğœ‰ğœ‚ğœ‚

ğœ•ğœ•ğ‘Šğ‘Š0
ğœ•ğœ•ğ‘§ğ‘§

,

ğ„ğ„ â†’ ğœ‰ğœ‰ğœ‚ğœ‚ğ„ğ„,

ğğ â†’ ğœ‰ğœ‰ ğğ ğœ‚ğœ‚â„ ,

ğ†ğ†ï¿½ â†’ ğœ‰ğœ‰ğ†ğ†ï¿½,

(44) 

ğ‘Šğ‘Šğ‘‹ğ‘‹ â†’ ğœ‚ğœ‚ğ‘Šğ‘Šğ‘‹ğ‘‹,

ğ¶ğ¶ğ‘‹ğ‘‹ â†’ ğœ‚ğœ‚

2

ğ¶ğ¶ğ‘‹ğ‘‹,  

where 

 is a subscript of any power (enh, ext, abs) and 
ğ‘ƒğ‘ƒEELS,CL â†’ ğ‘ƒğ‘ƒEELS,CL ğœ‰ğœ‰â„ ,

, 
, 
Î”ğ¸ğ¸ğ‘‹ğ‘‹.

, 

 are kept intact. Note 

2
, 
Î”ğ¸ğ¸ğ‘‹ğ‘‹ â†’ ğœ‰ğœ‰ğœ‚ğœ‚

that the scaling of powers and cross sections is different from the case of plane-wave excitation 

ğ¸ğ¸0

ğ‘ğ‘

â„

ğœ€ğœ€0

ğœ‡ğœ‡0

ğ‘‹ğ‘‹

due to the additional scaling of the incident field. 

Coming  back  to  simulating  EELS  and  CL  in  the  host  medium  with 

  using  any 

vacuum-based code, one has two options. The first one, described above, corresponds to 

ğ›½ğ›½h < 1

  and 

.  The  particle  geometry  and  electron  trajectory  are  kept  intact,  only  the 
ğœ‚ğœ‚ =
electron speed, the particle refractive index, and simulation frequency (energy loss or vacuum 
ğ‘šğ‘šh(ğœ”ğœ”)
ğœ‰ğœ‰ = 1
wavelength) need to be scaled: 

(45) 

Note that the values of both 

ğœğœ â†’ ğ‘šğ‘šhğœğœ,

 and 
ğ‘šğ‘šp â†’ ğ‘šğ‘šp ğ‘šğ‘šhâ„

 correspond to the original frequency rather than to the 

â„ğœ”ğœ” â†’ ğ‘šğ‘šhâ„ğœ”ğœ” (ğœ†ğœ† â†’ ğœ†ğœ† ğ‘šğ‘šhâ„

).

,

scaled one. Thus, both 

 and 
ğ‘šğ‘šp

 computed with vacuum code for energy loss 
ğ‘šğ‘šh

 are 

exactly  the sought  probabilities  for energy  loss 

ğ‘ƒğ‘ƒEELS

ğ‘ƒğ‘ƒCL

  in  the  host medium.  The  second  option 

ğ‘šğ‘šhâ„ğœ”ğœ”

keeps 

 and 

 intact at the cost of additional geometrical scaling, i.e. 

â„ğœ”ğœ”

. Thus, 

additionally both particle dimensions and electron position need to be multiplied by 

ğœ”ğœ”

ğœ†ğœ†

ğœ‚ğœ‚ = ğ‘šğ‘šh = 1 ğœ‰ğœ‰â„
ğ‘šğ‘šh

: 

(46) 

ğœğœ â†’ ğ‘šğ‘šhğœğœ,

ğ‘šğ‘šp â†’ ğ‘šğ‘šp ğ‘šğ‘šhâ„

,

ğ«ğ« â†’ ğ‘šğ‘šhğ«ğ«,

ğ«ğ«0 â†’ ğ‘šğ‘šhğ«ğ«0,

In this case, the probability density computed by the vacuum code needs to be further divided 

ğ‘ƒğ‘ƒEELS,CL â†’ ğ‘šğ‘šhğ‘ƒğ‘ƒEELS,CL.

by 

. Finally, note that the scaling 

 corresponds to the following scaling of electron 

kinetic energy 

ğ‘šğ‘šh

: 

ğœğœ â†’ ğ‘šğ‘šhğœğœ

â„°

16 

 
 
 
 
 
 
 
(47) 

where 

2
 is the electron rest mass energy. 
ï¿½â„°0

âˆ’ (ğœ€ğœ€h âˆ’ 1)â„°(2â„°0 + â„°)
Naturally, the proposed scaling cannot transform the Cherenkov case into a vacuum one, 

2

âˆ’ 1ï¿½,

  â„° â†’ â„°0 ï¿½

â„°0 = ğ‘šğ‘šeğ‘ğ‘

â„° + â„°0

but an alternative approximate scaling for the case 

 is described in Section S4 of the 

Supporting Information. 

ğ›½ğ›½h > 1

3  Simulations 
3.1  Implementation in ADDA 

To  perform  EELS  and  CL  simulations  according  to  the  developed  general  theory,  we 

modified the open-source software ADDA.[21] A single run of ADDA performs a simulation 

for a single set of parameters (

, beam position, etc.). To simulate a loss spectrum or to scan a 

particleâ€™s cross-section with the beam, it is necessary to run ADDA multiple times varying the 

ğœ†ğœ†

desired parameters. For instance, to simulate the EELS and CL spectra one needs to vary 

 and 

the corresponding 

. We developed a Python wrapper, named ADDAwrapper, to automate 

ğœ†ğœ†

this process. 

ğ‘šğ‘šp

The wrapper is designed to work as a Python library, so one only has to fill the example 

preset  file  with  the  simulation  parameters,  and  call  high-level  functions  from  this  file  to 

perform the corresponding set of simulations (spectrum, loss probability scan over the cross-

section  of  the  particle,  etc.),  collect  the  data  from  these  simulations,  and  plot  it  in  various 

formats. Ready-to-use examples are distributed with the ADDA in the folder /examples/.  
ADDAwrapper  supports  multithreading  to  speed  up  the  simulation  up  to  an  order  of 
physical  processor  cores.  Apart  from  that,  the  examples  use  optimized  set  of  simulation 

parameters, which allows the wrapper to perform EELS and CL simulations with ADDA up to 

an  order  of  magnitude  faster  than  with  the  default  code  settings.  More  details  are  given  in 

Section S5 of the Supporting Information. 

3.2  Comparison to the Lorenz-Mie theory in vacuum 

The classical Lorenz-Mie theory presents a solution of light scattering by a homogeneous 

sphere.[46] This solution was extended for calculation of the EELS and CL by Garcia de Abajo 

et al.,[5,47] who also implemented it in the online simulation tool,[48] which we used to obtain 

the reference solutions. 

In Fig. 2. we present the EELS and CL spectra simulated with ADDA and the Lorenz-Mie 

theory. In vacuum an electron with kinetic energy 

 100 keV passes at a distance of 100 nm 

â„° =

17 

 
from the center of a silver 75-nm-radius sphere. Optical data for silver is taken from [49], since 

it is available as a built-in option in the Lorenz-Mie simulation tool, and 128 dipoles along the 

-axis  (

)  are  used  for  volume  discretization.  Step  size  of  0.05 eV  is  used  for  all 

simulations of spectra. 
ğ‘¥ğ‘¥

ğ‘›ğ‘›ğ‘¥ğ‘¥ = 128

Fig. 2. EELS and CL spectra of a sphere simulated with the Lorenz-Mie theory and ADDA (

). 

The problem parameters are shown in the inset. 

ğ‘›ğ‘›ğ‘¥ğ‘¥ = 128

Simulated spectra are close to the exact solution, but can be further improved by increasing  

 (refining discretization) at the expense of extra computational resources. A more efficient 

approach is to employ the Richardson extrapolation.[50] Although it is a semi-empirical method, 
ğ‘›ğ‘›ğ‘¥ğ‘¥
it  was  successfully  used  in  various  applications[51â€“54]  and  was  especially  efficient  for 

nanoparticles. In particular, we used the guidelines from [50], performing simulations for a set 

of 

 128, 108, 91, 76, 64, 54, 45, 38, and 32 and extrapolating the dependence on the dipole 

size to 
ğ‘›ğ‘›ğ‘¥ğ‘¥ =

 using the quadratic function (see Fig. 3 for an example). The errors of data points 

were assumed to scale as 

ğ‘‘ğ‘‘ = 0

, and the standard error of fitted value at 

 was multiplied by 

2 to obtain nominal 95% confidence interval. 

3

ğ‘‘ğ‘‘

ğ‘‘ğ‘‘ = 0

18 

 
Fig. 3. Extrapolation of the simulated 

 value at 

 3.6 eV. The parameters of the problem are the 

ğ‘ƒğ‘ƒEELS

same as in Fig. 2. 

ğ‘ğ‘ğ¸ğ¸ =

In Fig. 4 the same Richardson extrapolation applied to the whole spectrum leads to almost 

perfect  match  with  the  exact  solution.  The  extrapolation  is  performed  automatically  by 

ADDAwrapper both for a single 

 and for the whole spectrum. 

ğ‘ğ‘ğ¸ğ¸

Fig. 4. EELS and CL spectra simulated with the Lorenz-Mie theory and ADDA (

 with the 

extrapolation). 95% confidence interval is showed for the extrapolated values. The parameters of the problem 

ğ‘›ğ‘›ğ‘¥ğ‘¥ = 128

are shown in the inset (the same as in Fig. 2). 

3.3  Comparison to the BEM in a host medium 

Next, we  consider particles embedded  in a host medium. In Fig. 5 we show  how EELS 

spectrum  changes  when  the  same  sphere  is  placed  inside  a  non-absorbing  host  medium,  in 

comparison to the simulation for vacuum (

). In host media the peaks shift to the lower 

energies  and  their  magnitudes  decrease.  We  also  performed  scaling  of  separate  DDA 
ğ‘šğ‘šh = 1

19 

 
 
simulations  for  a  particle  in  vacuum  according  to  Section  2.7  â€“  both  approaches  there 

[Eqs. (45), (46)] lead to identical results (only one of them is shown). For 

 the scaled 

spectrum perfectly matches the one obtained by directly setting this value of 

 in the code 

ğ‘šğ‘šh = 1.5

(Fig. 5). By contrast, for 

 the electron with 100 keV kinetic energy moves faster (

ğ‘šğ‘šh

) 

than  the  speed  of  light  in  this  medium  (

ğ‘šğ‘šh = 2

),  causing  qualitative  differences  in  theoretical 

0.55ğ‘ğ‘

description of this process (

). Specifically, the exact scaling is not valid anymore, 

0.5ğ‘ğ‘

but we have tried an approximate correction given by Eq. (S16) in the Supporting Information. 

ğ›½ğ›½h = 1.10

One can see that such scaling qualitatively reproduces the data, both peak positions and, less 

accurately, amplitudes. However, it is less accurate for peak magnitudes of CL (Fig. S1). See 

also Fig. S2 for further discussion of this scaling as a function of 

. 

ğ‘šğ‘šh

100 keV e

Ag

100 nm

mh

Fig. 5. EELS spectra for a sphere in an infinite non-absorbing host medium simulated with ADDA 

(

 128), either directly or through scaling of simulations in vacuum (see the text for details). The problem 

parameters are shown in the inset. In the host medium with 

ğ‘›ğ‘›ğ‘¥ğ‘¥ =

 the electron is faster than light, causing the 

Cherenkov radiation. 
ğ‘šğ‘šh = 2

We further compare our results with the BEM, as implemented in the MNPBEM17 code,[10] 

as  it  seems  to  support  arbitrary  host  medium.  We  limit  ourselves  to  EELS  in  this  section, 

presenting the corresponding CL results in the Supporting Information (Fig. S3â€“Fig. S5). First, 

we reproduce the EELS data from Fig. 4. As shown in Fig. 6, the BEM agrees with the DDA 

and the Lorenz-Mie theory except for the lowest loss energies (<1.4 eV). We used 1024 surface 

points for all BEM simulations, and further mesh refinement did not improve the accuracy for 

such energies. We hypothesize that it is related to large 

 in this range, but it is not 

important for further discussion. Note also that CL results for BEM do not have this artifact 

ï¿½ğ‘šğ‘špï¿½ > 7

(Fig. S3). Since the online tool[48] does not allow manual specification of a dielectric function 

20 

 
(which is used below), we further use the Lorenz-Mie theory built into MNPBEM. However, 

we tested that they produce identical results for the case of Fig. 6 (data not shown). 

Fig. 6. EELS spectra simulated with the Lorenz-Mie theory, ADDA (

 128 with the extrapolation), and 

the BEM. The parameters of the problem are shown in the inset (the same as in Fig. 4). 

ğ‘›ğ‘›ğ‘¥ğ‘¥ =

Next, we set 

 in both MNPBEM and ADDA and compare the results with the 

Lorenz-Mie  theory,  scaled  according  to  Eq. (45).  The  results  in  Fig. 7  show  that  all  three 

ğ‘šğ‘šh = 1.5

methods agree. The visible inaccuracy of the DDA at the peak value at 3.0 eV disappears with 

further grid refinement to 

 192 with the extrapolation (data not shown). The CL results 

also agree, but only if the MNPBEM results are additionally multiplied by 

ğ‘›ğ‘›ğ‘¥ğ‘¥ =

 (Fig. S4). 

ğ‘šğ‘šh
100 keV e

Ag

100 nm

mh=1.5

Fig. 7. EELS spectra simulated with the Lorenz-Mie theory (using scaling), ADDA (

 128 with the 

extrapolation), and BEM. The parameters of the problem are shown in the inset (subset of Fig. 5). 

ğ‘›ğ‘›ğ‘¥ğ‘¥ =

21 

 
 
The  situation  is  markedly  different  for 

  (Cherenkov  case),  as  shown  in  Fig. 8 

featuring huge difference between the DDA and BEM. To investigate this issue, let us formally 

ğ‘šğ‘šh = 2

define the extinction probability 

 by analogy to 

 [Eq. (37)] as 

As discussed in Section 2.5, 

for the case of 

ğ‘ƒğ‘ƒext

ğ‘ƒğ‘ƒEELS
â€²
2
ğœ€ğœ€0ğ¸ğ¸0
ğ‘šğ‘šh
ğ‘˜ğ‘˜0 ğ¶ğ¶ext.
2
 for 
ğœ‹ğœ‹â„
 (data not shown). However, they are different for 
ğ‘ƒğ‘ƒEELS

ğ‘Šğ‘Šext
2
2
=
 is identical to 
ğœ‹ğœ‹
ğœ”ğœ”
â„

ğ‘ƒğ‘ƒext(â„ğœ”ğœ”) â‰

ğ›½ğ›½h < 1

ğ‘ƒğ‘ƒext

, which we explicitly tested 

, as shown 

(48) 

in Fig. 8. And, surprisingly, the spectrum simulated with BEM turns out to be matching 

ğ‘šğ‘šh = 1.5

ğ‘šğ‘šh = 2

values  instead  of 

,  but  is 
ğ‘ƒğ‘ƒext
incorrect for the Cherenkov case. It uses the correct incident field in the latter case, but seems 

.  Thus,  we  conclude  that  MNPBEM  works  fine  for 

ğ‘ƒğ‘ƒEELS

to use incorrect expression for 

 based on equivalence of 

 and 

ğ›½ğ›½h < 1
 that no longer 

holds. The latter equivalence is also implicitly used in other DDA codes for EELS simulations: 

ğ‘Šğ‘Šext

ğ‘Šğ‘Šenh

ğ‘ƒğ‘ƒEELS

e-DDA[9] and DDEELS.[8] By contrast, the results of 

 computed with MNPBEM for 

  agree  with  the  DDA  after  multiplication  by 

definition of 
2
as discussed in Section 2.6. 
ğ‘ƒğ‘ƒCL

 is not affected by the difference between 

ğ‘šğ‘šh

  (Fig. S5).  This  is  expected,  since  the 
ğ‘šğ‘šh =
ğ‘ƒğ‘ƒCL
), 

 (in contrast to 

 and 

ğ‘Šğ‘Šext

ğ‘Šğ‘Šenh

tot
ğ‘ƒğ‘ƒCL

100 keV e

Ag

100 nm

mh=2

Fig. 8. EELS and extinction probabilities simulated with the DDA (

 128 with the extrapolation) 

compared to EELS spectrum simulated with BEM. The parameters of the problem are shown in the inset (subset 

ğ‘›ğ‘›ğ‘¥ğ‘¥ =

of Fig. 5). 

3.4  Comparison to the experiments 

In EELS experiments a particle is usually placed on or inside a substrate. Raza et al.[11] 

investigated silver nanospheres encapsulated in silicon nitride, which fixes them in place and 

prevents silver oxidation. In that paper both experimental and simulated spectra are shown for 

22 

 
 
 
an encapsulated nanosphere with a radius of 9.2 nm and an electron passing at different impact 

parameters. The simulations were performed for a full system geometry, discretizing the finite 

chunk of the silicon nitride layer. 

By contrast, we try to reproduce these experimental data by simulations for a particle in an 

infinite host medium.  Specifically, Fig. 9 shows the simulated spectrum for the  same silver 

nanosphere along with the experimental data from [11] for an impact parameter of 12.4 nm. The 

simulation is done in ADDAwrapper for 

, 

 100 keV, and 

 128. This is a 

Cherenkov  medium  with 

ğ‘šğ‘šh = âˆš3.2
somewhat more accurate than the data used in theoretical comparisons of Sections 3.2 and 3.3. 

.  The  optical  data  for  silver  is  taken  from  [55],  which  is 

ğ‘›ğ‘›ğ‘¥ğ‘¥ =

â„° =

ğ›½ğ›½h = 1.05

The  simulated  spectrum  was  additionally  convoluted  with  Gaussian  point  spread  function 

(PSF) with FWHM of 0.15 eV to match the experimental conditions. The simulated spectrum 

matches  the  main  2.8 eV  peak  position,  as  well  as  its  right  shoulder.  The  remaining 

disagreement at the left side of the peak can potentially be related to imperfect zero-loss peak 

removal, which also causes some experimental values at larger loss energies to systematically 

lie below zero. While such negative values are not impossible when 

 (see Section 2.6), 

they are not observed in simulations for the specific problem parameters. 

ğ›½ğ›½h > 1

120 keV e

Ag

12.4 nm

mh=âˆš3.2

Fig. 9. Experimental and simulated EELS spectra for a silver sphere encapsulated in silicon nitride, 

normalized by the maximum value. The problem parameters are in the inset. Experimental data is taken from 

[11], simulation is done with ADDA using 

 128 (blue line) and convoluted with Gaussian PSF with FWHM 

of 0.15 eV (purple line). 

ğ‘›ğ‘›ğ‘¥ğ‘¥ =

In  another  work  Kobylko  et  al.[12]  investigated  gold  nanoparticles  placed  inside  a  glass 

substrate. One of them was a 92.6-nm-long gold nanowire with a 7.8 nm radius, investigated 

by  electrons  with 

 100 keV.  We  modeled  this  nanowire  as  a  perfect  cylinder  with 

hemispheres at both ends with a computational grid of 16x16x190 dipoles and placed it in an 

â„° =

23 

 
infinite medium with 

 (corresponding to 

); optical data for gold is taken 

from [55]. We compare the results of the DDA simulations with the experimental data from [12] 

ğ‘šğ‘šh = 1.45

ğ›½ğ›½h = 0.79

in Fig. 10. The experimental data include EELS spectrum averaged over the cross section of 

the nanowire (Fig. 10, a), as well as plasmon maps for four observed resonant energies (Fig. 10, 

bâ€“e):  0.86,  1.27,  1.66,  and  2.4 eV.  The  simulation  results  include  the  same  cross-section-

averaged spectrum (Fig. 10, f) and the plasmon maps for resonant energies of the simulated 

spectrum  (Fig. 10,  gâ€“j):  0.7,  1.2,  1.55,  and  2.4 eV,  which  are  slightly  different  from  the 

experimental  ones.  The  latter  is  probably  caused  by  imperfect  cylindrical  geometry  of  the 

particle in the experiment. Apart from that and expected broadening of the experimental peaks, 

simulations reproduce the experimental data both for EELS spectrum and plasmon maps. 

Fig. 10. Comparison of experimental EELS data (a-e) for a gold nanowire in a glass substrate from [12] with 

the DDA simulations (f-j) (see the text for details). Shown are the EELS spectrum averaged over the cross 

section of the nanowire (a,f) and plasmon maps for four resonant energies (b-e, g-j). The resonant energies 

slightly differ between experiments and simulations. 

4  Conclusion 

We derived all the quantities necessary to simulate EELS and CL in the DDA in the energy-

budget  framework  based  on  the  volume-integral  equation.  This  framework  has  shown  its 

versatility  in  calculating  the  incident  electric  field,  free-space  energy  losses,  and  particle-

24 

 
induced energy losses of a current source, as well as scattered power corresponding to CL. The 

obtained expressions either coincide with those known from the literature (derived by several 

other  methods)  or  appear  for  the  first  time.  In  particular,  a  volume-integral  expression  for 

particle-induced energy losses of arbitrary source [Eq. (32)] can be efficiently calculated in the 

DDA.  This  expression  remains  valid  for  an  arbitrary  (even  absorbing  or  Cherenkov)  host 

medium, and in the case of vacuum it reduces to the known one.[8,9,36] We also extended the 

scale invariance rule to EELS, allowing one to apply any existing vacuum-based code to the 

case  of  moderately  dense  non-absorbing  host  medium.  The  presented  framework  for  a 

homogeneous  medium  is  derived  using  the  free-space  tensor 

,   but  it  can  be  further 

generalized  to  the  cases  of  layered  media,  such  as  a  semi-infinite  or  thin  substrate,  by 

ğ†ğ†ï¿½

employing the corresponding Greenâ€™s tensors. 

For a test case of a sphere in vacuum, the DDA results (with extrapolation of the computed 

values  versus  the  dipole  size)  almost  match  the  exact  Lorenz-Mie  solution,  exceeding  the 

accuracy of the BEM. The same agreement between the three methods holds for a host medium 

with no intrinsic electron losses, but the results of the Lorenz-Mie theory need to be scaled (as 

mentioned above), since  only  vacuum  implementations  of this  theory are  available.  For the 

Cherenkov (sufficiently dense) host medium, the DDA results for EELS probability disagreed 

with that of BEM (as implemented in the MNPBEM code), since the latter code ignores the 

interference of the Cherenkov and particle-induced radiations (effectively assuming that EELS 

probability is proportional to the extinction power). The CL spectra agree between the DDA 

and BEM in all considered cases up to the overall scale of MNPBEM results (it needed to be 

additionally multiplied by 

). 

Rigorously  accounting  for  the  host  medium  is  important  for  the  corresponding 

ğ‘šğ‘šh

experimental  conditions,  i.e.  when  particles  or  voids  are  considered  in  larger  homogeneous 

slabs,  since  LSPRs  strongly  depend  on  dielectric  properties  of  this  medium.  The 

implementation of the developed theory in the open-source ADDA code, augmented with a 

comprehensive Python wrapper, makes any such simulations easily available to practitioners. 

To illustrate these novel capabilities, we simulated actual EELS experiments: for nanospheres 

encapsulated  in  silicon  nitride  and  nanowires  inside  glass.  For  the  former  experiment,  the 

electrons were faster than the speed of light in the substrate (Cherenkov case), and the DDA 

perfectly reproduced the EELS spectrum in terms of a peak position. For the nanorod inside 

glass  the  DDA  reproduced  the  EELS  spectrum,  as  well  as  the  plasmon  maps  for  all  four 

plasmon resonances determined in the experiment. 

25 

5  Acknowledgments 

We  thank  SÃ¸ren  Raza  for  providing  experimental  data  shown  in  Fig. 9  and  Mathias 

Kobylko  for  providing  experimental  images  shown  in  Fig. 10.  We  also  thank  Tomas 

OstaÅ¡eviÄius  for  making  the  first  prototype  of  EELS  simulations  in  the  ADDA  code  and 

Alexander Moskalensky for implementing the support of host medium in this code (for light-

scattering  simulations).  The  theoretical  developments  and  implementation  of  EELS 

simulations in ADDA were supported by Russian Foundation for Basic Research (grant no. 

18-01-00502).  While  the  comparisons  with  BEM  and  experiments,  the  study  of  simulation 

accuracy, and adding the support of absorbing host medium to ADDA were supported by the 

Russian Science Foundation (grant no. 18-12-00052). 

6  References 
[1]  L.  Novotny,  B.  Hecht,  Principles  of  Nano-Optics,  Cambridge  University  Press, 

Cambridge, UK, 2012. 

[2]  C. Cherqui, N. Thakkar, G. Li, J. P. Camden, D. Masiello, Annu. Rev. Phys. Chem. 2016, 

67, 331. 

[3]  F. J. GarcÃ­a de Abajo, V. Di Giulio, ACS Photonics 2021, 8, 945. 
[4]  M. Kociak, L. F. Zagonel, Ultramicroscopy 2017, 176, 112. 
[5]  F. J. GarcÃ­a de Abajo, Phys. Rev. B 1999, 59, 3095. 
[6]  F. J. GarcÃ­a de Abajo, A. Howie, Phys. Rev. B 2002, 65, 115418. 
[7]  Y. Cao, A. Manjavacas, N. Large, P. Nordlander, ACS Photonics 2015, 2, 369. 
[8]  N. Geuquet, L. Henrard, Ultramicroscopy 2010, 110, 1075. 
[9]  N. W. Bigelow, A. Vaschillo, V. Iberi, J. P. Camden, D. J. Masiello, ACS Nano 2012, 6, 

7497. 

[10]  U. Hohenester, Comp. Phys. Commun. 2014, 185, 1177. 
[11]  S. Raza, S. Kadkhodazadeh, T. Christensen, M. Di Vece, M. Wubs, N. A. Mortensen, N. 

Stenger, Nat Commun 2015, 6, 8788. 

[12]  M. Kobylko, P.-E. Coulon, A. Slablab, A. Fafin, J. Cardin, C. Dufour, A. Losquin, M. 
Kociak, I. Monnet, D. Mailly, X. Lafosse, C. Ulysse, E. Garcia-Caurel, G. Rizza, Phys. 
Rev. Appl. 2018, 9, 064038. 

[13]  S. Kadkhodazadeh, T. Christensen, M. Beleggia, N. A. Mortensen, J. B. Wagner, ACS 

Photonics 2017, 4, 251. 

[14]  S. A. Maier, H. A. Atwater, J. Appl. Phys. 2005, 98, 011101. 
[15]  A. Losquin, L. F. Zagonel, V. Myroshnychenko, B. RodrÃ­guez-GonzÃ¡lez, M. TencÃ©, L. 
Scarabelli, J. FÃ¶rstner, L. M. Liz-MarzÃ¡n, F. J. GarcÃ­a de Abajo, O. StÃ©phan, M. Kociak, 
Nano Lett. 2015, 15, 1229. 

[16]  S. Raza, S. Kadkhodazadeh, T. Christensen, M. Di Vece, M. Wubs, N. A. Mortensen, N. 

Stenger, Nat. Commun. 2015, 6, 8788. 

[17]  N. Sakaguchi, S. Matsumoto, Y. Kunisada, M. Ueda, J. Phys. Chem. C 2019, 123, 6735. 
[18]  M. A. Yurkin, A. G. Hoekstra, J. Quant. Spectrosc. Radiat. Transfer 2007, 106, 558. 
[19]  M. I. Mishchenko, M. A. Yurkin, J. Quant. Spectrosc. Radiat. Transfer 2018, 214, 158. 
[20]  B. T. Draine, P. J. Flatau, J. Opt. Soc. Am. A 1994, 11, 1491. 
[21]  M. A. Yurkin, A. G. Hoekstra, J. Quant. Spectrosc. Radiat. Transfer 2011, 112, 2234. 
[22]  N. W. Bigelow, A. Vaschillo, J. P. Camden, D. J. Masiello, ACS Nano 2013, 7, 4511. 
[23]  A. E. Moskalensky, M. A. Yurkin, Phys. Rev. A 2019, 99, 053824. 

26 

[24]  A. A. Kichigin, M. A. Yurkin, in AIP Conf. Proc., ITMO University, Online, 2020, 2300, 

020053. 

[25]  A. A. Kichigin, M. A. Yurkin, in J. Phys.: Conf. Ser., ITMO University, Online, 2021, 

2015, 012064. 

[26]  M. A. Yurkin, M. I. Mishchenko, Phys. Rev. A 2018, 97, 043824. 
[27]  M.  I.  Mishchenko,  Electromagnetic  Scattering  by  Particles  and  Particle  Groups:  An 

Introduction, Cambridge University Press, Cambridge, UK, 2014. 

[28]  M. I. Mishchenko, Opt. Express 2007, 15, 13188. 
[29]  M.  I.  Mishchenko,  M.  A.  Yurkin,  J.  Quant.  Spectrosc.  Radiat.  Transfer  2020,  242, 

106688. 

[30]  C.  F.  Bohren,  D.  R.  Huffman,  Absorption  and  Scattering  of  Light  by  Small  Particles, 

Wiley, New York, 1983. 

[31]  M. A. Yurkin, M. I. Mishchenko, Phys. Rev. A 2018, 97, 043824. 
[32]  F. W. J. Olver, A. B. Olde Dallhuis, D. W. Lozier, B. I. Schneider, R. F. Boisvert, C. W. 
Clark, B. R. Miller, B. V. Saunders, H. S. Cohl, M.  A. McClain,  Eds., [DLMF] NIST 
Digital Library of Mathematical Functions, 2022. 

[33]  J. D. Jackson, Classical Electrodynamics, Wiley, New York, 1998. 
[34]  I. Frank, I. Tamm, Comptes Rendus (Dokl.) Acad. Sci. URSS 1937, 14, 109. 
[35]  P. A. Cherenkov, Phys. Rev. 1937, 52, 378. 
[36]  L. Henrard, P. Lambin, J. Phys. B 1996, 29, 5127. 
[37]  A. A. Lucas, M. Å unjiÄ‡, Prog. Surf. Sci. 1972, 2, 75. 
[38]  R. H. Ritchie, A. Howie, Phil. Mag. A 1988, 58, 753. 
[39]  F. J. GarcÃ­a de Abajo, Rev. Mod. Phys. 2010, 82, 209. 
[40]  O. Kfir, Phys. Rev. Lett. 2019, 123, 103602. 
[41]  V. L. Ginzburg, Physica Scripta 1982, T2/1, 182. 
[42]  M. I. Mishchenko, P. Yang, J. Quant. Spectrosc. Radiat. Transfer 2018, 205, 241. 
[43]  J. Dong, W. Zhang, L. Liu, Opt. Express 2021, 29, 7690. 
[44]  M. A. Yurkin, A. G. Hoekstra, â€œUser manual for the discrete dipole approximation code 
https://github.com/adda-

found 

under 

can 

be 

ADDA 
team/adda/raw/v1.4.0/doc/manual.pdf, 2020. 

1.4.0,â€ 

[45]  M. I. Mishchenko, J. Quant. Spectrosc. Radiat. Transfer 2006, 101, 411. 
[46]  G. Mie, Ann. Phys. 1908, 330, 377. 
[47]  F. J. GarcÃ­a de Abajo, A. Howie, Phys. Rev. Lett. 1998, 80, 5180. 
[48]  F.  J.  GarcÃ­a  de  Abajo,  â€œElectron  energy  loss  (EELS)  and  photon  emission 
(cathodoluminescence)  for  an  electron  passing  near  a  homogeneous  sphere.,â€  can  be 
found under http://widgets.nanophotonics.es/sphere/index.html, 2022. 
[49]  E. D. Palik, Handbook of Optical Constants of Solids, Academic Press, 1985. 
[50]  M. A. Yurkin, V. P. Maltsev, A. G. Hoekstra, J. Opt. Soc. Am. A 2006, 23, 2592. 
[51]  J. I. Hage, J. M. Greenberg, R. T. Wang, Appl. Opt. 1991, 30, 1141. 
[52]  M. A. Yurkin, D. de Kanter, A. G. Hoekstra, J. Nanophoton. 2010, 4, 041585. 
[53]  M. A. Yurkin, M. Kahnert, J. Quant. Spectrosc. Radiat. Transfer 2013, 123, 176. 
[54]  C. Liu, S. Teng, Y. Zhu, M. A. Yurkin, Y. L. Yung, J. Quant. Spectrosc. Radiat. Transfer 

2018, 221, 98. 

[55]  S. Babar, J. H. Weaver, Appl. Opt. 2015, 54, 477. 
[56]  G.  S.  Smith,  An  Introduction  to  Classical  Electromagnetic  Radiation,  Cambridge 

University Press, 1997. 

[57]  M.  A.  Yurkin,  A.  E.  Moskalensky,  in  J.  Phys.:  Conf.  Ser.,  ITMO  University,  Online, 

2021, 2015, 012167. 

27 

 
Supporting Information for:  

Simulating electron energy-loss spectroscopy and 

cathodoluminescence for particles in arbitrary host medium 

using the discrete dipole approximation 

Alexander A. Kichigin1,2 and Maxim A. Yurkin1,2,* 

1 Voevodsky Institute of Chemical Kinetics and Combustion SB RAS,  

Institutskaya Str. 3, 630090, Novosibirsk, Russia 

2 Novosibirsk State University, Pirogova Str. 2, 630090, Novosibirsk, Russia 

*Corresponding author: yurkin@gmail.com  

S1 Fourier transform 

We use the following definitions for the direct and inverse Fourier transforms: 

âˆ

ğ‘“ğ‘“(ğœ”ğœ”) = ï¿½ dğ‘¡ğ‘¡ğ‘“ğ‘“(ğ‘¡ğ‘¡)ğ‘’ğ‘’
âˆ’âˆ

âˆ

1
2ğœ‹ğœ‹

âˆ’iğœ”ğœ”ğœ”ğœ”

,

iğœ”ğœ”ğœ”ğœ”

(S1) 

 be real-valued functions, then, according to the Plancherel theorem,  

ï¿½ dğœ”ğœ”ğ‘“ğ‘“(ğœ”ğœ”)ğ‘’ğ‘’
âˆ’âˆ

.

ğ‘“ğ‘“(ğ‘¡ğ‘¡) =

Let 

 and 

ğ‘“ğ‘“(ğ‘¡ğ‘¡)

ğ‘”ğ‘”(ğ‘¡ğ‘¡)

âˆ

âˆ

The real-valuedness of 

ï¿½ dğ‘¡ğ‘¡ğ‘“ğ‘“(ğ‘¡ğ‘¡)ğ‘”ğ‘”(ğ‘¡ğ‘¡)
âˆ’âˆ

=
 implies that 

1
2ğœ‹ğœ‹

ï¿½ dğœ”ğœ”ğ‘“ğ‘“(ğœ”ğœ”)ğ‘”ğ‘”
âˆ’âˆ

âˆ—
 and analogously for 

(ğœ”ğœ”)

.

âˆ—
we split the integration interval and, using substitution 

ğ‘“ğ‘“(âˆ’ğœ”ğœ”) = ğ‘“ğ‘“

(ğœ”ğœ”)

ğ‘“ğ‘“(ğ‘¡ğ‘¡)

, re-write Eq. (S2) as  

ğ‘”ğ‘”

(S2)  

. Therefore, 

0
S2 Energy transfer for sources with general time dependence 

ï¿½ dğ‘¡ğ‘¡ğ‘“ğ‘“(ğ‘¡ğ‘¡)ğ‘”ğ‘”(ğ‘¡ğ‘¡)
âˆ’âˆ

=

 ï¿½ dğœ”ğœ”Re[ğ‘“ğ‘“(ğœ”ğœ”)ğ‘”ğ‘”

(ğœ”ğœ”)]

.

âˆ

âˆ

1
ğœ‹ğœ‹

ğœ”ğœ” â†’ âˆ’ğœ”ğœ”

âˆ—

(S3)  

In the energy budget framework the expressions for the powers are derived for the case of 

time-harmonic fields. Any other fields can be represented as a linear superposition of time-

harmonic  fields,  the  formal  mechanism  for  this  representation  is  the  Fourier  transform  (see 

Section S1). First, note that the Fourier transforms of fields, 

 and 

, have the units of 

electric and magnetic field per frequency, i.e., V

s/m and A

s/m, respectively. As a result, the 
ğ„ğ„(ğ«ğ«)

ğ‡ğ‡(ğ«ğ«)

units of their powers are W

s2=J

s. 

â‹…
We further derive the total energy lost by the electron, starting from the time domain and 

â‹…

â‹…

â‹…

converting to the frequency one according to Section 1.7.5 of [56]. Let 

 and 

 be the 

28 

ğ„ğ„(ğ«ğ«, ğ‘¡ğ‘¡)

ğ‡ğ‡(ğ«ğ«, ğ‘¡ğ‘¡)

 
 
 
 
 
electric and the magnetic fields respectively, then the time-domain Poynting vector is defined 

as 

and the total energy gained or lost inside a closed surface 
ğ’ğ’(ğ«ğ«, ğ‘¡ğ‘¡) â‰ ğ„ğ„(ğ«ğ«, ğ‘¡ğ‘¡) Ã— ğ‡ğ‡(ğ«ğ«, ğ‘¡ğ‘¡),

 is 

âˆ

ğ´ğ´

(S4) 

(S5) 

We use the same symbols for time- and frequency-domain counterparts, but the time argument 

âˆ’âˆ

ğ´ğ´

âˆ†ğ¸ğ¸ = ï¿½ dğ‘¡ğ‘¡ ï¿½ dğ€ğ€ â‹… ğ’ğ’(ğ«ğ«, ğ‘¡ğ‘¡)
.

is always explicitly included for the former to avoid confusion. We further change the order of 

integration and apply Eq. (S3) to transit to the frequency domain: 

âˆ

âˆ

âˆ†ğ¸ğ¸ = ï¿½ dğ€ğ€ â‹… ï¿½ dğ‘¡ğ‘¡[ğ„ğ„(ğ«ğ«, ğ‘¡ğ‘¡) Ã— ğ‡ğ‡(ğ«ğ«, ğ‘¡ğ‘¡)]

ğ´ğ´

âˆ’âˆ

âˆ

=

2
ğœ‹ğœ‹

ï¿½ dğœ”ğœ” ï¿½ dğ€ğ€ â‹…
0

ğ´ğ´

âˆ—

Re[ğ„ğ„(ğ«ğ«) Ã— ğ‡ğ‡

(ğ«ğ«)]

1
2

(S6) 

where 

 is the power for a time-harmonic field [cf. Eqs. (9), (10)]. Eq. (S6) is the universal 

=

ï¿½ dğœ”ğœ” ğ‘Šğ‘Š,
0

2
ğœ‹ğœ‹

way to convert time-harmonic powers into the total energy transfers for fields with general 

ğ‘Šğ‘Š

time dependence, such as the one for a moving electron. 

S3 Electric field derivation 

To calculate the integral defined by Eq. (23), we rewrite it as 

where 

ğ¼ğ¼1(ğ«ğ«) =

(ğ‘§ğ‘§ âˆ’ ğ‘§ğ‘§0)ï¿½ ï¿½ dğ‘§ğ‘§Ìƒ
2
. To calculate the remaining integral, denoted as 
+ ğ‘§ğ‘§Ìƒ

exp ï¿½i

âˆšğœ”ğœ”

âˆ’âˆ

2

ğ‘ğ‘
4ğœ‹ğœ‹

ğœ”ğœ”
ğœğœ

âˆ

2

2

exp ï¿½iğ‘˜ğ‘˜âˆšğœ”ğœ”

+ ğ‘§ğ‘§Ìƒ

âˆ’ i

(S7) 

ğœ”ğœ”
ğ‘§ğ‘§Ìƒï¿½
ğœğœ
, let us introduce 

,

 such that 

ğ‘§ğ‘§Ìƒ â‰ ğ‘§ğ‘§ âˆ’ ğ‘§ğ‘§â€²

 and use the identity 

â„

sinh ğ‘¢ğ‘¢ = ğ‘§ğ‘§Ìƒ/ğœ”ğœ”

âˆ

2
cosh

2
ğ‘¢ğ‘¢ âˆ’ sinh

: 
ğ¼ğ¼S(ğœ”ğœ”)

ğ‘¢ğ‘¢ = 1

ğ‘¢ğ‘¢ âˆˆ

(S8) 

In the case 

ğ¼ğ¼S(ğœ”ğœ”) = ï¿½ dğ‘¢ğ‘¢ exp ï¿½i
âˆ’âˆ

 we use the integral representation for the Hankel function of the first 

(ğ›½ğ›½h cosh ğ‘¢ğ‘¢ âˆ’ sinh ğ‘¢ğ‘¢)ï¿½ .

ğœ”ğœ”ğœ”ğœ”
ğœğœ

kind 

 (Eq. 10.9.15 of [32]) by substituting 

Im ğ›½ğ›½h > 0

 (

) and 

, 

and then express it as a modified Bessel function 

ğ“ğ“ = ğœ”ğœ”ğœ”ğœ”ğ›½ğ›½h ğœğœâ„

 (Eq. 10.27.8 of [32]): 

Im ğ“ğ“ > 0

ğœğœ = âˆ’ ğœ”ğœ”ğœ”ğœ” ğœğœâ„ âˆˆ â„

(1)

ğ»ğ»0

ğ¾ğ¾0

where we introduced the transverse wave vector of the electron field 

ğœ”ğœ”ğœ”ğœ”
ğœğœ
transformation in Eq. (S9) remains valid on the boundary of the first quadrant (for 

âˆ’ 1ï¿½ = 2ğ¾ğ¾0(ğ‘˜ğ‘˜tğœ”ğœ”),

ğ¼ğ¼S(ğœ”ğœ”) = ğœ‹ğœ‹iğ»ğ»0

2
ï¿½ğ›½ğ›½h

ï¿½

(1)

ğ‘˜ğ‘˜t â‰ ğœ”ğœ” (ğ›¾ğ›¾hğœğœ)
â„

(S9) 

. The last 

), 

specifically, when 

 (but 

), because both 

 (or 

) and the principal branch of 

Im ğ›½ğ›½h = 0

ğ›½ğ›½h â‰  1
 are continuous with respect to 

ğ›½ğ›½h > 0

 approaching the boundary from inside the quadrant. 

ğ›¾ğ›¾h

ğ‘˜ğ‘˜t

2
ï¿½ğ›½ğ›½h

âˆ’ 1

ğ›½ğ›½h

29 

 
 
 
 
 
 
Therefore,  the  validity  of  the  whole  Eq. (S9)  follows  from  the  analytic  continuation  of  the 

integral to the boundary of the quadrant. 

However, for additional rigor, we further separately consider the cases of 

 and 

. In the former case (including the case of vacuum) we introduce 

ğ›½ğ›½h > 1
Then collecting 

tanh ğ‘¤ğ‘¤ = ğ›½ğ›½h â‡’ sinh ğ‘¤ğ‘¤ = ğ›½ğ›½hğ›¾ğ›¾h, cosh ğ‘¤ğ‘¤ = ğ›¾ğ›¾h.

 inside the exponent and replacing 

, we obtain 

sinh(ğ‘¢ğ‘¢ âˆ’ ğ‘¤ğ‘¤)

âˆ

ğ‘¢ğ‘¢ âˆ’ ğ‘¤ğ‘¤ â†’ ğ‘¢ğ‘¢

(S11) 

ğ¼ğ¼S(ğœ”ğœ”) = ï¿½ dğ‘¢ğ‘¢ exp(âˆ’iğ‘˜ğ‘˜tğœ”ğœ” sinh ğ‘¢ğ‘¢)
where the latter equality follows from Eq. 10.32.6 of  [32]. For the case 

= 2ğ¾ğ¾0(ğ‘˜ğ‘˜tğœ”ğœ”),

âˆ’âˆ

 such that 

ğ‘¤ğ‘¤ âˆˆ â„
Then collecting 

coth ğ‘¤ğ‘¤ = ğ›½ğ›½h â‡’ sinh ğ‘¤ğ‘¤ = âˆ’iğ›¾ğ›¾h, cosh ğ‘¤ğ‘¤ = âˆ’iğ›½ğ›½hğ›¾ğ›¾h.

 we obtain similarly to Eq. (S11)  

 such that 
0 < ğ›½ğ›½h < 1

ğ‘¤ğ‘¤ âˆˆ â„

(S10) 

 we introduce 

ğ›½ğ›½h > 1

(S12) 

(S13) 

cosh(ğ‘¢ğ‘¢ âˆ’ ğ‘¤ğ‘¤)
âˆ

(1)

where the integral representation of 

âˆ’âˆ

ğ¼ğ¼S(ğœ”ğœ”) = ï¿½ dğ‘¢ğ‘¢ exp(âˆ’ğ‘˜ğ‘˜tğœ”ğœ” cosh ğ‘¢ğ‘¢)

= ğœ‹ğœ‹iğ»ğ»0

(iğ‘˜ğ‘˜tğœ”ğœ”) = 2ğ¾ğ¾0(ğ‘˜ğ‘˜tğœ”ğœ”),

 is based on Eq. 10.9.9 of [32] (since in this case 

). Combining the expression for 

(1)
 with Eq. (S7), we finally obtain: 

ğ»ğ»0
ğ¼ğ¼S(ğœ”ğœ”)

0

iğ‘˜ğ‘˜t >

(S14) 

S4 Ultra-relativistic scaling 

ğ¼ğ¼1(ğ«ğ«) =

exp ï¿½i

ğ‘ğ‘
2ğœ‹ğœ‹

ğœ”ğœ”
ğœğœ

(ğ‘§ğ‘§ âˆ’ ğ‘§ğ‘§0)ï¿½ ğ¾ğ¾0 ï¿½

ğœ”ğœ”ğœ”ğœ”
ğ›¾ğ›¾hğœğœ

ï¿½.

Let  us,  first,  discuss  the  behavior  of  the  incident  field  in  the  case 

,  when 

Eq. (25) simplifies into 

ğœ”ğœ”ğœ”ğœ” â‰ª |ğ›¾ğ›¾h|ğœğœ

ğ„ğ„inc(ğ«ğ«) â‰ˆ
Here we used Eq. 10.31.1 of [32] and the fact that 

exp ï¿½i

(ğ‘§ğ‘§ âˆ’ ğ‘§ğ‘§0)ï¿½ 

ğ‘ğ‘
2ğœ‹ğœ‹ğœ€ğœ€hğœğœ

ğœ”ğœ”
ğœğœ

1
2 ï¿½
ğœ”ğœ”

ğ‘¥ğ‘¥ âˆ’ ğ‘¥ğ‘¥0
ğ‘¦ğ‘¦ âˆ’ ğ‘¦ğ‘¦0
. For moderately fast electrons 
0

ï¿½. 

(S15) 

(

, 

) Eq. (S15) is valid whenever 

 is much smaller than the light wavelength in 
â€“ ln ğœ”ğœ” â‰ª 1 ğœ”ğœ”â„

the medium, i.e. in the classical quasi-static regime (
|ğ›¾ğ›¾h| âˆ¼ 1
ğœ”ğœ”
then we can neglect the remaining exponent as well leading to the field of a wire with static 

 is comparable to 

ğ›½ğ›½h âˆ¼ 1

). If 

, 

|ğ‘§ğ‘§ âˆ’ ğ‘§ğ‘§0|

ğœ”ğœ”

current (independent of 

). However, for 

; then Eq. (S15) remains 

ğ‘˜ğ‘˜ğœ”ğœ” â‰ª 1
 we have 

valid for much larger 

ğœğœ â†’ ğ‘ğ‘ ğ‘šğ‘šhâ„
(in  dense  media)  always  leads  to  quasi-static  dependence  of  the  field  versus  transverse 

. In other words, ultrarelativistic electron 

 with extra suppression of 
ğœ”ğœ”

|ğ›¾ğ›¾h| â‰« 1

ğœ”ğœ”

coordinates. Importantly, this regime shows that 

 is everywhere continuous with respect to 

 (or 

) and have a finite (and simple) limit for 

. However, its derivative with respect 

to 
ğ›½ğ›½h

 has logarithmic singularity at this point. 
ğ‘šğ‘šh

ğ›½ğ›½h

ğ¸ğ¸inc,ğ‘§ğ‘§

ğ„ğ„inc
ğ›½ğ›½h â†’ 1

30 

 
 
 
 
 
The rigorous scaling, described in Section 2.7, breaks down when the new value of 

 is 

larger than 

. More specifically, the general scaling of Eqs. (43), (44) works perfectly well in 

ğœğœ

the Cherenkov case, but then none of the two equivalent host media can be a vacuum one (due 

ğ‘ğ‘
. However, we can try to push it a bit further using the quasi-static limit of Eq. (S15). 

to 

Assuming the exponent to weakly depend on 

ğ›½ğ›½h > 1)

 (apart from a constant phase factor, which is 

irrelevant for computed probabilities), we obtain: 

ğœğœ

Thus, we may use any of the two scaling approaches above, then set 

ğ„ğ„inc â†’ ğ›½ğ›½hğ„ğ„inc,

  ğœğœ â†’ ğ‘ğ‘,

ğ‘ƒğ‘ƒEELS,CL.

2
ğ‘ƒğ‘ƒEELS,CL â†’ ğ›½ğ›½h

(S16) 

 (corresponding to 

) in vacuum simulation, and additionally divide the obtained probabilities by 

. Note, 

ğœğœ = ğ‘ğ‘

however,  that  this  approximation  does  not  correctly  describe  the  first  order  of  deviation  of 
â„° â‰« â„°0
probabilities  when 

  increases  from  1  due  to  logarithmic  singularity  of  the  derivative 

2
ğ›½ğ›½h

discussed in Section 2.2. 

ğ›½ğ›½h

S5 Code implementation  

To  perform  EELS  and  CL  simulations  according  to  the  developed  general  theory,  we 

modified the open-source software ADDA.[21] First, we added an option to use the electric field 

of a relativistic electron [Eq. (25)] as the incident field in ADDA. A user has to specify the 

electron kinetic energy in keV and coordinates of the beam (trajectory) center 

 in 

the  laboratory  reference  frame.  If  needed,  propagation  direction  can  be  changed  from  the 

(ğ‘¥ğ‘¥0, ğ‘¦ğ‘¦0, ğ‘§ğ‘§0)

default one (along the 

-axis). Note, that moving the beam center along the electron trajectory 

(e.g., changing 

 for the default propagation direction) affects only the constant phase factor 

ğ‘§ğ‘§

for both incident and total fields, but none of the measurable quantities. ADDA now has an 

ğ‘§ğ‘§0

option to specify arbitrary host-medium refractive index 

, although the standard light-

scattering  problem  for  a  particle  in  an  absorbing  host  medium  is  still  a  field  of  active 

ğ‘šğ‘šh âˆˆ â„‚

research.[28,43,57] 

A  technical  complication  arises  from  the  fact  that  currently  ADDA  is  based  on  the 

Gaussian-CGS system of units in contrast to SI used in this manuscript. Moreover, the unit of 

length is assumed to be nm in contrast to any other electromagnetic excitation (when any unit 

of length can be used as long as it is the same for all input and output quantities).[44] Therefore, 

the incident field given by Eq. (25) is additionally transformed from Vâˆ™s/m into statVâˆ™s/cm in 

ADDA, which then  computes  all cross  sections  including 

 [Eq. (38)] in nm2, assuming 

 statVâˆ™s/cm. It further computes 

 and 

 using Eqs. (37) and (41), respectively, 

ğ¶ğ¶enh

and identity 
ğ¸ğ¸0 = 1

2
4ğœ‹ğœ‹ğœ€ğœ€0ğ¸ğ¸0

 Jâˆ™s2/m3. 

ğ‘ƒğ‘ƒEELS

ğ‘ƒğ‘ƒCL

= 0.1

31 

 
Particle  refractive  index 

  (or  its  distribution  inside  the  particle)  depends  on  the 

wavelength 

 corresponding to the desired energy loss 

ğ‘šğ‘šp

. A single run of ADDA performs a 

simulation for a single set of parameters (

ğœ†ğœ†

, beam position, etc.). To simulate a loss spectrum 

â„ğœ”ğœ”

or to scan a particleâ€™s cross-section with the beam, it is necessary to run ADDA multiple times 

ğœ†ğœ†

varying the desired parameters. For instance, to simulate the EELS and CL spectra one needs 

to vary 

 and the corresponding 

. We developed a Python wrapper, named ADDAwrapper, 

to automate this process. 

ğœ†ğœ†

ğ‘šğ‘šp

The wrapper is designed to work as a Python library, so one only has to fill the example 

preset  file  with  the  simulation  parameters,  and  call  high-level  functions  from  this  file  to 

perform the corresponding set of simulations (spectrum, loss probability scan over the cross-

section  of  the  particle,  etc.),  collect  the  data  from  these  simulations,  and  plot  it  in  various 

formats. Multithreading is supported to run several single-thread ADDA runs simultaneously 

on different processor cores. Such use of ADDA in sequential mode is both easier and more 

efficient than the use of the parallel ADDA mode (based on Message Passing Interface), when 

run on a shared-memory machine and memory is not a limiting factor. In this case, the script 

leads to a speedup equal to the number of physical processor cores without any efforts from a 

user. The wrapper is distributed with the ADDA code in the folder /misc/ADDAwrapper.  
ADDA supports different options for computational procedures: polarizability prescription, 

iterative solver, interaction term, etc.[44] An optimal set of these options depends on the specific 

light scattering problems. From our experience, the best speed with satisfactory precision for 

EELS  and  CL  simulations  of  nanoparticles  are  achieved  with  the  following  set  of  options. 

Iterative solver QMR2 (quasi-minimal residual method for complex symmetric matrices based 

on a two-term recurrence) works slightly faster than the default QMR (based on a three-term 

recurrence) for the same precision. Polarizability prescription and interaction term based on 

integration of Greenâ€™s tensor (â€œâˆ’pol  igt_soâ€ and â€œâˆ’int  igt_soâ€, respectively) give 
more  precise  results  than  all  other  options,  and  are  faster  for  particles  with  higher 

surface/volume ratio. Setting the stopping threshold (relative residual) of the iterative solver 

  to 

  (instead  of  the  default  value 

)  by  the  command  line  option  â€œâˆ’eps  2â€ 
âˆ’5
accelerates the simulation several times keeping the satisfactory accuracy (errors due to the 
ğœ€ğœ€it
iterative solver are about 1%). Such accuracy level is generally acceptable for DDA simulations 

10

10

âˆ’2

of  metallic  nanoparticles,  since  improving  it  requires  very  fine  discretization  in  the  first 

place.[52] Apart from multithreading, using the above parameters allows the wrapper to perform 

EELS and CL simulations with ADDA up to an order of magnitude faster than with default 

32 

code settings. The updated code is available at https://github.com/alkichigin/adda and will be 

implemented into official ADDA release soon. 

S6 Additional simulations: cathodoluminescence and transition to 

the Cherenkov case 
CL probabilities simulated in ADDA for different refractive indices of the host medium. 

100 keV e

Ag

100 nm

mh

Fig. S1. CL spectra for a sphere in an infinite non-absorbing host medium simulated with ADDA 

(

 128), either directly or through scaling of simulations in vacuum (the same as Fig. 5, but for CL). The 

problem parameters are shown in the inset. In the host medium with 
ğ‘›ğ‘›ğ‘¥ğ‘¥ =

 the electron is faster than light, 

causing the Cherenkov radiation. 

ğ‘šğ‘šh = 2

Next, we study how 

 and 

 deviate from each other when 

 increases over the 

Cherenkov threshold (Fig. S2). First, one can see the inflection at this threshold (

), 

ğ‘ƒğ‘ƒEELS

ğ‘ƒğ‘ƒext

ğ‘šğ‘šh

corresponding to the logarithmic singularity of the derivative discussed in Section 2.2. Second, 

ğ‘šğ‘šh = ğ‘ğ‘ ğœğœâ„

we have also used the approximate scaling of Eq. (S16). As expected, it gives the wrong value 

of derivative near the inflection point. But, surprisingly, it describes the general trend of 

for  larger  values  of 

.  This  partly  explains  the 
ğ‘ƒğ‘ƒEELS
satisfactory performance of this scaling in Fig. 5 and Fig. S1. The specific reasons for that are 

,  which  is  very  different  from  that  of 

ğ‘ƒğ‘ƒext

ğ‘šğ‘šh

still not clear. 

33 

 
 
Fig. S2. EELS and extinction probabilities of 2.0 eV energy loss simulated with the DDA (

 32) for 

different host-medium refractive indices. The parameters of the problem are the same as in Fig. S1. 

ğ‘›ğ‘›ğ‘¥ğ‘¥ =

The  following  figures  show  the  comparison  of  CL  results  computed  with  ADDA,  the 

Lorenzâ€“Mie theory, and MNPBEM in different host media. All three methods agree for the 

case of vacuum (Fig. S3), but for 

 only ADDA and Lorenzâ€“Mie theory agree (as in 

Fig. S1), while MNPBEM results are markedly different. We have, however, took the liberty 

ğ‘šğ‘šh = 1.5

to multiply the latter by 

; this restores the agreement. We have not investigated this issue in 

details, but the error may be due to the fact that the BEM calculates 

 through a far-field 

ğ‘šğ‘šh
 in ADDA), which implicitly depends on the definition of 

integral (similar to 

ğ‘ƒğ‘ƒCL

 containing 

  [Eq. (19)].  Practically,  this  difference  is  not  important  since  all  CL  measurements  are 

ğ¶ğ¶sca

ğ¼ğ¼0

performed in arbitrary (relative) units. Still, the definition of 
ğ‘šğ‘šh
since, e.g., it guarantees that 

 for the case when both a particle and a host medium 

ğ‘ƒğ‘ƒCL

 by Eq. (42) is the correct one, 

are non-absorbing (and 

). 

ğ‘ƒğ‘ƒCL = ğ‘ƒğ‘ƒEELS

ğ›½ğ›½h < 1

34 

 
Fig. S3. CL spectra simulated with the Lorenz-Mie theory, ADDA (

 128 with the extrapolation), and 

the BEM (the same as Fig. 6, but for CL). The parameters of the problem are shown in the inset. 

ğ‘›ğ‘›ğ‘¥ğ‘¥ =

100 keV e

Ag

100 nm

mh=1.5

Fig. S4. CL spectra simulated with the Lorenz-Mie theory (using scaling), ADDA (

 128 with the 

extrapolation), and the BEM (the same as Fig. 7, but for CL). The corrected BEM results are obtained 

ğ‘›ğ‘›ğ‘¥ğ‘¥ =

multiplying by 

. The parameters of the problem are shown in the inset. 

Similar scaling issue can be seen for the Cherenkov case (

ğ‘šğ‘šâ„

) in Fig. S5, but here we 

additionally depict 

, defined by Eq. (41). Apart from the overall magnitude, it has certain 

ğ‘šğ‘šh = 2

qualitative difference from 

tot
ğ‘ƒğ‘ƒCL

ğ‘ƒğ‘ƒCL

. For instance, the peak around 2.5 eV has almost disappeared. 

35 

 
 
100 keV e

Ag

100 nm

mh=2

Fig. S5. CL probability simulated with the DDA (

 128 with the extrapolation) and the BEM (the same 

as Fig. 8, but for CL). For the DDA both 

 and 

 are shown, the corrected BEM results are obtained 

. The parameters of the problem are shown in the inset. 

ğ‘ƒğ‘ƒCL

ğ‘›ğ‘›ğ‘¥ğ‘¥ =
tot
ğ‘ƒğ‘ƒCL

multiplying by 

ğ‘šğ‘šâ„

36 

 
 
