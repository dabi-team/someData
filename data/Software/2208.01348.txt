Simulating electron energy-loss spectroscopy and 

cathodoluminescence for particles in arbitrary host medium 

using the discrete dipole approximation 

Alexander A. Kichigin1,2 and Maxim A. Yurkin1,2,* 

1Voevodsky Institute of Chemical Kinetics and Combustion SB RAS,  

Institutskaya Str. 3, 630090, Novosibirsk, Russia 

2 Novosibirsk State University, Pirogova Str. 2, 630090, Novosibirsk, Russia 

*Corresponding author: yurkin@gmail.com 

Abstract 
Electron energy-loss spectroscopy (EELS) and cathodoluminescence (CL) are widely used 

experimental 

techniques  for  characterization  of  nanoparticles.  The  discrete  dipole 

approximation  (DDA)  is  a  numerically  exact  method  for  simulating  interaction  of 

electromagnetic waves with particles of arbitrary shape and internal structure. In this work we 

extend  the  DDA  to  simulate  EELS  and  CL  for  particles  embedded  into  arbitrary  (even 

absorbing)  unbounded  host  medium.  The  latter  includes  the  case  of  the  dense  medium, 

supporting the Cherenkov radiation of the electron, which has never been considered in EELS 

simulations before. We build a rigorous theoretical framework based on the volume-integral 

equation, final expressions from which are implemented in the open-source software package 

ADDA.  This  implementation  agrees  with  both  the  Lorenz-Mie  theory  and  the  boundary-

element method for spheres in vacuum and moderately dense host medium. And it successfully 

reproduces the published experiments for particles encapsulated in finite substrates. The latter 

is shown for both moderately dense and Cherenkov cases – a gold nanorod in SiO2 and a silver 

sphere in SiNx, respectively. 

Keywords:  electron  energy-loss  spectroscopy,  cathodoluminescence,  discrete  dipole 

approximation, Cherenkov radiation, host medium 

1 

 
 
 
1  Introduction 

Optical excitations of small objects have been gaining interest over the past decades. The 

quest  for  the  highest  possible  space-energy  resolution  is  unachievable  by  purely  optical 

methods due to the diffraction limit.[1] This limit can be overcome using fast electrons as a 

probe instead of light – the corresponding experimental technique is called the electron energy-

loss  spectroscopy  (EELS).  EELS  is  a  well-developed  extension  of  the  standard  electron 

microscope,[2] where a particle under study is exposed to a beam of relativistic electrons with 

the same kinetic energies of the order of 100 keV. The energies of transmitted electrons are 

measured  leading  to  the  energy-loss  spectrum  (EELS  spectrum).  Currently,  EELS  provides 

information  about  excitations  with  sub-Å  and  few-meV  space-energy  resolution.[3]  While 

exposed  to  an  electron  beam,  the  particle  emits  photons  –  this  phenomenon,  called 

cathodoluminescence  (CL),  also  provides  information  about  photonic  properties.[4]  To 

accurately  interpret  the  results  of  an  EELS  or  CL  experiment,  it  is  necessary  to  have  a 

theoretical description of particle interaction with the electromagnetic field of a fast electron, 

complemented by a simulation method. 

There  are  many  methods  capable  of  simulating  EELS,  from  the  analytical  Lorenz-Mie 

theory for spheres[5] to surface-discretization boundary-element method (BEM)[6] and volume-

discretization  methods,  such  as  finite-difference  time-domain[7]  and  the  discrete-dipole 

approximation  (DDA).[8,9]  While  a  theoretical  description  of  EELS  can  be  developed  in  a 

general setting of a particle placed in arbitrary infinite host medium, most of the numerical 

methods apply only to vacuum environment. The notable exception is MNPBEM,[10] which 

seems to support arbitrary infinite host medium by its internal parameters. However, this option 

is poorly documented and the corresponding simulations have been performed only for the case 

of non-absorbing medium with relatively low density.[11,12] 

Thus, the simulation capabilities do not fully support the experimental conditions, where 

the particle is always placed on or inside a substrate, or require discretizing a large chunk of 

substrate  in  addition  to  the  particle  itself.  The  presence  of  a  substrate  affects  the  EELS/CL 

spectra.[13] e.g., by redshifting localized surface plasmon resonances (LSPRs) with increasing 

host-medium refractive index.[14] Although the development of very thin substrates has made 

the  experimental  results  close  to  vacuum  simulations,[15,13]  some  experimental  studies 

intentionally consider particles inside a substrate.[16,12,17] Importantly, sufficiently dense host 

medium may slow down the light below the electron speed, leading to qualitatively different 

2 

case of Cherenkov radiation.[16] This case may become more common with increasing electron 

energy, but has never been considered in numerical simulations of EELS. 

The  goal  of  this  paper  is  to  enhance  the  capabilities  of  EELS/CL  simulations  using  the 

DDA – a numerically exact method for simulating interaction of electromagnetic waves with 

particles  of  arbitrary  shape  and  internal  structure,[18]  based  on  the  volume  integral  equation 

(VIE)  in  the  frequency  domain.[19]  The  popularity  of  the  DDA  is  based  on  conceptual 

simplicity,  combined  with  availability  of  two  open-source  highly-optimized  codes: 

DDSCAT[20] and ADDA.[21] Initially designed for simulating interaction of particles with plane 

waves,[20] the DDA is applicable to arbitrary electromagnetic fields,[18] including the field of a 

fast  electron.  The  latter  has  been  exemplified  by  two  specialized  codes:  DDEELS[8]  and  e-

DDA,[9]  which,  however,  assume  the  vacuum  surrounding.  Moreover,  the  underlying  VIE-

based theory of EELS is available only for this case.[8,9,22] 

In  this  paper  we,  first,  construct  a  general  theoretical  framework  of  EELS  and  CL  for 

particles  in  arbitrary  host  medium  (Section  2),  based  on  the  VIE  and  energy-budget 

considerations.[23] When the host medium is absorbing or incurs Cherenkov radiation, particle-

induced  energy  losses  are  accompanied  by  free-space  ones.  We  discuss  the  feasibility  of 

separating  these  two  losses  in  experimental  signals  in  Sections  2.5  and  2.6.  Moreover,  we 

extend  the  scale  invariance  rule  of  electromagnetics  to  EELS  simulations,  expanding  the 

applicability domain of existing vacuum-based codes in Section 2.7. 

Second, we implement the obtained general expressions in the ADDA code together with 

a dedicated Python library, allowing wide range of EELS and CL simulations in arbitrary host 

medium  out  of  the  box  (Section  3.1).  Next,  we  demonstrate  the  high  accuracy  of  this 

implementation in comparison with the Lorenz-Mie theory and MNPBEM for a test sphere in 

vacuum (Section 3.2) and various host media (Section 3.3). The latter comparison highlights 

the limitations of MNPBEM in Cherenkov case. Finally, Section 3.4 demonstrates the practical 

applicability of the updated ADDA code by accurately reproducing experimental EELS data 

for a silver nanosphere encapsulated in non-absorbing Cherenkov host medium[16] and for a 

nanowire  placed  inside  glass  substrate.[12]  We  use  SI  units  throughout  the  manuscript,  and 

preliminary results of this paper have been presented in [24,25]. 

2  Theory 
2.1  Energy budget for time-harmonic sources 

This section is based on [19,23,26]. Let us define the current density of time-harmonic external 

sources 

  to  be  independent  of  the  resulting  electromagnetic  field  and  consider 

𝐉𝐉s(𝐫𝐫)

3 

nonmagnetic (

) isotropic host medium with dielectric permittivity 

 (

 is its 

refractive index). The incident (or “source-generated”) electromagnetic field must satisfy the 

2
𝜀𝜀h = 𝑚𝑚h

𝜀𝜀0

𝑚𝑚h

𝜇𝜇 = 𝜇𝜇0
Maxwell equations in 

: 

3
ℝ

Below we consider the cases of non-absorbing (

𝛁𝛁 × 𝐄𝐄inc(𝐫𝐫) = i𝜔𝜔𝜇𝜇0𝐇𝐇inc(𝐫𝐫),
𝛁𝛁 × 𝐇𝐇inc(𝐫𝐫) = −i𝜔𝜔𝜀𝜀h𝐄𝐄inc(𝐫𝐫) + 𝐉𝐉s(𝐫𝐫).

) and absorbing (

(1) 

) host media. In 

both  cases  we  assume 

  (passive  medium)  and  therefore 

𝜀𝜀h ∈ ℝ

, 

where 

 is the complex argument, for which we assume the range 

0 ≤ arg 𝜀𝜀h < 𝜋𝜋

A  particle  is  a  nonmagnetic  object  with  finite  volume 

arg

0 ≤ arg 𝑚𝑚h < 𝜋𝜋 2⁄
  and  complex  isotropic 
(−𝜋𝜋, 𝜋𝜋]
 is the particle’s refractive index). Then the 

𝑉𝑉int

permittivity distribution 

 (

dielectric permittivity function in the whole space is 

(𝐫𝐫)𝜀𝜀0

𝑚𝑚p(𝐫𝐫)

2
𝜀𝜀p(𝐫𝐫) = 𝑚𝑚p

𝜀𝜀h ∈ ℂ
. 

𝜀𝜀(𝐫𝐫) ≝ �
  is  the  refractive  index  relative  to  the  host  medium: 
𝐫𝐫 ∈ 𝑉𝑉int,

𝑚𝑚

𝐫𝐫 ∈ 𝑉𝑉ext,

𝜀𝜀h,
2
(𝐫𝐫)𝜀𝜀h,

(2) 

where 

, 

3

𝑚𝑚p(𝐫𝐫) 𝑚𝑚h⁄
composed of the particle’s volume 

. 
𝑉𝑉ext = ℝ
𝑚𝑚(𝐫𝐫) ≝
The  presence  of  the  particle  changes  the  electromagnetic  field  in  the  whole  space, 

\𝑉𝑉int

𝑚𝑚(𝐫𝐫)

 and the external volume 

. This field must satisfy 

the following Maxwell’s equations: 

𝑉𝑉int

𝑉𝑉ext

(3) 

and  boundary  conditions  at  the  particle  interface.  These  equations  are  equivalent  to  the 

𝛁𝛁 × 𝐄𝐄(𝐫𝐫) = i𝜔𝜔𝜇𝜇0𝐇𝐇(𝐫𝐫),
𝛁𝛁 × 𝐇𝐇(𝐫𝐫) = −i𝜔𝜔𝜀𝜀(𝐫𝐫)𝐄𝐄(𝐫𝐫) + 𝐉𝐉s(𝐫𝐫),
following volume integral equation (VIE) for the electric field 

:[19] 

𝐄𝐄(𝐫𝐫)

′

)

−

2

𝑚𝑚

(𝐫𝐫) − 1

3

𝐄𝐄(𝐫𝐫),

𝑘𝑘 = 𝜔𝜔�𝜀𝜀h𝜇𝜇0 = 𝑚𝑚h𝑘𝑘0
𝑘𝑘0 = 𝜔𝜔 𝑐𝑐⁄

(4) 

  is  the 

  is  the 

(5) 

(6) 

𝐄𝐄(𝐫𝐫) = 𝐄𝐄inc(𝐫𝐫) + 𝑘𝑘

d
\𝑉𝑉0 
  is  a  sphere  centered  at 

lim𝑉𝑉0→0 �
ℝ

where 

3

[𝑚𝑚

) ⋅ 𝐄𝐄(𝐫𝐫
𝐫𝐫
  to  exclude  the  singularity, 

) − 1]𝐆𝐆�(𝐫𝐫, 𝐫𝐫

(𝐫𝐫

2

3

′

2

′

′

wavenumber  in  the  host  medium  (
𝐫𝐫

𝑉𝑉0

  is  the  speed  of  light  in  vacuum,  and 

vacuum wavenumber), 

𝐆𝐆�(𝐫𝐫, 𝐫𝐫

′

)

 is the free-space Green’s tensor, defined as 

𝑐𝑐

where 

 is the identity tensor, and 

 denotes dyadic (tensor) product. 

′

𝐆𝐆�(𝐫𝐫, 𝐫𝐫

) ≝ �𝐈𝐈̅ +

∇ ⊗ ∇
2 �
𝑘𝑘

Incident electric field can be expressed in terms of 

⊗

𝐈𝐈̅

′

|)
,

exp(i𝑘𝑘|𝐫𝐫 − 𝐫𝐫
′
|
4𝜋𝜋|𝐫𝐫 − 𝐫𝐫
 as 

𝐄𝐄inc(𝐫𝐫) = i𝜔𝜔𝜇𝜇0 lim𝑉𝑉0→0 � d
𝑉𝑉s\𝑉𝑉0

3

′

𝐫𝐫

𝐆𝐆�(𝐫𝐫, 𝐫𝐫

′

) ⋅ 𝐉𝐉s(𝐫𝐫

′

)

− i

𝐉𝐉s(𝐫𝐫)
3𝜔𝜔𝜀𝜀h,

𝐉𝐉s(𝐫𝐫)

4 

 
 
 
 
 
 
where 

 is the volume enclosing the sources, and the exclusion of the singularity in the volume 

 makes the expression valid in the whole 

𝑉𝑉s

. In this work we assume that the sources are 

  (unless  noted  otherwise).  Let  us  further  define  the 

3

ℝ

outside  of  the  particle: 
𝑉𝑉0
polarization density of the particle as 
𝑉𝑉s ∩ 𝑉𝑉int = ∅

then the scattered electric field is expressed as 

𝐏𝐏(𝐫𝐫) = [𝜀𝜀(𝐫𝐫) − 𝜀𝜀h]𝐄𝐄(𝐫𝐫),

(7) 

(8) 

𝐄𝐄sca(𝐫𝐫) ≝ 𝐄𝐄(𝐫𝐫) − 𝐄𝐄inc(𝐫𝐫) = 𝜔𝜔

𝜇𝜇0 lim𝑉𝑉0→0 �

Time-averaged  electromagnetic-energy  transfer  per  unit  area  is  given  by  the  Poynting 

𝑉𝑉int\𝑉𝑉0

′

3
d

𝐫𝐫

′

′

𝐆𝐆�(𝐫𝐫, 𝐫𝐫

) ⋅ 𝐏𝐏(𝐫𝐫

)

−

2

𝐏𝐏(𝐫𝐫)
3𝜀𝜀h .

vector [27]: 

1
𝐒𝐒(𝐫𝐫) =
Integrating it over the closed surface 
2

∗

Re[𝐄𝐄(𝐫𝐫) × 𝐇𝐇
 results in the power generated or lost in the volume 

(𝐫𝐫)].

inside the surface (according to the Poynting theorem): 

𝐴𝐴

(9) 

where 

, 

 is the vector normal to the surface, and the sign is chosen such that 

𝐴𝐴

𝑊𝑊 = � d𝐀𝐀 ⋅ 𝐒𝐒(𝐫𝐫),

(10) 

 is 

positive  when  energy  goes  outside  the  surface.  Using  the  divergence  theorem,  the  surface 

𝑊𝑊

2

d𝐀𝐀 ≝ 𝐧𝐧 d

𝐫𝐫

𝐧𝐧

integral is transformed into the volume integral: 

𝑊𝑊 = −
This expression is valid only if 

� d
𝑉𝑉𝐴𝐴

Im[𝜀𝜀(𝐫𝐫)]
 and 

3

2
𝐫𝐫|𝐄𝐄(𝐫𝐫)|

𝜔𝜔
2

(𝐫𝐫)]
−
.
 are square-integrable inside 

∗
𝐫𝐫 Re[𝐄𝐄(𝐫𝐫) ∙ 𝐉𝐉s

3
� d
𝑉𝑉𝐴𝐴

1
2

(11) 

. Note that the 

dot product of two vectors does not imply conjugation of the second operand. This is consistent 

𝐄𝐄(𝐫𝐫)

𝐉𝐉s(𝐫𝐫)

𝑉𝑉𝐴𝐴

with the definition of action of tensor on the vector, as used above. In other words, this dot 

product is not a proper inner product of two complex vectors. 

For the case of non-absorbing host medium (

), let us apply Eq. (11) to 

 in the 

absence of the particle. Substituting 

 for 

 gives us the free-space energy loss power 

𝑚𝑚h ∈ ℝ

𝑉𝑉s

. The first component of Eq. (11) equals zero, and the second one can be rewritten as:[23] 

𝐄𝐄inc(𝐫𝐫)

𝐄𝐄(𝐫𝐫)

𝑊𝑊0

𝑊𝑊0 =
where we use the notation 

𝜔𝜔𝜇𝜇0
2

3

� d
𝑉𝑉s

𝐫𝐫 d

3

′

∗
 𝐉𝐉s

𝐫𝐫

(𝐫𝐫) ⋅ 𝐆𝐆�

𝐼𝐼

′

(𝐫𝐫, 𝐫𝐫

) ⋅ 𝐉𝐉s(𝐫𝐫

′

)

,

(12) 

(13) 

′
) − [𝐆𝐆�(𝐫𝐫
(𝐫𝐫, 𝐫𝐫
which is a symmetric (self-adjoint) operator kernel, and 

{𝐆𝐆�(𝐫𝐫, 𝐫𝐫

) ≝

𝐆𝐆�

𝐼𝐼

′

′

𝐻𝐻

, 𝐫𝐫)]

 denotes the Hermitian (conjugate) 

},

1
2i

transpose of a tensor (matrix). In isotropic medium 

𝐻𝐻

5 

 
 
 
 
 
 
 
and in non-absorbing medium 

𝐼𝐼

′

(𝐫𝐫, 𝐫𝐫
′

 is always finite,[23] in particular: 
) = Im[𝐆𝐆�(𝐫𝐫, 𝐫𝐫
)],

′

𝐆𝐆�
𝐼𝐼
𝐆𝐆�

(𝐫𝐫, 𝐫𝐫

)

(14) 

(15) 

Then, as explained in [23], Eq. (12) is continuous versus 
.

(𝐫𝐫, 𝐫𝐫

) =

lim𝐫𝐫→𝐫𝐫

, whenever the latter is integrable. 

′

𝐼𝐼

′ 𝐆𝐆�

𝑘𝑘𝐈𝐈̅
6𝜋𝜋

Thus, it is also valid for delta-functions although they are not square-integrable. 

𝐉𝐉s(𝐫𝐫)

By applying Eq. (11) to 

 and 

 in a similar manner, we obtain the particle-induced 

energy loss power 

, while the integral over 
𝐄𝐄sca
quantity in light scattering problems):[23] 
𝑊𝑊enh

𝑉𝑉s

 gives the extinction power (a standard 

𝑉𝑉int

𝑊𝑊enh ≝ −

1
2

� d
𝑉𝑉s

3

∗
𝐫𝐫 Re[𝐄𝐄sca(𝐫𝐫) ⋅ 𝐉𝐉s

(𝐫𝐫)]

𝜔𝜔

2

𝜇𝜇0
2

= −

3

� d
𝑉𝑉s

𝐫𝐫

� d
𝑉𝑉int

3

′

∗
Re[𝐉𝐉s

𝐫𝐫

(𝐫𝐫) ⋅ 𝐆𝐆�(𝐫𝐫, 𝐫𝐫

′

′

) ⋅ 𝐏𝐏(𝐫𝐫

)]

,

𝑊𝑊ext ≝ −

3

� d
𝑉𝑉int

𝜔𝜔
2

𝐫𝐫 Im[𝐄𝐄inc(𝐫𝐫) ⋅ 𝐏𝐏

∗

(𝐫𝐫)]

3
� d
For completeness, we also provide the expression for absorbed power: [23] 
𝑉𝑉int

(𝐫𝐫) ⋅ 𝐆𝐆�(𝐫𝐫, 𝐫𝐫

3
� d
𝑉𝑉s

Re[𝐏𝐏

) ⋅ 𝐉𝐉s(𝐫𝐫

= −

𝜔𝜔

𝐫𝐫

𝐫𝐫

∗

′

′

′

)]

.

2

𝜇𝜇0
2

(16) 

(17) 

(18) 

Schematically these and other powers are visualized in Fig. 1, with the only caveat that we 

𝑊𝑊abs ≝

� d
𝑉𝑉int

𝜔𝜔
2

3

2
𝐫𝐫 Im[𝜀𝜀(𝐫𝐫)]|𝐄𝐄(𝐫𝐫)|

.

further  consider  the  current  source  corresponding  to  a  moving  electron,  for  which 

  is  an 

infinite line. 

𝑉𝑉s

Interestingly, Eqs. (16)–(18) can also be used in the case of absorbing host medium, but 

their physical meaning is ambiguous. Absorption by the host medium significantly changes the 

whole energy budget, particularly positions of the contours in Fig. 1 cannot be freely moved 

around the particle and the sources. This problem does not have a fully satisfactory solution 

even  for  the  interpretation  of 

  in  the  standard  scattering  problem  for  the  plane 

electromagnetic  waves.[28,29]  A  similar  ambiguity  appears  if  the  source  is  placed  inside  the 

𝑊𝑊ext

particle, i.e. 

 and 

 overlap. We leave a rigorous analysis of this case for future research, 

but it must include certain assumption that sources and the medium are physically separated, 

𝑉𝑉s

𝑉𝑉int
  is  effectively  excluded  from 

i.e. 

.  In  the  case  of  delta-function  source  (point,  line, or 

surface) this will additionally incur a small exclusion volume, similar to that used in Eq. (8), 

𝑉𝑉int

𝑉𝑉s

but  with  the  shape  corresponding  to  that  of  the  source  (spherical,  cylindrical,  or  planar). 

6 

 
 
 
 
 
Moreover, if the medium around the sources is absorbing, some of the results may depend on 

the  width  of  this  exclusion  volume,  not  having  a  bounded  zero  limit.  The  corresponding 

problem of defining 

 in absorbing host medium is discussed in Section 2.3. 

𝑊𝑊0

Fig. 1. Visualization of energy powers in the energy budget framework. Reproduced from [23]. 

It  is  worth  mentioning  that  cross-sections 

  (extinction,  absorption,  scattering)  are 

commonly used in scattering problems for the plane waves. They are expressed in terms of the 

𝐶𝐶

corresponding power 

 and the intensity of the incident wave 

:[30] 

𝑊𝑊

𝐼𝐼0

(19) 

where 

𝐼𝐼0 ≝ 𝑚𝑚h
𝐶𝐶𝑋𝑋 =
  is  a  subscript  of  any  power  from  Fig. 1, 

amplitude  of  the  incident  wave. 

𝑋𝑋

𝑊𝑊𝑋𝑋
𝐼𝐼0 ,
  has  physical  meaning  for  the  plane  waves,  and  can  be 

2
𝐸𝐸0
  is  the  real  part  of 

  is  the 

,  and 

,

′ 𝜀𝜀0𝑐𝑐
2
′
𝑚𝑚h

𝑚𝑚h

𝐸𝐸0

meaningfully defined for some other shaped beams. Moreover, postulating any constant instead 

𝐸𝐸0

of 

, e.g., unity multiplied by appropriate unit, allows one to define all cross-sections for the 

moving electron as well. This can be convenient, since they are expressed in units of area and, 

𝐸𝐸0

thus, can be trivially converted between different systems of units. 

2.2  Electric field of a relativistic electron 

We  consider  a  relativistic  electron  as  a  point  charge 

  moving  with  the  speed 

  in  the 

positive direction of the 

-axis. At the time 

The corresponding current density is 

𝑧𝑧

𝑡𝑡 = 0

 the charge has coordinates 

𝑞𝑞

. 

𝜐𝜐
𝐫𝐫0 = (𝑥𝑥0, 𝑦𝑦0, 𝑧𝑧0)
(20) 

where 

 is a unit vector along the 

𝐉𝐉s(𝐫𝐫, 𝑡𝑡) = 𝑞𝑞𝜐𝜐𝑞𝑞(𝑥𝑥 − 𝑥𝑥0)𝑞𝑞(𝑦𝑦 − 𝑦𝑦0)𝑞𝑞(𝑧𝑧 − 𝑧𝑧0 − 𝜐𝜐𝑡𝑡)𝐞𝐞𝑧𝑧,

-axis. After applying the Fourier transform (defined as 

Eq. (S1) in the Supporting Information) we obtain the current density in the frequency domain 

𝐞𝐞𝑧𝑧

𝑧𝑧

7 

 
 
 
To  find  the  incident  electric  field,  we  substitute  Eq. (21)  into  Eq. (6)  for  arbitrary  host 

𝐉𝐉s(𝐫𝐫) = 𝑞𝑞𝑞𝑞(𝑥𝑥 − 𝑥𝑥0)𝑞𝑞(𝑦𝑦 − 𝑦𝑦0) exp �i

(𝑧𝑧 − 𝑧𝑧0)� 𝐞𝐞𝑧𝑧.

𝜔𝜔
𝜐𝜐

medium (

), dependence on which through 

 is implicit in the Green’s tensor: 

𝑚𝑚h ∈ ℂ

𝑘𝑘
′

  (22) 

(21) 

𝐄𝐄inc(𝐫𝐫) = i𝜔𝜔𝜇𝜇0 �𝐈𝐈̅ +
where  changing  the  order  of  integration  and  differentiation  eliminates  the  second  term  in 

= i𝜔𝜔𝜇𝜇0 �𝐞𝐞𝑧𝑧 +

2 � ⋅ � d

� 𝐼𝐼1(𝐫𝐫),

𝐉𝐉s(𝐫𝐫

𝑉𝑉s

𝐫𝐫

)

3

′ exp(i𝑘𝑘|𝐫𝐫 − 𝐫𝐫
′
|
4𝜋𝜋|𝐫𝐫 − 𝐫𝐫

|)

′

∇
2
𝑘𝑘

𝜕𝜕
𝜕𝜕𝑧𝑧

∇⨂∇
𝑘𝑘

Eq. (6)  and  makes  the  singularity  of  the  kernel  integrable  (the  exclusion  volume  is  then 

redundant).[31] The remaining integral is evaluated in Section S3 of the Supporting Information: 

′

(23) 

𝐼𝐼1(𝐫𝐫) ≝ � d
where we introduced 

𝑉𝑉s

3

𝐫𝐫

′ exp(i𝑘𝑘|𝐫𝐫 − 𝐫𝐫
′
|
4𝜋𝜋|𝐫𝐫 − 𝐫𝐫
2

|)

𝐽𝐽s,𝑧𝑧(𝐫𝐫

′

)

=

exp �i

𝑞𝑞
2𝜋𝜋
 and the notation analogous to the one used 
2

(𝑧𝑧 − 𝑧𝑧0)� 𝐾𝐾0 �

𝜔𝜔𝜔𝜔
𝛾𝛾h𝜐𝜐

𝜔𝜔
𝜐𝜐

�,

in the special relativity theory: 

𝜔𝜔 ≝ �(𝑥𝑥 − 𝑥𝑥0)

+ (𝑦𝑦 − 𝑦𝑦0)

(24) 

𝛾𝛾h ≝ �
The principal branch for the square-root function is chosen such that it continuously depends 

𝛽𝛽h ≝

𝑚𝑚h,

1
2.
1 − 𝛽𝛽h

𝜐𝜐
𝑐𝑐

on 

  when 

  (or,  equivalently, 

  which  we  assumed  in 

Section  2.1),  except  for  the  singularity  at 
0 ≤ arg 𝜀𝜀h < 𝜋𝜋

𝜀𝜀h

complex plane (

.  Then 
0 ≤ arg 𝑚𝑚h < 𝜋𝜋 2⁄  
𝛾𝛾h

) excluding the interval 
𝛽𝛽h = 1
) 

  lies  in  the  first  quadrant  of  the 

 Specifically, 

 and 

 lead to real (

0 ≤ arg 𝛾𝛾h ≤ 𝜋𝜋 2⁄

) and imaginary (

, respectively, corresponding to relatively 
𝛽𝛽h >

𝛽𝛽h < 1

[0,1).

less and more dense non-absorbing host media. In the case of vacuum, we always have 
Im 𝛾𝛾h > 0
1

𝛾𝛾h > 1

𝛾𝛾h

. 

1

We substitute Eq. (23) into Eq. (22) and obtain: 

𝛽𝛽h <

𝐄𝐄inc(𝐫𝐫) =

𝑞𝑞𝜔𝜔
2
2𝜋𝜋𝜀𝜀0𝑚𝑚h

𝜐𝜐

2

where  we  used 

𝐾𝐾1 �

𝑥𝑥 − 𝑥𝑥0
𝜔𝜔
𝑦𝑦 − 𝑦𝑦0
𝜔𝜔
i
𝛾𝛾h 𝐾𝐾0 �
  (Eq. 10.29.3  of  [32]).  The  behavior  of  the  incident  field  is 

𝜔𝜔𝜔𝜔
𝛾𝛾h𝜐𝜐
𝜔𝜔𝜔𝜔
𝛾𝛾h𝜐𝜐
𝜔𝜔𝜔𝜔
𝛾𝛾h𝜐𝜐

𝛾𝛾h exp �i

(𝑧𝑧 − 𝑧𝑧0)�

⎞
⎟
⎟
⎟

⎛
⎜
⎜
⎜

𝐾𝐾1 �

(25) 

𝜔𝜔
𝜐𝜐

⎝

−

�

�

�

.

mostly  determined  by 

′
𝐾𝐾0
exponentially  with 

(corresponding to 

𝜔𝜔

.  When  it  has  a  positive  real  part  (

(𝓏𝓏) = −𝐾𝐾1(𝓏𝓏)
  (Eq. 10.25.3  of  [32]).  By  contrast,  when 
𝛾𝛾h
), the field oscillates and decays as 

Re 𝛾𝛾h > 0
𝛾𝛾h

⎠
),  the  field  decays 

  is  purely  imaginary 

 similar to the field of a line 

source. 

𝛽𝛽h > 1

1 √𝜔𝜔⁄

8 

 
 
 
 
To conclude, we derived the field in the most general case of an arbitrary host medium 

(

).  This  expression  includes  the  case  of  non-absorbing  host  medium  (

)  or 

vacuum as special cases, and allow straightforward quasistatic limit. In all cases the final results 
𝑚𝑚h ∈ ℂ
match the ones described in the literature.[33] However, the latter were derived using different 

𝑚𝑚h ∈ ℝ

approaches for solving the Maxwell equations for different cases of the host media. By contrast, 

we used a single VIE framework with only technical differences in evaluating integrals. The 

observed agreement, thus, supports the  universal  applicability of this framework, which  we 

further use to evaluate interaction of the electron field with a nanoparticle. 

2.3  Free-space energy losses 

To find the free-space energy losses of a relativistic electron moving in an infinite non-

absorbing host medium (

), we substitute Eq. (21) into Eq. (12): 

𝑊𝑊0 =

2

𝜔𝜔𝜇𝜇0𝑞𝑞
8𝜋𝜋

𝑚𝑚h ∈ ℝ
∞

′

� d𝑧𝑧d𝑧𝑧

−∞

exp �i

where we used 

 in evaluating 

⇒

′

(𝑧𝑧

− 𝑧𝑧)� �1 +

2

1
2
𝑘𝑘

𝜕𝜕
𝜕𝜕𝑧𝑧

2�

′

− 𝑧𝑧)]

(26) 

sin[𝑘𝑘(𝑧𝑧
𝑧𝑧

′

− 𝑧𝑧

𝜔𝜔𝜇𝜇0𝑞𝑞
, expressed the loss power per unit distance, and 
8𝜋𝜋

𝐼𝐼2(𝛽𝛽h),

𝜔𝜔
𝜐𝜐

=

𝜕𝜕𝑊𝑊0
𝜕𝜕𝑧𝑧
𝐼𝐼
𝐆𝐆�

′

(𝐫𝐫, 𝐫𝐫

)

2

: 

𝐼𝐼2(𝛽𝛽h)

𝑧𝑧

′

𝑧𝑧

denoted the remaining one-dimensional integral as 

. To calculate it we replace 

 with 

𝑘𝑘 ∈ ℝ

in the derivative and substitute 

′

𝑢𝑢 ≝ 𝜔𝜔(𝑧𝑧

∞

− 𝑧𝑧) 𝜐𝜐⁄
2

𝐼𝐼2(𝛽𝛽h) ≝ � d𝑢𝑢 exp(i𝑢𝑢) �1 +

−∞

1
2
𝛽𝛽h

𝜕𝜕
𝜕𝜕𝑢𝑢

2�

sin(𝛽𝛽h𝑢𝑢)
𝑢𝑢

= �1 −

∞

1
2� � d𝑢𝑢 exp(i𝑢𝑢)
𝛽𝛽h
∞

−∞

sin(𝛽𝛽h𝑢𝑢)
𝑢𝑢

(27) 

d𝑢𝑢
𝑢𝑢

{sin[(𝛽𝛽h − 1)𝑢𝑢] + sin[(𝛽𝛽h + 1)𝑢𝑢]}

=

2 �
0

1
2
𝛾𝛾h
𝛽𝛽h
𝜋𝜋
2
2𝛽𝛽h

where we integrated by parts twice, and used the known limit for the sine integral. Note that 

2 [sgn(𝛽𝛽h − 1) + 1],
𝛾𝛾h
the integrals converge at infinity due to the oscillating kernel (since 

) decreasing as 

, 

=

and the integrand is regular at zero (together with its derivatives). 

𝛽𝛽h ≠ 1

1 𝑢𝑢⁄

By substituting the result for 

 into Eq. (26), we obtain that in vacuum or in a medium with 

 the free-space energy loss power is 

𝐼𝐼2

𝛽𝛽h < 1
which is a known fact: a charge moving slower than the speed of light in the medium does not 

(28) 

𝑊𝑊0 = 0,

lose energy. For 

, when the speed of charge exceeds the speed of light in the medium, 

𝛽𝛽h > 1

9 

 
 
 
 
 
which  vanish  when 

𝜕𝜕𝑊𝑊0
.  Hence,  the  validity  of  Eqs. (28)  and  (29)  can  be  extended  by 
𝜕𝜕𝑧𝑧

𝑐𝑐
2
𝑚𝑚h

𝜔𝜔 �1 −

𝜇𝜇0
8

2�,

=

𝑞𝑞

𝜐𝜐

2

2

(29) 

continuity  to 

  and 
𝛽𝛽h → 1

,  respectively.  Finally,  the  free-space  energy  loss  per  unit 

distance, given by Eq. (S6), is 

𝛽𝛽h ≤ 1

𝛽𝛽h ≥ 1

Thus, we obtained the well-known Frank-Tamm formula[34] for Cherenkov radiation[35] in any 

𝑞𝑞

�
𝛽𝛽h(𝜔𝜔)>1 

d𝜔𝜔 𝜔𝜔 �1 −

𝜕𝜕
𝜕𝜕𝑧𝑧

∆𝐸𝐸0 =

2

𝜇𝜇0
4𝜋𝜋

𝑐𝑐
2
𝑚𝑚h

2�

.

𝜐𝜐

2

(30) 

non-absorbing host medium, which again shows the versatility of our theoretical framework. 

In  an  infinite  absorbing  host  medium  (

)  the  integral  in  the  expression  for 

[Eq. (12)] will become singular due to the divergence of 

. As discussed in 
𝑊𝑊0
Section 2.1 the possible workaround is to assume a finite exclusion volume in the host medium 

𝑚𝑚h ∈ ℂ

 for 

𝐼𝐼

′

′

𝐆𝐆�

(𝐫𝐫, 𝐫𝐫

)

𝐫𝐫 → 𝐫𝐫

around  the  electron  trajectory,  which  is  equivalent  to  assuming  a  finite  electron  size.[33]  In 

principle,  the  latter  provides  practically  usable expressions,  but  we  do  not  discuss it  in  this 

paper. 

Note, however, that, conceptually, this singularity indicates the limitation of macroscopic 

Maxwell’s equations. Since the latter are obtained by averaging microscopic ones over the size 

of several atomic scales, they are not expected to be accurate at smaller scales. And it is exactly 

the  latter  scales  that  become  important  for  electron  losses  in  absorbing  medium. 

Microscopically,  the  electron  is  always  moving  in  the  vacuum,  thus  the  losses  (per  unit  of 

length) are always finite. 

2.4  Particle-induced energy losses 

To  express  particle-induced  energy  losses,  we  start  from  Eq. (16)  considering  the  most 

general host medium (

). We use the general property of tensor transposition  

𝑚𝑚h ∈ ℂ

and  Green’s  tensor’s  symmetry  (reciprocity) 

𝑇𝑇
∀𝐚𝐚, 𝐛𝐛: 𝐚𝐚 ⋅ 𝐀𝐀� ⋅ 𝐛𝐛 = 𝐛𝐛 ⋅ 𝐀𝐀�
′
𝐆𝐆�(𝐫𝐫, 𝐫𝐫

⋅ 𝐚𝐚,
) = [𝐆𝐆�(𝐫𝐫

integration: 

(31) 

  to  change  the  order  of 

′

𝑇𝑇

, 𝐫𝐫)]

(32) 

where we introduced the auxiliary electric field 

 equal to the incident field from conjugate 

𝑊𝑊enh = −

𝐫𝐫 Im[𝐄𝐄a(𝐫𝐫) ⋅ 𝐏𝐏(𝐫𝐫)]

,

3

� d
𝑉𝑉int

𝜔𝜔
2

sources [cf. Eq. (22)]: 

𝐄𝐄a(𝐫𝐫)

3
𝐄𝐄a(𝐫𝐫) ≝ i𝜔𝜔𝜇𝜇0 lim𝑉𝑉0→0 � d
𝑉𝑉s\𝑉𝑉0

𝐫𝐫

′

𝐆𝐆�(𝐫𝐫, 𝐫𝐫

′

∗
) ⋅ 𝐉𝐉s

′

(𝐫𝐫

)

− i

∗
𝐉𝐉s
(𝐫𝐫)
3𝜔𝜔𝜀𝜀h.

10 

(33) 

 
 
 
 
 
 
To  calculate  this  field,  we  note  that  the  conjugation  of 

  [Eq. (21)]  is  equivalent  to  the 

inversion of sign of 

∗
, which leads to the same inversion in Eq. (23), since the sign of 
𝐉𝐉s

can  be  freely  changed  inside  the  integral  in  the  latter  equation.  Therefore,  analogously  to 
𝑧𝑧̃

𝑧𝑧 − 𝑧𝑧0

Eq. (25) we obtain 

𝐄𝐄a(𝐫𝐫) = −

𝑞𝑞𝜔𝜔
2
2𝜋𝜋𝜀𝜀0𝑚𝑚h

2

𝛾𝛾h exp �−i

𝜐𝜐

𝜔𝜔
𝜐𝜐

(𝑧𝑧 − 𝑧𝑧0)�

𝜔𝜔𝜔𝜔
𝛾𝛾h𝜐𝜐
𝜔𝜔𝜔𝜔
𝛾𝛾h𝜐𝜐

𝐾𝐾1 �

𝐾𝐾1 �

𝑥𝑥 − 𝑥𝑥0
𝜔𝜔
𝑦𝑦 − 𝑦𝑦0
𝜔𝜔
i
𝛾𝛾h 𝐾𝐾0 �

⎛
⎜
⎜
⎜

⎝

𝜔𝜔𝜔𝜔
𝛾𝛾h𝜐𝜐

�

�

�

⎞
⎟
⎟
⎟

⎠

(34) 

−𝐸𝐸inc,𝑥𝑥(𝐫𝐫)
−𝐸𝐸inc,𝑦𝑦(𝐫𝐫)
where the additional minus arises from each derivative with respect to 
𝐸𝐸inc,𝑧𝑧(𝐫𝐫)

(𝑧𝑧 − 𝑧𝑧0)�,

� exp �−2i

𝜔𝜔
𝜐𝜐

= �

. 

Equation (32) is very convenient since the integration is performed over the volume of the 

𝑧𝑧

particle (rather than that of sources), 

 is easily obtained from the known 

, and 

is efficiently calculated in the DDA. Moreover, the resulting expression (32) for 
𝐄𝐄a(𝐫𝐫)

𝐄𝐄inc(𝐫𝐫)

 is very 
𝐏𝐏(𝐫𝐫)

similar to the expression (17) for 

 and can be calculated in a similar way. 

𝑊𝑊enh

Previously, the particle-induced energy losses, expressed as an integral over the volume of 

𝑊𝑊ext

the particle, were known only for the specific case of vacuum as a host medium,[8,9,36] for which 

it  is  known  that 

.  In  our  general  approach  the  equality  of  Eqs. (32)  and  (17) 

follows from the fact that 

𝑊𝑊enh = 𝑊𝑊ext

 which is true if and only if 

 (i.e., when 

). Alternatively, the same can be obtained from the total energy budget (Fig. 1) using 

𝐄𝐄a(𝐫𝐫) = −𝐄𝐄inc
,  where  the  latter  follows  from  the  possibility  of  extending  the 

𝛾𝛾h ∈ ℝ

  and 

(𝐫𝐫)

∗

 to infinity and the exponential decay of 

. The fast decay of 

 is actually required for any excitation that has 

as the far-field integral. 
𝐄𝐄inc(𝐫𝐫)

𝑊𝑊0 = 0

, since 

 can also be computed 

𝐄𝐄inc(𝐫𝐫)
𝑊𝑊0

The  major  novelty  of  Eq. (32)  is  its  applicability  to  the  arbitrary  passive  host  medium 

(

) and the Cherenkov case (

, when 

. Although in this case 

 is 

not zero and may even be effectively infinite (see Section 2.3), the expression for (additional) 
𝑚𝑚h ∈ ℂ
particle-induced energy losses is well defined. However, the equality 

𝑊𝑊enh ≠ 𝑊𝑊ext

𝑊𝑊0
 also 

𝛽𝛽h > 1)

remains approximately valid in the quasi-static case [cf. Eq. (S15)], especially when 
𝐄𝐄a(𝐫𝐫) = −𝐄𝐄inc

(𝐫𝐫)
Thus, to notice new effects, predicted by the rigorous theory of this section for the Cherenkov 
𝛽𝛽h ≈ 1

. 

∗

case, one needs to consider relatively large particles and 

 significantly larger than 1. 

𝛽𝛽h

11 

𝛽𝛽h < 1
integration surface for 
𝑊𝑊0 = 0

𝑊𝑊rad = 𝑊𝑊sca
𝑊𝑊sca

 
 
 
2.5  Electron energy-loss probability 

Total energy loss for the electron will be the sum of free-space and particle-induced energy 

losses. To find it we apply Eq. (S6) to 

 and 

where we introduced the electron energy-loss probability density function 

0

� d𝜔𝜔(𝑊𝑊0 + 𝑊𝑊enh)
0

= � d(ℏ𝜔𝜔)ΓEELS(ℏ𝜔𝜔)ℏ𝜔𝜔,

∆𝐸𝐸 = ∆𝐸𝐸0 + ∆𝐸𝐸enh =

2
𝜋𝜋

𝑊𝑊enh

𝑊𝑊0

∞

∞

of the random variable 

 such that 

ΓEELS(ℏ𝜔𝜔) ≝

 is the expected value of this variable. 

2
𝜋𝜋

𝑊𝑊0 + 𝑊𝑊enh
2
𝜔𝜔
ℏ

(35) 

(36) 

Strictly speaking, the purely classical theory is deterministic, i.e. each electron should lose 

ℏ𝜔𝜔

∆𝐸𝐸

exactly 

 given by Eq. (35). By contrast, the quantum description of EELS predicts that each 

electron loses energy in quanta (0 or some natural number of them), each of them is chosen 

∆𝐸𝐸

randomly  from  some  probability  distribution.  However,  it  has  been  shown[37–39]  that  the 

phenomenological introduction of probability density by Eq. (36) allows the classical theory 

to correctly reproduce the quantum result in the single-loss (weak-coupling) regime, i.e. when 

at most one energy quanta is assumed to be lost (also called the Born approximation). This 

regime is commonly satisfied in EELS experiments, although the strong-coupling regime is 

gaining increasing interest as well.[40] 

The total (measurable) loss probability 

 is proportional to the sum of 

 and 

and is naturally the simplest, when 

 (i.e. 
ΓEELS

). Otherwise, there are several potential 
𝑊𝑊enh
, especially for the absorbing host medium 

𝑊𝑊0

issues. First one is related to the definition of 

𝑊𝑊0 = 0
(see Section 2.3). Second, any non-zero 

𝛽𝛽h < 1
𝑊𝑊0
effectively  infinite  for  unbounded  host  media  (as  assumed  in  the  theoretical  derivation).  In 

 has a finite value per unit length, thus becomes 

𝑊𝑊0

practical applications the thickness of the host medium can be much larger than the particle 

size, but still finite. In this case, one  can hope that Eq. (32) remains approximately correct, 

while 

 can be computed from Eq. (30) (or another expression for absorbing host medium)[33] 

with possible addition of the transition-radiation losses.[41] Third, the resulting 

𝑊𝑊0

 need to be 

sufficiently small for the weak-coupling regime to remain valid. The latter requirement can 

𝑊𝑊0

probably be relaxed, assuming that an electron loses at most one energy quantum by interaction 

with particle, but potentially many quanta by interaction with bulk host medium (and these two 

processes are independent). However, in such case the loss probabilities proportional to 

and 

 cannot be added, but rather need to be convoluted as functions of 

 (each including 
𝑊𝑊0
the zero-loss peak for normalization). But we are not aware of existing rigorous analysis of 

𝜔𝜔

𝑊𝑊enh
such option. 

12 

 
 
 
 
 
In  any  case, 

  is  fully  determined  by  the  outer  boundaries  of  the  host  medium  (with 

respect to the electron beam) and is independent from the particle. By contrast, the focus of 

𝑊𝑊0

this paper is on calculating the particle-induced energy losses 

, for which one generally 

needs  to  employ  the  DDA  or  other  numerical  method.  To  avoid  confusion,  we  define  the 

𝑊𝑊enh

corresponding particle-induced loss probability as 

 and aim to compute only this part. 

When 

,  it  is  exactly  the  measurable  quantity 

𝑃𝑃EELS

,  otherwise  it  is  a  first  step  in 

𝑊𝑊0 = 0
ΓEELS

obtaining 

 with the second step consisting of a separate calculation of 

ΓEELS

. In the case of 

a weak-coupling regime for the whole system (particle + slab of host medium) 
𝑊𝑊0

 is equal 

to the difference between the losses in this system and the losses in the same system without a 

𝑃𝑃EELS

particle (both of which are potentially measurable). The same approach is commonly used, e.g., 

when defining cross sections for light scattering by particles in absorbing host medium.[42,43] 

The explicit expression for 

 follows from Eq. (36): 

𝑃𝑃EELS

=
where we defined the enhancement cross-section 

𝑃𝑃EELS(ℏ𝜔𝜔) ≝

2
𝜋𝜋

𝑊𝑊enh
2
𝜔𝜔
ℏ

′
𝑚𝑚h
𝜋𝜋ℏ

2
𝜀𝜀0𝐸𝐸0
𝑘𝑘0 𝐶𝐶enh,
2

analogously  to 

𝐶𝐶enh ≝ −
Im[𝐄𝐄a(𝐫𝐫
  [cf.  Eqs. (17),  (19)].  In  the  case  of 

𝐫𝐫

) ⋅ 𝐏𝐏(𝐫𝐫

𝑘𝑘0
𝜀𝜀0𝐸𝐸0

′
𝑚𝑚h

3
2 � d
𝑉𝑉int

′

′

(37) 

(38) 

  and 

′

)]
,
  we  have 

Eqs. (37),  (38)  simplify  to  a  previously  known  expression  for  the  electron  energy-loss 

𝐶𝐶ext
probability.[8] Usually, energy losses 

𝛽𝛽h < 1
 are expressed in the units of 

𝐶𝐶enh = 𝐶𝐶ext
, then 

 is 

in the units of 

. 

−1

𝑞𝑞𝐸𝐸 = ℏ𝜔𝜔

eV

𝑃𝑃EELS

2.6  Cathodoluminescence probability 

eV

As discussed in Section 2.4, in vacuum (or more generally when 

) the radiation from 

the particle-electron system 

 is only the one produced by induced currents in the particle 

𝛽𝛽h < 1

(

). In arbitrary non-absorbing host medium, the radiated energy is the energy lost by the 

𝑊𝑊rad

electron minus the energy absorbed by the particle: 
𝑊𝑊sca

∆𝐸𝐸 = ∆𝐸𝐸0 + ∆𝐸𝐸enh − ∆𝐸𝐸abs =

∞

∞

2
𝜋𝜋

� d𝜔𝜔(𝑊𝑊0 + 𝑊𝑊enh − 𝑊𝑊abs)
0

where by analogy to 

tot
= � d(ℏ𝜔𝜔)ΓCL

(ℏ𝜔𝜔)ℏ𝜔𝜔,

 we introduce the total light-emission probability density 
0

ΓEELS(ℏ𝜔𝜔)
tot
ΓCL

(ℏ𝜔𝜔) ≝

2
𝜋𝜋

𝑊𝑊0 + 𝑊𝑊enh − 𝑊𝑊abs
2
𝜔𝜔
ℏ

.

13 

(39) 

(40) 

 
 
 
 
As  discussed  in  Section  2.5, 

  is  potentially  problematic,  but  the  computationally-

intensive method is only needed to calculate the particle-related contribution to 

, which we 

𝑊𝑊0

tot
ΓCL

(41) 

further denote as 

: 

tot
𝑃𝑃CL
𝑊𝑊rad − 𝑊𝑊0
2
𝜔𝜔
ℏ

2
𝜀𝜀0𝐸𝐸0
tot
𝑘𝑘0 (𝐶𝐶enh − 𝐶𝐶abs) =
𝑃𝑃CL
2
=
where the second part prevents the loss of precision when 
decimal places, which is often the case for metallic nanoparticles. In the latter case one may 

2
𝜀𝜀0𝐸𝐸0
𝑘𝑘0 (𝐶𝐶enh − 𝐶𝐶ext + 𝐶𝐶sca),
2
 and 

 are equal within a few 

′
𝑚𝑚h
𝜋𝜋ℏ

(ℏ𝜔𝜔) ≝

2
𝜋𝜋

′
𝑚𝑚h
𝜋𝜋ℏ
𝐶𝐶enh

𝐶𝐶abs

calculate 

 by integrating the far field instead of using the relation 

The above definition of 

𝐶𝐶sca

 is fundamentally the most natural, since it accounts for the 

𝐶𝐶sca = 𝐶𝐶ext − 𝐶𝐶abs.

total outgoing radiation in all directions (denoted by superscript “tot”). However, all existing 

tot
𝑃𝑃CL

measurement modalities for CL collect light only in the upper hemisphere when the electron 

moves  downwards,  this  always  excludes  the  Cherenkov  cone  (directed  in  the  lower 

hemisphere). To be more accurate, one should consider a large but finite chunk of the host 

medium  (as  in  Section  2.5)  and  draw  the  Cherenkov  cone  from  each  point  of  the  electron 

trajectory inside the host medium. First, this solves the problem with potential unboundedness 

of 

, since it does not contribute to the measured signal if we neglect the reflection of the 

Cherenkov radiation from the bottom boundary of the host medium. Second, the interference 

𝑊𝑊0

of 

 and 

 in the far-field (also concentrated in the direction of the Cherenkov cone) is 

irrelevant to the measurements as well. But this interference is exactly the one which leads to 

𝐄𝐄inc

𝐄𝐄sca

the difference between 

 and 

. Thus, to exactly reproduce the experimental signal one 

should integrate 

if  one  aims  to  have  a  simple  approximation,  the  integral  of  the  scattered  intensity  over  the 

 over the detector collection angle, which is often not known. However, 
𝑊𝑊ext
2

𝑊𝑊enh

|𝐄𝐄sca|

whole solid angle (proportional to 

) is a reasonable option, at least for particles smaller 

than the wavelength. For the latter case, the angular dependence of 

𝐶𝐶sca
2
thus the ratio between the integral over the detector collection angle and 
|𝐄𝐄sca|

 is relatively weak, 

 is expected to 

weakly depend on the loss energy (frequency). Then the simulated spectrum will reproduce the 

𝐶𝐶sca

measured  one  semi-quantitatively  up  to  a  constant  factor.  Therefore,  we  postulate  the  CL 

probability to be: 

2
𝜋𝜋

𝑊𝑊sca
2
𝜔𝜔
ℏ

′
𝑚𝑚h
𝜋𝜋ℏ

2
𝜀𝜀0𝐸𝐸0
𝑘𝑘0 𝐶𝐶sca,
2

=
which agrees with the ones used in other simulation methods (Lorenz-Mie, BEM). Naturally, 

𝑃𝑃CL(ℏ𝜔𝜔) ≝

we also have 

 for 

. Finally, we stress once again that in the case of 

tot
𝑃𝑃CL = 𝑃𝑃CL

𝛽𝛽h < 1

𝛽𝛽h > 1

14 

(42) 

 
 
 
 
 (hence, 

𝑃𝑃EELS

tot
𝑃𝑃CL
 and 

the difference between 

 and 

 is important for the electron energy losses (Section 2.5), 

but is not visible in existing CL measurement configurations. 

𝑊𝑊ext

𝑊𝑊enh

The  definition  of 

  becomes  even  more  problematic  in  the  case  of  absorbing  host 

medium, since the absorption of the scattered radiation is generally significant. To accurately 

𝑃𝑃CL

reproduce the signal at a detector one should account for variation of optical path in the host 

medium with the scattering angle. The corresponding attenuation will depend on variation of 

  with 

.  Still,  we  can  expect  Eq. (42)  to  qualitatively  reproduce  the  measured  CL 

spectra.  Fortunately,  the  far  limit  of  the  incident  electron  field,  which  is  not  negligible  for 
Im 𝑚𝑚h

𝜔𝜔

, has the same behavior as attenuated Cherenkov radiation. Thus, its contribution to 

detector signal can also be usually neglected. By contrast, 
Re 𝛽𝛽h > 1
in  this  case,  since  all  underlying  components  of  the  energy  balance  depend  on  the  outer 

 has no practical relevance at all 

tot
𝑃𝑃CL

boundary of the host-medium and the far-field powers cannot be computed as integrals over 

the particle volume. 

Finally, we stress that neither 

 nor 

 are generally guaranteed to be positive. While 

the relations 

 and 

) always hold, see Eq. (18) and [23], only 

in the case 

 the probabilities 
𝑊𝑊sca > 0

𝑊𝑊abs ≥ 0
𝛽𝛽h < 1

𝑃𝑃CL > 0
𝑃𝑃CL

respectively, and hence are strictly positive. Negative probabilities, that may be obtained in 
𝑊𝑊sca
absorbing or Cherenkov host medium, are analogous to the phenomenon of negative extinction 

𝑊𝑊abs + 𝑊𝑊sca

𝑃𝑃EELS

 are proportional to 

 and 

, 

[42]. Note, however, that 

 holds in any non-absorbing medium, including the case 

. 

𝑊𝑊ext > 0

1
2.7  Scale invariance 

𝛽𝛽h >

To account for the host medium in the DDA, the Green’s tensor, the incident electric field, 

and the particle refractive index must be modified according to 

. For the electromagnetic 

codes that do not natively support refractive index of the host medium as an input parameter, 

𝑚𝑚h

this can be done by scaling other input parameters. For the case of the plane-wave excitation 

and 

, it is sufficient to divide both 

 and the vacuum wavelength 

 by 

, resulting 

in the correct values of 

𝑚𝑚h > 0

 and 

.[44] All computed values are then correct, except for scaling 

𝜆𝜆

𝑚𝑚h

of cross sections since 

 scales with 

 is fixed [Eq. (19)]. 

In the case of the electron excitation, additional care is required to keep the incident field 
𝐸𝐸0

𝑚𝑚h

[Eq. (25)] the same up to a constant factor. Relativistic factors 

 and 

 need to be the same, 

since they differently affect the fields along the transverse and longitudinal coordinates, leading 

𝛽𝛽h

𝛾𝛾h

to the scaling 

. Obviously, this applies only to the case of not very dense host medium 

(

𝛽𝛽h < 1

) – this derivation additionally illustrates that this case is fully analogous to the case of 

𝜐𝜐 → 𝑚𝑚h𝜐𝜐

15 

𝑚𝑚p
, when 

𝑘𝑘

𝑚𝑚(𝐫𝐫)
𝐼𝐼0

vacuum. The scaling of 

 is compensated by scaled 

, corresponding to the above scaling of 

. The resulting 

 in vacuum is then 
𝜐𝜐

 times the correct field in the host medium. 

𝜔𝜔

Let us generalize this analysis to arbitrary scaling of refractive index by 

 combined 

𝑚𝑚h

𝜂𝜂 ∈ ℝ
classical scale-invariance rule in electromagnetic scattering.[45] Formally, we have 

 (and inverse scaling of 

). The latter corresponds to the 

𝜉𝜉 ∈ ℝ

𝑘𝑘

𝜆𝜆
with scaling of all lengths by 

𝐄𝐄inc(𝐫𝐫)

𝑚𝑚p → 𝑚𝑚p 𝜂𝜂⁄ ,
Which,  after  straightforward  algebraic  analysis  [Eqs. (7),(17)–(19),(25),(26),(32),(37),(41)], 

𝑚𝑚h → 𝑚𝑚h 𝜂𝜂⁄ ,

𝜐𝜐 → 𝜂𝜂𝜐𝜐,

 𝐫𝐫 → 𝐫𝐫 𝜉𝜉⁄ ,

𝐫𝐫0 → 𝐫𝐫0 𝜉𝜉⁄ ,

𝑘𝑘 → 𝜉𝜉𝑘𝑘.

(43) 

leads to 

𝜔𝜔 → 𝜉𝜉𝜂𝜂𝜔𝜔,

𝐼𝐼0 → 𝐼𝐼0 𝜂𝜂⁄ ,

𝐄𝐄inc → 𝜉𝜉𝜂𝜂𝐄𝐄inc,
𝜕𝜕𝑊𝑊0
𝜕𝜕𝑧𝑧

→ 𝜉𝜉𝜂𝜂

𝜕𝜕𝑊𝑊0
𝜕𝜕𝑧𝑧

,

𝐄𝐄 → 𝜉𝜉𝜂𝜂𝐄𝐄,

𝐏𝐏 → 𝜉𝜉 𝐏𝐏 𝜂𝜂⁄ ,

𝐆𝐆� → 𝜉𝜉𝐆𝐆�,

(44) 

𝑊𝑊𝑋𝑋 → 𝜂𝜂𝑊𝑊𝑋𝑋,

𝐶𝐶𝑋𝑋 → 𝜂𝜂

2

𝐶𝐶𝑋𝑋,  

where 

 is a subscript of any power (enh, ext, abs) and 
𝑃𝑃EELS,CL → 𝑃𝑃EELS,CL 𝜉𝜉⁄ ,

, 
, 
Δ𝐸𝐸𝑋𝑋.

, 

 are kept intact. Note 

2
, 
Δ𝐸𝐸𝑋𝑋 → 𝜉𝜉𝜂𝜂

that the scaling of powers and cross sections is different from the case of plane-wave excitation 

𝐸𝐸0

𝑐𝑐

ℏ

𝜀𝜀0

𝜇𝜇0

𝑋𝑋

due to the additional scaling of the incident field. 

Coming  back  to  simulating  EELS  and  CL  in  the  host  medium  with 

  using  any 

vacuum-based code, one has two options. The first one, described above, corresponds to 

𝛽𝛽h < 1

  and 

.  The  particle  geometry  and  electron  trajectory  are  kept  intact,  only  the 
𝜂𝜂 =
electron speed, the particle refractive index, and simulation frequency (energy loss or vacuum 
𝑚𝑚h(𝜔𝜔)
𝜉𝜉 = 1
wavelength) need to be scaled: 

(45) 

Note that the values of both 

𝜐𝜐 → 𝑚𝑚h𝜐𝜐,

 and 
𝑚𝑚p → 𝑚𝑚p 𝑚𝑚h⁄

 correspond to the original frequency rather than to the 

ℏ𝜔𝜔 → 𝑚𝑚hℏ𝜔𝜔 (𝜆𝜆 → 𝜆𝜆 𝑚𝑚h⁄

).

,

scaled one. Thus, both 

 and 
𝑚𝑚p

 computed with vacuum code for energy loss 
𝑚𝑚h

 are 

exactly  the sought  probabilities  for energy  loss 

𝑃𝑃EELS

𝑃𝑃CL

  in  the  host medium.  The  second  option 

𝑚𝑚hℏ𝜔𝜔

keeps 

 and 

 intact at the cost of additional geometrical scaling, i.e. 

ℏ𝜔𝜔

. Thus, 

additionally both particle dimensions and electron position need to be multiplied by 

𝜔𝜔

𝜆𝜆

𝜂𝜂 = 𝑚𝑚h = 1 𝜉𝜉⁄
𝑚𝑚h

: 

(46) 

𝜐𝜐 → 𝑚𝑚h𝜐𝜐,

𝑚𝑚p → 𝑚𝑚p 𝑚𝑚h⁄

,

𝐫𝐫 → 𝑚𝑚h𝐫𝐫,

𝐫𝐫0 → 𝑚𝑚h𝐫𝐫0,

In this case, the probability density computed by the vacuum code needs to be further divided 

𝑃𝑃EELS,CL → 𝑚𝑚h𝑃𝑃EELS,CL.

by 

. Finally, note that the scaling 

 corresponds to the following scaling of electron 

kinetic energy 

𝑚𝑚h

: 

𝜐𝜐 → 𝑚𝑚h𝜐𝜐

ℰ

16 

 
 
 
 
 
 
 
(47) 

where 

2
 is the electron rest mass energy. 
�ℰ0

− (𝜀𝜀h − 1)ℰ(2ℰ0 + ℰ)
Naturally, the proposed scaling cannot transform the Cherenkov case into a vacuum one, 

2

− 1�,

  ℰ → ℰ0 �

ℰ0 = 𝑚𝑚e𝑐𝑐

ℰ + ℰ0

but an alternative approximate scaling for the case 

 is described in Section S4 of the 

Supporting Information. 

𝛽𝛽h > 1

3  Simulations 
3.1  Implementation in ADDA 

To  perform  EELS  and  CL  simulations  according  to  the  developed  general  theory,  we 

modified the open-source software ADDA.[21] A single run of ADDA performs a simulation 

for a single set of parameters (

, beam position, etc.). To simulate a loss spectrum or to scan a 

particle’s cross-section with the beam, it is necessary to run ADDA multiple times varying the 

𝜆𝜆

desired parameters. For instance, to simulate the EELS and CL spectra one needs to vary 

 and 

the corresponding 

. We developed a Python wrapper, named ADDAwrapper, to automate 

𝜆𝜆

this process. 

𝑚𝑚p

The wrapper is designed to work as a Python library, so one only has to fill the example 

preset  file  with  the  simulation  parameters,  and  call  high-level  functions  from  this  file  to 

perform the corresponding set of simulations (spectrum, loss probability scan over the cross-

section  of  the  particle,  etc.),  collect  the  data  from  these  simulations,  and  plot  it  in  various 

formats. Ready-to-use examples are distributed with the ADDA in the folder /examples/.  
ADDAwrapper  supports  multithreading  to  speed  up  the  simulation  up  to  an  order  of 
physical  processor  cores.  Apart  from  that,  the  examples  use  optimized  set  of  simulation 

parameters, which allows the wrapper to perform EELS and CL simulations with ADDA up to 

an  order  of  magnitude  faster  than  with  the  default  code  settings.  More  details  are  given  in 

Section S5 of the Supporting Information. 

3.2  Comparison to the Lorenz-Mie theory in vacuum 

The classical Lorenz-Mie theory presents a solution of light scattering by a homogeneous 

sphere.[46] This solution was extended for calculation of the EELS and CL by Garcia de Abajo 

et al.,[5,47] who also implemented it in the online simulation tool,[48] which we used to obtain 

the reference solutions. 

In Fig. 2. we present the EELS and CL spectra simulated with ADDA and the Lorenz-Mie 

theory. In vacuum an electron with kinetic energy 

 100 keV passes at a distance of 100 nm 

ℰ =

17 

 
from the center of a silver 75-nm-radius sphere. Optical data for silver is taken from [49], since 

it is available as a built-in option in the Lorenz-Mie simulation tool, and 128 dipoles along the 

-axis  (

)  are  used  for  volume  discretization.  Step  size  of  0.05 eV  is  used  for  all 

simulations of spectra. 
𝑥𝑥

𝑛𝑛𝑥𝑥 = 128

Fig. 2. EELS and CL spectra of a sphere simulated with the Lorenz-Mie theory and ADDA (

). 

The problem parameters are shown in the inset. 

𝑛𝑛𝑥𝑥 = 128

Simulated spectra are close to the exact solution, but can be further improved by increasing  

 (refining discretization) at the expense of extra computational resources. A more efficient 

approach is to employ the Richardson extrapolation.[50] Although it is a semi-empirical method, 
𝑛𝑛𝑥𝑥
it  was  successfully  used  in  various  applications[51–54]  and  was  especially  efficient  for 

nanoparticles. In particular, we used the guidelines from [50], performing simulations for a set 

of 

 128, 108, 91, 76, 64, 54, 45, 38, and 32 and extrapolating the dependence on the dipole 

size to 
𝑛𝑛𝑥𝑥 =

 using the quadratic function (see Fig. 3 for an example). The errors of data points 

were assumed to scale as 

𝑑𝑑 = 0

, and the standard error of fitted value at 

 was multiplied by 

2 to obtain nominal 95% confidence interval. 

3

𝑑𝑑

𝑑𝑑 = 0

18 

 
Fig. 3. Extrapolation of the simulated 

 value at 

 3.6 eV. The parameters of the problem are the 

𝑃𝑃EELS

same as in Fig. 2. 

𝑞𝑞𝐸𝐸 =

In Fig. 4 the same Richardson extrapolation applied to the whole spectrum leads to almost 

perfect  match  with  the  exact  solution.  The  extrapolation  is  performed  automatically  by 

ADDAwrapper both for a single 

 and for the whole spectrum. 

𝑞𝑞𝐸𝐸

Fig. 4. EELS and CL spectra simulated with the Lorenz-Mie theory and ADDA (

 with the 

extrapolation). 95% confidence interval is showed for the extrapolated values. The parameters of the problem 

𝑛𝑛𝑥𝑥 = 128

are shown in the inset (the same as in Fig. 2). 

3.3  Comparison to the BEM in a host medium 

Next, we  consider particles embedded  in a host medium. In Fig. 5 we show  how EELS 

spectrum  changes  when  the  same  sphere  is  placed  inside  a  non-absorbing  host  medium,  in 

comparison to the simulation for vacuum (

). In host media the peaks shift to the lower 

energies  and  their  magnitudes  decrease.  We  also  performed  scaling  of  separate  DDA 
𝑚𝑚h = 1

19 

 
 
simulations  for  a  particle  in  vacuum  according  to  Section  2.7  –  both  approaches  there 

[Eqs. (45), (46)] lead to identical results (only one of them is shown). For 

 the scaled 

spectrum perfectly matches the one obtained by directly setting this value of 

 in the code 

𝑚𝑚h = 1.5

(Fig. 5). By contrast, for 

 the electron with 100 keV kinetic energy moves faster (

𝑚𝑚h

) 

than  the  speed  of  light  in  this  medium  (

𝑚𝑚h = 2

),  causing  qualitative  differences  in  theoretical 

0.55𝑐𝑐

description of this process (

). Specifically, the exact scaling is not valid anymore, 

0.5𝑐𝑐

but we have tried an approximate correction given by Eq. (S16) in the Supporting Information. 

𝛽𝛽h = 1.10

One can see that such scaling qualitatively reproduces the data, both peak positions and, less 

accurately, amplitudes. However, it is less accurate for peak magnitudes of CL (Fig. S1). See 

also Fig. S2 for further discussion of this scaling as a function of 

. 

𝑚𝑚h

100 keV e

Ag

100 nm

mh

Fig. 5. EELS spectra for a sphere in an infinite non-absorbing host medium simulated with ADDA 

(

 128), either directly or through scaling of simulations in vacuum (see the text for details). The problem 

parameters are shown in the inset. In the host medium with 

𝑛𝑛𝑥𝑥 =

 the electron is faster than light, causing the 

Cherenkov radiation. 
𝑚𝑚h = 2

We further compare our results with the BEM, as implemented in the MNPBEM17 code,[10] 

as  it  seems  to  support  arbitrary  host  medium.  We  limit  ourselves  to  EELS  in  this  section, 

presenting the corresponding CL results in the Supporting Information (Fig. S3–Fig. S5). First, 

we reproduce the EELS data from Fig. 4. As shown in Fig. 6, the BEM agrees with the DDA 

and the Lorenz-Mie theory except for the lowest loss energies (<1.4 eV). We used 1024 surface 

points for all BEM simulations, and further mesh refinement did not improve the accuracy for 

such energies. We hypothesize that it is related to large 

 in this range, but it is not 

important for further discussion. Note also that CL results for BEM do not have this artifact 

�𝑚𝑚p� > 7

(Fig. S3). Since the online tool[48] does not allow manual specification of a dielectric function 

20 

 
(which is used below), we further use the Lorenz-Mie theory built into MNPBEM. However, 

we tested that they produce identical results for the case of Fig. 6 (data not shown). 

Fig. 6. EELS spectra simulated with the Lorenz-Mie theory, ADDA (

 128 with the extrapolation), and 

the BEM. The parameters of the problem are shown in the inset (the same as in Fig. 4). 

𝑛𝑛𝑥𝑥 =

Next, we set 

 in both MNPBEM and ADDA and compare the results with the 

Lorenz-Mie  theory,  scaled  according  to  Eq. (45).  The  results  in  Fig. 7  show  that  all  three 

𝑚𝑚h = 1.5

methods agree. The visible inaccuracy of the DDA at the peak value at 3.0 eV disappears with 

further grid refinement to 

 192 with the extrapolation (data not shown). The CL results 

also agree, but only if the MNPBEM results are additionally multiplied by 

𝑛𝑛𝑥𝑥 =

 (Fig. S4). 

𝑚𝑚h
100 keV e

Ag

100 nm

mh=1.5

Fig. 7. EELS spectra simulated with the Lorenz-Mie theory (using scaling), ADDA (

 128 with the 

extrapolation), and BEM. The parameters of the problem are shown in the inset (subset of Fig. 5). 

𝑛𝑛𝑥𝑥 =

21 

 
 
The  situation  is  markedly  different  for 

  (Cherenkov  case),  as  shown  in  Fig. 8 

featuring huge difference between the DDA and BEM. To investigate this issue, let us formally 

𝑚𝑚h = 2

define the extinction probability 

 by analogy to 

 [Eq. (37)] as 

As discussed in Section 2.5, 

for the case of 

𝑃𝑃ext

𝑃𝑃EELS
′
2
𝜀𝜀0𝐸𝐸0
𝑚𝑚h
𝑘𝑘0 𝐶𝐶ext.
2
 for 
𝜋𝜋ℏ
 (data not shown). However, they are different for 
𝑃𝑃EELS

𝑊𝑊ext
2
2
=
 is identical to 
𝜋𝜋
𝜔𝜔
ℏ

𝑃𝑃ext(ℏ𝜔𝜔) ≝

𝛽𝛽h < 1

𝑃𝑃ext

, which we explicitly tested 

, as shown 

(48) 

in Fig. 8. And, surprisingly, the spectrum simulated with BEM turns out to be matching 

𝑚𝑚h = 1.5

𝑚𝑚h = 2

values  instead  of 

,  but  is 
𝑃𝑃ext
incorrect for the Cherenkov case. It uses the correct incident field in the latter case, but seems 

.  Thus,  we  conclude  that  MNPBEM  works  fine  for 

𝑃𝑃EELS

to use incorrect expression for 

 based on equivalence of 

 and 

𝛽𝛽h < 1
 that no longer 

holds. The latter equivalence is also implicitly used in other DDA codes for EELS simulations: 

𝑊𝑊ext

𝑊𝑊enh

𝑃𝑃EELS

e-DDA[9] and DDEELS.[8] By contrast, the results of 

 computed with MNPBEM for 

  agree  with  the  DDA  after  multiplication  by 

definition of 
2
as discussed in Section 2.6. 
𝑃𝑃CL

 is not affected by the difference between 

𝑚𝑚h

  (Fig. S5).  This  is  expected,  since  the 
𝑚𝑚h =
𝑃𝑃CL
), 

 (in contrast to 

 and 

𝑊𝑊ext

𝑊𝑊enh

tot
𝑃𝑃CL

100 keV e

Ag

100 nm

mh=2

Fig. 8. EELS and extinction probabilities simulated with the DDA (

 128 with the extrapolation) 

compared to EELS spectrum simulated with BEM. The parameters of the problem are shown in the inset (subset 

𝑛𝑛𝑥𝑥 =

of Fig. 5). 

3.4  Comparison to the experiments 

In EELS experiments a particle is usually placed on or inside a substrate. Raza et al.[11] 

investigated silver nanospheres encapsulated in silicon nitride, which fixes them in place and 

prevents silver oxidation. In that paper both experimental and simulated spectra are shown for 

22 

 
 
 
an encapsulated nanosphere with a radius of 9.2 nm and an electron passing at different impact 

parameters. The simulations were performed for a full system geometry, discretizing the finite 

chunk of the silicon nitride layer. 

By contrast, we try to reproduce these experimental data by simulations for a particle in an 

infinite host medium.  Specifically, Fig. 9 shows the simulated spectrum for the  same silver 

nanosphere along with the experimental data from [11] for an impact parameter of 12.4 nm. The 

simulation is done in ADDAwrapper for 

, 

 100 keV, and 

 128. This is a 

Cherenkov  medium  with 

𝑚𝑚h = √3.2
somewhat more accurate than the data used in theoretical comparisons of Sections 3.2 and 3.3. 

.  The  optical  data  for  silver  is  taken  from  [55],  which  is 

𝑛𝑛𝑥𝑥 =

ℰ =

𝛽𝛽h = 1.05

The  simulated  spectrum  was  additionally  convoluted  with  Gaussian  point  spread  function 

(PSF) with FWHM of 0.15 eV to match the experimental conditions. The simulated spectrum 

matches  the  main  2.8 eV  peak  position,  as  well  as  its  right  shoulder.  The  remaining 

disagreement at the left side of the peak can potentially be related to imperfect zero-loss peak 

removal, which also causes some experimental values at larger loss energies to systematically 

lie below zero. While such negative values are not impossible when 

 (see Section 2.6), 

they are not observed in simulations for the specific problem parameters. 

𝛽𝛽h > 1

120 keV e

Ag

12.4 nm

mh=√3.2

Fig. 9. Experimental and simulated EELS spectra for a silver sphere encapsulated in silicon nitride, 

normalized by the maximum value. The problem parameters are in the inset. Experimental data is taken from 

[11], simulation is done with ADDA using 

 128 (blue line) and convoluted with Gaussian PSF with FWHM 

of 0.15 eV (purple line). 

𝑛𝑛𝑥𝑥 =

In  another  work  Kobylko  et  al.[12]  investigated  gold  nanoparticles  placed  inside  a  glass 

substrate. One of them was a 92.6-nm-long gold nanowire with a 7.8 nm radius, investigated 

by  electrons  with 

 100 keV.  We  modeled  this  nanowire  as  a  perfect  cylinder  with 

hemispheres at both ends with a computational grid of 16x16x190 dipoles and placed it in an 

ℰ =

23 

 
infinite medium with 

 (corresponding to 

); optical data for gold is taken 

from [55]. We compare the results of the DDA simulations with the experimental data from [12] 

𝑚𝑚h = 1.45

𝛽𝛽h = 0.79

in Fig. 10. The experimental data include EELS spectrum averaged over the cross section of 

the nanowire (Fig. 10, a), as well as plasmon maps for four observed resonant energies (Fig. 10, 

b–e):  0.86,  1.27,  1.66,  and  2.4 eV.  The  simulation  results  include  the  same  cross-section-

averaged spectrum (Fig. 10, f) and the plasmon maps for resonant energies of the simulated 

spectrum  (Fig. 10,  g–j):  0.7,  1.2,  1.55,  and  2.4 eV,  which  are  slightly  different  from  the 

experimental  ones.  The  latter  is  probably  caused  by  imperfect  cylindrical  geometry  of  the 

particle in the experiment. Apart from that and expected broadening of the experimental peaks, 

simulations reproduce the experimental data both for EELS spectrum and plasmon maps. 

Fig. 10. Comparison of experimental EELS data (a-e) for a gold nanowire in a glass substrate from [12] with 

the DDA simulations (f-j) (see the text for details). Shown are the EELS spectrum averaged over the cross 

section of the nanowire (a,f) and plasmon maps for four resonant energies (b-e, g-j). The resonant energies 

slightly differ between experiments and simulations. 

4  Conclusion 

We derived all the quantities necessary to simulate EELS and CL in the DDA in the energy-

budget  framework  based  on  the  volume-integral  equation.  This  framework  has  shown  its 

versatility  in  calculating  the  incident  electric  field,  free-space  energy  losses,  and  particle-

24 

 
induced energy losses of a current source, as well as scattered power corresponding to CL. The 

obtained expressions either coincide with those known from the literature (derived by several 

other  methods)  or  appear  for  the  first  time.  In  particular,  a  volume-integral  expression  for 

particle-induced energy losses of arbitrary source [Eq. (32)] can be efficiently calculated in the 

DDA.  This  expression  remains  valid  for  an  arbitrary  (even  absorbing  or  Cherenkov)  host 

medium, and in the case of vacuum it reduces to the known one.[8,9,36] We also extended the 

scale invariance rule to EELS, allowing one to apply any existing vacuum-based code to the 

case  of  moderately  dense  non-absorbing  host  medium.  The  presented  framework  for  a 

homogeneous  medium  is  derived  using  the  free-space  tensor 

,   but  it  can  be  further 

generalized  to  the  cases  of  layered  media,  such  as  a  semi-infinite  or  thin  substrate,  by 

𝐆𝐆�

employing the corresponding Green’s tensors. 

For a test case of a sphere in vacuum, the DDA results (with extrapolation of the computed 

values  versus  the  dipole  size)  almost  match  the  exact  Lorenz-Mie  solution,  exceeding  the 

accuracy of the BEM. The same agreement between the three methods holds for a host medium 

with no intrinsic electron losses, but the results of the Lorenz-Mie theory need to be scaled (as 

mentioned above), since  only  vacuum  implementations  of this  theory are  available.  For the 

Cherenkov (sufficiently dense) host medium, the DDA results for EELS probability disagreed 

with that of BEM (as implemented in the MNPBEM code), since the latter code ignores the 

interference of the Cherenkov and particle-induced radiations (effectively assuming that EELS 

probability is proportional to the extinction power). The CL spectra agree between the DDA 

and BEM in all considered cases up to the overall scale of MNPBEM results (it needed to be 

additionally multiplied by 

). 

Rigorously  accounting  for  the  host  medium  is  important  for  the  corresponding 

𝑚𝑚h

experimental  conditions,  i.e.  when  particles  or  voids  are  considered  in  larger  homogeneous 

slabs,  since  LSPRs  strongly  depend  on  dielectric  properties  of  this  medium.  The 

implementation of the developed theory in the open-source ADDA code, augmented with a 

comprehensive Python wrapper, makes any such simulations easily available to practitioners. 

To illustrate these novel capabilities, we simulated actual EELS experiments: for nanospheres 

encapsulated  in  silicon  nitride  and  nanowires  inside  glass.  For  the  former  experiment,  the 

electrons were faster than the speed of light in the substrate (Cherenkov case), and the DDA 

perfectly reproduced the EELS spectrum in terms of a peak position. For the nanorod inside 

glass  the  DDA  reproduced  the  EELS  spectrum,  as  well  as  the  plasmon  maps  for  all  four 

plasmon resonances determined in the experiment. 

25 

5  Acknowledgments 

We  thank  Søren  Raza  for  providing  experimental  data  shown  in  Fig. 9  and  Mathias 

Kobylko  for  providing  experimental  images  shown  in  Fig. 10.  We  also  thank  Tomas 

Ostaševičius  for  making  the  first  prototype  of  EELS  simulations  in  the  ADDA  code  and 

Alexander Moskalensky for implementing the support of host medium in this code (for light-

scattering  simulations).  The  theoretical  developments  and  implementation  of  EELS 

simulations in ADDA were supported by Russian Foundation for Basic Research (grant no. 

18-01-00502).  While  the  comparisons  with  BEM  and  experiments,  the  study  of  simulation 

accuracy, and adding the support of absorbing host medium to ADDA were supported by the 

Russian Science Foundation (grant no. 18-12-00052). 

6  References 
[1]  L.  Novotny,  B.  Hecht,  Principles  of  Nano-Optics,  Cambridge  University  Press, 

Cambridge, UK, 2012. 

[2]  C. Cherqui, N. Thakkar, G. Li, J. P. Camden, D. Masiello, Annu. Rev. Phys. Chem. 2016, 

67, 331. 

[3]  F. J. García de Abajo, V. Di Giulio, ACS Photonics 2021, 8, 945. 
[4]  M. Kociak, L. F. Zagonel, Ultramicroscopy 2017, 176, 112. 
[5]  F. J. García de Abajo, Phys. Rev. B 1999, 59, 3095. 
[6]  F. J. García de Abajo, A. Howie, Phys. Rev. B 2002, 65, 115418. 
[7]  Y. Cao, A. Manjavacas, N. Large, P. Nordlander, ACS Photonics 2015, 2, 369. 
[8]  N. Geuquet, L. Henrard, Ultramicroscopy 2010, 110, 1075. 
[9]  N. W. Bigelow, A. Vaschillo, V. Iberi, J. P. Camden, D. J. Masiello, ACS Nano 2012, 6, 

7497. 

[10]  U. Hohenester, Comp. Phys. Commun. 2014, 185, 1177. 
[11]  S. Raza, S. Kadkhodazadeh, T. Christensen, M. Di Vece, M. Wubs, N. A. Mortensen, N. 

Stenger, Nat Commun 2015, 6, 8788. 

[12]  M. Kobylko, P.-E. Coulon, A. Slablab, A. Fafin, J. Cardin, C. Dufour, A. Losquin, M. 
Kociak, I. Monnet, D. Mailly, X. Lafosse, C. Ulysse, E. Garcia-Caurel, G. Rizza, Phys. 
Rev. Appl. 2018, 9, 064038. 

[13]  S. Kadkhodazadeh, T. Christensen, M. Beleggia, N. A. Mortensen, J. B. Wagner, ACS 

Photonics 2017, 4, 251. 

[14]  S. A. Maier, H. A. Atwater, J. Appl. Phys. 2005, 98, 011101. 
[15]  A. Losquin, L. F. Zagonel, V. Myroshnychenko, B. Rodríguez-González, M. Tencé, L. 
Scarabelli, J. Förstner, L. M. Liz-Marzán, F. J. García de Abajo, O. Stéphan, M. Kociak, 
Nano Lett. 2015, 15, 1229. 

[16]  S. Raza, S. Kadkhodazadeh, T. Christensen, M. Di Vece, M. Wubs, N. A. Mortensen, N. 

Stenger, Nat. Commun. 2015, 6, 8788. 

[17]  N. Sakaguchi, S. Matsumoto, Y. Kunisada, M. Ueda, J. Phys. Chem. C 2019, 123, 6735. 
[18]  M. A. Yurkin, A. G. Hoekstra, J. Quant. Spectrosc. Radiat. Transfer 2007, 106, 558. 
[19]  M. I. Mishchenko, M. A. Yurkin, J. Quant. Spectrosc. Radiat. Transfer 2018, 214, 158. 
[20]  B. T. Draine, P. J. Flatau, J. Opt. Soc. Am. A 1994, 11, 1491. 
[21]  M. A. Yurkin, A. G. Hoekstra, J. Quant. Spectrosc. Radiat. Transfer 2011, 112, 2234. 
[22]  N. W. Bigelow, A. Vaschillo, J. P. Camden, D. J. Masiello, ACS Nano 2013, 7, 4511. 
[23]  A. E. Moskalensky, M. A. Yurkin, Phys. Rev. A 2019, 99, 053824. 

26 

[24]  A. A. Kichigin, M. A. Yurkin, in AIP Conf. Proc., ITMO University, Online, 2020, 2300, 

020053. 

[25]  A. A. Kichigin, M. A. Yurkin, in J. Phys.: Conf. Ser., ITMO University, Online, 2021, 

2015, 012064. 

[26]  M. A. Yurkin, M. I. Mishchenko, Phys. Rev. A 2018, 97, 043824. 
[27]  M.  I.  Mishchenko,  Electromagnetic  Scattering  by  Particles  and  Particle  Groups:  An 

Introduction, Cambridge University Press, Cambridge, UK, 2014. 

[28]  M. I. Mishchenko, Opt. Express 2007, 15, 13188. 
[29]  M.  I.  Mishchenko,  M.  A.  Yurkin,  J.  Quant.  Spectrosc.  Radiat.  Transfer  2020,  242, 

106688. 

[30]  C.  F.  Bohren,  D.  R.  Huffman,  Absorption  and  Scattering  of  Light  by  Small  Particles, 

Wiley, New York, 1983. 

[31]  M. A. Yurkin, M. I. Mishchenko, Phys. Rev. A 2018, 97, 043824. 
[32]  F. W. J. Olver, A. B. Olde Dallhuis, D. W. Lozier, B. I. Schneider, R. F. Boisvert, C. W. 
Clark, B. R. Miller, B. V. Saunders, H. S. Cohl, M.  A. McClain,  Eds., [DLMF] NIST 
Digital Library of Mathematical Functions, 2022. 

[33]  J. D. Jackson, Classical Electrodynamics, Wiley, New York, 1998. 
[34]  I. Frank, I. Tamm, Comptes Rendus (Dokl.) Acad. Sci. URSS 1937, 14, 109. 
[35]  P. A. Cherenkov, Phys. Rev. 1937, 52, 378. 
[36]  L. Henrard, P. Lambin, J. Phys. B 1996, 29, 5127. 
[37]  A. A. Lucas, M. Šunjić, Prog. Surf. Sci. 1972, 2, 75. 
[38]  R. H. Ritchie, A. Howie, Phil. Mag. A 1988, 58, 753. 
[39]  F. J. García de Abajo, Rev. Mod. Phys. 2010, 82, 209. 
[40]  O. Kfir, Phys. Rev. Lett. 2019, 123, 103602. 
[41]  V. L. Ginzburg, Physica Scripta 1982, T2/1, 182. 
[42]  M. I. Mishchenko, P. Yang, J. Quant. Spectrosc. Radiat. Transfer 2018, 205, 241. 
[43]  J. Dong, W. Zhang, L. Liu, Opt. Express 2021, 29, 7690. 
[44]  M. A. Yurkin, A. G. Hoekstra, “User manual for the discrete dipole approximation code 
https://github.com/adda-

found 

under 

can 

be 

ADDA 
team/adda/raw/v1.4.0/doc/manual.pdf, 2020. 

1.4.0,” 

[45]  M. I. Mishchenko, J. Quant. Spectrosc. Radiat. Transfer 2006, 101, 411. 
[46]  G. Mie, Ann. Phys. 1908, 330, 377. 
[47]  F. J. García de Abajo, A. Howie, Phys. Rev. Lett. 1998, 80, 5180. 
[48]  F.  J.  García  de  Abajo,  “Electron  energy  loss  (EELS)  and  photon  emission 
(cathodoluminescence)  for  an  electron  passing  near  a  homogeneous  sphere.,”  can  be 
found under http://widgets.nanophotonics.es/sphere/index.html, 2022. 
[49]  E. D. Palik, Handbook of Optical Constants of Solids, Academic Press, 1985. 
[50]  M. A. Yurkin, V. P. Maltsev, A. G. Hoekstra, J. Opt. Soc. Am. A 2006, 23, 2592. 
[51]  J. I. Hage, J. M. Greenberg, R. T. Wang, Appl. Opt. 1991, 30, 1141. 
[52]  M. A. Yurkin, D. de Kanter, A. G. Hoekstra, J. Nanophoton. 2010, 4, 041585. 
[53]  M. A. Yurkin, M. Kahnert, J. Quant. Spectrosc. Radiat. Transfer 2013, 123, 176. 
[54]  C. Liu, S. Teng, Y. Zhu, M. A. Yurkin, Y. L. Yung, J. Quant. Spectrosc. Radiat. Transfer 

2018, 221, 98. 

[55]  S. Babar, J. H. Weaver, Appl. Opt. 2015, 54, 477. 
[56]  G.  S.  Smith,  An  Introduction  to  Classical  Electromagnetic  Radiation,  Cambridge 

University Press, 1997. 

[57]  M.  A.  Yurkin,  A.  E.  Moskalensky,  in  J.  Phys.:  Conf.  Ser.,  ITMO  University,  Online, 

2021, 2015, 012167. 

27 

 
Supporting Information for:  

Simulating electron energy-loss spectroscopy and 

cathodoluminescence for particles in arbitrary host medium 

using the discrete dipole approximation 

Alexander A. Kichigin1,2 and Maxim A. Yurkin1,2,* 

1 Voevodsky Institute of Chemical Kinetics and Combustion SB RAS,  

Institutskaya Str. 3, 630090, Novosibirsk, Russia 

2 Novosibirsk State University, Pirogova Str. 2, 630090, Novosibirsk, Russia 

*Corresponding author: yurkin@gmail.com  

S1 Fourier transform 

We use the following definitions for the direct and inverse Fourier transforms: 

∞

𝑓𝑓(𝜔𝜔) = � d𝑡𝑡𝑓𝑓(𝑡𝑡)𝑒𝑒
−∞

∞

1
2𝜋𝜋

−i𝜔𝜔𝜔𝜔

,

i𝜔𝜔𝜔𝜔

(S1) 

 be real-valued functions, then, according to the Plancherel theorem,  

� d𝜔𝜔𝑓𝑓(𝜔𝜔)𝑒𝑒
−∞

.

𝑓𝑓(𝑡𝑡) =

Let 

 and 

𝑓𝑓(𝑡𝑡)

𝑔𝑔(𝑡𝑡)

∞

∞

The real-valuedness of 

� d𝑡𝑡𝑓𝑓(𝑡𝑡)𝑔𝑔(𝑡𝑡)
−∞

=
 implies that 

1
2𝜋𝜋

� d𝜔𝜔𝑓𝑓(𝜔𝜔)𝑔𝑔
−∞

∗
 and analogously for 

(𝜔𝜔)

.

∗
we split the integration interval and, using substitution 

𝑓𝑓(−𝜔𝜔) = 𝑓𝑓

(𝜔𝜔)

𝑓𝑓(𝑡𝑡)

, re-write Eq. (S2) as  

𝑔𝑔

(S2)  

. Therefore, 

0
S2 Energy transfer for sources with general time dependence 

� d𝑡𝑡𝑓𝑓(𝑡𝑡)𝑔𝑔(𝑡𝑡)
−∞

=

 � d𝜔𝜔Re[𝑓𝑓(𝜔𝜔)𝑔𝑔

(𝜔𝜔)]

.

∞

∞

1
𝜋𝜋

𝜔𝜔 → −𝜔𝜔

∗

(S3)  

In the energy budget framework the expressions for the powers are derived for the case of 

time-harmonic fields. Any other fields can be represented as a linear superposition of time-

harmonic  fields,  the  formal  mechanism  for  this  representation  is  the  Fourier  transform  (see 

Section S1). First, note that the Fourier transforms of fields, 

 and 

, have the units of 

electric and magnetic field per frequency, i.e., V

s/m and A

s/m, respectively. As a result, the 
𝐄𝐄(𝐫𝐫)

𝐇𝐇(𝐫𝐫)

units of their powers are W

s2=J

s. 

⋅
We further derive the total energy lost by the electron, starting from the time domain and 

⋅

⋅

⋅

converting to the frequency one according to Section 1.7.5 of [56]. Let 

 and 

 be the 

28 

𝐄𝐄(𝐫𝐫, 𝑡𝑡)

𝐇𝐇(𝐫𝐫, 𝑡𝑡)

 
 
 
 
 
electric and the magnetic fields respectively, then the time-domain Poynting vector is defined 

as 

and the total energy gained or lost inside a closed surface 
𝐒𝐒(𝐫𝐫, 𝑡𝑡) ≝ 𝐄𝐄(𝐫𝐫, 𝑡𝑡) × 𝐇𝐇(𝐫𝐫, 𝑡𝑡),

 is 

∞

𝐴𝐴

(S4) 

(S5) 

We use the same symbols for time- and frequency-domain counterparts, but the time argument 

−∞

𝐴𝐴

∆𝐸𝐸 = � d𝑡𝑡 � d𝐀𝐀 ⋅ 𝐒𝐒(𝐫𝐫, 𝑡𝑡)
.

is always explicitly included for the former to avoid confusion. We further change the order of 

integration and apply Eq. (S3) to transit to the frequency domain: 

∞

∞

∆𝐸𝐸 = � d𝐀𝐀 ⋅ � d𝑡𝑡[𝐄𝐄(𝐫𝐫, 𝑡𝑡) × 𝐇𝐇(𝐫𝐫, 𝑡𝑡)]

𝐴𝐴

−∞

∞

=

2
𝜋𝜋

� d𝜔𝜔 � d𝐀𝐀 ⋅
0

𝐴𝐴

∗

Re[𝐄𝐄(𝐫𝐫) × 𝐇𝐇

(𝐫𝐫)]

1
2

(S6) 

where 

 is the power for a time-harmonic field [cf. Eqs. (9), (10)]. Eq. (S6) is the universal 

=

� d𝜔𝜔 𝑊𝑊,
0

2
𝜋𝜋

way to convert time-harmonic powers into the total energy transfers for fields with general 

𝑊𝑊

time dependence, such as the one for a moving electron. 

S3 Electric field derivation 

To calculate the integral defined by Eq. (23), we rewrite it as 

where 

𝐼𝐼1(𝐫𝐫) =

(𝑧𝑧 − 𝑧𝑧0)� � d𝑧𝑧̃
2
. To calculate the remaining integral, denoted as 
+ 𝑧𝑧̃

exp �i

√𝜔𝜔

−∞

2

𝑞𝑞
4𝜋𝜋

𝜔𝜔
𝜐𝜐

∞

2

2

exp �i𝑘𝑘√𝜔𝜔

+ 𝑧𝑧̃

− i

(S7) 

𝜔𝜔
𝑧𝑧̃�
𝜐𝜐
, let us introduce 

,

 such that 

𝑧𝑧̃ ≝ 𝑧𝑧 − 𝑧𝑧′

 and use the identity 

ℝ

sinh 𝑢𝑢 = 𝑧𝑧̃/𝜔𝜔

∞

2
cosh

2
𝑢𝑢 − sinh

: 
𝐼𝐼S(𝜔𝜔)

𝑢𝑢 = 1

𝑢𝑢 ∈

(S8) 

In the case 

𝐼𝐼S(𝜔𝜔) = � d𝑢𝑢 exp �i
−∞

 we use the integral representation for the Hankel function of the first 

(𝛽𝛽h cosh 𝑢𝑢 − sinh 𝑢𝑢)� .

𝜔𝜔𝜔𝜔
𝜐𝜐

kind 

 (Eq. 10.9.15 of [32]) by substituting 

Im 𝛽𝛽h > 0

 (

) and 

, 

and then express it as a modified Bessel function 

𝓏𝓏 = 𝜔𝜔𝜔𝜔𝛽𝛽h 𝜐𝜐⁄

 (Eq. 10.27.8 of [32]): 

Im 𝓏𝓏 > 0

𝜁𝜁 = − 𝜔𝜔𝜔𝜔 𝜐𝜐⁄ ∈ ℝ

(1)

𝐻𝐻0

𝐾𝐾0

where we introduced the transverse wave vector of the electron field 

𝜔𝜔𝜔𝜔
𝜐𝜐
transformation in Eq. (S9) remains valid on the boundary of the first quadrant (for 

− 1� = 2𝐾𝐾0(𝑘𝑘t𝜔𝜔),

𝐼𝐼S(𝜔𝜔) = 𝜋𝜋i𝐻𝐻0

2
�𝛽𝛽h

�

(1)

𝑘𝑘t ≝ 𝜔𝜔 (𝛾𝛾h𝜐𝜐)
⁄

(S9) 

. The last 

), 

specifically, when 

 (but 

), because both 

 (or 

) and the principal branch of 

Im 𝛽𝛽h = 0

𝛽𝛽h ≠ 1
 are continuous with respect to 

𝛽𝛽h > 0

 approaching the boundary from inside the quadrant. 

𝛾𝛾h

𝑘𝑘t

2
�𝛽𝛽h

− 1

𝛽𝛽h

29 

 
 
 
 
 
 
Therefore,  the  validity  of  the  whole  Eq. (S9)  follows  from  the  analytic  continuation  of  the 

integral to the boundary of the quadrant. 

However, for additional rigor, we further separately consider the cases of 

 and 

. In the former case (including the case of vacuum) we introduce 

𝛽𝛽h > 1
Then collecting 

tanh 𝑤𝑤 = 𝛽𝛽h ⇒ sinh 𝑤𝑤 = 𝛽𝛽h𝛾𝛾h, cosh 𝑤𝑤 = 𝛾𝛾h.

 inside the exponent and replacing 

, we obtain 

sinh(𝑢𝑢 − 𝑤𝑤)

∞

𝑢𝑢 − 𝑤𝑤 → 𝑢𝑢

(S11) 

𝐼𝐼S(𝜔𝜔) = � d𝑢𝑢 exp(−i𝑘𝑘t𝜔𝜔 sinh 𝑢𝑢)
where the latter equality follows from Eq. 10.32.6 of  [32]. For the case 

= 2𝐾𝐾0(𝑘𝑘t𝜔𝜔),

−∞

 such that 

𝑤𝑤 ∈ ℝ
Then collecting 

coth 𝑤𝑤 = 𝛽𝛽h ⇒ sinh 𝑤𝑤 = −i𝛾𝛾h, cosh 𝑤𝑤 = −i𝛽𝛽h𝛾𝛾h.

 we obtain similarly to Eq. (S11)  

 such that 
0 < 𝛽𝛽h < 1

𝑤𝑤 ∈ ℝ

(S10) 

 we introduce 

𝛽𝛽h > 1

(S12) 

(S13) 

cosh(𝑢𝑢 − 𝑤𝑤)
∞

(1)

where the integral representation of 

−∞

𝐼𝐼S(𝜔𝜔) = � d𝑢𝑢 exp(−𝑘𝑘t𝜔𝜔 cosh 𝑢𝑢)

= 𝜋𝜋i𝐻𝐻0

(i𝑘𝑘t𝜔𝜔) = 2𝐾𝐾0(𝑘𝑘t𝜔𝜔),

 is based on Eq. 10.9.9 of [32] (since in this case 

). Combining the expression for 

(1)
 with Eq. (S7), we finally obtain: 

𝐻𝐻0
𝐼𝐼S(𝜔𝜔)

0

i𝑘𝑘t >

(S14) 

S4 Ultra-relativistic scaling 

𝐼𝐼1(𝐫𝐫) =

exp �i

𝑞𝑞
2𝜋𝜋

𝜔𝜔
𝜐𝜐

(𝑧𝑧 − 𝑧𝑧0)� 𝐾𝐾0 �

𝜔𝜔𝜔𝜔
𝛾𝛾h𝜐𝜐

�.

Let  us,  first,  discuss  the  behavior  of  the  incident  field  in  the  case 

,  when 

Eq. (25) simplifies into 

𝜔𝜔𝜔𝜔 ≪ |𝛾𝛾h|𝜐𝜐

𝐄𝐄inc(𝐫𝐫) ≈
Here we used Eq. 10.31.1 of [32] and the fact that 

exp �i

(𝑧𝑧 − 𝑧𝑧0)� 

𝑞𝑞
2𝜋𝜋𝜀𝜀h𝜐𝜐

𝜔𝜔
𝜐𝜐

1
2 �
𝜔𝜔

𝑥𝑥 − 𝑥𝑥0
𝑦𝑦 − 𝑦𝑦0
. For moderately fast electrons 
0

�. 

(S15) 

(

, 

) Eq. (S15) is valid whenever 

 is much smaller than the light wavelength in 
– ln 𝜔𝜔 ≪ 1 𝜔𝜔⁄

the medium, i.e. in the classical quasi-static regime (
|𝛾𝛾h| ∼ 1
𝜔𝜔
then we can neglect the remaining exponent as well leading to the field of a wire with static 

 is comparable to 

𝛽𝛽h ∼ 1

). If 

, 

|𝑧𝑧 − 𝑧𝑧0|

𝜔𝜔

current (independent of 

). However, for 

; then Eq. (S15) remains 

𝑘𝑘𝜔𝜔 ≪ 1
 we have 

valid for much larger 

𝜐𝜐 → 𝑐𝑐 𝑚𝑚h⁄
(in  dense  media)  always  leads  to  quasi-static  dependence  of  the  field  versus  transverse 

. In other words, ultrarelativistic electron 

 with extra suppression of 
𝜔𝜔

|𝛾𝛾h| ≫ 1

𝜔𝜔

coordinates. Importantly, this regime shows that 

 is everywhere continuous with respect to 

 (or 

) and have a finite (and simple) limit for 

. However, its derivative with respect 

to 
𝛽𝛽h

 has logarithmic singularity at this point. 
𝑚𝑚h

𝛽𝛽h

𝐸𝐸inc,𝑧𝑧

𝐄𝐄inc
𝛽𝛽h → 1

30 

 
 
 
 
 
The rigorous scaling, described in Section 2.7, breaks down when the new value of 

 is 

larger than 

. More specifically, the general scaling of Eqs. (43), (44) works perfectly well in 

𝜐𝜐

the Cherenkov case, but then none of the two equivalent host media can be a vacuum one (due 

𝑐𝑐
. However, we can try to push it a bit further using the quasi-static limit of Eq. (S15). 

to 

Assuming the exponent to weakly depend on 

𝛽𝛽h > 1)

 (apart from a constant phase factor, which is 

irrelevant for computed probabilities), we obtain: 

𝜐𝜐

Thus, we may use any of the two scaling approaches above, then set 

𝐄𝐄inc → 𝛽𝛽h𝐄𝐄inc,

  𝜐𝜐 → 𝑐𝑐,

𝑃𝑃EELS,CL.

2
𝑃𝑃EELS,CL → 𝛽𝛽h

(S16) 

 (corresponding to 

) in vacuum simulation, and additionally divide the obtained probabilities by 

. Note, 

𝜐𝜐 = 𝑐𝑐

however,  that  this  approximation  does  not  correctly  describe  the  first  order  of  deviation  of 
ℰ ≫ ℰ0
probabilities  when 

  increases  from  1  due  to  logarithmic  singularity  of  the  derivative 

2
𝛽𝛽h

discussed in Section 2.2. 

𝛽𝛽h

S5 Code implementation  

To  perform  EELS  and  CL  simulations  according  to  the  developed  general  theory,  we 

modified the open-source software ADDA.[21] First, we added an option to use the electric field 

of a relativistic electron [Eq. (25)] as the incident field in ADDA. A user has to specify the 

electron kinetic energy in keV and coordinates of the beam (trajectory) center 

 in 

the  laboratory  reference  frame.  If  needed,  propagation  direction  can  be  changed  from  the 

(𝑥𝑥0, 𝑦𝑦0, 𝑧𝑧0)

default one (along the 

-axis). Note, that moving the beam center along the electron trajectory 

(e.g., changing 

 for the default propagation direction) affects only the constant phase factor 

𝑧𝑧

for both incident and total fields, but none of the measurable quantities. ADDA now has an 

𝑧𝑧0

option to specify arbitrary host-medium refractive index 

, although the standard light-

scattering  problem  for  a  particle  in  an  absorbing  host  medium  is  still  a  field  of  active 

𝑚𝑚h ∈ ℂ

research.[28,43,57] 

A  technical  complication  arises  from  the  fact  that  currently  ADDA  is  based  on  the 

Gaussian-CGS system of units in contrast to SI used in this manuscript. Moreover, the unit of 

length is assumed to be nm in contrast to any other electromagnetic excitation (when any unit 

of length can be used as long as it is the same for all input and output quantities).[44] Therefore, 

the incident field given by Eq. (25) is additionally transformed from V∙s/m into statV∙s/cm in 

ADDA, which then  computes  all cross  sections  including 

 [Eq. (38)] in nm2, assuming 

 statV∙s/cm. It further computes 

 and 

 using Eqs. (37) and (41), respectively, 

𝐶𝐶enh

and identity 
𝐸𝐸0 = 1

2
4𝜋𝜋𝜀𝜀0𝐸𝐸0

 J∙s2/m3. 

𝑃𝑃EELS

𝑃𝑃CL

= 0.1

31 

 
Particle  refractive  index 

  (or  its  distribution  inside  the  particle)  depends  on  the 

wavelength 

 corresponding to the desired energy loss 

𝑚𝑚p

. A single run of ADDA performs a 

simulation for a single set of parameters (

𝜆𝜆

, beam position, etc.). To simulate a loss spectrum 

ℏ𝜔𝜔

or to scan a particle’s cross-section with the beam, it is necessary to run ADDA multiple times 

𝜆𝜆

varying the desired parameters. For instance, to simulate the EELS and CL spectra one needs 

to vary 

 and the corresponding 

. We developed a Python wrapper, named ADDAwrapper, 

to automate this process. 

𝜆𝜆

𝑚𝑚p

The wrapper is designed to work as a Python library, so one only has to fill the example 

preset  file  with  the  simulation  parameters,  and  call  high-level  functions  from  this  file  to 

perform the corresponding set of simulations (spectrum, loss probability scan over the cross-

section  of  the  particle,  etc.),  collect  the  data  from  these  simulations,  and  plot  it  in  various 

formats. Multithreading is supported to run several single-thread ADDA runs simultaneously 

on different processor cores. Such use of ADDA in sequential mode is both easier and more 

efficient than the use of the parallel ADDA mode (based on Message Passing Interface), when 

run on a shared-memory machine and memory is not a limiting factor. In this case, the script 

leads to a speedup equal to the number of physical processor cores without any efforts from a 

user. The wrapper is distributed with the ADDA code in the folder /misc/ADDAwrapper.  
ADDA supports different options for computational procedures: polarizability prescription, 

iterative solver, interaction term, etc.[44] An optimal set of these options depends on the specific 

light scattering problems. From our experience, the best speed with satisfactory precision for 

EELS  and  CL  simulations  of  nanoparticles  are  achieved  with  the  following  set  of  options. 

Iterative solver QMR2 (quasi-minimal residual method for complex symmetric matrices based 

on a two-term recurrence) works slightly faster than the default QMR (based on a three-term 

recurrence) for the same precision. Polarizability prescription and interaction term based on 

integration of Green’s tensor (“−pol  igt_so” and “−int  igt_so”, respectively) give 
more  precise  results  than  all  other  options,  and  are  faster  for  particles  with  higher 

surface/volume ratio. Setting the stopping threshold (relative residual) of the iterative solver 

  to 

  (instead  of  the  default  value 

)  by  the  command  line  option  “−eps  2” 
−5
accelerates the simulation several times keeping the satisfactory accuracy (errors due to the 
𝜀𝜀it
iterative solver are about 1%). Such accuracy level is generally acceptable for DDA simulations 

10

10

−2

of  metallic  nanoparticles,  since  improving  it  requires  very  fine  discretization  in  the  first 

place.[52] Apart from multithreading, using the above parameters allows the wrapper to perform 

EELS and CL simulations with ADDA up to an order of magnitude faster than with default 

32 

code settings. The updated code is available at https://github.com/alkichigin/adda and will be 

implemented into official ADDA release soon. 

S6 Additional simulations: cathodoluminescence and transition to 

the Cherenkov case 
CL probabilities simulated in ADDA for different refractive indices of the host medium. 

100 keV e

Ag

100 nm

mh

Fig. S1. CL spectra for a sphere in an infinite non-absorbing host medium simulated with ADDA 

(

 128), either directly or through scaling of simulations in vacuum (the same as Fig. 5, but for CL). The 

problem parameters are shown in the inset. In the host medium with 
𝑛𝑛𝑥𝑥 =

 the electron is faster than light, 

causing the Cherenkov radiation. 

𝑚𝑚h = 2

Next, we study how 

 and 

 deviate from each other when 

 increases over the 

Cherenkov threshold (Fig. S2). First, one can see the inflection at this threshold (

), 

𝑃𝑃EELS

𝑃𝑃ext

𝑚𝑚h

corresponding to the logarithmic singularity of the derivative discussed in Section 2.2. Second, 

𝑚𝑚h = 𝑐𝑐 𝜐𝜐⁄

we have also used the approximate scaling of Eq. (S16). As expected, it gives the wrong value 

of derivative near the inflection point. But, surprisingly, it describes the general trend of 

for  larger  values  of 

.  This  partly  explains  the 
𝑃𝑃EELS
satisfactory performance of this scaling in Fig. 5 and Fig. S1. The specific reasons for that are 

,  which  is  very  different  from  that  of 

𝑃𝑃ext

𝑚𝑚h

still not clear. 

33 

 
 
Fig. S2. EELS and extinction probabilities of 2.0 eV energy loss simulated with the DDA (

 32) for 

different host-medium refractive indices. The parameters of the problem are the same as in Fig. S1. 

𝑛𝑛𝑥𝑥 =

The  following  figures  show  the  comparison  of  CL  results  computed  with  ADDA,  the 

Lorenz–Mie theory, and MNPBEM in different host media. All three methods agree for the 

case of vacuum (Fig. S3), but for 

 only ADDA and Lorenz–Mie theory agree (as in 

Fig. S1), while MNPBEM results are markedly different. We have, however, took the liberty 

𝑚𝑚h = 1.5

to multiply the latter by 

; this restores the agreement. We have not investigated this issue in 

details, but the error may be due to the fact that the BEM calculates 

 through a far-field 

𝑚𝑚h
 in ADDA), which implicitly depends on the definition of 

integral (similar to 

𝑃𝑃CL

 containing 

  [Eq. (19)].  Practically,  this  difference  is  not  important  since  all  CL  measurements  are 

𝐶𝐶sca

𝐼𝐼0

performed in arbitrary (relative) units. Still, the definition of 
𝑚𝑚h
since, e.g., it guarantees that 

 for the case when both a particle and a host medium 

𝑃𝑃CL

 by Eq. (42) is the correct one, 

are non-absorbing (and 

). 

𝑃𝑃CL = 𝑃𝑃EELS

𝛽𝛽h < 1

34 

 
Fig. S3. CL spectra simulated with the Lorenz-Mie theory, ADDA (

 128 with the extrapolation), and 

the BEM (the same as Fig. 6, but for CL). The parameters of the problem are shown in the inset. 

𝑛𝑛𝑥𝑥 =

100 keV e

Ag

100 nm

mh=1.5

Fig. S4. CL spectra simulated with the Lorenz-Mie theory (using scaling), ADDA (

 128 with the 

extrapolation), and the BEM (the same as Fig. 7, but for CL). The corrected BEM results are obtained 

𝑛𝑛𝑥𝑥 =

multiplying by 

. The parameters of the problem are shown in the inset. 

Similar scaling issue can be seen for the Cherenkov case (

𝑚𝑚ℎ

) in Fig. S5, but here we 

additionally depict 

, defined by Eq. (41). Apart from the overall magnitude, it has certain 

𝑚𝑚h = 2

qualitative difference from 

tot
𝑃𝑃CL

𝑃𝑃CL

. For instance, the peak around 2.5 eV has almost disappeared. 

35 

 
 
100 keV e

Ag

100 nm

mh=2

Fig. S5. CL probability simulated with the DDA (

 128 with the extrapolation) and the BEM (the same 

as Fig. 8, but for CL). For the DDA both 

 and 

 are shown, the corrected BEM results are obtained 

. The parameters of the problem are shown in the inset. 

𝑃𝑃CL

𝑛𝑛𝑥𝑥 =
tot
𝑃𝑃CL

multiplying by 

𝑚𝑚ℎ

36 

 
 
