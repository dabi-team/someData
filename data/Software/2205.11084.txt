Cophylogeny Reconstruction Allowing for Multiple
Associations Through Approximate Bayesian
Computation

Blerina Sinaimeri1,2,†, Laura Urbini2,†, Marie-France Sagot2 and
Catherine Matias3
1 LUISS University, Rome, Italy
2 Inria Lyon, 56 Bd Niels Bohr, 69100 Villeurbanne, France, and Universit´e de Lyon,
F-69000, Lyon; Universit´e Lyon 1; CNRS, UMR5558; 43 Boulevard du 11 Novembre 1918,
69622 Villeurbanne cedex, France
3 Sorbonne Universit´e, Universit´e de Paris Cit´e, Centre National de la Recherche
Scientiﬁque, Laboratoire de Probabilit´es, Statistique et Mod´elisation, Paris, France

Corresponding author: Blerina Sinaimeri, LUISS University, Rome, Italy; E-mail:
bsinaimeri@luiss.it.

Abstract

Nowadays, the most used method in studies of the coevolution of hosts and
symbionts is phylogenetic tree reconciliation. A crucial issue in this method is
that from a biological point of view, reasonable cost values for an event-based
parsimonious reconciliation are not easily chosen. Diﬀerent approaches have been
developed (Alcala et al., 2017; Baudet et al., 2015; Sz¨oll˝osi et al., 2013) to infer
such cost values for a given pair of host and symbiont trees. However, a major
limitation of these approaches is their inability to model the invasion of diﬀerent
host species by the same symbiont species (referred to as a spread event), which
is thought to happen in symbiotic relations. To mention one example, the same
species of insects may pollinate diﬀerent species of plants (see the example of
wasps and ﬁgs in Silvieus et al., 2008). This results in multiple associations
observed between the symbionts and their hosts (meaning that a symbiont is no
longer speciﬁc to a host), that are not compatible with the current methods of
coevolution.

In this paper, we propose a method, called AmoCoala (a more realistic ver-
sion of a previous tool called Coala) which for a given pair of host and symbiont
trees, estimates the probabilities of the cophylogeny events, in presence of spread
events, relying on an approximate Bayesian computation (ABC) approach.

The algorithm that we propose, by including spread events, enables the mul-
tiple associations to be taken into account in a more accurate way, inducing
more conﬁdence in the estimated sets of costs and thus in the reconciliation of
a given pair of host and symbiont trees. Its rooting in the tool Coala allows it
to estimate the probabilities of the events even in the case of large datasets. We
evaluate our method on synthetic and real datasets. The software is available
at https://sites.google.com/view/blerinasinaimeri/software/amocoala
reconciliation, cophylogeny, ABC method, spread.

†First co-authors.

2
2
0
2

t
c
O
3
1

]

M
Q
.
o
i
b
-
q
[

2
v
4
8
0
1
1
.
5
0
2
2
:
v
i
X
r
a

 
 
 
 
 
 
Cophylogeny allowing for multiple associations

1

Introduction

A powerful framework for modelling host-symbiont coevolution is provided by co-
phylogeny, a method which allows to infer combined evolutionary scenarios for a pair
of phylogenetic trees of hosts and symbionts. In the following, we refer to symbionts in
a wide sense: an organism living in symbiosis, which is not necessarily detrimental nor
beneﬁcial to any of the organisms. The cophylogeny problem is usually envisioned as a
problem of mapping the phylogenetic tree of the symbionts into the one of the hosts (see
e.g. Charleston, 2003; Merkle and Middendorf, 2005; Page, 1994; Donati et al., 2015).
Such mapping, called a reconciliation, allows the identiﬁcation of (up to) four types of
biological events: (a) cospeciation, when the symbiont diverges in correspondence to
the divergence of a host species; (b) duplication, when the symbiont diverges but not
the host; (c) host switch, when a symbiont switches from one host species to another
independently of any host divergence; and (d) loss, which can describe for instance
speciation of the host species independently of the symbiont, which then follows just
one of the new host species.

The reconciliation method is abstract enough that it may actually be applied to
diﬀerent types of data, of which a common one is gene-species associations (Bansal
et al., 2012; Doyon et al., 2011; Hallett and Lagergren, 2001; Stolzer et al., 2012;
In fact, the trees that are compared do not even need to be
Toﬁgh et al., 2011).
representations of phylogenies. For instance in Becerra (1997), the phylogenetic tree of
the beetle genus Blepharida is compared to a tree of the host plants (genus Bursera)
whose construction is based on chemical similarity. Such generality may be seen as an
advantage since the methods developed for host-symbiont associations (Conow et al.,
2010; Merkle et al., 2010; Baudet et al., 2015; Donati et al., 2015) could be applicable
to other situations (such as the gene-species context). However, this also shows that
these models do not fully capture the speciﬁcity of the host-symbiont context. Among
the most important aspects that have been only partially addressed is the fact that the
same symbiotic species can interact, and therefore be associated with more than one
host species; we refer to this as a multiple association. This is in sharp contrast with
the gene-species context where a gene (sequence) is naturally associated to only one
species (the one it is extracted from) (Stolzer et al., 2012; Bansal et al., 2018). We refer
to the recent review by Libeskind-Hadas (2022) focusing on the theory of reconciliation
in the context of host-symbiont cophylogenetics.

In host-symbiont systems, a multiple association can result from a combination of
biologically diﬀerent situations. Following Banks and Paterson (2005), such association
can indeed be explained by: (i) cryptic symbiont species (that is, diﬀerent symbiont
species that are morphologically indistinguishable); (ii) misclassiﬁed (over-split) hosts
(if the apparently diﬀerent host species to which the symbiont is related represent in
fact a same single species); (iii) recent host switches (when the symbiont has recently
colonised a new host species and in the newly established population, there is very
limited genetic diversity compared to the original symbiont population); (iv) failure
to speciate by the symbiont population despite the fact that the host diverged (which
might happen if the symbiont populations maintain genetic contact despite the host

2

Cophylogeny allowing for multiple associations

speciation); and (v) incomplete host switching (if a symbiont colonised a sister taxon
of its original host, and maintained genetic contact with the source population).

While in the cases (i)-(ii) the multiple associations are due to errors in deﬁning
the real input, in the cases (iii)-(v) those are caused by the ability of the symbiont
to be associated to more than one host species and hence require the introduction of
an additional biological event that has been called spread in the literature. The ﬁrst
use of such term seems to be in Brooks and McLennan (1991). Several methods in the
literature deal with multiple associations in a more or less ad-hoc way but to the best of
our knowledge none of them fully considers spread events. As multiple associations can
be caused by spread events, any method that deals with multiple associations without
considering spread events is not satisfying. Below, we brieﬂy review the state of the
art of cophylogenetic methods that consider multiple associations.

The methods presented in the literature on host and symbiont trees reconciliation
can be divided into two main groups: parsimony methods and statistical methods of
inference. The ﬁrst group is based on an optimisation problem where, given a cost for
each of the events, an optimal reconciliation is found by minimising its total cost. An
advantage of parsimony methods is that they allow not only to estimate the frequencies
of each of the events but also to infer the past associations. However, a major problem
with these methods is that the solutions obtained are strongly dependent on the costs
that have to be chosen a priori. Indeed, costs are inversely proportional to the obtained
frequencies: the larger an event cost, the smaller the corresponding frequency of this
event. Statistical approaches can then be used in addition to or as an alternative as they
remove the subjective step of cost parameter choice and rely instead on a simultaneous
inference of parameter values (i.e. event probabilities) and events.

To the best of our knowledge, the parsimony-based methods that address multi-
ple associations are the following: TreeFitter (Ronquist, 2003), CoRe-Pa (Merkle
et al., 2010), Jane 4 (Conow et al., 2010) and WiSPA (unpublished, see Drinkwater
et al. (2016)). The tool TreeFitter (Ronquist, 2003) treats each multiply associated
symbiont as “an unresolved clade consisting of one lineage for each host in its reper-
toire. The ancestral host of this terminal clade can then be determined according to
one of three separate methods: the ancient, recent and free options (Sanmart´ın and
Ronquist, 2002).” CoRe-Pa (Merkle et al., 2010) deals only with the case of cryptic
species and solves the multiple associations locally in a parsimonious way. In Jane
4 (Conow et al., 2010) and WiSPA (Drinkwater et al., 2016), only parasite tips are
permitted to fail to diverge (case (iv) above).

For what concerns the statistical approaches, only Alcala et al. (2017) proposed
a method of inference addressing multiple associations. The authors develop an ap-
proximate Bayesian computation (ABC) method to infer the rates of only two events:
host switch and cospeciation. Their approach is diﬀerent from the current literature
on tree reconciliation in many ways. First, their method relies on symbiont genomic
sequences to produce sets of dated phylogenies instead of relying on a single sym-
biont tree. Moreover, they pre-estimate extinction and speciation rates from the set
of reconstructed symbiont phylogenies. As cospeciation occurs independently from the
speciation process in their cophylogeny model, one might expect that the symbiont

3

Cophylogeny allowing for multiple associations

trees obtained with this method exhibit more speciations than expected. Finally, their
method outputs only a host-shift rate and a cospeciation probability but no quantiﬁ-
cation of duplication or loss events. Note that a very recent work addresses multiple
associations in host-parasite systems, by modelling host repertoire evolution along the
branches of a parasite tree (Braga et al., 2020). However, this method is far from the
reconciliation approach and uses the host tree only through host pairwise distances.

In this paper, we introduce spread as a ﬁfth event in the method called Coala
(for COevolution Assessment by a Likelihood-free Approach) originally proposed in
Baudet et al. (2015) which to our knowledge was the ﬁrst method to rely on ABC
in the context of tree reconciliation. Coala infers a probability for each of the four
cophylogeny events: cospeciation, duplication, host switch and loss but requires that
the input has no multiple association. Introducing a spread event is a challenge and
there is yet no canonical way to do this.

We choose to introduce two kinds of spread events, called vertical and horizontal
spreads respectively.
In this way, we capture the two diﬀerent situations occurring
in the cases (iii)-(v) above. The ﬁrst event, called vertical spread, corresponds to a
spread of a symbiont in the entire subtree below a host species. This event could also
be called a freeze in the sense that the evolution of the symbiont freezes while the
symbiont continues to be associated with a host and with the new species that descend
from this host. As will be further detailed in Section Model and Method, this event
covers case (iv) above and is related to what is known in the literature as failure to
diverge (see for example Conow et al. (2010)). This also corresponds to the speciation
as a generalist introduced in Alcala et al. (2017). The second event, called horizontal
spread, informally corresponds to the combination of a “host switch” with 2 diﬀerent
vertical spreads, one occurring in the initial host subtree and the second in the new host
subtree. Thus, this horizontal spread event includes both an invasion of the symbiont
which remains with the initial host but at the same time gets associated with (invades)
another host that is not a descendant of the ﬁrst, plus a freeze, actually a double freeze
as the evolution of the symbiont freezes in relation to the evolution of the host to
which it was initially associated and to the evolution of the second host it invaded.
This event is useful to describe the cases (iii) and (v) from above. It allows to explain
the case where two host clades that are phylogenetically distant are associated with the
same symbiont species. Notice that a fundamental diﬀerence between host switch and
horizontal spread is that in the former, the symbiont that switches hosts will further
create 2 diﬀerent symbionts, each one associated to the initial and to the new host
respectively. In particular, a host switch never induces a multiple association, in sharp
contrast with a horizontal spread. Notice also that cases (i) and (ii) above correspond
to input errors rather than real biological events. Nonetheless, these situations are
dealt with by our model. Indeed, case (i) is considered as a horizontal spread while
case (ii) counts as a vertical spread. Our goal here is not to correct for these potential
input errors but to provide a comprehensive framework that handles the diversity of
biological situations.

In this paper, we propose a method, called AmoCoala, which for a given pair of
host and symbiont trees, ﬁrst pre-estimates the probabilities of spread events directly

4

Cophylogeny allowing for multiple associations

from the input (relying on heuristic frequencies estimates) and second estimates the
probabilities of the remaining four classical cophylogeny events, relying on an ABC
approach. In doing so, we also deﬁne a new distance to compare two symbiont trees
that are associated with the same host tree in presence of multiple associations. In-
deed, ABC methods heavily rely on the ability to compare observations with simulated
datasets. In the cophylogeny context, this means comparing trees (as these are the
most complete information on the data), a task that is far from trivial. Our new dis-
tance is an extension of the classical Maximum Agreement Subtree distance (MAS )
(Ganapathy et al., 2005) to what we call set-labelled trees. We believe this new distance
can be of independent interest (see Section Model and Method and also Section B.3 in
the Supplementary Material).

We test AmoCoala on both synthetic and real datasets and compare the results
with Coala. We could not compare our approach with the tool Alcala et al. (2017)
due to the, previously described, substantial diﬀerences both in the model and in the
input. Our tests show that AmoCoala produces results that seem closer than those
of Coala to what is expected from the judgment of a biological expert.
2 Model and method

2.1 Reconciliations and cophylogeny events

Similarly to Coala, AmoCoala is built on the event-based model presented in
Charleston (2002); Toﬁgh et al. (2011). The input of AmoCoala consists of a triple
(H, S, φ) where H and S correspond to the phylogenetic trees of the hosts and sym-
bionts, respectively, and φ is a relation from the leaves of the symbiont tree L(S) to the
leaves of the host tree L(H). The relation φ describes the existing associations between
currently living symbiont species and their hosts. More precisely, φ is a function from
the set of symbiont leaves to the set of all subsets of host leaves. Notice that a multiple
association will correspond to a leaf in the symbiont tree that is associated to more
than one leaf in the host tree. The number of multiple associations is computed as the
total number of those supernumerary leaf associations (e.g. a symbiont leaf associated
to 2 diﬀerent host leaves amounts to 1 multiple association). In Coala, as well as in
all the models that do not allow for multiple associations, the relation φ assigns to each
s ∈ L(S) exactly one host leaf in L(H) (notice however that one host can be associated
to more than one symbiont). In AmoCoala, this constraint will be dropped and thus
we have that each leaf s ∈ L(S) in the symbiont tree is associated to φ(s), a subset of
L(H).

A reconciliation λ is a function from the vertices of the symbiont species tree to
the set of all subsets of vertices of the host tree that is an extension of φ, i.e. that is
the same function as φ when restricted to the sets of leaves. In the classical setting, a
reconciliation can be associated to a set of cospeciations, duplications, host switches and
losses (the four classical cophylogeny events). For more details about the reconciliation
model, we refer to Charleston (2002); Toﬁgh et al. (2011); Stolzer et al. (2012); Donati
et al. (2015); Baudet et al. (2015) and Section A.2 in our Supplementary Material.
In this paper, we extend the classical reconciliation model to include other biological

5

Cophylogeny allowing for multiple associations

events.

Finally notice that here we focus on models that do not require the host tree to be
dated. This is a clear advantage of the method as this information is rarely available
and when it is available, is often not reliable. However, as we do not require the host
tree to be dated some combinations of host switches can introduce an incompatibility
due to the temporal constraints imposed by the host and symbiont trees, as well as
by the reconciliation itself. We say that a reconciliation is time-feasible if it does
not violate the time-feasibility constraints. The exact criterion we use to assess time-
feasibility is the one deﬁned in Stolzer et al. (2012) and that was already the one used
in Coala.
Spread events.
vertical and horizontal spreads. We now deﬁne and illustrate both of them.

In AmoCoala, we introduce two new additional cophylogeny events:

Vertical Spread. When for a symbiont s and with probability pvs(h), a vertical
spread happens at a host h, the evolution of the symbiont s freezes in h, i.e. s continues
to be associated with h and with the new species that descend from h.
In the toy
example depicted in Figure 1(a), we see that the symbionts s1, s2 are both related to
all the hosts h3, h4, h5. One possible explanation is that the symbiont s5 (the most
recent common ancestor of s1, s2) was present in all the clade of h8 (which is the most
recent common ancestor of h3, h4, h5). In that case, we say that h8 is the ancestral host
of s5 and the two clades Ss5 (which denotes the symbiont clade rooted in s5) and Hh8
(the host clade rooted in h8) are related. We say that a vertical spread has happened
at symbiont s5 and we associate s5 with all the vertices in the subtree rooted in h8 (see
Figure 1(b)).

(a)

(b)

Figure 1:
(a) Example of a dataset with multiple associations. The leaf associ-
ations are represented by plain lines and given by φ(s1) = {h3, h4, h5}; φ(s2) =
{h3, h4, h5}; φ(s3) = {h2}; φ(s4) = {h1}. (b) In dotted lines, a reconciliation involving 2
cospeciations in s and s6 and 1 vertical spread in s5. More precisely, the reconciliation
is given by λ(s) = {h}; λ(s6) = {h6} and λ(s5) = {h3, h4, h5, h7, h8} (on the symbiont
leaves, we have λ = φ).

Horizontal Spread. In some datasets, we see the occurrence of the same symbiont in
two diﬀerent clades of the host tree. Such a situation cannot occur when relying only on
cospeciation, duplication, loss, host switch or vertical spread events. Indeed, as already

6

Vertical spread 1HostSymbionts1s2s5sh2h3s3h4h6hh1h7h5h8s4s6Vertical spread 2HostSymbionts1s2s5sh2h3s3h4h6hh1h7h5h8s4s6Cophylogeny allowing for multiple associations

underlined, the four initial events never produce multiple associations, while the vertical
spread produces them only within clades. For this reason, we introduce a horizontal
spread event. In the horizontal spread event, the symbiont remains with the initial host
but at the same time gets associated with (invades) another host incomparable with the
ﬁrst, and undergoes a freeze, actually a double freeze as the evolution of the symbiont
freezes in relation to the evolution of the host to which it was initially associated and
in relation to the evolution of the second one it invaded. A horizontal spread event
involves two probabilities: the probability phs(h) that the horizontal spread occurs at
node h of the host tree, and for any other host node h(cid:48) that is incomparable to h, a
probability pjump(h → h(cid:48)) (symmetric wrt h, h(cid:48)) that the symbiont jumps from host h
to host h(cid:48) (and then freezes both under h and h(cid:48)). In fact, phs(h) is deduced from the
values {pvs(h), pvs(h(cid:48)), pjump(h → h(cid:48))}h(cid:48) for all h(cid:48) incomparable to h (details are given
in Section A.4 from the Supplementary Material). For illustrative purposes only, we
show in Figure 2 an example of a reconciliation involving a horizontal spread event.
The horizontal spread event happens in vertex s5 as it is associated to two subtrees of
the host tree, rooted in h6 and h7, respectively.

(a)

(b)

Figure 2:
(a) Example of a dataset with multiple associations. The leaf associ-
ations are represented by plain lines and given by φ(s1) = {h2, h4, h5}; φ(s2) =
{h1, h2, h4}; φ(s3) = {h3}; φ(s4) = {h1}. (b) In dotted lines, a reconciliation involving
a horizontal spread event is shown. The symbiont s5 makes a horizontal spread from
h6 to h7 (or from h7 to h6) and thus is associated to the two subtrees Hh6 and Hh7 (i.e.
λ(s5) = Hh6 ∪ Hh7). The symbiont s is associated to a duplication (and λ(s) = {h})
and the symbiont s6 to a cospeciation (and λ(s6) = {h}).

2.2 General framework of AmoCoala

The method we propose is based on the approximate Bayesian computation (ABC)
method that was already used in Coala (Baudet et al., 2015). We brieﬂy recall it
here for the sake of completeness. ABC methods belong to a family of likelihood-free
Bayesian inference algorithms that attempt to estimate posterior densities for problems
where the likelihood is unknown or may not be easily computed. ABC only requires
that simulations under the statistical model at stake are possible. We recall that the

7

HostSymbionts1s2s5sh2h3s3h4h6hh1h7h5h8s4s6Horizontal spread 1HostSymbionts1s2s5sh2h3s3h4h6hh1h7h5h8s4s6Horizontal spread 2Cophylogeny allowing for multiple associations

likelihood function expresses the probability of the observed data under a particular
statistical model. More speciﬁcally, given a set of observed data D0 (in our case the
input (H, S, φ)) and starting with a prior distribution π on the space of the parameters
of the model (here, the probabilities of the four classical cophylogeny events), the
objective is to estimate the parameter values θ that could lead to the observed data
using a Bayesian framework. Formally, we are interested in the posterior distribution
p(θ|D0) = p(D0|θ)π(θ)/p(D0).

For simple models, the likelihood function p(D0|θ) can typically be derived. How-
ever, for more complex models the likelihood function might be computationally very
costly to evaluate. In these cases, ABC methods approximate the posterior distribution
by simulations, the outcomes of which are compared with the observed data. First,
a population of N parameter values θi is sampled from the prior distribution. Then,
for each sampled parameter θ, a dataset ˜Dθ is simulated. It consists of a simulated
symbiont tree ˜Sθ together with a reconciliation ˜λ from ˜Sθ to H. This dataset ˜Dθ is
then compared with the real dataset D0 through a summary measure which is used
In many
as a quality measure to accept or reject the candidate parameter value θ.
cases when it is believed that the prior and posterior densities are very diﬀerent, the
acceptance rate is very low. To deal with that issue, we can rely more speciﬁcally on
a likelihood-free Sequential Monte Carlo (SMC) search that involves many iterations
of the simulation procedure, each iteration targeting more precisely good candidate
parameter values.

Given an input dataset (H, S, φ), an ABC-SMC method was developed in Coala
(Baudet et al., 2015) to infer the posterior density of the probability of each of the
four classical events, namely cospeciation, duplication, host switch and loss. Coala
includes two main parts. The ﬁrst consists in a simulation algorithm of the coevolu-
tionary history of symbionts and their hosts. More speciﬁcally, given the host tree H
and a vector θ = (cid:104)pc, pd, ps, pl(cid:105) specifying the probability of each of the classical cophy-
logeny events, the model generates a symbiont tree ˜Sθ together with a reconciliation
from ˜Sθ to H describing the ancient host-symbiont associations. In AmoCoala, this
ﬁrst part is improved by introducing spread events whose probabilities of occurrence are
ﬁxed throughout all the simulations, while being heterogeneous along the host tree and
speciﬁc to the original dataset. More precisely, these probabilities are pre-estimated
on each dataset through simple frequency estimates related to the symbiont and host
associations. Their values are speciﬁc to each node h of the host tree. The second part
concerns a method to select the most likely probability vectors based on an ABC-SMC
variant. It relies on the main idea that the most likely vectors θ will generate trees
˜Sθ together with reconciliations ˜λθ from ˜Sθ to H that are similar to the original input
(H, S, φ).

In Coala, the symbiont trees together with their leaf associations were summarised
through labelled trees and this step thus relied on a phylogenetic distance between
In AmoCoala, this part is improved by the introduction of a new
labelled trees.
distance that accounts for the possibility of multiple associations between ˜Sθ and H.
Indeed, the symbiont trees together with their leaf association may now be summarised
through set-labelled trees (i.e. trees with leaves labelled by subsets of L(H)). We thus

8

Cophylogeny allowing for multiple associations

provide and rely here on a new phylogenetic distance metric, called dM AS between set-
labelled trees. To the best of our knowledge, distances between set-labelled trees have
not been considered in the literature and our proposal for such may be of independent
interest.

In a nutshell, to deal with multiple associations coming from spread events, we thus
extend Coala as follows: (i) we ﬁrst propose estimators pspread for all the probabilities
needed to deﬁne spreads (namely, vertical spreads pvs(h), jumps pjump(h → h(cid:48)) and
horizontal spreads phs(h) probabilities) given the input (H, S, φ); (ii) we introduce a
new method to simulate the cophylogeny of the symbiont tree, along the host tree
and given a candidate probability for each of the four classical cophylogeny events
(cospeciation, duplication, host switch and loss) which also takes into account the
probabilities of vertical and horizontal spread; (iii) we introduce a new distance to
compare the simulated to the real symbiont trees in presence of multiple associations
to the host tree.
2.3 Estimation of the probabilities of the events

In AmoCoala, the probabilities (cid:104)pc, pd, ps, pl(cid:105) of the four classical cophylogeny
events (cospeciation, duplication, host switch and loss) are parameters inferred relying
on the ABC-SMC approach, namely they are ﬁrst sampled from a prior distribution
and then later selected according to some criteria that are speciﬁed later. On the
contrary, the probabilities pvs(h) and phs(h) for the (vertical and horizontal)
spread events at each host node h are not estimated within the ABC-SMC
method but rather in a preliminary step, directly from the input. This
choice is mainly driven by the fact that in a realistic model the spread probabilities
are not constant throughout the host tree. For instance, a spread event appearing
near to the root is less likely to happen than one close to the leaves. Indeed, spread
events were introduced partly to account for recent host switches (see point (iii) in the
introduction) and more generally they are motivated by the fact that symbionts may
not diversify immediately, which is less likely close to the root. Then, as the probability
of a spread event is speciﬁc to each vertex of the host tree, sampling the spread events
will increase signiﬁcantly the size of the parameter space and thus the size of the space
of the generated symbiont trees. Hence, in this framework the spread probabilities
cannot be inferred in the ABC procedure. Nevertheless, these probabilities are clearly
related to the shape of the host and symbiont trees and to the associations between
their leaves. For this reason, we exploit the signal from the input to pre-estimate the
probabilities of the spread events. These probabilities are used in the generation of the
putative symbiont trees and are not inferred through the ABC-SMC method. Details
about these estimators as well as an assessment of the robustness of the ABC method
with respect to these pre-estimated values are given in Sections A.4 and D.3 from the
Supplementary Material, respectively.
2.4 Simulation of a symbiont tree in AmoCoala

We now describe the procedure of generation of simulated symbiont trees in Amo-
Coala. Similarly to Coala, our algorithm takes as input (H, S, φ) and the probabil-

9

Cophylogeny allowing for multiple associations

ities of each of the events, and simulates the evolution of the symbionts by following
the evolution of the hosts, i.e. by traversing H from the root to the leaves, and pro-
gressively constructing the phylogenetic tree ˜S for the symbionts and at the same time
mapping them to subsets of vertices of the host tree, i.e. constructing ˜λ.
In this
process, a symbiont vertex can be in two diﬀerent states: mapped or unmapped. At
the moment of its creation, a new vertex ˜s is unmapped and is assigned a temporary
position on an arc a of the host tree H. We denote this situation by (cid:104)˜s : a(cid:105). We let
h(a) denote the head of the arc a (i.e. the vertex at the endpoint of a that is farthest
from the root). Then vertex ˜s is mapped to either vertex h(a) of H (i.e. ˜λ(˜s) = {h(a)}
for cospeciation, duplication and host switch) or to a subset H of vertices of H (i.e.
˜λ(˜s) = H for vertical and horizontal spread). Notice that for the vertical spread, the
subset of vertices H corresponds to a clade in H, while for the horizontal spread it
corresponds to the union of two clades in H.

In the cases of cospeciation, duplication, and host switch, a speciation has occurred
in the symbiont tree and hence two children are created for ˜S, denoted by ˜s1 and ˜s2.
Their positioning along the arcs of the host then depends on which of the three events
took place. In the case of a loss, no child for ˜S is created (at this step) since there is
no symbiont speciation, and ˜S is just moved to one of the two arcs outgoing from h(a)
chosen randomly.

The case of a spread event is diﬀerent. Consider for instance the example in Figure 3.
A vertical spread occurs at the symbiont s6 on the host h8 and thus s6 is associated
to all the subtree Hh8 (the host clade rooted in h8). Moreover, we choose that all the
symbionts descendent from s6 are associated to the same clade as s6 (see Deﬁnition A.2
in the Supplementary Material). We now need to choose a realistic way of continuing
the simulation of the symbiont subtree below s6. We call the subtree of the symbiont
tree rooted at a vertex associated to a spread event (vertical or horizontal) a ghost
subtree. In Figure 3, the subtree Ss6 is a ghost subtree. Then during the generation of
the symbiont tree ˜S when a symbiont ˜s undergoes a spread event, we need to simulate
the ghost subtree rooted in ˜s up to its leaves, in order to end the simulation in this
part of the tree. After a spread event, with the passing of time, both the host and
the symbiont have evolved and in addition, it could be that some hosts have lost some
of their symbionts. Taking into account all the possible evolutions of the symbiont
is computationally unfeasible in practice. Therefore, for computational reasons, we
decide to promote the simplest situation.
In particular, no other event takes place
after a spread event and we mimic in this part of the simulated symbiont tree the
evolution occurring in the real symbiont tree. Therefore we choose a topology and leaf
associations that are identical to those present in S. More formally, if a vertical spread
occurs at ˜s on the host h, we consider the set of host leaves descendent from h, namely
L = L(Hh). Let L(cid:48) be the set of symbiont leaves that are associated to the leaves in L,
i.e. L(cid:48) = φ−1(L) ∩ L(S). The ghost subtree ˜S˜s is then set equal to S|L(cid:48), the subtree of
the real symbiont tree induced by leaves L(cid:48). The case of horizontal spread is analogous,
except that the set of leaves L is given by the union of L(Hh) and L(Hh(cid:48)) where h, h(cid:48)
are the two host vertices involved in the horizontal spread. Once the ghost tree is set,
the simulation ends in this part of the tree. Notice that as already mentioned, the

10

Cophylogeny allowing for multiple associations

spread events are more likely to occur far from the root, so that the loss of variability
in the simulated tree ˜S induced by this choice is counterbalanced by the fact that it
should aﬀect a small part of the tree. More details are given in Section B.1 from the
Supplementary Material.

Figure 3: The symbiont s6 is associated to a vertical spread on the host h8 and thus is
associated to all the subtree Hh8. As we do not know exactly how the symbiont s5 is
associated, we symbolically associate it to all the vertices in Hh8. The subtree of S in
bold corresponds to a ghost subtree.

The symbiont tree simulation algorithm is summarised in Algorithm 1. It relies on
the following notation. A generic arc from the host tree H is denoted by a, its outgoing
arcs are a1, a2 and its head (end node farthest from the root) is h(a). L(T ) is the set
of leaves of T , while the subtree of T rooted at node h is denoted by Th. Finally, for
any set of leaves L, we let T|L denote the subtree of T whose set of leaves is exactly
L. This T|L is also the subtree of T rooted at the most recent common ancestor of the
elements in L. During the algorithm, before deﬁning the simulated association ˜λ(˜s) of
a simulated symbiont node ˜s, the node is temporarily positioned on an arc a, which is
denoted by (cid:104)˜s : a(cid:105).

Finally, Figures 4 to 7 illustrate the diﬀerent steps of the symbiont tree generation

procedure.

Figure 4: Simulation algorithm. (a) Starting conﬁguration. (b) Unmapped vertex ˜s.

11

HostSymbionts1s2s5sh2h3s3h4h6hh1h7h5h8s4s6ϕ(s1)={h3,h4,h5}ϕ(s2)={h3,h4,h5}ϕ(s3)={h3,h4,h5}ϕ(s4)={h1,h2}λ(s6)={h3,h4,h5,h7,h8}Ghost Treeρ(ρ,Hroot)˜SrootHrootaa1˜sh(a)a2<˜s:a>h(a)˜s[˜s:Hh(a)]Hh(a)aSh(a)Hh(a)as=lca(ϕ−1(L))S|ϕ−1(L)L=L(Hh(a))Hh(a)˜s[˜s:Hh(a)]Hh(a)aS|ϕ−1(L)h(a)˜s<˜s:a>Hh(a)a(a) (b) (a) (b) (c) (d) Cophylogeny allowing for multiple associations

Algorithm 1 Generation of a symbiont tree under model allowing for spreads
1: Input: (H, S, φ) and parameter vector (cid:104)pspread, θ(cid:105)
2: Create the root vertex ˜sroot and position it on the arc a before the root of H:

(cid:104)˜sroot : a(cid:105)

for all ˜s ∈ U with position (cid:104)˜s : a(cid:105) do

3: Add ˜sroot to the set U of unmapped nodes of ˜S
4: while U not empty do
5:
6:
7:
8:
9:
10:
11:

if h(a) is a leaf of H then remove ˜s from U and go to line 4
end if
Horizontal spread: Sample HS ∼ Bern(phs(h(a))
if HS = 1 then

if no vertex h(cid:48) is incomparable to h(a) then go to line 14
else sample with probability pjump(h(a) → h(cid:48)) a vertex h(cid:48) incomparable

to h(a), map ˜λ(˜s) = Hh(a) ∪ Hh(cid:48) and go to line 32

12:
13:
14:
15:

16:
17:

18:
19:
20:

21:

end if

end if
Vertical spread: Sample V S ∼ Bern(pvs(h(a))
if V S = 1 then map ˜λ(˜s) = Hh(a). Let L = L(Hh(a)) and L(cid:48) = φ−1(L) ∩
L(S). Paste S|L(cid:48) in ˜S below ˜s; for all s(cid:48) ∈ S˜s, map ˜λ(s(cid:48)) = Hh(a) and go to line 32

end if
Classical event:

Sample E ∼ M(1, θ) multinomial event among

{C, D, S, L}

if E ∈ {C, D, S} then map ˜λ(˜s) = {h(a)} and create ˜s1, ˜s2 children of ˜s
end if
if E = C (cospeciation) then position (cid:104)˜s1 : a1(cid:105) and (cid:104)˜s2 : a2(cid:105) and go to

line 31

end if

Figure 5: Simulation of a horizontal spread. (a) Initial conﬁguration. (b) Mapping of
vertex ˜s: we let ˜λ(˜s) = Hh(a) ∪ Hh(a(cid:48)). (c) Looking in the real symbiont tree for the
ghost subtree to be used in the next step. (d) Creating the ghost subtree in ˜s and
stopping the evolution of the leaves of ˜S˜s.

12

h(a)Hh(a)ah(a′ )Hh(a′ )a′ ˜s˜sS|ϕ−1(L)h(a)Hh(a)ah(a′ )Hh(a′ )a′ s=lca(ϕ−1(L)S|ϕ−1(L)h(a)Hh(a)ah(a′ )Hh(a′ )a′ L=L(h(a))∪L(h(a′ ))h(a)˜s<˜s:a>Hh(a)ah(a)˜s<˜s:a>Hh(a)aaa1˜sh(a)a2[˜s:h(a)]˜s2<˜s1:a1>˜s1<˜s2:a2>h(a)[˜s:h(a)]Hh(a)a˜s˜s2˜s1<˜s1:a><˜s2:a>aa1˜sh(a)a2<˜s:a2>h(a)Hh(a)ah(a′ )Hh(a′ )a′ ˜s˜s2˜s1[˜s:h(a)]<˜s1:a><˜s2:a′ >(a) (b) (c) (d) (a) (b) (c) (d) (e) Horizontal spreadCophylogeny allowing for multiple associations

22:
23:
24:
25:

26:

27:
28:
29:

if E = D (duplication) then position (cid:104)˜s1 : a(cid:105) and (cid:104)˜s2 : a(cid:105) and go to line 31
end if
if E = S (switch) then position (cid:104)˜s1 : a(cid:105)

if no vertex h(cid:48) is incomparable to h(a) OR there is no arc a(cid:48) in H such
that (cid:104)˜s2 : a(cid:48)(cid:105) does not violate time feasibility condition then sample E ∼ M(1, θ(cid:48))
multinomial event among {C, D, L} with θ(cid:48) = (cid:104)pc, pd, pl(cid:105)/(pc + pd + pl) and go to
line 18

else uniformly choose arc a(cid:48) (among those that do not violate time fea-

sibility condition) in H; position (cid:104)˜s2 : a(cid:48)(cid:105) and go to line 31

end if

end if
if E = L (loss) then randomly choose a(cid:48) ∈ {a1, a2}, position (cid:104)˜s : a(cid:48)(cid:105) and go

to line 5

end if
Add ˜s1, ˜s2 in U
Remove ˜s from U

30:
31:
32:
end for
33:
34: end while
35: Output: Simulated symbiont tree ˜S and reconciliation ˜λ to host H

Figure 6: Simulation of a vertical spread. (a) Initial conﬁguration. (b) Mapping of
vertex ˜s: we let ˜λ(˜s) = Hh(a). (c) Looking in the real symbiont tree for the ghost
subtree to be used in the next step. (d) Creating the ghost subtree in ˜s and stopping
the evolution of the leaves of ˜S˜s.

Figure 7: Simulation of a classical event. (a) Initial conﬁguration. (b) Cospeciation.
(c) Duplication. (d) Host switch. (e) Loss.

13

ρ(ρ,Hroot)˜SrootHrootaa1˜sh(a)a2<˜s:a>h(a)˜sHh(a)aSh(a)Hh(a)as=lca(ϕ−1(L))S|ϕ−1(L)L=L(Hh(a))Hh(a)˜sHh(a)aS|ϕ−1(L)h(a)˜s<˜s:a>Hh(a)a(a) (b) (a) (b) (c) (d) InitialVertical spreadh(a)˜s<˜s:a>Hh(a)aaa1˜sh(a)a2˜λ(˜s)={h(a)}˜s2<˜s1:a1>˜s1<˜s2:a2>h(a)˜λ(˜s)={h(a)}Hh(a)a˜s˜s2˜s1<˜s1:a><˜s2:a>aa1˜sh(a)a2<˜s:a2>h(a)Hh(a)ah(a′ )Hh(a′ )a′ ˜s˜s2˜s1˜λ(˜s)={h(a)}<˜s1:a><˜s2:a′ >(a) (b) (c) (d) (e) Classical eventsCophylogeny allowing for multiple associations

2.5 ABC-SMC inference method

AmoCoala is based on the same ABC-SMC method presented in Coala. It is
an iterative method with many rounds, and it involves a summary discrepancy that
describes the quality of any candidate vector θ (i.e. how much it is susceptible to
have generated the observed dataset). We ﬁrst present Algorithm 2 that describes how
we rely on simulated trees in a reconciliation model with spreads produced through
Algorithm 1, to characterize the quality of a candidate vector θ = (cid:104)pc, pd, ps, pl(cid:105) with
respect to the observed dataset (H, S, φ). In particular, for each candidate vector θ, we
produce many diﬀerent trees and summarise them into a discrepancy dθ that character-
izes the quality of θ as a candidate to produce the observed data. The structure of this
procedure is unchanged from Coala, except for the way we compute the discrepancy
dθ.

Algorithm 2 Symbiont tree simulation algorithm overview
1: Input: (H, S, φ), parameter vector (cid:104)pspread, θ(cid:105)
2: Parameters: M number of simulated symbiont trees
3: for m=1 to M do
4:

(§θ,m, ˜λθ,m)

Apply Algorithm 1 with input (H, S, φ) and parameters (cid:104)pspread, θ(cid:105) and output

if |Sθ,m| ≥ 2|S| then discard the tree and return to line 4
end if
Compute dθ,m discrepancy between ( ˜Sθ,m, ˜λθ,m) and (S, φ)

5:
6:
7:
8: end for
9: Compute dθ as the average value of {dθ,m}1≤m≤M
10: Output: dθ

We then present a general overview of the ABC-SMC procedure in Algorithm 3. We
include all the details of the method in Section B.2 from the Supplementary Material.
Moreover, we report below the diﬀerences between this procedure and the one at stake
in Coala.

The main diﬀerence between Algorithms 2 and 3 and their respective corresponding
versions in AmoCoala lies in the summary discrepancy dθ used to quantify the quality
of the vector θ. The summary discrepancy between a simulated dataset (the generated
symbiont tree and its host associations) and the observed one (the real symbiont tree
and its host associations) is measured through a distance between phylogenetic trees
which can be calculated in polynomial time. Similarly as in Coala, this discrepancy
is built from two components: (i) d1, that describes how much the simulated tree ˜Sθ is
representative of the vector θ, and ii) d2 that measures how much is ˜Sθ (and its labels)
topologically similar to S (and its labels). The value of d1 is computed identically as
in Coala. As concerns point (ii), the distance used here is diﬀerent from the one used
in Coala and we detail its deﬁnition and motivation in the next paragraph.

14

Cophylogeny allowing for multiple associations

Algorithm 3 ABC-SMC procedure
1: Input: (H, S, φ, pspread)
2: Parameters: R rounds, N initial number of vectors, {τi}1≤i≤R tolerance values at

each round, M simulated symbiont trees for each vector

3: Sample N vectors θ = (cid:104)pc, pd, ps, pl(cid:105) ∼ D(1, 1, 1, 1), stored in set Θ
4: for all θ in Θ do
5:
6:

Apply Algo 2 with input (H, S, φ, pspread), parameter M . Output dθ
Select Q1 = τ1 × N parameter vectors with smallest dθ, stored in set A1 and

set (cid:15)1 = Argmaxθ∈A1dθ

7: end for
8: for r = 2 to R do
9:
10:
11:
12:
13:
14:
15:

Sample θ(cid:63) uniformly in Ar−1 and create θ(cid:63)(cid:63) by perturbing θ(cid:63)
Apply Algo 2 with input (H, S, φ, pspread, θ(cid:63)(cid:63)), parameter M . Output dθ(cid:63)(cid:63)
if dθ(cid:63)(cid:63) ≤ (cid:15)r−1 then add θ(cid:63)(cid:63) to quantile set Qr
end if
if |Qr| ≤ Qr−1 then return to line 9
end if
Select Qr = τr × Qr−1 parameter vectors with smallest dθ(cid:63)(cid:63), stored in set Ar

and set (cid:15)r = Argmaxθ∈Ardθ

16: end for
17: Output: Selected vectors θ

2.6 A distance between set-labelled trees

There are many distances between tree topologies, though not all are simple to
compute. However, the topology of a simulated tree is not suﬃcient to characterize
its similarity in the reconciliation context. Here, we want to consider, on top of the
topology, the leaf labels of the tree. Indeed, the sets that label the leaves of the (simu-
lated) symbiont tree contain information on the associations given by the coevolution
In AmoCoala, the leaves of both the observed and the
of symbionts with their hosts.
simulated symbiont trees (S and ˜S respectively) are labelled by the host leaves to which
they are associated. Thus, due to possible multiple associations in AmoCoala, those
symbiont trees are what we call set-labelled trees, that is, their leaves are labelled with
sets and not with singletons. To the best of our knowledge, distances for set-labelled
trees have not been considered in the literature and we believe our proposal for such
is thus of independent interest.

We ﬁrst recall that the MAST distance of two phylogenetic trees T1 and T2 corre-
sponds to the number of leaves in the largest isomorphic subtree that is common to
the two trees (subtrees common to the two trees are called agreement subtrees and we
look for the one with the largest number of leaves). Clearly this isomorphism takes
into account the labels of the trees. The MAST distance can be calculated in O(n2)
time where n is the size of the largest input tree (Ganapathy et al., 2006). For set-
labelled trees, we need to take into account the sizes of the sets of labels in the possible

15

Cophylogeny allowing for multiple associations

agreement subtrees.

Thus, given a set-labelled tree T , we denote its weight by w(T ) = (cid:80)

v∈L(T ) |l(v)|,
where l(v) is the set of labels associated to the leaf v. Now, a maximum agreement set-
labelled subtree, denoted by M AS(T1, T2), is a set-labelled subtree that is common to
the two trees T1, T2 and which has largest weight. Notice that a common subtree may
have leaf labels that are subsets of the original ones. As a consequence, the MAS of two
trees does not necessarily have the maximum number of leaves among the set-labelled
agreement subtrees, as shown in Figure 8. In the same way as the MAST distance is
deﬁned, we introduce the maximum agreement set distance, denoted by dM AS, between
two set-labelled phylogenetic trees T1,T2 as well as a normalized related quantity d2,
respectively deﬁned as

dM AS(T1, T2) = max{w(T1), w(T2)} − w(M AS(T1, T2))

d2(T1, T2) =

dM AS(T1, T2)
max{w(T1), w(T2)}

= 1 −

w(M AS(T1, T2))
max{w(T1), w(T2)}

.

We can prove that dM AS is a distance metric and that it can be calculated in polynomial
time using a dynamic programming algorithm. Note that the normalized quantity d2
has the advantage of lying in [0, 1] and is computed with the same complexity as dM AS.
It is only a pseudo-distance (as it does not satisfy the triangular inequality). The
resulting dθ deﬁned relying on d2 is a summary discrepancy (see details in Section B.3
from the Supplementary Material).
2.7 Summary of AmoCoala

Algorithm 4 presents a ﬁnal summary of the algorithm at stake in AmoCoala.
The output of the ABC-SMC procedure is a speciﬁed number of selected vectors θ.
Similarly as Coala, AmoCoala further performs a hierarchical clustering procedure,
with an automatic selection of the number of groups, to cluster the ﬁnal list of accepted
parameter vectors. The clusters and their number are automatically selected through
the R package dynamicTreeCut (for details, see Langfelder et al., 2007).

Algorithm 4 AmoCoala general structure
1: Input: (H, S, φ)
2: Parameters: R rounds, N initial number of vectors, {τi}1≤i≤R tolerance values at

each round, M simulated symbiont trees for each vector

3: Compute: Vertical spread pvs(h) and jump pjump(h → h(cid:48)) probabilities for any in-
comparable nodes h, h(cid:48) ∈ H; deduce horizontal spread phs(h) probabilities. Gather
these quantities in vector pspread

4: ABC-SMC procedure: Apply Algo 3 with input (H, S, φ, pspread) and parameters

(R, N, {τi}1≤i≤R, M )

5: Output: Selected vectors θ, and (optional) clusters of these vectors

16

Cophylogeny allowing for multiple associations

Figure 8: (a) Two set-labelled phylogenetic trees. T1 has weight 9 and T2 has weight
11. In (b), (c), (d), three diﬀerent agreement set-labelled subtrees of weights 6, 5 and
7 respectively. The maximum agreement set-labelled subtree is the one depicted in (d)
and notice that it does not have the maximum number of leaves.

17

T1{h1, h2, h3, h4 } {h1, h5, h6 } {h7} {h8} T2{h1, h2, h3, h4 } {h7} {h8} {h1, h5, h6 } {h1} {h1} (a){h1, h2, h3, h4 } {h7} {h8} (b){h1, h3 } {h1, h5, h6 } (c){h1, h5, h6 } (d){h1, h2, h3, h4 } Cophylogeny allowing for multiple associations

3 Experimental results and discussion

3.1 Experimental settings

Parameter settings. For each (synthetic or biological) dataset (H, S, φ), we ran
AmoCoala with the following parameter values. We simulated N = 2000 vectors
θi, (1 ≤ i ≤ 2000) in the ﬁrst round of simulation. For each vector θi, we simulated
M = 1000 symbiont trees. We discarded the simulated trees whose size is larger than
twice the one of the real symbiont tree S in input as being too diﬀerent from the
original one. The tolerance value used in the ﬁrst round was τ1 = 0.1. We ran R = 3
rounds and we deﬁned τi = 0.25. Notice that τ1 × N = 200 deﬁnes the size Q of the
quantile set which must be produced in each new round. Thus, after the last round,
we have τ3 × Q = 50 accepted vectors.

Synthetic datasets generation. Synthetic datasets are obtained in a similar way
as in Coala (see Baudet et al., 2015, for more details), the only diﬀerence lying on
the fact that the simulation algorithm now includes spread events. In particular, we
use the real symbiont tree and its (multiple) associations to the host tree to derive
the spread probabilities. To obtain realistic datasets, we started from a real biological
tree and chose the dataset SFC described in the next section. This host tree H (and
associated spread probabilities) is combined with 8 diﬀerent parameter values. We
thus simulated 8 datasets (H, Sθj , φj) for 1 ≤ j ≤ 8 associated with the following 8
probability vectors, in the form θ = (cid:104)pc, pd, ps, pl(cid:105). We used θ1 = (cid:104)0.70, 0.10, 0.10, 0.10(cid:105),
θ2 = (cid:104)0.80, 0.15, 0.01, 0.04(cid:105), θ3 = (cid:104)0.75, 0.01, 0.16, 0.08(cid:105), θ4 = (cid:104)0.70, 0.05, 0.02, 0.23(cid:105),
θ5 = (cid:104)0.60, 0.20, 0.00, 0.20(cid:105), θ6 = (cid:104)0.55, 0.00, 0.20, 0.25(cid:105), θ7 = (cid:104)0.45, 0.10, 0.15, 0.30(cid:105) and
θ8 = (cid:104)0.40, 0.20, 0.10, 0.30(cid:105). The choice of these vectors was done with the aim to
cover some typical coevolution patterns of probability. Indeed, vectors with very low
probability of cospeciation correspond to situations where there is almost no signal
of the coevolution of the species at a macroevolutionary level.
In these cases, the
cophylogeny reconciliation methods are not appropriate (Baudet et al., 2015; Althoﬀ
et al., 2014). Moreover, a high probability of host switches or duplications is not
appropriate to produce synthetic datasets due to the variability of the simulated trees.
Note that for these reasons, a ninth parameter value used in Coala was discarded
here.

3.2 Results of the self-test

The objective of this test is to check whether AmoCoala produces the correct
results for synthetic datasets where we know the truth. To this purpose, we ran Amo-
Coala 50 times on each of the 8 synthetic datasets generated as explained in the
previous subsection with true parameter value θi. We expected to ﬁnd a vector “very
close” to θ among the vectors accepted on the last round of AmoCoala. Note that
contrarily to what we did in Coala, we here rely on an Euclidean distance over the
parameter vectors. At the end of the third round, we therefore took note of the clus-

18

Cophylogeny allowing for multiple associations

ter whose representative parameter vector had the smallest Euclidean distance to θi
(we call it the ”best” cluster). We also stress again that parameter vectors do not
include the probabilities of spread events, which are pre-estimated before applying the
ABC-SMC approach.

The results for the ﬁrst parameter value θ1 are presented in Figure 9. The results
for the other vectors are similar and given in Figures Ba to Cd from the Supplementary
Material.

The ﬁrst column shows the histograms of the distances between θi and the repre-
sentative parameter in the best cluster. Then, columns 2 to 5 show the histograms of
the distribution of the event probabilities in these best clusters. The solid vertical red
line indicates the true parameter value. The dashed vertical black line indicates the
mean value. Overall the distances (ﬁrst columns) are rather small and the parameters
are correctly estimated (columns 2 to 5). In some speciﬁc cases, the slightly lower per-
formance of the method may often be explained by the diﬃculty of the problem. For
instance, for parameter vector θ8, the low cospeciation level makes the reconciliation
problem less relevant. It results in over-estimation of the cospeciation and underesti-
mation of the loss probabilities. Overall, these simulations show that AmoCoala is
able to select parameter vectors that are close to the true ones.

For

each simulated dataset with true parameter value θ1 =
Figure 9:
(cid:104)0.70, 0.10, 0.10, 0.10(cid:105), we ran AmoCoala 50 times and, at the end of the third round,
we took note of the cluster whose representative parameter vector had the smallest
euclidean distance (histograms shown in the ﬁrst column) to θ1. Columns 2 to 5 show
the histograms of the distributions of the event probabilities in these ”best” clusters.
The dashed vertical black line indicates the mean value. The solid vertical red line
indicates the true parameter value.

3.3 Biological datasets

To test our method, we selected 4 biological datasets from the literature. The choice
of these datasets was dictated by: (1) the availability of the data in public databases,
(2) the desire to cover for situations as widely diﬀerent as possible in terms of the
topology of the trees and the presence of multiple associations. The phylogenetic trees
of each dataset can be found in Figures D to G from the Supplementary Material. As
already mentioned, any dataset D containing multiple associations cannot be analysed
with Coala. Thus, in order to compare the results with those obtained by Coala
(Baudet et al., 2015), for each real dataset D we generated a dataset DCoala which is

19

0.00.20.40.60.81.0Distance02468101214Count0.00.20.40.60.81.0Cospeciation024681012Count0.00.20.40.60.81.0Duplication0.02.55.07.510.012.515.017.5Count0.00.20.40.60.81.0Switch0.02.55.07.510.012.515.017.5Count0.00.20.40.60.81.0Loss02468101214CountCophylogeny allowing for multiple associations

obtained from D by randomly choosing exactly one association (among existing ones
and whenever there are more than 2 such associations) for each symbiont leaf. Notice
that this is what is usually done in the literature when analysing such datasets with
a method that does not allow for multiple associations. We detail here the results
obtained for only two datasets, the reader can ﬁnd the remaining ones in Section D.1
from the Supplementary Material. Computing times are also presented in Section D.2
from the Supplementary Material.

Dataset 1: AP - Acacia & Pseudomyrmex. This dataset was extracted from G´omez-
Acevedo et al. (2010) and displays the interaction between Acacia plants and Pseu-
domyrmex, a genus of ants. Although the authors did not use a cophylogeny reconstruc-
tion tool to analyse the dataset, this is considered as a typical example of mutualism
between ants and plants, and the authors show that their relationship originated in
Mesoamerica between the late Miocene to the middle Pliocene, with eventual diversiﬁ-
cation of both groups in Mexico. The host and symbiont trees include 9 and 7 leaves,
respectively. The dataset has 22 multiple-associations. The corresponding dataset with
no multiple association is called APCoala.

Dataset 2: SFC - Smut Fungi & Caryophillaceus plants. This dataset was extracted
from Refr´egier et al. (2008). The host and symbiont trees include 15 and 16 leaves,
respectively. The dataset has 4 multiple associations. The corresponding dataset with
no multiple association is called SFCCoala. Notice that this is the same dataset used in
Baudet et al. (2015).

In Figures 10 and 11, we present for each of the cophylogeny events, the distribu-
tion of the inferred probabilities obtained by running AmoCoala and Coala. First
notice that the results change substantially when we consider the complete dataset
instead of the one obtained by removing the multiple associations. Indeed, from the
graphics in the third row of Figure 10, we see that if we ignore multiple associations,
then Coala explains the dataset using a very low cospeciation frequency and a high
In general, we can say that Coala detects a high
number of switches and losses.
incongruence between the trees which cannot be explained by cospeciations. However,
if the complete dataset is considered, i.e. the one including all the multiple associa-
tions, we see from the ﬁrst two rows of Figure 10 that the dataset can be explained
by only 2-3 horizontal spreads, a high number of cospeciations, a very low number of
duplications and switches and also a signiﬁcantly lower number of losses. Thus, the
incongruence between the two phylogenetic trees can be explained by approximately
3 horizontal spreads and then most of the events correspond to cospeciations, which
is an indication of coevolution. This is in accordance with what is expected for this
dataset, which, as already mentioned in the previous paragraph, is considered as a
typical example of mutualism between ants and plants.

Next, we considered the dataset SFC with multiple associations proposed in Refr´egier
et al. (2008). From Figure 11, we can see that both methods show similar results
concerning cospeciations, duplications and host switches while AmoCoala outputs
a smaller number of losses (less then 25%) compared to Coala (less then 40%). In
Refr´egier et al. (2008), the diﬀerent analyses performed indicated that the most plau-
sible reconciliations presented for the SFC dataset have from 0 to 3 cospeciations, no

20

Cophylogeny allowing for multiple associations

Figure 10: Comparison of the results obtained with AmoCoala and Coala for the
dataset AP. In each graphic, we show for each event type, the distribution of the
parameter values. In the ﬁrst two rows, the results provided by AmoCoala and in
the third row, the ones provided by Coala.

duplication, 12 to 15 host switches and 0 to 2 losses. It is impossible for us to calculate
the number of events in a parsimony framework because there is no parsimonious algo-
rithm for computing optimal reconciliations in the presence of vertical and horizontal
spreads. Nonetheless, we have access to estimated frequencies of the reconstructed
events. Moreover, from the deﬁnition of the model (see Sections A.2 and A.3 from
the Supplementary Material) we know that the sum of the classical events (cospecia-
tion, duplication and host switch), excluding the loss event, is equal to the number of
internal vertices of the symbiont tree. The symbiont tree (that is the same for SFC
and SFCCoala) has 15 internal vertices. Based on the analyses presented in Refr´egier
et al. (2008), we expect to have events with the following frequencies: between 0%
and 20% for cospeciations (from 0 to 3 events), 0% for duplications (no duplications),
between 80% and 100% for host switches (from 12 to 15 events) and between 0% and
13% for losses (from 0 to 2 events). To compare the results output by the two methods
(Coala and AmoCoala) with those expected from the analyses of Refr´egier et al.
(2008), we cluster the parameter vectors output by the methods. Indeed, both Coala
and AmoCoala perform a hierarchical clustering procedure to group the ﬁnal list of
accepted parameter vectors. We then compared the cluster patterns found by the two

21

Cophylogeny allowing for multiple associations

Figure 11: Comparison of the results obtained with AmoCoala and Coala for the
dataset SFC. In each graphic, we show for each event type, the distribution of the
parameter values. In the ﬁrst two rows, the results provided by AmoCoala and in
the third row, the ones provided by Coala.

methods. Table 1 shows the representative vectors of each of the clusters output by
AmoCoala (for the SFC dataset) and by Coala (for the SFCCoala dataset). Notice
that as already mentioned in Baudet et al. (2015), a vector with a high frequency of
host switches can generate a large space of simulated trees, many of which can have a
high distance from the real symbiont tree. Thus, it is clear that such vectors are more
diﬃcult to be output by both Coala and AmoCoala.

From the results in Table 1, we have that the event vector that is most similar to the
expected one according to Refr´egier et al. (2008) is Cluster 2 for AmoCoala run on the
SFC dataset (22.6% for cospeciations, 0.4% for duplications, 54.3% for host switches
and 22.8% for losses). It is also important to note that the number of vectors that are
part of this cluster is high (14 out of 50 vectors accepted in the third round). Notice
that Cluster 5 of Coala run on SFCCoala is also close to these values, however this
cluster is supported by only 2 of the accepted vectors. Moreover, all the representative
vectors of the clusters output by AmoCoala have a frequency of duplication close to
0, which is in agreement with what is expected from Refr´egier et al. (2008).

22

Cophylogeny allowing for multiple associations

Table 1: Representative vectors of the clusters produced by AmoCoala (for the SFC
dataset) and by Coala (for the SFCCoala dataset). The column #vectors indicates
the number of vectors in the cluster.

Dataset

SFC

SFCCoala

Cluster
1
2
3
4
1
2
3
4
5

pc
0.531
0.226
0.898
0.859
0.437
0.417
0.850
0.005
0.144

pd
0.004
0.004
0.020
0.062
0.002
0.274
0.002
0.418
0.001

ps
0.282
0.543
0.040
0.002
0.357
0.003
0.005
0.003
0.548

pl
0.183
0.228
0.042
0.077
0.204
0.306
0.144
0.575
0.308

#vectors
19
14
12
5
20
19
5
4
2

Overall the results obtained with AmoCoala are closer to the result presented in
Refr´egier et al. (2008) than those that were obtained by Coala which ignores such
multiple associations. This shows again the importance of taking into account the
latter.
4 Concluding comments

In this paper, we propose a method, called AmoCoala, which for a given pair
of host and symbiont trees, estimates the probabilities of the cophylogeny events, in
presence of spread events, relying on an approximate Bayesian computation (ABC)
In AmoCoala, it is possible to estimate the probabilities of the classi-
approach.
cal cophylogeny events (cospeciation, duplication, host switch and loss) and also the
probabilities of horizontal and vertical spreads. These two latter events allow to study
datasets that contain multiple associations. The model uses set-labelled trees and to
compare them we introduced a new distance, called MAS, which we believe can be of
independent interest.

AmoCoala on one hand provides more conﬁdence in the set of costs to be used for
the reconciliation of a given pair of host and symbiont trees, while on the other hand,
it allows to estimate the probabilities of the events even in the case of large datasets.
We evaluate our method on synthetic and real datasets.

This work leads to diﬀerent research directions. First, it would be interesting to
deﬁne better distances for set-labelled trees. To the best of our knowledge, these types
of trees have not been considered in the literature and it would be interesting to gen-
eralise (if possible) some of the well-known phylogenetic distances to set-labelled trees.
Another direction is to include the vertical and horizontal spreads in the parsimonious
reconciliation framework. Thus, a perspective to this work is to design a reconciliation

23

Cophylogeny allowing for multiple associations

procedure that includes these switches.
5 Software and Supplementary Material

The software, datasets and Supplementary Material are available at https://

sites.google.com/view/blerinasinaimeri/software/amocoala.
6 Disclosure statement

The authors state they have no conﬂicts of interest to declare.

References

Alcala, N., T. Jenkins, P. Christe, and S. Vuilleumier. 2017. Host shift and cospeciation

rate estimation from co-phylogenies. Ecology Letters 20:1014–1024.

Althoﬀ, D. M., K. A. Segraves, and M. T. J. Johnson. 2014. Testing for coevolutionary
diversiﬁcation: linking pattern with process. Trends in Ecology & Evolution 29:82 –
89.

Banks, J. C. and A. M. Paterson. 2005. Multi-host parasite species in cophylogenetic

studies. International Journal for Parasitology 35:741 – 746.

Bansal, M. S., E. Alm, and M. Kellis. 2012. Eﬃcient algorithms for the reconciliation
problem with gene duplication, horizontal transfer and loss. Bioinformatics 28:i283–
i291.

Bansal, M. S., M. Kellis, M. Kordi, and S. Kundu. 2018. RANGER-DTL 2.0: rigorous
reconstruction of gene-family evolution by duplication, transfer and loss. Bioinfor-
matics 34:3214–3216.

Baudet, C., B. Donati, B. Sinaimeri, P. Crescenzi, C. Gautier, C. Matias, and M.-F.
Sagot. 2015. Cophylogeny reconstruction via an Approximate Bayesian Computa-
tion. Systematic Biology 64:416–31.

Becerra, J. X. 1997. Insects on plants: Macroevolutionary chemical trends in host use.

Science 276:253–256.

Braga, M. P., M. J. Landis, S. Nylin, N. Janz, and F. Ronquist. 2020. Bayesian inference
of ancestral host-parasite interactions under a phylogenetic model of host repertoire
evolution. Systematic biology 69:1149–1162.

Brooks, D. R. and D. A. McLennan. 1991. Phylogeny, Ecology, and Behavior: A Re-

search Program in Comparative Biology. University of Chicago press.

Charleston, M. A. 2002. Biological Evolution and Statistical Physics vol. 585 of Lecture
Notes in Physics chap. Principles of cophylogenetic maps, Pages 122–147. Springer
Berlin Heidelberg.

24

Cophylogeny allowing for multiple associations

Charleston, M. A. 2003. Recent results in cophylogeny mapping. Advances in Para-

sitology 54:303–330.

Conow, C., D. Fielder, Y. Ovadia, and R. Libeskind-Hadas. 2010. Jane: A new tool
for the cophylogeny reconstruction problem. Algorithms for Molecular Biology 5:10
pages.

Donati, B., C. Baudet, B. Sinaimeri, P. Crescenzi, and M. Sagot. 2015. Eucalypt:
eﬃcient tree reconciliation enumerator. Algorithms for Molecular Biology 10:3.

Doyon, J.-P., S. Hamel, and C. Chauve. 2011. An eﬃcient method for exploring
the space of gene tree/species tree reconciliations in a probabilistic framework.
IEEE/ACM Transactions on Computational Biology and Bioinformatics 9:26–39.

Drinkwater, B., A. Qiao, and M. A. Charleston. 2016. WiSPA: A new approach for

dealing with widespread parasitism. ArXiv:1603.09415.

Ganapathy, G., B. Goodson, R. Jansen, H. Le, V. Ramachandran, and T. Warnow.
2006. Pattern identiﬁcation in biogeography. IEEE/ACM Trans. on Comput. Biol.
Bioinf. 3:334–346.

Ganapathy, G., B. Goodson, R. Jansen, V. Ramachandran, and T. Warnow. 2005. Pat-
tern Identiﬁcation in Biogeography. Pages 116–127 in Algorithms in Bioinformatics
(R. Casadio and G. Myers, eds.) vol. 3692 of Lecture Notes in Computer Science
Springer Berlin Heidelberg.

G´omez-Acevedo, S., L. Rico-Arce, A. Delgado-Salinas, S. Magall´on, and L. E. Eguiarte.
2010. Neotropical mutualism between Acacia and Pseudomyrmex: Phylogeny and
divergence times. Molecular Phylogenetics and Evolution 56:393–408.

Hallett, M. T. and J. Lagergren. 2001. Eﬃcient algorithms for lateral gene transfer
problems. In Lengauer, T. (ed), Proceedings of the ﬁfth Annual International Con-
ference on Research in Computational Molecular Biology (RECOMB), ACM (New
York) Pages 149–156.

Langfelder, P., B. Zhang, and S. Horvath. 2007. Deﬁning clusters from a hierarchical

cluster tree: the Dynamic Tree Cut package for R. Bioinformatics 24:719–720.

Libeskind-Hadas, R. 2022. Tree reconciliation methods for host-symbiont cophyloge-

netic analyses. Life 12.

Merkle, D. and M. Middendorf. 2005. Reconstruction of the cophylogenetic history of
related phylogenetic trees with divergence timing information. Theory in Biosciences
123:277–299.

Merkle, D., M. Middendorf, and N. Wieseke. 2010. A parameter-adaptive dynamic
programming approach for inferring cophylogenies. BMC Bioinformatics 11:S60.

25

Cophylogeny allowing for multiple associations

Page, R. D. M. 1994. Parallel phylogenies: reconstructing the history of host-parasite

assemblages. Cladistics 10:155–173.

Refr´egier, G., M. Le Gac, F. Jabbour, A. Widmer, J. A. Shykoﬀ, R. Yockteng,
M. E. Hood, and T. Giraud. 2008. Cophylogeny of the anther smut fungi and their
caryophyllaceous hosts: Prevalence of host shifts and importance of delimiting par-
asite species for inferring cospeciation. BMC Evolutionary Biology 8:100.

Ronquist, F. 2003. Tangled trees: phylogeny, cospeciation, and coevolution chap. Parsi-
mony analysis of coevolving species associations, Pages 22–64. University of Chicago
Press.

Sanmart´ın, I. and F. Ronquist. 2002. New solutions to old problems: widespread taxa,
redundant distributions and missing areas in event-based biogeography. Animal Bio-
diversity and Conservation 25.2:75–93.

Silvieus, S. I., W. L. Clement, and G. D. Weiblen. 2008. Specialization, Speciation, and
Radiation chap. Cophylogeny of ﬁgs, pollinators, gallers and parasitoids, Pages 225–
237. University of California Press.

Stolzer, M. L., H. Lai, M. Xu, D. Sathaye, B. Vernot, and D. Durand. 2012. Inferring
duplications, losses, transfers and incomplete lineage sorting with nonbinary species
trees. Bioinformatics 28:i409–i415.

Sz¨oll˝osi, G. J., W. Rosikiewicz, B. Boussau, E. Tannier, and V. Daubin. 2013. Eﬃcient

exploration of the space of reconciled gene trees. Syst. Biol. 62:901–912.

Toﬁgh, A., M. T. Hallett, and J. Lagergren. 2011. Simultaneous identiﬁcation of dupli-
cations and lateral gene transfers. IEEE/ACM Trans. Comput. Biology Bioinform.
8:517–535.

26

Supplementary Material for: Cophylogeny reconstruction
allowing for multiple associations through approximate
Bayesian computation

Blerina Sinaimeri1,2,†, Laura Urbini2,†, Marie-France Sagot2 and
Catherine Matias3
1 LUISS University, Rome, Italy
2 Inria Lyon, 56 Bd Niels Bohr, 69100 Villeurbanne, France, and Universit´e de Lyon,
F-69000, Lyon; Universit´e Lyon 1; CNRS, UMR5558; 43 Boulevard du 11 Novembre 1918,
69622 Villeurbanne cedex, France
3 Sorbonne Universit´e, Universit´e de Paris Cit´e, Centre National de la Recherche
Scientiﬁque, Laboratoire de Probabilit´es, Statistique et Mod´elisation, Paris, France

Corresponding author: Blerina Sinaimeri, LUISS University, Rome, Italy; E-mail:
bsinaimeri@luiss.it.

Contents

A The event-based model

A.1 Tree-related basic deﬁnitions . . . . . . . . . . . . . . . . . . . . . . . .
A.2 Reconciliation model from Toﬁgh et al.
. . . . . . . . . . . . . . . . . .
A.3 Reconciliation model allowing for spreads . . . . . . . . . . . . . . . . .
. . . . . . . . . . . .
A.4 Pre-estimating probabilities for the spread events

B AmoCoala algorithm

B.1 Simulation algorithm in AmoCoala . . . . . . . . . . . . . . . . . . .
B.2 ABC-SMC inference method in AmoCoala . . . . . . . . . . . . . . .
B.3 Distance measure in AmoCoala . . . . . . . . . . . . . . . . . . . . .
. . . . . . . . . . . . . . . . . . . . .
B.4 A proof that dMAS is a distance
B.5 Polynomial time algorithm for computing the dMAS distance . . . . . .

C Additional results for the self-test

D Biological datasets

D.1 Results on biological datasets
. . . . . . . . . . . . . . . . . . . . . . .
D.2 Running times . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
D.3 Robustness analysis wrt the pre-estimated spread probabilities . . . . .

†First co-authors.

28
28
28
29
31

33
33
35
36
37
38

39

39
39
40
40

AmoCoala

Supplementary Material

A The event-based model

AmoCoala relies on the event-based model presented in Charleston (2002); Toﬁgh
et al. (2011). For the sake of completeness, we detail the model here. We ﬁrst start
with some basic deﬁnitions related to phylogenetic trees.

A.1 Tree-related basic deﬁnitions

A rooted phylogenetic tree is a leaf-labelled tree that models the evolution of a set
of taxa from their most recent common ancestor (placed at the root). The internal
vertices of the tree correspond to the speciation events. In a rooted phylogenetic tree,
a direction is assumed from the root to the leaves that corresponds to the direction
of evolutionary time. Speciﬁcally, a phylogenetic tree is a rooted tree with labelled
leaves where the root has in-degree 0 and out-degree 2, the leaves have in-degree 1
and out-degree 0 and every internal vertex has in-degree 1 and out-degree 2. For such
a tree T , the set of vertices is denoted by V (T ), the set of arcs by A(T ), and the
set of leaves by L(T ). The cardinality of set A is denoted by |A|. The root of T is
denoted by r(T ). For a vertex v in a tree T , we denote by Tv the subtree of T rooted
in v (often referred to as a clade), and we write L(v) for the set L(Tv). For a vertex
v ∈ V (T ), we denote by Des(v) the set of descendants of v, i.e. the set of vertices
in the subtree of Tv. Similarly, we denote by Anc(v) the set of ancestors of v, that is
the set of vertices in the unique path from r(T ) to v (including the end points). For
a vertex v ∈ V (T ) diﬀerent from the root, we call its parent, denoted by par(v), the
vertex x for which there is the arc (x, v) ∈ A(T ). We denote by mrca(v, w) the most
recent common ancestor of v and w in T . Finally, we denote by ≤ the partial order
induced by the ancestry relation in the tree. Formally, for x, y ∈ V (T ), we say that
x ≤ y if x ∈ Anc(y). If neither x ∈ Anc(y) nor y ∈ Anc(x), the vertices x and y are
said to be incomparable.

For any tree T and any set of leaves t1, . . . , tn, we denote by T|{t1,...,tn} the phylo-
genetic subtree of T induced by the leaves t1, . . . , tn and eventually suppressing the
vertices of out-degree 1. When a vertex u with parent vertex v and child vertex w
is suppressed, both vertex u and arcs (v, u), (u, w) are removed and the arc (v, w) is
added to the tree.

A.2 Reconciliation model from Toﬁgh et al.

In this section, we describe the classical reconciliation model, where 4 coevolution-
ary events are allowed, producing no multiple associations. Let H and S be respectively
the rooted phylogenetic trees of the host and symbiont species, both binary and full
(i.e. each internal vertex has exactly two children). Let φ be a function from L(S) to
L(H), representing the symbiont/host associations between extant species. A recon-
ciliation is a function λ that assigns, for each symbiont vertex s ∈ V (S), a host vertex
λ(h) ∈ V (H), and satisﬁes the conditions stated in Deﬁnition 1.

28

AmoCoala

Supplementary Material

In its classical form, a reconciliation associates to each vertex s in V (S) an event

E(λ(s)) among cospeciation (C), duplication (D) and host switch (S).

Deﬁnition 1. Given two phylogenetic trees S and H, and a function φ : L(S) → L(H),
a reconciliation of (S, H, φ) is a function λ : V (S) → V (H) satisfying the following:

1. For every leaf vertex s ∈ L(S), we have λ(s) = φ(s).

2. For every internal vertex s ∈ V (S) \ L(S) with children s1, s2, exactly one of the

following applies:

(a) E (λ(s)) = S, that is, either λ(s1) and λ(s) are incomparable and λ(s2) is
a descendant of λ(s), or λ(s2) and λ(s) are incomparable and λ(s1) is a
descendant of λ(s),

(b) E (λ(s)) = C, that is, mrca(λ(s1), λ(s2)) = λ(s), and λ(s1) and λ(s2) are

incomparable,

(c) E (λ(s)) = D, that is, λ(s1) and λ(s2) are both descendants of λ(s), and the

previous two cases do not apply.

The loss event is denoted by L and is identiﬁed by a multiset (generalisation of a
set where the elements are allowed to appear more than once) whose elements are in
V (H) containing all the vertices h ∈ V (H) that are in the path between the image of
a vertex s ∈ V (S) and the image of one of its children. The images themselves are
not included in the count, except for the duplication event, where one of the images is
included.

The function λ partitions the set of internal symbiont tree vertices into three disjoint
subsets according to the coevolutionary event occurring at that vertex. The number
of occurrences of each of the three events and the number of losses make up the event
vector of the reconciliation. The event vector of a reconciliation is a vector of integers
consisting of the total number of each type of events C, D, S, L.

We say that a reconciliation is time-feasible if it does not violate the time-feasibility
constraints. The exact criterion we use to assess time-feasibility is the one deﬁned in
Stolzer et al. (2012) and that was already in force in Coala.

A.3 Reconciliation model allowing for spreads

The introduction of spread events modiﬁes the previous setting in the following way.
Let again H and S be respectively the rooted phylogenetic trees of the host and sym-
biont species, both binary and full (i.e. every internal vertex has exactly two children).
Now, let φ be a relation between L(S) and L(H), representing the symbiont/host as-
sociations between extant species. More precisely, let us denote P(L(H)) the set of all
subsets of L(H). Then φ is now a function from L(S) to P(L(H)). For any extant
symbiont species s ∈ L(S), whenever the cardinality |φ(s)| ≥ 2 (i.e. whenever the

29

AmoCoala

Supplementary Material

symbiont is associated to more than one host), we say that this symbiont has multiple
associations and we count the total number of multiple associations in the dataset as:

Nb of multiple associations =

(cid:88)

(|φ(s)| − 1).

s∈L(S)

A reconciliation is now a function λ from V (S) to P(V (H)) that assigns, for each
symbiont vertex s ∈ V (S), a set of host vertices λ(s) ⊂ V (H), and satisﬁes the
conditions stated in Deﬁnition 2. A reconciliation now associates to each vertex s
in V (S) an event E(λ(s)) among cospeciation (C), duplication (D), host switch (S),
vertical spread (VS) and horizontal spread (HS).

Deﬁnition 2. Given two phylogenetic trees S and H, and a function φ : L(S) →
P(L(H)), a reconciliation of (S, H, φ) is a function λ : V (S) → P(V (H)) satisfying
the following:

1. For every leaf vertex s ∈ L(S), we have λ(s) = φ(s).

2. For every internal vertex s ∈ V (S) \ L(S) with children s1, s2, such that λ(s) is

a singleton, exactly one of the following applies:

(a) E (λ(s)) = S, that is, either λ(s) and one element of λ(s1) are incomparable
and λ(s2) contains a descendant of λ(s), or λ(s) and one element of λ(s2)
are incomparable and λ(s2) contains a descendant of λ(s),

(b) E (λ(s)) = C, that is, there is some h1 ∈ λ(s1) (resp. h2 ∈ λ(s2)) such that

mrca(h1, h2) = λ(s), and h1 and h2 are incomparable,

(c) E (λ(s)) = D, that is, there is some h1 ∈ λ(s1) (resp. h2 ∈ λ(s2)) such that
both h1, h2 are descendants of λ(s), and the previous two cases do not apply.

3. For every internal vertex s ∈ V (S)\L(S) such that λ(s) is not a singleton, exactly

one of the following applies:

(a) E (λ(s)) = VS, that is λ(s) is a clade in H, and all the descendants s(cid:48) of s

are also associated to the same clade, i.e. λ(s(cid:48)) = λ(s).

(b) E (λ(s)) = HS, that is λ(s) is the union of two clades in H whose respec-
tive roots are incomparable. Moreover, all the descendants s(cid:48) of s are also
associated to the same clades, i.e. λ(s(cid:48)) = λ(s).

(c) s is the descendant of a node s(cid:48) where a spread (either vertical or horizon-
tal) occurred (cases (3a) and (3b)). Then λ(s) = λ(s(cid:48)). In that case, no
additional coevolutionary event is recorded at that vertex.

The loss event denoted by L is identiﬁed by a multiset (generalisation of a set
where the elements are allowed to appear more than once) whose elements are in V (H)
containing all the vertices h ∈ V (H) that are in the path between the image of a vertex
s ∈ V (S) which is a singleton and the image of one of its children. Note that no other
event and thus no losses can happen below spread events.

30

AmoCoala

Supplementary Material

Now, the function λ partitions the set of internal symbiont tree vertices into ﬁve
disjoint subsets according to the coevolutionary event occurring at that vertex, plus
an additional subset of all internal symbiont vertices that descend from a vertex where
a spread occurred. The number of occurrences of each of the ﬁve events and the
number of losses make up the event vector of the reconciliation. The event vector of
a reconciliation is a vector of integers consisting of the total number of each type of
events C, D, S, L, VS, HS. Note that in the case of spread events (either vertical or
horizontal) occurring at internal vertex s ∈ V (S) \ L(S), the event is counted only once
and the internal vertices s(cid:48) descendants of s have no coevolutionary event associated
to them.

The time feasibility condition is unchanged when adding spreads in the list of

coevolutionary events.

A.4 Pre-estimating probabilities for the spread events

Given an input dataset (H, S, φ), we rely on frequency estimators for the spread
probabilities that will be used in our algorithm. Note that the “classical events” (cospe-
ciation, duplication, host switch and loss) have the same probability to occur every-
where in the tree, while the probability of a vertical or horizontal spread is speciﬁc to
each vertex of the host tree. These probabilities are pre-estimated based on the input
(H, S, φ) as described below rather than in the full ABC procedure. They are esti-
mated through heuristic frequencies observed in the associations of the two trees. In
Section D.3, we explore the robustness of our results with respect to these pre-computed
estimators.

A probability pvs(h) is
Probability that a vertical spread occurs at host h.
associated to a vertical spread event at host h as follows. If h ∈ L(H), then pvs(h) is
estimated to 1. Otherwise, for any internal vertex h of the host tree H, the probability
pvs(h) is estimated to

pvs(h) =

(cid:18) 1

(cid:19) (cid:80)

|SL(h)|

s∈SL(h) |φ(s) ∩ L(h)| − 1
|L(h)| − 1

(S.1)

where L(h) is the set of leaves in Hh (the subtree of H rooted in h), SL(h) is the set of
leaves in the symbiont tree S that are associated with at least one leaf of Hh (formally
SL(h) = {s ∈ L(S) : φ(s) ∩ L(h) (cid:54)= ∅}), and |φ(s) ∩ L(h)| is the number of host leaves
in Hh associated with a symbiont s.

Intuitively, the probability pvs(h) is large whenever a large proportion of the sym-
bionts in SL(h) are associated to a large proportion of the hosts L(h) (i.e. most of the
symbionts are generalists) and is low when most of those symbionts are associated only
with a few hosts of L(h) (i.e. most of the symbionts are specialists). Notice that for a
host h that is high in the tree, i.e. that is near to the root of H, the set L(h) is large.
Thus, a vertical spread to occur at h with high probability requires that some symbiont
leaves are associated to an unrealistically large set of hosts L(h). Hence usually the

31

AmoCoala

Supplementary Material

probability of a vertical spread is lower in hosts that are high in the tree. As explained
in the next paragraph, the same holds for the horizontal spread event.

Probability that a symbiont present in h invades an incomparable host h(cid:48).
For two incomparable vertices h and h(cid:48), a probability pjump(h → h(cid:48)) is estimated as
follows

pjump(h → h(cid:48)) =

|SL(h) ∩ SL(h(cid:48))|
|SL(h) ∪ SL(h(cid:48))|

.

(S.2)

The notion of “jump” does not refer to a coevolutionary event and should not be
confused with a host switch. The jump probability is speciﬁc to each pair of vertices
pjump(h → h(cid:48)) = pjump(h(cid:48) → h).
of the host tree.
It is high whenever the leaves of the subtrees Hh and Hh(cid:48) share a large proportion of
associated symbionts. In particular, it is zero when they do not share any associated
symbiont, and 1 when they have exactly the same set of associated symbionts.

It is a symmetric quantity, i.e.

Probability that a horizontal spread occurs at host h. From the probabilities
pjump(h → h(cid:48)), we estimate a probability of horizontal spread at each vertex h. The
associated probability depends on all the vertices h(cid:48) that are incomparable with h.
Indeed, such vertices are all those that may be reached from h through a horizontal
spread event. In fact, a horizontal spread corresponds to a jump combined with two
vertical spreads. We thus associate a probability of horizontal spread phs(h) to each
vertex h of the host tree that takes into account both a jump and two vertical spreads
and is set as

phs(h) = min{1, p∗(h)},

(S.3)

where

p∗(h) = pvs(h)

(cid:88)

pvs(h(cid:48))pjump(h → h(cid:48)).

h(cid:48)∈V (H)
h,h(cid:48) incomparable

The probability of a horizontal spread phs(h) is high whenever pvs(h) is high and there
exist vertices h(cid:48) incomparable to h with large pvs(h) and large value pjump(h → h(cid:48)) (so
that the leaves below h and h(cid:48) share many symbionts). Observe that p∗(h) is not a
probability but a positive value, that in particular may be larger than 1.

Probability for sampling a horizontal spread to some speciﬁc host h(cid:48).
In
the simulation process, once a horizontal spread is sampled for symbiont s at vertex h,
we need to choose an incomparable vertex h(cid:48) where the symbiont s has to jump to. In
this case, we need to guarantee that the jump satisﬁes the time-feasibility constraints
as given in Stolzer et al. (2012) and Baudet et al. (2015). This constraint depends on
the symbionts mapped so far (see Section Simulation algorithm in AmoCoala below).
For a current partial mapping λ from the vertices of S to the subsets of vertices of H,
the probability pinvasion(h → h(cid:48), λ) of a vertex h(cid:48) to be invaded by a symbiont s mapped

32

Supplementary Material

AmoCoala

in h is estimated as

pinvasion(h → h(cid:48), λ) =

pjump(h → h(cid:48))1{Eh,h(cid:48),λ}pvs(h)pvs(h(cid:48))

pvs(h) (cid:80)

h(cid:48)(cid:48) pvs(h(cid:48)(cid:48))pjump(h → h(cid:48)(cid:48))1{Eh,h(cid:48)(cid:48),λ}

=

(cid:80)

pjump(h → h(cid:48))1{Eh,h(cid:48),λ}pvs(h(cid:48))
h(cid:48)(cid:48) pvs(h(cid:48)(cid:48))pjump(h → h(cid:48)(cid:48))1{Eh,h(cid:48)(cid:48),λ}

,

,

(S.4)

where 1{Eh,h(cid:48),λ} = 1 whenever the horizontal spread of the symbiont mapped in h to
the new host h(cid:48) induces a time feasible reconciliation, and the sum in the denominator
is restricted to the vertices h(cid:48)(cid:48) that are incomparable to h. If no vertex induces a time
feasible reconciliation (namely pinvasion(h → h(cid:48), λ) = 0 for any h(cid:48) incomparable to h),
the horizontal spread is not applied and another event is sampled. Otherwise, as the
probabilities pinvasion(h → h(cid:48), λ) sum up to one, a vertex h(cid:48) is necessarily chosen.

Computing the pre-estimated spread probabilities. The estimated spread prob-
abilities are calculated at the beginning of the algorithm. These values depend only
on the host tree H, the symbiont tree S and the associations between the leaves φ.
In a ﬁrst step, we start by setting to 1 the probabilities pvs for the leaves. Then, for
the internal vertices h, these probabilities are computed as in Equation (S.1).
In a
second step, the probabilities of a jump are calculated for each pair of incomparable
vertices h and h(cid:48) as in Equation (S.2). In the last step, the probabilities of a horizontal
spread for vertex h are computed as in Equation (S.3). Observe that the probabilities
of invasion (Equation (S.4)) depend on the current simulation. Indeed, one has to take
into account the time-feasibility in order to choose the target h(cid:48) of a horizontal spread.
Therefore, it may happen that the invasion pinvasion(h → h(cid:48), λ) > 0 for the current
partial mapping λ but after some steps pinvasion(h → h(cid:48), λ(cid:48)) = 0 for the new mapping
λ(cid:48). These probabilities are then updated, during the simulation algorithm, each time
a horizontal spread is selected.

B AmoCoala algorithm

B.1 Simulation algorithm in AmoCoala

The simulation of a symbiont tree ˜S together with its reconciliation ˜λ starts with
the creation of its root vertex ˜sroot. This vertex is positioned before the root of H on
the arc a = (ρ, Hroot). We add the arc (ρ, Hroot) to allow the simulation of events that
happened in the symbiont tree before the most recent common ancestor of all host
species in H. Figure 4 in main text depicts this starting conﬁguration.

For any vertex ˜s of ˜S that is not yet mapped and whose position is (cid:104)˜s : a(cid:105) (see
Figure 4 in main text), AmoCoala successively considers the six allowed operations,
and chooses one depending on the probability of each event (once an event is picked,
the others are not considered). In what follows, we denote by a1, a2 the arcs outgoing
from the head h(a) of the arc a.

I. If h(a) is a leaf, we STOP the evolution of ˜s.

33

AmoCoala

Supplementary Material

II. We ﬁrst sample a horizontal spread according to the probability phs

(cid:0)h(a)(cid:1). When
a horizontal spread occurs (Figure 5 in main text), we apply the mapping ˜λ(˜s) =
Hh(a) ∪ Hh(a(cid:48)). The choice of the incomparable vertex h(a(cid:48)) varies in order to
preserve time feasibility (Stolzer et al., 2012; Baudet et al., 2015), thus the prob-
abilities described in Equation (S.4) are updated according to the new set of
incomparable vertices. If there is no incomparable vertex, it is not possible for
a horizontal spread to occur and we go to Step III. To select the ghost subtree
rooted in ˜s, we mimic the real symbiont tree as shown in Figure 5 in main text.

III. If a horizontal spread did not occur, we sample a vertical spread according to
(cid:0)h(a)(cid:1). When a vertical spread occurs (Figure 6 in main text),
the probability pvs
we apply the mapping ˜λ(˜s) = Hh(a). To select the ghost subtree rooted in ˜s, we
mimic the real symbiont tree as shown in Figure 6 from main text.

In both cases of vertical and horizontal spreads, the evolution of ˜s stops after the
creation of the ghost subtree and its descendants are not processed anymore.

IV. If a spread was not sampled, then we sample with a multinomial distribution
a classical event according to the probabilities θ = (cid:104)pc, pd, ps, pl(cid:105). Notice that
pc + pd + ps + pl = 1 so that one of the four events is selected. This case is
handled identically as in Coala and the symbiont is associated to a single host.
We brieﬂy recall the procedure below.

– Cospeciation (Figure 7(b) in main text): We apply the mapping ˜λ(˜s) =
{h(a)} and we create the vertices ˜s1 and ˜s2 as children of ˜s. We position
them as follows: (cid:104)˜s1 : a1(cid:105) and (cid:104)˜s2 : a2(cid:105). This operation is executed with
probability pc.

– Duplication (Figure 7(c) in main text): We apply the mapping ˜λ(˜s) =
{h(a)} and we create the vertices ˜s1 and ˜s2 as children of ˜s. Both ˜s1 and ˜s2
are positioned on a. This operation is executed with probability pd.

– Host switch (Figure 7(e) in main text): We apply the mapping ˜λ(˜s) =
{h(a)} and we create the vertices ˜s1 and ˜s2 as children of ˜s. We then
randomly choose one of the two children and position it on a. Finally, we
randomly choose an arc a(cid:48) that does not violate the time feasibility of the
reconstruction so far (Stolzer et al., 2012; Baudet et al., 2015). If such an
arc does not exist, it is not possible for a host switch to take place.
In
this case, we choose between the three remaining events with probability
pi/(pc + pd + pl) with i ∈ {c, d, l}. Otherwise, we position ˜s2 on a(cid:48). This
operation is executed with probability ps.

– Loss (Figure 7(e) in main text): This operation consists of randomly choos-
ing an arc outgoing from the head h(a) of a and positioning ˜s on it. This
operation is executed with probability pl.

In any of these four cases, the simulation process recursively continues with the
new vertices created (back to Step I).

34

AmoCoala

Supplementary Material

Note that in our modelling, losses never occur after a spread event. Indeed, in the
case of a vertical spread, a symbiont and its entire clade are associated to one host
clade, while in the case of a horizontal spread, they are then associated to two host
clades. This might appear unrealistic. However, this choice is made for computational
reasons.
Indeed, as mentioned in the Main Manuscript, there is no simple way of
simulating the symbiont tree below a symbiont where a spread occurs.

B.2 ABC-SMC inference method in AmoCoala

AmoCoala is based on the same ABC-SMC method as the one developed in
Coala (Baudet et al., 2015). For the sake of completeness, we now recall the proce-
dure.

The ABC-SMC procedure is composed of a sequence of R > 1 rounds. At each
round, parameter vectors θ are sampled in a speciﬁc way, symbiont trees ˜Sθ are gener-
ated under the reconciliation model allowing for spreads with parameter values given
by θ (and relying on the simulation algorithm described in the previous section). Then,
these symbiont trees are compared to the original dataset through a summary distance
d whose details are given in the next section. The parameters with the smallest dis-
crepancies are selected.

For each of these rounds, we deﬁne a tolerance value τr (1 ≤ r ≤ R) which deter-
mines the percentage of parameter vectors to be accepted. Associated with a tolerance
value τr, we have a threshold (cid:15)r which is the largest value of the summary distance
associated with the accepted parameter vectors.

• Initial round (r = 1):

– Draw an initial set of N parameter vectors {θi

– Then, for each θi

1, simulate M trees { ˜Sj(θi

sponding discrepancies {dj(θi
mary discrepancy dθi

1

through the mean value.

1}(1≤i≤N ) from the prior π.
1)}(1≤j≤M ). Compute the corre-
1)}(1≤j≤M ) and summarise them into the sum-

– Select Q1 = τ1 × N parameter vectors θ1 that have the smallest value dθ1,
thus deﬁning the threshold (cid:15)1 and the set A1 of accepted parameter vectors.

• Following rounds (2 ≤ r ≤ R):

1. Sample a parameter vector θ(cid:63) from the set A(r−1).
2. Create a parameter vector θ(cid:63)(cid:63) by perturbing θ(cid:63) (through a kernel proposal).
3. Simulate M trees relying on the parameter value θ(cid:63)(cid:63) and compute dθ(cid:63)(cid:63). If
dθ(cid:63)(cid:63) ≤ (cid:15)(r−1), add θ(cid:63)(cid:63) into the quantile set Qr. If |Qr| < Qr−1, return to
Step 1.

4. Based on the set Qr, select Qr = τr × Q parameter vectors θr that have
the smallest dθr, thus deﬁning the threshold (cid:15)r and the set Ar of accepted
parameters.

35

AmoCoala

Supplementary Material

Prior distribution. We sample from a uniform distribution on the simplex S3 =
{(p1, p2, p3, p4); pi ≥ 0 and (cid:80)

i pi = 1} (we recall that pc + pd + ps + pl = 1).

Kernel proposal. We add to each coordinate of θ a randomly chosen value in
[−0.01, +0.01] and normalise the result. The ﬁnal set of accepted parameter vectors is
the result of the ABC-SMC procedure and characterises the list of vectors that may
explain the evolution of the pair of host and symbiont trees given as input. Observe
that, since in all experiments a uniform prior distribution is assumed and also the
perturbations are performed in a uniform way, the weights induced by the proposals
will also appear to be uniform (Beaumont et al., 2009). However, in the case of a
diﬀerent prior, weights should be used in the process in order to correct the posterior
distribution according to the perturbation made.

Clustering of the vectors. The ﬁnal list of accepted vectors are clustered using
a hierarchical clustering procedure implemented in Coala (Baudet et al., 2015). As
ﬁnal result, we therefore obtain a list of clusters to each one of which a representative
vector is associated.

B.3 Distance measure in AmoCoala

The discrepancy between the simulated and the original datasets is measured through
a distance between set-labelled phylogenetic trees which can be calculated in polyno-
mial time. Similarly as in Coala, this distance contains two components: (i) d1, that
describes how much the simulated tree ˜Sθ is representative of the vector θ, and (ii)
d2 that measures how much is ˜Sθ (and its labels) topologically similar to S (and its
labels).

Let us recall the deﬁnition of this ﬁrst component. For a given vector θ = (cid:104)pc, pd, ps, pl(cid:105)

and for each simulated tree ˜Sθ that was simulated according to this vector, we keep
track of the vector of the number of classical cophylogeny events (cid:104)oc, od, os, ol(cid:105) associ-
ated to this simulation. We compute the corresponding expected vector (cid:104)ec, ed, es, el(cid:105)
as follows

∀i ∈ {c, d, s, l},

ei = |S| × θi = |S| × pi,

where |S| is the size of the symbiont tree, i.e. its number of internal leaves. Then by
comparing the observed and expected vectors, we deﬁne a measure d1(S, ˜Sθ) as follows:

d1(S, ˜Sθ) =

1
4

×

(cid:88)

i∈{c,d,s,l}

|ei − oi|
max{ei, oi}

.

Note that we did not consider the number of observed spread events, which does not
depend on the choice of θ as the corresponding probabilities are pre-estimated before
applying the ABC-SMC approach.

As concerns point (ii), we extend the well-known maximum agreement subtree
(MAST) distance (Finden and Gordon, 1985; Farach-Colton et al., 1995) to handle
set-labelled trees. This part is the novelty with respect to the proposal in Coala and

36

AmoCoala

Supplementary Material

details were given in the Main Manuscript. We establish in the next sections that dM AS
is a distance and that it can be computed in polynomial time.

We use a normalised version of dM AS and deﬁne the distance d2 (see Main Manuscript).

The two components are then combined to form the following distance

dθ = α1d1(S, ˜Sθ) + α2d2(S, ˜Sθ).

According to our experiments and also the ones presented in Coala, the most appro-
priate values are α1 = 0.7 and α2 = 0.3.

B.4 A proof that dMAS is a distance

We show that the distance dM AS is a metric. For this, we check that dM AS satisﬁes

the following properties:

1. dM AS(T1, T2) ≥ 0 for all T1,T2: this is trivial.

2. dM AS(T1, T2) = 0 if and only if T1 = T2. Clearly if T1 = T2 then dM AS(T1, T2) = 0.
Otherwise, let dM AS(T1, T2) = 0. Then max{w(T1), w(T2)} = M AS(T1, T2). The
proof follows by observing that if T ∗ is a subtree of T such that w(T ∗) = w(T )
then T ∗ = T .

3. dM AS(T1, T2) = dM AS(T2, T1): this is trivial.

4. For any triplet of trees T1, T2, T3, it holds that dM AS(T1, T2) + dM AS(T2, T3) ≥
dM AS(T1, T3). For simplicity, we set wi = w(Ti) and wi,j = w(M AS(Ti, Tj)).
Hence dM AS(Ti, Tj) = max{wi, wj} − wi,j. Furthermore, we denote by w1,2,3 the
weight of the maximum agreement subtree that is common to the three trees T1,
T2, T3. We then have:

dM AS(T1, T2) + dM AS(T2, T3)
= max{w1, w2} − w1,2 + max{w2, w3} − w2,3
= max{w1, w2} + max{w2, w3} − (w1,2 + w2,3 − w1,2,3 + w1,2,3)
≥ max{w1, w2, w3} + w2 − (w2 + w1,2,3)
≥ max{w1, w3} − w1,3,

where for the ﬁrst inequality, we use the fact that max{w1, w2} + max{w2, w3} ≥
max{w1, w2, w3} + w2 and we show in the next Lemma that w1,2 + w2,3 − w1,2,3
is at most w2. The last inequality uses w1,2,3 ≤ w1,3.

This concludes the proof.

Lemma. For any three set-labelled trees T1, T2, T3 (using the notation from the above
proof ) it holds that w1,2 + w2,3 − w1,2,3 ≤ w2.

37

AmoCoala

Supplementary Material

Proof. Let T1,2 and T2,3 be the MAS of T1, T2 and T2, T3, respectively. Consider any
pair of leaf, label that belongs to T2, i.e. (l, lab) ∈ T2. There are only four possibilities:
(i) (l, lab) ∈ T1,2 and (l, lab) (cid:54)∈ T2,3 (we call these leaves of type A), (ii) (l, lab) (cid:54)∈ T1,2
and (l, lab) ∈ T2,3 (we call these leaves of type B), (iii) (l, lab) ∈ T1,2 and (l, lab) ∈ T2,3
(we call these leaves of type C), (iv) (l, lab) (cid:54)∈ T1,2 and (l, lab) (cid:54)∈ T2,3 (we call these
leaves of type D). Then we have

w2 = |A| + |B| + |C| + |D|

= w12 − |C| + w23 − |C| + |C| + |D|
= w12 + w23 − |C| + |D|.

Or equivalently

(S.5)
w12 + w23 = w2 + |C| − |D|.
Moreover, we deﬁne the tree ˜T as the subtree obtained from T2 by taking all the pairs
of leaf, label that belong to T12 and T23. Notice that ˜T is also a subtree of T1 and of
T3. Thus, ˜T is included in T123. This implies that |C| ≤ w123. Going back to (S.5), we
thus obtain

w12 + w23 = w2 + |C| − |D|

≤ w2 + |C|
≤ w2 + w123.

This concludes the proof of the lemma.

Remark. The previous proof and comments show that the MAS distance dM AS is very
similar to the MAAC one (Ganapathy et al., 2005) for multi-labelled trees. Thus, it
is natural to ask whether comparing two set-labelled trees can be reduced to comparing
two multi-labelled trees. One idea is to transform a set-labelled tree into a multi-labelled
tree. However, the straightforward transformation seems not to work well for our pur-
pose. For instance, we can transform each set-labelled tree into a multi-labelled tree by
substituting each set-labelled leaf by a subtree with a ﬁxed topology (say a complete bi-
nary tree, or a multifurcating vertex) as in Figure S.1. However, in these cases the two
trees in Figure S.1 would be considered equivalent, but in our context they are diﬀerent.
In fact, the set-labelled tree in Figure S.1(a) indicates that there is a symbiont that
infects 4 diﬀerent hosts h1, h2, h3, h4, while in Figure S.1(b), we will have 4 diﬀerent
symbionts infecting each a diﬀerent host.

B.5 Polynomial time algorithm for computing the dMAS dis-

tance

We show that it is possible to calculate the distance dM AS(T1, T2) in polynomial time
with respect to the size of the trees. This boils down to computing the weight of the
maximum agreement subtree w(M AS(T1, T2)) in polynomial time. The algorithm is
based on dynamic programming and extends quite straightforwardly the algorithm for

38

AmoCoala

Supplementary Material

calculating the MAAC distance (Ganapathy et al., 2005). We abbreviate to w(v1, v2)
the weight of the maximum agreement subtree between the two trees T1 and T2 rooted
in v1 and v2, respectively. For a leaf v, we denote by l(v) the set of labels associated
with it. Finally, for an internal vertex v, we denote by ch1(v) and ch2(v) the two
children of v.

The dynamic programming algorithm starts from the leaves and ends in the roots

of T1 and T2 following a recursion. We have that w(v1, v2) is given by:

• If v1 and v2 are both leaves then w(v1, v2) = |l(v1) ∪ l(v2)|

• If v1 or v2 (could be both) are internal vertices, w(v1, v2) is the maximum value

among the following three quantities

1. max{w(ch1(v1), v2), w(ch2(v1), v2)} ;
2. max{w(v1, ch1(v2)), w(v1, ch2(v2)} ;
3. max{w(ch1(v1), ch1(v2)) + w(ch2(v1), ch2(v2)), w(ch1(v1), ch2(v2))

+w(ch2(v1), ch1(v2))}.

C Additional results for the self-test

The results for parameter values θ2 to θ8 are presented in Figures S.2a to S.3d.

D Biological datasets

We provide here a description of the 4 datasets used. The corresponding phyloge-

netic trees are shown in Figures S.4 - S.7.

Dataset 1: AP - Acacia & Pseudomyrmex. This dataset was extracted from G´omez-
Acevedo et al. (2010) and displays the interaction between Acacia plants and Pseu-
domyrmex species of ants. The host and symbiont trees include 9 and 7 leaves, respec-
tively. The dataset has 22 multiple-associations.

Dataset 2: MP - Myrmica & Phengaris. This dataset was extracted from Jansen
et al. (2011) and is composed of a pair of host and symbiont trees which have each 8
leaves. The dataset has 8 multiple-associations.

Dataset 3: SBL - Seabirds & Lice. This dataset was extracted from Paterson et al.
(1997). The host and symbiont trees include 15 and 8 leaves, respectively. The dataset
has 15 multiple-associations.

Dataset 4: SFC - Smut Fungi & Caryophillaceus plants. This dataset was extracted
from Refr´egier et al. (2008). The host and symbiont trees include 15 and 16 leaves,
respectively. The dataset has 4 multiple-associations.

D.1 Results on biological datasets

We ran AmoCoala on all the real datasets and plotted in Figures S.8 to S.19
the histograms of the summary discrepancies and event probabilities (except for the

39

AmoCoala

Supplementary Material

spread probabilities which are not inferred) obtained at the end of each one of the
3 rounds, for each of the 4 datasets. We see on the histograms that the summary
discrepancies for the accepted parameter vectors decrease after each round. We recall
that the summary discrepancy measures the similarity between the simulated trees and
the original symbiont tree, and hence is related to the quality of the vectors. Thus, our
result shows that the set of accepted vectors is reﬁned at each round, leading to vectors
which can generate trees that are increasingly more similar to the original symbiont
tree (and its host associations).

D.2 Running times

Table S.1 shows the running times obtained on the 4 biological datasets, together
with their sizes (as expressed by the number of leaves in the host and symbiont trees)
and the number of multiple associations. The results have been obtained on a com-
puter with a AMD EPYC 7542 32-Core processor and 128 CPU (2 sockets of 32 double
threads cores) and 675Gb RAM. We used just one core (’nthreads 1’, though Amo-
Coala has a parallelized version) and AmoCoala was run with default values on
these datasets.

Dataset
AP
MP
SBL
SFC

(Host,Symbiont) leaves Multiple associations Running time
23m20.859s
21m25.631s
28m53.597s
117m45.919s

(9,7)
(8,8)
(15,8)
(15,16)

22
8
15
4

Table S.1: For each of the 4 biological datasets, we indicate the pairs of numbers of
host and symbiont trees leaves (2nd column), the number of multiple associations (3rd
column) and the running time of AmoCoala on this dataset (4th column).

D.3 Robustness analysis wrt the pre-estimated spread prob-

abilities

In this section, we explore the robustness of our results with respect to the pre-
estimated values of the spread events probabilities. On each of the 4 biological datasets,
we ran AmoCoala with perturbated values of phs(h), pvs(h). More precisely, to each
non zero probability phs(h) or pvs(h), we added a noise value uniformly drawn in
[−0.1; 0.1] (and then took the inﬁmum with 1 and the supremum with 0, in order
to ensure the modiﬁed probabilities remain in [0, 1]). With these perturbed values, we
ran AmoCoala and output (after 3 rounds) 50 accepted vectors θ = (cid:104)pc, pd, ps, pl(cid:105).
The results are presented in Figures S.20 to S.23. Let us recall that AmoCoala is
a stochastic algorithm and any two runs will give similar but not identical results.
The results obtained adding these perturbations are qualitatively the same for the ﬁrst

40

AmoCoala

Supplementary Material

3 datasets (namely AP, MP and SBL) as the ones without perturbations (see Fig-
ures S.10 to S.16). The results for dataset SFC show more variability wrt those of
the unperturbed version (Figure S.19). Thus we also looked at the clusters output
by AmoCoala in this case in Table S.2. We recall that in Refr´egier et al. (2008),
the diﬀerent analyses performed indicated that the most plausible reconciliations pre-
sented for the SFC dataset have from 0 to 3 cospeciations, no duplication, 12 to 15
host switches and 0 to 2 losses. Here we ﬁnd that the ﬁrst main cluster (31 vectors
out of 50) has a representative vector with around 50% of cospeciations (about 7 or 8
events), almost no duplication (about 0 or 1 event), 31% of host switches (about 4 or 5
events) and 18% of losses (about 2 or 3 losses). The second main cluster has a higher
probability of cospeciation and less switches. Only the third cluster could correspond
to Refr´egier et al. (2008)’s scenario, with 1 or 2 cospeciations, no duplication, 8 or 9
host switches and 4 to 5 losses; though it is supported by only 3 selected vectors out
of 50. Thus for the SFC dataset, the detection of the biological scenario presented in
Refr´egier et al. (2008) is more diﬃcult to detect with perturbed values of the spread
probabilities. To conclude, our results are overall robust with respect to potential
errors in the estimation of the spread events probabilities.

References for Supplementary Material

Baudet, C., Donati, B., Sinaimeri, B., Crescenzi, P., Gautier, C., Matias, C., and Sagot,
M.-F. 2015. Cophylogeny reconstruction via an Approximate Bayesian Computation.
Systematic Biology, 64(3): 416–31.

Beaumont, M. A., Cornuet, J.-M., Marin, J.-M., and Robert, C. P. 2009. Adaptive

approximate Bayesian computation. Biometrika, 96: 983–990.

Charleston, M. A. 2002. Biological Evolution and Statistical Physics, volume 585 of
Lecture Notes in Physics, chapter Principles of cophylogenetic maps, pages 122–147.
Springer Berlin Heidelberg.

Farach-Colton, M., Przytycka, T. M., and Thorup, M. 1995. On the agreement of many

trees. Inform. Process. Lett., 55: 297–301.

Finden, C. R. and Gordon, A. D. 1985. Obtaining common pruned trees. J. Classif.,

2: 255–276.

Ganapathy, G., Goodson, B., Jansen, R., Ramachandran, V., and Warnow, T. 2005.
Pattern Identiﬁcation in Biogeography. In R. Casadio and G. Myers, editors, Algo-
rithms in Bioinformatics, volume 3692 of Lecture Notes in Computer Science, pages
116–127. Springer Berlin Heidelberg.

G´omez-Acevedo, S., Rico-Arce, L., Delgado-Salinas, A., Magall´on, S., and Eguiarte,
L. E. 2010. Neotropical mutualism between Acacia and Pseudomyrmex: Phylogeny
and divergence times. Molecular Phylogenetics and Evolution, 56(1): 393–408.

41

AmoCoala

Supplementary Material

Jansen, G., Veps¨al¨ainen, K., and Savolainen, R. 2011. A phylogenetic test of the
parasite-host associations between Maculinea butterﬂies (Lepidoptera: Lycaenidae)
and Myrmica ants (Hymenoptera: Formicidae). European Journal of Entomology,
108(1): 53–62.

Paterson, A., Gray, R. D., Clayton, D. H., and Moore, J. 1997. Host-parasite co-
speciation, host switching, and missing the boat. In D. H. Clayton and J. Moore,
editors, Host-parasite evolution: General principles and avian models, pages 236–
250. Oxford University Press.

Refr´egier, G., Le Gac, M., Jabbour, F., Widmer, A., Shykoﬀ, J. A., Yockteng, R.,
Hood, M. E., and Giraud, T. 2008. Cophylogeny of the anther smut fungi and
their caryophyllaceous hosts: Prevalence of host shifts and importance of delimiting
parasite species for inferring cospeciation. BMC Evolutionary Biology, 8(1): 100.

Stolzer, M. L., Lai, H., Xu, M., Sathaye, D., Vernot, B., and Durand, D. 2012. Inferring
duplications, losses, transfers and incomplete lineage sorting with nonbinary species
trees. Bioinformatics, 28(18): i409–i415.

Toﬁgh, A., Hallett, M. T., and Lagergren, J. 2011. Simultaneous identiﬁcation of dupli-
cations and lateral gene transfers. IEEE/ACM Trans. Comput. Biology Bioinform.,
8(2): 517–535.

42

AmoCoala

Supplementary Material

Figure S.1: The two phylogenetic trees will be considered at distance 0 if we substitute
the vertex labelled by the set h1, h2, h3, h4 by a multifurcated vertex.

(a) Results for θ2 = (cid:104)0.80, 0.15, 0.01, 0.04(cid:105).

(b) Results for θ3 = (cid:104)0.75, 0.01, 0.16, 0.08(cid:105)

(c) Results for θ4 = (cid:104)0.70, 0.05, 0.02, 0.23(cid:105).

Figure S.2: For each simulated dataset with true parameter value θi and 2 ≤ i ≤ 8,
we ran AmoCoala 50 times and, at the end of the third round, we took note of
the cluster whose representative parameter vector had the smallest euclidean distance
(histograms shown in the ﬁrst column) to θi. Columns 2 to 5 show the histograms
of the distributions of the event probabilities in these ”best” clusters. The dashed
vertical black line indicates the mean value. The solid vertical red line indicates the
true parameter value.

43

{h1, h2, h3, h4 } {h5} {h6} (a){h1} {h5} {h6} {h2} {h3} {h4} (b)0.00.20.40.60.81.0Distance0246810121416Count0.00.20.40.60.81.0Cospeciation024681012Count0.00.20.40.60.81.0Duplication024681012Count0.00.20.40.60.81.0Switch05101520253035Count0.00.20.40.60.81.0Loss0246810121416Count0.00.20.40.60.81.0Distance024681012Count0.00.20.40.60.81.0Cospeciation024681012Count0.00.20.40.60.81.0Duplication0.02.55.07.510.012.515.017.520.0Count0.00.20.40.60.81.0Switch0246810Count0.00.20.40.60.81.0Loss051015202530Count0.00.20.40.60.81.0Distance0246810Count0.00.20.40.60.81.0Cospeciation024681012Count0.00.20.40.60.81.0Duplication0.02.55.07.510.012.515.017.520.0Count0.00.20.40.60.81.0Switch0510152025Count0.00.20.40.60.81.0Loss0246810CountAmoCoala

Supplementary Material

(a) Results for θ5 = (cid:104)0.60, 0.20, 0.00, 0.20(cid:105)

(b) Results for θ6 = (cid:104)0.55, 0.00, 0.20, 0.25(cid:105).

(c) Results for θ7 = (cid:104)0.45, 0.10, 0.15, 0.30(cid:105)

(d) Results for θ8 = (cid:104)0.40, 0.20, 0.10, 0.30(cid:105).

Figure S.3: For each simulated dataset with true parameter value θi, we ran Amo-
Coala 50 times and, at the end of the third round, we took note of the cluster whose
representative parameter vector had the smallest euclidean distance (histograms shown
in the ﬁrst column) to θi. Columns 2 to 5 show the histograms of the distributions of
the event probabilities in these ”best” clusters. The dashed vertical black line indicates
the mean value. The solid vertical red line indicates the true parameter value.

44

0.00.20.40.60.81.0Distance024681012Count0.00.20.40.60.81.0Cospeciation0246810Count0.00.20.40.60.81.0Duplication024681012Count0.00.20.40.60.81.0Switch0510152025Count0.00.20.40.60.81.0Loss051015202530Count0.00.20.40.60.81.0Distance024681012Count0.00.20.40.60.81.0Cospeciation024681012Count0.00.20.40.60.81.0Duplication0246810121416Count0.00.20.40.60.81.0Switch0246810Count0.00.20.40.60.81.0Loss02468101214Count0.00.20.40.60.81.0Distance024681012Count0.00.20.40.60.81.0Cospeciation024681012Count0.00.20.40.60.81.0Duplication05101520253035Count0.00.20.40.60.81.0Switch02468101214Count0.00.20.40.60.81.0Loss0246810121416Count0.00.20.40.60.81.0Distance024681012Count0.00.20.40.60.81.0Cospeciation02468101214Count0.00.20.40.60.81.0Duplication024681012Count0.00.20.40.60.81.0Switch02468101214Count0.00.20.40.60.81.0Loss0.02.55.07.510.012.515.017.5CountAmoCoala

Supplementary Material

.
t
e
s
a
t
a
d
P
A

:
4
.
S

e
r
u
g
i
F

45

AmoCoala

Supplementary Material

.
t
e
s
a
t
a
d
P
M

:
5
.
S

e
r
u
g
i
F

46

AmoCoala

Supplementary Material

.
t
e
s
a
t
a
d

L
B
S

:
6
.
S

e
r
u
g
i
F

47

AmoCoala

Supplementary Material

.
t
e
s
a
t
a
d
C
F
S

:
7
.
S

e
r
u
g
i
F

48

AmoCoala

Supplementary Material

r
e
t
f
a

s
r
e
t
e
m
a
r
a
p

e
h
t

f
o

s

m
a
r
g
o
t
s
i

h

:

w
o
r

d
n
o
c
e
S

.
s
r
e
t
e
m
a
r
a
p

t
u
p
n
i

e
h
t

f
o

s

m
a
r
g
o
t
s
i
h

:

w
o
r

t
s
r
i
F

.
t
e
s
a
t
a
d

P
A

:
8
.
S

e
r
u
g
i
F

.
1

d
n
u
o
r

r
e
t
f
a

s
r
e
t
e
m
a
r
a
p

e
h
t

f
o

d
n
a

s
r
e
t
e
m
a
r
a
p

t
u
p
n
i

e
h
t

f
o

s
e
i
c
n
a
p
e
r
c
s
i
d

y
r
a
m
m
u
s

:

w
o
r

d
r
i
h
T

.
1

d
n
u
o
r

49

AP.nexround 1 − simulationp_cospDensity0.00.20.40.60.81.005101520253028%21%17%13%8%6%4%2%1%3AP.nexround 1 − simulationp_dupDensity0.00.20.40.60.81.005101520253028%22%17%12%9%6%3%2%1%2AP.nexround 1 − simulationp_switchDensity0.00.20.40.60.81.005101520253027%20%16%13%10%6%5%2%1%3AP.nexround 1 − simulationp_lossDensity0.00.20.40.60.81.0051015202526%23%16%13%9%7%3%2%1%2AP.nexround 1 − simulationvertical_SpreadFrequency0.00.20.40.60.81.00500100015002000AP.nexround 1 − simulationhorizontal_SpreadFrequency0.00.51.01.52.02.50200400600800AP.nexround 1 − epsilon = 0.3577p_cospDensity0.00.20.40.60.81.00510152021%12%16%12%8%12%8%8%3%1%AP.nexround 1 − epsilon = 0.3577p_dupDensity0.00.10.20.30.40.5010203040506060%22%4%6%3%1%2%1%2%1%AP.nexround 1 − epsilon = 0.3577p_switchDensity0.00.20.40.60.8051015202523%6%9%10%17%15%14%6%2%AP.nexround 1 − epsilon = 0.3577p_lossDensity0.00.20.40.60.8051015206%18%15%22%11%6%5%6%4%1%2%11%1%2%1%AP.nexround 1vertical_SpreadFrequency0.00.20.40.60.81.0050100150200AP.nexround 1horizontal_SpreadFrequency2.22.32.42.52.62.72.8010203040AP.nexround 1 − simulationDistanceDensity0.20.40.60.81.00102030405014%16%25%11%00045%AP.nexround 1 − epsilon = 0.3577DistanceDensity0.150.200.250.300.3505101520253010005%7%12%12%14%17%30%Nexus file: AP.nexHost/Parasite tree: 10/7 leavesPrior distribution: 2000 vectorsNumber of trees: 1000 treesMaximum number of trees: 5000 treesNumber of rounds: 3 roundsPerturbation: 0.0100Tolerances: 0.1000,0.2500,0.2500Simulation Model: 1 − From the root to the leaves modelCyclicity test: 2 − Donati et al., 2014.Metric: 4 − EVENTS AND MAAC−MULT. ASSOCIATIONS Metric(alpha1/alpha2): 0.7000/0.3000Alpha (cosp.,dupl.,switch,loss): (1.0000,1.0000,1.0000,1.0000)Root mapping probability: 1.0000AmoCoala

Supplementary Material

r
e
t
f
a

s
r
e
t
e
m
a
r
a
p

e
h
t

f
o

s

m
a
r
g
o
t
s
i

h

:

w
o
r

d
n
o
c
e
S

.
s
r
e
t
e
m
a
r
a
p

t
u
p
n
i

e
h
t

f
o

s

m
a
r
g
o
t
s
i
h

:

w
o
r

t
s
r
i
F

.
t
e
s
a
t
a
d

P
A

:
9
.
S

e
r
u
g
i
F

.
2

d
n
u
o
r

r
e
t
f
a

s
r
e
t
e
m
a
r
a
p

e
h
t

f
o

d
n
a

s
r
e
t
e
m
a
r
a
p

t
u
p
n
i

e
h
t

f
o

s
e
i
c
n
a
p
e
r
c
s
i
d

y
r
a
m
m
u
s

:

w
o
r

d
r
i
h
T

.
2

d
n
u
o
r

50

AP.nexround 2 − simulationp_cospDensity0.00.20.40.60.805101518%12%15%12%9%14%12%8%2%AP.nexround 2 − simulationp_dupDensity0.00.10.20.30.40.5010203040506059%25%2%8%2%1%1%1%3%1%AP.nexround 2 − simulationp_switchDensity0.00.20.40.60.80510152022%7%12%8%18%16%12%6%1%AP.nexround 2 − simulationp_lossDensity0.00.20.40.60.8051015208%17%16%22%11%7%5%6%3%1%2%11%01%1%AP.nexround 2 − simulationvertical_SpreadFrequency0.00.20.40.60.81.0050100150200AP.nexround 2 − simulationhorizontal_SpreadFrequency2.22.42.62.80204060AP.nexround 2 − epsilon = 0.2779p_cospDensity0.00.20.40.60.8051015208%14%12%14%8%12%8%18%6%AP.nexround 2 − epsilon = 0.2779p_dupDensity0.000.050.100.150.2001020304042%28%20%6%000004%AP.nexround 2 − epsilon = 0.2779p_switchDensity0.00.20.40.60.80510152020%4%10%10%2%20%20%10%4%AP.nexround 2 − epsilon = 0.2779p_lossDensity0.050.150.250510152025303514%32%8%8%10%6%2%6%6%002%4%02%AP.nexround 2vertical_SpreadFrequency0.00.20.40.60.81.001020304050AP.nexround 2horizontal_SpreadFrequency2.32.42.52.62.72.80246810AP.nexround 2 − simulationDistanceDensity0.220.260.300.340510152%3%3%4%7%9%6%7%8%2%8%16%14%14%AP.nexround 2 − epsilon = 0.2779DistanceDensity0.230.240.250.260.270.28051015208%2%8%8%4%4%10%8%20%18%10%Nexus file: AP.nexHost/Parasite tree: 10/7 leavesPrior distribution: 2000 vectorsNumber of trees: 1000 treesMaximum number of trees: 5000 treesNumber of rounds: 3 roundsPerturbation: 0.0100Tolerances: 0.1000,0.2500,0.2500Simulation Model: 1 − From the root to the leaves modelCyclicity test: 2 − Donati et al., 2014.Metric: 4 − EVENTS AND MAAC−MULT. ASSOCIATIONS Metric(alpha1/alpha2): 0.7000/0.3000Alpha (cosp.,dupl.,switch,loss): (1.0000,1.0000,1.0000,1.0000)Root mapping probability: 1.0000AmoCoala

Supplementary Material

r
e
t
f
a

s
r
e
t
e
m
a
r
a
p

e
h
t

f
o

s

m
a
r
g
o
t
s
i

h

:

w
o
r

d
n
o
c
e
S

.
s
r
e
t
e
m
a
r
a
p

t
u
p
n
i

e
h
t

f
o

s

m
a
r
g
o
t
s
i
h

:

w
o
r

t
s
r
i
F

.
t
e
s
a
t
a
d

P
A

:
0
1
.
S

e
r
u
g
i
F

.
3

d
n
u
o
r

r
e
t
f
a

s
r
e
t
e
m
a
r
a
p

e
h
t

f
o

d
n
a

s
r
e
t
e
m
a
r
a
p

t
u
p
n
i

e
h
t

f
o

s
e
i
c
n
a
p
e
r
c
s
i
d

y
r
a
m
m
u
s

:

w
o
r

d
r
i
h
T

.
3

d
n
u
o
r

51

AP.nexround 3 − simulationp_cospDensity0.00.20.40.60.805101520254%16%9%14%8%5%11%24%10%AP.nexround 3 − simulationp_dupDensity0.000.050.100.1501020304043%32%23%2%00001%AP.nexround 3 − simulationp_switchDensity0.00.20.40.60.805101520253029%2%10%7%1%17%16%10%8%AP.nexround 3 − simulationp_lossDensity0.050.100.150.200.25051015202516%25%9%15%8%10%2%4%7%1%02%1%AP.nexround 3 − simulationvertical_SpreadFrequency0.00.20.40.60.81.0050100150200AP.nexround 3 − simulationhorizontal_SpreadFrequency2.32.42.52.62.72.80102030AP.nexround 3 − epsilon = 0.2381p_cospDensity0.20.40.60.80102030406%02%04%2%00000014%44%26%2%AP.nexround 3 − epsilon = 0.2381p_dupDensity0.000.020.040.06051015204%2%6%4%6%10%12%4%18%4%14%16%AP.nexround 3 − epsilon = 0.2381p_switchDensity0.00.20.40.60.802040608086%00002%6%06%AP.nexround 3 − epsilon = 0.2381p_lossDensity0.050.100.150.200510152025308%4%2%28%10%20%10%018%AP.nexround 3vertical_SpreadFrequency0.00.20.40.60.81.001020304050AP.nexround 3horizontal_SpreadFrequency2.42.52.62.7051015202530AP.nexround 3 − simulationDistanceDensity0.200.220.240.260.2805101520251007%22%12%15%22%21%AP.nexround 3 − epsilon = 0.2381DistanceDensity0.190.200.210.220.230.24010203040502%000004%24%46%24%Nexus file: AP.nexHost/Parasite tree: 10/7 leavesPrior distribution: 2000 vectorsNumber of trees: 1000 treesMaximum number of trees: 5000 treesNumber of rounds: 3 roundsPerturbation: 0.0100Tolerances: 0.1000,0.2500,0.2500Simulation Model: 1 − From the root to the leaves modelCyclicity test: 2 − Donati et al., 2014.Metric: 4 − EVENTS AND MAAC−MULT. ASSOCIATIONS Metric(alpha1/alpha2): 0.7000/0.3000Alpha (cosp.,dupl.,switch,loss): (1.0000,1.0000,1.0000,1.0000)Root mapping probability: 1.0000AmoCoala

Supplementary Material

r
e
t
f
a

s
r
e
t
e
m
a
r
a
p

e
h
t

f
o

s

m
a
r
g
o
t
s
i

h

:

w
o
r

d
n
o
c
e
S

.
s
r
e
t
e
m
a
r
a
p

t
u
p
n
i

e
h
t

f
o

s

m
a
r
g
o
t
s
i
h

:

w
o
r

t
s
r
i
F

.
t
e
s
a
t
a
d

P
M

:
1
1
.
S

e
r
u
g
i
F

.
1

d
n
u
o
r

r
e
t
f
a

s
r
e
t
e
m
a
r
a
p

e
h
t

f
o

d
n
a

s
r
e
t
e
m
a
r
a
p

t
u
p
n
i

e
h
t

f
o

s
e
i
c
n
a
p
e
r
c
s
i
d

y
r
a
m
m
u
s

:

w
o
r

d
r
i
h
T

.
1

d
n
u
o
r

52

MP.nexround 1 − simulationp_cospDensity0.00.20.40.60.81.005101520253029%19%17%12%10%6%3%2%1%1MP.nexround 1 − simulationp_dupDensity0.00.20.40.60.81.0051015202527%23%17%12%9%7%3%2%1%2MP.nexround 1 − simulationp_switchDensity0.00.20.40.60.805101520253027%23%17%14%8%5%4%2%1%MP.nexround 1 − simulationp_lossDensity0.00.20.40.60.81.005101520253027%21%17%13%9%7%5%2%1%4MP.nexround 1 − simulationvertical_SpreadFrequency0.00.20.40.60.81.00500100015002000MP.nexround 1 − simulationhorizontal_SpreadFrequency0123402006001000MP.nexround 1 − epsilon = 0.3237p_cospDensity0.00.20.40.60.81.005101515%10%8%8%16%16%10%12%6%1%MP.nexround 1 − epsilon = 0.3237p_dupDensity0.00.10.20.30.4010203040506054%14%8%10%3%3%5%2%1%MP.nexround 1 − epsilon = 0.3237p_switchDensity0.00.10.20.30.40.50.601020304038%11%7%6%6%3%9%8%5%4%1%2%MP.nexround 1 − epsilon = 0.3237p_lossDensity0.00.10.20.30.40.50.60510152%7%8%10%12%8%18%10%9%5%6%3%3%MP.nexround 1vertical_SpreadFrequency0.00.20.40.60.81.0050100150200MP.nexround 1horizontal_SpreadFrequency2.42.62.83.03.23.43.6010203040MP.nexround 1 − simulationDistanceDensity0.20.40.60.81.001020304050601%5%17%14%1%00062%MP.nexround 1 − epsilon = 0.3237DistanceDensity0.150.200.250.30010203012%2%4%2%2%2%15%34%32%6%Nexus file: MP.nexHost/Parasite tree: 8/8 leavesPrior distribution: 2000 vectorsNumber of trees: 1000 treesMaximum number of trees: 5000 treesNumber of rounds: 3 roundsPerturbation: 0.0100Tolerances: 0.1000,0.2500,0.2500Simulation Model: 1 − From the root to the leaves modelCyclicity test: 2 − Donati et al., 2014.Metric: 4 − EVENTS AND MAAC−MULT. ASSOCIATIONS Metric(alpha1/alpha2): 0.7000/0.3000Alpha (cosp.,dupl.,switch,loss): (1.0000,1.0000,1.0000,1.0000)Root mapping probability: 1.0000AmoCoala

Supplementary Material

r
e
t
f
a

s
r
e
t
e
m
a
r
a
p

e
h
t

f
o

s

m
a
r
g
o
t
s
i

h

:

w
o
r

d
n
o
c
e
S

.
s
r
e
t
e
m
a
r
a
p

t
u
p
n
i

e
h
t

f
o

s

m
a
r
g
o
t
s
i
h

:

w
o
r

t
s
r
i
F

.
t
e
s
a
t
a
d

P
M

:
2
1
.
S

e
r
u
g
i
F

.
2

d
n
u
o
r

r
e
t
f
a

s
r
e
t
e
m
a
r
a
p

e
h
t

f
o

d
n
a

s
r
e
t
e
m
a
r
a
p

t
u
p
n
i

e
h
t

f
o

s
e
i
c
n
a
p
e
r
c
s
i
d

y
r
a
m
m
u
s

:

w
o
r

d
r
i
h
T

.
2

d
n
u
o
r

53

MP.nexround 2 − simulationp_cospDensity0.00.20.40.60.81.00510152017%9%8%5%20%9%10%14%9%1%MP.nexround 2 − simulationp_dupDensity0.00.10.20.30.401020304050607064%8%7%11%3%2%3%2%MP.nexround 2 − simulationp_switchDensity0.00.10.20.30.40.50.601020304036%10%5%8%5%5%7%9%5%7%12%MP.nexround 2 − simulationp_lossDensity0.00.10.20.30.40.50.60510154%6%9%10%9%12%16%9%9%6%5%5%MP.nexround 2 − simulationvertical_SpreadFrequency0.00.20.40.60.81.0050100150200MP.nexround 2 − simulationhorizontal_SpreadFrequency2.42.62.83.03.23.43.6010203040MP.nexround 2 − epsilon = 0.2748p_cospDensity0.00.20.40.60.81.00510152025303510%6%6%4%14%6%6%14%32%2%MP.nexround 2 − epsilon = 0.2748p_dupDensity0.00.10.20.30.402040608010094%4%000002%MP.nexround 2 − epsilon = 0.2748p_switchDensity0.00.10.20.30.40.50.60102030405052%14%002%6%4%2%4%12%2%2%MP.nexround 2 − epsilon = 0.2748p_lossDensity0.00.10.20.30.40.50.605101514%10%14%8%10%14%10%4%8%02%6%MP.nexround 2vertical_SpreadFrequency0.00.20.40.60.81.001020304050MP.nexround 2horizontal_SpreadFrequency2.42.62.83.03.23.43.6051015MP.nexround 2 − simulationDistanceDensity0.150.200.250.30010203013%5%4%2%1%1%18%34%31%2%MP.nexround 2 − epsilon = 0.2748DistanceDensity0.150.200.2505101520252%4%8%6%12%2%12%4%4%4%004%24%14%Nexus file: MP.nexHost/Parasite tree: 8/8 leavesPrior distribution: 2000 vectorsNumber of trees: 1000 treesMaximum number of trees: 5000 treesNumber of rounds: 3 roundsPerturbation: 0.0100Tolerances: 0.1000,0.2500,0.2500Simulation Model: 1 − From the root to the leaves modelCyclicity test: 2 − Donati et al., 2014.Metric: 4 − EVENTS AND MAAC−MULT. ASSOCIATIONS Metric(alpha1/alpha2): 0.7000/0.3000Alpha (cosp.,dupl.,switch,loss): (1.0000,1.0000,1.0000,1.0000)Root mapping probability: 1.0000AmoCoala

Supplementary Material

r
e
t
f
a

s
r
e
t
e
m
a
r
a
p

e
h
t

f
o

s

m
a
r
g
o
t
s
i

h

:

w
o
r

d
n
o
c
e
S

.
s
r
e
t
e
m
a
r
a
p

t
u
p
n
i

e
h
t

f
o

s

m
a
r
g
o
t
s
i
h

:

w
o
r

t
s
r
i
F

.
t
e
s
a
t
a
d

P
M

:
3
1
.
S

e
r
u
g
i
F

.
3

d
n
u
o
r

r
e
t
f
a

s
r
e
t
e
m
a
r
a
p

e
h
t

f
o

d
n
a

s
r
e
t
e
m
a
r
a
p

t
u
p
n
i

e
h
t

f
o

s
e
i
c
n
a
p
e
r
c
s
i
d

y
r
a
m
m
u
s

:

w
o
r

d
r
i
h
T

.
3

d
n
u
o
r

54

MP.nexround 3 − simulationp_cospDensity0.00.20.40.60.81.00102030408%6%4%5%10%3%6%15%40%2%MP.nexround 3 − simulationp_dupDensity0.00.10.20.30.402040608010092%6%000001%2%MP.nexround 3 − simulationp_switchDensity0.00.10.20.30.40.50.6010203040506054%18%0017%2%1%4%9%2%3%MP.nexround 3 − simulationp_lossDensity0.00.10.20.30.40.50.605101518%13%11%10%9%12%8%4%8%01%6%MP.nexround 3 − simulationvertical_SpreadFrequency0.00.20.40.60.81.0050100150200MP.nexround 3 − simulationhorizontal_SpreadFrequency2.62.83.03.23.43.6010203040MP.nexround 3 − epsilon = 0.1666p_cospDensity0.840.860.880.90051015202%8%2%4%6%2%2%6%18%12%14%10%8%6%MP.nexround 3 − epsilon = 0.1666p_dupDensity0.010.020.030.040.050.0605101520252%4%8%20%24%8%14%6%2%10%2%MP.nexround 3 − epsilon = 0.1666p_switchDensity0.020.030.040.050.060.0705101520252%4%8%14%24%18%6%6%16%2%MP.nexround 3 − epsilon = 0.1666p_lossDensity0.0250.0350.0450.0550510152025302%4%12%24%28%22%8%MP.nexround 3vertical_SpreadFrequency0.00.20.40.60.81.001020304050MP.nexround 3horizontal_SpreadFrequency3.403.453.503.550246810MP.nexround 3 − simulationDistanceDensity0.150.200.250510152013%8%10%5%14%8%8%2%5%3%01%2%19%13%MP.nexround 3 − epsilon = 0.1666DistanceDensity0.130.140.150.160.1705101520252%2%10%8%24%22%18%10%4%Nexus file: MP.nexHost/Parasite tree: 8/8 leavesPrior distribution: 2000 vectorsNumber of trees: 1000 treesMaximum number of trees: 5000 treesNumber of rounds: 3 roundsPerturbation: 0.0100Tolerances: 0.1000,0.2500,0.2500Simulation Model: 1 − From the root to the leaves modelCyclicity test: 2 − Donati et al., 2014.Metric: 4 − EVENTS AND MAAC−MULT. ASSOCIATIONS Metric(alpha1/alpha2): 0.7000/0.3000Alpha (cosp.,dupl.,switch,loss): (1.0000,1.0000,1.0000,1.0000)Root mapping probability: 1.0000AmoCoala

Supplementary Material

r
e
t
f
a

s
r
e
t
e
m
a
r
a
p

e
h
t

f
o

s

m
a
r
g
o
t
s
i

h

:

w
o
r

d
n
o
c
e
S

.
s
r
e
t
e
m
a
r
a
p

t
u
p
n
i

e
h
t

f
o

s

m
a
r
g
o
t
s
i
h

:

w
o
r

t
s
r
i
F

.
t
e
s
a
t
a
d

L
B
S

:
4
1
.
S

e
r
u
g
i
F

.
1

d
n
u
o
r

r
e
t
f
a

s
r
e
t
e
m
a
r
a
p

e
h
t

f
o

d
n
a

s
r
e
t
e
m
a
r
a
p

t
u
p
n
i

e
h
t

f
o

s
e
i
c
n
a
p
e
r
c
s
i
d

y
r
a
m
m
u
s

:

w
o
r

d
r
i
h
T

.
1

d
n
u
o
r

55

SBL.nexround 1 − simulationp_cospDensity0.00.20.40.60.805101520253029%21%17%13%9%6%3%2%7SBL.nexround 1 − simulationp_dupDensity0.00.20.40.60.81.0051015202526%22%17%12%9%6%4%2%1%4SBL.nexround 1 − simulationp_switchDensity0.00.20.40.60.81.005101520253027%21%17%13%9%6%4%2%1%3SBL.nexround 1 − simulationp_lossDensity0.00.20.40.60.81.0051015202527%21%17%13%10%7%3%1%1%1SBL.nexround 1 − simulationvertical_SpreadFrequency0.00.20.40.60.81.00200400600800SBL.nexround 1 − simulationhorizontal_SpreadFrequency012340200400600800SBL.nexround 1 − epsilon = 0.2713p_cospDensity0.00.20.40.60.80510152010%10%9%8%10%13%20%18%4%SBL.nexround 1 − epsilon = 0.2713p_dupDensity0.00.10.20.30.4010203040506062%15%7%7%5%2%1%1%SBL.nexround 1 − epsilon = 0.2713p_switchDensity0.00.20.40.60510152020%3%7%7%6%6%8%5%6%5%8%6%5%5%4%SBL.nexround 1 − epsilon = 0.2713p_lossDensity0.00.10.20.30.40.5051015202516%18%23%15%11%10%5%1%01%SBL.nexround 1vertical_SpreadFrequency0.40.60.81.0020406080100SBL.nexround 1horizontal_SpreadFrequency1.52.02.53.03.54.04.5020406080SBL.nexround 1 − simulationDistanceDensity0.20.40.60.81.00102030402%13%33%11%1%00040%SBL.nexround 1 − epsilon = 0.2713DistanceDensity0.100.150.200.2505101520251%02%6%12%21%23%19%17%Nexus file: SBL.nexHost/Parasite tree: 15/8 leavesPrior distribution: 2000 vectorsNumber of trees: 1000 treesMaximum number of trees: 5000 treesNumber of rounds: 3 roundsPerturbation: 0.0100Tolerances: 0.1000,0.2500,0.2500Simulation Model: 1 − From the root to the leaves modelCyclicity test: 2 − Donati et al., 2014.Metric: 4 − EVENTS AND MAAC−MULT. ASSOCIATIONS Metric(alpha1/alpha2): 0.7000/0.3000Alpha (cosp.,dupl.,switch,loss): (1.0000,1.0000,1.0000,1.0000)Root mapping probability: 1.0000AmoCoala

Supplementary Material

r
e
t
f
a

s
r
e
t
e
m
a
r
a
p

e
h
t

f
o

s

m
a
r
g
o
t
s
i

h

:

w
o
r

d
n
o
c
e
S

.
s
r
e
t
e
m
a
r
a
p

t
u
p
n
i

e
h
t

f
o

s

m
a
r
g
o
t
s
i
h

:

w
o
r

t
s
r
i
F

.
t
e
s
a
t
a
d

L
B
S

:
5
1
.
S

e
r
u
g
i
F

.
2

d
n
u
o
r

r
e
t
f
a

s
r
e
t
e
m
a
r
a
p

e
h
t

f
o

d
n
a

s
r
e
t
e
m
a
r
a
p

t
u
p
n
i

e
h
t

f
o

s
e
i
c
n
a
p
e
r
c
s
i
d

y
r
a
m
m
u
s

:

w
o
r

d
r
i
h
T

.
2

d
n
u
o
r

56

SBL.nexround 2 − simulationp_cospDensity0.00.20.40.60.805101520256%11%7%7%8%15%23%21%3%SBL.nexround 2 − simulationp_dupDensity0.00.10.20.30.401020304050607064%11%5%10%6%3%01%SBL.nexround 2 − simulationp_switchDensity0.00.20.40.6051015202524%2%8%8%7%6%8%6%3%3%5%8%4%5%3%SBL.nexround 2 − simulationp_lossDensity0.00.10.20.30.4051015202515%24%23%14%12%7%4%1%SBL.nexround 2 − simulationvertical_SpreadFrequency0.40.60.81.0020406080100SBL.nexround 2 − simulationhorizontal_SpreadFrequency1.52.02.53.03.54.04.50102030405060SBL.nexround 2 − epsilon = 0.2079p_cospDensity0.00.20.40.60.801020302%18%6%8%02%20%34%10%SBL.nexround 2 − epsilon = 0.2079p_dupDensity0.000.050.100.150.2001020304036%36%16%4%002%02%2%02%SBL.nexround 2 − epsilon = 0.2079p_switchDensity0.00.20.40.60510152020%2%2%8%10%14%8%2%008%06%14%6%SBL.nexround 2 − epsilon = 0.2079p_lossDensity0.000.050.100.150.200510152010%20%12%16%8%12%6%8%6%002%SBL.nexround 2vertical_SpreadFrequency0.850.900.951.001.051.10051015SBL.nexround 2horizontal_SpreadFrequency2.53.03.54.002468SBL.nexround 2 − simulationDistanceDensity0.100.150.200.2505101520251%12%6%11%23%22%21%15%SBL.nexround 2 − epsilon = 0.2079DistanceDensity0.100.120.140.160.180.2005101520252%2%2%08%08%14%16%26%22%Nexus file: SBL.nexHost/Parasite tree: 15/8 leavesPrior distribution: 2000 vectorsNumber of trees: 1000 treesMaximum number of trees: 5000 treesNumber of rounds: 3 roundsPerturbation: 0.0100Tolerances: 0.1000,0.2500,0.2500Simulation Model: 1 − From the root to the leaves modelCyclicity test: 2 − Donati et al., 2014.Metric: 4 − EVENTS AND MAAC−MULT. ASSOCIATIONS Metric(alpha1/alpha2): 0.7000/0.3000Alpha (cosp.,dupl.,switch,loss): (1.0000,1.0000,1.0000,1.0000)Root mapping probability: 1.0000AmoCoala

Supplementary Material

r
e
t
f
a

s
r
e
t
e
m
a
r
a
p

e
h
t

f
o

s

m
a
r
g
o
t
s
i

h

:

w
o
r

d
n
o
c
e
S

.
s
r
e
t
e
m
a
r
a
p

t
u
p
n
i

e
h
t

f
o

s

m
a
r
g
o
t
s
i
h

:

w
o
r

t
s
r
i
F

.
t
e
s
a
t
a
d

L
B
S

:
6
1
.
S

e
r
u
g
i
F

.
3

d
n
u
o
r

r
e
t
f
a

s
r
e
t
e
m
a
r
a
p

e
h
t

f
o

d
n
a

s
r
e
t
e
m
a
r
a
p

t
u
p
n
i

e
h
t

f
o

s
e
i
c
n
a
p
e
r
c
s
i
d

y
r
a
m
m
u
s

:

w
o
r

d
r
i
h
T

.
3

d
n
u
o
r

57

SBL.nexround 3 − simulationp_cospDensity0.00.20.40.60.801020302%20%6%6%0023%36%9%SBL.nexround 3 − simulationp_dupDensity0.000.050.100.150.2001020304034%42%18%4%00101%11%SBL.nexround 3 − simulationp_switchDensity0.00.20.40.605101515%2%1%15%12%16%5%1%005%15%15%8%SBL.nexround 3 − simulationp_lossDensity0.000.050.100.150.2005101516%14%17%11%5%11%9%8%7%102%SBL.nexround 3 − simulationvertical_SpreadFrequency0.800.901.001.10020406080SBL.nexround 3 − simulationhorizontal_SpreadFrequency2.53.03.54.005101520253035SBL.nexround 3 − epsilon = 0.1670p_cospDensity0.20.40.60.80102030406%000000002%42%44%4%02%SBL.nexround 3 − epsilon = 0.1670p_dupDensity0.000.020.040.06051015206%002%16%20%22%10%14%004%2%2%2%SBL.nexround 3 − epsilon = 0.1670p_switchDensity0.00.20.40.60102030402%0014%36%40%2%0000002%4%SBL.nexround 3 − epsilon = 0.1670p_lossDensity0.000.050.100.15010203034%30%16%10%2%02%0000002%4%SBL.nexround 3vertical_SpreadFrequency0.961.001.041.0805101520SBL.nexround 3horizontal_SpreadFrequency3.03.43.84.205101520SBL.nexround 3 − simulationDistanceDensity0.100.120.140.160.180.200510152014%3%3%6%3%6%15%22%22%15%SBL.nexround 3 − epsilon = 0.1670DistanceDensity0.110.130.150.170510152%10%8%6%6%10%4%12%12%10%2%14%4%Nexus file: SBL.nexHost/Parasite tree: 15/8 leavesPrior distribution: 2000 vectorsNumber of trees: 1000 treesMaximum number of trees: 5000 treesNumber of rounds: 3 roundsPerturbation: 0.0100Tolerances: 0.1000,0.2500,0.2500Simulation Model: 1 − From the root to the leaves modelCyclicity test: 2 − Donati et al., 2014.Metric: 4 − EVENTS AND MAAC−MULT. ASSOCIATIONS Metric(alpha1/alpha2): 0.7000/0.3000Alpha (cosp.,dupl.,switch,loss): (1.0000,1.0000,1.0000,1.0000)Root mapping probability: 1.0000AmoCoala

Supplementary Material

r
e
t
f
a

s
r
e
t
e
m
a
r
a
p

e
h
t

f
o

s

m
a
r
g
o
t
s
i

h

:

w
o
r

d
n
o
c
e
S

.
s
r
e
t
e
m
a
r
a
p

t
u
p
n
i

e
h
t

f
o

s

m
a
r
g
o
t
s
i
h

:

w
o
r

t
s
r
i
F

.
t
e
s
a
t
a
d

C
F
S

:
7
1
.
S

e
r
u
g
i
F

.
1

d
n
u
o
r

r
e
t
f
a

s
r
e
t
e
m
a
r
a
p

e
h
t

f
o

d
n
a

s
r
e
t
e
m
a
r
a
p

t
u
p
n
i

e
h
t

f
o

s
e
i
c
n
a
p
e
r
c
s
i
d

y
r
a
m
m
u
s

:

w
o
r

d
r
i
h
T

.
1

d
n
u
o
r

58

SFC.nexround 1 − simulationp_cospDensity0.00.20.40.60.805101520253028%23%17%12%8%6%4%2%1%SFC.nexround 1 − simulationp_dupDensity0.00.20.40.60.81.005101520253028%20%17%12%9%7%4%2%1%3SFC.nexround 1 − simulationp_switchDensity0.00.20.40.60.81.0051015202527%23%17%13%8%6%4%2%1%2SFC.nexround 1 − simulationp_lossDensity0.00.20.40.60.81.005101520253027%20%17%13%10%6%4%2%1%1SFC.nexround 1 − simulationvertical_SpreadFrequency0.00.51.01.502004006008001200SFC.nexround 1 − simulationhorizontal_SpreadFrequency01234560200400600800SFC.nexround 1 − epsilon = 0.2781p_cospDensity0.00.20.40.60.8051015204%4%5%13%12%22%19%14%8%SFC.nexround 1 − epsilon = 0.2781p_dupDensity0.000.100.200.300510152021%14%20%9%11%6%5%2%6%3%1%1%1%11%SFC.nexround 1 − epsilon = 0.2781p_switchDensity0.00.10.20.30.40.50.60510152018%11%13%11%10%8%7%7%6%3%3%2%2%SFC.nexround 1 − epsilon = 0.2781p_lossDensity0.00.10.20.30.40.5051015208%12%20%17%20%12%9%1%01%1%SFC.nexround 1vertical_SpreadFrequency0.40.60.81.01.21.405101520253035SFC.nexround 1horizontal_SpreadFrequency23456010203040506070SFC.nexround 1 − simulationDistanceDensity0.20.40.60.81.00102030405060514%17%9%3%40057%SFC.nexround 1 − epsilon = 0.2781DistanceDensity0.180.200.220.240.260.2805101520253011%1%4%6%4%5%8%20%29%22%Nexus file: SFC.nexHost/Parasite tree: 18/16 leavesPrior distribution: 2000 vectorsNumber of trees: 1000 treesMaximum number of trees: 5000 treesNumber of rounds: 3 roundsPerturbation: 0.0100Tolerances: 0.1000,0.2500,0.2500Simulation Model: 1 − From the root to the leaves modelCyclicity test: 2 − Donati et al., 2014.Metric: 4 − EVENTS AND MAAC−MULT. ASSOCIATIONS Metric(alpha1/alpha2): 0.7000/0.3000Alpha (cosp.,dupl.,switch,loss): (1.0000,1.0000,1.0000,1.0000)Root mapping probability: 1.0000AmoCoala

Supplementary Material

r
e
t
f
a

s
r
e
t
e
m
a
r
a
p

e
h
t

f
o

s

m
a
r
g
o
t
s
i

h

:

w
o
r

d
n
o
c
e
S

.
s
r
e
t
e
m
a
r
a
p

t
u
p
n
i

e
h
t

f
o

s

m
a
r
g
o
t
s
i
h

:

w
o
r

t
s
r
i
F

.
t
e
s
a
t
a
d

C
F
S

:
8
1
.
S

e
r
u
g
i
F

.
2

d
n
u
o
r

r
e
t
f
a

s
r
e
t
e
m
a
r
a
p

e
h
t

f
o

d
n
a

s
r
e
t
e
m
a
r
a
p

t
u
p
n
i

e
h
t

f
o

s
e
i
c
n
a
p
e
r
c
s
i
d

y
r
a
m
m
u
s

:

w
o
r

d
r
i
h
T

.
2

d
n
u
o
r

59

SFC.nexround 2 − simulationp_cospDensity0.00.20.40.60.8051015204%3%8%11%14%18%19%16%9%SFC.nexround 2 − simulationp_dupDensity0.000.100.200.30051015202526%12%16%14%10%7%2%3%6%1%001%101SFC.nexround 2 − simulationp_switchDensity0.00.10.20.30.40.50.60510152019%8%14%10%11%9%7%6%4%5%3%2%2%SFC.nexround 2 − simulationp_lossDensity0.00.10.20.30.405101520257%12%21%14%27%7%10%3%SFC.nexround 2 − simulationvertical_SpreadFrequency0.40.60.81.01.21.4010203040SFC.nexround 2 − simulationhorizontal_SpreadFrequency23456010203040506070SFC.nexround 2 − epsilon = 0.2369p_cospDensity0.00.20.40.60.8051015202%10%4%12%6%2%22%20%22%SFC.nexround 2 − epsilon = 0.2369p_dupDensity0.000.050.100.150.200.25010203040506058%4%6%8%6%6%04%4%2%002%SFC.nexround 2 − epsilon = 0.2369p_switchDensity0.00.10.20.30.40.50.60510152025303532%4%18%6%10%2%2%4%6%4%4%08%SFC.nexround 2 − epsilon = 0.2369p_lossDensity0.00.10.20.30.405101520253018%6%28%10%18%8%10%2%SFC.nexround 2vertical_SpreadFrequency0.60.81.01.21.40246810SFC.nexround 2horizontal_SpreadFrequency2.53.03.54.04.55.05.5024681012SFC.nexround 2 − simulationDistanceDensity0.160.200.240.280510152025303511%02%3%5%7%8%12%18%33%12%SFC.nexround 2 − epsilon = 0.2369DistanceDensity0.180.200.220.24051015202%02%008%2%6%6%12%8%16%10%20%8%Nexus file: SFC.nexHost/Parasite tree: 18/16 leavesPrior distribution: 2000 vectorsNumber of trees: 1000 treesMaximum number of trees: 5000 treesNumber of rounds: 3 roundsPerturbation: 0.0100Tolerances: 0.1000,0.2500,0.2500Simulation Model: 1 − From the root to the leaves modelCyclicity test: 2 − Donati et al., 2014.Metric: 4 − EVENTS AND MAAC−MULT. ASSOCIATIONS Metric(alpha1/alpha2): 0.7000/0.3000Alpha (cosp.,dupl.,switch,loss): (1.0000,1.0000,1.0000,1.0000)Root mapping probability: 1.0000AmoCoala

Supplementary Material

r
e
t
f
a

s
r
e
t
e
m
a
r
a
p

e
h
t

f
o

s

m
a
r
g
o
t
s
i

h

:

w
o
r

d
n
o
c
e
S

.
s
r
e
t
e
m
a
r
a
p

t
u
p
n
i

e
h
t

f
o

s

m
a
r
g
o
t
s
i
h

:

w
o
r

t
s
r
i
F

.
t
e
s
a
t
a
d

C
F
S

:
9
1
.
S

e
r
u
g
i
F

.
3

d
n
u
o
r

r
e
t
f
a

s
r
e
t
e
m
a
r
a
p

e
h
t

f
o

d
n
a

s
r
e
t
e
m
a
r
a
p

t
u
p
n
i

e
h
t

f
o

s
e
i
c
n
a
p
e
r
c
s
i
d

y
r
a
m
m
u
s

:

w
o
r

d
r
i
h
T

.
3

d
n
u
o
r

60

SFC.nexround 3 − simulationp_cospDensity0.00.20.40.60.805101520251%8%4%11%5%124%22%26%SFC.nexround 3 − simulationp_dupDensity0.000.050.100.150.200.25010203040506060%4%6%8%3%7%1%4%3%1%01%2%SFC.nexround 3 − simulationp_switchDensity0.00.10.20.30.40.50.605101520253030%3%21%11%8%3%1%6%5%3%1%18%SFC.nexround 3 − simulationp_lossDensity0.00.10.20.30.40510152025303520%8%32%7%17%5%10%1%SFC.nexround 3 − simulationvertical_SpreadFrequency0.60.81.01.21.4010203040SFC.nexround 3 − simulationhorizontal_SpreadFrequency2.53.54.55.501020304050SFC.nexround 3 − epsilon = 0.2041p_cospDensity0.00.20.40.60.80102030402%12%2%6%2%018%20%38%SFC.nexround 3 − epsilon = 0.2041p_dupDensity0.000.040.080.12010203040506062%12%2%0002%4%2%2%6%8%SFC.nexround 3 − epsilon = 0.2041p_switchDensity0.00.10.20.30.40.50.60510152025303528%032%12%4%2%002%4%02%14%SFC.nexround 3 − epsilon = 0.2041p_lossDensity0.00.10.20.30.401020304030%4%38%8%18%002%SFC.nexround 3vertical_SpreadFrequency0.60.81.01.21.4024681012SFC.nexround 3horizontal_SpreadFrequency3.03.54.04.55.05.5051015SFC.nexround 3 − simulationDistanceDensity0.160.180.200.220.2405101520251%2%1%6%8%16%26%24%18%SFC.nexround 3 − epsilon = 0.2041DistanceDensity0.150.160.170.180.190.2001020302%2%2%4%4%04%18%14%16%34%Nexus file: SFC.nexHost/Parasite tree: 18/16 leavesPrior distribution: 2000 vectorsNumber of trees: 1000 treesMaximum number of trees: 5000 treesNumber of rounds: 3 roundsPerturbation: 0.0100Tolerances: 0.1000,0.2500,0.2500Simulation Model: 1 − From the root to the leaves modelCyclicity test: 2 − Donati et al., 2014.Metric: 4 − EVENTS AND MAAC−MULT. ASSOCIATIONS Metric(alpha1/alpha2): 0.7000/0.3000Alpha (cosp.,dupl.,switch,loss): (1.0000,1.0000,1.0000,1.0000)Root mapping probability: 1.0000AmoCoala

Supplementary Material

:

w
o
r

d
n
o
c
e
S

.
s
r
e
t
e
m
a
r
a
p

t
u
p
n

i

e
h
t

f
o

s

m
a
r
g
o
t
s
i

h

:

w
o
r

t
s
r
i
F

.
s
e
i
t
i
l
i
b
a
b
o
r
p

d
a
e
r
p
s

d
e
t
a
b
r
u
t
r
e
p

h
t
i
w
t
e
s
a
t
a
d

P
A

:
0
2
.
S

e
r
u
g
i
F

s
r
e
t
e
m
a
r
a
p
e
h
t

f
o
d
n
a

s
r
e
t
e
m
a
r
a
p
t
u
p
n

i

e
h
t

f
o

s
e
i
c
n
a
p
e
r
c
s
i
d
y
r
a
m
m
u
s

:

w
o
r
d
r
i
h
T

.
1

d
n
u
o
r

r
e
t
f
a

s
r
e
t
e
m
a
r
a
p
e
h
t

f
o

s

m
a
r
g
o
t
s
i
h

.
1

d
n
u
o
r

r
e
t
f
a

61

AP.nexround 3 − simulationp_cospDensity0.00.20.40.60.8010203018%34%5%05%3%14%8%12%AP.nexround 3 − simulationp_dupDensity0.000.050.100.1501020304039%27%20%7%1%001%5%AP.nexround 3 − simulationp_switchDensity0.00.20.40.60510152018%16%00002%1%6%0012%8%18%20%AP.nexround 3 − simulationp_lossDensity0.050.150.250.350510152%10%13%13%12%12%4%3%04%9%10%7%1%1AP.nexround 3 − simulationvertical_SpreadFrequency0.00.20.40.60.81.0050100150200AP.nexround 3 − simulationhorizontal_SpreadFrequency2.32.42.52.62.7010203040AP.nexround 3 − epsilon = 0.2536p_cospDensity0.20.40.60.8010203040506%6%000000002%6%2%30%48%AP.nexround 3 − epsilon = 0.2536p_dupDensity0.000.020.040.06051015208%16%14%20%12%6%4%4%2%6%4%4%AP.nexround 3 − epsilon = 0.2536p_switchDensity0.00.20.40.60102030405038%50%000000000004%8%AP.nexround 3 − epsilon = 0.2536p_lossDensity0.100.150.200.250.3005101520253016%4%28%22%4%8%10%0006%2%AP.nexround 3vertical_SpreadFrequency0.00.20.40.60.81.001020304050AP.nexround 3horizontal_SpreadFrequency2.32.42.52.62.705101520AP.nexround 3 − simulationDistanceDensity0.180.220.260.3005101520252%0009%10%1%14%11%26%18%10%AP.nexround 3 − epsilon = 0.2536DistanceDensity0.180.200.220.24051015202530356%00000002%32%22%20%04%14%Nexus file: AP.nexHost/Parasite tree: 10/7 leavesPrior distribution: 2000 vectorsNumber of trees: 1000 treesMaximum number of trees: 5000 treesNumber of rounds: 3 roundsPerturbation: 0.0100Tolerances: 0.1000,0.2500,0.2500Simulation Model: 1 − From the root to the leaves modelCyclicity test: 2 − Donati et al., 2014.Metric: 4 − EVENTS AND MAAC−MULT. ASSOCIATIONS Metric(alpha1/alpha2): 0.7000/0.3000Alpha (cosp.,dupl.,switch,loss): (1.0000,1.0000,1.0000,1.0000)Root mapping probability: 1.0000AmoCoala

Supplementary Material

:

w
o
r

d
n
o
c
e
S

.
s
r
e
t
e
m
a
r
a
p

t
u
p
n

i

e
h
t

f
o

s

m
a
r
g
o
t
s
i

h

:

w
o
r

t
s
r
i
F

.
s
e
i
t
i
l
i
b
a
b
o
r
p

d
a
e
r
p
s

d
e
t
a
b
r
u
t
r
e
p

h
t
i
w
t
e
s
a
t
a
d
P
M

:
1
2
.
S

e
r
u
g
i
F

s
r
e
t
e
m
a
r
a
p
e
h
t

f
o
d
n
a

s
r
e
t
e
m
a
r
a
p
t
u
p
n

i

e
h
t

f
o

s
e
i
c
n
a
p
e
r
c
s
i
d
y
r
a
m
m
u
s

:

w
o
r
d
r
i
h
T

.
1

d
n
u
o
r

r
e
t
f
a

s
r
e
t
e
m
a
r
a
p
e
h
t

f
o

s

m
a
r
g
o
t
s
i
h

.
1

d
n
u
o
r

r
e
t
f
a

62

MP.nexround 3 − simulationp_cospDensity0.00.20.40.60.81.00510152011%12%7%6%4%9%8%16%19%8%MP.nexround 3 − simulationp_dupDensity0.000.020.040.060.080.10051015202516%17%23%13%14%11%1%1%3%02%MP.nexround 3 − simulationp_switchDensity0.00.10.20.30.40.50.60102030405050%4%05%03%1%4%3%6%10%7%7%MP.nexround 3 − simulationp_lossDensity0.00.10.20.30.40510152010%14%5%13%21%21%3%12%1%MP.nexround 3 − simulationvertical_SpreadFrequency0.00.20.40.60.81.0050100150200MP.nexround 3 − simulationhorizontal_SpreadFrequency3.03.23.43.63.8010203040MP.nexround 3 − epsilon = 0.1722p_cospDensity0.750.800.850.9001020304014%008%36%4%06%26%6%MP.nexround 3 − epsilon = 0.1722p_dupDensity0.000.020.040.060510156%12%2%6%16%14%2%2%6%10%12%10%2%MP.nexround 3 − epsilon = 0.1722p_switchDensity0.010.030.05051015202530356%4%8%6%8%8%32%4%10%4%4%6%MP.nexround 3 − epsilon = 0.1722p_lossDensity0.000.050.100.1505101520253022%16%0030%4%010%18%MP.nexround 3vertical_SpreadFrequency0.00.20.40.60.81.001020304050MP.nexround 3horizontal_SpreadFrequency3.403.503.603.700246810MP.nexround 3 − simulationDistanceDensity0.100.150.200.25051015202530353%6%121%12%8%17%33%1MP.nexround 3 − epsilon = 0.1722DistanceDensity0.100.120.140.160510152025304%4%4%08%8%6%4%0002%4%28%28%Nexus file: MP.nexHost/Parasite tree: 8/8 leavesPrior distribution: 2000 vectorsNumber of trees: 1000 treesMaximum number of trees: 5000 treesNumber of rounds: 3 roundsPerturbation: 0.0100Tolerances: 0.1000,0.2500,0.2500Simulation Model: 1 − From the root to the leaves modelCyclicity test: 2 − Donati et al., 2014.Metric: 4 − EVENTS AND MAAC−MULT. ASSOCIATIONS Metric(alpha1/alpha2): 0.7000/0.3000Alpha (cosp.,dupl.,switch,loss): (1.0000,1.0000,1.0000,1.0000)Root mapping probability: 1.0000AmoCoala

Supplementary Material

:

w
o
r

d
n
o
c
e
S

.
s
r
e
t
e
m
a
r
a
p

t
u
p
n

i

e
h
t

f
o

s

m
a
r
g
o
t
s
i

h

:

w
o
r

t
s
r
i
F

.
s
e
i
t
i
l
i
b
a
b
o
r
p

d
a
e
r
p
s

d
e
t
a
b
r
u
t
r
e
p

h
t
i
w
t
e
s
a
t
a
d

L
B
S

:
2
2
.
S

e
r
u
g
i
F

s
r
e
t
e
m
a
r
a
p
e
h
t

f
o
d
n
a

s
r
e
t
e
m
a
r
a
p
t
u
p
n

i

e
h
t

f
o

s
e
i
c
n
a
p
e
r
c
s
i
d
y
r
a
m
m
u
s

:

w
o
r
d
r
i
h
T

.
1

d
n
u
o
r

r
e
t
f
a

s
r
e
t
e
m
a
r
a
p
e
h
t

f
o

s

m
a
r
g
o
t
s
i
h

.
1

d
n
u
o
r

r
e
t
f
a

63

SBL.nexround 3 − simulationp_cospDensity0.00.20.40.60.801020308%7%2%2%6%12%35%16%13%SBL.nexround 3 − simulationp_dupDensity0.000.050.100.150.200102030405048%20%13%8%10009%1%SBL.nexround 3 − simulationp_switchDensity0.00.20.40.60.805101515%6%5%2%12%6%9%14%5%9%1%14%7%3%3%SBL.nexround 3 − simulationp_lossDensity0.000.050.100.150.200.25010203032%34%16%12%3%2%2%1%02%3%4%SBL.nexround 3 − simulationvertical_SpreadFrequency0.40.60.81.01.2050100150SBL.nexround 3 − simulationhorizontal_SpreadFrequency3.03.54.04.5010203040SBL.nexround 3 − epsilon = 0.1540p_cospDensity0.20.40.60.801020304012%00022%42%2%22%SBL.nexround 3 − epsilon = 0.1540p_dupDensity0.000.020.040.060510152020%20%6%004%2%4%02%20%8%2%12%SBL.nexround 3 − epsilon = 0.1540p_switchDensity0.00.20.40.60.805101520253014%8%0030%6%2%6%20%2%0000012%SBL.nexround 3 − epsilon = 0.1540p_lossDensity0.000.040.080.12010203034%30%4%12%6%2%000006%6%SBL.nexround 3vertical_SpreadFrequency1.001.051.100246810SBL.nexround 3horizontal_SpreadFrequency3.03.54.04.5024681012SBL.nexround 3 − simulationDistanceDensity0.100.120.140.160.180.2005101520111%7%11%15%16%20%13%14%1%SBL.nexround 3 − epsilon = 0.1540DistanceDensity0.110.120.130.140.15051015202%2%02%4%8%20%22%20%20%Nexus file: SBL.nexHost/Parasite tree: 15/8 leavesPrior distribution: 2000 vectorsNumber of trees: 1000 treesMaximum number of trees: 5000 treesNumber of rounds: 3 roundsPerturbation: 0.0100Tolerances: 0.1000,0.2500,0.2500Simulation Model: 1 − From the root to the leaves modelCyclicity test: 2 − Donati et al., 2014.Metric: 4 − EVENTS AND MAAC−MULT. ASSOCIATIONS Metric(alpha1/alpha2): 0.7000/0.3000Alpha (cosp.,dupl.,switch,loss): (1.0000,1.0000,1.0000,1.0000)Root mapping probability: 1.0000AmoCoala

Supplementary Material

:

w
o
r

d
n
o
c
e
S

.
s
r
e
t
e
m
a
r
a
p

t
u
p
n

i

e
h
t

f
o

s

m
a
r
g
o
t
s
i

h

:

w
o
r

t
s
r
i
F

.
s
e
i
t
i
l
i
b
a
b
o
r
p

d
a
e
r
p
s

d
e
t
a
b
r
u
t
r
e
p

h
t
i
w
t
e
s
a
t
a
d
C
F
S

:
3
2
.
S

e
r
u
g
i
F

s
r
e
t
e
m
a
r
a
p
e
h
t

f
o
d
n
a

s
r
e
t
e
m
a
r
a
p
t
u
p
n

i

e
h
t

f
o

s
e
i
c
n
a
p
e
r
c
s
i
d
y
r
a
m
m
u
s

:

w
o
r
d
r
i
h
T

.
1

d
n
u
o
r

r
e
t
f
a

s
r
e
t
e
m
a
r
a
p
e
h
t

f
o

s

m
a
r
g
o
t
s
i
h

.
1

d
n
u
o
r

r
e
t
f
a

64

SFC.nexround 3 − simulationp_cospDensity0.00.20.40.60.81.0051015203%1%08%18%15%20%11%18%6%SFC.nexround 3 − simulationp_dupDensity0.000.050.100.150.2002040608086%7%2%002%0002%2%SFC.nexround 3 − simulationp_switchDensity0.00.10.20.30.40.50.601020304036%04%3%10%15%5%13%8%2%1%13%SFC.nexround 3 − simulationp_lossDensity0.000.100.200.300102030409%7%20%38%17%5%4%SFC.nexround 3 − simulationvertical_SpreadFrequency0.40.60.81.01.21.4010203040506070SFC.nexround 3 − simulationhorizontal_SpreadFrequency23456010203040506070SFC.nexround 3 − epsilon = 0.1967p_cospDensity0.00.20.40.60.81.0051015204%2%010%22%14%16%022%10%SFC.nexround 3 − epsilon = 0.1967p_dupDensity0.000.040.080.1202040608010090%2%6%000000002%SFC.nexround 3 − epsilon = 0.1967p_switchDensity0.00.10.20.30.40.50.60510152025303532%02%2%12%14%2%22%4%4%2%04%SFC.nexround 3 − epsilon = 0.1967p_lossDensity0.000.100.200.30051015202%10%0006%12%20%14%12%12%02%04%4%2%SFC.nexround 3vertical_SpreadFrequency0.60.81.01.21.4051015SFC.nexround 3horizontal_SpreadFrequency2.53.03.54.04.55.05.505101520SFC.nexround 3 − simulationDistanceDensity0.160.180.200.2205101520101%01%4%11%5%11%12%19%15%12%10%SFC.nexround 3 − epsilon = 0.1967DistanceDensity0.160.170.180.190.200102030402%02%04%14%44%18%16%Nexus file: SFC.nexHost/Parasite tree: 18/16 leavesPrior distribution: 2000 vectorsNumber of trees: 1000 treesMaximum number of trees: 5000 treesNumber of rounds: 3 roundsPerturbation: 0.0100Tolerances: 0.1000,0.2500,0.2500Simulation Model: 1 − From the root to the leaves modelCyclicity test: 2 − Donati et al., 2014.Metric: 4 − EVENTS AND MAAC−MULT. ASSOCIATIONS Metric(alpha1/alpha2): 0.7000/0.3000Alpha (cosp.,dupl.,switch,loss): (1.0000,1.0000,1.0000,1.0000)Root mapping probability: 1.0000AmoCoala

Supplementary Material

Table S.2: Representative vectors of the clusters produced by AmoCoala with per-
turbations for the SFC dataset. The column #vectors indicates the number of vectors
in the cluster.

Dataset Cluster

SFC

1
2
3

pc
0.4985
0.8738
0.1087

pd
0.0024
0.0147
0.0012

ps
0.3162
0.0180
0.5770

pl
0.1829
0.0935
0.3131

#vectors
31
16
3

65

