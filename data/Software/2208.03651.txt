Draft version August 9, 2022
Typeset using LATEX twocolumn style in AASTeX631

Modules for Experiments in Stellar Astrophysics (MESA):
Time-Dependent Convection, Energy Conservation,
Automatic Diﬀerentiation, and Infrastructure

Adam S. Jermyn ,1 Evan B. Bauer

,2 Josiah Schwab

,4 Warrick H. Ball

,5

Earl P. Bellinger

,4, 6 Aaron Dotter

,7 Meridith Joyce

,9 Joey S. G. Mombarg ,10

,3 R. Farmer
,8 Pablo Marchant

William M. Wolf
R. Smolec

,11 Tin Long Sunny Wong ,12 Giulia C. Cinquegrana ,13, 14 Eoin Farrell

,15
,17 Matteo Cantiello ,18, 19 Falk Herwig ,20 Odette Toloza ,21, 22

,16 Anne Thoul
Lars Bildsten ,23, 12 Richard H. D. Townsend ,24 and F.X. Timmes

25

1Center for Computational Astrophysics, Flatiron Institute, New York, NY 10010, USA

2Center for Astrophysics

Harvard & Smithsonian, 60 Garden St, Cambridge, MA 02138, USA

|

3Department of Astronomy and Astrophysics, University of California, Santa Cruz, CA 95064, USA
4Max-Planck-Institut f¨ur Astrophysik, Karl-Schwarzschild-Straße 1, 85741 Garching, Germany
5School of Physics and Astronomy, University of Birmingham, Edgbaston, Birmingham B15 2TT, UK
6Stellar Astrophysics Centre, Aarhus University, 8000 Aarhus C, Denmark
7Department of Physics and Astronomy, Dartmouth College, Hanover, NH 03755 USA
8Space Telescope Science Institute, 3700 San Martin Drive, Baltimore, MD 21218, USA
9Institute of Astrophysics, KU Leuven, Celestijnenlaan 200D, 3001 Leuven, Belgium
10Institute of Astronomy, KU Leuven, Celestijnenlaan 200D, Leuven, Belgium
11Department of Physics and Astronomy, University of Wisconsin-Eau Claire, Eau Claire, WI 54701, USA
12Department of Physics, University of California, Santa Barbara, CA 93106, USA
13School of Physics & Astronomy, Monash University, Clayton VIC 3800, Australia
14ARC Centre of Excellence for All Sky Astrophysics in 3 Dimensions (ASTRO 3D)
15School of Physics, Trinity College Dublin, The University of Dublin, Dublin 2, Ireland
16Nicolaus Copernicus Astronomical Center of the Polish Academy of Sciences, Bartycka 18, PL-00-716 Warszawa, Poland
17Space sciences, Technologies and Astrophysics Research (STAR) Institute, Universit´e de Li`ege, All´ee du 6 Aoˆut 19C, Bat. B5C, 4000
Li`ege, Belgium
18Center for Computational Astrophysics, Flatiron Institute, 162 5th Avenue, New York, NY 10010, USA
19Department of Astrophysical Sciences, Princeton University, Princeton, NJ 08544, USA
20Dept. of Physics and Astronomy, University of Victoria, Victoria, BC V8P5C2, Canada
21Millennium Nucleus for Planet Formation, NPF, Valpara´ıso, Chile
22Departamento de F´ısica, Universidad T´ecnica Federico Santa Mar´ıa, Avenida Espa˜na 1680, Valpara´ıso, Chile
23Kavli Institute for Theoretical Physics, University of California, Santa Barbara, CA 93106, USA
24Department of Astronomy, University of Wisconsin-Madison, Madison, WI 53706, USA
25School of Earth and Space Exploration, Arizona State University, Tempe, AZ 85287, USA

ABSTRACT

We update the capabilities of the open-knowledge software instrument Modules for Experiments in
Stellar Astrophysics (MESA). The new auto diff module implements automatic diﬀerentiation in MESA,
an enabling capability that alleviates the need for hard-coded analytic expressions or ﬁnite diﬀerence
approximations. We signiﬁcantly enhance the treatment of the growth and decay of convection in
MESA with a new model for time-dependent convection, which is particularly important during late-
stage nuclear burning in massive stars and electron degenerate ignition events. We strengthen MESA’s
implementation of the equation of state, and we quantify continued improvements to energy accounting
and solver accuracy through a discussion of diﬀerent energy equation features and enhancements. To
improve the modeling of stars in MESA we describe key updates to the treatment of stellar atmospheres,
molecular opacities, Compton opacities, conductive opacities, element diﬀusion coeﬃcients, and nuclear
reaction rates. We introduce treatments of starspots, an important consideration for low-mass stars,
and modiﬁcations for superadiabatic convection in radiation-dominated regions. We describe new
approaches for increasing the eﬃciency of calculating monochromatic opacities and radiative levitation,
and for increasing the eﬃciency of evolving the late stages of massive stars with a new operator split

2
2
0
2

g
u
A
7

]

R
S
.
h
p
-
o
r
t
s
a
[

1
v
1
5
6
3
0
.
8
0
2
2
:
v
i
X
r
a

 
 
 
 
 
 
2

nuclear burning mode. We close by discussing major updates to MESA’s software infrastructure that
enhance source code development and community engagement.

Keywords: Stellar physics (1621); Stellar evolution (1599); Stellar evolutionary models (2046); Com-

putational methods (1965)

Contents

1. Introduction

2. Automatic Diﬀerentiation

3. Time-Dependent Convection

3.1. Formalism
3.2. Numerical Stability
3.3. Flipped Equations
3.4. Numerical Method
3.4.1. L given
3.4.2. Numerical Inversion
3.4.3. Relation to auto diff

Y

3.5. Reduction to Cox MLT
3.6. Accreting White Dwarfs

4. Equation of State

4.1. Skye

4.1.1. Crystallization

4.2. FreeEOS
4.3. EOS Blends
4.4. Thermodynamic Consistency

5. Energy Equations

5.1. Fundamentals and Implementations
5.2. Results: carbon kh
5.3. Quantifying EOS shortcomings

5.3.1. EOS Derivatives
5.3.2. Thermodynamic Consistency and

EOS Blends
5.4. Results: 1M pre ms to 1TP

6. Atmosphere

6.1. Atmospheric T (τ ) Relations
6.2. Irradiated Atmospheres
6.3. Tabulated White Dwarf Atmospheres
6.4. Atmosphere Reconstruction for Pulsation

Codes

6.5. Atmospheres as Part of the Interior
6.6. Choosing atmosphere options

7. Convection in the Outer Layers of Stars

7.1. Starspots

7.1.1. Starspots formalism
7.1.2. MESA implementation

2

5

7
7
8
8
8
8
9
10
10
12

15
15
16
17
17
17

18
19
21
23
23

23
24

25
25
26
27

27
28
29

29
29
29
30

7.1.3. MESA Models

7.2. Superadiabatic Convection in
Radiation-dominated Regions

8. Opacity

8.1. Molecular Opacities
8.2. Compton Opacities
8.3. Conductive Opacities
8.4. Radiative Accelerations from the OP

Monochromatic Opacities

9. Diﬀusion Coeﬃcients

10. Nuclear physics

10.1. Reaction rates updates
10.2. Operator split nuclear burning
10.3. Reaction rate output

11. Constants

12. Infrastructure

12.1. Migration to GitHub
12.2. MESA TestHub
12.3. User Contributions
12.4. NuDocker

13. Summary

30

31

33
33
34
34

35

36

37
37
38
39

39

39
39
40
41
41

42

1. INTRODUCTION

A resurgence of stellar astrophysics research is be-
ing fueled by the transformative capabilities in space-
and ground-based hardware instruments providing an
unprecedented volume of high-quality measurements of
stars, signiﬁcantly strengthening and extending the ob-
servational data upon which stellar astrophysics ulti-
mately rests (National Research Council 2021). Exam-
ples include:

(cid:39)

(cid:39)

Several individual stars at redshifts of

1 have been
discovered by temporary magniﬁcation factors of
1000
from microlensing (Kelly et al. 2018; Rodney et al. 2018;
Chen et al. 2019). A more persistent and highly magni-
ﬁed star at a redshift of 6.2 has also been discovered with
the Hubble Space Telescope (Welch et al. 2022) by a for-
tuitous alignment with a foreground galaxy cluster lens
caustic (Windhorst et al. 2018). The infrared instru-
ments aboard the James Webb Space Telescope (Gard-
ner et al. 2006; Beichman et al. 2012; Artigau et al. 2014;

Rieke et al. 2015; Labiano et al. 2021) will search for con-
ﬁrmation and spectral classiﬁcation of this distant star
to deﬁne its place on the Hertzsprung–Russell Diagram
(HRD), assess how galaxies evolve from their forma-
tion (Zackrisson et al. 2011; Robertson 2021), observe
the formation of stars (Senarath et al. 2018; Boquien
& Salim 2021), and measure the properties of stellar-
planetary systems including the Solar System (Sarkar &
Madhusudhan 2021; Patapis et al. 2022).

In the late 2020s, kilometer-scale gravitational wave
detectors such as Advanced Laser Interferometer Grav-
itational Observatory (LIGO Scientiﬁc Collaboration
et al. 2015), Advanced Virgo (Acernese et al. 2015) and
Kamioka Gravitational Wave Detector (Akutsu et al.
2021) will routinely detect tens of binary neutron-star
mergers with kilonovae annually (Abbott et al. 2018),
probe how kilonova r-process nucleosynthetic yields vary
with environment (e.g., Barnes et al. 2021), and assess
the populations that contribute to the stellar black hole
mass distribution, including the presence of any gaps in
the distribution (Perna et al. 2019; Zevin et al. 2021;
Renzo et al. 2021; Mandel & Broekgaarden 2022).

The next core-collapse supernova in the Milky Way
or its satellites will be a unique opportunity to observe
the explosion of a star. The SuperNova Early Warn-
ing System is a global network of neutrino experiments
sensitive to supernova neutrinos (Al Kharusi et al. 2021)
that includes multi-kiloton detectors such as KamLAND
(Araki et al. 2005), Borexino (Borexino Collaboration
et al. 2018, 2020), SNO+ (Andringa et al. 2016), Daya
Bay (Guo et al. 2007), SuperKamiokande (Simpson et al.
2019), and the upcoming HyperKamiokande (Abe et al.
2016), DUNE (Acciarri et al. 2016) and JUNO (JUNO
Collaboration 2022). Searching for pre-supernova neu-
trinos is ongoing, and of interest as they allow tests of
stellar and neutrino physics (e.g., Kosmas et al. 2022)
and enable an early alert of an impending core-collapse
supernova to the electromagnetic and gravitational wave
communities (Beacom & Vogel 1999; Vogel & Beacom
1999; Mukhopadhyay et al. 2020; Al Kharusi et al. 2021).
Sky surveys that probe ever-larger areas of the dy-
namic sky and ever-fainter transient sources include
the Imaging X-ray Polarimetry Explorer (Soﬃtta et al.
2021), the Compton Spectrometer and Imager (Tom-
sick & COSI Collaboration 2022), eROSITA (Predehl
et al. 2021), Gaia (Gaia Collaboration et al. 2016, 2018,
2021), the Sloan Digital Sky Survey (York et al. 2000;
Abdurro’uf et al. 2022), the All-Sky Automated Sur-
vey for Supernovae (Chen et al. 2022), Pan-STARRS1
(Flewelling et al. 2020), the Zwicky Transient Factory
(Bellm et al. 2019; Dhawan et al. 2022), Gattini-IR
(Moore et al. 2016), and the Nancy Grace Roman Space

3

Telescope (Akeson et al. 2019). Roman will measure
proper motions of stars several magnitudes fainter than
the Gaia mission (Brandt et al. 2021; Dorn-Wallenstein
et al. 2021), which is suﬃcient to probe the main se-
quence turnoﬀ to distances of
10 kpc and red giants
throughout the Galactic halo (Spergel et al. 2015).

(cid:39)

Wide-ﬁeld spectroscopic surveys in the coming decade
will resolve stellar populations and the Milky Way’s
structure (Bolton et al. 2019) at facilities such as
Gaia DR3 (Gaia Collaboration et al. 2021), SDSS-V
(Kollmeier et al. 2017), FOBOS (Bundy et al. 2019),
Maunakea Spectroscopic Explorer (Marshall et al. 2019),
and SpecTel (Ellis & Dawson 2019). For example,
FOBOS is a next-generation spectroscopic facility at
the W.M. Keck Observatory that will provide multi-
epoch, high-multiplex, and deep spectroscopic follow-up
of panoramic deep-imaging surveys.

The Vera C. Rubin Observatory will conduct a multi-
color optical survey of the Southern Hemisphere sky, the
Legacy Survey of Space and Time (LSST Science Collab-
oration et al. 2017; Ivezi´c et al. 2019), to probe dark en-
ergy and dark matter (S´anchez et al. 2021; Zhang et al.
2022), explore the transient optical sky (Bianco et al.
2022; Li et al. 2022; Raiteri et al. 2022; Hernitschek &
Stassun 2022; Andreoni et al. 2022; Bellm et al. 2022),
and build a catalog of solar system objects with an order
of magnitude more objects (LSST Solar System Science
Collaboration et al. 2020; Schwamb et al. 2021).

The TESS mission (Ricker et al. 2016) is providing
systematic measurements of the radii, masses, and ages
of 200,000 individual stars sampled at a 2 minute ca-
dence to open a new era of stellar variability explo-
ration (e.g., Huang et al. 2018; Ball et al. 2018; Dragomir
et al. 2019; Wang et al. 2019). Within the next decade,
the Planetary Transits and Oscillations of Stars mission
(PLATO; Rauer et al. 2014) will search for planetary
transits across up to one million stars, characterize rocky
extrasolar planets around yellow dwarf stars, subgiant
stars, and red dwarf stars (Montalto et al. 2021), and
investigate the seismology of stars (Miglio et al. 2017;
Cunha et al. 2021; Nascimbeni et al. 2022).

In partnership with this ongoing explosion of activity
in stellar astrophysics, revolutionary advances in soft-
ware infrastructure, computer processing power, data
storage capability, and open-knowledge software instru-
ments are transforming how stellar theory, modeling,
and simulations interact with experiments and observa-
tions. Examples include Astropy (Astropy Collabora-
tion et al. 2018, 2022), Athena++ (Stone et al. 2020;
Jiang 2021), Castro (Almgren et al. 2020), Dedalus
(Burns et al. 2020), emcee (Foreman-Mackey et al.
2013), Flash-X (Dubey et al. 2022), GYRE (Townsend

4

& Teitler 2013; Townsend et al. 2018), MAESTROeX
(Fan et al. 2019), MESA2Hydro (Joyce et al. 2019), MSG
(Townsend & Lopez 2022), Phantom (Price et al. 2018),
PHOEBE (Conroy et al. 2020), Starlib (Sallaska et al.
2013), TARDIS (Vogl et al. 2019), TULIPS (Laplace 2022),
and yt (Turk et al. 2011).

The previous Modules for Experiments in Stellar As-
trophysics software instrument papers (Paxton et al.
2011, MESA I; Paxton et al. 2013, MESA II; Paxton
et al. 2015, MESA III; Paxton et al. 2018, MESA IV;
Paxton et al. 2019, MESA V), as well as this one, de-
scribe new capabilities and limitations of MESA while also
comparing to other available numerical or analytic re-
sults. We do not fully explore the science implications
in this software instrument paper. The scientiﬁc poten-
tial of these new capabilities will be unlocked by future
eﬀorts of the MESA research community.

This MESA VI software instrument paper is organized
as follows. Section 2 describes the implementation of au-
tomatic diﬀerentiation and §3 introduces a new model
for time dependent convection. Section 4 describes im-
provements to MESA’s implementation of the equation of
state (EOS) and §5 discusses treatments of the energy
equation. Section 6 describes treatments of the stellar
atmosphere and §7 introduces new models of starspots
and a superadiabatic convection. Section 8 reports im-
provements to the opacities, §9 to the element diﬀusion
coeﬃcients, §10 to the nuclear physics, and §11 to the
physical constants. Section 12 discusses MESA’s infras-
tructure. Finally, §13 summarizes MESA VI.

Important symbols are deﬁned in Table 1. Acronyms
are deﬁned in Table 2. Components of MESA, such as
modules and routines, are in typewriter font e.g., tdc.

Table 1. Important symbols.

Name

Description

a

A

c

D

e

E

fspot
g

G

h

κ

Radiation constant
4πr2 Area of face

Speed of light in a vacuum

Element diﬀusion coeﬃcient

Speciﬁc internal energy

Energy

Filling factor

Gravitational acceleration

Gravitational constant

Pressure scale height

Opacity

Table 1 continued

Appears

7.2

3

8

9

4

5

7.1

6

6

3

6

Table 1 (continued)

Name

Description

λ

kB
L

m

Reaction rate

Boltzmann constant

Luminosity

Mass coordinate

M Stellar mass

n

NA
P

Q

r

R

ρ

s

σ

t

T

u

w

Number density

Avogadro number

Pressure

Thermal expansion

Radial coordinate

Stellar radius

Mass density

Speciﬁc entropy

Stefan-Boltzmann constant

Time

Temperature

Velocity

Turbulent velocity

xspot Temperature contrast

X

Y

Y

Z

Z

ae

α

αD

αr
αPt
cP

cV

δt

Hydrogen mass fraction

Helium mass fraction

Superadiabaticity ∇−∇ad
Charge

Metal mass fraction

Electron spacing (4πne/3)−

1/3

Convective ﬂux parameter

Convective ﬂux parameter

Convective ﬂux parameter

Convective ﬂux parameter

Speciﬁc heat at constant pressure

Speciﬁc heat at constant volume ∂e/∂T |ρ

Numerical time step

dm Mass of cell

(cid:15)

Energy generation rate

(cid:15)grav Gravitational heating rate
(cid:15)nuc
(cid:15)q

Viscous heating rate

Nuclear energy generation rate

et

Γ

Γ1
Γ3

Speciﬁc kinetic energy of turbulence

Eﬃciency of convection

First adiabatic exponent (∂ ln P/∂ ln ρ)ad
Third adiabatic exponent

Table 1 continued

Appears

10

9

3

3

3

9

8

3

3

6

6

3

4

3

3

3

5

3

7.1

3

3

3

9

9

9

3

3

3

3

3

5

5

5

5

4

10

3

3

3

3

3

Table 1 (continued)

Table 2 (continued)

Name

Description

Appears

Acronym

Description

Appears

5

ΓMCP Multi-component plasma coupling parameter
∇ad
∇e

Temperature gradient of convective eddy

Adiabatic temperature gradient

Ledoux temperature gradient

∇L
∇rad Radiative temperature gradient
Temperature gradient

∇

Kij

λe

Resistance coeﬃcients

Electron screening length

Luminosity of turbulent kinetic energy

Lt
Ledd
Lrad Radiative luminosity

Eddington luminosity

µ
Molecular weight
˙M Mass transfer rate
Turbulent pressure
Pt

qe

τ

Teﬀ
u

vc

χρ

χT

Electric charge

Optical depth

Eﬀective temperature

Cell velocity

Convection velocity

Adiabatic index (∂logP /∂logρ)|T,X

Adiabatic index (∂logP /∂logT )|ρ,X

Xi Mass fraction

9

3

3

3

3

3

9

9

3

7.2

7.2

8

3

3

9

6

6

5

3

3

3

3

Note: Single character symbols are listed ﬁrst, symbols
with modiﬁers are listed second. Some symbols may be
further subscripted, for example, by c (indicating a central
quantity), by s (indicating a surface quantity), by a cell
index k, or by species index i.

Table 2. Acronyms used in this article.

Acronym

Description

Appears

AGB

BCZ

DA

DB

EOS

HRD

MLT

RSG

Asymptotic Giant Branch

Base of the Convection Zone

White dwarf spectral type

White dwarf spectral type

Equation of State

Hertzsprung Russell Diagram

Mixing Length Theory

Red Super Giant

TAMS

Terminal Age Main Sequence

8

3

8

6

1

1

3

7.2

7.2

Table 2 continued

TDC

Time-Dependent Convection

TP

WD

Thermal Pulse

White Dwarf

ZAMS

Zero Age Main Sequence

3

8

3

8

2. AUTOMATIC DIFFERENTIATION

MESA solves the equations of stellar evolution implicitly
using a Newton-Raphson method, which requires the
partial derivatives of each equation with respect to the
basic structure variables in each cell (e.g., ρk, Tk). These
derivatives need to be computed accurately, typically to
one part in 106, often precluding use of ﬁnite diﬀerences.
These derivatives have historically been computed by
hard-coding analytic expressions for each equation. This
has accounted for a large fraction of the complexity and
sources of error in MESA.

We have largely eliminated this source of error and the
associated complexity by using forward-mode operator-
overloaded automatic diﬀerentiation (Bartholomew-
Biggs et al. 2000) in the new auto diff module. This
functionality provides partial derivatives of expressions
automatically with respect to their input variables. The
auto diff module provides a number of Fortran de-
rived types for this purpose. For example, we deﬁne
the type auto diff real star order1, which contains
a ﬂoating-point number as well as its ﬁrst partial deriva-
tive with respect to the basic stellar structure vari-
ables. The number of partial derivatives is speciﬁed at
compile-time. If x is a variable of this type, then it con-
tains components x%val representing the value of x and
x%d1Array(j) for the value of ∂x/∂ηj, where ηj is the
j-th independent variable.

The auto diff types overload operators to implement
the chain rule. This means that a source code line such
as f = x * y is equivalent to

f%val = x%val * y%val
f%d1Array(j) = x%d1Array(j) * y%val

+ y%d1Array(j) * x%val

Basic arithmetic and all special and trigonometric func-
tions used in MESA including functions such as min, max,
and abs, are provided. When these functions have dis-
continuities, we evaluate their derivatives as zero; and
where they have discontinuous derivatives, we compute
their derivatives as the average between the two sides of
the discontinuity.

6

Using auto diff, expressions like

F = min

can be written as

(cid:16)

ρ1eT1/√ρ0, cosh (r2 −

r1)

(cid:17)

(1)

F = min(rho1*exp(T1/sqrt(rho0)),cosh(r2-r1)).

Together with setup routines that link physical variables
(e.g., T1) with the independent variables ηj, this code
automatically provides correct partial derivatives of F .
By contrast, explicitly obtaining the partial deriva-
tives of F requires more complex and error-prone source
code:

x0 = rho1*exp(T1/sqrt(rho0))
x1 = cosh(r2-r1)
F = min(x0,x1)
if (x0 < x1) then

dF_drho1 = x0 / rho1
dF_drho0 = -T1 * x0 / (2 * sqrt(rho0))
dF_dT1 = x0/sqrt(rho0)
dF_dr2 = 0
dF_dr1 = 0

else

dF_drho1 = 0
dF_drho0 = 0
dF_T1 = 0
dF_dr2 = sinh(r2-r1)
dF_dr1 = -sinh(r2-r1)

end if

The auto diff module provides overloaded operators
that were generated using the SymPy (Meurer et al. 2017)
library in Python to compute power series and extract
chain-rule expressions. We ﬁrst optimized these expres-
sions to eliminate common sub-expressions and mini-
mize the number of division operators. We then trans-
lated these into Fortran. This functionality is built on
top of the CR-LIBM software package (Daramy-Loirat
et al. 2006), which enables bit-for-bit identical results
across all platforms (see MESA III).

The auto diff module also provides additional
auto diff real types for alternative use cases. For
convenience, types are provided to support the diﬀer-
ent hooks in MESA. For operations requiring higher-order
derivatives, such as in the EOS (see §4), additional
auto diff real types provide higher-order mixed par-
tial derivatives. The chain-rule expressions rapidly be-
come more complicated for higher-order derivatives, but
the basic principle is the same. The auto diff machin-
ery was used to benchmark the Skye EOS (Jermyn et al.
2021), with the result that the performance is similar
to explicit expressions. Here we provide more detailed
benchmarks.

Table 3. Ratio of runtimes for evaluating auto diff ex-
pressions relative to the same expressions with real(dp)
(double precision real) variables. The real(dp) op-
erations did not calculate any derivatives. Runtimes
are averaged over 106 trials, performed on the integers
1 − 106 (cast as real(dp)), with intermediate results
accumulated to prevent the compiler from optimizing
away the operations. Label “*” refers to the multipli-
cation operator x*x, labels “Xvar orderY” refer to the
number of independent variables X and the maximum
partial derivative order Y, label “f” refers to the func-
tion log(cosh(tanh))), and the label “N” refers to the
number of partial derivatives computed. Timing data
was obtained on a 2.4 GHz 8-Core Intel Core i9 running
on a 2019 Macbook Pro.

real(dp)
auto diﬀ real 1var order1
auto diﬀ real 2var order1
auto diﬀ real 2var order3
auto diﬀ real star order1

*

1
3.8
4.3
12
35

/

1
6.1
11
34
77

log

1
1.3
1.4
2.3
4

f

1
1.4
1.7
2.6
2.7

N

0
1
2
9
33

Table 4. Same as Table 3, but comparing auto diff
performance against explicit real(dp) routines that in-
clude partial derivatives. Partial derivative expressions
were constructed and simpliﬁed using Mathematica ver-
sion 12, then implemented manually in Fortran.

real(dp)
auto diﬀ real 1var order1
auto diﬀ real 2var order1
auto diﬀ real 4var order1

*

1
2.3
2.1
1.9

/

1
1.9
1.9
1.3

log

1
1.2
1.3
1.3

f

N

1
0.75
0.81
0.74

0
1
2
4

Table 3 compares the runtime cost for several opera-
tions and several auto diff types to the cost of evaluat-
ing the same expressions in real(dp) types calculating
no partial derivatives. For operations like multiplication
and division, this incurs an overhead of order the num-
ber of partial derivatives returned. For more expensive
operations, the overhead is much less, as the auto diff
expressions are optimized to re-use intermediate results.
Table 4 compares three ﬁrst-order auto diff types
and explicit real(dp) routines evaluating the same par-
tial derivatives. There is still overhead for simple oper-
ations, but the relative cost no longer scales with the

number of derivatives. For suﬃciently complex oper-
ations, such as f = log(cosh(tanh(x))), the optimized
auto diff functions outperform our explicit routines.

For use in stellar evolution calculations, we ﬁnd
the runtime performance of hand-coded expressions are
modestly better than those from auto diff, because
most equations do not depend on all of the indepen-
dent variables. However, this overhead is small com-
pared with the full cost of a timestep in MESA. Moreover,
runtime is often signiﬁcantly reduced by ensuring that
all partial derivatives are correct, as inaccurate deriva-
tives result in slow convergence and a larger number of
small timesteps. Some parts of the MESA source code do
not yet use auto diff, but this is gradually transition-
ing.

Four applications of the profound enabling capability
of auto diff are shown in §3 on time-dependent convec-
tion, §4 on MESA’s implementation of the EOS, §7.1 on
starspots, and §7.2 on superadiabatic convection. The
auto diff module can also be used in run star extras,
as well as for software development outside of MESA.

3. TIME-DEPENDENT CONVECTION

The mixing length theory (MLT; Vitense 1953) has
been used to parameterize convection in 1D stellar mod-
els for decades. It assumes that convective turbulence is
in a steady state in which the energy input by the con-
vective instability balances damping due to turbulent
processes and radiative diﬀusion. This is a good approx-
imation when the composition and structure evolve on
time-scales that are long compared to the characteristic
time-scales of convection.

However, during particularly violent episodes of stel-
lar evolution, it is possible for the structure to evolve
faster than convection can reach a steady state. This is
the case in late-stage nuclear burning in massive stars
(preceding core collapse), as well as during electron-
degenerate ignition events (e.g., He shell ﬂashes, Ne ig-
nition, etc.). In such cases, the dynamics of convective
growth and decay must be incorporated.

To model this, we employ the time-dependent convec-
tion (TDC) formalism of Kuhfuß (1986). We build on
the implementation by Smolec & Moskalik (2008). Pre-
viously introduced in MESA V to model radial stellar
pulsations in the RSP module, this formalism has now
been modiﬁed to support stellar evolution calculations.
We describe the TDC formalism in §3.1. In §3.2 and
§3.3 we explain the modiﬁcations we have made relative
to the implementation in RSP to make TDC numerically
stable on long timescales. Section 3.4 then details the
TDC solver algorithm. In §3.5 we identify a change to
the implementation which makes TDC agree with MLT

7

in the limit of long timescales. Finally, in §3.6 we explore
the impact of TDC on models of white dwarfs (WDs)
accreting He.

3.1. Formalism

Following the Kuhfuß (1986) model, TDC introduces
a new variable, the speciﬁc kinetic energy in turbulence
et, which evolves according to

Det
Dt

+ αPtPt

1
Dρ−
Dt

= (cid:15)q + C

∂Lt
∂m

.

−

(2)

(2/3)ρet is the turbulent pressure, αPt is a
Here Pt ≡
dimensionless free parameter, (cid:15)q is the viscous heating
of bulk motion, and Lt accounts for advection of kinetic
energy between mass shells. Furthermore,

αe1/2
t

C

≡

T P Q
h√6 Y −

αD

(cid:32)

2
3 (cid:33)

8
3 (cid:114)
T 3
ρ2cP κh2

e3/2
t
αh

et

(cid:19)

(3)

48σαr
α2

−

(cid:18)

groups together sources and sinks of turbulent kinetic
energy, including a source/sink from the superadiabatic-
ity

(4)

≡
1/∂T

Y ≡ ∇ − ∇ad.
The coeﬃcients α, αD, and αr are free parame-
ters, h
P/(ρg) is the pressure scale-height, and
|P is the thermal expansion coeﬃcient. By
∂ρ−
Q
default αr = 0, which means that TDC neglects radia-
tive damping of convective motions. This choice enables
subsequent modiﬁcations (§3.5) that make TDC reduce
to MLT in the limit of long timesteps. Other defaults
are α = 2, αD = 1, and αPt = 0.

≡

The turbulent energy is incorporated into the other
equations of stellar structure via heat and momentum
transport. Speciﬁcally, in the momentum equation we
include a turbulent pressure term Pt. In the luminosity
equation we incorporate

L = Lrad + Lconv ,

where Lrad is the radiative luminosity and

Lconv = 4πr2αρcP T

w
√6 Y

(5)

(6)

is the convective luminosity. Here w
√et is the tur-
bulent velocity. Finally, the luminosity enters the total
energy equation, which sets the time evolution of the
speciﬁc internal energy e in each cell.

≡

To implement TDC in MESA, we drop the term (cid:15)q from
the energy equation, simplifying our implementation.

8

We do not expect this term to matter in most cases,
because bulk velocities are typically much smaller than
convective velocities. When using the Ledoux criterion
for convective stability, we further modify TDC in MESA
relative to RSP to set
∇L
∇ad, as in Kuhfuß
rather than the adiabatic gradient
(1986).

with the Ledoux gradient

Y

3.2. Numerical Stability

In MESA, RSP solves equations (2), (5) and (6) im-
plicitly along with other structure equations to evolve
et and e. This approach works well on short (convec-
tive/pulsational) timescales, but it is numerically un-
stable on long (evolutionary) timescales. This poses a
challenge, as we want a method that can be used in both
limits and smoothly transitions between them.

We conjecture that this numerical instability arises

Y

, small errors in

when et is a solver variable. The superadiabaticity
Y
sets the time evolution of et, and hence Lconv and L.
As L is very sensitive to
result in
large errors in L. These errors are not important over
time steps shorter than the thermal timescale of a cell
(as is the case in RSP), as an excess luminosity through
one face heats one adjacent cell and cools the other,
restoring thermal equilibrium. With much longer time
steps, errors in L signiﬁcantly alter the entropy proﬁle,
propagating into
and producing even larger errors in
L with each iteration.

Y

Y

An alternative approach, taken by the MLT imple-
mentation in MESA, is to treat the luminosity as a solver
variable determined implicitly by the energy equation
(e.g., Equation 47). From this, MESA derives the tem-
perature gradient needed to produce that luminosity,
and requires that the temperature gradient between cells
match that computed by MLT. In eﬀect, this ﬂips the
logic around, so that MESA MLT solves for
given L
whereas RSP solves for L given
. Because L is very sen-
is relatively insensitive to L; thus, errors
sitive to
in L produce smaller errors in
, making this approach
numerically stable.

Y

Y

Y

Y

Y

,

3.3. Flipped Equations

To ensure numerical stability over long timescales, we
implement TDC in MESA in the same way as MLT, with
L as a solver variable. We ﬂip Equation (6) to solve
for
via
, accounting for the fact that w depends on
Equation (2). Doing so requires a few simpliﬁcations
and a number of new approaches.

Y

Y

We numerically invert Equations (2) and (6) to solve
for
given L. To do this, we note that the time evolu-
tion of et in a single cell is nearly independent of et in
adjacent cells (see Equation 2). The only direct (rather

Y

±

than implicit) coupling between et,k and et,k
1 arises
through Lt. For simplicity, we currently set Lt = 0. This
makes Det,k/Dt independent of et,k
1 except implicitly
via the other structure variables. This in turn makes
Yk a function only of the local luminosity Lk and solver
variables in the adjacent cells. We then solve for each
Yk using only local information, and preserve the basic
structure of the Jacobian in MESA as well as the runtime
performance.

±

3.4. Numerical Method

Our goal is to numerically solve Equations (2) and (6)
given L with Lt = 0. We ﬁrst construct machinery
, and then perform a numerical
Y
given L.

for
to evaluate L given
root-ﬁnd to obtain

Y

Y
3.4.1. L given Y

We use et = w2 to rewrite Equation (2) as

2

Dw
Dt

= ξ0 + ξ1w + ξ2w2,

(7)

where ξ0, ξ1, and ξ2 are coeﬃcients that we obtain by
expanding the deﬁnitions of C and Pt in Equation (2).
We have divided through by w, and so have implicitly
excluded one solution branch (w = 0). We will return
to that branch shortly.

The coeﬃcients are given by

ξ0 =

α
h√6

cP T

,

∇adY

(8)

ξ1 =

ξ2 =

− 



− (cid:32)

4σT 3
ρ2cP κ (cid:32)

2

2αr√3

αh (cid:33)

+

2
3

αPtρ

Dρ−

1

Dt 

,

(9)

8
3 (cid:114)

2
3 (cid:33)

αD
αh

.



(10)

We ﬁx these to their end-of-step values and solve for
w at the end of the time step given the initial value
at the start of the time step. This implicit approach
is numerically stable, and the required end-of-step val-
ues are readily available. The form of the solution to
Equation (7) depends on the sign of the discriminant
J 2

≡
When J 2 > 0, the system is convectively unstable,

ξ2
1 −

4ξ0ξ2.

with the solution

w =

1
2ξ2 (cid:18)

−

J tanh

λ + Jδt
4

+ ξ1

,

(cid:19)

(11)

after a time step δt, where λ is a constant depending on
the initial value of w. With long time steps, the solution
grows to a plateau w
(J + ξ1)/(2ξ2) independent
of this initial condition. We show below that this is
consistent with MLT.

→ −

When J 2 < 0, the system is convectively stable, with

the solution

w =

1
2ξ2 (cid:18)

tan

J
|

|

λ +

δt
|

J
|
4

−

ξ1

.

(cid:19)

(12)

∼

This solution eventually reaches w(δt∗) = 0 at some time
δt∗
1/J. Beyond that point the system remains ﬁxed
at w = 0, which is a valid solution to Equation (2) but
which was excluded in the form Equation (7) by dividing
through by w. When J 2 < 0 we must additionally check
to see if the ﬁrst root of w occurs before the end of the
time step and, if it occurs before, set w = 0 at the end of
the step rather than evaluating w with Equation (12).
Given w, we evaluate Lconv at the end of the step via

Equation (6), and so now have L given

Y
3.4.2. Numerical Inversion

as desired.

We now invert the relation between L and

, ℵ) = Lsolver,

L(

Y

by solving

Y

(13)

where Lsolver is the desired luminosity produced by the
, ℵ) is the relation we con-
Newton-Raphson solver, L(
Y
structed using Equations (6) and (7), and ℵ represents
additional structure variables.

To solve equation (13), we write it in the form

R(

Y

)

L(

Y

≡

, ℵ)

−

Lsolver = 0 ,

(14)

and then expand L using Equations (5) and (6) as

R(

)

Y

(Lsolver −

L0∇L)

−

≡

(L0 + c0w)

.

Y

(15)

Here

L0 ≡

16πac
3

GmT 4
κP

(cid:18)

(cid:19)

c0 ≡

4πr2 α
√6

ρT cP

(16)

Y

Y

are positive quantities set by local properties and inde-
pendent of
. All quantities in Equation (15) are eval-
uated at the end of the time step, determining the sign
in advance. The factor L0 + c0w is
of the solution for
matches that of the ﬁrst
positive; hence, the sign of
Y
term, which is independent of

Y

.

Y

We evaluate Lsolver −

L0∇L to determine the sign of
ln

,
Y
.
followed by a change of variables from
Y → Z ≡
|Y|
, which can vary by
This allows more resolution in
many orders of magnitude across a stellar model. We
restrict our search to
100, covering
100
≤ Z ≤
(cid:46) 1043. We choose such a wide range be-
10−
cause we have observed models that enter the extremes
of this range, typically involving shocks where both TDC
and MLT are suspect. We have not encountered models
43
with

approaching 1043, and those with

43 (cid:46)

< 10−

|Y|

−

|Y|

|Y|

9

are indistinguishable from
= 0 for the purposes of cal-
Y
culations in MESA, so this window should cover all cases
of interest.

The TDC solver identiﬁes and handles a variety of
cases. It takes advantage of the fact that dw/d
0,
which follows because the convective velocity always in-
creases as a region becomes more unstable.

Y ≥

Y

Y

Z

We now discuss the diﬀerent possible solutions. When
> 0, the root-ﬁnding problem is monotonic because
Y
< 0. We approach this by per-
> 0 and dR/d
dw/d
forming a bisection search in
followed by a Newton-
Raphson solve. The bisection search ensures that the
Newton-Raphson solve starts close to the true solution
1 for termination). The
(we require the range ∆
Z ≤
Newton-Raphson solve then rapidly reﬁnes the solution
to near machine precision and, crucially, imbues the so-
lution with a diﬀerentiable dependence on the solver
variables, tracked by auto diff (§2). Even if the bisec-
tion search ﬁnds an adequate solution, we still require
at least one Newton-Raphson iteration to ensure that
the result contains the partial derivatives needed for the
MESA Jacobian.

Y

Y

When

< 0 and the initial w = 0, the entropy
gradient is stable against convection. There is no pre-
existing turbulence, and so w = 0 for the entire step and
L = Lrad. This makes Equation (15) linear in

.

Finally, when

< 0 and the initial w > 0, there can

Y

Y

→

Y
be up to three solutions to Equation (15):
• In one solution,

becomes large and negative. This
0 before the end of the time step (e.g.,
forces w
the ﬁrst root of Equation (12) occurs before time dt
passes), and L = Lrad.
• In the other two solutions,

becomes small and neg-
ative, and w declines but does not reach zero by the
end of the step. Here L is carried by a mix of radia-
tion and convection. There are two solutions because
and
there is a tradeoﬀ between the magnitude of
term in
the decline of w, which compete in the w
Equation (6).
Multiple solutions exist because, for long time steps,
both
and w can evolve signiﬁcantly in a single step.
One could force the time step to be smaller, such that
there is just one solution. However, a global time step
limit is often undesirable, especially in cases where the
precise means by which convection decays (e.g., for a
retreating convective boundary on the main-sequence)
is not usually of interest. Hence, it is often preferable to
select one of the multiple solutions.

Y

Y

Y

We disfavor the solution that decays fastest (e.g.,
Y
is large and negative), as then convection decays on
a dynamical timescale, which we suspect is unphysi-
cal. Rather, we favor the slower-decaying (e.g., smaller-

10

is to ﬁrst detect the number of solutions and isolate the
one of physical interest.

Y

Y

Y

Y

Because dw/d

Y1) is the

The three solutions must be separated by two special
points. The ﬁrst (
with
Y0) is the smallest-magnitude
w = 0, and the second (
such that w > 0
and dR/d
= 0. These are highlighted in Figure 1. So-
lutions of the ﬁrst kind must occur at
Y0, solutions
<
Y
of the second kind must occur at
Y0, and at most
>
one solution of the second kind occurs on either side of
Y1.
in the interval
by a bisection search over
−
Y1

100. We likewise identify
100
ln
≤ Z ≤
interval
to divide
Y0
100. The discriminant R is monotonic
−
over each subinterval by construction, so in each case
we can search for a root using a combination of bisection
search and Newton-Raphson reﬁnement. We check the
intervals in order, from nearest to
= 0 to furthest,
and terminate the search as soon as a root is found.

Y0 using bisection
Y1
.
|Y0|
the

We use
100

> 0, we search for

≤ Z ≤

≤ Z ≤

Y
100

and

−

Y

3.4.3. Relation to auto diff

Y

Y

TDC returns

given L and the other solver variables.
It additionally returns the partial derivatives of
with
respect to each of those variables. This relies, funda-
mentally, on the new automatic diﬀerentiation feature
(see §2).
In particular, we used auto diff to calcu-
late and propagate partial derivatives with respect to 33
variables of stellar structure through a Newton-Raphson
solver, producing the partial derivatives of a root-ﬁnding
procedure with respect to its inputs. The auto diff
functionality enables the implementation of TDC.

3.5. Reduction to Cox MLT

We now derive the modiﬁcations needed to ensure that
TDC in MESA agrees with MLT in the limit of long time
steps.

In TDC, the convective luminosity is given by Equa-

tion (6). In MLT, the convective luminosity is

Lconv = 4πr2f2ρcP T vcΛ(

∇ − ∇e)h−

1

(17)

(Ludwig et al. 1999), where vc is the convective velocity
and f2 is a parameter dependent on the choice of MLT
prescription. Finally,
∇e is the temperature gradient
of a convective eddy, which is related to the eﬃciency
parameter

Γ

≡

∇ − ∇e
∇e − ∇L

.

We may write

∇ − ∇e =

Γ
1 + Γ

∇ − ∇L) =
(

Γ
1 + Γ Y

,

(18)

(19)

Figure 1. The residual of the luminosity equation R (upper)
and w at the end of the time step (lower), plotted as functions
of Y in a case where the correct Y < 0 and the initial w > 0.
Vertical dashed red lines denote the two special points Y0
(left) and Y1 (right). Input parameters were chosen so that
there are three solutions to R(Y) = 0 (black dots), with
Lsolver = 0.1, L0 = 2, ∇ad = 1, c0 = 20, ξ1 = 0, ξ2 = −1,
−Y, and δt = t − t0 = 5, all in arbitrary
winitial = 1, |J| =
units.

√

Y

magnitude

) solution, which connects smoothly to the
= 0 limit. These preferences yield this rule: we al-
and thus

Y
ways select the solution with the smallest
the slowest-decaying convection speed.

|Y|

To ﬁnd this solution, it is useful to examine R(

) in
a representative case, shown in Figure 1. Each solution
is a choice of
) = 0 (Equation 14).
Solutions are convective when w > 0 and radiative oth-
erwise.

such that R(

Y

Y

Y

≈

0.2 and

The ﬁrst (slowest-decaying) solution is convective,
0.35. The second solution
with w
Y ≈ −
is also convective, with w
0.75. Fi-
≈
nally, the third solution is purely radiative, with w = 0
0.95. The local maximum in R is due to the
and
Y ≈ −
becomes more negative, w falls but
fact that as
is not monotonic.
rises, so the product w

0.05 and

Y ≈ −

|Y|

Y

However, we do not know a priori how many solutions
there are. There can be no more than three, but by
changing Lsolver we can make the example shown in Fig-
ure 1 have just one (convective) solution. Our approach

Y

Y−1.5−1.0−0.50.00.5RY0Y1Y2−1.25−1.00−0.75−0.50−0.250.00Y0.00.10.2wY0Y1Y2so

Lconv =

Γ
1 + Γ

4πr2f2ρcP T vcΛ

Y

h−

1.

(20)

Next we identify w =
Λ = αh, so

3/2vc (in steady state) and

(cid:112)

Lconv = 4πr2α

Γ
1 + Γ

2
3

1/2

f 2
2

ρcP T w

.

(21)

Y

(cid:18)
This is nearly the same as Equation (6). In particular,
in Cox1 MLT (Cox & Giuli 1968) f2 = 1/2 and

(cid:19)

Lconv = 4πr2α

Γ
1 + Γ

ρcP T

w
√6 Y

,

(22)

so the only diﬀerence is the term involving Γ.

That term, which controls the convective eﬃciency, is
a genuine diﬀerence between TDC-in-RSP and MLT. We
want TDC in MESA to match the outputs of MLT in the
steady state limit, in agreement with Kuhfuß (1986), we
modify Equation (6) to include the factor Γ/(1 + Γ),
giving

Lconv = 4πr2α

Γ
1 + Γ

ρcP T

w
√6 Y

.

(23)

We evaluate Γ by calling MLT with the same inputs as
TDC. We then treat this as ﬁxed during the TDC itera-
tions, which allows us to still use the algorithm described
in §3.4.

With these modiﬁcations, the luminosity equations
3/2vc in steady state. We

now agree, subject to w =
now derive the conditions required to make this hold.

In MLT, the convective velocity is given by

(cid:112)

c = f1Λ2gδ(
v2

∇ − ∇e)h−

1,

(24)

where f1 is a parameter determined by the choice of
MLT and

δ

≡ −

∂ ln ρ
∂ ln T

=

χT
χρ

.

P

Using Λ

≡

αh we can write Equation (24) as

c = α2f1hg
v2

(

∇ − ∇e).

(cid:12)
(cid:12)
(cid:12)
(cid:12)
χT
χρ

Next, with Equation (19) we ﬁnd

c = α2f1hg
v2

χT
χρ

Γ
1 + Γ Y

.

(25)

(26)

(27)

1 If desired, TDC may be modiﬁed to match other variants of MLT

or other choices of f2.

11

(cid:112)

In TDC, we have identiﬁed the convection speed with
vc ≡
2/3w, so we now proceed to prove that this is
equivalent to that given by Equation (27). When the
TDC discriminant J 2 < 0, then
< 0 so the system is
subadiabatic. Hence, at long times w = 0 and therefore
vc = 0, which matches the MLT answer. When the dis-
criminant is positive the system is convectively unstable,
so we use Equation (11) and ﬁnd

Y

vc =

2
3

1
2ξ2 (cid:18)

−(cid:114)

J tanh

λ + δtJ
4

+ ξ1

.

(28)

(cid:19)

This solution was constructed assuming not only that
J 2 > 0 but also that the relevant root is J > 0. As
δt

the tanh term approaches unity. In this limit

→ ∞

vc =

1
6

1
ξ2

−(cid:114)

(J + ξ1) ,

(29)

and we also have ξ1 = 0 because Dρ/Dt = 0 and αr = 0
(Equation 9). Inserting the deﬁnition of J and expand-
ing with Equations (8) and (10) we ﬁnd

v2
c =

1
6

J 2
ξ2
2

=

2ξ0
3ξ2

−

=

α2cP T

∇adY

8αD

.

(30)

Comparing this with Equation (27), for equality

α2cP T

∇adYMLT
8αD

= α2f1hg

χT
χρ

Γ

1 + Γ YTDC.

(31)

As before, to obtain equivalence between MLT and
in the

TDC we need to substitute
Y
velocity equation. In addition, we need to have

Γ/(1 + Γ) for

Y

cP T

∇ad

8αD

= f1hg

χT
χρ

.

(32)

With some rearranging, and using h = P/ρg, we ﬁnd

1
8αDf1

=

P χT
χρρcP T

∇ad

.

(33)

With Γ3 = 1 + (P/ρcV T )χT ,

1)

= (Γ3 −

1
8αDf1

cV
χρcP ∇ad
In Cox MLT f1 = 1/8, and in TDC by default αD = 1,
so the two sides are equal.

Γ3 −
1
Γ1∇ad

= 1.

(34)

=

The net result is that in the limit of long time steps,
TDC and Cox MLT solve the same luminosity equation
with the same inputs and so are mathematically iden-
tical. We ﬁnd they agree numerically to around seven
decimal places in
1. We further im-
plement the calculation of convective mixing diﬀusivity

, even when

Y (cid:28)

Y

12

3.6. Accreting White Dwarfs

(cid:12)

yr−

6 M

WDs accreting He at rates (cid:46) 10−

1 undergo
He shell ﬂashes (Iben & Tutukov 1989). These ﬂashes
can lead to He nova (e.g., V445 Puppis; Ashok & Baner-
jee 2003), or even double-detonation type Ia supernovae
(e.g., Shen & Bildsten 2009; Woosley & Kasen 2011;
Kupfer et al. 2022). The time-dependent burning is
controlled by three timescales: the local nuclear heat-
ing time,

theat ≡

cP T
(cid:15)nuc

,

(35)

temperature
being the characteristic timescale for
changes due to nuclear burning; the convective accel-
eration time,

taccel ≡

4
J

=

3h
√2αDcP T

,

∇adY

(36)

being the timescale over which convection is varies (see
Equation 11); and the local dynamical time,

tdyn ≡
In steady state taccel is proportional to the eddy turnover
time

(37)

.

h
cs

Figure 2. The values of Y (upper) and vc (lower) plotted
as functions of ∇rad − ∇ad for MLT, TDC, and TDC without
the correction Y → YΓ/(1 + Γ) in the convective velocity
and luminosity equations. The time step was chosen to be
long enough that TDC reaches equilibrium.

and all other derived quantities using vc in the same way
in both TDC and Cox MLT.

Y → Y

Figure 2 shows the importance of the

Γ/(1+Γ)
correction. In both panels, the solutions for TDC and
MLT lie on top of each other. The solution for TDC
in the equations, by contrast,
without the correction of
deviates signiﬁcantly in both panels. This deviation is
starkest in the lower panel, which shows a diﬀerent vc
scaling in the ineﬃcient (

1) limit.

Y

∇rad − ∇ad (cid:28)

teddy ≡

αh
vc

,

(38)

but in cases of interest taccel and teddy can be quite dif-
ferent.

on a

Shen & Bildsten (2009) showed that He shell masses
of (cid:38) 0.03 M
WD can yield a theat compa-
(cid:12)
rable to or shorter than taccel or even tdyn near the base
of the convection zone (BCZ). TDC will yield diﬀerent
results than MLT in this limit.

1 M

≈

(cid:12)

(cid:12)

−

−

yr−

7.1 and

(cid:12)
1) between

We construct these He ﬂash models by accreting ma-
terial comprising 99% 4He and 1% 14N by mass (as ex-
pected for solar metallicity stars that have undergone
carbon-oxygen WD at con-
CNO burning) onto a 1 M
stant log( ˙M /M
7.4 in steps
of 0.1 dex. Compressional heating results in a local tem-
perature increase until the He shell ignites. Lower ˙M re-
sults in weaker compressional heating and a more mas-
sive He shell at ignition. Because heat is transported
from the temperature peak towards both the core and
the surface, ignition occurs above the base of the freshly
accreted layer. We stop the accretion once a convective
zone appears at the ignition site, and continue evolving
through the He ﬂash. Both the total accumulated He
shell mass and location of ignition are impacted by the
included reaction chain 14N(e−, ν)14C(α, γ)18O (NCO,
Hashimoto et al. 1986; Bauer et al. 2017).

∇rad−∇ad10−610−410−2100YCoxMLTTDCTDCw/ocorrection10−710−510−310−1101∇rad−∇ad100101102103104105106vc(arbitraryunits)13

Figure 4. Evolution of various time scales in the convection
zone (upper), the time derivative of convective velocity at
a ﬁxed mass coordinate (middle), and the superadiabaticity
at the same location (lower). The upper panel compares the
heating timescale (solid line), actual timescale for tempera-
ture change (dashed line), convective acceleration timescale
(dot-dashed line), and dynamical timescale (dotted line), for
models 1 and 3 (TDC only). The ﬁrst three timescales are
evaluated at the BCZ, and the last at maximum convective
velocity. Line styles in the middle and lower panels follow
that of Figure 3, and in the middle panel we show the gravi-
tational acceleration at the BCZ (gBCZ, dotted line) for com-
parison.

decrease sharply with TBCZ until the WD starts to ex-
1 displayed in
d ln T /dt
pand. To reduce the noise in
−
|
Figure 4, we ﬁt it with a polylogarithmic function. The
1 decreases with
diﬀerence between theat and
−
|
thicker He shells, as heat released by nuclear burning is
increasingly trapped locally.

d ln T /dt
|

|

Another relevant timescale is taccel, evaluated at max-
imum vc. At log(TBCZ/K) (cid:46) 8.4, taccel ≈
(3/4)teddy.

(cid:12)

Figure 3. Evolution of TBCZ and PBCZ during a He ﬂash on
a 1 M
WD with various He shell masses. Solid and dashed
lines correspond to models run with TDC and Cox MLT re-
spectively. The values in parentheses indicate the masses in
solar units enclosed within and exterior to the BCZ, respec-
tively. Dotted lines are contours of ﬁxed logarithmic ratio be-
tween theat and taccel. For the contours here, taccel ≈ 10 tdyn
(e.g., model 4 reaches theat/tdyn ≈ 0.1).

(cid:12)

In Figure 3, we label our models 1–4 at diﬀerent

˙M
7.2, etc.) and note
(with 1 corresponding to
the masses enclosed by and exterior to the base of the
convection zone (BCZ), which set the pressure PBCZ at
ignition. The total accumulated He shell mass ranges
from 0.03 to 0.08 M

7.1, 2 to

−

−

.

Figure 3 shows the evolution of TBCZ and PBCZ for
models 1–4 with both TDC and Cox MLT. All mod-
els initially evolve at nearly constant PBCZ, which in-
creases with He shell mass. As temperature increases
in the convection zone, the envelope expands and re-
duces PBCZ. Concurrently, TBCZ reaches a maximum
(Shen & Bildsten 2009). Thicker He shells reach higher
peak TBCZ and larger ratios between theat and taccel.
When models show theat (cid:46) taccel (models 3 & 4) and
start expanding, TDC starts to deviate from Cox MLT,
with greater deviations for thicker He shells. TDC shows
higher TBCZ than Cox MLT at ﬁxed PBCZ because TDC
results in more superadiabatic convection. In contrast,
when theat (cid:38) taccel (models 1 & 2) TDC and Cox MLT
show good agreement in the evolution of PBCZ and TBCZ.
several
The heating
timescales for TDC models 1 & 3.
1, but
timescale, theat, trends similarly with
−
|
the latter is larger than theat by factors of a few, be-
cause heat released by nuclear burning is distributed
throughout some portion of the convection zone. Due
to the sharp dependence of (cid:15)nuc on T , both timescales

The upper panel of Figure 4 compares

d ln T /dt
|

21.522.022.5log(PBCZ/dyncm−2)8.08.28.48.68.89.0log(TBCZ/K)PBCZ=13aT4BCZ10-1-2TDCCox1(1.010,0.020)2(1.014,0.027)3(1.018,0.038)4(1.021,0.056)log(theat/taccel)10−1100101102τ[s]TDCtdyn|dlnT/dt|−1theattaccel105107109Dvc/Dt[cms−2]gBCZTDCCox12348.48.68.89.0log(TBCZ/K)10−210−1100Y14

Figure 5. Proﬁles of T and P within model 3 at diﬀerent
moments, when both TDC (solid) and Cox MLT (dashed)
reach the same TBCZ. Curves of same color correspond to
identical TBCZ.

At log(TBCZ/K) (cid:38) 8.4, taccel evolves more quickly than
teddy, becoming up to 3 (6) times smaller than teddy in
model 3 (4). This is because convection is no longer in
steady-state, as theat (cid:46) taccel for log(TBCZ/K) (cid:38) 8.4
8.5
(see also Glasner et al. 2018). At minimum theat, the hi-
erarchy of timescales changes from

−

to

d ln T /dt
|

|

−

1 (cid:38) theat (cid:38) taccel (cid:29)

tdyn

taccel (cid:38)

d ln T /dt
|

−
|

1 (cid:38) theat (cid:38) tdyn

from model 1 to model 3, and ultimately to

taccel (cid:38) tdyn (cid:38)

d ln T /dt
|

|

1 (cid:38) theat
−

in model 4. The fact that convection is not able to reach
a steady state on the evolutionary timescale of the He
ﬂash explains the diﬀerence between TDC and Cox MLT
in models 3 & 4 (see Figure 3).

Y

We illustrate the diﬀerence in the evolution of vc and
between TDC and Cox MLT in the middle and lower
Y
panels of Figure 4. For each TDC and Cox MLT pair,
we locate the mass coordinate at which vc peaks when
) = 9 (arbitrarily chosen), and evaluate
log(Lnuc/L
(cid:12)
Dvc/Dt and
during the initial acceleration phase. Ini-
tially, TDC and Cox MLT show good agreement when
taccel (log(Tbcz/K) (cid:46) 8.4). When theat (cid:46) taccel
theat (cid:29)
(log(Tbcz/K) (cid:38) 8.5), TDC shows slower evolution in vc
and larger
than Cox MLT. As vc is lower in TDC,
heat is less eﬃciently transported out of the BCZ, re-
sulting in higher TBCZ and
near maximum. With a
thicker He shell, Dvc/Dt may become comparable to g
(especially for Cox MLT model 4).

Y

Y

Figure 6. Same as Figure 5, but instead showing T , s, vc,
and X(12C) as a function of mass coordinate from top to
bottom. In the third panel, cs is shown for comparison.

20.521.021.522.022.5log(P/dyncm−2)7.758.008.258.508.759.00log(T/K)10-1P=13aT4log(theat/taccel)TDCCox8.08.28.48.68.89.0log(T/K)TDCCox3.03.54.04.55.05.5s[kBNA]101102103vc[kms−1]cs1.021.031.041.05m[M(cid:12)]−2.00−1.75−1.50−1.25−1.00logX(12C)−

We now study the evolution of model 3 in detail. In
Figure 5, we compare seven snapshots of the TDC and
Cox MLT models in T
P space, when both reach
the same TBCZ. The three coolest pairs of curves show
good agreement and little superadiabaticity (third panel
of Figure 4). For the subsequent three hotter pairs,
grows up to order unity near peak TBCZ. Once
Y
theat (cid:46) taccel, heat is trapped more locally in TDC com-
pared to Cox MLT. Therefore, TDC reaches the same
TBCZ earlier in the evolution, and has a higher PBCZ
due to comparably colder outer layers. Likewise, TDC
shows less evolution in T
P near the top of the con-
−
vection zone and more superadiabaticity near the BCZ,
again because of stronger heat-trapping near the BCZ.
Figure 6 compares TDC and Cox MLT in model 3 as
a function of mass coordinate. The two show reasonable
agreement in vc when log(TBCZ/K) (cid:46) 8.5. At this point,
theat drops below taccel (see Figure 4), which leads to
TDC yielding lower vc than Cox MLT. For the same
reason, vc near the top of the convection zone appears
frozen in TDC for 8.6 (cid:46) log(TBCZ/K) (cid:46) 8.8.

At ﬁxed TBCZ, TDC shows lower T throughout the
convection zone, reﬂecting a local buildup of heat at the
BCZ. Since TDC carries heat out of the BCZ less eﬃ-
ciently, it also shows a stronger entropy gradient, and for
8.6 (cid:46) log(TBCZ/K) (cid:46) 8.8, T and s show little evolution
near the top of the convection zone.

Both TDC and Cox MLT show appreciable abundance
gradients, as 12C is produced near the BCZ but there is
insuﬃcient time for it to be transported outwards. Cox
MLT shows higher 12C abundance overall, as it has more
time to reach the same TBCZ and larger vc. As TDC
modiﬁes both the T and Xi proﬁles, it may impact the
potential for the ignition to develop into a detonation
that would result in a thermonuclear transient.

In summary, we see that convection in TDC adjusts
more slowly to changes in heating than in Cox MLT.
This results in slower, more superadiabatic convection
during rapidly-burning phases of evolution. The incor-
poration of the dynamics of how convection grows and
decays is now possible and enabled by default in MESA
via TDC.

4. EQUATION OF STATE

∼

MESA models require thermodynamic quantities over
a large span of T , ρ, and Xi. This involves calling the
104–1010 times, depending on the chosen
MESA EOS
local physics and the number of iterations, cells, and
time steps. It would be ideal to have a single EOS that
accurately represents the relevant physics in all regimes,
obeys all thermodynamic consistency relations to the
limits of the arithmetic, and is as eﬃcient in storage and

15

execution as possible. Below we report progress towards
this ideal.

Figure 7 shows the default MESA EOS boundaries for
solar and pure-metal (50% 12C, 50% 16O by mass) com-
positions. Broadly, we prioritize HELM (Timmes &
Swesty 2000) at high T and low ρ for handling of the
electron-positron plasma. Elsewhere we prioritize Skye
(Jermyn et al. 2021), limited by partial ionization at
lower T and ρ. We then prioritize FreeEOS (Irwin
2004), then OPAL (Rogers & Nayfonov 2002) and SCVH
(Saumon et al. 1995), and ﬁnally, when there are no
other options, we use an ideal gas with radiation. Blend-
ing boundaries between the diﬀerent EOS prescriptions
are set to defaults that have been motivated by speciﬁc
use cases. For example, we have chosen the boundaries
between FreeEOS and Skye such that solar models at
the age of the Sun stay fully on FreeEOS and do not
encounter the FreeEOS-Skye blend.

4.1. Skye

Skye is an EOS for fully ionized matter (Jermyn et al.
2021). A motivation for developing Skye was elimi-
nating the blend between HELM and PC (Potekhin
& Chabrier 2010). There is a blend between HELM
and Skye that occurs at much higher T and lower ρ
(see Figure 7), where the two agree. Skye includes
the eﬀects of positrons, relativity, and electron degen-
eracy (Timmes & Swesty 2000; Baturin et al. 2019),
Coulomb interactions (Ichimaru et al. 1987; Potekhin
& Chabrier 2010; Potekhin & Chabrier 2000; DeWitt &
Slattery 1999; Baiko et al. 2001; Farouki & Hamaguchi
1993), non-linear mixing eﬀects (Caillol 1999; Potekhin
et al. 2009; Potekhin & Chabrier 2013; Ogata et al.
1993; Medin & Cumming 2010), and quantum correc-
tions (Hansen & Vieillefosse 1975; Nagara et al. 1987;
Carr et al. 1961; Potekhin & Chabrier 2000; Potekhin
& Chabrier 2010; Baiko 2019; Baiko & Chugunov 2022).
Skye determines the point of Coulomb crystallization
in a self-consistent manner, accounting for mixing and
composition eﬀects. A deﬁning feature of Skye is the use
of analytic Helmholtz free energy terms and automatic
diﬀerentiation (see §2) to provide thermodynamic quan-
tities. Skye is thus readily extendable to new physics by
including additional terms in the free energy (Jermyn &
Timmes 2022).

Skye is both a standalone software instrument and in-
tegrated into MESA. The two implement the same input
physics and options. At times this has required mod-
iﬁcations of other parts of MESA. Here we describe the
most important of these modiﬁcations.

16

Figure 7. Default EOS boundaries for a solar-like composition (Z = 0.02, left) and for a pure-metal composition (Z = 1, 50%
12C and 50% 16O by mass, right). The colors and labels indicate an ideal gas approximation, Skye, FreeEOS, OPAL, SCVH,
HELM, and blends between two EOSs. The black curve in the left panel shows a model for the present day Sun.

4.1.1. Crystallization

Skye determines the crystallization phase transition
by minimizing the Helmholtz free energy, which permits
derivatives to be discontinuous at the transition. For in-
stance, the entropy discontinuity reﬂects the latent heat
of crystallization. This posed a challenge in MESA. Con-
sider the expression

Ds
Dt

.

(39)

T
(cid:15)grav ≡ −
∂F/∂T

≡ −

|ρ undergoes a discontinuity
The entropy s
at the phase transition. If Ds/Dt is evaluated by ﬁnite
diﬀerences, then no time step will be small enough to
produce a converged result for (cid:15)grav. We could write

Ds
Dt

=

∂s
∂T

DT
Dt

ρ

+

∂s
∂ρ

Dρ
Dt

,

T

(40)

(cid:12)
(cid:12)
(cid:12)
(cid:12)

(cid:12)
(cid:12)
(cid:12)
(cid:12)

but this form misses the latent heat of the phase tran-
sition because, except for the inﬁnitesimal vicinity of
crystallization, thermodynamic derivatives of s contain
no information about the transition. At the phase tran-
sition, derivatives of s contain a Dirac delta contribu-
tion, which cannot be directly implemented in numer-
ical calculations. The choice is between poor conver-
gence (ﬁnite diﬀerences of s) or neglecting the latent
heat (Equation 40).

To address crystallization, Skye returns a parameter
φ that provides a smoothed representation of the phase.
Speciﬁcally, φ = 1 in the solid phase, φ = 0 in the liquid
phase, and near the phase transition φ smoothly interpo-
lates between these limits. The transition in φ is tuned
so that the crystallization boundary is numerically re-
solved and yet spans a small fraction of a stellar model.

Using φ, Skye then constructs a smoothed version of the
latent heat of crystallization, which is only signiﬁcant in
the transition region. This allows use of Equation (40)
to avoid numerical issues near the phase transition, but
requires that we include an extra heat source in the en-
ergy equation to capture the latent heat:

(cid:15)latent ≡

LT

D ln T
Dt

+ Lρ

D ln ρ
Dt

,

(41)

where LT and Lρ represent the diﬀerences between
smoothed and original versions of the entropy deriva-
tives T ∂s/∂ ln T and T ∂s/∂ ln ρ. The original deriva-
tives lack the latent heat, while the smoothed ones
contain it, so LT and Lρ produce additional heating.
With this procedure, MESA is able to model phase tran-
sitions, remain numerically converged, and accurately
capture the latent heat of crystallization. This proce-
dure smears only the latent heat of crystallization and
does not smear the thermodynamics of the phase tran-
sition, which would produce unphysical results such as
negative sound speeds.

The Skye EOS approach represents a signiﬁcant im-
provement for the MESA latent heat treatment. Previ-
ously, MESA relied on a ﬁnite diﬀerence of the entropy cal-
culated in the PC EOS for solid and liquid phases so that
latent heat could be included in (cid:15)gravvia Equation (39),
smoothing this quantity near the phase transition for
numerical convergence (MESA IV). Another common
approach is to include latent heat release with an ex-
mp based
plicit heating term using lcr ≈
(cid:105)
on the calculation of Salaris et al. (2000). Our new ap-
proach based on Skye has the advantage that the phase
diagram and latent heat release are both calculated from
ﬁrst principles and are self-consistent with the underly-

0.77kBT /

A
(cid:104)

−10010log(ρ/gcm−3)246810log(T/K)SunMESAEOSRegions(X=0.7,Z=0.02)blendHELMOPAL/SCVHFreeEOSSkyeideal−10010log(ρ/gcm−3)246810log(T/K)MESAEOSRegions(X=0.0,Z=1.0)blendHELMOPAL/SCVHFreeEOSSkyeidealing thermodynamics of the EOS. Jermyn et al. (2021)
showed that the net latent heat release is commensurate
with the Salaris et al. (2000) value.

4.2. FreeEOS

We use FreeEOS version 2.2.1 (Irwin 2004) to expand
the chemical composition parameter space covered by
partial ionization, as compared to the OPAL tables.
This replaces the eosPTEH tables of MESA V. FreeEOS
minimizes a Helmholtz free energy to span essentially
the same thermodynamic range as OPAL.

The FreeEOS tables generated for MESA use the ‘EOS1’
mode, which is the highest level of physical accuracy pro-
vided by FreeEOS. The tables are parameterized by the
metal mass fraction Z = 0, 0.02, 0.04, 0.06, 0.08, 0.10,
0.20, 0.30, 0.40, 0.50, 0.60, 0.70, 0.80, 0.90, and 1.00.
All tables assumed a scaled-solar chemical composition
based on Grevesse & Sauval (1998). For Z
0.80, there
is also a set of tables with X(12C) = X(16O) for use
with WD interiors. For each Z a range of H mass frac-
Z are provided, allowing
tion values between 0 and 1
for a complementary range of He mass fractions. The
tools to generate a new set of MESA EOS tables for an
arbitrary chemical composition using FreeEOS are pro-
vided in MESA DIR/eos/eosFreeEOS builder with the
exception of the FreeEOS library, which can be down-
loaded from the FreeEOS repository.

≥

−

4.3. EOS Blends

The MESA EOS blends several EOS prescriptions.
Each EOS returns fundamental quantities and the par-
tial derivatives of those quantities. The blends of funda-
mental quantities and derivatives are treated diﬀerently
because they are used by MESA for diﬀerent purposes.
Fundamental quantities enter into physical equations,
and so must be physical (e.g., positive sound speed),
while their derivatives are used to construct the solver
Jacobian, and so must represent accurate derivatives of
the fundamental quantities.

The EOS returns a vector res containing fundamen-
tal EOS quantities such as e, s, and cV (see MESA I
Table 3), as well as blending fractions for the various
EOS components. The EOS also returns corresponding
vectors d dlnd and d dlnT of partial derivatives of each
of the quantities in res with respect to ρ and T .

At the boundary between a pair of EOS prescriptions
(EOS1 and EOS2) we calculate blends of res, d dlnd
and d dlnT independently. The EOS at a point in the
blending region between EOS1 and EOS2 is evaluated
[0, 1] representing the frac-
with blending coeﬃcient α
tion of EOS1, and 1
α representing the fraction of
EOS2. We construct blending coeﬃcients using a quintic

−

∈

17

polynomial with zero slope at the blending boundaries
(MESA V). The blending coeﬃcients therefore have non-
zero derivatives with respect to ρ and T in blending re-
gions. Quantities in the resulting resblend vector are
evaluated as a linear mix using the blending coeﬃcient,

resblend = α res1 + (1

α) res2 .

(42)

−

For the derivative vectors, we include additional terms
to account for the derivatives of the blending coeﬃcients,

d dlndblend =α d dlnd1 +

∂α
∂ ln ρ

res1

+ (1

α) d dlnd2 −

−

∂α
∂ ln ρ

res2 ,

(43)

and similarly for d dlnT. Including these terms for the
blending coeﬃcients in the derivative blends provides
correct derivatives for the solver, reducing the number
of Newton iterations.

Some quantities in the fundamental EOS res vector
are themselves derivatives of other EOS quantities, such
(∂e/∂T )ρ. The diﬀerent blending treatments for
as cV ≡
EOS quantities and their derivatives mean that thermo-
dynamic identities may be violated in blending regions.
Physical equations such as the energy equation must
use quantities such as cV from res rather than the the-
oretically equivalent but numerically diﬀerent derivative
quantities from the d dlnT vector. The latter can lead
to unphysical results such as negative heat capacities or
negative sound speeds. This inconsistency is unavoid-
able so long as we must blend between diﬀerent EOS
prescriptions.

4.4. Thermodynamic Consistency

One desirable feature in an EOS is thermodynamic
consistency, which ensures that the Maxwell relations
hold — e.g., mathematically equivalent forms of the
equations of stellar structure are also numerically equiv-
alent within the ﬂoating point precision of the arith-
metic. Unfortunately, several of the EOS prescriptions
in MESA are not fully thermodynamically consistent.
This can cause errors in energy conservation, making
mathematically equivalent formulations of the structure
equations behave diﬀerently.

Here we report on the current state of thermodynamic
consistency in MESA. Figure 8 compares the consistency
measure

∂s/∂T
∂e/∂T
for the MESA EOS with PC and OPAL (left, former de-
fault) and with Skye and FreeEOS (right, current de-
fault). The quantity dse is zero in thermodynamically
consistent systems.

|ρ
|ρ −

(44)

dse

≡

T

1

18

Figure 8. The logarithm of the thermodynamic consistency measure dse for the MESA EOS computed with PC and OPAL (left)
and Skye and FreeEOS (right) with X = 0.7, Y = 0.28, and Z = 0.02, with Z comprising equal mass fractions of 12C and 16O.

As Skye derives all quantities from partial derivatives
of a Helmholtz free energy, it is thermodynamically con-
sistent to near machine precision. Without Skye, the
corresponding regions of the EOS are covered by PC
and HELM. The regions with Skye active show thermo-
dynamic consistency to near machine precision, repre-
3) (cid:38) 3.
senting a signiﬁcant improvement for log(ρ/g cm−
The band at log (T /K)
10 in the right panel is due
−
to a blend in the EOS from Skye to HELM, which is re-
quired to remedy a ﬂoating point loss-of-precision issue
in Skye when electron-positron pairs dominate the EOS.
In the left panel the PC region shows a stripe of high er-
ror due to Coulomb crystallization. FreeEOS is thermo-
dynamically consistent to near machine precision. Our
current method of interpolating the MESA FreeEOS ta-
bles does not preserve this property. Still, these tables
show signiﬁcant improvement relative to OPAL.

≈

9

5. ENERGY EQUATIONS

Section 3 of MESA V highlighted the importance of
numerical energy conservation in MESA models, and in-
troduced a new form of the energy equation aimed at
improving energy conservation. This new form moti-
leading to tighter
vated several solver improvements,
tolerances for equation residuals and corrections. We
now advance that discussion by further explaining the
multiple formulations of the energy equations in MESA.
We contrast the advantages conferred by each formu-
lation across diﬀerent applications. We also clarify the
meaning of the quantities rel E err and rel run E err
reported for MESA runs, and elucidate what these quan-

tities do and do not tell us about the quality of the MESA
solutions.

After reviewing the energy-equation fundamentals and
recent implementation improvements in §5.1, we explore
an idealized example problem without any composition
changes or EOS complexities in §5.2. This example mo-
tivates a new time-centered approach for evaluating the
eps grav form of the energy equation, and demonstrates
that a lower value of rel run E err does not always in-
In
dicate evolution that is more physically accurate.
§5.3 we describe the additional complexities introduced
by thermodynamic inconsistencies that can be present
in the EOS, especially in EOS blending regions, and
how these manifest in diﬀerent ways for diﬀerent energy
equation implementations.

(cid:12)

Finally, in §5.4 we illustrate the various contributions
to energy error terms through the example of a 1 M
star
including both composition changes due to nuclear burn-
ing and EOS blends and inconsistencies. This example
demonstrates that the quantity rel run E err must be
interpreted diﬀerently for diﬀerent forms of the energy
equation. When using the dedt form of the energy equa-
tion, the energy error reﬂects the quality of the residuals
from the MESA solver, even though larger energy errors
associated with the EOS are still present in the model.
When using the eps grav form of the energy equation,
the energy error reports much larger values that reﬂect
the presence of these EOS errors, even when the quality
of solutions may be comparable to or better than the
dedt form.

Convergence tests and comparisons between multiple
forms of the energy equation remain vital for under-

−10−50510log(ρ/gcm−3)345678910log(T/K)PCOPALSCVHHELMHELMlog(dse)–OPAL/PC−14−12−10−8−6−4−20−10−50510log(ρ/gcm−3)345678910log(T/K)SkyeFreeEOSTablesOPALSCVHHELMHELMlog(dse)–FreeEOS/Skye−14−12−10−8−6−4−20standing the reliability and accuracy of solutions in dif-
ferent regimes. Signiﬁcant progress has been made in
ensuring that diﬀerent forms of the energy equation con-
verge to the same result. In degenerate conditions, the
eps grav forms generally perform better (i.e., they are
closer to the converged answer at a given time resolu-
tion). With the dedt form, the numerical energy conser-
vation error often measures the quality of the solution
(i.e., the size of the residuals). Focusing on improving
that quantity has driven signiﬁcant solver improvements
and motivated the development of an accurate energy
accounting infrastructure. This energy accounting work
has also motivated improving the eps grav form to ac-
count for composition changes, as well as an implicit
trapezoidal time-centering scheme. MESA now includes
these changes by default when using the eps grav form
of the energy equation. Further progress rests on im-
provements to the quality of the EOS.

5.1. Fundamentals and Implementations

MESA has two primary energy equations. One, called
the “eps grav form”,2 is the standard stellar structure
energy equation (e.g., Kippenhahn et al. 2012) and is
the equation introduced in MESA I. This equation is

∂L
∂m

= (cid:15) + (cid:15)grav ,

(45)

where L is the luminosity, (cid:15) is a speciﬁc energy genera-
tion source term (e.g., nuclear reactions, neutrinos), and

(cid:15)grav ≡ −

De
Dt

+ P

D
Dt

=

T

−

Ds
Dt −

i (cid:18)

(cid:88)

(cid:18)

1
ρ
(cid:19)
∂e
∂Xi (cid:19)s,ρ,

{

(46)

DXi
Dt

.

X

=Xi

}

In practice, the total Lagrangian time derivative of e
is expanded and further manipulated to reach the ﬁnal
form evaluated in MESA (see MESA IV, §8).

The other, called the “dedt form”, is an energy equa-
tion for the time evolution of the total speciﬁc energy of
a Lagrangian cell,

D
Dt

(cid:18)

e +

1
2

u2

−

Gm
r

(cid:19)

= (cid:15)

∂
∂m

−

(L + P

A

u) ,

(47)

= 4πr2 is the area of
where u is cell velocity and
the cell face. The relationship between these two forms
was derived in MESA IV, Section 8.3 and the dedt form

A

2 In MESA V, we referred to this equation as the “dLdm form”.
That was an unfortunate choice as a ∂L/∂m term occurs in all
versions of the equation.

19

was introduced as a powerful tool in support of improved
numerical energy conservation in MESA V, §3.

When solutions are numerically converged (i.e., have
suﬃcient
space/time resolution to give resolution-
independent results) and the EOS is thermodynamically
consistent and provides correct partial derivatives (see
§5.3), these two equations should give identical results.
Conversely, the solutions may diﬀer when unconverged.
The error in numerical energy conservation during a
step, Estep
err , is evaluated as the diﬀerence between the
change in total energy of the model across the time step
and the expected change in total energy due to known
energy sources and sinks (e.g., nuclear reactions, neu-
trinos, surface luminosity). Total energy is deﬁned as

Etot ≡

e +

(cid:90) (cid:18)

1
2

u2

−

Gm
r

=

dmk

ek +

(cid:88)k

(cid:18)

(cid:19)

1
2

u2
k −

dm

Gmk
rk (cid:19)

,

(48)

where dmk is the mass contained within cell k. Addi-
tional terms for rotational kinetic energy can also be
included in Equation (48) when rotation is enabled, and
turbulent energy is included for RSP models.

err and Erun

A cumulative sum of the per-step energy errors, Erun
err ,
is tracked during a run. When divided by the total en-
ergy at the end of the step, Estep
err respectively
become the quantities rel E err and rel run E err
that are reported by MESA. As stated in MESA V, these
quantities are primarily meant to represent a measure of
the numerical reliability of solutions accepted for MESA
evolution steps, rather than a measure of physical va-
In §5.3 and
lidity and completeness of MESA models.
§5.4, we focus on further clarifying the meaning of these
energy error quantities, which require a diﬀerent inter-
pretation when using the eps grav form of the energy
equation than when using the dedt form.

MESA does not solve its discretized, ﬁnite-mass form
of the stellar structure equations exactly. When a trial
solution is accepted, the residual diﬀerence between the
left- and right-hand sides of the equation becomes an
error in numerical energy conservation. Therefore, one
necessary step in ensuring good numerical energy con-
servation is to select tight tolerances for the acceptance
of a solution. This requires suﬃciently high quality
derivatives in the Jacobian that the solver can reach
these tolerances in a reasonable number of Newton iter-
ations (see §3 of MESA V).

However, even achieving zero residuals is not suﬃcient
to ensure numerical energy conservation. When MESA
modiﬁes the stellar model outside of the Newton solve,
the resulting changes in total energy must be correctly

(cid:54)
20

included in the accounting. When physically appropri-
ate, compensating energy source terms must be included
in the equations that are solved during the Newton it-
erations.

For example, mass changes of the stellar model are one
such process, and the procedure that ensures numerical
energy conservation is described in §3.3 of MESA V.
At that time, this procedure was applied only when
using the dedt form of the equation. Now, it is used
with all forms of the energy equation, and the less gen-
eral approach originally used with the eps grav form
(MESA III, §7) has been removed from MESA.

The composition changes associated with element dif-
fusion (§3 of MESA IV) and convective premixing (§5 of
MESA V) are also incorporated in an operator-split
manner (i.e., adjustments to the model made outside
of the Newton iterations for the implicit structure solve
during an evolutionary step; see also §10), and so require
special accounting. The energy changes due to these
composition changes are now tracked and compensat-
ing source terms are added to the equations, improving
numerical energy conservation.

Non-conservation of numerical energy can also occur
when the equations being solved are approximated in
ways that do not conserve energy. Historically, the
default MESA implementation of (cid:15)grav (MESA I, Equa-
tion 12) dropped the term associated with composition
changes. While the energy associated with composition
changes is dwarfed by the energy released by nuclear
reactions (see MESA IV), the integrated energy error
introduced by dropping this term is not negligible com-
pared to the value of Etot by the end of the MS.

In MESA V, Figure 25, the “dLdm-form” calculation
(right panel) did not include composition changes in
(cid:15)grav, and so the large values of the relative energy error
shown during core He burning eﬀectively quantify the
impact of dropping the composition term rather than
characterizing the numerical quality of the MESA solu-
tion.
In this case, the scale of the reported error ap-
pears signiﬁcant because MESA adopts Etot as the ref-
erence value for checking cumulative numerical energy
conservation. A larger reference value, like the time-
integrated radiated energy of the star, is typically used
to justify dropping the composition term from (cid:15)grav.

A continued focus on numerical energy conservation
requires equations that are energy conserving, so MESA
now includes the composition term in its default imple-
mentation of (cid:15)grav. With (ρ, T ) as the thermodynamic
structure variables, we have

(cid:15)grav =

cV T

−

D ln T

Dt −

+ (cid:15)grav,Xi ,

∂e
∂ρ

ρ

(cid:20)

(cid:18)

(cid:19)T −

D ln ρ
Dt

P
ρ

(cid:21)

(49)

where cV ≡
(65), MESA implements the equivalent expression

(∂e/∂T )ρ. As shown in MESA IV, Equation

(cid:15)grav =

− ∇adχT )

cP T

(1

−
+ (cid:15)grav,Xi ,

(cid:20)

D ln T
Dt − ∇adχρ

D ln ρ
Dt

(cid:21)

cP ≡

(∂e/∂T )P −

(∂ ln T /∂ ln P )s. The composition term is

(P/ρ2)(∂ρ/∂T )P

(50)

and

where
∇ad ≡

i (cid:18)

(cid:15)grav,Xi ≡ −

∂e
∂Xi (cid:19)ρ,T,
When implemented in MESA, the quantity (cid:15)grav,Xi is eval-
uated as a ﬁnite-diﬀerence approximation to the direc-
tional derivative along the change in the composition
vector over the time step:

DXi
Dt

(51)

(cid:88)

=Xi

X

{

}

.

(cid:15)grav,Xi =

1
δt

−

[e(ρ, T,

)
Xi}
{

−

e(ρ, T,

Xi}start)] .
{

(52)
This is analogous to the approach used in evaluating
the spatial composition derivatives that enter into the
Brunt-V¨ais¨al¨a frequency (§3.3 of MESA II). In addition
to being simpler to evaluate, this approximation is nu-
merically convenient because it only requires ﬁrst deriva-
tives of e with respect to composition in order to form
the Jacobian. The MESA eos module and its interface
with MESAstar have been upgraded either to provide
these partial derivatives when available, or to construct
approximations to these partial derivatives for the Jaco-
bian based on ﬁnite diﬀerences using small variations of
the composition when analytic derivatives are not avail-
able.

The total derivatives of the structure variables in
Equation (50) are evaluated as their diﬀerences over the
time step. In previous implementations of the eps grav
form of the energy equation, the thermodynamic quan-
tities that multiply the total derivative quantities were
evaluated at the end of the step (in the standard MESA
backwards-Euler approach). As a means of further im-
proving numerical energy conservation when using the
eps grav form, we have now introduced a higher-order
(in time) version of (cid:15)grav using the implicit trapezoidal
rule. This replaces end-of-step quantities with time-
centered versions (i.e., averages of the values at the start
and end of the step). We refer to this as “eps grav
(centered)” in contrast to the previous implementation,
which we indicate as “eps grav (end of step).” As we
shall show in the following sections, including both com-
position changes and time-centering in the eps grav im-
plementation greatly improves energy conservation, so
we now include both of these improvements by default
in MESA when using the eps grav form.

(cid:54)
In the following sections, we use test cases to demon-
strate the performance and physical meaning of numer-
ical energy conservation under the various forms of the
energy equation in MESA. We also show that in some cir-
cumstances, such as degenerate stars, the eps grav form
of the energy equation converges to accurate entropy
and temperature evolution substantially faster than the
dedt form does, even while reporting larger errors in
numerical energy conservation.

5.2. Results: carbon kh

(cid:12)

As an illustrative test case, we follow an initially low-
sphere of pure carbon as it undergoes
density, 1.3 M
Kelvin-Helmholtz contraction. The model begins at a
3) = 1 and we follow the
central density of log(ρc/g cm−
contraction over a factor (cid:38) 107 increase in ρc. Nuclear
reactions are not considered. For simplicity, we assume
that the radiative opacities are given by electron scatter-
ing and include standard thermal neutrino losses. This
model does not experience convection. We exclusively
use the HELM EOS, as the use of a single EOS that is
formulated from the Helmholtz free energy avoids most
of the EOS inconsistencies that we discuss in §5.3.

This case is not meant to model a real object, but
provides a simple example problem that has neither
mass changes nor composition changes. It is nonetheless
demanding as the conditions in the star vary tremen-
dously during the evolution as material goes from non-
degenerate conditions to conditions of relativistic elec-
tron degeneracy, and the dominant energy loss mech-
anism transitions from radiative diﬀusion to optically-
thin neutrino cooling.

We explore three diﬀerent versions of the energy equa-
tion: the dedt form, the eps grav form (end of step),
and the eps grav form (centered). We use a tempo-
ral convergence study to illustrate the performance of
the diﬀerent variants of the energy equation. For each
equation, we show three time resolutions, and compare
against a family of ultra-resolution runs that serve as ref-
erence solutions. These ultra-resolution reference runs
still show small diﬀerences depending on which form of
the energy equation is selected, so we also show that
smaller level of disagreement to indicate the level of dif-
ferences that should be interpreted as signiﬁcant. We
interpret the small magnitude of disagreement between
ultra-resolution runs as evidence that the diﬀerent ver-
sions of the energy equation are converging to the same
result for suﬃciently high resolution.

Figure 9 shows the trajectory of Tc versus ρc. While
this calculation does not consider nuclear reactions, in
calculations that do, the T and ρ sensitivity of the nu-
clear reaction rates motivates obtaining solutions that

21

(cid:12)

Figure 9. Convergence tests of the evolution of the central
quantities for the contracting 1.3 M
sphere of pure carbon
using diﬀerent forms of the energy equation. The central
density is a proxy for time. The top panel shows Tc. The
middle panel shows the Tc diﬀerence from a reference so-
lution. The three line styles represent the three levels of
resolution as indicated by the legend in the top left corner of
the upper panel. The grey region marks the level of agree-
ment between the set of reference solutions. The lower panel
shows the time step for each resolution, with the time step of
the runs used in the ultra-resolution reference set indicated
as the solid grey line.

are converged in these quantities (e.g. Schwab et al.
2015). This example does include thermal neutrinos,
which lead to central cooling at high density. The top
panel shows that the two eps grav versions agree (to
within the line width) at all resolutions, while the dedt
form shows visible diﬀerences during the evolution af-
ter the model has reached its maximum Tc. The level
of diﬀerence from the reference solution is shown in the
middle panel. All forms exhibit ﬁrst-order convergence,
where a 1 dex reduction in the time step leads to a 1 dex
reduction in the error in Tc. However, at a ﬁxed reso-
lution, the eps grav forms show similar performance to
each other and superior performance relative to the dedt
form.

7.07.58.08.59.0log(Tc/K)lowmidhigh10−710−410−1∆log(Tc/K)2468log(ρc/gcm−3)−2024log(δt/yr)reference(ultra)dedt(totalenergy)epsgrav(endofstep)epsgrav(centered)lowmidhigh22

In order to understand why the eps grav forms
perform better under degenerate conditions, consider
an adiabatic change, de + P d(1/ρ) = T ds = 0 at ﬁxed
composition. This expression is satisﬁed exactly for in-
ﬁnitesimal changes and a perfect EOS. When we inte-
grate across a time step, we know the integral of total
time derivatives (e.g. De/Dt or D ln ρ/Dt) exactly, but
approximate the integral over the time step for quan-
tities that are not total time derivatives. The extent
to which our scheme will fail to reproduce an adiabatic
evolution is the error in approximating these other inte-
grated quantities appearing in the energy equation (e.g.,
P or cV ). Recall that the usual backwards Euler ap-
proach in MESA is eﬀectively like assuming that the non-
total-time-derivative part is constant and equal to the
end-of-time step value (e.g., P = Pend).

For nearly adiabatic evolution in electron degenerate
conditions, we have a cancellation between large de and
P d(1/ρ) terms, but this cancellation ends up incomplete
in MESA because the evaluation of the former term is ex-
act while the latter has error. The error is usually small
compared to the order of the terms being subtracted,
and so imperfect cancellation often will not introduce
large errors. But in degenerate material, the scale of the
cancelling terms is larger than the thermal energy by
µe/kBT , where
roughly the degeneracy parameter η
µe is the electron chemical potential. Therefore, oth-
erwise small cancellation errors can be ampliﬁed by a
factor of η for the temperature evolution.3

≡

By contrast, when we write the (cid:15)grav form, this
cancellation for adiabatic evolution instead occurs in
P/ρ] (Equation 49) which is replaced with
[ρ(∂e/∂ρ)T −
∇adχρ in the form of Equation (50) that MESA uses
cP T
for its eps grav implementation. This captures adia-
batic density evolution in terms of EOS derivative quan-
tities that are not subject to cancellation errors.
In-
stead, accuracy in this form is limited by the accuracy
of our approximations over ﬁnite time steps for ther-
∇ad appearing in the energy
modynamic quantities like
equation. The error associated with time discretization,
− ∇adχT )]end∆ ln T + [cP T
[cP T (1
∇adχρ]end∆ ln ρ, is at
η smaller than the cancellation error,
least a factor of
∼
and in practice can be even better.

Figure 10 shows the total energy of the model. The
top panel shows that all runs agree in this quantity
within the line width, while the middle panel reveals
the level of relative diﬀerence. We emphasize that even

3 Numerical cancellation errors are a common pitfall for evolution
in electron degenerate material. See Brassard et al. (1991) for
a detailed discussion of an analogous problem in evaluating the
Brunt-V¨ais¨al¨a frequency in WD interiors.

Figure 10. Convergence tests of the evolution of the to-
tal energy for the contracting 1.3 M
sphere of pure carbon
using diﬀerent forms of the energy equation. The top panel
shows the negative total energy. The middle panel shows the
diﬀerence from a reference solution. The grey region marks
the level of agreement between the set of reference solutions.
The lower panel shows the relative cumulative energy error
for each run.

(cid:12)

though the dedt runs report by far the best cumulative
energy error as a measure of step-to-step internal energy
consistency (lower panel of Figure 10), they neverthe-
less show less accurate evolution of the total energy and
temperature relative to the ultra high-resolution refer-
ence runs (middle panel of Figure 10). This is because
the cumulative energy error reports the degree to which
energy is conserved by evolution steps, while the total
energy is a function of the global stellar structure which
can slowly diverge even with zero reported energy error.
This reﬂects the fact that “energy error” as reported
by MESA is primarily a measure of the internal consis-
tency of the stellar structure solver, and should not be
construed as always reﬂecting globally accurate energy
evolution. This reported error is still a useful diagnostic
for MESA models, but must be interpreted with caution.
All forms of the energy equation in Figure 10 approxi-
mately show ﬁrst-order convergence in the total energy.

10491050−TotalEnergy[erg]lowmidhigh10−710−410−1RelativeDiﬀerence2468log(ρc/gcm−3)10−1210−910−610−3relrunEerrdedt(totalenergy)epsgrav(endofstep)epsgrav(centered)lowmidhighThe lower panel shows that the diﬀerent forms exhibit
notably diﬀerent behaviors with increasing time resolu-
tion. The dedt form has excellent numerical energy con-
servation that does not depend on time resolution. The
error is roughly the error due to the non-zero residuals in
the solution of the energy equation. The eps grav forms
display worse performance in this quantity, though the
error shrinks as the time step decreases. The “end of
step” form shows ﬁrst-order convergence, while the “cen-
tered” variant exhibits more rapid, second-order conver-
gence with smaller numerical energy conservation errors
at ﬁxed resolution. We would expect these trends to
continue until the numerical energy conservation error
is no longer dominated by errors due to the temporal
discretization, at which point it reaches the ﬂoor set by
non-zero residuals or imperfect EOS thermodynamics.

The pure carbon case shows that the time-centered
eps grav form of the energy equation is the best choice
for models evolving under degenerate conditions, with
the best balance between accurate temperature evolu-
tion and step-to-step energy conservation according to
Figures 9 and 10. This case was idealized to focus on the
eﬀects of ﬁnite equation residuals and time discretiza-
tion. We now move on to discussing the additional com-
plexities introduced by EOS imperfections.

5.3. Quantifying EOS shortcomings

The value of e returned by the EOS is an essential
ingredient in evaluating the total energy of the model,
and high-quality partial derivatives of EOS quantities
are critical for accurate and eﬃcient solver performance.
We now discuss three primary EOS issues that inﬂuence
energy conservation and solver performance.

First, an EOS may return low quality partial deriva-
tives that degrade convergence of the implicit solver. We
now mitigate this with more careful derivative account-
ing described in §5.3.1.

Second, an EOS may have internal inconsistencies in
its reported thermodynamics. We have mitigated this by
upgrading the MESA EOS patchwork with Skye (Jermyn
et al. 2021) and FreeEOS (Irwin 2004) as described in
§4.

Third, even when individual EOS components yield
excellent thermodynamic consistency, the necessity of
blending between EOS components to provide contin-
uous coverage across diﬀerent regimes inevitably in-
troduces additional thermodynamic inconsistency. We
have mitigated this last issue by minimizing the number
and severity of EOS blends as much as possible, but un-
avoidable energy inconsistencies remain, and we discuss
their implications for energy conservation in §5.3.2.

23

5.3.1. EOS Derivatives

In MESA V, we addressed the quality of the EOS
derivatives by introducing new options that used bicu-
bic spline interpolation in high-resolution tables of Pgas,
s, and e. This provided accurate ﬁrst and second par-
tial derivatives by evaluating analytic derivatives of the
interpolating polynomials rather than by interpolating
values of tabulated derivatives. While this approach
successfully ensured that the partial derivatives corre-
sponded to how the interpolated EOS values actually
changed in response to small changes of the parameters,
it inevitably led to small, interpolation-related artifacts
∇ad or Γ1. In as-
in partial derivative quantities such as
teroseismic applications that require smooth proﬁles of
the Brunt-V¨ais¨al¨a frequency, this approach proved un-
satisfactory.

MESA now adopts an approach that separately treats
quantities that appear in the equations (and happen to
be partial derivatives) and the places where these theo-
retically equivalent, but numerically diﬀerent quantities
appear in the Jacobian (as partial derivatives of other
quantities that appear in the equations). That is, the Ja-
cobian uses the partial derivatives of interpolants, while
the equations use the interpolants of partial derivatives.
This enables both eﬃcient numerics and smoother solu-
tions at the cost of some additional bookkeeping.

5.3.2. Thermodynamic Consistency and EOS Blends

In order to quantify how models employing the dif-
ferent forms of the energy equation experience inconsis-
tencies in the EOS diﬀerently, we establish a measure
of the quality of the MESA EOS during the evolution of
) basis, the total
a model as follows. In the (ρ, T,
derivative of the speciﬁc internal energy, e, mathemati-
cally satisﬁes

Xi}

{

De
Dt − (cid:34)(cid:18)

∂e
∂ρ

Dρ
Dt

+

∂e
∂T

(cid:18)

(cid:19)T,

Xi

}

{
∂e
∂Xi (cid:19)ρ,T,

+

i (cid:18)

(cid:88)

X

=Xi

{

}

}

Xi

(cid:19)ρ,
{
DXi
Dt (cid:35)

DT
Dt

= 0.

(53)

For a Lagrangian volume corresponding to a cell k,
we evaluate the time integral of the left hand side of
Equation (53) across a time step. We replace the sum
over individual composition derivatives with a single
directional derivative along the direction of composi-
tion change over the time step, as in the evaluation of
(cid:15)grav,Xi. We approximate terms that are not the integral
of total derivatives using the implicit trapezoidal rule.
Weighting by dmk and summing over all cells this gives,

(cid:54)
24

for a single step,

Estep

err,eos =

n

(cid:88)k=1

dmk

∆e

(cid:40)

−

−

∂e
∂ρ

ρ

(cid:20)

(cid:18)

∆ ln ρ

(cid:19)T (cid:21)

[cV T ]∆ ln T

∆eXi

−

,

(cid:41)k

(54)

where overline quantities are the trapezoidal rule esti-
mates corresponding to the average at the start and
end of the time step. The value ∆eXi = e(
)
Xi}
{
e(
{
to composition changes alone at a given ρ and T , so

−
Xi}start) is the change in speciﬁc internal energy due

∆eXi =

1
2

e(ρstart, Tstart,

(cid:2)

+ e(ρ, T,

{

)
Xi}
{
)
Xi}

−

−
e(ρ, T,

e(ρstart, Tstart,

Xi}start)
{

.

{

Xi}start)
(cid:3)

(55)

Summing the per-step errors over a MESA run, then at
the n-th time step, we have

n

Erun

err,eos =

Estep,i

err,eos.

(56)

i=1
(cid:88)
As the time step is reduced, the error from the tem-
poral discretization shrinks and Erun
err,eos converges to a
measure of the energy error incurred as a result of EOS
shortcomings.

We deﬁne two other energy errors. By limiting the
sum in Equation (54) to those zones that are in an EOS
blend during a particular time step, we can isolate the
per-step energy error due to the blend and so analo-
gously deﬁne Estep
err,blend and Erun
err,blend. We deﬁne the per-
step residual energy error Estep
err,res as the mass-weighted
sum of the energy equation residuals over the model and
also track its cumulative value Erun

err,res.

To understand how these diﬀerent forms of error might
manifest under diﬀerent treatments of the energy equa-
tion, it is helpful to consider the idealized case of an EOS
that is a blend of EOS1 and EOS2, identical except for
their deﬁnition of where the energy zero point lies, so
that eEOS1 = eEOS2 + eoﬀset, where eoﬀset is some con-
stant. Physically, either EOS should produce the same
evolution, and all EOS derivatives will be the same.
However, evolution through the blend between EOS1
and EOS2 will not satisfy Equation (53), and there-
fore must lead to non-zero values of Estep
err,eos regardless of
which form of the energy equation is used. In particular,
the thermodynamic identity cV = (∂e/∂T )ρ is violated
in the blending region because the blending coeﬃcient
derivatives are not included as part of the blended value
of cV (see §4.3).

In practice, such energy oﬀsets (in addition to other
inconsistencies) always occur at the locations of MESA
EOS blends because it is impossible to construct a blend-
ing region in which two distinct EOS treatments agree
exactly. Due to diﬀerent input physics assumptions
in diﬀerent EOS components, energy oﬀsets have more
complexity than simple constant zero point diﬀerences
across the range of parameters where blending is neces-
sary. As far as possible, we have chosen blending loca-
tions to minimize the diﬀerences between EOS compo-
nents and to minimize the residual amount of unavoid-
able oﬀset (e.g., by adjusting the deﬁnitions of internal
energy to be as consistent as possible about where the
zero point lies). However, no general solution is cur-
rently available to completely eliminate inconsistencies
for blends between our current EOS components, and
EOS blends therefore remain one of the largest poten-
tial sources of energy error when present in MESA models.
When evolving using the dedt form of the energy
equation, Equation (47) will lead to eoﬀset being folded
into the De/Dt term of the energy equation for regions
of the model evolving through the blend, injecting spu-
rious heating/cooling into those regions. However, the
energy error reported by MESA in these regions may still
be 0, because MESA evaluates energy error according to
the blended e from the EOS. It is therefore possible to
have models for which Estep
err,eos is signiﬁcantly larger than
E err reported by MESA when using the dedt form of the
energy equation, as we shall see in the following sub-
section. On the other hand, in this idealized scenario
the eps grav form of the energy equation (Equations 49
and 50) would give the physically correct evolution since
it is evaluated in terms of derivatives that are unaﬀected
by the energy oﬀset in the blending region. However,
both Estep
err,eos and rel run E err will report large values
under the eps grav form in this scenario, reﬂecting the
thermodynamic inconsistency of e in the blended EOS
rather than inaccuracy in the evolution.

5.4. Results: 1M pre ms to 1TP

Having demonstrated the performance of the various
forms of the energy equation in idealized circumstances
in §5.2, we now model the evolution of a 1 M
star from
(cid:12)
the pre-main sequence to its ﬁrst He thermal pulse on
the AGB. This example includes composition changes
due to nuclear reactions, and it uses the current de-
fault MESA EOS (blending together FreeEOS and Skye
for the (ρ, T ) regions encountered by this model). A
small portion of the envelope of this model encounters
the FreeEOS-OPAL/SCVH blend near ZAMS, then the
model lies entirely on FreeEOS for most of the ﬁrst
5 Gyr of MS evolution (see §4 and Figure 7), after

≈

25

do not show up in the reported rel run E err for this
form of the energy equation, as explained in §5.3. In the
middle panel, the end-of-step eps grav form shows that
the numerical energy conservation error remains above
the energy errors associated with the EOS, while these
in turn are generally well above the errors associated
with the equation residuals. This panel also illustrates
that the measure of the energy error associated with the
EOS blend itself has approximately converged (agree-
ment among orange lines in the middle of the plot). The
measure of the EOS inconsistency in places where this
quantity is not dominated by the blend (i.e., where the
blue lines are above the orange lines) continues to shrink
with increasing time resolution, showing that this mea-
sure is not converged and that the true inconsistency is
less than that indicated by the highest resolution line.
In the bottom panel, the centered eps grav form shows
a numerical energy error (black lines) that is roughly the
energy error associated with the EOS inconsistencies. In
particular, by the end of the main sequence, the numer-
ical energy error is dominated by the blend error. Fur-
ther resolution increases or improvements to the energy
equation will not improve the numerical energy conser-
vation. Progress can only come through improvements
to the EOS.

6. ATMOSPHERE

The MESA atm module uses an atmosphere model to
evaluate the pressure Ps and temperature Ts at the out-
ermost (k = 1) cell boundary. These ‘model surface’
values are in turn incorporated in the outer boundary
conditions applied to the stellar model, as speciﬁed in
Equation (10) of MESA I. Here we describe various im-
provements and ﬁxes in the atm module since MESA I
and MESA II.

In older MESA releases, the choice of atmosphere model
was controlled by the which atm option inlist param-
In recent releases this parameter is renamed
eter.
atm option, with three possible choices:
• atm option = 'T tau': atmosphere based on T (τ )

relations, as discussed in §6.1.
• atm option = 'irradiated':
sphere, as discussed in §6.2.

• atm option = 'table':

discussed in §6.3.

irradiated

atmo-

tabulated atmosphere, as

In addition, MESA now oﬀers two complementary ap-
proaches to including the atmosphere structure in model
data passed as input into pulsation codes. These are de-
scribed in §6.4 and §6.5.

6.1. Atmospheric T (τ ) Relations
Setting atm option = 'T tau' builds an atmosphere
in which temperature at each optical depth τ is speciﬁed

Figure 11. Comparison of types of energy errors for a 1 M
(cid:12)
model. Each panel shows a diﬀerent form of the energy equa-
tion. Each line color indicates a diﬀerent type of energy er-
ror. Each line style indicates a diﬀerent time resolution. The
thick black lines show the error in numerical energy conserva-
tion that MESA reports as rel run E err. The thinner colored
lines show the errors due to the EOS, EOS blends, and equa-
tion residuals. The composition term (cid:15)grav,Xi is included for
both of the eps grav panels in this ﬁgure.

which the core evolves toward higher density and en-
counters the FreeEOS-Skye blend. The approach de-
scribed in §5.3 allows us to quantify the various sources
of energy errors, identifying how much error comes from
EOS inconsistencies and blends, and how much is due
to residuals of the equation solutions.

Figure 11 summarizes the energy errors deﬁned in §5.3
when using diﬀerent forms of the energy equation. Be-
cause the models are approximately converged and the
diﬀerent forms of the energy equation converge to the
same solution, the colored lines at a given time resolu-
tion are similar in all panels.

In the top panel, the dedt form shows a numerical
energy error (black lines) that is roughly the energy er-
ror associated with the equation residuals (green lines).
The EOS energy errors are present in the model, but

10−1110−710−3relrunEerrdedt(total)errEOSblendres10−1110−710−3relrunEerrepsgrav(endofstep)0510Age[Gyr]10−1110−710−3relrunEerrepsgrav(centered)11.411.611.8Age[Gyr]lowmidhigherrEOSblendres26

by a function T (τ ); Ps and Ts are obtained by evaluat-
ing the atmospheric thermodynamic state at an optical
depth τs corresponding to the nominal model surface.
This optical depth can be much smaller or much greater
than the optical depth τ
2/3 typically associated with
stellar photospheres; that is, the model surface need not
correspond to the photosphere.

≈

The T (τ ) functions have the form

T 4(τ ) =

3
4

T 4
eﬀ [τ + q(τ )] .

(57)

Selection of T (τ ) is set by the atm T tau relation inlist
parameter, with four possible choices:
• atm T tau relation = 'Eddington':

gray,
Eddington-approximation relation, where q(τ ) = 2/3.
• atm T tau relation = 'solar Hopf': the q(τ ) func-
tion described in Equation (A9) of MESA II, which is
a ﬁt to Model C of the solar atmosphere by Vernazza
et al. (1981), often referred to as VAL C.
• atm T tau relation = 'Krishna Swamy':

the rela-

the

tion from Equation (33) of Krishna Swamy (1966).

• atm T tau relation = 'Trampedach solar':

the
relation from Ball (2021), itself a ﬁt to the solar at-
mosphere simulation by Trampedach et al. (2014).
For a given T (τ ) relation, the corresponding P (τ )
throughout the atmosphere is obtained by integrating
the hydrostatic balance equation

∂P
∂τ

=

g
κ

,

(58)

(cid:28)

from τ
1 inward to τ = τs. In this integration the
gravity is set to the constant value g = GM/R2, in ac-
cordance with the assumption that the atmosphere is ge-
ometrically thin and contains negligible mass. The opac-
ity evaluation is controlled by the atm T tau opacity
inlist parameter, with three possible choices:
• atm T tau opacity = 'fixed' — uniform κ
throughout the atmosphere, with a value set by the
current opacity κ1 in the outermost cell.

• atm T tau opacity = 'iterated' — uniform κ
throughout the atmosphere, with a value obtained
from the kap module for (Ps, Ts). As indicated by
its name, this choice requires iteration because Ps is
not known a priori.

• atm T tau opacity = 'varying' — varying

κ
throughout the atmosphere, with a value obtained
from the kap module for (P, T ) at the local τ .

With the last choice, the dopri5 (5th-order Dormand-
Prince) diﬀerential equation integrator from the num
module is employed with speciﬁable error tolerance and
maximum number of steps. With the ﬁrst and second
choices, however, the fact that κ does not depend on τ

means that Equation (58) can be integrated analytically
to yield

P (τ ) =

g
κ

τ

(cid:18)

1 + Pextra factor

κL
6πGM cτ

×

(cid:19)

.

(59)

The second term in the parentheses arises as a constant
of integration, and accounts for non-zero radiation pres-
sure in the limit of small τ . The term is obtained from
Equation (20.16) of Cox & Giuli (1968). The parameter
Pextra factor depends on the assumed angular depen-
dence of the radiation speciﬁc intensity, with the default
value of unity corresponding to isotropic-outward, and
a value of 1.5 corresponding to radial-outward. While
unphysical, setting Pextra factor > 1.5 can sometimes
be a useful numerical strategy to improve convergence
in models that are close to the Eddington limit. How-
ever, caution is warranted as this strategy can produce
incorrect stellar radii.

For T (τ ) atmospheres, Table 5 summarizes the map-
ping between the which atm option parameter choices
supported in older MESA releases, and the combinations
of atm T tau relation and atm T tau opacity param-
eter choices that provide the replacement functionality.
In implementing the changes described here, we un-
covered two issues that impacted the accuracy and per-
formance of the atm module in older releases.

First, calls to the eos and kap modules to evaluate
ρ(P, T ) and κ(ρ, T ) did not use the same tables and/or
conﬁguration options as the interior model, leading to
possible inconsistencies at the surface where the atmo-
sphere and the interior join. To ﬁx this problem, we
implemented a callback system so that the star mod-
ule can pass appropriately conﬁgured EOS and opacity
wrapper routines to the atm module.

in

Second,

cases where

atm T tau opacity =
'iterated', the partial derivatives of Ps and Ts with
respect to dependent variables (L1, r1, ρ1, T1) in the out-
ermost cell were incorrectly evaluated; in some cases,
this caused the global Newton solver to converge slowly
or not at all. To ﬁx this problem, we implemented the
correct expressions, which follow from application of
the chain rule to the T (τ ) relation and the hydrostatic
solution (Equation 59).

6.2. Irradiated Atmospheres
Setting atm option = 'irradiated' provides func-
tionality similar to 'T tau', but adopting the T (τ )
relation for an externally irradiated atmosphere given
in Equation (6) of Guillot & Havel (2011). Equa-
tion (58) is integrated analytically, with opacity eval-
uation controlled by the atm irradiated opacity in-
the possible choices 'fixed' and
list parameter;

Release r11701 and earlier
which atm option
'simple photosphere'
'gray and kap'
'Eddington gray'
'Krishna Swamy'
'solar Hopf'

Release r12115 and later

atm T tau relation
'Eddington'
'Eddington'
'Eddington'
'Krishna Swamy'
'solar Hopf'

atm T tau opacity
'fixed'
'iterated'
'varying'
'varying'
'varying'

27

Table 5. Mapping between which atm option parameter choices in releases of MESA up to r11701 (see §12.4), and the corre-
sponding parameter choices in releases since r12115 (to be used in tandem with atm option = 'T tau').

'iterated' behave the same as described in §6.1.
The 'iterated' case replaces the which atm option =
'gray irradiated' choice described in MESA II, and
ﬁxes a bug related to incorrect Teﬀ evaluation.

6.3. Tabulated White Dwarf Atmospheres
When atm option = 'table', Ps and Ts are obtained
by interpolating in pre-computed atmosphere tables.
In addition to the options described in MESA I and
MESA II, MESA now provides a new set of atmosphere
tables for WDs with He-dominated surfaces (DB WDs).
These tables provide Ps and Ts data over the ranges
2) <
5, 000 K < Teﬀ < 40, 000 K and 6.0 < log(g/cm s−
9.4. They assume a He dominated composition of
5nHe, and are based on model atmospheres
nH = 10−
calculated using the Koester (2010) code and evaluated
at τ = 25. The limits of this grid are now explained.

At Teﬀ (cid:38) 40, 000 K He undergoes its second ioniza-
tion, and non-LTE eﬀects that are not included in the
atmosphere code become important. The lower limit
of Teﬀ = 5, 000 K is imposed by the Koester (2010)
code’s EOS. Studies of spectroscopic samples of DBs
(e.g., Eisenstein et al. 2006; Genest-Beaulieu & Berg-
eron 2019) have shown that DBs are well described for
2) = 9.5. The
surface gravities lower than log(g/cm s−
2) = 6.0 is imposed by the
lower limit of log(g/cm s−
convergence of the models at Teﬀ = 40, 000 K, since ra-
diation pressure competes with gravity in this regime.

As a diagnostic for these new tables, we use the
depth of the surface convection zone in cooling DB
WD models, which is primarily sensitive to the at-
mospheric boundary condition and the stellar model
EOS in the convective region.
Figure 12 demon-
strates the improvements brought by these new ta-
bles, plotting the mass Mcvz of the surface convec-
tion zone versus Teﬀ . Also shown are results from
the atmosphere and envelope models of Koester et al.
(2020), as well as the outcome from using atm option =
'T tau' with atm T tau relation = 'Eddington' and
atm T tau opacity = 'fixed'.

The new tables reproduce the Koester et al. (2020)
calculations much better at low Teﬀ than the Edding-

Figure 12. Depth of the surface convection zone (measured
as fractional convection zone mass Mcvz/M ) for a 0.57 M
,
(cid:12)
2) ≈ 8.0 WD with a He atmosphere. The curves
log(g/cm s−
indicate MESA results with the DB tables and the Eddington
T (τ ) relation, while the points are based on Koester et al.
(2020).

ton T (τ ) atmospheres. The latter diverge for Teﬀ (cid:46)
15, 000 K because the conditions at the surface cross the
boundaries of the He opacity table coverage in MESA. The
tabulated atmospheres agree with Koester et al. (2020)
7, 000 K. For cooler temperatures, the uncer-
to Teﬀ ≈
tainty in Mcvz is due to the uncertain EOS at the base
of the convection zone (Saumon et al. 1995). 4

6.4. Atmosphere Reconstruction for Pulsation Codes

As discussed in MESA II and MESA III, MESA can pass
models to the ADIPLS (Christensen-Dalsgaard 2008) or
GYRE (Townsend & Teitler 2013) linear pulsation codes,
either in-memory during an astero-module optimiza-
tion or via ﬁles written to disk in a variety of for-
mats. Often, it is desirable to reconstruct the atmo-
1 before passing
sphere structure from τ = τs out to τ

(cid:28)

4 See discussion at http://www1.astrophysik.uni-kiel.de/∼koester/
astrophysics/astrophysics.html, where the full tables of convec-
tion zone depths based on Koester et al. (2020) are hosted.

5000100001500020000Teﬀ[K]−10−8−6−4log(Mcvz/M)DBAtmosphereTableEddingtonT(τ)Koester(2020)28

1dP/dr (in units of the
Figure 13. The hydrostatic term ρ−
surface gravity GM/R2) as a function of r/R for GYRE-format
models of the present-day Sun that include reconstructed at-
mospheres with atm option = 'T tau', atm T tau relation
= 'Eddington' and atm T tau opacity = 'varying'. The
two curves show releases r11701 (prior to the reconstruction
ﬁx) and r22.05.1; only the latter reproduces the correct be-
1dP/dr = −GM/R2 throughout the reconstructed
havior ρ−
atmosphere r/R ≥ 1.

For

T (τ )

them to the pulsation codes. This has no impact on the
interior model, but can improve asteroseismic modeling.
(§6.1),
setting
add atmosphere to pulse data = .true.
enables
this reconstruction. The radial coordinate r throughout
the atmosphere is then determined by integrating the τ
equation

atmospheres

∂r
∂τ

1
κρ

=

−

(60)

1. For this integration, κ
outward from τ = τs to τ
(cid:28)
is evaluated in accordance with the atm T tau opacity
parameter discussed previously, while ρ(P, T ) is ob-
tained from the eos module for the local τ .

In releases of MESA prior to r12115, the outward in-
tegration used an explicit Euler scheme with a default
step-size too large to accurately follow r(τ ). Together
with the eos/kap table inconsistency highlighted in §6.1,
this led to departures from hydrostatic balance in the re-
constructed atmosphere, as highlighted in Figure D.1 of
Christensen-Dalsgaard et al. (2020) for r/R > 1. To ﬁx
this issue, release r12115 and later use the dopri5 in-
tegrator for the outward integration, with a speciﬁable
error tolerance, step-size and outermost optical depth.
Figure 58 demonstrates these improvements by show-
ing hydrostatic balance for GYRE-format models of the
present-day Sun calculated using releases r11701 (pre-
ﬁx) and r22.05.1.

Figure 14. Ratio of the left- and right-hand sides of Equa-
tion (57), by which we compare the temperature structure
of two models in FGONG format, one with the atmosphere
reconstructed as in §6.4 (integrated) and the other with the
atmosphere modeled with the interior as in §6.5 (interior).

6.5. Atmospheres as Part of the Interior

The optically-thin outer layers of a star are usually
treated separately from the interiors of stars because
they do not satisfy the assumptions under which the in-
terior structure equations are derived. Given a T (τ ) re-
lation, however, it is possible to correct the equation for
radiative heat transport so that the temperature strati-
ﬁcation produced by solving the stellar structure equa-
tions matches the desired T (τ ) (Trampedach et al. 2014;
Mosumgaard et al. 2018a). The radiative temperature
gradient
∇atm of an atmosphere that follows a given
T (τ ) relation is

∇atm =

∇rad

1 +

(cid:18)

dq
dτ

.

(cid:19)

(61)

We can therefore recover any T (τ ) relation by scaling
∇rad by 1 + dq/dτ . This procedure is
the canonical
enabled with the new option use T tau gradr factor.
For the gray, Eddington-approximation relation, q(τ ) is
constant and no correction is necessary.

To include the optically thin layers in the inte-
rior model, the surface boundary should be set or re-
laxed to a smaller τ using the ﬂags set tau factor or
relax tau factor and their associated controls. The
surface boundary conditions, now at smaller τ , still fol-
low §6.1. They are evaluated at τs = tau factor
τeﬀ
rather than τeﬀ , where τeﬀ is the optical depth at which
the T (τ ) relation is equal to Teﬀ .

×

This approach has several advantages. First,

like
atmospheres reconstructed with atm T tau opacity =
'varying', the atmospheric structure is kept consis-
tent with MESA’s EOS and opacity routines. Second, the

0.99900.99951.00001.00051.0010r/R0.950.960.970.980.991.00−ρ−1dP/dr[GM/R2]r11701r22.05.110−410−310−210−1100τ0.960.981.00(4/3)(T/Teff)4/[τ+q(τ)]integratedinteriorcomputation can leverage the parallelization of MESA.
Finally, this approach accounts for the fact that g is
not exactly constant throughout the atmosphere (§6.4),
which is assumed by T (τ ) atmospheres.

Figure 14 shows the ratio of the left- and right-hand
ZAMS model with the
sides of Equation (57) in a 1M
'solar Hopf' T (τ ) relation when the atmosphere is ei-
ther reconstructed as in §6.4 or included as part of the
interior. Both models deviate at τ (cid:38) 2 because convec-
tion starts to transport heat.

(cid:12)

The reconstructed atmosphere deviates in τeﬀ < τ (cid:46) 2
= 0 just below the photosphere, which is
because dq/dτ
∇rad.
treated as part of the interior without correcting
When using analytic T (τ ) relations, this can be cor-
rected by using the use T tau gradr factor option but
not when using tabulated atmospheres, for which the
correction factors 1 + dq/dτ have not been provided.
1, where
Though inconsequential for tables at τs (cid:29)
dq/dτ
it introduces inaccuracy in the
temperature stratiﬁcation when using tables at small
τ . This inaccuracy may be acceptable, depending on
the scientiﬁc problem. This inaccuracy is not present if
dq/dτ = 0 in the aﬀected regions, which includes the
Eddington T (τ ) relation.

0 anyway,

→

6.6. Choosing atmosphere options

There is limited consensus on when to use which atmo-
sphere options, but we nevertheless oﬀer a few guiding
remarks.

The most commonly used and current default in MESA
is a gray Eddington atmosphere with the surface bound-
ary at τs = 2/3, with κ ﬁxed throughout the atmosphere.
If the precise behavior of the stellar atmosphere is not
important, this should suﬃce.

There is a hierarchy of accuracy at the expense
of greater computational cost among the choices for
atm T tau opacity. On the basis of the self-consistency
of κ, 'varying' is more accurate than 'iterated',
which is in turn more accurate than 'fixed'.

For the calculation of pulsations that have signiﬁcant
amplitude near the surface (e.g., solar p modes), it is
important to choose an option that allows the atmo-
sphere to be reconstructed for the equilibrium stellar
model (§6.4).

Tabulated atmospheres provide boundary conditions
that are typically computed using more complete physics
(e.g., non-LTE) than can be described by the stellar
structure equations. As shown in Figure 14, tabulated
atmospheres at τ (cid:46) 2 lead to a stellar model in which
the near-surface temperature stratiﬁcation is equivalent
to an Eddington atmosphere. The models in Figure 14
50 K at τeﬀ . This inaccuracy might be out-
diﬀer by

∼

29

weighed by the beneﬁts of a complete atmosphere model.
The correct structure could in principle be recovered by
extracting the appropriate T (τ ) relations (Trampedach
et al. 2014) from the detailed atmosphere models, but
these are not generally available.

Ideally, we would have access to grids of T (τ ) re-
lations and corresponding bolometric corrections ex-
tracted from advanced simulations of stellar atmo-
spheres, with parameters that cover the HR diagram.
Until this ideal is realized, stellar modellers must decide
which aspects of the atmospheric boundary condition
are most important for their calculations and choose ap-
propriate options.

7. CONVECTION IN THE OUTER LAYERS OF

STARS

7.1. Starspots

Starspots are common for stars with M (cid:46) M
(cid:12)

. Mod-
els of M dwarfs that include starspots and surface mag-
netism have inﬂated radii close to those inferred by ob-
servation (e.g., Feiden & Chaboyer 2013; Mann et al.
2015).

We thus implement in MESA the treatment of starspots
introduced in the SPOTS models of Somers et al. (2020),
which are based on the Yale Rotating Stellar Evolution
Code (YREC; Demarque et al. 2008; Spada et al. 2013)
and described in detail in Somers & Pinsonneault (2015)
and Somers et al. (2020).

7.1.1. Starspots formalism

Somers et al. (2020) parameterize the variance of the
surface ﬂux due to magnetic pressure from starspots by
modifying the atmospheric boundary condition. Somers
& Pinsonneault (2015) characterized the degree of
“spottiness” on the stellar surface by two parameters:

•

•

SPOTF (hereafter fspot), a coverage fraction, or
“spot ﬁlling factor”

SPOTX (hereafter xspot), representing the temper-
ature contrast between the spotted and unspotted
regions at r = R: xspot = Tspot/Tphotosphere.

Numerically, values from 0.0 to 1.0 are permitted for
both parameters. Observationally constrained coverage
fractions fspot are described in Cao et al. (2022), who
ﬁnd that a value fspot = 0.34 is a reasonable ﬁt to ob-
servations of sub-solar-mass stars in the λ Ori cluster.

The spot-induced temperature contrast, xspot, is re-
1.0. A
stricted to physically meaningful values of 0.5
value of xspot = 1.0 indicates that the eﬀective tem-
perature in the spotted region, Tspot, does not diﬀer
from the surrounding, unspotted eﬀective temperature,

−

(cid:54)
30

Tamb(r) (the “ambient temperature,” or ATEFF in YREC).
At the surface, Tamb(r = R) = Tphotosphere. A value of
xspot = 0.5, on the other hand, corresponds to the state-
ment that Tspot diﬀers from Tamb by the maximum de-
gree permitted by magnetic equipartition: namely, when
the magnetic pressure contribution constitutes half of
the total pressure.

The temperature contrast xspot perturbs the radiative
∇rad, spot, in the surface convection zone. This

gradient,
eﬀect can be made depth-dependent via

xspot(r) = 1

(1

−

−

xspot)

Tamb(r)
T (r)

,

(62)

where T (r) is the temperature at r and the quantity
Tspot is held constant
Tphotosphere −
as a function of r. In Equation (62), xspot is a scalar
parameter.

Tspot = Tamb(R)

−

Per equations (1) through (4) in Somers & Pinson-

neault (2015), the “spotted” luminosity is set to

Lspotted ≡

L/

fspot x4

spot + (1

−

fspot)

.

(63)

(cid:2)

YREC models the suppression of convective ﬂux at the
stellar surface via a two–part lookup in its atmospheric
boundary tables, invoking “ambient” versus “spotted”
eﬀective temperatures that diﬀer by a factor of

(cid:3)

αspot = 1 + fspot(x4

spot −

1),

(64)

where xspot can optionally be a function of the local
temperature at a given depth within the convective en-
velope.

7.1.2. MESA implementation

MESA’s implementation is equivalent, but modiﬁes the
surface boundary conditions in terms of pressure rather
than Teﬀ , as Teﬀ is strictly an output in MESA. Through
the speciﬁcation of the magnetic pressure term, PB, the
temperature contrast is given by

xspot(r) =

P (r)

PB

−
P (r)

,

(65)

where PB is assigned at the start of the step via

PB = (kBNAρ/µ)(1

−

xspot(R))Teﬀ .

(66)

Choosing xspot = 1 corresponds to PB = 0, hence
there is no magnetic pressure and no perturbation to P .
Choosing xspot = 0 yields the other extreme: PB = P .
Once again, a practical limit on PB is set by the as-
signment xspot = 0.5, which corresponds to magnetic
equipartition.

Using auto diff (§2) we account for the modiﬁed
pressure term and its partial derivatives at every mass

Figure 15. Evolutionary tracks showing the eﬀects of star
spots for xspot = 0.85. Color indicates mass. Within clusters
of identical mass, fspot values are ordered lowest (left-most)
to highest (right-most).

In Equations (65) and (66), P and PB are
shell.
auto diff variables. Likewise, the radiative tempera-
ture gradient due to the presence of spots (i.e., magnetic
inhibition of the convective ﬂux),

−

(67)

fspot),

∇rad, spot =

∇rad/(fspot xspot(r)4 + 1
is an auto diff variable, since it is a function of the
auto diff quantities

∇rad, P , xspot(r), and scalars.

The quantity PB is assigned once at the beginning of
every evolutionary step and held constant over all New-
ton iterations within that step. The use of auto diff
data types ensures that the Newton solver automatically
receives correct partial derivatives of the modiﬁed radia-
tive temperature gradient with respect to, e.g., depth
and other stellar structure variables. The modiﬁcation
∇rad is evaluated once per Newton iteration. To ob-
to
tain the spotted luminosity, L is adjusted by a factor of
αspot (Equation 64).

7.1.3. MESA Models

−

1.3 M

We demonstrate the starspots functionality by com-
puting a grid of spotted evolutionary tracks for M =
and Z = 0.014. We use the photosphere
0.2
table option for atmospheric boundary conditions across
all tracks, though for the lowest–mass stars (e.g., M (cid:46)
), a choice of tau 1m1 would be more appropriate.
0.5 M
We use the Henyey MLT prescription with αMLT = 1.95.

(cid:12)

(cid:12)

3000400050006000Teﬀ[K]−2−1012log(L/L(cid:12))fspot=0.8fspot=0.6fspot=0.4fspot=0.2xspot=0.851.1M(cid:12)0.9M(cid:12)0.7M(cid:12)0.6M(cid:12)0.3M(cid:12)Figure 15 shows tracks using fspot =

0.2, 0.4, 0.6, 0.8
}
{
and xspot = 0.85. When comparing MESA models to the
YREC-based SPOTS models of Somers et al. (2020), we
observe the following features:
• Tracks computed with MESA starspots shift smoothly
by the same magnitude and in the same direction as
a function of fspot.

• We also ﬁnd that the lower the initial value of xspot
(i.e., more extreme in terms of magnetism), the
greater the impact of an increased coverage fraction.
, the SPOTS models are cooler than the
MESA starspots models. This is due to diﬀerences in
our choice of the atmospheric boundary condition.

• Below

0.6 M

≈

(cid:12)

• The degree of radial inﬂation for an 0.3 M
(cid:12)

M dwarf
predicted by MESA starspots, using fspot = 0.34 and
xspot = 0.85, is of the order 3%-5%, in agreement with
the SPOTS models.
The MESA starspots test case can be found in

MESA_DIR/star/test_suite/starspots.

7.2. Superadiabatic Convection in
Radiation-dominated Regions

Modeling stars near the Eddington limit is a com-
plex numerical problem. Under such conditions, convec-
tive regions with density inversions are expected (Joss
et al. 1973; Paxton et al. 2013) and 1D models using
standard MLT can develop extended low-density en-
velopes, becoming red supergiants before ﬁnishing their
MS evolution (e.g., Sanyal et al. 2015; Sz´ecsi et al. 2015).
Three-dimensional radiative hydrodynamic simulations
are just starting to explore the physics of energy trans-
port near the Eddington limit (Jiang et al. 2015; Schultz
et al. 2020; ?), and will hopefully provide a way to ac-
curately model these regions in 1D stellar evolution in-
struments. In the meantime, 1D simulations using MLT
near the Eddington limit are expensive, requiring small
timesteps down to the point that some calculations be-
come impractical. Enhanced convective energy trans-
port in these regions can inhibit the formation of den-
sity inversions and facilitate calculations. One such ap-
proach is the use of a density scale height rather than a
pressure scale height in MLT (Nishida & Schindler 1967;
Stothers & Chin 1973; Maeder 1987).

The MLT++ formalism is a stellar-engineering ap-
proach that has been commonly used in MESA to reduce
superadiabaticity in regions nearing the Eddington limit
(MESA III). This method is, however, non-local, which
can lead to large step-to-step variations that produce
unphysical results and prevent the solver from ﬁnding
a valid solution. By making use of auto diff (§2),
we have implemented a fully implicit and local alterna-
tive to MLT++, which allows the modelling of a larger

31

range of masses and metallicities. Setting the option
use superad reduction activates this method.

In hydrostatic equilibrium, the ratio between the ra-
diative luminosity and the local Eddington luminosity
is

ΓEdd ≡

Lrad
Ledd

=

4aT 4
3P ∇

.

(68)

For a particular model of energy transfer (e.g., TDC as
discussed in §3, or MLT), the expected Eddington factor
is

ΓEdd,exp ≡

4aT 4
3P ∇exp,

(69)

where
∇exp is the temperature gradient predicted by the
energy transfer model. As in MLT++, we artiﬁcially
enhance energy transport in convective regions where
the expected Eddington factor is high by adjusting
∇rad.
The diﬀerence between the radiative and the Ledoux
gradient is reduced to

∇rad,new − ∇L = ∇rad − ∇L

fΓ

,

(70)

∇rad,new is the adjusted radiative temperature
where
1 determines the reduction of
gradient and fΓ ≥
∇rad − ∇L in the convective region. Such a scaling
of
∇rad can be interpreted as an eﬀective lowering of
κ in regions near the Eddington limit. Results from
Schultz et al. (2020) suggest that the impact on radiative
transfer of a vigorously convecting region supports this
choice. The adjusted
∇rad,new is then used instead of
according to the convection model.
∇rad to recompute
The functional form of fΓ is arbitrary, and was de-
termined empirically so that Equation (70) can be ap-
plied in a large number of cases while minimizing adjust-
0. Just as with MLT++,
ments in the limit ΓEdd,exp →
it serves as a stellar-engineering method to circumvent
complex evolutionary stages, rather than a speciﬁc phys-
ical model that accounts for how convection is modiﬁed
near the Eddington limit. While exploring diﬀerent op-
tions for fΓ, auto diff played a critical role by removing
the need to directly specify partial derivatives.

∇

Our choice for fΓ is the following:

fΓ = 1

α1g(ΓEdd,exp/Γc −

+

1) + α2g(Γexp/Γinv −
√β

1)

(71)

h((

∇exp − ∇L)/δc),

×

where β is the ratio of gas to total pressure and Γinv ≡
4(1
3β) is the Eddington factor at which an
ideal gas with radiation develops a density inversion

β)/(4

−

−

32

Figure 16. Evolution of stars ranging from 10 to 106 M
(cid:12)
at solar metallicity, using the implicit method to increase
the eﬃciency of energy transport in regions approaching the
Eddington limit.

(Joss et al. 1973, MESA III). The parameters Γc, α1, α2
and δc regulate the enhancement of energy transport.
The function

0

x2/2

x < 0

0 < x < 1

1/2 x > 1

x

−

(72)

g(x)

≡






is continuous with a continuous ﬁrst derivative. No cor-
rection will be applied if Γexp < Γc and Γexp < Γinv.
If either of those thresholds is exceeded, α1 and α2 set
the strength of the enhancement in energy transport for
each. The 1/√β term further enhances the eﬀect in re-
gions dominated by radiation pressure. The function
h(x) is chosen such that it is equal to zero for x < 0 and
equal to one for x > 1, while monotonically increasing in
between with a zero derivative at x = 0 and x = 1. This
choice ensures signiﬁcant corrections are only applied in
cases where a superadiabaticity comparable to δc would
be expected.

Figure 16 illustrates the evolution of stars 106 M
at
high metallicities (Z = 0.0142) using this new approach.
The very high mass models are not necessarily meant
to represent real stars, but serve as an extreme test of
this new approach. The calculations all used Γc = 0.5,
2, which we found to perform
α1 = α2 = 5 and δc = 10−
consistently across a broad range of masses.

(cid:12)

A comparison between the new method, MLT++ and
a simulation without any enhancement of energy trans-
port is shown for a 30 M
model in Figure 17. Overall,
the new method provides smoother evolution while re-
maining closer to the result obtained without enhancing

(cid:12)

(cid:12)

star at solar metallic-
Figure 17. Evolution of a 30 M
ity. The diﬀerent tracks use the implicit method to enhance
energy transport near the Eddington limit (with diﬀerent
choices for α1 and α2), MLT++, and the MESA default which
includes no energy-transport enhancement. Both simula-
2.
tions with the new method use Γc = 0.5 and δc = 10−
The MESA default simulation stalls when evolving towards
the blue after a RSG phase. Inset plots are made to high-
light variations between the runs at TAMS and at the end
of the RSG phase.

energy transport. MLT++ introduces undesirable nu-
merical variations that are particularly visible when the
model moves from the blue to the red at TAMS, and
when it evolves from the red to the blue after being
stripped of most of its H envelope. Lowering α1 or α2,
or increasing Γc or δc, will produce results closer to those
without energy-transport enhancement. Figure 17 also
shows two diﬀerent simulations with the new method
using α1 = α2 = 5 and 2. The simulations performed
with α1 = α2 = 2 take almost triple the number of steps
and computation wall time. Selection of these param-
eters requires balancing performance and similarity to
the unenhanced behavior.

The stability of this implicit method is particularly
useful in simulations of binary systems, where small
step-to-step variations in R can result in large changes
to ˙M during Roche lobe overﬂow. This makes the pre-
vious MLT++ method inappropriate.

(cid:12)

Figure 18 shows the evolution of a 40 M

model with
a 30 M
point mass companion at an initial orbital pe-
riod of 50 days. Simulations are performed using no
enhancement of energy transfer, MLT++, and the im-
In all cases, the models experience an
plicit method.
initial mass transfer phase during the MS, and a sec-
ond mass transfer phase right after TAMS. The simula-

(cid:12)

3.54.04.55.05.5log(Teﬀ/K)46810log(L/L(cid:12))10M(cid:12)30M(cid:12)100M(cid:12)300M(cid:12)103M(cid:12)3×103M(cid:12)104M(cid:12)3×104M(cid:12)105M(cid:12)3×105M(cid:12)106M(cid:12)3.54.04.55.05.5log(Teﬀ/K)5.25.45.6log(L/L(cid:12))α1=α2=5MLT++α1=α2=2Default33

8. OPACITY

8.1. Molecular Opacities

Molecules contribute signiﬁcantly to stellar opacity for
T (cid:46) 5000K (Alexander & Ferguson 1994; Ferguson et al.
2005). The MESA kap module has been expanded to
include low-temperature molecular opacities from Led-
erer & Aringer (2009) and ÆSOPUS (Marigo & Aringer
2009). Both opacity sets allow for varying CNO levels.
CNO-enhanced molecular opacities ﬁnd applications in
models of red giants, AGB stars, and R Coronae Bore-
alis stars (Schwab 2019).

×

10−

Lederer & Aringer (2009) provide Rosseland mean
5
opacity tables for 14 metallicities ranging from Z = 10−
2, and three H mass fractions X = 0.5,
to Z = 4
0.7, or 0.8. One can specify seven Z-dependent lev-
els of C-enhancement and three Z-dependent levels of
N-enhancement, all with Lodders (2003) solar abun-
dances. The tables span 3.2
4.05 and
3
1. These opacities are en-

3)
−
abled by setting kappa low T prefix = 'kapCN'.

6 /g cm−

log(T /K)

log(ρT −

≤

≤

≤

≤

7

ÆSOPUS (Marigo & Aringer 2009) allows compu-
tation of opacity tables for a variety of solar com-
positions with the optional inclusion of enhancements
(and depletions) to C, N and C/O on top of the ba-
sic mixture. We provide a set of ÆSOPUS opacity
tables. Additional ÆSOPUS opacity tables can be
generated through the ÆSOPUS web-interface5, and
MESA DIR/kap/preprocessor/AESOPUS contains infor-
mation on preparing the tables for MESA.

To compare MESA and the Monash stellar evolution
code (Lattanzio 1986; Frost & Lattanzio 1996; Karakas
& Lattanzio 2007), custom ÆSOPUS tables were gen-
log(T /K)
4.5 in steps of 0.01 dex
erated with 3.2
≤
3
3)
and
1 in steps of 0.05 dex.
6 /g cm−
7
We use steps of 0.5 dex at higher T , the Lodders (2003)
solar composition, reference metallicities of Z = 0.01 to
0.8 in steps of
0.10 in steps of 0.01 dex and 0.5
0.1. We set the CNO abundance variation factors fc =
0.5, 0, 0.5, 1, 1.5

1, 0.2, 0.4, 0.6, 1, 1.5, fco =

log(ρT −

≤
≤

≤

−

≤

≤

1,

X

−
and fn = 0, 0.4, 0.7, 1.

−

−

These tables were installed in MESA and the Monash
code. The physics used in the Monash code is recon-
structed as closely as possible in MESA (Cinquegrana
et al. 2022; Cinquegrana & Joyce 2022). This in-
cludes the basic.net reaction network, treatment of
MLT convection (with independently calibrated αMLT
parameters of αMLT = 1.931 in MESA, αMLT = 1.86 in
Monash), high temperature and molecular opacities
(Iglesias & Rogers 1996; Marigo & Aringer 2009), an Ed-

5 http://stev.oapd.inaf.it/cgi-bin/aesopus

Figure 18. Evolution of a 40 M
point
mass companion with an initial orbital period of 50 days.
Models are computed for solar metallicity and using diﬀerent
methods to enhance energy transport in regions near the
Eddington limit.

star with a 30 M

(cid:12)

(cid:12)

Mass transfer rate

˙Mtransfer as a function
Figure 19.
of donor mass for the binary system shown in Figure 18.
All simulations have two signiﬁcant phases of mass transfer
corresponding to interaction during the MS (Case A) and
after TAMS (Case AB).

tion without enhanced energy transfer stalls during this
second mass transfer phase, exemplifying the computa-
tional complexity of modelling stars near the Eddington
limit.

Figure 19 demonstrates that although the MLT++
large step-to-step
model evolves beyond detachment,
variations lead to large changes in mass transfer rates.
In contrast, the new implicit method provides a smooth
solution throughout the mass transfer phase.

4.04.55.05.5log(Teﬀ/K)5.45.65.8log(L/L(cid:12))α1=α2=5MLT++Default20253035Mdonor[M(cid:12)]−7−6−5−4−3−2log(cid:16)˙Mtransfer/M(cid:12)yr−1(cid:17)Timeα1=α2=5MLT++Default34

Figure 20. Evolution of L and Teﬀ during the TP-AGB
, Z = 0.014 models from MESA (solid) and the
phase of 3 M
Monash code (dashed). The age of the MESA (Monash) stellar
model is shown on the bottom (top) x-axis.

(cid:12)

Figure 21. Cooling tracks for 0.9 M
DA WD models using
the conductive opacities of Cassisi et al. (2007) and Blouin
et al. (2020).

(cid:12)

dington gray atmosphere, and mass-loss approximations
(Reimers 1975; Bl¨ocker 1995). We use an ηReimers =
0.477 eﬃciency factor, and ηBl¨ocker = 0.01 in MESA and
ηBl¨ocker = 0.02 in the Monash code (Cinquegrana et al.
2022). Functionality that is not available in both in-
cludes the process of deﬁning the border between con-
vective and radiative regions. Here, a relaxation method
is used in the Monash code (Lattanzio 1986), and the
predictive mixing algorithm in MESA (MESA IV).

(cid:12)

We evolve a 3 M

, Z = 0.014 model with MESA and the
Monash code. Both models use the same initial con-
ditions and are terminated at the 11th thermal pulse.
Figure 20 compares the L, Teﬀ , and R histories of the
two models during the TP-AGB phase. The MESA model
reaches higher peak L, smaller peak Teﬀ , and larger peak
R than the Monash model. The diﬀerences decrease as
the evolution proceeds. Both have very similar inter-
pulse periods,

104 yr, after the ﬁrst few pulses.

(cid:39)
8.2. Compton Opacities
At temperatures log(T /K) (cid:38) 8.7, beyond the bound-
ary of the standard opacity tables, the radiative opacity
is set by Compton scattering (MESA I, §4.3). Such con-
ditions are often realized in simulations of massive stars

7.2

×

and thermonuclear bursts on neutron stars. MESA now
calculates the Compton scattering opacity using the pre-
scription of Poutanen (2017), which improves upon the
previous approach from Buchler & Yueh (1976). See §4
in Poutanen (2017) for a detailed comparison of the two
approaches.

8.3. Conductive Opacities

Energy transport via electron conduction plays an im-
portant role, especially in degenerate stellar interiors.
The conductive opacities in MESA are expanded versions
of the tables from Cassisi et al. (2007), see MESA II,
Appendix A.3. Blouin et al. (2020) improved the con-
ductive opacities for H and He in the regime of moderate
Coulomb coupling and moderate degeneracy, primarily
relevant for the envelopes of DA and DB WDs. We im-
plement their analytical ﬁts for conductive opacities for
H and He in MESA.

Figure 21 shows the eﬀect of these new opacities on
MESA WD cooling calculations for a 0.9 M
WD with
a H atmosphere, conﬁrming the result of Blouin et al.
(2020) that the cooling time to reach Teﬀ = 4000 K can
be reduced by
2 Gyr. The diﬀerence in cooling times
is somewhat smaller for WDs with He atmospheres, as
also conﬁrmed in MESA models for AM CVn accretors

≈

(cid:12)

3.43.63.84.04.2log(L/L(cid:12))4.5384.5404.5424.5443.43.63.84.04.24.1704.1724.174Age[108yr]3.503.523.543.563.583.60log(Teﬀ/K)MonashcodeMESA3.503.523.543.563.583.6040006000800010000Teﬀ[K]0.9M(cid:12)Cassisietal.(2007)Blouinetal.(2020)0.02.55.07.510.0WDcoolingtime[Gyr]10−510−410−310−2L[L(cid:12)]0.9M(cid:12)Cassisietal.(2007)Blouinetal.(2020)(Wong & Bildsten 2021). Salaris et al. (2022) provide
a more detailed study of the impact of these updated
opacities on WD cooling timescales. The conductive
opacities including the Blouin et al. (2020) corrections
are now the default in MESA.

8.4. Radiative Accelerations from the OP

Monochromatic Opacities

The radiative acceleration grad,i of a given species i
represents the acceleration caused by the radiation ﬁeld.
MESA III (§9) describes the inclusion of radiative lev-
itation from Hu et al. (2011), which includes evalua-
tion of the Rosseland mean opacity κR and grad,i using
the Opacity Project (OP) monochromatic opacity tables
(Seaton 2005). The computation of both of these quanti-
ties requires wavelength integrations of monochromatic
opacities according to the local mixture, introducing a
signiﬁcant amount of extra time. MESA V (§6.2) brieﬂy
describes the steps taken to reduce the time required to
evaluate κR and grad,i. We now describe a new imple-
mentation from Mombarg et al. (2022).

The OP tables provide monochromatic cross sections

σi, equally spaced in

v(u) =

15
4π4

0
(cid:90)

u

x4e−
x
e−

(1

x)3 dx,

−
3
with a step size ∆v, where 10−
20.
The OP tables contain data for H, He, C, N, O, Ne,
Na, Mg, Al, Si, S, Ar, Ca, Cr, Mn, Fe, and Ni. The
Rosseland mean opacity for cell k is then given by

hν/kBT

≤

≤

≡

u

(73)

κR,k =

1
µk 

1

fi,kσi(vn)

1

−

∆v



,

(74)

n
(cid:88)



i
(cid:80)
where µk is the mean molecular weight and fi the frac-
tional element abundance of species i. The monochro-
matic opacities are sampled at 10,000 points in the fre-
quency parameter vn, denoted by index n.



In the new implementation, the OP monochromatic
data are converted from (T, ne) space to (T, ρ) space
with

log(ρ/g cm−

3) = log(ne/cm−
log Ξ

−

−

log(NA/g),

3) + log µ

(75)

(cid:80)

where Ξ =
i fiΞi is the average number of electrons
per atom (given by the OP tables) and NA is Avo-
gadro’s constant. The tables contain data for 3.5
≤
3) bounds that depend
log(T /K)
on log(T /K). An error is returned for T and ρ beyond
these limits.

8.0 and log(ρ/g cm−

≤

We select the point in the OP tables with the smallest

value of

35

(log T OP

log Tk)2

i −
0.0025

+

(log ρOP

log ρk)2

i −
0.25

,

(76)

(cid:114)

where the diﬀerent denominators reﬂect the diﬀerent OP
table spacings.

From this OP data point we select nearest neigh-
bor points and construct a bicubic interpolant. The
interpolants are stored such that the opacity can
be re-interpolated at the next time step as long as
log(T /K) has changed by less than twice the grid spacing
3) has changed less than twice its
(0.01 dex), log(ρ/g cm−
grid spacing (0.1 dex), and the fractional abundances all
satisfy

fi,t −
|
fi,t

fi,t

1

−

1|
−

< (cid:15),

(77)

−

where t and t
1 indicate the current and previous time
steps, respectively. Empirically, we ﬁnd for MS mod-
4 optimizes the computational eﬃciency
els that (cid:15) = 10−
without sacriﬁcing accuracy in κR and grad,i (Hui-Bon-
Hoa 2021).

The radiative acceleration of a species is given by

grad,i =

µκR
µic F

γi,

(78)

where µi is the molecular weight of the species and
the radiative ﬂux. The factor γi is given by

F

is

σi(vn)[1

−

u(vn)]
e−
−
j fjσj(vn)

ai(vn)

∆v,

(79)

γi =

n
(cid:88)

(cid:80)

where the index j runs over all species. The correction
terms ai(vn) are provided by the OP data. The numer-
ator in Equation (79) is precomputed and stored.

In the new implementation, optimized for models with
a convective core and radiative envelope, the envelope is
divided into two equal regions based on the number of
cells. For each region, the γi factors are pre-computed
using an average mixture of the region

=

fi(cid:105)
(cid:104)

k2

(cid:32)

(cid:88)k=k1

fi,k

k2

1

−

(cid:33) (cid:32)

i
(cid:88)

(cid:88)k=k1

fi,k

(cid:33)

,

(80)

where k1 and k2 are the ﬁrst and last cell index of a
region. Near the boundary of these two regions, 15 cells
on each side, the value of log grad,i is blended

log grad,i = αi log grad,i,1 + (1

αi) log grad,i,2,

(81)

−

where log grad,i,1 is computed using the average mixture
of the ﬁrst region, and log grad,i,2 from the average
fi,1(cid:105)

(cid:104)

36

coeﬃcients disagree by a factor of a few with more ac-
curate molecular dynamics (MD) methods (MESA III,
Bauer et al. 2020, Caplan et al. 2022).

Until recently, it was unclear how to generalize these
results to the arbitrary plasma mixtures needed for stel-
lar models. However, Caplan et al. (2022) show that
in the liquid regime (10 (cid:46) ΓMCP (cid:46) 200), diﬀusion co-
eﬃcients are approximated to within
10% accuracy
by using a ﬁt to an equivalent one-component plasma
(OCP) coeﬃcient calculated with MD, and then scaling
with charge as

∼

Dj =

Zj
Z

0.6

−

DOCP ,

(82)

(cid:104)

(cid:18)

(cid:80)

Z
(cid:104)

(cid:105) (cid:19)
where Dj is the diﬀusion coeﬃcient of species j, Zj is
the charge of species j,
j njZj/nions is the av-
(cid:105) ≡
erage charge of ions in the liquid, and DOCP is the dif-
fusion coeﬃcient for an equivalent OCP with coupling
and screening set by the mixture averages. This scaling
is justiﬁed by the fact that in the liquid regime, ion dif-
fusion can be described in terms of spheres experiencing
Stokes-Einstein drift through a viscous liquid (Bildsten
& Hall 2001; Daligault 2006), with the eﬀective radii of
diﬀerent ions set by their charge relative to the back-
ground plasma (Bauer et al. 2020; Caplan et al. 2022).
The DOCP term therefore captures the physics of the
global viscosity experienced by all ions, while the scal-
ing with charge captures the diﬀerent eﬀective radii of
ions experiencing Coulomb interactions with the back-
ground plasma.

Since the diﬀusion solver in MESA is cast in terms of the
Burgers (1969) equations, coeﬃcients must be recast in
terms of the binary resistance coeﬃcients Kij between
species i and j rather than the net diﬀusion coeﬃcients
Dj. At strong plasma coupling (ΓMCP (cid:38) 10), these
coeﬃcients must satisfy the relation6

Dj =

njkBT
i Kij

.

(83)

The resistance coeﬃcients Kij must also be symmetric
(cid:80)
(Kij = Kji), motivating

Kij =

ninj(ZiZj)0.6kBT
Z

Z 0.6

0.6DOCP
(cid:105)

(cid:105)(cid:104)

nions(cid:104)
j njZ 0.6

Z 0.6
(cid:104)

(cid:105) ≡

where
j /nions. The resistance coeﬃ-
cients of Equation (84) reduce to the desired net diﬀu-
sion coeﬃcients of Equation (82) under the summation
required in Equation (83).

(cid:80)

,

(84)

6 As noted by Caplan et al. (2022), this expression for Dj in terms
of Kij is accurate for strong plasma coupling, but neglects a
higher-order correction for thermal diﬀusion that can reach up
to about 20% for ΓMCP (cid:28)

10 (Baalrud & Daligault 2014).

Figure 22. Rosseland mean opacity (κR, upper) and the
radiative accelerations (grad, lower) of 16O and 40Ar in a
2 M
model with an initial Z = 0.02 at a core H mass fraction
of Xc = 0.2. Green dotted curves show the MESA III (Hu)
treatment, and black solid curves show the current treatment
(Mombarg). Shaded areas indicate convective regions.

(cid:12)

mixture of the second region. The parameter αi linearly
varies between 0 and 1 where blending takes place.

Figure 22 compares κR and grad,i from MESA III and
the present method. The cell-averaged diﬀerence and
/ log gHu
maximum diﬀerence (
rad)
|
for 16O are 0.007 and 0.042, respectively, and for 40Ar
are 0.02 and 0.03, respectively. The diﬀerences in grad
for 16O are typical for most isotopes. The new imple-
mentation is about 5 times faster for MS stars.

log gMombarg
rad

log gHu

rad −

|

Enabling this capability requires a data ﬁle con-
taining the manipulated OP monochromatic data, doi:
https://doi.org/10.5281/zenodo.6761478.

9. DIFFUSION COEFFICIENTS

MESA III and MESA IV describe the implementation
of element diﬀusion in MESA using the Burgers (1969)
equations with diﬀusion coeﬃcients based on Paquette
et al. (1986), and updated with the coeﬃcients of Stan-
ton & Murillo (2016). For strong plasma coupling in the
liquid regime (where the multi-component plasma cou-
/aekBT (cid:38) 1), these
q2
pling parameter ΓMCP ≡
e (cid:104)

Z 5/3

(cid:105)

0.00.51.01.52.02.5log(κR/cm2g−1)MombargHu4567log(T/K)345log(grad/cms−2)16O40Ar37

tained from Equations (83) and (84) for MESA proﬁles of
our C/O WD model with a similar interior composition.
The coeﬃcients based on Stanton & Murillo (2016) vary
from the MD results by a factor of two or more, while
the residuals for our implementation of the Caplan et al.
(2022) coeﬃcients are 10% or less. This represents an
order of magnitude improvement on the uncertainties
for diﬀusion coeﬃcients in the strongly coupled regime
relative to the previous MESA implementation, while also
providing a procedure that is generalizable to composi-
tions other than just C/O/Ne mixtures (Equation 84).
We have implemented these Caplan et al. (2022) dif-
fusion coeﬃcients as the default coeﬃcients in MESA for
ΓMCP > 10, with a smooth transition from the Stanton
& Murillo (2016) coeﬃcients over the range 3 < ΓMCP <
10. The diﬀusion coeﬃcients in the liquid WD regime
10% for 10 (cid:46) ΓMCP (cid:46) 200, a sub-
are now accurate to
stantial improvement compared to our previous meth-
ods.

≈

When crystallization occurs for ΓMCP (cid:38) 200, we as-
sume that freezing into the solid phase causes the diﬀu-
sion coeﬃcient to go to zero. We implement this with a
smooth turnoﬀ near the crystallization boundary using
the smoothed phase parameter φ from Skye (§4.1), so
that the diﬀusion velocities are zero for φ

0.5.

≥

10. NUCLEAR PHYSICS

MESA models calculate the energy generation rates
and composition changes due to nuclear burning over
a large range of T , ρ, and Xi. The nuclear evolution of
the chemical composition dominates the total cost of a
model (memory + CPU) when the number of isotopes is
(cid:38) 30. Here we report progress on nuclear reaction rates,
a new operator split burning option, and enhanced re-
action rate outputs.

10.1. Reaction rates updates
MESA’s default reaction rate for 7Be(e−, νe)7Li came
from REACLIB (Cyburt et al. 2010). However, REACLIB
is only deﬁned for T > 107 K, and assumes that all atoms
are ionized. While this is a reasonable assumption for
reactions that occur deep in the stellar interior, signif-
icant Li production can occur in stellar envelopes with
T < 107 K where the reaction rate then depends on the
ionization balance (Schwab 2020). The new default (as
of r22.05.1) for this rate is Simonucci et al. (2013) which
incorporates ionization contributions.

REACLIB deﬁnes a reverse reaction as the endother-
mic direction. However, this direction depends on the
nuclear masses assumed during the evaluation. For
consistency with the nuclear masses used in MESA, we
deﬁne the reverse rate based on the nuclear masses

Figure 23. Diﬀusion coeﬃcient of 22Ne in the liquid interior
proﬁle of a cooling C/O WD model. The residuals in the
lower panel are relative to the Caplan et al. (2022) MD for
a C/O/Ne plasma mixture shown in the top panel.

We calculate the OCP diﬀusion coeﬃcient DOCP using
the Caplan et al. (2022) ﬁt to high-resolution MD, which
is given in terms of ΓMCP and electron screening length
λe. To calculate the value of λe as input for the diﬀusion
coeﬃcients, we follow the method described in MESA IV
based on Stanton & Murillo (2016) for non-relativistic
electrons at ρ < 106 g cm−
3. Electrons become rela-
tivistic at higher densities, and we therefore switch to

1

−

the relativistic screening length λe =
densities ρ > 106 g cm−
constant and kF = (3π2ne)1/3.

for
2kF
3, where α is the ﬁne-structure

α/π

(cid:112)

(cid:17)

(cid:16)

(cid:12)

Figure 23 shows the 22Ne diﬀusion coeﬃcient in a MESA
C/O WD, which has historically been
model of a 0.6 M
a key source of uncertainty in the rate at which 22Ne set-
tles toward the center of the WD (Bildsten & Hall 2001;
Deloye & Bildsten 2002; Garc´ıa-Berro et al. 2008). Such
C/O mixtures with trace 22Ne are in the liquid phase
for ΓMCP (cid:46) 200 (Caplan et al. 2020; Blouin & Dali-
gault 2021), though distillation of 22Ne may also occur
for suﬃcient 22Ne concentration (Blouin et al. 2021).

Figure 23 also shows the MD coeﬃcients from Caplan
et al. (2022) (these closely match the MD coeﬃcients of
Hughto et al. 2010) along with diﬀusion coeﬃcients ob-

10−510−4DNe[cm2s−1]MD(Caplanetal.2022)Stanton&Murillo(2016)MESAusingCaplanﬁt75100125150175200ΓMCP-50%0%50%ResidualStanton&Murillo(2016)MESAusingCaplanﬁt38

from masslib library 5.data. This aﬀects reactions
with uncertain nuclear masses; for instance, the reac-
tion 55Cu (γ, p) 54Ni has a Q = 0.293 MeV (exother-
mic) from “rpsm” (Rauscher 1999, priv. comm) and
0.07256 MeV (endothermic) from “ths8”7 (Cy-
a Q =
burt et al. 2010). Incorrectly determining which reaction
is endothermic leads to large errors when the reverse rate
is computed from detailed balance.

−

10.2. Operator split nuclear burning

By default MESA uses a nuclear reaction network that
is fully coupled to the stellar hydrodynamics (MESA I),
solving for the changes in the composition simultane-
ously with the changes in stellar structure quantities.
This approach provides consistency between the nuclear
physics and stellar hydrodynamics, but can place limits
on the maximum time step. When T (cid:38) 3
109 K, the
time step is limited by the nuclear burning timescale,
and the composition enters a dynamic equilibrium state
where large forward and reverse reaction rates nearly
cancel each other, potentially leading to numerical er-
rors when subtracting large values from one another
(MESA III). During the ﬁnal stages of evolution to core-
10 s are common (Farmer
collapse, time steps of δt < 10−
et al. 2016). This can make evolution to core collapse a
resource-consuming endeavor.

×

MESA has the capability to perform an operator-split
procedure (op split burn) to compute the composition
change and energy generation. Cells with high T use
operator splitting. For each such cell, MESA computes
the change in composition over the timestep δt with a
semi-implicit midpoint rule (Bader & Deuﬂhard 1983).
An operator-split cell can then take multiple sub-steps,
allowing the composition to evolve at ﬁxed T and ρ with
an adaptive time step. The nuclear energy generated
(cid:15)nuc is calculated by taking the diﬀerence between the
starting and ﬁnal compositions, and energy loss due to
neutrinos from nuclear reactions (cid:15)ν is accounted for.

This scheme allows accurate tracking of the net nu-
clear energy generation rate and composition changes.
However, operator-split burning cannot calculate the
partial derivatives of these terms with respect to T or
ρ for the matrix solver. These partial derivative matrix
terms are thus set to zero. This removes the diﬃculty
of the partial derivatives varying in sign and magnitude
over short timescales, and enables the solver to more
robustly ﬁnd a solution within the requested tolerances.
Figure 24 compares the fully-coupled (unsplit) and
operator split solutions in the central T -ρ plane for

7 For full details of the source of the REACLIB data, see https://

reaclib.jinaweb.org/labels.php

Figure 24. Central T -ρ tracks of a 30 M
ZAMS to formation of the iron core.

(cid:12)

star evolved from

Figure 25. Nuclear reactions rates ongoing in the Sun. Up-
per: Evolution of reaction rates from the pre-main sequence
to core H exhaustion. Lower: Proﬁles at the current solar
age as a function of the distance from the solar center.

,

(cid:12)

a 30 M
solar-metallicity model evolved from the
ZAMS to the formation of the iron core. We enable
op split burn for any cell with a T > 109 K. The evo-
109 K, after
lutions are nearly identical up to Tc ≈
which the operator-split solution evolves to a slightly
larger ρ. These diﬀerences are comparable to variations
arising from other physics choices, such as the nuclear re-

×

3

5.56.06.57.07.58.0log(cid:0)ρc/gcm−3(cid:1)9.09.19.29.39.49.59.69.7log(Tc/K)OperatorsplitFullycoupled104106108Star age [yr]10-4210-3510-2810-2110-14Reactions per secondZAMSSolarage0.000.250.500.751.00r/Rﬂ10-4410-3710-3010-2310-16Reactions per secondConvectionzone based(d,)αd(7Be,p)2α3He(p,e+ν)αd(3He,p)αp(e−p,ν)d7Be(p,γ)8B7Li(p,)2αp(p,e+ν)dd(p,γ)3He7Be(e−,ν)7Li3He(α,γ)7Be3He(3He,2p)α39

neutrino energy rates, nuclear energy rates, and screened
reaction rates.

(cid:12)

As an example, Figure 25 shows the total reaction
rates of a 1 M
model evolved to the solar age, and the
proﬁles of the reaction rates at the solar age. Figure 26
further shows the evolution of the solar electron neu-
trino ﬂuxes and a comparison with the observed solar
electron neutrino ﬂuxes (see also Farag et al. 2020) af-
ter correction for ﬂavor mixing (Bergstr¨om et al. 2016).
The model agreement with measurements is similar to
that obtained using the ASTEC stellar evolution code
(Bellinger & Christensen-Dalsgaard 2022).

11. CONSTANTS

The MESA const module provides mathematical, phys-
ical, and astronomical constants relevant to stellar astro-
physics (MESA I, Section 4.1). The values in this mod-
ule have been updated to reﬂect new deﬁnitions and
conventions. Some microphysics inputs (e.g., opacity,
EOS, reaction rates) use slightly diﬀerent constants in
constructing their tables or expressions. Such cases are
usually beyond our control, and the updates in this sec-
tion do not apply to those instances.

As part of the revision of the SI, the values of the phys-
ical constants e, h, kB, and NA are now exact (Newell
et al. 2018). We have adopted these values and ensured
that other constants composed of these and other exact
values (e.g., the Stefan-Boltzmann constant) are deﬁned
in a consistent manner. For other physical constants,
(e.g., G) we use CODATA 2018 (Tiesinga et al. 2021).
MESA follows IAU recommendations for astronomical
constants, currently adopting nominal solar and plane-
tary quantities from IAU 2015 Resolution B3 (Mamajek
et al. 2015). We follow the recommended procedure of
deriving nominal solar and planetary masses from the
mass parameters (GM ) and the adopted value of G.
We also adopt the convention that the nominal radii of
planetary bodies are the equatorial radii.

12. INFRASTRUCTURE

12.1. Migration to GitHub

−

MESA development began in 2007 with a Subversion
(SVN) repository hosted on SourceForge, and from
2020 this SVN repository was hosted by Assem-
2017
bla. Beginning in December 2020, development shifted
to GitHub, with the root of the new Git repository corre-
sponding to SVN r15140. An archival copy of the SVN
development history is available at doi: 10.5281/zen-
odo.4745225. The shift to GitHub paves the way for
a new era of collaborative MESA development and ex-
panded interaction with the astrophysics community.

Figure 26. The evolution of solar electron neutrino ﬂux at
Earth. The predicted values for the present Sun are in satis-
factory agreement with the observed values after correction
for ﬂavor eﬀects: Φ(pp)/109 = 5.934 (MESA), 5.971 ± 0.035
(Borexino); Φ(pep)/107 = 1.408 (MESA), 1.448 ± 0.013
(Borexino); Φ(7Be)/109 = 0.476 (MESA), 0.480 ± 0.023
(Borexino); and Φ(8B)/105 = 4.780 (MESA), 5.160 ± 0.110
(Borexino) cm−

2 s−

1.

≈

action rate screening prescription (see Appendix A.2 of
MESA V). Evolution up to the formation of the iron core
took approximately equal number of timesteps. Evolv-
ing the models further to the onset of core-collapse with
“gold” tolerances (MESA V), the operator split model
only required an additional
200 time steps, while the
fully-coupled model failed to reach the onset of core-
collapse after an additional

140,000 time steps.

≈
Operator splitting can provide a signiﬁcant speedup
during Si and Fe burning by reducing the number of
time steps needed, and may be the only way to make cer-
tain problems tractable. It is however less eﬃcient than
a fully-coupled model during earlier stages of evolution
due to the additional sub-steps taken by each operator-
split cell. Thus, we suggest considering operator split-
ting only for models evolving beyond core C-depletion.
It is diﬃcult to say which treatment is more accurate;
fully-coupled calculations include more physics but can
be subject to numerical errors, while operator-split cal-
culations ignore the physics in the partial derivatives,
but provide a more numerically stable solution.

10.3. Reaction rate output

MESA has the new capability to output individual
nuclear reaction rates and related quantities to the
history or proﬁle data ﬁles. Using add raw rates
will output the rates of all reactions. Alternatively,
raw rate with the name of a speciﬁc reaction will re-
port only that reaction. Similarly, add eps neu rates,
add eps nuc rates, and add screened rates provide

108109Star age [yr]10-1100101Neutrino flux Φ [cm−2 s−1]Solarage109Φ(pp)107Φ(pep)105Φ(8B)109Φ(7Be)observations40

As Git repositories can have a non-linear commit his-
tory, we will no longer denote public releases with a
revision number. In SVN, this counted the number of
commits from the beginning of MESA’s development. In-
stead, public releases will now be identiﬁed by the date,
in the format YY.MM.I, where YY is the ﬁnal two-digits
of the year, MM is the two digit month number, and I
is a version (usually 1) to distinguish multiple releases
in a given month. While we do not recommend publish-
ing an article based on non-released versions of MESA, if
necessary we suggest using the ﬁrst 7 characters of the
Git commit hash as the version number.

12.2. MESA TestHub

With the transition from SVN to Git, the version-
ing and branching scheme used in the development of
MESA changed substantially. A major overhaul of the
collection and distribution of continuous integration test
results on TestHub (https://testhub.mesastar.org) was
necessary. We now highlight these and other changes
made since MESA V.

With Git, understanding the relationship of a com-
mit to other commits requires knowledge of the commit
graph. To dynamically obtain and update this informa-
tion, TestHub uses GitHub webhooks and APIs. Upon
pushing to the GitHub remote, GitHub now sends a re-
quest to TestHub to update its internal tree of commits.
This is done by querying the GitHub API for a current
list of branches and the head commits of each. TestHub
removes any references to branches that are no longer in
GitHub and updates the branches table in the TestHub
database, adding commits as needed even if they have
not had any tests conducted. This allows easy identiﬁca-
tion of commits that have not yet been tested. We also
now store data about commits, such as the authors, com-
mit messages, and commit times directly in the TestHub
database for more convenient access.

To view the detailed changes made in a given commit,
each commit-speciﬁc page on TestHub links to the ap-
propriate page on GitHub. Additionally, most views in
TestHub now have a branch selector dropdown so devel-
opers can look at commits on a speciﬁc branch, and we
rely on the GitHub API to order these commits within
a branch.

Figure 27 shows the total number of individual test
instances (i.e., results for a single test case from a sin-
gle computer) and daily commits submitted since the
launch of TestHub in late 2017. Unsurprisingly, the rate
of test submissions is strongly correlated with the rate of
commits. Substantial deviations occur due to diﬀerent
testing computers coming on- and oﬄine, and because
some commits focus on documentation and do not trig-

Figure 27. Daily tests submitted since the instantiation
of TestHub, spanning the SVN and Git eras. To smooth
over the day-to-day variability, we also show 30-day rolling
averages of submitted tests and pushed commits. Below the
x-axis are dates of public releases and other milestones such
as instrument papers and the SVN-to-Git transition.

ger testing runs on automated testing setups. Figure 27
also shows the dates of public releases and key mile-
stones. The switch from SVN to Git was shortly after
release r15140, and there is a smooth transition between
the eras.

The MESA test suite takes

100 core hours to complete
∼
when run on a modern workstation. To reduce this run-
time while still providing diagnostic information, many
tests have optional steps that can be skipped, with the
next inlist loading a saved model. The total time for
a test suite run is roughly halved when these parts are
skipped. Skipping optional inlists has drawbacks in re-
quiring saved models, which can generate spurious fail-
ures when skipping inlists. At least one computer runs
all inlists on all tests on the main branch.

We now assess how quickly our distributed and au-
tomated continuous integration workﬂow can identify
a failure. Figure 28 shows that most failures are de-
tected within an hour of the commit, and more than a
third are detected within thirty minutes. This prompt
turnaround comes from computing clusters conﬁgured
to check for new commits every few minutes, and then
launch a full test suite run upon detecting a new commit.
Some clusters are conﬁgured to detect and test commits
on any branch of the MESA GitHub repository, allowing
full testing coverage during feature development and en-
suring that new features pass the test suite before being
merged into the main branch.

Awareness of test failure and the commit responsi-
ble is useful, but having the detailed output of a failing
test is often essential in quickly identifying and rectify-

201820192020202120220100020003000400050006000DailySubmittedTests1000010398115541170112115127781514021.12.122.05.1MESAIVMESAVGitHubMESAVI1,406,634totaltestsover7,771commitsTestsrunperday(raw)Testsrunperday(30-dayaverage)Commitsperday(30-dayaverage)010203040DailyPushedCommits41

12.4. NuDocker

Reproducibility is a goal of open science and a tenet
of scientiﬁc research. Provenance, as the term relates to
software instruments (Van den Bussche & Vianu 2001;
Carata et al. 2014; Stodden et al. 2018), is the ability
to record the full history of a result. Scientiﬁc research
is generally held to be of good provenance when pre-
vious results, perhaps decades old, can be reproduced.
The aim is to preserve the ﬁnal knowledge object and
the capability to perform the scientiﬁc actions that are
the foundation of the knowledge object. Thus, we seek
to preserve not only the numerical calculation, but ac-
celerate future research by archiving the computational
environment.

Provenance enables reproducing past simulations and
performing new calculations with diﬀerent physics or nu-
merical options. A challenge is that compilers change,
linked libraries evolve, and operating systems progress.
Many science results have been obtained with older ver-
sions of MESA, which in most cases are not obsolete and
therefore remain valuable. NuDocker10,11 provides a so-
lution to the provenance challenge by being able to run

Figure 29.
Reproduction of Figure 13 from Farmer
et al. (2015) using release r6794 in NuDocker: HRD of two
models; one non-rotating (blue) and one rotating at
8 M
Ω/Ωcrit ∼ 0.2 (red). The evolutions span from H depletion
to He depletion.

(cid:12)

10 https://github.com/NuGrid/NuDocker
11 https://doi.org/10.5281/zenodo.3678601

Figure 28. Distribution of delay times from when a commit
is pushed to when a failure is ﬁrst reported.

ing the regression. TestHub now collects information on
the runtime, computer architecture, broad failure type
(such as a compilation error or a runtime error), and
the stdout and stderr logs of the compilation and/or
test case in the event of a failure. When present, these
logs are accessible by links next to the failure indica-
tor. This allows developers to quickly identify what led
to the unexpected behavior without having to request
more data from the owner of the computer that sub-
mitted it. These updates to TestHub improve the pace,
eﬃciency, and quality of MESA source code development.

12.3. User Contributions
MESA has a Zenodo community8 to encourage users to
publicly archive their input and output ﬁles. To make
user-contributed routines easier to share while mini-
mizing maintenance, we have additionally created the
mesa-contrib repository9.

Routines in mesa-contrib can be implemented via
MESA’s hooks with a few Fortran include state-
ments. If the build environment deﬁnes the location of
mesa-contrib, then it is included by default as a search
path when MESA is compiled. Currently, mesa-contrib
contains routines for the atmospheric T (τ ) relations and
corresponding MLT parameters implemented by Mo-
sumgaard et al. (2018b) and for angular momentum
transport by the enhanced Tayler–Spruit dynamo de-
scribed by Fuller et al. (2019). To ease the burden of
maintenance, mesa-contrib is only intended to work
with the latest public MESA release.

8 https://zenodo.org/communities/mesa/
9 https://github.com/MESAHub/mesa-contrib

102103commit-to-failuredelay[minutes]0100200300400numberofcommits1008commitswithfailures3.63.84.04.2log(Teff/K)3.53.63.73.83.94.04.1log(L/L(cid:31))(Ω/Ωcrit)∼0.0(Ω/Ωcrit)∼0.242

older versions of MESA with age-appropriate compilers,
libraries, and operating system using light-weight, OS-
level virtualization (e.g., Docker12). NuDocker provides
four Docker images that can be launched with one ter-
minal command, and has been tested and used in 14
out-of-the-box MESA versions from r4942 to r22.05.1. A
hallmark of Docker virtualization is the minimal per-
formance penalty compared to running natively (Felter
et al. 2014, 2015).

As an example of the ability to provide almost decade-
old results with NuDocker, Figure 29 reproduces Fig-
ure 13 from Farmer et al. (2015) using the same MESA
version 6794 from July 2014 and inlists13 as in Farmer
et al. (2015). The virtual containers allow older versions
of MESA to be run with bit-for-bit consistency for all ver-
sions after 7503 (see MESA III), thereby enabling older
versions of MESA to be run on modern hardware, and
preserving the required system environment to enable
new research.

13. SUMMARY

We explain signiﬁcant new capabilities and improve-
ments implemented in MESA since the publication of
MESA I through MESA V. Advances in automatic dif-
ferentiation (§2) and time-dependent convection (§3)
will open opportunities for future investigations in stel-
lar evolution. Discussion of the current treatment of
the energy equation (§5), stellar atmospheres (§6), and
new formalisms for treating starspots and superadia-
batic convection (§7) will enhance the study of stellar
physics. Upgrades to the equation of state (§4), opacity
(§8), element diﬀusion coeﬃcients (§9), nuclear reaction
rates (§10), and physical constants (§11) will increase
the robustness of stellar evolution models. The tran-
sition to GitHub, upgrades to the MESA TestHub con-
tinuous integration framework (§12), the opening of a
mesa-contrib repository, and NuDocker’s ability to run
older versions of MESA will lead to an eﬃcient and dis-
tributed model of source code development. Inlists and
related materials for all the ﬁgures are available at doi:
10.5281/zenodo.6968760.

We thank Dr. Bill Paxton for two decades of his amaz-
ing talents, extraordinary energy, and his generous gift
of MESA to the astronomy and astrophysics community.
We also thank Amy Mainzer for Figure 4 of MESA III
making an appearance in the movie Don’t Look Up (ﬁrst
noted by Jared Goldberg), and the participants of the
MESA Summer Schools for their willingness to experi-

12 https://www.docker.com
13 https://zenodo.org/record/2590040

ment with new capabilities and modalities of delivery.
Finally, we thank Susie Groves for her heroic assistance
in enabling the completion of this MESA VI instrument
paper under challenging circumstances.

The MESA Project is supported by the National
Science Foundation (NSF) under the Software Infras-
tructure for Sustained Innovation program grants ACI-
1663684, ACI-1663688, and ACI-1663696. This re-
search was supported in part by the NSF under Grant
No. NSF PHY-1748958 for the Kavli Institute for Theo-
retical Physics. W.H.B acknowledges support from the
UK Science and Technology Facilities Council (STFC)
through grant ST/R0023297/1. G.C.C acknowledges
support by the Australian Research Council Centre of
Excellence for All Sky Astrophysics in 3 Dimensions
(ASTRO 3D), through project number CE170100013
and the Astronomical Society of Australia. R.F ac-
knowledges support of the University of Amsterdam’s
Helios cluster which was supported by a European Re-
search Council grant 715063, (PI S.E. de Mink) F.H
acknowledges funding through an NSERC Discovery
Grant, through NSERC project award SAPPJ-2021-
00032 and through the NSF under Grant PHY-1430152
for the JINA Center for the Evolution of the Elements.
The Flatiron Institute is supported by the Simons Foun-
dation. A.S.J thanks the Gordon and Betty Moore
Foundation (Grant GBMF7392) and the National Sci-
ence Foundation (Grant No. NSF PHY-1748958) for
supporting this work. M.J acknowledges the Lasker
Data Science Fellowship awarded by the Space Tele-
scope Science Institute, and thanks Marc Pinnsoneault,
Jen van Saders, and Jamie Tayar for many hours of
consultation on the Yale Rotating Stellar Evolution
Code and its documentation. J.S acknowledges sup-
port by NASA through Hubble Fellowship grant # HST-
HF2-51382.001-A awarded by the Space Telescope Sci-
ence Institute, which is operated by the Association
for
of Universities for Research in Astronomy, Inc.,
NASA, under contract NAS5-26555, by the A.F. Mor-
rison Fellowship in Lick Observatory, and by the Na-
tional Science Foundation through grant ACI-1663688.
R.S acknowledges support by the National Science Cen-
ter, Poland, Sonata BIS project 2018/30/E/ST9/00598.
A.T is a Research Associate at the Belgian Scientiﬁc
Research Fund (F.R.S.-F.N.R.S.). F.X.T acknowledges
support by NASA under the Astrophysics Theory Pro-
gram grant NNH21ZDA001N-ATP, and by the NSF un-
der Grant PHY-1430152 for the JINA Center for the
Evolution of the Elements. T.L.S.W thanks support
by the Gordon and Betty Moore Foundation through
Grant GBMF5076. J.S.G.M acknowledges support by
the KU Leuven Research Counsil (grant C16/18/005:

PARADISE). O.T was supported by a FONDECYT
project 321038. P.M. acknowledges support from the
FWO junior postdoctoral fellowship No. 12ZY520N.
This research made extensive use of the SAO/NASA
Astrophysics Data System (ADS).

Facilities: This work used the Extreme Science and
Engineering Discovery Environment (XSEDE; Towns
et al. 2014), which is supported by the NSF grant ACI-
1548562, speciﬁcally comet at the San Diego Supercom-
puter Center through allocation TG-AST180050. We
thank Charlie Conroy and the Harvard ITC for pro-
viding computational resources for continuous testing of
MESA through the FASRC Cannon cluster supported by
the FAS Division of Science Research Computing Group
at Harvard University. J.S acknowledges use of the lux
supercomputer at UC Santa Cruz, funded by NSF MRI
grant AST 1828315, and thanks Josh Sonstroem and
Brant Robertson for supporting this resource. A.S.J
acknowledges use of the rusty supercomputer at the

43

Flatiron Institute, supported by the Simons Founda-
tion, and thanks the Scientiﬁc Computing Core for sup-
porting this resource. W.H.B thanks the University of
Birmingham’s Advanced Research Computing team for
support of the BlueBEAR High-Performance Comput-
ing service. J.S.G.M thanks the VSC (Flemish Super-
computer Center), funded by the Research Foundation
- Flanders (FWO) and the Flemish Government - de-
partment EWI. T.L.S.W acknowledges use of compu-
tational facilities at UC Santa Barbara funded by NSF
grant CNS 1725797, and thanks the Center for Scientiﬁc
Computing for supporting this resource.

Software:

ÆSOPUS (Marigo & Aringer 2009)
http://stev.oapd.inaf.it/cgi-bin/aesopus, FreeEOS (Ir-
win 2004), ipython/jupyter (P´erez & Granger 2007;
Kluyver et al. 2016), matplotlib (Hunter 2007),
mesaPlot (Farmer 2021) NuDocker https://github.com/
NuGrid/NuDocker,
https://doi.org/10.5281/zenodo.
3678601, NumPy (van der Walt et al. 2011).

REFERENCES

Abbott, B. P., Abbott, R., Abbott, T. D., et al. 2018,

Andringa, S., et al. 2016, Adv. High Energy Phys., 2016,

Living Reviews in Relativity, 21, 3,
doi: 10.1007/s41114-018-0012-9

6194250, doi: 10.1155/2016/6194250

Araki, T., et al. 2005, Phys. Rev. Lett., 94, 081801,

Abdurro’uf, Accetta, K., Aerts, C., et al. 2022, ApJS, 259,

doi: 10.1103/PhysRevLett.94.081801

35, doi: 10.3847/1538-4365/ac4414

Artigau, ´E., Sivaramakrishnan, A., Greenbaum, A. Z., et al.

Abe, K., Haga, Y., Hayato, Y., et al. 2016, Astroparticle

Physics, 81, 39, doi: 10.1016/j.astropartphys.2016.04.003

Acciarri, R., Acero, M. A., Adamowski, M., et al. 2016,

arXiv e-prints, arXiv:1601.02984.
https://arxiv.org/abs/1601.02984

Acernese, F., Agathos, M., Agatsuma, K., et al. 2015,

Classical and Quantum Gravity, 32, 024001,
doi: 10.1088/0264-9381/32/2/024001

Akeson, R., Armus, L., Bachelet, E., et al. 2019, arXiv

e-prints, arXiv:1902.05569.
https://arxiv.org/abs/1902.05569

Akutsu, T., Ando, M., Arai, K., et al. 2021, Progress of
Theoretical and Experimental Physics, 2021, 05A102,
doi: 10.1093/ptep/ptab018

Al Kharusi, S., BenZvi, S. Y., Bobowski, J. S., et al. 2021,

New Journal of Physics, 23, 031201,
doi: 10.1088/1367-2630/abde33

Alexander, D., & Ferguson, J. 1994, The Astrophysical

Journal, 437, 879

2014, in Society of Photo-Optical Instrumentation

Engineers (SPIE) Conference Series, Vol. 9143, Space

Telescopes and Instrumentation 2014: Optical, Infrared,

and Millimeter Wave, 914340, doi: 10.1117/12.2055191

Ashok, N. M., & Banerjee, D. P. K. 2003, A&A, 409, 1007,

doi: 10.1051/0004-6361:20031160

Astropy Collaboration, Price-Whelan, A. M., Sip˝ocz, B. M.,

et al. 2018, AJ, 156, 123, doi: 10.3847/1538-3881/aabc4f

Astropy Collaboration, Price-Whelan, A. M., Lian Lim, P.,

et al. 2022, arXiv e-prints, arXiv:2206.14220.

https://arxiv.org/abs/2206.14220

Baalrud, S. D., & Daligault, J. 2014, Physics of Plasmas,

21, 055707, doi: 10.1063/1.4875282

Bader, G., & Deuﬂhard, P. 1983, Numerische Mathematik,

41, 373, doi: 10.1007/BF01418331

Baiko, D. A. 2019, MNRAS, 488, 5042,

doi: 10.1093/mnras/stz2041

Baiko, D. A., & Chugunov, A. I. 2022, MNRAS, 510, 2628,

Almgren, A., Sazo, M., Bell, J., et al. 2020, The Journal of
Open Source Software, 5, 2513, doi: 10.21105/joss.02513

doi: 10.1093/mnras/stab3613

Baiko, D. A., Potekhin, A. Y., & Yakovlev, D. G. 2001,

Andreoni, I., Coughlin, M. W., Almualla, M., et al. 2022,

Phys. Rev. E, 64, 057402,

ApJS, 258, 5, doi: 10.3847/1538-4365/ac3bae

doi: 10.1103/PhysRevE.64.057402

44

Ball, W. H. 2021, Research Notes of the American

Borexino Collaboration, Agostini, M., Altenm¨uller, K.,

Astronomical Society, 5, 7

Ball, W. H., Chaplin, W. J., Schoﬁeld, M., et al. 2018, The

Astrophysical Journal Supplement Series, 239, 34,
doi: 10.3847/1538-4365/aaedbc

Barnes, J., Zhu, Y. L., Lund, K. A., et al. 2021, ApJ, 918,

et al. 2018, Nature, 562, 505,
doi: 10.1038/s41586-018-0624-y

Borexino Collaboration, Agostini, M., Altenm¨uller, K.,

Appel, S., et al. 2020, Nature, 587, 577,
doi: 10.1038/s41586-020-2934-0

44, doi: 10.3847/1538-4357/ac0aec

Brandt, G. M., Michalik, D., Brandt, T. D., et al. 2021, AJ,

Bartholomew-Biggs, M., Brown, S., Christianson, B., &

162, 230, doi: 10.3847/1538-3881/ac12d0

Dixon, L. 2000, Journal of Computational and Applied
Mathematics, 124, 171,
doi: 10.1016/S0377-0427(00)00422-2

Brassard, P., Fontaine, G., Wesemael, F., Kawaler, S. D., &
Tassoul, M. 1991, ApJ, 367, 601, doi: 10.1086/169655

Buchler, J. R., & Yueh, W. R. 1976, ApJ, 210, 440,

Baturin, V. A., D¨appen, W., Oreshina, A. V., Ayukov,
S. V., & Gorshkov, A. B. 2019, A&A, 626, A108,
doi: 10.1051/0004-6361/201935669

Bauer, E. B., Schwab, J., & Bildsten, L. 2017, ApJ, 845, 97,

doi: 10.3847/1538-4357/aa7ﬀa

doi: 10.1086/154847

Bundy, K., Westfall, K., MacDonald, N., et al. 2019, in

Bulletin of the American Astronomical Society, Vol. 51,
198. https://arxiv.org/abs/1907.07195

Burgers, J. M. 1969, Flow Equations for Composite Gases

Bauer, E. B., Schwab, J., Bildsten, L., & Cheng, S. 2020,

(New York: Academic)

ApJ, 902, 93, doi: 10.3847/1538-4357/abb5a5

Burns, K. J., Vasil, G. M., Oishi, J. S., Lecoanet, D., &

Beacom, J. F., & Vogel, P. 1999, PhRvD, 60, 033007,

doi: 10.1103/PhysRevD.60.033007

Beichman, C. A., Rieke, M., Eisenstein, D., et al. 2012, in
Society of Photo-Optical Instrumentation Engineers
(SPIE) Conference Series, Vol. 8442, Space Telescopes
and Instrumentation 2012: Optical, Infrared, and
Millimeter Wave, 84422N, doi: 10.1117/12.925447
Bellinger, E. P., & Christensen-Dalsgaard, J. 2022,

MNRAS, arXiv:2206.13570.
https://arxiv.org/abs/2206.13570

Bellm, E. C., Burke, C. J., Coughlin, M. W., et al. 2022,

Brown, B. P. 2020, Physical Review Research, 2, 023068,
doi: 10.1103/PhysRevResearch.2.023068

Caillol, J. M. 1999, JChPh, 111, 9695,

doi: 10.1063/1.480302

Cao, L., Pinsonneault, M. H., Hillenbrand, L. A., & Kuhn,
M. A. 2022, ApJ, 924, 84, doi: 10.3847/1538-4357/ac307f

Caplan, M. E., Bauer, E. B., & Freeman, I. F. 2022,
MNRAS, 513, L52, doi: 10.1093/mnrasl/slac032
Caplan, M. E., Horowitz, C. J., & Cumming, A. 2020,
ApJL, 902, L44, doi: 10.3847/2041-8213/abbda0
Carata, L., Akoush, S., Balakrishnan, N., et al. 2014,

ApJS, 258, 13, doi: 10.3847/1538-4365/ac4602

Queue, 12, 10

Bellm, E. C., Kulkarni, S. R., Graham, M. J., et al. 2019,
PASP, 131, 018002, doi: 10.1088/1538-3873/aaecbe

Bergstr¨om, J., Gonzalez-Garcia, M. C., Maltoni, M., et al.

2016, Journal of High Energy Physics, 2016, 132,
doi: 10.1007/JHEP03(2016)132

Carr, W. J., Coldwell-Horsfall, R. A., & Fein, A. E. 1961,

Physical Review, 124, 747, doi: 10.1103/PhysRev.124.747
Cassisi, S., Potekhin, A. Y., Pietrinferni, A., Catelan, M., &
Salaris, M. 2007, ApJ, 661, 1094, doi: 10.1086/516819
Chen, P., Dong, S., Kochanek, C. S., et al. 2022, ApJS, 259,

Bianco, F. B., Ivezi´c, ˇZ., Jones, R. L., et al. 2022, ApJS,

53, doi: 10.3847/1538-4365/ac50b7

258, 1, doi: 10.3847/1538-4365/ac3e72

Chen, W., Kelly, P. L., Diego, J. M., et al. 2019, ApJ, 881,

Bildsten, L., & Hall, D. M. 2001, ApJL, 549, L219,

8, doi: 10.3847/1538-4357/ab297d

doi: 10.1086/319169

Bl¨ocker, T. 1995, A&AS, 297, 727
Blouin, S., & Daligault, J. 2021, PhRvE, 103, 043204,

Christensen-Dalsgaard, J. 2008, Ap&SS, 316, 113
Christensen-Dalsgaard, J., Silva Aguirre, V., Cassisi, S.,

et al. 2020, A&A, 635, A165

doi: 10.1103/PhysRevE.103.043204

Cinquegrana, G. C., & Joyce, M. 2022, Research Notes of

Blouin, S., Daligault, J., & Saumon, D. 2021, ApJL, 911,

the AAS, 6, 77

L5, doi: 10.3847/2041-8213/abf14b

Cinquegrana, G. C., Joyce, M., & Karakas, A. I. 2022,

Blouin, S., Shaﬀer, N. R., Saumon, D., & Starrett, C. E.
2020, ApJ, 899, 46, doi: 10.3847/1538-4357/ab9e75

arXiv e-prints, arXiv:2208.01859.
https://arxiv.org/abs/2208.01859

Bolton, A., Abbott, T., Allen, L., et al. 2019, in Bulletin of

Conroy, K. E., Kochoska, A., Hey, D., et al. 2020, ApJS,

the American Astronomical Society, Vol. 51, 240

250, 34, doi: 10.3847/1538-4365/abb4e2

Boquien, M., & Salim, S. 2021, A&A, 653, A149,

Cox, J. P., & Giuli, R. T. 1968, Principles of stellar

doi: 10.1051/0004-6361/202140992

structure (New York: Gordon and Breach)

45

Cunha, M. S., Roxburgh, I. W., Aguirre Børsen-Koch, V.,

Felter, W., Ferreira, A., Rajamony, R., & Rubio, J. 2014,

et al. 2021, MNRAS, 508, 5864,
doi: 10.1093/mnras/stab2886

Cyburt, R. H., Amthor, A. M., Ferguson, R., et al. 2010,

ApJ Supp. Ser., 189, 240

Daligault, J. 2006, PhRvL, 96, 065003,
doi: 10.1103/PhysRevLett.96.065003

Daramy-Loirat, C., Defour, D., de Dinechin, F., et al. 2006,

CR-LIBM A library of correctly rounded elementary
functions in double-precision, Research report, LIP,.
https://hal-ens-lyon.archives-ouvertes.fr/ensl-01529804

Deloye, C. J., & Bildsten, L. 2002, ApJ, 580, 1077,

doi: 10.1086/343800

An updated performance comparison of virtual machines
and Linux container, Tech. Rep. RC25482, IBM
Research, Austin, TX. https://dominoweb.draco.res.ibm.
com/0929052195dd819c85257d2300681e7b.html

Felter, W., Ferreira, A., Rajamony, R., & Rubio, J. 2015, in
2015 IEEE International Symposium on Performance
Analysis of Systems and Software (ISPASS), 171–172,
doi: 10.1109/ISPASS.2015.7095802

Ferguson, J. W., Alexander, D. R., Allard, F., et al. 2005,

The Astrophysical Journal, 623, 585

Flewelling, H. A., Magnier, E. A., Chambers, K. C., et al.
2020, ApJS, 251, 7, doi: 10.3847/1538-4365/abb82d

Demarque, P., Guenther, D. B., Li, L. H., Mazumdar, A., &

Foreman-Mackey, D., Hogg, D. W., Lang, D., & Goodman,

Straka, C. W. 2008, Ap&SS, 316, 31,
doi: 10.1007/s10509-007-9698-y

DeWitt, H., & Slattery, W. 1999, Contributions to Plasma

J. 2013, PASP, 125, 306, doi: 10.1086/670067

Frost, C., & Lattanzio, J. 1996, ApJ, 473, 383
Fuller, J., Piro, A. L., & Jermyn, A. S. 2019, MNRAS, 485,

Physics, 39, 97, doi: 10.1002/ctpp.2150390124

3661, doi: 10.1093/mnras/stz514

Dhawan, S., Goobar, A., Smith, M., et al. 2022, MNRAS,

510, 2228, doi: 10.1093/mnras/stab3093
Dorn-Wallenstein, T. Z., Davenport, J. R. A.,

Huppenkothen, D., & Levesque, E. M. 2021, ApJ, 913,
32, doi: 10.3847/1538-4357/abf1f2

Gaia Collaboration, Brown, A. G. A., Vallenari, A., et al.
2016, A&A, 595, A2, doi: 10.1051/0004-6361/201629512
—. 2018, A&A, 616, A1, doi: 10.1051/0004-6361/201833051
—. 2021, A&A, 649, A1, doi: 10.1051/0004-6361/202039657
Garc´ıa-Berro, E., Althaus, L. G., C´orsico, A. H., & Isern, J.

Dragomir, D., Teske, J., G¨unther, M. N., et al. 2019, ApJ,

2008, ApJ, 677, 473, doi: 10.1086/527536

875, L7, doi: 10.3847/2041-8213/ab12ed

Gardner, J. P., Mather, J. C., Clampin, M., et al. 2006,

Dubey, A., Weideh, K., O’Neal, J., et al. 2022, SoftwareX,

SSRv, 123, 485, doi: 10.1007/s11214-006-8315-7

in press

Genest-Beaulieu, C., & Bergeron, P. 2019, ApJ, 882, 106,

Eisenstein, D. J., Liebert, J., Koester, D., et al. 2006, AJ,

doi: 10.3847/1538-4357/ab379e

132, 676, doi: 10.1086/504424

Glasner, S. A., Livne, E., Steinberg, E., Yalinewich, A., &

Ellis, R., & Dawson, K. 2019, in Bulletin of the American

Astronomical Society, Vol. 51, 45.
https://arxiv.org/abs/1907.06797

Truran, J. W. 2018, MNRAS, 476, 2238,
doi: 10.1093/mnras/sty421

Grevesse, N., & Sauval, A. J. 1998, SSRv, 85, 161,

Fan, D., Nonaka, A., Almgren, A. S., Harpole, A., &

doi: 10.1023/A:1005161325181

Zingale, M. 2019, ApJ, 887, 212,
doi: 10.3847/1538-4357/ab4f75

Guillot, T., & Havel, M. 2011, A&A, 527, A20
Guo, X., et al. 2007, arXiv e-prints.

Farag, E., Timmes, F. X., Taylor, M., Patton, K. M., &

https://arxiv.org/abs/hep-ex/0701029

Farmer, R. 2020, ApJ, 893, 133,
doi: 10.3847/1538-4357/ab7f2c

Farmer, R. 2021, rjfarmer/mesaplot: Release: v2.0.3, v2.0.3,

Hansen, J., & Vieillefosse, P. 1975, Physics Letters A, 53,

187 , doi: https://doi.org/10.1016/0375-9601(75)90523-X
Hashimoto, M. A., Nomoto, K. I., Arai, K., & Kaminisi, K.

Zenodo, doi: 10.5281/zenodo.5779536

1986, ApJ, 307, 687, doi: 10.1086/164453

Farmer, R., Fields, C. E., Petermann, I., et al. 2016, ApJS,

Hernitschek, N., & Stassun, K. G. 2022, ApJS, 258, 4,

227, 22, doi: 10.3847/1538-4365/227/2/22

doi: 10.3847/1538-4365/ac3baf

Farmer, R., Fields, C. E., & Timmes, F. X. 2015, ApJ, 807,

184, doi: 10.1088/0004-637X/807/2/184

Farouki, R. T., & Hamaguchi, S. 1993, Phys. Rev. E, 47,

Hu, H., Tout, C. A., Glebbeek, E., & Dupret, M. A. 2011,
Monthly Notices of the Royal Astronomical Society, 418,
195, doi: 10.1111/j.1365-2966.2011.19482.x

4330, doi: 10.1103/PhysRevE.47.4330

Huang, C. X., Burt, J., Vanderburg, A., et al. 2018, ApJ,

Feiden, G. A., & Chaboyer, B. 2013, in EAS Publications

868, L39, doi: 10.3847/2041-8213/aaef91

Series, Vol. 64, EAS Publications Series, ed.
K. Pavlovski, A. Tkachenko, & G. Torres, 127–130,
doi: 10.1051/eas/1364017

Hughto, J., Schneider, A. S., Horowitz, C. J., & Berry,

D. K. 2010, PhRvE, 82, 066401,
doi: 10.1103/PhysRevE.82.066401

46

Hui-Bon-Hoa, A. 2021, Astronomy & Astrophysics, 646, L6,

Kollmeier, J. A., Zasowski, G., Rix, H.-W., et al. 2017,

doi: 10.1051/0004-6361/202040095

Hunter, J. D. 2007, Computing In Science &amp;

arXiv e-prints, arXiv:1711.03234.
https://arxiv.org/abs/1711.03234

Engineering, 9, 90

Iben, Icko, J., & Tutukov, A. V. 1989, ApJ, 342, 430,

doi: 10.1086/167603

Kosmas, T. S., Tsoulos, I., Kosmas, O., & Giannaka, P. G.
2022, Frontiers in Astronomy and Space Sciences, 8,
763276, doi: 10.3389/fspas.2021.763276

Ichimaru, S., Iyetomi, H., & Tanaka, S. 1987, Physics

Krishna Swamy, K. S. 1966, ApJ, 145, 174

Reports, 149, 91 ,
doi: https://doi.org/10.1016/0370-1573(87)90125-6

Kuhfuß, R. 1986, A&A, 160, 116

Kupfer, T., Bauer, E. B., van Roestel, J., et al. 2022, ApJL,

Iglesias, C. A., & Rogers, F. J. 1996, ApJ, 464, 943

925, L12, doi: 10.3847/2041-8213/ac48f1

Irwin, A. W. 2004, The FreeEOS Code for Calculating the

Labiano, A., Argyriou, I., ´Alvarez-M´arquez, J., et al. 2021,

Equation of State for Stellar Interiors.
http://freeeos.sourceforge.net/

A&A, 656, A57, doi: 10.1051/0004-6361/202140614

Laplace, E. 2022, Astronomy and Computing, 38, 100516,

Ivezi´c, ˇZ., Kahn, S. M., Tyson, J. A., et al. 2019, ApJ, 873,

doi: 10.1016/j.ascom.2021.100516

111, doi: 10.3847/1538-4357/ab042c

Lattanzio, J. C. 1986, ApJ, 311, 708

Jermyn, A. S., Schwab, J., Bauer, E., Timmes, F. X., &

Lederer, M. T., & Aringer, B. 2009, Astronomy &

Potekhin, A. Y. 2021, ApJ, 913, 72,
doi: 10.3847/1538-4357/abf48e

Astrophysics, 494, 403

Li, X., Ragosta, F., Clarkson, W. I., & Bianco, F. B. 2022,

Jermyn, A. S., & Timmes, F. X. 2022, Research Notes of

ApJS, 258, 2, doi: 10.3847/1538-4365/ac3bca

the AAS, 6, 43, doi: 10.3847/2515-5172/ac5ac1

LIGO Scientiﬁc Collaboration, Aasi, J., Abbott, B. P.,

Jiang, Y.-F. 2021, ApJS, 253, 49,
doi: 10.3847/1538-4365/abe303

et al. 2015, Classical and Quantum Gravity, 32, 074001,
doi: 10.1088/0264-9381/32/7/074001

Jiang, Y.-F., Cantiello, M., Bildsten, L., Quataert, E., &

Lodders, K. 2003, ApJ, 591, 1220

Blaes, O. 2015, ApJ, 813, 74,
doi: 10.1088/0004-637X/813/1/74

Joss, P. C., Salpeter, E. E., & Ostriker, J. P. 1973, ApJ,

181, 429, doi: 10.1086/152060

Joyce, M., Lairmore, L., Price, D. J., Mohamed, S., &

Reichardt, T. 2019, ApJ, 882, 63,
doi: 10.3847/1538-4357/ab3405

LSST Science Collaboration, Marshall, P., Anguita, T.,

et al. 2017, ArXiv e-prints.
https://arxiv.org/abs/1708.04058

LSST Solar System Science Collaboration, Jones, R. L.,

Bannister, M. T., et al. 2020, arXiv e-prints,
arXiv:2009.07653. https://arxiv.org/abs/2009.07653

Ludwig, H.-G., Freytag, B., & Steﬀen, M. 1999, A&A, 346,

JUNO Collaboration. 2022, Progress in Particle and

111

Nuclear Physics, 123, 103927,
doi: 10.1016/j.ppnp.2021.103927

Maeder, A. 1987, A&A, 173, 247

Mamajek, E. E., Prsa, A., Torres, G., et al. 2015, arXiv

Karakas, A., & Lattanzio, J. C. 2007, Pub. Astron. Soc.

Aus., 24, 103

e-prints, arXiv:1510.07674.
https://arxiv.org/abs/1510.07674

Kelly, P. L., Diego, J. M., Rodney, S., et al. 2018, Nature
Astronomy, 2, 334, doi: 10.1038/s41550-018-0430-3

Mandel, I., & Broekgaarden, F. S. 2022, Living Reviews in

Relativity, 25, 1, doi: 10.1007/s41114-021-00034-3

Kippenhahn, R., Weigert, A., & Weiss, A. 2012, Stellar
Structure and Evolution (Springer-Verlag: Berlin),
doi: 10.1007/978-3-642-30304-3

Mann, A. W., Feiden, G. A., Gaidos, E., Boyajian, T., &

von Braun, K. 2015, ApJ, 804, 64,
doi: 10.1088/0004-637X/804/1/64

Kluyver, T., Ragan-Kelley, B., P´erez, F., et al. 2016, in

Marigo, P., & Aringer, B. 2009, A&A, 508, 1539

Positioning and Power in Academic Publishing: Players,
Agents and Agendas: Proceedings of the 20th
International Conference on Electronic Publishing, IOS
Press, 87

Marshall, J., Bolton, A., Bullock, J., et al. 2019, in Bulletin

of the American Astronomical Society, Vol. 51, 126.
https://arxiv.org/abs/1907.07192

Medin, Z., & Cumming, A. 2010, PhRvE, 81, 036107,

Koester, D. 2010, Mem. Soc. Astron. Italiana, 81, 921

doi: 10.1103/PhysRevE.81.036107

Koester, D., Kepler, S. O., & Irwin, A. W. 2020, A&A, 635,

A103, doi: 10.1051/0004-6361/202037530

Meurer, A., Smith, C. P., Paprocki, M., et al. 2017, PeerJ
Computer Science, 3, e103, doi: 10.7717/peerj-cs.103

Miglio, A., Chiappini, C., Mosser, B., et al. 2017,

Perna, R., Wang, Y.-H., Farr, W. M., Leigh, N., &

Astronomische Nachrichten, 338, 644,
doi: 10.1002/asna.201713385

Cantiello, M. 2019, ApJL, 878, L1,
doi: 10.3847/2041-8213/ab2336

Mombarg, J. S. G., Dotter, A., Rieutord, M., et al. 2022,

Potekhin, A. Y., & Chabrier, G. 2000, Phys. Rev. E, 62,

47

The Astrophysical Journal, 925, 154,
doi: 10.3847/1538-4357/ac3dfb

Montalto, M., Piotto, G., Marrese, P. M., et al. 2021, A&A,

653, A98, doi: 10.1051/0004-6361/202140717

Moore, A. M., Kasliwal, M. M., Gelino, C. R., et al. 2016,
in Society of Photo-Optical Instrumentation Engineers
(SPIE) Conference Series, Vol. 9906, Ground-based and
Airborne Telescopes VI, ed. H. J. Hall, R. Gilmozzi, &
H. K. Marshall, 99062C, doi: 10.1117/12.2233694

Mosumgaard, J. R., Ball, W. H., Silva Aguirre, V., Weiss,
A., & Christensen-Dalsgaard, J. 2018a, MNRAS, 478,
5650, doi: 10.1093/mnras/sty1442

—. 2018b, MNRAS, 478, 5650, doi: 10.1093/mnras/sty1442

Mukhopadhyay, M., Lunardini, C., Timmes, F. X., &

Zuber, K. 2020, ApJ, 899, 153,
doi: 10.3847/1538-4357/ab99a6

Nagara, H., Nagata, Y., & Nakamura, T. 1987, Phys. Rev.

A, 36, 1859, doi: 10.1103/PhysRevA.36.1859

Nascimbeni, V., Piotto, G., B¨orner, A., et al. 2022, A&A,

658, A31, doi: 10.1051/0004-6361/202142256

National Research Council. 2021, Pathways to Discovery in
Astronomy and Astrophysics for the 2020s (The National
Academies Press)

Newell, D. B., Cabiati, F., Fischer, J., et al. 2018,

Metrologia, 55, L13, doi: 10.1088/1681-7575/aa950a

Nishida, M., & Schindler, A. M. 1967, AJ, 72, 820,

doi: 10.1086/110510

Ogata, S., Iyetomi, H., Ichimaru, S., & van Horn, H. M.

1993, PhRvE, 48, 1344, doi: 10.1103/PhysRevE.48.1344

Paquette, C., Pelletier, C., Fontaine, G., & Michaud, G.

1986, ApJS, 61, 177, doi: 10.1086/191111

Patapis, P., Nasedkin, E., Cugno, G., et al. 2022, A&A,

658, A72, doi: 10.1051/0004-6361/202141663

Paxton, B., Bildsten, L., Dotter, A., et al. 2011, ApJS, 192,

3, doi: 10.1088/0067-0049/192/1/3

Paxton, B., Cantiello, M., Arras, P., et al. 2013, ApJS, 208,

4

Paxton, B., Marchant, P., Schwab, J., et al. 2015, ApJS,

220, 15, doi: 10.1088/0067-0049/220/1/15

Paxton, B., Schwab, J., Bauer, E. B., et al. 2018, ApJS,

234, 34, doi: 10.3847/1538-4365/aaa5a8

8554, doi: 10.1103/PhysRevE.62.8554

Potekhin, A. Y., & Chabrier, G. 2010, Contributions to
Plasma Physics, 50, 82, doi: 10.1002/ctpp.201010017

—. 2013, A&A, 550, A43,

doi: 10.1051/0004-6361/201220082

Potekhin, A. Y., Chabrier, G., Chugunov, A. I., DeWitt,

H. E., & Rogers, F. J. 2009, PhRvE, 80, 047401,
doi: 10.1103/PhysRevE.80.047401

Poutanen, J. 2017, ApJ, 835, 119,

doi: 10.3847/1538-4357/835/2/119

Predehl, P., Andritschke, R., Areﬁev, V., et al. 2021, A&A,

647, A1, doi: 10.1051/0004-6361/202039313

Price, D. J., Wurster, J., Tricco, T. S., et al. 2018, PASA,

35, e031, doi: 10.1017/pasa.2018.25

Raiteri, C. M., Carnerero, M. I., Balmaverde, B., et al.
2022, ApJS, 258, 3, doi: 10.3847/1538-4365/ac3bb0

Rauer, H., Catala, C., Aerts, C., et al. 2014, Experimental
Astronomy, 38, 249, doi: 10.1007/s10686-014-9383-4

Reimers, D. 1975, in Problems in stellar atmospheres and

envelopes (Springer), 229–256

Renzo, M., Callister, T., Chatziioannou, K., et al. 2021,

ApJ, 919, 128, doi: 10.3847/1538-4357/ac1110

Ricker, G. R., Vanderspek, R., Winn, J., et al. 2016, in
Society of Photo-Optical Instrumentation Engineers
(SPIE) Conference Series, Vol. 9904, Space Telescopes
and Instrumentation 2016: Optical, Infrared, and
Millimeter Wave, ed. H. A. MacEwen, G. G. Fazio,
M. Lystrup, N. Batalha, N. Siegler, & E. C. Tong,
99042B, doi: 10.1117/12.2232071

Rieke, G. H., Wright, G. S., B¨oker, T., et al. 2015,

Publications of the Astronomical Society of the Paciﬁc,
127, 584, doi: 10.1086/682252

Robertson, B. E. 2021, arXiv e-prints, arXiv:2110.13160.

https://arxiv.org/abs/2110.13160

Rodney, S. A., Balestra, I., Bradac, M., et al. 2018, Nature

Astronomy, 2, 324, doi: 10.1038/s41550-018-0405-4

Rogers, F. J., & Nayfonov, A. 2002, ApJ, 576, 1064,

doi: 10.1086/341894

Salaris, M., Cassisi, S., Pietrinferni, A., & Hidalgo, S. 2022,

MNRAS, 509, 5197, doi: 10.1093/mnras/stab3359

Paxton, B., Smolec, R., Schwab, J., et al. 2019, ApJS, 243,

Salaris, M., Garc´ıa-Berro, E., Hernanz, M., Isern, J., &

10, doi: 10.3847/1538-4365/ab2241

Saumon, D. 2000, ApJ, 544, 1036, doi: 10.1086/317235

P´erez, F., & Granger, B. E. 2007, Computing in Science &

Sallaska, A. L., Iliadis, C., Champange, A. E., et al. 2013,

Engineering, 9, 21

ApJS, 207, 18, doi: 10.1088/0067-0049/207/1/18

48

S´anchez, B., Kessler, R., Scolnic, D., et al. 2021, arXiv

e-prints, arXiv:2111.06858.
https://arxiv.org/abs/2111.06858

Stone, J. M., Tomida, K., White, C. J., & Felker, K. G.
2020, ApJS, 249, 4, doi: 10.3847/1538-4365/ab929b

Stothers, R., & Chin, C.-W. 1973, ApJ, 179, 555,

Sanyal, D., Grassitelli, L., Langer, N., & Bestenlehner,

doi: 10.1086/151895

J. M. 2015, A&A, 580, A20,
doi: 10.1051/0004-6361/201525945

Sz´ecsi, D., Langer, N., Yoon, S.-C., et al. 2015, A&A, 581,

A15, doi: 10.1051/0004-6361/201526617

Sarkar, S., & Madhusudhan, N. 2021, MNRAS, 508, 433,

Tiesinga, E., Mohr, P. J., Newell, D. B., & Taylor, B. N.

doi: 10.1093/mnras/stab2472

Saumon, D., Chabrier, G., & van Horn, H. M. 1995, ApJS,

2021, Reviews of Modern Physics, 93, 025010,
doi: 10.1103/RevModPhys.93.025010

99, 713, doi: 10.1086/192204

Timmes, F. X., & Swesty, F. D. 2000, ApJS, 126, 501,

Schultz, W. C., Bildsten, L., & Jiang, Y.-F. 2020, ApJ, 902,

doi: 10.1086/313304

67, doi: 10.3847/1538-4357/abb405

Tomsick, J., & COSI Collaboration. 2022, in 37th

Schwab, J. 2019, The Astrophysical Journal, 885, 27

Schwab, J. 2020, ApJL, 901, L18,
doi: 10.3847/2041-8213/abb45f

International Cosmic Ray Conference. 12-23 July 2021.
Berlin, 652. https://arxiv.org/abs/2109.10403

Towns, J., Cockerill, T., Dahan, M., et al. 2014, Computing

Schwab, J., Quataert, E., & Bildsten, L. 2015, MNRAS,

453, 1910, doi: 10.1093/mnras/stv1804

in Science and Engineering, 16, 62,
doi: 10.1109/MCSE.2014.80

Schwamb, M. E., Juri´c, M., Bolin, B. T., et al. 2021,

Townsend, R. H. D., Goldstein, J., & Zweibel, E. G. 2018,

Research Notes of the American Astronomical Society, 5,
143, doi: 10.3847/2515-5172/ac090f

MNRAS, 475, 879

Townsend, R. H. D., & Lopez, A. 2022, Journal of

Seaton, M. J. 2005, Monthly Notices of the Royal

Open-Source Software

Astronomical Society, 362, L1,
doi: 10.1111/j.1365-2966.2005.00019.x

Townsend, R. H. D., & Teitler, S. A. 2013, MNRAS, 435,

3406

Senarath, M. R., Brown, M. J. I., Cluver, M. E., et al.
2018, ApJ, 869, L26, doi: 10.3847/2041-8213/aaf4ﬀ

Shen, K. J., & Bildsten, L. 2009, ApJ, 699, 1365,

Trampedach, R., Stein, R. F., Christensen-Dalsgaard, J.,
Nordlund, ˚A., & Asplund, M. 2014, MNRAS, 442, 805
Turk, M. J., Smith, B. D., Oishi, J. S., et al. 2011, ApJS,

doi: 10.1088/0004-637X/699/2/1365

192, 9, doi: 10.1088/0067-0049/192/1/9

Simonucci, S., Taioli, S., Palmerini, S., & Busso, M. 2013,

ApJ, 764, 118, doi: 10.1088/0004-637X/764/2/118

Simpson, C., Abe, K., Bronner, C., et al. 2019, ApJ, 885,

133, doi: 10.3847/1538-4357/ab4883

Smolec, R., & Moskalik, P. 2008, AcA, 58, 193.

Van den Bussche, J., & Vianu, V., eds. 2001, Why and
Where: A Characterization of Data Provenance, ed.
J. Van den Bussche & V. Vianu (Berlin, Heidelberg:
Springer Berlin Heidelberg),
doi: 10.1007/3-540-44503-X 20

https://arxiv.org/abs/0809.1979

van der Walt, S., Colbert, S. C., & Varoquaux, G. 2011,

Soﬃtta, P., Baldini, L., Bellazzini, R., et al. 2021, AJ, 162,

208, doi: 10.3847/1538-3881/ac19b0

Computing in Science Engineering, 13, 22,
doi: 10.1109/MCSE.2011.37

Somers, G., Cao, L., & Pinsonneault, M. H. 2020, ApJ, 891,

Vernazza, J. E., Avrett, E. H., & Loeser, R. 1981, ApJS,

29, doi: 10.3847/1538-4357/ab722e

45, 635, doi: 10.1086/190731

Somers, G., & Pinsonneault, M. H. 2015, ApJ, 807, 174,

Vitense, E. 1953, ZA, 32, 135

doi: 10.1088/0004-637X/807/2/174

Vogel, P., & Beacom, J. F. 1999, PhRvD, 60, 053003,

Spada, F., Demarque, P., Kim, Y.-C., & Sills, A. 2013,

doi: 10.1103/PhysRevD.60.053003

ApJ, 776, 87, doi: 10.1088/0004-637X/776/2/87

Vogl, C., Sim, S. A., Noebauer, U. M., Kerzendorf, W. E.,

Spergel, D., Gehrels, N., Baltay, C., et al. 2015, arXiv

e-prints, arXiv:1503.03757.
https://arxiv.org/abs/1503.03757

& Hillebrandt, W. 2019, A&A, 621, A29,
doi: 10.1051/0004-6361/201833701

Wang, S., Jones, M., Shporer, A., et al. 2019, AJ, 157, 51,

Stanton, L. G., & Murillo, M. S. 2016, PhRvE, 93, 043203,

doi: 10.3847/1538-3881/aaf1b7

doi: 10.1103/PhysRevE.93.043203

Welch, B., Coe, D., Diego, J. M., et al. 2022, Nature, 603,

Stodden, V., Seiler, J., & Ma, Z. 2018, Proceedings of the

815, doi: 10.1038/s41586-022-04449-y

National Academy of Sciences, 115, 2584,
doi: 10.1073/pnas.1708290115

Windhorst, R. A., Timmes, F. X., Wyithe, J. S. B., et al.
2018, ApJS, 234, 41, doi: 10.3847/1538-4365/aaa760

Wong, T. L. S., & Bildsten, L. 2021, ApJ, 923, 125,

Zackrisson, E., Rydberg, C.-E., Schaerer, D., ¨Ostlin, G., &

doi: 10.3847/1538-4357/ac2b2a

Tuli, M. 2011, ApJ, 740, 13,
doi: 10.1088/0004-637X/740/1/13

Woosley, S. E., & Kasen, D. 2011, ApJ, 734, 38,

Zevin, M., Bavera, S. S., Berry, C. P. L., et al. 2021, ApJ,

doi: 10.1088/0004-637X/734/1/38

910, 152, doi: 10.3847/1538-4357/abe40e

Zhang, T., Mandelbaum, R., & LSST Dark Energy Science

York, D. G., Adelman, J., Anderson, John E., J., et al.

2000, AJ, 120, 1579, doi: 10.1086/301513

Collaboration. 2022, MNRAS, 510, 1978,
doi: 10.1093/mnras/stab3584

49

