Joint species distribution models with imperfect detection for

high-dimensional spatial data

Jeﬀrey W. Doser1, 2, Andrew O. Finley2, 3, Sudipto Banerjee4

1Department of Integrative Biology, Michigan State University, East Lansing, MI, USA

2Ecology, Evolution, and Behavior Program, Michigan State University, East Lansing, MI, USA

3Department of Forestry, Michigan State University, East Lansing, MI, USA

4Department of Biostatistics, University of California, Los Angeles, CA

Corresponding Author: Jeﬀrey W. Doser, email: doserjef@msu.edu; ORCID ID: 0000-0002-

8950-9895

Running Title: Spatial JSDMs with imperfect detection

2
2
0
2

r
p
A
6

]
P
A

.
t
a
t
s
[

1
v
7
0
7
2
0
.
4
0
2
2
:
v
i
X
r
a

1

 
 
 
 
 
 
Abstract

Determining spatial distributions of species and communities are key objectives of ecology and

conservation. Joint species distribution models use multi-species detection-nondetection data

to estimate species and community distributions. The analysis of such data is complicated by

residual correlations between species, imperfect detection, and spatial autocorrelation. While

methods exist to accommodate each of these complexities, there are few examples in the litera-

ture that address and explore all three complexities simultaneously. Here we developed a spatial

factor multi-species occupancy model to explicitly account for species correlations, imperfect

detection, and spatial autocorrelation. The proposed model uses a spatial factor dimension re-

duction approach and Nearest Neighbor Gaussian Processes to ensure computational eﬃciency

for data sets with both a large number of species (e.g., > 100) and spatial locations (e.g.,

100,000). We compare the proposed model performance to ﬁve candidate models, each address-

ing a subset of the three complexities. We implemented the proposed and competing models in

the spOccupancy software, designed to facilitate application via an accessible, well-documented,

and open-source R package. Using simulations, we found ignoring the three complexities when

present leads to inferior model predictive performance, and the impacts of failing to account

for one or more complexities will depend on the objectives of a given study. Using a case

study on 98 bird species across the continental US, the spatial factor multi-species occupancy

model had the highest predictive performance among the candidate models. Further, our model

successfully distinguished between two biogeographical species groups within the 98 species, in-

dicating the potential of our framework as a model-based ordination technique. Our proposed

framework, together with its implementation in spOccupancy, serves as a user-friendly tool to

understand spatial variation in species distributions and biodiversity metrics while addressing

common complexities in multi-species detection-nondetection data.

Keywords: Bayesian, latent factor, Nearest Neighbor Gaussian Process, occupancy model

Introduction

Understanding the spatial distributions of species and communities is a fundamental task of

ecology and conservation. Species distribution models (SDMs) are popular for predicting species

distributions and their drivers across space and time (Guisan and Zimmermann, 2000), which

2

have informed key developments in ecological theory as well as conservation and management

decisions (Bateman et al., 2020). While SDMs can use diﬀerent data types, they most commonly

use binary detection-nondetection data. Advances in hierarchical modeling have addressed

many issues encountered when modeling multi-species detection-nondetection data (Shirota

et al., 2019; Devarajan et al., 2020). In particular, the three major complexities are (1) residual

species correlations (Ovaskainen et al., 2010), (2) imperfect detection (MacKenzie et al., 2002),

and (3) spatial autocorrelation (Latimer et al., 2009; Finley et al., 2009; Banerjee et al., 2014).

Joint species distribution models (JSDMs) are regression-based approaches that explicitly

accommodate residual species correlations (Latimer et al., 2009; Ovaskainen et al., 2010). By

jointly modeling species within a single model, JSDMs facilitate co-occurrence hypothesis testing

(Ovaskainen et al., 2010) and increase precision of both individual species distributions and

community metrics. However, JSDMs typically do not accommodate imperfect detection (but

see Tobler et al. 2019; Hogg et al. 2021). Failure to account for imperfect detection when

modeling detection-nondetection data can lead to biases in both species distributions and the

eﬀects of environmental drivers on species occurrence (MacKenzie et al., 2002). Occupancy

models, a speciﬁc type of SDM, explicitly account for imperfect detection separately from the

true species occurrence process using replicated detection-nondetection data (MacKenzie et al.,

2002; Tyre et al., 2003). Multi-species occupancy models are an extension to single-species

occupancy models that use detection-nondetection data from multiple species by treating species

as random eﬀects arising from a common, community-level distribution (Dorazio and Royle,

2005; Gelfand et al., 2005). Unlike JSDMs, multi-species occupancy models do not estimate

residual co-occurrence associations between species (but see Tobler et al. 2019).

Accounting for spatial autocorrelation in SDMs is often necessary when modeling species

distributions across large spatial extents or a large number of observed locations (Latimer

et al., 2009). Spatially-explicit SDMs account for spatial autocorrelation by including spatially-

structured random eﬀects in a hierarchical framework (Banerjee et al., 2014; Shirota et al., 2019).

Such spatially-explicit approaches have been leveraged in a JSDM framework to simultaneously

account for residual species correlations and spatial autocorrelation (Thorson et al., 2015), and

in multi-species occupancy models that directly model imperfect detection (Doser et al., 2021).

Despite development of JSDMs, multi-species occupancy models, and their spatially-explicit

extensions, only recently have approaches emerged that incorporate species correlations and

3

imperfect detection in SDMs for large communities (Tobler et al., 2019; Hogg et al., 2021).

Further, these approaches can become computationally intensive as both the number of spatial

locations and species in the community increases, and no approaches exist that simultaneously

incorporate species correlations, imperfect detection, and spatial autocorrelation, despite the

well-recognized impacts of ignoring these complexities. Here we develop a joint species distri-

bution model that explicitly accounts for species correlations, imperfect detection, and spatial

autocorrelation. Our hierarchical model consists of an ecological process model and an observa-

tion sub-model. Analogous to Tikhonov et al. (2020), the ecological process model uses a spatial

factor model together with Nearest Neighbor Gaussian Processes (NNGP; Datta et al. 2016)

to ensure computational eﬃciency for large species assemblages (e.g., > 100 species) across a

large number of spatial locations (e.g., ∼105). We extend the model of Tikhonov et al. (2020)

by incorporating an observation sub-model that separately models imperfect detection from the

latent ecological process. We use simulations and a case study on 98 bird species across the con-

tinental U.S. to compare performance of our proposed model with ﬁve alternative models that

fail to address all three complexities. Our proposed modeling framework, and its user-friendly

implementation in the spOccupancy R package (Doser et al., 2021), provides a computation-

ally eﬃcient approach that explicitly accounts for imperfect detection to provide inference on

individual species distributions, species co-occurrence patterns, and overall biodiversity metrics.

Modeling Framework

Process Model

Let sj denote the spatial coordinates of site j, for all j = 1, . . . , J sites. Deﬁne zi(sj) as the

true latent presence (1) or absence (0) of species i at site j for i = 1, . . . , N species. We assume

zi(sj) arises from a Bernoulli distribution following

zi(sj) ∼ Bernoulli(ψi(sj)) ,

where ψi(sj) is the probability of occurrence for species i at site j. We model ψi(sj) as

logit(ψi(sj)) = (βi,1 + w∗

i (sj)) +

pψ
X

t=2

xt(sj)βi,t ,

4

(1)

(2)

where xt(sj), for each t = 2, . . . , pψ, is an environmental covariate at site j, βi,t is a regression

coeﬃcient corresponding to xt(sj) for species i, βi,1 is the species-speciﬁc intercept, and w∗

i (sj)

is a species-speciﬁc latent spatial process. While not shown in Equation 2, we can also include

unstructured random intercepts that may aﬀect species-speciﬁc occurrence probability. We

seek to jointly model the species-speciﬁc spatial processes to account for residual correlations

between species. For a small number of species (e.g., < 10), such a process can be estimated

via a linear model of coregionalization framework (Gelfand et al., 2004; Latimer et al., 2009;

Finley et al., 2009). However, when the number of species is even moderately large (e.g., >

10), estimating such a joint process becomes computationally intractable. A viable solution to

this problem is to use a spatial factor model (Hogan and Tchernis, 2004; Ren and Banerjee,

2013), a dimension reduction approach that can account for correlations among a large number

of species. Speciﬁcally, we decompose w∗

i (sj) into a linear combination of q latent variables (i.e.,

factors) and their associated species-speciﬁc coeﬃcients (i.e., factor loadings). In particular, we

have

w∗

i (sj) = λ>

i w(sj),

(3)

where λ>
i

is the ith row of factor loadings from an N × q loading matrix Λ, and w(sj) is a q × 1

vector of independent spatial factors at site j. We achieve computational improvements and

dimension reduction by setting q << N , where often a small number of factors (e.g., q = 5) is

suﬃcient (Taylor-Rodriguez et al., 2019; Zhang and Banerjee, 2021). We account for residual

species correlations via their individual responses (i.e., loadings) to the q latent spatial factors.

Given a single factor, if two species commonly occur together beyond that which is explained

by the covariates included in the model, the species-speciﬁc factor loadings will show positive

correlation, whereas if one species tends to occur at locations where the other is not present,

the species-speciﬁc factor loadings will show negative correlation. The residual inter-species

covariance matrix Σ = ΛΛ> has rank q << N and, hence, is singular. Shirota et al. (2019)

discuss its use and interpretation in detecting species clustering.

Following Taylor-Rodriguez et al. (2019) and Tikhonov et al. (2020), we model wr(sj) using

an NNGP (Datta et al., 2016) for each r = 1, . . . , q to achieve computational eﬃciency when

modeling a large number of spatial locations. More speciﬁcally, we have

wr(sj) ∼ N (0, ˜Cr(θr)),

(4)

5

where ˜Cr(θr) is the NNGP-derived covariance matrix for the rth spatial process. The vector θr

consists of parameters governing the spatial process according to a spatial correlation function

(Banerjee et al., 2014). For many correlation functions (e.g., exponential, spherical, Gaussian),

θr includes a spatial variance parameter, σ2

r , and a spatial range parameter, φr, while the

Matérn correlation function includes an additional spatial smoothness parameter, νr.

We assume all species-speciﬁc parameters (βi,t for all t = 1, . . . , pψ) arise from community-

level distributions to enable information sharing across species (Dorazio and Royle, 2005;

Gelfand et al., 2005). Speciﬁcally, we assign a normal prior with mean and variance hyper-

parameters that represent the community-level average and variance among species-speciﬁc

eﬀects across the community, respectively. For example, we model the non-spatial component

of the species-speciﬁc occurrence intercept, βi,1, following

βi,1 ∼ N (µβ1, τ 2

β1),

(5)

where µβ1 is the average intercept across the community, and τ 2
β1

is the variability in the species-

speciﬁc intercepts across the community.

Observation Model

To estimate ψi(sj) and zi(sj) while explicitly accounting for imperfect detection, we obtain

k = 1, . . . , Kj sampling replicates at each site j. Let yi,k(sj) denote the detection (1) or

nondetection (0) of species i during replicate k at site j. We model the observed data yi,k(sj)

conditional on the true species-speciﬁc occurrence zi(sj) at site j following

yi,k(sj) | zi(sj) ∼ Bernoulli(πi,k(sj)zi(sj)),

(6)

where πi,k(sj) is the probability of detecting species i at site j during replicate k given the

species is present at the site (i.e., zi(sj) = 1). We model πi,k(sj) as a function of site and/or

replicate-level covariates that may inﬂuence species-speciﬁc detection probability. Speciﬁcally,

we have

logit(πi,k(sj)) = αi,1 +

pπ
X

t=2

vt,k(sj)αi,t,

(7)

6

where vt,k(sj) is the value of covariate t at site j during replicate k, αi,t is a regression coeﬃcient

corresponding to vt,k(sj), and αi,1 is a species-speciﬁc intercept.

If applicable, we can also

include unstructured random intercepts in the model for species-speciﬁc detection probability.

Analogous to the species-speciﬁc occurrence eﬀects (Equation 5), we assume all species-speciﬁc

detection parameters (i.e., αi,t for all t = 1, . . . , pπ) arise from common community-level normal

distributions with community-level mean and variance hyperparameters.

Prior speciﬁcation and identiﬁability considerations

We assume normal priors for mean parameters and inverse-Gamma priors for variance param-

eters. Following Taylor-Rodriguez et al. (2019), we set all elements in the upper triangle of the

factor loadings matrix Λ equal to 0 and its diagonal elements equal to 1 to ensure identiﬁability

of the spatial factors. We additionally ﬁx the spatial variance parameters σ2

r of each latent

spatial process to 1. We assign standard normal priors for all lower triangular elements in Λ

and assign each spatial range parameter φr an independent uniform prior.

Model implementation and derived quantities

We implement the spatial factor multi-species occupancy model in a Bayesian framework in

the function sfMsPGOcc within our open-source spOccupancy R package (Doser et al., 2021).

We employ the computational algorithms discussed in Finley et al. (2019) and Finley et al.

(2020) to ensure spatially-explicit models are computationally feasible for data sets with a large

number of locations. The Bayesian framework allows us to easily calculate biodiversity metrics,

with fully propagated uncertainty, as derived quantities. For example, we can estimate species

richness of the entire community (or a subset of species in the community) by summing up the

latent occurrence state zi(sj) at each site j for all species of interest at each iteration to yield a

full posterior distribution for species richness. We leverage a Pólya-Gamma data augmentation

scheme (Polson et al., 2013) to yield an eﬃcient Gibbs sampler (see Appendix S2 for full details).

Candidate models

We compare the spatial factor multi-species occupancy model to ﬁve candidate models that

only address a subset of the three complexities (Table 1). We provide functionality for all

7

ﬁve candidate models in the spOccupancy R package, and subsequently refer to all models by

their spOccupancy function name (Table 1). Our ﬁrst candidate model is a non-spatial latent

factor JSDM (lfJSDM) that does not account for imperfect detection, analogous to standard

JSDM approaches (Wilkinson et al., 2019). Our second candidate model is a spatial factor

JSDM (sfJSDM) that does not account for imperfect detection, similar to the NNGP model

of Tikhonov et al. (2020). Our third model is the basic non-spatial multi-species occupancy

model (msPGOcc) that does not incorporate residual species correlations (Dorazio and Royle,

2005). Our fourth model is a spatial multi-species occupancy model (spMsPGOcc) that does

not incorporate residual species correlations and estimates a separate spatial process for each

species (Doser et al., 2021). Finally, our ﬁfth model is a non-spatial latent factor multi-species

occupancy model (lfMsPGOcc) that accounts for residual species correlations and imperfect

detection, analogous to the model of Tobler et al. (2019), except we use a logit formulation of

the model. See Appendices S1 and S2 for full model details.

Simulation Study

We used simulations to compare estimates from the spatial factor multi-species occupancy

model to estimates from the ﬁve candidate models (Table 1). We generated 100 detection-

nondetection data sets for each of six simulation scenarios, where the data were simulated

with diﬀerent combinations of the three complexities. We simulated data under situations

that roughly corresponded to the six candidate models to assess how each model performed

under “ideal” data conditions for that model, as well as when the data do not meet all the

assumptions of the modeling framework. More speciﬁcally, we generated data with (1) residual

species correlations and constant imperfect detection, (2) residual species correlations, constant

imperfect detection, and spatial autocorrelation, (3) imperfect detection only, (4) imperfect

detection and spatial autocorrelation, (5) residual species correlations and imperfect detection,

and (6) residual species correlations, imperfect detection, and spatial autocorrelation.

We simulated detection-nondetection data from N = 10 species at J = 225 sites with K = 3

replicates at each site for each of the 100 data sets for the six simulation scenarios. We used

an exponential correlation function for spatially-explicit data generation scenarios (Scenarios

2, 4, 6). For scenarios leveraging a factor model (Scenarios 1, 2, 5, 6), we generated the data

8

using q = 3 latent factors. We speciﬁed reasonable values for all parameters in the model

(see Appendix S1 for full simulation study details). For each data set in each scenario, we ran

three chains each of 15,000 samples, with a burn-in of 10,000 samples and a thinning rate of

5, resulting in a total of 3,000 MCMC samples for each of the six candidate models. We ﬁt all

models using the spOccupancy R package (Doser et al., 2021). We assessed performance of the

models by comparing the root mean squared error and 95% coverage rates for the species-speciﬁc

occurrence probabilities and the occurrence covariate eﬀect.

Case Study

We applied the spatial factor multi-species occupancy model to detection-nondetection data

from the North American Breeding Bird Survey (Pardieck et al., 2020) in 2018 on N = 98 bird

species at J = 2619 routes (i.e., sites) across the continental USA. The 98 species belong to two

distinct biogeographical communities following the deﬁnitions in Bateman et al. (2020), with 66

species in the eastern forest bird community and 32 species in the grassland bird community.

Our objectives for this case study were to (1) develop spatially-explicit maps of species richness

for the two communities across the continental USA; (2) determine if the latent spatial factors

(w) and the species-speciﬁc factor loadings (Λ) distinguish the two communities of birds; and

(3) assess the beneﬁts of accounting for species correlations, imperfect detection, and spatial

autocorrelation. At 50 points along each route (called “stops”), observers performed a three-

minute point count survey of all birds seen or heard within a 0.4km radius. We summarized

the data for each species at each site into K = 5 spatial replicates (each comprising data from

10 of the 50 stops), where each spatial replicate took value 1 if the species was detected at any

of the 10 stops in that replicate, and value 0 if the species was not detected.

Using the spatial factor multi-species occupancy model, we modeled route-level occurrence

of the 98 species as a function of local forest cover (linear) and elevation (linear and quadratic).

We modeled detection as a function of the day of survey (linear and quadratic), time of day

(linear), and a random observer eﬀect. We standardized all variables to have a mean of 0

and standard deviation of 1. We ﬁt the model using 15 nearest neighbors, an exponential

correlation function, and q = 5 latent spatial factors. We subsequently predicted occurrence for

the 98 species across the entire continental USA to generate spatially-explicit maps of species

9

richness, with associated uncertainty, for the two bird communities.

To determine if the spatial factor multi-species occupancy model provided beneﬁts for pre-

dicting species distributions and biodiversity metrics, we ﬁt four additional candidate models

(msPGOcc, lfMsPGOcc, lfJSDM, sfJSDM) and subsequently predicted richness across the conti-

nental USA using each model. We did not ﬁt the spatial multi-species occupancy model without

species interactions (spMsPGOcc) because it required estimating 98 separate spatial processes,

which was not computationally practical. For the models that do not explicitly model imperfect

detection (lfJSDM and sfJSDM), we collapsed the data with ﬁve replicates at each site into a

single binary value, which takes value 1 if the species was detected in any of the ﬁve replicates

and 0 if not. Additionally, because the detection covariates we include in our model only vary

by site and not by replicate, we included the detection covariates together with the occurrence

covariates in the two JSDMs without a distinct submodel, which is a common approach used to

account for sampling variability in models that do not explicitly account for imperfect detection

(Ovaskainen et al., 2017). We used the Widely Applicable Information Criterion (WAIC; Watan-

abe 2010) to compare the performance of the three occupancy models (msPGOcc, lfMsPGOcc,

and sfMsPGOcc) and the two JSDMs (lfJSDM and sfJSDM). However, since the two JSDMs use

a collapsed form of the data used in the occupancy models, we cannot directly compare all

ﬁve models using WAIC. Thus, we additionally ﬁt all models using 75% of the data points and

kept the remaining 25% of the data points for evaluation of model predictive performance. We

collapsed the ﬁve spatial replicates at each site in the hold-out data set into a single value of

1 if the species was detected and 0 if not. We then compared predictions from each model to

the collapsed data at the hold-out locations, and used the model deviance as a scoring rule of

predictive performance (Hooten and Hobbs, 2015), where lower values indicate better model

predictive performance. Additionally, we compared predictions of latent occurrence at the hold

out locations from each model to estimates of the latent occurrence state (zi(sj)) generated

from the three models that account for imperfect detection (msPGOcc, lfMsPGOcc, sfMsPGOcc)

using the complete data set (Zipkin et al., 2012). We then averaged across the three model

deviance scoring rules to generate a single measure of predictive performance for the latent

occurrence state. This allowed us to assess performance of the models in predicting the eco-

logical process of interest rather than the raw detection-nondetection values (which confounds

imperfect detection and true species occurrence) while accounting for model uncertainty (Doser

10

et al., 2022).

Results

Simulation study

Failing to account for residual species correlations had negative impacts on both the accuracy

and precision of model estimates (Tables 2, Appendix S1: Tables S1, S2). Estimates from

msPGOcc, which does not account for residual species correlations, had larger bias (Appendix

S1: Tables S1, S2), and low coverage rates (Table 2) for both latent occurrence and a covariate

eﬀect when data were simulated with residual correlations between species. spMsPGOcc, which

accounts for spatial autocorrelation but ignores species correlations, had less bias and better

coverage rates than msPGOcc in these scenarios, but still had higher bias and lower coverage

rates than models that did account for species correlations. This suggests that accounting for

spatial autocorrelation can mitigate some, but not all, of the negative impacts of incorrectly

assuming independence between species.

When data were simulated with imperfect detection that varied across sites and replicates,

ignoring imperfect detection resulted in higher bias and low coverage rates for both occurrence

probability and a covariate eﬀect (Table 2, Appendix S1: Tables S1, S2). However, when

detection was high and constant over sites and replicates (Scenarios 1 and 2), bias in lfJSDM

and sfJSDM was comparable to models that address imperfect detection and coverage rates were

closer to the expected 95%, in particular for the latent occurrence probability (Appendix S1:

Tables S1, S2). Notably, the increased bias and decreased coverage rates were less drastic for

estimating occurrence probability when failing to account for imperfect detection compared to

estimates from a standard multi-species occupancy model (msPGOcc) when ignoring residual

correlations and/or spatial autocorrelation when present. Alternatively, failing to account for

imperfect detection when present resulted in larger bias and smaller coverage rates in occurrence

covariate eﬀect estimates compared to a model that ignores residual correlations and/or spatial

autocorrelation when present.

Ignoring spatial autocorrelation had minimal impacts on average bias, but coverage rates

were substantially low for both latent occurrence and the covariate eﬀect (Table 2). Coverage

rates for msPGOcc were well below the expected 95% for latent occurrence and the covariate

11

eﬀect when data were simulated with spatial autocorrelation, while estimated coverage rates

from lfMsPGOcc for the covariate eﬀect were low but were near the expected 95% for the latent

occurrence probabilities. Coverage rates of the occurrence estimates from spatially-explicit

models were nearly 100% in scenarios where data were simulated without spatial autocorrelation

or residual species correlations (Table 2).

The spatial factor multi-species occupancy model (sfMsPGOcc) showed negligible diﬀerences

in both bias and coverage rates compared to spMsPGOcc when data were simulated with an

independent spatial process for each species (Scenario 4). Further, sfMsPGOcc performed better

in terms of bias and coverage rates compared to spMsPGOcc when data were generated with

species correlations and no spatial autocorrelation. Together with substantial decreases in

run time for sfMsPGOcc compared to spMsPGOcc, this suggests sfMsPGOcc is a more eﬃcient

alternative to address spatial autocorrelation in multi-species detection-nondetection data sets.

Case study

The spatial factor multi-species occupancy model predicted high species richness for the eastern

forest bird community across the eastern US and high species richness for the grassland bird

community in the Northern Great Plains region (Figure 1). Compared to the standard multi-

species occupancy model (msPGOcc), incorporating residual species correlations (lfMsPGOcc)

yielded a lower WAIC, while additionally accounting for spatial autocorrelation (sfMsPGOcc)

further reduced the WAIC, indicating that accounting for both residual species correlation and

spatial autocorrelation yield improved model performance (Table 3). Failing to account for

spatial autocorrelation led to unreasonable species richness estimates for the two communi-

ties across large portions of the US (Figure 2A-B). Additionally, the spatially-explicit JSDM

(sfJSDM) outperformed the non-spatial JSDM (lfJSDM) according to the WAIC.

Analogous to model comparison using WAIC, the two models that accounted for spatial

autocorrelation (sfJSDM and sfMsPGOcc) had the smallest out-of-sample model deviance, with

sfJSDM outperforming sfMsPGOcc when assessing performance based on the raw detection-

nondetection data. However, when estimating predictive performance using estimates of species

occurrence generated from three occupancy model ﬁts, sfMsPGOcc outperformed sfJSDM (Table

3), suggesting that accounting for imperfect detection provides improved predictive performance

of the latent ecological process of interest. Further, estimates of species richness from sfJSDM

12

were substantially lower across the US for both the eastern forest and grassland bird community

(Figure 2C-D) compared to estimates from sfMsPGOcc.

The spatial factor multi-species occupancy model clearly distinguished between the two bird

communities via the species-speciﬁc factor loadings and the latent spatial factors (Figure 3). In

particular, a map of the ﬁrst spatial factor across the US revealed high values in the eastern US

(Figure 3B). Accordingly, 96% of the mean species-speciﬁc factor loadings for the ﬁrst spatial

factor were greater than zero for the eastern forest bird community, compared to only 16% of

the factor loadings for the grassland bird community (Figure 3A), indicating the potential of the

spatial factor multi-species occupancy model to serve as a model-based ordination technique

(Hui et al., 2015). The second spatial factor showed high values in the Great Plains region

(Figure 3D), and to a lesser extent distinguished between the two communities, with 60% and

94% positive factor loadings for the eastern forest and grassland communities, respectively

(Figure 3C-D). The additional three factors further distinguished between subsets of species

within each community (Appendix S1: Figures S1-S3).

Discussion

Multi-species detection-nondetection data are often complicated by residual correlations among

species detections (Ovaskainen et al., 2010), imperfect detection of species (MacKenzie et al.,

2002; Tyre et al., 2003), and spatial autocorrelation (Latimer et al., 2009). While primarily

disjoint ﬁelds of statistical ecology have developed separate methods (e.g., JSDMs, occupancy

models) to address a subset of these complexities, there is a lack of computationally eﬃcient

models and software that simultaneously address all three complexities. Here, we developed

a spatial factor multi-species occupancy model that accounts for residual species correlations,

imperfect detection, and spatial autocorrelation. We showed using simulations that ignoring

these three complexities when present leads to inferior inference and predictions. Further,

the spatial factor multi-species occupancy model improved predictive performance compared to

models that failed to address the three complexities in an empirical case study of 98 bird species

across the continental US.

In our simulation study, failing to account for residual species correlations, imperfect detec-

tion, and/or spatial autocorrelation when present led to increased bias and low coverage rates.

13

We found that the standard multi-species occupancy model (msPGOcc) had high bias and low

coverage rates for both the latent occurrence and occurrence covariate eﬀects for all scenar-

ios except when data were simulated without species correlations and spatial autocorrelation

(Table 2, Appendix S1: Tables S1 and S2), clearly indicating the importance of accommo-

dating these data complexities if they exist. Similarly, estimates from JSDMs that failed to

account for imperfect detection resulted in increased bias and low coverage rates, although

these ﬁndings were less prominent under ideal scenarios of constant, high detection probability.

Interestingly, Table 2 suggests that if it is not possible to accommodate all three complexi-

ties (e.g., because of limited resources, small sample sizes) determining which complexities to

ignore will depend on the study objectives. For example, when data were simulated with im-

perfect detection and species correlations, coverage rates were better for lfJSDM than msPGOcc

for the occurrence probability estimates, but coverage rates from msPGOcc were better than

lfJSDM for the occurrence covariate eﬀect. This suggests that under these scenarios, lfJSDM

would be better for prediction, while msPGOcc would be better for inference. While our sim-

ulation study did not consider all potential complexities when comparing the performance of

occupancy models, these results do illustrate that speciﬁc data characteristics and research

questions will determine whether it is necessary to account for residual species correlations,

imperfect detection, and/or spatial autocorrelation. Our ﬁndings, as well as more in-depth sim-

ulation studies geared towards speciﬁc ecological scenarios, could have important implications

for designing detection-nondetection surveys to meet speciﬁc objectives. We include options to

ﬁt all six candidate models (Table 1) in the spOccupancy R package, as well as functions for

data simulation and model comparison to enable ecologists and conservation practitioners to

accommodate these three complexities using accessible and well-documented software. See Ap-

pendix S3 for a detailed vignette on ﬁtting these models in spOccupancy as well as the package

website (https://www.jeffdoser.com/files/spoccupancy-web/) for additional tutorials.

In the breeding bird case study, accounting for species correlations, imperfect detection,

and spatial autocorrelation in the spatial factor multi-species occupancy model resulted in

improved predictive performance compared to models that failed to address all three complex-

ities. Accounting for species correlations in lfMsPGOcc improved model ﬁt over the standard

multi-species occupancy model (msPGOcc) according to WAIC but did not improve predictive

performance for the out-of-sample deviance metric using the raw data (Table 3). This is likely

14

a result of treating the latent factors as independent standard normal random variables, which

results in predictions that are not able to leverage the estimated values of the latent variables

at nearby sampled locations to improve prediction at non-sampled locations (Hui et al., 2021).

Alternatively, the spatial factor multi-species occupancy model (sfMsPGOcc) had the smallest

WAIC and the best predictive performance for both deviance metrics among the three occu-

pancy models. Further, sfJSDM substantially outperformed lfJSDM according to all criteria.

These results demonstrate how assigning spatial structure to the latent factors in a model that

accounts for species correlations can yield large improvements in model predictive performance.

We thus recommend using sfMsPGOcc when there is a desire to account for species correlations

and the primary goal of the analysis is prediction.

The spatial factor multi-species occupancy model leverages a spatial factor dimension re-

duction approach (Hogan and Tchernis, 2004; Ren and Banerjee, 2013) and Nearest Neighbor

Gaussian Processes (Datta et al., 2016) to ensure computational eﬃciency when modeling data

sets with a large number of species (e.g., > 100) and/or spatial locations (e.g., 100,000). Our

proposed model requires speciﬁcation of the number of latent spatial factors (q) as well as the

number of neighbors to use in the NNGP. When choosing the number of nearest neighbors for

the NNGP, Datta et al. (2016) showed 15 neighbors is suﬃcient for most data sets, with as

few as ﬁve neighbors providing adequate performance for certain data sets. When choosing the

number of spatial factors, often using as few as 2-5 factors is suﬃcient, but for particularly large

communities (e.g., N = 600), a larger number of factors may be necessary to accurately repre-

sent variability among the species (Tobler et al., 2019; Tikhonov et al., 2020). Determining the

optimal number of factors for a given data set is not straightforward and will vary depending

on the characteristics of the speciﬁc community of species (e.g., species rarity, variability among

species). See Appendix S4 for recommendations and considerations for making this decision.

The latent spatial factors and the species-speciﬁc factor loadings can provide insight into

the additional ecological and environmental processes that govern distributions of species in the

modeled community. In our case study, the ﬁrst spatial factor revealed a spatial gradient likely

related to climate, with high values in the eastern US, while the second spatial factor was high-

est in prairie and grassland regions of the US (Figure 3). An assessment of the species-speciﬁc

factor loadings (i.e., coeﬃcients) of these factors showed the factors eﬀectively distinguished be-

tween the two biogeographical communities of birds included in our case study. This indicates

15

the potential of the spatial factor multi-species occupancy model to serve as a model-based ordi-

nation technique in which we could assess how species composition varies across environmental

gradients (Hui et al., 2015; Shirota et al., 2019). Alternatively, we can recover a full species-

to-species covariance matrix using the factor loadings matrix as ΛΛ>, which, while singular,

may be able to provide insight on the residual co-occurrence patterns between pairs of species

in the modeled community. This can be the result of missing environmental drivers, biological

interactions, and/or model mis-speciﬁcation. While the covariance matrix provides information

on which species tend to occur together, we caution against interpretation of these covariances

as true biological interactions, as co-occurrence does not imply an interaction (Poggiato et al.,

2021).

We found slow MCMC convergence and mixing of the species-speciﬁc factor loadings in the

spatial factor multi-species occupancy model for communities of species with a large number

of rare species. This is in large part due to weak identiﬁability of the factor loadings (λi(sj))

and spatial factors (w(sj)), as it is only their product (λi(sj)>w(sj)) that inﬂuences species-

speciﬁc occurrence probability. Further, the identiﬁability constraints placed on Λ requires

consideration of the ﬁrst q species in the detection-nondetection data array, as certain factor

loadings are ﬁxed for these species. See Appendices S3 and S4 for further discussion of these

challenges and how to address them when ﬁtting models in spOccupancy.

As both the number and size of multi-species detection-nondetection data sets increases,

we require computationally eﬃcient models and software to address common data complexities.

Our spatial factor multi-species occupancy model extends previous approaches (Tobler et al.,

2019; Tikhonov et al., 2020) to eﬃciently model species-speciﬁc and community-level occurrence

patterns while accounting for residual species correlations, imperfect detection, and spatial

autocorrelation. Our proposed framework, together with its user friendly implementation in the

spOccupancy R package (Doser et al., 2021), will enable ecologists to study spatial variation

in species occurrence and co-occurrence patterns, develop spatially-explicit maps of individual

species distributions and biodiversity metrics, and explicitly account for common complexities

in multi-species detection-nondetection data.

16

Acknowledgements

This work was supported by National Science Foundation (NSF) grants EF-1253225 and DMS-

1916395.

Open Research

The package spOccupancy is available on the Comprehensive R Archive Network (CRAN;

https://cran.r-project.org/web/packages/spOccupancy/index.html). Data and code used

in the manuscript are available on GitHub (https://github.com/doserjef/Doser_et_al_

2022) and will be posted on Zenodo upon acceptance.

References

Banerjee, S., Carlin, B. P., and Gelfand, A. E. (2014). Hierarchical modeling and analysis for

spatial data. CRC press.

Bateman, B. L., Wilsey, C., Taylor, L., Wu, J., LeBaron, G. S., and Langham, G. (2020). North

American birds require mitigation and adaptation to reduce vulnerability to climate change.

Conservation Science and Practice, 2(8):e242.

Datta, A., Banerjee, S., Finley, A. O., and Gelfand, A. E. (2016). Hierarchical nearest-neighbor

Gaussian process models for large geostatistical datasets. Journal of the American Statistical

Association, 111(514):800–812.

Devarajan, K., Morelli, T. L., and Tenan, S. (2020). Multi-species occupancy models: review,

roadmap, and recommendations. Ecography, 43(11):1612–1624.

Dorazio, R. M. and Royle, J. A. (2005). Estimating size and composition of biological commu-

nities by modeling the occurrence of species. Journal of the American Statistical Association,

100(470):389–398.

Doser, J. W., Finley, A. O., Kéry, M., and Zipkin, E. F. (2021). spOccupancy: An R package

for single species, multispecies, and integrated spatial occupancy models. arXiv preprint

arXiv:2111.12163.

17

Doser, J. W., Leuenberger, W., Sillett, T. S., Hallworth, M. T., and Zipkin, E. F. (2022).

Integrated community occupancy models: A framework to assess occurrence and biodiversity

dynamics using multiple data sources. Methods in Ecology and Evolution, 13(4):919–932.

Finley, A. O., Banerjee, S., and McRoberts, R. E. (2009). Hierarchical spatial models for

predicting tree species assemblages across large domains. The Annals of Applied Statistics,

3(3):1052 – 1079.

Finley, A. O., Datta, A., and Banerjee, S. (2020). spNNGP R package for nearest neighbor

Gaussian process models. arXiv preprint arXiv:2001.09111.

Finley, A. O., Datta, A., Cook, B. D., Morton, D. C., Andersen, H. E., and Banerjee, S.

(2019). Eﬃcient algorithms for Bayesian nearest neighbor Gaussian processes. Journal of

Computational and Graphical Statistics, 28(2):401–414.

Gelfand, A. E., Schmidt, A. M., Banerjee, S., and Sirmans, C. F. (2004). Nonstationary multi-

variate process modeling through spatially varying coregionalization. Test, 13(2):263–312.

Gelfand, A. E., Schmidt, A. M., Wu, S., Silander Jr, J. A., Latimer, A., and Rebelo, A. G.

(2005). Modelling species diversity through species level hierarchical modelling. Journal of

the Royal Statistical Society: Series C (Applied Statistics), 54(1):1–20.

Guisan, A. and Zimmermann, N. E. (2000). Predictive habitat distribution models in ecology.

Ecological Modelling, 135(2-3):147–186.

Hogan, J. W. and Tchernis, R. (2004). Bayesian factor analysis for spatially correlated data,

with application to summarizing area-level material deprivation from census data. Journal

of the American Statistical Association, 99(466):314–324.

Hogg, S. E., Wang, Y., and Stone, L. (2021). Eﬀectiveness of joint species distribution models

in the presence of imperfect detection. Methods in Ecology and Evolution, 12(8):1458–1474.

Hooten, M. B. and Hobbs, N. T. (2015). A guide to Bayesian model selection for ecologists.

Ecological Monographs, 85(1):3–28.

Hui, F. K., Hill, N. A., and Welsh, A. (2021). Assuming independence in spatial latent variable

models: Consequences and implications of misspeciﬁcation. Biometrics.

18

Hui, F. K., Taskinen, S., Pledger, S., Foster, S. D., and Warton, D. I. (2015). Model-based

approaches to unconstrained ordination. Methods in Ecology and Evolution, 6(4):399–411.

Latimer, A., Banerjee, S., Sang Jr, H., Mosher, E., and Silander Jr, J. (2009). Hierarchical

models facilitate spatial analysis of large data sets: a case study on invasive plant species in

the northeastern united states. Ecology letters, 12(2):144–154.

MacKenzie, D. I., Nichols, J. D., Lachman, G. B., Droege, S., Royle, J. A., and Langtimm,

C. A. (2002). Estimating site occupancy rates when detection probabilities are less than one.

Ecology, 83(8):2248–2255.

Ovaskainen, O., Hottola, J., and Siitonen, J. (2010). Modeling species co-occurrence by

multivariate logistic regression generates new hypotheses on fungal interactions. Ecology,

91(9):2514–2521.

Ovaskainen, O., Tikhonov, G., Norberg, A., Guillaume Blanchet, F., Duan, L., Dunson, D.,

Roslin, T., and Abrego, N. (2017). How to make more out of community data? A conceptual

framework and its implementation as models and software. Ecology Letters, 20(5):561–576.

Pardieck, K., Ziolkowski Jr, D., Lutmerding, M., Aponte, V., and Hudson, M.-A. (2020).

North American breeding bird survey dataset 1966–2019. U.S. Geological Survey data re-

lease, https://doi.org/10.5066/P9J6QUF6.

Poggiato, G., Münkemüller, T., Bystrova, D., Arbel, J., Clark, J. S., and Thuiller, W. (2021).

On the interpretations of joint modeling in community ecology. Trends in ecology & evolution,

36(5):391–401.

Polson, N. G., Scott, J. G., and Windle, J. (2013). Bayesian inference for logistic mod-

els using Pólya–Gamma latent variables. Journal of the American Statistical Association,

108(504):1339–1349.

Ren, Q. and Banerjee, S. (2013). Hierarchical factor models for large spatially misaligned data:

A low-rank predictive process approach. Biometrics, 69(1):19–30.

Shirota, S., Gelfand, A., and Banerjee, S. (2019). Spatial joint species distribution modeling

using dirichlet processes. Statistica Sinica, 29:1127–1154.

19

Taylor-Rodriguez, D., Finley, A. O., Datta, A., Babcock, C., Andersen, H.-E., Cook, B. D.,

Morton, D. C., and Banerjee, S. (2019). Spatial factor models for high-dimensional and large

spatial data: An application in forest variable mapping. Statistica Sinica, 29:1155.

Thorson, J. T., Scheuerell, M. D., Shelton, A. O., See, K. E., Skaug, H. J., and Kristensen,

K. (2015). Spatial factor analysis: a new tool for estimating joint species distributions and

correlations in species range. Methods in Ecology and Evolution, 6(6):627–637.

Tikhonov, G., Duan, L., Abrego, N., Newell, G., White, M., Dunson, D., and Ovaskainen,

O. (2020). Computationally eﬃcient joint species distribution modeling of big spatial data.

Ecology, 101(2):e02929.

Tobler, M. W., Kéry, M., Hui, F. K., Guillera-Arroita, G., Knaus, P., and Sattler, T. (2019).

Joint species distribution models with species correlations and imperfect detection. Ecology,

100(8):e02754.

Tyre, A. J., Tenhumberg, B., Field, S. A., Niejalke, D., Parris, K., and Possingham, H. P.

(2003). Improving precision and reducing bias in biological surveys: estimating false-negative

error rates. Ecological Applications, 13(6):1790–1801.

Watanabe, S. (2010). Asymptotic equivalence of Bayes cross validation and widely applicable

information criterion in singular learning theory. Journal of Machine Learning Research,

11(12).

Wilkinson, D. P., Golding, N., Guillera-Arroita, G., Tingley, R., and McCarthy, M. A. (2019).

A comparison of joint species distribution models for presence–absence data. Methods in

Ecology and Evolution, 10(2):198–211.

Zhang, L. and Banerjee, S. (2021). Spatial Factor Modeling: A Bayesian Matrix-Normal Ap-

proach for Misaligned Data. Biometrics.

Zipkin, E. F., Grant, E. H. C., and Fagan, W. F. (2012). Evaluating the predictive abilities of

community occupancy models using AUC while accounting for imperfect detection. Ecological

Applications, 22(7):1962–1972.

20

Tables

Table 1: Characteristics of the six candidate models used in the simulation study and
case study, as well as the function name for model implementation in the spOccupancy
R package (Doser et al., 2021).

spOccupancy
Function

lfJSDM
sfJSDM
msPGOcc
spMsPGOcc
lfMsPGOcc
sfMsPGOcc

Species

Imperfect
Correlations Autocorrelation Detection

Spatial

(cid:88)
(cid:88)

(cid:88)
(cid:88)

(cid:88)

(cid:88)

(cid:88)

(cid:88)
(cid:88)
(cid:88)
(cid:88)

21

Table 2: Estimated coverage rates of simulated species-speciﬁc occurrence probabilities
and covariate eﬀects for six diﬀerent simulation scenarios and six models of varying com-
plexity, as well as average run time. Coverage rates are deﬁned as the percentage of
species-speciﬁc occurrence probabilities (ψi(sj)) or covariate eﬀects contained within the
95% credible interval, averaged across the 10 species and 100 simulated data sets. Run
time is the number of minutes for the model to complete 15,000 MCMC iterations, aver-
aged across all six simulation scenarios and 100 simulated data sets.

Parameter Scenario

Model

lfJSDM sfJSDM msPGOcc spMsPGOcc lfMsPGOcc sfMsPGOcc

ψi(sj)

βi,1

Run time

1
2
3
4
5
6
1
2
3
4
5
6

93.5
93.9
97.4
83.5
86.1
86.4
89.5
72.5
48.3
46.7
47.2
45.8

1.18

93.1
93.8
97.1
81.0
85.3
85.3
91.5
89.8
58.8
65.1
53.3
63.2

2.36

28.2
29.5
94.7
36.8
33.9
34.6
70.1
59.9
94.7
73.7
73.2
63.4

2.31

79.8
90.2
99.9
91.7
80.8
89.0
87.2
86.7
96.6
91.3
89.0
84.1

5.16

95.1
95.4
99.9
93.3
95.2
95.5
94.8
76.5
90.5
84.7
95.5
79.4

2.62

94.8
95.6
99.9
92.3
94.7
95.6
96.2
93.4
93.8
94.6
96.1
92.4

3.90

22

Table 3: Out-of-sample model deviance and WAIC results for the ﬁve candidate models
used in the breeding bird case study. Boldface indicates the best performing model
according to the given criteria. Note that WAIC is only comparable within models that
do or do not account for imperfect detection. spMsPGOcc was not considered due to the
massive computation time required.

Deviance type

Model

Data
Latent

WAIC

lfJSDM sfJSDM msPGOcc lfMsPGOcc sfMsPGOcc

385
483

247
354

441
489

490
455

346
302

88,956

84,916

422,024

396,686

391,427

23

Figure Legends

Figure 1: Predicted mean species richness for the eastern forest bird community (A) and

the grassland bird community (C), as well as their associated standard deviations (B, D).

Figure 2: Diﬀerence in predicted mean richness from a spatial latent factor multispecies

occupancy model to two simpler candidate models. Panels (A) and (B) show diﬀerences with

the non-spatial latent factor multi-species occupancy model for the eastern forest and grassland

bird communities, respectively, while panels (C) and (D) show diﬀerences with the spatial factor

joint species distribution model.

Figure 3: Density of estimated mean species-speciﬁc factor loadings from a spatial

factor multi-species occupancy model for all species in the eastern forest and grassland bird

communities on the ﬁrst (A) and second (C) latent spatial process. Panels (B) and (D) show

the mean realizations of the ﬁrst and second spatial process, respectively.

24

Figures

Figure 1

25

25(cid:176)N30(cid:176)N35(cid:176)N40(cid:176)N45(cid:176)N120(cid:176)W110(cid:176)W100(cid:176)W 90(cid:176)W 80(cid:176)WLongitudeLatitude10203040(A) Eastern Forest Mean Richness25(cid:176)N30(cid:176)N35(cid:176)N40(cid:176)N45(cid:176)N120(cid:176)W110(cid:176)W100(cid:176)W 90(cid:176)W 80(cid:176)WLongitudeLatitude246(B) Eastern Forest SD Richness25(cid:176)N30(cid:176)N35(cid:176)N40(cid:176)N45(cid:176)N120(cid:176)W110(cid:176)W100(cid:176)W 90(cid:176)W 80(cid:176)WLongitudeLatitude51015(C) Grassland Mean Richness25(cid:176)N30(cid:176)N35(cid:176)N40(cid:176)N45(cid:176)N120(cid:176)W110(cid:176)W100(cid:176)W 90(cid:176)W 80(cid:176)WLongitudeLatitude123(D) Grassland SD RichnessFigure 2

26

25(cid:176)N30(cid:176)N35(cid:176)N40(cid:176)N45(cid:176)N120(cid:176)W110(cid:176)W100(cid:176)W 90(cid:176)W 80(cid:176)WLongitudeLatitude−40−20020(A) Eastern Forest sfMsPGOcc − lfMsPGOcc25(cid:176)N30(cid:176)N35(cid:176)N40(cid:176)N45(cid:176)N120(cid:176)W110(cid:176)W100(cid:176)W 90(cid:176)W 80(cid:176)WLongitudeLatitude−50510(B) Grassland sfMsPGOcc − lfMsPGOcc25(cid:176)N30(cid:176)N35(cid:176)N40(cid:176)N45(cid:176)N120(cid:176)W110(cid:176)W100(cid:176)W 90(cid:176)W 80(cid:176)WLongitudeLatitude0481216(C) Eastern Forest sfMsPGOcc − sfJSDM25(cid:176)N30(cid:176)N35(cid:176)N40(cid:176)N45(cid:176)N120(cid:176)W110(cid:176)W100(cid:176)W 90(cid:176)W 80(cid:176)WLongitudeLatitude01234(D) Grassland sfMsPGOcc − sfJSDMFigure 3

27

(A)(B)(C)(D)