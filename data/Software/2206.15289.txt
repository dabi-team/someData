Euphonic:inelasticneutronscatteringsimulationsfromforceconstantsandvisualisationtoolsforphononpropertiesRebeccaFaira,AdamJacksonb,DavidVoneshena,c,DominikJochymb,DucLea,KeithRefsona,andTobyPerringaaISISNeutronandMuonSource,STFCRutherfordAppletonLaboratory,HarwellCampus,Didcot,OxfordshireOX110QX,UKbScientiﬁcComputingDepartment,STFCRutherfordAppletonLaboratory,HarwellCampus,Didcot,OxfordshireOX110QX,UKcDepartmentofPhysics,RoyalHollowayUniversityofLondon,Egham,TW200EX,UK1arXiv:2206.15289v2  [cond-mat.mtrl-sci]  10 Aug 2022AbstractInterpretationofvibrationalinelasticneutronscatteringspectraofcomplexsystemsisfrequentlyreliantonaccompanyingsimulationsfromtheoreticalmodels.Abinitiocodescanroutinelygenerateforceconstants,butadditionalstepsarerequiredfordirectcomparisontoexperimentalspectra.Onmodernspectrometersthisisacomputationallyexpensivetaskduetothelargedatavolumescollected.Inaddition,workﬂowsarefrequentlycumbersomeasthesimulationsoftwareandexperimentaldataanalysissoftwareoftendonoteasilyinterfacetoeachother.Hereanewpackage,Euphonic,ispresented.Euphonicisarobust,easytouseandcomputationallyeﬃcienttooldesignedtobeintegratedintoexperimentalsoftwareandabletointerfacedirectlywiththeforceconstantmatrixoutputofabinitiocodes.1IntroductionThestudyofatomicvibrationsisofbothfundamentalandappliedinterestastheyhaveasigniﬁcantroleinmanymacroscopicmaterialproperties.Theycandrivephasetransitions[9],transportheat[52],governelasticproperties[7]andevenlimitthecoherenceofqubits[23].Forthisreasonsigniﬁcanteﬀorthasbeendevotedtounderstandingatomicvibrationsboththeoreticallyandexperimentally.Inelasticneutronscat-tering(INS)isaparticularlypowerfulexperimentaltechniqueasthemomentumandfrequencydependenceoftheatomicvibrationscanbestraightforwardlyandquantitativelyrelatedtotheexperimentalintensities,providingastringenttestoftheoreticalmodels.Theearliestexperimentswereperformedusingatriple-axisspectrometer(TAS)[8]andthisremainsawidelyappliedmethod.Initsconventionalformthisinstrumentdeﬁnestheincident(ﬁnal)neutronenergywithacrystalmonochromator(analyser)andasingledetectormeasuringatasinglepointinQ-ω(momentum-energy)space.Dispersioncurvesaremappedoutbymakingaseriesofmeasurementsasafunctionofenergytransferatﬁxedmomentum,orasafunctionofmomentumatﬁxedenergytransfer,whichcollectivelyrasteroveraQ-ωregionofinterest.Toimproveeﬃciency,additionalanalyser-detectorgroupsafterthesamplecanbeused[35],increasingdataratesbutalsoincreasingthevolumeandcomplexityofthedatatobemodelled.Alternatively,atime-structuredbeammaybeusedinconjunctionwithbeamlinecomponentsthatdeﬁnetheincidentneutronenergyorﬁnalneutronenergies,sothateachdetectorinanarraycanmapoutmanydiﬀerentenergytransfersω.Thesetime-of-ﬂight(TOF)instrumentshavebecomeincreasinglypopularespeciallywiththeadventofhighpower,pulsedspallationsources.Tomaximisetheireﬃciencytheseinstrumentshavedetectorarrayswhichcoverlargesolidanglesbrokenupintopixels.Forexample,LETatISIS[6]hasathreesteradiandetectorarraythatissplitinto98304pixels,ineachofwhichtheenergytransferrangeisresolvedinto∼300bins.Forsinglecrystalexperimentsthesamplemustberotated,commonlyin0.5◦–1◦stepsovera180◦range,leadingtothegenerationofamultidimensionaldatasetwhichconsistsof109–1010individualQ-ωpoints.Dataanalysisframeworkstohandleandinteractwiththeseobjectsexistandarewidelyused[17,46,3].Thecalculationofvibrationalpropertiesfromﬁrst-principlesorparameterisedatomisticlatticedynamicsiswellestablishedwithinthecomputationalchemistryandphysicscommunities.Astheequationsneededarestraightforward,manycodeshavebeenwrittentocomputeINSspectraforcomparisonbetweentheoryandexperiment.TheseincludeSimPhonies[4],OpenPhonon[38],Scatter[47]forGULP[22],Ab2tds[39],theCLIMAXseries[34,44,11]andPHONON[42]inadditiontoprivateandunreleasedcodes.RecentversionsofPhonopy[50]alsoincludefunctionsforcalculationofthedynamicalstructurefactor.Howevernoavailablesoftwaremeetsalloftherequirementsofatoolsuitableforexperimentalistsattime-of-ﬂightINSfacilities,lackingoneormoreofsomefunctionalitysuchasﬂexibleandcustomisablemodellingofinstrumentalresolution,thescalingofcomputationalperformancetoverylarge,high-resolutiondatasets,easeofuse,andavailabilityofmaintainedsourcecode.Theforce-constantsapproachoftheabove-mentionedcodesisrestrictedtosystemsandexcitationswelldescribedbytheharmonicapproximationoflatticedynamics.Anharmonicphenomenaincludingfrequencyshiftsofasymmetricbondvibrationsandovertones,broadening,dynamicallystabilizedandhigh-temperature2structuralphasesandnuclearquantumdynamicsarepoorlydescribedornotincludedatall.Insomecasesitisfeasibletostillcomputestableharmonicphononsusingvolumeortemperaturedependenteﬀectivepotentials[31].Computationalapproachestostronganharmonicityarenotaswellestablishedorwidespread,butonewhichmeritsmentioninthecontextofINSspectraisbasedonanalysisofdynamicalcorrelationfunctionscomputedusingmoleculardynamicssimulations.ThesoftwarepackagesofnMoldyn[48],MDANSE[28],Dynasor[21]andLiquidLib[51]allperformthecalculationofdynamicalstructurefactorfrommoleculardynamicstrajectorydata.HerewepresentEuphonic[20],asoftwarepackagetocalculateinelasticneutronscatteringintensitiesintheharmonicapproximationusingforceconstantsobtainedfromabinitiocalculations.ItiswritteninPython,foreaseofintegrationwithothersoftwareandexperimentalworkﬂows.Thisallows,forexample,ittobeusedtosimulateanypartofatime-of-ﬂightQ-ωdatasetwithinstrumentalresolutionconvolutionviathedataanalysispackageHorace[17].GiventhepotentialsizeoftheQ-ωtime-of-ﬂightdatasetsdescribedabove,EuphonichasafocusoncomputationalperformanceandusesanextensionwritteninCandOpenMPtohandlethemostdemandingsteps.Euphonicisnotstronglycoupledtoanyparticularatomisticcode;currently,forceconstantscanbereadfromCASTEP[13],whichinternallyimplementsseveralschemesforphononcalculations,andPhonopy[50],whichmanagesﬁnite-displacementcalculationswithanyofelevenforcecalculators.InadditiontosimulatinglargeQ-ωtime-of-ﬂightdatasets,itisintendedasageneral-purposetoolforanalysisofphononsimulations.Command-lineprogramsareincludedforquickcalculationandplottingofphononbandstructure,densityofstates(DOS)andtheneutrondynamicalstructurefactor,whilethePythonAPIallowsEuphonictobeusedasamoreﬂexiblelibraryforoptimisedphononfrequencyandeigenvectorcalculationsandrelatedquantities.Inthispaperwewilldescribe:thebasictheorybehindEuphonic;thesoftwarestructure,itsmainfeatures,andhowitinteractswithothersoftware;showhowitsperformanceandresultscomparetosimilarexistingsoftwaretoolsand,ﬁnally,compareEuphonictoexperimentaldatasetsforbothsinglecrystalsandpowders.1.1AvailabilityEuphonichasbeendevelopedfollowingsoftwaredevelopmentbestpractice:continuousintegrationprocessestestthefunctionalityandvalidatenumericalresultsasfeaturesareadded,andthePythonAPIhasbeenexplicitlydesignedtomakeiteasytouseEuphonicwithotherprojects.Euphonicisopen-sourceundertheGNUGeneralPublicLicensev3–thesourcecodeisisfreelyavailableonGithub,andpackagesaredistributedbyPyPIandConda-forgeforthepipandcondapackagemanagers.Linkstothesourcecodeandonlinedocumentation,includinginstallationinstructionsandhowtouseEuphonic,areavailablefromtheDOIlandingpagehttps://doi.org/10.5286/SOFTWARE/EUPHONIC[20].1.2ValidationdatasetsThroughoutthispaperavarietyofsimulatedandexperimentaldatasetswillbeusedtocompareEuphonicoutputstobothothersoftwaretoolsandexperimentaldata.ThechosenmaterialsareNb,Al,Si,quartzandLa2Zr2O7,andwillbedescribedandusedineachsectionasappropriate.Thesedatasetshavebeenchosentogiveavarietyofunitcellsizesandcrystalsymmetries,andincludebothpolar(quartz)andnon-polarmaterials.SimulatedforceconstantshavebeenproducedwitheitherCASTEPorVASP[36]plusPhonopyinordertothoroughlytestthefeaturesofEuphonic.Detailsoftheforceconstantcalculationsforeachmaterialandwheretoobtaintheresultsofthesimulationsandtheneutronexperimentaldatacanbefoundinthesupplementarymaterial.2Theory2.1HarmoniclatticedynamicsVibrationalexcitations—phonons—incrystallinematerialsaredescribedwithinthetheoryoflatticedynamics[14].Displacementofasingleatominaninﬁniteperiodiccrystalgivesrisetoforcesoneveryother3atominthecrystal,whichintheharmonicapproximationarelinearlyrelatedtothedisplacementbytheforceconstantmatrixΦκκ0αα0(0,l)=∂2E∂uκα0∂uκ0α0l(1)whereΦistheforceconstantmatrix,theunitcellcontainingthedisplacedatomislabelled0,lrunsoverunitcellsinthecrystal,κrunsoveratomsintheunitcell,αrunsovertheCartesiandirections,uκαlisthedisplacementofatomκincelllindirectionαfromitsequilibriumposition,andEisthetotallatticeenergy.Theseforceconstantsdecayrapidlywithdistanceaccordingtoapower-law|R|−nwheren=5−7innon-polarcrystals.ThisallowsforatruncationofΦ(0,l)atsomeradiusRcbeyondwhichtheresidualforceconstantsmaybeneglected.Rc≈8−10˚Aissuﬃcientforalmostallpracticalcases.Substitutingaplane-wavesolutionintotheequationofmotionyieldsaneigenvalueequationXκ0α0Dκκ0αα0(q)eqνκ0α0=ω2qνeqνκα(2)whereDκκ0αα0(q)isthedynamicalmatrixatwavevectorq,theeigenvaluesω2qνarethesquareofthephononfrequenciesofmodeνatq,andtheeigenvectorseqνκarethephononpolarisationvectorsatqofmodeνforatomκ.Thedynamicalmatrixcanbecalculatedasthemass-weightedFouriertransformoftheforceconstantmatrixDκκ0αα0(q)=1√MκMκ0XlΦκκ0αα0exp(−iq·Rl)(3)whereMκisthemassofatomκ,Rlisthevectorfromtheorigintothelthunitcell,andlincludesunitcellswith|Rl|<Rc.2.1.1DeconvolutionofperiodicrepresentationofΦThoughtheforceconstantmatrix,Φ(0,l),isaﬁnitematrixitdoesnotmapdirectlyontoamodellingframeworkwithsupercellperiodicboundaryconditionsasusedinalmostallabinitiolatticedynamicsimplementations.InsteadtheseyieldaconvolutionofΦ(0,l)withthelatticeofasuitablesupercell.IdeallythiswouldbechosensothemagnitudeofΦ(0,l)fallstoanegligiblevalueinhalfthesupercell’slineardimensiontoavoidoverlaperror.Theforceconstantsmayeitherbedirectlycomputedusingthesupercellastheabinitiosimulationcell,(the“directmethod”),[1]orimplicitlyusingFourierinterpolationeitherofdensity-functionalperturbationtheory[5]orﬁnitedisplacements[1].ThereforeEuphonicmustdeconvolveaperiodicdatasettorecovertheaperiodicforceconstantmatrix,Φ(0,l).Foraverylargesupercellthesupercell-periodicimagesofΦ(0,l)truncatedatsomeradiusRcdonotoverlapatallandtheextractionisastraightforwardmappingofthedatavalues.Howeverinpracticalabinitiocalculationsthesupercellsizesarelimitedbycomputationalresources,andthereisalwaysasmallresidualoverlapbetweenperiodicimagesofΦ(0,l).Euphonicadoptsthe“Cumulantimage”approach[41],combiningthedeconvolutionwiththeFouriertransformtocomputethedynamicalmatrixinaformulationwhichrespectspointgroupsymmetry.2.1.2AcousticsumruleTheinvarianceofthetotalenergyupondisplacementoftheentirecrystalinspaceimposesaconditionknownastheacousticsumrulewhichguaranteesthepresenceoftheusualthreeacousticmodeswithzerofrequencyatq=0andlineardispersionnearby.ThesumruleappliestotheforceconstantmatrixortheΓ-pointdynamicalmatrixXκlΦκκ0αα0(0,l)=0(4a)XκDκκ0αα0(0)=0(4b)4whereκrunsovertheNatomsintheunitcellandlovertheNcellunitcellsinthesupercell.Thezerosdependonanexactcancellationofanentirerowofthedynamicalorforceconstantmatrices,whoseelementsarelargeandofoppositesign.Inthepresenceofnumericalconvergenceerrorsandsymmetrybreakingbytypicalabinitiocomputationalgridsthesumruleisnotexactlysatisﬁed,leadingtonon-zeroacousticmodesatq=0andnonlineardispersionofacousticmodesnearby.Euphonicoptionallyappliesacorrectionusingprojectionmethodsontothepuretranslationmodestorestorenear-exactsatisfactionofthesumrule.Twoalternativeadjustmentsareimplemented;eithertothedynamicalmatrices(thereciprocal-spacemethod)ortotheperiodicrepresentationoftheforce-constantmatrix(thereal-spacemethod).IfEquation4bisimperfectlysatisﬁed,thedynamicalmatrixD(droppingindicesforclarity)hasthreenear-zeroeigenvaluescorrespondingtotheacousticmodes.AcorrectionisappliedDcorr(q)=D(q)−ΨΩacousticΨ−1(5)whereΨisthematrixofeigenvectorsofD(q=0),ΩacousticisamatrixwhosediagonalentriesaretheeigenvaluesofD(q=0)fortheacousticmodesandzerootherwise.AsperGonzeandLee[25],thecorrectionatq=0isalsoappliedatnon-zeroq.Thealternativereal-spacecorrectionissimilarlyformulated,butappliedtotheforceconstantmatrixΦcorr=Φ−ΠΘacousticΠ−1(6)whereΦ,ΠandΘacousticareall3NNcell×3NNcellmatrices.Φisthematrixofforceconstants,ΠisthematrixofeigenvectorsofΦ,andΘacousticisamatrixwhosediagonalentriesaretheeigenvaluesofΦfortheacousticmodes,andzerootherwise.Thismethodmorefaithfullyrestoresthelinearityoftheacousticbranchesnearq=0aswellastheΓ-pointlimit.2.1.3PolarcrystalsFornon-polarcrystals,thedecayofforceconstantswithdistancebyahighinversepowerlawof5–7meansthatacutoﬀradiusof8–10˚Aisusuallysuﬃcienttocontainthenon-negligibleelementsoftheforceconstantmatrix.Theresultingsupercellof16–20˚AineachdimensioniswellwithinthetypicalcomputationalcapabilityofabinitioDFTmethods.(Typicallythesewouldbewithinthelocal-densityapproximationorgeneralised-gradientapproximation,buthybridfunctionalshavebecomemoreaccessibleevenforasystemsuchasLa2Zr2O7[12].)However,inthecaseofionicorpolarcrystalstheCoulombinteractionsaddatailthatdecaysasR−3,whichprecludesaconvergedcalculationinacomputationallypracticalsupercell.Thislong-rangetailisresponsibleforthephenomenonofsplittingofthelongitudinalopticalandtransverseopticalmodes(LO/TOsplitting)andunwarrantedtruncationwillleadtounphysicalbehaviourofLOmodesattheorigin.Fortunatelythistermmaybecomputedanalyticallyandsubtractedfromtheforceconstantmatrixleavingtheremainderterm,whichcanberepresentedwithinafeasiblysizedsupercell[26].ThisistheapproachadoptedbyCASTEP,Phonopyandseveralothercodes,whichoutputonlytheshort-rangedpartoftheforceconstantmatrix.Euphoniccomputesthedipole-dipolecorrectiontermof[26]usingtheBorneﬀectivechargesanddielectricpermittivitytoreconstructthefullforceconstantmatrix.2.2CoherentinelasticneutronscatteringThecoherentone-phononscatteringstructurefactorscanbecalculatedatmomentumtransferQofscatteredneutrons[15,49]|F(Q,ν)|2=(cid:12)(cid:12)(cid:12)(cid:12)(cid:12)XκbκM1/2κω1/2qν(Q·eqνκ)exp(iQ·rκ)exp(−Wκ)(cid:12)(cid:12)(cid:12)(cid:12)(cid:12)2(7)whereqisthereducedwavevectorintheﬁrstBrillouinzone(i.e.Q=q+τwhereτisareciprocallatticevector),bκisthecoherentneutronscatteringlengthofatomκ,rκisthevectorfromtheorigintoatomκwithintheunitcell,Mκisthemassofatomκ,eqνκisthephononpolarisationvectoratqofmodeνforatom5κandωqνisthephononfrequencyofmodeνatq.Thetermexp(−Wκ)istheanisotropicDebye–Wallerfactorforatomκ,wheretheexponentscanbewrittenWκ=XαβWαβκQαQβ(8)Wαβκ=¯h4MκNq0Xq0ν0∈BZeq0ν0καe∗q0ν0κβωq0ν0coth(cid:18)¯hωq0ν02kBT(cid:19)(9)wherethesumisoverwavevectorsandmodesintheﬁrstBrillouinZone(BZ),Nq0isthenumberofq-pointsinthesum,Tisthetemperature,αandβrunovertheCartesiandirections,¯histhereducedPlanckconstantandkBistheBoltzmannconstant.TheDebye–Wallerfactorhasbeenwritteninthisformtomakeitexplicitthattheexpensivecomputationofthesetof3×3matricesWαβκneedonlybeperformedonceoveranappropriatelyﬁnegridintheﬁrstBrillouinZone,leavingcomputationoftheDebye–WallerfactorforanarbitraryQasthefastevaluationofaquadraticformforeachatom,Eq.(8).Fromtheone-phononstructurefactorstheneutrondynamicalstructurefactorS(Q,ω)canbecalculatedS(Q,ω)=12Xν|F(Q,ν)|2(nqν+12±12)δ(ω∓ωqν)(10)wheretheupperandlowersignsrefertophononcreationandannihilationrespectivelyandnqνistheBosepopulationfunctionnqν=1exp(cid:16)¯hωqνkBT(cid:17)−1(11)Finally,theneutronscatteringcross-sectionperunitcellintermofS(Q,ω)isd2σdΩdEf=kfkiS(Q,ω)(12)wherekiandkfaretheincidentandscatteredneutronwavevectors.3ImplementationEuphonicprovidesanextensivePythonAPIandanumberofconvenientcommandlinetools.Fig.1showshowEuphonicconnectswithexistingpackagesintheneutronsoftwareecosystem.EstablishedsoftwaresuchasHorace[17]andtheMantid[3]plug-inAbINS[16]makedirectuseofEuphonicasacalculatorforsimulatedphononsandscatteringintensities.Thecommandlinetoolsprovideconvenientplottingofphononbandstructures,DOSandtheneutrondynamicalstructurefactoralongspeciﬁcreciprocallatticedirections(seeSection6.1).EuphoniccanalsobeuseddirectlyfromPythonenvironmentsforcustomisedplots,workﬂowsorfunctionalitydevelopment.3.1ContextandAPIInatypicalHoraceworkﬂow,thescatteringintensitiesatmillionsofQ-pointscanbecombinedtoproducemultidimensionalplotsofmeasureddata.PriortotheavailabilityofEuphonic,theworkﬂowforgeneratingsuchplotswaslimitedbytheneedtoreadpre-computedphononfrequenciesandeigenvectorsfromﬁlesproducedbyotherprograms.Thebottleneckherebecomestheactivityofreadingandwritingtodisk.ForasystemofNatomsperunitcell,eachQ-pointhasasetofeigenvectorswhosestoragerequirementsof18N2ﬂoating-pointnumberscanbecomeimpracticallylarge.Forexample,a22-atomunitcellwithamodest25,000Q-pointswouldequatetoa5GBtextﬁleinCASTEP.phononformat.InatypicalclusterenvironmentrunningtheCASTEPphononstool,morethan85%ofruntimeisspentwritingthisﬁleto6disk(seeTable1forspeciﬁcN2timingexamples).Furthermore,onasharedclusterresourcethiscanbeexacerbatedbylocalnetworkcapacityandtheactivitiesofotherusers.TherequirementofeﬃciencyforEuphonichasdriventhedecisiontoimplementFourierinterpolationofphononfrequenciesandeigenvectorsdirectlyfromforceconstants.ThisallowsforcalculationofdataforeachQ-pointondemand,removinganyneedforﬁle-baseddatatransferfromothercodes.Accordingly,therepresentationofforceconstantsasaclassandassociatedmethodsformsthecoreoftheEuphonicAPI,illustratedinFig.2anddescribedforreferencebelow.ForceConstantsobjectscanbeinstantiatedfromPythondataobjectssuchasNumpy[30]arrays,butwouldtypicallybecreatedfromthedataoutputsofanexternalmodellingcode–currentlyCASTEP.castepbinoutputandPhonopyphonopy.yaml,FORCECONSTANTSandforceconstants.hdf5outputaresupported.ThroughPhonopy,Euphonicforceconstantscanbeobtainedusingawidevarietyofatom-isticcodessuchasVASP[36],Abinit[27]andQuantumEspresso[24],makingEuphonicaccessibletoalargeportionofthematerialsmodellingcommunity.Fromtheforceconstants,phononfrequenciesandeigenvectorsmaybecalculatedatarbitraryQ-pointsusingthemethodsdescribedinSection2.1.QpointPhononModesrepresentsphononmodedata:theQ-points,phononfrequenciesandeigenvectors.QpointPhononModescanalsobeinstantiatedfromexternaldataﬁles(currently,theseareCASTEP.phononandPhonopymesh/band/qpointsﬁles).ThePintPythonlibrary[29]isextensivelyusedinEuphonictorepresentdimensioneddataasaQuantitywithbothamagnitudeandaunit.Thismakestheunitsexplicit,andfacilitatesconversiontotheenduser’spreferredunits,usuallyoneofmeV,cm−1orTHz,inthecaseofphononfrequencies.NoparticularQ-pointsamplingisenforced;while,forexample,aMonkhorst–PackmeshisrecommendedfortraditionalDOSplotting,phononmodescanalsobecalculatedalongahigh-symmetrypathorsampledatrandompointsdependingontheusecase.Fromthephononmodes,Euphoniccancomputequantitiessuchasthemode-resolvedstructurefactors,theDebye–Wallerexponentandtotal,partialandneutron-weightedDOS.StructureFactorisderivedfromthephononmodes.ThisobjectcontainstheneutronstructurefactorsresolvedbyQ-pointandphononmodeindex(ν)andalsotheQ-pointsandfrequencies.Thiscanbebinnedinenergytoproduceatwo-dimensional(2D)S(Q,ω)plot,oraveragedoverthecontainedQ-pointstoproduceaone-dimensional(1D)S(ω)spectrum.DebyeWallerrepresentsthetemperaturedependentDebye–Wallerfactor;speciﬁcally,itcontainsthesetof3×3matrices,oneperatom,WαβκdeﬁnedinEq.(9).ADebyeWallerobjectistypicallypre-computedoverauniformQ-pointmeshandthenappliedduringastructurefactorcalculationtoperformthefastcalculationoftheatomicDebye–WallerexponentWκviaEq.(8)overwhichever(potentiallylarge)setofQ-pointsareappropriatetothetaskathand.Spectrum2D,Spectrum1DandSpectrum1DCollectionareclassesrepresentinggenericspectrumobjectsthatcanbeusedforvariouspurposes,suchasrepresentingtheDOSwithSpectrum1D,oraS(Q,ω)orS(|Q|,ω)intensitymapwithSpectrum2D.BandstructureandpartialDOSdataarerepresentedwithSpectrum1DCollection,whichensuresconsistentbinsareusedandallowsindividuallinestobetaggedwithmetadata.Theplottingtoolsinturnworkwiththegenericspectrumobjectstoproduceplotsofphononbandstructure,DOS,andintensitymaps.Crystalisasimpleclasscontainingthecrystalstructureinformation:thecellvectors,atompositions,speciesandmasses.TheaboveForceConstants,QpointPhononModes,StructureFactorandDebyeWallerclassesallcontainaninstanceofthiscrystalclassasanattribute,toensurethedataineachclassremainscompleteandunambiguous.3.2UsewithHoraceAwidelyusedsoftwareapplicationforanalysisandvisualisationofmultidimensionaltime-of-ﬂightinelasticneutronscatteringdatafromsinglecrystalexperimentsisHorace[17].Inadditiontohandlingandplottingthedata,italsoallowssimulationandﬁttingofthesedatasetswithuser-createdmodelsofthescatteringfunction.AMatlabadd-onhasbeendeveloped,Horace-Euphonic-Interface[19]whichprovidesinterfacefunctionsthatallowEuphonictobeusedtosimulatedatasetsdirectlyinHorace.ThewaythisworksisillustratedinFig.1.FirstausersetsupamodelwithHorace-Euphonic-Interface,givingthepathtothe7forceconstantsﬁleorfolder,andaddingotheroptionalparameterssuchasthesampletemperatureortheDebye–Wallergridsize.TheuserthencallsaHoracesimulationfunctionwiththedatasettobesimulatedandthemodeltheyhavejustcreated.HoracewillautomaticallyprovidetheQ-pointstobesimulatedtoHorace-Euphonic-Interface,whichthencallsEuphonictocalculatethestructurefactorsandphononfrequenciesatthoseQ-points.Horace-Euphonic-InterfacethenconvertstheoutputfromEuphonicintotherequiredformforHoracetocreatethesimulateddataset.Thisisasigniﬁcantimprovementoverpreviousworkﬂowstosimulatescatteringfromphonons,whichrequireduserstoprogramtheirownfunctionstocalculatethestructurefactorsfromabinitiocalculations.ThesewouldnotusuallyincludeFourierinterpolationoftheforceconstants,andhencewererestrictedtotheQ-pointsoutputbytheabinitiocalculations.Thesebespokescriptswerealsonottypicallyoptimisedforfastcomputation.Horace-Euphonic-Interfacehasalloweduserstoeasilysimulateonexactlythesameaxesandinthesamesoftwareastheexperimentaldata,makingﬁttingofscalingfactorsandquantitativecomparisonsmuchmoreconvenient.TheperformanceofEuphonichasalsomadeapplicationoftheMonteCarlobasedinstrumentalresolutionconvolutionmethod[43]availableinHoracetractablewithphononsfortheﬁrsttime.ExamplesofdatasimulatedandﬁttedwithEuphonicandHoraceareshowninSection6.3.Horace-Euphonic-InterfaceisopensourceanddistributedasaMatlabToolboxﬁleonGithubandtheMatlabFileExchange.LinkstothesourcecodeandonlinedocumentationareavailablefromtheDOIlandingpagehttps://doi.org/10.5286/SOFTWARE/HORACEEUPHONICINTERFACE[19].3.3UsewithAbINSAbINSisacodewhichsimulatespowder-averagedINSspectrainananalyticincoherentapproximation,andresidesintheMantidframeworkusedforexperimentaldatareductionandanalysis[16,3,2].AbINShasrecentlybeenupdatedtomakeuseofEuphonic;asofMantidversion6.3,itispossibletoselectforceconstantsdatainCASTEPorPhonopyformatasaninputﬁle.EndusersdonotneedtoknowanythingaboutEuphonicorchangetheirworkﬂow,excepttoensurethatforceconstantsdataispresentintheir.castepbinorphonopy.yamlﬁles.Asingle-parametercutoﬀdistance(asdeﬁnedbyMorenoandSoler[40],andhiddenfromtheuserinterface)isusedtodetermineadefaultMonkhorst–Packmeshforthegivencrystalstructure;eigenvaluesandeigenvectorsarecomputedusingtheEuphonicPythonAPIandpassedontotheusualincoherentinelasticscatteringcomputation[16].AbINSandHoracehavediﬀerenttargetusers:withEuphonicasacommondependency,itbecomespossiblefortheseneutron-scatteringsimulationcodestodevelopoverlappingfeaturesetswhilesharingimplementationwork.4PerformanceproﬁlingandoptimisationGiventheaimofcalculatingscatteringintensitiesatmillionsofQ-points,performanceoptimisationofEuphonichasbeenapriority.Table1illustratesthepotentialcostofwritinglargeeigenvectorarraystodisk,whichhasbeenavoidedinEuphonicbyenablingitsowninterpolationfromforceconstants.Therearefourmainstepsincomputingtheneutrondynamicalstructurefactorfromforceconstants:readingtheforceconstants,computingthephononfrequenciesandeigenvectors(interpolation),computingthemode-resolvedstructurefactorsand,ﬁnally,applyingtheBosefactorandbinningtheseinenergytoobtainS(Q,ω).Readingtheforceconstantsonlyhastobedoneonce,andthebinningforlargedatasetsistypicallydoneviaanotherprogramsuchasHorace.Ofthetworemainingparts,thecalculationofphononfrequenciesandeigenvectorsisbyfarthemostexpensive,illustratedinTable2.EveninthecaseofLa2Zr2O7,whichhasthemostexpensivestructurefactorcalculationduetothenumberofatomsintheunitcell,theinterpolationtakesapproximately20timeslonger.Forthisreason,thispartofthecalculationhasbeenthefocusofmuchoftheoptimisationeﬀort,andperformancecomparisonshavebeenmadewithanotherinterpolationtool,theCASTEPphononstool,ratherthansoftwarethatperformsthecheaperstructurefactorcalculationssuchasAb2tds[39]orOClimax[11,10].ThePhonopysoftwaredoesperformphononinterpolation,buthasnotbeenchosenforperformancecomparisonsasitdoesnot(asofversion2.11.0)paralleliseitscalculationoverQ-points.8EuphonicmakesextensiveuseofNumpytoimproveitsperformance,buttheserialPythonperformanceshowninTable2isstillnotsuﬃcienttosimulatethenumbersofQ-pointscontainedinlargermultidimen-sionalQ-ωdatasetsinareasonabletime.Accordingly,anextensionhasbeenwritteninCandOpenMPtoperformtheinterpolationpartofthecalculation,whichbothimprovesperformancesigniﬁcantlyandenablescalculationstobecarriedoutinparallel.TheperformanceimprovementcanbeseeninFig.3,whichshowsthetimetakentorunthecalculateqpointphononmodesinterpolationfunctioninEuphonicfor25,000Q-pointsfordiﬀerentmaterials,forboththeserialPythonandparallelCimplementations.Onemetricforcomparingperformanceisthespeedupcalculatedastheratioofthetimestoperformthesameoperationinthetwoimplementations:S=T1T2(13)Foroneprocessor,useoftheCextensiongivesspeedupsof2.1,4.0and6.0overthepurePythonimplementa-tionforLa2Zr2O7,quartzandNbrespectively.Fig.3alsoshowshowthewalltimechangeswithincreasingnumbersofprocessorsandcomparesitwiththetimetakentorunthephononcalculatefunctionfromtheCASTEPphononstool.Carehasbeentakentogetafaircomparison,soCASTEPfeaturesthatarenotavailableinEuphonicwhichwouldhavedecreasedtheperformanceofCASTEPhavebeenswitchedoﬀ(grouptheoryanalysis,dynamicalmatrixsymmetrisation)andfeaturesthatcouldnotbeturnedoﬀhavebeenproﬁledandsubtractedfromthetotaltime(writingthe.phononﬁle,constructingtheforceconstantmatrix).Evenwiththistakenintoaccount,theperformanceofEuphonicisbetterthantheCASTEPphononstoolbyanorderofmagnitudeinsomecases,withEuphonicgivingspeedupsof13.1,2.7and20.9overtheCASTEPtoolforLa2Zr2O7,quartzandNbrespectivelyfor24processors.ItcanbeseeninFig.3thatinterpolationforquartzisslowerthanLa2Zr2O7,despitehavingfeweratomsperunitcell.ThisisduetotheexpensiveEwaldsumcorrectionthatmustbeappliedtothedynamicalmatrixforpolarmaterials,describedinSection2.1.ThiscalculationhasbeenheavilyoptimisedinEuphonic,andexplainstheperformancediﬀerencebetweenEuphonicandtheCASTEPphononstoolforquartz.InthecaseofNbandLa2Zr2O7,theperformancediscrepancylargelycomesfromthefactthattheCASTEPphononstoolusesdistributedmemoryparallelismviaMPI,soneedstocommunicatethephononfrequenciesandeigenvectorsbacktothemainprocess,whichiswheremosttimeisspent.EuphonicdoesnothavethisissueasitmakesuseofsharedmemoryparallelismviaOpenMP.ThiswaschosenspeciﬁcallytosatisfythetwomainusecasesforEuphonic:runningsmallercalculationsonasinglecomputerornode;andrunninglargercalculationsonaclusterviaadataanalysistoolsuchasHorace,inwhichcaseHoracewouldhandleanymulti-nodeparallelism.ThenumberofQ-pointsusedforcomparisonofEuphonictoothertools,25,000forthebenchmarkingpresentedabove,waschosenbecauseitpushesthelimitsoftheCASTEPtool,andallowsresultstobeobtainedinareasonableamountoftime.However,theruntimesofjustafewsecondsforEuphonicforlargenumbersofprocessorsarenotenoughtoobtaingoodperformancedata,asanon-negligibleamountoftimewillbespentinnon-computationalpartsofthecode,forexampleimportinglibrariesorspawningthreads.TheinterpolationinEuphonichasthereforealsobeenproﬁledfor250,000Q-points,andhasbeenusedtodemonstratetheperformancescaling,thisisshowninFig.4.ThespeeduphasbeencalculatedasinEq.(13),whereT1istheserialinterpolationfunctiontime,andT2istheparalleltime.EachinterpolatedQ-pointisindependent,sothecalculationcaneasilybeparallelisedoverQ-pointsusingaparallelforloop.DespitethisindependenceofQ-points,thescalingisimperfect,particularlyforNb.ThiscanbeexplainedbylookingatFig.5,whichshowsthetimespentindiﬀerentpartsoftheinterpolationcalculationinCfordiﬀerentnumbersofprocessorsandmaterials.Inparticular,theserialPythonpartofthecalculationshowninwhiteimposesa∼0.1soverhead,whichlimitsthemaximumpossiblespeedup,especiallyforasmallsystemlikeNbwheretheparallelisedpartonlytakes0.1swith24processors.Theserialpartincludesvariousset-uptasks,suchascalculatingthelistofperiodicsupercellimagesasdescribedinSection2.1.1.Fig.5alsoexplainsthelongerruntimesforquartzseeninFig.3.Evenafterbeingthefocusofmuchoptimisationwork,theEwaldsumstilltakesaround70%ofthetotalinterpolationtimeforquartz.ThisoptimisationhasincludedavoidingredundantcalculationofQ-independentvaluesbyfactorisation,andoptimisingthebalancebetweentherealandreciprocalspacesums(Λinequation5inGonzeetal.[26]).9ChangingΛwillnotchangetheresultbutcandrasticallyimprovetheperformanceifchosencorrectly.Theoptimumvaluedependsonthematerialandisnotimmediatelyobvious—Euphonicprovidesacommand-linetool,euphonic-optimise-dipole-parameter,whichproﬁlesthecalculationforafewQ-pointsandsuggeststheoptimumvalueforthatsystemforuseinfurthercalculations.Evenwiththeseoptimisations,thereisstillaperformancepenaltyforthecalculationofphononsforpolarmaterials,suggestingatargetforfurtheroptimisationwork.Innon-polarmaterials,mostofthetimeisspenteithercalculatingordiagonalisingthedynamicalmatrix.Thisdependsstronglyonthenumberofatomsintheunitcellvs.thenumberofcellsinthesupercell.InthecaseofLa2Zr2O7,whichhas22atomsintheunitcell,over70%oftheinterpolationtimeisspentdiagonalisingthedynamicalmatrices.BycontrastNbhas1atomperunitcelland(ignoringserialoverhead)over80%ofthetimeisspentcalculatingdynamicalmatrices.4.1HardwareandsoftwarelibrariesAllproﬁlinginthissectionhasbeencompletedontheSTFCScientiﬁcComputingDepartment’sSCARFClusterusingtheSCARF18hardware,whichcontains2IntelGold6126processorspernode(24corespernode).Euphonic0.6.1andCASTEP19.1wereused.BoththeEuphonicCextensionandtheCASTEPphononstoolhavebeencompiledwiththeIntel2018.3compiler,OpenMPI3.1.1andlinkedagainstIntelMKL2018.3.Theproﬁlingresultscanbeobtainedathttps://github.com/pace-neutrons/euphonic-performance.5ValidationTheresultsofacomparisonofEuphonicoutputtoexperimentalinelasticneutronscatteringdatawillbegiveninSection6.3.InthisSection,totestthecalculationofthedynamicalstructurefactorstringently,Euphonicisvalidatedagainsttwootherprograms-Ab2tds[39]andOClimax[11,10].Thisallowsvalidationofthemoresubtlepartsofthecalculation(suchastheDebye–Wallerfactor)withoutthecomplicationofotherscatteringmechanismsorbroadeningduetotheinstrumentalresolution,northepossibilityoftheﬁrst-principlescomputationoftheforceconstantmatrixfailingtofullycapturethephysicsofthelatticedynamics.Forthevalidationcomparisons,fourmaterialshavebeenchosen:La2Zr2O7,quartz,NbandAl.La2Zr2O7,quartzandNbforceconstants,frequenciesandeigenvectorshavebeencomputedusingCASTEP,andthecorrespondingdataforAlhasbeencomputedusingVASPandPhonopy,tovalidateboththeCASTEPandPhonopyreadersavailableinEuphonic.Thedatachosenforvalidationareall2D(Q,ω)mapsasthesetypesofdatacanbecalculatedbyallthreeprograms.ThedatamapshaveawidevariationofmagnitudesanddirectionsinQtoensurethevariationofquantitiessuchasstructurefactorsandDebye–WallerfactorsacrossQ-spacearereliablytested.Visualisationsofthechosen(Q,ω)mapsareshowninFig.6.Themetricthathasbeenusedforcomparisonisthemeanrelativepercentagediﬀerence(MRPD):1nnXi=1|yi−xi|xi×100(14)wherexiistheneutrondynamicalstructurefactor(S(Q,ω)asinEq.(10))calculatedwithEuphonic,andyiistheequivalentcalculatedwithOClimaxorAb2tds.Acousticmodesclosetothegammapoint,whichhavedivergingintensity,andverylowintensitydatahavebeenexcludedtoavoidnumericalinstabilities(moredetailsareinthesupplementarymaterial).TheOClimaxneutrondynamicalstructurefactorshavebeenreaddirectlyfromOClimaxoutput.InthecaseofAb2tds,theinstrumentalresolutionappliedwhencreatingsuchmapscouldnotbecompletelyremovedfromtheAb2tdsoutput,sothedynamicalstructurefactorhasinsteadbeencalculatedbybinninginenergytheAb2tdsmode-resolvedoutput(whichisequivalenttotheone-phononstructurefactorinEq.(7)withthe(nqν+1)factorfromEq.(10)alreadyapplied).TheresultsofthecomparisonsaresummarisedinTable3(Ab2tds)andTable4(OClimax).Theright-handcolumnofeachtableshowstheMRPDforS(Q,ω)calculatedfromphononfrequenciesandeigenvectorsobtainedfrominterpolationviaCASTEP(Nb,quartz,La2Zr2O7)orPhonopy(Al).TheseMRPDtest10thecomputationofS(Q,ω)byEuphonicdirectlyfromthefrequenciesandeigenvectors.ThepreviouscolumnshowsthecomparisonwheninthecaseofEuphonicS(Q,ω)iscomputedfromtheforceconstants,inordertotesttheinterpolationavailableinEuphonicinadditiontotheS(Q,ω)calculationfromthephononfrequenciesandeigenvectorscomputedbythatinterpolation.ForAb2tdstheagreementisextremelygood,withMRPDsof0.05%orless.InthecaseofOClimax,theMRPDsaresigniﬁcantlylarger,upto2.62%fortheLa2Zr2O7[-5,7-L]cutat300K.However,theoverallcomparisonisstillreasonablygood,withoutparticularlysystematicvariationoftherelativepercentagediﬀerenceacrosstheslices.ThescriptsusedforvalidationandtheEuphonic,Ab2tdsandOClimaxinputsandoutputsareavailableathttps://github.com/pace-neutrons/euphonic-validation.Furtherdetailsonthevalidationcalculationsaregiveninthesupplementarymaterial.6Examples6.1Command-linetoolsandplottingThissectionillustratessomeofthemainfeaturesofEuphonic,usingavarietyofsamplesforbothsinglecrystalsandpowders,fromarangeofmodellingcodes.Anoverviewofeachofthecommand-linetoolsinEuphonicisshowninTable5,withexampleﬁguresreferencedforeach.Manyofthesetoolsallowsamplingparameters(e.g.energybins,broadening)andappearanceoptions(e.g.unitconversions,axislabelsandstyling)tobeeasilyspeciﬁedviacommand-linearguments.ForcustomplotsitmaybenecessarytowriteaPythonscript.Forexample,Fig.6showstheneutrondynamicalstructurefactorsampledalongarbitraryQdirections.AsamplescripttoachievethiskindofresultisshowninFig.9.6.2ExperimentalpowderdatacomparisonHere,priorexperimentalmeasurementsarecomparedwithnewlysimulatedspectra[18].MeasurementsofpowderedelementalsamplesofAl(at5Kwith60meVincidentenergyandtheGdmonochromatingchopperrunningat200Hz)andSi(at300Kwith80meVincidentenergywiththe“sloppy”1monochromatingchopperat250Hz)wererecordedontheMARIinstrumentatISIS,thedatawerereducedusingMantidandbinnedto2DS(|Q|,ω)mapsusingMSLICEinMantid(Fig.10(a)andFig.11(a)).FortheAlcalculations,VASP5.4.4wasused,andtheforceconstantswereobtainedbyﬁnitedisplacementsusingPhonopy[36,37,50].ForSi,CASTEPwasused,obtainingforceconstantsbydensity-functionalperturbationtheory(DFPT)[13,45].Formoredetails,seethesupplementarymaterial.Theresultingcastep.binandphonopy.yamlﬁleswereusedwiththeeuphonic-powder-mapcommand-linetooltogeneratenumericallysampledmapsofScoh(|Q|,ω).(Detailsoftheparametersaregiveninthesupplementarymaterial).TheseresultsareplottedinFig.10(b)andFig.11(b)andincludethemaininelasticscatteringfeaturesinthepositiveregionoftheexperimentalmeasurements.Itiseasytoseeinboththeexperimentalandsimulateddatahowsphericallyaveragedperiodicfeaturescollidetocreatebroadregionsofhigherintensity.Inthecaseofthe300KSidata,boththeexperimentalandsimulatedresultshavesigniﬁcantintensityinthenegativeenergytransferregion,whereasforthe5KAldatatheintensityissuppressedinthisregion.ThisarisesfromtheBosepopulationfactorsuppressingthelowtemperaturescattering.ThehighintensitiesseenaroundzeroenergytransferintheexperimentalmeasurementsinFig.10(a)andFig.11(a)areduetoscatteringfromBraggpeakswhichisnotcurrentlymodelledbyEuphonic,hencetheyareabsentfromthecorrespondingsimulationsinFig.10(b).andFig.11(b).ThehighintensityfeatureinFig.11(a)at80meVisanartefactduetoalaterpulseofneutronswhichpassesthroughthechoppersystem,andisnotduetoscatteringfromthesample,soisnotreproducedinthesimulateddatainFig.11(b).1Theterm“sloppy”heremeansthechopperhasrelativewideopeningstomaximizeﬂuxoverawiderangeofenergies(particularlylowenergies¡100meV),incontrasttootherchopperswhichareoptimizedforsharpresolutionatspeciﬁc(high)energiesbutatthecostoflowertransmissionandﬂux.116.3ExperimentalsinglecrystaldatacomparisonusingHoraceSimulationscreatedfrompre-existingquartzforceconstantscalculationshavebeencomparedwithnewlycollectedexperimentaldata[18].OriginalquartzforceconstantscalculationsperformedwithCASTEP6.1havebeenre-processedforthisworkwithCASTEP19.1;moredetailsareinthesupplementarymaterial.Fortheexperimentalmeasurements,alargesinglecrystalofnaturalquartzwasalignedwiththec-axisverticalonanAlplate,securedinplacewithAlwire.Itwascooledto10Kusingaclosedcyclerefrigerator.TheMERLIN‘G’chopperat350Hzwasphasedtoselect45meVincidentenergyneutrons.Thesamplewasrotatedover180◦in0.5◦steps.ThedataforeachindividualanglewerereducedusingMantidandthencombinedusingHorace.SeveralcutsthroughexperimentalandsimulateddataforquartzareshowninFig.12.TheneutrondynamicalstructurefactorhasbeencomputedwithEuphonic,withtheinstrumentalresolutionaccountedforbytheMonteCarloresolutionconvolutionmethod[43]implementedinHorace.Inaddition,1DcutsareshowninFig.13,withthesimulatedscatteringlikewiseconvolvedwiththeinstrumentalresolutionfunction.TheonlyadjustableparameterinthecomparisonisaglobalscalingfactorwhichhasbeendeterminedbysettingtheintegratedareasoftheexperimentalandsimulateddatainFig.13(a)between12and37meVtobeequal,whichhasthenbeenappliedtoall1Dand2Dcuts.Asidefromthis(arbitrary)choiceofintensityscale,noadjustableparametershavebeenusedinanypartofthecalculation.Therearesmalldisagreements,forexamplethephononfrequenciesdonotmatchupperfectly.Thisistobeexpected,astheLDAtendstooverestimatebondstrengths(andthusphononfrequencies).Inadditiontherearesmalldiﬀerencesinparticularmodeintensities,forexamplearound27meVinFig.13(b)wheretheintensityisunderestimatedorat23meVinFig.13(c)whereitisoverestimated.Giventhelackofadjustableparametershowevertheagreementisremarkablystrong.Notwithstandingdisagreementsthatarisefromtheabinitiocodenotfullycapturingthephysicsofthematerial,Fig.13(a-d)showtheimportanceofaccountingforinstrumentalresolutionwhencomparingcalculationwithexperimentaldata.7ConclusionsandfuturedevelopmentWehavedescribedtheEuphonicpackagewhichisdesignedtoeﬃcientlycomputephononeigenvectors,eigenvaluesandtheinelasticneutronscatteringcross-sectionforalargenumberofQ-pointsfromforceconstantsmatrices.Ithasasetofcommandlinestoolstoplotthephononbandstructure,DOSandtheneutrondynamicalstructurefactoralongapathinreciprocalspace,andanextensivePythonAPIsothatitcanbeuseddirectlyfromPythonenvironmentsforcustomisedworkﬂowsandplotting.EuphonicalsoworksdirectlyfromHorace[17]andtheMantid[3]plug-inAbINS[16].ExamplesoftheuseoftheEuphoniccommandlinetoolswereshowninSection6,togetherwithcompari-sonofsimulatedandexperimentaldatafrompowdersandsinglecrystals,thelatteralsoincludingconvolutionwiththeinstrumentalresolutionfunction.Euphonichasbeenextensivelybenchmarkedandvalidatedagainstothercodes.ItisnowbeingusedfortheinterpretationofphonondataattheISISNeutronandMuonSource,whereitwillcontinuetobemaintainedanddevelopedaspartofthecoredataanalysissoftwareportfolio.Promisingavenuesforfuturedevelopmentinclude:supportofothercodes,particularlytheAtomicSimulationEnvironment(ASE)[33];performanceimprovementsfromsymmetry-awareinterpolationofthedynamicalmatrices,andotherinter-polationmethods;correctionsforthermalexpansion/softeningbyusingaquasi-harmonicforce-constantsmatrix;andX-raystructurefactors.Euphonicisopen-sourceandthesourcecodeisavailabletodownloadfromGithub[20],withreleasesalsoavailableviathepipandcondapackagemanagers,asaservicetotheneutronscatteringandthecomputationalchemistryandphysicscommunities.Theauthorswelcomebugreports,feedbackonusabilityanddocumentation,andsuggestionsforadditionalfunctionality.TheauthorsalsowelcomecontributionstotheEuphonicpackage.12AcknowledgmentsThecomputingresourcesforSection4wereprovidedbySTFCScientiﬁcComputingDepartment’sSCARFcluster.References[1]GJAckland,MCWarren,andSJClark.“Practicalmethodsinabinitiolatticedynamics”.In:JournalofPhysics:CondensedMatter9.37(Sept.1997),pp.7861–7872.issn:0953-8984,1361-648X.doi:10.1088/0953-8984/9/37/017.url:https://iopscience.iop.org/article/10.1088/0953-8984/9/37/017(visitedon11/16/2021).[2]FreddieAkeroydetal.Mantid:ManipulationandAnalysisToolkitforInstrumentData.2013.doi:10.5286/SOFTWARE/MANTID.url:https://doi.org/10.5286/SOFTWARE/MANTID.[3]O.Arnoldetal.“Mantid—DataanalysisandvisualizationpackageforneutronscatteringandµSRexperiments”.In:NuclearInstrumentsandMethodsinPhysicsResearchSectionA:Accelerators,Spec-trometers,DetectorsandAssociatedEquipment764(2014),pp.156–166.issn:0168-9002.doi:https://doi.org/10.1016/j.nima.2014.07.029.url:https://www.sciencedirect.com/science/article/pii/S0168900214008729.[4]FengBaoetal.“Complexoptimizationforbigcomputationalandexperimentalneutrondatasets”.In:Nanotechnology27.48(Nov.2016).Publisher:IOPPublishing,p.484002.doi:10.1088/0957-4484/27/48/484002.url:https://doi.org/10.1088/0957-4484/27/48/484002.[5]StefanoBaronietal.“Phononsandrelatedcrystalpropertiesfromdensity-functionalperturbationtheory”.en.In:ReviewsofModernPhysics73.2(July2001),pp.515–562.issn:0034-6861,1539-0756.doi:10.1103/RevModPhys.73.515.url:https://link.aps.org/doi/10.1103/RevModPhys.73.515(visitedon11/16/2021).[6]R.I.Bewley,J.W.Taylor,andS.M.Bennington.“LET,acoldneutronmulti-diskchopperspectrom-eteratISIS”.en.In:NuclearInstrumentsandMethodsinPhysicsResearchSectionA:Accelerators,Spectrometers,DetectorsandAssociatedEquipment637.1(May2011),pp.128–134.issn:01689002.doi:10.1016/j.nima.2011.01.173.url:https://linkinghub.elsevier.com/retrieve/pii/S0168900211002750(visitedon11/16/2021).[7]KarlW.B¨oerandUdoW.Pohl.“ElasticityandPhonons”.en.In:SemiconductorPhysics.Cham:SpringerInternationalPublishing,2018,pp.111–150.isbn:97833196914809783319691503.doi:10.1007/978-3-319-69150-3_4.url:http://link.springer.com/10.1007/978-3-319-69150-3%5C_4(visitedon11/16/2021).[8]B.N.Brockhouse.“EnergyDistributionofNeutronsScatteredbyParamagneticSubstances”.en.In:PhysicalReview99.2(July1955),pp.601–603.issn:0031-899X.doi:10.1103/PhysRev.99.601.url:https://link.aps.org/doi/10.1103/PhysRev.99.601(visitedon07/20/2022).[9]JohnD.Budaietal.“Metallizationofvanadiumdioxidedrivenbylargephononentropy”.en.In:Nature515.7528(Nov.2014),pp.535–539.issn:0028-0836,1476-4687.doi:10.1038/nature13865.url:http://www.nature.com/articles/nature13865(visitedon07/30/2021).[10]Y.Q.ChengandA.J.Ramirez-Cuesta.“CalculationoftheThermalNeutronScatteringCross-SectionofSolidsUsingOCLIMAX”.en.In:JournalofChemicalTheoryandComputation16.8(Aug.2020),pp.5212–5217.issn:1549-9618,1549-9626.doi:10.1021/acs.jctc.0c00569.url:https://pubs.acs.org/doi/10.1021/acs.jctc.0c00569(visitedon05/27/2022).[11]Y.Q.Chengetal.“SimulationofInelasticNeutronScatteringSpectraUsingOCLIMAX”.en.In:JournalofChemicalTheoryandComputation15.3(Mar.2019),pp.1974–1982.issn:1549-9618,1549-9626.doi:10.1021/acs.jctc.8b01250.url:http://pubs.acs.org/doi/10.1021/acs.jctc.8b01250(visitedon03/25/2019).13[12]V.A.Chernyshev.“StructureandLatticeDynamicsofLa2Zr2O7Crystal:AbInitioCalculation”.en.In:ComputationalScienceandItsApplications–ICCSA2019.Ed.bySanjayMisraetal.Vol.11622.SeriesTitle:LectureNotesinComputerScience.Cham:SpringerInternationalPublishing,2019,pp.625–638.isbn:978-3-030-24304-3978-3-030-24305-0.doi:10.1007/978-3-030-24305-0\_46.url:http://link.springer.com/10.1007/978-3-030-24305-0%5C_46(visitedon02/22/2022).[13]StewartJ.Clarketal.“FirstprinciplesmethodsusingCASTEP”.en.In:Zeitschriftf¨urKristallographie-CrystallineMaterials220.5-6(May2005),pp.567–570.issn:2196-7105,2194-4946.doi:10.1524/zkri.220.5.567.65075.url:https://www.degruyter.com/document/doi/10.1524/zkri.220.5.567.65075/html(visitedon11/16/2021).[14]MartinT.Dove.Introductiontolatticedynamics.Cambridgetopicsinmineralphysicsandchemistry4.Cambridge;NewYork:CambridgeUniversityPress,1993.isbn:978-0-521-39293-8.[15]MartinT.Dove.Structureanddynamics:anatomicviewofmaterials.Oxfordmasterseriesincon-densedmatterphysics.Oxford;NewYork:OxfordUniversityPress,2003.isbn:978-0-19-850677-5978-0-19-850678-2.[16]KrzysztofDymkowskietal.“AbINS:ThemodernsoftwareforINSinterpretation”.en.In:PhysicaB:CondensedMatter551(Dec.2018),pp.443–448.issn:09214526.doi:10.1016/j.physb.2018.02.034.url:https://linkinghub.elsevier.com/retrieve/pii/S0921452618301546(visitedon11/16/2021).[17]R.A.Ewingsetal.“Horace:Softwarefortheanalysisofdatafromsinglecrystalspectroscopyex-perimentsattime-of-ﬂightneutroninstruments”.en.In:NuclearInstrumentsandMethodsinPhysicsResearchSectionA:Accelerators,Spectrometers,DetectorsandAssociatedEquipment834(Oct.2016),pp.132–142.issn:01689002.doi:10.1016/j.nima.2016.07.036.url:https://linkinghub.elsevier.com/retrieve/pii/S016890021630777X(visitedon11/05/2020).[18]R.Fairetal.PhononcalculationsandmeasurementsdatasetforusewiththeEuphonicprogram.July2022.doi:10.5281/zenodo.6620084.url:https://doi.org/10.5281/zenodo.6620084.[19]RebeccaFairandManhDucLe.Horace-Euphonic-Interface.2022.doi:10.5286/SOFTWARE/HORACEEUPHONICINTERFACE.url:https://doi.org/10.5286/SOFTWARE/HORACEEUPHONICINTERFACE(visitedon05/05/2022).[20]RebeccaFairetal.Euphonic.2022.doi:10.5286/SOFTWARE/EUPHONIC.url:https://doi.org/10.5286/SOFTWARE/EUPHONIC(visitedon06/13/2022).[21]ErikFranssonetal.“¡spanstyle=”font-variant:small-caps;”¿dynasor¡/span¿—AToolforExtractingDynamicalStructureFactorsandCurrentCorrelationFunctionsfromMolecularDynamicsSimula-tions”.en.In:AdvancedTheoryandSimulations4.2(Feb.2021),p.2000240.issn:2513-0390,2513-0390.doi:10.1002/adts.202000240.url:https://onlinelibrary.wiley.com/doi/10.1002/adts.202000240(visitedon07/26/2022).[22]JulianD.Gale.“GULP:Capabilitiesandprospects”.en.In:Zeitschriftf¨urKristallographie-Crys-tallineMaterials220.5-6(May2005),pp.552–554.issn:2196-7105,2194-4946.doi:10.1524/zkri.220.5.552.65070.url:https://www.degruyter.com/document/doi/10.1524/zkri.220.5.552.65070/html(visitedon11/16/2021).[23]E.Garlattietal.“Unveilingphononsinamolecularqubitwithfour-dimensionalinelasticneutronscatteringanddensityfunctionaltheory”.en.In:NatureCommunications11.1(Dec.2020),p.1751.issn:2041-1723.doi:10.1038/s41467-020-15475-7.url:http://www.nature.com/articles/s41467-020-15475-7(visitedon07/30/2021).[24]PaoloGiannozzietal.“QUANTUMESPRESSO:amodularandopen-sourcesoftwareprojectforquantumsimulationsofmaterials”.In:JournalofPhysics:CondensedMatter21.39(Sept.2009),p.395502.issn:0953-8984,1361-648X.doi:10.1088/0953-8984/21/39/395502.url:https://iopscience.iop.org/article/10.1088/0953-8984/21/39/395502(visitedon11/16/2021).14[25]XavierGonzeandChangyolLee.“Dynamicalmatrices,Borneﬀectivecharges,dielectricpermittivitytensors,andinteratomicforceconstantsfromdensity-functionalperturbationtheory”.In:PhysicalReviewB55.16(1997),pp.10355–10368.url:http://prb.aps.org/abstract/PRB/v55/i16/p10355%5C_1(visitedon09/21/2013).[26]XavierGonzeetal.“Interatomicforceconstantsfromﬁrstprinciples:Thecaseofα-quartz”.In:PhysicalReviewB50.17(Nov.1994),pp.13035–13038.issn:0163-1829.doi:10.1103/PhysRevB.50.13035.url:http://link.aps.org/doi/10.1103/PhysRevB.50.13035(visitedon11/29/2012).[27]XavierGonzeetal.“TheAbinitproject:Impact,environmentandrecentdevelopments”.en.In:ComputerPhysicsCommunications248(Mar.2020),p.107042.issn:00104655.doi:10.1016/j.cpc.2019.107042.url:https://linkinghub.elsevier.com/retrieve/pii/S0010465519303741(visitedon11/16/2021).[28]G.Goret,B.Aoun,andE.Pellegrini.“MDANSE:AnInteractiveAnalysisEnvironmentforMolecularDynamicsSimulations”.en.In:JournalofChemicalInformationandModeling57.1(Jan.2017),pp.1–5.issn:1549-9596,1549-960X.doi:10.1021/acs.jcim.6b00571.url:https://pubs.acs.org/doi/10.1021/acs.jcim.6b00571(visitedon11/16/2021).[29]H.Grecco.Pint:OperateandmanipulatephysicalquantitiesinPython.2012.url:https://github.com/hgrecco/pint(visitedon12/18/2020).[30]CharlesR.Harrisetal.“ArrayprogrammingwithNumPy”.en.In:Nature585.7825(Sept.2020),pp.357–362.issn:1476-4687.doi:10.1038/s41586-020-2649-2.url:https://www.nature.com/articles/s41586-020-2649-2(visitedon12/18/2020).[31]OlleHellmanetal.“Temperaturedependenteﬀectivepotentialmethodforaccuratefreeenergycalcu-lationsofsolids”.en.In:PhysicalReviewB87.10(Mar.2013),p.104111.issn:1098-0121,1550-235X.doi:10.1103/PhysRevB.87.104111.url:https://link.aps.org/doi/10.1103/PhysRevB.87.104111(visitedon12/14/2021).[32]YoyoHinumaetal.“Bandstructurediagrampathsbasedoncrystallography”.en.In:ComputationalMaterialsScience128(Feb.2017),pp.140–184.issn:09270256.doi:10.1016/j.commatsci.2016.10.015.url:https://linkinghub.elsevier.com/retrieve/pii/S0927025616305110(visitedon01/04/2021).[33]AskHjorthLarsenetal.“Theatomicsimulationenvironment—aPythonlibraryforworkingwithatoms”.In:JournalofPhysics:CondensedMatter29.27(July2017),p.273002.issn:0953-8984,1361-648X.doi:10.1088/1361-648X/aa680e.url:https://iopscience.iop.org/article/10.1088/1361-648X/aa680e(visitedon05/20/2022).[34]G.J.KearleyandJ.Tomkinson.“CLIMAX:Aprogramforforceconstantreﬁnementfrominelasticneutronspectra”.In:NeutronScatteringDataAnalysis.Vol.107.InstituteofPhysicsConferenceSeries.1990,pp.245–252.isbn:0-85498-066-0.[35]M.Kempaetal.“TheFlatConemultianalyzersetupforILL’sthree-axisspectrometers”.en.In:PhysicaB:CondensedMatter385-386(Nov.2006),pp.1080–1082.issn:09214526.doi:10.1016/j.physb.2006.05.371.url:https://linkinghub.elsevier.com/retrieve/pii/S0921452606012622(visitedon11/16/2021).[36]G.KresseandJ.Furthm¨uller.“Eﬃcientiterativeschemesforabinitiototal-energycalculationsusingaplane-wavebasisset”.en.In:PhysicalReviewB54.16(Oct.1996),pp.11169–11186.issn:0163-1829,1095-3795.doi:10.1103/PhysRevB.54.11169.url:https://link.aps.org/doi/10.1103/PhysRevB.54.11169(visitedon11/16/2021).[37]G.KresseandD.Joubert.“Fromultrasoftpseudopotentialstotheprojectoraugmented-wavemethod”.en.In:PhysicalReviewB59.3(Jan.1999),pp.1758–1775.issn:0163-1829,1095-3795.doi:10.1103/PhysRevB.59.1758.url:https://link.aps.org/doi/10.1103/PhysRevB.59.1758(visitedon11/16/2021).15[38]AlessandroMironeandMatteod’Astuto.OpenPhonon:anopensourcecomputercodeforlattice-dynamicalcalculations.2006.url:https://www.esrf.fr/computing/scientific/OpenPhonon/manual/index.html(visitedon11/16/2021).[39]AlessandroMironeandBjornWehinger.Ab2tds.2013.url:http://ftp.esrf.fr/scisoft/AB2TDS/Introduction.html.[40]JuanaMorenoandJos´eM.Soler.“Optimalmeshesforintegralsinreal-andreciprocal-spaceunitcells”.In:Phys.Rev.B45.24(June1992).Publisher:AmericanPhysicalSociety,pp.13891–13898.doi:10.1103/PhysRevB.45.13891.url:https://link.aps.org/doi/10.1103/PhysRevB.45.13891.[41]K.Parlinski,Z.Q.Li,andY.Kawazoe.“First-PrinciplesDeterminationoftheSoftModeinCubicZrO2”.en.In:PhysicalReviewLetters78.21(May1997),pp.4063–4066.issn:0031-9007,1079-7114.doi:10.1103/PhysRevLett.78.4063.url:https://link.aps.org/doi/10.1103/PhysRevLett.78.4063(visitedon11/16/2021).[42]KrzysztofParlinski.PHONON.2014.url:http://www.computingformaterials.com/phoncfm710/2phon610.html(visitedon11/16/2021).[43]TobyG.Perring.“Highenergymagneticexcitationsinhexagonalcobalt”.AppendixA.PhDthesis.UniversityofCambridge,1991.[44]AnibalJ.Ramirez-Cuesta.“aCLIMAX4.0.1,Thenewversionofthesoftwareforanalyzingandinter-pretingINSspectra”.In:ComputerPhysicsCommunications157.3(Mar.2004),pp.226–238.issn:00104655.doi:10.1016/S0010-4655(03)00520-4.url:http://linkinghub.elsevier.com/retrieve/pii/S0010465503005204.[45]KeithRefson,PaulR.Tulip,andStewartJ.Clark.“Variationaldensity-functionalperturbationtheoryfordielectricsandlatticedynamics”.en.In:PhysicalReviewB73.15(Apr.2006),p.155114.issn:1098-0121,1550-235X.doi:10.1103/PhysRevB.73.155114.url:https://link.aps.org/doi/10.1103/PhysRevB.73.155114(visitedon11/16/2021).[46]DmitryReznikandIradaAhmadova.“AutomatingAnalysisofNeutronScatteringTime-of-FlightSingleCrystalPhononData”.en.In:QuantumBeamScience4.4(Nov.2020),p.41.issn:2412-382X.doi:10.3390/qubs4040041.url:https://www.mdpi.com/2412-382X/4/4/41(visitedon11/16/2021).[47]D.L.Roach,J.D.Gale,andD.K.Ross.“Scatter:ANewInelasticNeutronScatteringSimulationSubroutineforGULP”.en.In:NeutronNews18.3(Aug.2007),pp.21–23.issn:1044-8632,1931-7352.doi:10.1080/10448630701492475.url:http://www.tandfonline.com/doi/abs/10.1080/10448630701492475(visitedon11/16/2021).[48]T.R´ogetal.“nMoldyn:Aprogrampackageforaneutronscatteringorientedanalysisofmoleculardynamicssimulations”.en.In:JournalofComputationalChemistry24.5(Apr.2003),pp.657–667.issn:01928651.doi:10.1002/jcc.10243.url:https://onlinelibrary.wiley.com/doi/10.1002/jcc.10243(visitedon07/26/2022).[49]G.L.Squires.Introductiontothetheoryofthermalneutronscattering.Mineola,N.Y:DoverPublica-tions,1996.isbn:978-0-486-69447-4.[50]AtsushiTogoandIsaoTanaka.“Firstprinciplesphononcalculationsinmaterialsscience”.en.In:ScriptaMaterialia108(Nov.2015),pp.1–5.issn:13596462.doi:10.1016/j.scriptamat.2015.07.021.url:https://linkinghub.elsevier.com/retrieve/pii/S1359646215003127(visitedon11/05/2020).[51]NathanP.Walteretal.“LiquidLib:Acomprehensivetoolboxforanalyzingclassicalandabinitiomoleculardynamicssimulationsofliquidsandliquid-likematterwithapplicationstoneutronscatteringexperiments”.en.In:ComputerPhysicsCommunications228(July2018),pp.209–218.issn:0010-4655.doi:10.1016/j.cpc.2018.03.005.url:https://www.sciencedirect.com/science/article/pii/S0010465518300778(visitedon08/03/2022).16[52]QiyeZhengetal.“Advancesinthermalconductivityforenergyapplications:areview”.In:ProgressinEnergy3.1(Jan.2021),p.012002.issn:2516-1083.doi:10.1088/2516-1083/abd082.url:https://iopscience.iop.org/article/10.1088/2516-1083/abd082(visitedon11/16/2021).17Table1:CASTEP.phononﬁlesize,andtimetakentowritethe.phononﬁlecomparedwiththetotaltimetakentoruntheCASTEPphononstool(includingwritetime)with25,000Q-pointsfordiﬀerentmaterials.(DetailsofthehardwarearegiveninSection4.1.)MaterialAtomsSize(GB)TotalTime(s)WriteTime(s)Nb10.02557.8377.557Quartz90.913811.43064.930La2Zr2O7225.187302.167258.243Table2:Comparisonofthemeantimetakenforphononinterpolationagainstthemeantimetakentocalculatethemode-resolvedstructurefactorsfor25,000Q-pointswithserialPythoninEuphonic.(DetailsofthehardwarearegiveninSection4.1.)MaterialInterpolation(s)StructureFactor(s)Nb7.0700.104Quartz199.0690.426La2Zr2O735.7431.853Table3:MeanrelativepercentagediﬀerencebetweentheEuphonicandAb2tdsneutrondynamicalstructurefactorfortheNb,quartzandLa2Zr2O72D(Q,ω)mapsshowninFig.6at300K.ForEuphonictheneutrondynamicalstructurefactorhasbeencalculatedfrombothCASTEP-interpolatedandEuphonic-interpolatedfrequenciesandeigenvectors.MaterialQ-directionMeanRelativePercentageDiﬀerenceEuphonicInterpolationCASTEPInterpolationNb[h,h,0]<0.01<0.01[2−k,k,0]<0.01<0.01Quartz[h,−4,0]0.030.03[−3,0,−l]0.05<0.01La2Zr2O7[−5,7,−l]0.050.05[h,−h,2]0.050.0518Figure1:WhereEuphonicsitsinrelationtoothersoftware,andusersofEuphonicorthosesoftware.19Figure2:AsummaryoftheAPItoEuphonic,showingthemainclassesandmethods.20Figure3:ComparisonofthewalltimetakentorunthecalculateqpointphononmodesinterpolationfunctioninEuphonicagainstthephononcalculatefunctioninCASTEPfor25,000Q-pointsfordiﬀerentmaterialsandnumbersofprocessors.ScatterpointsshowthewalltimetakentoruntheserialPythonversionofcalculateqpointphononmodes.(DetailsofthehardwarearegiveninSection4.1.)Figure4:SpeedupofthecalculateqpointphononmodesinterpolationfunctioninEuphonicwithCex-tensioncomparedtoserialPythonfor250,000Q-pointsfordiﬀerentmaterialsandnumbersofprocessors.(DetailsofthehardwarearegiveninSection4.1.)21Figure5:WheretimeisspentintheEuphonicinterpolationfunctioncalculateqpointphononmodesfor250,000Q-pointsfordiﬀerentmaterialsandnumbersofprocessors.Thewhiteareasindicatetimespentintheserialpartofthecode.Table4:MeanrelativepercentagediﬀerencebetweentheEuphonicandOClimaxneutrondynamicalstruc-turefactorforthe2D(Q,ω)mapsshowninFig.6atdiﬀerenttemperatures.ForEuphonictheneutrondynamicalstructurefactorhasbeencalculatedfrombothCASTEP/Phonopy-interpolated((Nb,quartzandLa2Zr2O7)/Al)andEuphonic-interpolatedfrequenciesandeigenvectors.MaterialQ-directionT(K)MeanRelativePercentageDiﬀerenceEuphonicCASTEP/PhonopyInterpolationInterpolationNb[h,h,0]300<0.01<0.015<0.01<0.01[2−k,k,0]300<0.01<0.015<0.01<0.01Quartz[h,−4,0]3000.870.8750.490.49[−3,0,−l]3001.751.8250.830.92La2Zr2O7[−5,7,−l]3002.622.6251.831.83[h,−h,2]3002.052.0551.421.42Al[h,2,2]3000.01<0.0150.01<0.01[h,2+h2,2+h2]300<0.01<0.015<0.01<0.0122Figure6:TheneutrondynamicalstructurefactorsforthevalidationcutssimulatedwithEuphonic.Nbalong(a)[h,h,0],(b)[2−k,k,0].Quartzalong(c)[h,−4,0],(d)[−3,0,−l].La2Zr2O7along(e)[−5,7,−l],(f)[h,−h,2].Alalong(g)[h,2,2],(h)[h,2+h2,2+h2].23Table5:Anoverviewofthecommand-linetoolsavailableinEuphonicToolDescriptionExampleFigureeuphonic-dispersionPlotsaphononbandstructurealongarecommendedQ-pointpath(generatedbySeeK-path[32])ifusingaforceconstantsﬁleasinput,orwillplotexistingphononfrequenciesifusingaphononmodesﬁleasinput(e.g.CASTEP.phonon)ﬁleFig.7(a)euphonic-dosPlotsatotalorpartialDOSonaspeciﬁedMonkhorst–Packgridifusingaforceconstantsﬁle,oronaprecalculatedgridifusingaphononmodesﬁle.Thespectrumcanalsobeweightedbycoherentorincoherentneutron-scatteringcross-sectionFig.7(d)euphonic-intensity-mapPlotsa2D(Q,ω)crystalintensitymapalongarec-ommendedQ-pointpathifusingforceconstants,oralongaprecalculatedpathifusingphononmodes.Theintensitiescanbeweightedbytheneutrondy-namicalstructurefactororphononDOSFig.7(b)&Fig.7(c)euphonic-powder-mapPlotsa2D(|Q|,ω)powderintensitymapalongaspeciﬁedrangein|Q|usingsphericalaveraging;re-quiresforceconstants.IntensitiescanbeweightedbytheneutrondynamicalstructurefactororphononDOSFig.10(b)andFig.11(b)euphonic-show-samplingPlotsa3DvisualisationofthedistributionofQ-pointsoverasphereforthediﬀerentsphericalsam-plingschemesthatareusedinpowderaveragingFig.8euphonic-optimise-dipole-parameterThe’dipoleparameter’determinesthebalanceofrealandreciprocaltermsusedintheEwaldsumforcal-culatingthedipolecorrection(seeSection2.1.3).Ahighervalueusesmorereciprocalterms,andalowervaluemorerealterms.Tuningthisparametercanimproveperformance;thistoolrunstheinterpola-tionforafewQ-pointsforafewdiﬀerentvaluesoftheparameter,andsuggestsanoptimumvalue-24Figure7:Examplesofplotsproducedwithcommand-linetoolsinEuphonic.(a)Quartzwitheuphonic-dispersion.(b)Quartzwitheuphonic-intensity-mapusingtheDOS-weightedintensitiesop-tion.(c)Quartzwitheuphonic-intensity-mapusingtheneutrondynamicalstructurefactorweightedintensitiesoption.(d)La2Zr2O7witheuphonic-dosusingthecoherent-weightedpartialDOSoption.Figure8:Outputsofeuphonic-show-sampling.(a)”Goldensphere”sampling(b)”Improvedsphericalpolar”samplingwithjitter.25Figure9:ExampleEuphonicscripttocalculateandplottheneutrondynamicalstructurefactorinthe[h,−h,−2]direction,producingaplotsimilartoFig.6(f)Figure10:Alpowderdataat5K.(a)ExperimentaldatarecordedonMARI(b)Correspondingpowder-averagedcoherentS(|Q|,ω)generatedwitheuphonic-powder-map.26Figure11:Sipowderdataat300K.(a)ExperimentaldatarecordedonMARI(b)Correspondingpowder-averagedcoherentS(|Q|,ω)generatedwitheuphonic-powder-map.Figure12:(a),(c)and(e)cutsthroughtheexperimentalquartzdatasetand(b),(d)and(f)correspondingsimulationswithEuphonic.Allﬁguresusetheprojectionaxesof[h,0,0],[h2,−h,0],[0,0,l]withintegrationoverthenon-plotteddirectionsof±0.1.Theenergyaxisintegrationin(e)and(f)isfrom8to9meV.27Figure13:LinecutsthroughthequartzdataandcorrespondingsimulationswithEuphonic(solidlines).(a)acutthrough[-3,0,0],(b)[-5,1,0],(c)[-3.75,-0.5,0],and(d)acutatconstantenergy(integratedfrom8to9meV).Allﬁguresusetheprojectionaxesof[h,0,0],[h2,−h,0],[0,0,l]withintegrationoverthenon-plotteddirectionsof±0.1.28Supportinginformationfor:Euphonic:inelasticneutronscatteringsimulationsfromforceconstantsandvisualisationtoolsforphononpropertiesRebeccaFaira,AdamJacksonb,DavidVoneshena,c,DominikJochymb,DucLea,KeithRefsona,andTobyPerringaaISISNeutronandMuonSource,STFCRutherfordAppletonLaboratory,HarwellCampus,Didcot,OxfordshireOX110QX,UKbScientiﬁcComputingDepartment,STFCRutherfordAppletonLaboratory,HarwellCampus,Didcot,OxfordshireOX110QX,UKcDepartmentofPhysics,RoyalHollowayUniversityofLondon,Egham,TW200EX,UK1arXiv:2206.15289v2  [cond-mat.mtrl-sci]  10 Aug 20221Validationcalculation1.1IntensityscalingForthecomparisonofEuphonic[5]withAb2tds[10]andOClimax[2],ascalingfactorwascalculatedforeachintensitymapbyaveragingtheratiooftheintensitiesineachbinwiththoseinthecorrespondingbinsintheEuphonicintensitymap.Datapointsatenergieslessthan1meVwereﬁrstremovedtoeliminateacousticmodedataclosetothegammapoints(wherethephononintensitydiverges)andafterwardsanyvaluesthatweresmallerthan10−4ofthemaximumintensityintheremainingportionofthemapwereremovedtoavoidpotentialnumericalinstabilitiesarisinginthecomputationofverysmallintensities.TheAb2tdsorOClimaxintensitymapwasthennormalisedbytheresultingscalingfactorandthemeanrelativepercentagediﬀerence(MRPD)wascomputedforthedatathatpassedthesameﬁlteringcriteria.1.2SymmetrisationoftheDebye–WallerexponentInallcasesthegridusedtocalculatetheDebye–WallerfactorwasafullyunfoldedMonkhorst–Packgrid,i.e.thesetofpointswasnotsymmetryreduced.ItwasfoundthatusingasymmetryreducedgridproducesslightlydiﬀerentvaluesfortheDebye–WallerexponentWκthanthefullgridunlesstheDebye–Wallerexponentisexplicitlysymmetrisedsothatitisinvariantundersymmetryoperations.ThiswouldhavemadecomparisonbetweenthediﬀerentcodesdiﬃcultasAb2tdsandOClimaxappeartohandlesymmetryreducedgridsdiﬀerently,increasingtheMRPDsdependingonwhichgridtypeandsymmetrisationsettingsareused.(EuphonichastheoptiontoswitchonoroﬀDebye–Wallersymmetrisation).AnexampleoftheMRPDincreaseforAb2tdsisshowninTable1forthecasewhereasymmetryreducedgridwasusedasinputandDebye–WallersymmetrisationwasdisabledinEuphonic.TheMRPDsarehigherthaninthecorresponding??inthemaintext,whereafullgridwasused.IftheDebye–WallersymmetrisationisenabledagaininEuphonicwhenusingthereducedgrid,thelowMRPDsseenin??inthemaintextarerecovered.Table1:MeanrelativepercentagediﬀerencebetweenEuphonicandAb2tdsasin??inthemaintext,butusingasymmetryreducedMonkhorst–PackgridtocalculatetheDebye–Wallerfactor,andwithDebye–WallersymmetrisationturnedoﬀinEuphonicMaterialQ-directionMeanRelativePercentageDiﬀerenceEuphonicInterpolationCASTEPInterpolationNb[h,h,0]0.210.21[2−k,k,0]0.250.25Quartz[h,−4,0]1.891.89[−3,0,−l]0.270.23La2Zr2O7[−5,7,−l]1.611.61[h,−h,−2]1.151.152ForceconstantscalculationdetailsTheinputandoutputﬁlesforeachofthefollowingcalculationsareavailableathttps://doi.org/10.5281/zenodo.6620084[4].2.1La2Zr2O7CalculationsoftheforceconstantswereperformedwithDFTasimplementedinCASTEP17.21[3].DefaultultrasoftpseudopotentialswereusedandtheresultspresentedusedtheLocalDensityApproximation(LDA)toexchangeandcorrelation.Aplanewavecut-oﬀof600eVwithelectronick-pointsamplingonaMonkhorst–Packmeshof4×4×4withintheprimitivecellwasfoundtoreducetheerrorintheforcestobelow0.0052eV˚A−1.Thestructureandlatticeparameterswererelaxedwiththequasi-Newtonmethod[1]correctedfortheﬁnitebasisset[6].Forceconstantswerecalculatedusingtheﬁnitedisplacement/supercellmethod[7]withinasinglecubicunitcell.2.2QuartzOriginalcalculationswereperformedwithCASTEP6.1usingLDAexchangeandcorrelation,optimisednorm-conservingpseudopotentials[11],aplane-wavecutoﬀof880eVanda5×5×4Monkhorst–Packmeshfork-pointsampling.Theoptimisedlatticeparameterswere4.852˚Aand5.350˚A.DFPTcalculationsalsosampledusinga5×5×4gridwithdipole-dipolemodelcorrectionsapplied.Theresultingforceconstantswerere-processedforthisworkusingCASTEP19.1.2.3NbNiobiumcalculationsusedtheone-atomprimitivecellwithbcclatticeparameterof3.25988˚A,CASTEP19.1,LDAexchangeandcorrelationandaplane-wavecutoﬀof900eV.TheNCP19on-the-ﬂy(OTF)librarypseudopotentialusedisconstructedwithunfrozen4sand4psemi-corestates.Electronicstatesweresampledusingan18×18×18Monkhorst–PackgridandsmearedusingGaussianbroadeningwithawidthof0.5eV.DFPTcalculationswereperformedfora9×9×9gridofq-pointsandtheforceconstantmatrixconstructedbyFouriertransformingonthisgrid.2.4AlForceconstantswereobtainedfroma4×4×4supercellofthecubic(conventional)unitcellusingPhonopy[12]toimplementandprocessasymmetrisedﬁnite-displacementmethod.TheforcecalculatorwasVASP5.4.4[9],withthestandardLDAPAWsetupandparameters:ENCUT=600.000000KSPACING=0.100000SIGMA=0.200000EDIFF=1.00e-08ALGO=fastPREC=accurateIBRION=-1ISMEAR=0ISYM=2KPAR=6NCORE=6ADDGRID=.TRUE.LASPH=.TRUE.LREAL=.FALSE.Afterk-pointconvergenceandoptimisationtheunitcellhasalatticeparameterof3.984207(cid:6)A.2.5SiForceconstantswereobtainedfroma5×5×5Γ-centeredQ-pointmeshsamplingofaSiprimitivecell,usingDFPTwithCASTEP19.1,on-the-ﬂy-generatednorm-conservingpseudopotentialsandLDAexchange-correlationfunctionalwitha”Precise”(266.9eV)plane-wavebasisset.ThegeometrywasobtainedbylocaloptimisationinCASTEPfromaninitialstructuregeneratedwithAtomicSimulationEnvironment(ASE)[8].33Powder-averagedcalculationdetailsandparameters3.1AlThepowder-averagingcommandwaseuphonic-powder-mapAl-444-lda.yaml--weightingcoherent\--q-max11--asr--temperature5\--npts-density400--npts-min500--npts-max20000\--energy-broadening1--q-broadening0.1\--e-min-25--e-max60--v-max2\--angle-range3135--e-incident60\--no-widgets--stylecustom.mplstyle\--save-toal-simulated.png\--x-label’$|\mathbf{Q}|$$(\AA^{-1})$’\--y-label’Energytransfer(meV)’3.2SiThepowder-averagingcommandwaseuphonic-powder-mapSi-prim-555.json--weightingcoherent\--q-max12.5--asr--temperature300\--npts-density400--npts-min500--npts-max20000\--energy-broadening1--q-broadening0.1\--e-min-40--e-max80--v-max5\--angle-range3135--e-incident80\--no-widgets--stylecustom.mplstyle\--save-tosi-simulated.png\--x-label’$|\mathbf{Q}|$$(\AA^{-1})$’\--y-label’Energytransfer(meV)’References[1]RichardH.Byrd,JorgeNocedal,andRobertB.Schnabel.“Representationsofquasi-Newtonmatri-cesandtheiruseinlimitedmemorymethods”.en.In:MathematicalProgramming63.1(Jan.1994),pp.129–156.issn:1436-4646.doi:10.1007/BF01582063.url:https://doi.org/10.1007/BF01582063(visitedon01/11/2022).[2]Y.Q.Chengetal.“SimulationofInelasticNeutronScatteringSpectraUsingOCLIMAX”.en.In:JournalofChemicalTheoryandComputation15.3(Mar.2019),pp.1974–1982.issn:1549-9618,1549-9626.doi:10.1021/acs.jctc.8b01250.url:http://pubs.acs.org/doi/10.1021/acs.jctc.8b01250(visitedon03/25/2019).[3]StewartJ.Clarketal.“FirstprinciplesmethodsusingCASTEP”.en.In:Zeitschriftf¨urKristallographie-CrystallineMaterials220.5-6(May2005),pp.567–570.issn:2196-7105.doi:10.1524/zkri.220.5.567.65075.url:https://www.degruyter.com/document/doi/10.1524/zkri.220.5.567.65075/html(visitedon01/11/2022).[4]R.Fairetal.PhononcalculationsandmeasurementsdatasetforusewiththeEuphonicprogram.July2022.doi:10.5281/zenodo.6620084.url:https://doi.org/10.5281/zenodo.6620084.[5]RebeccaFairetal.Euphonic.2022.doi:10.5286/SOFTWARE/EUPHONIC.url:https://doi.org/10.5286/SOFTWARE/EUPHONIC(visitedon06/13/2022).4[6]GPFrancisandMCPayne.“Finitebasissetcorrectionstototalenergypseudopotentialcalculations”.In:JournalofPhysics:CondensedMatter2.19(May1990),pp.4395–4404.issn:0953-8984,1361-648X.doi:10.1088/0953-8984/2/19/007.url:https://iopscience.iop.org/article/10.1088/0953-8984/2/19/007(visitedon01/11/2022).[7]W.Frank,C.Els¨asser,andM.F¨ahnle.“AbinitioForce-ConstantMethodforPhononDispersionsinAlkaliMetals”.In:PhysicalReviewLetters74.10(Mar.1995),pp.1791–1794.doi:10.1103/PhysRevLett.74.1791.url:https://link.aps.org/doi/10.1103/PhysRevLett.74.1791(visitedon01/11/2022).[8]AskHjorthLarsenetal.“Theatomicsimulationenvironment—aPythonlibraryforworkingwithatoms”.In:JournalofPhysics:CondensedMatter29.27(July2017),p.273002.issn:0953-8984,1361-648X.doi:10.1088/1361-648X/aa680e.url:https://iopscience.iop.org/article/10.1088/1361-648X/aa680e(visitedon05/20/2022).[9]G.KresseandJ.Furthm¨uller.“Eﬃcientiterativeschemesforabinitiototal-energycalculationsusingaplane-wavebasisset”.en.In:PhysicalReviewB54.16(Oct.1996),pp.11169–11186.issn:0163-1829,1095-3795.doi:10.1103/PhysRevB.54.11169.url:https://link.aps.org/doi/10.1103/PhysRevB.54.11169(visitedon11/16/2021).[10]AlessandroMironeandBjornWehinger.Ab2tds.2013.url:http://ftp.esrf.fr/scisoft/AB2TDS/Introduction.html.[11]AndrewM.Rappeetal.“Optimizedpseudopotentials”.en.In:PhysicalReviewB41.2(Jan.1990),pp.1227–1230.issn:0163-1829,1095-3795.doi:10.1103/PhysRevB.41.1227.url:https://link.aps.org/doi/10.1103/PhysRevB.41.1227(visitedon05/20/2022).[12]AtsushiTogoandIsaoTanaka.“Firstprinciplesphononcalculationsinmaterialsscience”.en.In:ScriptaMaterialia108(Nov.2015),pp.1–5.issn:13596462.doi:10.1016/j.scriptamat.2015.07.021.url:https://linkinghub.elsevier.com/retrieve/pii/S1359646215003127(visitedon11/05/2020).5