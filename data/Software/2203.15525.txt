DNA KMMD

Quantum Machine Learning Corrects Classical Force Fields: Stretching
DNA Base Pairs in Explicit Solvent

Joshua T. Berryman∗,1 Amirhossein Taghavi,1 Florian Mazur,1, a) and Alexandre Tkatchenko1
Department of Physics and Materials Science, University of Luxembourg, L-1511 Luxembourg City,
Luxembourg.

(*Electronic mail: josh.berryman@uni.lu)

(Dated: 12 September 2022)

In order to improve the accuracy of molecular dynamics simulations, classical force ﬁelds are supplemented with a
kernel-based machine learning method trained on quantum-mechanical fragment energies. As an example application,
a potential-energy surface is generalised for a small DNA duplex, taking into account explicit solvation and long-range
electron exchange–correlation effects. A long-standing problem in molecular science is that experimental studies of
structural and thermodynamic behaviour of DNA under tension are not well conﬁrmed by simulation; study of the
potential energy versus extension taking into account a novel correction shows that leading classical DNA models have
excessive stiffness with respect to stretching. This discrepancy is found to be common across multiple forceﬁelds. The
quantum correction is in qualitative agreement to the experimental thermodynamics for larger DNA double helices,
providing a candidate explanation for the general and long-standing discrepancy between single molecule stretching
experiments and classical calculations of DNA stretching. The new dataset of quantum calculations should facilitate
multiple types of nucleic acid simulation, and the associated Kernel Modiﬁed Molecular Dynamics method (KMMD)
is applicable to biomolecular simulations in general. KMMD is made available as part of the AMBER22 simulation
software.

The deﬁnitive version of this manuscript is the publisher
postprint which is open access at J Chem Phys: https:
//doi.org/10.1063/5.0094727 .

I.

INTRODUCTION

The dominant long-range interactions in molecular sys-
tems can be treated classically with great efﬁciency as a
pairwise Coulomb term (Uc ∝ 1/r) plus a pairwise ﬂuctuating
dipole-dipole attraction (a dispersion interaction, Ud ∝ 1/r6),
with atoms represented as spheres having ﬁtted non-integer
charge and attraction parameters, both of which in theory can
be derived from ab initio quantum mechanics.1–3 Limitations
to the accuracy of this approach are especially evident when
atomic polarisability is anisotropic, or when the atoms are
part of a ﬂexible molecule in which the atomic polarisability
and the partial charge can couple to the molecular conforma-
tion. These two limitations apply very much to nucleic acids
where the charged backbone, anisotropically delocalised
electrons in the aromatic bases, polar solvent, and close
localisation of cations give a strongly many-body character to
the interatomic non-bonded forces.4,5

Although the limitations of classical forceﬁelds are un-
derstood, with large discrepancies noted in less-standard
conformations such as single stranded DNA6, due to the
complexity of nucleic acid molecules and the important role
of dispersion interactions, it has been quite difﬁcult to arrive

a)Also at: Laboratoire de Physique et Chimie Théoriques, Université de Lor-
raine, Faculté des Sciences et Technologies, Boulevard des Aiguillettes, B.P.
70239, F-54506 Vandoeuvre-les-Nancy, France.

at solid quantum benchmark calculations from which to
improve these models. Substantial progress has been made
in recent years by calculation of dispersion interactions in
an explicit many-body manner, working with tensors of
directional atom-centred polarisabilities (for example,
in
the many-body dispersion method7). This approach was
found to be quantitative for DNA stacking energies8 and
benchmarked favourably against other methods over a dataset
of
‘challenging’ noncovalent complexes including DNA
bases.9

Evaluation of potential energies of static molecular con-
formations has limited relevance to the highly dynamic
ﬁnite-temperature behaviour of biomolecules: ideally in order
to study large nucleic acid molecules in explicit solvent and
salt a potential energy surface (PES) should be deﬁned over
the nuclear coordinates. The PES must be differentiable and
inexpensive to compute, scaling better than O(N2) in the
In order to integrate the accuracy of the
number of atoms.
ab initio calculations to existing efﬁcient infrastructure of
classical forceﬁelds, a Kernel Modiﬁed Molecular Dynamics
(KMMD) approach is devised here.

The KMMD approach, described in detail below (II), uses
a kernel machine to learn not the full PES, but only the part
of the quantum correction to the classical PES susceptible
to prediction by selected internal degrees of freedom of the
nucleic acid chain.
Solvent-solvent interactions are thus
calculated as usual for the chosen classical forceﬁeld, and
solvent-DNA interactions are modiﬁed only when they can
be predicted by the DNA conformation. This is a form of
coarse-graining: degrees of freedom which are not explicitly
corrected may still be corrected on average. DNA-DNA
interactions are only modiﬁed in so far as can be predicted
from the training data, for instance because information

2
2
0
2

p
e
S
9

]
h
p
-
m
e
h
c
.
s
c
i
s
y
h
p
[

2
v
5
2
5
5
1
.
3
0
2
2
:
v
i
X
r
a

 
 
 
 
 
 
DNA KMMD

2

relating to bond lengths was excluded from the training data,
bond lengths are only improved in the KMMD as far as they
are driven by correlations with the explicitly treated torsions.
The role of solvent is signiﬁcant for nucleic acids, so it is
important to understand that although the KMMD correction
presented is not a correction to solvent interactions, because
solvent was present in the training data it is nonetheless an
implicit correction to interactions in a solvated system.

Having implemented the KMMD method, simulations
CC DNA complex (with Watson-Crick
were made of a GG
·
base pairing artiﬁcially imposed), under constant force at the
O3’ and O5’ termini, before and after quantum corrections.
The observed small reduction in the work to extend with base
pairing preserved was consistent with the large long-standing
difference between single-molecule stretching experiments
on DNA polymers and classical simulation (comparing
simulations10,11 against a review of experimental data12,
work in experiment is 50-70% of work in classical simula-
tions). While a change in work to extend single steps should
imply a change of the same sign for large polymers, for the
present prototype study only a small GG
CC complex was
·
studied, and direct experimental measurement of single-step
stretching free energies in order to make a quantitative com-
parison is non trivial. Experimental measurement of single
base stacking energy has been made for a comparable proxy
system, a nicked duplex.13 This setup is not exactly equiv-
alent to the calculation geometry however the experimental
energies are closer to the KMMD corrected calculation than
to the uncorrected (vide infra: III).

×

×
millimeters, and from seconds

Various alternative hypotheses exist in relation to the dis-
crepancy between experimental and calculated DNA exten-
sion dynamics, and not all are mutually inconsistent.
It is
possible that experimental systems contain chemical defects
not accounted for in classical simulation or by KMMD: nick-
ing of the backbone due to some form of tension-accelerated
hydrolysis, for example, or occasional base-pair mismatches
due to failure of polymerase enzymes. On the simulation
side, apart from the forceﬁeld errors documented here, there
is the problem of scaling up results from a simulation on a
nanometers scale to experiments in the world
microseconds
of seconds
millimeters to
the abstraction of a fully adiabatic, quasi-equilibrium stretch-
ing. Advanced nonequilibrium data analysis using the Jarzyn-
ski equality is often applied to make the scaling-up in
time, even when starting from the relatively long timescales
of experiment.14 A corresponding recovery of equilibrium
stretching behaviour from continuous stretching simulations
requires care and expertise;15 in DNA there are certain very
rare dynamical ﬂuctuations such as base breathing which
might well have an impact on the stretching process but which
are expected to manifest only on microsecond timescales,16
thus requiring many microseconds for effective sampling.
Finite-size thermodynamics arising through the generalisation
from small to large systems are equally subtle, and difﬁcult to
treat for a complex molecule such as DNA.17 Finally, although
the present study addresses collective electronic effects in the

×

DNA, collective electron ﬂuctuations in the solvent are not
treated beyond the nearest few molecules, and these have been
shown to be important for biomolecules up to the 20Å scale.18

II. METHODS

A. Generation of DNA Training Data

CC DNA dyad structures were sampled from ex-
69 GG
·
isting classical atomistic simulations of 24bp (24 base pair)
DNA duplexes at varying extensions documented in previ-
ous work.19 Hydrogens were added to the O5’ and O3’ ends.
Each dyad structure was solvated with 2446 TIP3P waters20
and two sodium ions (neutralising the system), and the solvent
box was then allowed to equilibrate while holding the dyads
in stiff restraints for 10ns. This classical simulation and pro-
cessing was done using AmberTools.21 The OL15 forceﬁeld22
was used. Dynamics were classical (no nuclear quantum ef-
fects were treated) allowing all atomic masses to be set to 12
amu.

From the initial 69 structures, fresh conformations were
bootstrapped from long KMMD simulations with a total time
of 1µs (sampling one per ns) to make a training set of 1000
solvated 2bp duplexes. The bootstrapping process was de-
signed as a carousel of 69 independent runs, each restrained
to have roughly constant extension O3’-O5’ and each restart-
ing after a 10ns window, to use fresh training data generated
by all previous runs. When a total of 1 microsecond dynam-
ics was achieved (1000 frames at one per nanosecond), the
bootstrapping process was stopped.

For each training snapshot, a structure of the DNA with 20
water molecules and 2 sodium ions surrounding it in a clus-
ter was created. The water molecules were selected based on
the 20 closest to any solute atom, this number was found to
be sufﬁcient such that backbone charges and solute-solvent
hydrogen bonds were always coordinated. Energies were
found for the cluster structures using density functional the-
ory (DFT) calculations with the hybrid PBE0 functional23–25
for semi-local electron exchange and correlation together with
the MBD method7,26 for long-range electron correlation inter-
actions (including van der Waals forces). The FHI-aims code
was used to converge the electron density,27 with the associ-
ated atom-centred basis sets represented at the ‘intermediate’
level where available (H, C, N, O) but at the ‘tight’ level when
intermediate basis sets were not available for the given ele-
ment (Na, P). Memory requirement for a neutralised dyad plus
20 water molecules was approximately 12GB, with conver-
gence taking approximately 12 hours on 8 cores. Two struc-
tures which did not converge within 72 hours were rejected
as having unphysical geometry, leaving 998 initial reference
DNA structures for use in the ﬁrst stage of the machine learn-
ing calculation.

DNA KMMD

B. Kernel Method for Generalisation to PES

3

{

−

The

HAMBER((cid:126)xi).

Φi((cid:126)xi)
}
{

training datapoints

were deﬁned as
the quantum and classical energies:
the residuals of
Φi = HQ((cid:126)xi)
HAMBER
Evaluations of
}
are made at the start of each run, for convenient re-use of
the quantum data across forceﬁelds. Feature extraction was
carried out in order to reduce the degrees of freedom of the
problem, by deﬁning a vector of dihedral angles (cid:126)φi((cid:126)xi) based
on the Cartesian coordinates. The canonical DNA torsions
(α, β , γ, δ , ε, ζ , χ, ν0, ν1, ν2, ν3, ν4) were collected, with one
occurrence per strand of the backbone torsions α, β , γ, ε, ζ
and two occurrences per strand of the sugar torsions δ , ν0
4
−
and the base twisting angle χ, giving a total of 38 angular
degrees of freedom to summarize the state of a base-pair
step. These are then (reversibly) expanded to vectors (cid:126)pi of
76 Cartesian degrees of freedom by taking the sin and cos of
each angular degree of freedom: (cid:126)pi = (sin(cid:126)φi, cos(cid:126)φi).

The feature space of transformed angles forms a toroidal
manifold embedded in R76. The maximum Euclidean distance
between two points is rmax = 2√38
12.3 and the average
distance between two random points is √76
8.7. For small
angular differences, the distance in feature space is very close
to the imaged distance in angular space (perturbing a single
angle by 0.1 rad implies r = 0.0996 in the feature space, 1 rad
implies r = 0.959, π rad implies 2). The PES correction at a
feature space point (cid:126)q is estimated from the training set using a
single-parameter Gaussian kernel:

≈

≈

(cid:107)

−

(cid:126)pi

(1)

−
(cid:126)pi

2/σ 2(cid:1)
(cid:107)
2/σ 2)

∑i Φi exp (cid:0)
∑i exp(

Φ((cid:126)q) =

(cid:126)q
−(cid:107)
(cid:126)q
−(cid:107)
where σ 2 := 0.1 for all results discussed here. In the limit
of small σ the PES becomes a Voronoi diagram in the fea-
ture space (losing differentiability), in the limit of large σ
the PES becomes ﬂat. For any σ the PES deals gracefully
with duplicate training points, simply averaging their contri-
butions: this is valuable because it permits degrees of freedom
not represented in the feature space to be averaged over, how-
ever the caveat is introduced that if multiple copies of training
points exist, untreated degrees of freedom should preferably
be sampled using the Gibbs measure at the target tempera-
ture for simulation. The denominator in eqn. 1 is treated as
an empirical conﬁdence value for a given point evaluation.
This kernel method, a minor variation of the extant family of
kernel methods, is referred to as a ‘Normalised Radial Ba-
sis Function’ (‘nRBF’) kernel machine, or equivalently as a
nRBF network.28

To calculate the force, ﬁrst deﬁne pi,d as the displacement
of point i in dimension d in the Cartesian feature space
i, having
from the reference position of training point
D treated dihedral angles.
2],
pi,d = cos φi,d/2 −
1],
i,d/2;
pi,d = sin φi,(d
1)/2 −
−

For even d
for odd d
1)/2. R2
i = ∑d

[0, 2..2D
−
[1, 3...2D
−
1] p2
i,d.
−

cos φ 0
sin φ 0
i,(d

−
We write a "weight" for the ith training point, wi as:

∈
∈

[0,2D

∈

wi = exp

i /σ 2
R2

−

The normalisation term follows:

Z = ∑
i

wi

The energy delta:

∑i Φiwi
Z
Differentiating, using a primed notation for the partial
:

derivative of a function in dimension d for point i: f (cid:48) = ∂ f
∂ pi,d

Φ =

w(cid:48) =

2pi,dwi/σ 2

−

Z(cid:48) = w(cid:48)

Following the quotient rule:

Φ(cid:48) =

Φiw(cid:48)Z

−

Z(cid:48) ∑i Φiwi
Z2
2pi,dwi/σ 2:

−

Substituting Z(cid:48) = w(cid:48) =

Φ(cid:48) =

2pi,dwi

−

ΦiZ

∑i Φiwi

−
σ 2Z2

Substituting Φ = ∑i Φiwi/Z:

Φ(cid:48) =

2pi,dwi

−

(Φi

Φ)

−
σ 2Z

(2)

The Cartesian feature space has dimension 2D, where D
is the number of torsions studied. Forces are not in general
tangent to the subspace of the Cartesian space which can be
mapped directly back to the space of angles, therefore they
are projected onto the subspace. By construction, the force
gradients are linear with respect to individual training points
and angles, but must be treated in pairs for the purpose of
projection back to the subspace of dihedral angles. The 2D
unit radius vector corresponding to angle φi,d for d
[1, D] is
already known as:

∈

ˆ(cid:126)ui,d = cos φi,d ˆ(cid:126)e1 + sin φi,d ˆ(cid:126)e2

ˆ(cid:126)ui,d = pi,2d ˆ(cid:126)e1 + pi,2d+1

ˆ(cid:126)e2

to project orthogonal to a unit vector we subtract a term

scaled by the inner product:

( ˆ(cid:126)ui,d
This vector can then be converted directly to an angular

(cid:126)Φ(cid:48)d ←

(cid:126)Φ(cid:48)d) ˆ(cid:126)ui,d

(cid:126)Φ(cid:48)d −

(3)

·

force.

DNA KMMD

C. Validation of Machine Learning Approach

FIG. 1. Validation of KMMD implementation (a) against related
machine learning methods, including a conventional nRBF (b) with
weights Φi as trained parameters. Performance is tested against un-
seen validation data for increasing amounts of seen training data. The
basic KMMD approach is stable with respect to parameters and per-
forms well.

Validation of the KMMD approach was carried out by sub-
sampling a set of 1232 frames, then evaluating the trained
system against the remaining unseen frames. Mean Absolute
Error (MAE) values shown are averages over ﬁve indepen-
dent selections of training/test sets, noise is greater for larger
training sets due to the smaller validation sets. The KMMD
was robust at predicting energies regardless of the σ 2 param-
eter and made more efﬁcient use of training data than the
other, more sophisticated, approaches. The “normalised Ra-
dial Basis Function Network” (nRBF) has an identical func-
tional form to that of the KMMD (eqn. 1) except in that the
Φi are not training point energies, but arbitrary values ﬁxed
by a least-squares ﬁt to the training data.29 In theory this ﬁt-
ting should allow a performance improvement, however with
a relatively modest number of training points (as in this ex-
ample, where the number of centres is still small enough to
be computationally cheap at evaluation time), then there is no
gain and potentially some minor loss due to under-constraint
of the ﬁtting problem. Relaxing the constraint that the weights
should be normalised (removing the denominator of eqn. 1)
converts the system to a standard RBF network, this removal
of a constraint gives even greater freedom in ﬁtting however
no beneﬁt was observed.

Kernel Ridge Regression (KRR) is a generalisation of the
RBF network which has been used successfully to ﬁt atom-
isation energies of small molecules in vacuo using a feature
space constructed around the Coulomb Matrix of atom-atom
x
distances30, the Laplacian kernel e−|
| recommended in this
related example was tested in the present feature space and
found to perform about as well as the Gaussian nRBF for some
choices of the KRR regularisation parameter α. Although the

4

KMMD performed best on the present dataset, all methods
have the potential for optimisation and for efﬁciency gains
against larger datasets. In the present examples all training
points became nodes of the evaluation, for larger training sets
it is possible to merge or prune training points, or even to use
non-physical constructed points as RBF centres, gaining efﬁ-
ciency at evaluation time in exchange for a small or zero loss
of accuracy.

D. Constant Force Simulations

,O3(cid:48)

In order to monitor the inﬂuence of extensional force on the
DNA dynamics, 36 parallel simulation replicates were pre-
pared with the four terminus atoms G,C@O5(cid:48)
subjected
to constant-force restraints of strengths (15, 20..185, 190) pN,
oriented towards ﬁxed sites at the top and bottom of the sim-
ulation box. Each replicate was equilibrated in a box of 2446
TIP3P water molecules and 2 sodium ions for 50ns. During
equilibration, frames evaluated with a low conﬁdence (small
denominator of eqn. 1) were saved, and those points with the
lowest conﬁdence were used to augment the training set to
1232 frames. In production, force-extension time series were
collected for 1500ns per replicate, with a 1fs timestep.

The calculation was run with DNA bases restrained to
Watson-Crick pairing, following standard B-DNA geometry31
with the intention to therefore focus on the behaviour of stack
interactions. In detail the restraints were such that there was
no energy penalty for the proton-acceptor pairs G@N1H-
C@N3, G@NH2-C@O, C@H2-G@O to be within distances
0.2Å of their equilibrium values, 1.94Å, 1.85Å, 2.95Å.
±
Beyond these ranges, harmonic restraints were imposed with
2, for a further 0.5Å,
a spring constant of 20 kcal mol−
after which restraints became constant-force. For the two
stronger hydrogen bonds, G@N1-C@N3 and C@N-G@O
donor-acceptor distance restraints were also added with the
same pattern, at equilibrium distances 2.5Å and 2.51Å, thus
(weakly) enforcing planarity of the base pairs.

1 Å−

E. Equilibrium Potential of Mean Force Calculations

As an examination of the equilibrium behaviour of the
KMMD calculation, potentials of Mean Force (PMF) over
ε, ζ , χ dihedral angles were calculated using sets of multi-
ple parallel simulations with and without KMMD. Sampling
was enhanced using the technique of Hamiltonian Replica Ex-
change (HREMD) within the sets of 120 simulations, which
individually sampled umbrellas spaced 3 degrees apart in the
torsion for which the given PMF was desired. Umbrella tor-
sion restraints were harmonic with the spring constant 250
2. The two chains were kept together using
kcal mol−
a weak ﬂat-bottomed distance restraint between the two phos-
phorous atoms, with zero force at distances between 20Å and
30Å but a harmonic force with a spring constant of 20 kcal
2 thereafter. Exchange ﬂux between replicas was
mol−
veriﬁed as leading to a physically credible free energy distri-

1 rad−

1 Å−

DNA KMMD

5

bution, however the PMF were calculated using the Weighted
Histogram Analysis Method (WHAM), implemented using
the utility distributed by Alan Grossﬁeld.32

≈

Replica exchange runs were chunked into sections of 10 ps
(10000 steps of 1 fs each). Each chunk had 2000 cycles of ex-
change attempts (one per 5 MD steps), with an average accep-
tance rate r
0.3. The ﬁrst chunk for each run was discarded
as equilibration, and the subsequent two were used as produc-
tion runs. A Langevin thermostat with a temperature of 300
1 was applied to accelerate
Kelvin and a coupling rate of 1 ps−
divergence between the 120 replicas in each set. Implicit sol-
vent was applied using a Generalised Born solvation model.33
No cutoff was applied to the non-bonded interactions. When
errorbars were calculated with the assumption of a decorrela-
tion time (per replica) equal to 100 fs, or 20 cycles of replica
exchange, these appeared as almost too small to be visible.
Production runs for each equilibrium calculation comprised
in total 120
20 ps, or 2.4 ns, of dynamics with HREMD-
accelerated sampling.

×

III. RESULTS

A. Correction versus Multiple Forceﬁelds

Stretching simulations were made against the OL15 force-
ﬁeld, which is considered to be among the best classical DNA
models at time of writing,34 however it was found prudent to
make a survey of multiple forceﬁelds in order to conﬁrm that
the deﬁciency in treating stacking is general (ﬁg. 2). The bsc1
forceﬁeld35 was therefore compared against OL15 by post-
processing snapshots taken from the KMMD simulations. The
DESRES reﬁnement of non-bonded interaction parameters for
nucleobases36 was also checked, using the OL15 bonded and
other non-speciﬁed parameters (‘OL15DES’).

Firstly snapshots were ordered by the length of the av-
erage vector between chain-adjacent bases measured at the
N atoms where the chain joins the backbone (ﬁg. 2a), in
this case the behaviour around the minimum remained un-
changed by adding KMMD, although the potential became
apparently stiffer for large separation of the bases. The min-
imum appeared very sharp with ff99, whether corrected or
not, this effect arises because all frames were generated using
OL15+KMMD and are therefore close to the energy minima
or valleys as deﬁned by that PES, other forceﬁelds may have
similar features but subject to slight geometry shifts, there-
fore giving apparently stiffer potentials. When lengths x were
measured using the terminus atoms O5’-O3’ (ﬁg. 2b) an in-
crease in the equilibrium length of the duplex was observed.
0.25Å was independent of the base classical
This shift of
forceﬁeld, and was associated with an continued softening of
the potential with respect to further extension. All three force-
ﬁelds performed similarly for snapshots having small end-to-
end length x, at large x the bsc1 forceﬁeld had the small-
est over-estimate of pulling energy. The differences between
the forceﬁelds seem to be largely independent of the KMMD
correction: all were altered by the KMMD by quite similar
amounts.

≈

Postprocessing frames with different forceﬁelds shows
FIG. 2.
that the differences between them are largely independent of the
larger errors ﬁxed by using the KMMD Machine Learning correc-
tion (marked as ‘ML’). (a): Base-base distance (measured N9-N9 or
N1-N1) shows moderate effects, with ML slightly increasing stiff-
ness, but only when far from the minimum. (b): Extension measured
between the O5’ and O3’ termini is noticeably softer after correc-
tion, and has a shifted minimum, regardless of the starting forceﬁeld,
in a seeming conﬂict with the tendency of bases to resist having large
separation.

B. Modulations of Collective Dynamics

The purpose of the KMMD correction to the forceﬁeld is
not primarily to moderate individual dihedral potentials, but
to treat collective interactions in molecules with multiple soft
torsions. Fig. 3 compares structural correlations in the DNA
duplex under stretch with and without the ML correction. A
basic probe of correlation is to collect the proportion of frames
in which the χ angles adjacent on the chain were both in
the same energy basin (of three available, as determined by
the tetrahedral C1’ atom at which the base joins the sugar).
As expected, the C3:C4 stacked pair of bases has an overall
smaller chance for adjacent χ angles to be in the same min-
imum than does the G1:G2 stack, due to the smaller size of
the C base. For both stacks, there is a changeover in the effect
of the KMMD with increasing extension: at short extension,
KMMD destabilises the base stack relative to standard MD
with the OL15 forceﬁeld, while at higher extension, ordering
of bases increases for all systems, but especially so with the
KMMD (Fig. 3b). This signal is consistent with stabilisation
of edge-edge interactions by the KMMD when under imposed
extension, as investigated in ﬁgures (5, 6).

As simulations were run at constant force it is proper to
show the force-extension curve (Fig. 3c), although this ob-
servable is noisy and subject to ﬁnite size effects it does sup-
port a reduction of the work to extend the DNA base step, re-
ducing the discrepancy against the lower work to force-melt
macroscopic DNA typically seen in experiment relative to
simulation. Although the KMMD force-extension trace ap-
pears visually to be ﬂatter than the uncorrected trace, an out-
lier point at 90 pN has the effect of giving almost equal values
for the work to extend from 8Å to 10Å when a simple integra-
1
tion is performed using the trapezium rule (1.69 kcal mol−
1 without). If the offend-
with KMMD versus 1.72 kcal mol−
ing datapoint is removed, the corrected work becomes 1.56
1, giving a difference which is still quite small in
kcal mol−

DNA KMMD

6

(a) The CC chain of the GG

FIG. 3.
CC duplex, with backbone
·
and χ torsions labelled. The four atoms deﬁning each χ are shown
with green highlight lines. (b) Base-base interactions versus exten-
sion: proportion of χ angles on the same chain to be in the same
basin. At short extension, KMMD gives less correlation between ad-
jacent χ, at long extension KMMD strengthens the correlation. (c)
Force-extension. Points are independent constant-force simulations;
lines are a moving average. (d): Change in covariance of dihedrals,
KMMD-MD, over all extensions. Signiﬁcant signals for χ and for
torsions adjacent to central phosphate.

absolute terms but signiﬁcant as a fraction of the total work
to stretch the base-pair step. The experimental value given by
Yakovchuk et al.13 for the base pair stacking energy of GG
CC
·
1 at a salt
at 300K is salt-dependent, giving 1.5
concentration of 45mM, equivalent to the selected 2Na+ in
2446 water.

0.1 kcal mol−

±

−

−

¯θ1)(θ2

Fig. 3d gives a sketch of the pairwise torsion angle cor-
relations most affected by the KMMD correction. Covari-
ance C1,2 of a pair of dihedrals θ1, θ2 is deﬁned here as
¯θ2) in units radians squared (the means ¯θi are
(θ1
found as arctan2(cos θi, sin θi)). The (signed) differences in
the absolute values of the covariances
are
shown in ﬁg. 3d as a heatmap. Overall the KMMD correction
promotes disorder (negative delta covariance, orange) how-
ever covariance between some torsions is (more weakly) in-
creased (positive delta, grey), in particular involving χ and ζ
angles. The β angle linking G bases becomes more covariant
(grey) while the β angle linking the C bases becomes much
less covariant, and more disordered.

CKMMD
|

CMD

| − |

|

C. Conformational Analysis

The strength of the ML method is that second-order and
higher correlations between torsion angles are treated, how-
ever it is still instructive to project onto individual torsions
in order to see which conformations of the duplex are sta-
bilised/destabilised relative to classical forceﬁelds. In order
to compare the ML corrected forceﬁeld with traditional nu-

FIG. 4. Potentials of mean force (PMF) for key dihedrals, sampled
without any stretching or WC bonding imposed.

cleic acid forceﬁelds, a series of replica exchange calculations
were made (REMD) at zero imposed force and without hy-
drogen bond restraints, generating equilibrium potentials of
mean force (PMFs). Three of the most important dihedral an-
gles were examined, the ε and ζ joining two G bases, and the
χ angle of the ﬁrst G. The qualitative picture was instructive:
from the point of view of individual dihedral angles (as op-
posed to correlations between them) the KMMD correction is
a step backwards through time. Qualitatively, a 1-dimensional
view of the KMMD correction seems to show it as operat-
ing in the opposite direction to a recently proposed correc-
tion to the AMBER ff10 forceﬁeld,37 modifying the shapes
of the free energy landscapes over the relevant dihedrals with
the opposite sign relative to the original ff1038,39 (ff10 is a
recent ancestor of the OL1522 starting point for the present
study). The correction of Aytenﬁsu et al. did not alter the
functional form of the forceﬁeld but did re-ﬁt with a much
wider range of nucleic acid construct structures, with the nov-
elty being that many structures drawn from crystallographic
data were used, as well as the typical systematic rotations of
dihedral angles in otherwise canonical structures. This use of
crystallographic data selectively well-ﬁts ordered structures.
In the KMMD-corrected simulation, with training data drawn
from highly disordered non-equilibrium structures, the less-
dominant syn conformation for the χ angle was relatively sta-
bilised, individually promoting disorder in the base confor-
mation even though it is clear from ﬁg. 3 that collective or-
der/disorder in base stacking without stretch is not much al-
tered by KMMD. Training set bias is therefore less important
when using KMMD because it is possible for a given dihe-
dral to be both stabilised and destabilised at the same angle,
depending on conformations of other dihedrals elsewhere in
the system. The 1D PMFs for ε and ζ appear, in constrast to
χ, to be order-stabilising in the KMMD without stretch, and
this is consistent with the variance-covariance plot of ﬁg. 3d
showing small or negative changes in the individual variances
of these angles under stretch with the correction applied. This
is accentuated by a positive (gray) covariance between the ad-
jacent ε and ζ angles: decreased individual variance coupled
to increased covariance indicates an overall reduction of en-

γδ(cid:15)ζαβγδO5’O3’N1N1χC3χC4(a)8910Length[˚A]0.40.60.81.0χmatches:p(χi=χi+1)(b)G1:G2KMMDG1:G2MDC3:C4KMMDC3:C4MD8910Length[˚A]255075100125Force[pN](c)KMMDMDγδ(cid:15)ζχαβγδχγδ(cid:15)ζχαβγδχγδ(cid:15)ζχαβγδχγδ(cid:15)ζχαβγδχDeltaCovarianceoftorsionsG1:G2G1:C3G1:C4G2:C3G2:C4C3:C4(d)−1.00.00.5−90090180(cid:15)◦02468PMF[kcal/mol](a)OL15OL15+ML−90090180ζ◦(b)−90090180χ◦(c)DNA KMMD

7

tropy associated to the backbone degrees of freedom with-
out imposed stretch. The behaviour of the χ
χ couplings
versus stretch in ﬁg. 3b indicate however a slight increase of
base-stack entropy at low or no imposed stretch, so we can
state that the classical forceﬁelds have at equilibrium a slight
under-stiffening of the backbone and a slight over-emphasis
on base-base interactions or on the stiffness of the χ angles
which also control base positioning.

−

These data do not imply a simple revision of the exist-
ing backbone torsion potentials, and a re-ﬁtting of individ-
ual dihedral angle potentials such that they could agree with
the KMMD 1D-PMFs would land close to the AMBER ff10,
which is after more than a decade now regarded as relatively
obsolete even among traditional forceﬁelds. What is shown
however is that conﬂicting sets of training data (the dihedral
scans which generated ff10 and the crystallographic structures
which contributed to the Aytenﬁsu et al. correction) can be
reconciled by considering a larger number of degrees of free-
dom together. Collective dihedral angle corrections can indi-
rectly address errors arising from the other terms of the force-
ﬁeld: the example of the steric clash between the hydrogen at-
tached to the Guanine C8 (or to any purine C8 Hydrogen) and
the pentose O4’ is investigated by permuting the angles la-
belled in ﬁg. 5(a). Although the Pauli exclusion which drives
the sharp increase of energy as atoms approach overlap is not
addressed directly by the KMMD correction; because molecu-
lar geometry is determined predominantly by dihedral angles,
it is possible to indirectly address a clash which the standard
classical treatment misses.

1D and 2D cuts holding other angles ﬁxed. (a) Strand 1
FIG. 5.
(GG) of the dyad, showing angles permuted in the conformation ex-
amined. (b) A steric clash (red and white spheres, inset foreground)
140◦ is penalised more harshly by the ML method. (c) A
at χ =
highly extended conformation (* and inset) is strongly favoured by
the ML.

−

D. Conformations of Greatest Deviation

Analysing the individual conformations with the greatest
differences between KMMD and classical treatment interro-
gates the limitations of classical methods and helps to moti-
vate the operation of the method. The top 100 structures with
large favourable corrections following KMMD are dominated
by conformations showing roughly 90◦ base-base interactions
(the single most-favoured conformation is shown in ﬁg. 6).

FIG. 6.
A conformation highly favoured by the ML relative to
the uncorrected OL15 forceﬁeld. Hydrogen bonding is preserved
and bases on the same strand remain (sometimes/partly) in contact
despite a large vertical stretch.

We refer to stretched duplex geometries with mostly-
preserved hydrogen bonding and partly-preserved stacking
(subject to tilt and slide) as ‘τ-steps’19, these have been put
forward among various candidate geometries for stretched
DNA since the earliest molecular mechanics studies40, and
CC pairs in recent classi-
linked speciﬁcally to stretched GG
·
cal MD work41; our primary structural observation into DNA
under tension therefore is that the posited τ-step conforma-
tion is conﬁrmed, and that this is very much more favourable
than found when modelled classically. The strength of this
interaction geometry is not inconsistent with the chemical un-
derstanding of 90◦ interactions between aromatic molecules
with hydrogen bonding groups at the edges, in general dis-
cussed as ‘remarkably strong’42, although the canonical T-
shape aromatic geometry is typically presented as edge-face
rather than edge-edge. The lack of directionality imposed by a
pointlike treatment of classical atoms leaves little hope of cor-
rectly treating the highly directional combination of hydrogen
bonding and aromatic stacking in the framework of current
mainstream forceﬁelds.

E. Outlook

Distillation of ab initio quantum mechanical calculations
on fragments into a smooth potential energy surface was
successful in this initial example, demonstrating integration
of machine-learned physics for short-range interactions with
classical modelling of longer-range Coulomb and pairwise
dispersion physics, as well as classical treatment of solvent
and of stiffer short-range degrees of freedom (bond lengths
and angles) not strongly affecting the geometry. Generalisa-
tion to long chains as a sum of overlapping fragments does
not seem in principle to be a major challenge, nor does gen-
eralisation to a wider array of treated repeating units such
as amino acids or RNA. Classical MD simulations corrected
with KMMD were able to provide a qualitatively correct al-
teration to the force-extension behaviour of a small DNA con-
struct, bringing results more closely into line with experiment.
KMMD does not as applied here treat chemical effects, col-
lective electron dynamics in the solvent, or convergence errors
due to rare ﬂuctuations; however by application of Occam’s
razor following the results presented here we may reduce our

*−90090180χ1010203040U[kcal/mol]∗UOL15UOL15+∆UML−90090180(cid:15)1−90090180ζ1*BDNA*−30−20−10010∆UML[kcal/mol](a)(b)(c)DNA KMMD

8

concern in relation to these potential sources of error.

The KMMD concept as described here does ultimately have
well-deﬁned limitations, arising in particular from the fact that
non-bonded interactions are treated indirectly only. It is en-
tirely feasible to construct an augmented feature space con-
taining two-body or N-body distance information as well as
the angular information treated in the present implementation,
indeed this has been done for kernel methods targeting smaller
molecules,30 however there are always costs for adding com-
plexity. Development of accuracy and generality for kernel-
modiﬁed MD is likely to continue in the near future by con-
sidered design of the feature space in which the kernel oper-
ates, and the thoughtful integration of physics which can be
calculated cheaply and well from ﬁrst principles with physics
which is best treated through machine learning.

KMMD was shown to modify DNA dynamics with a qual-
itatively correct reduction of the force to extend a small two-
base pair construct in water, of the correct sign such that it can
now be hoped that simulations of larger systems will manifest
thermodynamics (and perhaps structure) in line with exper-
iment. The putative biologically relevant conformations for
many-base pair DNA which have been suggested from experi-
mental data in relation to stretching19,43 and also to hydropho-
bic denaturants44 were not susceptible to be conﬁrmed or de-
nied by this study, in particular the hypothetical Σ phase of
DNA in which symmetry is broken with a three-bp periodic-
ity is obviously not susceptible to direct study by simulations
of 2bp only.

ACKNOWLEDGMENTS

The experiments presented in this paper were carried out
using the HPC facilities of the University of Luxembourg.45
Supported by the Luxembourg National Research Fund (FNR)
grant C20/MS/14769845/BroadApp.

DATA AVAILABILITY STATEMENT

Software to carry out

the KMMD and other calcula-
tions is available from ambermd.org as a part of the
AmberTools 22 package.46 The dataset of quantum en-
ergy evaluations generated for this work is available from
the NOMAD database under a Document Object Identi-
ﬁer: https://dx.doi.org/10.17172/NOMAD/2022.04.
25-110.17172/NOMAD/2022.04.25-1.

1F.-Y. Dupradeau, A. Pigache, T. Zaffran, C. Savineau, R. Lelong, N. Grivel,
D. Lelong, W. Rosanski, and P. Cieplak, Phys. Chem. Chem. Phys. 12,
7821 (2010).
2P. Bleiziffer, K. Schaller, and S. Riniker, J. Chem. Inf. Model. 58, 579
(2018).
3A. Tkatchenko and M. Schefﬂer, Phys. Rev. Lett. 102, 073005 (2009).
4J. Šponer, J. Leszczy´nski, and P. Hobza, J. Phys. Chem. 100, 5590 (1996).
5J. Šponer, K. E. Riley, and P. Hobza, Phys. Chem. Chem. Phys. 10, 2595
(2008).
6C. Nganou, S. D. Kennedy, and D. W. McCamant, J. Phys. Chem. B 120,
1250 (2016).
7A. Tkatchenko, R. A. DiStasio Jr., R. Car, and M. Schefﬂer, Phys. Rev.
Lett. 108, 236402 (2012).

8R. A. DiStasio Jr., O. A. von Lilienfeld, and A. Tkatchenko, Proc. Natl.
Acad. Sci. U.S.A. 109, 14791 (2012).
9Y. S. Al-Hamdani and A. Tkatchenko, J. Chem. Phys. 150, 010901 (2019).
10S. A. Harris, Z. A. Sands, and C. A. Laughton, Biophys. J. 88, 1684 (2005).
11D. R. Roe and A. M. Chaka, J. Phys. Chem. B 113, 15364 (2009).
12C. Bustamante, S. B. Smith, J. Liphardt, and D. Smith, Curr. Opin. Struct.

Biol. 10, 279 (2000).

13P. Yakovchuk, E. Protozanova, and M. D. Frank-Kamenetskii, Nucleic

Acids Res. 34, 564 (2006).

14J. Liphardt, S. Dumont, S. B. Smith, I. Tinoco, and C. Bustamante, Science

296, 1832 (2002).

15S. Park, F. Khalili-Araghi, E. Tajkhorshid, and K. Schulten, J. Chem. Phys.

119, 3559 (2003).

16R. Galindo-Murillo, D. R. Roe, and T. E. Cheatham, Biochim. Biophys.
Acta Gen. Subj. 1850, 1041 (2015), recent developments of molecular dy-
namics.

17M. Manghi, J. Palmeri, and N. Destainville, J. Phys.: Condens. Matter 21,

034104 (2008).

18M. Stöhr and A. Tkatchenko, Sci. Adv. 5 (2019).
19A. Taghavi, P. van der Schoot, and J. T. Berryman, Q. Rev. Biophys. 50

(2017).

20W. L. Jorgensen, J. Chandrasekhar, J. D. Madura, R. W. Impey, and M. L.

Klein, J. Chem. Phys. 79, 926 (1983).

21D. Case, K. Belfon, S. Ben-Shalom, S. Brozell, D. Cerutti, T. Cheatham III,
V. Cruzeiro, T. Darden, R. Duke, G. Giambasu, M. Gilson, H. Gohlke,
A. Goetz, R. Harris, S. Izadi, S. Izmailov, K. Kasavajhala, A. Ko-
valenko, R. Krasny, T. Kurtzman, T. LEe, S. LeGrand, P. Li, C. Lin,
J. Liu, T. Luchko, R. Luo, V. Man, K. Merz, Y. Miao, O. Mikhailovskii,
G. Monard, H. Nguyen, A. Onufriev, F. Pan, S. Pantano, R. Qi, D. Roe,
A. Roitberg, C. Sagui, S. Schott-Verdugo, J. Shen, C. Simmerling,
N. Skrynnikov, J. Smith, J. Swails, R. Walker, J. Wang, L. Wilson, R. Wolf,
X. Wu, Y. Xiong, Y. Xue, D. York, and K. PA, University of California,
San Francisco (2020).

22M. Zgarbová, A. M. Rosnik, F. J. Luque, C. Curutchet, and P. Jureˇcka, J.

Comput. Chem. 36, 1874 (2015).

23J. P. Perdew, M. Ernzerhof, and K. Burke, J. Chem. Phys. 105, 9982 (1996).
24C. Adamo and V. Barone, J. Chem. Phys. 110, 6158 (1999).
25X. Ren, P. Rinke, V. Blum, J. Wieferink, A. Tkatchenko, A. Sanﬁlippo,

K. Reuter, and M. Schefﬂer, New J. Phys. 14, 053020 (2012).

26A. Ambrosetti, A. M. Reilly, R. A. DiStasio Jr., and A. Tkatchenko, J.

Chem. Phys. 140, 18A508 (2014).

27V. Blum, R. Gehrke, F. Hanke, P. Havu, V. Havu, X. Ren, K. Reuter, and

M. Schefﬂer, Comput. Phys. Commun. 180, 2175 (2009).
28J. Moody and C. J. Darken, Neural Comput. 1, 281 (1989).
29G. Bugmann, Neurocomputing 20, 97 (1998).
30K. Hansen, G. Montavon, F. Biegler, S. Fazli, M. Rupp, M. Schefﬂer, O. A.
von Lilienfeld, A. Tkatchenko, and K.-R. Müller, J. Chem. Theory Com-
put. 9, 3404 (2013).

31W. Saenger, “Principles of nucleic acid structure,” (Springer, 1984).
32A. Grossﬁeld, WHAM: the weighted histogram analysis method (2002).
33H. Nguyen, D. R. Roe, and C. Simmerling, J. Chem. Theory Comput. 9,

2020 (2013).

34P. D. Dans, I. Ivani, A. Hospital, G. Portella, C. González, and M. Orozco,

Nucleic Acids Res. 45, 4217 (2017).

35I. Ivani, P. D. Dans, A. Noy, A. Pérez, I. Faustino, A. Hospital, J. Walther,

P. Andrio, R. Goñi, A. Balaceanu, et al., Nat. Methods 13, 55 (2016).

36D. Tan, S. Piana, R. M. Dirks, and D. E. Shaw, Proc. Natl. Acad. Sci.

U.S.A. 115, E1346 (2018).

37A. H. Aytenﬁsu, A. Spasic, A. Grossﬁeld, H. A. Stern, and D. H. Mathews,

J. Chem. Theory Comput. 13, 900 (2017).

38A. Pérez, F. J. Luque, and M. Orozco, J. Am. Chem. Soc. 129, 14739

(2007).

39M. Zgarbová, M. Otyepka, J. Šponer, A. Mládek, P. Banáš, T. E. Cheatham,

and P. Jureˇcka, J. Chem. Theory Comput. 7, 2886 (2011).

40A. Lebrun and R. Lavery, Nucleic Acids Res. 24, 2260 (1996).
41J. W. Shepherd, R. J. Greenall, M. Probert, A. Noy, and M. Leake, Nucleic

Acids Res. 48, 1748 (2020).

42L. R. Rutledge and S. D. Wetmore, J. Chem. Theory Comput. 4, 1768

(2008).

DNA KMMD

9

43N. Bosaeus, A. Reymer, T. Beke-Somfai, T. Brown, M. Takahashi,
and B. Nordén, Q. Rev. Biophys. 50

P. Wittung-Stafshede, S. Rocha,
(2017).

44B. Feng, R. P. Sosa, A. K. F. Mårtensson, K. Jiang, A. Tong, K. D. Dorfman,
M. Takahashi, P. Lincoln, C. J. Bustamante, F. Westerlund, and B. Nordén,
Proc. Natl. Acad. Sci. U.S.A. 116, 17169 (2019).

45S. Varrette, P. Bouvry, H. Cartiaux, and F. Georgatos, in Proc. of the 2014
Intl. Conf. on High Performance Computing & Simulation (HPCS 2014)
(IEEE, Bologna, Italy, 2014) pp. 959–967.

46D. Case, H. Aktulga, K. Belfon, S. Ben-Shalom, J. Berryman, S. Brozell,
D. Cerutti, T. Cheatham III, G. Cisneros, V. Cruzeiro, T. Darden, R. Duke,
G. Giambasu, M. Gilson, H. Gohlke, A. Goetz, R. Harris, S. Izadi, S. Iz-
mailov, K. Kasavajhala, M. Kaymak, E. King, A. Kovalenko, T. Kurtzman,
T. Lee, S. LeGrand, P. Li, C. Lin, J. Liu, T. Luchko, R. Luo, M. Machado,
V. Man, M. Manathunga, K. Merz, Y. Miao, O. Mikhailovskii, G. Monard,
H. Nguyen, K. O’Hearn, A. Onufriev, F. Pan, S. Pantano, R. Qi, A. Rah-
namoun, D. Roe, A. Roitberg, C. Sagui, S. Schott-Verdugo, A. Shajan,
J. Shen, C. Simmerling, N. Skrynnikov, J. Smith, J. Swails, R. Walker,
J. Wang, J. Wang, H. Wei, R. Wolf, X. Wu, Y. Xiong, Y. Xue, D. York,
S. Zhao, and P. Kollman, University of California, San Francisco (2020).

