SMuRF Tone-Tracking Electronics

SLAC Microresonator RF (SMuRF) Electronics:
A tone-tracking readout system for superconducting microwave resonator
arrays

Cyndia Yu,1, 2, a) Zeeshan Ahmed,2, 3 Josef C. Frisch,3 Shawn W. Henderson,2, 3 Max Silva-Feaver,4 Kam Arnold,4
David Brown,3 Jake Connors,5 Ari J. Cukierman,1, 2 J. Mitch D’Ewart,3 Bradley J. Dober,5 John E. Dusatko,3
Gunther Haller,3 Ryan Herbst,3 Gene C. Hilton,5 Johannes Hubmayr,5 Kent D. Irwin,1, 3 Chao-Lin Kuo,1, 3 John
A.B. Mates,5 Larry Ruckman,3 Joel Ullom,5 Leila Vale,5 Daniel D. Van Winkle,3 Jesus Vasquez,3 and Edward
Young1, 2
1)Department of Physics, Stanford University; Stanford, CA 94305; USA
2)Kavli Institute for Particle Astrophysics and Cosmology; Stanford, CA 94305; USA
3)SLAC National Accelerator Laboratory; Menlo Park, CA 94025; USA
4)Department of Physics, University of California San Diego; La Jolla, CA 92093; USA
5)National Institute of Standards and Technology; Boulder, CO 80305; USA

(Dated: 24 August 2022)

We describe the newest generation of the SLAC Microresonator RF (SMuRF) electronics, a warm digital control
and readout system for microwave-frequency resonator-based cryogenic detector and multiplexer systems such as mi-
crowave SQUID multiplexers (µmux) or microwave kinetic inductance detectors (MKIDs). Ultra-sensitive measure-
ments in particle physics and astronomy increasingly rely on large arrays of cryogenic sensors, which in turn necessitate
highly multiplexed readout and accompanying room-temperature electronics. Microwave-frequency resonators are a
popular tool for cryogenic multiplexing, with the potential to multiplex thousands of detector channels on one readout
line. The SMuRF system provides the capability for reading out up to 3328 channels across a 4-8 GHz bandwidth.
Notably, the SMuRF system is unique in its implementation of a closed-loop tone-tracking algorithm that minimizes
RF power transmitted to the cold ampliﬁer, substantially relaxing system linearity requirements and effective noise
from intermodulation products. Here we present a description of the hardware, ﬁrmware, and software systems of the
SMuRF electronics, comparing achieved performance with science-driven design requirements. We focus in particular
on the case of large-channel-count, low-bandwidth applications, but the system has been easily reconﬁgured for high-
bandwidth applications. The system described here has been successfully deployed in lab settings and ﬁeld sites around
the world and is baselined for use on upcoming large-scale observatories.

I.

Introduction

Superconducting detector technologies have enabled highly
sensitive measurements across a wide array of scientiﬁc ap-
plications, including particle physics, astronomy, cosmology,
materials science, chemistry, biophysics, and quantum infor-
mation science1–7. As the instruments making these measure-
ments move to ever-denser detector arrays to increase their
sensitivity or throughput, there is a growing need for advance-
ments in cryogenic multiplexing techniques to reduce thermal
loading at sub-Kelvin stages, cost, and integration complexity.
As an example, transition edge sensors (TESs) are a widely-
used superconducting detector technology that have been
ﬁelded in arrays with over 10,000 detector channels.8 Cryo-
genic multiplexing of TESs on ﬁelded experiments has been
achieved with time-division multiplexing (TDM)9, frequency-
division multiplexing (FDM)10, and Walsh code-division mul-
tiplexing (CDM) techniques11,12. These technologies oper-
ate at ∼MHz frequencies and achieve multiplexing factors
of O(100) sensors read out per wire, but are limited by high
cost, complexity, and/or noise penalties as they move towards
higher multiplexing factors. To achieve future science goals
which beneﬁt from larger and/or more tightly packed detector

a)Electronic mail: cyndiayu@stanford.edu

arrays, new strategies are being devised to push towards the
much larger sensor counts required.

Microwave frequency-division multiplexing techniques of-
fer one strategy for addressing these challenges by coupling
signals to superconducting microresonators on a single RF
feedline13. The high quality factors achieved by standard
superconducting nanofabrication techniques along with the
large readout bandwidth on the microwave feedline in the 0.1-
10 GHz frequency range enable O(1000) multiplexing fac-
tors on a single coaxial line.
In microwave SQUID mul-
tiplexing (µmux), each detector is inductively coupled via
an RF SQUID to a unique GHz-frequency resonator such
that detector signals correspond to shifts in the resonator’s
frequency.14,15 The resonator may also serve as both the read-
out and the detector simultaneously, as is the case for mi-
crowave kinetic inductance detectors (MKIDs), where incom-
ing photons break Cooper pairs and induce a modulation of
the resonance transmission3.
In either scheme, many res-
onators with unique resonance frequencies can be ﬁt in the
available readout bandwidth, allowing large numbers of de-
tectors to be read out on a single coaxial input/output pair.

Despite the promise of these microwave resonator based
systems, challenges in both cold and warm components had
until recently limited these systems from achieving their full
multiplexing potential. Previous implementations of µmux
have traditionally been limited by resonator spacing and band-
width achieved in fabrication. These challenges have since

2
2
0
2

g
u
A
2
2

]
t
e
d
-
s
n
i
.
s
c
i
s
y
h
p
[

1
v
3
2
5
0
1
.
8
0
2
2
:
v
i
X
r
a

 
 
 
 
 
 
SMuRF Tone-Tracking Electronics

2

been largely resolved, and resonators with high quality fac-
tors, reproducible frequency spacing, and bandwidths suit-
able for O(2000) multiplexing factors are now being consis-
tently produced.16 KID devices have similarly achieved suf-
ﬁciently uniform fabrication and post-fabrication frequency
adjustments to realize O(1000) channel multiplexing factor
arrays.17,18 For several microwave resonator-based readout
systems such as bolometric applications of µmux, which op-
erate at higher resonator drive powers, linearity of the cold
ampliﬁer and subsequent warm electronics have become im-
portant constraints in the achievable multiplexing factor.

The SLAC Microresonator RF (SMuRF) warm electron-
ics system has been designed to meet these linearity chal-
lenges and read out up to 3328 channels in a 4 GHz band.
The SMuRF provides both the RF and low-frequency signals
required to enable full operation of a microresonator-based
readout system. Here and throughout the text, we refer to RF
as the frequency regime spanning about 1-10 GHz, while DC
refers to both DC and low-frequency (up to about 1 MHz)
signals. The SMuRF system is unique in its implementation
of fast tone tracking via a closed-loop adaptive ﬁlter, which
thereby reduces power on the cryogenic ampliﬁers and RF
mixers. This in turn increases the RF dynamic range of the
electronics, allowing for improved RF linearity and increas-
ing the achievable multiplexing factor. An earlier version of
SMuRF was described demonstrating multiplexed readout of
nearly 500 µmux channels.19 SMuRF has already been used to
read out TES-coupled arrays in laboratory and ﬁeld observing
settings, achieving multiplexing factors of over 900 channels
on a single coaxial pair.20,21 This system is being used for sev-
eral upcoming Cosmic Microwave Background (CMB) exper-
iments including Simons Observatory22 and BICEP Array23.
While SMuRF was designed and optimized for the read
out of TES-coupled µmux resonators, it is ﬂexibly recon-
ﬁgureable for application to many other sensor and mi-
crowave readout technologies including KIDs, magnetic mi-
crocalorimeters (MMCs), and even potentially superconduct-
ing qubits3,24,25. Many other warm RF systems have been de-
veloped for GHz resonator read out, particularly targetting the
µmux and MKID applications.26–33 Compared to those sys-
tems, SMuRF offers signiﬁcant advantages including linear
RF performance for high channel density over a 4 GHz band-
width, integrated high-performance low-frequency signal gen-
eration, timing and data streaming integration with large-scale
experiment infrastructures, and a unique tone-tracking capa-
bility.

In this paper, we present the design and performance of the
current SMuRF electronics. We begin with a brief introduc-
tion to the superconducting resonator systems that SMuRF has
been designed to read out in Section II. We pay special atten-
tion to µmux for large-format arrays to motivate the design
needs of the readout electronics.
In Section III we outline
the system requirements driven by the science goals and de-
sign constraints in anticipated applications. We follow with an
overview of the system in Section IV and descriptions of its
hardware and ﬁrmware in Sections V and VI respectively. We
brieﬂy describe the data streaming system, integration with
instrument control systems, and the end user software envi-

ronment in Section VII. Finally, we present the system per-
formance in Section VIII, in particular demonstrating that the
SMuRF system meets or exceeds its design goals.

II. Superconducting Resonator Readout

There are many scientiﬁc applications that utilize super-
conducting microwave resonators as the sensing and/or read-
out element for ultra-sensitive circuits, including but not lim-
ited to superconducting cryogenic sensor arrays for both low-
bandwidth signals and pulse detection, qubit control and read-
out, and quantum information storage and addressing.7,13,34,35
These applications have a large range of signal bandwidths
ranging from < 1 Hz to 10s of kHz or faster. There is generi-
cally a tradeoff between signal bandwidth and channel count:
to ﬁt large numbers of sensors in the usable readout band-
width the detectors must be bandwidth-limited, while larger-
bandwidth detectors utilize a greater fraction of the total read-
out bandwidth and cannot be packed as tightly in frequency
space. To maximize performance on the smaller number of
channels being used in the higher-bandwidth cases, system
linearity is more limited, meaning that the fewer channels may
be run before performance begins to degrade.

Since the RF linearity requirements for the high channel
density case drive the SMuRF hardware design in particular,
we focus here on low bandwidth, high-channel-count applica-
tion, such as transition-edge sensor (TES) bolometer or MKID
arrays for astronomical sensing. We further focus on the case
of microwave SQUID multiplexers (µmux) coupled to low-
bandwidth TESs, since the higher resonator drive powers and
ﬂux ramp demodulation present additional complications be-
yond KID systems. In this section we brieﬂy review key terms
pertaining to resonator readout and give a brief overview of
the TES-coupled µmux system and typical integration to ori-
ent the reader for later sections.

A. Microwave Resonators

The microwave resonators used for cryogenic detector read-
out are coupled to a common RF transmission line to enable
multiplexing. The RF transmission line is excited with input
microwave power to interrogate the state of each resonator si-
multaneously. This input power can be broadband noise, or
as is more often the case for high-channel count systems with
known resonance frequencies, probe tones tuned to each reso-
nance frequency. We typically operate the RF line in transmis-
sion mode and adjust the power levels at the resonator inputs
with attenuation on the input and ampliﬁers on the output. In
the discussion that follows we assume that the resonators are
coupled to the RF line such that they exhibit a dip in forward
transmission (S21) amplitude on resonance; other systems are
easily mapped onto this case.36

An example resonator S21 is plotted in Figure 1.

In this
idealized case, the resonance frequency fres corresponds to
the minimum of the transmission amplitude at the center of
the resonance, though in general resonances can be asymmet-

SMuRF Tone-Tracking Electronics

3

FIG. 2. [Right] Example resonance circle corresponding to an ideal
resonance, with magnitude response [Left] for reference. The Smin
21
is denoted with a star in both cases. The color gradient denotes the
same points in frequency in both panels. We see that the resonance
generically traces out a circle in the complex plane, with the diameter
of the circle corresponding to the depth of the resonance.

FIG. 1. Example S21 amplitude [Top] and phase [Bottom] versus
frequency for an idealized resonator. The resonance frequency fres
corresponds here to the minimum of transmission. The width char-
acterizes the sharpness of the resonance, which is inversely related to
the quality factor Q.

ric. The complex phase undergoes a sign change through the
resonance. The width of the resonance in frequency space is
characterized by the resonator quality factor Q, which is re-
lated to the width of the resonance ∆ f at full width half max-
imum by Q = fres/∆ f . We further differentiate between the
internal quality factor denoted Qi where Qi ≡ Q/Smin
21 and the
coupling quality factor Qc, where the total Q is related to the
coupling and internal quality factors by 1/Q = 1/Qc + 1/Qi.
The complex forward transmission through an idealized reso-
nance may be parameterized as

S21( f ) = 1 −

Q
Qc

1
1 + 2 jQx

(1)

where x = ( f − fres)/ fres is the fractional detuning from the
resonance frequency.3

We can equivalently plot the S21 from Figure 1 in the com-
plex plane, where the resonance traces out a circle with the
resonance frequency at the point of intersection with the real
axis as seen in Figure 2. For an ideal resonance, this circle
is positioned such that on resonance the transmission is en-
tirely real and small changes in the resonance frequency re-
sult in changes in transmission along the imaginary axis, or
phase quadrature of the resonator. The real axis corresponds
to the amplitude quadrature. The effects of cabling and loss,
however, may in general displace, scale, and/or rotate the res-
onance circle to an arbitrary position in the complex plane.
We may equivalently refer to the amplitude and phase quadra-
tures of the resonator as I and Q, respectively, which are re-
lated by the same rotation and scaling to the electronics I and
Q quadratures.

FIG. 3. An overview of the phase modulation scheme of µmux. The
top panel depicts the resonance frequency, which shifts in response to
ﬂux in the SQUID loop. The middle panel gives the ﬂux ramp, which
is typically driven in a sawtooth pattern with amplitude sufﬁcient to
drive many ﬂux quanta through the SQUID (in this case, 4). The
bottom panel gives an example detector signal, which varies slowly
compared with the ﬂux ramp. The detector and ﬂux ramp signals
both contribute ﬂux to the SQUID; thus, the resonator response to
the detector signal is a shift in the phase of the ﬂux ramp modulated
frequency shift (dark dotted lines on top panel) from the detector
signal-free case (light lines on top panel).

B. The Microwave SQUID Multiplexer

The microwave SQUID multiplexer (µmux) transduces a
cryogenic detector signal, typically from a transition-edge
sensor (TES) or a magnetic microcalorimeter (MMC), into
ﬂux in an RF SQUID loop.14,15 Flux in the SQUID loop
changes the effective inductance of the microwave resonator,
causing a shift in its resonance frequency. A separate and
common ﬂux ramp bias simultaneously applied to all channels
linearizes the SQUID response without the need for individ-
ual feedback lines.37 An incoming detector signal is therefore
transduced into a phase shift in the SQUID response to ﬂux
ramp, which is periodic. A simpliﬁed picture of this phase
modulation scheme is depicted in Figure 3.

The SQUID ﬂux to resonance frequency relation is a quasi-
sinusoidal relation parameterized at low drive power by the
peak to peak swing of the resonance frequency ∆ fpp and hys-
teresis parameter λ , where lower values of λ correspond to

SMuRF Tone-Tracking Electronics

4

more sinusoidal curves. It is commonly parameterized as37

∆ f (t) = B

(cid:18) λ cos(ωct + θ (t))

(cid:19)

1 + λ cos(ωct + θ (t))

(2)

where B is a constant related to ∆ fpp. We note that Eq. 2
does not fully capture the complexity or dependencies of the
SQUID curve, which is a subject of intense study.38

The SMuRF system hardware was designed for high linear-
ity use cases with large channel counts. The current ﬁrmware
was optimized for reading out microwave SQUID devices
for CMB TES bolometer readout fabricated by the Quan-
tum Sensing Group at NIST Boulder.16 The design values for
these resonators are resonator bandwidths of ∆ f ∼ 100 kHz,
peak to peak frequency swing of ∆ fpp ∼ 100 kHz, quality fac-
tor Qi > 100, 000, and λ ∼ 1/3. They are optimally driven
with input powers around Pin ∼ −75dBm. The devices are
being developed for the eventual goal of achieving a multi-
plexing factor of 2000 channels from 4-8 GHz on a single RF
line. Other resonator technologies such as MKIDs, TKIDs,
and even room-temperature resonators have been successfully
read out with SMuRF systems as well, but did not drive design
choices.

The maximum multiplexing factor is set by the design value
of the peak to peak swing ∆ fpp and the requirement that the
resonances are spaced apart by a factor of 10 times ∆ fpp in fre-
quency to avoid collisions and crosstalk. In general µmux de-
vices have roughly matched resonance bandwidth and peak to
peak frequency swings to maximize SQUID sensitivity with-
out causing hysteresis or pathological SQUID responses.15

Reconstruction of detector information is achieved by ex-
citing the resonators with power and monitoring their state.
The signal chain consists of a comb of microwave-frequency
resonators capacitively coupled to a single RF transmission
line. Each detector is uniquely identiﬁed by its resonance fre-
quency through a 1:1 mapping between detectors and SQUID
input coils. Since the initial resonance frequencies of the res-
onators can be measured in advance, the resonator excitation
is often achieved with a comb of excitation probe tones, each
tuned to a single resonator channel.
In typical microwave
resonator electronics systems, the resonator acts as a moving
notch (narrow bandstop) ﬁlter that shifts off the probe tone,
and each probe tone is monitored for changes in amplitude
and phase. As will be discussed more in depth in § III B 2, the
RF linearity requirements on a system that must accommo-
date the possibility of several thousand off-resonance probe
tones are stringent, motivating SMuRF’s unique tone-tracking
capability.

C. Typical µmux System Implementation

In this subsection we describe a typical implementation
of a µmux system to motivate the electronics and periph-
eral system designs. The superconducting detector arrays
are mounted at the cold stages of a cryostat and connected
to room-temperature electronics systems via cabling that is
passed through the cryostat vacuum feedthrough. A sketch of
a typical system integration is given in Fig. 4.

FIG. 4. A typical integration between the SMuRF system and cryo-
stat. The SMuRF system consists of RF and DC components that
interact with the cryostat. The number of RF pairs may change de-
pending on the multiplexing factor achieved by the cold devices. The
DC lines supply the biases for RF ampliﬁers and detectors as well as
the ﬂux ramp. The system additionally interacts with several periph-
erals, including an optional external timing reference and data acqui-
sition system (DAQ). Throughout this paper, the color scheme is kept
broadly consistent such that the main system computation and pro-
cessing is given in green, RF components are depicted in light blue,
DC components in purple, data output in pink, timing in yellow, the
control in orange, and the cryostat and other externally derived pa-
rameters in red.

The SMuRF electronics interface with a cryostat through
both RF and DC connections. The RF connections consist
of two RF ports per transmission line, one each for input and
output. The DC connection is made with a single multipin her-
metic connector, which is carried to colder temperature stages
by a wire loom that is broken out at the 50K and 4K tempera-
ture stages to provide ampliﬁer biases and ﬁltering of the ﬂux
ramp and detector bias lines.

The RF lines provide the signals that are carried via coax-
ial cables to the resonator transmission line. After interacting
with the resonators, the transmitted power is ampliﬁed with
one or more cryogenic RF ampliﬁers before being returned to
the warm electronics for processing. In µmux, the resonators
are coupled to the TES detectors, which must be biased for
operation. In addition to the TES bias lines and RF ampliﬁer
bias lines, the DC lines must also supply a ﬂux ramp line to
the SQUIDs.

III. Requirements

The SMuRF system and auxiliary components must sat-
isfy many performance criteria in order to meet the design
speciﬁctions of the experiments they are coupled to. Here,
we outline brieﬂy the system requirements driven by the ex-
pected functional requirements in § III A, the science goals in
§ III B, and the user needs in § III C. These design require-
ments are ultimately driven by the goal of reading out 2000
µmux-coupled TES channels in a 4-8 GHz bandwidth, each
with ∼-75 dBm input power, while maintaining total readout
noise subdominant to the detector noise for a small-aperture
telescope with no polarization modulation.

SMuRF Tone-Tracking Electronics

A. Functional Requirements

We ﬁrst list the signals and connections that the SMuRF
system is expected to provide, based on the typical system
implementation discussed in § II C.

The RF system of SMuRF must provide one RF signal gen-
eration and readback pair per cryostat coaxial line. The mul-
tiplexing factors achieved by µmux are set by the cryogenic
devices, which are currently being designed for channel den-
sities of about 500 resonators per 1 GHz of bandwidth across
the 4-8 GHz range. For 1000x multiplexing factors we thus
require two pairs of coaxial cables, while for 2000x multiplex-
ing factors only a single pair is needed. Based on NIST CMB-
style µmux design speciﬁcations, we require that SMuRF can
generate up to 2000 probe tones at about ∼-35 dBm each
across 4 GHz of total bandwidth, allowing for cold attenua-
tion prior to the resonator input.

For science operations, the TESs are usually operated with
a constant low-noise voltage bias. In calibration mode and to
drive the detectors out of their superconducting state, a higher
bias level must be supplied, though this state is subject to
looser requirements on the noise performance. Depending on
the design and operating conditions of the TES, the bias line
may be required to supply between ∼10 µA and ∼5 mA of
current.

The electronics should additionally provide low-noise DC
biases for the cryogenic ampliﬁers. Previous measurements
indicate that cascaded cryogenic ampliﬁers offer improved
IP3 for minimal noise temperature penalty compared with typ-
ical noise in the cryogenic resonators.19 In this case, a lower
gain, low noise 4K ampliﬁer operates as the ﬁrst-stage ampli-
ﬁer followed by a 50K ampliﬁer, which may operate at higher
powers and thus offers better linearity than a single 4K ampli-
ﬁer alone. For other applications, a single LNA may be suf-
ﬁcient. The LNAs are biased with a gate and optional drain
DC line that supply no more than ±2 V and O(10) mA. We
thus require the electronics supply bias lines for up to two
cryogenic ampliﬁers per transmission line, which we refer to
throughout the text as located at 4K and 50K, though they are
not required to be ﬁxed at these temperature stages.

Beyond these DC signals, the electronics must include a
low-frequency signal generation system that supplies the ﬂux
ramp line common to all resonators on the same coaxial line.
To modulate the TES signal above the 1/ f knee of supercon-
ducting resonators3, we require that the ﬂux ramp line achieve
at least 10 kHz Φ0 rate, deﬁned as the sawtooth reset rate mul-
tiplied by the number of ﬂux quanta swept per ramp. The
required amplitude of the ﬂux ramp depends on the mutual in-
ductance to the SQUID, but must be able to sweep several Φ0.
Assuming there is no current division in the cryostat to sup-
press noise, this places the minimum requisite current at about
∼10 µA for current device designs, which have couplings be-
tween the ﬂux ramp coil and SQUID of about O(30) pH.16,37.
To mitigate against unwanted pickup from ambient radio
frequency interference (RFI), cables carrying critical low fre-
quency bias signals between the warm electronics and cryo-
stat input connectors must be well-ﬁltered and kept as short as
feasible.

5

The electronics should interface with a control computer,
allowing the user to command the system and receive data.
The system should further provide the ability to interface with
external timing systems such as provided from experiment or
observatory control. While standalone laboratory test systems
may be able to stream data directly to disk, we require that the
SMuRF system be capable of interfacing with external data
acquisition systems as required by large-scale experiments.
We similarly require that a SMuRF system be capable of com-
municating with and operating alongside other SMuRF sys-
tems.

B. Science-driven Requirements

1. Noise

The ultimate ﬁgure of merit for the readout noise perfor-
mance is the noise referred to the detector input. The noise
the white noise and the
performance has two components:
low-frequency behavior. Achieving good noise performance
places stringent constraints on all of SMuRF’s subsystems,
including but not limited to: RF tone generation and chan-
nelization, detector bias drives, ﬂux ramp, and all digital
signal processing algorithms.
Since low-frequency noise
on the detector bias line directly contributes low-frequency
noise on the detectors, noise performance and stability of the
low-frequency subsystems is particularly crucial.

White Noise

√

The white noise requirement of the readout, which includes
both the cryogenic readout devices and warm electronics, is
set by the requirement that it be subdominant to detector
noise referred to the input. For uncorrelated noise contri-
butions to the total detector noise the various noise compo-
nents add in quadrature; thus, in order to have minimal impact
we require the readout electronics induce no more than 10%
penalty to the detector noise. CMB TES detectors are cur-
rently photon-noise limited, with noise-equivalent powers of
Hz at 95 GHz.39 We operate in the regime that to-
O(40) aW/
tal readout noise is subdominant to phonon and Johnson noise
of the TES, which are in turn subdominant to photon noise.
The amplitude of the TES photon noise-equivalent current is
set by the operating resistance, which varies widely across
experimental conﬁgurations from about 1 mΩ to 30 mΩ for
DC-biased systems.21,40 For CMB detectors with antenna re-
sponses centered at 95 GHz, this translates roughly to O(100-
160) pA/
Hz for a BICEP-like experiment with large operat-
ing resistance and Simons Observatory-like experiment with
a low operating resistance, respectively.21,39

√

To maintain low total readout noise, we require that the
added white noise due to the warm electronics be subdomi-
nant to the intrinsic noise of the superconducting resonators
and cryogenic ampliﬁers, whose combined noise in turn is re-
quired to be subdominant to the detected signals. For NIST
CMB-style µmux resonators,
the dominant readout noise

SMuRF Tone-Tracking Electronics

6

tion products produced by device nonlinearities, the dynamic
range is eventually limited by the thermal noise ﬂoor of the
electronics. Conversely, improving signal to noise over the
thermal noise ﬂoor with higher drive powers eventually re-
sults in an increased effective noise ﬂoor due to intermodu-
lation products of the probe tones. We operate in the regime
that the electronics dBc/Hz is not changed by attenuation, as
is generally the case for broadband RF electronics in this pa-
rameter space.

The referral from electronics noise in dBc/Hz to TES noise
equivalent current involves converting noise in electronics
phase to resonator frequency noise via resonator and SQUID
device parameters and referring to detector input-referred
noise via factors of SQUID couplings. The full derivation
and measurement is deferred to a separate publication. To
remain subdominant to the intrinsic noise of NIST CMB-style
µmux resonators, the requirement for the SMuRF electronics
RF dynamic range per tone is -100 dBc/Hz at 30 kHz offset
frequency when operating 2000 simultaneous channels. This
channel density goal is driven by the maximum expected den-
sity of the cryogenic multiplexer.

The input-referred noise in the TES detector bias line is cur-
rent divided between the shunt resistor and the TES. The ratio
of the shunt resistance to the TES resistance under typical op-
erating conditions is about 0.1. This sets the requirement on
the noise on the bias line to 10 times the requirement on the
current noise of the readout; for example, if the detector input-
√
referred electronics noise requirement is 10 pA/
Hz, then the
√
noise on the TES bias line must be (cid:46) 100 pA/
Hz. The cur-
rent noise requirement for a given application can vary widely
depending on the TES operating resistance; but we require
that the bias line current noise be < 50 pA/
Hz, which is
conservative for most DC voltage-biased TES arrays.

√

The ﬂux ramp has a smaller mutual inductance on the
SQUID input coil than the TES, typically by a factor of 10.
In order to further reduce noise, it may be current divided in-
side the cryostat. We assume no current division in the worst
Hz total electronics
case and the same conservative 5 pA/
noise requirement, resulting in a ﬂux ramp current noise re-
quirement of < 50 pA/

Hz.

√

√

Low-Frequency Noise

For mm-wave ground-based bolometric applications in par-
ticular, minimizing the 1/ f noise of the detector time-ordered
data is critical.42 The conversion between angular scale on the
sky and time-ordered data frequency depends on the telescope
scan strategy. CMB ground-based surveys targeting large-
scale sky features, such as the BICEP/Keck program, require
time-ordered data that is white down to ∼ 0.1 Hz. Thus, in
the absence of additional polarization modulation we target
the 1/ f knee of the electronics to be ∼ 0.01 Hz. This low-
frequency performance encompasses both the RF and DC sub-
systems, the latter presenting a particularly challenging con-
straint since any low frequency noise on the detector bias line
directly translates to additional low frequency noise on the de-
tector.

The primary components of the SMuRF system which drive

FIG. 5. A sketch of a carrier tone roughly centered within the
displayed bandwidth to illustrate various terms relating to dynamic
range. The dynamic range is measured at some offset frequency from
the main carrier and represents the strength of the carrier signal rel-
ative to the noise ﬂoor. The noise ﬂoor may contain narrow-band
spurs; thus, the spur-free dynamic range represents the strength of
the carrier relative to the largest spur within the bandwidth.

sources include two-level systems (TLS) in the resonator di-
electric, HEMT noise, and DAC noise.41 To incur no more
than 10% penalty in the total current noise, this places an over-
Hz,
all requirement on the readout at roughly O(45-70) pA/
which includes both the cryogenic devices and warm electron-
ics.

√

For the purposes of setting a requirement on the warm
electronics, we must relate the detector input-referred current
noise to more practical units. Here we deﬁne several quanti-
ties relating to RF electronics systems that set the engineering
speciﬁcations for the SMuRF systems.

In µmux systems, detector signals are modulated into the
sidebands of the drive tones at an offset frequency given by
the product of the ﬂux ramp sawtooth rate and the number of
RF SQUID Φ0 swept in each ramp, typically 4-6 kHz and 4-6
Φ0 respectively to get above the strong 1/ f -like component
of the resonator noise. The difference between the power of
the drive tone and the noise ﬂoor generated in the sidebands of
the tone by the warm electronics at this offset frequency deter-
mines the maximum usable RF dynamic range. The dynamic
range is often expressed in units of dBc/Hz, or decibels rela-
tive to the carrier integrated over the measurement bandwidth,
where the carrier is taken as the resonator probe tone and the
measurement bandwidth is typically 1 Hz. Alternatively, we
can assign the maximum power of the carrier or ADC as “full
scale” and express power levels relative to this maximum in
terms of decibels relative to full scale (dBFS). While we are
typically interested in the dynamic range above the effective
noise ﬂoor, we may at times consider the strength of the car-
rier signal above the strongest spurs, or the spur-free dynamic
range (SFDR). A sketch of these concepts for an arbitrary car-
rier and noise ﬂoor is given in Figure 5.

The maximum achievable dynamic range is limited by both
noise and nonlinearity in the active devices used to amplify,
up- and down-mix, and read out the tones. In general there
are tradeoffs between noise and RF nonlinearity; while low-
ering drive power may improve the noise due to intermodula-

SMuRF Tone-Tracking Electronics

7

the low-frequency noise requirement are, in approximate or-
der of impact, (1) the detector bias circuit, (2) the ﬂux ramp
circuit, (3) the RF signal circuit, and (4) the RF ampliﬁer cir-
cuit.
In particular, the detector bias circuit is critical since
fractional drifts in detector bias current couple directly into
fractional drifts in the mean detector signal and gain in the
high loop gain limit of TES responsivity.

The low frequency drifts in the SMuRF-provided bias cur-
rent are sourced by intrinsic 1/ f noise of the DACs and op-
amps used in the bias circuit and by the coupling between bias
circuit components (current-setting resistors and DAC volt-
age references) and the temperature of their environment. We
choose DACs and op-amps such that their intrinsic 1/ f contri-
bution is subdominant to the temperature coupling effects. In
this limit the dominant driver of 1/ f noise is the temperature
dependence of the passive circuit components. These compo-
nents must maintain an fknee ∼ 0.01 Hz even when coupling
to the extreme case of diurnal ambient temperature variations
in the Atacama Desert where many CMB observatories are
currently operating or being built, assuming no active temper-
ature control. This sets the requirement for the combined tem-
perature coefﬁcient of all components in the TES bias circuit
to be (cid:46) 20 ppm/◦C.

The ﬂux ramp is typically operated at 10s of kHz, allowing
for some relaxation of 1/ f requirements on individual com-
ponents. Since the ﬂux ramp demodulation scheme relies on
knowledge of the average ﬂux ramp rate over long periods,
the stability of this circuit is crucial. We ﬁnd that the required
component temperature stability and noise performance are
comparable or subdominant to that of the detector bias cir-
cuit; thus, choosing similarly rated components for both cir-
cuits sufﬁces to meet this requirement.

The RF signal circuit low-frequency noise performance, de-
ﬁned here as the dynamic range at small carrier offset, is set
by the stability of the local oscillator (LO), discussed fur-
ther in § V B. Due to the ﬂux ramp scheme of µmux, the
requirements on low-frequency noise in the RF circuit and
low-frequency variation of the LO position itself are not as
stringent, and are subdominant to other sources of 1/ f noise.
The SMuRF provides circuitry for cryogenic RF ampliﬁer
biasing, as outlined in § V D. These ampliﬁers are typically
sourced commercially and are robust to gain ﬂuctuations due
to noise in the bias circuit. Flux ramp modulation is expected
to further suppress the majority of 1/ f noise. The phase mod-
ulation scheme of µmux additionally offers some amount of
immunity to overall amplitude ﬂuctuations resulting from am-
pliﬁer gain noise.

2. RF Linearity

Here, we set requirements on the system to minimize 3rd-
order intermodulation products that degrade the RF dynamic
range. The full octave of readout bandwidth used for this ap-
plication places stringent requirements on the bandwidth of
the RF components in the ampliﬁcation and signal processing
chain.

For ﬁxed-tone readout where the RF probe tone is ﬁxed

while the resonance is modulating, thousands of unattenu-
ated tones are incident on the cryogenic ampliﬁer as the res-
onances move in frequency. This is a particular challenge
for µmux systems both due to the higher probe tone pow-
ers and since the resonance swings by O(1) resonator band-
width in operation. To accommodate this large change in
power, the cryogenic ampliﬁer must trade off noise temper-
ature, thus degrading the overall readout noise. The interac-
tion of the RF probe tones further generates third-order inter-
modulation products in-band; for 2000 RF tones in one oc-
tave of bandwidth there are over one billion third order inter-
modulation products whose total power grows as the cube of
the fundamental tone power. These intermodulation products
combine and form an irreducible pseudo-noise ﬂoor that de-
grades the dynamic range of the probe tones and may exceed
the -100 dBc/Hz requirement discussed above, adding to the
detector-referred readout noise. In addition to sourcing noise,
intermodulation products induce crosstalk between channels
that poses potential systematics for science analysis.43

SMuRF addresses this linearity problem with a tone-
tracking algorithm, which follows the modulating resonance
with a closed-loop adaptive ﬁlter-based feedback. Previous
results demonstrate that this tone tracking is sufﬁcient to add
negligible noise penalty when running O(400) channels si-
multaneously versus a single channel at a time for NIST
CMB-style µmux resonators.16,19 The impact of adding ad-
ditional channels is dependent on resonator properties, most
crucially the resonator dip depths. For the full system we de-
sign with the goal of sufﬁcient linearity such that there is min-
imal penalty incurred by additional channels for up to 2000
NIST CMB-style µmux channels on an RF line. This sets
a stringent requirement in particular on the RF components
including the ADCs, DACs, and RF mixers, as discussed in
§ V B.

We emphasize that there is generically a tradeoff in RF sys-
tems between noise temperature and linearity; the noise may
be improved at the expense of being able to operate fewer
channels simultaneously. For the SMuRF system the large
channel counts necessitated aggressive optimization for lin-
earity at scale, but the noise performance of the SMuRF sys-
tem for a small number of channels can be improved.

3. Bandwidth

The required sampling bandwidth for the readout electron-
ics is driven by the bandwidth of the detectors and the band-
width of the resonator. For CMB measurements, the science
readout bandwidth is typically in the 0.1-300 Hz range.10,44
This gives us a minimum bandwidth for reading out TES
bolometers of O(1 kHz) per detector channel across a min-
imum of 2000 channels. The detector noise itself extends
higher in frequency; to keep the TESs stable they are designed
to have bandwidth in the ∼ kHz range.2

For applications that require the reconstruction of fast
pulses such as calorimetry, the energy resolution is set by the
rise time and height of the pulse.45 In this case, the SMuRF
must be reconﬁgured for lower channel count, higher band-

SMuRF Tone-Tracking Electronics

8

width channelization and signal processing. Further discus-
sion of SMuRF optimization for pulse detection and process-
ing is deferred to a future publication.

The requisite TES readout bandwidths stated above are for
the ﬂux ramp-demodulated detector data, whose sample rate
is set by the ﬂux ramp rate. While the tone-tracking ability
of SMuRF allows for readout of resonator modulation faster
than the resonator bandwidth, it is still useful to use the res-
onator bandwidth as a heuristic for required per-channel read-
out bandwidth. The resonator bandwidth for NIST CMB-style
µmux resonators is designed to be ∼ 100 kHz, well above the
TES bandwidth. To avoid aliasing penalties and get above the
1/ f noise from two-level systems (TLS) in the resonator, we
ﬂux ramp-modulate the signal to O(10 kHz). For the SMuRF
to be capable of resolving O(10) kHz ﬂux ramp rates, the
per-channel digitization bandwidth requirement is set at O(1
MHz) to ensure enough samples per ﬂux ramp cycle to allow
for demodulation.

Additional bandwidth and aliasing considerations of the
µmux devices are discussed in a separate publication.46 For
the purposes of checking performance for CMB-style res-
onators, we require that the system is capable of resolving and
demodulating waveforms with frequencies up to ∼ 1 kHz.

4. Crosstalk

Crosstalk between channels contributes to unwanted signal
that biases scientiﬁc analyses. For CMB polarization anal-
ysis, the crosstalk between channels is held below 0.3%.42
The sources of signal crosstalk in the µmux cryogenic sub-
system have been investigated and largely mitigated through
cryogenic device design.43 Most pertinently for SMuRF, the
noise ﬂoor induced in part by the higher order intermodulation
products of tones contributes some amount to an “all-into-all”
form of crosstalk. We expect that the RF linearity require-
ment outlined in § III B 2 is sufﬁcient to address this form of
crosstalk. In particular, the -100 dBc/Hz for 2000 tones re-
quirement translates to a maximum -43 dBc leakage between
arbitrary channels in 1 GHz bandwidth. To be conservative,
this sets a minimum requirement of −60 dB isolation between
channels in any given 1 GHz bandwidth.

Beyond the linearity requirement, there may remain some
amount of crosstalk between channels in the electronics. The
NIST CMB-style µmux resonator is expected to dominate any
crosstalk contribution from the SMuRF electronics.16 We thus
require simply that the electronics-induced crosstalk be sub-
dominant to the crosstalk induced by the cryogenic resonators.

C. Ancillary Design Requirements

We note here several additional design constraints guided
by the unique operating environments encountered by SMuRF
and similar microwave resonator-based systems.

• Environment: The SMuRF electronics are expected
to operate in a wide range of ambient temperature con-
In the worst case, the
ditions without noise penalty.

electronics are air-cooled in ambient conditions. Ad-
ditionally, many CMB experiments operate at high alti-
tudes where oxygen levels are substantially lower than
sea level. Extra care must be taken to ensure that the
electronics do not overheat or otherwise fail in these
conditions. The SMuRF was designed to operate at al-
titudes up to 5200 meters above sea level with ambient
temperatures below 25◦C.

• Power: Each SMuRF system’s maximum power con-
sumption must ﬁt within the power budget of the in-
tended application. For high altitude astronomical ob-
servatories which often operate on a spare total power
budget, this poses a signiﬁcant constraint due to the
high signal and switching speeds, the computationally
intensive nature of the SMuRF processing algorithm,
and the power demands of the electronics crate and pe-
ripherals. For reference, the total electrical power avail-
able for readout for current sites is about O(1-3) kW for
20,000 channels.

• Vibration Sensitivity: The detector readout electron-
ics on telescopes is often mounted as comoving with
the receiver, which for CMB applications scans the sky
at several degrees per second and turnaround accelera-
tions of O(1)◦/s2. The SMuRF should be able withstand
this movement without damage or noise penalty. In ad-
dition, multiple SMuRF systems are often run together
in adjacent slots of one electronics crate. The presence
of additional SMuRF systems in adjacent slots should
not impact the performance of any given system.

• Modularity: Components of the system should be de-
signed to allow for separate testing and integration, al-
lowing for swapping and upgrading parts as necessary
on deployed systems.

• Ease of Use: The user-facing interface and software
should be accessible to end users who may desire to use
SMuRF as a readout platform without expert knowl-
edge of the electronics, ﬁrmware, or cryogenic multi-
plexer. This drives the SMuRF design towards modu-
lar components that are easily swappable, open source
software, and compatibility with standard scientiﬁc lab-
oratory computers and operating systems.

IV. SMuRF Electronics Overview

The SMuRF electronics are built on the SLAC Common
Platform, a comprehensive FPGA-based ﬁrmware framework
built on standardized hardware designed speciﬁcally for high-
performance systems.47 The hardware components are de-
signed for modular use with commercial Advanced Telecom-
munications Computing Architecture (ATCA) crates.48 The
hardware architecture is based on a Xilinx FPGA carrier
board, which supports up to two double-wide dual-height
mezzanine cards for analog and RF processing and a rear tran-
sition module for high speed links and further customization.

SMuRF Tone-Tracking Electronics

9

A block diagram of the full SMuRF system is given in Fig. 6.

The system consists of an FPGA carrier card, which pro-
vides all real-time signal processing. Mounted to the carrier
are one or two Advanced Mezzanine Cards (AMCs) which
each consist of a base board and an RF daughter card. The
base board contains the ADCs and DACs for the main signal
path, clock generation, and local oscillator (LO) generation.
RF daughter cards mounted to the AMC base boards contain
the RF mixers, ampliﬁers, and bandpass ﬁlters. Opposite the
AMCs on the carrier card is a Rear Transition Module (RTM)
handling the low frequency signal generation, which is con-
nected via a ﬂexible multipin cable to a cryostat card that in-
terfaces the low frequency signals with the cryostat. Addi-
tional peripherals such as the crate, timing, and networking
are required to run the system, but may be shared between
multiple systems.

Multiple parallel systems reside in a single commercial
ATCA multislot crate, with each system occupying one slot.
Timing information is distributed through the crate backplane.
Typical crates contain N + 1 slots, with N carrier cards and
one slot dedicated to a network switch (Vadatech ATC807)
that allows for data streaming across multiple SMuRF sys-
tems. A 1 Gbit ethernet connection between the ATCA net-
work switch and the control server, commonly a Dell R440,
provides ﬁrmware register access for every SMuRF carrier in
the 7-slot ATCA crate, allowing for software control and data
acquisition. For large integrations, an additional PCIe card
(Xilinx KCU1500) allows for streaming data from multiple
carriers to the server. This speciﬁc hardware, including the
PCIe card, Vadatech ATCA network switch, and Dell R440
computer server, have been qualiﬁed for operation in high-
altitude environments as described in § VIII F.

Up to two AMCs ﬁt into designated mezzanine slots on
the FPGA, each with four up/downconverters corresponding
to one of eight 500 MHz wide bands. The ﬁrmware frame-
work is built on these 500 MHz-wide bands that can each
accommodate processing and streaming of up to 416 simul-
taneous 2.4 MHz-wide channels. For each band, the tones are
synthesized in the DACs and upconverted to the appropriate
GHz frequency range with a local oscillator. Tones returning
from the cryostat are split into bands and downmixed with the
same LO before being sent to the corresponding ADC. The
downmixed tones are digitized, channelized, and read into the
FPGA, where they are processed. Each channel is typically
associated with a unique resonance, thus creating a 1:1 map-
ping between readout channels and detectors. Thus, in total
each SMuRF system contains the requisite hardware to read
out 3328 resonator channels across 4 GHz of bandwidth, ei-
ther in two parallel systems reading out resonators in 2 GHz
of bandwidth or in two serial systems reading out resonators
in across a 4 GHz range.

Each channelized tone is processed by the ﬁrmware to re-
turn data with desired levels of processing depending on the
application. At the lowest level, the downconverted and chan-
nelized data can be streamed as the orthogonal I and Q com-
ponents of the digital down conversion. Following calibration,
these orthogonal components may be returned as the ampli-

tude and phase components of the resonator voltage ﬂuctua-
tions, or an approximation of the probe tone frequency and
resonator frequency error ∆ f . With this frequency error ap-
proximation, a feedback loop may be applied to minimize ∆ f ,
thus following the resonator minimum. This “tone-tracking”
feedback enables the applied probe tone to “follow” the res-
onace dip as it is modulated by the ﬂux ramp and/or incoming
detector power.

A more detailed discussion of the options for data process-
ing is given in §VI. At the highest level of processing, the
SMuRF returns a time-ordered data stream of ﬂux ramp de-
modulated detector data for saving to disk or passing on to
downstream data acquisition.

V. Hardware

A full picture of the hardware components is shown in Fig-
ure 7. The components displayed constitute the pieces of one
SMuRF system, which is capable of reading out up to 3328
channels in one rack-unit of space, excluding peripherals that
are shared between multiple systems. They are mounted in
one slot of a multi-slot ATCA crate, and present SMA ports
for RF connections from the front of the crate and a ﬂexible
multipin cable to a card mounted directly at the cryostat vac-
uum feedthrough at the back of the crate.

A. Carrier Card

The FPGA carrier card (Xilinx XCKU15P Ultrascale+)
handles the real time signal processing, most notably the RF
tone generation/channelization and tone tracking. The card
provides interfaces for data, control, and timing. An Intelli-
gent Platform Management Interface (IPMI) provides a se-
rial control protocol for monitoring and power cycling. A
single-lane 2.5 Gbit uplink provides on board timing and a
frequency reference, while a 4-lane 10 Gbit/s ethernet inter-
face to the ATCA crate switch via the backplane handles all
other communication, including data transfer. The AMC (see
§ V B) interface with the carrier consists of eight 12.5 Gbit bi-
directional JESD204b links to each AMC card for ADC/DAC
data, digital clocks, and low-speed serial peripheral interfaces
(SPI) for control and status readback. The carrier interfaces
digitally with the RTM via SPI link and provides 51.2 MHz
clock (see § V C). The RTM additionally routes two optional
external 2.5 Gbit external inputs to the carrier, one for ethernet
and the other for timing.

The ﬁrmware on the carrier card is programmed via VHDL
and Xilinx System Generator for Digital Signal Processing
and may be updated remotely. Further ﬁrmware details are
addressed in § VI.

Due to the large resource consumption of the signal pro-
cessing ﬁrmware and the need for many carriers to operate in
close proximity in high altitude environments, the carrier is
robustly temperature controlled with large heatsinks, delidded
regulators, and high-velocity crate fans. The results of testing
of these temperature control measures is described in § VIII F.

SMuRF Tone-Tracking Electronics

10

FIG. 6. A sketch of a full SMuRF system. Each system consists of an FPGA carrier board (green) that supports both the RF (blue) and DC
(purple) systems. Multiple systems may be run in parallel in a single crate. The RF system (blue) consists of two Advanced Mezzanine Cards
(AMCs), each with a pair of RF daughter cards that interface between the RF cabling to the cryostat and the ADC/DACs. The LOs used for
up- and downmixing signals between the baseband and RF are derived from the main carrier but are generated on the AMCs. The DC system
(purple) provides the ampliﬁer biases, TES biases, and ﬂux ramp generation on a Rear Transition Module (RTM). The voltage sources are
further conditioned in a cryostat card that interfaces directly with the cryostat. The main signal processing functions take place on the carrier,
and consist of a pair of polyphase ﬁlter banks for RF tone synthesis and readback and a baseband processor for per-channel computations.
Several options exist for interfacing timing and data acquisition with the system; displayed here are streaming to a PCIe card installed in the
control server and receiving an external clock reference. An ethernet connection between the the control server and network switch provides
ﬁrmware register access to all slots simultaneously and may receive data streamed to disk for a small number of carriers. Not pictured is the
ATCA crate backplane, which distributes power and timing information and connects the network switch ports to the carriers in each slot.

B. Advanced Mezzanine Cards and RF Daughter Cards

The Advanced Mezzanine Card (AMC) contains the ADCs
and DACs for the main RF signal path, clock generation sys-
tem, and LO generation for the RF daughter cards. Each AMC
consists of a base board interfaced with an RF daughter card
supporting a total of 2 GHz of bandwidth at either 4-6 GHz or
6-8 GHz. The RF daughter card provides the up- and down-
mixing between the digital signal processing (DSP) band cen-
tered at 750 MHz and the RF frequencies of the microwave
resonators. The current iteration of SMuRF has RF daughter
cards for operation of either “low band” (4-6 GHz) or “high
band” (6-8 GHz) resonators. The daughter cards may be ar-
bitrarily swapped between AMC base boards, which require
only minimal modiﬁcation between low and high band types.
Each carrier card accommodates two AMCs of any combi-
nation of low band and high band types. The LO frequency
may be modiﬁed via ﬁrmware register. Combined with RF

hardware part swaps, this allows for for operation of SMuRF
systems with cryogenic resonators at other frequency ranges
and channel densities.

1. AMC Base Board

The AMC base board contains the hardware for interfacing
the digital logic on the carrier with the analog electronics. A
block diagram is shown in Fig. 8.

Each AMC baseboard features four 16-bit 2.4 GS/s ADCs
(TI ADC32RF45) and four 16-bit 2.4 GS/s DACs (TI
DAC38J84). The SMuRF implements I/Q data separation
digitally, using Digital DownConversion (DDC) rather than
use integrated analog I/Q combiners and separators. In this
scheme, rather than implementing separate I and Q hardware
paths, a single high-speed ADC samples the full input signal,
which is then separated into orthogonal components via mul-

SMuRF Tone-Tracking Electronics

11

FIG. 7. A picture of the hardware for one SMuRF system accommodating up to 3328 resonator channels across one or two RF chains,
excluding peripherals such as the server, data streaming, and timing. The pictured contents excepting the cryostat card occupy one slot in a
multi-slot ATCA crate. The AMCs with RF daughter cards mount to the front of the carrier and present SMA connectors for RF connection
to the cryostat, while the RTM mounts to the rear of the carrier and presents a multipin cable to a cryostat card, which mounts directly to the
cryostat. The RTM and cryostat card combination supplies the low-frequency signal generation and conditioning.

ing the gain and maintaining the phase offset between the I
and Q components. However, DDC requires higher speed
DACs and ADCs to do the I/Q combination and separation
in ﬁrmware.

The DACs convert input complex data from the FPGA car-
rier card at 614.4 MS/s to a 500 MHz-wide ﬁltered signal be-
tween 500 MHz and 1 GHz. The ADCs convert the unaliased
input signal in the 500 MHz-1 GHz frequency range up to a
complex data stream at 614.4 MS/s to pass to the carrier. The
ADCs and DACs are run with 4x digital decimation and in-
terpolation ﬁlters respectively to deﬁne the Nyquist band and
simplify analog ﬁltering requirements. Data bandwidth lim-
its prevent the ADCs from transmitting wholly unprocessed
ADC data and the DACs from processing arbitrary waveforms
at the full data rate. The communication between the carrier
and the ADCs and DACs is therefore routed through a 12 Gb/s
custom, open source JESD protocol.

Each DAC/ADC pair is associated with a unique local sig-
nal generator to provide the LO that the RF daughter card uses
to upmix or downmix between the 500 MHz-1 GHz band and
the desired GHz-frequency band. Each 500 MHz band has
its own LO, which is offset by the ADC/DAC numerically-
controlled oscillator (NCO) frequency of 2.4 MHz from the
centers of 3.5 GHz, 4.0 GHz, 6.0 GHz, and 6.5 GHz for the
low band, and 5.5 GHz, 6.0 GHz, 8.0 GHz, and 8.5 GHz for
the high band. We use the lower sidebands for the ﬁrst two
LOs and the upper sidebands for the second two such that
the LOs fall outside the resonator bandwidth when operat-
ing AMCs of the same type (both low or both high band).
These LOs are generated via a fractional-N locked phase-
locked loop IC (Analog Devices ADF5355) with integrated
low-noise voltage-controlled oscillators (VCOs).

FIG. 8. Block diagram of a SMuRF Advanced Mezzanine Card
(AMC), which is responsible for the RF signal input/output. RF
signals enter the system between 4-8 GHz and are ﬁrst split into
500MHz bands via a quadruplexer (bottom right). Each band is then
processed in parallel through digitally controllable attenuators and
mixers (denoted with X) each with an LO tuned to place the IF band
in the 500-1000MHz range. The ADCs (bottom left) then sample the
IF of each band at 2.4 GS/s. The RF output (up conversion) chain
starts from the DACs (top left) and performs the same operations in
reverse with the mixers fed by the same LOs as the down conversion.
The separate bands are combined with the quadruplexer, resulting in
a comb of output between 4-8 GHz at the RF output (upper right).

tiplication with a directly synthesized intermediate frequency
(IF), ﬁltered, and downsampled to obtain the complex base-
band signal. This relaxes the requirement on precisely match-

SMuRF Tone-Tracking Electronics

12

Finally, the AMC card contains a clock generation system
(TI LMK04828) for the digitizer and associated JESD204b
links. This clock, as well as all other SMuRF system clocks,
are ultimately derived from a common timing reference (Crys-
tek CVHD-950).

Since the LO is used to generate all the tones in its respec-
tive 500 MHz band, its noise proﬁle is critical to the overall
noise performance. Other studies ﬁnd that the noise proﬁle of
the LO can be seen in resonator channel noise spectra at high
ﬂux ramp rates, which does not impact typical science data
but may constrain the maximum operable ﬂux ramp rate.46
The noise proﬁle of the LO is set by the noise of the reference
clock source, the charge pump used for loop gain adjustment,
and the VCO. The phase noise of the clock reference source
the LOs are locked to sets the close-in phase noise (below
∼100 Hz). An external clock reference can be passed in and
locked to the onboard clock either via a SMA input on the
AMC front panel or through a timing distribution system on
the ATCA crate backplane. If no external source is provided,
the 122.88 MHz is derived from the FPGA.

Above 100 Hz the phase noise of the LO is set by the pa-
rameters of the charge pump phase-locked loop (CP-PLL)
which is used to create a ﬂat phase noise proﬁle out to
O(100 kHz). The noise level in this ﬂat portion of the phase
noise proﬁle can be adjusted slightly by trading off bandwidth
of the CP-PLL. Pushing to much higher bandwidth above ∼
100s of kHz leads to instability in the CP-PLL. The phase
noise after the CP-PLL rolloff is set by the intrinsic phase
noise of the VCOs that generate the LO, which ultimately
limit the phase noise level. For applications that require lower
system phase noise, the VCOs can be exchanged with lower
phase noise, ﬁxed-frequency crystal oscillators. These were
not used in the current design because ﬂexibility of LO fre-
quency while achieving the required white noise speciﬁcation
was favored over further improvements in phase noise.

2. AMC RF Daughter Cards

The AMC RF daughter cards mounted to the AMC base
boards provide the RF frequency tone generation and read-
back. The RF mixers (Analog Devices LTC5548) that pro-
vide the up- and downmixing between between the DAC/ADC
baseband from the AMC base board and the LOs are con-
tained on the RF daughter cards. Since the RF mixer typically
sets the linearity of the system, the choice of mixer here is
critical, as is the attenuation of DAC output power prior to
passing to the mixer.

The RF daughter cards exist in both low band (4-6 GHz)
and high band (6-8 GHz) variants. Quadruplexers (Lark En-
gineering SMCQ819-110 and SMCQ819-111) interface from
the mixers on the four ADC/DAC pairs to a single input/output
coaxial pair that connect with the cryostat or other test sys-
tem via SMA connectors. Cavity ﬁlters within the quadru-
plexers deﬁne overlapping bandpass ﬁlters that split the RF
frequency band into each 500 MHz band that is synthesized
or channelized in ﬁrmware. Since the ADCs and DACs are
clocked at 2.4 GS/s, the Nyquist frequency for the alias band

FIG. 9. The response of the AMC band-deﬁning ﬁlters for each of
the 500 MHz wide bands across the full 4-8 GHz SMuRF band. Band
0 corresponds to the 4-4.5 GHz band, and the bands count upwards
in 500 MHz increments from there.

is at 1.2 GHz.

The AMC S21 response for each 500 MHz band is shown
in Figure 9. We note in particular that the maximal passband
of the ﬁlters is not quite 500 MHz wide to guarantee sufﬁcient
rejection out of band, set at 60 dB isolation between bands as
described in § III B 4. The portion of the passband that is ﬂat
within -2 dB is about 460 MHz wide, while the edges of each
band are about 3 dB down and isolation is > 65 dB between
adjacent bands. The RF daughter cards additionally include
programmable attenuators on both the RF input and output
for each 500 MHz band to allow for ﬂattening the RF signal
levels over the full SMuRF RF bandwidth.

Since the ADCs and DACs have optimal noise performance
at a ﬁxed output/input power level, respectively, adjusting
power levels at the resonator is most easily accomplished via
some combination of external attenuation/ampliﬁcation and
these programmable attenuators. With existing default set-
tings, the optimal output/input power levels are about -33 dBm
per tone. Individual tone powers are adjustable in ﬁrmware in
coarse (3 dB) steps, while the programmable attenuators act
on each 500 MHz band deﬁned by one ADC/DAC pair and
can be tuned in ﬁner (0.5 dB) steps. The size of ﬁrmware
steps can be modiﬁed easily in ﬁrmware, but the present com-
bination of coarse and ﬁne steps has been sufﬁcient for user
needs.

C. Rear Transition Module

The rear transition module (RTM) generates the following
low frequency signals for the SMuRF system: (1) Detector bi-
ases, (2) RF ampliﬁer biases, and (3) ﬂux ramp. It additionally
provides control and clocking to the cryostat card.

The RTM acquires its sequencing and interfaces via a com-
plex programmable logic device (CPLD), which runs a sim-
ple, compact ﬁrmware programmed in VHDL. The CPLD
ﬁrmware cannot be updated remotely.

SMuRF Tone-Tracking Electronics

13

The DC TES biases and cryogenic ampliﬁer biases are
provided by 33 low-noise 18-bit DACs (Analog Devices
AD5780). To reduce low-frequency noise, the TES bias DACs
are typically operated differentially, though they can be driven
single-ended with no modiﬁcations to the SMuRF hardware or
ﬁrmware to double the number of independent TES bias lines.
As discussed in §II C, for applications requiring high RF
linearity it may be desirable to cascade two cryogenic ampli-
ﬁers rather than use a single LNA. Thus, the RTM allocates
eight DACs to biasing up to four total RF ampliﬁers, typi-
cally two ampliﬁers placed at 4K and 50K for two separate
RF chains. Each ampliﬁer is allocated two DACs for the gate
and drain voltages, though some models require only a single
bias line. Additional ampliﬁer bias lines can be added at the
expense of TES detector bias lines with no modiﬁcation to the
RTM hardware or ﬁrmware, if desired. These DACs, referred
to as “slow”, can generate arbitrary waveforms up to about
1 kHz for calibration and testing purposes.

An additional 50 MS/s 16-bit differential current DAC
(Analog Devices LTC1668) drives a differential pair that
serves as the ﬂux ramp for µmux systems. Since the ﬂux ramp
is required to be much faster than the detector and ampliﬁer bi-
ases and operates at lower full scale voltages, it is higher speed
and therefore higher noise than the DC bias DACs. The ﬂux
ramp is implemented as a sawtooth function, although other
waveforms are possible. It is generated by the RTM CPLD
with control and triggering from the carrier card FPGA. The
RTM ﬁnally provides DC power and a low speed SPI serial
link for communication to the cryostat card (see § V D).

A daughter card on the RTM consists of a voltage refer-
ence providing buffered ±10V reference signals to the preci-
sion DACs. The card uses two commercial voltage references
(Analog Devices LTC6655) in parallel to reduce noise, and
low-pass ﬁlters with low acoustic sensivity capacitors (Ruby-
con 35MU106MD35750) to mitigate vibrational pickup. A
daughter card implementation for the voltage reference pro-
vides the ﬂexibility to easily and cheaply upgrade the perfor-
mance of the voltage reference if required for a particular ap-
plication.

The RTM presents a 100-pin SCSI connector containing the
low-impedance ﬂux ramp, TES bias, ampliﬁer bias, DC power
supplies, and digital communication to the cryostat card. The
SPI communication link between the RTM and the cryostat
card is default quiet to reduce noise during operation, with no
active polling.

Two monitor ports with LEMO connectors are available
laboratory diagnostics. First, the ﬂux ramp monitor port out-
puts a single-ended 50 Ω-impedance signal for monitoring the
ﬂux ramp output. This line is not guaranteed to have the req-
uisite noise stability or bandwidth for properly driving the ﬂux
ramp. Second, the trigger output provides a low voltage TTL
signal asserted at the start of each ﬂux ramp period, typically
at the resets for the sawtooth signal.

An SFP 1 Gbit ethernet port may be used for data stream-
ing of a single SMuRF system without the need for interfac-
ing with the rest of the ATCA crate. An additional SFP port
receives timing data that may be used for synchronizing mul-
tiple SMuRF systems together, as discussed in § VI D.

D. Cryostat Card

The cryostat card interfaces signals from the RTM directly
with the cryostat. It conditions the TES bias and ﬂux ramp
signals from the low-impedance voltage sources at the output
of the RTM to ﬁltered, high-impedance current sources. Since
the bias lines are particularly susceptible to noise pickup after
converting to current sources, the cryostat card was designed
to be placed as close to the cryostat as possible, with a separate
card and enclosure from the main RTM to allow for shielding
and thermal regulation. The connector on the cryostat side is
chosen to match the feedthrough of the desired application.

The cryostat card additionally provides regulated power
supplies and conditions gate bias voltages from the RTM
DACs to bias the cryogenic RF ampliﬁers. The card is con-
trolled and monitored via an on-board microcontroller (Mi-
crochip PIC32MX795 32-bit microcontroller) and interfaces
to the rest of the SMuRF system via an SPI serial link to the
RTM CPLD.

The detector bias is a differential output voltage using
two opposing ±10V RTM DACs. For each detector bias
line, mechanically latching relays on the cryostat card (Ax-
ion 5-1462037-4) controlled by the microcontroller allow for
switching between a low-pass ﬁltered, low-current bias circuit
(“low current mode”) and a higher current, minimally ﬁltered
(∼ 100 kHz bandwidth) circuit (“high current mode”). The
relays are mechanically latching to reduce power dissipation
that could couple to temperature variation in the board, mean-
ing the state cannot be queried during operation. The default
state is in low current mode.

In low current mode, added parallel capacitance low pass
ﬁlters the detector bias outputs with a frequency cutoff f3dB ∼
8 Hz. The output current levels in both low and high cur-
rent modes are set with inline series resistors, typically in the
1-50 kΩ range depending on the maximum current desired,
providing a high impedance source. The maximum current
is thus determined by the resistor selection, which is set by
individual detector operating parameters, up to op-amp lim-
its of ∼ 10 mA. This high current mode is typically used for
delatching superconducting detectors, biasing detectors with
higher operating resistances for calibration purposes, or for
high bandwidth measurements.

As discussed in § III C, we set stringent requirements on the
low frequency performance of signals provided by the cryostat
card. It is expected that temperature variation of electronic
components drives a large fraction of the variation in the low
frequency noise, particularly the temperature variation in the
RTM voltage reference and cryostat card resistors. This sets
a requirement of <∼20ppm/◦C on the temperature coupling
coefﬁcient of these resistors. The cryostat card resistors were
thus chosen to be guaranteed to ±10 ppm/◦C (TE Connectiv-
ity RQ73 series). The capacitors on the cryostat card were
similarly selected for low frequency noise performance and
low acoustic sensitivity (Rubycon).

The 4K and 50K ampliﬁer gate bias voltages are each
driven single ended via an RTM DAC with 20 µF bypass ca-
pacitors on the cryostat card for ﬁltering. A resistor divider on
the cryostat card allows for limiting the output gate voltages

SMuRF Tone-Tracking Electronics

14

to less than the maximum ampliﬁer ratings if required. The
drain currents may be read back to allow for bias adjustment
using an inline resistor on the input to the regulator, which is
ampliﬁed by an instrumentation amp and read back by ADCs
on the microcontroller. The ﬂux ramp and ampliﬁer bias cryo-
stat card circuits have jumpers that allow the user to manually
select between sourcing from the RTM and inserting signals
from an external source via a 2-pin differential LEMO con-
nector.

All output voltages, including the RF ampliﬁer drains, are
disabled by default on power-on, and must be explicitly en-
abled. This is a requirement for many cryogenic RF ampli-
ﬁers, which can draw large currents and generate substantial
heat loads if the drain voltage is enabled before the gate volt-
age is set. For the RF ampliﬁer drain voltages, which are gen-
erated on the cryostat card using adjustable linear voltage reg-
ulators, this is accomplished by toggling the enable pin of the
linear regulators using the cryostat card PIC.

The cryostat card provides an additional DC line at +12V
with minimal ﬁltering for powering an optional warm follow-
on RF ampliﬁer, which can be used to optimize the cryostat
RF output signal power levels into the AMC RF ADCs. For
general diagnostic purposes, it can report its temperature us-
ing an on-board TI TMP236 temperature sensor over the SPI
bus.

The ﬂux ramp is a differential output current source drive,
converted from the RTM low-impedance voltage source via a
passive resistor H-pad attenuator to allow impedance match-
ing if required by the application. A mechanically latching re-
lay allows for switching between AC and DC-coupled modes
via large capacitors. In AC mode, large acoustic sensitive ca-
pacitors (Rubycon) are used to mitigate against vibrational
coupling. Operating in AC mode high-pass ﬁlters the dif-
ferential ﬂux ramp drive with an f3dB ∼ 80 Hz, attenuating
60 Hz power line noise and low frequency noise pickup in
the cables between the RTM and cryostat. Operating in DC-
coupled option enables low-frequency and ﬁxed-current ﬂux
ramp biasing as required, such as when taking µmux resonator
frequency versus ﬂux ramp bias curves or other device char-
acterization data.

During data taking, each SMuRF carrier transfers data frames
at the ﬂux ramp rate to the PCIe card, where the frame stream
is received and processed further in software. Common soft-
ware processing steps include packaging the data with an
application-speciﬁc header, which can include timing infor-
mation, and optionally ﬁltering and downsampling the data
streams before writing the data to disk.

VI. Firmware

The FPGA carrier card ﬁrmware is responsible for SMuRF
computation including RF tone generation, tone tracking, ﬂux
ramp demodulation, and data framing. A component block
diagram is given in Figure 10. The SMuRF ﬁrmware compo-
nents provide the following functionality:

• Tone Generation and Channelization: A pair of
polyphase ﬁlter banks provide synthesis and analysis of
the RF tones used to probe the resonators. The ﬁlter
banks are show as the blue boxes in Figure 10.

• Frequency error estimation: SMuRF uses an afﬁne
transform to translate the received complex response
(S21) into a resonator frequency error estimate. As this
occurs on a per-channel basis, it is contained in the
baseband processor (green box in Figure 10).

• Tone tracking and ﬂux ramp demodulation: SMuRF
uses a feedback loop to update the probe tone frequency,
attempting to minimize its estimate of the frequency
error. The feedback loop parameterizes the ﬂux ramp
modulation and also outputs the demodulated detector
signal. This is also part of the baseband processor.

• Miscellaneous: The ﬁrmware handles miscellaneous
timing and waveform synthesis tasks, such as ﬂux ramp
timing, arbitrary detector bias DAC waveform genera-
tion, data streaming, and synchronization between mul-
tiple SMuRF systems. These are shown heuristically
with the timing (yellow), DC signal generation (purple),
and DAQ (pink) boxes in Figure 10.

E. PCI Express Card

For large integrations, a Xilinx KCU1500 data acquisition
PCI express (PCIe) card using a custom ﬁrmware allows for
multiple carriers’ worth of data to be streamed to a server,
with each slot outputting to a 10 Gbit ﬁber link on the network
switch.49 The PCIe ﬁrmware implementation is designed for
a 7-slot ATCA crate conﬁguration, with the PCIe card inter-
facing with up to six SMuRF carriers through the Vadatech
switch via dedicated ethernet links to an eight lane PCIe 3.0
bus in a server computer (commonly a Dell R440). The ded-
icated ethernet link for each SMuRF carrier is implemented
with 10 Gbit ﬁbers which connect from the ATCA ether-
net switch to two Quad Small Form-factor Pluggable (QSFP)
transceivers in the KCU1500. The PCIe card presents two x8
interfaces bifurcated to a x16 edge connector to the server.

Intermediate data outputs with increasing levels of signal pro-
cessing are available to examine for system characterization
and debugging.

A. Tone Generation and Channelization

The SMuRF FPGA synthesizes and analyzes data from
each of 500 MHz bands corresponding each to one RF
ADC/DAC pair separately. The RF ADCs and DACs trans-
form the IF band from 500 MHz-1 GHz to and from the com-
plex baseband of ±307.2 MHz, deﬁned by the ADC sample
rate of 2.4 GS/s and divide-by-4 complex decimation ﬁlter.
From here, the data is downconverted from a 614.4 MHz-wide
frequency band to individual channels to be processed. A con-
ceptual sketch for the single channel downconversion chain is

SMuRF Tone-Tracking Electronics

15

FIG. 10. Block diagram of the main components of the SMuRF ﬁrmware. Some miscellaneous tasks are not shown for simplicity. The blue
boxes represent a pair of polyphase ﬁlterbanks that provide the synthesis and readback of the RF tones used to probe the resonators. The green
box contains the baseband processor, which acts on each channel separately to perform the calibration and frequency error estimation, then
the tone-tracking and ﬂux ramp demodulation. The ﬁlter banks and baseband processor act on hardware-deﬁned 500 MHz-wide bands. One
SMuRF FPGA carrier card supports up to 8 bands, allowing for a total of 3328 channels per board. Auxiliary ﬁrmware functions such as
timing synchronization, data framing, and low-frequency signal generation are represented by the yellow, pink, and purple boxes respetively.

given in Fig. 11. The upconversion works similarly, but in
reverse.

100 ns, and the additional delay from the ADCs and DACs
another ∼ 0.5 µs.

A polyphase ﬁlter bank performs the channelization, con-
verting from each 614.4 MHz I/Q stream to 512 interleaved
2.4 MHz-wide bins that are time multiplexed. The ﬁlter bank
response is shown in Fig. 12. The ﬁlter bank oversamples
by 2 such that each resonance falls into multiple bins; two
resonances which fall in the same bin may be assigned to
an overlapping bin such that both resonators are processed.
Thus, a given 1.2 MHz frequency band may not contain more
than 3 resonances such that every resonance can be assigned
to its own bin. The ﬁrmware is capable of supporting process-
ing multiple channels per bin if desired, but currently uses
only one channel per bin. Placing a single channel per bin
introduces additional latency due to the lack of paralleliza-
tion, but reduces FPGA resource consumption. NIST CMB-
style µmux resonators aim for at least 1 MHz spacing between
µmux resonances for crosstalk considerations; thus the width
of the ﬁlter bank channels does not signiﬁcantly contribute to
readout yield degradation.43

The data from each bin is ﬁltered with a 16 tap digital low-
pass ﬁlter, resulting in a 4096 tap FIR ﬁlter (since there are
512 resulting channels, oversampled by 2). The ﬁlter bank
achieves about 100 dB of rejection for out of band response
and adds a group delay that is approximately constant across
the 2.4 MHz-wide band.

This ﬁlter sets the majority of the processing delay due to
SMuRF, on the order of 6 µs out of a total signal processing
delay of about 8.8 µs. For comparison, the roundtrip cable
delay through a typical CMB receiver cryostat may be about

The FFT is performed with a streaming Radix 22 architec-

ture to convert between the frequency and time domains.

The tone frequencies are deﬁned with a 24-bit input to a
direct digital synthesis (DDS) system. This results in a fre-
quency resolution of 0.1431 Hz for probe tones, which is es-
sentially continuous for practical purposes. A 10-bit look-up
table and Taylor series correction generates the probe tone per
channel, which is ampliﬁed to the desired output tone power
and converted back to the full frequency-multiplexed band-
width via the synthesis ﬁlter bank. The DDS system achieves
greater than 100 dB spur-free dynamic range (SFDR) over the
synthesis ﬁlter bank per-channel bandwidth of 2.4 MHz. The
DDS continuous synthesis allows for ﬁne frequency resolu-
tion and fast, phase-continuous frequency switching necessary
for continuously updating the tone frequency with tone track-
ing, as discussed in § VI C.

The 512 time-multiplexed channels output

from the
polyphase ﬁlter bank are processed in two parallel streams
by the baseband processor, which performs the per-channel
calibration and feedback operations discussed in § VI B and
VI C. While the ﬁlter bank channelizes the full 614.4 MHz
bandwidth, we only use the center 500 MHz per AMC as de-
ﬁned by hardware ﬁlters. To reduce power consumption on
the FPGA, the edge channels are dropped from processing,
resulting in 499.2 MHz of bandwidth covering 208 time mul-
tiplexed channels per baseband processor stream for a total
of 416 channels available per 500 MHz band. While drop-
ping the edge channels adds the complication of converting

SMuRF Tone-Tracking Electronics

16

the 614.4 MHz stream from the ADC to a 499.2 MHz stream
for processing, the slower clock speed is critical to ﬁtting the
baseband processor computations within the resource limits
of the FPGA.

For each channel, the ADC output is digitally downcon-
verted with the output from the DDS to center it about 0 Hz.
At this point, the data may be optionally output as per-channel
orthogonal I and Q streams for ofﬂine test and debugging pur-
poses. Application of calibration (as discussed in § VI B)
transforms this data into tone frequency and frequency error
between the output tone and the resonator frequency. Finally,
an adaptive loop ﬁlter conﬁgured with feedback parameters
(as discussed in § VI C) outputs ﬂux ramp demodulated data
at the ﬂux ramp frame rate, and feeds back to the DDS to up-
date the output tone frequency during tracking.

After interacting with the baseband processor, the time-
multiplexed processed channels are padded from 499.2 MHz
back to the 614.4 MHz bandwidth and synthesized into a
614.4 MHz I/Q stream via the synthesis ﬁlter bank. A user-
deﬁned delay may be added to correct for any system delays
due to cabling, processing, etc. before being passed to the
DAC. The relevant frequency domains of the channelization
and synthesis process is given in the main RF loop of Fig-
ure 10.

B. Frequency Error Estimation

Following the tone synthesis and analysis, the SMuRF elec-
tronics can be thought of as a system that is capable of gener-
ating tones and reading back the complex response as a chan-
nelized stream of orthogonal in-phase and quadrature compo-
nents, typically denoted I and Q respectively. This I/Q stream
may then be processed by the baseband processor, which acts
on each channel serially. A conceptual diagram of the base-
band processor is given in Fig. 13.

For µmux systems, we are typically interested in modula-
tion of the resonance frequency due to incoming power on
the detector. We thus seek to transform our complex digital
data to an estimate of resonator frequency shifts. We trans-
form shifts of the resonance frequency into shifts entirely in
the phase (Q) direction of the resonator response via a rotation
and scaling of the resonator’s complex response, allowing us
to ignore changes in the amplitude direction (I). Equivalently,
we rotate the resonator circle in the complex plane such that it
is oriented as given in Figure 2, and approximate small move-
ments near the resonance frequency as occurring along a sin-
gle axis.

The resonance frequency is estimated as the point of mini-
mum amplitude response, which is true for an ideal resonator
and a good approximation for typical NIST CMB-style µmux
resonators. Resonance frequency estimation is performed in
software; thus other metrics may be supported by the SMuRF
system as various applications require.

The resonator has a response in the complex plane corre-
sponding to the real and imaginary components of the S21 re-
sponse. This response may be rotated and scaled by a complex
number η such that for small changes in resonance frequency,

FIG. 11. Conceptual diagram of the downconversion process for a
single SMuRF channel. Heuristically, the process works as follows:
(1) The incoming data x[n] consists of N channels separated in fre-
quency space across the 614.4 MHz-wide output of the ADC, cen-
tered each at frequency θk for k = 1, 2, . . . , N.
(2) Each channel is centered by multiplying with the inverse of the
channel center frequency e− jθkn.
(3) A digital low-pass prototype ﬁlter is applied.
(4) We downsample by M = 256 to arrive at a 2.4 MHz-wide single-
channel output.
This process is implemented in parallel for N = 512 channels via the
analysis ﬁlter bank. The similar upconversion process occurs via the
synthesis ﬁlter bank in the reverse order.

FIG. 12. A zoomed-in section of the ﬁlter bank response for 16 in-
terleaved 2.4 MHz wide channelization bins. Note that the channels
are oversampled by 2 such that the bins are overlapping with each
other. The ﬁlter bank converts between 614.4 MHz of bandwidth
and 512 time multiplexed bins that are each 2.4 MHz wide.

SMuRF Tone-Tracking Electronics

17

FIG. 13. The per-channel baseband processor. This acts on each of the channels serially, clocked at 499.2 MHz. Various intermediate points
are available to examine for debugging and more detailed characterization, or the ﬁnal demodulated data is passed to the data streamer for
packaging and writing to disk or to external DAQ. External inputs are shown in red, FPGA computations are shown in green, interactions with
the ﬁlter banks are given in blue, and options for data outputs are in pink.

the change in S21 is entirely in a single quadrature.

For (I±, Q±) the complex transmission measured at fre-
quency offset ±∆ f from the resonance frequency, we estimate
η as

η =

2∆ f
(I+ − I−) + i(Q+ − Q−)

.

(3)

We see that the denominator gives an angle in the complex
plane by which to rotate the resonance circle, while the over-
all magnitude is set by the sharpness of the resonance. Thus,
η has the effect of rotating and scaling the resonance circle
such that the real and complex axes have physically meaning-
ful units and with the Smin
21 rotated to be parallel to the imagi-
nary axis.

With this calibration, the frequency shift may then be esti-

mated as

∆ f ∼ ˆ∆ f ≡ Im [S21(∆ f ) × η]

(4)

where S21(∆ f ) is the complex transmission at the shifted res-
onance frequency. Throughout this text we denote estimates
with a hat. This estimate is equivalent to projecting the ro-
tated and scaled S21 response at the probe tone frequency onto
a single axis. A sketch of this calibration scheme is given in
Fig. 14.

The estimate holds for small changes in frequency and in
the limit that shifting the resonance frequency away from the
tone is the inverse of shifting the tone, ie

∂ S21 ( f − fres(φ ))
∂ f

= −

∂ S21 ( f − fres(φ ))
∂ fres(φ )

(5)

where f is the probe tone frequency and fr is the resonance
frequency, which depends on the ﬂux φ . This assumption is
valid for most resonator-based readout systems in the small
signal limit, i.e. where the frequency shift ∆ f is small com-
pared with the resonance bandwidth. Figure 15 shows the es-
ˆ∆ f using the η calibration versus the
timated frequency error

true frequency error ∆ f . In particular, we note that the fre-
quency error estimate holds only for a small region within the
resonance bandwidth.

The η estimate must be performed once per resonance, typ-
ically at the ﬁrst cooldown for a set of resonators. The calibra-
tion is largely stable between data-taking sessions and fridge
cycles for a given set of devices, and saved for reuse between
device cooldowns. Subsequent to η calibration, the SMuRF
is capable of channelizing tones and returning the output tone
frequency and frequency error, interpreted as the resonator
frequency offset from the probe tone, for each resonator si-
multaneously.

C. Tone Tracking and Flux Ramp Demodulation

We implement a feedback loop to minimize the SMuRF es-
timate of the frequency error magnitude and continuously up-
date the probe tone to be positioned at the estimated resonance
frequency.

When using the microwave SQUID multiplexer, the detec-
tor signal is reconstructed via phase shifts in the ﬂux ramp re-
sponse, which are linear in detector signal for detector signals
much slower than the ﬂux ramp rate. For recent generations
of NIST CMB-style µmux resonators with bandwidth of about
100 kHz, we typically modulate the SQUIDs with ﬂux ramp
sawtooth rates of several kHz and 3 to 6 ﬂux quanta swept per
sawtooth period.16

Rather than design a feedback loop to directly track arbi-
trary signals at 10s of kHz or faster, which is challenging due
to latency from the ﬁlter bank, we rely on the periodicity of the
ﬂux ramp response. That is, we express the ﬂux-ramp mod-
ulated frequency response of the resonator as in Equation 2,
reproduced here for convenience:

∆ f (t) = B

(cid:18) λ cos(ωct + θ (t))

1 + λ cos(ωct + θ (t))

(cid:19)

.

SMuRF Tone-Tracking Electronics

18

FIG. 14. A sketch of the calibration and frequency error estimation. [Left] An uncalibrated resonator generically has some response in the
complex plane that may be arbitrarily rotated and scaled. A probe tone (orange) is initially tuned to the point of minimum transmission Smin
21
(red), but as the resonator is modulated by ﬂux the Smin
21 will shift away from the probe tone. [Right] Following calibration by η as deﬁned in
Eq. 3, the resonance circle is scaled such that the axes are in physically meaningful units and the small changes in the resonance frequency
correspond to movements in only one axis. The frequency error ∆ f between the probe tone and the new resonance frequency is estimated as
the projection (green) of the probe tone complex response onto a single axis, corresponding to Eq. 4.

of about 100 kHz and λ ∼ 1/3, though this discussion ap-
plies without loss of generality to any sufﬁciently periodic
signal.16 For detector signal θ (t) approximately constant rela-
tive to ωct, we treat this as an estimation problem for multiple
sinusoids in a truncated Fourier series, where we have M sinu-
soids of known frequencies. These frequencies are harmonics
of the carrier with known frequency fc but unknown in ampli-
tude or phase.

Thus, the resonance frequency of a given channel as func-

tion of time is parameterized by

f [n] = constant +

M
∑
i=1

Ai sin(ωiTsn + θi) + w[n],

(6)

where we include a constant offset term and a Gaussian mea-
surement noise w[n]. Here, n is the sample number and Ts is
the time per discrete sample, which is Ts = 1/(2.4 MHz) as
deﬁned by the ﬁlter bank per-channel bandwidth. Expanding
the sine terms, we can rewrite the frequency as a sum of sines
and cosines:

f [n] = constant +

(cid:32) M
∑
i=1

ai sin ωiTsn + bi cos ωiTsn

+ w[n]

(cid:33)

where

ai = Ai cos θi,

bi = Ai sin θi.

(7)

(8)

FIG. 15. Estimated frequency error with the η multiplication (blue)
versus real frequency error for a simulated resonator (orange). The
ˆ∆ f (blue) matches
regime in which the estimated frequency error
the real frequency error is in a narrow band about the resonator fre-
quency (∆ f = 0). SMuRF tracks resonators with tones in this narrow
bandwidth while ﬂux ramping using an adaptive ﬁlter as described in
Section VI C.

The carrier frequency fc = ωc/2π is the product of the ﬂux
ramp sawtooth reset rate and the number of ﬂux quanta swept
in a single ﬂux ramp period. For NIST CMB-style µmux res-
onators, the design values are a resonator peak to peak swing

SMuRF Tone-Tracking Electronics

In the limit of slowly varying θ (t), the ai and bi are approx-
imately constant, and the overall frequency estimate is linear
in the ai, bi, and constant offset. The change in phase of each
harmonic is given by ∆ arctan(bi/ai) = i × ∆θi. As the detec-
tor signal modulates the phase of the entire SQUID response
curve, we seek an estimate of the phase of the fundamental
harmonic θ1 = arctan(b1/a1). Due to FPGA resources, in the
µmux system we take the number of tracked harmonics M to
be 3. In practice this provides a sufﬁcient parameterization of
well-behaved SQUID curves on NIST CMB-style µmux de-
vices.

For M harmonics of a fundamental frequency ω1, Eq. 7 may

be rewritten as

(cid:126)f = H(cid:126)α + (cid:126)w

19

(9)

where (cid:126)f and (cid:126)w are M × 1 column vectors of resonance fre-
quency values and measurement noise for N discrete samples
per ﬂux ramp frame. We deﬁne coefﬁcient vector (cid:126)α as a
(2M + 1) × 1 column vector of sine and cosine coefﬁcients
a1, b1, . . . , aN, bN, constant for M harmonics and a constant
offset term. The harmonic sample matrix H is an N ×(2M +1)
matrix given by







sin1[0]
sin1[1]
...

H =

cos1[0]
cos1[1]
...

sin2[0]
sin2[1]
...

cos2[0]
cos2[1]
...

sin1[N − 1] cos1[N − 1] sin2[N − 1] cos2[N − 1]



,





· · · 1
· · · 1
...
. . .
· · · 1

(10)

where

sinm[n] ≡ sin (ωmTsn) , ωm = m × ω1

(11)

and similarly for cosm[n]. Our problem thus reduces to esti-
mating the coefﬁcients vector (cid:126)α.

The current SMuRF tracking and demodulation loop imple-
ments this estimation using a recursive algorithm. The funda-
mental tracking frequency f1 = ω1/2π is assumed known and
must be measured using software tools (§ VII C) or input by
the user. At each discrete timestep n, a probe tone centered on
a resonance has frequency predicted as

ˆf [n] = a1[n] sin(ω1[n]) + b1[n] cos(ω1[n]) + · · · +C

(12)

which may be thought of equivalently as the dot product of
the nth row of H with (cid:126)α. Simplifying notation, we can write
the nth row of H as(cid:126)h[n], given by

(cid:126)h[n] = (cid:0) sin1[n] cos1[n]

· · · sinN[n] cosN[n] 1 (cid:1) .

(13)

Eq. 12 is then written more compactly as

ˆf [n] =(cid:126)h[n] ·(cid:126)α[n].

(14)

We measure the frequency error as described in § VI B fol-

lowing Eq. 4 as

ˆ∆ f [n] ≡ f [n] − ˆf [n] ≈ Im (cid:0)S21

(cid:0) ˆf [n] − fres[n](cid:1) × η(cid:1)

(15)

Importantly, we measure only ˆ∆ f [n] and do not have access to
the true fres[n].

Based on this readback, we update the prediction via a feed-

back loop such that

(cid:126)α[n + 1] = (cid:126)α[n] + µ ˆ∆ f [n]((cid:126)h[n])T

(16)

where µ is a user-tuned gain parameter. This algorithm is
equivalent to the stochastic gradient descent method, where
we are attempting to minimize ˆ∆ f [n].50 Note that
ˆf [n] and
ˆ∆ f [n] are scalars corresponding to the probe tone frequency
and estimated frequency error, respectively, of a single chan-
nel at discrete timestep n. Since ω1 is known, the ﬂux ramp
rate is no longer limited by the bandwidth of the constant-only
tracking loop, i.e. the N = 0 case.

In this N = 0 case of no ﬂux ramp such as with KID sys-
tems or when slower tracking is desired, (cid:126)α reduces to a single
constant frequency error α = ∆ f . We further see that (cid:126)h[n] is
simply 1, and ˆ∆ f [n] is the estimated frequency error, which
is added to the previous constant offset term α with some
gain µ.
In this limit, a model with only the constant off-
set term is equivalent to having only proportional control in
the tracking loop. The bandwidth of this operation alone is
about several kHz, setting the limit for tracking bandwidth in
non-ﬂux ramped systems. Planned modiﬁcations for KID sys-
tems would use the resources freed up by no longer using the
higher harmonic tracking to add a proportional gain term or a
lead/lag compensator to increase the loop bandwidth, allow-
ing for higher bandwidth applications such as calorimetry.

Since this tracking loop estimates coefﬁcients of the har-
monic content, the constant term encodes frequency shifts not
directly sampled by the harmonics vector (cid:126)h[n]. In the case of
poorly selected tracking frequencies ωi, this effectively aliases
against the true modulation frequency and misconstructs the
phase. The constant term C absorbs slow shifts in the res-
onator frequency or the amplitude of transmitted quadrature
voltage through the resonator, potentially suppressing sources
of noise including but not limited to ampliﬁer gain ﬂuctuations
and microphonic pickup.

The user-deﬁned parameters to the tracking algorithm are
the fundamental harmonic frequency ω1 and the gain µ. As is
typical for generic tracking feedback systems, the gain must
be large enough to guarantee convergence without causing sta-

SMuRF Tone-Tracking Electronics

20

bility issues. In practice, there exists a broad range of gain
values for which the feedback loop is stable, with the gain
determining the feedback loop bandwidth.

The fundamental tracking frequency f1 is independent of
the resonator bandwidth, and resonators centered in bins of the
polyphase ﬁlter bank can in principle be tracked as fast as the
per-channel Nyquist frequency, which for the SMuRF CMB
ﬁrmware implementation is 1.2 MHz. Resonator tracking at
rates faster than the resonator bandwidth may be desirable
for several applications. The tracking loop updates for each
channel at the per-channel digitization rate of 2.4 MHz; how-
ever, the stochastic gradient descent method is only expected
to converge on the mean phase over the ﬂux ramp period.51
Therefore, while the tracked frequency of each resonator is
sampled at 2.4 MHz, detector information is only sampled at
the ﬂux ramp rate. Because the tracking feedback loop acts
as a low pass ﬁlter, its bandwidth must be limited to at most
half the ﬂux ramp rate through the choice of tracking gain µ
or pre-ﬁltering to avoid aliasing detector noise into the signal
band. Combined with the fact that increasing ﬂux ramp rate
modulates the detector signal band to a region of lower TLS
contributions, higher ﬂux ramp rates are generically preferred
to reduce readout noise.46

To avoid losing lock on the feedback loop during the ﬂux
ramp sawtooth resets, which cause a transient in the SQUID
that are difﬁcult to track, the tracking algorithm supports
a user-tuned window within each ﬂux ramp frame to be
“blanked off”, or removed from the feedback loop. During
this period, the coefﬁcients α are held constant at the last up-
dated value. The size of this window is typically tuned to
cover the sawtooth reset period and subsequent transient re-
sponse, and to maintain an integer number of ﬂux quanta be-
ing tracked in the active loop. Blanking introduces an aliasing
penalty due to the lower duty cycle, which is mitigated by
keeping the blanking window size as short as possible.

D. Other Miscellaneous Firmware Functions

In addition to tone synthesis and readback, channelization,
frequency error estimation, and tracking, the ﬁrmware han-
dles miscellaneous functions such as the data streaming in-
terface, timing synchronization between SMuRF and external
systems, and control and conﬁguration of the AMCs, RTM,
and cryostat card.

In the carrier FPGA ﬁrmware, the streaming data framer
sums the estimated coefﬁcients of the ﬁrst tracked harmonic
a1, b1 as discussed in § VI C for each ﬂux ramp frame and
writes them to a dual port RAM at the start of each frame. This
effectively averages over the ﬂux ramp frame. From the dual-
port RAM of each baseband processor, the per-channel coef-
ﬁcients and channel ID information are combined into a full
4096 channel RAM. The per-channel phase is computed se-
rially as θ1 = arctan(b1/a1) with a coordinate rotation digital
computer (CORDIC) algorithm, packaged with header infor-
mation, and passed to the software streaming interface. The
header includes information about the hardware conﬁguration
including the RTM DAC settings including detector bias set-

tings, ﬂux ramp status, timing counters and synchronization
bits, data rate, and optional user words. Additional coefﬁ-
cients from the higher harmonics of the tracking loop could in
principle be added to the data stream for higher signal to noise
performance, although in practice have not yet been found
necessary and are not currently implemented.

The arctan computation is clocked at 156.25 MHz. Since
all 3328 channels must pass through a single CORDIC for
the phase calculation, this clock thus limits the per-channel
streaming data rate to 156.25 MHz / 3328 channels ∼ 50 kHz.
Since the ﬂux ramp reset rate in typical operation has not
exceeded ∼ 30 kHz, this is acceptable for current uses but
could be upgraded to faster clock rates if necessary. Faster
data rates are available for writing directly to disk for diag-
nostic and debugging purposes. These may be sampled up to
the per-channel digitization rate of 2.4 MHz per channel, or
the decimated 614.4 MHz ADC speed for the full band with-
out channelization. Applications with fewer channels, such as
high bandwidth pulse detection applications, would also have
higher data streaming rates without the need for an upgraded
clock.

The ﬂux ramp sawtooth reset is triggered through one of
three possible modes:
(1) internally, (2) through a trigger
from a common timing system, or (3) from an external TTL
trigger on a LEMO port on the RTM. The internal timing
mode uses a 32-bit programmable count limited counter in
the FPGA, clocked at the complex baseband processing rate
of 307.2 MHz. The trigger and pulse width are passed to the
digital signal processing core for ﬂux ramp demodulation and
to the CPLD, which has a 32-bit counter to receive the ex-
ternal reset. The upper 20 bits of the CPLD counter are se-
lected to output to the ﬂux ramp DAC on the RTM, which
allows for better ﬂux ramp amplitude control. For large in-
stallations in which the timing information is important, the
external timing option allows for higher precision and syn-
chronization. The common timing system was originally de-
veloped for accelerator systems and designed for synchroniz-
ing large numbers of devices to sub-nanosecond precision.47
In this case, a separate timing card distinct from the SMuRF
carrier card generates a timing data stream at 2.4576 GS/s
and broadcasts timing words over a serial ﬁber. The timing
words are subsequently decoded by each individual SMuRF
carrier card. These words may be derived from an external
timing system to allow for synchronization between SMuRF
and non-SMuRF timing systems within a given experiment.

While the bulk of the ﬁrmware is located on the carrier card,
the PIC microcontroller on the cryostat card and the CPLD on
the RTM additionally run ﬁrmware. The RTM CPLD is nomi-
nally clocked at 51.2MHz to accommodate the maximum fre-
quency of the ﬂux ramp DAC of 50MHz, though the ﬂux ramp
DAC is typically operated well below this frequency. An arbi-
trary waveform generation module containing a look-up table
is capable of writing pairs of bias DAC values sequentially,
which allows for up to ∼ 1kHz updates to the DAC output
voltages. Due to ﬁrmware resource limitations, the CPLD in-
terface is write-only, so to maintain a record of operations we
cache written values in FPGA shadow memory (BRAM).

The large-scale PCIe streaming interface splits incoming

SMuRF Tone-Tracking Electronics

21

FIG. 16. Total consumption proﬁle of ﬁxed resources for the FPGA,
a Xilinx Kintex UltraScale+ XCKU15P. The terms are as follows:
LUT = look-up tables, LUTRAM = look-up table RAM, FF = ﬂip-
ﬂops, BRAM = block memory, URAM = larger block memory, DSP
= digital signal processing blocks, IO = input/output interfacing, GT
= gigabit transceivers, BUFG = global clocking, MMCM = mixed-
mode clocking manager, PLL = phase-locked loops for clocking.

data from the QSFP links to separate ports handling ﬁrmware
register access and streaming data, respectively. Up to 6 carri-
ers, typically run together in a single 7-slot ATCA crate with
a network switch occupying the ﬁnal slot. Each carrier’s reg-
ister access and data streaming ports are routed to the CPU
via direct memory access (DMA) lanes. The register access
port is low-latency for fast commanding and access. Every
pair of carriers receives a dedicated 4 GB error correction
code (ECC) DDR4 block, allowing for 2 GB of determinis-
tic buffering per carrier before the CPU RAM to avoid drop-
ping packets due to CPU back pressures on the DMA path.
To avoid software data operations from back pressuring the
register access, the DMA lanes for register access and data
streaming are kept separate with independent PCIe DMA de-
scriptors.

E. Firmware Resource Consumption

A challenge for SMuRF was ﬁtting the ﬁrmware within the
resource proﬁle of the FPGA. The total FPGA resource con-
sumption proﬁle is given in Figure 16. We see that the most
intensive elements for the SMuRF involve memory and sig-
nal processing. The high FPGA ﬁrmware resource usage and
high 614.4 MHz clock rate is near the device limits and re-
quire substantial ﬁrmware optimization. We conﬁrm that the
requisite power draw and thermal environment can be main-
tained within device limits for this conﬁguration even in high-
altitude environments in § VIII F.

FIG. 17. A block diagram of the software components. A server
(Dell R440) interfaces with the FPGA via Rogue via the EPICS
framework. The pysmurf control software provides the end-user
interface with the system.

VII. Software

A block diagram of the SMuRF software interface is given
in Fig. 17. The FPGA is interfaced with a server via Rogue52,
a Python-based hardware abstraction and data-streaming sys-
tem. Rogue registers are accessed via the Experimental
Physics and Industrial Control System (EPICS)53, a control
system architecture which acts as a communication protocol
between the ﬁrmware registers and the end user’s desired in-
terface. For SMuRF end users, the EPICS layer is further
wrapped in the open source pysmurf control software, which
provides higher level processing and analysis tools.54 Each of
these layers is discussed in turn below.

To guarantee a consistent software environment across mul-
tiple deployed systems, the software suite is version controlled
with git55 and deployed to user institutions via Dockers56.
Furthermore, each hardware component has a serial number
programmed in that may be remotely queried to facilitate
hardware tracking across multiple deployments.

A. Rogue

The Rogue system serves as the communication layer be-
tween the FPGA ﬁrmware and the server software. It provides
data streaming and hardware abstraction in a clean, modular-
ized format that enables systems to be brought up from the
prototyping phase to the system integration and deployment
stage. Firmware registers are accessed via a hierarchical tree
structure that encodes and optionally commands the conﬁg-
uration and status of each register. A memory API and data
stream API separately handle FPGA memory access and data
processing, respectively. The data stream may be passed di-
rectly to downstream DAQ programs such as telescope control
suites, as described in § VII D. Metadata streams of any Rogue
process variable can also be streamed alongside the data at the
data rate, allowing for real time recording of important cali-
bration and state information.

SMuRF Tone-Tracking Electronics

B. EPICS

The Rogue ﬁrmware registers are accessed via Experimen-
tal Physics and Industrial Control System (EPICS) process
variables.57 The EPICS interface provides a control system
architecture with a distributed real-time database of register
values and a client/server model with efﬁcient communication
protocol for passing data. Existing infrastructure for EPICS is
built on decades of experience in designing and implement-
ing large-scale control systems for scientiﬁc instruments such
as accelerator systems, including pre-built software tools. It
is currently actively developed and maintained by an interna-
tional collaboration of users across several large scientiﬁc fa-
cilities. A channel access protocol connects the EPICS server,
which wraps the Rogue registers, to the client-side process
variables that may be queried, set, or monitored by any com-
puter on the same client network. EPICS process variable in-
teraction may be conducted in essentially any modern inter-
face, including but not limited to C/C++, Java, perl, python,
Tcl/Tk, sh, and Matlab.

C.

pysmurf Control Software

Since python is an open source language used extensively
for astronomical applications and laboratory experiment set-
tings, our primary user software suite is built in Python3. The
pysmurf control software serves as the interface for general
users interacting with the SMuRF system. The software pro-
vides the following functionality:

• Wraps EPICS process variable control functions and
provides data handling and low level commands, such
as turning tones on and off, setting DAC voltages for
detector and ampliﬁer bias, and acquiring time-ordered
data.

• Provides utility functions for ﬁnding and characterizing
resonators, setting up tone tracking, and acquiring ﬂux
ramp demodulated data.

• Stores speciﬁc hardware conﬁguration information
such as in-line wiring resistance, band frequencies,
SQUID couplings, and shunt resistances in a human-
readable conﬁguration table that may be edited or refer-
enced in later analysis.

• Offers higher level control and analysis functions, in-
cluding but not limited to noise analysis, TES detector
characterization, and system optimization.

The repository is git controlled and actively managed at
SLAC to ensure continuity and cross-system compatibility as
the software advances.

D.

Integration with Telescope Control Suites

The pysmurf software suite and Rogue streaming inter-
face can be integrated with other experimental DAQ/control

22

suites, aligning detector data with information such as tele-
scope pointing, housekeeping, and observatory state. It is pos-
sible to either encode syncwords in the frame headers or re-
lease frames based on sync signals for frame alignment. These
syncwords, typically received from an experiment common
timing synchronization system, allow for frames to be aligned
ofﬂine, typically by a downstream frame packager or in post-
processing. This integration has been successfully demon-
strated with the generic control program (gcp) observa-
tory control suite in a test deployment with the BICEP/Keck
program, and has been built for the Observatory Control Sys-
tem (OCS) in anticipation of deployment for the Simons
Observatory.20,58,59 Critical setup, calibration, and control
functions may be received by SMuRF from a central telescope
DAQ. Optionally downsampled data is digitally low-passed
with a multi-pole Butterworth ﬁlter with user-deﬁned rolloff
frequency. Useful registers may additionally be encoded in
frame headers, allowing for streaming of information such as
detector bias levels and observatory timing synchronization.

E. Simulation Suite

To model the impact of the SMuRF ﬁrmware algorithms,
particularly in frequency error estimation and ﬂux ramp de-
modulation as described in § VI B and VI C, these algorithms
are implemented in a publicly available Python simulation
suite.60 The simulation suite takes as input real or simulated
resonator and SQUID characteristics, detector-referred input
signals, and readout parameters such as ﬂux ramp rate and
tracking loop gain, and outputs the ﬂux ramp demodulated
detector phase as would be output by SMuRF. The details of
this code and example studies of the impact of various user-
selected parameters on ﬁnal detector-referred demodulated
data are presented elsewhere.61 Integration with the pysmurf
user control software suite is planned for a future release.

VIII. Performance

SMuRF systems have been successfully integrated and used
for both laboratory and ﬁeld measurements of CMB detec-
tors, demonstrating achievement of end-to-end system perfor-
mance meeting the goals of CMB experiments.16,20,21 In this
section we explicitly address the electronics requirements as
outlined by § III.

A. RF Dynamic Range and Linearity

As outlined in § III B 1, the RF dynamic range of the elec-
tronics in dBc/Hz, or the level of the total RF noise ﬂoor, is
critical to the readout white noise performance. The SMuRF
was designed to achieve better than 100 dBc/Hz at 30kHz
carrier offset for 2000 tones. At smaller carrier offsets, the
dynamic range is expected to degrade due to the noise pro-
ﬁle of the LO used to upmix the synthesized tones. The
dynamic range of the SMuRF system is considered through

SMuRF Tone-Tracking Electronics

23

the full tone synthesis and analysis chain, which includes the
ADCs, DACs, and the polyphase ﬁlter banks. In Figure 18
we show 2000 tones generated over 4–8 GHz by a SMuRF
system and the dynamic range of one of those tones measured
directly using a signal analyzer connected to the SMuRF RF
output with no additional ampliﬁcation or attenuation beyond
a short length of coaxial cable. Note that measurements do
not include the effects of the downmix, ADCs, or analysis
polyphase ﬁlter bank which combined can both improve and
degrade the achieved end-to-end RF dynamic range.

To check the impact of the entire digital processing chain,
we acquire a 0.5 second timestream of the digitized I and Q
orthogonal data components from a single channel with a low-
band AMC connected in loopback, i.e. with a short coaxial
cable connecting its RF input to its RF output. Since the noise
performance of a single channel is limited by ﬁrmware rather
than hardware choices, one AMC sufﬁces to demonstrate per-
formance without the need for a second AMC. The tone power
is set to -33 dBm output from the DAC, with an additional
6 dB of programmable RF attenuation added to each the RF
input and output on the AMC, as is typically used for NIST
CMB-style resonators. The digital I/Q data are acquired with-
out additional processing, corresponding to the state of the
data at the output of the analysis ﬁlter bank as described in
§ VI A. We take the power spectral density of the time-ordered
data and convert to units of dBc/Hz via normalizing by the
magnitude of the time-ordered data stream. This is given in
the left panel of Figure 19.

We note that the 1/ f performance of a single channel is due
to 1/ f noise in the hardware components, particularly in the
LO generation and RF mixers, which have an fknee ∼ 100 Hz.
However, for µmux this performance is irrelevant due to the
ﬂux ramp modulation scheme: we focus instead on the noise
at the carrier offset, where the sidebands due to ﬂux ramp
modulation are sampled. Thus, we repeat the measurement
shown in Figure 19 while sweeping the generated tone across
the entire frequency band and extract the noise level at 30 kHz
offset, a typical ﬂux ramp Φ0 rate. This is given in the left
panel of Figure 20. For applications requiring better 1/ f
stability in RF performance, upgraded hardware components
have been identiﬁed and may be swapped in easily.

We see that the noise ﬂoor is well below the requirement
of -100dBc/Hz across the entire frequency range. The noise
rises slightly at the band edges, as is expected given the ﬁnite
roll-off of the cavity ﬁlters on the AMC RF daughter cards.

A key design consideration for SMuRF is its ability to read
out a large number of channels for cryogenic multiplexing ap-
plications. We trade off single channel noise performance for
linearity across a large number of channels. We therefore re-
quire that the noise performance achieved in one channel is
scalable to 2000 channels, corresponding to the expected mul-
tiplexing density for NIST CMB-style µmux resonators. In
the right panel Figure 19, we show the noise spectral den-
sity of a single channel in loopback while 2000 channels at
-33 dBm each are turned on from 4-8 GHz across two AMCs,
which are chained in a conﬁguration consistent with operating
a full 4-8 GHz resonator set on a single coaxial line within the
cryostat. This corresponds to the maximum expected chan-

nel density of a full operating SMuRF system, limited by the
density of cryogenic channels. We see that the noise per-
formance suffers minimal penalty as compared to the single
channel case shown in the left side of the ﬁgure.

Similarly, with 2000 channels turned on from 4-8 GHz on
two AMCs, we take the noise on each channel serially and
extract the noise level at 30 kHz offset. This is shown in the
right panel of Figure 20, with the single channel case for com-
parison given on the left panel. For more explicit comparison,
in Figure 21 we plot the histogram of the counts in each side
of Figure 20.

B. White and Low Frequency Noise Performance

√

Reading out newer, optimized (v3.2 or later) NIST CMB-
style resonators not connected to TESs in dark cryostats
with basic magnetic shielding (e.g. only a room-temperature
mumetal can around the cold multiplexer volume), µmux-
coupled SMuRF systems routinely achieve white noise levels
of O(40 pA/
Hz) TES current noise-equivalent with an ap-
proximately 1/ f -like spectrum with 1/ f knees of O(10 mHz)
while multiplexing O(1000) channels.19,62 For ground-based
CMB receivers instrumented with O(10 mΩ) normal resis-
tance TESs this level of readout noise is expected to increase
the total per-detector noise-equivalent power, which is domi-
nated by ﬂuctuations in the observed photon intensity, by only
an additional 1-2%. While a full analysis of the different noise
contributions is deferred to a future publication, typical mea-
sured white noise levels measured at a O(30 kHz) Φ0 mod-
ulation rate are dominated by resonator TLS noise, with a
subdominant contribution from SMuRF’s ﬁnite RF dynamic
range.

√

Conﬁrming the TES and ﬂux ramp drives achieve their
low 50 pA/
Hz output current noise speciﬁcation (see Sec-
tion III B 1) is difﬁcult using conventional benchtop instru-
mentation due to the required sensitivity. From integrated
system measurements, the estimated white noise contributions
from the TES and ﬂux ramp drives are consistent with exceed-
ing their output current noise speciﬁcation. At low frequen-
cies, characterizing the noise performance of the TES and
ﬂux ramp drives is further complicated by additional noise
sources including variations in passive component tempera-
tures, microphonics, and RF phase drift. A method for moni-
toring the overall phase drift of the RF line for slow changes
to enable feedback on tuning parameters or ofﬂine data clean-
ing has further been developed.63 Further discussion of the
low-frequency system performance, with particular focus on
the SMuRF TES and ﬂux ramp drives as well as mitigation
techniques integrated into the software and hardware, will be
addressed in a future publication.

C. Ampliﬁer Linearity and Tone Tracking

As detailed in § III B 2, microwave resonator systems are
often limited by the linearity of both warm and cryogenic RF
components. We see above in § VIII A that the SMuRF RF

SMuRF Tone-Tracking Electronics

24

[Left] 2000 ﬁxed tones generated with SMuRF over 4–8 GHz (with 250 tones in each 500 MHz band) measured directly using a
FIG. 18.
signal analyzer. LOs which fall within the frequency range of the plot are labeled with smaller brown markers. The average tone power in each
500 MHz band has been leveled using the programmable output attenuators. [Right] Zoom in of a single tone while playing 2000 ﬁxed tones,
indicated by a larger orange marker on the lefthand plot. The arrow indicates the measured RF dynamic range at a 30 kHz carrier offset. The
signal analyzer trace has been median ﬁltered (while preserving the maximum) to suppress narrow-band spurs. The dynamic range at 30 kHz
carrier offset exceeds the SMuRF requirement of > 100 dBc/Hz after accounting for the signal analyzer noise ﬂoor (which is only ∼6 dB
lower) and noise which cancels when the RF signals are downmixed with their common LO.

FIG. 19. [Left] The noise spectral density of a single channel looped back directly from RF out to RF in with only that channel on. The traces
represent orthogonal data components I and Q, which should be identical given there is no resonator in the measurement. We expect the 1/ f
knee to be at several hundred Hz due to the LO generation and RF mixers. The white noise level is below -100 dBc/Hz, as expected, with a
roll-off at 1.2 MHz deﬁned by the Nyquist rate of the polyphase ﬁlter bank. Narrow-band spikes are due to a combination of hardware and
ﬁrmware DSP effects, but do not contribute substantially to the total noise power. [Right] The same measurement as the left, but with 2000
tones turned on from 4-8 GHz. The minimal degradation in noise performance demonstrates the excellent linearity of the full SMuRF system.

SMuRF Tone-Tracking Electronics

25

FIG. 20. [Left] The noise at 30 kHz carrier offset of a single channel in loopback across the entire 4-8 GHz frequency range. We see that the
overall level remains below -100 dBc/Hz aside from a handful of outliers. The edges of each 500 MHz band are visible due to the slight roll-off
in the edges of the passband of the cavity ﬁlters. A small overall tilt is expected due to the degradation of RF performance at higher frequencies
for these broadband components. [Right] The same measurement taken while 2000 tones are turned on across 4-8 GHz, with 250 randomly
chosen frequencies chosen in each 500 MHz band. We see that the overall level and shape are nearly identical to that of the single-channel
case.

sion Smin
21 .

We show that this tone tracking system succeeds in reduc-
ing the power at the 4K cryogenic ampliﬁer in a measured sys-
tem in Figure 22. A resonator was calibrated using pysmurf
software tools, with a directional coupler splitting the output
of the cryostat between the SMuRF RF input on the strongly-
coupled port and a spectrum analyzer on the weakly-coupled
port. The power at the input of the cryogenic LNA chain was
computed by taking the integrated power in a 100 Hz window
around the probe tone frequency as measured by the spectrum
analyzer and adjusting appropriately for the ampliﬁer gains
and coupler loss. When tracking is off, the probe tone is sta-
tionary and the total power at the 4K LNA input varies by over
10 dBm. After tracking is enabled, the probe tone moves with
the resonance, and the power incident on the cryogenic am-
pliﬁer is minimized and constant. Since the system linearity
scales exponentially with the power incident on the RF ampli-
ﬁers, this allows for substantial relaxation on the requirements
for the linearity of the hardware components.

This minimization of tone power on the cryogenic ampli-
ﬁer is critical to reducing intermodulation products in band,
which may contribute to crosstalk or noise. We demon-
strate the improvement of the overall noise ﬂoor due to re-
duced intermodulation products in Fig 23. Here, a sin-
gle NIST CMB-style µmux resonator chip with 65 SQUID-
coupled resonators spanning 4.25-4.5 MHz is calibrated with
SMuRF at a tone power roughly corresponding to -70 dBm
the input of the resonators. After interact-
per tone at
ing with the resonators,
the tones are ampliﬁed with a
4K HEMT (Low Now Factory LNF-LNC4-8C-LG), a 50K
follow-on ampliﬁer (B&Z Technologies BZUCR-04000800-
031012-102323), and room-temperature ampliﬁer (MiniCir-
cuits ZX60-83LN12+) and input to a spectrum analyzer. Af-
ter feedback is disabled, no additional external ﬂux is applied

FIG. 21. Noise at 30 kHz offset of each channel in loopback with 1
or 2000 channels turned on using identical attenuation and ampliﬁ-
cation settings. The 2000 channel data was taken with 1000 channels
each from a low band and high band AMC connected serially in loop-
back. We see that there is a modest penalty from turning on 2000
channels across the 4 GHz bandwidth, but the overall distribution
falls within the -100 dBc/Hz speciﬁcation from the initial require-
ment.

components achieve the requisite linearity: the warm system
in loopback suffers minimal degradation when 2000 channels
are operated simultaneously. The linearity of the full RF chain
is therefore typically limited by the achievable linearity of the
cryogenic ampliﬁer and other cold RF components. As de-
scribed in § VI C, SMuRF addresses this linearity problem by
implementing a closed loop feedback algorithm to maintain
the probe tone on the point of minimum amplitude transmis-

SMuRF Tone-Tracking Electronics

26

The power incident on the ﬁrst-stage cryogenic ampli-
FIG. 22.
ﬁer with and without tone tracking for a single tone tuned to a NIST
CMB-style µmux resonator. We see that the average power incident
on the ampliﬁer is reduced by about 5 dB for a single tone due to
tone tracking, and by more than 10 dB for some bias points, signiﬁ-
cantly reducing the linearity requirement for the cryogenic ampliﬁer
performance.

to the SQUID. The measurement was limited by availability
of cold multiplexer chips at the time it was performed; how-
ever, we see that even with a small subset of the full O(1000)
tones used in typical operation, the overall noise ﬂoor due to
the additional intermodulation products when feedback is dis-
abled is elevated by ∼ 3 dBm, thus degrading the RF dynamic
range. This degradation is prohibitive for µmux at full multi-
plexing density; thus, the tone-tracking capability of SMuRF
is key to achieving the O(1000)x or higher multiplexing fac-
tors desired.

D. Bandwidth

The measurements in § VIII A and VIII C indicate that the
SMuRF achieves the synthesis and analysis of tones across
the full 4-8 GHz bandwidth while exceeding the requirement
for RF dynamic range. We focus now on the achievable band-
width of the detector readout ﬁrmware, including tone track-
ing and ﬂux ramp demodulation. A discussion of the full
bandwidth performance of the tone-tracking algorithm is de-
ferred to a future publication. However, we see in Figure 24
that in the “DC tracking” state in which the ﬂux ramp has
not been activated, the power spectral density of tracked fre-
quency and frequency error rolls off between 1 and 10 kHz
depending on the gain settings used.

Using the adaptive feedback algorithm with tone tracking,
previous measurements have indicated that the SMuRF is ca-
pable of tracking a ﬂux ramp modulated resonance to ﬂux
ramp rates approaching 100 kHz on NIST CMB-style µmux
resonators, well in excess of requirements for CMB polarime-
try measurements.46 We show explicitly in Figure 25 that a
1 kHz sine wave injected on the detector bias line is resolved
through the full tone tracking and ﬂux ramp demodulation

FIG. 23. Spectrum analyzer trace of the probe tone comb interacting
with a single NIST CMB-style µmux resonator chip containing 65
SQUID-coupled resonators. Probe tones approximately equivalent
to -70 dBm per tone at the input of the resonators are calibrated to
the resonators. The spectrum analyzer was placed at the equivalent of
the RF input to SMuRF, after probe tones interact with the resonators
and are ampliﬁed by 4K, 50K, and room temperature ampliﬁers. No
additional ﬂux is applied; thus, any change in resonance frequencies
is due to noise only. We see that when feedback is disabled, the
effective noise ﬂoor rises by about 3 dB.

FIG. 24. Power spectral density of tracked frequency and frequency
error for varying gains and no ﬂux ramp. We see that the tracked fre-
quency rolls off at a few kHz or above depending on the gain setting.
The frequency error is suppressed at low frequencies, corresponding
to the majority of the power being captured by the tracked frequency.

scheme. This measurement was limited by the ability of RTM
slow DACs to play a pre-programmed waveform on the TES
bias line, but is not near the capacity of the system.

SMuRF Tone-Tracking Electronics

27

a typical SMuRF system draws 110 W for the SMuRF carrier,
40 W for each AMC, and 20 W for the RTM. The power con-
sumed by the SMuRF carriers is dominated by the main Xil-
inx Kintex UltraScale+ XCKU15P FPGA, which can draw as
much as 80 W in steady state when reading out resonators over
the full 4 GHz SMuRF bandwidth. The majority of the power
drawn by the FPGA is consumed by the FPGA’s 0.85V inter-
nal supplies, which draw more than 50A which is provided by
an 80A Intel Enpirion Power Solutions EM2280P01QI regu-
lator on the SMuRF carrier. At these large current and power
draws, the temperature limits of this regulator and the main
FPGA are critical design considerations, particularly because
the SMuRF systems are air cooled and intended for use at
high altitude astronomical sites where the air pressure can be
as much as 50% lower than sea level. For the regulator, this
is compounded by the fact that the regulator efﬁciency de-
grades near its 80A limit, which can result in thermal run-
away if not carefully controlled for in design. FPGA lifetime
is an additional concern, since expected lifetime can degrade
if the FPGA temperature exceeds the Xilinx temperature spec-
iﬁcation. The maximum regulator operating temperature is
120◦C.65 Xilinx speciﬁes that the FPGAs must not exceed a
temperature of 100◦C for a 50A input current to ensure a > 10
year lifetime.

Early SMuRF prototypes exceeded these temperature limits
in simulated high altitude conditions. This was addressed in
the subsequent production systems by modifying the SMuRF
FPGA ﬁrmware to signiﬁcantly decrease resource usage and
by making signiﬁcant improvements to the FPGA and regula-
tor heatsink designs and heatsink gluing materials and pro-
cedures. To verify performance, six full SMuRF systems,
each consisting of a SMuRF carrier with two installed AMCs
and an RTM, were tested in a 7-slot COMTEL ATCA crate
along with all required peripherals, including a Dell R440
server and Xilinx KCU1500 data acquisition PCIe card, in a
low pressure chamber.66 With the chamber pressure pumped
down to the equivalent air pressure at 17,000 ft (395 Torr) to
simulate operating conditions at a high altitude astronomical
site, a test routine was run simulating the full computational
load expected for the read out of the maximum 3328 chan-
nels over the full 4 GHz SMuRF bandwidth for each of the
6 SMuRF systems simultaneously. The chamber temperature
was ramped from -5◦C to +25◦C and then back down to -5◦C
on a 3 hour cadence 120 times over the course of 14 days,
simulating the typical diurnal temperature swing expected at
a typical high altitude astronomical site based on environmen-
tal data from the high Andes. No subsystem (including pe-
ripherals) failures were observed over this 14 day run, and
the SMuRF subsystem temperatures and currents were logged
while ramping the chamber temperature. At 20◦C ambient
temperature, the averaged logged temperature for the SMuRF
carrier FPGAs and regulators during this test was 71◦C and
67◦C, respectively, and the average regulator current at 20◦C
was 57A. The measured regulator temperatures are well below
their 120◦C operating limit, and the FPGA currents and tem-
peratures meet Xilinx’s 10 year lifetime speciﬁcation mod-
iﬁed to account for these lower FPGA temperatures.67 The
system was also successfully cold booted at -5◦C three times,

FIG. 25.
[Top] Input signal and ﬂux ramp demodulated signal
played on the detector bias line while the detector was superconduct-
ing. The raw input signal is sparsely sampled and scaled and shifted
to account for the transfer function of the superconducting detector’s
bias circuit and latency. [Bottom] Amplitude spectral density (ASD)
of the input and measured signals. SMuRF easily generates and re-
covers a 1 kHz sine wave, here sampled at a ﬂux ramp frame rate of
30 kHz with 1 Φ0 per ramp. The white noise ﬂoor of ∼ 100 pA/
Hz
is due to Johnson noise generated by the superconducting detector’s
cold bias resistor.

√

E. Crosstalk

Since the polyphase ﬁlter bank achieves 100 dBc/Hz SFDR,
it is expected that the crosstalk between channels is dominated
by the hardware components. The linearity measurements
from § VIII C indicate that the impact of additional probe
tones being turned on in other channels does not contribute
meaningfully to the measured characteristics of existing chan-
nels.

Previous measurements with SMuRF in a full ﬁeld de-
ployment setting including telescope scanning and stream-
ing to external DAQ indicate that the crosstalk between non-
pathological cold multiplexer channels integrated with TESs
is at least 30 dB below the primary detector channel.64

More recent laboratory measurements of the cold multi-
plexer only constrain the crosstalk of well-behaved channels
to about 1 part in 104, consistent with expectations for the
crosstalk of µmux cold hardware.16 These suggest that the
crosstalk of the electronics comfortably meets the existing re-
quirements and dominated by the cryogenic elements.

F. Altitude

We demonstrate that the SMuRF system is operable in high-
altitude environments despite its computationally intensive
digital signal processing algorithm.

Due to high FPGA use and the 614.4 MHz maximum FPGA
clock frequency, each SMuRF system (not including periph-
erals) consumes roughly 210 Watts. Out of this 210 W total,

SMuRF Tone-Tracking Electronics

28

simulating remote recovery in winter conditions.

G. Vibration Sensitivity

The acoustic sensitivity of the SMuRF is determined pri-
marily by the speciﬁc details of a given installation, such as
the RF cabling used and the mounting between the crate and
cryostat. While a comprehensive frequency sweep has not
been exhaustively probed, prior ﬁeld deployment on a scan-
ning telescope indicated the SMuRF electronics suffered from
no obvious additional noise due to the telescope motion, in-
dicating that mounting schemes exist such that the SMuRF
is sufﬁciently acoustically isolated.20 Numerous existing lab
measurement setups indicate no detectable acoustic sensitivity
in the electronics from normal cryogenic laboratory settings,
including the nearby operation of a pulse tube compressor and
water chiller.

In order to sufﬁciently cool the boards within a crate, which
may house arbitrarily many (typically up to 6) parallel SMuRF
systems, we run the SMuRF crate fans at high speeds. This
fan motion does not appear to cause additional noise in the
electronics.

IX. Conclusion and Future Outlook

We have developed a digital readout and control system for
use with large-scale microwave resonator-based arrays. The
SMuRF electronics achieve > 100 dBc/Hz dynamic range at
30 kHz offset for 2000 simultaneous channels across its full
4-8 GHz bandwidth, with capacity to read out up to 3328
channels across its readout bandwidth. Each channel may
return data with bandwidth up to 2.4 MHz and with a va-
riety of processing options up to reporting ﬂux ramp de-
modulated timestreams. Compared to other microwave res-
onator readout systems, SMuRF is unique in its implementa-
tion of a tone-tracking algorithm, which allows for dramati-
cally increasing the channel count without exceeding the lin-
earity requirements of RF elements such as cryogenic ampli-
ﬁers. The system has been designed for integration with other
data acquisition and experimental control platforms, and has
been successfully integrated with control suites for the BI-
CEP/Keck and Simons Observatory CMB experiments. It has
been ﬁelded previously within the BICEP/Keck program and
is baselined for use on the upcoming Simons Observatory and
BICEP Array experiments.

Current efforts are underway to reconﬁgure the existing
SMuRF ﬁrmware and hardware architectures for KID systems
by removing hardware and ﬁrmware functionality required
only for µmux readout. It is estimated that for resonators fab-
ricated with sufﬁcient frequency accuracy, a single SMuRF
card has the resources to support 20,000 KID-type resonators.
This would allow for megapixel arrays to be read out with a
single rack of equipment.

Future SMuRF development efforts include development
of on-board pulse processing algorithms for high-bandwidth
improving the resonator tracking calibration
applications,

scheme for asymmetric resonances, and porting the existing
software and ﬁrmware architecture to newly available “RF
system on a chip” (RFSoC) systems. RFSoC systems allow
for a large simpliﬁcation in RF hardware design, compact pro-
ﬁle, and lower power consumption, making them particularly
attractive for balloon- and space-based missions. Preliminary
results on a Xilinx ZCU111 evaluation board demonstrated
comparable noise performance on 237 tracked channels, with
the measurement limited by the availability of cold resonators
at the time.68 In addition to reproducing the existing SMuRF
ﬁrmware and performance on the RFSoC, a number of im-
provements using the RFSoC platform are being pursued. We
have developed new approaches to calibrating and improv-
ing the linearity of baseband I/Q modulation and demodula-
tion schemes that provide the performance required for µmux
without requiring the large band-splitting cavity ﬁlters present
on the current AMCs. This technique has been successfully
demonstrated with test code on RFSoC hardware and cur-
rently is being fully built out and tested.

Acknowledgments

CY was supported in part by the National Science Foun-
dation Graduate Research Fellowship Program under Grant
No. 1656518. MSF was supported in part by the Depart-
ment of Energy (DOE) Ofﬁce of Science Graduate Student
Research (SCGSR) Program. The SCGSR program is admin-
istered by the Oak Ridge Institute for Science and Education
(ORISE) for the DOE, which is managed by ORAU under
contract number DE-SC0014664. ZA was supported in part
by the DOE Ofﬁce of Science Early Career Research Program.
Several ﬁgures in this paper were generated with numpy and
matplotlib69,70. This work was supported by the Depart-
ment of Energy at SLAC National Accelerator Laboratory un-
der contract DE-AC02-76SF00515.

Data Availability Statement

The data that support the ﬁndings of this study are available

from the corresponding author upon reasonable request.

1C. Enss, ed., Cryogenic Particle Detection (Springer, 2005).
2K. Irwin and G. Hilton, “Transition-edge sensors,” in Cryogenic Particle
Detection, edited by C. Enss (Springer Berlin Heidelberg, Berlin, Heidel-
berg, 2005) pp. 63–150.
3J. Zmuidzinas, “Superconducting microresonators: Physics and applica-
tions,” Annual Review of Condensed Matter Physics 3, 169–214 (2012),
https://doi.org/10.1146/annurev-conmatphys-020911-125022.
4J. A. B. Mates, D. T. Becker, D. A. Bennett, B. J. Dober, J. D. Gard,
J. P. Hays-Wehle, J. W. Fowler, G. C. Hilton, C. D. Reintsema, D. R.
Schmidt, D. S. Swetz, L. R. Vale, and J. N. Ullom, “Simultaneous read-
out of 128 x-ray and gamma-ray transition-edge microcalorimeters using
microwave squid multiplexing,” Appl. Phys. Lett. 111, 062601 (2017),
https://doi.org/10.1063/1.4986222.
5S.-J. Lee, C. Titus, R. Alonso Mori, M. L. Baker, D. A. Bennett, H.-M.
Cho, W. B. Doriese, J. W. Fowler, K. J. Gaffney, A. Gallo, J. D. Gard,
G. C. Hilton, H. Jang, Y. I. Joe, C. J. Kenney, J. Knight, T. Kroll, J.-S.
Lee, D. Li, D. Lu, R. Marks, M. P. Minitti, K. M. Morgan, H. Ogasawara,
G. C. O’Neil, C. D. Reintsema, D. R. Schmidt, D. Sokaras, J. N. Ullom,
T.-C. Weng, C. Williams, B. A. Young, D. S. Swetz, K. D. Irwin, and

SMuRF Tone-Tracking Electronics

29

D. Nordlund, “Soft x-ray spectroscopy with transition-edge sensors at stan-
ford synchrotron radiation lightsource beamline 10-1,” Rev. Sci. Inst. 90,
113101 (2019), https://doi.org/10.1063/1.5119155.
6I. Esmaeil Zadeh, J. Chang, J. W. N. Los, S. Gyger, A. W. Elshaari, S. Stein-
hauer, S. N. Dorenbos, and V. Zwiller, “Superconducting nanowire single-
photon detectors: A perspective on evolution, state-of-the-art, future devel-
opments, and applications,” Applied Physics Letters 118, 190502 (2021),
https://doi.org/10.1063/5.0045990.
7M. Mariantoni, H. Wang, T. Yamamoto, M. Neeley, R. C. Bial-
czak, Y. Chen, M. Lenander, E. Lucero, A. D. O’Connell, D. Sank,
M. Weides, J. Wenner, Y. Yin, J. Zhao, A. N. Korotkov, A. N. Cle-
land,
and J. M. Martinis, “Implementing the quantum von neumann
architecture with superconducting circuits,” Science 334, 61–65 (2011),
https://www.science.org/doi/pdf/10.1126/science.1208517.
8J. A. Sobrin, A. J. Anderson, A. N. Bender, B. A. Benson, D. Dutcher,
A. Foster, N. Goeckner-Wald, J. Montgomery, A. Nadolski, A. Rahlin,
P. A. R. Ade, Z. Ahmed, E. Anderes, M. Archipley, J. E. Austermann, J. S.
Avva, K. Aylor, L. Balkenhol, P. S. Barry, R. Basu Thakur, K. Benabed,
F. Bianchini, L. E. Bleem, F. R. Bouchet, L. Bryant, K. Byrum, J. E. Carl-
strom, F. W. Carter, T. W. Cecil, C. L. Chang, P. Chaubal, G. Chen, H. M.
Cho, T. L. Chou, J. F. Cliche, T. M. Crawford, A. Cukierman, C. Daley,
T. de Haan, E. V. Denison, K. Dibert, J. Ding, M. A. Dobbs, W. Everett,
C. Feng, K. R. Ferguson, J. Fu, S. Galli, A. E. Gambrel, R. W. Gard-
ner, R. Gualtieri, S. Guns, N. Gupta, R. Guyser, N. W. Halverson, A. H.
Harke-Hosemann, N. L. Harrington, J. W. Henning, G. C. Hilton, E. Hivon,
G. P. Holder, W. L. Holzapfel, J. C. Hood, D. Howe, N. Huang, K. D.
Irwin, O. B. Jeong, M. Jonas, A. Jones, T. S. Khaire, L. Knox, A. M. Kof-
man, M. Korman, D. L. Kubik, S. Kuhlmann, C. L. Kuo, A. T. Lee, E. M.
Leitch, A. E. Lowitz, C. Lu, S. S. Meyer, D. Michalik, M. Millea, T. Natoli,
H. Nguyen, G. I. Noble, V. Novosad, Y. Omori, S. Padin, Z. Pan, P. Paschos,
J. Pearson, C. M. Posada, K. Prabhu, W. Quan, C. L. Reichardt, D. Riebel,
B. Riedel, M. Rouble, J. E. Ruhl, B. Saliwanchik, J. T. Sayre, E. Schi-
appucci, E. Shirokoff, G. Smecher, A. A. Stark, J. Stephen, K. T. Story,
A. Suzuki, C. Tandoi, K. L. Thompson, B. Thorne, C. Tucker, C. Umilta,
L. R. Vale, K. Vanderlinde, J. D. Vieira, G. Wang, N. Whitehorn, W. L. K.
Wu, V. Yefremenko, K. W. Yoon, and M. R. Young, “The Design and Inte-
grated Performance of SPT-3G,” arXiv e-prints , arXiv:2106.11202 (2021),
arXiv:2106.11202 [astro-ph.IM].
9J. Chervenak, K. Irwin, E. Grossman, J. Martinis, C. Reintsema,
and
M. Huber, “Performance of multiplexed squid readout for cryogenic sen-
sor arrays,” Appl. Phys. Lett. 74, 4043 (1999).

10M. Dobbs, M. Halpern, K. Irwin, A. Lee, J. Mates, and B. Mazin, “Mul-
tiplexed readout of cmb polarimeters,” J. Phys. Conf. Ser. 155, 012004
(2004).

11K. Irwin, M. Niemack, J. Beyer, H. Cho, W. Doriese, G. Hilton,
C. Reintsema, D. Schmidt, J. Ullom, and L. Vale, “Code-division multi-
plexing of superconducting transition-edge sensor arrays,” Suprcond. Sci.
Technol. 23, 034004 (2010).

12K. M. Morgan, B. K. Alpert, D. A. Bennett, E. V. Denison, W. B. Doriese,
J. W. Fowler, J. D. Gard, G. C. Hilton, K. D. Irwin, Y. I. Joe, G. C. O’Neil,
C. D. Reintsema, D. R. Schmidt, J. N. Ullom, and D. S. Swetz, “Code-
division-multiplexed readout of large arrays of tes microcalorimeters,”
Appl. Phys. Lett. 109, 112604 (2016), https://doi.org/10.1063/1.4962636.
13P. Day, H. LeDuc, B. Mazin, A. Vayonakis, and J. Zmuidzinas, “A broad-
band superconducting detector suitable for use in large arrays,” Nature 425,
817–821 (2003).

14K. Irwin and K. Lehnert, “The microwave squid multiplexer,” Appl. Phys.

Lett. 85, 2107 (2004).

15J. Mates, G. Hilton, K. Irwin, L. Vale, and K. Lehnert, “Demonstration of
a multiplexer of dissipationless superconduting quantum interference de-
vices,” Appl. Phys. Lett. 92, 023514 (2008).

16B. Dober, Z. Ahmed, K. Arnold, D. T. Becker, D. A. Bennett, J. A. Con-
nors, A. Cukierman, J. M. D’Ewart, S. M. Duff, J. E. Dusatko, J. C. Frisch,
J. D. Gard, S. W. Henderson, R. Herbst, G. C. Hilton, J. Hubmayr, Y. Li,
J. A. B. Mates, H. McCarrick, C. D. Reintsema, M. Silva-Feaver, L. Ruck-
man, J. N. Ullom, L. R. Vale, D. D. Van Winkle, J. Vasquez, Y. Wang,
E. Young, C. Yu, and K. Zheng, “A microwave squid multiplexer opti-
mized for bolometric applications,” Applied Physics Letters 118, 062601
(2021), https://doi.org/10.1063/5.0033416.

17S. Shu, M. Calvo, J. Goupy, S. Leclercq, A. Catalano, A. Bideaud,
A. Monfardini,
and E. F. C. Driessen, “Increased multiplexing of su-
perconducting microresonator arrays by post-characterization adaptation
of the on-chip capacitors,” Applied Physics Letters 113, 082603 (2018),
https://doi.org/10.1063/1.5040968.

18C. M. McKenney, J. E. Austermann, J. A. Beall, B. J. Dober, S. M. Duff,
J. Gao, G. C. Hilton, J. Hubmayr, D. Li, J. N. Ullom, J. L. Van Lanen, and
M. R. Vissers, “Tile-and-trim micro-resonator array fabrication optimized
for high multiplexing factors,” Review of Scientiﬁc Instruments 90, 023908
(2019), https://doi.org/10.1063/1.5037301.

19S. W. Henderson, Z. Ahmed, J. Austermann, D. Becker, D. A. Bennett,
D. Brown, S. Chaudhuri, H.-M. S. Cho, J. M. D’Ewart, B. Dober, S. M.
Duff, J. E. Dusatko, S. Fatigoni, J. C. Frisch, J. D. Gard, M. Halpern, G. C.
Hilton, J. Hubmayr, K. D. Irwin, E. D. Karpel, S. S. Kernasovskiy, S. E.
Kuenstner, C.-L. Kuo, D. Li, J. A. B. Mates, C. D. Reintsema, S. R. Smith,
J. Ullom, L. R. Vale, D. D. V. Winkle, M. Vissers, and C. Yu, “Highly-
multiplexed microwave SQUID readout using the SLAC Microresonator
Radio Frequency (SMuRF) electronics for future CMB and sub-millimeter
surveys,” in Millimeter, Submillimeter, and Far-Infrared Detectors and In-
strumentation for Astronomy IX, Vol. 10708, edited by J. Zmuidzinas and
J.-R. Gao, International Society for Optics and Photonics (SPIE, 2018) pp.
170 – 185.

20A. Cukierman, Z. Ahmed, S. Henderson, E. Young, C. Yu, D. Barkats,
D. Brown, S. Chaudhuri, J. Cornelison, J. M. D’Ewart, M. Dierickx, B. J.
Dober, J. Dusatko, S. Fatigoni, J. P. Filippini, J. C. Frisch, G. Haller,
M. Halpern, G. C. Hilton, J. Hubmayr, K. D. Irwin, K. S. Karkare,
E. Karpel, S. A. Kernasovskiy, J. M. Kovac, A. Kovacs, S. E. Kuenstner,
C. L. Kuo, D. Li, J. A. B. Mates, S. Smith, T. S. Germaine, J. N. Ullom,
L. R. Vale, D. D. V. Winkle, J. Vasquez, J. Willmert, L. Zeng, P. A. R. Ade,
M. Amiri, R. B. Thakur, C. A. Bischoff, J. J. Bock, H. Boenish, E. Bullock,
V. Buza, J. Cheshire, J. Connors, M. Crumrine, L. Duband, G. Hall, S. Har-
rison, S. R. Hildebrandt, H. Hui, J. Kang, S. Kefeli, K. Lau, K. G. Mege-
rian, L. Moncelsi, T. Namikawa, H. T. Nguyen, R. O’Brient, S. Palladino,
C. Pryke, B. Racine, C. D. Reintsema, S. Richter, A. Schillaci, R. Schwarz,
C. D. Sheehy, A. Soliman, B. Steinbach, R. V. Sudiwala, K. L. Thomp-
son, C. Tucker, A. D. Turner, C. Umiltà, A. G. Vieregg, A. Wandui, A. C.
Weber, D. V. Wiebe, W. L. K. Wu, H. Yang, K. W. Yoon, and C. Zhang,
“Microwave multiplexing on the keck array,” J. Low Temp. Phys. 199, 858–
866 (2020).

21H. McCarrick, E. Healy, Z. Ahmed, K. Arnold, Z. Atkins, J. E. Auster-
mann, T. Bhandarkar, J. A. Beall, S. M. Bruno, S. K. Choi, J. Connors,
N. F. Cothard, K. D. Crowley, S. Dicker, B. Dober, C. J. Duell, S. M. Duff,
D. Dutcher, J. C. Frisch, N. Galitzki, M. B. Gralla, J. E. Gudmundsson,
S. W. Henderson, G. C. Hilton, S.-P. P. Ho, Z. B. Huber, J. Hubmayr, J. Iu-
liano, B. R. Johnson, A. M. Kofman, A. Kusaka, J. Lashner, A. T. Lee,
Y. Li, M. J. Link, T. J. Lucas, M. Lungu, J. A. B. Mates, J. J. McMahon,
M. D. Niemack, J. Orlowski-Scherer, J. Seibert, M. Silva-Feaver, S. M. Si-
mon, S. Staggs, A. Suzuki, T. Terasaki, J. N. Ullom, E. M. Vavagiakis, L. R.
Vale, J. V. Lanen, M. R. Vissers, Y. Wang, E. J. Wollack, Z. Xu, E. Young,
C. Yu, K. Zheng, N. Zhu, and R. Thornton, “The simons observatory mi-
crowave SQUID multiplexing detector module design,” The Astrophysical
Journal 922, 38 (2021).

22N. Galitzki, A. Ali, K. S. Arnold, P. C. Ashton, J. E. Austermann, C. Bac-
cigalupi, T. Baildon, D. Barron, J. A. Beall, S. Beckman, S. M. M. Bruno,
S. Bryan, P. G. Calisse, G. E. Chesmore, Y. Chinone, S. K. Choi, G. Coppi,
K. D. Crowley, K. T. Crowley, A. Cukierman, M. J. Devlin, S. Dicker,
B. Dober, S. M. Duff, J. Dunkley, G. Fabbian, P. A. Gallardo, M. Gerbino,
N. Goeckner-Wald, J. E. Golec, J. E. Gudmundsson, E. E. Healy, S. Hen-
derson, C. A. Hill, G. C. Hilton, S.-P. P. Ho, L. A. Howe, J. Hubmayr,
O. Jeong, B. Keating, B. J. Koopman, K. Kiuchi, A. Kusaka, J. Lashner,
A. T. Lee, Y. Li, M. Limon, M. Lungu, F. Matsuda, P. D. Mauskopf, A. J.
May, N. McCallum, J. McMahon, F. Nati, M. D. Niemack, J. L. Orlowski-
Scherer, S. C. Parshley, L. Piccirillo, M. S. Rao, C. Raum, M. Salatino, J. S.
Seibert, C. Sierra, M. Silva-Feaver, S. M. Simon, S. T. Staggs, J. R. Stevens,
A. Suzuki, G. Teply, R. Thornton, C. Tsai, J. N. Ullom, E. M. Vavagiakis,
M. R. Vissers, B. Westbrook, E. J. Wollack, Z. Xu, and N. Zhu, “The Si-
mons Observatory: instrument overview,” in Millimeter, Submillimeter, and
Far-Infrared Detectors and Instrumentation for Astronomy IX, Vol. 10708,
edited by J. Zmuidzinas and J.-R. Gao, International Society for Optics and
Photonics (SPIE, 2018) pp. 1 – 13.

SMuRF Tone-Tracking Electronics

30

23L. Moncelsi, P. A. R. Ade, A. Z, M. Amiri, D. Barkats, R. B. Thakur, C. A.
Bischoff, J. J. Bock, V. Buza, J. R. Cheshire, J. Connors, J. Cornelison,
M. Crumrine, A. J. Cukierman, E. V. Denison, M. Dierickx, L. Duband,
M. Eiben, S. Fatigoni, J. P. Filippini, N. Goeckner-Wald, D. Goldﬁnger,
J. A. Grayson, P. Grimes, G. Hall, M. Halpern, S. A. Harrison, S. Hen-
derson, S. R. Hildebrandt, G. C. Hilton, J. Hubmayr, H. Hui, K. D. Irwin,
J. H. Kang, K. S. Karkare, S. Kefeli, J. M. Kovac, C. L. Kuo, K. Lau,
E. M. Leitch, K. G. Megerian, L. Minutolo, Y. Nakato, T. Namikawa,
H. T. Nguyen, R. O’brient, S. Palladino, N. Precup, T. Prouve, C. Pryke,
B. Racine, C. D. Reintsema, A. Schillaci, B. L. Schmitt, A. Soliman, T. S.
Germaine, B. Steinbach, R. V. Sudiwala, K. L. Thompson, C. Tucker, A. D.
Turner, C. Umiltà, A. G. Vieregg, A. Wandui, A. C. Weber, D. V. Wiebe,
J. Willmert, W. L. K. Wu, E. Yang, K. W. Yoon, E. Young, C. Yu, L. Zeng,
C. Zhang, and S. Zhang, “Receiver development for BICEP Array, a next-
generation CMB polarimeter at the South Pole,” in Millimeter, Submillime-
ter, and Far-Infrared Detectors and Instrumentation for Astronomy X, Vol.
11453, edited by J. Zmuidzinas and J.-R. Gao, International Society for
Optics and Photonics (SPIE, 2020) pp. 189 – 206.

24T. R. Stevenson, M. A. Balvin, S. R. Bandler, A. M. Devasia, P. C. Na-
gler, K. K. Ryu, S. J. Smith, and W. Yoon, “Magnetic calorimeter option
for the Lynx x-ray microcalorimeter,” Journal of Astronomical Telescopes,
Instruments, and Systems 5, 1 – 9 (2019).

25Y. Chen, D. Sank, P. O’Malley, T. White, R. Barends, B. Chiaro, J. Kelly,
E. Lucero, M. Mariantoni, A. Megrant, C. Neill, A. Vainsencher, J. Wenner,
Y. Yin, A. N. Cleland, and J. M. Martinis, “Multiplexed dispersive read-
out of superconducting phase qubits,” Applied Physics Letters 101, 182601
(2012), https://doi.org/10.1063/1.4764940.

26O. Bourrion, A. Bideaud, A. Benoit, A. Cruciani, J. F. Macias-Perez,
A. Monfardini, M. Roesch, L. Swenson, and C. Vescovi, “Electronics and
data acquisition demonstrator for a kinetic inductance camera,” Journal of
Instrumentation 6, 6012 (2011), arXiv:1102.1314 [astro-ph.IM].

27S. McHugh, B. A. Mazin, B. Serfass, S. Meeker, K. O’Brien, R. Duan,
R. Raffanti, and D. Werthimer, “A readout for large arrays of microwave
kinetic inductance detectors,” Review of Scientiﬁc Instruments 83, 044702–
044702 (2012), arXiv:1203.5861 [astro-ph.IM].

28S. Gordon, B. Dober, A. Sinclair, S. Rowe, S. Bryan, P. Mauskopf,
J. Austermann, M. Devlin, S. Dicker, J. Gao, G. C. Hilton, J. Hubmayr,
G. Jones, J. Klein, N. P. Lourie, C. McKenney, F. Nati, J. D. Soler,
M. Strader, and M. Vissers, “An Open Source, FPGA-Based LeKID Read-
out for BLAST-TNG: Pre-Flight Results,” Journal of Astronomical Instru-
mentation 5, 1641003 (2016), arXiv:1611.05400 [astro-ph.IM].

29J. van Rantwijk, M. Grim, D. van Loon, S. Yates, A. Baryshev,

and
J. Baselmans, “Multiplexed Readout for 1000-Pixel Arrays of Microwave
Kinetic Inductance Detectors,” IEEE Transactions on Microwave Theory
Techniques 64, 1876–1883 (2016), arXiv:1507.04151 [astro-ph.IM].

30J. D. Gard, D. T. Becker, D. A. Bennett, J. W. Fowler, G. C. Hilton, J. A. B.
Mates, C. D. Reintsema, D. R. Schmidt, D. S. Swetz, and J. N. Ullom, “A
Scalable Readout for Microwave SQUID Multiplexing of Transition-Edge
Sensors,” Journal of Low Temperature Physics 193, 485–497 (2018).

31N. Fruitwala, P. Strader, G. Cancelo, T. Zmuda, K. Treptow, N. Wilcer,
C. Stoughton, A. B. Walter, N. Zobrist, G. Collura, I. Lipartito, J. I. Bai-
ley, and B. A. Mazin, “Second generation readout for large format photon
counting microwave kinetic inductance detectors,” Review of Scientiﬁc In-
struments 91, 124705 (2020), arXiv:2011.06685 [astro-ph.IM].

32J. P. Smith, J. I. Bailey, J. Tuthill, L. Stefanazzi, G. Cancelo, K. Treptow,
and B. A. Mazin, “A high-throughput oversampled polyphase ﬁlter bank
using vivado hls and pynq on a rfsoc,” IEEE Open Journal of Circuits and
Systems 2 (2021), 10.1109/OJCAS.2020.3041208.

33L. Stefanazzi, K. Treptow, N. Wilcer, C. Stoughton, C. Bradford, S. Ue-
mura, S. Zorzetti, S. Montella, G. Cancelo, S. Sussman, A. Houck, S. Sax-
ena, H. Arnaldi, A. Agrawal, H. Zhang, C. Ding,
and D. I. Schuster,
“The qick (quantum instrumentation control kit): Readout and control for
qubits and detectors,” Review of Scientiﬁc Instruments 93, 044709 (2022),
https://doi.org/10.1063/5.0076249.

34H. Wang, M. Hofheinz, J. Wenner, M. Ansmann, R. C. Bialczak, M. Lenan-
der, E. Lucero, M. Neeley, A. D. O’Connell, D. Sank, M. Weides, A. N.
Cleland, and J. M. Martinis, “Improving the coherence time of supercon-
ducting coplanar resonators,” Applied Physics Letters 95, 233508 (2009),
https://doi.org/10.1063/1.3273372.

35M. Hofheinz, H. Wang, R. C. Bialczak, E. Lucero, A. D. O’Connell,
D. Sank, J. M. Martinis, and A. N. Cleland, “Synthesizing arbitrary quan-
tum states in a superconducting resonator,” Nature 459, 546–549 (2009).
36H. Wang, S. Singh, C. R. H. McRae, J. C. Bardin, S.-X. Lin, N. Mes-
saoudi, A. R. Castelli, Y. J. Rosen, E. T. Holland, D. P. Pappas, and J. Y.
Mutus, “Cryogenic single-port calibration for superconducting microwave
resonator measurements,” Quantum Science and Technology 6, 035015
(2021).

37J. A. B. Mates, K. D. Irwin, L. R. Vale, G. C. Hilton, J. Gao, and K. W.
Lehnert, “Flux-Ramp Modulation for SQUID Multiplexing,” Journal of
Low Temperature Physics 167, 707–712 (2012).

38M. Wegner, C. Enss, and S. Kempf, “Analytical model of the readout power
and squid hysteresis parameter dependence of the resonator characteristics
of microwave squid multiplexers,” Superconductor Science and Technology
35, 075011 (2022).

39P. A. R. Ade, Z. Ahmed, M. Amiri, D. Barkats, R. B. Thakur, C. A.
Bischoff, D. Beck, J. J. Bock, H. Boenish, E. Bullock, V. Buza, I. Cheshire,
J. R., J. Connors, J. Cornelison, M. Crumrine, A. Cukierman, E. V. Denison,
M. Dierickx, L. Duband, M. Eiben, S. Fatigoni, J. P. Filippini, S. Fliescher,
N. Goeckner-Wald, D. C. Goldﬁnger, J. Grayson, P. Grimes, G. Hall,
G. Halal, M. Halpern, E. Hand, S. Harrison, S. Henderson, S. R. Hilde-
brandt, G. C. Hilton, J. Hubmayr, H. Hui, K. D. Irwin, J. Kang, K. S.
Karkare, E. Karpel, S. Kefeli, S. A. Kernasovskiy, J. M. Kovac, C. L.
Kuo, K. Lau, E. M. Leitch, A. Lennox, K. G. Megerian, L. Minutolo,
L. Moncelsi, Y. Nakato, T. Namikawa, H. T. Nguyen, R. O’Brient, I. Og-
burn, R. W., S. Palladino, T. Prouve, C. Pryke, B. Racine, C. D. Reintsema,
S. Richter, A. Schillaci, R. Schwarz, B. L. Schmitt, C. D. Sheehy, A. Soli-
man, T. S. Germaine, B. Steinbach, R. V. Sudiwala, G. P. Teply, K. L.
Thompson, J. E. Tolan, C. Tucker, A. D. Turner, C. Umiltà, C. Vergès, A. G.
Vieregg, A. Wandui, A. C. Weber, D. V. Wiebe, J. Willmert, C. L. Wong,
W. L. K. Wu, H. Yang, K. W. Yoon, E. Young, C. Yu, L. Zeng, C. Zhang,
and S. Zhang, “BICEP/Keck XV: The BICEP3 Cosmic Microwave Back-
ground Polarimeter and the First Three-year Data Set,” Astrophys. J. 927,
77 (2022), arXiv:2110.00482 [astro-ph.IM].

40BICEP2 Collaboration, Keck Array Collaboration, SPIDER Collaboration,
P. A. R. Ade, R. W. Aikin, M. Amiri, D. Barkats, S. J. Benton, C. A.
Bischoff, J. J. Bock, J. A. Bonetti, J. A. Brevik, I. Buder, E. Bullock,
G. Chattopadhyay, G. Davis, P. K. Day, C. D. Dowell, L. Duband, J. P. Fil-
ippini, S. Fliescher, S. R. Golwala, M. Halpern, M. Hasselﬁeld, S. R. Hilde-
brandt, G. C. Hilton, V. Hristov, H. Hui, K. D. Irwin, W. C. Jones, K. S.
Karkare, J. P. Kaufman, B. G. Keating, S. Kefeli, S. A. Kernasovskiy, J. M.
Kovac, C. L. Kuo, H. G. LeDuc, E. M. Leitch, N. Llombart, M. Lueker,
P. Mason, K. Megerian, L. Moncelsi, C. B. Netterﬁeld, H. T. Nguyen,
R. O’Brient, I. Ogburn, R. W., A. Orlando, C. Pryke, A. S. Rahlin, C. D.
Reintsema, S. Richter, M. C. Runyan, R. Schwarz, C. D. Sheehy, Z. K.
Staniszewski, R. V. Sudiwala, G. P. Teply, J. E. Tolan, A. Trangsrud, R. S.
Tucker, A. D. Turner, A. G. Vieregg, A. Weber, D. V. Wiebe, P. Wil-
son, C. L. Wong, K. W. Yoon, and J. Zmuidzinas, “Antenna-coupled TES
Bolometers Used in BICEP2, Keck Array, and Spider,” Astrophys. J. 812,
176 (2015), arXiv:1502.00619 [astro-ph.IM].

41J.

A.

B. Mates,
thesis,

The Microwave
of

SQUID Multiplexer,
Boulder,

at

Ph.D.
Colorado
University
https://www.proquest.com/docview/868186018 (2011).

42Bicep2 Collaboration, P. A. R. Ade, R. W. Aikin, D. Barkats, S. J. Benton,
C. A. Bischoff, J. J. Bock, J. A. Brevik, I. Buder, E. Bullock, C. D. Dowell,
L. Duband, J. P. Filippini, S. Fliescher, S. R. Golwala, M. Halpern, M. Has-
selﬁeld, S. R. Hildebrandt, G. C. Hilton, K. D. Irwin, K. S. Karkare, J. P.
Kaufman, B. G. Keating, S. A. Kernasovskiy, J. M. Kovac, C. L. Kuo, E. M.
Leitch, M. Lueker, C. B. Netterﬁeld, H. T. Nguyen, R. O’Brient, I. Ogburn,
R. W., A. Orlando, C. Pryke, S. Richter, R. Schwarz, C. D. Sheehy, Z. K.
Staniszewski, R. V. Sudiwala, G. P. Teply, J. E. Tolan, A. D. Turner, A. G.
Vieregg, C. L. Wong, and K. W. Yoon, “Bicep2 III: Instrumental Systemat-
ics,” The Astrophysical Journal 814, 110 (2015), arXiv:1502.00608 [astro-
ph.IM].

43J. A. B. Mates, D. T. Becker, D. A. Bennett, B. J. Dober, J. D. Gard,
G. C. Hilton, D. S. Swetz, L. R. Vale, and J. N. Ullom, “Crosstalk in mi-
crowave squid multiplexers,” Applied Physics Letters 115, 202601 (2019),
https://doi.org/10.1063/1.5116573.

44S. W. Henderson, J. R. Stevens, M. Amiri, J. Austermann, J. A. Beall,
S. Chaudhuri, H.-M. Cho, S. K. Choi, N. F. Cothard, K. T. Crowley,

SMuRF Tone-Tracking Electronics

31

S. M. Duff, C. P. Fitzgerald, P. A. Gallardo, M. Halpern, M. Hasselﬁeld,
G. Hilton, S.-P. P. Ho, J. Hubmayr, K. D. Irwin, B. J. Koopman, D. Li,
Y. Li, J. McMahon, F. Nati, M. Niemack, C. D. Reintsema, M. Salatino,
A. Schillaci, B. L. Schmitt, S. M. Simon, S. T. Staggs, E. M. Vavagiakis,
and J. T. Ward, “Readout of two-kilopixel transition-edge sensor arrays for
Advanced ACTPol,” in Millimeter, Submillimeter, and Far-Infrared Detec-
tors and Instrumentation for Astronomy VIII, Vol. 9914, edited by W. S.
Holland and J. Zmuidzinas, International Society for Optics and Photonics
(SPIE, 2016) pp. 346 – 362.

45J. W. Fowler, B. K. Alpert, W. B. Doriese, Y. I. Joe, G. C. O’Neil, J. N. Ul-
lom, and D. S. Swetz, “The Practice of Pulse Processing,” Journal of Low
Temperature Physics 184, 374–381 (2016), arXiv:1511.03950 [physics.ins-
det].

46C. Yu, Z. Ahmed, J. A. Connors, J. M. D’Ewart, B. Dober, J. C. Frisch,
S. W. Henderson, G. C. Hilton, J. Hubmayr, S. E. Kuenstner, J. A. B.
Mates, M. Silva-Feaver, J. N. Ullom, L. R. Vale, D. V. Winkle,
and
E. Young, “Bandwidth and Aliasing in the Microwave SQUID Multiplexer,”
(LTD2021, 2021).

47J. C. Frisch, R. Claus, J. M. D’Ewart, G. Haller, R. Herbst, B. Hong,
U. Legat, L. Ma, J. Olsen, B. Reese, L. Ruckman, L. Sapozhnikov, S. Smith,
T. Straumann, D. V. Winkle, J. Vasquez, M. Weaver, E. Williams, C. Xu,
and A. Young, “A FPGA based common platform for LCLS2 beam diag-
nostics and controls,” in BPMs and Beam Stability, Vol. 9914 (IBIC2016,
2016) pp. 650 – 653.

48https://www.picmg.org/openstandards/advancedtca/.
49Xilinx

“UG1260 KCU1500 Board User Guide,” https:

Inc.,

//docs.xilinx.com/v/u/en-US/ug1260-kcu1500-data-center
(2018), v1.4.

50L. Bottou and O. Bousquet, “The tradeoffs of large scale learning,” in Op-
timization for Machine Learning, edited by S. Sra, S. Nowozin, and S. J.
Wright (MIT Press, Cambridge, 2012) pp. 351–368.

51D. P. Mandic, S. Kanna, and A. G. Constantinides, “On the intrinsic rela-
tionship between the least mean square and kalman ﬁlters [lecture notes],”
IEEE Signal Processing Magazine 32, 117–122 (2015).

52https://github.com/slaclab/rogue.
53https://docs.epics-controls.org/en/latest/guides/EPICS\

protect_Intro.html.

54https://github.com/slaclab/pysmurf.
55https://git-scm.com/.
56https://www.docker.com/.
57https://epics-controls.org.
58K. Story, E. Leitch, P. Ade, K. A. Aird, J. E. Austermann, J. A. Beall,
D. Becker, A. N. Bender, B. A. Benson, L. E. Bleem, J. Britton, J. E.
Carlstrom, C. L. Chang, H. C. Chiang, H. M. Cho, T. M. Crawford, A. T.
Crites, A. Datesman, T. de Haan, M. A. Dobbs, W. Everett, A. Ewall-Wice,
E. M. George, N. W. Halverson, N. Harrington, J. W. Henning, G. C. Hilton,
W. L. Holzapfel, S. Hoover, N. Huang, J. Hubmayr, K. D. Irwin, M. Kar-
funkle, R. Keisler, J. Kennedy, A. T. Lee, D. Li, M. Lueker, D. P. Mar-
rone, J. J. McMahon, J. Mehl, S. S. Meyer, J. Montgomery, T. E. Montroy,
J. Nagy, T. Natoli, J. P. Nibarger, M. D. Niemack, V. Novosad, S. Padin,
C. Pryke, C. L. Reichardt, J. E. Ruhl, B. R. Saliwanchik, J. T. Sayre, K. K.
Schaffer, E. Shirokoff, G. Smecher, B. Stalder, C. Tucker, K. Vanderlinde,
J. D. Vieira, G. Wang, R. Williamson, V. Yefremenko, K. W. Yoon, and
E. Young, “South Pole Telescope software systems: control, monitoring,
and data acquisition,” in Software and Cyberinfrastructure for Astronomy
II, Society of Photo-Optical Instrumentation Engineers (SPIE) Conference
Series, Vol. 8451, edited by N. M. Radziwill and G. Chiozzi (2012) p.
84510T, arXiv:1210.4966 [astro-ph.IM].

59B. J. Koopman, J. Lashner, L. J. Saunders, M. Hasselﬁeld, T. Bhandarkar,
S. Bhimani, S. K. Choi, C. J. Duell, N. Galitzki, K. Harrington, A. D.
Hincks, S.-P. P. Ho, L. Newburgh, C. L. Reichardt, J. Seibert, J. Spisak,
B. Westbrook, Z. Xu, and N. Zhu, “The Simons Observatory: overview of
data acquisition, control, monitoring, and computer infrastructure,” in Soft-
ware and Cyberinfrastructure for Astronomy VI, Vol. 11452, edited by J. C.
Guzman and J. Ibsen, International Society for Optics and Photonics (SPIE,
2020) pp. 35 – 53.

60https://github.com/cyndiayu/babysmurf.
61C. Yu, Z. Ahmed, J. M. D’Ewart, J. C. Frisch, S. W. Henderson, and
M. Silva-Feaver, “A simulation suite for readout with smurf tone-tracking
electronics,” in Millimeter, Submillimeter, and Far-Infrared Detectors and
Instrumentation for Astronomy X, Vol. 12190, edited by J. Zmuidzinas and
J.-R. Gao, International Society for Optics and Photonics (SPIE, 2022).
62H. McCarrick, K. Arnold, Z. Atkins, J. Austermann, T. Bhandarkar, S. K.
Choi, C. J. Duell, S. M. Duff, D. Dutcher, N. Galitzk, E. Healy, Z. B.
Huber, J. Hubmayr, B. R. Johnson, M. D. Niemack, J. Seibert, M. Silva-
Feaver, R. F. Sonka, S. T. Staggs, E. M. Vavagiakis, Y. Wang, Z. Xu,
K. Zheng, and N. Zhu, “The 90 and 150 ghz universal focal-plane modules
for the simons observatory,” Journal of Low Temperature Physics (2021),
10.48550/ARXIV.2112.01458.

63M. Silva-Feaver, Z. Ahmed, K. Arnold, J. C. Frisch, J. Groh, S. W. Hen-
derson, J. Vasquez, and C. Yu, “Phase drift monitoring for tone tracking
readout of superconducting microwave resonators,” in Millimeter, Submil-
limeter, and Far-Infrared Detectors and Instrumentation for Astronomy X,
Vol. 12190, edited by J. Zmuidzinas and J.-R. Gao, International Society
for Optics and Photonics (SPIE, 2022).

64C. Yu, Z. Ahmed, A. J. Cukierman, S. W. Henderson, E. Y. Young, H.-
M. Cho, J. M. D’Ewart, D. Barkats, D. Brown, S. Chaudhuri, M. I. Di-
erickx, B. J. Dober, J. Dusatko, S. Fatigoni, J. P. Filippini, J. C. Frisch,
G. Haller, M. Halpern, G. C. Hilton, J. Hubmayr, K. D. Irwin, K. S.
Karkare, E. Karpel, S. A. S. Kernasovskiy, J. M. Kovac, S. E. Kuenstner,
C.-L. Kuo, D. Li, J. A. B. Mates, S. Smith, M. T. S. Germaine, J. N. Ullom,
L. Vale, D. D. V. Winkle, J. Vasquez, L. Zeng, and the BICEP/Keck Col-
laborations, “On-sky systematics of the microwave squid multiplexer,” in
Low Temperature Detectors Conference (Milan, Italy, 2019).

65https://www.xilinx.com/products/silicon-devices/fpga/

kintex-ultrascale-plus.html#documentation.

66Westpak, Inc. San Jose, CA, https://www.westpak.com/.
67Xilinx, private communication.
68J. M. D’Ewart, Z. Ahmed, D. Brown, S. Chaudhuri, H.-M. S. Cho,
B. Dober, J. E. Dusatko, S. Fatigoni, J. C. Frisch, M. Halpern, S. W. Hender-
son, G. C. Hilton, J. Hubmayr, K. D. Irwin, E. D. Karpel, S. E. Kuenstner,
C.-L. Kuo, D. Li, J. A. B. Mates, S. R. Smith, J. Ullom, L. R. Vale, D. D. V.
Winkle, C. Yu, G. Haller, J. Vasquez, E. Young, A. Cukierman, R. Herbst,
and L. Ruckman, “Smurf readout electronics for microwave squid multi-
plexing,” in Collaboration for Astronomy Signal Processing and Electron-
ics Research Community Workshop (Cambridge, MA, 2019).

69C. R. Harris, K. J. Millman, S. J. van der Walt, R. Gommers, P. Virtanen,
D. Cournapeau, E. Wieser, J. Taylor, S. Berg, N. J. Smith, R. Kern, M. Pi-
cus, S. Hoyer, M. H. van Kerkwijk, M. Brett, A. Haldane, J. Fernández del
Río, M. Wiebe, P. Peterson, P. Gérard-Marchant, K. Sheppard, T. Reddy,
W. Weckesser, H. Abbasi, C. Gohlke, and T. E. Oliphant, “Array program-
ming with NumPy,” Nature 585, 357–362 (2020).

70J. D. Hunter, “Matplotlib: A 2d graphics environment,” Computing in Sci-

ence & Engineering 9, 90–95 (2007).

