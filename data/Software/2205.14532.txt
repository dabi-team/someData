2
2
0
2

y
a
M
8
2

]

O
C

.
t
a
t
s
[

1
v
2
3
5
4
1
.
5
0
2
2
:
v
i
X
r
a

%CRTFASTGEEPWR: A SAS MACRO FOR POWER OF
GENERALIZED ESTIMATING EQUATIONS ANALYSIS OF
MULTI-PERIOD CLUSTER RANDOMIZED TRIALS WITH
APPLICATION TO STEPPED WEDGE DESIGNS

Ying Zhang
UNC-Chapel Hill

John S. Preisser
UNC-Chapel Hill

Fan Li
Yale School of Public Health

Elizabeth L. Turner
Duke University

Paul J. Rathouz
University of Texas at Austin

ABSTRACT

Multi-period cluster randomized trials (CRTs) are increasingly used for the evaluation of interventions
delivered at the group level. While generalized estimating equations (GEE) are commonly used to
provide population-averaged inference in CRTs, there is a gap of general methods and statistical
software tools for power calculation based on multi-parameter, within-cluster correlation structures
suitable for multi-period CRTs that can accommodate both complete and incomplete designs. A
computationally fast, non-simulation procedure for determining statistical power is described for the
GEE analysis of complete and incomplete multi-period cluster randomized trials. The procedure
is implemented via a SAS macro, %CRTFASTGEEPWR, which is applicable to binary, count and
continuous responses and several correlation structures in multi-period CRTs. The SAS macro is
illustrated in the power calculation of two complete and two incomplete stepped wedge cluster
randomized trial scenarios under different speciﬁcations of marginal mean model and within-cluster
correlation structure. The proposed GEE power method is quite general as demonstrated in the SAS
macro with numerous input options. The power procedure and macro can also be used in the planning
of parallel and crossover CRTs in addition to cross-sectional and closed cohort stepped wedge trials.

Keywords correlation decay, group randomized trial, intraclass correlation, marginal models, SAS macro

1

Introduction

Cluster randomized trials (CRTs) are studies designed to evaluate interventions that operate at a group level, manipulate
the physical or social environment, or cannot be delivered to individuals [Murray et al., 2004]. Regarding the different
schedules of recruiting participants, CRTs are classiﬁed with cross-sectional, closed-cohort and open-cohort designs
[Copas et al., 2015]. Cross-sectional designs recruit a unique set of individuals in each period, whereas closed-cohort
designs follow the same individuals in clusters with repeated observations across periods. The open-cohort design,
however, allows the attrition of members from and addition of new members to an existing cohort in each period. On
the other hand, there are different types of CRT designs, including parallel, crossover, and stepped-wedge designs.
Among CRTs with outcomes measured in multiple periods, a stepped-wedge cluster randomized trial (SW-CRT) is a
type of CRT such that clusters switch from control condition to treatment at randomly assigned time points [Hussey
and Hughes, 2007]. Logistical and ethical considerations such as the need to deliver the intervention in stages and the
desire to implement the intervention in all clusters are factors involved in the choice to use a SW-CRT [Turner et al.,
2017]. SW-CRTs may be preferred over other designs because they may facilitate cluster recruitment or offer increased
power over other cluster randomized designs even with a limited number of clusters [Hemming and Taljaard, 2020].
Most study planning methods are for complete SW-CRTs where all clusters have outcome data in all periods. However,
incomplete stepped wedge designs are increasingly being deployed, whereby some cluster-periods do not record data

 
 
 
 
 
 
A SAS macro %CRTFASTGEEPWR

due to logistical, resource, and patient-centered considerations [Kasza and Forbes, 2019]. Speciﬁcally, researchers
may choose not to collect data in a cohort design or enroll new participants in a cross-sectional design during some
cluster-periods. Hemming et al. [2015] described two types of incompleteness in stepped wedge designs, one involving
implementation periods and the other staggered study entry or termination of clusters.

Population-averaged models with GEE analysis have several advantages for the design and analysis of CRTs [Preisser
et al., 2003]. In contrast to generalized linear mixed models, the intervention effect from a population-averaged model
describes how the average response changes across the subsets of population deﬁned by the treated and control cluster-
periods. Additionally, because models for mean and correlation structures are separately speciﬁed, the interpretation
of the marginal mean regression parameters remains the same regardless of the speciﬁcation of working correlation
model [Preisser et al., 2008]. The link function is chosen to obtain inference on the target parameter of choice; for
binary responses, the target parameters could be the odds ratio via the logit link, the risk ratio via the log link, or
the risk difference via the identify link. Another advantage in using GEE for CRTs is that the estimation of mean
model parameters is robust to misspeciﬁcation of correlation structures in large samples. However, the speciﬁcation of
working independence correlation structure may result in efﬁciency loss that can be substantial when the cluster-period
sizes are not all equal [Tian et al., 2021]. Furthermore, an over-simpliﬁed exchangeable correlation structure may give
inaccurate power calculations when there is correlation decay in multi-period CRTs [Li, 2020, Kasza et al., 2019]. Thus,
correlation structures informed by the study design are recommended for both study design and data analysis of stepped
wedge and other multi-period CRTs.

Because CRTs are usually less powerful than individually randomized trials, determination of the proper number and
allocation of study participants is critically important. In the case of population-averaged models with GEE analysis,
simple-to-use sample size formulae for continuous responses and non-simulation procedures for binary responses
have recently been proposed for complete, cross-sectional and cohort SW-CRTs within the framework of GEE [Li
et al., 2018]. The methods extend earlier sample size formulae for GEE analysis of parallel-groups CRTs, including
cross-sectional and cohort CRTs [Preisser et al., 2003, 2007] and multi-level CRTs [Reboussin et al., 2012, Teerenstra
et al., 2010, Wang et al., 2021]. Prior work [Li et al., 2018, Li, 2020] has shown that the analytical power for marginal
mean (e.g, intervention) parameters in complete SW-CRTs agrees well with simulated power based on GEE with
ﬁnite-sample sandwich variance estimators for as few as eight clusters [Li et al., 2018]. Those studies focus on
the empirical performance of the analytical power rather than software tools to implement the method for different
multi-period CRT designs.

This article implements a comprehensive, analytical power method for both complete and incomplete SW-CRTs. The
proposed GEE power procedure is motivated by the Connect-Home trial, which uses an incomplete, cross-sectional
stepped wedge design to test an intervention to improve outcomes for rehabilitation patients transitioning from skilled
nursing facilities (SNFs) to home-based care [Toles et al., 2021]. The primary component of the intervention is
an individualized Transition Plan of Care that SNF staff create to support the patient and caregiver at home. The
incomplete design with six SNFs (clusters) and four patients per cluster-period (360 patients total), shown in Figure
1, was chosen based on considerations of internal validity and power under restrictions placed by available resources
and logistical considerations. The black and orange boxes represent cluster-periods where no patients are enrolled,
giving an incomplete design. Staggered enrollment of SNFs (clusters) is used to initiate data collection in stages with
limited research staff resulting in the black boxes. The orange boxes represent the implementation phase, where two
months are needed to activate the intensive intervention through training nursing home and home health care staff. The
Connect-Home study design is distinct in several aspects. First, the number of periods (J = 22) is much greater than
the number of sequences (S = 6), as compared to the standard SW-CRT in which J = S + 1 [Hussey and Hughes,
2007, Hemming et al., 2015, Li et al., 2018]. Next, the incompleteness of the design adds to the complexity of power
calculation.

Thus, the Connect-Home trial inspires an extension of the computationally fast, non-simulation procedures for deter-
mining sample size and statistical power for GEE analysis from complete SW-CRTs [Li et al., 2018] to incomplete
SW-CRTs. Speciﬁcally, we introduce a SAS[Inc., 2016] macro %CRTFASTGEEPWR as a computationally efﬁcient,
non-simulation based routine for determining the statistical power in multi-period CRTs by further accommodating
incompleteness at the design stage. For its implementation, the SAS macro %CRTFASTGEEPWR is developed to
accommodate binary, count and continuous responses in stepped wedge and other multi-period CRTs with a collection
of commonly-seen multilevel intra-cluster correlation structures and numerous options for planning complete and
incomplete cross-sectional and cohort designs. To the best of our knowledge, %CRTFASTGEEPWR is by far the
most comprehensive SAS macro for power calculation in multi-period CRTs based on marginal models, and is distinct
from existing computing software such as R package swdpwr [Chen et al., 2022], which currently does not allow for
decaying correlation structures, incomplete designs, count outcomes and alternative marginal mean models beyond the
average intervention effects model.

2

A SAS macro %CRTFASTGEEPWR

The remainder of this article is organized as follows. Section 2 describes the population-averaged models of interest
with special consideration of correlation structures suitable for cross-sectional and cohort multi-period CRTs. Section 3
summarizes the general power procedure for GEE analysis with the application to complete and incomplete stepped
wedge designs. Section 4 presents the SAS macro details and four examples for complete and incomplete SW-CRTs.

Figure 1: The trial diagram of the Connect Home trial: the blue, orange and green cells denote control, implementation
and intervention cluster-periods, respectively

2 GEE Analysis of multi-period CRTs

A unifying population-averaged model framework is described below for the design and statistical analysis of multi-
period CRTs. The following notations apply to both cross-sectional and cohort multi-period CRTs, where there are J
periods, S sequences, I clusters and Is clusters in sequence s, such that I = (cid:80)S
s=1 Is. Let yijk denote the response
of the kth individual from cluster i during period j for i = 1 . . . I, j = 1 . . . Ji, and k = 1 . . . Nij, noting that Ji ≤ J
is the number of observed periods (i.e., with data collection) for cluster i, and Nij is the cluster-period size. Let µijk
denote the marginal mean response of yijk, which is related to the intervention effect δ and jth categorical period effect
βj with link function g(.) via the marginal mean model

g(µijk) = βj + uijδ

(1)

For multi-period CRTs with fewer clusters than the number of periods (I < J), categorical period effects in the equation
(1) can be replaced with linear period effects:

g(µijk) = β0 + β1(tij − 1) + uijδ

(2)

where β0 is the intercept, and {tij : j = 1, . . . , Ji} are integer-valued calendar periods from the study design such that
β1 is the increment in the mean response on the scale of the link function for a unit increase in calendar period, and uij
is the treatment status in cluster i at period j.

Three types of intervention effect models are implemented in the SAS macro, the widely used average intervention
effects model [Hussey and Hughes, 2007, Hemming et al., 2015, Li et al., 2018], the incremental intervention effects
model [Hughes et al., 2015] and the extended incremental intervention effects model. In the average intervention effects
model, uij is the period-speciﬁc treatment indicator (1=intervention; 0=control) for cluster i and δ is the intervention
effect, irrespective of time on treatment, on the link function scale. With the speciﬁcation of uij, population-averaged
models could be used for different types of multi-period CRTs. In multi-period CRTs with parallel designs, uij = 0 for
all clusters under baseline period j, and uij = 0, 1 in subsequent post-baseline periods depending on the treatment status.
In the case of complete SW-CRTs, clusters switch from control condition to intervention at different periods. Thus,
uij = 0 in the control period, j = 1, ..., bi and bi is the total periods under the control condition in cluster i, whereas,
in intervention periods, uij = 1, j = bi + 1, ..., Ji. Conversely, the incremental intervention effects model assumes a
gradual uptake of the intervention such that its effect depends on time-on-treatment. Assuming a complete SW-CRT
is speciﬁed with the incremental intervention effects model, the treatment status is uij = 0 in the control period and
uij = (j − bi)/q, j = bi + 1, ..., Ji in the intervention period, where q > 0 is chosen to scale the intervention effect δ
according to user speciﬁcation. In the Connect-Home trial (Figure 1), q = 10 so that δ is deﬁned as the full intervention
effect on the link function scale after 10 periods, which corresponds to the number of intervention periods for the
ﬁrst SNF. Finally, an extended incremental intervention effects model is considered for designs additionally having
a maintenance phase after the active intervention phase with q periods. In SW-CRTs with a maintenance phase, one
research question relates to whether the patient beneﬁt from the intervention as captured by the outcome is maintained
after the active intervention period has ceased. The treatment status is uij = (j − bi)/q, j = bi + 1, ..., bi + q in the
active intervention periods and uij = 1 in the maintenance phase, for j > bi + q.

Speciﬁcation of the marginal model is completed with the covariance structure of all individual responses in each cluster.
Variance of the individual-level response is var(yijk) = vijkφ where vijk is the variance function and φ is the dispersion
parameter. For binary responses, vijk = µijk(1 − µijk) and φ = 1, while for continuous responses following typical

3

A SAS macro %CRTFASTGEEPWR

normal model assumptions, vijk = 1 and φ is the constant variance. For count outcomes with Poisson distribution,
vijk = φµijk and φ is the dispersion parameter. The macro assumes GEE is used to estimate the marginal mean
parameters θ = (β1, ..., βp, δ) as well as the working correlation matrix parameters; common multilevel correlation
structures for multi-period CRTs will be presented in section 4.1 during the SAS macro description.

3 Fast GEE power for multi-period CRTs

3.1 Overview of the fast GEE power method

I(ˆδ − δ) with mean zero and variance determined by the (p, p)-th element of cov(

The two-sided test of the intervention effect H0: δ = 0 vs H1: δ (cid:54)= 0 is based upon the asymptotic normal distribution of
√
I( ˆθ − θ)) , when I is sufﬁciently
large [Li et al., 2018]. In turn, the Wald-test statistic ˆδ/ var(ˆδ) has an asymptotically standard normal distribution under
the null hypothesis. Thus, power to detect an intervention effect of size δ (cid:54)= 0 with a nominal type I error rate α is

√

(cid:18)

(cid:113)

var(ˆδ)

(cid:19)

Φ

zα/2 + |δ|/

where Φ(·) is the standard normal cumulative distribution function and zα/2 is the normal

quantile such that Φ(zα/2) = α/2. However, for CRTs with a small number of clusters, the t-test is a good alternative
(cid:19)

(cid:18)

with power modiﬁed as Φt,I−p

tα/2,I−p + |δ|/

where tα/2,I−p is the α/2% quantile of the t-distribution

(cid:113)

var(ˆδ)

with I − p degrees of freedom. Typically, the degrees of freedom of the t-statistic in CRTs is set to I − p, where
p = dim(θ) is the number of estimated marginal mean model parameters in equation (1); some authors have used I − 2,
which is sometimes preferred for multi-period CRTs with fewer number of clusters than periods [Li, 2020, Ford and
Westgate, 2020]. The model-based variance of the intervention effect var(ˆδ) in the determination of power is deﬁned as
the (p, p)-th element in the model-based covariance matrix covMB(ˆθ). We refer to this general analytical power method
[Rochon, 1998] as “fast GEE power” because it is a computationally fast power calculation procedure for CRTs with
GEE analysis.

3.2 Adaption of the fast GEE power for incomplete SW-CRTs

The fast GEE power procedure has been previously investigated for complete SW-CRTs for the average intervention
effects marginal mean model with categorical period effects [Li et al., 2018]. Motivated by Connect-Home, we deﬁne
a class of incomplete designs for which Connect-Home is an archetype allowing for implementation periods and/or
staggered entry/termination. Let bi0 and bi1 denote the ﬁrst and last calendar periods of data collection for cluster
i in the control condition (b20 = 2 and b21 = 7 for the second sequence, s = 2, in Figure 1), such that there are
bi = bi1 − bi0 + 1 total periods in the control condition; qi0 and qi1 as the ﬁrst and last calendar periods of data collection
for cluster i in the intervention condition (e.g., q20 = 10 and q21 = 18, s = 2) such that there are qi = qi1 − qi0 + 1 total
periods in the intervention condition; and ci implementation periods occurring in calendar periods bi1 + 1, . . . bi1 + ci
where ci = qi0 − bi1 − 1.

A key step in applying the fast GEE power computation to incomplete SW-CRTs is the generation of cluster-level
design matrices, consisting of covariates in equation (1) or (2). For incomplete SW-CRTs, we specify a Design
Pattern (DP) matrix by the notation of {bi0, bi1, qi0, qi1, i = 1, . . . , I} to represent the experimental design analogous
to the power analysis of continuous responses in linear mixed models [Hemming et al., 2015]. Each element in
the DP matrix corresponds to a representative cluster-period in the SW-CRT design with entries of 0 for control
condition, 1 for intervention condition and 2 for cluster-periods in sequences without data collection. To illustrate
the speciﬁcation of DP matrix, an example of incomplete SW-CRT [Hemming et al., 2015] is used here with S = 2
treatment sequences, T = 4 periods, and an implementation period that occurs in period 2 for the ﬁrst sequence and in
period 3 for the second sequence. The incomplete design is speciﬁed by (b10, b11, q10, q11) = (1, 1, 3, 4) for s = 1 and
(b20, b21, q20, q21) = (1, 2, 4, 4) for s = 2. Then

DP =

(cid:18) 0
0

2
0

1
2

(cid:19)

.

1
1

The DP matrix serves to modify the design matrix obtained under the complete design to more accurately determine
covMB(ˆθ) and thus var(ˆδ) in the power calculation for CRTs with incomplete design.

4

A SAS macro %CRTFASTGEEPWR

4 The SAS macro details

4.1

Input arguments in the macro

A SAS macro %CRTFASTGEEPWR that implements the fast GEE power method is developed for multi-period CRTs
with complete and incomplete designs and available at
http://www.bios.unc.edu/∼preisser/ personal/software.html.

Macro Variable*
DESIGNPATTERN

CP_SIZE_MATRIX

M

DIST

LINK

PHI
INTERVENTION_EFFECT_TYPE

PERIOD_EFFECT_TYPE

DELTA
BETA_PERIOD_EFFECTS

CORR_TYPE

ALPHA0

R0

ALPHA1

ALPHA2

ALPHA3

MAX_INTERVENTION_PERIOD

ALPHA
DF_CHOICE

Input
Variable

Variable

Variable

=BINARY
=POISSON
=NORMAL
=LOGIT
=LOG
=IDENTITY
Variable
=AVE
=INC
=INC_EX
=CAT
=LIN
Variable
Variable

=NE/ED
/BE/PD
Variable

Variable

Variable

Variable

Variable

Variable

Variable
=1

=2

Description
A matrix with dimension S x T of 0, 1 and 2,
with 0 representing control periods,1 standing for interven-
tion periods, 2 presenting periods without data collection.
Number of cluster-period sizes, a matrix vector with di-
mension SxT
Number of clusters in each sequence, a vector with dimen-
sion Sx1
The distribution for the outcomes

Link function for the outcomes. For binary,
count, and continuous responses, the default
link is logit, log and identity, respectively
The dispersion parameter
Average intervention effects model
Incremental intervention effects model
Extended incremental intervention effects model
Categorical period effects model
Linear period effects model
The parameters of intervention
The parameters for period effects:
A Tx1 vector for categorical period effect
A 2x1 vector for continuous period effect
NE:Nested Exchangeable, ED:Exponential decay,
BE:Block exchangeable, PD:Proportional decay
The within-period correlation in exponential decay and
proportional decay correlation structure
Correlation decay rate over time in exponential decay and
proportional decay correlation structure
The within-period correlation in nested exchangeable and
block exchangeable correlation structure
The inter-period correlation in nested exchangeable and
block exchangeable correlation structure
The within-subject correlation in block exchangeable cor-
relation structure
The number of intervention periods to reach full interven-
tion effects in incremental intervention
effects model and extended incremental intervention ef-
fects model
Signiﬁcance level with two sided test, default at 0.05
Degree of freedom method (df), df = I-p, p is the number
of parameters in marginal mean model (at default)
df = I-2

Table 1: Arguments in the SAS macro CRTFASTGEEPWR. *All required arguments are in boldface

Table 1 provides required and optional arguments in the macro, which are classiﬁed into three aspects: describing the
characteristics of the multi-period CRT, parameterizing the marginal mean model and choosing the working correlation
structure.

5

A SAS macro %CRTFASTGEEPWR

First, users are required to describe the characteristics of the multi-period CRT through the design pattern matrix, speci-
ﬁed by DESIGNPATTERN, containing the number of sequences and periods, numerical indicators for treatment status,
and the incompleteness in the design. The SAS macro applies to cross-sectional and closed-cohort multi-period CRT
designs but not to closed cohort designs. Speciﬁcally, the SAS macro allows a varying number of participants across
cluster periods for cross-sectional designs through the speciﬁcation of CP_SIZE_MATRIX. For closed cohort designs,
each column of CP_SIZE_MATRIX should be the same such that cluster-period sizes may vary across sequences but
not within rows. The number of clusters in sequences are speciﬁed by a vector M to allow varying cluster numbers
across sequences.
Marginal mean model options include binary, count, and continuous responses with three link functions, speciﬁed
by DIST and LINK, respectively. Note that the default link function is the canonical link. Meanwhile, the categor-
ical period effects model or the linear period effects model is selected by specifying PERIOD_EFFECT_TYPE.
The user also needs to choose one of three intervention effects models introduced in Section 2, speciﬁed by
INTERVENTION_EFFECT_TYPE. For the incremental intervention effects model, MAX_INTERVENTION_PERIOD
should be ﬁlled with the number of periods at which the full treatment effect δ is reached. For the extended incremental
intervention effects model, the MAX_INTERVENTION_PERIOD is the number of periods under active intervention
phase and there should be at least one maintenance period in each sequence. The intervention effect size and period
effects at the scale of link function are all required with the choice of speciﬁc intervention and period effects model
through DELTA and BETA_PERIOD_EFFECTS .

Four within-cluster correlation structures commonly used for multi-period CRTs are considered in the SAS macro
(Table 2) through speciﬁcation of CORR_TYPE and corresponding intra-cluster correlations (ICCs). Speciﬁcally, there
are two distinct correlation structures for each of the cohort and cross-sectional design. Each structure incorporates
the usual ICC, which measures the correlation between responses from different individuals within the same cluster
during the same period: corr (yijk, yijk(cid:48)) = α0 or α1, k (cid:54)= k(cid:48). For cross-sectional designs, the nested exchangeable
correlation structure additionally speciﬁes a correlation parameter α2 for observation pairs collected from different
periods. Alternatively, exponential decay assumes the between-period correlation between responses from different
individuals within the same cluster in the jth and j(cid:48)
. For cohort designs, the
block exchangeable correlation structure distinguishes between-period correlations for pairs of individuals, α2, from a
constant intra-individual correlation for repeated observations, α3 [Li et al., 2018, Preisser et al., 2008]. On the other
hand, the proportional decay correlation structure [Li, 2020, Lefkopoulou et al., 1989] allows for correlation decay over
time, where the intra-individual correlation corr (yijk, yij(cid:48)k) = r|j−j(cid:48)|
, j (cid:54)= j(cid:48) has a ﬁrst-order auto-regressive structure
decay rate r0 and the between-period correlation among responses from different individuals within the same cluster is
α0r|j−j(cid:48)|
, j (cid:54)= j(cid:48), k (cid:54)= k(cid:48). Note that the nested exchangeable correlation for cross-sectional designs is a special case
of block exchangeable correlation when α2 = α3. Finally, the simple exchangeable correlation [Hussey and Hughes,
2007] additionally speciﬁes that within- and between-period correlations are equal α1 = α2.

th periods decays over time as α0r|j−j(cid:48)|

0

0

0

Design
Cross Sectional

Cohort

Label

Correlation Structure
Nested Exchangeable NE
ED
Exponential Decay
BE
Block Exchangeable
PD
Proportional Decay

j = j(cid:48)
α1
α0
α1
α0

j (cid:54)= j(cid:48),k (cid:54)= k(cid:48)
α2
α0r|j−j(cid:48)|
α2
α0r|j−j(cid:48)|

0

0

j (cid:54)= j(cid:48) ,k = k(cid:48)
-
-
α3
r|j−j(cid:48)|

0

Table 2: Intra-cluster correlation: corr (yijk, yij(cid:48)k(cid:48)) under different correlation structures for SW-CRTs (i=cluster,
j=period, k=individual)

The signiﬁcance level for two-sided tests, speciﬁed by ALPHA is optional with a default value of 0.05. In the degrees
of freedom determination, the number of clusters minus the number of marginal mean parameters, df = I − p, is the
default formula. Another degrees of freedom determination df = I − 2 in Li [2020] is also available, speciﬁed by
DF_CHOICE.

There are some consistency checks in SAS macro %CRTFASTGEEPWR to ensure parameters are reasonably spec-
iﬁed for the power calculation. First, if there are cluster periods in the design pattern matrix with no data collec-
tion (i.e. 2 in DESIGNPATTERN), the corresponding locations in the CP_SIZE_MATRIX need to be 0. Second,
BETA_PERIOD_EFFECTS should match the selected period effects model. For the linear period effects model,
there are two period effects parameters. While for the categorical period effects model, the number of period effects
parameters is equal to the column size of the Design pattern matrix DESIGNPATTERN. Finally, the marginal mean
outcome µijk needs to be within the rational range based on the speciﬁc outcome type, such as µijk within (0,1) for
binary outcomes and µijk are non-negative for count outcomes. Speciﬁcally, for binary outcomes, the Frèchet bounds

6

A SAS macro %CRTFASTGEEPWR

are also checked based on the speciﬁcation of working correlation structures and the marginal means to ensure their
compatibility [Qaqish, 2003].

4.2: Multi-period CRT examples of SAS macro %CRTFASTGEEPWR

In the section, we focus on illustrating the power calculation of two complete and two incomplete stepped wedge cluster
randomized trials using the SAS macro %CRTFASTGEEPWR, with different outcome types, speciﬁcation of marginal
mean models and correlation structures.

The ﬁrst example illustrates power calculation based on the Connect-Home trial design (Figure 1) with linear period
effects for a continuous outcome, patient preparedness for home care (a scale with range 0 to 100) assessed 7 days after
discharge from the SNF. There are 6 sequences with 22 periods in the study, having 7 periods without patient enrollment
and 15 periods with patient enrollment in each cluster. In the power calculation, there is 1 cluster in each sequence
and 360 subjects in the trial, in which 4 patients enrolled in each non-missing cluster period. In CP_SIZE_MATRIX, 0
means no patients enrolled in the speciﬁc sequence and period, which corresponds to locations with 2 in the design
pattern matrix. We assume the baseline patient preparedness score as β0 = 68 and a gently increasing linear period
effect such that β1 = 0.1 for J = 1, ..., 22 with common variance φ = 64 (standard deviation = 8). The full effect size
is reached at 10 months on intervention condition (q = 10) for the incremental intervention effects model with δ = 10.
ICCs are speciﬁed with (α1, α2) = (0.1, 0.05) under nested exchangeable correlation structure to indicate a moderate
within-cluster correlation for the cross-sectional design. The power is calculated using z-test with normal approximation
and t-test with df = 3. From the results, the power using the z-test is much greater than the t-test. Simulation studies
have shown that the z-test is too optimistic and tends to have an inﬂated test size in SW-CRTs with a small number of
clusters [Li et al., 2018]. Thus, we recommend calculating power with the t-test for the Connect Home study.

1 % CRTFASTGEEPWR ( alpha =0.05 , m =% str ( J (6 ,1 ,1) ) , corr_type = NE , alpha1 = 0.03 ,
2 alpha2 = 0.015 , i n t e rv e n ti o n _e f f ec t _ ty p e = INC , delta = 10 , period_effect_type = LIN ,
3 m ax _i nt e rv en t io n _ pe r i o d =10 , beta_period_effects =% str ({68 ,0.1}) , dist = normal ,
4 phi =64 ,
5 CP_size_matrix = % str ({4 4 4 4 4 0 0 4 4 4 4 4 4 4 4 4 4 0 0 0 0 0 ,
0 4 4 4 4 4 4 0 0 4 4 4 4 4 4 4 4 4 0 0 0 0 ,
6
0 0 4 4 4 4 4 4 4 0 0 4 4 4 4 4 4 4 4 0 0 0 ,
0 0 0 4 4 4 4 4 4 4 4 0 0 4 4 4 4 4 4 4 0 0 ,
0 0 0 0 4 4 4 4 4 4 4 4 4 0 0 4 4 4 4 4 4 0 ,
0 0 0 0 0 4 4 4 4 4 4 4 4 4 4 0 0 4 4 4 4 4}) ,

8

9

7

10

11
12 DesignPattern
13

14

15

16

17

= % str ({0 0 0 0 0 2 2 1 1 1 1 1 1 1 1 1 1 2 2 2 2 2 ,
2 0 0 0 0 0 0 2 2 1 1 1 1 1 1 1 1 1 2 2 2 2 ,
2 2 0 0 0 0 0 0 0 2 2 1 1 1 1 1 1 1 1 2 2 2 ,
2 2 2 0 0 0 0 0 0 0 0 2 2 1 1 1 1 1 1 1 2 2 ,
2 2 2 2 0 0 0 0 0 0 0 0 0 2 2 1 1 1 1 1 1 2 ,
2 2 2 2 2 0 0 0 0 0 0 0 0 0 0 2 2 1 1 1 1 1}) ) ;

1 Output of Example 1: The fast GEE power of normal outcomes with nested exchangeable
2 correlation structure and ( alpha1 , alpha2 ) :(0.03 , 0.015) under incremental
3 intervention effects model and delta = 10
4
5 T
6 22
7

Link
stddel
IDENTITY 3.9139

clusters
6

zpower
0.9746

Dist
NORMAL

totaln
360

tpower
0.7413

df
3

S
6

theta
68
0.1
10

8

The second example aims to calculate the power for a count outcome based on the Connect-Home trial design (Figure 1),
which is the number of days of acute care use for patients within 60 days after discharge from the SNF. In this example,
an average intervention effect model is speciﬁed with the same linear period effect model as in the ﬁrst example. The
design is identical to the ﬁrst example but the number of clusters increases from 6 to 12 clusters to achieve enough
power for the count outcome. For the parameters in the marginal mean model with log link, baseline number of acute
care use is assumed to be 1.24 days with an slightly decreasing period effect over time, giving β0 = log(1.24) = 0.215
and β1 = −0.01 with the dispersion parameter φ = 1.2. Assuming the intervention reduces the mean number of acute
care days by 40%, the intervention effect under the average intervention effects model is δ = log(0.6) = −0.511. ICCs
are speciﬁed with (α0, r0) = (0.03, 0.8) under exponential decay correlation structure to indicate a small within-cluster
correlation for the cross-sectional design. The power is calculated using the z-test with normal approximation and the
t-test with df = 9. Compared to the ﬁrst example that had only six clusters, power using the two tests are closer in
values and exceed 79%.

7

A SAS macro %CRTFASTGEEPWR

1 % CRTFASTGEEPWR ( alpha =0.05 , m =% str ( J (6 ,1 ,2) ) , corr_type = ED , alpha0 = 0.03 ,
2 R0 = 0.8 , i n t e r ve n t i o n _ ef f e ct _ t y pe = AVE , delta = -0.511 , period_effect_type = LIN ,
3 b eta _ per iod _e ff ect s =% str ({0.215 , -0.01}) , dist = poisson , phi =1.2 ,
4 CP_size_matrix = % str ({4 4 4 4 4 0 0 4 4 4 4 4 4 4 4 4 4 0 0 0 0 0 ,
0 4 4 4 4 4 4 0 0 4 4 4 4 4 4 4 4 4 0 0 0 0 ,
5
0 0 4 4 4 4 4 4 4 0 0 4 4 4 4 4 4 4 4 0 0 0 ,
0 0 0 4 4 4 4 4 4 4 4 0 0 4 4 4 4 4 4 4 0 0 ,
0 0 0 0 4 4 4 4 4 4 4 4 4 0 0 4 4 4 4 4 4 0 ,
0 0 0 0 0 4 4 4 4 4 4 4 4 4 4 0 0 4 4 4 4 4}) ,

8

6

9

7

10
11 DesignPattern =
12

13

14

15

16

% str ({0 0 0 0 0 2 2 1 1 1 1 1 1 1 1 1 1 2 2 2 2 2 ,
2 0 0 0 0 0 0 2 2 1 1 1 1 1 1 1 1 1 2 2 2 2 ,
2 2 0 0 0 0 0 0 0 2 2 1 1 1 1 1 1 1 1 2 2 2 ,
2 2 2 0 0 0 0 0 0 0 0 2 2 1 1 1 1 1 1 1 2 2 ,
2 2 2 2 0 0 0 0 0 0 0 0 0 2 2 1 1 1 1 1 1 2 ,
2 2 2 2 2 0 0 0 0 0 0 0 0 0 0 2 2 1 1 1 1 1}) ) ;

1 Output of Example 2: The fast GEE power of poisson outcomes with exponential decay
2 correlation structure and ( alpha0 , r0 ) :(0.03 , 0.8) under average intervention
3 effects model and delta = -0.511
4
5 T
6 22
7

Dist
POISSON

zpower
0.8749

stddel
3.1096

tpower
0.7906

totaln
720

Link
LOG

clusters

df
9

12

S
6

theta
0.215
-0.01
-0.511

8

The third example illustrates power calculation for a cross-sectional SW-CRT to improve pre-operative decision-making,
by the use of a patient-driven question prompt list intervention [Taylor et al., 2017, Schwarze et al., 2020]. In the third
example, 480 patients enrolled across six periods are clustered within 40 surgeons who are randomized to transition
from control (blue cells) to intervention condition (green cells) at one of ﬁve randomly assigned sequences (8 surgeons
per sequence; Figure 2). We calculate the power for a binary primary outcome regarding whether the patient has a
post-treatment regret. We assume a balanced and complete design for the study, 12 patients for each surgeon with
two patients in each cluster period. In the marginal mean model for the binary outcome with logit link and average
intervention effects model, the control is assumed to have 2.2 times the odds of reporting post treatment regret compared
to the intervention group, given by δ = log(1/2.2) = −0.789. The average probability of post treatment regret at
baseline is assumed to be 0.22, such that β0 = log(0.22/0.78) = −1.266 with an consistent increasing period effects
βi = 0.01, i = 1, . . . , 5. For the working correlation structure, we used the exponential decay correlation structure
with ICCs (α0, r0) = (0.03, 0.8). Power using the t-test and the z-test both reach 80% and are similar to one another
considering the moderately large number of clusters.

Figure 2: The trial diagram of the decision-making trial: the study includes 40 clusters and each treatment sequence
includes 8 clusters. The blue and green cells denote control and intervention cluster-periods, respectively

10 % CRTFASTGEEPWR ( alpha =0.05 , m =% str ( J (5 ,1 ,8) ) , corr_type = ED , alpha0 = 0.03 ,
11 R0 = 0.8 , i n t e r ve n t i o n _ ef f e ct _ t y pe = AVE , delta = -0.789 , period_effect_type = CAT ,
12 beta_period_e ff ec ts =% str ({ -1.266 ,0.01 ,0.01 ,0.01 ,0.01 ,0.01}) , dist = binary , phi =1 ,
13 CP_size_matrix =% str ( J (5 ,6 ,2) ) ,
14 DesignPattern =% str ({ 0 1 1 1 1 1 ,
0 0 1 1 1 1 ,
15
0 0 0 1 1 1 ,

16

8

A SAS macro %CRTFASTGEEPWR

17

18

0 0 0 0 1 1 ,
0 0 0 0 0 1}) ) ;

19 Output of Example 3: The fast GEE power of binary outcomes with exponential decay
20 correlation structure and ( alpha0 , r0 ) :(0.03 , 0.8) under average intervention
21 effects model and delta = -0.789
22
23 T
24 6
25

Dist
BINARY

tpower
0.8081

zpower
0.8307

stddel
2.9170

totaln
480

Link
LOGIT

clusters

df
33

40

S
5

26

27

28

29

30

theta
-1.266
0.01
0.01
0.01
0.01
0.01
-0.789

The fourth example is based on the Heart Health NOW study for which we assume a complete, stratiﬁed, SW-CRT
evaluating the effect of primary care practice support on evidence-based cardiovascular disease (CVD) prevention,
organizational change process measures, and patient outcomes, the latter captured by electronic health records (EHR)
[Weiner et al., 2015]. Medical practices are randomized to receive the intervention at one of three time points (steps)
within two strata deﬁned by high (the ﬁrst three treatment sequences, Figure 3) or low (last three rows) readiness for
change. After four quarters in the intervention phase (green boxes), each practice enters a maintenance phase (gray boxes)
for two to six quarters depending upon the allocated treatment sequence. HHN was a quality improvement research
project whereby the intervention of practice facilitation aimed to bring about enduring change in the patient-centered
and organizational outcomes. We consider a combined binary outcome regarding whether there is hospitalization
due to stroke, acute myocardial infarction, or angina for patients. We assume that there are 30 medical practices
(clusters) in each sequence (practice cohort) with 100 patients enrolled in each cluster period; thus 1100 patients will be
enrolled in each cluster. If the baseline probability of hospitalization is 0.05, making β0 = log(0.05/0.95) = −2.944
with an consistent decreasing period effects β1 = −0.01. Under the extended incremental intervention effects model,
the intervention effect is assumed to decrease the odds of hospitalization at the end of 4 quarters by 25% under the
active intervention condition, δ = log(0.75) = −0.288, maintaining the same effect size in the maintenance periods.
The working correlation structure for the binary outcome is a nested exchangeable correlation structure with ICCs
(α1, α2) = (0.03, 0.015). Considering the large cluster size and number of clusters, powers is very similar under the
z-test and t-test, reaching 78%.

Figure 3: The study design of the HHN study: the blue, green and grey cells denote control, active intervention and
maintenance cluster-periods, respectively

31 % CRTFASTGEEPWR ( alpha =0.05 , m =% str ( J (6 ,1 ,30) ) , corr_type = NE , alpha1 =0.03 ,
32 alpha2 =0.015 , i n t e r v en t i on _ e ff e c t_ t y pe = INC_EX , period_effect_type = LIN ,
33 delta = -0.288 , m a x _ in t e r ve nt io n _p er i od =4 , b eta _period_effects =% str ({ -2.944 , -0.01}) ,
34 dist = binary , phi =1 , CP_size_matrix =% str ( J (6 ,11 ,100) ) ,
35 DesignPattern =% str ({0 1 1 1 1 1 1 1 1 1 1 ,
0 0 1 1 1 1 1 1 1 1 1 ,
36
0 0 0 1 1 1 1 1 1 1 1 ,
0 0 0 1 1 1 1 1 1 1 1 ,
0 0 0 0 1 1 1 1 1 1 1 ,
0 0 0 0 0 1 1 1 1 1 1}) ) ;

38

39

37

40

9

A SAS macro %CRTFASTGEEPWR

41 Output of Example 4: GEE power of binary outcomes with nested exchangeable
42 correlation structure and ( alpha1 , alpha2 ) :(0.03 , 0.015) under extended incremental
43 intervention effects model and delta = -0.288
44
45 T
46 11
47

clusters
180

Dist
BINARY

zpower
0.7846

totaln
198000

stddel
2.7477

tpower
0.7801

Link
LOGIT

df
177

S
6

theta
-2.944
-0.01
-0.288

48

In the appendix, we also describe the power calculation of multi-period parallel cluster randomized trials, as well as
SAScodes to calculate powers under varying effect sizes using the SAS macro.

5 Discussion

This article proposes a fast GEE power method for binary, count, and continuous responses of complete and incomplete
multi-period CRTs, including parallel-arm longitudinal CRTs, cluster randomized crossover trials and SW-CRTs. The
fast GEE power approach was illustrated in the planning of four complete and incomplete cross-sectional stepped
wedge designs for binary, count and continuous outcomes, with different correlation structures. The SAS macro
%CRTFASTGEEPWR is novel in several aspects. Through speciﬁcation of the Design Pattern matrix in the spirit of
Hemming et al. [Hemming et al., 2015] and Rochon, [Rochon, 1998], the general GEE power method in the SAS macro
is implemented for complete and incomplete multi-period CRTs. We have also considered four multilevel correlation
structures proposed in the recent literature for multi-period CRTs. To our knowledge, there is no other single statistical
software that uniﬁes the four multilevel correlation structures in an approach for designing cross-sectional and cohort
CRTs. This proposed software for power of multi-period CRTs based on marginal models ﬁlls a gap by adding to the
literature of power calculators based on mixed models. [Hughes et al., 2015, Hemming et al., 2020]

The accuracy of the fast GEE power method based on the GEE model-based variance matrix has been validated in
simulation studies based on GEE with the bias-corrected variance estimator proposed by Kauerman and Carroll. [Li
et al., 2021, Kauermann and Carroll, 2001] For researchers interested in GEE analysis with bias-corrected variance
estimators for CRTs, the SAS macro GEECORR by Shing and Preisser [Shing et al., 2021] is available for binary
responses. A SAS macro GEEMAEE developed by the authors for binary, count, and continuous outcomes additionally
applies bias-corrections in the estimation of ICCs and their variance estimators, which is desired for reporting ICC
parameters as recommended by the CONSORT statement for stepped wedge trials [Hemming et al., 2018]. GEECORR
and GEEMAEE are all available at http://www.bios.unc.edu/∼preisser/ personal/software.html.

Acknowledgments

The Connect-Home trial was funded by the National Institute of Nursing Research of the National Institutes of Health
under award number 1R01NR017636-01. The content is solely the responsibility of the authors and does not necessarily
represent the ofﬁcial views of the National Institutes of Health.
Research in this article was funded through a Patient-Centered Outcomes Research Institute® (PCORI® Award ME-
2019C1-16196).The statements presented in this article are solely the responsibility of the authors and do not necessarily
represent the views of PCORI®, its Board of Governors or Methodology Committee.

References

Jiachen Chen, Xin Zhou, Fan Li, and Donna Spiegelman. swdpwr: A sas macro and an r package for power calculations
in stepped wedge cluster randomized trials. Computer methods and programs in biomedicine, 213:106522, Jan 2022.

Andrew J Copas, James J Lewis, Jennifer A Thompson, Calum Davey, Gianluca Baio, and James R Hargreaves.
Designing a stepped wedge trial: three main designs, carry-over effects and randomisation approaches. Trials, 16:352,
August 2015. ISSN 1745-6215. doi: 10.1186/s13063-015-0842-7. URL https://europepmc.org/articles/
PMC4538756.

Whitney P. Ford and Philip M. Westgate. Maintaining the validity of inference in small-sample stepped wedge cluster
randomized trials with binary outcomes when using generalized estimating equations. Statistics in Medicine, 39(21):
2779–2792, 2020. doi: https://doi.org/10.1002/sim.8575. URL https://onlinelibrary.wiley.com/doi/abs/
10.1002/sim.8575.

10

A SAS macro %CRTFASTGEEPWR

Karla Hemming and Monica Taljaard. Reﬂection on modern methods: when is a stepped-wedge cluster randomized trial
a good study design choice? International Journal of Epidemiology, 49(3):1043–1052, 05 2020. ISSN 0300-5771.
doi: 10.1093/ije/dyaa077. URL https://doi.org/10.1093/ije/dyaa077.

Karla Hemming, Richard Lilford, and Alan J. Girling. Stepped-wedge cluster randomised controlled trials: a generic

framework including parallel and multiple-level designs. Statistics in medicine, 34:181–96, 2015.

Karla Hemming, Monica Taljaard, Joanne E McKenzie, Richard Hooper, Andrew Copas, Jennifer A Thompson,
Mary Dixon-Woods, Adrian Aldcroft, Adelaide Doussau, Michael Grayling, Caroline Kristunas, Cory E Goldstein,
Marion K Campbell, Alan Girling, Sandra Eldridge, Mike J Campbell, Richard J Lilford, Charles Weijer, Andrew B
Forbes, and Jeremy M Grimshaw. Reporting of stepped wedge cluster randomised trials: extension of the consort
2010 statement with explanation and elaboration. BMJ, 363, 2018. ISSN 0959-8138. doi: 10.1136/bmj.k1614. URL
https://www.bmj.com/content/363/bmj.k1614.

Karla Hemming, Jessica Kasza, Richard Hooper, Andrew Forbes, and Monica Taljaard. A tutorial on sample size
calculation for multiple-period cluster randomized parallel, cross-over and stepped-wedge trials using the shiny crt
calculator. International journal of epidemiology, 49:979–995, Jun 2020.

James P. Hughes, Tanya S. Granston, and Patrick J. Heagerty. Current issues in the design and analysis of stepped

wedge trials. Contemporary clinical trials, 45:55–60, Nov 2015.

Michael A. Hussey and James P. Hughes. Design and analysis of stepped wedge cluster randomized trials. Contemp

Clin Trials., 28(2):182–191, 2007.

SAS Institute Inc. SAS Software, Version 9.4. Cary, NC, 2016. URL http://www.sas.com/.

J. Kasza, K. Hemming, R. Hooper, Jns Matthews, and A. B. Forbes. Impact of non-uniform correlation structure on
sample size and power in multiple-period cluster randomised trials. Statistical methods in medical research, 28:
703–716, Mar 2019.

Jessica Kasza and Andrew B. Forbes. Information content of cluster–period cells in stepped wedge trials. Biometrics, 75
(1):144–152, 2019. doi: https://doi.org/10.1111/biom.12959. URL https://onlinelibrary.wiley.com/doi/
abs/10.1111/biom.12959.

Göran Kauermann and Raymond J Carroll. A note on the efﬁciency of sandwich covariance matrix estimation. Journal
of the American Statistical Association, 96(456):1387–1396, 2001. doi: 10.1198/016214501753382309. URL
https://doi.org/10.1198/016214501753382309.

Myrto Lefkopoulou, Dirk Moore, and Louise Ryan. The analysis of multiple correlated binary outcomes: Application
to rodent teratology experiments. Journal of the American Statistical Association, 84(407):810–815, 1989. ISSN
01621459.

Fan Li. Design and analysis considerations for cohort stepped wedge cluster randomized trials with a decay correlation

structure. Statistics in medicine, 39(4):438–455, 2020.

Fan Li, Elizabeth L. Turner, and John S. Preisser. Sample size determination for gee analyses of stepped wedge cluster

randomized trials. Biometrics, 74(4):1450–1458, 2018.

Fan Li, Hengshi Yu, Paul J. Rathouz, Elizabeth L. Turner, and John S. Preisser. Marginal modeling of cluster-period
means and intraclass correlations in stepped wedge designs with binary outcomes. Biostatistics (Oxford, England),
Feb 2021.

David M. Murray, Sherri P. Varnell, and Jonathan L. Blitstein. Design and analysis of group-randomized trials: a review

of recent methodological developments. American journal of public health, 94:423–32, Mar 2004.

John S. Preisser, Mary L. Young, Daniel J. Zaccaro, and Mark Wolfson. An integrated population-averaged approach to
the design, analysis and sample size determination of cluster-unit trials. Statistics in medicine, 22:1235–54, Apr
2003.

John S. Preisser, Beth A. Reboussin, Eun-Young Song, and Mark Wolfson. The importance and role of intracluster

correlations in planning cluster trials. Epidemiology (Cambridge, Mass.), 18:552–60, Sep 2007.

John S. Preisser, Bing Lu, and Bahjat F. Qaqish. Finite sample adjustments in estimating equations and covariance

estimators for intracluster correlations. Statistics in Medicine, 27(27):5764–5785, 2008.

Bahjat F. Qaqish. A family of multivariate binary distributions for simulating correlated binary variables with speciﬁed

marginal means and correlations. Biometrika, 90(2):455–463, 2003. ISSN 00063444.

BA Reboussin, JS Preisser, E-Y Song, and M Wolfson. Sample size estimation for alternating logistic regression
analysis of multilevel randomized community trials of underage drinking. Journal of the Royal Statistical Society,
Series A, 175:691–712, 2012.

11

A SAS macro %CRTFASTGEEPWR

James Rochon. Application of gee procedures for sample size calculations in repeated measures experiments. Statistics

in Medicine, 17(14):1643–1658, 1998.

Margaret L. Schwarze, Anne Bufﬁngton, Jennifer L. Tucholka, Bret Hanlon, Paul J. Rathouz, Nicholas Marka, Lauren J.
Taylor, Christopher J. Zimmermann, Anna Kata, Nathan D. Baggett, Daniel A. Fox, Andrea E. Schmick, Ana Berlin,
Nina E. Glass, Anne C. Mosenthal, Emily Finlayson, Zara Cooper, and Karen J. Brasel. Effectiveness of a question
prompt list intervention for older patients considering major surgery: A multisite randomized clinical trial. JAMA
surgery, 155:6–13, Jan 2020.

Tracie L. Shing, John S. Preisser, and Richard C. Zink. Geecorr: A sas macro for regression models of correlated
binary responses and within-cluster correlation using generalized estimating equations. Computer Methods and
Programs in Biomedicine, 208:106276, 2021. ISSN 0169-2607. doi: https://doi.org/10.1016/j.cmpb.2021.106276.
URL https://www.sciencedirect.com/science/article/pii/S0169260721003503.

Lauren J. Taylor, Paul J. Rathouz, Ana Berlin, Karen J. Brasel, Anne C. Mosenthal, Emily Finlayson, Zara Cooper,
Nicole M. Steffens, Nora Jacobson, Anne Bufﬁngton, Jennifer L. Tucholka, Qianqian Zhao, and Margaret L.
Schwarze. Navigating high-risk surgery: protocol for a multisite, stepped wedge, cluster-randomised trial of a
question prompt list intervention to empower older adults to ask questions that inform treatment decisions. BMJ
open, 7:e014002, May 2017.

Steven Teerenstra, Bing Lu, John S. Preisser, Theo van Achterberg, and George F. Borm. Sample size considerations

for gee analyses of three-level cluster randomized trials. Biometrics, 66:1230–7, Dec 2010.

Zibo Tian, John S. Preisser, Denise Esserman, Elizabeth L. Turner, Paul J. Rathouz, and Fan Li. Impact of unequal
cluster sizes for gee analyses of stepped wedge cluster randomized trials with binary outcomes. Biometrical journal.
Biometrische Zeitschrift, Oct 2021.

M. Toles, C. Colón-Emeric, LC. Hanson, M. Naylor, M. Weinberger, J. Covington, and JS. Preisser. Transitional care
from skilled nursing facilities to home: study protocol for a stepped wedge cluster randomized trial Trials. pages
22–120, 2021.

Elizabeth L. Turner, Fan Li, John A. Gallis, Melanie Prague, and David M. Murray. Review of recent methodological
developments in group-randomized trials: Part 1-design. American journal of public health, 107:907–915, Jun 2017.
Xueqi Wang, Elizabeth L. Turner, John S. Preisser, and Fan Li. Power considerations for generalized estimating
equations analyses of four-level cluster randomized trials. Biometrical journal. Biometrische Zeitschrift, Dec 2021.
Bryan J. Weiner, Michael P. Pignone, C. Annette DuBard, Ann Lefebvre, Janet L. Suttie, Janet K. Freburger, and
the heart health now study protocol.
Samuel Cykert. Advancing heart health in north carolina primary care:
Implementation Science, 10(1):160, 2015. ISSN 1748-5908. doi: 10.1186/s13012-015-0348-4. URL https:
//doi.org/10.1186/s13012-015-0348-4.

12

A SAS macro %CRTFASTGEEPWR

Appendix

In the appendix, we will illustrate the use of SAS macro %CRTFASTGEEPWR for a parallel cluster trial, based on the
Enforcing Underage Drinking Laws (EUDL) Program [Preisser et al., 2003]. The EDUL program funded interventions
at the community level to enforce laws related to alcohol use by underage person to reduce the underage drinking.
Moreover, the study used a non-randomized trial design because the intervention communities were selected by the
administrative units in states. The control communities were selected by the propensity score method to match the
intervention communities based on US census data. There are three periods: one baseline assessment and two follow-up
assessments for participants in the communities participating in the EUDL program. We will use the design of the
EUDL study to calculate the power under the assumption that all confounded covariates were balanced in control and
intervention groups. The main outcome is the binary outcome of self-reported last 30-day alcohol use for an underage
person. We assume there are 40 clusters in total with 20 clusters per intervention group and 30 participants enrolled
in each cluster-period. Assuming the baseline probability of self-reported last 30-day alcohol use for an underage
person is 0.6, we set β0 = log(0.6/0.4) = 0.405 with an consistent decreasing period effects β1 = −0.01. Under the
average intervention effects model, the intervention effect is assumed to decrease the odds of underage drinking by
30% on average, δ = log(0.7) = −0.357. Moreover, a nested exchangeable correlation structure is used with ICCs
(α1, α2) = (0.02, 0.01). From the power calculation results, power is close to 90% given the parameters. Thus, this
example further illustrates the ﬂexibility of the SAS macro in calculating power for multi-period cluster randomized
trials with different designs.

50
51 % CRTFASTGEEPWR ( alpha =0.05 , m =% str ( J (2 ,1 ,20) ) ,
52 alpha2 = 0.01 , i n t e r ve n t io n _ ef f e ct _ t yp e = AVE , delta = -0.357 , period_effect_type = CAT ,
53 beta_period_e ff ec ts =% str ({0.405 , -0.01 , -0.01}) , dist = binary , phi =1 ,
54 CP_size_matrix =
55

% str ( J (2 ,3 ,30) ) , DesignPattern =% str ({0 1 1 ,

corr_type = NE , alpha1 = 0.02 ,

0 0 0}) ) ;

56 Output of EUDL design : The fast GEE power of binary outcomes with nested
57 exchangeable correlation structure and ( alpha1 , alpha2 ) :(0.02 , 0.01)
58 under average intervention effects model and delta = -0.357
59
60 T
61 3
62

totaln
3600

zpower
0.9036

Dist
BINARY

Link
LOGIT

clusters

3.2624

stddel

df
36

40

S
2

tpower
0.8875

theta
0.405
-0.01
-0.01
-0.357

We provide SAScodes to calculate and compare powers using GEE analysis bases on different effect sizes. In the example
codes, %CRTFASTGEEPWR is used to calculate powers under varying effect sizes, reducing the odds of underage drink-
ing in the EDUL study by (20%, 25%, 30%, 35%, 40%) on average, leading to δ = log(20%, 25%, 30%, 35%, 40%) =
(−0.223, −0.288, −0.357, −0.431, −0.511). Outputs of the SAScodes are attached below the codes.

65 % macro
66

mult i_effectsizes ( effectsizes ) ;

% local index value ;
% do index = 1 % to % sysfunc ( countw (& effectsizes ,% str ( ) ) ) ;
% let value =% scan (& effectsizes ,& index ,% str ( ) ) ;
% CRTFASTGEEPWR ( alpha =0.05 , m =% str ( J (2 ,1 ,20) ) , corr_type = NE , alpha1 = 0.02 ,
alpha2 = 0.01 , i n t e r ve n t io n _ ef f e ct _ t yp e = AVE ,
period_ef fe ct _ty pe = CAT , beta_pe rio d_e ffec ts =% str ({0.405 , -0.01 , -0.01}) ,
dist = binary , phi =1 , CP_size_matrix =
DesignPattern =

% str ( J (2 ,3 ,30) ) ,

delta = & value ,

% str ({0 1 1 ,

63

64

67

68

69

70

71

72

73

74

0 0 0}) ) ;

% end ;

75
76 % mend ;
77 % multi_effectsizes ( -0.223

-0.288 -0.357

-0.431

-0.511) ;

13

A SAS macro %CRTFASTGEEPWR

78 Outputs : The fast GEE power of binary outcomes with nested exchangeable
79 correlation structure and ( alpha1 , alpha2 ) :(0.02 , 0.01) under average
80 intervention effects model and delta = -0.223
81
82 T
83 3
84

totaln
3600

stddel
2.0482

Dist
BINARY

zpower
0.5352

Link
LOGIT

clusters

df
36

40

S
2

87
88 The fast GEE power of binary outcomes with nested exchangeable
89 correlation structure and ( alpha1 , alpha2 ) :(0.02 , 0.01) under average
90 intervention effects model and delta = -0.288
91
92 T
93 3
94

totaln
3600

stddel
2.6395

Dist
BINARY

Link
LOGIT

clusters

df
36

40

S
2

zpower
0.7516

97
98 The fast GEE power of binary outcomes with nested exchangeable
99 correlation structure and ( alpha1 , alpha2 ) :(0.02 , 0.01) under average
100 intervention effects model and delta = -0.357
101
102 T
103 3
104

totaln
3600

stddel
3.2624

Dist
BINARY

Link
LOGIT

clusters

df
36

40

S
2

zpower
0.9036

tpower
0.5080

tpower
0.7276

tpower
0.8875

107
108 The fast GEE power of binary outcomes with nested exchangeable
109 correlation structure and ( alpha1 , alpha2 ) :(0.02 , 0.01) under average
110 intervention effects model and delta = -0.431
111

112
113 T
114 3
115

116

117

S
2

clusters

40

df
36

theta
0.405
-0.01
-0.01
-0.431

totaln
3600

Dist
BINARY

Link
LOGIT

stddel
3.9239

zpower
0.9752

tpower
0.9670

118
119 The fast GEE power of binary outcomes with nested exchangeable
120 correlation structure and ( alpha1 , alpha2 ) :(0.02 , 0.01) under average
121 intervention effects model and delta = -0.511
122
123 T
124 3
125

totaln
3600

stddel
4.6296

Dist
BINARY

Link
LOGIT

clusters

df
36

40

S
2

zpower
0.9962

tpower
0.9933

theta
0.405
-0.01
-0.01
-0.223

theta
0.405
-0.01
-0.01
-0.288

theta
0.405
-0.01
-0.01
-0.357

theta
0.405
-0.01
-0.01
-0.511

85

86

95

96

105

106

126

127

14

