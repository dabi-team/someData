2
2
0
2

g
u
A
9
1

]
h
p
-
p
m
o
c
.
s
c
i
s
y
h
p
[

1
v
1
3
5
9
0
.
8
0
2
2
:
v
i
X
r
a

MODELLING FINE-SLICED THREE DIMENSIONAL ELECTRON
DIFFRACTION DATA WITH DYNAMICAL BLOCH-WAVE
SIMULATIONS

A PREPRINT

Anton Cleverley
Department of Chemistry
University of Warwick
Coventry, CV4 7AL

Prof. Richard Beanland
Department of Physics
University of Warwick
Coventry, CV4 7AL
r.beanland@warwick.ac.uk

ABSTRACT

Recent interest in structure solution and reﬁnement using electron diffraction (ED) has been fuelled
by its inherent advantages when applied to crystals of sub-micron size, as well as a better sensitivity
to light elements. Currently, data is often processed using software written for X-ray diffraction, using
the kinematic theory of diffraction to generate model intensities – despite the inherent differences in
diffraction processes in ED. Here, we use dynamical Bloch-wave simulations to model continuous
rotation electron diffraction data, collected with a ﬁne angular resolution (crystal orientations of
∼ 0.1◦). This ﬁne-sliced data allows us to reexamine the corrections applied to ED data. We propose
a new method for optimising crystal orientation, and take into account the angular range of the
incident beam and varying slew rate. We extract observed integrated intensities and perform accurate
comparisons with simulations using rocking curves for a (110) lamella of silicon 185 nm in thickness.
R1 is reduced from 26% with the kinematic model to 6.8% using dynamical simulations.

Keywords Electron Diffraction · Structure Solution · Bloch-Waves

1

Introduction

Electron diffraction (ED) is currently enjoying increased attention and activity due to its ability to work with crystallites
that are far smaller than can be tackled by X-ray diffraction (XRD) Xu and Zou [2019]. Structural solution utilising ED
has dramatically increased since the turn of the century due to advances in computer control and detector development
Gemmi and Lanza [2019a] and the new methodologies that have been developed for structure solution are generally
known by the term three-dimensional electron diffraction (3D-ED) Gemmi et al. [2019]. Just as in XRD, these
techniques measure the direction and intensity of many Bragg-diffracted beams from a crystal, which are then processed
to deduce a unit cell, given Miller indices hkl and observed intensities I (obs)
. These data can then be used to produce
a crystal model using structure solution methods. Currently, many analyses of ED data for structural solution and
reﬁnement use well-established and relatively sophisticated XRD software, despite the vastly different scattering
processes involved. As a result, the quality of structural solutions from 3D-ED appears much worse than that of XRD,
even though the structures obtained seem reliable Palatinus et al. [2015a]. To develop the ﬁeld of ED further, it is
necessary to improve quality of ﬁt.

hkl

Electron detector technology has seen a signiﬁcant improvement in both quantum efﬁciency and speed in recent years
Faruqi and McMullan [2018] Paterson et al. [2020], allowing ever greater amounts of data to be obtained. The arrival of
fast pixelated detectors is fuelling a trend away from integrated intensities and it is now possible to collect data that has
quite ﬁne resolution both temporally and in scattering angle. The many differences between electrons and X-rays when
used for structure solution are well documented Gemmi and Lanza [2019b], but can seem relatively subtle in integrated
data. Conversely, in ﬁne-sliced data these differences can be observed more clearly and there is sufﬁcient information to
allow them to be modelled more comprehensively. In this work, we explore continuous-rotation electron diffraction

 
 
 
 
 
 
Modelling ﬁne-sliced three dimensional electron diffraction data with dynamical Bloch-wave simulations

(cRED) data taken with a crystal orientation resolution of ∼ 0.1◦, in combination with Bloch-wave electron diffraction
simulations. Our aim is to elucidate the most important experimental and modelling parameters that will be necessary
in future dynamical reﬁnement methodologies.

To a great extent ED and XRD are complementary, with strengths in different areas that can be very powerful when
used in combination Yun et al. [2015]. There are many differences between ED and XRD, including very different
wavelengths and damage mechanisms, but the principal one which affects diffracted intensities is the strength of
interaction, with electrons roughly 10,000 times more likely to be scattered than X-rays Xu and Zou [2019]. Thus,
multiple scattering is usual for electrons – and is essential to capture the interaction of a fast electron with even a single
gold atom Howie [2014] – whereas single scattering usually dominates for XRD. Since structural reﬁnement relies on
and model calculated values I (calc)
minimising the difference between I (obs)
, it is therefore unsurprising that a ﬁt to a
single (kinematic) scattering model is poor for a method where multiple (dynamical) scattering dominates.

hkl

hkl

Apart from the real difference in the current state of development of dedicated software for ED and XRD data analysis,
the main reason for the continued adherence to a scattering model that is known to be inadequate for ED is the relative
difﬁculty of calculation for dynamical scattering in comparison with the kinematic model. In both models, the starting
point for calculation of the diffracted intensity for reﬂection g = hkl is the structure factor Fhkl

Fhkl =

N
(cid:88)

j=1

fj(θB)Tj exp (2πig · rj) ,

(1)

hkl = |Fhkl|2 = FhklF ∗

where fj(θB) is the atomic scattering factor evaluated at the Bragg angle θB, Tj the thermal factor and rj fractional
atomic coordinates of the jth atom, the sum taken over all N atoms in the unit cell. In the kinematic model, it is
commonly stated that the structure factor Fhkl gives the complex amplitude of the diffracted beam, whose intensity
is proportional to I (kin)
hkl, where * indicates complex conjugate. With tabulated scattering
factors Eq. (1) can be evaluated almost instantaneously on even the most basic computer. In comparison, modelling
dynamical scattering for ED to obtain I (dyn)
requires solving Schrodinger’s wave equation for an electron travelling
through the crystal, usually done using either the Bloch-wave method or a multislice wave scattering/propagation
calculation. The structure factor enters the Bloch wave calculation as elements in the scattering matrix, which contains
all excitetd g-vectors and their differences, but is present only indirectly in a multislice calculation. These models,
which require signiﬁcant computing resources and may be cluster or GPU-based, are widely used in more traditional
electron diffraction work such as convergent beam electron diffraction (CBED) and in the simulation of transmission
electron microscopy (TEM) and scanning TEM (STEM) images. Dynamical modelling has been applied to ED Dudka
et al. [2007] Sinkler and Marks [2010] Palatinus et al. [2015b], but to date has only been incorporated into dedicated
3D-ED analysis in the software PETS Palatinus [2011].

hkl

In any quantitative experiment, measurements and calculations must meet at some point and in XRD it is most
convenient for that point to be the structure factor. The correspondence between model and experiment is usually
captured using an R-factor (see S1.3). Although it is often said that diffracted X-ray intensities from a crystal are given
by |Fhkl|2 (Eq.1), in reality things are not so simple and many other factors need to be accounted for, which depend on
both the experiment being performed and the material. These factors are usually considered to be experimental, and are
dealt with and reﬁned separately from the crystal structure itself. In Eq. 2 we include these other factors explicitly and
make a distinction between experimental measurements of diffracted intensity I (expt)
and the ‘observed’ intensities
I (obs)
hkl

that are suitable for comparison with calculations |F (calc)

|2:

hkl

hkl

|F (obs)
hkl

|2 = I (obs)

hkl = L−1G−1B−1A−1E−1S−1C −1M −1p−1I (expt)

hkl

,

(2)

with corrections for Lorentz factors L, geometry G, background B, absorption A, extinction E, scaling S, ﬂuctuations
in the incident X-ray beam intensity C, mosaicity M and polarisation p. It is usually assumed that these corrections
are independent and commutative, i.e. can be applied in any order, although they can be reﬁned iteratively Ladd and
Palmer [1994]. In XRD each reﬂection hkl has a single well-deﬁned I (obs)
, so that if it is sampled multiple times, or
there are symmetrically equivalent reﬂections, they can all be merged into a single measurement with improved ﬁdelity.
Comparison with theory is then made using a metric Rmerge. However, in dynamical diffraction a reﬂection no longer
has a single well-deﬁned intensity Clabbers et al. [2019], as illustrated by Fig. 1. This shows a Bloch-wave simulation
of a ¯14 ¯2 ¯2 reﬂection from the silicon cRED data set (section 3) which, although kinematically forbidden, has intensities
up to 10% of the incident beam intensity where pathways for multiple allowed reﬂections exist. Although this is an
extreme example, it is not uncommon for weak reﬂections to be affected in this way in ED. Thus an average intensity,
taken either by merging multiple measurements, symmetrically equivalent reﬂections, or through the use of a precessed
incident beam Oleynikov et al. [2007], will in general converge to some ill-deﬁned value. Conversely, comparison of

hkl

2

Modelling ﬁne-sliced three dimensional electron diffraction data with dynamical Bloch-wave simulations

Figure 1: An illustration of the range of intensities that are obtained for the kinematically-forbidden ¯14 ¯2 ¯2 reﬂection in
silicon with a thickness of 180nm in a dynamical simulation. The image below shows the corresponding LACBED
pattern (see section 3)

experimental data with a dynamical model in which each measurement is simulated individually should give a better R1
without any data merging Palatinus et al. [2015a].

Before embarking on a structural reﬁnement in which rj and Tj in Eq. 1 are determined for each atom in the unit cell by
minimising R1, the many corrections in Eq. 2 must be applied to optimise the experimental input |F (obs)
|. At ﬁrst sight,
it might therefore appear that Eq. 1 deals with scattering theory while Eq. 2 deals only with experimental parameters,
but this is not strictly correct – absorption and extinction, for example, are scattering effects that depend upon the
sample. For dynamical electron diffraction, we must reconsider the validity of Eq. 2 to account for the differences in ED
vs XRD experiments. For electrons, we can discard the polarisation correction p since electron beams are unpolarised,
but each of the other terms has an equivalent in ED. Thus, before presenting our results from a continuous rotation
electron diffraction (cRED) measurement, we brieﬂy discuss each in turn.

hkl

i) Lorentz corrections L. Lorentz corrections ensure that a given reﬂection has the same integrated intensity in XRD
irrespective of the way the crystal is rotated, i.e. they account for the different time spent in the vicinity of each Bragg
condition during data collection. As purely geometrical corrections, they apply equally to XRD and ED Palatinus
et al. [2015b], Zhang et al. [2010a] although if beam precession is employed this must also be taken into account
Gjønnes [1997], Zhang et al. [2010b]. In our cRED experiment, we measure the integrated intensity of each reﬂection
individually from rocking curves in both experiment and simulation and it is therefore possible to compare intensities
without applying Lorentz corrections. However, to maintain equivalence with XRD reﬁnement methods it is preferable
to apply them, and we do so for both experiment and simulation.

ii) Geometry G. Corrections for other geometrical issues, such as variations in specimen height or rotation axis, are
needed in XRD and also for ED. These issues primarily affect a diffracted beam’s position, rather than the intensity that
is our main interest here. It is of course important to ensure that the crystal of interest does not wander out of the electron
beam as it is rotated Cichocka et al. [2018], Plana-Ruiz et al. [2020]. More importantly, since dynamical diffraction is
exquisitely sensitive to geometry, crystal orientation must be known to high precision. At crystal orientations where
diffraction is strong, a good calculation of intensities in a cRED measurement using dynamical scattering requires an
angular precision and accuracy better than 40 arc seconds (∼0.2 mrad). Previously, orientation reﬁnement has been

3

Modelling ﬁne-sliced three dimensional electron diffraction data with dynamical Bloch-wave simulations

performed by optimising the ﬁt between experimental and dynamical integrated intensities Palatinus et al. [2013]. Here,
we show that ﬁne-sliced data allows a quicker and more straightforward orientation reﬁnement to be performed, using
the sequence of reﬂections as they appear during crystal rotation. This also permits a measurement of varying slew rate
(section 3). As a corollary of the requirement for high precision in crystal orientation, the angular range of the incident
beam must also be taken into account; while parallel illumination is often assumed, in practice there is always some
beam convergence or divergence that broadens the range of reciprocal space that is sampled.

iii) Background B. In ED, corrections for background need to be considered from two main sources, a) the detector;
and b) non-Bragg scattered electrons (both elastic and inelastic). For (a), detector characteristics such as dark noise
levels, quantum efﬁciency and linearity can be measured effectively; these corrections are necessary but straightforward.
Unfortunately, (b) is rather more problematic. Amorphous material, e.g. the support ﬁlm for the crystal, can create a
non–linear background Tivol [2010], but the sample itself also produces non-Bragg thermal diffuse scattering (TDS,
caused by displacement of atoms from their mean positions by thermal vibrations) and inelastic scattering. Importantly,
these electrons can be diffracted again by the crystal, producing a background that is highly structured, with Kikuchi
lines and dynamical scattering effects Eggeman and Midgley [2012]. Calculating this background is not a trivial exercise
and generally requires a model of thermal vibrations (ideally, complete knowledge of the phonon spectrum) Muller
et al. [2001], Kolb et al. [2012] and a full quantum-mechanical description of inelastic processes Forbes et al. [2011]
respectively. In a complete model of electron scattering these effects would be taken into account in the calculation
of diffracted intensities to be compared against experiment. Currently, while some current multislice simulation
packages can do so Oleynikov [2011] none have yet been implemented for 3D-ED experiments. Here, we use a simple
Bloch-wave model that neglects this ‘background’ intensity of diffuse scattering by the crystal.

iv) Absorption A. This is another term which, strictly speaking, should be considered in scattering theory but in XRD
its behaviour is simple enough for it to be corrected as an experimental variable. For the energies typical of ED (80-300
keV) and a thin specimen suitable for structure solution, true absorption of the electron beam does not happen to any
appreciable extent. However, the attenuation of a Bragg reﬂection, as electrons are scattered into the diffuse background
by TDS or inelastic interactions, is a very similar effect. In ED, TDS is enhanced signiﬁcantly when the electrons are
channeled along atom columns, particularly those with high atomic number Hall and Hirsch [1965]. Thus, dark bands
can be seen between low-index Bragg conditions in bright ﬁeld LACBED patterns (‘anomalous absorption’, Hirsch
et al. [1965], Jordan et al. [1991] see examples below). This complicated behaviour means that in ED it is best dealt
with in scattering theory, and should no longer regarded as an experimental parameter. Both Bloch-wave and multislice
models can account for this effect in ED.

v) Extinction E. This is simply the X-ray term for dynamical diffraction effects. The underlying theory is very similar;
the two-beam analysis by Darwin Darwin [1914a,b, 1922] for X-rays has many resemblances to that of Howie and
Whelan for electrons Howie and Whelan [1961], Hirsch et al. [1965], so much so that they are sometimes referred to as
the Darwin-Howie-Whelan model James [1990]. The term extinction refers to the transfer of intensity from the direct
beam to a diffracted beam g, and back again, as a function of crystal thickness; the distance over which this occurs
is known as an extinction distance ξg. Like absorption, in XRD this can be considered an experimental correction,
since X-ray extinction distances are usually much larger than the size of a crystallite. In ED, where extinction distances
can be tens of nm, this is not the case. (In XRD, there is also ‘secondary’ extinction, which refers to the enhanced
absorption of strong diffracted beams in large crystals Ladd and Palmer [1994], whose counterpart in ED is anomalous
absorption, above). Again, this correction should not be applied to ED data, but taken into account in the calculation of
diffracted intensities.

vi) Scaling S. This correction takes account of the varying proportion of the incident beam occupied by a crystal of
irregular shape as it is rotated. This is certainly a correction that should be applied in principle in ED, although in
practice extreme care must be taken not to confound it with simple loss of intensity in the direct beam due to a very
strong diffracted beam, or the effect of ‘absorption’ due to TDS. ED has a potential advantage over XRD here, in that
a crystal can be imaged directly, allowing scaling to be calculated from a series of images taken after a diffraction
measurement Plana-Ruiz et al. [2020]. Without these images, scaling of intensities is difﬁcult to calculate, although
here we propose a method using the direct beam intensity.

vii) Fluctuations in incident electron beam intensity C. cRED measurements are in general very rapid; diffracted
electron beam intensities are sufﬁciently high that they can be sampled to good precision even in a small fraction of a
second and the total time for data collection is often less than a minute. Variations in incident beam intensity on this
timescale are negligible. Despite this, it is common to see signiﬁcant changes in the direct 000 beam intensity in a
cRED dataset (e.g. SI video 1). This happens because electron diffraction is strong and the crystal occupies much, or
all, of the incident electron beam. In ED, it is quite possible for a diffracted beam with a large structure factor to have a
higher intensity than the direct beam. Nevertheless, this effect is not due to a change in incident beam intensity and
therefore this correction is not appropriate for a cRED measurement.

4

Modelling ﬁne-sliced three dimensional electron diffraction data with dynamical Bloch-wave simulations

vii) Mosaicity M . Crystal imperfections, in the form of dislocations, low-angle grain boundaries and cracks, allows the
Bragg condition to be satisﬁed over a wider range of angles than would be the case for a perfect crystal without strain. In
XRD, the presence of these defects can be helpful in that they effectively break the crystal into a mosaic of small crystal
blocks that reduces extinction effects signiﬁcantly, Ladd and Palmer [1994] although it can also produce broadening of
diffracted beams. For high energy electrons, with much smaller extinction distances, defects alter diffracted intensity
very strongly, allowing them to be visualised directly in diffraction-contrast TEM Hirsch et al. [1965], Williams and
Carter [2009]. In ED they may have a signiﬁcant effect on measured intensities that is too complicated to account for in
any simple model and will vary from one crystal to another in an unknown way. Currently, their effect is neglected
completely and this is probably the best approach until the more tractable effects of dynamical diffraction are fully
accounted for.

To summarise, in reconsidering Eq. 2 for dynamical ED structure solution or reﬁnement, we ﬁnd that some factors
that can be separated from the scattering model and considered ‘experimental’ variables for XRD – i.e. absorption A,
geometry G, and extinction E – must instead be considered explicitly in the scattering model for ED. Other experimental
factors – polarisation p, incident beam intensity variations C, and the complicated effects of mosaicity M – can probably
be neglected at the current level of simulation ﬁdelity, being either relatively unimportant or too difﬁcult to tackle with
current methods. Finally, truly experimental corrections L, B and S that both XRD and ED hold in common must
be taken into account, but the differences in Bragg angle and hardware means that they are rather different for ED.
One of the biggest changes in emphasis is that the point of contact between experimental measurements and modelled
intensities in a dynamical reﬁnement no longer has the simple and elegant interpretation relating to the structure factor.

In what follows, we still use the square root of the corrected intensity as a metric for R1, and use the same notation, i.e.
F (obs)
, bearing in mind that the relationship between these observed values and the structure factor Fhkl of Eq. 1 is no
hkl
longer straightforward. Our discussion above justiﬁes only corrections for Lorentz factors L, background B and scaling
S:

|F (obs)
hkl

|2 = I (obs)

hkl = B−1L−1S−1I (expt)

hkl

.

(3)

We compare F (obs)
hkl with the square root of calculated ED integrated intensities using a dynamical diffraction model in
which extinction X and absorption A are implicit, resulting from the crystal itself. Dynamical integrated intensities
I (dyn)
are a non-linear function of crystal thickness t, geometry G and beam proﬁle P , also with corrections for Lorentz
hkl
factors L:

|F (dyn)
hkl

|2 = L−1 I (dyn)

hkl

(X t G P ) ,

(4)

We now explore this approach using Bloch-wave simulations to compare kinematic and dynamical model ﬁts to
experimental data for simple, well-known materials. We examine data from a single crystal of silicon, ion milled to a
thin foil. This almost perfect crystal shows strong dynamical scattering and is used to evaluate the improvement in ﬁt
using dynamical modelling as well as the importance of correction factors applied to the raw data.

2 Experiment

2.1 Data collection

Experimental data was obtained using selected area electron diffraction (SAED) with parallel beam illumination on a
JEOL 2100 LaB6 transmission electron microscope operating at 200 kV. The sample was a defect-free single crystal ion
milled to produce a (110) lamella with extensive electron transparent regions. Diffraction patterns were produced using
a strongly excitetd third condenser lens giving close to parallel illumination and a selected area aperture, and captured
using a Gatan OneView camera recording continuously at 8× binning (4096 × 4096 → 512 × 512) at 75 frames/sec.
(N.B. with 8x binning for data collection, the point spread function of the camera is negligible.) The crystal was much
larger than the selected area aperture and was rotated at maximum slew rate about the α-tilt axis over 143◦, giving 1389
frames, each with a nominal crystal rotation of 0.1035◦ (i.e. all data collected in 18.5 seconds).

2.2 Data reduction and dynamical simulations

P ET S (Process Electron Tilt Series) is a software program developed speciﬁcally to process electron diffraction tilt
series data Palatinus [2011]. We used P ET S to ﬁnd the crystal orientation and unit cell, to index reﬂections and give
their rocking curves, and obtain a hkl and I (obs)

list as detailed in sections 4.1-4.6 of Palatinus et al. [2019].

hkl

5

Modelling ﬁne-sliced three dimensional electron diffraction data with dynamical Bloch-wave simulations

Figure 2: a) The relative direct beam intensity for the Si cRED data as a function of goniometer angle α. The red line
marks the average intensity, normalised to unity. See also Fig. S2.

Bloch wave simulations were performed using the code F elix Beanland et al. [2019] running on a high performance
computing cluster (typically 384 cores, completing a simulation in ∼ 30 seconds) using a python script to extract
data from the the dyn.cif_pets ﬁle generated by PETS and write input ﬁles for f elix, e.g. setting the incident beam
orientation with respect to the crystal. Large-angle convergent beam electron diffraction (LACBED) patterns of size
400x400 pixels were simulated over an angular range corresponding to 40 frames (4.14◦, or 72.26 mrad). The x-axis of
the image was taken to be along a direction perpendicular to the rotation axis. Successive simulations overlapped by 10
frames, thus requiring 70 simulations in total to cover the full angular range of the cRED data.

3 Results

The Si cRED data contained 962 reﬂections with I (obs)
hkl /σhkl > 10 and to avoid any issues with signal to noise the
analysis is restricted to these strong reﬂections. The intensity of each reﬂection is given frame-by-frame as an output
from P ET S. Almost all these experimental rocking curves showed a single sharp peak as the crystal was rotated; only
27 had clear dynamical structure with multiple peaks. To obtain integrated intensities according to Eq. 3 we apply
the three experimental corrections of Eq. 3, beginning with background correction B−1. As noted above, background
from thermal diffuse scattering and Kikuchi lines is complex and not modelled correctly in a simple Bloch-wave
simulation; here we simply subtract a linear ﬁt to the background by interpolating beneath the peak of each rocking
curve (supplementary Fig. S1). The Lorentz correction L−1 was then applied for each reﬂection g by taking the sum of
counts in the background-subtracted rocking curve and multiplying by the change in deviation parameter per frame δsg.

Since the silicon lamella was close to parallel-sided and much larger than the selected area aperture, it ﬁlled the ﬁeld
of view completely throughout data collection and therefore no frame scaling correction S−1 should be required.
Nevertheless, it is useful to examine the intensity of the direct beam as the crystal rotated, since this should show
changes in transmission that result from a varying fraction of the incident beam being intercepted by the crystal. Thus,
each frame was cropped to a 17 × 17 pixel image containing just the direct beam and an average beam proﬁle ¯I000 was
obtained by summing all frames and dividing by n = 1387. A normalised direct beam intensity was then produced
by dividing each cropped frame by ¯I000; re-slicing this 17 × 17 × 1387 xyz data volume to 1387 × 17 × 17 zyx, and
taking the average along x, gives a 1387 × 17 image that shows relative direct beam intensity as the crystal is rotated
(supplementary Fig. S2), shown in graphical form in Fig. 2. For most of the angular range the relative intensity plot
has an average with a value of unity (red line), consistent with the unchanging crystal shape sampled as it completely
ﬁlls the selected area aperture. There is a range of approx. 10◦ at α = 0◦ where the relative intensity is depressed by
∼ 20%, but this is primarily due to channeling (see below); since this is calculated as part of the dynamical simulation
it should not be compensated by scaling. But most strikingly, there are many sharp and signiﬁcant minima (up to 50%
of the relative intensity). Closer examination showed each of these dark lines to occur when a diffraction condition was
satisﬁed; they simply indicate a transfer of intensity from the direct beam to a diffracted beam. As seen in more detail
in supplementary Fig. S2, Bragg conditions that are satisﬁed in only a few frames are visible as dark vertical bands,
while Bragg conditions that only pass through the direct beam slowly are also visible as inclined dark lines.

6

Modelling ﬁne-sliced three dimensional electron diffraction data with dynamical Bloch-wave simulations

Figure 3: R1 calculation for cRED silicon data using the kinematic model (Eq. 1) with B = 0.2. Kinematically
forbidden reﬂections are highlighted in red. R1 = 26.0%

(cid:17)

(cid:16)

hkl

hkl = F (kin)
F (obs)

After applying corrections B−1, L−1 and discounting S we now have a set of integrated intensities that can be compared
to simulation and yield an R-factor. We ﬁrst consider kinematic intensities calculated using Eq. 1, taking the temperature
factor to be Tj = exp(−Bj sin2(θ)/λ2) where Bj is the Debye-Waller factor. We ﬁnd a minimum R1 = 28.7% at
B = 0, shown in Fig. 3 (X-ray reﬁnements give B = 0.54 Többens et al. [2001]). In this plot the bold black line
indicates R1 = 0
while the orange line is a least-squares linear ﬁt to the data. It is quite clear that
the ﬁt of the kinematic model to the data is poor, not least because there are a number of kinematically–forbidden
reﬂections that have signiﬁcant experimental intensities (highlighted in red), but also because many strong reﬂections
(F (kin)
hkl > 0.2) are in fact weaker than expected . (N.B. There are no weak reﬂections in the experimental data,
hkl < 0.04, as we have excluded those with I (obs)
F (obs)
hkl /σhkl < 10.)
The poor R1 seen in Fig. 3 is typical of many ED reﬁnements using a kinematic model and we now turn to a dynamical
one. We use an initial Debye-Waller factor B = 0.54 Többens et al. [2001] since the value obtained from the kinematic
model is unphysical. A Bloch-wave simulation of seventy F elix 000 LACBED patterns, stitched together to make a
continuous strip, is shown in Figure 4. Frame numbers underneath correspond to experiment. In this image, a perfect
plane-wave incident beam corresponds to a single point and the red line marks the nominal path traced by the direct
beam through reciprocal space as the crystal is rotated. Each dark line in the simulation shows the location of a Bragg
condition; when the direct beam lies on one of these lines a diffracted beam is produced, with an intensity that can be
obtained from the corresponding point in the relevant dark-ﬁeld LACBED pattern. The correspondence between this
simulation and experiment can also be seen by converting the normalised experimental direct beam data volume to a 2D
image, shown in greyscale below the simulation. Some features common to both experiment and simulation are marked
by arrows.

The simulated rocking curve for a reﬂection is given by the intensity along a line in its dark ﬁeld LACBED pattern, as
shown in Fig. 5 for a) a typical reﬂection with a single peak ¯9¯3¯3, and b) one with obvious dynamical structure 311.
Integrated intensities I (dyn)
can be obtained from these simulated rocking curves in the same way as they are taken from
experimental ones, although here there is no diffuse scattering and therefore no background correction. The incident
beam intensity is ﬁxed at unity so there is no scaling correction and only Lorentz corrections need to be applied.

hkl

7

Modelling ﬁne-sliced three dimensional electron diffraction data with dynamical Bloch-wave simulations

Figure 4: Dynamical simulation for the path of the 000 beam through reciprocal space (red line) in the silicon cRED
data set, corresponding to 1387 frames (goniometer rotation of 143◦ about α). Frame numbers are indicated; note that
one division = 5 frames = 0.5175◦ = 9 mrad. Each dark line corresponds to a Bragg condition for a diffracted beam, two
of which (¯9¯3¯3, frames 30-50 and 311, frames 545-590) are labelled. Below the simulation, the experimental intensity
of the 000 beam is shown. Some features that are clearly present in both simulation and experiment are indicated by
arrows.

8

Modelling ﬁne-sliced three dimensional electron diffraction data with dynamical Bloch-wave simulations

Figure 5: Two examples of silicon cRED rocking curves. (a) and (b) are experimental data. Most experimental rocking
curves have a simple peak like (a) ¯9¯3¯3, while less than 3% show dynamical structure like (b) 311. c) and d) show the
corresponding dark ﬁeld LACBED simulations (specimen thickness 185 nm). The nominal beam path is a red line, with
frame numbers in yellow. Intensity proﬁles along the red line give the rocking curves (e) and (f). The difference in
frame numbers (a) to (e) and (b) to (f) are caused by a varying slew rate (Fig. 8b). g) and h): Applying the angular
spread of the incident beam (Fig. 9) as a convolution to the simulation gives simulated rocking curves that are a good
match to experiment.

Kinematic intensities are independent of crystal thickness, but dynamic intensities can be very sensitive to it, particularly
strong reﬂections with short extinction distances. It is therefore necessary to perform simulations for a range of
thicknesses. (Supplementary sections S1.4 and S1.5). We may also expect the specimen thickness along the path of the
electron beam to vary as the crystal is rotated, but this is ignored for the moment. The best R1 is obtained for a thickness
of 190nm, shown in Fig. 6. A very signiﬁcant improvement over the kinematic model is apparent, with R1 = 12.6%.
The wide spread of intensities is no longer present, but there is still considerable scatter about the expected R1 = 0 line
and the gradient of a linear ﬁt is 0.74.

Dynamical simulations therefore clearly give a much better ﬁt to experimental data, as may be expected. However,
R1 is still relatively high in Fig. 6 and further improvements are possible by increasing the precision of the crystal
orientation. The wide range of reciprocal space covered in the simulation allows geometry to be optimised, as described
below.

3.0.1 Orientation optimisation G.

For any given reﬂection in Fig. 4 its Bragg condition is satisﬁed, and a spot will appear in the SAED pattern, when the
000 beam sits on the corresponding dark line. The frame in which the maximum diffracted intensity appears is given
by the crossing point of the Bragg condition and the red line. It is thus possible to obtain the sequence of reﬂections
which appear in a cRED experiment, and the frame spacing between them, for any given direct beam path. Conversely,

9

Modelling ﬁne-sliced three dimensional electron diffraction data with dynamical Bloch-wave simulations

Figure 6: R1 calculation for cRED silicon data with a dynamical Bloch wave model, using the nominal direct beam
path (red line in Fig. 2) and a specimen thickness of 190 nm. The black line marks perfect correspondence (R1 = 0)
and the orange line a least squares linear ﬁt. R1 = 12.6%

Figure 7: a) The intersections with Bragg conditions for eight reﬂections in the ﬁrst Si F elix simulation. Frame
numbers are given at the bottom of the image and the frame in which each peak intensity is found is marked by a
vertical blue line. The intersection of the blue line with its Bragg condition is marked by a yellow dot (yellow lines
correspond to an error of ±0.5 frames). The horizontal red line marks the nominal beam path (output from P ET S)
and if the crystal orientation was correct the yellow dots would all lie on this line. b) The best ﬁt to a straight line is
obtained by shifting the blue lines by -2.5 frames. c) R1 calculation using an optimised beam path and a specimen
thickness of 185 nm. R1 = 10.0%

with knowledge of the frames in which diffracted maxima appear in an experiment we can ﬁnd the corresponding path
through reciprocal space.

The effect of a slightly incorrect crystal orientation is shown in Fig. 7a. In this simulated image each frame corresponds
to a vertical stripe ten pixels wide and the nominal direct beam path runs horizontally through the centre, marked by a
red line. Experimentally, the ¯14 ¯2 ¯2 and 11 1 3 reﬂections were seen in frame 4, 84¯4 was seen in frame 9, etc, as marked
by blue vertical lines. The image is a superposition of eight dark-ﬁeld LACBED patterns; each bright line corresponds
to a diffracted beam (and to a dark line in the direct beam LACBED pattern, not shown). The intersection of each

10

Modelling ﬁne-sliced three dimensional electron diffraction data with dynamical Bloch-wave simulations

Figure 8: Corrections to the nominal direct beam path (red line in Fig. 4), a) perpendicular to the line (β-tilt) and b)
along the line (α-tilt). Uncertainty in δα and δβ for each data point are ∼ ±0.5 frames, i.e. 0.05◦. c) R1 calculation
after correcting integrated intensities for varying slew rate gives R1 = 9.4% at a specimen thickness of 195 nm.

blue line and its corresponding diffraction condition is marked by a yellow dot and must lie on the beam path; yellow
lines indicate an error of 0.5 frames. Clearly, these points do not correspond to the expected horizontal line through
reciprocal space, indicating that the nominal crystal orientation is slightly in error. An optimised crystal orientation can
be found by shifting the group of blue lines while maintaining their relative frame spacing (e.g. 3¯39 has an experimental
peak intensity one frame before 13¯7 and three frames after 84¯4). Shifting the set of blue lines by 2.5 frames to the left
brings all points close to a horizontal line (Fig. 7b). An optimised direct beam path was then calculated by ﬁtting a
smoothed curve to the best crystal orientation for each simulation (Fig. 8), both for changes about the rotation axis δα
and perpendicular to it δβ by least-squares ﬁtting a horizontal line to the optimised set of intersection points. Rocking
curves extracted from the Bloch-wave simulations using an optimised beam path gives a signiﬁcant improvement to
R1 = 10.0% (Fig. 7c), mainly by reducing the scatter in reﬂections with lower intensities. This can be understood by
referring back to Fig. 1, which shows how large variations in intensity can be found in weak beams when they coincide
with stronger beams. Optimisation of the beam path is essential to capture these interactions correctly.

The resulting corrections are shown in Fig. 8. The actual path traced by the direct beam deviates vertically from the
red line (i.e. about the β tilt axis) in Fig. 8 by a maximum of 10 pixels (equivalent to 1 frame, or 0.1◦). There is a
much larger correction needed along α, up to 5 frames (0.5◦, Fig. 8b) that varies through the data series, caused by
a varying slew rate during rotation of the specimen. This varying slew rate is apparent in Fig. 4, where the features
in the normalised experimental direct beam intensity are not found directly beneath their corresponding points in the
simulation above. A changing slew rate also has an impact on integrated intensities, since the crystal is rotating more
slowly or quickly through a diffraction condition than expected. Applying a slew rate correction to the simulated
intensities gives a further improvement to R1 = 9.4%. (Fig.8c).

3.0.2 Correction for beam proﬁle P .

The sensitivity of dynamical electron diffraction to thickness is apparent in the R1 calculation for all integrated
intensities (see S1.4). It is also very important for the ﬁne structure of rocking curves of strongly dynamical interactions,
which show fringes that change in size and number as a function of crystal thickness. It has long been known that
crystal thickness can be measured to an accuracy of a nm or better using these features in CBED patterns.Kelly et al.
[1975], Allen [1981] The ﬁne structure of strongly dynamical rocking curves thus gives another way to measure crystal
thickness, which should match the minimum R1 for all reﬂections. These fringes can be seen clearly for the 311
reﬂection in Fig. 5. However, the features in Fig. 5f are noticeably sharper than the experimental rocking curve Fig. 5b
and this is due to the angular range of the incident electron beam. Additionally, in the optimised orientation Fig. 7b the
yellow dots do not lie precisely on a straight horizontal line. Both of these effects may be explained if the intersections
are not points, but have a ﬁnite size.

The incident electron beam is not a perfect plane wave because the crossover produced by the ﬁnal condenser lens,
which acts as an effective illumination source, is of ﬁnite size. We may approximate the angular proﬁle of the incident
beam by the intensity proﬁle of the direct transmitted beam averaged through all frames, which is shown in Fig. 9a
together with a ﬁt to a Lorentzian proﬁle. The ﬁt is excellent and gives the FWHM of the direct beam to be 0.037
Å
, or 0.47 mrad (97 arc sec). Applying this beam proﬁle as a convolution to the simulated LACBED patterns allows
rocking curves to be extracted that are a good approximation to experiment, as shown in Figs. 5g and 5h. Integrated

−1

11

Modelling ﬁne-sliced three dimensional electron diffraction data with dynamical Bloch-wave simulations

Figure 9: a) The direct beam proﬁle, obtained by averaging all frames in the Si cRED data and a Lorentzian ﬁt. b)
R1 calculation after optimising geometry and correcting for slew rate and beam proﬁle (specimen thickness 185 nm).
R1 = 8.9%. c) R1 for the kinematic model K, initial dynamical model D, with geometry optimisation G, corrections
for slew rate S and beam proﬁle P , and reﬁnement of Debye-Waller factor DW F .

Figure 10: a) R1 as a function of Debye-Waller factor B. b) Optimised R1 calculation for B = 0.33, giving a best
R1 = 6.8% at a specimen thickness of 185 nm.

intensities obtained after applying this ﬁnal correction gives R1 = 8.9% (Fig. 9b). The largest scatter from the R1 = 0
line is now found in the highest intensity reﬂections.

Having applied all relevant corrections to the experimental data and optimised the simulation, we are ﬁnally in a position
to perform a structural reﬁnement. In silicon there is only one free parameter – the Debye-Waller factor B. Fig. 10
shows the variation of R1 with B, with a ﬁnal R1 of 6.8% and a well-deﬁned best-ﬁt at B = 0.32Å
. This is rather
lower than the X-ray value of B = 0.54Å
Többens et al. [2001] and there is still noticeable scatter in the highest
intensity measurements. These differences may be due to difﬁculties in background subtraction, which result from a
limited number of intensity measurements in the P ET S output (see section S1.1)

2

2

In summary for this silicon cRED data, we have demonstrated that the poor R1 obtained using a kinematical diffraction
model is not found when using a dynamical model with appropriate optimisation and correction factors (Fig. 9c). The
ﬁnal result (R1 < 7%) approaches the values deemed acceptable for X-rays. The importance of careful correction is
very clear from the observation that the improvement in R1 due to reﬁnement of the temperature factor (Fig. 10) is
of similar magnitude to improvements that result from optimisation of geometry (Fig. 9c). Nevertheless, dynamical
ED intensities are far more sensitive to structure (i.e. atomic coordinates) than temperature factors Beanland et al.
[2021], which is reassuring for structure solution and consistent with the growing number of structures solved by
ED. Further improvements may be possible with improved background subtraction, which may be incorrect for high
intensity reﬂections in this particular example due to a lack of data in the rocking curves.

12

Modelling ﬁne-sliced three dimensional electron diffraction data with dynamical Bloch-wave simulations

4 Discussion and conclusions

In this work, we have established a protocol for dynamical modelling of ﬁne-sliced cRED data, taking account of the
corrections that should be applied in the case of electron diffraction, equivalent to those applied to X-ray data. These
corrections rely on the ability to extract rocking curves from experimental data, i.e. having a large number of frames
collected at small angular increments. We expect that this approach will become widespread as detector technology
continues to improve. Our results show that dynamical modelling of cRED data has a very signiﬁcant impact on the
quality of ﬁt, reducing R1 by almost 20% in the silicon example chosen here (similar improvements were seen by
Palatinus et al. [2013] for silicon). Nevertheless, this is a particularly simple material with very high perfection and
many systematic absences. Equivalent improvements may not be found for more interesting (complex) materials,
particularly if they have poorer crystallinity, strong inelastic scattering as seen in organic materials Latychevskaia and
Abrahams [2019], and are not parallel sided lamellae.

Several improvements can be made from this ﬁrst attempt at dynamical modelling, not least the need for signiﬁcant
computing resources. Each set of 70 simulations calculated 5.6 × 106 incident beam orientations, producing a 400 × 400
pixel LACBED pattern for each of the 962 diffracted beams. The large range of reciprocal space covered in each
LACBED pattern, together with knowledge of which frame each reﬂection was seen experimentally, allowed precise
correction of the crystal orientation but the area of reciprocal space covered could be reduced by a factor of > 20 if this
optimisation were performed by direct calculation of the positions of the different Bragg conditions. To allow rocking
curves to be captured fully, each simulation overlapped with the next, meaning that every incident beam orientation was
simulated twice, something easily avoided if a single simulation (e.g. 20 × 14000 pixels) is calculated instead. Rocking
curves and integrated intensities could be output directly, rather than extracted from these simulated data using python
scripts. In F elix, the Bloch wave calculation is optimised by careful choice of the diffracted beams included Zuo and
Weickenmeier [1995], Chuvilin and Kaiser [2005], but the time required remains ∝ N 3, where N is the number of
beams Yang et al. [2017]. No attempt was made to optimise this parameter and all simulations were run with N = 200
from a beam pool of ∼ 800 in each simulation. If all such improvements were to be implemented it seems reasonable
to expect a full set of |F (dyn)
|2 to be obtained in seconds, which would then allow dynamical reﬁnement of crystal
structure in reasonable times.

hkl

Improvements in simulation ﬁdelity are also possible. The simple Bloch-wave calculation used here assumes that the
surface normal is parallel to the incident beam direction, i.e. it does not properly account for continuity of the electron
wave function at the entrance and exit surfaces of a tilted crystal. This is obviously not correct for a specimen tilted
by up to 70◦. Furthermore, as the crystal rotates, the thickness of material transited by the electron beam changes.
Interestingly, we found that simulated rocking curves for a single thickness gave a good match to experiment across the
full dataset (section S1.5), and that this thickness agreed with the minimum R1, obtained from integrated intensities.
Furthermore, incorporating a change in crystal thickness t corresponding to that expected for a parallel-sided slab
(t ∝ 1/cos α) gave a worse result than using a single thickness for the complete data set. Presumably these aspects are
linked and a more correct model would yield further improvements in R1. Finally, some experimental rocking curves
suffered from poor background correction (section S1.1), although it is unclear for these very strong reﬂections how
much diffuse scattering is present. More careful extraction of integrated intensities may also improve R1.

In conclusion, dynamical modelling of cRED data has a signiﬁcant impact on the quality of ﬁt. If all correction factors
are accounted for properly, it seems probable that ﬁt metrics for electron diffraction will equal those of X-ray diffraction.
This is encouraging for future development and application of 3D-ED techniques to structural solution in a wide range
of applications.

5 Acknowledgments

We would like to thank Dr. Lukáš Palatinus for assistance in using P ET S for data processing and to extract rocking
curve data. Data collection was aided by Yani Carter and Will Roberts. We acknowledge the University of Warwick
Research Technology Platforms for Electron Microscopy and Scientiﬁc Computing for use of facilities. AC would like
to thank the University of Warwick for PhD funding as part of the Warwick Centre for Doctoral Training in Analytical
Science.

13

Modelling ﬁne-sliced three dimensional electron diffraction data with dynamical Bloch-wave simulations

References

Hongyi Xu and Xiaodong Zou. Absolute structure, at the nanoscale.

Science, 364(6441):632–633, 2019.

doi:10.1126/science.aax5385.

Mauro Gemmi and Arianna E. Lanza. 3d electron diffraction techniques. Acta Crystallographica Section B, 75(4):

495–504, Aug 2019a. doi:10.1107/S2052520619007510.

Mauro Gemmi, Enrico Mugnaioli, Tatiana Gorelik, U. Kolb, Lukáš Palatinus, Philippe Boullay, and Jan Abra-
3d electron diffraction: The nanocrystallography revolution. ACS Central Science, 5, 07 2019.

hams.
doi:10.1021/acscentsci.9b00394.

Lukáš Palatinus, Cinthia Antunes Correa, Gwladys Steciuk, Damien Jacob, Pascal Roussel, Philippe Boullay, Mariana
Klementova, Mauro Gemmi, Jaromir Kopecek, M. Chiara Domeneghetti, Fernando Camara, and Vaclav Petricek.
Structure reﬁnement using precession electron diffraction tomography and dynamical diffraction: Tests on experi-
mental data. Acta Crystallographica Section B: Structural Science, Crystal Engineering and Materials, 71:740–751,
2015a. doi:10.1107/S2052520615017023.

A.R. Faruqi and G. McMullan. Direct imaging detectors for electron microscopy. Nuclear Instruments and Methods in
Physics Research Section A: Accelerators, Spectrometers, Detectors and Associated Equipment, 878:180–190, 2018.
ISSN 0168-9002. doi:https://doi.org/10.1016/j.nima.2017.07.037. Radiation Imaging Techniques and Applications.

Gary W. Paterson, Raymond J. Lamb, Rafael Ballabriga, Dima Maneuski, Val O’Shea, and Damien McGrouther.
Sub-100 nanosecond temporally resolved imaging with the medipix3 direct electron detector. Ultramicroscopy,
210:112917, 2020. ISSN 0304-3991. doi:https://doi.org/10.1016/j.ultramic.2019.112917. URL https://www.
sciencedirect.com/science/article/pii/S0304399119301834.

Mauro Gemmi and Arianna E. Lanza. 3d electron diffraction techniques. Acta Crystallographica Section B, 75(4):

495–504, Aug 2019b. doi:10.1107/S2052520619007510.

Yifeng Yun, Xiaodong Zou, Sven Hovmöller, and Wei Wan. Three-dimensional electron diffraction as a complementary
technique to powder x-ray diffraction for phase identiﬁcation and structure solution of powders. IUCrJ, 2(2):267–282,
Mar 2015. doi:10.1107/S2052252514028188.

Archie Howie. Addressing coulomb’s singularity, nanoparticle recoil and johnson’s noise. In PD Nellist, editor,
ELECTRON MICROSCOPY AND ANALYSIS GROUP CONFERENCE 2013 (EMAG2013), volume 522 of Journal
of Physics Conference Series, 2014. doi:10.1088/1742-6596/522/1/012001. Conference of the Electron-Microscopy-
and-Analysis-Group (EMAG), York, ENGLAND, SEP 03-06, 2013.

A.P. Dudka, A.S. Avilov, and S. Nicolopoulos.

for precession electron diffraction.
doi:https://doi.org/10.1016/j.ultramic.2006.03.009.

Ultramicroscopy, 107(6):474–482, 2007.

Crystal structure reﬁnement using bloch-wave method
ISSN 0304-3991.

Wharton Sinkler and Laurence D. Marks. Characteristics of precession electron diffraction intensities from dynamical
simulations. Zeitschrift für Kristallographie, 225(2-3):47–55, 2010. doi:doi:10.1524/zkri.2010.1199. URL https:
//doi.org/10.1524/zkri.2010.1199.

Lukáš Palatinus, Václav Petˇríˇcek, and Cinthia Antunes Corrêa. Structure reﬁnement using precession electron diffraction
tomography and dynamical diffraction: theory and implementation. Acta Crystallographica Section A, 71(2):235–244,
Mar 2015b. doi:10.1107/S2053273315001266.

L Palatinus. PETS: Program for Analysis of Electron Diffraction Data. Institute of Physics of the Czech Academy of

Sciences, 2011.

M. F. C Ladd and R. A Palmer. Structure determination by X-ray crystallography. Plenum Press, 1994.

Max T. B. Clabbers, Tim Gruene, Eric van Genderen, and Jan Pieter Abrahams. Reducing dynamical electron scattering
reveals hydrogen atoms. Acta Crystallographica Section A, 75(1):82–93, Jan 2019. doi:10.1107/S2053273318013918.

P. Oleynikov, S. Hovmöller, and X.D. Zou. Precession electron diffraction: Observed and calculated intensities.
Ultramicroscopy, 107(6):523–533, 2007. ISSN 0304-3991. doi:https://doi.org/10.1016/j.ultramic.2006.04.032. URL
https://www.sciencedirect.com/science/article/pii/S030439910600218X.

Daliang Zhang, Peter Oleynikov, Sven Hovmöller, and Xiaodong Zou. Collecting 3d electron diffraction data by the
rotation method. Zeitschrift für Kristallographie, 225(2-3):94–102, 2010a. doi:doi:10.1524/zkri.2010.1202. URL
https://doi.org/10.1524/zkri.2010.1202.

Kjersti Gjønnes. On the integration of electron diffraction intensities in the vincent-midgley precession technique.

Ultramicroscopy, 69(1):1–11, 1997. ISSN 0304-3991. doi:https://doi.org/10.1016/S0304-3991(97)00031-4.

14

Modelling ﬁne-sliced three dimensional electron diffraction data with dynamical Bloch-wave simulations

Daliang Zhang, Daniel Grüner, Peter Oleynikov, Wei Wan, Sven Hovmöller, and Xiaodong Zou. Precession elec-
ISSN 0304-3991.

tron diffraction using a digital sampling method. Ultramicroscopy, 111(1):47–55, 2010b.
doi:https://doi.org/10.1016/j.ultramic.2010.09.008.

Magdalena Ola Cichocka, Jonas Ångström, Bin Wang, Xiaodong Zou, and Stef Smeets. High-throughput continuous
rotation electron diffraction data acquisition via software automation. Journal of Applied Crystallography, 51(6):
1652–1661, Dec 2018. doi:10.1107/S1600576718015145.

S Plana-Ruiz, Y Krysiak, J Portillo, E Alig, S Estradé, F Peiró, and U Kolb. Fast-adt: A fast and automated electron
diffraction tomography setup for structure determination and reﬁnement. Ultramicroscopy, 211:112951, 2020. ISSN
0304-3991. doi:https://doi.org/10.1016/j.ultramic.2020.112951.

Lukáš Palatinus, Damien Jacob, Priscille Cuvillier, Mariana Klementová, Wharton Sinkler, and Laurence D. Marks.
Structure reﬁnement from precession electron diffraction data. Acta Crystallographica Section A, 69(2):171–188,
Mar 2013. doi:10.1107/S010876731204946X.

William F. Tivol. Selected area electron diffraction and its use in structure determination. Microscopy Today, 18(4):

22–28, 2010. doi:10.1017/S1551929510000441.

Alexander S. Eggeman and Paul A. Midgley. Chapter 1 - precession electron diffraction. In Peter W. Hawkes, editor,
Advances in Imaging and Electron Physics, volume 170 of Advances in Imaging and Electron Physics, pages 1–63.
Elsevier, 2012. doi:https://doi.org/10.1016/B978-0-12-394396-5.00001-4.

David A. Muller, Byard Edwards, Earl J. Kirkland, and John Silcox. Simulation of thermal diffuse scattering including
a detailed phonon dispersion curve. Ultramicroscopy, 86(3):371–380, 2001. doi:https://doi.org/10.1016/S0304-
3991(00)00128-5.

Ute Kolb, Kenneth Shankland, Louisa Meshi, Anatoly S. Avilov, and William I. F. David, editors. Uniting electron

crystallography and powder diffraction. Springer, Dordrecht, 2012.

B. D. Forbes, A. J. D’Alfonso, S. D. Findlay, D. Van Dyck, J. M. LeBeau, S. Stemmer, and L. J. Allen.
Thermal diffuse scattering in transmission electron microscopy. Ultramicroscopy, 111(12):1670–1680, 2011.
doi:https://doi.org/10.1016/j.ultramic.2011.09.017.

P. Oleynikov. emap and eslice: a software package for crystallographic computing. Crystal Research and Technology,

46(6):569–579, 2011. doi:https://doi.org/10.1002/crat.201100052.

C. R. Hall and Peter Bernhard Hirsch. Effect of thermal diffuse scattering on propagation of high energy electrons
through crystals. Proceedings of the Royal Society of London. Series A. Mathematical and Physical Sciences, 286
(1405):158–177, 1965. doi:10.1098/rspa.1965.0136.

P. B. Hirsch, A. Howie, R. B. Nicholson, D. W. Pashley, and M. J. Whelan. Electron Microscopy of Thin Crystals.

Butterworths, London, 1965.

I. K. Jordan, C. J. Rossow, and R. Vincent. Effects of energy ﬁltering in lacbed patterns. Ultramicroscopy, 35(3):

237–243, 1991. ISSN 0304-3991. doi:https://doi.org/10.1016/0304-3991(91)90075-H.

Charles G Darwin. The theory of x-ray reﬂexion. The London, Edinburgh, and Dublin Philosophical Magazine and

Journal of Science, 27(158):315–333, 1914a. doi:10.1080/14786440208635093.

Charles G Darwin. The theory of x-ray reﬂexion part ii. The London, Edinburgh, and Dublin Philosophical Magazine

and Journal of Science, 27(160):675–690, 1914b. doi:10.1080/14786440408635139.

Charles G Darwin. The reﬂexion of x-rays from imperfect crystals. The London, Edinburgh, and Dublin Philosophical

Magazine and Journal of Science, 43(257):800–829, 1922. doi:10.1080/14786442208633940.

Archibald Howie and Michael John Whelan. Diffraction contrast of electron microscope images of crystal lattice defects
- ii. the development of a dynamical theory. Proceedings of the Royal Society of London. Series A. Mathematical and
Physical Sciences, 263(1313):217–237, 1961. doi:10.1098/rspa.1961.0157.

Richard James. Applications of perturbation theory in high energy electron diffraction. PhD thesis, University of Bath,

1990.

D. B. Williams and C. B. Carter. Transmission electron microscopy : a textbook for materials science. Springer, New

York ; London, 2009.

Lukáš Palatinus, Petr Brazda, Martin Jelinek, Jaromira Hrda, Gwladys Steciuk, and Mariana Klementova. Speciﬁcs
of the data processing of precession electron diffraction tomography data and their implementation in the program
pets2.0. Acta Crystallographica Section B, 75(4):512–522, Aug 2019. doi:10.1107/S2052520619007534.

R. Beanland, K. Evans, Rudolf A. Römer, and A. J. M. Hubert. Felix bloch wave simulation: Source code, 2019. URL

https://github.com/WarwickMicroscopy/Felix.

15

Modelling ﬁne-sliced three dimensional electron diffraction data with dynamical Bloch-wave simulations

D.M. Többens, N. Stüber, K. Knorr, H.M. Mayer, and G. Lampert. E9: The new high-resolution neutron
powder diffractometer at the berlin neutron scattering center. Materials Science Forum, 378:288–293, 2001.
doi:10.4028/www.scientiﬁc.net/msf.378-381.288.

PM Kelly, A Jostsons, RG Blake, and JG Napier. The determination of foil thickness by scanning transmission electron

microscopy. Physica status solidi (a), 31(2):771–780, 1975.

Samuel M. Allen. Foil thickness measurements from convergent-beam diffraction patterns. Philosophical Magazine A,

43(2):325–335, 1981. doi:10.1080/01418618108239412.

R. Beanland, K. Smith, P. Vanˇek, H. Zhang, A. Hubert, K. Evans, R. A. Römer, and S. Kamba. A new electron
diffraction approach for structure reﬁnement applied to ca3mn2o7. Acta Crystallographica Section A, 77(3):196–207,
May 2021. doi:10.1107/S2053273321001546.

Tatiana Latychevskaia and Jan Pieter Abrahams.

namical diffraction in biological crystals.
doi:10.1107/S2052520619009661. URL https://doi.org/10.1107/S2052520619009661.

Inelastic scattering and solvent scattering reduce dy-
Acta Crystallographica Section B, 75(4):523–531, Aug 2019.

J.M. Zuo and A.L. Weickenmeier. On beam selection and convergence in the bloch-wave method. Ultramicroscopy, 57

(4):375–383, 1995. doi:https://doi.org/10.1016/0304-3991(94)00190-X.

A. Chuvilin and U. Kaiser. On the peculiarities of cbed pattern formation revealed by multislice simulation. Ultrami-

croscopy, 104(1):73–82, 2005. ISSN 0304-3991. doi:https://doi.org/10.1016/j.ultramic.2005.03.003.

Yi Yang, Qibin Yang, Jianyu Huang, Canying Cai, and Jianguo Lin. Quantitative comparison between
real space and bloch wave methods in image simulation. Micron, 100:73–78, 2017.
ISSN 0968-4328.
doi:https://doi.org/10.1016/j.micron.2017.04.007. URL https://www.sciencedirect.com/science/article/
pii/S0968432817300744.

16

Modelling ﬁne-sliced three dimensional electron diffraction data with dynamical Bloch-wave simulations

Figure S1: Background subtraction for four rocking curves in the Si cRED data set

S1.1 Experimental rocking curves and background subtraction.

Four examples of rocking curves from the silicon cRED data produced by PETS, and subsequent background subtraction,
are shown in Fig. S1. The red line is a linear least-squares ﬁt to data points outside the peak. The raw integrated
intensity is the sum of the green bars. For some strong reﬂections, such as the 111 peak, the data points in the rocking
curve may not extend sufﬁciently to allow a good ﬁt to the background, leading to a systematic underestimation of
integrated intensity.

Integrated intensities useful for structure solution and computation of R1s are obtained by applying Lorentz scaling to
each raw integrated intensity.

17

Modelling ﬁne-sliced three dimensional electron diffraction data with dynamical Bloch-wave simulations

S1.2 Direct beam intensity.

18

Modelling ﬁne-sliced three dimensional electron diffraction data with dynamical Bloch-wave simulations

Figure S2: The relative direct beam intensity, obtained by cropping the stack of n = 1389 frames to just the direct
beam, producing an average of the beam proﬁle by summing all frames and dividing by n, and then dividing each image
in the stack by this average. The stack of frames is then re-sliced to view from the side. Deﬁcits in the direct beam,
caused by each Bragg condition that is passed through as the goniometer rotates, are visible as dark lines.

19

Modelling ﬁne-sliced three dimensional electron diffraction data with dynamical Bloch-wave simulations

Figure S3: R1 calculation as a function of B in the kinematic model. The lowest R is found at B = 0.

S1.3 R1 calculation and sensitivity to B in the kinematic model.

In all R-factor calculations, we normalise calculated intensities by dividing by I000 = F000F ∗
000, i.e. the direct beam has
an intensity of unity in the absence of any Bragg diffraction. We take the square root of the experimental Lorentz-scaled
integrated intensities H (obs)

hkl )0.5 and scale them to match calculated structure factors F (calc)
hkl = (I (obs)
hkl = H (obs)
F (obs)

hkl H (obs)
F (kin)
hkl /

hkl H (obs)

H (obs)

(cid:88)

(cid:88)

hkl

hkl

hkl

:

where the sum is taken over all observed reﬂections. The R1 is the obtained from

R1 =

(cid:16)(cid:80) F (obs)

hkl − F (calc)
(cid:80) F (obs)
hkl

hkl

(cid:17)

,

where the sum is again taken over all observed reﬂections. The quality of ﬁt can be seen by plotting F (obs)
F (calc)
hkl

as shown in Fig. S3.

hkl

20

(S5)

(S6)

against

Modelling ﬁne-sliced three dimensional electron diffraction data with dynamical Bloch-wave simulations

Figure S4: R1 calculation as a function of specimen thickness t in the dynamic model, with the nominal beam path
given by P ET S

S1.4 Dynamical R-factors as a function of thickness.

Since diffracted intensities change signiﬁcantly as a function of specimen thickness in a dynamical model, each specimen
thickness has a different R1. This is illustrated below in Figs. S4 and S5 for Bloch-wave simulations corresponding to
the nominal beam path in Fig. 4.

21

Modelling ﬁne-sliced three dimensional electron diffraction data with dynamical Bloch-wave simulations

Figure S5: R1 as a function of specimen thickness t in the dynamic model, with an optimised beam path and beam
proﬁle convolution.

S1.5 Dynamical rocking curves as a function of thickness.

The ﬁne structure of rocking curves obtained from strongly dynamical reﬂections is very sensitive to specimen thickness,
as exempliﬁed here by Si 311. The simulated rocking curves have been convoluted with the experimentally measured
beam proﬁle.

22

Modelling ﬁne-sliced three dimensional electron diffraction data with dynamical Bloch-wave simulations

Figure S6: Comparison of the experimental Si 311 rocking curve (blue) and simulations at a variety of thicknesses
(orange)

S1.6 R-factor as a function of B for optimised simulations.

R1 is sensitive to thermal vibrations of atoms in the dynamical model as shown in the plots of F (obs)
for
different values of the Debye-Waller factor B. The systematic underestimation of strong reﬂections (S1.1) may lead to
an underestimation of B.

against F (dyn)

hkl

hkl

23

Modelling ﬁne-sliced three dimensional electron diffraction data with dynamical Bloch-wave simulations

Figure S7: R1 calculations as a function of B for an optimised dynamical simulation as shown in Fig. 10. The lowest R
is found at B = 0.33

24

