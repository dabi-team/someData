Prepared for submission to JINST

Kinematic and vertex ï¬tting package for the CMD-3
experiment

ğ‘,ğ‘

ğ‘,ğ‘

A.S. Popov

S.S. Gribanov,
ğ‘Budker Institute of Nuclear Physics, SB RAS,
Prospekt Akademika Lavrentâ€™yeva, 11, Novosibirsk, 630090 Russia
ğ‘Novosibirsk State University, Physics Department,
Pirogova, 2, Novosibirsk, 630090 Russia

E-mail: S.S.Gribanov@inp.nsk.su, aspopov1@inp.nsk.su

Abstract: In this article, we discuss a new software package of kinematic and vertex ï¬tting for the
CMD-3 experiment at the VEPP-2000 electron-positron collider. The authors describe in detail the
ï¬tting algorithm, parametrization of four-momenta and trajectories of various particles, and also
present the results of testing the ï¬tting pakage using events of Monte Carlo simulation of various
ğ‘’+ğ‘’âˆ’ annihilation processes. Although the package discussed in this article is intended for the
CMD-3 experiment, it can also be used in other experiments. The authors consider the described
package as their ï¬rst step towards a more universal and rigrous kinematic and vertex ï¬tting package
that can be used in future ğ‘’+ğ‘’âˆ’ experiments, such as the Super Charm-Tau factory.

2
2
0
2

p
e
S
9
2

]
x
e
-
p
e
h
[

2
v
9
6
5
1
1
.
8
0
2
2
:
v
i
X
r
a

 
 
 
 
 
 
Contents

1

Introduction

2 Minimization algorithm

3 Hypotheses

4 Chi-square distribution
4.1 Gaussian simulation
4.2 Linear constraints
4.2.1 Case ğ‘™ = 0
4.2.2 Case ğ‘™ â‰  0
4.3 Nonlinear constraints
4.4 Chi-square in the case of Monte Carlo simulation and experimental data

5 Vertices

6 Particles
Initial pseudo-particle
6.1
6.2 Charged particles and photons
6.2.1 Charged particle
Photon
6.2.2
Intermediate particles
6.3.1
6.3.2

6.3

Intermediate neutral particle
Intermediate charged particle

6.4 Lost particles

6.4.1 Massive particle
6.4.2 Massless particle

7 Constraints

7.1 Energy-momentum conservation constraints
7.2 Mass constraint
7.3 Vertex constraints

8 Examples

8.1 Hypotheses ğ‘’+ğ‘’âˆ’ â†’ ğ‘‹ğ¾ Â±ğœ‹âˆ“, ğ‘‹ â†’ ğœ‹+ğœ‹âˆ’

8.1.1 Description of the ğ‘’+ğ‘’âˆ’ â†’ ğ‘‹ğ¾ Â±ğœ‹âˆ“, ğ‘‹ â†’ ğœ‹+ğœ‹âˆ’ hypotheses
8.1.2
8.1.3
8.1.4

Fitting procedure details
Fitting the ğ‘’+ğ‘’âˆ’ â†’ ğ¾ğ‘†ğ¾ Â±ğœ‹âˆ“ events
Fitting the ğ‘’+ğ‘’âˆ’ â†’ ğœ‹+ğœ‹âˆ’ğœ‹+ğœ‹âˆ’ events
8.2 Hypotheses ğ‘’+ğ‘’âˆ’ â†’ ğ¾ğ‘†ğ¾ Â±ğœ‹âˆ“, ğ¾ğ‘† â†’ ğœ‹+ğœ‹âˆ’

8.2.1 Description of the ğ‘’+ğ‘’âˆ’ â†’ ğ¾ğ‘†ğ¾ Â±ğœ‹âˆ“ hypotheses

â€“ i â€“

2

3

6

7
7
8
10
11
12
12

13

14
14
15
15
16
17
17
18
19
20
20

20
21
23
24

25
25
25
26
27
34
37
37

8.2.2

8.2.3

Fitting the ğ‘’+ğ‘’âˆ’ â†’ ğ¾ğ‘†ğ¾ Â±ğœ‹âˆ“ events
Fitting the ğ‘’+ğ‘’âˆ’ â†’ ğœ‹+ğœ‹âˆ’ğœ‹+ğœ‹âˆ’ events

8.3 Hypothesis ğ‘’+ğ‘’âˆ’ â†’ ğœ‹+ğœ‹âˆ’ğœ‹+ğœ‹âˆ’

8.3.1 Description of the ğ‘’+ğ‘’âˆ’ â†’ ğœ‹+ğœ‹âˆ’ğœ‹+ğœ‹âˆ’ hypothesis
8.3.2

Fitting procedure details
Fitting the ğ‘’+ğ‘’âˆ’ â†’ ğœ‹+ğœ‹âˆ’ğœ‹+ğœ‹âˆ’ events
Fitting the ğ‘’+ğ‘’âˆ’ â†’ ğ¾ğ‘†ğ¾ Â±ğœ‹âˆ“ events

8.3.3

8.3.4

8.4 Hypothesis ğ‘’+ğ‘’âˆ’ â†’ ğ›¾ğ›¾ğ›¾

8.4.1 Description of the ğ‘’+ğ‘’âˆ’ â†’ ğ›¾ğ›¾ğ›¾ hypothesis
8.4.2

Fitting the ğ‘’+ğ‘’âˆ’ â†’ ğœ‹0ğ›¾ events

8.5 Hypothesis ğ‘’+ğ‘’âˆ’ â†’ ğœ‹+ğœ‹âˆ’ğ›¾ğ›¾

8.5.1 Description of the ğ‘’+ğ‘’âˆ’ â†’ ğœ‹+ğœ‹âˆ’ğ›¾ğ›¾ hypothesis
8.5.2

Fitting the ğ‘’+ğ‘’âˆ’ â†’ ğœ‚ğœ‹+ğœ‹âˆ’, ğœ‚ â†’ ğ›¾ğ›¾ events

8.6 Hypothesis ğ‘’+ğ‘’âˆ’ â†’ ğœ‹+ğœ‹âˆ’ğ›¾ğ›¾lost
8.7 Hypothesis ğ‘’+ğ‘’âˆ’ â†’ ğœ‹+ğœ‹âˆ’ğœ‹+ğœ‹âˆ’ğœ‹0

lost

8.7.1 Description of the ğ‘’+ğ‘’âˆ’ â†’ ğœ‹+ğœ‹âˆ’ğœ‹+ğœ‹âˆ’ğœ‹0
8.7.2

Fitting procedure details
Fitting the ğ‘’+ğ‘’âˆ’ â†’ ğœ‚ğœ‹+ğœ‹âˆ’, ğœ‚ â†’ ğœ‹+ğœ‹âˆ’ğœ‹0 events

8.7.3

lost hypothesis

8.8 Hypothesis ğ‘’+ğ‘’âˆ’ â†’ ğœ‚ğœ‹+ğœ‹âˆ’, ğœ‚ â†’ ğœ‹+ğœ‹âˆ’ğœ‹0

lost

8.8.1 Description of the ğ‘’+ğ‘’âˆ’ â†’ ğœ‚ğœ‹+ğœ‹âˆ’, ğœ‚ â†’ ğœ‹+ğœ‹âˆ’ğœ‹0
8.8.2

Fitting procedure details
Fitting the ğ‘’+ğ‘’âˆ’ â†’ ğœ‚ğœ‹+ğœ‹âˆ’, ğœ‚ â†’ ğœ‹+ğœ‹âˆ’ğœ‹0 events

8.8.3

lost hypothesis

8.9 Hypothesis ğ‘’+ğ‘’âˆ’ â†’ ğ‘‹ ğ‘‹ ğœ‹+ğœ‹âˆ’, ğ‘‹ â†’ ğœ‹+ğœ‹âˆ’

8.9.1 Description of the ğ‘’+ğ‘’âˆ’ â†’ ğ‘‹ ğ‘‹ ğœ‹+ğœ‹âˆ’, ğ‘‹ â†’ ğœ‹+ğœ‹âˆ’ hypothesis
8.9.2

Fitting procedure details
Fitting the ğ‘’+ğ‘’âˆ’ â†’ ğ¾ğ‘†ğ¾ğ‘† ğœ‹+ğœ‹âˆ’, ğ¾ğ‘† â†’ ğœ‹+ğœ‹âˆ’ events

8.9.3

9 Examples of Gaussian simulation
9.1 Hypothesis ğ‘’+ğ‘’âˆ’ â†’ ğœ‹+ğœ‹âˆ’ğ›¾ğ›¾
9.2 Hypotheses ğ‘’+ğ‘’âˆ’ â†’ ğ‘‹ğ¾ Â±ğœ‹âˆ“, ğ‘‹ â†’ ğœ‹+ğœ‹âˆ’

10 Fitting package

11 Summary

12 Acknowledgments

â€“ 1 â€“

38

39

40

40

41

41

42

43

43

43

47

47

47

48

50

50

50

50

52

52

52

52

54

54

54

55

57

57

59

64

64

65

1

Introduction

Kinematic and vertex ï¬tting is widely used data analysis technique in particle physics experi-
ments [1â€“9]. This technique can be used in order to separate events corresponding to diï¬€erent
kinematic hypotheses and to restore interaction and decay vertices.
In addition, the use of this
technique often leads to signiï¬cant improvements in resolution of some quantities, such as various
invariant masses. This paper describes kinematic and vertex ï¬tting package developed for the
CMD-3 experiment [10, 11] located at the VEPP-2000 electron-positron collider [12, 13]. The
discussed package is currently actively used in the study of a number of processes with the CMD-3
detector. This package can also be used in other similar experiments. To do this, it is necessary to
make a number of experiment-dependent changes related to the format of input data and probably
to some particle parametrizations. The authors believe that it is quite easy to do, since the discussed
package is divided into detector-dependent and detector-independent parts.

In general, any kinematic and vertex ï¬tting algorithm consists in constrained minimization of

the chi-square function:

ğœ’2(ğ’™) = ğš«ğ’™(cid:124) Ë†ğ¶âˆ’1ğš«ğ’™,

ğš«ğ’™ = ğ’™ âˆ’ Ëœğ’™

(1.1)

where ğ’™ âˆˆ Rğ‘› is the vector of the optimization variables corresponding to measurable parameters,
i.e. such parameters that can be measured in an experiment. The natural number ğ‘› is the number
of such parameters, the vector Ëœğ’™ is the vector of these parameters, measured in a single event.
The matrix Ë†ğ¶ is the corresponding covariance matrix, obtained in the same event. The parameters
measured by a detector are usually refer to one particle or another. Moreover, usually the parameters
corresponding to diï¬€erent particles are measured independently. With these assumptions in mind,
the chi-square from equation (1.1) can be written as

ğ‘ğ‘
âˆ‘ï¸

ğœ’2(ğ’™) =

ğš«ğ’™ (ğ’Š) (cid:124) Ë†ğ¶ (ğ‘–) âˆ’1

ğš«ğ’™ (ğ’Š) ,

ğ‘–=1
ğš«ğ’™ (ğ’Š) = ğ’™ (ğ’Š) âˆ’ Ëœğ’™ (ğ’Š) ,

ğ’™ = ğ’™ (1) âŠ• ğ’™ (2) âŠ• . . . âŠ• ğ’™ (ğ‘µğ’‘) ,
Ëœğ’™ = Ëœğ’™ (1) âŠ• Ëœğ’™ (2) âŠ• . . . âŠ• Ëœğ’™ (ğ‘µğ’‘) ,
Ë†ğ¶ = Ë†ğ¶ (1) âŠ• Ë†ğ¶ (2) âŠ• . . . âŠ• Ë†ğ¶ ( ğ‘ğ‘) ,

(1.2)

where ğ‘– is the particle index, ğ‘ ğ‘ is the number of particles in a hypothesis, ğ’™ (ğ’Š) is the vector of the
optimization variables corresponding to measurable parameters of the ğ‘–-th particle. The vector Ëœğ’™ (ğ’Š)
Ë†ğ¶ (ğ‘–) is the corresponding covariance
is the vector of these parameters, measured in a single event.
matrix. The notation ğ’™ (ğ’Š) âŠ• ğ’™ (ğ’‹) means the concatenation of the vectors ğ’™ (ğ’Š) and ğ’™ (ğ’‹) , while the
notation Ë†ğ¶ (ğ‘–) âŠ• Ë†ğ¶ ( ğ‘—) means the direct sum of the matrices Ë†ğ¶ (ğ‘–) and Ë†ğ¶ ( ğ‘—) .

In the case of kinematic and vertex ï¬tting, equality constraints are commonly used. These

constraints have the following form:

ğ‘“ğ‘˜ ( ğ’š) = 0, ğ‘˜ = 1, 2, . . . , ğ‘š,

ğ’š = ğ’™ âŠ• ğ’‚,

(1.3)

â€“ 2 â€“

where ğ‘˜ is the constraint index, ğ‘“ğ‘˜ is the ğ‘˜-th constraint function, ğ‘š is the number of constraints
in a hypothesis, ğ’‚ âˆˆ Rğ‘™ is the vector of non-measurable optimization parameters, ğ‘™ is the number
of these parameters. In this article we mean, that non-measurable parameters are those parameters
that cannot be measured experimentally, but can be obtained as result of ï¬tting. There is a
number of such parameters: momentum components of a lost particle, time parameter of a charged
particle trajectory (track), vertex coordinates, and some other parameters. Some examples of
non-measurable parameters are given in sections 5 and 6.

Taking into account the chi-square function (1.1) or (1.2) and the equality constraints (1.3),
one can formulate the following problem for ï¬nding the conditional extremum of the chi-square
function:

(cid:40)ğœ’2(ğ’™) â†’ extremum,
ğ‘“ğ‘˜ ( ğ’š) = 0, ğ‘˜ = 1, 2, . . . , ğ‘š.

(1.4)

It is important to note that the initial values of the measurable parameters ğ’™ should be set equal to
their measured values Ëœğ’™. In this case, the minimization algorithm starts from the lowest point of
the chi-square hyperparabaloid, which increases the probability that the ï¬t will converge to a global
minimum. The criterion that the found extremum is a local minimum and not a local maximum is
discussed in section 2.

2 Minimization algorithm

In this work the well-known method of Lagrange multipliers [14â€“16] is used in order to reduce the
problem of constrained optimization to the unconstrained one. The method of Lagrange multipliers
is based on the concept of the Lagrange function. In the context of the problem (1.4) this function
has the following form:

L (ğ’š, ğ€) = ğœ’2(ğ’™) +

ğ‘š
âˆ‘ï¸

ğ‘˜=1

ğœ†ğ‘˜ ğ‘“ğ‘˜ (ğ’š), ğ€ =

,

ğœ†1
ï£®
ï£¯
ğœ†2
ï£¯
ï£¯
...
ï£¯
ï£¯
ï£¯
ï£¯
ğœ†ğ‘š
ï£¯
ï£°

ï£¹
ï£º
ï£º
ï£º
ï£º
ï£º
ï£º
ï£º
ï£º
ï£»

(2.1)

where variables ğœ†1, ğœ†2, . . . , ğœ†ğ‘š are the Lagrange multipliers. Taking into the account the Lagrange
function, the necessary condition for the existence of an extremum in the problem (1.4) can be
formulated using the following theorem [14].

Theorem 2.1 (necessary condition). If ğ’š(cid:48) âˆˆ Î© â‰¡ {ğ’š âˆˆ Rğ‘›+ğ‘™ | ğ‘“ğ‘˜ (ğ’š) = 0, ğ‘˜ = 1, 2, . . . , ğ‘š} is a
conditional extremum point of the problem (1.4), then there is a nonzero vector ğ€(cid:48) âˆˆ Rğ‘š such that

âˆ‡ğ’š L ( ğ’š, ğ€(cid:48))|ğ’š=ğ’š(cid:48) = 0.

(2.2)

In order to determine whether the found extremum is a local minimum or a local maximum, it

is necessary to formulate a suï¬ƒcient conditions for an extremum [14].

â€“ 3 â€“

Theorem 2.2 (suï¬ƒcient conditions). Let ğ’š(cid:48) âˆˆ Î© and there is a vector ğ€(cid:48), such that âˆ‡ğ’š L ( ğ’š, ğ€(cid:48))|ğ’š=ğ’š(cid:48) =
0. If for any vector ğ’…ğ’š âˆˆ Rğ‘›+ğ‘™, ğ’…ğ’š â‰  0 that satisï¬es the conditions âˆ‡ğ’š ğ‘“ğ‘˜ ( ğ’š)|ğ’š=ğ’š(cid:48) Â· ğ’…ğ’š = 0, ğ‘˜ =
1, 2, . . . , ğ‘š, the following inequality holds

ğ‘›+ğ‘™
âˆ‘ï¸

ğ‘›+ğ‘™
âˆ‘ï¸

ğ‘–=1

ğ‘—=1

ğœ•2L (ğ’š, ğ€(cid:48))
ğœ•ğ‘¦ğ‘–ğœ•ğ‘¦ ğ‘—

(cid:12)
(cid:12)
(cid:12)ğ’š=ğ’š(cid:48)

ğ‘‘ğ‘¦ğ‘– ğ‘‘ğ‘¦ ğ‘— > 0,

(2.3)

then the strict local minimum of the function ğœ’2 on the set Î© is reached at the point ğ’š = ğ’š(cid:48). If the
following inequality holds

ğ‘›+ğ‘™
âˆ‘ï¸

ğ‘›+ğ‘™
âˆ‘ï¸

ğ‘–=1

ğ‘—=1

ğœ•2L (ğ’š, ğ€(cid:48))
ğœ•ğ‘¦ğ‘–ğœ•ğ‘¦ ğ‘—

(cid:12)
(cid:12)
(cid:12)ğ’š=ğ’š(cid:48)

ğ‘‘ğ‘¦ğ‘– ğ‘‘ğ‘¦ ğ‘— < 0,

(2.4)

then the strict local maximum is reached at the point ğ’š = ğ’š(cid:48).

Thus, in order to ï¬nd the conditional minimum of the ğœ’2 function (1.2), one should follow the
algorithm below. First of all, we need to compose the Lagrange function according equation (2.1).
Then we need to use the necessary condition for the existence of an extremum (theorem 2.1), i.e.
solve the following system of equations:

(cid:40)âˆ‡ğ’š L ( ğ’š, ğ€) = 0,
ğ‘“ğ‘˜ ( ğ’š) = 0, ğ‘˜ = 1, 2, . . . , ğ‘š.

(2.5)

Let us note that the system of equations (2.5) can be rewritten in a form that is more convenient for
the further use:

âˆ‡ğ’’L (ğ’š, ğ€) = 0,

ğ’’ = ğ’š âŠ• ğ€,

(2.6)

where ğ’’ is the vector of all parameters involved in the constrained chi-square minimization, including
the Lagrange multipliers. Suppose that as a result of solving the system of equations (2.6), a pair
of vectors is obtained: ğ’š = ğ’š(cid:48) and ğ€ = ğ€(cid:48). This pair of vectors corresponds to a conditional
local extremum of the chi-square function. Finally, it is necessary to check whether this pair of
vectors corresponds to a local minimum or to a local maximum point. To do this, we can use
inequalities (2.3) and (2.4).

To solve the system of equations (2.6), the package discussed in this paper uses the well-known

Newtonâ€™s method [17â€“19]. This method is based on the following iterative approach:

ğ’’ğ‘  = ğ’’ğ‘ âˆ’1 âˆ’ Ë†H âˆ’1(ğ’’ğ‘ âˆ’1)âˆ‡ğ’’L ( ğ’šğ‘ âˆ’1, ğ€ğ‘ âˆ’1), ğ‘  = 1, 2, . . . ,

(2.7)

where ğ’’ğ‘  = ğ’™ğ‘  âŠ• ğ’‚ğ‘  âŠ• ğ€ğ‘  is the vector of optimization parameters at the ğ‘ -th step of the iterative
Ë†H (ğ’’ğ‘ âˆ’1) is the Hessian of the
procedure, ğ’’0 = ğ’™0 âŠ• ğ’‚0 âŠ• ğ€0 is the vector of their initial values,
Lagrange function with respect to the variables ğ’’, and âˆ‡ğ’’L (ğ’šğ‘ âˆ’1, ğ€ğ‘ âˆ’1) is its gradient calculated
at the point ğ’’ğ‘ âˆ’1. The vector ğ’šğ‘ âˆ’1 is the concatenation of the vectors of measurable ğ’™ğ‘ âˆ’1 and non-
measurable ğ’‚ğ‘ âˆ’1 parameters at the (ğ‘  âˆ’ 1)-th step of the optimization algorithm: ğ’šğ‘ âˆ’1 = ğ’™ğ‘ âˆ’1 âŠ• ğ’‚ğ‘ âˆ’1.
The initial values ğ’™0 of the measurable parameters ğ’™ are set equal to their measured values Ëœğ’™. The

â€“ 4 â€“

initial values ğ€0 of the Lagrange multipliers are set to zero. The initial values ğ’‚0 of the non-
measurable parameters can optionally be set to custom values.

It is easy to see that the Hessian Ë†H (ğ’’ğ‘ âˆ’1) of the Lagrange function has the following form:

Ë†H (ğ’’ğ‘ âˆ’1) =

(cid:34)

2 Ë†ğ‘€ + Ë†ğ‘„ğ‘ âˆ’1
Ë†ğ½ (cid:124)
ğ‘ âˆ’1

Ë†ğ½ğ‘ âˆ’1
0ğ‘šÃ—ğ‘š

(cid:35)

,

Ë†ğ‘€ = Ë†ğ¶âˆ’1 âŠ• 0ğ‘™Ã—ğ‘™,

(2.8)

where 0ğ‘šÃ—ğ‘š and 0ğ‘™Ã—ğ‘™ are ğ‘š by ğ‘š and ğ‘™ by ğ‘™ zero matrices, respectively; Ë†ğ‘„ğ‘ âˆ’1 is the matrix containing
the Hessians of the constraint functions with respect to the ğ’š variables. Let us denote the Hessian
of the ğ‘˜-th constraint function calculated at the point ğ’šğ‘ âˆ’1 as Ë†ğ‘„ (ğ‘˜)
ğ‘ âˆ’1. In these notations, the matrix
Ë†ğ‘„ğ‘ âˆ’1 has the following form:

Ë†ğ‘„ğ‘ âˆ’1 =

ğœ†ğ‘˜,ğ‘ âˆ’1 Ë†ğ‘„ (ğ‘˜)
ğ‘ âˆ’1

,

(2.9)

ğ‘š
âˆ‘ï¸

ğ‘˜=1

where ğœ†ğ‘˜,ğ‘ âˆ’1 is the value of the ğ‘˜-th Lagrange multiplier at the (ğ‘  âˆ’ 1)-th step of the iterative
ğœ•( ğ‘“1,..., ğ‘“ğ‘š)
procedure given by equation (2.7). The matrix Ë†ğ½ğ‘ âˆ’1 in equation (2.8) is the Jacobian
ğœ•( ğ‘¦1,...,ğ‘¦(ğ‘›+ğ‘™) )
of the constraint functions with respect to the variables ğ’š. This Jacobian is also calculated at the
point ğ’šğ‘ âˆ’1.

It should be noted that constraints (1.3) do not explicitly depend on the parameters of particles
and vertices. The constraint functions usually explicitly depend only on parametrizations of the
particle four-momenta and trajectories (see section 6), as well as the vertex parametrization (see
section 5). In this case, it is convenient to use the chain rule to obtain partial derivatives of the
constraints:

ğœ• ğ‘“ğ‘˜ (ğ‘”1(ğ’š), . . . , ğ‘”ğ‘ğ‘” (ğ’š))
ğœ•ğ‘¦ğ‘–

=

ğœ• ğ‘“ğ‘˜
ğœ•ğ‘” ğ‘—

ğœ•ğ‘” ğ‘—
ğœ•ğ‘¦ğ‘–

,

(2.10)

where ğ‘” ğ‘— is a function of some parametrization, ğ‘ğ‘” is the number of such functions, the repeated
index ğ‘— is summed up. Using a chain rule in the ï¬tting package makes it possible to implement
constraint, particle, and vertex classes independently. Thus, for example, adding a new particle
class to the package will not change the implementation of the constraints, and vice versa.

In the case of the package discussed in this paper, the procedure given by equation (2.7)

continues until one of the following conditions is met:

1.

| ğœ’2(ğ’™ğ‘ ) âˆ’ ğœ’2(ğ’™ğ‘ âˆ’1)| < ğœ€ and ğ›¿( ğ’šğ‘ ) < ğœ€, where ğ›¿( ğ’šğ‘ ) =
some tolerance;

ğ‘š
(cid:205)
ğ‘˜=1

| ğ‘“ğ‘˜ ( ğ’šğ‘ )| is the residual and ğœ€ is

2. ğ‘  > ğ‘iter, where ğ‘  is the step number of the iterative procedure given by equation (2.7) and

ğ‘iter is the maximum number of iterations.

If the ï¬rst condition (1) is met, then the ï¬t has converged to a local extremum.
If the second
condition (2) is met, then the ï¬t has not converged. The default tolerance ğœ€ and maximum number
of iterations ğ‘iter used in the ï¬tting package are equal to 10âˆ’4 and 20, respectively. These values can
be easily adjusted if desired. Although the default value for the maximum number of iterations is
equal to 20, it should be noted that the optimization algorithm usually converges in fewer iterations.
For example, in the case of ï¬tting the events of the ğ‘’+ğ‘’âˆ’ â†’ ğ¾ğ‘†ğ¾ Â±ğœ‹âˆ“, ğ¾ğ‘† â†’ ğœ‹+ğœ‹âˆ’ process under

â€“ 5 â€“

the corresponding signal hypothesis (see sections 3 and 8.2.2), the optimization algorithm most
often converges in three iterations. At the same time, in about 93% of all events, the algorithm
In the case of ï¬tting the events of the ğ‘’+ğ‘’âˆ’ â†’ ğœ‚ğœ‹+ğœ‹âˆ’, ğœ‚ â†’ ğ›¾ğ›¾
converges in 2â€“6 iterations.
process (see section 8.5.2), the algorithm most often converges in two iterations. In about 98% of
the ğ‘’+ğ‘’âˆ’ â†’ ğœ‚ğœ‹+ğœ‹âˆ’, ğœ‚ â†’ ğ›¾ğ›¾ events, the algorithm converges in 2â€“4 iterations.

It should be noted that in the implementation of the optimization algorithm, special attention
is paid to periodic measurable parameters. If, during optimization, such a parameter goes beyond
the period boundaries, then the corresponding contribution to the chi-square becomes incorrect
because the measured value of this parameter is within the period. Therefore, after each iteration,
if the parameter goes beyond the period boundaries, then it is returned back using a shift by an
integer number of periods. Since it is assumed that it does not matter for the constraint functions
whether the parameter is inside the period or not, the parameter values before and after the shift are
equivalent.

Another important feature of the ï¬tting package is the ability to use upper and lower limits
for parameters. In the current version of the package, if the parameter is out of range, it returns to
its initial value, after which the optimization algorithm continues. Thus, the values of individual
parameters can be limited. However, it may well be necessary to limit the values of some function,
i.e. use inequality constraints [17, 20, 21]. This feature is planned to be added during the further
development of the ï¬tting package.

The ï¬tting package provides an interface for ï¬xing and releasing parameters. Fixing a parameter
means that this parameter does not change during the execution of the optimization algorithm. This
can be achieved in the following way.
In the Hessian (2.8), all oï¬€-diagonal elements of rows
and columns corresponding to a ï¬xed parameter are set to zero. At the same time, the diagonal
element of the Hessian corresponding to this parameter must be set equal to one. The component
of the Lagrange function gradient corresponding to a ï¬xed parameter must be set to zero (see
equation (2.7)). It is this approach to ï¬xing parameters that is used in the considered ï¬tting package.
However, it should be noted that this approach is not unique. For instance, ï¬xed parameters can
be excluded programmatically, i.e. one can consider the Hessian with respect to free parameters
only. Both approaches are equivalent, but the latter approach makes it possible to reduce the size
of the Hessian matrix. With the further development of the ï¬ttings package, it is planned to switch
to using this mechanism for ï¬xing parameters.

The ï¬tting package also provides an interface for enabling and disabling constraints. This
feature is coming very useful when it is necessary to perform a ï¬t in several hypotheses (see
section 3) that diï¬€er from each other only in the set of constraints.

3 Hypotheses

Further, in this work the term hypothesis is often used. By hypothesis we mean a set of all particles,
vertices and constraints involved in the constrained chi-square minimization. The hypothesis also
depends on the state of particles and vertices, since some parameters of these entities can be ï¬xed.
The ï¬tting package discussed in this paper has special classes responsible for describing these
hypotheses. Further, for simplicity, we name the hypotheses according to the particles they contain,
for example, as ğ‘’+ğ‘’âˆ’ â†’ ğ›¾ğ›¾ğ›¾. One has to distinguish a hypothesis from a process, since the same

â€“ 6 â€“

notation is used for both of them. The text of the paper always notes whether the reader is dealing
with the notation of a hypothesis or a process.

The paper also often uses the terms signal and background hypothesis. A hypothesis is called
a signal hypothesis for some process if it describes this process. Otherwise, the hypothesis is
a background hypothesis. There may be several signal hypotheses for some processes. Such
hypotheses can diï¬€er from each other, for example, by the set of constraints, as well as by the
presence or absence of lost particles. To show this, let us consider the ğ‘’+ğ‘’âˆ’ â†’ ğœ‚ğœ‹+ğœ‹âˆ’, ğœ‚ â†’ ğ›¾ğ›¾
process. Since the ï¬nal state of this process contains two charged pions and two photons, then
hypothesis ğ‘’+ğ‘’âˆ’ â†’ ğœ‹+ğœ‹âˆ’ğ›¾ğ›¾ is a signal hypothesis for this process. Another signal hypothesis is
ğ‘’+ğ‘’âˆ’ â†’ ğœ‚ğœ‹+ğœ‹âˆ’, ğœ‚ â†’ ğ›¾ğ›¾. This hypothesis takes into account the intermediate particle ğœ‚. This
particle can be taken into account using the constraint on the two-photon invariant mass.

It should be noted that some of the hypotheses discussed in the article contain a particle denoted
by the letter ğ‘‹. It is important to keep in mind that this designation is used for a neutral intermediate
particle of unknown mass. An example of such a hypothesis is ğ‘’+ğ‘’âˆ’ â†’ ğ‘‹ğ¾ +ğœ‹âˆ’, ğ‘‹ â†’ ğœ‹+ğœ‹âˆ’,
which is a signal hypothesis for the ğ‘’+ğ‘’âˆ’ â†’ ğ¾ğ‘†ğ¾ +ğœ‹âˆ’, ğ¾ğ‘† â†’ ğœ‹+ğœ‹âˆ’ process.

4 Chi-square distribution

4.1 Gaussian simulation

Consider a single event of some process. Let us assume that the exact measurable parameters ğğ’™
of the particles are known in this event. A single measurement of these parameters gives a vector
of measured parameters Ëœğ’™, which has a random nature. Further, we suppose that Ëœğ’™ âˆ¼ N ( ğğ’™, Ë†ğ¶),
where Ë†ğ¶ is the corresponding covariance matrix. Using this multivariate normal distribution, it is
possible to generate a number of events similar to the initial one, but corresponding to diï¬€erent
outcomes of the random vector Ëœğ’™. For each of these events, one can perform the procedure of
kinematic and vertex ï¬tting according to the algorithm 2. This sequence of steps is necessary to
obtain the chi-square ğœ’2(ğ’™ (cid:48)) = (ğ’™ (cid:48) âˆ’ Ëœğ’™)(cid:124) Ë†ğ¶âˆ’1 (ğ’™ (cid:48) âˆ’ Ëœğ’™) distribution at the local minimum points
ğ’™ (cid:48) found using the ï¬tting procedure. The ï¬rst question is whether this distribution will match
the well-known chi-square distribution from statistics. Let us remind that the probability density
function (PDF) for the latter distribution has the following form:

ğ‘“ğœ’2 (ğ‘¡; ğ‘˜) =

ğ‘¡ ğ‘˜/2âˆ’1ğ‘’âˆ’ğ‘¡/2, ğ‘¡ > 0;

1
2ğ‘˜/2Î“(ğ‘˜/2)
0, otherwise,

ï£±ï£´ï£²
ï£´
ï£³

(4.1)

where the variable ğ‘˜ has the meaning of the number degrees of freedom (NDF), and the variable
ğ‘¡ has the meaning of the chi-square value. If the chi-square ğœ’2(ğ’™ (cid:48)) distribution at the output of
the ï¬tting procedure matches the distribution (4.1) under certain conditions, then a second question
arises. The question is what number of degrees of freedom corresponds to this distribution.

However, it should be noted that the exact values ğğ’™ of the measurable particle parameters
are unknown in experimental and Monte Carlo simulation1 events. Therefore, in order to follow

1Further, by Monte Carlo simulation we understand the simulation of events of any ğ‘’+ğ‘’âˆ’ annihilation process, taking
into account the response of a detector. We assume that in this simulation we are interested in particles reconstructed using
this response. It should be noted that the exact particle parameters can be known from a primary generator. However, it
is not always a trivial task to compare the particles from the primary generator with the reconstructed particles.

â€“ 7 â€“

the sequence of steps from the previous paragraph and obtain the distribution of ğœ’2(ğ’™ (cid:48)), a little
trick is needed. The exact particle parameters ğğ’™ correspond to the situation when all conservation
constraints are satisï¬ed. Suppose that in the initial event only the vector of measured parameters
Ëœğ’™ and the covariance matrix Ë†ğ¶ are known. This event can be ï¬tted according to algorithm 4.1
under the signal hypothesis. As a result of this ï¬tting, one can obtain a point ğ’™ (cid:48) of the chi-square
conditional minimum. This point satisï¬es the constraints by deï¬nition. However, it should be
noted that the vector ğ’™ (cid:48) has a random nature (sine it depends on the random vector Ëœğ’™) and does not
coincide exactly with the vector ğğ’™. In any case, one can forget about the previous initial event,
and consider a new initial event with exactly known vector ğğ’™ = ğ’™ (cid:48). With the last event, one can
perform the sequence of steps from the ï¬rst paragraph and obtain the desired ğœ’2(ğ’™ (cid:48)) distribution.
The procedure described in this paragraph and the previous one is further referred to as Gaussian
simulation.

4.2 Linear constraints

Let us ï¬rst consider the case where all constraints are linear. Suppose that these constraints have
the following form:

(4.2)
ğœ•( ğ‘“1,..., ğ‘“ğ‘š)
ğœ•( ğ‘¦1,...,ğ‘¦(ğ‘›+ğ‘™) ) is the Jacobian of constraint functions, ğ’— is some vector, dim ğ’— = ğ‘š. The

Ë†ğ½ ğ’š + ğ’— = 0,

where Ë†ğ½ =
Lagrange function in this case has the form:

L ( ğ’š, ğ€) = (ğ’™ âˆ’ Ëœğ’™)(cid:124) Ë†ğ¶âˆ’1 (ğ’™ âˆ’ Ëœğ’™) + ğ€(cid:124) (cid:0) Ë†ğ½ ğ’š + ğ’—(cid:1) ,

ğ’š = ğ’™ âŠ• ğ’‚.

(4.3)

After substituting the Lagrange function 4.3 into equation (2.6), this equation will be reduced to the
following system of linear equations2:

(cid:35)

(cid:34)

2 Ë†ğ‘€ Ë†ğ½ (cid:124)
Ë†ğ½ 0ğ‘šÃ—ğ‘š

Î”ğ’’ = âˆ’Î”ğ’ˆ,

(4.4)

where Ë†ğ‘€ = Ë†ğ¶âˆ’1 âŠ• 0ğ‘™Ã—ğ‘™, Î”ğ’’ = Î”ğ’š âŠ• Î”ğ€, Î”ğ’š = ğ’š âˆ’ Ëœğ’š, Î”ğ€ = ğ€ âˆ’ 0 = ğ€. 0ğ‘šÃ—ğ‘š and 0ğ‘™Ã—ğ‘™ are zero ğ‘š by ğ‘š
and ğ‘™ by ğ‘™ zero matrices, respectively. The vector Ëœğ’š = Ëœğ’™ âŠ• Ëœğ’‚ has the meaning of the vector of initial
values of the parameters ğ’š. As discussed above, the vector Ëœğ’™ at the same time has the meaning of
the measured values of the parameters ğ’™. Vector Î”ğ’ˆ can be written in the following form:

ï£®
ï£¯
ï£¯
ï£¯
ï£¯
ï£¯
ï£¯
ï£¯
ï£¯
ï£¯
ï£¯
ï£¯
ï£¯
ï£¯
ï£¯
ï£¯
ï£°
2Thus, within the framework of the iterative algorithm given by equation (2.7), the optimization problem (1.4) is

0
...
0
ğ‘“1( Ëœğ’š)
ğ‘“2( Ëœğ’š)
...
ğ‘“ğ‘š( Ëœğ’š)

0
ï£®
ï£¯
...
ï£¯
ï£¯
ï£¯
ï£¯
0
ï£¯
Î” ğ‘“1
ï£¯
ï£¯
ï£¯
Î” ğ‘“2
ï£¯
...
ï£¯
ï£¯
ï£¯
ï£¯
Î” ğ‘“ğ‘š
ï£¯
ï£°

Î”ğ’ˆ = âˆ‡ğ’’L ( Ëœğ’š, 0) =

ï£¹
ï£º
ï£º
ï£º
ï£º
ï£º
ï£º
ï£º
ï£º
ï£º
ï£º
ï£º
ï£º
ï£º
ï£º
ï£º
ï£»

ï£¹
ï£º
ï£º
ï£º
ï£º
ï£º
ï£º
ï£º
ï£º
ï£º
ï£º
ï£º
ï£º
ï£º
ï£º
ï£º
ï£»

(4.5)

â‰¡

,

solved in one iteration in the case of linear constraints.

â€“ 8 â€“

where Î” ğ‘“ğ‘˜ = ğ‘“ğ‘˜ ( Ëœğ’š) âˆ’ ğ‘“ğ‘˜ ( ğ’š(cid:48)) = ğ‘“ğ‘˜ ( Ëœğ’š), ğ‘“ğ‘˜ ( ğ’š(cid:48)) = 0, ğ’š(cid:48) is the local extremum point.

Note that the matrix of the system of equations (4.4) is non-singular only if rank( Ë†ğ½) = ğ‘š. If
the last equality is not satisï¬ed, then linearly dependent rows and columns appear in the matrix of
the system of linear equations (4.4), i.e. this matrix becomes degenerate. Note that the condition
rank( Ë†ğ½) = ğ‘š must also hold in the nonlinear case, otherwise the Hessian (2.8) is degenerate. Thus,
it makes sense to consider only functionally independent constraints (rank( Ë†ğ½) = ğ‘š). In addition, it is
easy to show that the inequality ğ‘› + ğ‘™ â‰¥ ğ‘š must also hold, otherwise the constraints are functionally
dependent: rank( Ë†ğ½) â‰¤ min(ğ‘› + ğ‘™, ğ‘š) = ğ‘› + ğ‘™ < ğ‘š.

Let us represent the Jacobian as the concatenation of two matrices: Ë†ğ½ =
ğœ•( ğ‘“1,..., ğ‘“ğ‘š)
ğœ•( ğ‘¥1,..., ğ‘¥ğ‘›) is the Jacobian of the constraint functions with respect to the parameters ğ’™, and the
ğœ•( ğ‘“1,..., ğ‘“ğ‘š)
ğœ•(ğ‘1,...,ğ‘ğ‘™) is the Jacobian of these functions with respect to the parameters ğ’‚. Taking

Ë†ğ½ğ’™ =
matrix Ë†ğ½ğ’‚ =
into account this form of the Jacobian, the system of equations (4.4) can be rewritten as follows:

. The matrix

Ë†ğ½ğ’™ Ë†ğ½ğ’‚

(cid:104)

(cid:105)

Ë†ğ½ (cid:124)
ğ’™
Ë†ğ½ (cid:124)
ğ’‚

2 Ë†ğ¶âˆ’1 0ğ‘›Ã—ğ‘™
ï£®
ï£¯
0ğ‘™Ã—ğ‘›
ï£¯
ï£¯
ï£¯
Ë†ğ½ğ’™
ï£¯
ï£°

0ğ‘™Ã—ğ‘™
Ë†ğ½ğ’‚ 0ğ‘šÃ—ğ‘š

Î”ğ’’ = âˆ’Î”ğ’ˆ.

(4.6)

ï£¹
ï£º
ï£º
ï£º
ï£º
ï£º
ï£»

It can be seen from the last system of linear equations that rank( Ë†ğ½ğ’‚) = ğ‘™, otherwise the matrix
It is also seen that the inequality ğ‘™ â‰¤ ğ‘š must be satisï¬ed, since
of this system is degenerate.
min(ğ‘š, ğ‘™) â‰¥ rank( Ë†ğ½ğ’‚) = ğ‘™.

Equation (4.6) can be easily solved by inverting the corresponding block matrix. To do this,

one can use the well-known Forbenius formula [22] for block matrix inversion:

Ë†ğ´âˆ’1 =

(cid:35) âˆ’1

(cid:34) Ë†ğµ Ë†ğ¶
Ë†ğ· Ë†ğ¹

=

(cid:34) Ë†ğµâˆ’1 + Ë†ğµâˆ’1 Ë†ğ¶ Ë†ğºâˆ’1 Ë†ğ· Ë†ğµâˆ’1 âˆ’ Ë†ğµâˆ’1 Ë†ğ¶ Ë†ğºâˆ’1

(cid:35)

âˆ’ Ë†ğºâˆ’1 Ë†ğ· Ë†ğµâˆ’1

Ë†ğºâˆ’1

,

(4.7)

where Ë†ğµ is a ğ‘›1 Ã— ğ‘›1 non-singular matrix, Ë†ğ¹ is a ğ‘›2 Ã— ğ‘›2 matrix, and Ë†ğº = Ë†ğ¹ âˆ’ Ë†ğ· Ë†ğµâˆ’1 Ë†ğ¶. Taking into
account the last formula, one can obtain the following result:

Ë†ğ½ (cid:124)
ğ’™
Ë†ğ½ (cid:124)
ğ’‚

2 Ë†ğ¶âˆ’1 0ğ‘›Ã—ğ‘™
ï£®
ï£¯
0ğ‘™Ã—ğ‘›
ï£¯
ï£¯
ï£¯
Ë†ğ½ğ’™
ï£¯
ï£°

0ğ‘™Ã—ğ‘™
Ë†ğ½ğ’‚ 0ğ‘šÃ—ğ‘š

âˆ’1

ï£¹
ï£º
ï£º
ï£º
ï£º
ï£º
ï£»

=

=

(cid:35) âˆ’1

(cid:34)

2 Ë†ğ¶âˆ’1
Ë†ğ¾

Ë†ğ¾ (cid:124)
Ë†ğ‘†

(cid:34) 1
2

Ë†ğ¶ + 1
4
âˆ’ 1
2

Ë†ğ¶ Ë†ğ¾ (cid:124) Ë†ğºâˆ’1 Ë†ğ¾ Ë†ğ¶ âˆ’ 1
2
Ë†ğºâˆ’1 Ë†ğ¾ Ë†ğ¶

Ë†ğ¶ Ë†ğ¾ (cid:124) Ë†ğºâˆ’1
Ë†ğºâˆ’1

(cid:35)

,

where Ë†ğ‘† is the following matrix:

Ë†ğ‘† =

(cid:35)

Ë†ğ½ (cid:124)
ğ’‚

(cid:34)0ğ‘™Ã—ğ‘™
Ë†ğ½ğ’‚ 0ğ‘šÃ—ğ‘š

;

Ë†ğ¾ is the concatenation of matrices 0ğ‘™Ã—ğ‘› and Ë†ğ½ğ’™:

Ë†ğ¾ =

(cid:35)

(cid:34)0ğ‘™Ã—ğ‘›
Ë†ğ½ğ’™

.

â€“ 9 â€“

(4.8)

(4.9)

(4.10)

0
ï£®
ï£¯
...
ï£¯
ï£¯
ï£¯
ï£¯
0
ï£¯
ï£¯
Î” ğ‘“1
ï£¯
...
ï£¯
ï£¯
ï£¯
ï£¯
Î” ğ‘“ğ‘š
ï£¯
ï£°

ï£¹
ï£º
ï£º
ï£º
ï£º
ï£º
ï£º
ï£º
ï£º
ï£º
ï£º
ï£º
ï£º
ï£º
ï£»

ï£¼ï£´ï£´ï£´ï£´ï£´ï£½
ï£´ï£´ï£´ï£´ï£´
ï£¾
ï£¼ï£´ï£´ï£´ï£½
ï£´ï£´ï£´
ï£¾

ğ‘› + ğ‘™

ğ‘š

The matrix Ë†ğº in the case of equation (4.8) is as follows:

Thus, the solution for the vector Î”ğ’’ has the form:

Ë†ğº = Ë†ğ‘† âˆ’

Ë†ğ¾ Ë†ğ¶ Ë†ğ¾ (cid:124).

1
2

(cid:34) 1
2

Î”ğ’’ =

Ë†ğ¶ + 1
4
âˆ’ 1
2

Ë†ğ¶ Ë†ğ¾ (cid:124) Ë†ğºâˆ’1 Ë†ğ¾ Ë†ğ¶ âˆ’ 1
2
Ë†ğºâˆ’1 Ë†ğ¾ Ë†ğ¶

(cid:35)

Ë†ğ¶ Ë†ğ¾ (cid:124) Ë†ğºâˆ’1
Ë†ğºâˆ’1

(cid:34)

âˆ’ 1
2

(cid:35)

Ë†ğ¶ Ë†ğ¾ (cid:124) Ë†ğºâˆ’1
Ë†ğºâˆ’1

=

0
ï£®
ï£¯
...
ï£¯
ï£¯
ï£¯
ï£¯
0
ï£¯
ï£¯
Î” ğ‘“1
ï£¯
...
ï£¯
ï£¯
ï£¯
ï£¯
Î” ğ‘“ğ‘š
ï£¯
ï£°

ï£¹
ï£º
ï£º
ï£º
ï£º
ï£º
ï£º
ï£º
ï£º
ï£º
ï£º
ï£º
ï£º
ï£º
ï£»

ï£¼ï£´ï£´ï£´ï£´ï£´ï£½
ï£´ï£´ï£´ï£´ï£´
ï£¾
ï£¼ï£´ï£´ï£´ï£½
ï£´ï£´ï£´
ï£¾

ğ‘™

ğ‘š

= Ë†ğ‘… Ë†ğºâˆ’1 Ë†ğ‘ƒÎ” ğ’‡ ,

where matrix Ë†ğ‘… is such that

matrix Ë†ğ‘ƒ has the following form:

Ë†ğ‘… =

(cid:34)

Ë†ğ¶ Ë†ğ¾ (cid:124)
âˆ’ 1
2
Ë†ğ¼ğ‘™+ğ‘š

(cid:35)

,

Ë†ğ‘ƒ =

(cid:35)

(cid:34)0ğ‘™Ã—ğ‘š
Ë†ğ¼ğ‘š

,

(4.11)

(4.12)

(4.13)

(4.14)

matrix Ë†ğ¼ğ‘˜ is the ğ‘˜ Ã— ğ‘˜ identity matrix, Î” ğ’‡ =
minimum point ğ’™ (cid:48) has the following form:

(cid:104)

Î” ğ‘“1 Î” ğ‘“2 Â· Â· Â· Î” ğ‘“ğ‘š

(cid:105) (cid:124)

. The chi-square at the local

ğœ’2(ğ’™ (cid:48)) = (cid:0)ğ’™ (cid:48) âˆ’ Ëœğ’™(cid:1) (cid:124) Ë†ğ¶âˆ’1 (cid:0)ğ’™ (cid:48) âˆ’ Ëœğ’™(cid:1) = Î”ğ’™(cid:124) Ë†ğ¶âˆ’1Î”ğ’™ = Î”ğ’’(cid:124) Ë†ğ‘Œ Î”ğ’’

= Î” ğ’‡ (cid:124) Ë†ğ‘ƒ(cid:124) Ë†ğºâˆ’1 Ë†ğ‘…(cid:124) Ë†ğ‘Œ Ë†ğ‘… Ë†ğºâˆ’1 Ë†ğ‘ƒÎ” ğ’‡

= Î” ğ’‡ (cid:124)

(cid:18) 1
4

Ë†ğ‘ƒ(cid:124) Ë†ğºâˆ’1 Ë†ğ¾ Ë†ğ¶ Ë†ğ¾ (cid:124) Ë†ğºâˆ’1 Ë†ğ‘ƒ

(cid:19)

Î” ğ’‡ = Î” ğ’‡ (cid:124) Ë†MÎ” ğ’‡ ,

(4.15)

where Ë†ğ‘Œ = Ë†ğ¶âˆ’1 âŠ• 0(ğ‘™+ğ‘š)Ã—(ğ‘™+ğ‘š) and Ë†M = 1
4

Ë†ğ‘ƒ(cid:124) Ë†ğºâˆ’1 Ë†ğ¾ Ë†ğ¶ Ë†ğ¾ (cid:124) Ë†ğºâˆ’1 Ë†ğ‘ƒ.

4.2.1 Case ğ‘™ = 0
Let us consider ï¬rst the case where the number of non-measurable parameters is zero, ğ‘™ = 0. In this
case Ë†ğº = âˆ’ 1
. This matrix must be non-singular, otherwise the system of equations (4.6) is
2
unsolvable.

Ë†ğ½ğ’™ Ë†ğ¶ Ë†ğ½ğ’™

(cid:124)

Consider the random vector Î” ğ’‡ = Ë†ğ½ğ’™ Ëœğ’™ + ğ’—. Since this vector is linearly related to the random
vector Ëœğ’™ âˆ¼ N ( ğğ’™, Ë†ğ¶), it is easy to show that it is also normally distributed. The expectation E[.] of

â€“ 10 â€“

this vector has the following form: E[Î” ğ’‡ ] = Ë†ğ½ğ’™E[ Ëœğ’™] + ğ’— = Ë†ğ½ğ’™ ğğ’™ + ğ’— â‰¡ 0. In the previous formula,
we used the identity E[ Ëœğ’™] = ğğ’™. The covariance matrix Ë†Cov[.] for this vector can also be easily
obtained:

Ë†Cov[Î” ğ’‡ ]ğ‘– ğ‘— = E[(Î” ğ’‡ âˆ’ 0)ğ‘– (Î” ğ’‡ âˆ’ 0) ğ‘—] =

E[( Ë†ğ½ğ’™ Ëœğ’™ + ğ’—)ğ‘– ( Ë†ğ½ğ’™ Ëœğ’™ + ğ’—) ğ‘—] = ( Ë†ğ½ğ’™)ğ‘–ğ‘ ( Ë†ğ½ğ’™) ğ‘—ğ‘E[( Ëœğ’™)ğ‘ ( Ëœğ’™)ğ‘] + (ğ’—)ğ‘– ( Ë†ğ½ğ’™ ğğ’™) ğ‘— =
(cid:17)

(cid:16)

(4.16)

( Ë†ğ½ğ’™)ğ‘–ğ‘ ( Ë†ğ½ğ’™) ğ‘—ğ‘E[( Ëœğ’™ âˆ’ ğğ’™)ğ‘ ( Ëœğ’™ âˆ’ ğğ’™)ğ‘] =

Ë†ğ½ğ’™ Ë†ğ¶ Ë†ğ½ (cid:124)

ğ’™

.

ğ‘– ğ‘—

(cid:124)

Indices ğ‘– and ğ‘— are free matrix indices. Thus we got that Î” ğ’‡ âˆ¼ N (0, Ë†ğ½ğ’™ Ë†ğ¶ Ë†ğ½ (cid:124)

In the last equation it is assumed that summation is carried out over the repeated indices ğ‘ and
ğ‘.
ğ’™ ). Since the
Ë†ğ½ğ’™ Ë†ğ¶ Ë†ğ½ğ’™
matrix Ë†ğº = âˆ’ 1
is also non-singular. Therefore, the
2
random variable Î” ğ’‡ (cid:124) (cid:16)
(cid:17)

is non-singular, the matrix Ë†ğ½ğ’™ Ë†ğ¶ Ë†ğ½ğ’™
Ë†ğ½ğ’™ Ë†ğ¶ Ë†ğ½ (cid:124)
= ğ‘š degrees of freedom.

Ë†ğ½ğ’™ Ë†ğ¶ Ë†ğ½ (cid:124)
On the other hand, according to equation (4.15), the following equality holds in the case of

Î” ğ’‡ is distributed according to the chi-square distribution with

rank

(cid:17) âˆ’1

(cid:16)

(cid:124)

ğ’™

ğ’™

ğ‘™ = 0:

ğœ’2(ğ’™ (cid:48)) = Î”ğ’™(cid:124) Ë†ğ¶âˆ’1Î”ğ’™ = Î” ğ’‡ (cid:124) Ë†ğ‘€Î” ğ’‡ = Î” ğ’‡ (cid:124) (cid:16)

(cid:17) âˆ’1

Ë†ğ½ğ’™ Ë†ğ¶ Ë†ğ½ (cid:124)

ğ’™

Î” ğ’‡ ,

(4.17)

the random variable ğœ’2(ğ’™ (cid:48)) = Î”ğ’™(cid:124) Ë†ğ¶âˆ’1Î”ğ’™ has the same distribution as the random variable
Ë†ğ½ğ’™ Ë†ğ¶ Ë†ğ½ (cid:124)
Î” ğ’‡ . Thus, in the case of linear constraints and with ğ‘™ = 0, the random variable

i.e.
Î” ğ’‡ (cid:124) (cid:16)
ğœ’2(ğ’™ (cid:48)) is distributed according to the chi-square distribution (4.1) with ğ‘š degrees of freedom.

(cid:17) âˆ’1

ğ’™

4.2.2 Case ğ‘™ â‰  0

Now consider the case when the number of non-measurable parameters is non-zero. The system of
linear equations (4.2) describing the constraints can be rewritten as follows:

Ë†ğ½ğ’™ ğ’™ + Ë†ğ½ğ’‚ ğ’‚ + ğ’— = 0.
Since rank( Ë†ğ½) = ğ‘š, the latter system contains ğ‘š linearly independent equations. Let us multiply
this system of equations on the left by the matrix Ë†ğ½ (cid:124)
(cid:1) = rank( Ë†ğ½ğ’‚) = ğ‘™, the ğ‘™ Ã— ğ‘™
matrix Ë†ğ½ (cid:124)
ğ’‚ Ë†ğ½ğ’‚ is a full rank matrix, i.e. this matrix is non-singular. Thus, non-measurable variables
ğ’‚ can be expressed from equation (4.18) as follows:
(cid:1) âˆ’1 Ë†ğ½ (cid:124)
ğ’‚

ğ’‚ . Since rank (cid:0) Ë†ğ½ (cid:124)

(cid:0) Ë†ğ½ğ’™ ğ’™ + ğ’—(cid:1) .

ğ’‚ = âˆ’ (cid:0) Ë†ğ½ (cid:124)

(4.18)

(4.19)

ğ’‚ Ë†ğ½ğ’‚

ğ’‚ Ë†ğ½ğ’‚

Further, non-measurable parameters can be excluded from equation (4.18) by substituting equa-
tion (4.19) back into equation (4.18). As a result of this substitution, one can obtain the following
system of equations:

(cid:16)

Ë†ğ¼ âˆ’ Ë†ğ½ğ’‚

(cid:0) Ë†ğ½ (cid:124)

ğ’‚ Ë†ğ½ğ’‚

(cid:1) âˆ’1 Ë†ğ½ (cid:124)
ğ’‚

(cid:17) (cid:0) Ë†ğ½ğ’™ ğ’™ + ğ’—(cid:1) = 0,

(4.20)

where Ë†ğ¼ is the identity matrix. The system of linear equations (4.20) contains ğ‘š equations, but some
of the equations in this system are linearly dependent. Since this system was obtained from a system
of ğ‘š linearly independent equations (4.18) by eliminating ğ‘™ non-measurable parameters, it contains
only ğ‘š âˆ’ ğ‘™ linearly independent equations. Thus the case ğ‘™ â‰  0 can be reduced to the case ğ‘™ = 0.
Therefore, by analogy with section 4.2.2, one can conclude that in the case of linear constraints and
with ğ‘™ â‰  0, the random variable ğœ’2(ğ’™ (cid:48)) is distributed according to a chi-square distribution (4.1)
with ğ‘š âˆ’ ğ‘™ degrees of freedom.

â€“ 11 â€“

4.3 Nonlinear constraints

In the case of nonlinear constraints, the random vectors ğ’™ (cid:48) and Î” ğ’‡ are expressed in terms of the
random vector Ëœğ’™ non-linearly. Thus, in the case of nonlinear constraints, the distribution of the
random variable ğœ’2(ğ’™ (cid:48)) = Î”ğ’™(cid:124) Ë†ğ¶âˆ’1Î”ğ’™ diï¬€ers from the chi-square distribution (4.1).

It should be noted that the kinematic and vertex ï¬tting implies extensive use of nonlinear
constraints (see sections 6 and 7). Thus, one should expect that the distribution of the random
variable ğœ’2(ğ’™ (cid:48)) obtained using Gaussian simulation will not be consistent with the chi-square
distribution (4.1). However, in the case of many hypotheses, nonlinear eï¬€ects do not lead to
signiï¬cant distortion of the chi-square distribution. That is, despite the non-linearity, the distribution
of the random variable ğœ’2(ğ’™ (cid:48)) in these cases is well described by the distribution (4.1). At the same
time, in the case of some hypotheses3, the nonlinear eï¬€ects can be so large that the distribution of
the random variable ğœ’2(ğ’™ (cid:48)) in these cases is not described by the probability density function (4.1).
A detailed discussion of how constraint non-linearity aï¬€ects the ğœ’2(ğ’™ (cid:48)) distribution is given in
section 9 with examples using Gaussian simulation.

The fact that the ğœ’2(ğ’™ (cid:48)) distribution is in many cases described by a probability density func-
tion (4.1), despite the non-linearity of the constraints, makes Gaussian simulation an important tool
for testing the ï¬tting package discussed in this work. Typos in various kinds of parametrizations, as
well as in their gradients and Hessians, often lead to signiï¬cant distortions of the ğœ’2(ğ’™ (cid:48)) distribution.
The consequences of such typos appear in all hypotheses using corresponding parametrizations.
Thus, the analysis of the ğœ’2(ğ’™ (cid:48)) distribution, obtained as a result of the Gaussian simulation, makes
it possible to identify some these typos.

4.4 Chi-square in the case of Monte Carlo simulation and experimental data

As noted above, Gaussian simulation is of interest for testing a ï¬tting package. In real analysis,
the user of a ï¬tting package deals with experimental data as well as Monte Carlo simulations of
It often happens that the uncertainties of some measurable parameters
a particular processes.
are of a non-Gaussian nature4 even in the case of Monte Carlo simulation. Therefore, it can be
expected that the distribution of the random variable ğœ’2(ğ’™ (cid:48)) in the case of Monte Carlo simulations
and experimental data is less consistent with the chi-square distribution (4.1) than in the case of
Gaussian simulation. Examples of distributions of the random variable ğœ’2(ğ’™ (cid:48)) for Monte Carlo
simulation events can be seen in section 8. These distributions were obtained using the ï¬tting
package discussed in this paper. It should be noted that below in the text and in the captions to the
ï¬gures, instead of ğœ’2(ğ’™ (cid:48)), we often use the notation ğœ’2.

Since the Monte Carlo simulation does not perfectly describe the experimental data, the
distributions of the random variable ğœ’2(ğ’™ (cid:48)) in the experiment and simulation may be diï¬€erent.
Suppose that in the analysis of some physical process, a selection criterion for ğœ’2(ğ’™ (cid:48)) is used.
Since the distributions of the random value ğœ’2(ğ’™ (cid:48)) in experiment and simulation are diï¬€erent, the
detection eï¬ƒciencies in simulation and experiment are also diï¬€erent. The detection eï¬ƒciency in

3It should be noted that the inï¬‚uence of nonlinear constraints on the ğœ’2 (ğ’™(cid:48)) distribution depends not only on the
hypothesis choice, but also on the magnitude of the elements of the covariance matrix Ë†ğ¶. The greater the deviation of the
measured parameters from their exact values, the more the eï¬€ects of the constraint non-linearity aï¬€ect this distribution.

4Due to non-Gaussian response of a detector.

â€“ 12 â€“

the experiment is usually unknown, so the corresponding eï¬ƒciency from the simulation is usually
used instead. Since these eï¬ƒciencies are diï¬€erent, this diï¬€erence must be taken into account
using eï¬ƒciency corrections and ï¬nding the corresponding systematic uncertainties. Examples of
detection eï¬ƒciency corrections related to a chi-square selection criterion can be found, for example,
in articles [23, 24].

5 Vertices

In this paper, vertices are considered as separate entities. The reason for considering vertices as
separate entities is that each vertex is always shared by some set of particles. Each vertex has three
coordinates. The kinematic and vertex ï¬tting package includes vertex classes corresponding to
coordinates in Cartesian and cylindrical coordinate systems. User can add vertices with custom
parametrization corresponding to a diï¬€erent coordinate system. To do this, one needs to implement
a new vertex class inherited from the base vertex class. The base vertex class contains virtual abstract
methods that return the Cartesian coordinates of a vertex depending on its three parameters. This
class also contains virtual abstract methods for obtaining gradients and Hessians of the Cartesian
coordinates, depending on a vertex parametrization. In order to create a custom vertex class, the
user have to implement the above abstract methods.
In the case of the vertex corresponding to
the Cartesian coordinate system, the implementation of the methods listed above is trivial. For
example, functions that return the Cartesian coordinates of a vertex have the following form:

ğ‘¥v(ğ’‚ (ğ’—) ) = ğ‘¥ (ğ‘£) ,
ğ‘¦v(ğ’‚ (ğ’—) ) = ğ‘¦ (ğ‘£) ,
ğ‘§v(ğ’‚ (ğ’—) ) = ğ‘§ (ğ‘£) ,
ğ‘¥ (ğ‘£)
ğ‘¦ (ğ‘£)
ğ‘§ ( ğ‘£)

ğ’‚ (ğ’—) =

ï£®
ï£¯
ï£¯
ï£¯
ï£¯
ï£¯
ï£°

(5.1)

,

ï£¹
ï£º
ï£º
ï£º
ï£º
ï£º
ï£»

where ğ‘¥v, ğ‘¦v and ğ‘§v are functions that return the Cartesian coordinates of a vertex depending on
the vector ğ’‚ (ğ‘£) of its parameters ğ‘¥ (ğ‘£) , ğ‘¦ (ğ‘£) and ğ‘§ (ğ‘£) , which are themselves the vertex Cartesian
coordinates. In the case of a vertex parametrized according to the cylindrical coordinate system,
the functions returning Cartesian coordinates are as follows:

ğ‘¥v(ğ’‚ (ğ’—) ) = ğœŒ (ğ‘£) cos ğœ™ (ğ‘£) ,
ğ‘¦v(ğ’‚ (ğ’—) ) = ğœŒ (ğ‘£) sin ğœ™ (ğ‘£) ,
ğ‘§v(ğ’‚ (ğ’—) ) = ğ‘§ (ğ‘£) ,
ğœŒ (ğ‘£)
ğœ™ (ğ‘£)
ğ‘§ (ğ‘£)

,

ï£®
ï£¯
ï£¯
ï£¯
ï£¯
ï£¯
ï£°
where parameters ğœŒ (ğ‘£) , ğœ™ (ğ‘£) and ğ‘§ ( ğ‘£) are the vertex coordinates in the cylindrical coordinate system.
Here and below, we do not present gradients and Hessians for vertex coordinates, particle four-
momenta and trajectories, since the procedure for calculating them is well known. At the same

ğ’‚ (ğ’—) =

ï£¹
ï£º
ï£º
ï£º
ï£º
ï£º
ï£»

(5.2)

â€“ 13 â€“

time, gradients and Hessians, for example, in the case of charged particle (see section 6.2.1), can
take up quite a lot of paper space.

In the case of the CMD-3 experiment, vertex parametrization (5.1) is most often used. Such ver-
tex parametrizations as (5.2) can be used in speciï¬c cases. For example, a vertex with parametriza-
tion (5.2) can be used if it is required to set limits for the ğœŒ (ğ‘£) parameter. Such a need may arise,
for example, if one wants to restore a vertex of a photon conversion on the vacuum tube of the drift
chamber.

Vertex coordinates are considered as non-measurable parameters by default.

In principle,
vertex coordinates can be made measurable parameters by specifying a non-zero inverse covariance
matrix corresponding to these coordinates. In this case, an additional non-zero sum over the vertices
will appear in the equation (1.2). However, in the case of the CMD-3 experiment, there is no such
need.

In the case of an ğ‘’+ğ‘’âˆ’ interaction vertex, the ğ‘¥- and ğ‘¦-coordinates can be ï¬xed at the beam
position in the corresponding plane, since this position is known with an accuracy of about 100 Âµm
in the case of the VEPP-2000 collider. The ğ‘§-coordinate of this vertex should be a free parameter.
In the case of decay vertices, all three coordinates should be free.

6 Particles

Like vertices, particles are considered as separate entities in this work. Particle classes contain
parametrizations of output four-momenta with respect to the origin vertex and input four-momenta
with respect to the decay vertex. These four-momenta are used in the energy-momentum con-
servation constraints, as well as in the constraints on the invariant mass of some particle set.
Energy-momentum constraints and mass constraint are described in detail in sections 7.1 and 7.2,
respectively.

In the case of some particle classes, parametrization of particle trajectories can also be imple-

mented. These trajectories are required in constraints using for vertex ï¬tting (see section 7.3).

6.1

Initial pseudo-particle

The initial pseudo particle is used in order to set the total four-momentum of all particles present
in a certain hypothesis. In the case of the VEPP-2000 collider, the energies of the initial electrons
and positrons are the same with high accuracy, and the directions of their motion are opposite. For
this reason, the four-momentum parametrization for the initial pseudo-particle in the case of the
CMD-3 experiment can be written in the following form:

P (ğ‘–)
pseudo = (ğ¸c.m., 0),
where ğ¸c.m. = 2ğ¸beam is the center-of-mass energy, ğ¸beam is the beam energy, ğ‘– is the particle index.
In the case of the CMD-3, the energy is set constant at each event.
In principle, the user can
easily add a custom pseudo-particle class in which energy and momentum are free parameters and
contribute to the chi-square (1.2). In the case of the VEPP-2000, the typical beam energy spread is
less than 1 MeV. For this reason, using a non-constant center-of-mass energy ğ¸c.m. in the case of
the CMD-3 experiment will not have a signiï¬cant eï¬€ect5 on the ï¬t result.

(6.1)

5This eï¬€ect is within the detector resolution.

â€“ 14 â€“

6.2 Charged particles and photons

The parametrizations of a charged particle and photon were placed in a separate subsection, since
the authors consider these parametrizations to be detector-dependent. For example, in the case of a
photon, the detector-dependent part of the parametrization is contained at least in the description of
the photon conversion point inside a calorimeter. In the case of the CMD-3 experiment, a cylindrical
coordinate system is used to set the photon conversion point. The parametrization of a charged
particle in the case of the CMD-3 experiment is described in section 6.2.1. This parametrization
may also have some diï¬€erences in the case of a diï¬€erent experiment. For example, in the case of
the charged particle parametrization described in section 6.2.1, a constant magnetic ï¬eld6 at any
point of the drift chamber is used, i.e. the change in the magnetic ï¬eld near the detector end-caps
is not taken into account. This is due to the fact that the charged particle tracks themselves are
reconstructed in the case of the CMD-3 experiment under the assumption of an uniform magnetic
ï¬eld. The inhomogeneity of the magnetic ï¬eld in the CMD-3 experiment is usually taken into
account by introducing a corresponding systematic uncertainty. Since the package of kinematic and
vertex ï¬tting discussed in this paper uses the parameters of already reconstructed tracks, it makes
no sense to take into account the inhomogeneity of the magnetic ï¬eld in this package.

It should be noted that only the parametrization of a ï¬nal charged particle is discussed in
section 6.2.1. The parametrization of an intermediate charged particle is discussed in section 6.3.2.

6.2.1 Charged particle

In the case of the experiment with the CMD-3 detector, the parametrizations of four-momenta and
trajectories of ï¬nal charged particles depend on ï¬ve measurable parameters. These parameters are
listed below:

â€¢ ğ‘ (ğ‘–)

âŠ¥ is the radial component of momentum, i.e. the momentum component perpendicular to

the magnetic ï¬eld;

â€¢ ğœŒ (ğ‘–)
c

â€¢ ğ‘§ (ğ‘–)
c

â€¢ ğœ™ (ğ‘–)
c

â€¢ ğœƒ (ğ‘–)
c

is the distance between the beam axis and the nearest point on a charged particle trajectory;

is ğ‘§-coordinate of the track point closest to the beam axis;

is the axial angle corresponding to the track point closest to the beam axis;

is the polar angle of a charged particle momentum.

The parametrizations of the charged particle four-momentum and trajectory depend also on one
non-measurable parameter ğ‘ğ‘¡ (ğ‘–)
out. This parameter has a meaning of a distance along charged particle
trajectory with respect to the track point closest to the beam axis. At the end of the chi-square
minimization the value of the parameter ğ‘ğ‘¡ (ğ‘–)
out is equal to the distance between the track point closest
to the beam axis and the vertex of a charged particle origin.

6Further, it is assumed that this ï¬eld is directed along the ğ‘-axis.

â€“ 15 â€“

The parametrization of a charged particle four-momentum P (ğ‘–)

c, out =

(cid:16)

ğ¸ (ğ‘–)
c

, ğ’‘ (ğ’Š)

c, out

(cid:17)

has the

following form:

2,

(6.2)

ğ‘ğ‘¡ (ğ‘–)
out âˆ’ ğœ™ (ğ‘–)

ğ‘ğ‘¡ (ğ‘–)
out âˆ’ ğœ™ (ğ‘–)

c

c

(cid:33)

c ) + ğ‘š (ğ‘–)
ï£¹
ï£º
ï£º
ï£º
ï£º
ï£º
ï£º
ï£º
ï£º
ï£º
ï£º
ï£º
ï£º
ï£»

(cid:33)

c

,

ğ¸ (ğ‘–)

c =

âˆšï¸ƒ

2

ğ‘ (ğ‘–)
âŠ¥

(1 + cot2 ğœƒ (ğ‘–)

ğ’‘ (ğ’Š)
c, out =

(cid:32) ğœ” (ğ‘–)
c
ğ‘

(cid:32) ğœ” (ğ‘–)
c
ğ‘

âŠ¥ sin

ğ‘ (ğ‘–)
âŠ¥ cos

ï£®
ï£¯
ï£¯
ï£¯
ï£¯
ï£¯
ï£¯
âˆ’ğ‘ (ğ‘–)
ï£¯
ï£¯
ï£¯
ï£¯
ï£¯
ï£¯
ï£°
ğ‘ (ğ‘–)
c ğµğœ…c
ğ¸ (ğ‘–)
c
ğœ…c â‰ˆ 2.9979 Ã— 10âˆ’3,

ğœ” (ğ‘–)
c
=
ğ‘

,

âŠ¥ cot ğœƒ (ğ‘–)
ğ‘ (ğ‘–)

c

is the particle charge, measured in elementary charges; the constant ğ‘š (ğ‘–)
c

where the constant ğ‘ (ğ‘–)
is
c
the mass of a charged particle, measured in GeV/ğ‘2; the constant ğµ is the magnetic ï¬eld, measured
in T. Fraction ğœ” (ğ‘–)
c /ğ‘ is the fraction of cyclotron frequency to the speed of light; the constant
ğœ…c â‰ˆ 2.9979 Ã— 10âˆ’3 is the proportionality factor7.

The parametrization of a charged particle trajectory ğ’“ (ğ’Š)

c, out =

the following equation:

(cid:104)

ğ‘¥ (ğ‘–)
c, out

ğ‘¦ (ğ‘–)
c, out

ğ‘§ (ğ‘–)
c, out

(cid:105) (cid:124)

sin ğœ™ (ğ‘–)

c + ğ‘… (ğ‘–)

c

sin

out âˆ’ ğœ™ (ğ‘–)
ğ‘ğ‘¡ (ğ‘–)

c

(cid:32) ğœ” (ğ‘–)
c
ğ‘
(cid:32) ğœ” (ğ‘–)
c
ğ‘

(cid:33)

,

(cid:33)

,

cos ğœ™ (ğ‘–)

c + ğ‘… (ğ‘–)

c cos

out âˆ’ ğœ™ (ğ‘–)
ğ‘ğ‘¡ (ğ‘–)

c

ğ‘¥ (ğ‘–)
c, out = ğ‘¥beam +

(cid:16)

c âˆ’ ğœŒ (ğ‘–)
ğ‘… (ğ‘–)

c

ğ‘¦ (ğ‘–)
c, out = ğ‘¦beam âˆ’

(cid:16)

c âˆ’ ğœŒ (ğ‘–)
ğ‘… (ğ‘–)

c

(cid:17)

(cid:17)

c, out = ğ‘§ (ğ‘–)
ğ‘§ (ğ‘–)

c +

c ğ‘ğ‘¡ (ğ‘–)

out

ğ‘ (ğ‘–)
âŠ¥ cot ğœƒ (ğ‘–)
ğ¸ (ğ‘–)
c

,

is given by

(6.3)

ğ‘… (ğ‘–)

c =

ğ‘ (ğ‘–)
âŠ¥
ğ‘ (ğ‘–)
c ğµğœ…c

,

where ğ‘¥beam are ğ‘¦beam the ğ‘¥- and ğ‘¦-coordinates of the beam axis, respectively.
In the case of
the CMD-3 detector these coordinates considered as constants, since they are known with a high
accuracy.

6.2.2 Photon

The parametrization of the photon four-momentum depends on seven parameters. Four of the seven
parameters belong to the photon. The remaining three parameters are the coordinates ğ’“origin of its
origin vertex. One of the four photon parameters is its energy ğ¸ (ğ‘–)
ğ›¾ . The remaining three photon

7The value of this factor is determined by the speed of light and units of measurement of the quantities involved in
equation (6.2). Here and below, we assume that energy is measured in GeV, magnetic ï¬eld in T, time in seconds, and
distance in cm.

â€“ 16 â€“

parameters are the coordinates ğœŒ (ğ‘–)
ğ›¾ , ğœ™ (ğ‘–)
system. The photon four-momentum P (ğ‘–)

ğ›¾ and ğ‘§ (ğ‘–)
ğ›¾ = (ğ¸ (ğ‘–)

ğ›¾ of the conversion point in a cylindrical coordinate
ğ›¾ , ğ’‘ (ğ’Š)
ğœ¸ ) is given by the following equation:
ğ’“ (ğ’Š)
conv âˆ’ ğ’“origin
(cid:107) ğ’“ (ğ’Š)
conv âˆ’ ğ’“origin(cid:107)
ğœŒ (ğ‘–)
ğ›¾ cos ğœ™ (ğ‘–)
ï£¹
ğ›¾
ï£º
ğ›¾ sin ğœ™ (ğ‘–)
ğœŒ (ğ‘–)
ï£º
ğ›¾
ï£º
ğ‘§ (ğ‘–)
ï£º
ï£º
ğ›¾
ï£»

(6.4)

,

.

ï£®
ï£¯
ï£¯
ï£¯
ï£¯
ï£¯
ï£°

ğœ¸ = ğ¸ (ğ‘–)
ğ’‘ (ğ’Š)

ğ›¾

ğ’“ (ğ’Š)
conv =

Since equation (6.4) already requires a photon to ï¬‚y from the origin vertex ğ’“origin to the conversion
point ğ’“ (ğ’Š)

conv, there is no need for a separate parametrization of a photon trajectory.

Intermediate particles

6.3
Along all intermediate particles in the case of the CMD-3 experiment, ğ¾ğ‘† mesons require special
attention due to their long lifetime. Parametrization of neutral intermediate particles, such as ğ¾ğ‘†
mesons, is given in section 6.3.1. It should also be noted that for particles such as ğœ‹0 or ğœ‚ mesons,
the parametrization described in section 6.3.1 should not be used. In the terms of kinematic and
vertex ï¬tting, these particles decay at the origin vertex due to their short lifetime. To take these
particles into account, it suï¬ƒces to require a mass constraint on their decay products.

Due to the small radius (30 cm) of the drift chamber in the CMD-3 experiment, it practically
makes no sense to consider hypotheses with intermediate charged particles. The probability of
a charged ğœ‹-meson or ğ¾-meson decay inside the drift chamber is low. There is always an odd
number of charged particles among the decay products of a charged particle in order to conserve
charge. The tracks of an initial charged particle and the charged products of its decay are well
reconstructed if the decay vertex is near the center of the drift chamber radius, since in this case
the probability that all tracks will have a suï¬ƒcient number of hits is the highest. Thus, the number
of charged particle decay events in which kinematic and vertex ï¬tting can be successfully used is
additionally limited by the track reconstruction eï¬ƒciency. However, intermediate charged particles
have been implemented in the discussed kinematic and vertex ï¬tting package. In addition, it was
veriï¬ed that the use of these intermediate particles makes it possible, for example, to ï¬nd events
with ğœ‹+ â†’ ğœ‡+ğœˆğœ‡ decay8. The parametrization of intermediate charged particles is discussed in
detail in section 6.3.2.

6.3.1

Intermediate neutral particle

The parametrization of the intermediate neutral particle depends on seven parameters. Four param-
eters belong to this particle. The three remaining parameters are the coordinates ğ’“origin of its origin
vertex. The ï¬rst three parameters of an intermediate neutral particle are the Cartesian components
of its momentum

ï£®
ï£¯
ï£¯
ï£¯
ï£¯
ï£¯
ï£°
8Since the detection of intermediate charged particles in the case of CMD-3 is diï¬ƒcult due to the small size of the
drift chamber, the authors do not further consider examples of hypotheses with such particles. The authors hope to study
in more detail the possibility of using intermediate charged particles 6.3.2 in other experiments in the future.

ğ’‘ (ğ’Š)
int. n. =

(6.5)

ï£¹
ï£º
ï£º
ï£º
ï£º
ï£º
ï£»

,

ğ‘ (ğ‘–)
x
ğ‘ (ğ‘–)
y
ğ‘ (ğ‘–)
z

â€“ 17 â€“

the last parameter ğœ‰ (ğ‘–) is proportional to the time interval between the particle origin and decay.
The four-momentum parametrization for an intermediate neutral particle has the following form:

(cid:32)âˆšï¸‚

P (ğ‘–)
int. n. =

2

ğ‘š (ğ‘–)

int. n.

+ ğ’‘ (ğ’Š)

2 , ğ’‘ (ğ’Š)

int. n.

int. n.

(cid:33)

,

(6.6)

where the constant ğ‘š (ğ‘–)
particle can be written as follows:

int. n. is the particle mass. Trajectory parametrization of an intermediate neutral

All parameters ğ‘ (ğ‘–)
non-measurable.

x , ğ‘ (ğ‘–)

y , ğ‘ (ğ‘–)

z

int. n. = ğ’“origin + ğœ‰ (ğ‘–) ğ’‘ (ğ’Š)
ğ’“ (ğ’Š)

int. n.

.

(6.7)

and ğœ‰ (ğ‘–) of an intermediate neutral particle are considered to be

It should be noted that instead of the momentum parametrization (6.5), one could consider a
momentum parametrization similar that of a photon momentum (6.4). In the case of an intermediate
neutral particle, such parametrization would have the following form:

int. n. = ğ‘ (ğ‘–)
ğ’‘ (ğ’Š)

int. n.

ğ’“decay âˆ’ ğ’“origin
(cid:107) ğ’“decay âˆ’ ğ’“origin(cid:107)

,

(6.8)

int. n.

int. n. = (cid:107) ğ’‘ (ğ’Š)

where the parameter ğ‘ (ğ‘–)
(cid:107) is the particle momentum norm9, ğ’“decay is the particle decay
vertex. The advantage of the parametrization (6.8) could be that it already requires the particle to
ï¬‚y from the origin vertex to the decay vertex, so the trajectory parametrization (6.7) can be avoided
in this case. The parametrization (6.8) would allow one to reduce the space of minimization
parameters by six, allowing one to remove three particle parameters and three Lagrange multipliers
corresponding to the vertex constraints 7.3 for this particle. However, the kinematic and vertex ï¬tting
in the case of parametrization (6.8) would work very unstable. This is due to the fact that zeros10
may appear in the denominator of equation (6.8). These zeros can also appear in the gradients and
Hessians of the particle momentum components. The use of parametrizations (6.5) and (6.7) makes
it easy to avoid the indicated problem, although it increases the space of minimization parameters.
It should be noted, however, that such an increase in the dimension of the parameter space does not
cause a signiï¬cant slowdown in the work of the ï¬t, at least in the case of the hypotheses that can
appear in the CMD-3 experiment.

6.3.2

Intermediate charged particle

The parametrizations of four-momenta and the trajectories of intermediate charged particles are very
similar to the corresponding parametrizations in the case of ï¬nal charged particles 6.2.1. In the case
of an intermediate charged particle, the parametrizations of the output four-momentum (6.2) and
the output trajectory (6.3) with respect to the origin vertex are exactly the same as for a ï¬nal charged
particle. The parametrizations of the input four-momentum and the input trajectory with respect
to the decay vertex diï¬€er from the parametrizations (6.2) and (6.3) by replacing the parameter

9In this article, by norm we always mean the â„“2-norm: (cid:107)ğ’ƒ(cid:107) =

âˆšï¸„

dim ğ’ƒ
(cid:205)
ğ‘–=1

ğ‘2
ğ‘– .

10During ï¬tting, points ğ’“decay and ğ’“origin can become very close to each other.

â€“ 18 â€“

ğ‘ğ‘¡ (ğ‘–)
out with the parameter ğ‘ğ‘¡ (ğ‘–)
in . As a result of this replacement, the parametrization of the input
four-momentum P (ğ‘–)
ğ¸ (ğ‘–)
of an intermediate charged particle has the following form:
c

(cid:17)

(cid:16)

, ğ’‘ (ğ’Š)
c, in

c, in =

ğ¸ (ğ‘–)

c =

âˆšï¸ƒ

2

ğ‘ (ğ‘–)
âŠ¥

(1 + cot2 ğœƒ (ğ‘–)

(cid:32) ğœ” (ğ‘–)
c
ğ‘

ğ‘ğ‘¡ (ğ‘–)
in

(cid:32) ğœ” (ğ‘–)
c
ğ‘

ğ‘ğ‘¡ (ğ‘–)
in

âŠ¥ cot ğœƒ (ğ‘–)
ğ‘ (ğ‘–)

c

2,

c

(cid:33)

âˆ’ ğœ™ (ğ‘–)
c

c ) + ğ‘š (ğ‘–)
ï£¹
ï£º
ï£º
ï£º
ï£º
ï£º
ï£º
ï£º
ï£º
ï£º
ï£º
ï£º
ï£º
ï£»

âˆ’ ğœ™ (ğ‘–)
c

(cid:33)

,

âŠ¥ sin

ğ‘ (ğ‘–)
âŠ¥ cos

ï£®
ï£¯
ï£¯
ï£¯
ï£¯
ï£¯
ï£¯
âˆ’ğ‘ (ğ‘–)
ï£¯
ï£¯
ï£¯
ï£¯
ï£¯
ï£¯
ï£°
ğ‘ (ğ‘–)
c ğµğœ…c
ğ¸ (ğ‘–)
c

.

ğ’‘ (ğ’Š)
c, in =

ğœ” (ğ‘–)
c
=
ğ‘

The parametrization of input trajectory can be written as follows:

sin ğœ™ (ğ‘–)

c + ğ‘… (ğ‘–)

c

sin

(cid:33)

âˆ’ ğœ™ (ğ‘–)
c

ğ‘ğ‘¡ (ğ‘–)
in

(cid:32) ğœ” (ğ‘–)
c
ğ‘
(cid:32) ğœ” (ğ‘–)
c
ğ‘

cos ğœ™ (ğ‘–)

c + ğ‘… (ğ‘–)

c cos

ğ‘ğ‘¡ (ğ‘–)
in

âˆ’ ğœ™ (ğ‘–)
c

ğ‘¥ (ğ‘–)
c, in = ğ‘¥beam +

(cid:16)

c âˆ’ ğœŒ (ğ‘–)
ğ‘… (ğ‘–)

c

ğ‘¦ (ğ‘–)
c, in = ğ‘¦beam âˆ’

(cid:16)

c âˆ’ ğœŒ (ğ‘–)
ğ‘… (ğ‘–)

c

(cid:17)

(cid:17)

c, in = ğ‘§ (ğ‘–)
ğ‘§ (ğ‘–)

c +

c ğ‘ğ‘¡ (ğ‘–)

in

âŠ¥ cot ğœƒ (ğ‘–)
ğ‘ (ğ‘–)
ğ¸ (ğ‘–)
c

,

(6.9)

(6.10)

,

(cid:33)

,

ğ‘… (ğ‘–)

c =

ğ‘ (ğ‘–)
âŠ¥
ğ‘ (ğ‘–)
c ğµğœ…c

.

The parameter ğ‘ğ‘¡ (ğ‘–)
in in equations (6.9) and (6.10) has the meaning of the distance along the charged
particle trajectory from the track point closest to the beam axis to the decay vertex of this particle.
Like the parameter ğ‘ğ‘¡ (ğ‘–)

out, the parameter ğ‘ğ‘¡ (ğ‘–)

in is a non-measurable parameter.

Practically, ï¬nal 6.2.1 and intermediate 6.3.2 charged particles are implemented as a single
class in the kinematic and vertex ï¬tting package. In the case of a ï¬nal charged particle the parameter
ğ‘ğ‘¡ (ğ‘–)

in is ï¬xed.

6.4 Lost particles

An important requirement for the kinematic and vertex ï¬tting package is the ability to perform a
ï¬t in hypotheses with lost particles11. It should be noted that for a lost particle it makes sense to
specify only a four-momentum, while specifying the trajectory of such a particle is meaningless.
It should also be noted that the four-momentum parameterization will be diï¬€erent for massive and
massless particles. The four-momentum parametrization of a massive lost particle is discussed in
section 6.4.1, while the parametrization in the case of a massless lost particle is given in section 6.4.2.
The parameters of the lost particles are non-measurable as they are not measured directly with a
detector. In the case of the discussed package, this is achieved by specifying zero inverse covariance

11By lost particles, we mean ï¬nal particles that are not detected.

â€“ 19 â€“

matrices corresponding to the parameters of these particles. It should also be noted that in some
cases the parameterizations from sections 6.4.1 and 6.4.2 can also be used for detected particles.
It is assumed that the parametrization of the trajectories of such particles is of no interest, and the
corresponding inverse covariance matrices are nonzero.

6.4.1 Massive particle

The parametrization of a massive lost particle has the following form:

âˆšï¸ƒ

P (ğ‘–)

ğ‘šâ‰ 0 = (

ğ‘š (ğ‘–) 2 + ğ’‘ (ğ’Š) 2, ğ’‘ (ğ’Š) ), ğ’‘ (ğ’Š) =

ğ‘ (ğ‘–)
ğ‘¥
ğ‘ (ğ‘–)
ğ‘¦
ğ‘ (ğ‘–)
ğ‘§

ï£®
ï£¯
ï£¯
ï£¯
ï£¯
ï£¯
ï£°

ï£¹
ï£º
ï£º
ï£º
ï£º
ï£º
ï£»

,

(6.11)

where the parameters ğ‘ (ğ‘–)
constant ğ‘š (ğ‘–) â‰  0 is its mass.

ğ‘¥ , ğ‘ (ğ‘–)

ğ‘¦ and ğ‘ (ğ‘–)
ğ‘§

are the momentum components of the particle, and the

6.4.2 Massless particle

The four-momentum parametrization of a lost massless particle cannot be chosen in the form (6.11)
with ğ‘š (ğ‘–) = 0. The disadvantages of the parametrization (6.11) in the case of a massless particle is
that the denominators of the derivatives of this parametrization become very small if ğ’‘ (ğ’Š) is close
to zero. For this reason, in the case of a lost massless particle, a slightly diï¬€erent four-momentum
parametrization is used. This parametrization has the following form:

P (ğ‘–)
ğ‘š=0 = (ğ¸ (ğ‘–) , ğ¸ (ğ‘–) ğ’(ğ’Š) ), ğ’(ğ’Š) =

sin ğœƒ (ğ‘–) cos ğœ™ (ğ‘–)
ï£®
ï£¯
sin ğœƒ (ğ‘–) sin ğœ™ (ğ‘–)
ï£¯
ï£¯
ï£¯
cos ğœƒ (ğ‘–)
ï£¯
ï£°

ï£¹
ï£º
ï£º
ï£º
ï£º
ï£º
ï£»

,

(6.12)

where the parameter ğ¸ (ğ‘–) is the particle energy, the parameters ğœƒ (ğ‘–) and ğœ™ (ğ‘–) are the polar and
axial angles, respectively. These angles determine the direction of the particle momentum ğ’‘ (ğ’Š) =
ğ¸ (ğ‘–) ğ’(ğ’Š) .

7 Constraints

The discussed kinematic and vertex ï¬tting package uses three diï¬€erent kinds of constraints. These
are energy-momentum conservation constraints, vertex constraints and mass constraints.

The energy-momentum conservation constraints are imposed on a certain set of particles,
and are divided into four diï¬€erent constraints: one constraint is needed for energy conservation,
the other three are for momentum conservation. A detailed discussion of the energy-momentum
conservation constraints is given in section 7.1.

The mass constraint is imposed on a certain set of particles in order to require that the invariant
mass of these particles be equal to a certain value. The detailed description of the mass constraint
is given in section 7.2.

The vertex constraints are imposed on some individual particles at the vertices of their origin
and / or decay. These constraints require that the particleâ€™s trajectory pass through the origin vertex
and the decay vertex. A detailed discussion of the vertex constraints is given in section 7.3.

â€“ 20 â€“

(1)

[ğ‘ƒ ( ğ‘—)
ğ›¼ ]

(2)

(3)

Figure 1: An example of a sub-tree of some energy-momentum conservation constraint tree. The
vertex [ğ‘ƒ ( ğ‘—)
ğ›¼ ] of the sub-tree corresponds to a constraint on the conservation of the ğ›¼-th component
of the four-momentum, ğ›¼ = ğ‘¥, ğ‘¦, ğ‘§, ğ‘¡. The edges of the sub-tree correspond to the particles on
which the constraint [ğ‘ƒ ( ğ‘—)
ğ›¼ ] is imposed. The solid edge corresponds to a decaying particle, while
the dashed edges correspond to its decay products.

7.1 Energy-momentum conservation constraints

The energy-momentum conservation constraints have the following form:

âˆ‘ï¸

ğ‘ âˆˆS( ğ‘—)
+

P (ğ‘)
output âˆ’

âˆ‘ï¸

ğ‘ âˆˆS( ğ‘—)
âˆ’

P (ğ‘)
input = 0,

(7.1)

output is the output four-momentum of the ğ‘-th particle, P (ğ‘)

where the sets S( ğ‘—)
Â± are the sets of indices corresponding to the particles involved in the considered
constraints, P (ğ‘)
input is the input four-
momentum of the ğ‘-th particle. The set S( ğ‘—)
âˆ’ corresponds12 to particles before interaction or decay,
while the set S( ğ‘—)
corresponds to particles that are products of this interaction or decay. The index
+
ğ‘— in S( ğ‘—)
Â± means the index of particle sets on which the constraints 7.1 are imposed. Thus, it is
implied that, in the same hypothesis, the constraints given by equation (7.1) can be imposed on
several diï¬€erent sets of particles. This circumstance is caused by the fact that the energy-momentum
conservation laws often need to be written at each vertex. Thus, the sets S( ğ‘—)
Â± usually correspond to
particles having a ( ğ‘—-th) common vertex. However, in some cases described below, this statement is
not true. Note also that equation (7.1) is considered as four diï¬€erent constraints: one constraint is
for energy conservation, and remaining three constraints are for conservation of three-dimensional
momentum components. The discussed kinematic and vertex ï¬tting package allows using all these
constraints simultaneously, as well as only a part of them.

The energy-momentum constraints given by equation (7.1) are schematically shown in the
ï¬gure 1 when one particle decays into two other particles. The vertex of the decay tree shown in
this ï¬gure corresponds to one of the components (ğ›¼ = ğ‘¥, ğ‘¦, ğ‘§, ğ‘¡) of the four-momentum conservation
constraints. The edges of this tree correspond to the particles on which the constraints are imposed.

12Taking into account section 6.1, it can be concluded that the cardinality of the set S( ğ‘—)

âˆ’ is equal to one (as rule).

â€“ 21 â€“

ğœ‹âˆ’
2

[ğ‘ƒ (2)
ğ›¼ ]

ğœ‹+

ğ¾
ğ‘†

ğ‘’+ğ‘’âˆ’

ğ¾
ğ‘†

[ğ‘ƒ (1)
ğ›¼ ]

ğ¾+

ğœ‹âˆ’
1

Figure 2: The energy-momentum conservation constraint tree corresponding to the hypothesis
ğ‘’+ğ‘’âˆ’ â†’ ğ¾ğ‘ ğ¾ +ğœ‹âˆ’, ğ¾ğ‘† â†’ ğœ‹+ğœ‹âˆ’. Label ğ‘’+ğ‘’âˆ’ in the tree denotes the initial pseudo-particle with
the input four-momentum P (ğ‘’+ğ‘’âˆ’)
ğ›¼ ] ensures the conservation of
the ğ›¼-th four-momentum component at the ğ‘’+ğ‘’âˆ’ interaction vertex, ğ›¼ = ğ‘¥, ğ‘¦, ğ‘§, ğ‘¡. Constraint [ğ‘ƒ (2)
ğ›¼ ]
ensures the conservation of the ğ›¼-th four-momentum component at the ğ¾ğ‘† meson decay vertex.
Since the considered hypothesis contains two ğœ‹âˆ’ mesons, they are denoted as ğœ‹âˆ’

= (2ğ¸beam, 0). Constraint [ğ‘ƒ (1)

input

1 and ğœ‹âˆ’
2 .

The solid edge corresponds to the initial particle, while the dashed edges correspond to its decay
products. Equation (7.1) in the case of the example shown in ï¬gure 1 takes the following form:

+ P (2)

âˆ’P (1)
input

output = 0.

output + P (3)
Figure 2 shows an example of the energy-momentum conservation constraint tree in the case of
the ğ‘’+ğ‘’âˆ’ â†’ ğ¾ğ‘†ğ¾ +ğœ‹âˆ’, ğ¾ğ‘  â†’ ğœ‹+ğœ‹âˆ’ hypothesis. Label ğ‘’+ğ‘’âˆ’ denotes the initial pseudo-particle (see
section 6.1) with the input four-momentum P (ğ‘’+ğ‘’âˆ’)
ğ›¼ ] ensures the
conservation of the ğ›¼-th four-momentum component at the ğ‘’+ğ‘’âˆ’ interaction vertex, while constraint
[ğ‘ƒ (2)
ğ›¼ ] does this at the ğ¾ğ‘† meson decay vertex. According to the tree shown in ï¬gure 2, the
intermediate particle ğ¾ğ‘† is included in the four-momentum conservation constraints. In particular,
this particle is included in the energy conservation constraint, which leads to the fact that the
invariant mass of the decay products of this particle turns out to be ï¬xed on the ğ¾ğ‘† meson mass
after the ï¬t.

input = (2ğ¸beam, 0). Constraint [ğ‘ƒ (1)

Sometimes it becomes necessary to use a hypothesis in which the invariant mass of decay prod-
ucts is not ï¬xed after the ï¬t. This result can be achieved if the momentum conservation constraints
are applied to all particles, including intermediate ones, while the energy conservation constraint
is applied only to the initial and ï¬nal particles. Examples of energy-momentum conservation
constraint trees for such a hypothesis are shown in ï¬gure 3. This hypothesis corresponds to the
ğ‘’+ğ‘’âˆ’ â†’ ğ‘‹ğ¾ +ğœ‹âˆ’, ğ‘‹ â†’ ğœ‹+ğœ‹âˆ’ process, where particle ğ‘‹ is unknown13. Two trees are shown in the

13Particle ğ‘‹ is unknown in the sense that the value of its mass does not aï¬€ect the result of the ï¬tting. This property of

â€“ 22 â€“

ğœ‹âˆ’
2

[ ğ‘ (2)
ğ‘˜ ]

ğœ‹+

ğ‘‹

ğ‘’+ğ‘’âˆ’

ğ‘‹

ğ¾+

[ ğ‘ (1)
ğ‘˜ ]

ğœ‹âˆ’
1

ğ‘’+ğ‘’âˆ’

ğœ‹âˆ’
2

[ğ¸ (3) ]

ğœ‹+

ğ¾+

ğœ‹âˆ’
1

(a) Momentum conservation constraint tree.

(b) Energy conservation constraint tree.

Figure 3: The energy-momentum conservation constraint trees corresponding to the hypothesis
ğ‘’+ğ‘’âˆ’ â†’ ğ‘‹ğ¾ +ğœ‹âˆ’, ğ‘‹ â†’ ğœ‹+ğœ‹âˆ’, where ğ‘‹ is unknown intermediate massive particle. Vertices [ ğ‘ (1)
ğ‘˜ ]
and [ ğ‘ (2)
ğ‘˜ ] of the ï¬rst tree represent the three-dimensional (ğ‘˜ = ğ‘¥, ğ‘¦, ğ‘§) momentum conservation
constraints at the ğ‘’+ğ‘’âˆ’ interaction vertex and at the ğ‘‹ decay vertex, respectively. This tree contains
all particles, including intermediate ones. Vertex [ğ¸ (3) ] of the second tree corresponds to the
energy conservation constraint. This tree contains all particles except intermediate ones.

ï¬gure 3. The tree shown in Figure 3a describes how three momentum conservation constraints are
applied, while the tree in ï¬gure 3b describes how the energy conservation constraint is applied. A
example of using this hypothesis can be found in section 8.1.

7.2 Mass constraint

The mass constraint is used in order to require that the invariant mass of some set of particles be
equal to a certain value. This constraint can be written as follows:

P (ğ‘–)
output

âˆ‘ï¸

(cid:169)
(cid:173)
(cid:173)
ğ‘– âˆˆF( ğ‘—)
+
(cid:171)

2

(cid:170)
(cid:174)
(cid:174)
(cid:172)

âˆ’ ğ‘š2

target = 0,

(7.2)

where F( ğ‘—)
+
and ğ‘štarget is the target value of the invariant mass.

is some set of particle indices, P (ğ‘–)

output is the output four-momentum of the ğ‘–-th particle,

On the one hand, the introduction of mass constraint (7.2) is redundant, since the energy-
momentum conservation constraints 7.1 together with the use of intermediate particles 6.3 make
it possible to achieve the same result. Indeed, suppose that we are dealing with a hypothesis in

particle ğ‘‹ is determined not by its parametrization, but by the speciï¬c conï¬guration of energy-momentum conservation
constraints. As for the intermediate particle ğ¾ğ‘†, the parameterizations described in section 6.3.1 are used for particle ğ‘‹.
Thus, the particle ğ¾ğ‘† can be used as a particle ğ‘‹. The designation ğ‘‹ is introduced only to emphasize that the mass of
such a particle does not aï¬€ect anything.

â€“ 23 â€“

which the ğœ‹0 meson decays into two photons. Since the ğœ‹0 meson lifetime is short, the ğœ‹0 meson
decay vertex is close to its origin vertex. The resolution of the (CMD-3) detector does not allow
distinguishing one vertex from another. Thus, in terms of the kinematic and vertex ï¬tting, the ğœ‹0
meson decays at the origin vertex. In this case, the use of vertex constraints 7.3 for the intermediate
ğœ‹0 meson does not make sense. The parameter ğœ‰ (ğ‘–) of the intermediate ğœ‹0 meson will not be used
in this case and can be ï¬xed (see equation (6.7)). However, eight energy-momentum conservation
constraints can be imposed on the intermediate ğœ‹0 meson in this case. Four constraints correspond
to the laws of energy-momentum conservation at the origin vertex, and four others correspond to
such laws at the decay vertex.

On the other hand, the use of four-momentum parametrizations from section (6.3) in the case
of short-lived intermediate particles is not justiï¬ed because it leads to a senseless increase in the
number of minimization parameters. In addition to the parameters of the intermediate particle, eight
more Lagrange multipliers will be involved in the minimization procedure in this case. If, however,
a short-lived intermediate particle is not introduced directly and the mass constraint (7.2) is used,
then only one additional Lagrange multiplier corresponding to this constraint will be involved in
the minimization procedure. Thus, the conclusion is that in the case of short-lived intermediate
particles, it is better to use the mass constraint (7.2) if necessary.

7.3 Vertex constraints

Vertex constraints are used to require particle trajectories to pass through origin and decay vertices.
The vertex constraints that require a particle to ï¬‚y out of its origin vertex have the following form:

ğ’“ (ğ’Š)
output âˆ’ ğ’“origin = 0,

(7.3)

where ğ’“ (ğ’Š)
output is the parametrization of the output trajectory of the ğ‘–-th particle, i.e. the trajectory
corresponding to the escape of ğ‘–-th particle from its origin vertex ğ’“origin. The vertex constraints,
which require a particle to ï¬‚y to its decay vertex, can be written as follows:

ğ’“ (ğ’Š)
input

âˆ’ ğ’“decay = 0,

(7.4)

output is the parametrization of the input trajectory of the ğ‘–-th particle, i.e.

where ğ’“ (ğ’Š)
along which the particle ï¬‚ies into its decay vertex ğ’“decay.

the trajectory

Among all particle kinds discussed in section 6, there are particle kinds for which trajectories
are not deï¬ned. Such particle kinds are the initial pseudo particle from section 6.1, the lost
particles from section 6.4, and the photon from section 6.2.2. However, it should be noted that
the photon ï¬‚ies from its origin vertex to its conversion point according to the parametrization of
its momentum (6.4). For the ï¬nal charged particle 6.2.1, only the output trajectory (6.3) is given,
while for the intermediate charged particle 6.3.2, both the output (6.3) and input (6.10) trajectories
are given.
In the case of the discussed package of kinematic and vertex ï¬tting, only the input
trajectory (6.7) is speciï¬ed for the neutral intermediate particle 6.3.1.

â€“ 24 â€“

8 Examples

This section provides examples of applying the kinematic and vertex ï¬tting technique in various
hypotheses to the simulated14 events of various ğ‘’+ğ‘’âˆ’ annihilation processes. Hypotheses with
intermediate long-lived neutral particles (ğ¾ğ‘† mesons), hypotheses containing charged particles only,
hypotheses containing photons only, hypotheses containing both charged particles and photons, as
well as hypotheses with lost massive and massless particles are discussed in detail. The following
subsections present mainly the results of applying the ï¬tting algorithm under signal hypotheses.
However, in some cases, examples of the ï¬tting under background hypotheses are also given.

8.1 Hypotheses ğ‘’+ğ‘’âˆ’ â†’ ğ‘‹ğ¾ Â±ğœ‹âˆ“, ğ‘‹ â†’ ğœ‹+ğœ‹âˆ’

8.1.1 Description of the ğ‘’+ğ‘’âˆ’ â†’ ğ‘‹ğ¾ Â±ğœ‹âˆ“, ğ‘‹ â†’ ğœ‹+ğœ‹âˆ’ hypotheses

Section 8.1 presents the results of applying the package of kinematic and vertex ï¬tting under two
charged conjugate hypotheses ğ‘’+ğ‘’âˆ’ â†’ ğ‘‹ğ¾ +ğœ‹âˆ’ and ğ‘’+ğ‘’âˆ’ â†’ ğ‘‹ğ¾ âˆ’ğœ‹+, where ğ‘‹ is an unknown
intermediate neutral particle decaying into two charged pions: ğ‘‹ â†’ ğœ‹+ğœ‹âˆ’. These hypotheses
were developed in order to select the events of the ğ‘’+ğ‘’âˆ’ â†’ ğ¾ğ‘†ğ¾ Â±ğœ‹âˆ“, ğ¾ğ‘† â†’ ğœ‹+ğœ‹âˆ’ process. The
particle ğ‘‹ is called unknown because the energy conservation constraints are not applied at the ğ‘’+ğ‘’âˆ’
interaction vertex and the decay vertex. The energy conservation constraint is applied only to ï¬nal
and initial particles in these hypotheses. Therefore, the mass of the particle ğ‘‹ is not contained in the
Lagrange function (2.1) and, as a consequence, does not participate in the constrained minimization
of the chi-square function (1.2). For this reason, the invariant mass of the ğ‘‹ decay products,
calculated using parameters obtained from the ï¬tting is not ï¬xed (e.g. on the ğ¾ğ‘† mass). For more
details, see sections 6.3.1, 7.1 and ï¬gure 3.

The hypotheses under discussion have the following structure.

â€¢ Each hypothesis has two vertices. The ï¬rst vertex is the ğ‘’+ğ‘’âˆ’ interaction vertex, the second
vertex is the decay vertex of the particle ğ‘‹. All coordinates of the ğ‘‹ decay vertex are free.
The ğ‘¥- and ğ‘¦- coordinates of the ğ‘’+ğ‘’âˆ’ interaction vertex are ï¬xed at the beam position, while
the ğ‘§-coordinate of this vertex is free. However, it should be reminded that ï¬xing vertex
coordinates does not mean disabling the corresponding vertex constraints for particles. In
the case of the ğ‘’+ğ‘’âˆ’ interaction vertex, all vertex constraints related to this vertex are still
required.

â€¢ Hypothesis ğ‘’+ğ‘’âˆ’ â†’ ğ‘‹ğ¾ +ğœ‹âˆ’, ğ‘‹ â†’ ğœ‹+ğœ‹âˆ’ requires the presence of four ï¬nal particles and one
intermediate particle ğ‘‹. The intermediate particle ğ‘‹ originates at the ğ‘’+ğ‘’âˆ’ interaction vertex
and decays at its decay vertex into two ï¬nal particles ğœ‹+ and ğœ‹âˆ’. Another ï¬nal ğœ‹âˆ’ comes from
the ğ‘’+ğ‘’âˆ’ interaction vertex. The ï¬nal ğ¾ + also originates at this vertex. The charge conjugate
hypothesis ğ‘’+ğ‘’âˆ’ â†’ ğ‘‹ğ¾ âˆ’ğœ‹+ diï¬€ers from the ğ‘’+ğ‘’âˆ’ â†’ ğ‘‹ğ¾ +ğœ‹âˆ’ hypothesis in that ğ¾ âˆ’ and ğœ‹+
ï¬‚y from the ğ‘’+ğ‘’âˆ’ interaction region instead of ğ¾ + and ğœ‹âˆ’. Both hypotheses also contain the
initial pseudo-particle that provides the ğ‘’+ğ‘’âˆ’ four-momentum (see section 6.1).

14By simulated events in this section, we mean the events of Monte Carlo simulation, which takes into account the

response of the CMD-3 detector.

â€“ 25 â€“

Table 1: Mappings between charged particles and their tracks in the case of the ğ‘’+ğ‘’âˆ’ â†’ ğ‘‹ğ¾ Â±ğœ‹âˆ“
hypotheses. 1 â€” the ğ‘’+ğ‘’âˆ’ interaction vertex, 2 â€” the ğ‘‹ â†’ ğœ‹+ğœ‹âˆ’ decay vertex, ğ‘¡+
2 are tracks
of positively charged particles, ğ‘¡âˆ’
2 are tracks of negatively charged particles.

1 and ğ‘¡âˆ’

1 and ğ‘¡+

Hypothesis
Origin vertex
Particle

Track com-
binations

ğ‘’+ğ‘’âˆ’ â†’ ğ‘‹ğ¾ +ğœ‹âˆ’

ğ‘’+ğ‘’âˆ’ â†’ ğ‘‹ğ¾ âˆ’ğœ‹+

1

2

1

2

ğ¾ +
ğ‘¡+
1
ğ‘¡+
1
ğ‘¡+
2
ğ‘¡+
2

ğœ‹âˆ’
ğ‘¡âˆ’
1
ğ‘¡âˆ’
2
ğ‘¡âˆ’
1
ğ‘¡âˆ’
2

ğœ‹+
ğ‘¡+
2
ğ‘¡+
2
ğ‘¡+
1
ğ‘¡+
1

ğœ‹âˆ’ ğ¾ âˆ’
ğ‘¡âˆ’
ğ‘¡âˆ’
1
2
ğ‘¡âˆ’
ğ‘¡âˆ’
1
1
ğ‘¡âˆ’
ğ‘¡âˆ’
2
2
ğ‘¡âˆ’
ğ‘¡âˆ’
2
1

ğœ‹+
ğ‘¡+
1
ğ‘¡+
2
ğ‘¡+
1
ğ‘¡+
2

ğœ‹+
ğ‘¡+
2
ğ‘¡+
1
ğ‘¡+
2
ğ‘¡+
1

ğœ‹âˆ’
ğ‘¡âˆ’
2
ğ‘¡âˆ’
2
ğ‘¡âˆ’
1
ğ‘¡âˆ’
1

â€¢ At each vertex, three-dimensional momentum conservation constraints are imposed.

In
total, each of two hypotheses has 6 constraints on the conservation of the three-dimensional
momentum components, i.e. three constraints per each vertex.

â€¢ Each hypothesis has only one energy conservation constraint. Only the ï¬nal particles and the

initial pseudo-particle are involved in this constraint.

â€¢ Each hypothesis requires three vertex constraints for each ï¬nal particle (one constraint for
each trajectory component). Three vertex constraints are also required for the intermediate
particle ğ‘‹. See, sections 6.2.1, 6.3.1 and 7.3 for more details. In total, each of two hypotheses
contains 15 vertex constraints.

In total, each of two discussed hypotheses contains 22 constraints. Each of the hypotheses contains
32 free parameters: 20 measurable and 12 non-measurable parameters.

8.1.2 Fitting procedure details
Further, the considered hypotheses are applied to the simulated events of the signal process ğ‘’+ğ‘’âˆ’ â†’
ğ¾ğ‘†ğ¾ Â±ğœ‹âˆ“ and the background process ğ‘’+ğ‘’âˆ’ â†’ ğœ‹+ğœ‹âˆ’ğœ‹+ğœ‹âˆ’. Only four-track events are used in order
to demonstrate how the ï¬tting works under the discussed hypotheses. Moreover, only such four
tracks are considered, which correspond to the total electric charge equal to zero. At the same time,
for demonstration purposes, the pre-separation of tracks into kaon and pion ones is not performed.
The presence of four charged particles implies the presence of combinatorics associated with the
fact that it is not known in advance which track from a certain event corresponds to one or another
charged particle. Therefore, it is necessary to perform a separate ï¬t for each mapping of particles
to their tracks. All possible variants of such mappings are given in table 1. The table shows for
each hypothesis there are four possible mappings of charged particles into tracks. Since it is not
known in advance which of the signal processes ğ‘’+ğ‘’âˆ’ â†’ ğ¾ğ‘†ğ¾ +ğœ‹âˆ’ or ğ‘’+ğ‘’âˆ’ â†’ ğ¾ğ‘†ğ¾ âˆ’ğœ‹+ took place
in a particular event, in each event the ï¬t is performed in both hypotheses ğ‘’+ğ‘’âˆ’ â†’ ğ‘‹ğ¾ Â±ğœ‹âˆ“. Thus,
in each event, the ï¬t is performed eight times.

In order to demonstrate how the ï¬tting works, for each hypothesis, among the four mappings
of particles to their tracks, the one in which the ï¬t gives the smallest chi-square is selected. Fits in
the charge conjugate hypotheses ğ‘’+ğ‘’âˆ’ â†’ ğ‘‹ğ¾ +ğœ‹âˆ’ and ğ‘’+ğ‘’âˆ’ â†’ ğ‘‹ğ¾ âˆ’ğœ‹+ give the same chi-square

â€“ 26 â€“

(a) Fit convergence histogram. The ï¬rst bin corre-
sponds to the number of the events, where at least
one of the ï¬ts converged to a local minimum. The
second bin corresponds to the number of the events,
where none of the ï¬ts converged. The third bin
corresponds to those events where among the con-
verging ï¬ts there are only those that have converged
to a local maximum.

(b) Chi-square distribution. This distribution cor-
responds to events in which the ï¬tting procedure
has converged to a local minimum, i.e. events from
the ï¬rst bin of the histogram in ï¬gure 4a.

Figure 4: Fit convergence histogram (a) and chi-square distribution (b) for the for the simulated
ğ‘’+ğ‘’âˆ’ â†’ ğ¾ğ‘†ğ¾ Â±ğœ‹âˆ“ events when ï¬tted to the ğ‘’+ğ‘’âˆ’ â†’ ğ‘‹ğ¾ Â±ğœ‹âˆ“, ğ‘‹ â†’ ğœ‹+ğœ‹âˆ’ hypotheses.

distribution when applied to signal15 events. Therefore, among these hypotheses, the hypothesis
corresponding to the minimum chi-square is selected16. It should be noted that only those ï¬ts that
have converged to a local minimum are accepted for consideration. If in the event none of the ï¬ts
converged to a local minimum, then such an event is ignored.

8.1.3 Fitting the ğ‘’+ğ‘’âˆ’ â†’ ğ¾ğ‘†ğ¾ Â±ğœ‹âˆ“ events

This subsection presents the results of the ï¬tting the simulated ğ‘’+ğ‘’âˆ’ â†’ ğ¾ğ‘†ğ¾ Â±ğœ‹âˆ“ events under the
ğ‘’+ğ‘’âˆ’ â†’ ğ‘‹ğ¾ Â±ğœ‹âˆ“, ğ‘‹ â†’ ğœ‹+ğœ‹âˆ’ hypotheses. The ğ‘’+ğ‘’âˆ’ â†’ ğ¾ğ‘†ğ¾ Â±ğœ‹âˆ“ events were simulated at the
center-of-mass energy of 1792.9 MeV and the magnetic ï¬eld of 1 T. 21281 four-track events were
passed to the input of the kinematic and vertex ï¬tting procedure 8.1.2. Figure 4a shows a histogram
with the number of events where the ï¬tting procedure converged to a local minimum (ï¬rst bin),
where the ï¬tting procedure did not converge (second bin), and where ï¬tting procedure converged to
a local maximum (third bin). Further, histograms like this one are called ï¬t convergence histograms.
The histogram contains one entry per each event. If at least one of the ï¬ts in the event converges
to a local minimum, then the event is included in the ï¬rst bin of the histogram.
If none of the
ï¬ts converged, then the event included in the second bin. If among all converged ï¬ts in the event
there are only those that converged to the local maximum, then the event is included in the second
bin. In the considered case, the ï¬rst bin contains 20794 events, the second bin contains 487 events,
and the third bin contains zero events. It should be noted that in 10374 out of 20794 events the
ï¬tting procedure converged to the ğ‘’+ğ‘’âˆ’ â†’ ğ‘‹ğ¾ +ğœ‹âˆ’ hypothesis, i.e.
the minimum chi-square in

15The signal events for the ğ‘’+ğ‘’âˆ’ â†’ ğ‘‹ğ¾+ğœ‹âˆ’ hypothesis are the events of the ğ‘’+ğ‘’âˆ’ â†’ ğ¾ğ‘† ğ¾+ğœ‹âˆ’ process, while the

signal events for the ğ‘’+ğ‘’âˆ’ â†’ ğ‘‹ğ¾âˆ’ğœ‹+ hypothesis are the events of the ğ‘’+ğ‘’âˆ’ â†’ ğ¾ğ‘† ğ¾âˆ’ğœ‹+ process.

16Thus, among the results of eight ï¬ts in each event, the result that corresponds to the minimum chi-square is accepted.

â€“ 27 â€“

0123errorcode01000020000Entries21281Mean0.0229StdDev0.14950100200Ï‡20500Entries20794Mean36.6562StdDev37.1907Figure 5: Invariant mass distributions of the intermediate particle decay products (ğ‘‹ â†’ ğœ‹+ğœ‹âˆ’).
The distributions shown in the ï¬gure were obtained for the simulated events of the ğ‘’+ğ‘’âˆ’ â†’
ğ¾ğ‘†ğ¾ Â±ğœ‹âˆ“ process. The dashed line corresponds to the invariant mass distribution obtained using the
parameters found with the ï¬ts under the ğ‘’+ğ‘’âˆ’ â†’ ğ‘‹ğ¾ Â±ğœ‹âˆ“ hypotheses. The solid line corresponds to
the invariant mass distribution obtained using the measured particle parameters, but the mappings
of the particles to their tracks were found using the ï¬tting procedure 8.1.2.

this hypothesis turned out to be less than in the ğ‘’+ğ‘’âˆ’ â†’ ğ‘‹ğ¾ âˆ’ğœ‹+ hypothesis. For the remaining
10420 events, the ï¬tting procedure converged to the ğ‘’+ğ‘’âˆ’ â†’ ğ‘‹ğ¾ âˆ’ğœ‹+ hypothesis. Further in this
subsection, we discuss only such distributions that correspond to events where at least one of the
ï¬ts converged to a local minimum, i.e. to the ï¬rst bin of the histogram from ï¬gure 4a. For example,
ï¬gure 4b shows the chi-square distribution for events where the ï¬tting procedure 8.1.2 converged
to a local minimum.

Figure 5 shows the invariant mass distributions of the two pions from the ğ‘‹ â†’ ğœ‹+ğœ‹âˆ’ decay. The
dashed line corresponds to the invariant mass distribution obtained using the particle parameters
found with the ï¬tting procedure 8.1.2. The solid line corresponds to the invariant mass distribution
obtained using the measured particle parameters, but the mappings of the particles to their tracks
were found with the ï¬tting procedure 8.1.2. It can be seen from the ï¬gure that the distribution
obtained using the particle parameters found with the ï¬tting procedure has a better resolution than
the distribution obtained using the measured particle parameters. The mean value of the invariant
mass for the both distributions is close to the ğ¾ğ‘† meson invariant mass. It should be noted that
the simulation of the ğ‘’+ğ‘’âˆ’ â†’ ğ¾ğ‘†ğ¾ Â±ğœ‹âˆ“ process takes into account the initial state radiation (ISR).
Since the ğ‘’+ğ‘’âˆ’ â†’ ğ‘‹ğ¾ Â±ğœ‹âˆ“ hypotheses do not take into account the ISR, the invariant mass obtained
using the particle parameters found with the ï¬tting procedure is slightly biased.

Figure 6 shows the coordinates of the vertices found with the ï¬tting procedure 8.1.2. In this
ï¬gure, ğ‘¥1, ğ‘¦1 and ğ‘§1 are the coordinates of the ğ‘’+ğ‘’âˆ’ interaction vertex, while ğ‘¥2, ğ‘¦2 and ğ‘§2 are the
coordinates of the ğ‘‹ â†’ ğœ‹+ğœ‹âˆ’ decay vertex. As already noted, the coordinates ğ‘¥1 and ğ‘¦1 of the ğ‘’+ğ‘’âˆ’

â€“ 28 â€“

0.400.450.500.550.60MÏ€+Ï€âˆ’(GeV/c2)0200400600Entries20794Mean0.4972StdDev0.0288Entries20794Mean0.5004StdDev0.0210beforeï¬tafterï¬tFigure 6: Distributions of vertex coordinates. These coordinates were found using the ï¬tting
procedure 8.1.2. The distributions correspond to the simulated ğ‘’+ğ‘’âˆ’ â†’ ğ¾ğ‘†ğ¾ Â±ğœ‹âˆ“ events. ğ‘¥1, ğ‘¦1
and ğ‘§1 are the ğ‘’+ğ‘’âˆ’ interaction vertex coordinates, while ğ‘¥2, ğ‘¦2 and ğ‘§2 are the ğ‘‹ â†’ ğœ‹+ğœ‹âˆ’ decay
vertex coordinates.

2

1

interaction vertex are ï¬xed at the beam position. All other vertex coordinates are free parameters.
In each event of the simulation, the coordinates of the ğ‘’+ğ‘’âˆ’ interaction vertex ğ’“sim

and the
ğ‘‹ â†’ ğœ‹+ğœ‹âˆ’ decay vertex ğ’“sim
are known. Since the coordinates of these vertices found using the
ï¬tting procedure are also known, it is possible to show the distributions of the diï¬€erence between the
coordinates found using the ï¬tting and the coordinates from the simulation. These distributions are
shown in ï¬gure 7. Figure 7a shows the diï¬€erence between the ğ‘§-coordinate of the ğ‘’+ğ‘’âˆ’ interaction
vertex found using the ï¬tting procedure and the same coordinate from the simulation. Figure 7b
shows a similar diï¬€erence in the ğ‘§-coordinates of the ğ‘‹ â†’ ğœ‹+ğœ‹âˆ’ decay vertex. Figures 7c and 7d
show the distributions of the similar diï¬€erences in the ğ‘¥-coordinates and ğ‘¦-coordinates of the
ğ‘‹ â†’ ğœ‹+ğœ‹âˆ’ decay vertex, respectively. From ï¬gures 7a and 7b, one can conclude that the accuracy
of ï¬nding the ğ‘§-coordinates of both vertices using the ï¬tting procedure is about 1 cm. At the
same time, it can be concluded from ï¬gures 7c and 7d that the accuracy of ï¬nding the ğ‘¥- and ğ‘¦-
coordinates of the ğ‘‹ â†’ ğœ‹+ğœ‹âˆ’ decay vertex is about 1 mm. It should be noted that the coordinates
found using the ï¬tting procedure turned out to be unshifted, at least within their resolution.

Since the coordinates of both vertices are known, the distances between these vertices can

â€“ 29 â€“

x1(cm)020000x2(cm)01000y1(cm)020000y2(cm)01000âˆ’10010z1(cm)0200âˆ’10010z2(cm)0200(a) The diï¬€erence between the ğ‘§-coordinate of the
ğ‘’+ğ‘’âˆ’ interaction vertex found with the ï¬tting pro-
cedure and the same coordinate obtained from the
simulation.

(b) The diï¬€erence between the ğ‘§-coordinate of the
ğ‘‹ â†’ ğœ‹+ğœ‹âˆ’ decay vertex found with the ï¬tting pro-
cedure and the same coordinate obtained from the
simulation.

(c) The diï¬€erence between the ğ‘¥-coordinate of the
ğ‘‹ â†’ ğœ‹+ğœ‹âˆ’ decay vertex found with the ï¬tting pro-
cedure and the same coordinate obtained from the
simulation.

(d) The diï¬€erence between the ğ‘¦-coordinate of the
ğ‘‹ â†’ ğœ‹+ğœ‹âˆ’ decay vertex found with the ï¬tting pro-
cedure and the same coordinate obtained from the
simulation.

Figure 7: Distributions of the diï¬€erences between the vertex coordinates found using the ï¬tting
procedure 8.1.2 and the vertex coordinates from the simulation. These distributions obtained for
the events of the ğ‘’+ğ‘’âˆ’ â†’ ğ¾ğ‘†ğ¾ Â±ğœ‹âˆ“ simulation.

2 âˆ’ ğ’“ï¬t

1 be the interaction vertex found using the ï¬tting procedure, and ğ’“ï¬t

be calculated. Let ğ’“ï¬t
2 be the
ğ‘‹ â†’ ğœ‹+ğœ‹âˆ’ decay vertex also found using the same procedure. The distance between these vertices
is then calculated using the formula: Î”ğ‘Ÿï¬t = (cid:107) ğ’“ï¬t
1 (cid:107). Similarly, it is possible to calculate the
distance between these vertices obtained from the simulation: Î”ğ‘Ÿsim = (cid:107) ğ’“sim
1 (cid:107). Figure 8
shows the distribution of the diï¬€erence between the distances Î”ğ‘Ÿï¬t and Î”ğ‘Ÿsim. It can be seen from
the ï¬gure that in the case of the CMD-3 experiment, the ï¬tting procedure makes it possible to ï¬nd
the distance between the vertices with an accuracy of about 3.5 mm. In fact, this accuracy is even
slightly better, since the distribution shown in the ï¬gure has non-Gaussian tails, which increase the
standard deviation. These tails can be signiï¬cantly suppressed by the chi-square selection criterion.
The distribution of the distance Î”ğ‘Ÿï¬t between the vertices is shown in ï¬gure 9a.

2 âˆ’ ğ’“sim

The kinematic ï¬tting technique makes it possible to separate charged kaons from pions, since

â€“ 30 â€“

âˆ’505âˆ†z1(cm)05001000Entries20794Mean-0.0031StdDev0.9354âˆ’505âˆ†z2(cm)0500Entries20794Mean-0.0087StdDev0.8838âˆ’0.50.00.5âˆ†x2(cm)05001000Entries20794Mean0.0007StdDev0.1069âˆ’0.50.00.5âˆ†y2(cm)05001000Entries20794Mean-0.0003StdDev0.1070Figure 8: Distribution of the diï¬€erence Î”ğ‘Ÿï¬tâˆ’Î”ğ‘Ÿsim for the simulated events of the ğ‘’+ğ‘’âˆ’ â†’ ğ¾ğ‘†ğ¾ Â±ğœ‹âˆ“
process. Î”ğ‘Ÿï¬t is the distance between the ğ‘’+ğ‘’âˆ’ interaction vertex and the ğ‘‹ â†’ ğœ‹+ğœ‹âˆ’ decay vertex,
found using the ï¬tting procedure 8.1.2. Î”ğ‘Ÿsim is the same distance obtained from the simulation.

the masses of these particles diï¬€er signiï¬cantly. However, this technique does not allow achieving
the desired level of the ğ¾-ğœ‹ separation17. For example, in the case of ï¬tting the ğ‘’+ğ‘’âˆ’ â†’ ğ¾ğ‘†ğ¾ Â±ğœ‹âˆ“
events under the ğ‘’+ğ‘’âˆ’ â†’ ğ‘‹ğ¾ Â±ğœ‹âˆ“ hypotheses, kaons and pions can be mixed up at the ğ‘’+ğ‘’âˆ’
interaction vertex. These entanglements can be seen in ï¬gures 9b and 9c. The ï¬gures show the
dependencies of ğ‘‘ğ¸/ğ‘‘ğ‘¥ on the particle momentum for those particles that the ï¬tting procedure
identiï¬ed as kaons and pions. Figure 9b corresponds to particles that have been identiï¬ed as kaons,
while ï¬gure 9c corresponds to pions.
In each of the ï¬gures, one can see typical dependencies
corresponding to both particle types (true kaons and pions). Figure 9d shows the dependence
of ğ‘‘ğ¸/ğ‘‘ğ‘¥ on the particle momentum for those particles that were identiï¬ed as pions from the
ğ‘‹ â†’ ğœ‹+ğœ‹âˆ’ decay. In this ï¬gure, one can see only a typical dependence corresponding to true pions.
Thus, we can conclude that in this case there is a signiï¬cant entanglement of kaons and pions at the
ğ‘’+ğ‘’âˆ’ interaction vertex, while pions from the ğ‘‹ â†’ ğœ‹+ğœ‹âˆ’ decay are not mixed up with kaons.

Figures 9e and 9f show histograms from which one can conclude about the proportion of
events in which the ï¬tting procedure 8.1.2 led to an incorrect signal hypothesis. The histogram
in ï¬gure 9e was obtained using the simulated ğ‘’+ğ‘’âˆ’ â†’ ğ¾ğ‘†ğ¾ +ğœ‹âˆ’ events, while the histogram in
ï¬gure 9f was obtained using the simulated ğ‘’+ğ‘’âˆ’ â†’ ğ¾ğ‘†ğ¾ âˆ’ğœ‹+ events. Both histograms show the
number of events in which the ï¬tting procedure chose the ğ‘’+ğ‘’âˆ’ â†’ ğ‘‹ğ¾ +ğœ‹âˆ’ hypothesis or the
ğ‘’+ğ‘’âˆ’ â†’ ğ‘‹ğ¾ âˆ’ğœ‹+ hypothesis. The ï¬rst bin in both histograms corresponds to the number of events
for the ğ‘’+ğ‘’âˆ’ â†’ ğ‘‹ğ¾ +ğœ‹âˆ’ hypothesis, while the second bin corresponds to the number of events for
the ğ‘’+ğ‘’âˆ’ â†’ ğ‘‹ğ¾ âˆ’ğœ‹+ hypothesis. In the case of the ğ‘’+ğ‘’âˆ’ â†’ ğ¾ğ‘†ğ¾ +ğœ‹âˆ’ process, the correct signal
hypothesis is the ğ‘’+ğ‘’âˆ’ â†’ ğ‘‹ğ¾ +ğœ‹âˆ’. In the case of the ğ‘’+ğ‘’âˆ’ â†’ ğ¾ğ‘†ğ¾ âˆ’ğœ‹+ process, the correct signal
hypothesis is the ğ‘’+ğ‘’âˆ’ â†’ ğ‘‹ğ¾ âˆ’ğœ‹+. Both ï¬gures show that the ï¬tting procedure led to the correct

17At least when using the considered hypotheses.

â€“ 31 â€“

âˆ’2âˆ’1012âˆ†rï¬tâˆ’âˆ†rsim(cm)02004006008001000Entries20794Mean0.0009StdDev0.3513(a) Distribution of the distance between the ğ‘’+ğ‘’âˆ’
interaction vertex and the ğ‘‹ â†’ ğœ‹+ğœ‹âˆ’ decay vertex.
The distance between the vertices was found using
the ï¬tting procedure.

(b) Dependence of ğ‘‘ğ¸/ğ‘‘ğ‘¥ on the momentum of par-
ticles identiï¬ed by the ï¬tting procedure as kaons.

(c) Dependence of ğ‘‘ğ¸/ğ‘‘ğ‘¥ on the momentum of
particles identiï¬ed by the ï¬tting procedure as pions
from the ğ‘’+ğ‘’âˆ’ interaction vertex.

(d) Dependence of ğ‘‘ğ¸/ğ‘‘ğ‘¥ on the momentum of
particles identiï¬ed by the ï¬tting procedure as pions
from the ğ‘‹ â†’ ğœ‹+ğœ‹âˆ’ decay vertex.

(e) The ï¬rst bin is the number of events with the
best chi-square obtained with the ğ‘’+ğ‘’âˆ’ â†’ ğ‘‹ğ¾ +ğœ‹âˆ’
hypothesis, the second bin is the number of events
with the best chi-square obtained with the ğ‘’+ğ‘’âˆ’ â†’
ğ‘‹ğ¾ âˆ’ğœ‹+ hypothesis. The histograms corresponds to
the events of the ğ‘’+ğ‘’âˆ’ â†’ ğ¾ğ‘†ğ¾ +ğœ‹âˆ’ process.

(f) The ï¬rst bin is the number of events with the
best chi-square obtained with the ğ‘’+ğ‘’âˆ’ â†’ ğ‘‹ğ¾ +ğœ‹âˆ’
hypothesis, the second bin is the number of events
with the best chi-square obtained with the ğ‘’+ğ‘’âˆ’ â†’
ğ‘‹ğ¾ âˆ’ğœ‹+ hypothesis. The histograms corresponds to
the events of the ğ‘’+ğ‘’âˆ’ â†’ ğ¾ğ‘†ğ¾ âˆ’ğœ‹+ process.

Figure 9: Some distributions obtained as a result of applying the ï¬tting procedure 8.1.2 to the
simulated ğ‘’+ğ‘’âˆ’ â†’ ğ¾ğ‘†ğ¾ Â±ğœ‹âˆ“ events. The units of ğ‘‘ğ¸/ğ‘‘ğ‘¥ in ï¬gures (b), (c) and (d) are conditional.

â€“ 32 â€“

051015âˆ†rï¬t(cm)05001000Entries20794Mean2.1551StdDev2.10670.250.500.75P(GeV/c)50001000015000dE/dx(CU)0200.250.500.75P(GeV/c)50001000015000dE/dx(CU)010200.250.500.75P(GeV/c)50001000015000dE/dx(CU)01020012025005000Entries10318Mean0.3347StdDev0.4719012025005000Entries10476Mean0.6650StdDev0.4720(a) This histogram corresponds to the simulated
ğ‘’+ğ‘’âˆ’ â†’ ğ¾ğ‘†ğ¾ Â±ğœ‹âˆ“ events in which the ï¬tting pro-
cedure 8.1.2 converged to the incorrect signal hy-
pothesis.

(b) This histogram corresponds to the simulated
ğ‘’+ğ‘’âˆ’ â†’ ğ¾ğ‘†ğ¾ Â±ğœ‹âˆ“ events in which the ï¬tting proce-
dure 8.1.2 converged to the correct signal hypothe-
sis.

Figure 10: Invariant mass distributions of the intermediate particle decay products (ğ‘‹ â†’ ğœ‹+ğœ‹âˆ’).
The distributions shown in the ï¬gure were obtained for the simulated events of the ğ‘’+ğ‘’âˆ’ â†’
ğ¾ğ‘†ğ¾ Â±ğœ‹âˆ“ process. The dashed line corresponds to the invariant mass distribution obtained using the
parameters found with the ï¬ts under the ğ‘’+ğ‘’âˆ’ â†’ ğ‘‹ğ¾ Â±ğœ‹âˆ“ hypotheses. The solid line corresponds to
the invariant mass distribution obtained using the measured particle parameters, but the mappings
of the particles to their tracks were found using the ï¬tting procedure 8.1.2.

hypothesis in about 2/3 of the events, while in the rest of the events this procedure led to the wrong
hypothesis. Thus, one can see that the proportion of events with mixed up kaons and pions from
the ğ‘’+ğ‘’âˆ’ interaction vertex is quite large.

It should be noted that the entanglement of kaons and pions has a dramatic eï¬€ect on the
results of the ï¬tting procedure 8.1.2. This entanglement leads to a signiï¬cant distortion of the
ï¬tting parameters. In the considered case, not only the parameters of particles ï¬‚ying from the ğ‘’+ğ‘’âˆ’
interaction vertex are distorted, but also the parameters of pions from the ğ‘‹ â†’ ğœ‹+ğœ‹âˆ’ decay vertex.
This happens because the parameters of diï¬€erent particles are related through the constraints.
Figures 10a and 10b show the distributions of the invariant masses of pions from the ğ‘‹ â†’ ğœ‹+ğœ‹âˆ’
decay. Both ï¬gures were obtained using the ğ‘’+ğ‘’âˆ’ â†’ ğ¾ğ‘†ğ¾ Â±ğœ‹âˆ“ simulation events. However,
ï¬gure 10a was obtained for events in which the ï¬tting procedure chose the wrong signal hypothesis,
and ï¬gure 10b corresponds to those events in which the signal hypothesis was chosen correctly. It
can be seen from these ï¬gures that the resolution of the invariant mass is signiï¬cantly worse if the
signal hypothesis was chosen incorrectly.

Thus, one can conclude that an additional ğ¾-ğœ‹ separation procedure is required to avoid the
entanglement of kaons and pions. This procedure may be based on the use of ğ‘‘ğ¸/ğ‘‘ğ‘¥, for example.
The ğ¾-ğœ‹ separation procedure must be used before the kinematic and vertex ï¬tting. After performing
such a procedure, it will be known which tracks correspond to kaons with the highest probability.
Thus, in each event, one know the mapping of the kaon to its track. The sign of the kaon charge

â€“ 33 â€“

0.40.50.6MÏ€+Ï€âˆ’(GeV/c2)0100200Entries6962Mean0.4939StdDev0.0334Entries6962Mean0.5001StdDev0.0285beforeï¬tafterï¬t0.40.50.6MÏ€+Ï€âˆ’(GeV/c2)0250500Entries13832Mean0.4987StdDev0.0264Entries13832Mean0.5005StdDev0.0164beforeï¬tafterï¬tdetermines the signal hypothesis that will be used for the ï¬tting in a certain event. As a result, the
number of ï¬ts in a single event can be signiï¬cantly reduced. Instead of mappings from table 1, it
is enough to consider only permutations of tracks for the pions of the same charge, i.e. there will
be only two ï¬ts per event. Among these two ï¬ts, as in the case of ï¬tting procedure 8.1.2, one can
choose the ï¬t with the smallest chi-square.

In this work, we do not use any additional ğ¾-ğœ‹ separation procedure, but for demonstration
purposes we can use the fact that in each event of the simulation we know which of the ï¬nal states
ğ¾ğ‘†ğ¾ +ğœ‹âˆ’ or ğ¾ğ‘†ğ¾ âˆ’ğœ‹+ occurred. Thus, it is possible to run ï¬tting procedure for each event of the
ğ‘’+ğ‘’âˆ’ â†’ ğ¾ğ‘†ğ¾ Â±ğœ‹âˆ“ simulation under the right signal hypothesis. For a given signal hypothesis, it
is necessary to consider only four mappings from table 1, i.e. do four ï¬ts in each event. Using
the correct signal hypothesis in each event eliminates the entanglement of kaons and pions at the
ğ‘’+ğ‘’âˆ’ interaction vertex. Taking into account that there is also no entanglement of kaons and pions
from the ğ‘‹ â†’ ğœ‹+ğœ‹âˆ’ decay (see ï¬gure 9d), it can be obtained that with this approach there is no
entanglement of kaons and pions. The ï¬tting procedure in this case converges to a local minimum in
20519 events out of 21281, i.e. in most events where the wrong hypothesis was previously chosen,
there was a ï¬t under the correct hypothesis with a slightly larger chi-square. The ï¬t convergence
histogram corresponding to the considered approach is shown in ï¬gure 11a. The corresponding
chi-square distribution is shown in ï¬gure 11b. In this case, the distribution of the distance between
the vertices does not change signiï¬cantly and is shown in ï¬gure 11c. To conï¬rm that kaons and
pions are not mixed up, ï¬gures 11d, 11e, and 11f show the dependencies of ğ‘‘ğ¸/ğ‘‘ğ‘¥ on the particle
momentum, similar to those shown in ï¬gures 9b, 9c, and 9d, respectively. Figure 12 shows the
distributions of the invariant mass of pions from the ğ‘‹ â†’ ğœ‹+ğœ‹âˆ’ decay. Unlike ï¬gure 5, ï¬gure 12
was obtained by ï¬tting each simulation event using the correct signal hypothesis only. It can be
seen from ï¬gure 12 that the distribution of the invariant mass obtained using the pion parameters
after ï¬tting has somewhat changed compared to the similar distribution shown in ï¬gure 5 (see
dashed line). So the left slope of the peak became steeper, and the peak itself is slightly higher,
which indicates a slight increase in mass resolution. However, the distribution in ï¬gure 12 has
non-Gaussian tails, as in the case of a similar distribution in ï¬gure 5, which leads to the fact that
the standard deviations for the histograms in both ï¬gures are the same.

8.1.4 Fitting the ğ‘’+ğ‘’âˆ’ â†’ ğœ‹+ğœ‹âˆ’ğœ‹+ğœ‹âˆ’ events

This subsection provides an example of applying the ï¬tting procedure 8.1.2 under the ğ‘’+ğ‘’âˆ’ â†’
ğ‘‹ğ¾ Â±ğœ‹âˆ“, ğ‘‹ â†’ ğœ‹+ğœ‹âˆ’ hypotheses to the simulated ğ‘’+ğ‘’âˆ’ â†’ ğœ‹+ğœ‹âˆ’ğœ‹+ğœ‹âˆ’ events. The process ğ‘’+ğ‘’âˆ’ â†’
ğœ‹+ğœ‹âˆ’ğœ‹+ğœ‹âˆ’ is one of the main background processes in the study of the ğ‘’+ğ‘’âˆ’ â†’ ğ¾ğ‘†ğ¾ Â±ğœ‹âˆ“ process
with the CMD-3 detector. It should be noted that the ğ‘’+ğ‘’âˆ’ â†’ ğœ‹+ğœ‹âˆ’ğœ‹+ğœ‹âˆ’ process does not contain
charged kaons in the ï¬nal state and, therefore, is also a background process with respect to the
ğ‘’+ğ‘’âˆ’ â†’ ğ‘‹ğ¾ Â±ğœ‹âˆ“ hypotheses.

Figure 13a shows the ï¬t convergence histogram for the events of the ğ‘’+ğ‘’âˆ’ â†’ ğœ‹+ğœ‹âˆ’ğœ‹+ğœ‹âˆ’
simulation. It can be seen from the ï¬gure that the ï¬tting procedure in most events converged to
a local minimum. Note, however, that in this case the ï¬tting procedure 8.1.2 does not have to
converge to a local minimum, since the ğ‘’+ğ‘’âˆ’ â†’ ğœ‹+ğœ‹âˆ’ğœ‹+ğœ‹âˆ’ is the background process for the
ğ‘’+ğ‘’âˆ’ â†’ ğ‘‹ğ¾ Â±ğœ‹âˆ“ hypotheses.

â€“ 34 â€“

(a) Fit convergence histogram. See description in
ï¬gure 4a.

(b) Chi-square distribution.

(c) Distribution of the distance between the ğ‘’+ğ‘’âˆ’
interaction vertex and the ğ‘‹ â†’ ğœ‹+ğœ‹âˆ’ decay vertex.

(d) Dependence of ğ‘‘ğ¸/ğ‘‘ğ‘¥ on the momentum of par-
ticles identiï¬ed by the ï¬tting procedure as kaons.

(e) Dependence of ğ‘‘ğ¸/ğ‘‘ğ‘¥ on the momentum of
particles identiï¬ed by the ï¬tting procedure as pions
from the ğ‘’+ğ‘’âˆ’ interaction vertex.

(f) Dependence of ğ‘‘ğ¸/ğ‘‘ğ‘¥ on the momentum of
particles identiï¬ed by the ï¬tting procedure as pions
from the ğ‘‹ â†’ ğœ‹+ğœ‹âˆ’ decay vertex.

Figure 11: Some distributions obtained as a result of applying the ï¬tting procedure to the events
of the ğ‘’+ğ‘’âˆ’ â†’ ğ¾ğ‘†ğ¾ Â±ğœ‹âˆ“ simulation. Each event was ï¬tted only using the correct signal hypothesis
(ğ‘’+ğ‘’âˆ’ â†’ ğ‘‹ğ¾ +ğœ‹âˆ’ or ğ‘’+ğ‘’âˆ’ â†’ ğ‘‹ğ¾ âˆ’ğœ‹+), i.e. the hypothesis determined from the simulation.

â€“ 35 â€“

0123errorcode01000020000Entries21281Mean0.0358StdDev0.18580100200Ï‡20500Entries20519Mean37.1324StdDev37.4666051015âˆ†rï¬t(cm)05001000Entries21281Mean2.1091StdDev2.05270.250.500.75P(GeV/c)50001000015000dE/dx(CU)0200.250.500.75P(GeV/c)50001000015000dE/dx(CU)01020300.250.500.75P(GeV/c)50001000015000dE/dx(CU)01020Figure 12: Invariant mass distributions of the intermediate particle decay products (ğ‘‹ â†’ ğœ‹+ğœ‹âˆ’).
The distributions shown in the ï¬gure were obtained for the simulated events of the ğ‘’+ğ‘’âˆ’ â†’
ğ¾ğ‘†ğ¾ Â±ğœ‹âˆ“ process. The dashed line corresponds to the invariant mass distribution obtained using the
parameters found with the ï¬ts under the ğ‘’+ğ‘’âˆ’ â†’ ğ‘‹ğ¾ Â±ğœ‹âˆ“ hypotheses. The solid line corresponds to
the invariant mass distribution obtained using the measured particle parameters, but the mappings
of the particles to their tracks were found using the ï¬tting procedure. In the case of this ï¬gure, in
each event only the correct signal hypothesis (ğ‘’+ğ‘’âˆ’ â†’ ğ‘‹ğ¾ +ğœ‹âˆ’ or ğ‘’+ğ‘’âˆ’ â†’ ğ‘‹ğ¾ âˆ’ğœ‹+) is used, i.e. the
hypothesis determined from the simulation.

(a) Fit convergence histogram. See description in
ï¬gure 4a.

(b) Chi-square distribution.

Figure 13: Fit convergence histogram (a) and chi-square distribution (b) obtained by applying the
ï¬tting procedure 8.1.2 to the simulated ğ‘’+ğ‘’âˆ’ â†’ ğœ‹+ğœ‹âˆ’ğœ‹+ğœ‹âˆ’ events.

â€“ 36 â€“

0.400.450.500.550.60MÏ€+Ï€âˆ’(GeV/c2)0200400600Entries20519Mean0.4970StdDev0.0286Entries20519Mean0.5033StdDev0.0210beforeï¬tafterï¬t0123errorcode02000040000Entries44160Mean0.0203StdDev0.14100200400600Ï‡20500Entries43264Mean219.7339StdDev114.8120Figure 14: Distribution of the distance between the ğ‘’+ğ‘’âˆ’ interaction vertex and the ğ‘‹ â†’ ğœ‹+ğœ‹âˆ’
decay vertex, obtained as a result of applying the ï¬tting procedure 8.1.2 to the simulated ğ‘’+ğ‘’âˆ’ â†’
ğœ‹+ğœ‹âˆ’ğœ‹+ğœ‹âˆ’ events.

Figure 13b shows the chi-square distribution obtained by applying the ï¬tting procedure to the
events of the ğ‘’+ğ‘’âˆ’ â†’ ğœ‹+ğœ‹âˆ’ğœ‹+ğœ‹âˆ’ simulation. Since the ğ‘’+ğ‘’âˆ’ â†’ ğœ‹+ğœ‹âˆ’ğœ‹+ğœ‹âˆ’ is the background
process with respect to the considered hypotheses, the chi-square distribution turned out to be wide
(compare with ï¬gure 4b).

Figure 14 shows the distribution of the distance Î”ğ‘Ÿï¬t between the ğ‘’+ğ‘’âˆ’ interaction vertex and
the ğ‘‹ â†’ ğœ‹+ğœ‹âˆ’ decay vertex. The distribution was obtained for the ğ‘’+ğ‘’âˆ’ â†’ ğœ‹+ğœ‹âˆ’ğœ‹+ğœ‹âˆ’ events using
the ï¬tting procedure 8.1.2. The distance is calculated using the vertex coordinates found as a result
of the ï¬tting. Since in the ğ‘’+ğ‘’âˆ’ â†’ ğœ‹+ğœ‹âˆ’ğœ‹+ğœ‹âˆ’ process all pions originate from the ğ‘’+ğ‘’âˆ’ interaction
vertex, the large Î”ğ‘Ÿï¬t distances are not expected. Indeed, it can be seen from the ï¬gure that most of
the events belong to region Î”ğ‘Ÿï¬t (cid:46) 4 mm.

Finally, we can conclude that the chi-square and Î”ğ‘Ÿï¬t distributions can be successfully used
to select the events of the ğ‘’+ğ‘’âˆ’ â†’ ğ¾ğ‘†ğ¾ Â±ğœ‹âˆ“ process and suppress the corresponding background
processes, such as the ğ‘’+ğ‘’âˆ’ â†’ ğœ‹+ğœ‹âˆ’ğœ‹+ğœ‹âˆ’ process.

8.2 Hypotheses ğ‘’+ğ‘’âˆ’ â†’ ğ¾ğ‘†ğ¾ Â±ğœ‹âˆ“, ğ¾ğ‘† â†’ ğœ‹+ğœ‹âˆ’

8.2.1 Description of the ğ‘’+ğ‘’âˆ’ â†’ ğ¾ğ‘†ğ¾ Â±ğœ‹âˆ“ hypotheses

In section 8.2 we present the results of ï¬tting under ğ‘’+ğ‘’âˆ’ â†’ ğ¾ğ‘†ğ¾ Â±ğœ‹âˆ“, ğ¾ğ‘† â†’ ğœ‹+ğœ‹âˆ’ hypotheses.
The diï¬€erence between section 8.1 and this section is that in this section the intermediate neutral
particle (ğ¾ğ‘†) is known. By the fact that the intermediate particle is known, we mean that this particle
directly participates in the energy conservation constraints, i.e. its mass inï¬‚uences the ï¬tting results.
The energy-momentum conservation constraint tree corresponding to the ğ‘’+ğ‘’âˆ’ â†’ ğ¾ğ‘†ğ¾ +ğœ‹âˆ’, ğ¾ğ‘† â†’
ğœ‹+ğœ‹âˆ’ hypothesis has the form shown in ï¬gure 2. For the charge-conjugate hypothesis, there is
a similar tree, but with oppositely charged particles. Thus, energy conservation constraints are

â€“ 37 â€“

0.00.20.40.60.81.0âˆ†rï¬t(cm)025050075010001250Entries44160Mean0.2465StdDev0.1868(a) Fit convergence histogram. See description in
ï¬gure 4a.

(b) Chi-square distribution.

Figure 15: Fit convergence histogram (a) and chi-square distribution (b) obtained using the ï¬tting
procedure under the ğ‘’+ğ‘’âˆ’ â†’ ğ¾ğ‘†ğ¾ Â±ğœ‹âˆ“, ğ¾ğ‘† â†’ ğœ‹+ğœ‹âˆ’ hypotheses. Both histograms correspond to
the events of the ğ‘’+ğ‘’âˆ’ â†’ ğ¾ğ‘†ğ¾ Â±ğœ‹âˆ“ simulation.

imposed in each of the two vertices and include all particles related with one or another vertex.
This is the only diï¬€erence between the hypotheses ğ‘’+ğ‘’âˆ’ â†’ ğ¾ğ‘†ğ¾ Â±ğœ‹âˆ“ and ğ‘’+ğ‘’âˆ’ â†’ ğ‘‹ğ¾ Â±ğœ‹âˆ“ (see
subsection 8.1.1).

The ï¬tting procedure with the ğ‘’+ğ‘’âˆ’ â†’ ğ¾ğ‘†ğ¾ +ğœ‹âˆ’ hypotheses is completely similar to the
ï¬tting procedure 8.1.2 with the ğ‘’+ğ‘’âˆ’ â†’ ğ‘‹ğ¾ Â±ğœ‹âˆ“ hypotheses. This procedure does not contain any
additional ğ¾-ğœ‹ pre-separation algorithm and is used for demonstration purposes only.

Subsections 8.2.2 and 8.2.3 show the results of the ï¬tting the ğ‘’+ğ‘’âˆ’ â†’ ğ¾ğ‘†ğ¾ Â±ğœ‹âˆ“ events and the

events of the background process ğ‘’+ğ‘’âˆ’ â†’ ğœ‹+ğœ‹âˆ’ğœ‹+ğœ‹âˆ’.

8.2.2 Fitting the ğ‘’+ğ‘’âˆ’ â†’ ğ¾ğ‘†ğ¾ Â±ğœ‹âˆ“ events

This subsection discusses the results of applying the ï¬tting procedure under the ğ‘’+ğ‘’âˆ’ â†’ ğ¾ğ‘†ğ¾ Â±ğœ‹âˆ“
hypotheses to the events of the ğ‘’+ğ‘’âˆ’ â†’ ğ¾ğ‘†ğ¾ Â±ğœ‹âˆ“ process. Since the ï¬tting with the ğ‘’+ğ‘’âˆ’ â†’
ğ¾ğ‘†ğ¾ Â±ğœ‹âˆ“ hypotheses imposes tighter constraints than the ï¬tting with the ğ‘’+ğ‘’âˆ’ â†’ ğ‘‹ğ¾ Â±ğœ‹âˆ“ hypothe-
ses, it is expected that in this case the ï¬tting procedure will converge to a local minimum less often.
This fact can be observed from the ï¬t convergence histogram shown in ï¬gure 15a. This ï¬gure
was obtained under conditions similar to those in ï¬gure 4a, but corresponds to the ï¬tting under the
ğ‘’+ğ‘’âˆ’ â†’ ğ¾ğ‘†ğ¾ Â±ğœ‹âˆ“ hypotheses. Figure 15a indeed shows that the ï¬tting procedure converged to a
local minimum for fewer events than in the case of ï¬gure 4a, which corresponds to the ï¬tting under
the ğ‘’+ğ‘’âˆ’ â†’ ğ‘‹ğ¾ Â±ğœ‹âˆ“ hypotheses.

Figure 15b shows the chi-square distribution for the events of the ğ‘’+ğ‘’âˆ’ â†’ ğ¾ğ‘†ğ¾ Â±ğœ‹âˆ“ simulation.
This distribution corresponds to the ğ‘’+ğ‘’âˆ’ â†’ ğ¾ğ‘†ğ¾ Â±ğœ‹âˆ“ hypotheses. Figure 15b shows that the
distribution has become slightly wider than in the case of ï¬gure 4b. This is due to the fact that
in the ğ‘’+ğ‘’âˆ’ â†’ ğ¾ğ‘†ğ¾ Â±ğœ‹âˆ“ hypotheses there is one more energy conservation constraint than in the
ğ‘’+ğ‘’âˆ’ â†’ ğ‘‹ğ¾ Â±ğœ‹âˆ“ hypotheses.

Figure 16 shows the two-pion invariant mass distribution. Only pions from the ğ¾ğ‘† â†’ ğœ‹+ğœ‹âˆ’
decay are taken into account. As in the case of ï¬gure 5, the solid line denotes the invariant mass dis-
tribution obtained using the measured pion parameters, however, pions from the ğ¾ğ‘† â†’ ğœ‹+ğœ‹âˆ’ decay

â€“ 38 â€“

0123errorcode01000020000Entries21281Mean0.0286StdDev0.16670100200Ï‡20250500Entries20672Mean39.5536StdDev38.2701Figure 16: Invariant mass distributions of the intermediate particle decay products (ğ¾ğ‘† â†’ ğœ‹+ğœ‹âˆ’).
The distributions shown in the ï¬gure were obtained for the simulated events of the ğ‘’+ğ‘’âˆ’ â†’
ğ¾ğ‘†ğ¾ Â±ğœ‹âˆ“ process. The dashed line corresponds to the invariant mass distribution obtained using the
parameters found with the ï¬ts under the ğ‘’+ğ‘’âˆ’ â†’ ğ¾ğ‘†ğ¾ Â±ğœ‹âˆ“ hypotheses. The solid line corresponds
to the invariant mass distribution obtained using the measured particle parameters, but the mappings
of the particles to their tracks were found using the ï¬tting procedure.

were found using the ï¬tting procedure. The dashed line indicates the invariant mass distribution
obtained using the pion parameters found with the ï¬tting procedure. Since the intermediate particle
(ğ¾ğ‘†) in the considered hypotheses has a certain mass and participates in the energy conservation
constraints, the last distribution turned out to be ï¬xed on the value of this mass.

8.2.3 Fitting the ğ‘’+ğ‘’âˆ’ â†’ ğœ‹+ğœ‹âˆ’ğœ‹+ğœ‹âˆ’ events

This subsection discusses the results of applying the ï¬tting procedure under the ğ‘’+ğ‘’âˆ’ â†’ ğ¾ğ‘†ğ¾ Â±ğœ‹âˆ“
hypotheses to the simulated events of the background process ğ‘’+ğ‘’âˆ’ â†’ ğœ‹+ğœ‹âˆ’ğœ‹+ğœ‹âˆ’. Figure 17a shows
the corresponding ï¬t convergence histogram, while ï¬gure 17b shows the chi-square distribution.
Since the background events are considered, the last distribution turned out to be much wider than
the similar distribution for the signal events shown in ï¬gure 15b. The chi-square distribution is
even broader than the similar distribution for the ğ‘’+ğ‘’âˆ’ â†’ ğœ‹+ğœ‹âˆ’ğœ‹+ğœ‹âˆ’ events corresponding to the
ğ‘’+ğ‘’âˆ’ â†’ ğ‘‹ğ¾ Â±ğœ‹âˆ“ hypotheses and shown in ï¬gure 13b. The last statement is due to the fact that the
ğ‘’+ğ‘’âˆ’ â†’ ğ¾ğ‘†ğ¾ Â±ğœ‹âˆ“ contain more constraints than the ğ‘’+ğ‘’âˆ’ â†’ ğ‘‹ğ¾ Â±ğœ‹âˆ“ hypotheses.

Figure 18 shows the distance Î”ğ‘Ÿï¬t between the ğ‘’+ğ‘’âˆ’ interaction vertex and the ğ¾ğ‘† â†’ ğœ‹+ğœ‹âˆ’
decay vertex. As in the case of similar distributions in ï¬gures 9a and 14, this distribution was
obtained using the coordinates of the vertices found with the ï¬tting procedure. Since in this case
the ï¬tting under the ğ‘’+ğ‘’âˆ’ â†’ ğ¾ğ‘†ğ¾ Â±ğœ‹âˆ“ is applied to the ğ‘’+ğ‘’âˆ’ â†’ ğœ‹+ğœ‹âˆ’ğœ‹+ğœ‹âˆ’ events, the distances
in ï¬gure 18 is on average smaller than in ï¬gure 9a. However, these distances are larger than in
ï¬gure 14, which also corresponds to the ğ‘’+ğ‘’âˆ’ â†’ ğœ‹+ğœ‹âˆ’ğœ‹+ğœ‹âˆ’ events, but with the ğ‘’+ğ‘’âˆ’ â†’ ğ‘‹ğ¾ Â±ğœ‹âˆ“

â€“ 39 â€“

0.20.30.40.50.60.70.8MÏ€+Ï€âˆ’(GeV/c2)100101102103104Entries20672Mean0.4960StdDev0.0503Entries20672Mean0.4976StdDev0.0000beforeï¬tafterï¬t(a) Fit convergence histogram. See description in
ï¬gure 4a.

(b) Chi-square distribution.

Figure 17: Fit convergence histogram (a) and chi-square distribution (b) obtained using the ï¬tting
procedure under the ğ‘’+ğ‘’âˆ’ â†’ ğ¾ğ‘†ğ¾ Â±ğœ‹âˆ“, ğ¾ğ‘† â†’ ğœ‹+ğœ‹âˆ’ hypotheses. Both histograms correspond to
the events of the ğ‘’+ğ‘’âˆ’ â†’ ğœ‹+ğœ‹âˆ’ğœ‹+ğœ‹âˆ’ simulation.

Figure 18: Distribution of the distance Î”ğ‘Ÿï¬t between the interaction vertex and the ğ¾ğ‘† â†’ ğœ‹+ğœ‹âˆ’
decay vertex obtained for the events of the ğ‘’+ğ‘’âˆ’ â†’ ğœ‹+ğœ‹âˆ’ğœ‹+ğœ‹âˆ’ simulation. The vertex coordinates
were found using the ï¬tting procedure under the ğ‘’+ğ‘’âˆ’ â†’ ğ¾ğ‘†ğ¾ Â±ğœ‹âˆ“, ğ¾ğ‘† â†’ ğœ‹+ğœ‹âˆ’ hypotheses.

hypotheses. This means that in the case of using a hypothesis similar to the ğ‘’+ğ‘’âˆ’ â†’ ğ¾ğ‘†ğ¾ Â±ğœ‹âˆ“,
the selection criterion on the Î”ğ‘Ÿï¬t is probably less eï¬€ective than in hypotheses with an unknown
intermediate particle.

8.3 Hypothesis ğ‘’+ğ‘’âˆ’ â†’ ğœ‹+ğœ‹âˆ’ğœ‹+ğœ‹âˆ’

8.3.1 Description of the ğ‘’+ğ‘’âˆ’ â†’ ğœ‹+ğœ‹âˆ’ğœ‹+ğœ‹âˆ’ hypothesis

Section 8.3 presents the results of applying the ï¬tting package under the ğ‘’+ğ‘’âˆ’ â†’ ğœ‹+ğœ‹âˆ’ğœ‹+ğœ‹âˆ’
hypothesis. This hypothesis has the following structure.

â€“ 40 â€“

0123errorcode02000040000Entries44160Mean0.0503StdDev0.21850100020003000Ï‡20500Entries41940Mean948.4322StdDev747.64530.00.51.01.52.02.53.0âˆ†rï¬t(cm)025050075010001250Entries44160Mean0.6278StdDev0.6166â€¢ The hypothesis has a single vertex. This vertex is the ğ‘’+ğ‘’âˆ’ interaction vertex. The ğ‘¥- and ğ‘¦-
coordinates of this vertex are ï¬xed at the beam position, while the ğ‘§-coordinate of this vertex
is free.

â€¢ The hypothesis contains four ï¬nal particles. These particles are charged pions. The con-
sidered hypothesis requires also the initial pseudo-particle 6.1 in order to provide total
four-momentum of the initial particles (ğ‘’+ğ‘’âˆ’).

â€¢ All of the particles listed above are involved in four energy-momentum conservation con-

straints.

â€¢ Each charged pion has three vertex constraints. In total, the hypothesis contains 12 vertex

constraints.

In total, the ğ‘’+ğ‘’âˆ’ â†’ ğœ‹+ğœ‹âˆ’ğœ‹+ğœ‹âˆ’ hypothesis contains 16 constraints. This hypothesis contains 25
free parameters: 20 measurable and 5 non-measurable parameters.

8.3.2 Fitting procedure details

Further, the considered hypothesis is applied to the simulated events of the signal process ğ‘’+ğ‘’âˆ’ â†’
ğœ‹+ğœ‹âˆ’ğœ‹+ğœ‹âˆ’ and the background process ğ‘’+ğ‘’âˆ’ â†’ ğ¾ğ‘†ğ¾ Â±ğœ‹âˆ“, ğ¾ğ‘† â†’ ğœ‹+ğœ‹âˆ’. As in section 8.1,
only four-track events are used in order to demonstrate how the ï¬tting works under the discussed
hypothesis. Moreover, only such four tracks are considered, which correspond to the total electric
In the ğ‘’+ğ‘’âˆ’ â†’ ğœ‹+ğœ‹âˆ’ğœ‹+ğœ‹âˆ’ hypothesis, particles of the same charge are
charge equal to zero.
equivalent, so only a single mapping of particles into their tracks is considered. Thus, only one ï¬t
is done in each event.

Almost all ï¬gures in subsections 8.3.3 and 8.3.4 correspond to events in which the ï¬tting
procedure converged to a local minimum . As in the previous sections, the ï¬t convergence histograms
are an exception. These histograms were obtained for all events in which the ï¬tting procedure was
applied.

8.3.3 Fitting the ğ‘’+ğ‘’âˆ’ â†’ ğœ‹+ğœ‹âˆ’ğœ‹+ğœ‹âˆ’ events

This subsection discusses the result of applying the ï¬tting procedure under the ğ‘’+ğ‘’âˆ’ â†’ ğœ‹+ğœ‹âˆ’ğœ‹+ğœ‹âˆ’
hypothesis to the events of the ğ‘’+ğ‘’âˆ’ â†’ ğœ‹+ğœ‹âˆ’ğœ‹+ğœ‹âˆ’ simulation. These events were simulated at the
same center-of-mass energy and magnetic ï¬eld as the events of the ğ‘’+ğ‘’âˆ’ â†’ ğ¾ğ‘†ğ¾ Â±ğœ‹âˆ“, ğ¾ğ‘† â†’ ğœ‹+ğœ‹âˆ’
simulation (see section 8.1.3). The ï¬tting procedure converged to a local minimum in 44715 events
out of 45022. In 47 events, this procedure converged to a local maximum, while in the remaining
260 events, the ï¬t did not converge. The corresponding ï¬t convergence histogram is shown in
ï¬gure 19a, while the chi-square distribution is shown in ï¬gure 19b.

Figure 20a shows the distribution of the ğ‘§-coordinate of the ğ‘’+ğ‘’âˆ’ interaction vertex found with
the ï¬tting procedure. As expected, this distribution is similar to the one shown in ï¬gure 6. Figure 20
shows the distribution of the diï¬€erence between the ğ‘§-coordinate of the interaction vertex found
with the ï¬tting procedure and the same coordinate obtained from the simulation. As in the case of
a similar ğ‘§-coordinate distribution shown in ï¬gure 7a, the accuracy of obtaining the ğ‘§-coordinate
using the ï¬tting procedure in this case is also about 1 cm.

â€“ 41 â€“

(a) Fit convergence histogram. See description in
ï¬gure 4a.

(b) Chi-square distribution.

Figure 19: Fit convergence histogram (a) and chi-square distribution (b) obtained using the ï¬tting
procedure under the ğ‘’+ğ‘’âˆ’ â†’ ğœ‹+ğœ‹âˆ’ğœ‹+ğœ‹âˆ’ hypothesis. Both histograms correspond to the events of
the ğ‘’+ğ‘’âˆ’ â†’ ğœ‹+ğœ‹âˆ’ğœ‹+ğœ‹âˆ’ simulation.

(a) Distribution of the ğ‘§-coordinate of the ğ‘’+ğ‘’âˆ’ in-
teraction vertex found with the ï¬tting procedure.

(b) Distribution of the diï¬€erence between the ğ‘§-
coordinate of the ğ‘’+ğ‘’âˆ’ interaction vertex found us-
ing the ï¬tting procedure and the same coordinate
obtained from the simulation.

Figure 20: Distributions related with the ğ‘§-coordinate of the ğ‘’+ğ‘’âˆ’ interaction vertex. Both dis-
tributions were obtained using the ï¬tting procedure under the ğ‘’+ğ‘’âˆ’ â†’ ğœ‹+ğœ‹âˆ’ğœ‹+ğœ‹âˆ’ hypothesis and
correspond to the events of the same process.

8.3.4 Fitting the ğ‘’+ğ‘’âˆ’ â†’ ğ¾ğ‘†ğ¾ Â±ğœ‹âˆ“ events

In this subsection, we discuss the results of applying the ï¬tting procedure under the ğ‘’+ğ‘’âˆ’ â†’
ğœ‹+ğœ‹âˆ’ğœ‹+ğœ‹âˆ’ hypothesis to the events of the ğ‘’+ğ‘’âˆ’ â†’ ğ¾ğ‘†ğ¾ Â±ğœ‹âˆ“, ğ¾ğ‘† â†’ ğœ‹+ğœ‹âˆ’ simulation. The
corresponding ï¬t convergence histogram shown in ï¬gure 21a. The ğ‘’+ğ‘’âˆ’ â†’ ğ¾ğ‘†ğ¾ Â±ğœ‹âˆ“ is the
background process with respect to the considered hypothesis. For this reason, the corresponding
chi-square distribution shown in ï¬gure 21b is much wider than the similar distribution shown in
ï¬gure 19b. Finally, one can conclude that the chi-squared distributions in ï¬gures 19b and 21b, as
well as the distributions in ï¬gures 4b and 13b, can be used to separate the events of the processes
ğ‘’+ğ‘’âˆ’ â†’ ğœ‹+ğœ‹âˆ’ğœ‹+ğœ‹âˆ’ and ğ‘’+ğ‘’âˆ’ â†’ ğ¾ğ‘†ğ¾ Â±ğœ‹âˆ“, ğ¾ğ‘† â†’ ğœ‹+ğœ‹âˆ’.

â€“ 42 â€“

0123errorcode02000040000Entries45022Mean0.0079StdDev0.09940100200Ï‡201000Entries44715Mean39.7767StdDev35.5282âˆ’10010z(cm)010002000Entries44715Mean-0.0033StdDev2.8757âˆ’505âˆ†z(cm)01000Entries44715Mean-0.0037StdDev0.9659(a) Fit convergence histogram. See description in
ï¬gure 4a.

(b) Chi-square distribution.

Figure 21: Fit convergence histogram (a) and chi-square distribution (b) obtained using the ï¬tting
procedure under the ğ‘’+ğ‘’âˆ’ â†’ ğœ‹+ğœ‹âˆ’ğœ‹+ğœ‹âˆ’ hypothesis. Both histograms correspond to the events of
the ğ‘’+ğ‘’âˆ’ â†’ ğ¾ğ‘†ğ¾ Â±ğœ‹âˆ“ simulation.

8.4 Hypothesis ğ‘’+ğ‘’âˆ’ â†’ ğ›¾ğ›¾ğ›¾

8.4.1 Description of the ğ‘’+ğ‘’âˆ’ â†’ ğ›¾ğ›¾ğ›¾ hypothesis

In section 8.4, we present the results of applying the kinematic and vertex ï¬tting package under the
ğ‘’+ğ‘’âˆ’ â†’ ğ›¾ğ›¾ğ›¾ hypothesis to the events of the ğ‘’+ğ‘’âˆ’ â†’ ğœ‹0ğ›¾, ğœ‹0 â†’ ğ›¾ğ›¾ simulation. The ğ‘’+ğ‘’âˆ’ â†’ ğ›¾ğ›¾ğ›¾
hypothesis has the following form.

â€¢ The hypothesis contains a single vertex. This vertex is the ğ‘’+ğ‘’âˆ’ interaction vertex. The ğ‘¥-
and ğ‘¦- coordinates of this vertex are ï¬xed at the beam position, while the ğ‘§-coordinate of this
vertex is free.

â€¢ The hypothesis contains three ï¬nal particles. These particles are photons 6.2.2. The hypoth-
esis contains also the initial pseudo-particle 6.1, which is used in order to provide the total
four-momentum of the initial particles (ğ‘’+ğ‘’âˆ’).

â€¢ All of the above particles are involved in four energy-momentum conservation constraints.

â€¢ The vertex constraints 7.3 are not imposed on the photons, because the photons are already
emitted from the origin vertex due to the parametrization of their momentum (6.4). An
important note about this hypothesis is that for a ï¬xed position of the beam axis, three
photons are suï¬ƒcient to restore the ğ‘§-coordinate of the ğ‘’+ğ‘’âˆ’ vertex using the kinematic ï¬tting
technique.

In total, the ğ‘’+ğ‘’âˆ’ â†’ ğ›¾ğ›¾ğ›¾ hypothesis contains 4 constraints. This hypothesis contains 13 free
parameters. Among these parameters, there are 12 measurable parameters and one non-measurable
parameter.

8.4.2 Fitting the ğ‘’+ğ‘’âˆ’ â†’ ğœ‹0ğ›¾ events
In this subsection, we discuss the results of the ï¬tting the simulated ğ‘’+ğ‘’âˆ’ â†’ ğœ‹0ğ›¾, ğœ‹0 â†’ ğ›¾ğ›¾ events
under the ğ‘’+ğ‘’âˆ’ â†’ ğ›¾ğ›¾ğ›¾ hypothesis. It should be noted that for the demonstration purposes only

â€“ 43 â€“

0123errorcode0500010000Entries12399Mean0.0341StdDev0.1932010002000Ï‡20200400Entries12003Mean786.4002StdDev621.9858(a) Fit convergence histogram. See description in
ï¬gure 4a.

(b) Chi-square distribution.

Figure 22: Fit convergence histogram (a) and chi-square distribution (b) obtained using the ï¬tting
procedure under the ğ‘’+ğ‘’âˆ’ â†’ ğ›¾ğ›¾ğ›¾ hypothesis. Both histograms correspond to the events of the
ğ‘’+ğ‘’âˆ’ â†’ ğœ‹0ğ›¾ simulation.

Figure 23: Two-photon invariant mass distribution for the ğ‘’+ğ‘’âˆ’ â†’ ğœ‹0ğ›¾ events. The dashed line
corresponds to the invariant mass distribution obtained using the photon parameters found with the
ï¬tting procedure under the ğ‘’+ğ‘’âˆ’ â†’ ğ›¾ğ›¾ğ›¾ hypothesis. The solid line corresponds to the invariant
mass distribution obtained using the measured photon parameters.

events with three photon clusters in the calorimeter are considered. Thus, since all three photons
are equivalent, there is a single mapping of photons to their clusters, i.e. only one ï¬t is performed
in each event. Figure 22a shows the ï¬t convergence histogram corresponding to this section, while
ï¬gure 22b shows the chi-square distribution. It can be seen from ï¬gure 22a that in this case, all the
ï¬ts converged to a local minimum.

Figure 23 shows histograms with the two-photon invariant mass distributions. The histogram
indicated by the solid line is obtained using the measured photon parameters, and the histogram in-

â€“ 44 â€“

0123errorcode050000Entries75086Mean0.0000StdDev0.00000102030Ï‡201000Entries75086Mean4.4909StdDev4.94430.00.20.40.60.8MÎ³Î³(GeV/c2)0200040006000800010000Entries225258Mean0.3857StdDev0.2301Entries225258Mean0.3895StdDev0.2292beforeï¬tafterï¬t(a) Distribution of the ğ‘§-coordinate of the ğ‘’+ğ‘’âˆ’ in-
teraction vertex found with the ï¬tting procedure.

(b) Distribution of the diï¬€erence between the ğ‘§-
coordinate of the ğ‘’+ğ‘’âˆ’ interaction vertex found us-
ing the ï¬tting procedure and the same coordinate
obtained from the simulation.

Figure 24: Distributions related with the ğ‘§-coordinate of the ğ‘’+ğ‘’âˆ’ interaction vertex. Both distribu-
tions were obtained using the ï¬tting procedure under the ğ‘’+ğ‘’âˆ’ â†’ ğ›¾ğ›¾ğ›¾ hypothesis and correspond
to the events of the ğ‘’+ğ‘’âˆ’ â†’ ğœ‹0ğ›¾ process.

dicated by the dashed line is obtained using the photon parameters found using the ï¬tting procedure.
These histograms are shown for the reason that we would like to see a pion peak on them. Since
in the ğ‘’+ğ‘’âˆ’ â†’ ğ›¾ğ›¾ğ›¾ hypothesis, it is unknown which photons are the pion decay products, these
histograms contain the invariant masses of all diï¬€erent photon pairs, i.e. each histogram has three
entries per event. Thus, in these histograms, in addition to the pion peak, there is a contribution
from the combinatorial background. It is seen from the ï¬gure that the ï¬tting procedure signiï¬cantly
improves the two-photon invariant mass resolution.

Figure 24a shows the distribution of the ğ‘§-coordinate of the ğ‘’+ğ‘’âˆ’ interaction vertex. This
coordinate is found using the ï¬tting procedure. It can be seen from the ï¬gure that this distribution is
the same as the similar distributions shown in ï¬gures 6 and 20a, but obtained with other hypotheses.
Figure 24 shows the distribution of the diï¬€erence between the ğ‘§-coordinate of the interaction vertex
found using the ï¬tting procedure and the same coordinate obtained from the simulation. The
accuracy of obtaining the ğ‘§-coordinate in this case is slightly worse than in the case of hypotheses
with charged particles, but this accuracy is still on the order of 1 cm.

The hypothesis ğ‘’+ğ‘’âˆ’ â†’ ğ›¾ğ›¾ğ›¾ is quite simple. In this hypothesis, the energy-momentum conser-
vation constraints are imposed only at one vertex, and there are no direct vertex constraints. Let us
show how the energy-momentum conservation constraints hold. Figure 25 shows the distributions
of the left-hand sides of the energy-momentum conservation constraints (7.1). The solid lines indi-
cate the distributions obtained using the measured particle parameters. The dashed lines denote the
distributions obtained using the particle parameters found with the ï¬tting procedure. The dashed
distributions are ï¬xed at zero, i.e. energy-momentum conservation constraints are satisï¬ed with
high accuracy. Similar distributions for the energy-momentum conservation constraints, as well as
for vertex constraints, can also be shown in the case of more complex hypotheses. However, in this
paper, we restrict ourselves to the distributions shown in ï¬gure 25.

â€“ 45 â€“

âˆ’10010z(cm)02000Entries75086Mean0.0623StdDev2.7620âˆ’505âˆ†z(cm)02000Entries75086Mean-0.0098StdDev1.1857(a) Total ğ‘ ğ‘¥.

(b) Total ğ‘ ğ‘¦.

(c) Total ğ‘ğ‘§.

(d) Total energy.

Figure 25: Distributions demonstrating the fulï¬llment of the energy-momentum conservation
constraints the case of the ğ‘’+ğ‘’âˆ’ â†’ ğ›¾ğ›¾ğ›¾ hypothesis. The distributions are obtained for the events
of the ğ‘’+ğ‘’âˆ’ â†’ ğœ‹0ğ›¾ simulation. The solid line in the ï¬gures denotes the components of the
total four-momentum obtained using the measured particle parameters. The dashed line denotes the
components of the total four-momentum obtained using the particle parameters found with the ï¬tting
procedure. By total four-momentum we mean the diï¬€erence between the total four-momentum of
the ï¬nal and initial particles, i.e. the left-hand side of equation (7.1).

â€“ 46 â€“

01ptotx(GeV/c)102105Entries75086Mean0.0017StdDev0.0359Entries75086Mean0.0000StdDev0.0000beforeï¬tafterï¬t01ptoty(GeV/c)102105Entries75086Mean0.0004StdDev0.0357Entries75086Mean-0.0000StdDev0.0000beforeï¬tafterï¬tâˆ’1012ptotz(GeV/c)102105Entries75086Mean0.0014StdDev0.0584Entries75086Mean0.0000StdDev0.0000beforeï¬tafterï¬tâˆ’1012Etot(GeV)102105Entries75086Mean-0.0026StdDev0.0630Entries75086Mean0.0000StdDev0.0000beforeï¬tafterï¬t8.5 Hypothesis ğ‘’+ğ‘’âˆ’ â†’ ğœ‹+ğœ‹âˆ’ğ›¾ğ›¾

8.5.1 Description of the ğ‘’+ğ‘’âˆ’ â†’ ğœ‹+ğœ‹âˆ’ğ›¾ğ›¾ hypothesis

Section 8.5.1 discusses the results of applying kinematic and vertex ï¬tting under the ğ‘’+ğ‘’âˆ’ â†’
ğœ‹+ğœ‹âˆ’ğ›¾ğ›¾ hypothesis. This hypothesis has the following form.

â€¢ The hypothesis has a single vertex, which is the ğ‘’+ğ‘’âˆ’ interaction vertex. The ğ‘¥- and ğ‘¦-
coordinates of the ğ‘’+ğ‘’âˆ’ interaction vertex are ï¬xed at the beam position, while the ğ‘§-coordinate
of this vertex is free.

â€¢ The hypothesis requires the presence of four ï¬nal particles and one initial pseudo-particle 6.1.
The list of ï¬nal particles consists of two photons 6.2.2 and two oppositely charged pions 6.2.1.

â€¢ There are four constraints on the energy-momentum conservation in the hypothesis. All

particles are involved into these constraints.

â€¢ Three vertex constraints are imposed on each charged particle. No vertex constraints are im-
posed on the photons, because the photons already ï¬‚y out of the vertex due to the parametriza-
tion of their momenta.

In total, the ğ‘’+ğ‘’âˆ’ â†’ ğœ‹+ğœ‹âˆ’ğ›¾ğ›¾ hypothesis contains 10 constraints. This hypothesis contains
21 free parameters. Among these parameters, 18 parameters are measurable and 3 parameters are
non-measurable.

8.5.2 Fitting the ğ‘’+ğ‘’âˆ’ â†’ ğœ‚ğœ‹+ğœ‹âˆ’, ğœ‚ â†’ ğ›¾ğ›¾ events

In this subsection we present the results of applying the ï¬tting package to the events of the ğ‘’+ğ‘’âˆ’ â†’
ğœ‹+ğœ‹âˆ’ğœ‚, ğœ‚ â†’ ğ›¾ğ›¾ simulation. For demonstration purposes, only those events are passed to the input
of the ï¬tting procedure, in which there are at least two photon clusters in the calorimeter. If there
are only two photon clusters in an event, then a single ï¬t is performed in this event. If the number
of photon clusters is more than two, then separate ï¬ts are performed for each diï¬€erent mapping
of photons to their clusters. Permutations of two photon clusters in each pair are not considered,
because they do not aï¬€ect the ï¬tting result.

The ï¬tting procedure in the considered case converges in 23602 out of 25629 events passed
to the input of this procedure. In 1952 events, the ï¬tting procedure does not converge, while in
75 events it converges to a local maximum. The corresponding ï¬t convergence histogram and
chi-square distribution are shown in ï¬gures 26a and 26b, respectively.

The ï¬tting procedure signiï¬cantly improves the resolution in the two-photon invariant mass.
The distributions of the two-photon invariant mass are shown in ï¬gure 26c. As usual, the distribution
indicated by the solid line was obtained using the measured particle parameters, but the mappings
of photons to their clusters were found using the ï¬tting procedure. The distribution indicated by
the dashed line was obtained using the particle parameters found with the ï¬tting procedure.

It should be noted that there is no signiï¬cant improvement in the two-pion invariant mass. This
is due the fact that the dominant intermediate state in the ğ‘’+ğ‘’âˆ’ â†’ ğœ‚ğœ‹+ğœ‹âˆ’ process is the ğœ‚ğœŒ(770),
the two ï¬nal pions are the ğœŒ(770) â†’ ğœ‹+ğœ‹âˆ’ decay products. The width of the ğœŒ(770) is
i.e.
approximately 149 MeV, which gives a lower limit to the typical width of the two-pion invariant

â€“ 47 â€“

(a) Fit convergence histogram. See description in
ï¬gure 4a.

(b) Chi-square distribution.

(c) Two-photon invariant mass.

(d) Two-pion invariant mass.

Figure 26: Some results of applying the ï¬tting procedure to the events of the ğ‘’+ğ‘’âˆ’ â†’ ğœ‚ğœ‹+ğœ‹âˆ’, ğœ‚ â†’
ğ›¾ğ›¾ simulation under the ğ‘’+ğ‘’âˆ’ â†’ ğœ‹+ğœ‹âˆ’ğ›¾ğ›¾ hypothesis.

mass distribution. The two-pion invariant mass distributions can be seen in ï¬gure 26d. There
are two distributions in the ï¬gure. One distribution is indicated by a solid line, while the other is
indicated by a dashed line. The meaning of the diï¬€erent line styles is the same as in the case of the
two-photon invariant mass distributions shown in ï¬gure 26c.

8.6 Hypothesis ğ‘’+ğ‘’âˆ’ â†’ ğœ‹+ğœ‹âˆ’ğ›¾ğ›¾lost

In this section, we present the results of ï¬tting the events of the ğ‘’+ğ‘’âˆ’ â†’ ğœ‚ğœ‹+ğœ‹âˆ’, ğœ‚ â†’ ğ›¾ğ›¾
simulation under the ğ‘’+ğ‘’âˆ’ â†’ ğœ‹+ğœ‹âˆ’ğ›¾ğ›¾lost hypothesis. The diï¬€erence between the ğ‘’+ğ‘’âˆ’ â†’ ğœ‹+ğœ‹âˆ’ğ›¾ğ›¾
and ğ‘’+ğ‘’âˆ’ â†’ ğœ‹+ğœ‹âˆ’ğ›¾ğ›¾lost hypotheses is that in the ğ‘’+ğ‘’âˆ’ â†’ ğœ‹+ğœ‹âˆ’ğ›¾ğ›¾lost hypothesis one of the photons
is lost. The lost photon is represented as the massless lost particle 6.4.2.

For demonstration purposes, we consider all events of the ğ‘’+ğ‘’âˆ’ â†’ ğœ‚ğœ‹+ğœ‹âˆ’, ğœ‚ â†’ ğ›¾ğ›¾ simulation
containing at least one photon cluster. Thus, even if there are clusters for both photons in an event,
only one photon cluster is ï¬nally taken into account. Events containing at least one photon cluster
are passed to the input of the ï¬tting procedure. Further, in the ï¬tting procedure, each photon cluster
is matched in turn to the detected photon. For each mapping of the detected photon to its cluster,

â€“ 48 â€“

0123errorcode01000020000Entries25629Mean0.0820StdDev0.2849050100Ï‡20500Entries23602Mean23.1428StdDev23.80340.00.51.0MÎ³Î³(GeV/c2)05001000Entries23602Mean0.5375StdDev0.1057Entries23602Mean0.5753StdDev0.1022beforeï¬tafterï¬t0.00.51.01.5MÏ€+Ï€âˆ’(GeV/c2)02000Entries23602Mean0.7683StdDev0.1271Entries23602Mean0.7763StdDev0.1192beforeï¬tafterï¬t(a) Fit convergence histogram. See description in
ï¬gure 4a.

(b) Chi-square distribution.

(c) Two-photon invariant mass.

(d) Two-pion invariant mass.

Figure 27: Some results of applying the ï¬tting procedure to the events of the ğ‘’+ğ‘’âˆ’ â†’ ğœ‚ğœ‹+ğœ‹âˆ’, ğœ‚ â†’
ğ›¾ğ›¾ simulation under the ğ‘’+ğ‘’âˆ’ â†’ ğœ‹+ğœ‹âˆ’ğ›¾ğ›¾lost hypothesis.

a separate ï¬t is performed. Finally, in each event, such a mapping of the detected photon to the
photon cluster is chosen that leads to the smallest chi-square.

The ï¬tting procedure converges in 25684 events out of 25786 events passed to it. In 38 events,
the ï¬tting procedure converges to a local maximum, while in 64 events this procedure does not
converge. The corresponding ï¬t convergence histogram and chi-square distribution are shown in
ï¬gures 27a and 27b, respectively.

Figure 27c shows the distributions of the two-photon invariant mass. Since one of the photons
is lost in the considered hypothesis, the ï¬tting leads to a smaller improvement in the resolution
of the two-photon invariant mass than in the case of ğ‘’+ğ‘’âˆ’ â†’ ğœ‹+ğœ‹âˆ’ğ›¾ğ›¾ hypothesis (see ï¬gure 26c
for comparison). Figure 27d shows the distributions of the two-pion invariant mass. For the
reasons described in section 8.5.2, the ï¬tting procedure does not lead to signiï¬cant changes in the
distribution of this mass. The description of the distributions in ï¬gures 27c and 27d is the same as
in the case of ï¬gures 26c and 26d, respectively. The last two ï¬gures are described in section 8.5.2.

â€“ 49 â€“

0123errorcode01000020000Entries25786Mean0.0054StdDev0.091402040Ï‡20500Entries25684Mean5.2336StdDev6.13630.00.51.0MÎ³Î³(GeV/c2)0500Entries25684Mean0.5801StdDev0.1285Entries25684Mean0.5955StdDev0.1343beforeï¬tafterï¬t0.00.51.01.5MÏ€+Ï€âˆ’(GeV/c2)02000Entries25684Mean0.7677StdDev0.1262Entries25684Mean0.7642StdDev0.1149beforeï¬tafterï¬t8.7 Hypothesis ğ‘’+ğ‘’âˆ’ â†’ ğœ‹+ğœ‹âˆ’ğœ‹+ğœ‹âˆ’ğœ‹0

lost

8.7.1 Description of the ğ‘’+ğ‘’âˆ’ â†’ ğœ‹+ğœ‹âˆ’ğœ‹+ğœ‹âˆ’ğœ‹0

lost hypothesis

As an example of a hypothesis involving a lost massive particle, let us consider the ğ‘’+ğ‘’âˆ’ â†’
ğœ‹+ğœ‹âˆ’ğœ‹+ğœ‹âˆ’ğœ‹0

lost hypothesis. This hypothesis has the following structure.

â€¢ The hypothesis has a single vertex. This vertex is the ğ‘’+ğ‘’âˆ’ interaction vertex. The ğ‘¥- and ğ‘¦-
coordinates of this vertex are ï¬xed at the beam position, while the ğ‘§-coordinate of this vertex
is free.

â€¢ The hypothesis contain ï¬ve ï¬nal particles. The four ï¬nal particles are charged pions 6.2.1,
and the ï¬fth particle is a lost ğœ‹0. This ğœ‹0 is represented as the lost massive particle 6.4.1.
In order to provide the four-momentum of initial particles, the hypothesis also contains the
initial pseudo-particle 6.1.

â€¢ All of the particles listed above are involved in four energy-momentum conservation con-

straints.

â€¢ Each charged pion has three vertex constraints. In total, the hypothesis contains 12 vertex

constraints.

In total, the ğ‘’+ğ‘’âˆ’ â†’ ğœ‹+ğœ‹âˆ’ğœ‹+ğœ‹âˆ’ğœ‹0
lost hypothesis contains 16 constraints. This hypothesis contains
28 free parameters. Among these parameters, 20 parameters are measurable and 8 parameters are
non-measurable.

8.7.2 Fitting procedure details

The ï¬tting procedure in the ğ‘’+ğ‘’âˆ’ â†’ ğœ‹+ğœ‹âˆ’ğœ‹+ğœ‹âˆ’ğœ‹0
lost hypothesis is quite simple. For demonstration
purposes, only events with four tracks are passed to the input of this procedure. Moreover, these
tracks must correspond to a neutral combination of charged particles. Since pions of the same
charge are equivalent in this hypothesis, it makes sense to consider a single mapping of these pions
into their tracks. Thus, only one ï¬t is performed in each event. It is important to note that in order
for the point of initial optimization parameters to lie closer to the conditional minimum point, the
initial momentum of the lost ğœ‹0 is set equal to the initial missing momentum of four charged pions.

8.7.3 Fitting the ğ‘’+ğ‘’âˆ’ â†’ ğœ‚ğœ‹+ğœ‹âˆ’, ğœ‚ â†’ ğœ‹+ğœ‹âˆ’ğœ‹0 events

In this subsection, we present the results of applying the ï¬tting procedure 8.7.2 to the events of the
ğ‘’+ğ‘’âˆ’ â†’ ğœ‚ğœ‹+ğœ‹âˆ’, ğœ‚ â†’ ğœ‹+ğœ‹âˆ’ğœ‹0 â†’ ğœ‹+ğœ‹âˆ’ğ›¾ğ›¾ simulation. For demonstration purposes, we completely
ignore the information about the presence of photons, i.e. even if photons from the ğœ‹0 â†’ ğ›¾ğ›¾ decay
were detected, we still consider the neutral pion to be lost. The ï¬tting procedure converged in
12665 events out of 12796 events passed to its input. This procedure converged to a local maximum
in 43 events and did not converge in 88 events. The corresponding ï¬t convergence histogram and
chi-square distribution are shown in ï¬gures 28a and 28b, respectively.

Since the decay ğœ‚ â†’ ğœ‹+ğœ‹âˆ’ğœ‹0 occurs in the considered process, the three-pion (ğœ‹+ğœ‹âˆ’ğœ‹0
lost)
invariant mass distribution should have a peak corresponding to the ğœ‚-meson. Despite the fact that
the hypothesis with the lost particle is considered, the ï¬tting under this hypothesis allows one to

â€“ 50 â€“

(a) Fit convergence histogram. See description in
ï¬gure 4a.

(b) Chi-square distribution.

Figure 28: Fit convergence histogram (a) and chi-square distribution (b) obtained by applying the
ï¬tting procedure 8.7.2 to the events of the ğ‘’+ğ‘’âˆ’ â†’ ğœ‚ğœ‹+ğœ‹âˆ’, ğœ‚ â†’ ğœ‹+ğœ‹âˆ’ğœ‹0, ğœ‹0 â†’ ğ›¾ğ›¾ simulation.

Figure 29: Three-pion invariant mass distributions obtained for the events of the ğ‘’+ğ‘’âˆ’ â†’
ğœ‚ğœ‹+ğœ‹âˆ’, ğœ‚ â†’ ğœ‹+ğœ‹âˆ’ğœ‹0, ğœ‹0 â†’ ğ›¾ğ›¾ simulation. The histogram indicated by the solid line was
obtained using the measured particle parameters. The histogram indicated by the dashed line was
obtained using the particle parameters found with the ï¬tting procedure 8.7.2. Both histograms have
four entries per event, corresponding to the number of diï¬€erent ğœ‹+ğœ‹âˆ’ğœ‹0 combinations.

signiï¬cantly improve the resolution of the three-pion invariant mass near the ğœ‚-meson peak. The
distributions of the three-pion invariant mass are shown in ï¬gure 29. The dashed line, as usual,
denotes the distribution of the invariant mass obtained using the parameters found with the ï¬tting
procedure. The solid line denotes the invariant mass distribution obtained using the measured
particle parameters. In this case, since the momentum of the lost neutral pion is not measured,
the missing momentum of the four charged pions is used instead. In the ğ‘’+ğ‘’âˆ’ â†’ ğœ‹+ğœ‹âˆ’ğœ‹+ğœ‹âˆ’ğœ‹0
lost
hypothesis, there is no diï¬€erence between charged pions of the same sign. Therefore, there are

â€“ 51 â€“

0123errorcode0500010000Entries12796Mean0.0136StdDev0.1419050100Ï‡20250500Entries12665Mean22.9099StdDev23.87790.500.751.001.251.501.75MÏ€+Ï€âˆ’Ï€0(GeV/c2)050010001500Entries50660Mean0.9343StdDev0.2876Entries50660Mean0.9531StdDev0.2896beforeï¬tafterï¬tTable 2: Mappings between charged particles and their tracks in the case of the ğ‘’+ğ‘’âˆ’ â†’
ğœ‚ğœ‹+ğœ‹âˆ’, ğœ‚ â†’ ğœ‹+ğœ‹âˆ’ğœ‹0
1 and
ğ‘¡âˆ’
2 are tracks of negatively charged particles.

2 are tracks of positively charged particles, ğ‘¡âˆ’

lost hypothesis.

1 and ğ‘¡+
ğ‘¡+

Intermediate particle
Final particle

Track com-
binations

ğœ‹0

lost

ğœ‹+
ğ‘¡+
1
ğ‘¡+
1
ğ‘¡+
2
ğ‘¡+
2

ğœ‹âˆ’
ğ‘¡âˆ’
1
ğ‘¡âˆ’
2
ğ‘¡âˆ’
1
ğ‘¡âˆ’
2

ğœ‹+
ğ‘¡+
2
ğ‘¡+
2
ğ‘¡+
1
ğ‘¡+
1

ğœ‚
ğœ‹âˆ’
ğ‘¡âˆ’
2
ğ‘¡âˆ’
1
ğ‘¡âˆ’
2
ğ‘¡âˆ’
1

four diï¬€erent neutral three-pion ğœ‹+ğœ‹âˆ’ğœ‹0 combinations corresponding to diï¬€erent charged pions.
The histograms shown in ï¬gure 29 are ï¬lled with invariant masses corresponding to all such
combinations. Thus, these histograms have four entries per event.

8.8 Hypothesis ğ‘’+ğ‘’âˆ’ â†’ ğœ‚ğœ‹+ğœ‹âˆ’, ğœ‚ â†’ ğœ‹+ğœ‹âˆ’ğœ‹0

lost

8.8.1 Description of the ğ‘’+ğ‘’âˆ’ â†’ ğœ‚ğœ‹+ğœ‹âˆ’, ğœ‚ â†’ ğœ‹+ğœ‹âˆ’ğœ‹0

lost hypothesis

In section 8.8, we discuss the ğ‘’+ğ‘’âˆ’ â†’ ğœ‚ğœ‹+ğœ‹âˆ’, ğœ‚ â†’ ğœ‹+ğœ‹âˆ’ğœ‹0
lost hypothesis. It should be noted that
in this hypothesis the ğœ‚-meson is not explicitly contained in the form of an intermediate particle.
This is due to its short life time. The presence of a short-lived intermediate particle in this case is
emulated by the mass constraint (7.2). Thus, this hypothesis is a good example of how the mass
constraint works. In this case, the mass constraint is imposed on the invariant mass of three pions
(ğœ‹+ğœ‹âˆ’ğœ‹0) in order to require that this invariant mass be equal to the mass of the ğœ‚-meson. In other
aspects, the structure of the ğ‘’+ğ‘’âˆ’ â†’ ğœ‚ğœ‹+ğœ‹âˆ’, ğœ‚ â†’ ğœ‹+ğœ‹âˆ’ğœ‹0
lost hypothesis coincides with the structure
of the ğ‘’+ğ‘’âˆ’ â†’ ğœ‹+ğœ‹âˆ’ğœ‹+ğœ‹âˆ’ğœ‹0
lost hypothesis. A detailed description of the ğ‘’+ğ‘’âˆ’ â†’ ğœ‹+ğœ‹âˆ’ğœ‹+ğœ‹âˆ’ğœ‹0
lost
hypothesis can be found in section 8.7.1.

8.8.2 Fitting procedure details

Due to the presence of the mass constraint, charged pions are not equivalent in the ğ‘’+ğ‘’âˆ’ â†’
ğœ‚ğœ‹+ğœ‹âˆ’, ğœ‚ â†’ ğœ‹+ğœ‹âˆ’ğœ‹0
lost hypothesis. This is due to the fact that only two charged pions are involved
in this constraint. Therefore, the ï¬tting procedure under the considered hypothesis must take into
account diï¬€erent mappings of charged pions into their tracks. Only four-track events are passed to
the input of the ï¬tting procedure. Thus, there are four possible mappings of four charged pions into
their tracks, i.e. four ï¬ts are performed in each event. These mappings are listed in table 2.

8.8.3 Fitting the ğ‘’+ğ‘’âˆ’ â†’ ğœ‚ğœ‹+ğœ‹âˆ’, ğœ‚ â†’ ğœ‹+ğœ‹âˆ’ğœ‹0 events

The ï¬tting procedure described above is applied to the events of the ğ‘’+ğ‘’âˆ’ â†’ ğœ‚ğœ‹+ğœ‹âˆ’, ğœ‚ â†’
ğœ‹+ğœ‹âˆ’ğœ‹0, ğœ‹0 â†’ ğ›¾ğ›¾ simulation. As in section 8.7.3, information about detected photons is com-
pletely ignored in this example. The ï¬tting procedure converged to a local minimum in 12722 events
out of 12796. This procedure converged to a local maximum in 14 events and did not converge in
60 events. The corresponding ï¬t convergence histogram and chi-square distribution are shown in
ï¬gures 30a and 30b, respectively.

â€“ 52 â€“

(a) Fit convergence histogram. See description in
ï¬gure 4a.

(b) Chi-square distribution.

Figure 30: Fit convergence histogram (a) and chi-square distribution (b) obtained by applying the
ï¬tting procedure 8.8.2 to the events of the ğ‘’+ğ‘’âˆ’ â†’ ğœ‚ğœ‹+ğœ‹âˆ’, ğœ‚ â†’ ğœ‹+ğœ‹âˆ’, ğœ‹0 â†’ ğ›¾ğ›¾ simulation.

Figure 31: Three-pion invariant mass distributions obtained for the events of the ğ‘’+ğ‘’âˆ’ â†’
ğœ‚ğœ‹+ğœ‹, ğœ‚ â†’ ğœ‹+ğœ‹âˆ’ğœ‹0, ğœ‹0 â†’ ğ›¾ğ›¾ simulation. The histogram indicated by the solid line was ob-
tained using the measured particle parameters, but the mappings of charged pions to their tracks
were found using a ï¬tting procedure 8.8.2. The histogram indicated by the dashed line was obtained
using the particle parameters found with the ï¬tting procedure 8.8.2. Both histograms have one
entry per event.

â€“ 53 â€“

0123errorcode0500010000Entries12796Mean0.0069StdDev0.0950050100Ï‡20200400Entries12722Mean24.0050StdDev24.09030.40.60.81.01.21.4MÏ€+Ï€âˆ’Ï€0(GeV/c2)100101102103104Entries12722Mean0.5884StdDev0.1000Entries12722Mean0.5479StdDev0.0000beforeï¬tafterï¬tFigure 31 shows the distributions of the three-pion invariant mass. These three pions are the
ğœ‚ â†’ ğœ‹+ğœ‹âˆ’ğœ‹0 decay products. The distribution indicated by the dashed line was obtained using the
particle parameters found with the ï¬tting procedure. This distribution turned out to be ï¬xed on the
ğœ‚-meson mass, since the corresponding mass constraint is used in the hypothesis. The distribution
indicated by the solid line was obtained using the measured particle parameters, but the mappings
of charged pions into their tracks were found with the ï¬tting procedure. To obtain this distribution,
the momentum of the lost neutral pion was set equal to the missing momentum of four charged
pions. The histograms in ï¬gure 31 contain only one entry per event.

8.9 Hypothesis ğ‘’+ğ‘’âˆ’ â†’ ğ‘‹ ğ‘‹ ğœ‹+ğœ‹âˆ’, ğ‘‹ â†’ ğœ‹+ğœ‹âˆ’

8.9.1 Description of the ğ‘’+ğ‘’âˆ’ â†’ ğ‘‹ ğ‘‹ ğœ‹+ğœ‹âˆ’, ğ‘‹ â†’ ğœ‹+ğœ‹âˆ’ hypothesis

The ğ‘’+ğ‘’âˆ’ â†’ ğ‘‹ ğ‘‹ ğœ‹+ğœ‹âˆ’, ğ‘‹ â†’ ğœ‹+ğœ‹âˆ’ hypothesis is an example of a three-vertex hypothesis. As in
the previous sections, by particle ğ‘‹ we mean a long-lived intermediate particle with an unknown
mass. This hypothesis is a signal hypothesis for the ğ‘’+ğ‘’âˆ’ â†’ ğ¾ğ‘†ğ¾ğ‘† ğœ‹+ğœ‹âˆ’, ğ¾ğ‘† â†’ ğœ‹+ğœ‹âˆ’ events, for
example. The structure of this hypothesis is the following.

â€¢ The hypothesis has three vertices. The ï¬rst vertex is the ğ‘’+ğ‘’âˆ’ interaction vertex, the other
two vertices are the ğ‘‹-particle decay vertices. All coordinates of the ğ‘‹ decay vertices are
free. The ğ‘¥- and ğ‘¦- coordinates of the ğ‘’+ğ‘’âˆ’ interaction vertex are ï¬xed at the beam position,
while the ğ‘§-coordinate of this vertex is free.

â€¢ The ğ‘’+ğ‘’âˆ’ â†’ ğ‘‹ ğ‘‹ ğœ‹+ğœ‹âˆ’, ğ‘‹ â†’ ğœ‹+ğœ‹âˆ’ hypothesis contains six ï¬nal particles, two intermediate
neutral particles 6.3.1 and an initial pseudo-particle 6.1. The ï¬nal particles are charged pions.
The parametrizations of four-momentum and trajectory of a charged particle can be found in
section 6.2.1.

â€¢ At each vertex, three-dimensional momentum conservation constraints are imposed. In total,

the hypothesis contains 9 constraints related to conservation of momentum.

â€¢ The hypothesis contains a single energy conservation constraint. Only the ï¬nal particles and

the initial pseudo-particle are involved in this constraint.

â€¢ Three separate vertex constraints are imposed to each ï¬nal pion and each intermediate particle.

So the hypothesis contains 24 vertex constraints.

In total, the ğ‘’+ğ‘’âˆ’ â†’ ğ‘‹ ğ‘‹ ğœ‹+ğœ‹âˆ’, ğ‘‹ â†’ ğœ‹+ğœ‹âˆ’ hypothesis contains 34 constraints. This hypothesis
contains 39 free parameters. Among these parameters, 20 parameters are measurable and 19
parameters are non-measurable.

8.9.2 Fitting procedure details

For demonstration purposes, only six-track events are passed to the input of the ï¬tting procedure
under the ğ‘’+ğ‘’âˆ’ â†’ ğ‘‹ ğ‘‹ ğœ‹+ğœ‹âˆ’, ğ‘‹ â†’ ğœ‹+ğœ‹âˆ’ hypothesis. In these events, all possible mappings of
charged pions into their tracks are considered. For each mapping, a separate ï¬t is performed. The
number of diï¬€erent mappings of the ï¬nal pions into their tracks in the considered hypothesis is
18. These mappings are shown in table 3. The considered hypothesis clearly shows that as the

â€“ 54 â€“

Table 3: Mappings between charged particles and their tracks in the case of the ğ‘’+ğ‘’âˆ’ â†’
ğ‘‹ ğ‘‹ ğœ‹+ğœ‹âˆ’, ğ‘‹ â†’ ğœ‹+ğœ‹âˆ’ hypothesis. 1 â€” the ğ‘’+ğ‘’âˆ’ interaction vertex, 2 and 3 â€” the ğ‘‹ â†’ ğœ‹+ğœ‹âˆ’
decay vertices, ğ‘¡+
1,2,3 are tracks of negatively charged
particles.

1,2,3 are tracks of positively charged particles, ğ‘¡âˆ’

Origin vertex
Final particle

Track com-
binations

1

2

3

1

2

3

ğœ‹+
ğ‘¡+
1
ğ‘¡+
3
ğ‘¡+
2
ğ‘¡+
1
ğ‘¡+
3
ğ‘¡+
2
ğ‘¡+
1
ğ‘¡+
3
ğ‘¡+
2

ğœ‹âˆ’
ğ‘¡âˆ’
1
ğ‘¡âˆ’
1
ğ‘¡âˆ’
1
ğ‘¡âˆ’
1
ğ‘¡âˆ’
1
ğ‘¡âˆ’
1
ğ‘¡âˆ’
3
ğ‘¡âˆ’
3
ğ‘¡âˆ’
3

ğœ‹+
ğ‘¡+
2
ğ‘¡+
1
ğ‘¡+
3
ğ‘¡+
3
ğ‘¡+
2
ğ‘¡+
1
ğ‘¡+
2
ğ‘¡+
1
ğ‘¡+
3

ğœ‹âˆ’
ğ‘¡âˆ’
2
ğ‘¡âˆ’
2
ğ‘¡âˆ’
2
ğ‘¡âˆ’
2
ğ‘¡âˆ’
2
ğ‘¡âˆ’
2
ğ‘¡âˆ’
1
ğ‘¡âˆ’
1
ğ‘¡âˆ’
1

ğœ‹+
ğ‘¡+
3
ğ‘¡+
2
ğ‘¡+
1
ğ‘¡+
2
ğ‘¡+
1
ğ‘¡+
3
ğ‘¡+
3
ğ‘¡+
2
ğ‘¡+
1

ğœ‹âˆ’
ğ‘¡âˆ’
3
ğ‘¡âˆ’
3
ğ‘¡âˆ’
3
ğ‘¡âˆ’
3
ğ‘¡âˆ’
3
ğ‘¡âˆ’
3
ğ‘¡âˆ’
2
ğ‘¡âˆ’
2
ğ‘¡âˆ’
2

ğœ‹+
ğ‘¡+
1
ğ‘¡+
3
ğ‘¡+
2
ğ‘¡+
1
ğ‘¡+
3
ğ‘¡+
2
ğ‘¡+
1
ğ‘¡+
3
ğ‘¡+
2

ğœ‹âˆ’
ğ‘¡âˆ’
3
ğ‘¡âˆ’
3
ğ‘¡âˆ’
3
ğ‘¡âˆ’
2
ğ‘¡âˆ’
2
ğ‘¡âˆ’
2
ğ‘¡âˆ’
2
ğ‘¡âˆ’
2
ğ‘¡âˆ’
2

ğœ‹+
ğ‘¡+
3
ğ‘¡+
2
ğ‘¡+
1
ğ‘¡+
2
ğ‘¡+
1
ğ‘¡+
3
ğ‘¡+
3
ğ‘¡+
2
ğ‘¡+
1

ğœ‹âˆ’
ğ‘¡âˆ’
1
ğ‘¡âˆ’
1
ğ‘¡âˆ’
1
ğ‘¡âˆ’
3
ğ‘¡âˆ’
3
ğ‘¡âˆ’
3
ğ‘¡âˆ’
3
ğ‘¡âˆ’
3
ğ‘¡âˆ’
3

ğœ‹+
ğ‘¡+
2
ğ‘¡+
1
ğ‘¡+
3
ğ‘¡+
3
ğ‘¡+
2
ğ‘¡+
1
ğ‘¡+
2
ğ‘¡+
1
ğ‘¡+
3

ğœ‹âˆ’
ğ‘¡âˆ’
2
ğ‘¡âˆ’
2
ğ‘¡âˆ’
2
ğ‘¡âˆ’
1
ğ‘¡âˆ’
1
ğ‘¡âˆ’
1
ğ‘¡âˆ’
1
ğ‘¡âˆ’
1
ğ‘¡âˆ’
1

number of particles and vertices increases, the number of ï¬ts per event increases dramatically.
This increase leads to a signiï¬cant slowdown in the ï¬tting procedure. Therefore, in such or more
complex hypotheses, before the ï¬tting procedure, it may be necessary to perform some preliminary
procedure that reduces the number of track permutations. This procedure can be based on the
analysis of track parameters. With the help of such a preliminary procedure, one can make an
approximate conclusion about whether a certain pair of tracks originates from the same vertex or
not. In this work, we do not use such a preliminary procedure. Instead, we consider all mappings
from table 3 for demonstration purposes, i.e. perform 18 ï¬ts per event.

8.9.3 Fitting the ğ‘’+ğ‘’âˆ’ â†’ ğ¾ğ‘†ğ¾ğ‘† ğœ‹+ğœ‹âˆ’, ğ¾ğ‘† â†’ ğœ‹+ğœ‹âˆ’ events

Let us present the results of applying the ï¬tting procedure 8.9.2 to the events of the ğ‘’+ğ‘’âˆ’ â†’
ğ¾ğ‘†ğ¾ğ‘† ğœ‹+ğœ‹âˆ’ process, where both ğ¾ğ‘†-mesons decay into two charged pions. As noted above, the
ğ‘’+ğ‘’âˆ’ â†’ ğ‘‹ ğ‘‹ ğœ‹+ğœ‹âˆ’, ğ‘‹ â†’ ğœ‹+ğœ‹âˆ’ hypothesis is a signal hypothesis for the considered process.
The ï¬tting procedure converges to a local minimum in 9002 events out of 9194. This procedure
converges to a local maximum in 16 events and does not converge in 176 events. The corresponding
ï¬t convergence histogram and chi-square distribution are shown in ï¬gures 32a and 32b, respectively.
Figure 32c shows the invariant mass distributions of the decay products of the ï¬rst intermediate
particle. Similar invariant-mass distributions corresponding to the decay products of the second
intermediate particle are shown in ï¬gure 32d. The solid line in these ï¬gures denotes the distributions
obtained using the measured particle parameters, but the mappings of charged pions into their tracks
were found with the ï¬tting procedure. The dashed line denotes the invariant mass distributions
obtained using the particle parameters found with the ï¬tting procedure. It can be seen from both
ï¬gures that the use of the ï¬tting procedure leads to an improvement in the resolution of the invariant
mass.

Figure 33a shows the distribution of the distance between the ğ‘’+ğ‘’âˆ’ interaction vertex and the

â€“ 55 â€“

(a) Fit convergence histogram. See description in
ï¬gure 4a.

(b) Chi-square distribution.

(c) Two-pion invariant mass distributions. These
two pions are the decay products of the ï¬rst inter-
mediate particle. The histogram indicated by the
solid line was obtained using the measured parti-
cle parameters, but the mappings of charged par-
ticles into their tracks were found using the ï¬tting
procedure 8.9.2. The histogram indicated by the
dashed line was obtained using the particle param-
eters found with this ï¬tting procedure.

(d) Two-pion invariant mass distributions. These
two pions are the decay products of the second
intermediate particle. Diï¬€erent line styles have the
same meaning as in ï¬gure 32c.

Figure 32: Some results of applying the ï¬tting procedure 8.9.2 to the events of the ğ‘’+ğ‘’âˆ’ â†’
ğ¾ğ‘†ğ¾ğ‘† ğœ‹+ğœ‹âˆ’, ğ¾ğ‘† â†’ ğœ‹+ğœ‹âˆ’ simulation.

decay vertex of the ï¬rst intermediate particle. Figure 33b shows a similar distribution corresponding
to the second intermediate particle. In both cases, the vertex coordinates were found using the ï¬tting
procedure. These distributions are similar to those shown in some of the previous examples (see
ï¬gure 9a, for example).

â€“ 56 â€“

0123errorcode05000Entries9194Mean0.0226StdDev0.16000100200Ï‡20200400Entries9002Mean50.3013StdDev51.72820.40.50.6MÏ€+Ï€âˆ’(GeV/c2)0250500Entries9002Mean0.4969StdDev0.0256Entries9002Mean0.4978StdDev0.0216beforeï¬tafterï¬t0.40.50.6MÏ€+Ï€âˆ’(GeV/c2)0200400Entries9002Mean0.4966StdDev0.0260Entries9002Mean0.4977StdDev0.0220beforeï¬tafterï¬t(a) Distance between the ğ‘’+ğ‘’âˆ’ interaction vertex
and the decay vertex of the ï¬rst intermediate parti-
cle.

(b) Distance between the ğ‘’+ğ‘’âˆ’ interaction vertex
and the decay vertex of the second intermediate
particle.

Figure 33: Distances between the ğ‘’+ğ‘’âˆ’ interaction vertex and the decay vertex of one of the
intermediate particles. The vertex coordinates are found with the ï¬tting procedure 8.9.2.

9 Examples of Gaussian simulation

In this section, we discuss kinematic and vertex ï¬tting of events obtained using Gaussian simula-
tion 4.1. Subsection 9.1 provides examples of Gaussian simulations of the ğ‘’+ğ‘’âˆ’ â†’ ğœ‚ğœ‹+ğœ‹âˆ’, ğœ‚ â†’ ğ›¾ğ›¾
process. The events of these simulations are ï¬tted under the ğ‘’+ğ‘’âˆ’ â†’ ğœ‹+ğœ‹âˆ’ğ›¾ğ›¾ hypothesis. Subsec-
tion 9.2 provides examples of Gaussian simulations of the ğ‘’+ğ‘’âˆ’ â†’ ğ¾ğ‘†ğ¾ Â±ğœ‹âˆ“, ğ¾ğ‘† â†’ ğœ‹+ğœ‹âˆ’ process.
The events of these simulations are ï¬tted under the ğ‘’+ğ‘’âˆ’ â†’ ğ‘‹ğ¾ Â±ğœ‹âˆ“, ğ‘‹ â†’ ğœ‹+ğœ‹âˆ’ hypotheses.

The event of the corresponding Monte Carlo simulation was chosen as the initial event for
each of Gaussian simulations discussed in this section. The examples in this section are of interest
for testing the ï¬tting package, as well as for observing how constraint non-linearity distorts the ğœ’2
distribution.

9.1 Hypothesis ğ‘’+ğ‘’âˆ’ â†’ ğœ‹+ğœ‹âˆ’ğ›¾ğ›¾

This subsection presents the results of ï¬tting the events of the Gaussian simulation of the ğ‘’+ğ‘’âˆ’ â†’
ğœ‚ğœ‹+ğœ‹âˆ’, ğœ‚ â†’ ğ›¾ğ›¾ process. As the initial event, a certain event of the ğ‘’+ğ‘’âˆ’ â†’ ğœ‚ğœ‹+ğœ‹âˆ’, ğœ‚ â†’ ğ›¾ğ›¾
Monte Carlo simulation is chosen. It should be noted that the same Monte Carlo simulation is used
as in section 8.5.2. The ï¬tting procedure under the ğ‘’+ğ‘’âˆ’ â†’ ğœ‹+ğœ‹âˆ’ğ›¾ğ›¾ hypothesis 8.5.1 was applied
once to the initial event. This procedure made it possible to obtain measurable particle parameters
satisfying the constraints. Then the initial event was redeï¬ned: the measured parameters of the
particles were replaced by the corresponding parameters obtained with the ï¬tting procedure (see
section 4.1). Then these parameters were drawn multiple times according to the corresponding
multivariate normal distribution. As a result of such draws, the Gaussian simulation events were
obtained. These events were ï¬tted under the ğ‘’+ğ‘’âˆ’ â†’ ğœ‹+ğœ‹âˆ’ğ›¾ğ›¾ hypothesis. The ï¬gure 34 shows
the ğœ’2 distribution for the events of this Gaussian simulation. This distribution corresponds to
the case when all constraints are enabled in the ğ‘’+ğ‘’âˆ’ â†’ ğœ‹+ğœ‹âˆ’ğ›¾ğ›¾ hypothesis. A list of these
constraints is given in section 34. The hypothesis contains ğ‘š = 10 constraints and ğ‘™ = 3 free
non-measurable parameters. If all constraints were linear, one would expect the ğœ’2 distribution to

â€“ 57 â€“

0510âˆ†rï¬t(cm)0250500Entries9002Mean1.2541StdDev1.39090510âˆ†rï¬t(cm)0250500Entries9002Mean1.2491StdDev1.4061Figure 34: Chi-square distribution in the case of the ğ‘’+ğ‘’âˆ’ â†’ ğœ‚ğœ‹+ğœ‹âˆ’, ğœ‚ â†’ ğ›¾ğ›¾ Gaussian simulation.
The events of this simulation were ï¬tted under the ğ‘’+ğ‘’âˆ’ â†’ ğœ‹+ğœ‹âˆ’ğ›¾ğ›¾ hypothesis 8.5.1. All the
constraints corresponding to this hypothesis were enabled. The solid line is the ğœ’2 histogram, and
the dashed line is the ï¬tting function.

be described by the chi-square probability density function (4.1) with ğ‘š âˆ’ ğ‘™ = 7 degrees of freedom
(see section 4.2.2). However, all the constraints of the considered hypothesis are nonlinear. Despite
this, the ğœ’2 distribution is well described by the chi-square probability density function. This
statement was veriï¬ed by ï¬tting the distribution to a probability density function (4.1) multiplied
by the normalization factor ğ‘ğ‘, where ğ‘ is the bin width of the ğœ’2 histogram and ğ‘ is the number
of events in the Gaussian simulation. In the ï¬tting function, the number degrees of freedom and ğ‘
are considered as free parameters. The ğœ’2 histogram in ï¬gure 34 is indicated by a solid line, while
the ï¬tting function is indicated by a dashed line. The ï¬tting parameters are shown in the ï¬gure in
the dashed box. The ï¬tting function indeed describes the histogram well. The number of degrees
found with the ï¬t is 6.9974 Â± 0.0035, i.e. it is equal to 7 with good accuracy.

To estimate the magnitude of the non-linearity of the constraints, one can obtain the distribution
2 Î”ğ’š(cid:124) Ë†ğ‘„Î”ğ’š, where Ë†ğ‘„ is the Ë†ğ‘„ğ‘ âˆ’1 from equations (2.8) and (2.9) calculated after
of the quadratic form 1
the minimization is completed. As noted above, the matrix Ë†ğ‘„ contains the constraint Hessians. In
2 Î”ğ’š(cid:124) Ë†ğ‘„Î”ğ’š
the case of linear constraints, this matrix is zero. The distribution of the quadratic form 1
is shown in ï¬gure 35a. This distribution was obtained under the conditions described in the
previous paragraph.
It can be seen from the ï¬gure that the mean value of the quadratic form
2 Î”ğ’š(cid:124) Ë†ğ‘„Î”ğ’š is approximately equal to zero, while its standard deviation is approximately equal to
1
0.4. From equation (2.8) it is clear that in order to estimate the magnitude of the non-linearity of the
2 Î”ğ’š(cid:124) Ë†ğ‘„Î”ğ’š should be compared with the chi-square ğœ’2 = Î”ğ’™(cid:124) Ë†ğ¶âˆ’1Î”ğ’™.
constraints, the quadratic form 1
The corresponding two-dimensional histogram is shown in ï¬gure 35b. It can be seen from the ï¬gure
2 Î”ğ’š(cid:124) Ë†ğ‘„Î”ğ’š is always several times less than the chi-square. It is shown below
that the quadratic form 1
that in those cases where the non-linearity of the constraints leads to a signiï¬cant distortion of the

â€“ 58 â€“

051015202530Ï‡205000100001500020000Entries1000000Mean6.9764StdDev3.6847N999880Â±1001NDFparameter6.9974Â±0.0035Ï‡2/NDF134.4366/126(a) Distribution of the quadratic form 1

2 Î”ğ’š(cid:124) Ë†ğ‘„Î”ğ’š.

(b) Two-dimensional distribution:
ğœ’2.

1

2 Î”ğ’š(cid:124) Ë†ğ‘„Î”ğ’š vs

Figure 35: Figures showing the non-linearity of constraints. These ï¬gures correspond to the
events of the ğ‘’+ğ‘’âˆ’ â†’ ğœ‚ğœ‹+ğœ‹âˆ’, ğœ‚ â†’ ğ›¾ğ›¾ Gaussian simulation. These events were ï¬tted under
ğ‘’+ğ‘’âˆ’ â†’ ğœ‹+ğœ‹âˆ’ğ›¾ğ›¾ hypothesis 8.5.1. All constraints of this hypothesis were enabled.

chi-square distribution, the 1

2 Î”ğ’š(cid:124) Ë†ğ‘„Î”ğ’š distribution is signiï¬cantly wider.
The ğœ’2 distributions similar to those shown in ï¬gure 34 can be obtained when some of the
constraints are disabled while ï¬tting the events of the Gaussian simulation. So, for example,
ï¬gure 36a shows the distribution in the case when the energy conservation constraint is disabled.
Figure 36b shows the ğœ’2 distribution in the case when the energy conservation and ğ‘§-momentum
conservation constraints are disabled. Figure 36c shows the ğœ’2 distribution in the case when the
energy, ğ‘¥-momentum, and ğ‘¦-momentum conservation constraints are disabled. Finally, ï¬gure 36d
shows the distribution in the case when all four-momentum conservation constraints are disabled.
If the constraints were linear, one would expect the listed distributions to follow the chi-square
distribution (4.1) with ğ‘š âˆ’ ğ‘™ degrees of freedom. Despite the fact that the constraints are nonlinear,
the distributions in ï¬gures 36a, 36b and 36c correspond to the probability density function (4.1). The
number of degrees of freedom in these cases is 6, 5 and 4, respectively. In the case of ï¬gure (36d),
the chi-square distribution is less well described by a probability density function (4.1). The ratio
ğœ’2/NDF â‰ˆ 180.7/125 obtained by ï¬tting this distribution is large. Despite this, the ï¬tting function
visually describes the ğœ’2 histogram. The number of degrees of freedom found with the ï¬tting is
the same as ğ‘š âˆ’ ğ‘™ and equal to 3.

As mentioned above, a certain single event of the ğ‘’+ğ‘’âˆ’ â†’ ğœ‹+ğœ‹âˆ’ğœ‚, ğœ‚ â†’ ğ›¾ğ›¾ Monte Carlo
simulation was chosen as the initial event. However, it should be noted that the ï¬tting results given
in this subsection do not depend on the choice of the initial event. However, in cases where the
non-linearity of the constraints can manifest itself strongly, the results of the Gaussian simulation
can signiï¬cantly depend on the choice of the initial event. Such a case is described in detail in the
next subsection.

9.2 Hypotheses ğ‘’+ğ‘’âˆ’ â†’ ğ‘‹ğ¾ Â±ğœ‹âˆ“, ğ‘‹ â†’ ğœ‹+ğœ‹âˆ’

This subsection discuss the ï¬tting results corresponds to a number of the ğ‘’+ğ‘’âˆ’ â†’ ğ¾ğ‘†ğ¾ Â±ğœ‹âˆ“,
ğ¾ğ‘† â†’ ğœ‹+ğœ‹âˆ’ Gaussian simulations. Each Gaussian simulation corresponds to diï¬€erent initial
events. As in the previous subsection, the events of the corresponding Monte Carlo simulation

â€“ 59 â€“

0512âˆ†yâŠºË†Qâˆ†y01000020000Entries1000000Mean0.0108StdDev0.41651020Ï‡2âˆ’2.50.02.512âˆ†yâŠºË†Qâˆ†y0.0001.0672.1333.2004.2675.3336.4007.467(a) The energy conservation constraint is disabled.

(b) The energy and ğ‘§-momentum conservation con-
straints are disabled.

(c) The energy, ğ‘¥- and ğ‘¦-momentum conservation
constraints are disabled.

(d) All four-momentum conservation constraints
are disabled.

Figure 36: Chi-square distributions. These distributions correspond to the events of the ğ‘’+ğ‘’âˆ’ â†’
ğœ‚ğœ‹+ğœ‹âˆ’, ğœ‚ â†’ ğ›¾ğ›¾ Gaussian simulation. The events of this simulation were ï¬tted under the ğ‘’+ğ‘’âˆ’ â†’
ğœ‹+ğœ‹âˆ’ğ›¾ğ›¾ hypothesis 8.5.1. During the ï¬tting, some constraints were disabled. The solid line
indicates the ğœ’2 histogram, while the dashed line indicates the ï¬tting function, similar to that used
in ï¬gure 34. The parameters of the ï¬tting functions, as well as the ï¬t quality ratios ğœ’2/NDF, are
shown in the dashed boxes.

â€“ 60 â€“

0102030Ï‡201000020000Entries1000000Mean5.9883StdDev3.4343N999886Â±1000NDFparameter5.9968Â±0.0032Ï‡2/NDF137.1225/1260102030Ï‡2020000Entries1000000Mean4.9958StdDev3.1499N999834Â±1000NDFparameter4.9981Â±0.0029Ï‡2/NDF125.3302/1260102030Ï‡2020000Entries1000000Mean3.9974StdDev2.8215N999504Â±999NDFparameter4.0012Â±0.0025Ï‡2/NDF146.5867/1260102030Ï‡202000040000Entries1000000Mean2.9994StdDev2.4499N997930Â±998NDFparameter3.0097Â±0.0021Ï‡2/NDF180.7732/125(a) A case of the Gaussian simulation based on one
of the Monte Carlo simulation events.

(b) A case of the Gaussian simulation based on
another Monte Carlo simulation event.

(c) A case of the Gaussian simulation based on the
third event of the Monte Carlo simulation.

(d) A case of the Gaussian simulation based on all
Monte Carlo simulation events.

Figure 37: Chi-square distributions corresponding to the events of the ğ‘’+ğ‘’âˆ’ â†’ ğ¾ğ‘†ğ¾ Â±ğœ‹âˆ“, ğ¾ğ‘† â†’
ğœ‹+ğœ‹âˆ’ Gaussian simulations. These events were ï¬tted under the correct signal hypothesis: ğ‘’+ğ‘’âˆ’ â†’
ğ‘‹ğ¾ +ğœ‹âˆ’, ğ‘‹ â†’ ğœ‹+ğœ‹âˆ’ or ğ‘’+ğ‘’âˆ’ â†’ ğ‘‹ğ¾ âˆ’ğœ‹+, ğ‘‹ â†’ ğœ‹+ğœ‹âˆ’. The ğœ’2 histogram is indicated by a solid line,
while the dashed line is the ï¬tting function. This ï¬tting function is proportional to the probability
density function (4.1) of the chi-square distribution from statistics. The ï¬tting function describes
the histogram well only in ï¬gure (a).

â€“ 61 â€“

0204060Ï‡202000040000Entries999981Mean10.0255StdDev4.4837N999893Â±1000NDFparameter10.0209Â±0.0043Ï‡2/NDF91.5048/810204060Ï‡2020000Entries998666Mean16.4860StdDev10.6346N788678Â±888NDFparameter13.0698Â±0.0101Ï‡2/NDF205727.0004/1260200400Ï‡2050000Entries989308Mean66.6045StdDev71.7267N337402Â±581NDFparameter16.9579Â±0.0317Ï‡2/NDF640779.8118/126050100150Ï‡20500Entries20533Mean22.8963StdDev25.5822N13671Â±117NDFparameter11.4774Â±0.0568Ï‡2/NDF5102.2019/253(see section 8.1.3) were used as these initial events. Further, to obtain the events of each Gaussian
simulation, a procedure similar to that described in the ï¬rst paragraph of the previous subsection
was performed. However, in this case, one of the ğ‘’+ğ‘’âˆ’ â†’ ğ‘‹ğ¾ Â±ğœ‹âˆ“, ğ‘‹ â†’ ğœ‹+ğœ‹âˆ’ hypotheses is used,
while ï¬tting the simulated events. Moreover, when ï¬tting each simulation event, only the correct
signal hypothesis is used to avoid mixing of kaons and pions.

Figure 37a shows the ğœ’2 distribution corresponding to the events of the ï¬rst Gaussian simula-
tion. The parameters of the particles and their covariance matrices in the corresponding initial event
are such that the eï¬€ects of the constraints non-linearity are not large enough to lead to a signiï¬cant
distortion of the chi-square distribution. It is seen from the ï¬gure that the ğœ’2 histogram is well
described by the probability density function (4.1). Moreover, the number of degrees of freedom is
equal to 10, as expected.

In the case of a Gaussian simulation obtained using another initial event, the parameters of the
particles in this initial event turned out to be such that they led to signiï¬cant non-linearity eï¬€ects.
The corresponding ğœ’2 histogram is shown in ï¬gure 37b. It can be seen from the ï¬gure that this
histogram is not described by the probability density function 4.1.

Figure 37c shows the ğœ’2 histogram for an even more dramatic case than in ï¬gure 37b. This
ï¬gure corresponds to the events of the third Gaussian simulation obtained using a third initial event
diï¬€erent from the ï¬rst two. In this case, the distribution is much wider than in ï¬gures 37a and 37b.
This distribution is not described by the probability density function (4.1).

Although the non-linearity of the constraints tends to a wider chi-square distribution, even
in the worst case shown in ï¬gure 37c, the ğœ’2 distribution peaks at ğœ’2 âˆ¼ 10. Comparing this
distribution with the ğœ’2 distribution shown in ï¬gure 13b and obtained for background events, one
can conclude that even in the worst case, signal and background events can be separated using a
chi-square selection criterion. However, it is clear that the separation power is the smaller, the wider
the signal ğœ’2 distribution.

In connection with the above, the question arises, what is the ratio between the number of
events in the Monte Carlo simulation, leading to the distributions in ï¬gure 37a and ï¬gures 37b, 37c.
This question can be answered using a slightly diï¬€erent kind of Gaussian simulation than the one
described above. Instead of doing a Gaussian simulation based on a single Monte Carlo simulation
event, let us draw one Gaussian simulation event for each event of the Monte Carlo simulation. The
ğœ’2 distribution corresponding to such a Gaussian simulation is shown in ï¬gure 37d. Although this
distribution is not consistent with the probability density function (4.1), it can be concluded that
the Monte Carlo simulation is dominated by events that correspond to distributions in ï¬gures 37a
and 37b.

Figure 38a shows the 1

2 Î”ğ’š(cid:124) Ë†ğ‘„Î”ğ’š distribution. This distribution corresponds to the Gaussian
simulation in the case of ï¬gure 37a. As in the case of ï¬gure 35a, the peak of this distribution is
approximately at zero. The standard deviation is equal to 1.6, which is about four times greater
2 Î”ğ’š(cid:124) Ë†ğ‘„Î”ğ’š
than in the case of ï¬gure 35a. Figure 38b shows the two-dimensional distribution of the 1
versus the ğœ’2. This distribution is similar to that shown in ï¬gure 35b in the case of the ğ‘’+ğ‘’âˆ’ â†’
ğœ‚ğœ‹+ğœ‹âˆ’, ğœ‚ â†’ ğ›¾ğ›¾ Gaussian simulation.

Figure 39 shows distributions similar to those shown in ï¬gure 38, but corresponds to the case of
the second and third Gaussian simulations, i.e. ï¬gures 37b and 37c, respectively. Figure 39a shows
2 Î”ğ’š(cid:124) Ë†ğ‘„Î”ğ’š distribution for the events of the second Gaussian simulation. The standard deviation
the 1

â€“ 62 â€“

(a) Distribution of the quadratic form 1

2 Î”ğ’š(cid:124) Ë†ğ‘„Î”ğ’š.

(b) Two-dimensional distribution:
ğœ’2.

1

2 Î”ğ’š(cid:124) Ë†ğ‘„Î”ğ’š vs

Figure 38: Figures showing the nonlinearity of constraints. These ï¬gures correspond to the events
of the ğ‘’+ğ‘’âˆ’ â†’ ğ¾ğ‘†ğ¾ Â±ğœ‹âˆ“, ğ¾ğ‘† â†’ ğœ‹+ğœ‹âˆ’ Gaussian simulation. This Gaussian simulation corresponds
to the case of the ğœ’2 distribution shown in ï¬gure 37a.

(a) Distribution of the quadratic form 1
the case of the second Gaussian simulation.

2 Î”ğ’š(cid:124) Ë†ğ‘„Î”ğ’š in

2 Î”ğ’š(cid:124) Ë†ğ‘„Î”ğ’š vs
(b) Two-dimensional distribution ( 1
ğœ’2) in the case of the second Gaussian simulation.

(c) Distribution of the quadratic form 1
the case of the third Gaussian simulation.

2 Î”ğ’š(cid:124) Ë†ğ‘„Î”ğ’š in

(d) Two-dimensional distribution ( 1
ğœ’2) in the case of the third Gaussian simulation.

2 Î”ğ’š(cid:124) Ë†ğ‘„Î”ğ’š vs

Figure 39: Figures showing the nonlinearity of constraints. These ï¬gures correspond to the events
of the two diï¬€erent ğ‘’+ğ‘’âˆ’ â†’ ğ¾ğ‘†ğ¾ Â±ğœ‹âˆ“, ğ¾ğ‘† â†’ ğœ‹+ğœ‹âˆ’ Gaussian simulations (second and third).
Figures (a) and (b) correspond to the events of the second simulation, while ï¬gures (c) and (d)
correspond to the events of the third simulation. The second Gaussian simulation corresponds to
the ğœ’2 distribution shown in ï¬gure 37b, while the third Gaussian simulation corresponds to the
distribution shown in ï¬gure 37c.

â€“ 63 â€“

0255012âˆ†yâŠºË†Qâˆ†y02000040000Entries999981Mean-0.0781StdDev1.62982040Ï‡2âˆ’2502512âˆ†yâŠºË†Qâˆ†y0.0001.3332.6674.0005.3336.6678.0009.333âˆ’250255012âˆ†yâŠºË†Qâˆ†y0500010000Entries998666Mean0.0474StdDev4.83272550Ï‡205012âˆ†yâŠºË†Qâˆ†y0.0001.3332.6674.0005.3336.6678.0009.333010020012âˆ†yâŠºË†Qâˆ†y0500010000Entries989308Mean40.1802StdDev48.7027100200Ï‡2020012âˆ†yâŠºË†Qâˆ†y0.0001.3332.6674.0005.3336.6678.0009.333of this distribution is about three times larger than in the case of the distribution shown in ï¬gure 38a.
2 Î”ğ’š(cid:124) Ë†ğ‘„Î”ğ’š is suï¬ƒcient to skew the corresponding
As shown in ï¬gure 37b, such a deviation of the 1
2 Î”ğ’š(cid:124) Ë†ğ‘„Î”ğ’š versus the ğœ’2
ğœ’2 distribution. Figure 39b shows the two-dimensional distribution of the 1
for the case of the second Gaussian simulation. Figures 39c and 39d show distributions similar to
those shown in ï¬gures 39a and 37b, respectively. Figures 39c and 39d correspond to the case of the
third Gaussian simulation. Figure 39c shows that the distribution in this case is much wider than
in the case of the ï¬rst and second Gaussian simulations. In addition, this distribution is strongly
asymmetric with respect to zero. Moreover, the long tail on the right slope of this distribution
corresponds to large chi-square values. This can be seen from the two-dimensional distribution
shown in ï¬gure 39d.

10 Fitting package

The kinematic and vertex ï¬tting package consists of two parts. The ï¬rst part is the base ï¬tting
package KFBase. The KFBase package contains the optimizer class and an abstract base hypothesis
class. This package also contains classes for all constraints, vertices and particles, except for charged
particles and photons. The second part is the package of kinematic and vertex ï¬tting for the CMD-3
experiment. This package is called KFCmd and depends on the base ï¬tting package. The KFCmd
package contains classes of charged particles and photons. It also contains a class responsible for
reading input data, as well as classes with the implementation of some hypotheses. The packages
KFBase and KFCmd, as well as their documentation, can be found in the repositories https://
github.com/sergeigribanov/KFBase and https://github.com/sergeigribanov/KFCmd,
respectively.

Both packages are written in the C++ programming language and depend on a number of
other packages such as ROOT [25] and Eigen 3 [26]. The Eigen 3 header only library is used
for matrix computations, while the ROOT framework is mainly used for ï¬le manipulations. The
authors also provide a docker image that contains a number of examples of using the ï¬tting
package. The examples can be run in Jupiter notebooks based on the python 3 kernel. The
ï¬tting package does not currently have a python API. Instead of such an API, the PyROOT [27]
functionality is currently used. The repository with the docker image can be found at the link https:
//github.com/sergeigribanov/kinfit-cmd3-docker.

11 Summary

In this paper, the authors reviewed in detail the algorithm of operation and the capabilities of the
kinematic and vertex ï¬tting package for the CMD-3 experiment. The paper provides a description
of the constraints available in the ï¬tting package, as well as the parameterizations of particles
and vertices. The work provides a number of examples that show the operation of the ï¬tting
package using most of the constraints and particle parametrizations. These examples consider
hypotheses containing charged particles and photons in the ï¬nal state, hypotheses with intermediate
and lost particles. It should be noted that the ï¬tting package can be easily extended with additional
constraints, particle and vertex parameterizations. Despite the fact that this package was developed

â€“ 64 â€“

for the CMD-3 experiment, the authors believe that after some adaptation the package can be used
in other similar experiments.

In addition, the ï¬tting package was tested using the Gaussian simulation technique. This kind
of testing is very useful, as it helps to eliminate some issues at the stage of package development.
Typos in the gradients and Hessians of constraints, as well as of the particle four-momentum and
trajectories, can be examples of such issues. Since some gradients and Hessians can be very
cumbersome, testing for this kind of issues requires special attention.

The authors consider the discussed kinematic and vertex ï¬tting package as their ï¬rst step
towards a more rigorous and universal ï¬tting package. In the future, it is planned to pay special
attention to the optimization algorithm. The ï¬tting package currently uses Newtonâ€™s method. This
requires inverting the Hessian matrix at each iteration of the optimization procedure. The more
optimization parameters the hypothesis contains, the more resource-intensive the Hessian inversion
becomes. The authors plan to consider the possibility of using quasi-Newtonian methods [17, 18],
in which the Hessian inversion does not occur at every iteration. In the case of hypotheses with
a large number of vertices, the authors also plan to study optimization algorithms based on the
Kalman ï¬ltering, similar to the one discussed in the paper [8]. In addition, the authors plan to also
explore the possibility of using inequality constraints [17, 20, 21] in some kinematic and vertex
ï¬tting cases.

12 Acknowledgments

The authors are grateful to the members of the CMD-3 collaboration for discussion of the considered
topic and numerous suggestions. The authors also express special gratitude to the members of the
collaboration who are already actively using and testing the ï¬tting package. The work described in
sections 2-7 is supported by Russian Science Foundation grant No. 19-72-20114. The work related
to the testing of the ï¬tting package is supported by the Russian Foundation for Basic Research grant
No. 20-02-00496 A.

References

[1] J.M. Bauer, Kinematic Fit for the Radiative Bhabha Calibration of BaBarâ€™s Electromagnetic

Calorimeter, 2000. 10.48550/ARXIV.HEP-EX/0011019.

[2] K. Prokoï¬ev and T. Speer, â€œA kinematic and a decay chain reconstruction library.â€ https://twiki.
cern.ch/twiki/pub/CMSPublic/SWGuideKinematicVertexFit/CMS_IN_2004_20.pdf, 2004.

[3] K. Prokoï¬ev and T. Speer, A kinematic and a decay chain reconstruction library, in 14th

International Conference on Computing in High-Energy and Nuclear Physics, pp. 411â€“414, 2005.

[4] Y. Liang, H. Rang-Lin, L. Wei-Guo, B. Jian-Ming, F. Cheng-Dong, H. Bin et al., Lagrange multiplier

method used in BESIII kinematic ï¬tting, Chinese Physics C 34 (2010) 204.

[5] P. JÃ¶rg, The kinematically constrained ï¬t, in Exploring the Size of the Proton: by Means of Deeply

Virtual Compton Scattering at CERN, (Cham), pp. 61â€“76, Springer International Publishing (2018),
DOI.

[6] J. Sundermann and T. GÃ¶pfert, â€œKinFitter â€“ A Kinematic Fit with Constraints.â€

https://github.com/goepfert/KinFitter.

â€“ 65 â€“

[7] R. Smith and J. Bishop, A Fast Universal Kinematic Fitting Code for Low-Energy Nuclear Physics:

FUNKI_FIT, Physics 1 (2019) .

[8] J.-F. Krohn, F. Tenchini, P. UrquÄ³o, F. AbudinÃ©n, S. Cunliï¬€e, T. Ferber et al., Global decay chain

vertex ï¬tting at Belle II, Nuclear Instruments and Methods in Physics Research Section A:
Accelerators, Spectrometers, Detectors and Associated Equipment 976 (2020) 164269.

[9] Y. Radkhorrami and J. List, Kinematic ï¬tting for particle ï¬‚ow detectors at future higgs factories,

2021. 10.48550/ARXIV.2111.14775.

[10] B. Khazin, Physics and detectors for VEPP-2000, Nucl. Phys. B Proc. Suppl. 181-182 (2008) 376.

[11] G.P. Razuvaev et al., Calorimetry at the CMD-3 Detector, in CERN-BINP Workshop for Young

Scientists in ğ‘’+ğ‘’âˆ’ Colliders, pp. 71â€“76, 2017, DOI.

[12] V.V. Danilov, P.M. Ivanov, I.A. Koop, I.N. Nesterenko, E.A. Perevedentsev, D.N. Shatilov et al., â€œThe

Concept of Round Colliding Beams.â€ https://cds.cern.ch/record/860802, 1996.

[13] D. Berkaev, A. Kirpotin, I. Koop, A. Lysenko, I. Nesterenko, A. Otboyev et al., VEPP-2000 Operation

with Round Beams in the Energy Range from 1 to 2 GeV, Nuclear Physics B - Proceedings
Supplements 225-227 (2012) 303.

[14] A. Ioï¬€e and V. Tihomirov, Theory of Extremal Problems, Studies in mathematics and its applications

6, North-Holland (1979).

[15] D.P. Bertsekas, Constrained optimization and Lagrange multiplier methods, Optimization and neural

computation series, Athena Scientiï¬c, 1 ed. (1996).

[16] E. Herman and G. Strang, Calculus, vol. Volume 3, OpenStax (2018).

[17] P.E. Gill, W. Murray and M.H. Wright, Practical Optimization, Emerald Group Publishing Limited

(1982).

[18] A.F. Izmailov and M.V. Solodov, Newton-Type Methods for Optimization and Variational Problems,

Springer Series in Operations Research and Financial Engineering, Springer Cham (2014),
https://doi.org/10.1007/978-3-319-04247-3.

[19] N.K. Vishnoi, Algorithms for Convex Optimization, Cambridge University Press (2021),

https://doi.org/10.1017/9781108699211.

[20] E.G. Birgin and J.M. MartÃ­nez, Practical augmented Lagrangian methods for constrained

optimization, Fundamentals of Algorithms, Society for Industrial and Applied Mathematics (2014),
https://doi.org/10.1137/1.9781611973365.

[21] H.A. Eiselt and C.-L. Sandblom, Nonlinear Optimization, International Series in Operations Research
and Management Science, Springer Cham, 1 ed. (2019), https://doi.org/10.1007/978-3-030-19462-8.

[22] V.N. Bukov and S.V. Goryunov, Inversion and canonization of block matrices, Mathematical Notes 79

(2006) 614.

[23] S.S. Gribanov, A.S. Popov, R.R. Akhmetshin, A.N. Amirkhanov, A.V. Anisenkov, V.M. Aulchenko
et al., Measurement of the ğ‘’+ğ‘’âˆ’ â†’ ğœ‚ğœ‹+ğœ‹âˆ’ cross section with the CMD-3 detector at the VEPP-2000
collider, JHEP 01 (2020) 112 [1907.08002].

[24] V.M. Aulchenko, M.N. Achasov, A.Y. Barnyakov, K.I. Beloborodov, A.V. Berdyugin,

A.G. Bogdanchikov et al., Measurement of the ğ‘’+ğ‘’âˆ’ â†’ ğœ‚ğœ‹+ğœ‹âˆ’ cross section in the center-of-mass
energy range 1.22â€“2.00 gev with the snd detector at the vepp-2000 collider, Phys. Rev. D 91 (2015)
052013.

â€“ 66 â€“

[25] R. Brun and F. Rademakers, ROOT: An object oriented data analysis framework, Nucl. Instrum. Meth.

A 389 (1997) 81.

[26] G. Guennebaud, B. Jacob et al., â€œEigen v3.â€ http://eigen.tuxfamily.org, 2010.

[27] M. Galli, E. Tejedor and S. Wunsch, A New PyROOT: Modern, Interoperable and More Pythonic, EPJ

Web Conf. 245 (2020) 06004.

â€“ 67 â€“

