Shape-ConstrainedEstimationinFunctionalRegressionwithBernsteinPolynomialsRahulGhosal1,∗,SujitGhosh2,JacekUrbanek3,JenniferA.Schrack4,VadimZipunnikov51DepartmentofEpidemiologyandBiostatistics,UniversityofSouthCarolina2DepartmentofStatistics,NorthCarolinaStateUniversity3DepartmentofMedicine,JohnsHopkinsUniversitySchoolofMedicine4DepartmentofEpidemiology,JohnsHopkinsBloombergSchoolofPublicHealth5DepartmentofBiostatistics,JohnsHopkinsBloombergSchoolofPublicHealthSeptember13,2022AbstractShaperestrictionsonfunctionalregressioncoeﬃcientssuchasnon-negativity,monotonicity,convexityorconcavityareoftenavailableintheformofapriorknowledgeorrequiredtomaintainastructuralconsistencyinfunctionalregressionmodels.Anewestimationmethodisdevelopedinshape-constrainedfunctionalregressionmodelsusingBernsteinpolynomials.Speciﬁcally,estimationapproachesfromnonparametricregressionareextendedtofunctionaldata,properlyaccount-ingforshape-constraintsinalargeclassoffunctionalregressionmodelssuchasscalar-on-functionregression(SOFR),function-on-scalarregression(FOSR),andfunction-on-functionregression(FOFR).Theoreticalresultsestablishtheasymp-toticconsistencyoftheconstrainedestimatorsunderstandardregularityconditions.Aprojectionbasedapproachprovidespoint-wiseasymptoticconﬁdenceintervalsfortheconstrainedestimators.Abootstraptestisdevelopedfacilitatingtestingoftheshapeconstraints.Numericalanalysisusingsimulationsillustrateimprove-mentineﬃciencyoftheestimatorsfromtheuseoftheproposedmethodundershapeconstraints.Twoapplicationsincludei)modelingadrugeﬀectinamentalhealthstudyviashape-restrictedFOSRandii)modelingsubject-speciﬁcquantilefunctionsofaccelerometry-estimatedphysicalactivityintheBaltimoreLongitu-dinalStudyofAging(BLSA)asoutcomesviashape-restrictedquantile-functiononscalarregression(QFOSR).Rsoftwareimplementationandillustrationoftheproposedestimationmethodandthetestisprovided.Keywords:Shapeconstrainedestimation;Functionalregression;Montonicity,Convexity;PhysicalActivity1arXiv:2209.04476v1  [stat.ME]  9 Sep 20221IntroductionFunctionalregression(RamsayandSilverman,2005)isanactiveareaofresearchinfunc-tionaldataanalysis(FDA)andreferstotheclassofregressionmodelswithfunctionalresponseand/orcovariates.Functionalregressionmodelshavediverseapplicationsinbiologicalsciencessuchasgenome-wideassociationstudies(GWAS)(FanandReimherr,2017),physicalactivityresearch(Goldsmithetal.,2016),functionalmagneticresonanceimaging(Reissetal.,2017),marineecology(Ghosaletal.,2020),radiomics(Yangetal.,2020),environmentalmodeling(GhosalandSaha,2021)andmanyothers.Dependingonwhetheraresponseoracovariateisafunctionalobservation,functionalregressionmodelscanbebroadlydividedintothreemaincategories:scalar-on-functionregression(SOFR),function-on-scalarregression(FOSR),andfunction-on-functionregression(FOFR).Inthesimplestformofsuchmodels,thedynamiceﬀectofthepredictorofinterestontheresponseiscapturedusingsmoothunivariateorbivariatefunctionalregressioncoeﬃ-cients.SeveralmethodsexistinFDAliteraturetoestimatetheseregressioncoeﬃcients(HastieandTibshirani,1993;Hooveretal.,1998;Huangetal.,2004;Reissetal.,2010,2017).Shaperestrictionssuchasnon-negativity,monotonicity,convexityorconcavityofthefunctionalregressioncoeﬃcientscaneitherbeavailableasapriorknowledgeabouttherelationshipbetweentheresponseandthepredictorofinterestorberequiredtomain-tainstructuralconsistencyofsuchmodels.Forexample,inquantileregressionanalysisofsystolicbloodpressure(SBP)anddiastolicbloodpressure(DBP)(Kim,2006)onage,itisknownthatDBPbecomeslessresponsivethanSBPaspeoplegetolder,whileSBPincreases.Inparticular,theamountofincreaseinDBPasaresponsetoagingbecomesprogressivelysmallercomparedtothecorrespondingamountofincreaseinSBP.Hence,forstructuralconsistencyandinterpretability,thefunctionalcoeﬃcientofDBPisre-quiredtobeanondecreasingfunctionoftheage.IntheBaltimoreLongitudinalStudyofAging(BLSA),themagnitudeofdiurnalphysicalactivitycurvewasfoundtodecreaseasafunctionofageatalltimesduringthedayforbothwomenandmen(Xiaoetal.,2015).Inlongitudinalclinicalstudiesexploringtheeﬀectofadrugondiseaseseverity(e.g.,Ahkimetal.(2017))anegativefunctionalcoeﬃcientcorrespondingtothetreat-mentgroupwouldprovetheeﬀectivenessofthedrugwhileanegativeanddecreasingfunctionalcoeﬃcientwouldsuggesttheeﬀectivenessofthedrugtoincreaseinthefollow2upweeks.InaQuantileFunction-on-ScalarRegression(QFOSR)frameworkintroducedinYangetal.(2020)anon-decreasingfunctionalcoeﬃcientprovideasuﬃcientcondition(Yang,2020)forensuringmonotonicityofthepredictedquantilefunctions.Inmodelingofgrowthcurves(Huetal.,2009),themeanfunctionµ(t)isrequiredtobenon-decreasingas‘growth’isnecessarilynon-decreasing.Inclinicalstudies,oftenodds-ratiosofadis-easecanbeknowntobepositively(negatively)associatedwithafunctionalbiomarker-aknowledgethatcanbemodelledusingaconstrainedscalar-on-functionregression(SOFR)model.Incorporationofsuchshapeconstraintsonfunctionalregressioncoeﬃ-cientscanoftenleadtoreduceduncertaintyofthecoeﬃcientestimatesintherestrictedparameterspace(LimandGlynn,2012;Yagietal.,2020)andcanregulatethemodelﬁt,particularly,forsmallersamplesizes.Severalmethodshavebeendevelopedforshapeconstrainedestimationinnonparametricregressionusingkernel-basedapproaches(HallandHuang,2001;Detteetal.,2006;BirkeandDette,2007),smoothingsplines(PyaandWood,2015),regressionsplines(Meyer,2008,2018),Bernsteinpolynomials(Changetal.,2005;McKayCurtisandGhosh,2011;WangandGhosh,2012)amongmanyothers.Ahkimetal.(2017)developedamethodforshapetestingusingconstrainedregressionsplines(B-spline)forthevaryingcoeﬃcientmodel.Inthisarticle,weextendaBernsteinpolynomial(BP)estimationapproachfromshape-constrainednonparametricregression(WangandGhosh,2012)toawideclassoffunctionalregressionmodelsundervariousshapeconstraints.Wefollowamethodofsieve(Grenander,1981)anduseBernsteinpolynomialbasisformodelingtheunknownfunctionalregressioncoeﬃcients.Importantly,weshowthatmodelﬁttingcanbereducedtosolvingaleastsquareproblemwithlinearconstraintsonthebasiscoeﬃcients,wheretheconstraintmatrixisuniversalanddoesnotdependontheorderofthebasis(barringdimension),observedtime-pointsortheinternalknots,unliketheconstrainedestimationapproacheswithB-splines(Ahkimetal.,2017).Thisensurestheshaperestrictionsaresatisﬁedeverywhereoverthedomainandnotjustattheobservedtimepoints.Further,weproperlyaccountforthetemporaldependencewithinthecurvesinfunction-on-scalarorfunction-on-functionregressionusingapre-whitening/feasiblegeneralizedleastsquaresapproach(Chenetal.,2016;Ghosaletal.,2020),makingtheestimatorsmoreeﬃcient.Theshapeconstraintsonthecoeﬃcientfunctionsautomaticallyregularizesthecoeﬃ-cientfunctions,asoftenrequiredinFDA,andsmoothnessofthecoeﬃcientfunctions3isachievedusingatruncatedbasisapproach(RamsayandSilverman,2005;Fanetal.,2015),byrestrictingthenumberofBPsinthebasis.Aresidualbootstrapbasedtestisdevelopedusingtheproposedestimationmethod,whichcanbeusefulfortestingspeciﬁcshapeconstraintsintheabsenceofapriorknowledge.Bernsteinpolynomialshavevariousattractiveshape-preservingproperties(Lorentz,2013;CarnicerandPena,1993;Changetal.,2005).OptimalstabilityofBPs(FaroukiandGoodman,1996)makesthispolynomialchoiceparticularlysuitableformodelingfunctionalregressioncoeﬃcientsintheconstrainedfunctionalregressionproblem.Theo-reticalresultsareprovidedonconsistencyoftheconstrainedestimatorsunderstandardregularityconditions.Aprojectionbasedapproachisdevelopedtoconstructpoint-wiseasymptoticconﬁdenceintervalsfortheconstrainedestimators.Numericalanalysesus-ingsimulationsshowsatisfactoryandcompetitiveperformanceoftheproposedmethodcomparedtotheexistingtechniquesforfunctionalregression,inthepresenceofshapeconstraints.Inparticular,theestimatesfromtheconstrainedmethodareshowntohavereduceduncertaintyintherestrictedparameterspace,particularlyforﬁnitesamplesizes.TheRcodeforimplementationoftheproposedestimationmethodandtestingispubliclyavailablewiththisarticle.Therestofthisarticleisorganizedasfollows.Wepresentourmodelingframework,illustratetheproposedestimationmethodforshapeconstrainedfunctionalregression,establishthetheoreticalpropertiesoftheestimator,andproposeabootstraptestinSection2.InSection3,weperformnumericalsimulationstoevaluatetheperformancetheproposedmethodsandprovidecomparisonswithexistingunconstrainedfunctionalregressions.InSection4,wedemonstrateapplicationoftheproposedmethodintworealdatastudies:i)atime-varyingcoeﬃcientmodelanalyzingatemporalevolutionofadrugeﬀectontheseverityofillnessintheNationalInstituteofMentalHealthSchizophreniaCollaborativeStudy(Ahkimetal.,2017)andii)aquantilefunction-on-scalarregressionmodelofaccelerometry-estimatedphysicalactivitydatafromtheBaltimoreLongitudinalStudyofAging(BLSA).WeconcludeinSection5withabriefdiscussiononourproposedmethodandsomepossibleextensionsofthiswork.42Methodology2.1ModelingFrameworkWeconsiderthreetypesoffunctionalregressionmodels:scalar-on-functionregression(SOFR),function-on-scalarregression(FOSR),andfunction-on-functionregression(FOFR).Belowwereviewthesemodelsandaccompanyingassumptions.ScalaronFunctionRegressionSuppose{Yi,Xi(t)}istheobserveddatafortheithsubject,i=1,...,n,andYiisascalarresponseofinterestandXi(·)isthecorrespondingfunctionalpredictor.Tostartwith,weassumethefunctionalobjectsareobservedonadenseandregulargridofpointsS={t1,t2,...,tm}⊂T=[0,1],withoutlossofgenerality.Althoughthiscanberelaxedandtheproposedmethodcanbeextendedtoaccommodatemoregeneralscenarioswherethefunctionalobservationsareobservedonanirregularandsparsedomainandpossiblywithameasurementerror.Weconsiderthecommonlyusedscalar-on-functionregressionmodel(RamsayandSilverman,2005),Yi=α+ZTXi(t)β(t)dt+(cid:15)i.(1)Here,β(t)isasmoothfunctionoverT,capturingthedynamiceﬀectofthefunctionalpredictorXi(t).Theerrors(cid:15)iareassumedtobei.i.d.randomvariableswithmeanzeroandvarianceσ2.NotethatSOFRmodel(1)capturesonlyalineareﬀectofasinglefunctionalpredictorXi(t)andmultipleextensionshavebeenproposed(YaoandM¨uller,2010;Eilersetal.,2009;McLeanetal.,2014)toextendittononlinearmodelsandmodelswithmultiplefunctionalpredictors.SeeReissetal.(2017),andthereferencestherein,foradetailedreviewofvariousmethodsregardingtheSOFR.FunctiononScalarRegressionLettheobserveddatafortheithsubjectis{Yi(t),Xi},i=1,...,n,whereYi(t)isnowthefunctionalresponseofinterestandXiisacorrespondingscalarpredictor.Thecommonlyusedfunction-on-scalarregressionmodel(RamsayandSilverman,2005;Reissetal.,2010)5isdeﬁnedasYi(t)=β0(t)+Xiβ1(t)+(cid:15)i(t).(2)ThedependenceofthefunctionalresponseYi(t)onthescalarpredictorXiiscapturedinthefunction-on-scalarregressionmodel(2)viathecoeﬃcientfunctionβ(t).Wefurtherassumetheerrorfunctions(cid:15)i(t)arei.i.d.copiesof(cid:15)(t)whichisameanzerostochasticprocesswithunknownnontrivialcovariancestructure.Ageneralassumption(Huangetal.,2004;Kimetal.,2018)madefortheerrorprocess(cid:15)(t)is(cid:15)(t)=V(t)+wt,whereV(t)isasmoothmeanzerostochasticprocesswithcovariancekernelG(s,t)andwtisawhitenoisewithvarianceσ2.ThecovariancefunctionoftheerrorprocessisthengivenbyΣ(s,t)=cov{(cid:15)(s),(cid:15)(t)}=G(s,t)+σ2I(s=t).FOSRmodel(2)assumesalineareﬀectofthepredictorXionYi(t).Thismodelhasbeenextendedtohandlenonlinearassociations(Xiaoetal.,2015)andhighdimensionalscenarioswithafocusonvariableselection(Chenetal.,2016;KowalandBourgeois,2020;GhosalandMaity,2021).FunctiononFunctionRegressionInthiscase,letthetheobserveddatafortheithsubjectis{Yi(t),t∈TY},{Xi(s),s∈TX},i=1,...,n,whereYi(t)isnowafunctionalresponseofinterestobservedoverdomainTYandXi(s)isafunctionalpredictorobservedoverdomainTY.Thecommonlyusedfunctionallinearmodel(FLM)forfunction-on-functionregression(RamsayandSilverman,2005;Yaoetal.,2005b;Wuetal.,2010)isdeﬁnedasYi(t)=β0(t)+ZTXXi(s)β1(s,t)ds+(cid:15)i(t).(3)Hereabivariateregressioncoeﬃcientβ(s,t)capturesthedependenceofthefunctionalresponseYi(t)ontheentirepredictortrajectoryXi(s),s∈TX.AspecialcaseofthetheabovemodeliswhenTX=TYanditisassumedtheresponseYi(t)dependsonXi(·)concurrently.Speciﬁcally,β1(s,t)=β1(t)I(s=t).Theresultingfunctionallinearconcurrentmodel(RamsayandSilverman,2005)isgivenbyYi(t)=β0(t)+Xi(t)β1(t)+(cid:15)i(t).(4)6Inbothregressionmodelsdiscussedabove,(cid:15)(·)isassumedtobeameanzerostochasticprocesswithanunknownnontrivialcovariancestructure.Multipleextensionshavebeenproposedinvolvingnonlinearassociationsandmultiplepredictorsinthefunction-on-functionregressionmodel(Kimetal.,2018;Scheipletal.,2015;Kimetal.,2018).2.2ShapeConstrainedFunctionalRegressionusingBernsteinPolynomialsInallthefunctionalregressionmodelsdiscussedabove,thedependencebetweenthere-sponseandpredictorsarecapturedusingnonparametricfunctionalcoeﬃcients.Oftenapriorknowledgeaboutthesefunctionalregressioncoeﬃcientsisavailableintheformofconstraintssuchasβ1(t)>0,β1(t)isincreasing,β1(t)isconvex(concave),β1(s,t)ismonotoneorbi-monotone,etc.Incorporationoftheseconstraintsintheestimationproce-durecanleadtoareduceduncertaintyaboutestimatesintherestrictedparameterspace.Below,wedevelopageneralpurposeestimationprocedureforthefunctionalregressionmodels1-4undersuchshapeconstraints.Weexpressanyunivariatecoeﬃcientfunctionsβ(t)inmodels(1),(2),(3),and(4)intermsofunivariateexpansionsofBernsteinbasispolynomials.Speciﬁcally,wemodelthemasfollows:β(t)=NXk=0βkbk(t,N),wherebk(t,N)=(cid:18)Nk(cid:19)tk(1−t)N−k,for0≤t≤1.(5)ThenumberofbasispolynomialsdependsontheorderofthepolynomialbasisN.Notethatbk(t,N)≥0andPNk=0bk(t,N)=1.LetFbetheclassofshaperestrictedfunc-tionsweareinterestedin.FollowingWangandGhosh(2012),wedeﬁnetheconstrainedBernsteinpolynomialsieveasfollows:FN={BN(t)=NXk=0βkbk(t,N):ANβN≥0,NXk=0|βk|≤LN},(6)whereβN=(β0,β1,...,βN)TaretheunknownbasiscoeﬃcientsandANistheconstraintmatrix(ofthedimensionRN×(N+1))choseninawaytoguaranteethedesiredshaperestriction(i.e.,FN⊂F).NotethattheconditionPNk=0|βk|≤LNwasonlyrequiredforestablishingasymptoticpropertiesimplyingthatthefunctionsspannedbythisbasisareboundedinabsolutevaluebyLN,andcanbeavoidedinpractice(WangandGhosh,72012).Bivariatefunctionβ(s,t)canbemodelledusingabivariatebasisexpansionwithatensorproductofunivariateBernsteinpolynomialsasfollows:β(s,t)=NXk1=0NXk2=0βk1,k2bk1(s,N)bk2(t,N),wherebkj(x,N)=(cid:18)Nkj(cid:19)xkj(1−x)N−kj,(7)wheres,t∈[0,1].Inthiscase,wecandeﬁnethesieveFNasFN={BN(s,t)=NXk1=0NXk2=0βk1,k2bk1(s,N)bk2(t,N):ANβN≥0,NXk1=0NXk2=0|βk1,k2|≤LN}.(8)HereβNdenotesthestackedvector{βk1,k2}N,Nk1=0,k2=0andANistheconstraintmatrixofdimensionRN×(N+1)2ensuringtherequiredshaperestrictiononthesurfaceβ(s,t).Remark1:Fornotationalsimplicity,wedenotetheorderofBernsteinpolynomialbyNinboththevariabless,t.Below,weconsiderthemostcommonscenariosforconstraintsonβ(t)andβ(s,t)deﬁnedbyAN,including:nonnegativity,monotonicity,convexity/concavityandtheircombinations.PropertiesofBernsteinpolynomialsieveThesequenceoffunctionspacesFNisnestedinFandS∞N=1FNisdenseinFwithrespecttothesup-norm(seeproperty3.1and3.2inWangandGhosh(2012)).ThisresultalongwiththeStone-Weierstrassapproximationtheoremguaranteethatforanyβ(t)∈F,thereexistsBN(t)∈FN⊂S∞j=1Fjwhichconvergesuniformly(Lorentz,2013)toβ(t).Constraints•FixedboundariesLetβ(t)beinthespaceF={β∈C[0,1]:β(0)=a0,β(1)=a1},whereC[0,1]istheclassofallcontinuousfunctionson[0,1].ForanyBN(t)inthecorrespondingsieveFN(6),theseboundaryconditionsreducetolinearequalityconstraintsofthe8formANβN≡10...000...12×(N+1)β0β1...βN=a0a1.Thus,β0=a0andβN=a1.HereANistheconstraintmatrixwithrankRN=2.Notethatthisequalityconstraintcanbedecomposedintocombinationoftwoinequalitycontraintsintheusualway,i.e.,ANβN≥aand−ANβN≥−a,wherea=(a0,a1).•NonnegativityLetβ(t)beanonnegativefunctioninthespaceF={β∈C[0,1]:β(t)≥0∀t∈[0,1]},whereC[0,1]istheclassofallcontinuousfunctionson[0,1].ForanyBN(t)inthecorrespondingsieveFN(6),thenonegativityconstraintreducestothelinearinequalityconstraintANβN≡10...001...0...00...1(N+1)×(N+1)β0β1...βN≥00...0.HereANistheconstraintmatrixwithrankRN=(N+1).•MonotonicityLetβ(t)beamonotone(non-decreasing)functioninthespaceF={β∈C[0,1]:β(t1)≤β(t2)∀0≤t1≤t2≤1}.NotethatforanyBN(t)inthecorrespondingsieveFN(6),itsderivativeisgivenbyB0N(t)=NPN−1k=0(βk+1−βk)bk(t,N−1).Henceifβk+1≥βkfork=0,1,...,N−1,BN(t)isnondecreasingandFN⊂F.Thusthelinearconstraintontheparametersisgivenby,ANβN≡−110...00−110......0...0−11N×(N+1)β0β1...βN≥00...0.9HereANistheconstraintmatrixwithrankRN=N.Notethatanon-increasingconstraintonβ(t)cansimplybeobtainedbyreversingtheinequality.•Convexity/ConcavityLetβ(t)beaconvexfunctioninthespaceF={β∈C[0,1]:2β(t1+t22)≤β(t1)+β(t2),∀t1,t2∈[0,1]}.NotethatforanyBN(t)inthesievethesecondderivativeisgivenbyB0N(t)=N(N−1)PN−2k=0(βk+2−2βk+1+βk)bk(t,N−2).Henceifβk+2−2βk+1+βk≥0fork=0,1,...,N−2,B00N(t)≥0andFN⊂F.Hencetheconvexityconstraintonthecoeﬃcientfunctionreducestothefollowinglinearinequalityconstraint,whereANistheconstraintmatrixwithrankRN=N−1.Aconcaveconstraintonβ(t)cansimplybeobtainedbyreversingtheinequality.ANβN≡1−21...001−21......0...1−21(N−1)×(N+1)β0β1...βN≥00...0.•BivariatemonotonicityLetβ(s,t)beabivariatefunctionmonotoneinbothcoordinates,speciﬁcally,F={β∈C[0,1]2:β(s1,t1)≤β(s2,t1),β(s1,t1)≤β(s1,t2),∀0≤s1≤s2≤1,0≤t1≤t2≤1}.Here,C[0,1]2istheclassofallcontinuousfunctionson[0,1]2.ForanyBN(s,t)inthesieveFN(8),thepartialderivativesaregivenby∂BN∂s=NPN−1k1=0PNk2=0(βk1+1,k2−βk1,k2)bk1(s,N−1)bk2(t,N)and∂BN∂t=NPNk1=0PN−1k2=0(βk1,k2+1−βk1,k2)bk1(s,N)bk2(t,N−1).Hencethebimonotoneconstraintredcuestoalinearconstraintoftheform,ANβN≥0,wheretheconstraintmatrixisgivenbyAN=A(1)NA(2)N.TheﬁrstsubmatrixA(1)NensuresmonotonicityinsandA(2)Nensuresmonotonicityint.ThetwosubmatricesaregivenbyA(1)N=−10...01−10...01...−10...01N(N+1)×(N+1)2,10andA(2)N=BB...BN(N+1)×(N+1)2B=−110...00−110......0...0−11N×(N+1)respectively.Ifmonotonicityisrequiredonlyinoneofthecoordinatesort,thentheconstraintmatrixcanbetakentobeAN=A(1)NorAN=A(2)Naccordingly.•Partialconvexityofβ(s.t)Supposeβ(s,t)isaconvexfunctioninsforeveryﬁxedtandvice-versa.HeretherestrictedfunctionspaceisgivenbyF={β∈C[0,1]:2β(s1+s22,t1)≤β(s1,t1)+β(s2,t1)and2β(s1,t1+t22)≤β(s1,t1)+β(s1,t2)∀s!,s2,t1,t2∈[0,1]}.Notethat,foranyBN(s,t)inthesieveFN(8),thepartialderivativesaregivenby∂2BN∂s2=NPN−2k1=0PNk2=0(βk1+2,k2−2βk1+1,k2+βk1,k2)bk1(s,N−2)bk2(t,N)and∂2BN∂t2=NPNk1=0PN−2k2=0(βk1,k2+2−2βk1,k2+1+βk1,k2)bk1(s,N)bk2(t,N−2).Hencethepartialconvexityconstraintsreducedtolinearconstraintsoftheform,ANβN≥0,wheretheconstraintmatrixisgivenbyAN=A(1)NA(2)N.TheﬁrstsubmatrixA(1)NensuresconvexityinsandA(2)Nensuresconvexityint.ThetwosubmatricesaregivenbyA(1)N=10...0−20...0110...0−20...01...(N2−1)×(N+1)2,andA(2)N=BB...B(N2−1)×(N+1)2B=1−21...001−21......0...1−21(N−1)×(N+1)respectively.11•Variousothershapeconstraintsonβ(t)andβ(s,t)includinganycombinationofaboveconstraintscansimilarlybeshowntobereducedtolinearinequalitycon-straintsoftheformANβN≥0.ScalarresponseregressionUsingthebasisexpansionforthecoeﬃcientfunctionβ(t)in(5),theSOFRmodel(1)canbereformulatedasfollowsYi=α+ZTXi(t)β(t)dt+(cid:15)i=α+NXk=0βkZTXi(t)bk(t,N)dt+(cid:15)i=α+NXk=0βkWik+(cid:15)i,whereWik=ZTXi(t)bk(t,N)dt=α+WTiβ+(cid:15)i,(9)whereWi=(Wi0,Wi1,...,WiN)Tandβ=(β0,β1,...,βN)T.Parameters(α,β)isesti-matedbyminimizingtheconstrainedleastsquareproblem,(ˆα,ˆβ)=argminα,βnXi=1(Yi−α−WTiβ)2s.tANβ≥0,(10)wheretheconstraintANβ≥0correspondstotherequiredshaperestrictiononβ(t).Theaboveoptimizationproblemisaquadraticprogrammingproblem(GoldfarbandIdnani,1982,1983)andcanbeeﬃcientlysolvedinRusingthequadprog(Turlachetal.,2019)ortherestriktor(VanbrabantandRosseel,2019)package.AdditionalscalarcovariatesofinterestZi(confounders)canbereadilyincludedintheSOFRmodel(1)andtheaboveoptimizationcriterionthroughanadditionaltermZTiγ(Reissetal.,2017)capturingeﬀectsofthescalarpredictors.FunctionalresponseregressionWeusetheBernsteinpolynomialbasisexpansionsformodelingunivariateandbivariatecoeﬃcientfunctionsβ0(t),β1(t)andβ1(s,t)infunction-on-scalarregressionmodel(2)andfunction-on-functionregressionmodels(3),(4).Wedenotethestackedfunctional12responsecorrespondingtosubjectiasYi=(Yi(t1),Yi(t2),...,Yi(tm)).Usingthebasisexpansionsforthecoeﬃcientfunctions,thefunction-on-scalarorthefunction-on-functionregressionmodelscanbereformulatedasfollowsYi=B0β0+Wiβ1+(cid:15)i.(11)Here,thematrixB0dependsonthebasisfunctionsusedformodelingβ0(t).MatrixWidependsonthebasisfunctionsusedforβ1(t)orβ1(s,t)andthecorrespondingpredictorXi,Xi(t),ortheentiretrajectoryXi(·).Vectorsβ0andβ1denotethebasiscoeﬃcients,andthestackedresidualsaredenotedas(cid:15)i=((cid:15)i(t1),(cid:15)i(t2),...,(cid:15)i(tm)).Theshapere-strictionsonthecoeﬃcientfunctionofinterestβ1(t),orβ1(s,t)canbespeciﬁedaslinearconstraintsoftheformAβ1≥0asillustratedintheSection2.2.Asmentionedearlier,theerrorprocess(cid:15)(·)isassumedtohaveanontrivialcovariancekernelΣ(s,t)forthefunctionalregressionmodelswithafunctionalresponse.Totakeintoaccountthewithincurvedependencewhiledoingestimation,weproposethefollowingtwo-stepmethod.Step1NotethatthecovariancefunctionoftheerrorprocessisgivenbyΣ(s,t)=cov{(cid:15)(s),(cid:15)(t)}=G(s,t)+σ2I(s=t).Fordataobservedondenseandregulargrid,thecovariancematrixoftheresidualvector(cid:15)iisΣm×m,thecovariancekernelΣ(s,t)evaluatedonthegridS={t1,t2,...,tm}.InrealityΣm×misunknown,andweneedanestimatorˆΣm×m.Inthecontextoffunctionaldata,wewanttoestimateΣ(·,·)nonparametrically.Iftheoriginalresiduals(cid:15)ijwereavailable,functionalprincipalcomponentanalysis(FPCA)canbeused,e.g.,Yaoetal.(2005a)toestimateΣ(s,t).ByMercer’stheorem,thecovariancekernelG(s,t)hasaspectraldecompositionG(s,t)=∞Xk=1λkφk(s)φk(t),whereλ1≥λ2≥...0aretheorderedeigenvaluesandφk(·)sarethecorrespondingeigenfunctions.ThuswehavethedecompositionΣ(s,t)=P∞k=1λkφk(s)φk(t)+σ2I(s=t).Given(cid:15)tij=V(tij)+wij,FPCA(Yaoetal.,2005b)canbeusedtogetˆφk(·),ˆλksand13ˆσ2.SoanestimatorofΣ(s,t)canbeformedasˆΣ(s,t)=KXk=1ˆλkˆφk(s)ˆφk(t)+ˆσ2I(s=t),whereKislargeenoughsuchthatpercentofvarianceexplained(PVE)bytheselectedeigencomponentsexceedssomepre-speciﬁedvaluesuchas99%or95%.Inpractice,wedon’thavetheoriginalresiduals(cid:15)ij.HenceweﬁtanunconstrainedmodelbyminimizingtheresidualsumofsquaresPni=1||Yi−B0β0−Wiβ1||22,andobtaintheresidualseij=Yi(tj)−ˆYi(tj).Thentreatingeijasouroriginalresiduals,weobtainˆΣ(s,t)andˆΣm×musingtheFPCAapproachdescribeabove.Step2Wepre-whiten(Chenetal.,2016)Yi,B0andWiinmodel(11)usingtheestimatedcovariancematrixˆΣ−1/2m×masY∗i=ˆΣ−1/2m×mYi,B∗0=ˆΣ−1/2m×mB0,W∗i=ˆΣ−1/2m×mWi.Subsequently,themodelparametersareestimatedfromtheconstrainedoptimizationproblem(ˆβ0,ˆβ1)=argminβ0,β1nXi=1||Y∗i−B∗0β0−W∗iβ1||22s.tAβ1≥0.(12)Againtheaboveconstrainedleastsquareoptimizationcanbeperformedusingquadraticprogrammingasinthecaseofshapeconstrainedscalar-on-functionregression.Remark2:ThisfeasibleGLSapproachisusedinthearticleforalltheresultscorrespondingtofunctionalresponseregression.TheconstrainedestimatorcanbeviewedasaprojectionoftheunconstrainedGLSestimatorasillustratedinAppendixBoftheSupplementaryMaterial.ConsistencyoftheshapeconstrainedestimatorsWeestablishtheconsistencyofshapeconstrainedestimatorinscalar-on-functionregres-sion.ThefunctionalresponsemodelisconsideredinAppendixBoftheSupplementaryMaterial.Theorem1Considerscalar-on-functionregressionmodel(1).Supposethefollowingconditionshold.(H1)||X(·)||L2≤C1<∞,a.s.14(H2)Var(Y|X(·)=x(·))≤C2<∞a.s.(H3)TheeigenvaluesofthecovarianceoperatorofX(·)arepositiveanddistinct.(H4)Thefunctionalcoeﬃcientβ(t)deﬁnedon[0,1]issupposedtobesuﬃcientlysmooth.Inparticular,letHbetheclassoffunctionsβ(·)havingq≥0derivatives,withβ(q)(t)satisfying|β(q)(t1)−β(q)(t2)|≤C3|t1−t2|v,C3>0andv∈[0,1].(H5)limnd(β(·),FN)=0andlimnNlogN/n=0,whered(β(·),FN)isdeﬁnedasd(β(·),FN)=infg∈FNsupt∈T|β(t)−g(t)|.Iftheshaperestrictionassumptionforβ(t)holds,i.e.,thetruecoeﬃcientfunctionβ(t)∈F∩H,thentheconstrainedestimatorˆβc(t)isaconsistentestimatorofβ(t).Proof:TheproofofTheorem1isgiveninAppendixAoftheSupplementaryMaterial.Remark3:Theprimaryadvantageoftheproposedestimationmethod,particularlyforﬁnitesamplesizes,comesfromthepotentialreductioninvarianceoftheconstrainedestimator,astheobjectivefunctionisminimizedoveraconstrained(smaller)spacewithalowerentropy.Thispointisalsowellillustratedinourempiricalanalysis.2.3UncertaintyQuantiﬁcationAsshowninSection2.2,theconstrainedestimatorcanbeviewedastheprojectionoftheunconstrainedestimatorontotherestrictedspace:ˆβr=argminβ∈ΘR||β−ˆβur||2ˆΩ.Hence,wecanusetheprojectionofthelargesampledistributionof√n(ˆβur−β0)toapproximatethedistributionof√n(ˆβr−β0).Weassumethat√n(ˆβur−β0)isasymptoticallydistributedasN(0,∆)undersuitableregularityconditions(analogoustoassumption2ofTheorem1inFreybergerandReeves(2018)),where∆canbeestimatedbyaconsistentestimator.Forexampleˆ∆=(ˆΩ)−1(1nPni=1ˆ(cid:15)i2WiWTi)(ˆΩ)−1forthescalarresponsecase.LettheBernsteinpolynomialapproximationofβ(t)begivenbyβN(t)=PNk=0βkbk(t,N)=ρKn(t)0β.Algorithm1willbeusedtoobtainapoint-wiseapproximate100(1−α)%asymptoticconﬁdenceintervalforthetruecoeﬃcientfunctionβ0(t).15Algorithm1Point-wiseconﬁdenceintervalofβ0(t)undershaperestriction1.Fittheunconstrainedmodelandobtaintheunconstrainedestimatorˆβur=argminβ∈RKnPni=1(Yi−WTiβ)2(forscalarresponse)orˆβur=argminβ∈RKnPni=1||Y∗i−Z∗iβ||22(forthefunctionalresponse,Z∗i=[B∗0W∗i]).2.Lettheestimatedasymptoticcovariancematrixoftheunconstrainedestimatorbegivenbyˆ∆n=ˆ∆/n=ˆcov(ˆβur).3.Forb=1toB[-]generateZb∼NKn(ˆβur,ˆ∆n).[-]computetheprojectionofZbasˆβr,b=argminβ∈ΘR||β−Zb||2ˆΩ.[-]EndFor4.100(1−α)%point-wiseconﬁdenceintervalforβ0(t)isgivenby(Cα/2(t),C1−α/2(t)),whereCα(t)denotestheempiricalαthpercentileofρKn(t)0ˆβjr,b(b=1,...,B),andj=0,1.2.4TestingforShapeConstraintsSofarwehavefocusedonestimationunderapriorknowledgeofshapeconstraintsonfunctionalregressioncoeﬃcients.Inmanycases,suchconstraintsmaynotbeknownbeforehandorapractitionermightpositsomepriorbeliefsabouttheshape,whichheorshewouldliketotest.Inthissection,wedevelopatestingprocedureforshapeconstraintsbasedontheproposedestimationmethod.Inparticular,weusebootstraponaF-typeteststatisticbasedontheresidualsumofsquaresoftheconstrained(null)andunconstrained(full)modelsimilartoKimetal.(2018).Alternatively,onemayalsousetheideaofwildbootstrap(DavidsonandFlachaire,2008)whichgeneratestheresponsesusingscaledresidualsonly.TheteststatisticisdeﬁnedasT=RSSc−RSSuRSSu,(13)whereRSSc,RSSuaretheresidualsumofsquaresundertheconstrainedanduncon-strainedmodelrespectively.ForthescalarresponsecaseRSSu=Pni=1(Yi−ˆαu−WTiˆβu)2,where(αu,ˆβu)aretheunconstrainedestimatorsandRSScisdeﬁnedanalogously.FormodelswithfunctionalresponseRSSu,RSSciscalculatedbasedontheresidualsumofsquaresfrommodel(11)afterobtainingunconstrainedandconstrainedestimatesofβj(j=0,1).Weillustrateourtestingprocedureformodelswithscalarresponseandfunctionalresponsewithunivariateregressionfunctionsβ(·).Thecasewithbivariatecoeﬃcientfunctionsβ(·,·)formoregeneralfunction-on-functionregressionmodels(e.g.,16FLM)canbehandledsimilarly.ShapeTestingwithScalarResponseWeconsidertheSOFRmodel(1).Weareinterestedintestingpriorshaperestrictionsonthefunctionalcoeﬃcientβ(t)fort∈[0,1].LetFbetheclassofshaperestrictedfunctionsweareinterestedinandHbespaceoffunctionasdeﬁnedincondition(H4)inTheorem1.WewanttotestthenullhypothesisH0:β(·)∈F∩HversusH1:β(·)∈H.ThenulldistributionofthetheteststatisticTin(13)isapproximatedusingbootstrap.WepresentthecompletebootstrapprocedureinAlgorithm2.Algorithm2Bootstrapalgorithmforshapetestingwithscalarresponse1.FittheunconstrainedSOFRmodel(1)usingBernstein-polynomialrepresentationin(9)andcalculatetheresidualsei=Yi−ˆYi,fori=1,2,...,n.2.FittheconstrainedmodelcorrespondingtoH0(thenull)andestimateα,β(t)fromtheconstrainedminimizationcriteriain(10),denotetheestimatesˆαc,ˆβc(t).3.ComputeteststatisticT(13)basedonthenullandfullmodelﬁts,denotethisasTobs.4.ResampleBsetsofbootstrapresiduals{e∗b,i}ni=1fromresiduals{ei}ni=1obtainedinstep1.5.forb=1toB6.GeneratescalarresponseundertheconstrainednullmodelasY∗b,i=ˆαc+ZTXi(t)ˆβc(t)dt+e∗b,i.7.Giventhebootstrapdataset{Xi(t),Y∗b,i}ni=1ﬁtthenullandthefullmodeltocomputetheteststatisticT∗b.8.endfor9.Calculatethep-valueofthetestasˆp=PBb=1I(T∗b≥Tobs)B.ShapeTestingwithFunctionalResponseWenowconsiderthemodelswithfunctionalresponsesuchastheFOSRmodel(2)ortheFLCM(4).Hereagain,wewanttotest,H0:β1(·)∈F∩HversusH1:β(·)∈H,17whereFisthespeciﬁcclassofshaperestrictedfunctions.Thetestingmethodisbasedonasimilarbootstrapprocedureasinthecasewithscalarresponse.Whileperformingtesting,wedon’tenforcepre-whiteninginthestep2ofourestimation,astheestimatedresidualsfromtheunconstrainedmodel(11)(correspondingtotheestimatorsobtainedviaminimizingPni=1||Yi−B0β0−Wiβ1||22)asymptoticallyhasthesamecovarianceastheoriginalresidualsandbootstrappingthesegeneratesresidualsfromthesamecovariancestructurewithoutgoingintotheneedforestimatingit.ThedetailedtestingprocedureispresentedinAlgorithm1withinAppendixCoftheSupplementaryMaterial.2.5SelectionoforderoftheBernsteinPolynomialBasisTheorderoftheBernsteinpolynomialbasisNcontrolsthesmoothnessoftheregres-sioncoeﬃcientfunctionsβ(t).AsmallerNmightintroducebiasinestimation,whilealargerNcanmakethecoeﬃcientfunctionswiggly.Wefollowatruncatedbasisapproach(RamsayandSilverman,2005;Fanetal.,2015),byrestrictingthenumberofBPbasisfunctionstoensuretheestimatedregressioncoeﬃcientfunctionissmooth.Theempir-icallyoptimalnumberofbasisfunctionsischoseninadata-drivenway(Ahkimetal.,2017)viaV-fold(V=5inthisarticle)cross-validationmethod(WangandGhosh,2012)usingcross-validatedresidualsumofsquaresforboththescalarandfunctionalresponseregression.Inparticular,thecross-validatedresidualsumofsquareforthescalarresponsecaseisdeﬁnedasfollowsCVs(N)=VXv=1nvXi=1(Yi,v−ˆY−vi,v,N)2.HereˆY−vi,v,NistheﬁttedvalueofthescalaroutcomeYi,v,withinthevthfoldobtainedbyapplyingamodeltrainedontherest(V−1)foldsusingBernsteinpolynomialsoforderN.Similarlyforthefunctionalresponsecase,cross-validatedresidualsumofsquareisdeﬁnedasfollowsCVf(N)=VXv=1nvXi=1||Yi,v−ˆY−vi,v,N||22.TheempiricallyoptimalNisthenchosenbasedonagridsearchastheminimizerofCVs(N)orCVf(N).Itshouldhoweverbenotedthatthereisperhapsnouniversal(data-dependent)methodofempiricallyselectingthetuningparameterN,evenwhenonecan18establishasharprateofasymptoticconvergence.3SimulationStudiesInthisSection,weinvestigatetheperformanceoftheproposedestimationmethodundershapeconstraintsviasimulations.Tothisend,thefollowingscenariosareconsidered.3.1DataGeneratingScenariosScenarioA:SOFR,non-negativeconstraintWegeneratedatafromthescalar-on-functionregression(SOFR)modelgivenbyYi=α+ZTXi(t)β(t)dt+(cid:15)i,whereα=0.15andβ(t)=0.1∗sin(πt).Theresiduals(cid:15)i∼N(0,0.052)(i.i.d).Weconsideradensedesignwithm=50equispacedtime-pointsinT=[0,1]andsamplesizen∈{25,50,100}.ThecovariateprocessXi(t)isgeneratedasXi(t)=P20k=1ψikφk(t),whereφk(t)areorthogonalbasispolynomials(ofdegreek−1)andψikaremeanzeroandindependentNormallydistributedscoreswithvarianceσ2k=(20−k+1).Weconsiderestimationintheabovemodelundertheconstraintβ(t)≥0.ScenarioB:FLCM,non-increasingconstraintWegeneratedatafromthefunctionallinearconcurrentmodel(FLCM)Yi(t)=β0(t)+Xi(t)β1(t)+(cid:15)i(t),wherethecoeﬃcientfunctionsaregivenbyβ0(t)=8sin(πt),β1(t)=5cos(πt).ThecovariateprocessXi(t)isgeneratedasXi(t)=P5k=1ψikφk(t),whereφk(t)areorthogonalbasispolynomials(ofdegreek−1)andψikaremeanzeroandindependentNormallydistributedscoreswithvarianceσ2k=(5−k+1).Theerrorprocess(cid:15)i(t)isgeneratedas(cid:15)i(t)=ξi1cos(t)+ξi2sin(t)+N(0,0.52),whereξi1iid∼N(0,0.52)andξi2iid∼N(0,0.752).Weconsideradensedesignwithm=40equispacedtime-pointsinT=[0,1]andsample19sizen∈{25,50,100}.Weconsiderestimationintheabovemodelundertheconstraintβ1(t)isdecreasing.AdditionalSimulations:Weconsiderasparsedesignundertheabovedatageneratingsetup,wherethefunctionalcovariateXi(t)andthefunctionalresponseYi(t)areobservedoverrandomlychosenmitime-points(mi∼Unif{5,6,...,10})fromthedensegridof40equispacedtime-pointsinT=[0,1].Samplesizen∈{50,100}isconsideredforthissparsescenario.ScenarioC:FLCM,non-decreasingandconcaveconstraintWegeneratedatafromanotherFLCMgivenby,Yi(t)=β0(t)+Xi(t)β1(t)+(cid:15)i(t),wherethecoeﬃcientfunctionsaregivenbyβ0(t)=3cos(πt),β1(t)=5sin(π2t).ThecovariateprocessXi(t)andtheerrorprocess(cid:15)i(t)isgeneratedexactlyasinscenarioB.Weagainconsideradensedesignwithm=40equispacedtime-pointsinT=[0,1]andsamplesizen∈{25,50,100}.Weconsiderestimationintheabovemodelundertheconstraintβ1(t)isnon-decreasing,andβ1(t)isconcave.Weconsider200Monte-Carlo(M.C)replicationsfromtheabovespeciﬁedsimulationscenariostoassesstheperformanceoftheproposedestimationmethod.3.2SummaryofResultsfromSimulatedDataScenariosPerformanceunderscenarioA:WeconsiderestimationintheSOFRmodelofscenarioAundertheconstraintβ(t)≥0(satisﬁedbythetruecoeﬃcientfunction).Theperformanceoftheproposedconstrainedmethodiscomparedwithexistingunconstrainedapproachusingthestandard"pfr"functionforSOFRwithintherefundpackageinR.Figure1displaystheestimatedcoeﬃcientfunctionˆβ(t)(forthesamplesizen=50)averagedoverthe200M.Creplica-tionsfromboththeconstrainedandtheunconstrainedmethod.Onaverage,theorderofBernstein-polynomialschosenbyﬁve-fold(V=5)cross-validationwasN=4acrossthethreesamplesizes.The95%point-wiseconﬁdenceintervalsofthecoeﬃcientfunctionare20alsoshownbasedontheM.Creplications.Wecannoticetheconﬁdencebandsfortheconstrainedmethoddoesnotincludezeroforanyt,andalsoproducecloserestimatestothetruefunctioncomparedtotheunconstrainedapproach.Theconﬁdenceintervalsarealsonarrower,speciallyattheboundariescomparedtotheonesfromtheunconstrainedmethod.TheaverageM.Cmeansquareerror(IMSE)oftheestimatedcoeﬃcientfunctionˆβ(t)deﬁnedasIMSE=RT(ˆβ(t)−β(t))2dt,fromboththeconstrainedandunconstrainedmethod,arereportedinTable1.WecannoticethattheconstrainedestimatesproducesmalleraverageIMSEcomparedtotheunconstrainedestimates.Inparticular,basedonTable1,theconstrainedestimators,onanaverage,arefoundtobe33%moreeﬃcientcomparedtotheunconstrainedestimatesintermsofaverageIMSE.Asthesamplesizeincrease,theIMSEfromboththemethodsbecomenegligibleindicatingconsistencyoftheestimators.0.00.20.40.60.81.0−0.050.000.050.100.15constrained estimatetbeta(t)0.00.20.40.60.81.0−0.050.000.050.100.15SOFR estimatetbeta(t)Figure1:Estimatedcoeﬃcientfunction(dashedline)andtruecoeﬃcientfunction(solidline)alongwith95%point-wiseconﬁdenceinterval(dottedlines)fromtheconstrained(left)andunconstrained(right)method,simulationscenarioA,n=50.Samplesize(n)ConstrainedmethodUnconstrainedmethodP-value250.9(1.0)1.3(1.1)2.99×10−5500.4(0.3)0.6(0.4)1.5×10−61000.2(0.2)0.3(0.2)0.0004Table1:Averageintegratedmeansquareerror(×1000)over200Monte-Carlorepli-cations,scenarioA.StandarderrorsofIMSE(×1000)arereportedintheparenthesis.P-valuesareobtainedfromtwosamplet-test.21Projection-basedconﬁdenceintervalsWeapplytheprojectionbasedmethodoutlinedinAlgorithm1toobtainpoint-wiseasymptotic95%conﬁdenceintervaloftheregressioncoeﬃcientfunctionβ(t)undertheshapeconstraintβ(t)>0.TableS1inSupplementaryMaterialreportstheaverageempiricalcoverageoftheconﬁdenceintervalsacrossthethreesamplesizesforarangeofchoicesfortheorderoftheBernsteinpolynomialbasis,N.Averageestimatedcov-eragesareclosetothenominal95%coverageforN≥4,whichistheaverageorderoftheBernsteinpolynomialbasischosenbyourproposedcross-validationcriterion.Theaveragewidthoftheconﬁdenceintervalisfoundtobecomparableorsmallerthantheunconstrained("pfr")methodforchoicesofNaroundN0=4.Theprojectionbasedconﬁdenceintervalforaparticularreplication(n=100)isdisplayedinFigureS1inSupplementaryMaterial.TestingshapeconstraintsWeconsidertestingthefollowingshapeconstraintsforthesimulationscenarioA.i)H0:β1(t)≥0forallt∈[0,1],ii)H0:β1(t)isconcaveforallt∈[0,1]iii)H0:β1(t)isincreasingforallt∈[0,1].Thetruecoeﬃcientfunctioninthisscenarioisβ(t)=0.1∗sin(πt)whichsatisfyi)andii)butdoesnotsatisfyiii).Table2displaystherejectionratesoftheboot-straptestforthethreenullhypothesisandthreesetsofsamplesizesforthenominallevelofα=0.05.H0n=25n=50n=100β1(t)≥00.0550.050.065β1(t)isconcave0.040.070.055β1(t)isincreasing0.2350.550.84Table2:Rejectionratesfortherespectivehypothesisfromthebootstrapbasedtestbasedon200M.CsimulationsfromScenarioA.Wenoticetherejectionratesremainclosetothenominallevelof0.05whenthenullhypothesisistrue(caseiandii)andisincreasingto1asthesamplesizeincreasewhenthenullisfalse(caseiii)indicatingconsistencyoftheproposedtestingmethod.22PerformanceunderscenarioB:WeconsiderestimationinthefunctionallinearconcurrentmodelofscenarioBundertheconstraintβ1(t)isdecreasing.TheaverageorderofBernstein-polynomialbasischosenbyﬁve-fold(V=5)cross-validationwasN=5,acrossthethreesamplesizes.Figure2displaystheestimatedcoeﬃcientfunctionβ1(t)(forsamplesizen=50)averagedover200M.Creplicationsfromboththeconstrainedandunconstrainedapproach(smoothingsplineimplementedusing"pffr"functionwithintherefundpackage)alongwiththeir95%point-wiseconﬁdenceintervalsbasedontheMonte-Carloreplications.0.00.20.40.60.81.0−4−2024constrained estimatetBeta1(t)0.00.20.40.60.81.0−4−2024FLCM estimatetBeta1(t)Figure2:Estimatedcoeﬃcientfunction(dashedline)andtruecoeﬃcientfunction(solidline)alongwith95%point-wiseconﬁdenceinterval(dottedlines)fromtheconstrained(left)andunconstrained(right)method,simulationscenarioB,n=50.Itcanbenoticedtheconstrainedapproachproducemuchnarrowerconﬁdenceintervaloftheestimateindicatingloweruncertaintyoftheestimatedfunctionintherestrictedparameterspace.TheM.Caveragemeansquareerror(IMSE)(multipliedby100)oftheestimatedcoeﬃcientfunctionˆβ1(t)fromtheconstrainedandunconstrainedmethodisreportedinTable3.ItcanbeobservedthattheproposedconstrainedestimateshavemuchsmalleraverageIMSEcomparedtotheunconstrainedestimates.Acrossthesamplesizes,theconstrainedestimatesarefoundtobe346%moreeﬃcientcomparedtotheunconstrainedestimators.Asthesamplesizeincrease,theIMSEfromboththemethodsagainbecomenegligibleindicatingconsistencyoftheestimators.TheIMSE(multipliedby100)oftheestimatedcoeﬃcientfunctionˆβ1(t)fromthesparsedesignsetupisreported23inTableS3oftheSupplementaryMaterial,wheresimilarimprovementineﬃciencycanbenoticedfromtheconstrainedapproach.Samplesize(n)ConstrainedmethodUnconstrainedmethodP-value251.23(1.14)5.37(5.15)<2.2×10−16500.46(0.30)2.13(1.56)<2.2×10−161000.26(0.15)1.14(0.85)<2.2×10−16Table3:Averageintegratedmeansquareerror(×100)over200Monte-Carloreplications,scenarioB.StandarderrorsofIMSE(×100)arereportedintheparenthesis.P-valuesareobtainedfromtwosamplet-test.Projection-basedconﬁdenceintervalsWedisplaytheprojection-basedpoint-wiseasymptotic95%conﬁdenceintervaloftheregressioncoeﬃcientfunctionβ1(t)undertheshapeconstraint:β1(t)isdecreasing.TableS2inSupplementaryMaterialreportstheaverageempiricalcoverageoftheconﬁdenceintervalsacrossthethreesamplesizesforarangeofchoicesofN.Theestimatedcoverageisclosetothenominal95%coverageforN≥5,whichistheaverageorderoftheBernsteinpolynomialbasischosenbyourproposedcross-validationcriterion.Theaveragewidthoftheconﬁdenceintervalisfoundtobesmallerthantheunconstrained("pffr")methodforchoicesofNaroundN0=5,whileyieldingthecorrectcoverage.Theprojection-basedconﬁdenceintervalofβ1(t)foraparticularreplication(n=100)isdisplayedintheSupplementaryFigureS2.TestingshapeconstraintsInthisscenario,Wetestthefollowingshapeconstraints.i)H0:β1(t)isdecreasing∀t∈[0,1],ii)H0:β1(t)isconvex∀t∈[0,1]iii)H0:β1(t)isconcave∀t∈[0,1].Thetruecoeﬃcientfunctioninthisscenarioisβ1(t)=5cos(πt)whichsatisﬁesi)butdoesnotsatisfyii)andii).Table4displaystherejectionratesofthebootstraptestforthethreenullhypothesisandthreesetsofsamplesizesforthenominallevelofα=0.05.H0n=25n=50n=100β1(t)isdecreasing0.060.070.065β1(t)isconvex111β1(t)isconcave111Table4:Rejectionratesfortherespectivehypothesisfromthebootstrapbasedtestbasedon200M.CsimulationsfromScenarioB.24Weagainobservethattherejectionratesremainclosetothenominallevelof0.05whenthenullhypothesisistrue(casei)andis1forallthesamplesizeswhenthenullisfalse(caseiiandiii)indicatingsatisfactorypoweroftheproposedtestingmethod.Remark4:SupplementarySimulationScenarioS1illustratesthattheproposedestimationapproachandtheprojectionbasedasymptoticconﬁdenceintervalisabletocapturethetrueco-eﬃcientfunctionaccurately,evenwhenitliesontheboundaryoftheparameterspace(e.g.,constantfunctionunderdecreasingconstraint).PerformanceunderscenarioC:WeconsiderestimationintheFLCMdescribedinsimulationscenarioCundertheconstraintsβ1(t)isincreasingandβ1(t)isconcave.TheaverageorderofBernstein-polynomialbasischosenbyﬁve-fold(V=5)cross-validationwasN=5acrossthethreesamplesizes.Figure3displaystheestimatedcoeﬃcientfunctionβ1(t)averagedover200M.Creplicationsfromboththeconstrainedandunconstrainedapproachalongwiththeir95%point-wiseconﬁdenceintervals.Itcanagainbenoticedtheconstrainedapproachproducemuchnarrowerconﬁdenceintervaloftheestimatedcoeﬃcientfunctionˆβ1(t)in-dicatingloweruncertaintyoftheestimateintherestrictedparameterspace.TheaverageM.Cmeansquareerror(IMSE)oftheestimatedcoeﬃcientfunctionˆβ1(t)fromboththeconstrainedandunconstrainedmethodisreportedinTable5.WeagainobservethatSamplesize(n)ConstrainedmethodUnconstrainedmethodP-value259.5(9.8)49.3(49.7)<2.2×10−16503.1(2.6)19.5(15.1)<2.2×10−161001.4(1.1)10.5(8.2)<2.2×10−16Table5:Averageintegratedmeansquareerror(×1000)over200Monte-Carlorepli-cations,scenarioC.StandarderrorsofIMSE(×1000)arereportedintheparenthesis.P-valuesareobtainedfromtwosamplet-test.theproposedconstrainedestimateshavemuchsmalleraverageIMSEcomparedtotheunconstrainedestimates.Speciﬁcally,theconstrainedestimatesarefoundtobe485%moreeﬃcientcomparedtotheunconstrainedestimator.Asthesamplesizeincrease,theIMSEfromboththemethodsagainbecomeasymptoticallynegligible.Thesimulationresultsinthissectionillustratetheadvantagesoftheproposedestima-tionmethodinfunctionalregressionmodelsundershaperestrictions.Forsmallersample250.00.20.40.60.81.0012345constrained estimatetBeta1(t)0.00.20.40.60.81.0012345FLCM estimatetBeta1(t)Figure3:Estimatedcoeﬃcientfunction(dashedline)andtruecoeﬃcientfunction(solidline)alongwith95%conﬁdenceinterval(dottedlines)fromtheconstrained(left)andunconstrained(right)method,simulationscenarioC,n=50.sizes,suchshaperestrictionsleadtoreduceduncertaintyofthecoeﬃcientfunctionsintherestrictedparameterspace.4RealDataApplicationsInthissection,wedemonstrateapplicationsoftheproposedshapeconstraintestimationmethodinfunctionalregressionmodels.First,weconsideramentalhealthschizophreniacollaborativestudyanalyzingevolutionofdrugeﬀectontheseverityofillness.Next,weapplytheproposedestimationmethodfordistributionalanalysisofquantile-functionsofphysicalactivitydatafromBaltimoreLongitudinalStudyofAging(BLSA).4.1Application1:MentalHealthSchizophreniaCollaborativeStudyWeconsiderdatafromtheNationalInstituteofMentalHealthSchizophreniaCollabo-rativeStudyusedinAhkimetal.(2017).Theresponseofinterestisseverityofillness26measuredintheInpatientMultidimensionalPsychiatricScale(IMPS),rangingfrom1(normal)to7(amongthemostextremelyill).Thepatients(n=437)consideredinthisstudywererandomlyassignedtoatreatment(drug)orplaceboandmeasuredatweeks0,1,2,...,6.Majorityofthepatientsweremeasureatweeks0,1,3,6withafewbeingadditionallymeasuredonweeks2,4,5.Theprimaryinteresthereistoassesstheeﬃcacyofthedrug.Weconsiderafunction-on-scalarregressionmodel,Yi(t)=β0(t)+Giβ1(t)+(cid:15)i(t),(14)whereYi(t)denotesdiseaseseverityatweektforsubjectiandGiisaindicatorofthetreatmentgroupforthesubject(Gi=1,ifsubjectireceiveddrug).Thetime-varying0123456−2.0−1.5−1.0−0.50.0estimated drug effect on disease severityweekbeta1(week)Figure4:Estimatedeﬀectofdrugondiseaseseverityasfunctionofweek.Constrained(β1(t)≤0)estimate(greensolidline)andunconstrainedestimate(bluesolidline),alongwiththeir95%conﬁdenceintervals(dottedforconstrainedanddashedforunconstrained).coeﬃcientfunctionβ1(t)capturestheeﬀectofthedrugondiseaseseverity.Anegativeβ1(t)wouldprovetheeﬀectivenessofthedrugwhileanegativeanddecreasingβ1(t)wouldsuggestthemagnitudeoftheeﬀectivenessofthedrugincreaseastheweeksprogress.27Weapplytheproposedresidualbootstrap-basedtestinSection2,andtestthecon-straintsi)β1(t)≤0andii)β01(t)≤0,i.e.,β1(t)isdecreasing.TheP-valuesofthetestsarecalculatedtobe0.53,0.6respectively.Hencewefailtorejectthehypothesisthattheeﬀectofthedrugisnegativeandtheeﬀectisdecreasing,whichmatcheswiththeﬁndingsbyAhkimetal.(2017).Next,weapplytheproposedestimationmethodinthisarticleundertheshapeconstraintβ1(t)≤0,withthepriorknowledgethatthedrugiseﬀective(Ahkimetal.,2017)(ascertainedbyourproposedtest).ThedegreeoftheBernsteinpolynomialusedtomodelthecoeﬃcientfunctionswaschosentobe3byﬁve-foldcross-validationindicatingsuﬃciencyofacubicﬁt.Theestimatedcoeﬃcientfunctionβ1(t)capturingtheeﬀectofthedrugondiseaseseverityisshowninFigure4.Theestimatedcoeﬃcientfunctionfromanunconstrainedﬁtusingpenalizedfunction-on-scalarregression(obtainedusing"pffr"functionwithintherefundpackageinR)isalsodisplayed.Theestimatesareaccompaniedwiththeirrespective95%conﬁdenceintervals.Theaveragewidthoftheconﬁdenceintervalsfromtheconstrainedmethod(0.62)isfoundtobesmallercomparedtothatoftheunconstrainedmethod(0.65).Wenoticeanegativeandmostlydecreasingβ1(t),illustratingtheeﬀectivenessofthedrugwhichiscapturedbyboththeconstrainedandtheunconstrainedestimator.TheﬁtteddiseaseseveritytrajectoriesfromtheconstrainedmethodisshowninFigure5forthetreatmentandtheplacebogroup,whichareveryclosetotheaverageobservedvaluesofdiseaseseverity(IMPS).4.2QuantileFunctiononScalarRegression(QFOSR)ofPhys-icalActivityDatafromBLSAAsoursecondexample,wemodelsubject-speciﬁcdistributionsofaccelerometry-measuredphysicalactivityfromBaltimoreLongitudinalStudyofAging(BLSA),thelongest-runningscientiﬁcstudyofagingintheUnitedStates.Speciﬁcally,weareinterestedinhowthesubject-speciﬁcquantilefunctionsofminute-levelactivitycountsareassoci-atedwithage,gender,heightandweight.Weuseaquantilefunction-on-scalarregressionframeworkintroducedinYangetal.(2020)fordistributionalanalysisofphysicalactivity.PriorstudiesonBLSA(Xiaoetal.,2015)havefocusedonmodelingdiurnalvariabilityofphysicalactivity.Activitycountsweremeasuredusingachest-wornActiheartphysicalactivitymonitoronparticipantsintheirfree-livingenvironmentforseveralconsecutive2801234561234567weekDisease severityplacebo fittreatment fitmean placebomean treatmentFigure5:Fitteddiseaseseveritytrajectoriesforplacebo(solidline)andtreatmentgroup(solidline),Schizophreniadata.days.Forthisanalysis,weconsiderasampleofn=857subjectsinBLSAandasinglevisitofeachparticipant.Table6presentsthedescriptivestatisticsofthesample.CharacteristicComplete(n=857)Male(n=420Female(n=437)PvalueMeanSDMeanSDMean/FreqSDAge66.8313.1768.1113.3665.612.880.005Height(m)1.690.091.760.071.630.06<2.2×10−16Weight(Kg)78.3316.3785.0214.9271.9015.09<2.2×10−16Table6:Summarystatisticsforthecomplete,maleandfemalesamplesconsideredfortheBLSAanalysis.Subject-speciﬁcdailyPAisrepresentedvia1440minute-levelactivitycounts.Fortheanalysisinthispaper,welimitourattentiontodatacollectedonMondaysforeachsubjectvisit.Wealsoonlyconsideractivitycountsfromparticipantsintheirmostactive10hourperiod(Mi10)(Wittingetal.,1990),sincethiscanserveasaproxyperiodformostofdailyphysicalactivity.TheactivitycountsarelogtransformedusingthetransformationA−→log(A+1)toremovepossibleskewnessinthedata.Subsequently,weencodesubjectlevelphysicalactivitydatainthewindowMi10(dependsonthesubjecti)usingsubject-speciﬁcquantilefunctionsQi(p)fori=1,2,...,n=857,andp∈[0,1].Figure296displaystheobserved(empirical)subject-speciﬁcquantilefunctionsQi(p).0.00.20.40.60.81.002468Activity quantile function within M10pQ(p)Figure6:Subject-speciﬁcquantilefunctionsoflog-transformedphysicalactivityintheirmostactive10hourwindowMi10.Wemodelthesubject-dayspeciﬁcquantilefunctionsasoutcomesusingthequantilefunction-on-scalarregressionmodelasfollows:Qi(p)=β0(p)+xage,iβage(p)+xsex,iβsex(p)+xheight,iβH(p)+xweight,iβW(p)+(cid:15)i(p).(15)Thefunctionalregressioncoeﬃcientsβage(p),βsex(p),βH(p)andβW(p)capturetheeﬀectsofage,sex(Male=1,Female=0),height,andweightonthequantilelevelpofsubject-speciﬁcphysicalactivity.Theinterceptfunctionβ0(p)representsthebaselinep−thquantilelevelofphysicalactivity.Yangetal.(2020)proposedtousequantlets,data-drivenbasisfunctions,forestimatingthefunctionalregressioncoeﬃcientsinQFOSR.Thequantletbasedestimationapproachdoesnotexplicitlyimposemonotonicityinthepredictedquantilefunctions,althoughtheobserved(empirical)quantilefunctionsaremonotone(Yangetal.,2020),andmostofthepredictedquantilefunctionsintheirapplicationswerefoundtobemonotoneandnon-decreasing.Yang(2020)proposedanon-decreasingbasisbasedestimationusingI-splines(Ram-say,1988)orBetaCDFswhichenforcethismonotonicityattheestimationstep.This30producesthecoeﬃcientfunctionsofformβa(p)=PKk=1Ψk(p)ˆβak,whereˆβak≥0.Noticethatthisessentiallyenforcesthecoeﬃcientfunctionsofthescalarpredictorstobemono-toneandnon-decreasingwhichmightnotbenecessarilytrueformanyofthecovariates.0.00.20.40.60.81.0−20246810interceptpbeta0_intercept0.00.20.40.60.81.0−0.03−0.02−0.010.000.01age effectpbeta_age0.00.20.40.60.81.0−0.4−0.20.00.2sex effect Malepbeta_sex0.00.20.40.60.81.0−3−2−10123height effectpbeta_height0.00.20.40.60.81.0−0.04−0.020.000.020.04weight effectpbeta_weightFigure7:Estimatedquantileleveleﬀectofscalar(age,sex,height,weight)predictorsonquantilefunctionofphysicalactivityinBLSAdatausingthequantilefunction-on-scalarregressionmodel(13).ConstrainedBPestimates(βage(p)isdecreasing)areshowninsolidlines,alongwiththeirprojectionbased95%conﬁdenceintervals(shownindottedlines).31Westartwithﬁttingunconstrainedregressionmodel(15)whichisshowninFigureS4.Severalofthefunctionalcoeﬃcients(e.g.,age,genderetc.)arenotnecessarilynon-decreasing.Theagefunctionalcoeﬃcient,inparticular,appearstobedecreasing,indicatinganaccelerateddecreaseinmaximallevelsofPAwithincreasingage(Varmaetal.,2017).Tofurtherconﬁrmthisphenomenon,wetestthenullhypothesisH0:βage(p)isdecreasingforallp∈[0,1]usingtheproposedbootstraptest(B=200)inthisarticle.Thep-valueofthetestiscalculatedtobe0.12,hencewefailtorejectthenullhypothesisthatβage(p)isdecreasing.Therefore,next,weimposethemonotonicityconstraintthatβage(p)isdecreasing.Weassumeacommondegreeofsmoothness(duetocomputationaltractability)inthecoef-ﬁcientfunctionswhichiscontrolledbytheordertheBernsteinpolynomialbasisN.ThecommonorderoftheBernsteinpolynomialbasisusedtomodelallregressioncoeﬃcientfunctionsischosentobe7usingtheﬁve-foldcross-validationmethod.Figure7displaystheestimatedcoeﬃcientfunctionsfromtheproposedBernsteinbasedconstrainedestimationapproachalongwiththeirpoint-wiseasymptotic95%con-ﬁdenceintervalsconstructedusingtheprojectionmethod.Theestimatedeﬀectofageˆβage(p)isfoundtobenegativeanddecreasingoverpillustratingthatphysicalactivitynotonlydecreasewithage(Xiaoetal.,2015;Varmaetal.,2017),butmaximallevelsofphysicalactivityaredecreasingwithafasterrate.Basedontheconﬁdenceintervals,theeﬀectofageonPAissigniﬁcantacrossallquantilelevels.Theestimatedeﬀectofgender(Male)ˆβsex(p)indicatesthatmaleshavehighermaxi-malcapacityofphysicalactivity(forp>0.8)whilefemaleshavehigheractivitylevelsintherangeofpbetween0and0.8.Inparticular,femalesareshowntohavesigniﬁcantlyhighermoderatelevelsofPA(p∈(0.4,0.8))whichisconsistentwiththeﬁndingsofXiaoetal.(2015).Forheight,weseeasigniﬁcantpositiveeﬀectˆβheight(p),especially,acrossamid-rangeofp.Theestimatedeﬀectˆβweight(p)isnegativeandappearstobedecreasing,indicatinganaccelerateddecreaseofmaximallevelsofPAduetotheincreasedweight.FittedquantilefunctionsstratiﬁedbygenderareshowninFigure8acrossdiﬀerentagesandthecenteredvaluesofheightandweight.Similarly,thepredictedphysicalactivityquantilefunctionasfunctionofweightisalsodisplayedinFigure8.Wenoticethepredictedquantilefunctionstobenondecreasingandaclearseparationamongthemwithrespecttoageandweight.Theseresultsoﬀerimportantscientiﬁcinsightsandadeeper32understandingofdependencebetweensubject-speciﬁcphysicalactivityanddemographicfactors.Remark5:Ouranalysisinthissectionillustratesthatnotallfunctionalregressioncoeﬃcients(e.g.,age)arenon-decreasinginQFOSR.InAppendixDofSupplementaryMaterial,weil-lustrateamethodoutliningasuﬃcientconditionforthemonotonicityofthequantilefunctionwhichmakesmuchweakerassumptioncomparedtoYang(2020),allowingforamoreﬂexiblemodelingoffunctionalregressioncoeﬃcientsinQFOSR.Weleavethisasafutureworktobeexploredmoredeeply.0.00.20.40.60.81.001234567MalepFitted quantile function of activityage 30age 40age 50age 60age 70age 800.00.20.40.60.81.001234567FemalepFitted quantile function of activityage 30age 40age 50age 60age 70age 800.00.20.40.60.81.00123456MalepFitted quantile function of activityweight 60weight 80weight 100weight 1200.00.20.40.60.81.00123456FemalepFitted quantile function of activityweight 60weight 80weight 100weight 120Figure8:PredictedquantilefunctionsofphysicalactivityforMaleandFemalefordiﬀer-entagesatmeanvaluesofheightandweight(top)andthepredictedquantilefunctionofphysicalactivityforMaleandFemalefordiﬀerentweightsatmeanvaluesofageandheight(bottom).335DiscussionWehavedevelopedanewestimationmethodfordealingwithshape-constrainedfunc-tionalregressioncoeﬃcientsincommonfunctionalregressionmodels.Theestimationapproachextendstheoneof(WangandGhosh,2012).Itisshownthatthekeyproblemofshaperestrictedestimationisreducedtoalinearinequalityconstrainedleastsquaresproblem,wheretheconstraintmatricesareuniversalanddonotdependonthevalueofthebasisfunctions,theobservedtime-points,ortheorderofthesplinesunliketheB-splinebasedconstrainedestimationapproaches(Ahkimetal.,2017).Theproposedapproachiscomputationallyeﬃcientandcanbeimplementedwithexistingmethodsofquadraticprogramming.Theconstrainedestimatorisshowntobeaprojectionoftheunconstrainedestimator,andconsistencyoftheconstrainedestima-torisestablishedunderthesameregularityconditionsastheunconstrainedestimator.Projection-basedpoint-wiseasymptoticconﬁdenceintervalsaredevelopedforthecon-strainedfunctionalregressioncoeﬃcientsprovidinguncertaintyquantiﬁcationofthees-timates.Aresidualbootstrap-basedtestisproposedthatisbasedontheconstrainedestimationmethod.Thisfurtherfacilitatestestingofvariousshapeconstraintsinconsid-eredfunctionalregressionproblems.Ourempiricalanalysisillustratesthattheproposedconstrainedestimationmethodcanleadtoreduceduncertaintyofthefunctionalcoeﬃ-cientintherestrictedparameterspace.ApplicationsshownonschizophreniacollaborativestudyandBaltimoreLongitudi-nalStudyofAgingillustratetheuseoftheproposedestimationmethodunderpriorconstraintsandoﬀerimportantscientiﬁcinsightsintotheseproblems.Althoughtheesti-mationmethodisillustratedforfunctionaldataobservedonadenseandregulargrid,themethodcanbeextendedtomoregeneralscenarioswherefunctionaldataareobservedonirregularandsparsedomainsandcovariatesobservedwithmeasurementerror.Insuchsparsesetups,although,theindividualnumberofobservationsmicanbesmall,andSni=1Smij=1tijhastobedenseinT.Functionalprincipalcomponentanalysis(FPCA)couldbeappliedtode-noisethefunctionalcovariatesandgettheirpredictedtrajectoriesatalltime-pointsofinterest(Ghosaletal.,2020).Theproposedestimationmethodforbothfunctionalandscalarresponsecanthenbeusedundertheabovescenarios.Exam-plesincludetheschizophreniacollaborativestudyandtheadditionalsimulationsetupunderScenarioBofthisarticle.34Therearemanyresearchproblemsthatremaintobeexploredbasedonthiscurrentwork.OneofthelimitationsofthecurrentapproachistheabsenceofatheoreticallyoptimalchoicefortheorderoftheBernsteinpolynomialbasisN.Currentlyitischoseninadatadrivenwayandithasshownasatisfactoryperformanceinourempiricalresults.Wehaveconsideredthreecommonfunctionalregressionmodels(SOFR,FOSR,FOFR)andshowntheapplicationoftheproposedestimationmethodundershapeconstraints.Themodelsillustratedinthisarticlearebuildingblocksoffunctionalregressionmodels(RamsayandSilverman,2005)andarelimitedinassuminglineareﬀectsofthepredictorsontheresponse,whereasinmanyrealworldapplicationstheeﬀectsmightaswellbenonlinear.Multipleextensionshavebeenproposedinscalar-on-function(Reissetal.,2010),function-on-scalarandfunction-on-functionregressionmodels(Kimetal.,2018)modelingdependencebetweenscalar/functionalresponseandscalar/functionalcovariatesviaunknownnonparametricfunctions.ItwouldbeofinteresttoexploretheproposedBernsteinpolynomialbasedestimationapproachtoextendtothesemodelsunderpriorshapeconstraintsonthenonparametricfunctions.Anotherinterestingareaofworkwouldbetoextendtheproposedestimationmethodbeyondcontinuousresponseandallowscalar/functionalresponsescomingfromageneralexponentialfamily,e.g,binarydata,countdataetc.UsingtheproposedBernsteinpoly-nomialbasedapproach,insuchcaseswouldleadtooptimizinganegativelog-likelihoodcriterionunderlinearinequalityconstraints.OnenaturalideawouldbetouseasecondorderTaylorapproximation(Jamesetal.,2020)oftheloglikelihoodaroundthecurrentestimateandsolveiterativelyaleastsquareobjectivefunctionunderthelinearinequalityconstraints.ABayesianframeworkforgeneralizedlinearmodelcouldalsobeadaptedtoincorporatethepriorrestrictions(GhosalandGhosh,2022).Extendingtheproposedshapeconstrainedestimationmethodtosuchgeneralclassesoffunctionalregressionmod-elswouldallowmorediverseapplicationsandremainareasforfutureresearch.SoftwareSoftwareimplementationviaR(RCoreTeam,2018)andillustrationoftheproposedframeworkisavailableonlinewiththisarticle.35SupplementaryMaterialAdditionalmethodologicalillustrationsandSupplementaryTablesandFiguresareavail-ableonlinewiththeSupplementaryMaterial.AcknowledgementsTheauthorswouldliketothanktheAssociateEditorandtwoanonymousReviewersfortheirconstructivefeedbackwhichhaveledtoanimprovedversionofthismanuscript.ReferencesAhkim,M.,I.Gijbels,andA.Verhasselt(2017).Shapetestinginvaryingcoeﬃcientmodels.Test26(2),429–450.Birke,M.andH.Dette(2007).Estimatingaconvexfunctioninnonparametricregression.ScandinavianJournalofStatistics34(2),384–404.Carnicer,J.M.andJ.M.Pena(1993).Shapepreservingrepresentationsandoptimalityofthebernsteinbasis.AdvancesinComputationalMathematics1(2),173–196.Chang,I.-S.,C.A.Hsiung,Y.-J.Wu,andC.-C.Yang(2005).Bayesiansurvivalanalysisusingbernsteinpolynomials.Scandinavianjournalofstatistics32(3),447–466.Chen,Y.,J.Goldsmith,andR.T.Ogden(2016).Variableselectioninfunction-on-scalarregression.Stat5(1),88–101.Davidson,R.andE.Flachaire(2008).Thewildbootstrap,tamedatlast.JournalofEconometrics146(1),162–169.Dette,H.,N.Neumeyer,andK.F.Pilz(2006).Asimplenonparametricestimatorofastrictlymonotoneregressionfunction.Bernoulli12(3),469–490.Eilers,P.H.,B.Li,andB.D.Marx(2009).Multivariatecalibrationwithsingle-indexsignalregression.ChemometricsandIntelligentLaboratorySystems96(2),196–202.Fan,Y.,G.M.James,andP.Radchenko(2015).Functionaladditiveregression.TheAnnalsofStatistics43(5),2296–2325.36Fan,Z.andM.Reimherr(2017).High-dimensionaladaptivefunction-on-scalarregression.Econometricsandstatistics1,167–183.Farouki,R.andT.Goodman(1996).Ontheoptimalstabilityofthebernsteinbasis.Mathematicsofcomputation65(216),1553–1566.Freyberger,J.andB.Reeves(2018).Inferenceundershaperestrictions.AvailableatSSRN3011474.Ghosal,R.andS.K.Ghosh(2022).Bayesianinferenceforgeneralizedlinearmodelwithlinearinequalityconstraints.ComputationalStatistics&DataAnalysis166,107335.Ghosal,R.andA.Maity(2021).Variableselectioninnonlinearfunction-on-scalarre-gression.Biometrics.Ghosal,R.,A.Maity,T.Clark,andS.B.Longo(2020).Variableselectioninfunctionallinearconcurrentregression.JournaloftheRoyalStatisticalSociety:SeriesC(AppliedStatistics)69(3),565–587.Ghosal,R.andE.Saha(2021).Impactofthecovid-19inducedlockdownmeasuresonpm2.5concentrationinusa.AtmosphericEnvironment254,118388.Goldfarb,D.andA.Idnani(1982).Dualandprimal-dualmethodsforsolvingstrictlyconvexquadraticprograms.InNumericalanalysis,pp.226–239.Springer.Goldfarb,D.andA.Idnani(1983).Anumericallystabledualmethodforsolvingstrictlyconvexquadraticprograms.Mathematicalprogramming27(1),1–33.Goldsmith,J.,X.Liu,J.Jacobson,andA.Rundle(2016).Newinsightsintoactivitypatternsinchildren,foundusingfunctionaldataanalyses.Medicineandscienceinsportsandexercise48(9),1723.Grenander,U.(1981).Abstractinference.Technicalreport.Hall,P.andL.-S.Huang(2001).Nonparametrickernelregressionsubjecttomonotonicityconstraints.AnnalsofStatistics29(3),624–647.Hastie,T.andR.Tibshirani(1993).Varying-coeﬃcientmodels.JournaloftheRoyalStatisticalSociety.SeriesB(Methodological)55,757–796.37Hoover,D.R.,J.A.Rice,C.O.Wu,andL.-P.Yang(1998).Nonparametricsmoothingestimatesoftime-varyingcoeﬃcientmodelswithlongitudinaldata.Biometrika85(4),809–822.Hu,Y.,X.He,J.Tao,andN.Shi(2009).Modelingandpredictionofchildren’sgrowthdataviafunctionalprincipalcomponentanalysis.ScienceinChinaSeriesA:Mathe-matics52(6),1342–1350.Huang,J.Z.,C.O.Wu,andL.Zhou(2004).Polynomialsplineestimationandinferenceforvaryingcoeﬃcientmodelswithlongitudinaldata.StatisticaSinica14,763–788.James,G.M.,C.Paulson,andP.Rusmevichientong(2020).Penalizedandconstrainedoptimization:Anapplicationtohigh-dimensionalwebsiteadvertising.JournaloftheAmericanStatisticalAssociation115(530),538–554.Kim,J.,A.Maity,andA.-M.Staicu(2018).Additivenonlinearfunctionalconcurrentmodel.StatisticsandItsInterface11,669–685.Kim,J.S.,A.-M.Staicu,A.Maity,R.J.Carroll,andD.Ruppert(2018).Addi-tivefunction-on-functionregression.JournalofComputationalandGraphicalStatis-tics27(1),234–244.Kim,M.-O.(2006).Quantileregressionwithshape-constrainedvaryingcoeﬃcients.Sankhy¯a:TheIndianJournalofStatistics68(3),369–391.Kowal,D.R.andD.C.Bourgeois(2020).Bayesianfunction-on-scalarsregressionforhigh-dimensionaldata.JournalofComputationalandGraphicalStatistics29(3),629–638.Lim,E.andP.W.Glynn(2012).Consistencyofmultidimensionalconvexregression.OperationsResearch60(1),196–208.Lorentz,G.G.(2013).Bernsteinpolynomials.AmericanMathematicalSoc.McKayCurtis,S.andS.K.Ghosh(2011).Avariableselectionapproachtomonotonicregressionwithbernsteinpolynomials.JournalofAppliedStatistics38(5),961–976.38McLean,M.W.,G.Hooker,A.-M.Staicu,F.Scheipl,andD.Ruppert(2014).Functionalgeneralizedadditivemodels.JournalofComputationalandGraphicalStatistics23(1),249–269.Meyer,M.C.(2008).Inferenceusingshape-restrictedregressionsplines.AnnalsofAppliedStatistics2(3),1013–1033.Meyer,M.C.(2018).Aframeworkforestimationandinferenceingeneralizedadditivemodelswithshapeandorderrestrictions.StatisticalScience33(4),595–614.Pya,N.andS.N.Wood(2015).Shapeconstrainedadditivemodels.Statisticsandcomputing25(3),543–559.RCoreTeam(2018).R:ALanguageandEnvironmentforStatisticalComputing.Vienna,Austria:RFoundationforStatisticalComputing.Ramsay,J.andB.Silverman(2005).FunctionalDataAnalysis.NewYork:Springer-Verlag.Ramsay,J.O.(1988).Monotoneregressionsplinesinaction.Statisticalscience3(4),425–441.Reiss,P.T.,J.Goldsmith,H.L.Shang,andR.T.Ogden(2017).Methodsforscalar-on-functionregression.InternationalStatisticalReview85(2),228–249.Reiss,P.T.,L.Huang,andM.Mennes(2010).Fastfunction-on-scalarregressionwithpenalizedbasisexpansions.Theinternationaljournalofbiostatistics6(1).Scheipl,F.,A.-M.Staicu,andS.Greven(2015).Functionaladditivemixedmodels.JournalofComputationalandGraphicalStatistics24(2),477–501.Turlach,B.A.,A.Weingessel,andC.Moler(2019).FunctionstoSolveQuadraticPro-grammingProblems.1.5-8.Vanbrabant,L.andY.Rosseel(2019).RestrictedStatisticalEstimationandInferenceforLinearModels.0.2-250.Varma,V.R.,D.Dey,A.Leroux,J.Di,J.Urbanek,L.Xiao,andV.Zipunnikov(2017).Re-evaluatingtheeﬀectofageonphysicalactivityoverthelifespan.Pre-ventivemedicine101,102–108.39Wang,J.andS.K.Ghosh(2012).Shaperestrictednonparametricregressionwithbern-steinpolynomials.ComputationalStatistics&DataAnalysis56(9),2729–2741.Witting,W.,I.Kwa,P.Eikelenboom,M.Mirmiran,andD.F.Swaab(1990).Alter-ationsinthecircadianrest-activityrhythminagingandalzheimer’sdisease.Biologicalpsychiatry27(6),563–572.Wu,Y.,J.Fan,andH.-G.M¨uller(2010).Varying-coeﬃcientfunctionallinearregression.Bernoulli16(3),730–758.Xiao,L.,L.Huang,J.A.Schrack,L.Ferrucci,V.Zipunnikov,andC.M.Crainiceanu(2015).Quantifyingthelifetimecircadianrhythmofphysicalactivity:acovariate-dependentfunctionalapproach.Biostatistics16(2),352–367.Yagi,D.,Y.Chen,A.L.Johnson,andT.Kuosmanen(2020).Shape-constrainedkernel-weightedleastsquares:Estimatingproductionfunctionsforchileanmanufacturingindustries.JournalofBusiness&EconomicStatistics38(1),43–54.Yang,H.(2020).Randomdistributionalresponsemodelbasedonsplinemethod.JournalofStatisticalPlanningandInference207,27–44.Yang,H.,V.Baladandayuthapani,A.U.Rao,andJ.S.Morris(2020).Quantilefunctiononscalarregressionanalysisfordistributionaldata.JournaloftheAmericanStatisticalAssociation115(529),90–106.Yao,F.andH.-G.M¨uller(2010).Functionalquadraticregression.Biometrika97(1),49–64.Yao,F.,H.-G.M¨uller,andJ.-L.Wang(2005a).Functionaldataanalysisforsparselongitudinaldata.JournaloftheAmericanStatisticalAssociation100(470),577–590.Yao,F.,H.-G.M¨uller,andJ.-L.Wang(2005b).Functionallinearregressionanalysisforlongitudinaldata.TheAnnalsofStatistics33(6),2873–2903.40SupplementaryMaterialforShape-ConstrainedEstimationinFunctionalRegressionwithBernsteinPolynomialsRahulGhosal1,∗,SujitGhosh2,JacekUrbanek3,JenniferA.Schrack4,VadimZipunnikov51DepartmentofEpidemiologyandBiostatisticsUniversityofSouthCarolina2DepartmentofStatistics,NorthCarolinaStateUniversity3DepartmentofMedicine,JohnsHopkinsUniversitySchoolofMedicine4DepartmentofEpidemiology,JohnsHopkinsBloombergSchoolofPublicHealth5DepartmentofBiostatistics,JohnsHopkinsBloombergSchoolofPublicHealthSeptember13,20221arXiv:2209.04476v1  [stat.ME]  9 Sep 20221AppendixA:ProofofTheorem1First,wewillshowthattheconstrainedestimatorˆβc(t)isaconsistentestimatorofβ(t)aslongastheunconstrainedestimatorˆβu(t)isconsistent.Second,conditions(H1)-(H5)willbeusedtoverifytheconsistencyoftheunconstrainedestimatorusingexistingresultsforSOFR(Cardotetal.,1999,2003).NoticethatforBernsteinpolynomialbasisapproximation,thecondition(H4)withjustq=v=0(i.e.,H=C[0,1])wouldsuﬃce.Thepriorshaperestrictions,e.g.,positivity,monotonicity,convexityortheircombi-nationsontheregressioncoeﬃcientfunctionoftheformβ(t)∈FcanbeapproximatedbythelinearconstraintsAβ≥0usingtheBernsteinpolynomialbasisexpansion.NoticethatalthoughthematrixAandthevectorβvarieswithn,wesuppresssuchnotationsforsimplicity.TherestrictedparameterspaceisgivenbyΘR={β∈RKn:Aβ≥0},whereagainKnisalloweddependonthesamplesizen.Thebasiscoeﬃcientsarethenestimatedviaconstrainedleastsquareswithlinearinequalities.Thescalar-on-functionregressionmodelafterbasisexpansionwithBernsteinpolynomialscanbewritten(w.l.gbyabsorbingtheinterceptterm)asfollowsYi=WTiβ+(cid:15)i.Theunrestrictedandrestrictedestimatorsaregivenbyˆβur=argminβ∈RKnnXi=1(Yi−WTiβ)2,(1)ˆβr=argminβ∈ΘRnXi=1(Yi−WTiβ)2.(2)WefollowtheproofsofMeyer(2008);FreybergerandReeves(2018)whoshowedthattheconstrainedestimatorsareprojectionoftheunconstrainedestimatorsontherestrictedspace,particularlywhentheobjectivefunctionisquadratic(FreybergerandReeves,2018).Inourcase,thiscanbeshownbyﬁrstnotingthat1n||Y−Wβ||22=1n||Y−Wˆβur||22+1n||Wˆβur−Wβ||22,whereY=(Y1,Y2,...,Yn)TandW=(W1,W2,...,Wn)T.Hence,wehaveˆβr=2argminβ∈ΘR||β−ˆβur||2ˆΩ,whereˆΩ=1nPni=1WiWTiandΩ=E(ˆΩ)isnon-singular.LettheBernsteinpolynomialapproximationofβ(t)begivenbyβN(t)=PNk=0β0kbk(t,N)=ρKn(t)0β0forsomeβ0∈ΘR(WangandGhosh,2012;FreybergerandReeves,2018),whichuniformlyconvergestoβ(t)(sinceFNisnestedinFandS∞N=1FNisdenseinFwithrespecttothesup-norm).Sincetherestrictedestimatorˆβrisprojectionoftheunconstrainedbasiscoeﬃcientˆβur,wehave:Pr[||ˆβr−β0||ˆΩ>(cid:15)]≤Pr[||ˆβr−ˆβur||ˆΩ+||ˆβur−β0||ˆΩ>(cid:15)]≤Pr[||ˆβur−β0||ˆΩ>(cid:15)/2].Thereasonisthatˆβristheprojectionofˆβurandhence||ˆβr−ˆβur||ˆΩ≤||ˆβur−β0||ˆΩ.LetusalsoassumeˆΩ=1nPni=1WiWTi→Ω,whichisastandardregularityconditionintheunconstrainedcase.Theaboveinequalitiesdirectlyshowthatˆβrisconsistent,iftheunrestrictedestimatorˆβurisconsistent.Conditions(H1)-(H5)guaranteeconsistencyoftheunconstrainedestimatorusingexistingresultsforSOFR(Cardotetal.,1999,2003)andHuangetal.(2004)(speciﬁcally,Theorem3.1inCardotetal.(2003)).Hencetherestrictedestimatorisconsistentunderthesameregularityconditions.Moreover,ifβ0∈ΘRwehave||ˆβur−β0||2ˆΩ=||ˆβur−ˆβr||2ˆΩ+||ˆβr−β0||2ˆΩ.Hence||ˆβr−β0||2ˆΩ≤||ˆβur−β0||2ˆΩ,withequalityiﬀˆβur=ˆβr.Hencetheshape-restrictedestimatorofthebasiscoeﬃcientshassmallersquarederrorlossthantheunrestrictedversion,whenthetrueregressionfunctionsatisﬁestheshapeassumptions.2AppendixB:SupplementaryResultsandProofsforFunctionalResponseCaseWeconsidershapeconstrainedestimationinthefunctionalresponseregressionmodel(11)ofthepaper,arisingfromfunction-on-scalarorfunction-on-functionregression.WepositthefollowingTheoremoutliningconsistencyoftheconstrainedestimator.TheoremS1Considerthefunctionalresponseregressionmodel(11).Supposethefol-lowingconditionshold.(C1)Theobservedtime-pointsS={t1,t2,...,tm}∼FTonT;moreovertheyareinde-pendentoftheresponseandcovariateprocesses{Yi(t),Xi(t)}(i=1,2,...,n).The3distributionFThasaLebesguedensityfT(t)whichisboundedawayfrom0and∞uniformlyoverT.(C2)∃positiveconstantsM1,M2>0s.ttheeigenvaluesλ0(t)≤λ1(t)ofW(t)=E{H(t)HT(t)}(H(t)=[1X(t)])satisfyM1≤λ0(t)≤λ1(t)≤M2uniformlyoverT.(C3)∃M3>0s.t|X(t)|≤M3fort∈T.(C4)ThereisaconstantM4s.tE((cid:15)2(t))≤M4<∞.(C5)limsupnmax‘=0,1N‘min‘=0,1N‘<∞,whereN‘isthereorderoftheBernsteinbasispolynomialusedtomodelβ‘(t).(C6)Theerrorprocesscanbedecomposedas(cid:15)(t)=V(t)+wt,whereV(·)isameanzerostochasticprocessandandwtaremeasurementerrorsthatareindependentatdiﬀerenttimepointsandhavemeanzeroandconstantvarianceσ2.(C7)limnd(β‘(·),FN,‘)=0(‘=0,1)andlimnNnlogNn/n=0,whered(β‘(·),FN,‘)isdeﬁnedasd(β‘(·),FN,‘)=infg∈FN,‘supt∈T|β‘(t)−g(t)|andNn=maxl∈{0,1}N‘.(C8)ˆΣisaconsistentestimatorofΣinthesense||ˆΣ−1−Σ−1||2=op(1)(spectralnorm).Ifthepriorshaperestrictiononβ‘(t)iscorrect,i.e.,thetruecoeﬃcientfunctionβ‘(t)∈F‘,thentheconstrainedestimatorˆβc,‘(t)isaconsistentestimatorofβ‘(t).Proof:Weagainshowthattheconstrainedestimatorˆβc,‘(t)isaconsistentestimatorofβ‘(t)iftheunconstrainedestimatorˆβu,‘(t)isconsistent.Regularityconditions(C1)-(C8)providestheconsistencyoftheunconstrainedGLSestimatorusingTheorem1inHuangetal.(2004).Letβ(t)=[β0(t)β1(t)].Itisenoughtoshowthatˆβc(t)isaconsistentestimatorofβ(t)ifˆβu(t)isconsistent.Thepriorshaperestrictions,e.g.,positivity,monotonicity,convexityortheircombi-nationsontheregressioncoeﬃcientfunctionsoftheformβ(t)∈F(F=F0×F1)canbereducedtolinearconstraintsAβ≥0usingtheBernsteinpolynomialbasisexpansion.LettherestrictedparameterspaceisgivenbyΘR={β∈RKn:Aβ≥0}.Thebasiscoeﬃcientsarethenestimatedvialinearinequalityconstrainedgeneralizedleastsquares.ForthemomentletusassumeΣtobeknown,inpracticewewillusetheconsistent4estimatorˆΣinitsplace.ThefunctionalresponseregressionmodelafterbasisexpansionwithBernsteinpolynomialsandpre-whiteningwithcovariancematrixcanbewrittenas,Y∗i=B∗0β0+W∗iβ1+(cid:15)∗i.HereY∗i=Σ−1/2m×mYi,B∗0=Σ−1/2m×mB0,W∗i=Σ−1/2m×mWiand(cid:15)∗i=Σ−1/2m×m(cid:15)i.LetZ∗i=[B∗0W∗i].Theunrestrictedandrestrictedestimatorsaregivenbyˆβur=argminβ∈RKnnXi=1||Y∗i−Z∗iβ||22(3)ˆβr=argminβ∈ΘRnXi=1||Y∗i−Z∗iβ||22Weagainshowthattheconstrainedestimatorsareprojectionofunconstrainedesti-matesontherestrictedspace(FreybergerandReeves,2018).LetusdenoteY∗T=(Y∗1,Y∗2,...,Y∗n)TandZ∗=[Z∗T1,Z∗T2,...,Z∗Tn]T.1n||Y∗−Z∗β||22=1n||Y∗−Z∗ˆβur||22+1n||Z∗ˆβur−Z∗β||22.Hencewehaveˆβr=argminβ∈ΘR||β−ˆβur||2ˆΩ,whereˆΩ=1nPni=1Z∗TiZ∗iandΩ=E(ˆΩ)isnon-singular.LettheBernsteinpolynomialapproximationofβ(t)begivenbyβN(t)=ρKn(t)0β0forsomeβ0∈ΘR(FreybergerandReeves,2018).Sincetherestrictedestimatorˆβrisprojectionoftheunconstrainedbasiscoeﬃcientˆβur,arguinginthesimilarwayasinthescalarresponsecase,wehave:Pr[||ˆβr−β0||ˆΩ>(cid:15)]≤Pr[||ˆβr−ˆβur||ˆΩ+||ˆβur−β0||ˆΩ>(cid:15)]≤Pr[||ˆβur−β0||ˆΩ>(cid:15)/2].WeagainassumeˆΩ=1nPni=1Z∗TiZ∗i→Ω.Theaboveinequalitydirectlyshowsthatˆβrisconsistentiftheunrestrictedestimatorˆβurisconsistent,andtheshape-restrictedestimatorisconsistentunderthesameregularityconditionsastheunconstrainedestimator.3AppendixC:5Algorithm1Bootstrapalgorithmforshapetestingwithfunctionalresponse1.FittheunconstrainedFOSRmodel(2)ortheFLCM(4)usingtheBernstein-polynomialrepresentationin(11)andcalculatetheresidualsei(tj)=Yi(tj)−ˆYi(tj),fori=1,2,...,n.2.FittheconstrainedmodelcorrespondingtoH0(thenull)andestimateβ0(t),β1(t)usingthefollowingconstrainedminimizationcriteria(nopre-whitening),(ˆβ0,ˆβ1)=argminβ0,β0nXi=1||Yi−B0β0−Wiβ1||22s.tAβ1≥b.Denotetheestimatesˆβc0(t),ˆβc1(t).3.ComputeteststatisticT(15)basedonthesenullandfullmodelﬁts,denotethisasTobs.4.ResampleBsetsofbootstrapresiduals{e∗b,i(t)}ni=1fromresiduals{ei(t)}ni=1obtainedinstep1.5.forb=1toB6.GeneratefunctionalresponseundertheconstrainednullmodelfortheFLCM(forFOSRXi(t)=Xi)asY∗b,i(t)=ˆβc0(t)+Xi(t)ˆβc1(t)+e∗b,i(t),7.Giventhebootstrapdataset{Xi(t),Y∗b,i(t)}ni=1ﬁtthenullandthefullmodeltocomputetheteststatisticT∗b.8.endfor9.Calculatethep-valueofthetestasˆp=PBb=1I(T∗b≥Tobs)B.4AppendixD:MonotonicityofQuantilefunctionsasoutcomesinQFOSRLetµ(p)=β0(p)+PJj=1xjβj(p),0≤p≤1.Weassume0≤xj≤1,∀j=1,2,...,J,withoutlossofgenerality(otherwiseachievedbylineartransformationorbyanactivationfunction,e.g.,zj=F0(xj)forac.d.fF0onsupportofxj).Now,µ0(p)=β00(p)+PJj=1xjβ0j(p).Letβ00(p)=Pmk=1γ0kbk−1(p,m−1)andβ0j(p)=Pmk=1γjkbk−1(p,m−1),wherebk−1(p,m−1)=(cid:0)m−1k−1(cid:1)pk−1(1−p)m−kandγjk’sarethediﬀerencesoftheoriginalBernsteinbasiscoeﬃcientsβjkcorrespondingtoβj(p)’s.Thus,µ0(p)=mXk=1 γ0k+JXj=1xjγjk!bk−1(p,m−1).Now,asγ0k+PJj=1xjγjkisalinearfunctionin(x1,x2,...,xJ)∈[0,1]J,bythewell-knownBauer’sprincipletheminimumisattainedattheboundarypointsB={(x1,x2,...,xJ):6xj∈{0,1}}.Hencetherequiredsuﬃcientconditionformonotonicity(non-decreasing)isargmin(x1,x2,...,xj)∈B(γ0k+JXj=1xjγjk)≥0,∀k.Examples•J=1:Theconstraintreducesto,argminx1∈{0,1}(γ0k+x1γ1k)=min(γ0k,γ0k+γ1k)≥0,:⇔γ0k≥0&γ0k+γ1k≥0∀k.Notethatthisallowsγ1k≤0forsomekandhenceanon-decreasingβ1(p)isnotrequired.•J=2:Asuﬃcientconditionisargmin(x1,x2)∈{0,1}2(γ0k+x1γ1k+x2γ2k)≥0,:⇔γ0k≥0,γ0k+γ1k≥0,γ0k+γ2k≥0,γ0k+γ1k+γ2k≥0∀k.Noticethatthesuﬃcientconditionaboveislinearinγjk’sandhenceβjk’s.Ingeneral,theconditioncanbeexpressedviathelinearinequalityconstraintANβN≥0(forasuitablematrixAN),theframeworkillustratedinthepaper.5SupplementarySimulationScenarioS1WeconsideradatageneratingscenariosimilarasinScenarioB(densedata)ofthepaper,withnowβ1(t)=2.5,aconstantfunction.Weconsiderestimationundertheconstraintβ1(t)isdecreasing,sothatthetruefunctionliesontheboundaryoftherestrictedparameterspace.Samplesizen=100andBernsteinpolynomialbasisoforderN=5isconsideredforestimationandobtainingtheprojectionbasedconﬁdenceintervals.Theaverageestimatedcoveragefromtheasymptotic95%conﬁdenceintervalsisfoundtobe0.946,closetothenominallevel.FigureS3inthisSupplementaryMaterialdisplaystheestimatedcoeﬃcientfunctionalongwithitspoint-wiseconﬁdenceintervalsforoneoftheMonteCarloreplication.Theconstantfunctionisobservedtobewellcapturedbytheproposedestimateandtheconﬁdenceintervals.76SupplementaryTablesBPorder(N)Samplesize(n=25)Samplesize(n=50)Samplesize(n=100)20.88(0.09)0.87(0.06)0.86(0.04)30.90(0.11)0.92(0.07)0.90(0.05)40.91(0.15)0.93(0.09)0.96(0.06)50.92(0.23)0.95(0.13)0.96(0.08)60.91(0.41)0.93(0.19)0.94(0.11)pfr(unconstrained)0.88(0.14)0.94(0.10)0.98(0.07)TableS1:Averageestimatedcoverage(overthegridof50equispacedtime-pointsinT=[0,1])oftheprojection-based95%point-wiseconﬁdenceintervals,forvariouschoicesoftheorderoftheBernsteinpolynomial(BP)basis,scenarioA.Averagewidthoftheconﬁdenceintervalisgivenintheparenthesis.TheaveragechoiceofNfromcross-validationforthisscenarioishighlightedinbold.BPorder(N)Samplesize(n=25)Samplesize(n=50)Samplesize(n=100)30.76(0.26)0.70(0.17)0.61(0.12)40.82(0.29)0.78(0.20)0.68(0.13)50.91(0.34)0.92(0.23)0.92(0.16)60.91(0.38)0.93(0.26)0.93(0.17)70.93(0.43)0.93(0.29)0.94(0.19)80.94(0.55)0.94(0.35)0.94(0.22)pﬀr(U)0.63(0.40)0.69(0.29)0.67(0.21)pﬀr-sandwich(U)1.00(1.42)0.99(1.00)1.00(0.71)TableS2:Averageestimatedcoverage(overthegridof40equispacedtime-pointsinT=[0,1])oftheprojection-based95%point-wiseconﬁdenceintervals,forvariouschoicesoftheorderoftheBernsteinpolynomial(BP)basis,scenarioB.Averagewidthoftheconﬁdenceintervalisgivenintheparenthesis.TheaveragechoiceofNfromcross-validationforthisscenarioishighlightedinbold.Lasttworowsreporttheresultsfromthedefaultunconstrained(U)("pffr")methodwithin"refund"andfromusingasandwichestimatorforapproximatevariancesin"pffr".Samplesize(n)ConstrainedmethodUnconstrainedmethodP-value501.84(1.37)3.86(2.93)<2.2×10−161000.967(0.65)1.91(1.38)<2.2×10−16TableS3:Averageintegratedmeansquareerror(×100)over200Monte-Carlorepli-cations,scenarioB,Sparsedata.StandarderrorsofIMSE(×100)arereportedintheparenthesis.P-valuesareobtainedfromtwosamplet-test.87SupplementaryFigures0.00.20.40.60.81.0−0.050.000.050.100.15tbeta(t)FigureS1:Asymptotic95%point-wiseconﬁdenceintervalforβ(t)usingtheprojection-basedapproach,scenarioA,n=100.Thetrueregressioncoeﬃcientfunctionisthesolidblackline,theconstrainedestimatoristhesolidgreenline,thedottedgreenlinesshowpoint-wise95%conﬁdenceintervals.90.00.20.40.60.81.0−4−2024tBeta1(t)FigureS2:Asymptotic95%point-wiseconﬁdenceintervalforβ1(t)fromtheprojectionbasedapproach,scenarioB,n=100.Thetrueregressioncoeﬃcientfunctionisthesolidblackline,theestimatoristhesolidgreenline,thedottedgreenlinesshowpoint-wise95%conﬁdenceintervals.100.00.20.40.60.81.01.52.02.53.03.5tBeta1(t)FigureS3:Asymptotic95%point-wiseconﬁdenceintervalforβ1(t)fromtheprojectionbasedapproach,SupplementaryscenarioS1,n=100.Thetruecoeﬃcientfunctionisshownviathesolidblacklineandtheestimateisshowninsolidgreen,thedashedlinescorrespondtothepoint-wise95%conﬁdenceintervals.110.00.20.40.60.81.00246interceptM10 level pbeta0(p)_intercept 0.00.20.40.60.81.0−0.03−0.02−0.010.000.010.02age effectpbeta_age0.00.20.40.60.81.0−0.20−0.100.000.050.10sex effect Malepbeta_sex0.00.20.40.60.81.0−0.20.00.20.40.60.81.01.2height effectpbeta_height0.00.20.40.60.81.0−0.015−0.010−0.0050.000weight effectpbeta_weightFigureS4:Estimatedquantileleveleﬀectofscalar(age,sex,height,weight)predictorsonquantilefunctionofphysicalactivityinBLSAdatausingthequantilefunction-on-scalarregressionmodel(13).Unconstrainedpenalizedsplineestimatesobtainedusingthe"pffr"functionwithintherefundpackageareshownindottedlines.12ReferencesCardot,H.,F.Ferraty,andP.Sarda(1999).Splineestimatorsforthefunctionallinearmodel:Consistency,applicationandsplusimplementation.Cardot,H.,F.Ferraty,andP.Sarda(2003).Splineestimatorsforthefunctionallinearmodel.StatisticaSinica13(3),571–591.Freyberger,J.andB.Reeves(2018).Inferenceundershaperestrictions.AvailableatSSRN3011474.Huang,J.Z.,C.O.Wu,andL.Zhou(2004).Polynomialsplineestimationandinferenceforvaryingcoeﬃcientmodelswithlongitudinaldata.StatisticaSinica14,763–788.Meyer,M.C.(2008).Inferenceusingshape-restrictedregressionsplines.AnnalsofAppliedStatistics2(3),1013–1033.Wang,J.andS.K.Ghosh(2012).Shaperestrictednonparametricregressionwithbern-steinpolynomials.ComputationalStatistics&DataAnalysis56(9),2729–2741.13