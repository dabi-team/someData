2
2
0
2

y
a
M
8
2

]

R
S
.
h
p
-
o
r
t
s
a
[

1
v
1
7
4
4
1
.
5
0
2
2
:
v
i
X
r
a

Draft version May 31, 2022
Typeset using LATEX preprint style in AASTeX631

Photometric metallicity prediction of fundamental-mode RR Lyrae stars in the Gaia
optical and Ks infrared wavebands by deep learning
Istv´an D´ek´any1 and Eva K. Grebel1

1Astronomisches Rechen-Institut, Zentrum f¨ur Astronomie der Universit¨at Heidelberg, M¨onchhofstr. 12-14, 69120
Heidelberg, Germany

ABSTRACT
RR Lyrae stars are useful chemical tracers thanks to the empirical relationship be-
tween their heavy-element abundance and the shape of their light curves. However, the
consistent and accurate calibration of this relation across multiple photometric wave-
bands has been lacking. We have devised a new method for the metallicity estimation
of fundamental-mode RR Lyrae stars in the Gaia optical G and near-infrared VISTA
Ks wavebands by deep learning. First, an existing metallicity prediction method is
applied to large photometric data sets, which are then used to train long short-term
memory recurrent neural networks for the regression of the [Fe/H] to the light curves
in other wavebands. This approach allows an unbiased transfer of our accurate, spec-
troscopically calibrated I-band formula to additional bands at the expense of minimal
additional noise. We achieve a low mean absolute error of 0.1 dex and high R2 regres-
sion performance of 0.84 and 0.93 for the Ks and G bands, respectively, measured by
cross-validation. The resulting predictive models are deployed on the Gaia DR2 and
VVV inner-bulge RR Lyrae catalogs. We estimate mean metallicities of −1.35 dex for
the inner bulge and −1.7 for the halo, which are signiﬁcantly less than values obtained
by earlier photometric prediction methods. Using our results, we establish a public cat-
alog of photometric metallicities of over 60,000 Galactic RR Lyrae stars, and provide an
all-sky map of the resulting RR Lyrae metallicity distribution. The software code used
for training and deploying our recurrent neural networks is made publicly available in
the open-source domain.

Keywords: RR Lyrae variable stars(1410) – Metallicity(1031) – Light curves(918) –

Deep learning (1938)

1. INTRODUCTION

RR Lyrae variables are low-mass, core helium-burning stars undergoing radial pulsation. Since these
bright stars abound in old stellar populations, are easy to identify, and their absolute luminosities
and heavy-element abundances can be inferred from their light variations (see Bhardwaj 2022, for
a recent review), they have been widely employed as astrophysical tracer objects within the Local
Group of galaxies (e.g., Tanakul & Sarajedini 2018; Clementini et al. 2019; Soszy´nski et al. 2019;
D´ek´any & Grebel 2020). In addition, the photometric estimation of the metallicity distributions of
large RR Lyrae samples oﬀer the possibility to constrain the formation epoch and early chemical

 
 
 
 
 
 
2

D´ek´any et al.

enrichment of the underlying old stellar populations (see, e.g., Savino et al. 2020, and references
therein).

Although the existence of an empirical relationship between the shape of an RR Lyrae star’s light
curve and its metallicity has been known since the pioneering work by Jurcsik & Kov´acs (1996),
its accurate calibration in multiple photometric bands has been a challenging task, mainly due to
the small number of stars with high-dispersion spectroscopic (HDS) metallicity measurements. Over
the past ∼ 25 years, various empirical formulae have been established to predict the [Fe/H] from
the Fourier regression parameters of the light curves in various photometric wavebands, following
diﬀerent strategies. Since direct regression to the HDS metallicities has long suﬀered from small
sample sizes (e.g., Nemec et al. 2013), most authors (e.g., Jurcsik & Kov´acs 1996; Smolec 2005;
Ngeow et al. 2016; Iorio & Belokurov 2020; Mullen et al. 2021) addressed the problem by relying
on low-dispersion spectroscopic or spectro-photometric metallicities estimated from spectral indices
(see, e.g., Layden 1994; Crestani et al. 2021). Although the diversity of light-curve shapes in the
training sets could be increased by a few times this way, such an approach required the intermediate
calibration of the spectral indices to the same limited amount of HDS data. Another approach was
to transfer a predictive formula established for one waveband to another by linearly transforming the
regressors, i.e., the Fourier parameters of the light curve, between these bands (e.g., Skowron et al.
2016; Clementini et al. 2019). However, such transformations are not only inherently noisy, but they
also depend on the metallicity.

Generally speaking, the limited amount of heterogeneous data, strong heteroskedasticity, and large
errors in the regressors lead to various systematic biases in the metallicity prediction formulae. Such
systematics were often also diﬃcult to explore and quantify due to the lack of large samples with ac-
curate light curves in multiple wavebands. Fortunately, HDS analyses of RR Lyrae stars have recently
proliferated (see Crestani et al. 2021, and references therein), calling for the revision of earlier pho-
tometric [Fe/H] estimation methods. Exploiting the new state-of-the-art abundance measurements,
we recently established new empirical predictive models of the [Fe/H] of both fundamental-mode
(RRab) and ﬁrst-overtone (RRc) RR Lyrae stars from their light curves in the Cousins I ﬁlter, a
highly important waveband in contemporary studies of the Milky Way and the Magellanic Clouds.
In the case of this band, the training sample was suﬃciently large and accurate, so that with careful
feature selection and probabilistic modeling of the uncertainties, it allowed a direct regression to the
HDS data, removing the additional error-prone but customary intermediate step of calibrating spec-
tral indices to the HDS [Fe/H] values. Our analysis revealed large systematic biases in several earlier
formulae, that led to an ∼ 0.4 dex positive bias in previous estimates of the metallicity distribution
functions of old stellar populations, such as the bulge and the Magellanic Clouds.

In the era of large time-domain sky surveys that discovered and monitor ∼ 105 RR Lyrae stars in
the Local Group and keep on detecting new ones, accurate photometric predictive models of their
metallicties are needed in order to unlock their full potential as population tracers; and ideally we
need them in all the various optical and infrared wavebands in which such surveys operate. One way
to accomplish that is to consider this task as a set of independent regression problems of the HDS
measurements on the light curves in each waveband. However, this approach is hindered by the fact
that in most cases, the number of stars with both HDS abundance measurements and accurate light
curves is still too small. Using small, separate training data sets for diﬀerent wavebands is not only

Photometric [Fe/H] of RRab stars in the G and Ks bands by deep learning

3

prone to systematics in the predicted [Fe/H], but also makes it hard to keep all separate relations
up-to-date as new data become available.

An alternative approach is to ﬁt a single predictive formula to the HDS measurements using a
waveband in which a suﬃciently large HDS training data set already exists. Then, transfer the
resulting base estimator to other wavebands; but instead of transforming the regressors, handle each
problem as a regression of the light curve shapes to the predicted photometric [Fe/H] as the response
variable. By taking this approach, large training data sets become available, allowing us to use
deep learning for the regression, i.e., highly complex models capable of extracting every last bit of
predictive information from the light curves. This, in turn, oﬀers the possibility of a highly precise
and unbiased transfer of the original relation to additional wavebands, with the cost of introducing
only minimal noise. Therefore, the safe combination of photometric data across diﬀerent surveys
for the inference of metallicity distribution functions of large stellar populations becomes possible.
Moreover, upon the availability of additional HDS measurements, an immediate homogeneous update
of the predictive models in all wavebands becomes very straightforward.

It is important to emphasize that by adopting this method, we make the important assumption of
physical similarity between the HDS training data set of the base estimator and the training sets of
the deep learned models. Speciﬁcally, we assume that these data sets are not systematically diﬀerent
in terms of other, latent physical variables that aﬀect the light-curve shapes (e.g., in their helium
abundances; see, e.g., D´ek´any et al. 2021). We note that the same assumption is also implicitly made
when any other estimator of photometric metallicity estimation is either calibrated or applied to a
new data set.

The above approach of photometric metallicity estimation was originally put forward by Hajdu
et al. (2018), who trained an ensemble of multi-layer perceptrons (i.e., classical fully connected neural
networks) to predict the [Fe/H] of RRab stars from their Ks-band photometric time series, using a
parametric representation of the light curves as regressors, and I-band photometric [Fe/H] estimates
obtained with the formula of Smolec (2005) as response variables. In this study, we build upon this
idea to obtain deep-learned predictive models of the [Fe/H] of RRab stars from their light curves in
the Gaia G and VISTA Ks wavebands. Our analysis comprises the following major steps. First, using
our recent predictive formula (D´ek´any et al. 2021, hereafter D21), we create our development data
sets by computing photometric [Fe/H] estimates from the I-band light curves of a large number of
RRab stars that were also observed in either the Gaia optical G or the VISTA near-infrared (near-IR)
Ks ﬁlters. These [Fe/H]I estimates are then used as our response variables for the development of
additional predictive models. To estimate the [Fe/H]I from G and Ks light curves, we train Recurrent
Neural Networks (RNNs), which allow us to use the original photometric time series as input data,
instead of relying on a classical parametric representation of the light curves. Finally, the trained
RNNs are deployed on the RRab catalogs of the Gaia and the VISTA Variables in the V´ıa L´actea
surveys, in order to deliver a public database of accurate photometric metallicity estimates.

2. PHOTOMETRIC DATA AND THEIR REPRESENTATION

As the ﬁrst step of establishing the photometric data sets for the development of our predictive
models for the metallicity, we compute I-band photometric [Fe/H] estimates for a very large number
of Galactic RRab stars using the D21 formula, that is directly calibrated to HDS spectroscopic
measurements. These [Fe/H]I estimates will serve as our response variables for training and validating
the predictive models for the optical and near-IR bands. We used the public I-band light curves

4

D´ek´any et al.

Table 1. I-band photometric parameters and metallicities of RRab stars in the bulge
and disk areas of the OCVS.

Fielda

ID

R.A.b [hms] DEC.b [dms]

[Fe/H]I

b
b
b
b
b

00001
00003
00004
00005
00006

17:05:07.49
17:05:09.88
17:05:15.22
17:05:21.98
17:05:29.00

-32:37:57.2
-32:39:52.8
-32:50:13.2
-32:39:42.5
-32:33:37.4

-1.712
-1.296
-1.868
-2.596
-1.426

(cid:104)I(cid:105)

Nep. Period [d] Atot.

A1

A2

A3

φ21

φ31

c S/N

Cϕ

15.595
16.451
15.965
15.336
15.846

121
121
122
121
121

0.732586
0.515465
0.651696
0.565511
0.478877

0.447 0.167 0.073 0.043 9.5708 6.680 0.956 413.2
0.696 0.215 0.118 0.077 8.9977 5.700 0.950 428.2
0.264 0.113 0.036 0.018 9.3813 6.315 0.965 154.5
0.606 0.241 0.098 0.029 8.9175 5.006 0.962
72.3
0.804 0.245 0.121 0.097 8.8742 5.396 0.958 547.3

a‘b’: bulge, ‘d’: disk; original OCVS designations: OGLE-BLG-RRLYR-ID and OGLE-GD-RRLYR-ID,
respectively.
bCoordinates of J2000.0 epoch.
cPhase coverage: 1−maximum phase lag.
Note— Results are shown for stars that pass the following criteria: Cϕ ≥ 0.8, Atot. ≤ 1.2, S/N ≥ 50.
This table is available in its entirety in machine-readable form.

of RRab stars acquired by the Optical Gravitational Lensing Experiment (OGLE, Udalski et al.
2015) cataloged in the OGLE Collection of Variable Stars1 (OCVS) of the Galactic bulge and disk,
comprising tens of thousands of objects.

The pulsation periods of the RRab stars were adopted from the OCVS, while the I-band φ31 and
A2 Fourier parameters that also serve as input features of the D21 formula were computed using
the lcfit2 package (D´ek´any 2022a), following the regression procedure discussed by D´ek´any et al.
(2021). In brief, a robust ﬁtting of a truncated Fourier-sum with iterative outlier rejection and order
optimization via cross-validation is followed by a Gaussian Process Regression (GPR) of the phase-
folded light curves. The ﬁnal parameters are obtained from the Fourier representation of the mean
GPR model. The results of our analysis are displayed in Table 1. The uncertainties in the resulting
[Fe/H]I values were estimated by drawing numerous random samples from the GPR model at the
original observational phases for each object, repeating the same regression procedure as above for
each realization, and calculating the standard deviation of the resulting [Fe/H] predictions. These
uncertainties will be used for sample weighting in the training and validation of the predictive models.

1 http://ogledb.astrouw.edu.pl/∼ogle/OCVS/
2 https://zenodo.org/record/6576222

Photometric [Fe/H] of RRab stars in the G and Ks bands by deep learning

5

At the next step, we cross-matched the celestial coordinates of the OCVS RRab stars with the
RR Lyrae catalog from the Gaia data release 2 (DR2) (Clementini et al. 2019), and the Ks-band
point source catalogs of the VISTA Variables in the V´ıa L´actea (VVV) ESO Public Survey (Minniti
et al. 2010) created by the VISTA Data Flow System (VDFS, Emerson et al. 2004) and provided
by the Cambridge Astronomy Survey Unit (CASU). The cross-match yielded ∼ 13, 700 objects with
Gaia and ∼ 29, 600 stars with VVV photometry.

The Gaia light curves of the cross-matched objects were directly retrieved through the Gaia@AIP
database interface of the Leibniz Institute for Astrophysics Potsdam. The corresponding Ks-band
VVV light curves were obtained by following the procedure discussed in D´ek´any et al. (2018), and
subsequently applying the photometric zero-point corrections of Hajdu et al. (2020).

Both the Gaia and VVV light curves were pre-processed by subjecting them to the previously
discussed regression procedure, which was also used for the OGLE light curves. Since the sampling,
precision, and temporal baseline of the OGLE light curves are far superior than those of the Gaia and
VVV data, we always used the periods derived from the former. Likewise, we adopted the OGLE
variable star classiﬁcations for similar reasons. In case of the Gaia data, we opted not to use the
per-epoch photometric quality ﬂags provided in DR2 for the omission of bad data, instead we relied
on our own outlier rejection mechanism because the former would have led to the culling of too many
useful measurements. In case of the VVV data, we selected the optimal photometric aperture for
each object by maximizing the signal-to-noise (S/N ) ratio in the cleaned light curve.

For the predictive modeling of the [Fe/H] from the light curves, we use the following 2-dimensional

sequences as input variables (i.e., regressors):

(cid:32)

m<t> − (cid:104)m(cid:105)

(cid:33)

x<t> =

· P
φP (T ) = mod[(T + P · Φ1/(2π))/P ] ,

φ<t>
P

, t = {1, . . . , Nep.} ,

(1)

(2)

P

Here, m<t> and φ<t>
are the magnitudes and corresponding pulsation phases of the light curve,
respectively, (cid:104)m(cid:105) is the mean magnitude, Φ1 is the phase of the ﬁrst Fourier term, T is the observation
time, and Nep. is the number of observational epochs. In addition, the VVV Ks light curves were
binned to a maximum of 60 points per time series in order to speed up the training of the neural
networks.

By using the original (phased) measurements instead of a traditional parametric representation
of the light curves, we virtually eliminate any potential representation error in the regressors, and
allow a natural propagation of uncertainties in the photometric time series in the form of scatter
in the input sequences. We note that the above representation of the time series is not strictly
non-parametric due to the phase-folding of the light curves: an accurate knowledge of the period is
obviously required or else the input sequence will suﬀer from bias. In addition, the input sequences
are phase-aligned by Φ1, which thereby acts as a nuisance parameter, and its uncertainty can still
lead to some representation error due to sequence misalignment. In practice, however, the robustness
of this phase alignment method ensures negligible bias in the input for all but the noisiest and most
ill-sampled light curves.

In addition to the broad optical G waveband, Gaia also acquires simultaneous photometric mea-
In principle, we could use all three time-series as

surements in its bp (blue) and rp (red) ﬁlters.

6

D´ek´any et al.

Figure 1. Cumulative distributions of the S/N of the Gaia light curves in the G, bp, and rp wavebands for
the Galactic RRab stars in the common sample with the OCVS.

6-dimensional sequences (3 magnitudes and their corresponding phases) at the input of the RNN.
However, the bp and rp light curves in the common OCVS–Gaia data set have much lower S/N and
signiﬁcantly less useful data points than their G-band counterparts (Fig. 1). Therefore, they would
mostly add noise to our model, and introducing quality criteria to counter this would shrink the
data set too much. Moreover, bad data points in the diﬀerent bands occur at diﬀerent phases, thus
their independent omission would disrupt the matching phase values across the diﬀerent bands for
the same star, the handling of which would require increased complexity of the RNN model. In view
of the above points, we decided to rely solely on the G-band Gaia light curves in our analysis.

The obtained database of phase-folded, phase-aligned, and cleaned photometric time series was
narrowed down by imposing various criteria for controlling their quality. Light curves with very few
measurements, low S/N , poor phase coverage, and uncertain [Fe/H]I estimates were excluded from
the regressions. We also trimmed outliers beyond the main locus of the period–amplitude–metallicity
distributions. Formally, such criteria can be considered as tunable hyper-parameters whose optimal
values maximize the predictive model’s performance at validation (see Sect. 3.2), and provide a good
trade-oﬀ between data quality and quantity. Our ﬁnal criteria for the development data sets are
summarized below:

Gaia G:

Cϕ > 0.85; S/N > 30; Nep. > 20; Atot. < 1.4; − 2.7 < [Fe/H]I < 0; σ[Fe/H]I < 0.3

(3)

VVV Ks:

Cϕ > 0.9; S/N > 100; Nep. > 100; Atot. < 0.45; − 2.5 < [Fe/H]I; σ[Fe/H]I < 0.15; PBl. < 0.7 (4)

Here, Cϕ denotes the phase coverage (i.e., 1−maximum phase lag), Atot. is the total (peak-to-valley)
amplitude of the GPR light-curve model, Nep. is the number of epochs in the light curve, and σ[Fe/H]I
is the uncertainty in the [Fe/H]I values, estimated from the GPR model of the I-band light curve.
Moreover, PBl. is the probability that a star shows the Blazhko eﬀect (see, e.g., Smolec 2016, for

02004006008001000S/N0.00.20.40.60.81.0cumulative fractionGaia GGaia bpGaia rpPhotometric [Fe/H] of RRab stars in the G and Ks bands by deep learning

7

a review), i.e., a periodic amplitude and/or phase modulation of the light curve according to the
machine-learned classiﬁer of Prudil & Skarka (2017). Our selection criterion excludes stars with
strongly modulated light curves from the Ks development set. Strong phase modulation due to the
Blazhko eﬀect, especially when undersampled, biases the RRab stars’ light-curve shape and thus
aﬀects their photometric metallicity prediction (see, e.g., Nemec et al. 2013; D´ek´any et al. 2021).
Even though the strength of the modulation is generally larger in the optical than in the near-IR
Jurcsik et al. (2018) for the same star, introducing a selection criterion by PBl. for the G-band data,
unlike for the Ks band, did not give any advantage. The much more subtle dependence of the light
curve shape on the metallicity in the Ks band and the highly non-uniform sampling of the VVV
light curves probably both contribute to this behavior. Finally, we note that we imposed limits on
the input metallicity range in order to exclude possibly spurious [Fe/H]I values. The applied limits
trim the lowest 1 percentiles of the distributions and remove only 7 objects with positive I-band
metallicities from the G-band data set.

By applying the selection criteria in Eqs. 3 and 4, we remove most Gaia stars from the crowded
inner bulge where they have generally poor sampling, and exclude most stars from the relatively
small common disk sample of OGLE and VVV, resulting in almost disjunct development data sets
for the G and Ks bands. They comprise 4458 G-band and 7534 Ks-band light curves, which are
shown in Fig. 2. The Bailey (period–amplitude) diagrams of the development data sets are shown in
Fig. 3 with the corresponding [Fe/H]I values color-coded; highlighting the strong correlation of the
period on the metallicity, and the more non-linear structure of this diagram in the near-IR compared
to the optical domain.

Figure 4 shows the [Fe/H]I distributions of these data sets, revealing the strong data imbalance,
which particularly aﬀects the Ks band. Since both data sets predominantly comprise bulge stars,
their metallicity distributions are strongly peaked at around -1.4 dex, with relatively weak tails on
both their metal-rich and metal-poor sides.

In order to handle the data imbalance, we introduced density-dependent sample weights for the
training of our regression model. First, we computed Gaussian kernel density estimates of the [Fe/H]I
distributions, evaluated them for every object in the development sets, and assigned a density weight
wd to each data point by taking the inverse of the estimated normalized density. Additionally,
we introduced density threshold values ρG and ρKs, beyond which uniform wd values are used in
order to prevent an excessive inﬂuence of the relatively few data points in the tails of the [Fe/H]I
distributions in the regression. We treat these thresholds as tunable hyper-parameters, and ﬁnd their
optimal values to be ρG = 0.5 and ρKs = 0.9. In addition, to take the uncertainties in individual
[Fe/H]I values also into account, we introduce wu weights as their normalized squared inverse. The
ﬁnal sample weights are then computed as the product w = wd · wu. Figure 4 shows the distributions
of wd and w for both the Ks- and G-band development sets.

3. PREDICTIVE MODELING

3.1. Long Short-Term Memory Recurrent Neural Networks

Recurrent neural networks (RNNs) encompass a variety of mathematical models that are capable to
accurately approximate extremely complex, highly non-linear interrelations in numerical sequences.
They have been successfully employed for supervised learning scenarios in a wide range of research

8

D´ek´any et al.

Figure 2. Phase-folded, phase-aligned, mean-subtracted light curves of the Ks-band (left) and G-band
(right) development data sets after all pre-processing steps have been applied. Gray dots show all data,
black points highlight the data for a single RRab star. We note that the vertical structures in the left panel
are due to data binning (see text).

Figure 3. Period–amplitude–metallicity distributions of the VVV Ks-band (left) and Gaia G-band (right)
light curves of the RRab stars in our respective development data sets. The metallicity values were estimated
from the I-band light curves of the same objects (see text) and are denoted with a color map shown at the
right side of the ﬁgure.

areas involving sequential data, ranging from neural translation to ﬁnances (see, e.g., Yu et al. 2019,
for a recent review).

0.30.40.50.60.70.80.91.0P[d]0.050.100.150.200.250.300.350.400.45Atot.,Ks0.30.40.50.60.70.80.91.0P[d]0.20.40.60.81.01.21.4Atot.,G2.52.01.51.00.50.0[Fe/H]IPhotometric [Fe/H] of RRab stars in the G and Ks bands by deep learning

9

Figure 4. Distributions of the metallicities of the Ks- (left) and G-band (right) development data sets and
their sample weights. Red bars and blue curves show the histograms and kernel density estimates of the
[Fe/H]I values. Black symbols denote the (normalized) weights computed from the inverse of the density.
Red points show the ﬁnal sample weights.

The simplest type of RNN takes a sequence x<t> at its input, and performs the following recurrent

transformation at every time step t ∈ {1, Tx}:

a<t> = tanh(Waaa<t−1> + Waxx<t> + ba) .
Here, the output a<t> is called the activation of the t-th time step, and the Waa and Wax weight
matrices and ba bias vector are free parameters of the RNN, which are shared across all time steps.
In case of using the RNN for predicting a single real number from each input sequence, the following
operation is performed on the activation vector from the last time step:

(5)

ˆy = (wyaa<Tx> + by) ,
where ˆy is the predicted value of the response variable y, and the wya weight vector and the by bias
term are free parameters of the model.

(6)

The RNN’s complexity can be adjusted to a speciﬁc problem by changing the dimensionality of the
weight matrices (a.k.a. the number of neurons) and hence the dimension of the resulting activation
vectors, and by using multiple recurrent layers. In case of the latter, the input of layer l will be the
sequence of activation vectors a[l−1]<t> computed by the previous layer l −1; each layer will have their
[l] bias vectors, and the prediction will be computed from
own Waa
the activation vector of the last time step of the last layer by Eq. 6. The optimal model parameters of
the RNN are found by minimizing an appropriate cost function, e.g., the mean squared error (MSE)
in case of a regression problem.

[l] weight matrices and ba

[l], Wax

Modern alternatives to the classical RNN architecture outlined in Eq. 5 include modiﬁcations aiming
to increase the speed of training and to enable a better representation of long-term dependencies in
lengthy input sequences. Perhaps the most successful of these has proven to be the Long Short-Term
Memory (LSTM) network originally proposed by Hochreiter & Schmidhuber (1997), which has been

2.52.01.51.00.50.0[Fe/H]I0.00.51.01.52.02.53.0norm. density0.00.20.40.60.81.0weights2.52.01.51.00.50.0[Fe/H]I0.00.20.40.60.81.01.21.4norm. density0.00.20.40.60.81.0weights10

D´ek´any et al.

the primary architecture of choice in a wide spectrum of use cases (see, e.g., Houdt et al. 2020, and
references herein). Recently, LSTMs have been successfully employed in time-domain astronomy for
the classiﬁcation of photometric time series, e.g. to identify RR Lyrae stars (D´ek´any & Grebel 2020)
and detect stellar ﬂares (Vida et al. 2021).

A standard LSTM unit features a memory cell designed to retain information over an arbitrary
number of time steps, and thus enable the network to learn long-term dependencies. It also contains
update, forget, and output gates that regulate the information ﬂow to/from the memory cell and
enable to reset its state. The cell and the gates each have free parameters that are learned by the
model (i.e., ﬁtted to the data). For a more in-depth mathematical discussion of LSTM networks in
the context of astronomical light curves, we refer to D´ek´any & Grebel (2020, see their Eqs. 6–11 and
Fig. 1).

3.2. Model selection and optimization

The optimization of a machine-learned predictive model consists of two fundamental steps, training
and hyper-parameter tuning. During training, the optimal values of a model’s parameters are found
by minimizing a cost function for a training data set. Since the gradients of the cost function can be
explicitly expressed in the case of neural networks, gradient descent-based optimization algorithms
can be employed. The model’s hyper-parameters that govern its complexity, such as the number
of layers and the number of neurons in each of them, along with the data ﬁltering and weighing
thresholds (see Sect. 2), as well as the choice of regularization and its parameter(s) have ﬁxed values
during training. The optimal values of these hyper-parameters are searched for by maximizing a
performance metric for a validation data set that the model has not seen during training.

For training, we used the MSE cost function with sample weights discussed in Sect. 2. In order
to prevent overﬁtting the model to the training set, we experimented with two diﬀerent methods,
namely kernel regularization and dropout. In the former, the J cost function includes a term that is
proportional to the norm of weights that are used for the linear transformation of the input sequence
and/or the recurrent state (i.e., previous activation vector):

J ∝

N
(cid:88)

i=1

(y − ˆy)2 + λ||W|| ,

(7)

where N is the number of training data. The coeﬃcient λ of the weight norm W is called the regu-
larization parameter, which, together with the type of norm used, are handled as hyper-parameters
of the model. In addition, we also employed the dropout (Srivastava et al. 2014) regularization tech-
nique, whereby a random Pd fraction of the activation vectors’ elements are randomly dropped (i.e.,
assigned to 0) during training, with the dropout probability being another hyper-parameter.

The performance metric to be maximized during hyper-parameter tuning should reﬂect how well
the trained model fulﬁlls our expectations on yet unseen data (i.e., the validation set). On the one
hand, we would like to minimize our mean prediction errors, which we formulate as maximizing the
coeﬃcient of determination, i.e., the R2 score:

R2 = 1 −

(cid:80)
(cid:80)

i(yi − ˆyi)2
i(yi − ¯y)2 ,

(8)

Photometric [Fe/H] of RRab stars in the G and Ks bands by deep learning

11

where ¯y is the mean of the response variable in the validation set. The R2 score measures predictive
performance relative to the total variation of the response variable. Its best possible value is 1 (i.e., no
prediction errors), and it can take arbitrarily low values. On the other hand, we expect the predicted
distribution of the metallicity to be as close to the real distribution as possible. In other words, we
want the predictive performance to be homogeneously high across the entire range of metallicities
covered by the development set. We formulate this by minimizing the symmetric diﬀerence measure
between the true and predicted distributions, i.e., their Jensen–Shannon (JS) divergence:

DJS =

1
2

(DKL(P ||M ) + DKL(Q||M )) .

(9)

Here, P and Q are the compared distributions, M = (P + Q)/2, and DKL is the Kullback-Leibler
divergence. The JS divergence is bound to the [0, 1] interval and takes the value of 0 in case the
compared distributions are identical. An optimal value of the R2 metric does not necessarily mean
that DJS takes its optimum as well, in case the predictive performance changes with [Fe/H]. Since the
data imbalance in our regression problem may enhance such a skew in the model’s performance, we
search for the optimal hyper-parameter values by jointly optimizing R2 and DJS, which we achieve
by using their ratio as our custom metric:

M = R2/DJS

(10)

Since our development data sets have modest sizes, a single held-out validation set would signiﬁ-
cantly decrease the diversity of the training data. To avoid this, we could apply k-fold cross validation
(CV) instead, whereby the development set is randomly split into k training and k disjunct validation
sets, a mean performance metric is computed from the predictions on the latter; and the model with
the best set of hyper-parameters is ﬁnally reﬁtted to the entire development set in order to obtain
a single “monolithic” ﬁnal model. Due to the limited amount of data however, this approach can
still be volatile to the distribution changes introduced by the training–validation splits. Firstly, the
same hyper-parameters can lead to signiﬁcant over- or underﬁtting in diﬀerent folds. Secondly, the
true performance of the reﬁtted model can be signiﬁcantly diﬀerent from the performance estimate
from CV due to the reduced data set sizes in the latter. It might even be the case that the optimal
hyper-parameters are diﬀerent for the ﬁnal ﬁt to the development set from the ones found by CV.

A more robust predictive model can be obtained by a modiﬁed approach to k-fold CV. In order to
prevent the model’s volatility to data splitting during each CV fold, we apply the “early stopping”
regularization technique, which is commonly used in deep learning scenarios. During training, we
monitor the model’s performance by evaluating it on both the current training and validation folds
after each training epoch. When overﬁtting occurs, the model’s performance measured on the training
set will keep increasing as the learning algorithm starts to ﬁt the model to the noise pattern of the
training set, while the thus far increasing validation performance will turn over and start to decrease,
due to the model’s poor generalization. We obtain the optimal model for each CV fold by stopping
its training at this turnover point, and estimate its overall performance by the mean M metric across
the folds. Finally, instead of reﬁtting the model with the best hyper-parameters to the development
set as we would in standard k-fold CV, we instead keep the k models and use their mean prediction.
This approach is commonly referred to as training an “early stopped k-fold ensemble” of models,
and is not only more robust than a single monolithic model, but oﬀers the advantage that instead

12

D´ek´any et al.

Figure 5. Schematic architectural graph of our predictive models. Grey boxes represent neural network
(LSTM and dense) units, empty boxes denote their inputs and outputs. The activation vector at the output
of the ﬁrst biLSTM layer is 64 and 32 dimensional for the Ks- and G-band model, respectively.

of providing a point estimate for an input, its prediction’s uncertainty can also be estimated as the
standard deviation of the ensemble’s k predictions.

An extensive grid search of hyper-parameters was performed to ﬁnd the best model ensemble.
We tried one- and two-layer mono- and bidirectional LSTM (biLSTM) architectures with various
numbers of neurons in each. The eﬀect of both L1 and L2 norms were tested in Eq. 7 for the cost
function’s weight penalty (a.k.a. lasso and Tikhonov regularization, respectively), along with a grid
of λ values and dropout probabilities. We trained each model with the Adam optimization algorithm
(Kingma & Ba 2014) with a learning rate of 0.005 until the optimal early stopping epoch was found
(typically after a few thousand epochs). In order to have a suﬃcient number of training examples
from our entire [Fe/H] range, we used a large mini-batch size of 2563.

Figure 5 shows a schematic picture of our best-performing predictive models, while their main
attributes are listed in Table 2. For both the Ks and G bands, they contain two biLSTM layers, and
use L1 regularization on the recurrent weights. In addition, dropout is employed after both the ﬁrst
and second layers.

3 Each training iteration is performed on a mini-batch of training data. During one training epoch, all training data are

used once.

m⟨1⟩−¯mφP⟨1⟩⋅Pm⟨2⟩−¯mφP⟨2⟩⋅Pm⟨3⟩−¯mφP⟨3⟩⋅Pm⟨Nep.⟩−¯mφP⟨Nep.⟩⋅Pinputa→⟨1⟩a→⟨2⟩a→⟨3⟩a→⟨Nep.⟩a←⟨Nep.⟩a←⟨2⟩a←⟨3⟩a←⟨1⟩biLSTM 1concatenate,dropout 1a[2]→a[2]←biLSTM 2concatenate,dropout 2dense^yPhotometric [Fe/H] of RRab stars in the G and Ks bands by deep learning

13

Table 2. Properties of the ﬁnal Ks- and G-band predictive models of the metallicity

Ks-band model

G-band model

Layer

hyper-params.

params.

hyper-params.

params.

biLSTM1 32 neurons, λ = 3 · 10−6 8960
dropout1 Pd = 0.1
biLSTM2 32 neurons, λ = 3 · 10−6 24832
dropout2 Pd = 0.1
dense
Note—The number of neurons refers to a single direction of the network.

16 neurons, λ = 5 · 10−6 2432
Pd = 0.1
16 neurons, λ = 5 · 10−6 6272
Pd = 0.1
–

0
65

0
33

–

0

0

3.3. Regression performance

The regression performance of our ﬁnal model ensembles has been measured using various common
metrics applied on the union of the k-fold validation data sets, except in the case of the R2 metric, for
which the mean was computed. All of these metrics estimate very low generalization error, i.e., high
prediction performance on unseen data. Their values for both the Ks and the G bands are shown
in Table 3, which also includes the same metrics for the training data as reference. The similarity
between the values obtained for the training and validation data sets indicates an excellent bias-
variance tradeoﬀ of the ﬁnal model ensembles. We emphasize that the metrics in Table 3 describe our
model ensembles’ precision in predicting the D21 I-band photometric metallicities. Their accuracy
in predicting the [Fe/H] can be estimated by combining the metrics in Table 3 with those of the
D21 formula. For example, by adding the MAE values in quadrature, we obtain a total nominal
uncertainty of ∼ 0.19 dex.

Figure 6 compares our model ensembles’ [Fe/H] predictions with the metallicities computed from the
corresponding I-band light-curves. The residuals do not show any signiﬁcant structure and contain
only few strong outliers. At the very metal-poor end ([Fe/H] < −2), some Ks-band metallicity
predictions lie out from the main locus with a sizable positive bias for a relatively small number of
stars. Upon the inspection of both their Ks- and I-band light curves, we did not identify peculiarity
in their photometry. It might be possible that a latent physical parameter with a large inﬂuence on
the light-curve shape (such as the He content) is systematically diﬀerent for these objects compared
to the rest of the sample. Another possibility is that the dependency of the Ks light-curve shape on
the [Fe/H] is too complicated at the metal-poor end for our model to accurately learn it from the
available data.

The photometric metallicity distributions predicted by our model ensembles for the training and
validation data sets are directly compared to the I-band photometric metallicities in Fig. 7. For both
wavebands, the predicted distributions are virtually identical to the original ones, not showing any
bias, and even subtle features are accurately recovered, which tallies with their very low DJS values.
We further test the consistency of our models by directly comparing their [Fe/H] predictions with
HDS measurements of RRab stars in the Gaia DR2 catalog. We cross-matched the latter with the
same large spectroscopic sample that was compiled from the literature for the development of our D21

14

D´ek´any et al.

Table 3. Various performance metrics of our
ﬁnal LSTM model ensembles in terms of pre-
dicting the I-band photometric metallicities

Ks-band model G-band model

tr.

tr.

val.

val.

0.93
0.13
0.10
0.18
0.13
0.10

0.84
0.13
0.10
0.15
0.11
0.08
0.004 0.004
218

Metric
R2
0.87
wRMSE 0.12
0.09
wMAE
0.14
RMSE
MAE
0.10
medAE 0.07
DJS
R2/DJS
Note—(w)RMSE:
root mean
squared error; (w)MAE: (weighted) mean
absolute error; medAE: median absolute er-
ror; DJS: Jensen-Shannon divergence

0.96
0.10
0.07
0.15
0.12
0.09
0.001 0.001
956

(weighted)

960

239

I-band photometric metallicity estimator, using the results of Crestani et al. (2021, C21), For et al.
(2011, F11), Chadid et al. (2017, C17), Sneden et al. (2017, S17), Clementini et al. (1995), Fernley
& Barnes (1996), Lambert et al. (1996), Liu et al. (2013), Nemec et al. (2013), Govea et al. (2014),
Pancino et al. (2015), and Andrievsky et al. (2018). The corrections for the systematic [Fe/H]
oﬀsets computed by D21 were applied to these measurements to match the homogeneous scale of
C21+F11+C17+S17. We selected the objects with well-sampled and accurate G-band light curves,
which resulted 213 individual data points of 60 unique objects, 28 with single and 32 with multiple
HDS [Fe/H] measurements. We note that this data set largely overlaps the one used for calibrating the
D21 predictive formula, but is too small and imbalanced for a reliable direct calibration of a similar
formula for the G band. Figure 8 compares the predicted [Fe/H]G values with the corresponding
individual HDS measurements. The two sets of values are in good agreement, showing no systematics
in their residual, and their scatter is consistent with the prediction uncertainties measured on the
validation data set (c.f. Fig 6). This important cross-check indicates the pertinence of our underlying
assumption about the physical similarity between the HDS training set of the D21 formula and the
development data set of our LSTM model, thus supporting the consistency of our approach.

4. PHOTOMETRIC METALLICITY CATALOGS

As the ﬁnal goal of this study, we computed photometric metallicities for a large number of RRab
stars by deploying the neural networks developed in Sect. 3 on the photometric databases of the Gaia
and VVV surveys.

4.1. G-band photometric metallicities of the Gaia DR2 RRab stars

We analyzed the G-band light curves of all 98024 RRab stars in the Gaia DR2 RR Lyrae catalog
following the same procedure that was applied on the development set, as described in Sect. 2. We

Photometric [Fe/H] of RRab stars in the G and Ks bands by deep learning

15

Figure 6. Predicted vs true photometric metallicities from the best-performing predictive models for the
Ks (left) and G (right) wavebands. The top and bottom panels show the full training and validation data
sets, respectively. The red lines denote the identity function.

adopted the periods and type classiﬁcations from Clementini et al. (2019). Our predictive model was
applied to all light curves that passed the following quality criteria: C > 0.85; S/N > 30; Nep. >
20; Atot. < 1.4, resulting in a target set of 58652 RRab stars. Their metallicity estimates, along with
various photometric attributes, are presented in Table 4. The sample is dominated by halo stars,
with additional large samples contributing to it from the Magellanic Clouds, the bulge, and the Milky
Way’s thick disk.

In our D21 study, we have shown that several earlier methods for metallicity estimation are aﬀected
by systematic positive biases with respect to our new I-band [Fe/H] prediction formula, which is
directly calibrated to modern HDS measurements. Since the neural networks in this study were

16

D´ek´any et al.

Ks band

G band

Figure 7. Histograms of the true (red) and predicted (gray) [Fe/H] values from our Ks- and G-band model
ensembles for the training (T, left) and validation (V, right) data sets. The upper and lower panels show
the histograms on logarithmic and linear scales, respectively.

Figure 8. G-band mean [Fe/H] predictions of 60 RRab stars by our LSTM model ensemble plotted against
the individual HDS metallicity measurements of the same objects. The red line denotes the identity function.

trained on I-band photometric metallicities obtained with the latter, we can expect to see similar
diﬀerences between our model predictions and other G-band [Fe/H] estimates from the literature.

We directly compared our results to metallicities published in the Gaia DR2 RR Lyrae catalog by
Clementini et al. (2019) ([Fe/H]DR2), which were available for 43681 objects in our target set. These
estimates are based on the quadratic formula by Nemec et al. (2013), which relates the metallicity to
the period and the φ31 Fourier parameter in the Kepler photometric waveband, and was calibrated on
a tiny sample of 27 HDS measurements. To apply it to G-band light-curve parameters, Clementini

3.02.52.01.51.00.50.00.5[Fe/H]HDS3.02.52.01.51.00.50.00.5[Fe/H]GPhotometric [Fe/H] of RRab stars in the G and Ks bands by deep learning

17

et al. (2019) performed two successive linear transformations of the G-band φ31 parameters, convert-
ing them ﬁrst to the V band, and from there to the Kepler band. The left panel of Fig 9 confronts
the [Fe/H]G values from our study with their [Fe/H]DR2 equivalents. The latter are aﬀected by a very
large positive bias, and the residual strongly correlates with the period, with long-periodic stars hav-
ing extreme biases of up to ∼ 2 dex. In addition, the distribution shows a clump of metal-rich stars
standing out from the main locus that correspond to a metal-rich tail of the [Fe/H]G distribution,
but remains blended with the rest of the [Fe/H]DR2 sample due to its aforementioned bias.

To improve the quality of RR Lyrae metallicity estimation from Gaia photometry, Iorio & Belokurov
(2020, IB20) ﬁtted a linear relation to the pulsation period and the G-band φ31 Fourier parameter
using 84 stars with [Fe/H] values adopted from Layden (1994). The latter were derived from low-
resolution spectral indices using a linear formula that was calibrated to early HDS measurements of
a handful of ﬁeld and cluster RRab stars. We note that the same Layden (1994) sample, with slight
adjustments, forms partly the basis of the widely used photometric metallicity prediction formulae
of Jurcsik & Kov´acs (1996) and Smolec (2005). In the middle panel of Fig. 9, we compare the IB20
metallicities with our [Fe/H]G estimates for the same set of stars as for our previous comparison.
They show a much better agreement with our results than the [Fe/H]DR2 values, especially at the
metal-rich end, and instead of the huge positive bias observed in the case of DR2 metallicities of
long-periodic, metal-poor stars, we see a smaller, but still quite large bias in the opposite, negative
direction. Overall, the IB20 formula also overestimates the metallicities with respect to our model,
with a positive bias of up to 0.2–0.3 dex at the center of the distribution. The particularly poor DR2
and IB20 predictions at the long-periodic, metal-poor limit can probably be attributed mainly to the
lack of such stars in the data sets used to calibrate those formulae.

Finally, we compare the photometric metallicity distributions using all three methods in the right
panel of Fig. 9, revealing large systematic diﬀerences between them.
In addition to large oﬀsets
between their centers, their shapes are also remarkably diﬀerent. Our distribution features a long
metal-rich tail, which is absent from the DR2 MDF, and only slightly apparent in the IB20 MDF,
because it blends with the bulk of the distributions due to the positive bias dominating the latter.

Figure 10 shows the celestial distribution of our target set, with the predicted [Fe/H]G values color-
coded. The stars in the metal-rich tail of the MDF lie in close proximity of the Galactic plane, while
the high-latitude halo sample and the Magellanic Clouds contribute with the most metal-poor stars.
A positive gradient in the mean metallicity from the halo towards the center of the bulge is also
apparent. Notably, the metallicities of the stars constituting the metal-rich tail are the ones that
show the best correlation between our predictions and those from both DR2 and IB20 (albeit with
an oﬀset in the former case; c.f. the left and middle panels of Fig. 9). This is probably due to the
fact that the training data sets used for ﬁtting the latter two relations comprise similar objects from
the Solar neighborhood.

The distributions in Fig. 9, and thus their modes are dominated by halo objects. To obtain simple
estimates of the median halo metallicity, we cross-matched our sample with the RR Lyrae stars in
the bulge and Magellanic Clouds listed in the OCVS, and excluded all matches within 1(cid:48)(cid:48), resulting
in a reduced sample of ∼ 33000 objects. Since the OCVS is a highly complete catalog, this simple
approach leaves us with only a small contamination of disk RRab stars, which does not signiﬁcantly
aﬀect the accuracy in terms of estimating the mode of the halo RRab MDF. To measure the latter, we
computed kernel density estimates of the MDFs and determined their maxima. Our estimates of the

18

D´ek´any et al.

Figure 9. Photometric metallicities predicted by our model ensemble ([Fe/H]G) for the G-band target
data set, plotted against the corresponding metallicity estimates from the Gaia DR2 RR Lyrae catalog
([Fe/H]DR2, left), and by the IB20 formula ([Fe/H]IB20, middle). The pulsation periods are color-coded,
the red line denotes the identity function. Right: histograms and corresponding kernel density estimates of
the same data set as in the left and middle panels. Green: [Fe/H]G estimates from this work, blue: IB20
metallicities, red: [Fe/H] values from the DR2 RR Lyrae catalog.

median [Fe/H] of the halo obtained in this way is −1.67 dex using our predictive model, −1.43 dex
using the IB20 formula, and −1.04 dex according to the DR2 RR Lyrae catalog. Our results are in
good agreement with pertinent studies of the inner halo MDF using main-sequence stars by An et al.
(2013) and Youakim et al. (2020), while the IB20 and DR2 values both show signiﬁcant positive bias.

4.2. Ks-band photometric metallicities of the VVV inner bulge RRab stars
The Ks-band predictive model ensemble was deployed on the catalog of RRab stars in the inner
bulge area of the VVV survey discovered by D´ek´any & Grebel (2020, D20). These objects have
not been detected by the OGLE survey covering the same area due to extremely high interstellar
extinction. Our target data set comprises the public Ks-band light curves of all 4446 RRab stars in the
D20 catalog, processed according to Sect. 2. The resulting photometric parameters and metallicity
estimates are displayed in Table 5.

The right panel of Figure 11 shows the resulting metallicity distribution of the inner bulge RRab
stars, compared to the distribution of the D21 I-band [Fe/H] estimates of our development data set.
The two distributions are very similar with their modes at −1.35 and −1.36 dex, respectively, showing
a smooth continuation of the bulge MDF toward low Galactic latitudes. The ﬁgure also indicates
the accuracy of both our model ensemble developed in this study, and the D20 deep-learned RRab
light-curve classiﬁer. We can observe minor diﬀerences between the two MDFs in their metal-rich and
metal-poor tails. The MDF of the development set shows a very slightly enhanced metal-poor tail.
Based on the OCVS only, a similar diﬀerence between the inner and outer bulge’s MDF was noted
by D21. The MDF of the D20 inner bulge sample also features a slightly more enhanced metal-rich
tail, which can be expected, since it covers lower Galactic latitudes, where the relative fraction of
metal-rich stars of the thick disk is higher. Figure 12 shows the celestial distribution of the target
data set with the [Fe/H]Ks predictions color-coded. Around the Galactic equator, the distribution is
dominated by incompleteness due to thick interstellar dust that remains impenetrable for the VISTA

3.02.52.01.51.00.50.00.5[Fe/H]0.00.20.40.60.81.01.21.4Normalized densitythis workDR2IB20Photometric [Fe/H] of RRab stars in the G and Ks bands by deep learning

19

Figure 10. Celestial distribution of the target data set of our Gaia G-band photometric metallicity estimator
in the Galactic coordinate system. The predicted [Fe/H]G values are color-coded.

telescope even at two microns. The few stars detected around the Galactic Center sight-line are in
fact mostly metal-rich stars in the foreground disk. We note that the linear patterns on the northern
side are gaps between OGLE ﬁelds, where RRab stars that remained previously undiscovered by
OGLE were detected in VVV data. The slight overdensity at (l, b) ∼ (9, −1) is due to an extinction
window where faint metal-rich disk RRab stars behind the bulge are detected. Together with the
OCVS RRab stars (for which the I-band [Fe/H] estimates in Table 1 are preferred), this sample
provides an unbiased, homogeneous sample of photometric metallicities.

Finally, we compare our results with another method for metallicity estimation from Ks-band light
curves, that was published by Hajdu et al. (2018, H18). Following an approach similar to our study,
they developed a fully connected neural network to predict the [Fe/H] of RRab stars from a 4-
parameter representation of their light curves. In the latter, the phase-folded light curves were ﬁtted
with a linear combination of 4 eigenvectors obtained from a principal component analysis, and the
neural network made its predictions from these 4 regression coeﬃcients. The model was trained on
I-band photometric metallicities obtained by the formula of Smolec (2005). Since the latter has a
positive bias with respect to our D21 formula (see D´ek´any et al. 2021), we can expect that the H18
model will also output systematically higher predictions compared to our LSTM neural network. We
verify this by directly comparing our [Fe/H]Ks predictions to those computed by the H18 model for
the target data set, shown in the left panel of Fig. 11. The [Fe/H]H18 estimates have a positive bias
of 0.4 dex on average, with a signiﬁcant structure in the residual. The inner bulge MDF obtained by
the H18 model is shown with blue in the right panel of Fig. 11. Similarly to the G-band DR2 and
IB20 estimates, the metal-rich tail of the distribution is not recovered, due to its blending with the

20

D´ek´any et al.

Table 4. G-band photometric metallicity estimates and basic light-curve attributes of Gaia DR2
RRab stars

(cid:104)G(cid:105)

a σ([Fe/H]G)b
0.04
0.03
0.02
0.17
0.03

Gaia DR2 source id [Fe/H]G
11977018818239872 −1.73
11991514330833408 −2.01
36039689056047872 −1.45
36110989810386560 −2.10
36246122364621440 −1.71
aMean of predictions from a model ensemble.
bStandard deviation of predictions from a model ensemble.
Note—This table is available in its entirety in machine-readable form.

Nep. Period [d] Atot.
0.903
0.515610
38
0.824
0.564529
36
0.570
0.600486
29
0.775
0.607803
29
0.893
0.542566
30

16.708
18.929
19.131
18.246
18.904

Cϕ
0.881
0.923
0.880
0.901
0.886

S/N

125.5
152.0
108.0
43.2
177.9

Table 5. Ks-band photometric metallicity estimates and basic light-curve attributes of the VVV bulge RRab stars
discovered by D´ek´any & Grebel (2020)

c σ([Fe/H]Ks)d

17:05:27.27
17:06:58.67
17:07:41.14
17:08:58.02
17:10:26.66

IDa R.A.b [hms] DEC.b [dms]
[Fe/H]Ks
-34:33:50.9
7
−1.27
-34:59:07.7
27
−0.40
-34:18:33.7
36
−1.48
-33:40:19.8
64
−1.81
-35:14:50.0
108
−1.30
aIdentiﬁer from D´ek´any & Grebel (2020).
bCoordinates of J2000.0 epoch.
cMean of predictions from a model ensemble.
dStandard deviation of predictions from a model ensemble.
Note—This table is available in its entirety in machine-readable form.

0.07
0.05
0.05
0.12
0.02

(cid:104)Ks(cid:105) Nep. Period [d] Atot.
0.171
14.657
0.245
15.538
0.157
14.421
0.143
14.808
0.181
14.573

0.643188
0.440602
0.769114
0.737811
0.632416

117
64
64
65
65

Cϕ
0.939
0.938
0.933
0.915
0.924

S/N

78.5
56.8
82.2
46.3
91.8

distribution’s overestimated mode. The MDF is also wider due to the signiﬁcantly higher scatter of
the H18 predictions.

5. SUMMARY AND CONCLUSIONS

In this study, we have provided a new method for the estimation of the metallicity of RRab stars
from their Gaia G-band and near-infrared Ks-band light curves. In our approach, we have leveraged
deep learning to accurately transfer a carefully calibrated photometric [Fe/H] prediction formula to

Photometric [Fe/H] of RRab stars in the G and Ks bands by deep learning

21

Figure 11. Left: photometric metallicities predicted by our model ensemble ([Fe/H]Ks) for the Ks-band
target data set, plotted against metallicity estimates by the H18 method ([Fe/H]H18). The pulsation periods
are color-coded, the red line denotes the identity function. Right: histograms and corresponding kernel
density estimates of [Fe/H]Ks (green) and [Fe/H]H18 (blue) values for the target data set, and [Fe/H]I values
for the development data set (gray).

Figure 12. Celestial distribution of the target data set of our Gaia Ks-band photometric metallicity
estimator in the Galactic coordinate system. The predicted [Fe/H]Ks values are color-coded.

3.02.52.01.51.00.50.00.5[Fe/H]0.00.51.01.52.02.5Normalized density[Fe/H]Ks[Fe/H]I[Fe/H]H1822

D´ek´any et al.

additional wavebands at the cost of minimal additional noise. To achieve this, we used the I-band
D21 formula, which had been calibrated to HDS metallicities, to compute photometric metallicities
for a large number of objects that also have light curves in the G and/or Ks bands. Subsequently,
these metallicities served as response variables in separate regression problems of the G and Ks light
curves, solved by state-of-the-art recurrent neural networks. The resulting model ensembles have
very high predictive performance measured by cross-validation, with a (weighted) mean absolute
error of only 0.1 dex in predicting the I-band photometric metallicities. They are also able to recover
the metallicity distributions of the validation data sets without bias, demonstrating that our models
generalize well to new data.

Comparing our results with predictions of various other methods from the literature, we found
that earlier methods generally overestimate the metallicity with respect to the D21 formula, and
consequently the LSTM models of this study, which were trained on [Fe/H]I values from the former.
Systematic errors in earlier photometric [Fe/H] formulae resulted in positive biases of (cid:38) 0.4 dex
and (cid:38) 0.25 dex in the modes of the bulge’s and the halo’s MDFs, respectively. We found that the
[Fe/H] values provided with the Gaia DR2 RR Lyrae catalog are particularly discrepant. We suspect
that these disagreements stem from multiple sources, including biases in regressions due to small and
imbalanced calibration data sets, in the transformations of Fourier parameters between wavebands,
and in the low-resolution spectroscopic determinations of the metallicity used for the calibration of
most of the earlier methods.

We deployed our predictive models to compute the [Fe/H] for numerous Galactic RRab stars ob-
served by the OGLE, Gaia, and VVV surveys. The resulting catalogs of photometric metallicities
are provided in the electronic versions of Tables 1, 4, and 5, and can be directly incorporated in var-
ious future studies of Galactic archeology. We also make our software code (D´ek´any 2022b) publicly
available online4, in order to facilitate the further deployment of the neural networks, as well as to
allow their eventual re-training and further optimization on other data sets.

The approach of metallicity estimation presented in this paper should be easily applicable in the
future to other surveys as well, provided that large enough data sets with well-sampled light curves
in multiple photometric wavebands are available for training the neural networks. We also anticipate
that the upcoming Gaia data releases will have improved light-curve sampling and accuracy, and they
will include many more RR Lyrae stars, allowing the future improvement of our models’ predictive
performance. Upon the availability of these data releases, the timely update of our method will be
straightforward by retraining our published neural networks on the new data sets.

Our photometric prediction method makes it straightforward to obtain consistent metallicities for
very large combined samples of RRab stars, spanning across the footprints of various sky surveys
conducted in diﬀerent wavebands. The resulting homogeneous metallicity estimates, combined with
astrometric or photometric distances, make RRab stars outstanding chemo-dynamical tracer objects
in the era of data-driven astronomy.

1

2

The authors were supported by the Deutsche Forschungsgemeinschaft (DFG, German Research Foun-
dation) – Project-ID 138713538 – SFB 881 (“The Milky Way System”, subproject A03).

4 https://zenodo.org/record/6576131

Photometric [Fe/H] of RRab stars in the G and Ks bands by deep learning

23

Software: numpy (Harris et al. 2020), scipy (Virtanen et al. 2020), scikit-learn (Pedregosa et al.

2011), TensorFlow (Abadi et al. 2015), lcﬁt (D´ek´any 2022a), rrl feh nn (D´ek´any 2022b)

REFERENCES

Abadi, M., Agarwal, A., Barham, P., et al. 2015,
TensorFlow: Large-Scale Machine Learning on
Heterogeneous Systems.
https://www.tensorﬂow.org/

An, D., Beers, T. C., Johnson, J. A., et al. 2013,

ApJ, 763, 65, doi: 10.1088/0004-637X/763/1/65
Andrievsky, S., Wallerstein, G., Korotin, S., et al.
2018, Publications of the Astronomical Society
of the Paciﬁc, 130, 024201,
doi: 10.1088/1538-3873/aa9783
Bhardwaj, A. 2022, arXiv e-prints,

arXiv:2202.06982.
https://arxiv.org/abs/2202.06982

Chadid, M., Sneden, C., & Preston, G. W. 2017,

The Astrophysical Journal, 835, 187,
doi: 10.3847/1538-4357/835/2/187

Clementini, G., Carretta, E., Gratton, R., et al.
1995, The Astronomical Journal, 110, 2319,
doi: 10.1086/117692

Clementini, G., Ripepi, V., Molinaro, R., et al.
2019, Astronomy & Astrophysics, 622, A60,
doi: 10.1051/0004-6361/201833374

Crestani, J., Fabrizio, M., Braga, V. F., et al.

2021, ApJ, 908, 20,
doi: 10.3847/1538-4357/abd183

D´ek´any, I. 2022a, lcﬁt: A python package for the

regression of periodic time series, 1.0.0, Zenodo,
doi: 10.5281/ZENODO.6576222

—. 2022b, rrl feh nn: Deep-learned metallicity
estimation of RR Lyrae-type pulsating stars
from their G and Ks light curves, 1.0.0, Zenodo,
doi: 10.5281/ZENODO.6576131

D´ek´any, I., Grebel, E. K., & Pojma´nski, G. 2021,
ApJ, 920, 33, doi: 10.3847/1538-4357/ac106f

D´ek´any, I., & Grebel, E. K. 2020, The

Astrophysical Journal, 898, 46,
doi: 10.3847/1538-4357/ab9d87

Emerson, J. P., Irwin, M. J., Lewis, J., et al. 2004,
in Society of Photo-Optical Instrumentation
Engineers (SPIE) Conference Series, Vol. 5493,
Optimizing Scientiﬁc Return for Astronomy
through Information Technologies, ed. P. J.
Quinn & A. Bridger, 401–410,
doi: 10.1117/12.551582

Fernley, J., & Barnes, T. G. 1996, Astronomy &

Astrophysics, 312, 957. http://adsabs.harvard.
edu/abs/1996A%26A...312..957F

For, B.-Q., Sneden, C., & Preston, G. W. 2011,
The Astrophysical Journal Supplement Series,
197, 29, doi: 10.1088/0067-0049/197/2/29

Govea, J., Gomez, T., Preston, G. W., & Sneden,
C. 2014, The Astrophysical Journal, 782, 59,
doi: 10.1088/0004-637X/782/2/59

Hajdu, G., D´ek´any, I., Catelan, M., & Grebel,

E. K. 2020, Experimental Astronomy, 49, 217,
doi: 10.1007/s10686-020-09661-0

Hajdu, G., D´ek´any, I., Catelan, M., Grebel, E. K.,
& Jurcsik, J. 2018, The Astrophysical Journal,
857, 55, doi: 10.3847/1538-4357/aab4fd

Harris, C. R., Millman, K. J., van der Walt, S. J.,

et al. 2020, Nature, 585, 357,
doi: 10.1038/s41586-020-2649-2

Hochreiter, S., & Schmidhuber, J. 1997, Neural

Computation, 9, 1735,
doi: 10.1162/neco.1997.9.8.1735

Houdt, G. V., Mosquera, C., & N´apoles, G. 2020,

Artiﬁcial Intelligence Review, 1

Iorio, G., & Belokurov, V. 2020, arXiv e-prints,

2008, arXiv:2008.02280. http://adsabs.harvard.
edu/abs/2020arXiv200802280I

Jurcsik, J., Hajdu, G., D´ek´any, I., et al. 2018,

MNRAS, 475, 4208, doi: 10.1093/mnras/sty112

Jurcsik, J., & Kov´acs, G. 1996, Astronomy &

Astrophysics, 312, 111

Kingma, D. P., & Ba, J. 2014, arXiv e-prints,

arXiv:1412.6980.
https://arxiv.org/abs/1412.6980

D´ek´any, I., Hajdu, G., Grebel, E. K., et al. 2018,

The Astrophysical Journal, 857, 54,
doi: 10.3847/1538-4357/aab4fa

Lambert, D. L., Heath, J. E., Lemke, M., & Drake,
J. 1996, The Astrophysical Journal Supplement
Series, 103, 183, doi: 10.1086/192274

24

D´ek´any et al.

Layden, A. C. 1994, The Astronomical Journal,

108, 1016, doi: 10.1086/117132

Liu, S., Zhao, G., Chen, Y.-Q., Takeda, Y., &
Honda, S. 2013, Research in Astronomy and
Astrophysics, 13, 1307,
doi: 10.1088/1674-4527/13/11/003

Minniti, D., Lucas, P. W., Emerson, J. P., et al.

2010, \na, 15, 433,
doi: 10.1016/j.newast.2009.12.002

Mullen, J. P., Marengo, M., Mart´ınez-V´azquez,

C. E., et al. 2021, ApJ, 912, 144,
doi: 10.3847/1538-4357/abefd4

Nemec, J. M., Cohen, J. G., Ripepi, V., et al.
2013, The Astrophysical Journal, 773, 181,
doi: 10.1088/0004-637X/773/2/181

Ngeow, C.-C., Yu, P.-C., Bellm, E., et al. 2016,

The Astrophysical Journal Supplement Series,
227, 30, doi: 10.3847/1538-4365/227/2/30
Pancino, E., Britavskiy, N., Romano, D., et al.

2015, Monthly Notices of the Royal
Astronomical Society, 447, 2404,
doi: 10.1093/mnras/stu2616

Pedregosa, F., Varoquaux, G., Gramfort, A., et al.
2011, Journal of Machine Learning Research,
12, 2825

Prudil, Z., & Skarka, M. 2017, MNRAS, 466,

2602, doi: 10.1093/mnras/stw3231

Savino, A., Koch, A., Prudil, Z., Kunder, A., &
Smolec, R. 2020, Astronomy & Astrophysics,
641, A96, doi: 10.1051/0004-6361/202038305
Skowron, D. M., Soszy´nski, I., Udalski, A., et al.

2016, Acta Astronomica, 66, 269. http:
//adsabs.harvard.edu/abs/2016AcA....66..269S

Smolec, R. 2005, Acta Astronomica, 55, 59
Smolec, R. 2016, in 37th Meeting of the Polish
Astronomical Society, ed. A. R´o˙za´nska &
M. Bejger, Vol. 3, 22–25.
https://arxiv.org/abs/1603.01252

Sneden, C., Preston, G. W., Chadid, M., &

Adam´ow, M. 2017, \apj, 848, 68,
doi: 10.3847/1538-4357/aa8b10

Soszy´nski, I., Udalski, A., Wrona, M., et al. 2019,

Acta Astronomica, 69, 321,
doi: 10.32023/0001-5237/69.4.2

Srivastava, N., Hinton, G., Krizhevsky, A.,

Sutskever, I., & Salakhutdinov, R. 2014, Journal
of Machine Learning Research, 15, 1929.
http://jmlr.org/papers/v15/srivastava14a.html
Tanakul, N., & Sarajedini, A. 2018, MNRAS, 478,

4590, doi: 10.1093/mnras/sty1311

Udalski, A., Szyma´nski, M. K., & Szyma´nski, G.

2015, Acta Astronomica, 65, 1. http:
//adsabs.harvard.edu/abs/2015AcA....65....1U
Vida, K., B´odi, A., Szklen´ar, T., & Seli, B. 2021,

A&A, 652, A107,
doi: 10.1051/0004-6361/202141068

Virtanen, P., Gommers, R., Oliphant, T. E., et al.

2020, Nature Methods, 17, 261,
doi: 10.1038/s41592-019-0686-2

Youakim, K., Starkenburg, E., Martin, N. F.,

et al. 2020, MNRAS, 492, 4986,
doi: 10.1093/mnras/stz3619

Yu, Y., Si, X., Hu, C., & Zhang, J. 2019, Neural

Computation, 31, 1235,
doi: 10.1162/neco a 01199

