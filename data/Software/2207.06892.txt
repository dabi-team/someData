2
2
0
2

l
u
J

4
1

]

C
O
.
h
t
a
m

[

1
v
2
9
8
6
0
.
7
0
2
2
:
v
i
X
r
a

Approximation of the value function
for optimal control problems on stratiﬁed domains

Simone Cacace∗

Fabio Camilli †

July 15, 2022

Abstract

In optimal control problems deﬁned on stratiﬁed domains, the dynamics and the running cost
may have discontinuities on a ﬁnite union of submanifolds of RN . In [8, 5], the corresponding
value function is characterized as the unique viscosity solution of a discontinuous Hamilton-
Jacobi equation satisfying additional viscosity conditions on the submanifolds. In this paper,
we consider a semi-Lagrangian approximation scheme for the previous problem. Relying on a
classical stability argument in viscosity solution theory, we prove the convergence of the scheme
to the value function. We also present HJSD, a free software we developed for the numerical
solution of control problems on stratiﬁed domains in two and three dimensions, showing, in var-
ious examples, the particular phenomena that can arise with respect to the classical continuous
framework.

Key-words: Optimal control, discontinuous dynamics, stratiﬁed domain, Hamilton-Jacobi equa-
tion, viscosity solution, semi-Lagrangian scheme, convergence.

MSC: 49L20, 49L25, 35F21, 49M25.

1

Introduction

For discontinuous control problems, the deﬁnition of viscosity solution is, in general, not suﬃcient
to guarantee the characterization of the value function as the unique solution of the corresponding
Hamilton-Jacobi equation. Hence, the goal is both to ﬁnd suﬃcient conditions and to appropriately
modify the deﬁnition of viscosity solution in order to recover the previous property (see for example
[3, 4, 10, 16, 20]).
In the seminal paper [8], Bressan and Hong introduced a class of optimal control problems deﬁned
on stratiﬁed domains; namely, the state space RN admits a stratiﬁcation given by a disjoint union
of submanifolds of RN where the controlled dynamics and running cost may have discontinuities.

∗Dipartimento di Matematica e Fisica, Universit`a Roma Tre, Largo S. Leonardo Murialdo 1, 00146 Roma (Italy).

Email: cacace@mat.uniroma3.it

†Dipartimento di Scienze di Base e Applicate per l’Ingegneria, Universit`a di Roma “La Sapienza”, via Scarpa 16,

00161 Roma (Italy). Email: fabio.camilli@uniroma1.it

1

 
 
 
 
 
 
Uniqueness of solutions is obtained by adding diﬀerential conditions to the notion of viscosity so-
lution in the tangent direction to the submanifolds of the stratiﬁcation. Then, the problem was
studied in detail by Barles and Chesseigne [5] who provided, under natural regularity and con-
trollability assumptions for the data of the problem, a Comparison Principle and a stability result
for semicontinuous sub and supersolutions of stratiﬁed Hamilton-Jacobi equations (see [6] for a
complete account).
In this paper, we study a semi-Lagrangian scheme for the approximation of stationary Hamilton-
Jacobi equations on ﬂat stratiﬁed domains. This type of schemes, together with ﬁnite diﬀerences
ones, constitute a classical method to approximate the viscosity solution of a Hamilton-Jacobi
equation (see [14]). Their convergence to the value function is usually demonstrated through the
semi-relaxed limits technique introduced in [7], which has, as its fundamental ingredient, the Com-
parison Principle.
As usual for semi-Lagrangian schemes, the considered approximation scheme is based on the con-
trollistic interpretation of the problem and, in particular, it takes into account the control problems
deﬁned on each submanifold. We ﬁrst prove existence and uniqueness of the solution to the discrete
problem. Then, to prove its convergence, we follow the classical approach in [7], and we show that
the scheme is consistent in viscosity sense not only with the Hamilton-Jacobi equation deﬁned on
all RN , but also with the tangential Hamilton-Jacobi equations deﬁned on the submanifolds of the
stratiﬁcation. In this way, the semi-relaxed limits of the sequence of the discrete solutions satisfy
the additional conditions for stratiﬁed viscosity solutions introduced in [8, 5], and the uniform con-
vergence of the scheme is a consequence of the Comparison Principle.
To our knowledge, the approximation of Hamilton-Jacobi equations on stratiﬁed domains has never
been studied before. Nevertheless, the problem has some similarities with Hamilton-Jacobi equa-
tions on networks, where the dynamics and running cost can jump across the vertices. Approxima-
tion schemes for these problems have been considered for example in [11, 15, 17]. In particular, in
[12], it is considered a semi-Lagrangian scheme which has some similarities with the proposed one.
In this paper, we pay particular attention to the algorithm for solving the approximation scheme,
and to the qualitative analysis of the corresponding numerical tests, revealing new and in some
ways unexpected phenomena with respect to the case of continuous Hamilton-Jacobi equations. To
this end, we implemented the ﬁrst release of HJSD, a free and standalone software which is able to
solve optimal control problems on stratiﬁed domains in two and three dimensions. The program
accepts, as input, simple and suitably formatted text ﬁles, containing all the relevant information
on the stratiﬁcation and the related control problems. Then it writes in output a standard vtk ﬁle
containing the computed solution and the optimal controls of the problem, that can be eﬀectively
visualized by classical vtk viewers, such as Paraview.
Both theory and numerics presented in this work can be extended in several directions, including
more general Hamiltonians, time dependent equations and non ﬂat stratiﬁcations approximated by
unstructured meshes. We plan to address these topics in a forthcoming paper.

The paper is organized as follows. In Section 2, we brieﬂy introduce the optimal control problem
and recall the main theoretical results. In Section 3, we describe the approximation scheme and
prove its convergence to the value function of the optimal control problem. Section 4 contains
some information on the HJSD software developed for the solution of Hamilton-Jacobi equations
on stratiﬁed domains. Finally, in Section 5, we present some numerical tests in two and three
dimensions, and further comments on the problem.

2

2 Hamilton-Jacobi equations on stratiﬁed domains

We brieﬂy recall the theory of Hamilton-Jacobi equations on stratiﬁed domains which has been
developed in [8, 5] (see also [6, Chapter 21]). We only consider the case of a ﬂat stratiﬁcation, i.e.
when disjoint submanifolds of RN are locally aﬃne subspace.

Deﬁnition 2.1. We say that M = (Mk)k=0,...,N is an Admissible Flat Stratiﬁcation (AFS in short)
if, for k = 0, . . . , N , it holds:

(i) For any x ∈ Mk, there exists r > 0 and Vk, a k-dimensional linear subspace of RN , such that

B(x, r) ∩ Mk = B(x, r) ∩ (x + Vk) .

Moreover B(x, r) ∩ Ml = ∅ if l < k.

(ii) If Mk ∩ Ml (cid:54)= ∅ for some l > k then Mk ⊂ Ml.

(iii) Mk ⊂ M0 ∪ M1 ∪ · · · ∪ Mk.

In the case k = 0, Vk = {0} and (i) implies that the set M0, if not void, consists of isolated

points.
We deﬁne a control problem associated to a diﬀerential inclusion. Let BCL : RN → P(RN +2) be
a set-valued map satisfying

[H0] The map x (cid:55)→ BCL(x) has compact, convex images and is upper semi-continuous;

[H1] There exists M > 0, such that for any x ∈ RN ,

BCL(x) ⊂ (cid:8)(b, c, (cid:96)) ∈ RN +2 : |b| ≤ M ; |c| ≤ M ; |(cid:96)| ≤ M (cid:9) .

Assumption [H1] implies that the data of the control problem are uniformly bounded. We consider
the diﬀerential inclusion

(X, C, L)(s) ∈ BCL(cid:0)X(s)(cid:1) for a.e. s ∈ [0, t) ,

and (X, C, L)(0) = (x, 0, 0) .

d
dt

Under the previous assumptions on BCL, given x ∈ RN , there exists a Lipschitz function (X, C, L) :
R+ → RN +2 which is a solution of this diﬀerential inclusion and, for almost any s, ( ˙X, ˙C, ˙L)(s) =
(b, c, (cid:96))(s) for some (b, c, (cid:96))(s) ∈ BCL(X(s)). Here b, c and (cid:96) represent, respectively the dynamics,
the discount factor and the running cost associated to the control problem.
The value function of the control problem is deﬁned by
(cid:110) (cid:90) ∞

(cid:111)

U(x) =

inf
(X,C,L)∈T (x)

0

e−C(t)L(t) dt

,

where T (x) stands for all the Lipschitz trajectories (X, C, L) of the diﬀerential inclusion which start
at (x, 0, 0) . The Hamiltonian associated to the previous control problem is given by

H(x, r, p) =

sup
(b,c,(cid:96))∈BCL(x)

(cid:8) − b · p + cr − (cid:96)(cid:9) .

(2.1)

3

The assumptions on the map BCL implies that H is upper semi-continuous (w.r.t. all variables)
and is convex and Lipschitz in p. The notion of viscosity solution is not suﬃcient to characterize
the value function U as the unique viscosity solution of the Hamilton-Jacobi equation

H(x, u, Du) = 0

on RN

(2.2)

and additional conditions for subsolutions on the discontinuity set have to be introduced. For
k = 0, . . . , N , we introduce the Hamiltonian H k on Mk

H k(x, r, p) =

sup
(b,c,l)∈BCL(x)
b∈TxMk

(cid:8) − b · p + cr − (cid:96)(cid:9),

x ∈ Mk, p ∈ RN , r ∈ R.

We now give the deﬁnition of stratiﬁed solution for the problem (2.2) (for the notion of viscosity
solution, we refer to [1, 2]).

Deﬁnition 2.2. We say that

(i) a locally bounded, lsc function v : RN → R is a stratiﬁed supersolution of (2.2) if it is a

viscosity supersolution of the equation;

(ii) a locally bounded, usc function u : RN → R is a stratiﬁed subsolution of (2.2) if it is a viscosity
subsolution of the equation and for any k = 0, . . . , N , for any test-function φ ∈ C1(Mk) such
that u − φ has a local maximum point at x ∈ Mk on Mk, then

H k(x, u(x), Dφ(x)) ≤ 0 .

The following result characterizes the value function U as the unique stratiﬁed solution of (2.2).
In particular, the uniqueness is consequence of a Comparison Principle among bounded stratiﬁed
sub and supersolutions of (2.2).

Theorem 2.3 ([6, Theorem 21.3.1 and Corollary 22.1.2]). Assume [H0], [H1] and

[H2] for any 0 ≤ k ≤ j ≤ N , if y1, y2 ∈ Mj ∩ B(x, r) with y1 − y2 ∈ Vk, then




distH



distH

(cid:0)B(y1), B(y2)(cid:1) ≤ C1|y1 − y2| ,
(cid:0)BCL(y1), BCL(y2)(cid:1) ≤ ω(cid:0)|y1 − y2|(cid:1) ,

where B(x) = (cid:8)b ∈ RN :
the Hausdorﬀ distance and ω is a modulus of continuity.

there exists c, (cid:96) ∈ R such that (b, c, (cid:96)) ∈ BCL(x)(cid:9), distH denotes

[H3] there exists δ > 0 such that, for any 0 ≤ k < N , if y ∈ B(x, r) \ Mk there holds

B(0, δ) ∩ V ⊥

k ⊂ B(y) ∩ V ⊥
k ;

[H4] there exists a constant ¯c > 0 such that, for all x ∈ RN , if (b, c, l) ∈ BCL(x), then c ≥ ¯c.

Then, the value function U is continuous and it is the unique stratiﬁed solution of (2.2).

More general assumptions for the data of the problem and also the case of a general stratiﬁcation

are discussed in [5, 6].

4

3 A semi-Lagrangian scheme for Hamilton-Jacobi equations on

stratiﬁed domains

In this section, we consider an approximation scheme for the problem described in the previous
section. We consider a speciﬁc form for the Hamilton-Jacobi equation that corresponds to assigning
an optimal control problem on each submanifold Mk, k = 0, . . . , N of the stratiﬁcation (see [6,
Section 22.2.1] for more details).
Given an AFS M of RN , we write each manifold as the union of its connected components, i.e.
Mk = ∪J(k)
j=1 Mk,j with J(k) ∈ N. On each Mk,j, we consider a control set Ak,j, a dynamics
bk,j : RN × Ak,j → R, with bk,j(x, α) ∈ TxMk for (x, α) ∈ Mk,j × Ak,j, a discount factor ck,j ∈ R
and a running cost (cid:96)k,j : RN × Ak,j → R. We deﬁne the associated Hamiltonian

H k,j(x, r, p) = sup
α∈Ak,j

(cid:110)

− bk,j(x, α) · p + ck,jr − (cid:96)k,j(x, α)

(cid:111)
,

(x, p) ∈ Mk,j × TxMk,j.

Note that for x ∈ M0,j, j ∈ J(0), we have

H 0,j(x, r, p) = sup
α∈A0,j

(cid:110)

− (cid:96)0,j(x, α) + c0,jr

(cid:111)

since TxM 0,j = {0}.
Set L(x) = {(k, j) : x ∈ Mk,j} and consider the map BCL : RN → P(RN +2) given by

BCL(x) = co

(cid:110) (cid:91)

{(bk,j(x, α), ck,j, (cid:96)k,j(x, α)) : α ∈ Ak,j}

(cid:111)
,

(k,j)∈L(x)

where co denotes the closure of the convex hull, and the Hamiltonian H : RN × RN → R given by

H(x, r, p) = max

(k,j)∈L(x)

(cid:110)

sup
α∈Ak,j

− bk,j(x, α) · p + ck,jr − (cid:96)k,j(x, α)

(cid:111)
.

(3.1)

Assumptions of Theorem 2.3 are satisﬁed if

• bk,j, (cid:96)k,j are bounded, continuous functions on RN × Ak,j and {(bk,j, (cid:96)k,j)(x, α) : α ∈ Ak,j}
are convex, compact subsets of RN +1. Moreover, for any R > 0, there exists a constant CR
such that

|bk,j(x, α) − bk,j(y, α)| ≤ CR|x − y|

∀x, y ∈ B(0, R), α ∈ Ak,j.

• ck,j ≥ ¯c for some positive constant ¯c.

• For x ∈ M¯k, the set

(cid:110)

co

(cid:91)

(k,j)∈L(x),k>¯k

{(bk,j(x, α), (cid:96)k,j(x, α)) : α ∈ Ak,j}

(cid:111)

satisﬁes [H3].

5

The previous assumptions will be made in the rest of paper.

We now describe a classical semi-Lagrangian approximation scheme for (2.2) based on a two-
step discretization procedure (see [14]). For h ∈ (0, 1/¯c) and H given by (3.1), we ﬁrst deﬁne the
following semi-discrete approximation scheme for (2.2)

u(x) = min

(k,j)∈L(x)

inf
α∈Ak,j

(cid:110)

(1 − ck,jh)u(x + hbk,j(x, α)) + h(cid:96)k,j(x, α)

(cid:111)
,

x ∈ RN .

(3.2)

In the second discretization step, we introduce a FEM like discretization of (3.2) yielding a fully
discrete scheme for (2.2). For ∆x > 0, let T ∆x = {S∆x
τ }τ ∈N be a non-degenerate triangulation of
RN , i.e. a collection of N -simplices S∆x

such that

τ

τ = RN ,
S∆x

∪
τ ∈N

sup
τ ∈N

(diam Sτ ) ≤ ∆x,

ρ∆x ≤ sup
τ ∈N

(diam BS∆x

),

τ

is the greatest ball contained in
. We denote by X ∆x = {xσ}σ∈N the corresponding set of the vertices, and introduce the space

where ρ ∈ (0, 1), diam denotes the diameter of the set, and BS∆x
S∆x
τ
of continuous piecewise linear functions on T ∆x,

τ

W ∆x = {w ∈ C(RN ) : Dw(x) is constant in S∆x

τ

, τ ∈ N}.

Every element w in W ∆x can be expressed as

w(x) =

(cid:88)

σ∈N

βσ(x)w(xσ),

for basis functions βσ ∈ W ∆x satisfying βσ(xτ ) = δστ for σ, τ ∈ N. It immediately follows that
0 ≤ βσ(x) ≤ 1, (cid:80)
σ∈N βσ(x) = 1, βσ has compact support, and at any x ∈ RN at most N +1 βσ’s are
non-zero. We require that the triangulation T ∆x is adapted to the stratiﬁcation Mk, k = 0, . . . , N ,
i.e. given x ∈ Mk with x = (cid:80)
σ βσ(x)xσ, then βσ(x) (cid:54)= 0 if and only if xσ ∈ Mk. In other words,
T ∆x induces a triangulation of size ∆x also of the ﬂat manifold Mk. In particular, points of M0
must be vertices of the triangulation.
The fully discrete scheme can then be formulated as follows: Find the function u ∈ W ∆x that
satisﬁes (3.2) at every vertex xσ ∈ X ∆x, or equivalently,

u(xσ) = (cid:61)(h, ∆x, xσ, u),

xσ ∈ X ∆x,

(3.3)

where

(cid:61)(h, ∆x, xσ, u) = min

(k,j)∈L(xσ)

inf
α∈Ak,j

(cid:110)

(1 − ck,jh)

(cid:88)

τ ∈N

στ (α)u(xτ ) + h(cid:96)k,j(xσ, α)
I k,j

(cid:111)

and the interpolation matrix I k,j(α) is given by

I k,j
στ (α) = βτ

(cid:0)xσ + hbk,j(xσ, α)(cid:1).

(3.4)

Note that only N + 1 entries of any row of I k,j(α) are non-zero and (cid:80)

τ ∈N I k,j

στ (α) = 1.

Proposition 3.1. There exists a unique bounded solution uh,∆x ∈ W ∆x of (3.3).

6

Proof. For u, v ∈ W ∆x, we have that

|(cid:61)(h, ∆x, xσ, u) − (cid:61)(h, ∆x, xσ, V )| ≤ (1 − ¯ch)(cid:107)u − v(cid:107)∞

for all xσ ∈ X ∆x. The previous inequality implies that (cid:61) is a contraction on the set W ∆x, hence
there exists a unique bounded solution uh,∆x ∈ W ∆x to (3.3).
Given M as in [H1], we have (cid:107)(cid:96)k,j(cid:107)∞ ≤ M for any k = 0, . . . , N , j ∈ J(k). Hence

uh,∆x(x) = (cid:61)(h, ∆x, xσ, u) ≤ min

(k,j)∈L(x)

(1 − ck,jh)

inf
α∈Ak,j

(cid:88)

τ ∈N

στ (α)(cid:107)uh,∆x(cid:107)∞ + h(cid:107)(cid:96)k,j(cid:107)∞
I k,j

≤ (1 − ¯ch)(cid:107)uh,∆x(cid:107)∞ + hM.

and therefore (cid:107)uh,∆x(cid:107)∞ ≤ M/¯c.

Remark 3.2. For x ∈ M0,j, j ∈ J(0), taking into account that x ∈ X ∆x, the scheme (3.3) implies
that

uh,∆x(x) ≤

1
¯c

{(cid:96)0,j(x, α)}

inf
α∈A0,j

For the convergence analysis, we rewrite the fully discrete scheme (3.3) in a equivalent way as

where, for xσ ∈ X ∆x, r ∈ R, w ∈ W ∆x, we have

Σ(h, ∆x, xσ, u(xσ), u) = 0

σ ∈ N

Σ(h, ∆x, xσ, r, w) = max

(k,j)∈L(xσ)

Σk,j(h, ∆x, xσ, r, w)

with

Σk,j(h, ∆x, xσ, r, w) = ck,jr + sup
α∈Ak,j

(cid:110)

− (1 − ck,jh)

w(xσ + hbk,j(xσ, α)) − r
h

− (cid:96)k,j(xσ, α)

(cid:111)

= ck,jr + sup
α∈Ak,j

(cid:110)

− (1 − ck,jh)

(cid:80)

τ ∈N I k,j

στ (α)w(xτ ) − r

h

− (cid:96)k,j(xσ, α)

(cid:111)

(3.5)

(3.6)

and I as in (3.4). In the following, given a smooth function φ ∈ C∞
linear interpolation on the simplices S∆x

of the triangulation.

τ

b (RN ), we denote with ˆφ its

Proposition 3.3. The scheme (3.2) satisﬁes the following properties

(P1) The scheme is invariant by addition of constants, i.e.

Σ(h, ∆x, xσ, r + C, w + C) = S(h, xσ, r, w),

for any xσ ∈ X ∆x, C ∈ R, w ∈ W ∆x.

(P2) The scheme is monotone, i.e. given two bounded functions v, w ∈ W ∆x such that v ≤ w,

then

for any xσ ∈ X ∆x.

Σ(h, ∆x, xσ, r, w) ≤ Σ(h, ∆x, xσ, r, v),

7

(P3) For any smooth function φ ∈ C∞

b (RN ) and xσ ∈ X ∆x,

|H(xσ, φ(xσ), Dφ(xσ)) − Σ(h, ∆x, xσ, ˆφ(xσ), ˆφ)| ≤ Cφ

(cid:18)

h +

(cid:19)

,

∆x
h

(3.7)

for some constant Cφ = C((cid:107)φ(cid:107)C2).

Proof. Properties (P1) and (P2) are immediate. To prove (P3), for (h, x, r) ∈ (0, 1/¯c) × RN × R
and a bounded smooth function φ, we set

S(h, x, r, φ) = max

(k,j)∈L(x)

S k,j(h, x, r, φ)

with

S k,j(h, x, r, φ) = ck,jr + sup
α∈Ak,j

(cid:110)

− (1 − ck,jh)

φ(x + hbk,j(x, α)) − r
h

− (cid:96)k,j(x, α)

(cid:111)
.

Then, for all x ∈ RN

|H(x, φ(x), Dφ) − S(h, x, φ(x), φ)|

|H k,j(x, φ(x), Dφ) − S k,j(h, x, φ(x), φ)|

max
(k,j)∈L(x)

≤ sup
x∈RN
≤ Ch,

for some constant C = C((cid:107)D2φ(cid:107)∞). Moreover, since (cid:107)φ − ˆφ(cid:107)∞ ≤ C∆x, if xσ ∈ X ∆x we have

|S(h, xσ, φ(xσ), φ) − Σ(h, ∆x, xσ, ˆφ(xσ), ˆφ)|
≤ sup
x∈RN
∆x
h

max
(k,j)∈L(x)

≤ C

.

|S k,j(h, xσ, φ(xσ), φ) − Σk,j(h, ∆x, xσ, ˆφ(xσ), ˆφ)|

Taking into account the previous inequalities, we get

|H(xσ, φ(xσ), Dφ(xσ)) − Σ(h, ∆x, xσ, ˆφ(xσ), ˆφ)| ≤ C

(cid:18)

h +

(cid:19)

∆x
h

with C = C(φ) independent of xσ.

Theorem 3.4. If h, ∆x → 0, with ∆x/h → 0, the sequence uh,∆x of the solutions to (3.5) converges
to the unique stratiﬁed solution U of (2.2).

Proof. The proof is based again on the classical technique of half-relaxed limits introduced in [7].
We deﬁne

u(x) := lim inf
h,∆x→0
y→x

∗ uh,∆x(y),

u(x) := lim sup
h,∆x→0
y→x

∗ uh,∆x(y)

and we denote by H ∗, H∗ the upper and lower semicontinuous envelopes of the Hamiltonian H (see
[2] for the previous deﬁnitions).

8

We claim that u, u are a supersolution and, respectively, a subsolution to (2.2) in the standard
viscosity sense. Indeed, by (3.7), for any x ∈ RN , for any smooth function φ and for any sequence
xσ → x for h, ∆x → 0 with ∆x/h → 0, we have

lim sup
h,∆x→0

Σ(h, ∆x, xσ, ˆφ(xσ), ˆφ)

(cid:20)

≤ lim sup
h,∆x→0

H(xσ, φ(xσ), Dφ(xσ)) + Cφ

h +

(cid:18)

(cid:19)(cid:21)

∆x
h

≤ H ∗(x, φ(xσ), Dφ(x)) = H(x, φ(x), Dφ(x))

(recall that H is usc) and similarly

lim sup
h,∆x→0

Σ(h, ∆x, xσ, ˆφ(xσ), ˆφ) ≥ H∗(x, φ(x), Dφ(x)).

Hence, the scheme (3.5) is consistent, in viscosity solution sense, with (2.2) and the claim is a direct
consequence of the convergence result in [7, Theorem 2.1].
If we show that u is a stratiﬁed subsolution, then the comparison principle (see [5, Theorem 5.2.]
and [6, Theorem 21.3.1]) implies u ≤ u. Being the reverse inequality straightforward and taking
into account Theorem 2.3, we get u = u = U, and therefore the local uniform convergence of uh,∆x
to U. Hence, it remains to show that for any smooth test function φ such that u − φ has a local
(strict) maximum point at x0 ∈ Mk on Mk with u(x0) = φ(x0), then

H k(x0, φ(x0), Dφ(x0)) ≤ 0 .

(3.8)

Since the argument is local, we can consider a neighborhood of x0 small enough in such a way that
it contains no point of Ml for l < k and of no other connected component of Mk except the one,
denoted with Mk,p, containing x0.
Since x0 is a maximum point for u−φ on Mk, there exists a sequence of maximum points xh,∆x ∈ Mk
for uh,∆x − φ such that xh,∆x → x0 and uh,∆x(xh,∆x) → u(x0) for h, ∆x → 0. To simplify the
notation, we write uh,∆x = u∆, xh,∆x = x∆, where ∆ → 0 for h, ∆x → 0. Since the triangulation
is adapted to the stratiﬁcation, we have x∆ = (cid:80)
σ βσ(x∆)x∆,σ with βσ(x∆) (cid:54)= 0 if and only if
x∆,σ ∈ Mk and, moreover, x∆,σ + hbk,p(x∆,σ, α) ∈ Mk,p for h suﬃciently small. Hence

φ(x∆,σ + hbk,p(x∆,σ, α)) − φ(x∆) ≥ u∆(x∆,σ + hbk,p(x∆,σ, α)) − u∆(x∆).

Recalling (3.5) and that (cid:80)

σ βσ(x∆) = 1, we have

0 =

≥

(cid:88)

σ
(cid:88)

σ

βσ(x∆)Σ(h, ∆x, x∆,σ, u∆(x∆,σ), u∆)

βσ(x∆)Σk,p(h, ∆x, x∆,σ, u∆(x∆,σ), u∆)

≥ ck,pu∆(x∆) + sup
α∈Ak,p

(cid:110)

− (1 − ck,ph)

(cid:104) (cid:80)

σ βσ(x∆)φ(x∆,σ + hbk,p(x∆,σ, α)) − φ(x∆)
h

(cid:105)

βσ(x∆)(cid:96)k,p(x∆,σ, α)

(cid:111)
.

(cid:88)

−

σ

9

(3.9)

We estimate

(cid:12)
(cid:12)
(cid:12)

|

(cid:88)

(cid:12)
(βσ(x∆)φ(x∆,σ + hbk,p(x∆,σ, α)) − φ(x∆)) − Dφ(x∆) · bk,p(x∆, α)
(cid:12)
(cid:12) ≤ C

1
h
σ
(cid:88)
βσ(x∆)(cid:96)k,p(x∆,σ, α) − (cid:96)k,p(x∆, α)| ≤ ω(∆x)

∆x
h

+ ω(∆x) (3.10)

(3.11)

σ

for any ∆, with C = C(φ) and ω the continuity modulus of bk,p, (cid:96)k,p. Replacing (3.10) and (3.11)
in (3.9), we get

(cid:110)

0 ≥ ck,pu∆(x∆) + sup
α∈Ak,p
= H k(x∆, u∆(x∆), Dφ(x∆)) + o(1),

− bk,p(x∆, α) · Dφ(x∆) − (cid:96)k,p(x∆, α)

+ o(1)

(cid:111)

where o(1) → 0 for h, ∆x → 0 with ∆x/h → 0. Hence, passing to the limit, we get (3.8) and the
claim is proved.

Remark 3.5. If the Hamiltonian is globally deﬁned in RN , see (2.1), then the semi-discrete scheme
reads as

u(x) =

inf
(b,c,(cid:96))∈BCL(x)

{−(1 − ch)u(x + hb) − h(cid:96)}.

and the fully discrete one corresponds to ﬁnd a function u ∈ W ∆x that satisﬁes the previous
equation at every vertex xσ ∈ X ∆x, or equivalently,

u(xσ) =

inf
(b,c,(cid:96))∈BCL(xσ)

(cid:110)

(1 − ch)

(cid:88)

τ ∈N

I k,j
στ (b)u(xτ ) + h(cid:96)

(cid:111)
,

xσ ∈ X ∆x

where the matrix I k,j(b) is given by

I k,j
στ (b) = βτ

(cid:0)xσ + hb(cid:1).

The convergence analysis in Prop. 3.3 and Theorem 3.4 can be easily extended to this case.

Remark 3.6. In [3, 4], it is characterized the value function of a control problem where the
dynamics and running cost have a discontinuity along a set of co-dimension one. More precisely,
using the notation of those papers, consider

and the Hamiltonians

Ω1 := {x = (x1, · · · , xN ); xN > 0},
Ω2 := {x = (x1, · · · , xN ); xN < 0},
H := Ω1 ∩ Ω2 = (cid:8)x ∈ RN : xN = 0(cid:9) .

H1(x, r, p) := sup
α1∈A1
H2(x, r, p) := sup
α2∈A2

{−b1(x, α1) · p + r − (cid:96)1(x, α1)} ,

{−b2(x, α2) · p + r − (cid:96)2(x, α2)} ,

10

H(x, r, p) :=




H1(x, r, p)

if x ∈ Ω1,



H2(x, r, p)

if x ∈ Ω2.

Since the Hamiltonian H has a discontinuity along the hyperplane H, the standard deﬁnition of
viscosity sub and supersolutions for

H(x, u, Du) = 0

on RN

reads as (see [1, 2])

H1(x, u, Du) = 0

H2(x, u, Du) = 0






min{H1(x, u, Du), H2(x, u, Du)} ≤ 0

max{H1(x, u, Du), H2(x, u, Du)} ≥ 0

in Ω1 ,

in Ω2 ,

on H ,

on H.

(3.12)

The conditions induced on H by (3.12) are not enough to ensure uniqueness of the solution and
there may exists several viscosity solution of the problem.
In [3, 4, 6], diﬀerent deﬁnitions to
characterize the value function as the unique solution of the previous problem are introduced.
Another possibility is to interpret (3.12) in the stratiﬁed sense, with a stratiﬁcation given by
MN −1 = H, MN = RN \ H. Introduce the tangential Hamiltonian

HT (x, r, p) := sup

(cid:8) − bH(x, a) · pH + r − lH(x, a)(cid:9) ,

(3.13)

a∈AH(x)

with

(cid:0)x, a) = bH

(cid:0)x, (α1, α2, µ)(cid:1) := µb1(x, α1) + (1 − µ)b2(x, α2) ,

bH

(cid:96)H(x, a) = (cid:96)H

(cid:0)x, (α1, α2, µ)(cid:1) := µ(cid:96)1(x, α1) + (1 − µ)(cid:96)2(x, α2) ,

AH(x) :=

(cid:110)

(α1, α2, µ) ∈ A1 × A2 × [0, 1] : bH

(cid:111)
(cid:0)x, (α1, α2, µ)(cid:1) · eN (x) = 0

.

and consider on H the Hamilton-Jacobi equation

HT (x, u, DHu) = 0

on H.

(3.14)

Then, Theorem 2.3 implies that U is the unique stratiﬁed solution of (2.2) with H N −1(x, r, p) =
HT (x, r, p) for x ∈ H. The fully discrete approximation scheme (3.3) reads in this case as

u(xσ) =




inf
α∈Ai

{−(1 − h)u(xσ + hbi(xσ, α)) + h(cid:96)i(xσ, α)}

xσ ∈ Ωi, i = 1, 2,



min
i=1,2

inf
α∈Ai

{−(1 − h)u(xσ + hbi(xσ, α)) + h(cid:96)i(xσ, α)} xσ ∈ H.

11

4 The software HJSD

In this section we introduce HJSD (Hamilton-Jacobi on Stratiﬁed Domains), an easy-to-use pro-
gram written in C++ we developed for the numerical solution of Hamilton-Jacobi equations
on stratiﬁed domains in two and three dimensions (the free software will be soon available at
http://www.sbai.uniroma1.it/ fabio.camilli/HJSD.html).

HJSD is able to solve equations with Hamiltonians of the form (3.1), where a speciﬁc control
problem can be deﬁned on each connected component of the stratiﬁcation. In this ﬁrst version of the
software, it is assumed that each pair (dynamics, running cost) is of the form (b(x)a, (cid:96)(x)), namely
both the speed function b and the running cost (cid:96) only depend on the state but not on the control. On
the other hand, the control a takes discrete values in A1 = [−1, 1] or A2 = S 1 = {a ∈ R2 | |a| = 1}
or A3 = S 2 = {a ∈ R3 | |a| = 1}, according to the dimension of the corresponding submanifold.
Finally, the computational domain is a box in two or three dimensions, discretized respectively by
structured triangles or tetrahedra.
HJSD takes in input .hjsd ﬁles, which are simple text ﬁles containing all the relevant information
for the deﬁnition of the stratiﬁcation and of the corresponding control problems. More precisely,
.hjsd ﬁles are formatted as follows.

For two dimensional problems, we have the syntax:

yLX
1

#HJSD2D Nx Ny xmin xmax ymin ymax NA1 NA2
#P xP yP (cid:96)P cP
. . . (other points)
#LX xLX yLX
0
. . . (other X-lines)
#LY yLY xLY
0
. . . (other Y-lines)
#S xS yS bS(x, y) (cid:96)S(x, y) cS
. . . (other surfaces)

bLX (x, y) (cid:96)LX (x, y) cLX

bLY (x, y) (cid:96)LY (x, y) cLY

xLY
1

meaning that

(i) #HJSD2D deﬁnes a stratiﬁcation of R2 using the computational box [xmin, xmax] × [ymin, ymax],
discretized by means of a uniform structured grid with Nx × Ny nodes. Each cell is divided into
two triangles to reconstruct the solution via linear interpolation. Moreover, the control sets A1 and
A2 are uniformly discretized with NA1 and NA2 elements respectively.

(ii) #P deﬁnes a connected component of the submanifold M0, namely a point with coordinates
(xP , yP ) (actually the closest grid point). Moreover, (cid:96)P and cP are, respectively, the constant
running cost and discount factor corresponding to the point (no dynamics on zero-dimensional
submanifolds, since the related tangent space is trivial).

(iii) #L(X)(Y) deﬁnes a connected component of the submanifold M1, namely a coordinate (X)(Y)-
line, speciﬁed by a constant coordinate in one direction and two coordinates in the remaining di-

12

rection (the line is actually projected on the grid). Note that, if one or both end-points fall out
the computational box, the line is considered respectively as semi-inﬁnite and inﬁnite, otherwise
it is a segment. The end-points are then excluded in order to obtain an approximation of an
open set, according to the deﬁnition of M1: it is up to the user to possibly deﬁne the end-points
as elements of M0. Moreover, bL(X)(Y )(x, y) and (cid:96)L(X)(Y )(x, y) are symbolic functions of the vari-
ables x, y (parsed and evaluated using the free library ExprTk [13]) deﬁning, respectively, the speed
for the dynamics and the running cost corresponding to the line, while cL(X)(Y ) is its discount factor.

(iv) #S deﬁnes a connected component of the submanifold M2, namely a ﬂat open surface obtained
using a classical Flood Fill algorithm [18], specifying a belonging point of coordinates (xS, yS). Note
that the user should specify the belonging points for all the surfaces induced by the lines in the
stratiﬁcation. Moreover, bS(x, y) and (cid:96)S(x, y) are symbolic functions of the variables x, y deﬁning,
respectively, the speed for the dynamics and the running cost corresponding to the surface, while
cS is its discount factor.

Similarly, for three-dimensional problems, we have the following syntax:

0

0

zLXY
1

xLY Z
1

bLY Z(x, y, z) (cid:96)LY Z(x, y, z) cLY Z

bLXY (x, y, z) (cid:96)LXY (x, y, z) cLXY

#HJSD3D Nx Ny Nz xmin xmax ymin ymax zmin zmax NA1 NA2 NA3
#P xP yP zP (cid:96)P cP
. . . (other points)
#LXY xLXY yLXY zLXY
. . . (other XY-lines)
#LYZ yLY Z zLY Z xLY Z
. . . (other YZ-lines)
#LXZ xLXZ zLXZ yLXZ
. . . (other XZ-lines)
zSX
#SX xSX ySX
0
. . . (other X-surfaces)
#SY ySY xSY
0
. . . (other Y-surfaces)
#SZ zSZ xSZ
. . . (other Z-surfaces)
#V xV yV zV bV (x, y, z) (cid:96)V (x, y, z) cV
. . . (other volumes)

bLXZ(x, y, z) (cid:96)LXZ(x, y, z) cLXZ

bSX (x, y, z) (cid:96)SX (x, y, z) cSX

bSY (x, y, z) (cid:96)SY (x, y, z) cSY

bSZ(x, y, z) (cid:96)SZ(x, y, z) cSZ

yLXZ
1

ySX
1

zSX
1

xSZ
1

ySZ
1

ySZ
0

xSY
1

zSY
1

zSY
0

0

0

0

with the following diﬀerences with respect to the two-dimensional case:

(i) #HJSD3D deﬁnes a stratiﬁcation of R3 using the computational box [xmin, xmax] × [ymin, ymax] ×
[zmin, zmax], with additional Nz nodes in the z direction. Each cell of the discretization is divided
into six tetrahedra to reconstruct the solution via linear interpolation. Moreover, the control set
A3, i.e. the unit sphere, is approximated in spherical coordinates with NA3 meridians and NA3
parallels, with a total number of NA3 × NA3 elements.

(ii) #P and #L(XY)(YZ)(XZ) deﬁne points and coordinate lines in three-dimensions as before, using
additional z coordinates.

13

(iii) #S(X)(Y)(Z) deﬁnes a connected component of the submanifold M2, namely a coordinate
(X)(Y)(Z)-plane, speciﬁed by a constant coordinate in one direction and two pairs of coordinates
in the remaining directions (the plane is actually projected on the grid). As for lines, such ﬂat sur-
faces are considered semi-inﬁnite, inﬁnite or rectangles, depending on which parts of them fall out
the computational box. Again, their boundaries are excluded in order to obtain approximations of
open sets, according to the deﬁnition of M2, and it is up to the user to deﬁne the missing elements
of M0 and M1.

(iv) #V deﬁnes a connected component of the submanifold M3, namely a volume obtained using
again a classical Flood Fill algorithm in three-dimension, specifying a belonging point of coordi-
nates (xV , yV , zV ).

(v) all the functions deﬁning the diﬀerent speeds for the dynamics and the running costs on the
stratiﬁcation, are now symbolic functions of the variables x, y, z.

The program checks for syntax errors in the input .hjsd ﬁle, then it computes an approxima-
tion of the stratiﬁed viscosity solution of the problem, and writes the results in a vtk ﬁle, ready
for the visualization in Paraview [19]. The vtk ﬁle contains the geometry of the stratiﬁcation, the
value function and the corresponding vector ﬁeld of the optimal dynamics, which can be also used
to compute the optimal trajectories starting from arbitrary points (directly in Paraview, by means
of the StreamTracerWithCustomSource ﬁlter).

We now provide some details on the actual implementation of HJSD. The code employs the
fully-discrete semi-Lagrangian scheme in ﬁxed-point form introduced in (3.3). The user can specify
at runtime the discretization step h and the tolerance τ for the convergence. The most delicate part
of the algorithm is the construction of a suitable data structure to store a general stratiﬁcation.
More precisely, we have to build, for each grid node xσ, the map L(xσ) of all the indices (k, j)
of sub-manifolds and related connected components that compete to the node, and we have to
attach to each pair (k, j) the corresponding symbolic functions for the dynamics, running cost and
discount factor. Then, the evaluation of the ﬁxed-point operator is performed by exhaustively
selecting the optimal value among all the (k, j)’s and the corresponding controls in Ak,j. We recall
that the reconstruction of the solution through the interpolation matrix I k,j involves the values at
the vertices of a suitable element: the one containing the foot of the characteristic associated to
the control a, starting from the node xσ and moving for a single time step h along the direction
provided by the vector ﬁeld b(xσ)a. Whenever the characteristic falls out the computational box,
the corresponding control is penalized so that the optimal one will always point inside the domain.
This procedure is straightforward on structured triangular/tetrahedral grids, as the ones considered
here, but it can be implemented eﬃciently also on unstructured grids, see e.g. [9]. Moreover, the
computation is intrinsically parallel, since each node can be assigned to a single processor, and
a single synchronization is required at each ﬁxed-point iteration. This eﬀectively mitigates the
computational eﬀort due to the exhaustive search of the minimum value in the solution update.
A CUDA-GPU version of the code is currently under development, including general stratiﬁcations
with arbitrary (non coordinate) lines and planes on adapted unstructured grids, more general
Hamiltonians as in (3.1), and also suitable descent methods for the computation of optimal controls.

14

5 Numerical experiments

In this section, we report and discuss the numerical results obtained by the software HJSD, showing
the features of the proposed method in diﬀerent scenarios.

Let us start by deﬁning the setup for some parameters common to all the experiments, the

other ones will be tuned ad-hoc for the single tests.
For the ﬁrst three simulations in two dimensions, we choose the computational box [xmin, xmax] ×
[ymin, ymax] = [−1, 1]2, discretized by Nx × Ny = 201 × 201 nodes, whereas the control sets A1 and
A2 are respectively approximated by NA1 = 3 and NA2 = 64 elements. We also ﬁx the tolerance
for the convergence τ = 10−6, while the discretization step is chosen of order h = O(
∆x) to
guarantee the convergence of the scheme (Theorem 3.4).
On the other hand, for the last simulation in three dimensions, we choose [xmin, xmax]×[ymin, ymax]×
[zmin, zmax] = [−1, 1]3, Nx × Ny × Nz = 101 × 101 × 101, NA1 = 3, NA2 = 32 and NA3 = 32.
Finally, in all the experiments and for visualization convenience, we adopt the convention that
the dynamics speed on the zero dimensional submanifold is depicted with a zero value, despite no
dynamics is deﬁned on M0 at all.
Test 1. We consider the stratiﬁcation of R2 obtained combining a horizontal segment, its end-points
and an additional isolated point. More precisely, we set

√

M0 = {P0} ∪ {P1,0} ∪ {P1,1}

with

(cid:18)

P0 =

0,

(cid:19)

3
4

(cid:18)

, P1,0 =

−

1
2

(cid:19)

, 0

, P1,1 =

(cid:19)

, 0

,

(cid:18) 1
2

M1 = L :=

(cid:19)

(cid:18)

−

1
2

,

1
2

× {0}

and M2 = S := R2 \ (M0 ∪ M1) .

On each connected component of these submanifolds, we deﬁne the dynamics, the running cost and
the discount factor according to the following table:

Connected component Dynamics

P1,i

P0
i = 0, 1
L
S

-
-
bL(x, y) ≡ 1
bS(x, y) ≡ 1

Running Cost
(cid:96)P0 = 0
(cid:96)P1,i = 2

(cid:96)L(x, y) = 1

4 (1 + 4|x|)

(cid:96)S(x, y) ≡ 5

Discount factor
cP0 = 1
cP1,i = 10−4
cL = 10−4
cS = 10−4

This stratiﬁcation is reported in Figure 1-a, where the color-map represents the values of the
running cost on the diﬀerent submanifolds (while the dynamics, excluding M0, has everywhere a
unitary speed). In practice, the point P0 is an absolute minimizer for the global running cost, and
it acts as a target point. On the other hand, the segment L has a strictly positive running cost,
ranging in the interval ( 1
4 ), and a local minimum at its middle point. Finally, the points P1, P2
and the remaining surface S have an higher and higher running cost.
In Figure 1-b we report the computed optimal dynamics, while Figure 1-c shows the value function,
its level sets and some optimal trajectories. We remark that all the optimal trajectories are forced
to eventually reach P0, as in a minimum time problem, and this is implied by the fact that, with

4 , 3

15

the exception of cP0, all the discount factors are close to zero. Nevertheless, we observe that, due
to its much more favorable cost, the segment L can temporarily attract some trajectories, also
increasing their travelled distance. This results in the creation of a shock which splits the domain
in two parts, connected only in a neighborhood of the middle point of L, see the surface of the
solution in Figure 1-d.
Finally, we observe that the contribution of P1 and P2 is irrelevant, both control problems on them
are replaced by the one on L, extended to its closure as described in Section 3, which is again more
favorable.

(a)

(b)

(c)

(d)

Figure 1: Stratiﬁcation for Test 1 (a), optimal dynamics (b), solution values and optimal trajectories
(c), solution surface (d).

16

Test 2. We consider a more complex stratiﬁcation of R2, obtained combining two vertical segments,
their end-points and an additional isolated point. More precisely, we set

M0 = {P0} ∪ {P1,0} ∪ {P1,1} ∪ {P2,0} ∪ {P2,1}

with

(cid:18)

P0 =

0,

(cid:19)

3
4

(cid:18)

, P1,0 =

−

1
2

, −

(cid:19)

1
2

(cid:18)

, P1,1 =

−

(cid:19)

1
2

,

1
2

, P2,0 =

(cid:18) 1
2

, −

(cid:19)

1
2

, P2,1 =

(cid:18) 1
2

,

1
2

(cid:19)

,

while

with

and

M1 = L0 ∪ L1

(cid:26)

L0 =

−

(cid:27)

(cid:18)

×

−

(cid:19)

1
2

,

1
2

1
2

, L1 =

(cid:26) 1
2

(cid:27)

(cid:18)

×

−

(cid:19)

1
2

,

1
2

M2 = S := R2 \ (M0 ∪ M1) .

On each connected component of these submanifolds, we deﬁne the dynamics, the running cost and
the discount factor according to the following table:

Pi,j

Connected component
P0
i = 1, 2
L0
L1
S

j = 0, 1

Dynamics
-
-
bL0(x, y) ≡ 2
bL1(x, y) ≡ 3
bS(x, y) ≡ 1

Running Cost Discount factor

(cid:96)P0 = 0
(cid:96)Pi,j = 1
(cid:96)L0(x, y) ≡ 1
(cid:96)L1(x, y) ≡ 1
(cid:96)S(x, y) ≡ 1

cP0 = 1
cPi,j = 10−4
cL0 = 10−4
cL1 = 10−4
cS = 10−4

This stratiﬁcation is reported in Figure 2-a, where now the color-map represents the values of the
speed functions on the diﬀerent submanifolds (while the running cost, excluding M0, is everywhere
equal to one). Again, due to the values close to zero of all the discount factors (with the exception
of cP0), this example resembles a minimum time problem with target P0, but on the two vertical
segments L0 and L1 we have speeds higher than the one on S. Hence, we can expect L0 and L1 to
behave as fast tracks for the optimal trajectories.
This is conﬁrmed by the numerical results reported in Figure 2-b (optimal dynamics) and in Figure
2-c (value function, level sets and optimal trajectories). It is worth noting that the solution is not
symmetric with respect to the vertical axis, the higher speed on L1 attracts more points than L0.
Moreover, we observe that the shock in the solution produced by L1 ends up exactly at the end-
point P2,1, while the one produced by L0 stops shortly before the end-point P1,1 (see also Figure
2-d). This explains why all the optimal trajectories, running on L1, leave the fast track at P2,1,
before pointing to P0 along a straight line, while the ones running on L0 leave it slightly before
P1,1. The result clearly depends on the balance between the diﬀerent control problems involved in
a neighborhood of P1,1.
Finally, we observe that, also in this test, the contribution of the end-points of the two segments
results irrelevant for global control problem on the stratiﬁcation.

17

(a)

(b)

(c)

(d)

Figure 2: Stratiﬁcation for Test 2 (a), optimal dynamics (b), solution values and optimal trajectories
(c), solution surface (d).

Test 3. We consider an even more complex stratiﬁcation of R2, obtained combining the sides of a
square and its corner points. Diﬀerently from the previous tests, here we also have two connected
components for the two dimensional submanifold. More precisely, we set

M0 = {P0} ∪ {P1} ∪ {P2} ∪ {P3}

with

(cid:18)

P0 =

−

3
4

, −

(cid:19)

3
4

, P1 =

(cid:18) 3
4

, −

(cid:19)

3
4

, P2 =

(cid:19)

(cid:18) 3
4

,

3
4

(cid:18)

, P3 =

−

(cid:19)

,

3
4

,

3
4

18

while

with

and

with

M1 = L0 ∪ L1 ∪ L2 ∪ L3

(cid:26)

L0 =

−

(cid:27)

(cid:18)

×

−

(cid:19)

3
4

,

3
4

3
4

(cid:18)

, L1 =

−

3
4

,

3
4

(cid:19)

(cid:26)

×

−

(cid:27)

,

3
4

L2 =

(cid:27)

(cid:18)

×

−

(cid:26) 3
4

(cid:19)

3
4

,

3
4

(cid:18)

, L3 =

−

3
4

,

3
4

(cid:19)

×

(cid:27)

(cid:26) 3
4

M2 = R2 \ (M0 ∪ M1) = S0 ∪ S1

(cid:26)

S0 =

(cid:107)(x, y)(cid:107)∞ <

(cid:27)

3
4

(cid:26)

, S1 =

(cid:107)(x, y)(cid:107)∞ >

(cid:27)

.

3
4

On each connected component of these submanifolds, we deﬁne the dynamics, the running cost and
the discount factor according to the following table:

Connected component

Pi
Li

i = 0, 1, 2, 3
i = 0, 1, 2, 3

S0
S1

Dynamics
-
bLi(x, y) ≡ 10
bS0(x, y) ≡ 1
bS1(x, y) ≡ 1

Running Cost
(cid:96)Pi = 1
(cid:96)Li(x, y) ≡ 1

(cid:96)S0(x, y) = min (cid:8)cos( 8

3 πx) + cos( 8

3 πy) + 2, 3(cid:9)

(cid:96)S1(x, y) ≡ 1

Discount factor
cPi = 10−4
cLi = 10−4
cS0 = 1
cS1 = 10−4

This stratiﬁcation is reported in Figure 3-a, with the color-map representing the values of the run-
ning costs on the diﬀerent submanifolds.
Starting from S1, the running cost jumps to higher values across the four segments, where we rec-
ognize eight local minimizers, two for each segment. Despite this barrier, the running cost also has
four absolute minimizers inside S0 which act again as target points, due to the very small discount
factors on S1 and M0 ∪ M1.
The numerical results are reported in Figure 3-b (optimal dynamics) and in Figure 3-c (value func-
tion, level sets and optimal trajectories). As expected, we observe that all the optimal trajectories
eventually reach the target points, but the speed on M1 is so high that a longer travelled distance
is always preferred, in order to approach S0 at the local minimizers for the running cost. This eﬀect
also propagates inside S0, in order to avoid the absolute maxima (plateaux) of (cid:96)S0 located around
the four corners and the middle points of the segments. The result is the creation of several shocks
with triple points, see Figure 3-d). Finally, the contribution of the four corners to the optimal
solution is again irrelevant.

Test 4. This last experiment is similar to Test 2, but in three dimensions. We consider a stratiﬁca-
tion of R3 obtained combining a horizontal square (including its sides and corners) with a vertical
segment (including its end-points).

19

(a)

(b)

(c)

(d)

Figure 3: Stratiﬁcation for Test 3 (a), optimal dynamics (b), solution values and optimal trajectories
(c), solution surface (d).

More precisely, we set

M0 = {P0,0} ∪ {P0,1} ∪ {P1,0} ∪ {P1,1} ∪ {P1,2} ∪ {P1,3}

with

(cid:18)

P0,0 =

0, 0,

(cid:19)

1
2

, P0,1 = (0, 0, 0) ,

(cid:18)

P1,0 =

−

1
2

, −

1
2

(cid:19)

, 0

, P1,1 =

(cid:18) 1
2

, −

1
2

(cid:19)

, 0

, P1,2 =

(cid:18) 1
2

,

1
2

(cid:19)

(cid:18)

, 0

, P1,3 =

−

(cid:19)

, 0

,

1
2

,

1
2

20

while

with

M1 = L0 ∪ L1,0 ∪ L1,1 ∪ L1,2 ∪ L1,3

L0 = {0} × {0} ×

0,

(cid:18)

(cid:19)

,

1
2

(cid:26)

L1,0 =

−

(cid:27)

(cid:18)

×

−

1
2

L1,2 =

(cid:27)

(cid:18)

×

−

(cid:26) 1
2

(cid:19)

(cid:19)

1
2

,

1
2

1
2

,

1
2

× {0} , L1,1 =

−

(cid:18)

1
2

,

1
2

(cid:19)

(cid:26)

×

−

(cid:27)

1
2

× {0} ,

× {0} , L1,3 =

−

(cid:18)

1
2

,

1
2

(cid:19)

×

(cid:27)

(cid:26) 1
2

× {0} ,

and

(cid:26)

M2 = S :=

(cid:107)(x, y, 0)(cid:107)∞ <

(cid:27)

1
2

× {0} , M3 = V := R3 \ (M0 ∪ M1 ∪ M2).

On each connected component of these submanifolds, we deﬁne the dynamics, the running cost and
the discount factor according to the following table:

Connected component
P0,0
P0,1
i = 0, 1, 2, 3

P1,i

L0

L1,i

i = 0, 1, 2, 3

S
V

Dynamics
-
-
-
bL0(x, y, z) ≡ 5
bL1,i(x, y, z) ≡ 5
bS(x, y, z) ≡ 5
bV (x, y, z) ≡ 1

Running Cost Discount factor

(cid:96)P0,0 = 0
(cid:96)P0,1 = 1
(cid:96)P1,i = 1
(cid:96)L0(x, y, z) ≡ 1
(cid:96)L1,i(x, y, z) ≡ 1
(cid:96)S(x, y, z) ≡ 1
(cid:96)V (x, y, z) ≡ 1

cP0,0 = 1
cP0 = 10−4
cP1,i = 10−4
cL0 = 10−4
cL1,i = 10−4
cS = 10−4
cV = 10−4

This stratiﬁcation is reported in Figure 4-a, where the color-map represents the values of the speed
functions on the diﬀerent submanifolds.
According to the choice of the discount factors, only P0,0 acts as a target point, but on M1 ∪ M2 we
have a speed for the dynamics higher than the one on V . As in Test 2, we expect that the optimal
trajectories starting from points far enough from P0,0 will be attracted by these submanifolds,
increasing their travelled distances before approaching the target.
The numerical results are reported in Figure 4-b (some iso-surface of the value function and some
level-sets on a couple of two dimensional slices) and in Figure 4-c (optimal trajectories).
Looking at the level-sets on the horizontal slice, we observe that the solution behaves like the
distance function from the boundary of S. On the other hand, entering S, the solution has circular
level sets, behaving like the distance function from the point P0,1. In particular, it is interesting to
note that, once a trajectory starting from V approaches S, it never leaves S, but proceeds along a
straight line towards P0,1, then it goes up along the segment L0 towards the target.
A closer look at the iso-surfaces of the solution also reveals the shock surface resulting from the
competition between S and L0.
Finally, we remark that, as in the previous tests, the contribution to the optimal solution of the
four segments L1,i for i = 0, . . . , 3, of the four points P1,i for i = 0, . . . , 3, and of the end-point P0,1
of L0, is again irrelevant.

21

(a)

(b)

(c)

Figure 4: Stratiﬁcation for Test 4 (a), solution surfaces and values (b), optimal trajectories (c).

Acknowledgments. The authors would like to thank Guy Barles and Emmanuel Chasseigne for
providing them with an updated version of the book [6].

22

References

[1] Bardi, M.; Capuzzo-Dolcetta, I. Optimal control and viscosity solutions of Hamilton-Jacobi-
Bellman equations, Systems & Control: Foundations & Applications, Birkh¨auser Boston, Inc.,
Boston, MA, 1997.

[2] Barles, G.

Solutions de viscosit´e des ´equations de Hamilton-Jacobi, volume 17 of
Math´ematiques & Applications (Berlin) [Mathematics & Applications], Springer-Verlag, Paris,
1994.

[3] Barles, G.; Briani, A.; Chasseigne, E. A Bellman approach for two-domains optimal control

problems in RN , ESAIM Control Optim. Calc. Var. 19 (2013), no. 3, 710-739.

[4] Barles, G.; Briani, A.; Chasseigne, E.; Imbert, C. Flux-limited and classical viscosity solutions
for regional control problems, ESAIM Control Optim. Calc. Var. 24 (2018), no. 4, 1881-1906.

[5] Barles, G.; Chasseigne, E. (Almost) everything you always wanted to know about deterministic

control problems in stratiﬁed domains, Netw. Heterog. Media 10 (2015), no. 4, 809-836.

[6] Barles G.; Chasseigne E. An Illustrated guide of the modern approaches of Hamilton-Jacobi

equations and control problems with discontinuities, arXiv:1812.09197.

[7] Barles, G.; Souganidis, P. E. Convergence of approximation schemes for fully nonlinear second

order equations, Asymptotic Anal. 4 (1991), no. 3, 271-283.

[8] Bressan A.; Hong Y. Optimal control problems on stratiﬁed domains, Netw. Heterog. Media 2

(2007), no. 2, 313-331.

[9] Cacace, S.; Ferretti, R. Eﬃcient implementation of characteristic-based schemes on unstruc-

tured triangular grids, Comput. Appl. Math. 41 (2022), no. 1, Paper No. 19, 24 pp.

[10] Camilli, F.; Siconolﬁ, A. Time-dependent measurable Hamilton-Jacobi equations, Comm. Par-

tial Diﬀerential Equations 30 (2005), no. 4-6, 813-847

[11] Camilli, F.; Festa, A.; Schieborn, D. An approximation scheme for a Hamilton-Jacobi equation

deﬁned on a network, Appl. Numer. Math. 73 (2013), 33-47.

[12] Carlini, E.; Festa, A.; Forcadel, N. A semi-Lagrangian scheme for Hamilton-Jacobi-Bellman

equations on networks, SIAM J. Numer. Anal. 58 (2020), no. 6, 3165-3196.

[13] ExprTk, the C++ Mathematical Expression Toolkit Library,

http://www.partow.net/programming/exprtk.

[14] Falcone, M.; Ferretti, R. Semi-Lagrangian approximation schemes for linear and Hamilton-
Jacobi equations, Society for Industrial and Applied Mathematics (SIAM), Philadelphia, PA,
2014.

[15] Guerand, J.; Koumaiha, M. Error estimates for a ﬁnite diﬀerence scheme associated with

Hamilton-Jacobi equations on a junction, Numer. Math. 142 (2019), no. 3, 525-575.

23

[16] Giga, Y.; Hamamuki, N. Hamilton-Jacobi equations with discontinuous source terms, Comm.

Partial Diﬀerential Equations 38 (2013), no. 2, 199-243.

[17] Morfe, P. Convergence & rates for Hamilton-Jacobi equations with Kirchoﬀ junction conditions,

NoDEA Nonlinear Diﬀerential Equations Appl. 27 (2020), no. 1, Paper No. 10, 69 pp.

[18] Pavlidis, T. Filling algorithms for raster graphics, Computer Graphics and Image Processing

10 (1979), no. 2, 126–141.

[19] ParaView, an open-source, multi-platform data analysis and visualization application,

https://www.paraview.org

[20] Soravia, P. Boundary value problems for Hamilton-Jacobi equations with discontinuous La-

grangian, Indiana Univ. Math. J. 51 (2002), no. 2, 451-477.

24

