MNRAS000,1–6(2022)PreprintSeptember5,2022CompiledusingMNRASLATEXstyleﬁlev3.0RapidlocalizationofgravitationalwavehostswithFIGAROStefanoRinaldi1,2?andWalterDelPozzo1,21DipartimentodiFisica“E.Fermi”,Universit`adiPisa,I-56127Pisa,Italy2INFN,SezionediPisa,I-56127Pisa,ItalyAcceptedXXX.ReceivedYYY;inoriginalformZZZABSTRACTThecopiousscientiﬁcliteratureproducedafterthedetectionofGW170817electromagneticcounterpartdemonstratedtheimportanceofapromptandaccuratelocalizationofthegravitationalwavewithintheco-movingvolume.Inthisletter,wepresentfigaro,areadytouseandpubliclyavailablesoftwarethatreliesonBayesiannon-parametrics.figaroisdesignedtoruninparallelwithparameterestimationalgorithmstoprovideupdatedthree-dimensionalvolumelocalizationinformation.Diﬀerentlyfromanyexistingalgorithms,theanalyticalnatureofthefigaroreconstructionallowsarankingoftheentriesofgalaxycataloguesbytheirprobabilityofbeingthehostofagravitationalwaveevent,henceprovidinganadditionaltoolforapromptelectromagneticfollowupofgravitationalwaves.WeillustratethefeaturesoffigaroonbinaryblackholesaswellasonGW170817.Finally,wedemonstratetherobustnessoffigarobyproducingso-calledpp-plotsandwepresentamethodbasedoninformationentropytoassesswhen,duringtheparameterestimationrun,itisreasonabletobeginreleasingskymaps.Keywords:methods:dataanalysis–methods:statistical–gravitationalwaves–stars:blackholes1INTRODUCTIONThediscoveryofthebinaryneutronstar(BNS)mergerGW170817(Abbottetal.2017a)bytheLIGO(Aasietal.2015)andVirgo(Acerneseetal.2015)detectorsandthesimultaneousdetectionoftheshortgamma-rayburst(GRB)GRB170817A(Goldsteinetal.2017;Abbottetal.2017d)ledtoanintensefollowupcampaign(Abbottetal.2017c)thatul-timatelyidentiﬁedthekilonovatransientAT2017gfo(Coulteretal.2017)andNGC4993asthehostgalaxy.Thismulti-messengerobservationwasascientiﬁcgoldmine,leadingtotheconﬁrmationthatBNSmergersareprogenitorsofshortGRBs,aspredicteddecadesearlier(e.g.Goodman1986;Paczynski1986;Eichleretal.1989),thattheaftermathofthemergerleadstointenser-processes(Pianetal.2017)andallowedaﬁrstindependentsdeterminationoftheHubbleconstant(Abbottetal.2017b).Theseresults,whichareaselectedsubsetofthevastliter-aturethatsparkedafterwards,havebeenmadepossiblebydecade-longmethodologicalandtechnologicaleﬀorts.FromtheGWside,whichisourareaofexpertise,thediscoveryofGW170817wasenabledbynotonlythedetectors,butbythedevelopmentofonlinesearchpipelines,suchasMBTA(Aubinetal.2021),pycbc(Usmanetal.2016),gstlal(Sachdevetal.2019)andcWB(Klimenkoetal.2016),thatwereabletoidentifytheGWtriggeralmostinstantly.Thetriggerac-tivatedthenrapidlocalizationalgorithmssuchasbayestar(Singer&Price2016)toproduceaﬁrstestimateofthesourcelocationtoreleasetotheastronomicalcommunityforitto?E-mail:stefano.rinaldi@phd.unipi.itbeginthehuntforacounterpart.Atthesametime,morein-depthparameterestimationalgorithms,suchasLALInference(Veitchetal.2015)orBilby(Ashtonetal.2019;Romero-Shawetal.2020),starttheirendeavourtoupdateandreﬁnetheinitialbayestarvolumemapsandhenceeasetheastronomershuntforacounterpart(Singeretal.2016b,a).Thiswholeprocesshappened–andstilldoeshappen–ontimescalesthatrangefromsecondstominutes,fromtheonlinesearchtothebayestarinitialvolumemap,tohoursforaﬁrstaccurateparameterestimationreleaseoftheGWsourcepositioninthevolume.GW170817demonstratesthatthewholeprocessisextremelysuccessful.However,thehoursgapinbetweentheﬁrstbayestarmapandtheﬁnalMarkovChainMonteCarlo(MCMC)is,inouropinion,stillanunacceptablylongtimefortheastronomerscommunitytowaitforupdatedlocalizationinformation.Inthisletter,weproposeasolutiontothisproblem.OursolutionisbasedonBayesiannon-parametricsandledtothedevelopmentofanalgorithmwhichwenamedfigaroforFastInferenceforGWAstronomy,Research&Observations.figaroispubliclyavailableathttps://github.com/sterinaldi/figaro.Themainfeatures,andpointofdeparturesfromanypreviouseﬀorts,offigaroarethereconstructionofthethree-dimensionalposteriordistribu-tionoverskypositionandluminositydistanceofaGWsourcefrompartialMCMCresultsintermsofanalyticalfunctions(amixtureofmultivariatenormaldistributions)thatcanbeusedto(i)estimatecredibleregionsinthethreeandtwodimensionallocalizationspace;(ii)assesstheconvergenceoftheunderlyingMCMCbylookingattheinformationentropyofthereconstructeddistribution;(iii)evaluatetheprobability©2022TheAuthorsarXiv:2205.07252v2  [astro-ph.IM]  1 Sep 20222S.RinaldiandW.DelPozzothananygalaxyisthehostoftheGWeventwithoutrelyingonapixelisation(e.g.G´orskietal.2005)ofthesky.AlloftheabovepointshappensimultaneouslywithanMCMCrunandaddinsigniﬁcantoverheadtothesampleritself.Therestoftheletteristhusorganisedasfollows:inSec.2webrieﬂyreviewtheDirichletprocessGaussianmixturemodelthatisthebackboneoffigaro.InSec.3wedescribeoursolutiontothevolumelocalizationofaGWsourceinrealtime(withrespecttoaMCMCrun)andthegenerationoftheprobabilityrankedlistofpotentialgalaxyhosts.WeconcludewithsomeconsiderationsinSec.4.Themoretechnicalpoints,suchastheuseoftheinformationentropytoassesstheconvergenceoffigaroaswellasananalysisofitsrobustnessviaso-calledpp-plotsarepresentedinSupplementaryMaterial,AppendixAandB,respectively.2DENSITYESTIMATEInthissectionwebrieﬂyreviewtheDirichletprocess(DP)andDirichletprocessGaussianmixturemodel(DPGMM)toprovidethereaderwiththenecessarybackgroundforfigaro.However,acomprehensivedescriptionofthemodelandcom-putationalmethodisbeyondthescopeofthisletter,hencewerefertheinterestedreadertoDelPozzoetal.(2018),whereasimilarideawasﬁrstexplored,andtoRinaldi&DelPozzo(2022)wherethedetailsofthemethod(anditshierarchicalgeneralisation)andofthesamplingalgorithmaredescribed.TodevelopanintuitionofaDPandoftheDPGMM,beginbyconsideringanexperimentwhoseoutcomescanassumeaﬁnitenumberofvalues,sayK,andimaginedrawingacertainnumberofsamplesN.EachoftheKpossibleoutcomescanbethoughtofasaseparate,knownapriori,“class”ofoutcomes.Ifthesamplesareexchangeable,theorderinwhichtheyaredrawndoesnotmatter;theonlyrelevantinformationishowmanytimesweobservedeachoftheKclasses,n={n1,...,nK}withPKini=N.Givenn,wewishtoinfertheprobabilitiesq={q1,...,qK}associatedwitheachoftheKclasses.ThisisdoneviaBayes’theorem:p(q|n)∝p(n|q)p(q).(1)wherethelikelihoodfortheobservedcountsisamultinomialdistributionp(n|q)=N!QKini!KYiqnii.(2)andthepriordistributionfortheprobabilitiesqisaDirichletdistribution(DD)p(q|h,α)=Dir(q|α)=Γ(α)QKiΓ(αhi)KYiqαhi−1i,(3)whereh={h1,...,hK}isadiscreteprobabilitydistribution,hencePihi=1.Thevectorhandtheparameterαcom-pletelycharacterisetheDD:histhemean–expectedvalue–forqandαquantiﬁeshowconcentratedaroundhthevectorqis.Beingconjugatetothemultinomialdistribution,theposterioronqisstillaDD:p(q|n,h,α)=Γ(α+N)QKiΓ(αhi+ni)KYiqni+αhi−1i.(4)Considernowthecaseiswhichthenumberof“classes”isunknown.Hence,apriori,theycouldbecountablyinﬁnite.TheproblemcanstillbesolvedbyintroducingtheDirichletprocess(DP),theinﬁnitedimensionalgeneralisationoftheDD.Assigningprobabilitiestoaninﬁnitesetmightseemanhopelesstask,howeveranobserverwillalwaysrecordaﬁnitenumberofoutcomes.ThisﬁnitesetofoutcomeswillthenbedescribedbyaDD.However,theDPtakesintoaccountthepossibilitythatthereare–aformallyinﬁnite–setofoutcomesthathavenotbeenrecordedyet.SimilarlytotheDD,theDPisparametrizedbya(continuous)basedistributionH,whichplaystheroleofh,andaconcentrationparameterα,asbefore.ADPisparticularlyusefulinthedeﬁnitionoftheDirichletprocessGaussianmixturemodel(Escobar&West1995).ThepurposeistorepresentarbitraryprobabilitydistributionsasaninﬁnitemixtureofmultivariateGaussiandistributions(Rasmussen2000):p(x)=∞Xk=1wkN(x|µk,σk),(5)wherePkwk=1andµkandσkarethemeanvectorandcovariancematrixofamultivariateGaussiandistribution,denotedbyN.ThewayinwhichtheDPentersinthepictureisbyprovidingapracticalwayofinferringthemixingpropor-tionsandrelativemeansµ={µk}k=1,...,∞andcovariancesσ={σk}k=1,...,∞fromsomeobservationX.ApplyingBayes’theorem:p(w,µ,σ|X)∝p(X|w,µ,σ)p(w,µ,σ).(6)DrawingsamplesfromaGaussianmixtureisdoneviaGibbssampling:drawoneofthecomponentswithprobabilitywkandfromthatcomponentdrawasamplefromtheGaussiandistribution.Eachsamplewillbethereforeassociatedwithaspeciﬁccomponent.Thisinformationisstoredinanindicatorvariablezicontainingthelabelofthecomponentthesamplehasbeendrawnfrom.GivenasetofsamplesX,thevectorz={z1,...,zN}andassumingasymmetric–uniforminthew–DPprioronw,itispossibletowritetheprobabilitydistributionforw,p(w|z,α)=Γ(N+α)QKiΓ(ni+α/N)KYiwni+α/N−1i,(7)wherenidenotesthenumberofsamplesassociatedwithcomponenti,andforµiandσi:p(µi,σi|X,z)∝p({xj|zj=i}|µi,σi,z)p(µi,σi).(8)ItisalsopossibletoderivetheconditionalprobabilitythatanewdatapointxN+1isdrawnfromoneofthealreadyobservedmixturecomponentsp(zN+1=j|xN+1,z,X,α)==njN+αZp(x|µj,σj,X,z)p(µj,σj|X,z)dµjdσj(9a)aswellasfromapreviouslyunobservedcomponentp(zN+1=new|xN+1,z,X,α)=αN+α.(9b)ThepracticalpowerofaDPGMMisthis:thereisnoneedtoassignapriorianexpectednumberofcomponentstoexplaintheobserveddata,butwecanletthedatatellushowmanyweneed.Therefore,togetadrawfrom(6)givenasetofsamplesXfromthetargetdistributionp(x):MNRAS000,1–6(2022)FIGARO3(i)Drawasampleofz:startingwithnosamplesatall,iterativelyaddonesampleatatimetothemixture,drawingzifromEqs.(9)conditionedonlyonthepreviouslyaddedsamples;(ii)Onceallthesampleshavebeenadded,drawasampleofw,µandσfromEqs.(7)and(8)conditionedonthepreviouslydrawnzortaketheexpectedvaluefromthesamedistributions1;(iii)Repeatthesetwosteps,alwaysstartingfromanemptymixtureandshuﬄingtheorderinwhichthesamplesareaddedtoit,untilthedesirednumberofw,µandσisaccumulated.Sincetheprobabilitydistributionsforw,µandσarecon-ditionedontheobservedz,theyareupdatedeverytimeanewsampleisaddedtothepool.Hence,ifthesamplesaredrawnbysomesamplingalgorithm–aMCMCalgorithm,forinstance,oranykindofsamplingalgorithmthatisabletoproduceindependentsamplesduringitsrun–aDPGMMcanbeupdatedasthesamplerisrunning,thereforewecanesti-matetheposteriordistributionatanystageoftherunitselftoprovideup-to-dateestimatesofcredibleregions,aswellasananalyticalrepresentationoftheyetunknownMCMCtargetdistribution.Inanutshell,thisiswhatfigarodoes:byreadingthecurrentstateofanyMCMCsampler,itprovidesaDPGMMrepresentationoftheposteriordistributionfortheskypositionandluminositydistancetoaGWsourceatthestageatwhichthesampleris.ItisthereforepossibletoproduceintermediatevolumemapsandupdatethelocalizationinformationonashorttimescalethanhavingtowaitfortheexpensiveMCMCrunstoﬁnish.3VOLUMERECONSTRUCTIONANDSKYLOCALIZATIONWhileinprinciplefigarocouldbeappliedtothefullparam-eterspace,forthisworkwefocusontheskyposition(rightascensionαanddeclinationδ)andluminositydistanceDL.Ouralgorithmproceedsasfollows;asaMCMCisrunning,figaroreadsthecurrentsetofsamplesfromtheposteriorforα,δandDLand,usingthedensityestimationschemewedescribedintheprevioussection,itreconstructsthecurrentsnapshotofthefullthreedimensionalposteriordistributionasamixtureofmultivariateGaussiandistributions.figarothenproceedsatevaluatingthe3Dmaponauser-deﬁnedgridthatcanbemarginalisedtoobtainatwo-dimensionalskymapforthelocationoftheGWhost.TheprocedureisrepeatedatanyﬁxednumberofnewMCMCsamples,untilweestimatetheconvergenceofthedensityestimationviatheinformationentropy,seeSupplementaryMaterial,AppendixA.WedecidedtoworkintermsofnumberofMCMCsamplessincetheactualwalltimedependsquitedramaticallyonthewaveformmodeladoptedfortheanalysisaswellasonthesamplerused,(e.g.Veitchetal.2015,TableVI).Inthemostoptimisticcase,onecanadoptawalltimeperindependentsampleof3stogetanideaoftheactualtime.Thecom-putationaltimeaddedbyfigaroisnegligiblebeing,fora3-dimensionaldistribution,approximately500µspersample.1Weoptedforthelatter,inourimplementationofthisalgorithm.Itisimportant,however,topointoutthefactthatthesam-plesfromaMCMCmustbehandledwithcare.Theinitialpartofachain,theso-calledburn-in,isnotrepresentativeofthetruedistribution:theinformationentropyofthedistribu-tion(seeappendixA),however,heavilyﬂuctuatesduringtheburn-inphase,indicatingthatthemapisstillunreliable.Asecond,moreimportant,issuetoaddressisthecorrelationamongsamplesproducedbytheMCMC–oneofthefoundingassumptionoftheDPGMMisthefactthatthesamplesareindependent.Werecommendtoensure,e.g.bymeanofsomeautocorrelationcomputationscript,thatthesamplesfedtofigaroareindependent.However,weobservedthateveninthecaseofcorrelatedsamples,themainfeaturesofthetargetdistribution,suchas90%credibleregions,areapproximatelycorrect.Todemonstratetheeﬃcacyofourproposedscheme,weanalysedthepubliclyavailableposteriorsamplesreleasedonGWOSC(Abbottetal.2021c)andsimulatedtheaboveap-proachbyproducingresultsfromfigarousinganincrementalnumberofsamples.AnexampleofthemarginalskypositionposteriorforGW190909canbeseeninFig.1,whereweshowtheevolutionofthe90percentand50percentcredibleregionsasafunctionofthenumberofsamplesaccumulatedbytheMCMC.Weobtaina90percentcredibleregionof4619.4deg2whereasAbbottetal.(2021b)reports,forthesameevent,a90percentcredibleregionof4700deg2.Asafurthercomparison,Figure2showsthefigaroskymapforGW150914(Abbottetal.2016)asreconstructedusingtheposteriorsamplesfromthegravitationalwavecatalogueGWTC–3(Abbottetal.2021a).3.1ExploitinggalaxycataloguesCurrentstrategiesforEMfollowup,seeforinstanceCoughlinetal.(2018)andreferencestherein,implytheadoptionoftilingalgorithms,aimedatschedulingtelescopeobservationsinordertooptimisesomepre-deﬁnedmetric–e.g.minimisethenumberofpointingsormaximisetheprobabilityofobserv-ingagivencounterpartatﬁxedmagnitude–giventhetimeallocationoneachtelescope.Aspointedoutearlier,figarothree-dimensionaldensityestimatesareanalytical,hencetheycanbeevaluatedeﬃcientlyoveranypointintheparameterspacetoprovidethevalueoftheprobabilitydensityatthatpoint,includingthestandardpixelisationschemesrequiredbytilingalgorithms.Wewouldliketohighlightthat,sincesearchoptimiza-tionpipelinessuchasgwemopt,presentedinCoughlinetal.(2018),aretriggeredbyskymapsprovidedbytheGWlo-calisationalgorithms,aslongastheformatinwhichtheseskymapsareprovidedishomogeneous,thewayinwhichtheyareproducedshouldnotaﬀectthesepipelines.LookingattheﬂowchartinFigure1oftheaforementionedpaper,figaroispositionedupstreamoftheGraceDBbranch.WeproposetoexploittheanalyticalformoftheDPGMMposteriorinordertomaximisetheprobabilityofidentifyingthepotentialhostofaGWevent,asweshallseeinthissection.TherapiddecayofthefaintlightcurveforGW170817(Droutetal.2017)andtheexpectedsimilarbehaviourforotherkilonovaesignals(Chaseetal.2022)suggestthatasuccessfulEMfollowupcampaignshouldplantoidentifythehostoftheGWeventassoonaspossible,ideallywithintheﬁrst36hoursoftheGWtransient.ConsideringthattheexpecteddetectionMNRAS000,1–6(2022)4S.RinaldiandW.DelPozzo0123456α−1.5−1.0−0.50.00.51.01.5δ90%90%50%50%50%50%CR:277.5deg290%CR:18210.3deg240samples0123456α−1.5−1.0−0.50.00.51.01.5δ90%90%90%90%90%50%50%50%50%50%50%CR:850.6deg290%CR:3985.7deg2160samples0123456α−1.5−1.0−0.50.00.51.01.5δ90%90%50%50%50%CR:1101.3deg290%CR:4660.5deg2640samples0123456α−1.5−1.0−0.50.00.51.01.5δ90%90%50%50%50%CR:1225.7deg290%CR:4766.2deg25120samples0123456α−1.5−1.0−0.50.00.51.01.5δ90%90%50%50%50%CR:1206.9deg290%CR:4619.4deg219366samplesFigure1.EvolutionofGW190909skymapwiththenumberofMCMCsamples.Thenumberofavailablesamplesgoesfrom40toabout8000(indicatedineachpanel)andincreasesfromlefttoright.Asthenumberofsamplesincludedintheanalysisincreases,thecredibleregionsreconstructedbyfigaroevolveaccordingly.0123456α−1.5−1.0−0.50.00.51.01.5δ90%50%50%CR:59.4deg290%CR:219.7deg28350samplesFigure2.SkymapforGW150914.Weobtaina90percentcredibleregionof219.7deg2,whereasAbbottetal.(2019)reports,forthesameevent,acredibleregionof182deg2.rangefortheLVKnetworkinO4andO5isexpectedtoreachO(100)MpcforBNS,therapidhostidentiﬁcationbecomesevenmorecritical,giventhelimitedsensitivityofrapidEMfollowuptelescopes.Callf(x)theDPGMMinferredbyfigaro,withx≡(α,δ,DL);givenalistofknowngalaxypositionsxg,wecancomputetheprobabilitydensitiesf(x1),...,f(xn)andsortthemindecreasingordertoprovideaprobability-rankedlistofpotentialhoststoaGW.Thepossibilityofdoingsoinrealtimeisamajordeparturefromanyotheralgorithms.Moreover,thelistcanbeupdatedatanytimefigaroreleasesanewdensityestimatefromanon-goingMCMCrun.Weap-pliedthismethodtoGW170817usingtheGLADE+catalog(D´alyaetal.2021).Wefollowedtheprocedureoutlinedintheprevioussection,byprogressivelyincludingmoreandmoreMCMCsamplestoourDPGMMinferenceandproducedalistofpotentialgalactichoststogetherwiththetwoandthree-dimensionalcredibleregions.TheresultofourexperimentisshowninFig.3.Thisshowstheevolutionofthegalaxieswithinthe90percentcrediblevolumeforGW170817,colouredaccordingtotheprobabilityofbeingthehost.NGC4993,thehostgalaxy,ishighlightedwithagreencircle.BeingGW170817averywelllocalizedevent,thenumberofpotentialhostsforthiseventisquitesmall,sometensofgalaxies.Thetruehostturnsouttobewithinthesegalaxiesevenwithasmallnumberofsamples.Wereportthe5mostprobablegalaxiesforeachofthefourskymapspresentedinFigure3inTable1.Thetruehost(NGC4993)isalwaysinthelistofthetop5mostprobablehosts,evenafterhavingonly40MCMCsamples.Assumingareasonablewalltimepersampleof5s,thisimpliesthatwithfigaroafterjust200sofMCMCrun-time,thetruehostwouldhavebeenthethirdgalaxytopointatforasuccessfulidentiﬁcation.4DISCUSSIONANDCONCLUSIONSWepresentedfigaro,afastandreliablevolumereconstruc-tionmethodbasedonaDPGMM.Wedemonstratedtheeﬃcacyofthemethodincorrectlyreconstructingthetwoandthreedimensionalprobabilitydensityfunctionsanditisabletoconsistentlyestimatecredibleregions,asshowninSupple-mentaryMaterial,AppendixB,evenwhendeclaringearlyconvergencebasedontheinformationentropy.Furthermore,wehaveshownwhatweregardasthemainadvantageoffi-garocomparedtootherrapidlocalizationalgorithmssuchasthepreviouslymentionedbayestar:usingtheanalyticalformMNRAS000,1–6(2022)FIGARO540samples160samples1280samples5042samplesLEDA803966ESO575-55ESO575-55ESO575-55ESO575-55LEDA803966LEDA803966NGC4993NGC4993NGC4993NGC4993LEDA803966ESO575-53ESO575-53ESO575-53ESO575-53LEDA1696636dFGSgJ130832.3-2320506dFGSgJ130832.3-2320506dFGSgJ130832.3-232050Table1.Listofthetop5mostprobablehoststoGW170817asidentiﬁedbyevaluatingthefigarodensityreconstructionovertheGLADE+catalogue.ThetruehostNGC4993isalwaysinthelist,alsoextremelyearlyintherunanditisthesecondmostprobablehostwhen5042sampleshavebeenaccumulated.oftheprobabilitydensityfunction,wecanevaluateitonanyavailablegalaxywithinthereconstructedvolumeandprovidealistofpotentialhostsrankedbyprobabilitybasedonthein-formationencodedintheGWsignal.InthisletterwefocusedexclusivelyonlocalizationinformationfromGWaloneanddisregardedanyotherinformationaboutgalaxyluminositiesorclass.Thisinformationis,however,easilyfoldedinthehostprobabilitycalculation,e.g.byassuminganadditionalweightbasedonaSchectherluminosityfunction.ThislatterpointalsohelpsaddressoneofthepossibleissueswithourproposedrankingmodelforO4,O5andsubsequentobservationruns.AstheglobalnetworkofGWdetectorsex-pandswiththeinclusionofKAGRA(Akutsuetal.2021)andtheforeseenLIGO-India(Iyeretal.2011)anditssensitivityincreases,thetypicaldistanceatwhichpotentialEMcounter-partsalsoincreases(Abbottetal.2018;Pankowetal.2020)andweendupinregionswherethecurrentgalaxycataloguessuﬀerfrombeingincomplete.Thisisapotentialproblem,althoughindependentofouralgorithm,butwedonotregardthisasashowstopper.ItisinfactplausibletoassumethatifaGWislocalizedinagalaxy,theprobabilitythatanygalaxywillbethehostmustbeproportionaltothegalaxystellarmass,hencetothegalaxyluminosity(Artaleetal.2020a,b).Inotherwords,moreluminousgalaxiesaremorelikelytobethehostsofaGW.Moreluminousgalaxiesarealsoseenuptogreaterdistancesforaﬁxedsurveysensitivity,hencearealsomorelikelytobeincludedingalaxycatalogues:thisstrategyisinquiredinGehrelsetal.(2016).Wethereforeconcludethatprovidingalistofpotentialhostsbasedonprobabilitywillstillbeaveryvaluabletoolforastronomers,evenwhenthebaselinecatalogueisdeemedincompleteattheGWeventdistance.DATAAVAILABILITYfigaroisavailableathttps://github.com/sterinaldi/figaro.Examplesandinstructionsonhowtousethecodeareavailableontherepository.GWTC–3dataareavailableinGWOSCathttps://www.gw-openscience.org/.TheF2Ydatasetisavailableathttps://www.ligo.org/scientists/first2years/.ACKNOWLEDGMENTSTheauthorswouldliketoacknowledgethediscussionsandinteractionswiththeParameterEstimationgroupandtheLow-LatencygroupoftheLIGO-Virgo-KagraCollaborationthatimprovedthiswork.WewouldalsoliketothankChristo-pherP.L.Berry,MaricaBranchesi,EdoardoMilotti,VeronicaRoccatagliata,StevenN.Shore,LeoP.Singerandtheanony-mousrefereeforusefulcommentsanddiscussions.ThisresearchhasmadeuseofdataorsoftwareobtainedfromtheGravitationalWaveOpenScienceCenter(gw-openscience.org),aserviceofLIGOLaboratory,theLIGOScientiﬁcCollaboration,theVirgoCollaboration,andKA-GRA.LIGOLaboratoryandAdvancedLIGOarefundedbytheUnitedStatesNationalScienceFoundation(NSF)aswellastheScienceandTechnologyFacilitiesCouncil(STFC)oftheUnitedKingdom,theMax-Planck-Society(MPS),andtheStateofNiedersachsen/Germanyforsupportoftheconstruc-tionofAdvancedLIGOandconstructionandoperationoftheGEO600detector.AdditionalsupportforAdvancedLIGOwasprovidedbytheAustralianResearchCouncil.Virgoisfunded,throughtheEuropeanGravitationalObservatory(EGO),bytheFrenchCentreNationaldeRechercheScientiﬁque(CNRS),theItalianIstitutoNazionalediFisicaNucleare(INFN)andtheDutchNikhef,withcontributionsbyinstitutionsfromBelgium,Germany,Greece,Hungary,Ireland,Japan,Monaco,Poland,Portugal,Spain.TheconstructionandoperationofKAGRAarefundedbyMinistryofEducation,Culture,Sports,ScienceandTechnology(MEXT),andJapanSoci-etyforthePromotionofScience(JSPS),NationalResearchFoundation(NRF)andMinistryofScienceandICT(MSIT)inKorea,AcademiaSinica(AS)andtheMinistryofScienceandTechnology(MoST)inTaiwan.TheDigitizedSkySurveyswereproducedattheSpaceTele-scopeScienceInstituteunderU.S.GovernmentgrantNAGW-2166.Theimagesofthesesurveysarebasedonphoto-graphicdataobtainedusingtheOschinSchmidtTelescopeonPalomarMountainandtheUKSchmidtTelescope.Theplateswereprocessedintothepresentcompresseddigitalformwiththepermissionoftheseinstitutions.TheNationalGeographicSociety-PalomarObservatorySkyAtlas(POSS-I)wasmadebytheCaliforniaInstituteofTechnologywithgrantsfromtheNationalGeographicSociety.TheSecondPalomarOb-servatorySkySurvey(POSS-II)wasmadebytheCaliforniaInstituteofTechnologywithfundsfromtheNationalSci-enceFoundation,theNationalGeographicSociety,theSloanFoundation,theSamuelOschinFoundation,andtheEastmanKodakCorporation.TheOschinSchmidtTelescopeisoper-atedbytheCaliforniaInstituteofTechnologyandPalomarObservatory.TheUKSchmidtTelescopewasoperatedbytheRoyalObservatoryEdinburgh,withfundingfromtheUKSci-enceandEngineeringResearchCouncil(latertheUKParticlePhysicsandAstronomyResearchCouncil),until1988June,andthereafterbytheAnglo-AustralianObservatory.TheblueplatesofthesouthernSkyAtlasanditsEquatorialExtension(togetherknownastheSERC-J),aswellastheEquatorialRed(ER),andtheSecondEpoch[red]Survey(SES)werealltakenwiththeUKSchmidt.Supplementalfundingforsky-surveyworkattheSTScIisprovidedbytheEuropeanSouthernObservatory.MNRAS000,1–6(2022)6S.RinaldiandW.DelPozzo13h16m12m08m04m−21◦−22◦−23◦−24◦−25◦−26◦αδ50%CR:18.5deg290%CR:71.8deg2NGC4993111galaxies1234phost13h16m12m08m04m−21◦−22◦−23◦−24◦−25◦−26◦αδ50%CR:10.6deg290%CR:41.1deg2NGC499370galaxies12345678phost13h16m12m08m04m−21◦−22◦−23◦−24◦−25◦−26◦αδ50%CR:5.6deg290%CR:22.0deg2NGC499340galaxies2468101214phost13h16m12m08m04m−21◦−22◦−23◦−24◦−25◦−26◦αδ50%CR:5.1deg290%CR:19.7deg2NGC499338galaxies2468101214phostFigure3.EvolutionofpotentialgalaxyhostsforGW170817withthenumberofPEsamples.Thenumberofsamplesisrespectively,fromtoptobottom,40,160,1280and5042.Galaxieswithinthe90percentcrediblevolumearemarkedbycrossescolouredaccordingtotheprobabilityofthegalaxyofbeingthehostconditionedonlyontheinformationcomingfromtheGW.NGC4993ishighlightedbyagreencircle.TheﬁvemostprobablegalaxiesforeachskymaparereportedinTable1.BackgroundimagesaretakenfromtheDigitizedSkySurveys(DSS).ReferencesAasiJ.,etal.,2015,Class.Quant.Grav.,32,074001AbbottB.P.,etal.,2016,Phys.Rev.Lett.,116,061102AbbottB.P.,etal.,2017a,Phys.Rev.Lett.,119,161101AbbottB.P.,etal.,2017b,Nature,551,85AbbottB.P.,etal.,2017c,ApJ,848,L12AbbottB.P.,etal.,2017d,ApJ,848,L13AbbottB.P.,etal.,2018,LivingReviewsinRelativity,21,3AbbottB.P.,etal.,2019,PhysicalReviewX,9,031040AbbottR.,etal.,2021a,arXive-prints,p.arXiv:2111.03606AbbottR.,etal.,2021b,PhysicalReviewX,11,021053AbbottR.,etal.,2021c,SoftwareX,13,100658AcerneseF.,etal.,2015,Class.Quant.Grav.,32,024001AkutsuT.,etal.,2021,ProgressofTheoreticalandExperimentalPhysics,2021,05A101ArtaleM.C.,MapelliM.,BouﬀanaisY.,GiacobboN.,PasquatoM.,SperaM.,2020a,MNRAS,491,3419ArtaleM.C.,BouﬀanaisY.,MapelliM.,GiacobboN.,SabhaN.B.,SantoliquidoF.,PasquatoM.,SperaM.,2020b,MNRAS,495,1841AshtonG.,etal.,2019,ApJS,241,27AubinF.,etal.,2021,Class.Quant.Grav.,38,095004ChaseE.A.,etal.,2022,ApJ,927,163CoughlinM.W.,etal.,2018,MonthlyNoticesoftheRoyalAstro-nomicalSociety,478,692CoulterD.A.,etal.,2017,Science,358,1556D´alyaG.,etal.,2021,arXive-prints,p.arXiv:2110.06184DelPozzoW.,BerryC.P.L.,GhoshA.,HainesT.S.F.,SingerL.P.,VecchioA.,2018,MNRAS,479,601DroutM.R.,etal.,2017,Science,358,1570EichlerD.,LivioM.,PiranT.,SchrammD.N.,1989,Nature,340,126EscobarM.D.,WestM.,1995,JournaloftheAmericanStatisticalAssociation,90,577GehrelsN.,CannizzoJ.K.,KannerJ.,KasliwalM.M.,NissankeS.,SingerL.P.,2016,ApJ,820,136GoldsteinA.,etal.,2017,ApJ,848,L14GoodmanJ.,1986,ApJ,308,L47G´orskiK.M.,HivonE.,BandayA.J.,WandeltB.D.,HansenF.K.,ReineckeM.,BartelmannM.,2005,ApJ,622,759IyerB.,SouradeepT.,UnnikrishnanC.,DhurandharS.,RajaS.,AnandS.,2011,LIGO-India,ProposaloftheConsortiumforIndianInitiativeinGravitational-waveObservations(IndIGO),https://dcc.ligo.org/LIGO-M1100296/publicKlimenkoS.,etal.,2016,Phys.Rev.D,93,042004PaczynskiB.,1986,ApJ,308,L43PankowC.,RizzoM.,RaoK.,BerryC.P.L.,KalogeraV.,2020,ApJ,902,71PianE.,etal.,2017,Nature,551,67RasmussenC.,2000,inSollaS.,LeenT.,M¨ullerK.,eds,Vol.12,AdvancesinNeuralInformationProcessingSys-tems.MITPress,https://proceedings.neurips.cc/paper/1999/file/97d98119037c5b8a9663cb21fb8ebf47-Paper.pdfRinaldiS.,DelPozzoW.,2022,MNRAS,509,5454Romero-ShawI.M.,etal.,2020,MNRAS,499,3295SachdevS.,etal.,2019,arXive-printsSingerL.P.,PriceL.R.,2016,Phys.Rev.D,93,024013SingerL.P.,etal.,2016a,ApJS,226,10SingerL.P.,etal.,2016b,ApJ,829,L15UsmanS.A.,etal.,2016,Class.Quant.Grav.,33,215004VeitchJ.,etal.,2015,Phys.Rev.D,91,042003ThispaperhasbeentypesetfromaTEX/LATEXﬁlepreparedbytheauthor.MNRAS000,1–6(2022)MNRAS000,1–2(2022)PreprintSeptember5,2022CompiledusingMNRASLATEXstyleﬁlev3.0RapidlocalizationofgravitationalwavehostswithFIGARO-SupplementaryMaterialsStefanoRinaldi1,2?andWalterDelPozzo1,21DipartimentodiFisica“E.Fermi”,Universit`adiPisa,I-56127Pisa,Italy2INFN,SezionediPisa,I-56127Pisa,ItalyAcceptedXXX.ReceivedYYY;inoriginalformZZZAPPENDIXA:ENTROPYFigure1demonstratesthat,astheinferenceproceeds,theskymapsdrasticallyaltertheirappearanceduringaMCMCrun.WearguedthattomaximisetheprobabilityofdetectinganEMcounterparttoaGW,itisimperativetoreleaseskymapsandlistsofpotentialtargetsassoonaspossible.Ontheotherhand,releasingtheseproductstooearlyintherun,whenweknowthattheMCMCisstillfarfromconvergence,wouldbemeaninglessandresultinwastedresourcesandeﬀortsfromtheastronomersside.Itisthereforenecessarytoestablishacriteriontodeterminethe“goodness”ofalocalization,withoutknowingwhattheﬁnalposteriorwillbe.Necessarily,wewillhavetodeﬁnesomearbitrarythreshold,sotherearenocorrectanswers,butonlyusefulones.Hereweproposeasolutionbasedontheinformationentropycontentofthereconstructeddistribution.Theinformationentropyofadiscretedistribution{pk},introducedbyShannon(?),isS=−Xkpklogpk.(A1)anddescribeshowmuchinformationisstoredintheprobabil-itydistributionitself1.figarousestheinformationchangeinthereconstructedprobabilitydistributionbyaddingeverynewMCMCsampletothelistofobservedoutcomes.Asthefigarodistributionconvergestowardsthe“ﬁnal”distribu-tion,theamountofinformationthateachsamplecontributesshouldasymptoticallygotozero,hencetheinformationen-tropyinthereconstructedprobabilitydensityshouldgotoitslimitingvalue,ultimatelydeterminedbytheproperties,likesignal-to-noiseratio,ofthesignalitself.WedeﬁnetheentropyasafunctionofthenumberofsamplesNusing(A1)asS(N)=−Xkp(N)klogp(N)k,(A2)where{pk(x)(N)}kisthedistributionobtainedwithNsam-ples.Thisquantityisexpectedtoreachaplateau,thusitsderivativedS(N)dNisexpectedtogotozero.Unfortunately,pN(x)isarealisationfromastochasticprocess,hencethe1Forthereaderslessfamiliarwithinformationtheory,weprovideanintuitiveinterpretationoftheterm“information”inthiscontext.Theinformationinaprobabilitydistribution,measuredtypicallyinbits,canbethoughtofasthelengthofthemessageIneedtosendtosomeone,forthatsomeonetobeabletopredict,inastatisticalsense,theoutcomesofsuccessivedrawsfromthegivenprobabilitydistribution.entropyS(N)anditsderivativewillexhibitﬂuctuations.Nev-ertheless,oncetheplateauisreached,dS(N)dNwillrandomlyﬂuctuatearoundzero.Hence,wedecidedtoadoptthenum-berofzero-crossingsofdS(N)dNratherthansomeevent-speciﬁcthresholdtodecideifthefigaroreconstructionconvergedtoitstargetdistribution.Thecomputationofnumericalderiva-tivesofrandomvariablesisnottrivialeither,therefore,wedecidedtocomputeS(N)everytimeanewsampleisaddedtothepoolandthenperformalinearregressiononthevaluesofS(N)thatfallwithinawindowofﬁxedlengthL.There-gressiongivesa“ﬁltered”representationoftheentropyS(N)inthelastLsteps.Moreover,wecanthenapproximatedS(N)dNtheangularcoeﬃcientobtainedfromthislinearregression.WefoundthatL=500isagoodchoice.FigureA1showsS(N)anddS(N)dNforGW150914alongwiththeskymapproducedwiththeminimumnumberofsamplesthatsatisﬁedthezero-crossingscriterion,2446samples.Thisnumbercorrespondstoroughly30percentofallthe8350availablesamples.Inthiscaseandforillustrativepurposes,wesetthethresholdforproducingreliableskymapsat5zero-crossings.TheskymapwegetisconsistentwiththeoneinFigure2,whichisobtainedusingalltheposteriorsamples.APPENDIXB:PP-PLOTSInordertodemonstratetheeﬀectivenessofthismethod,weappliedittotheFirstTwoYearsofElectromagneticFollow-upwithAdvancedLIGOandVirgo,(?,fromnowon,F2Y)dataset.ThesimulationcampaignconsistsofthousandsofsimulatedeventsplacedinastreamofcolouredGaussiannoise.250oftheseeventshavebeenrecoveredbyareal-timedetectionpipelineandfollowedupwithstochasticsamplerstoestimatetheirparameters.WeappliedfigarototheposteriorsamplesfortheskypositionandluminositydistanceforalltheeventsavailableintheF2Ydatasetinordertoreconstructthethree-dimensionalposteriorprobabilitydensityfortheseevents.Inordertoverifytheself-consistencyoftheresults,wecomputedthefractionofeventslocatedwithinthecrediblevolume(cfr.region)atagivenprobability.Theexpectationfromaself-consistentanalysisisthatafractionPisfoundwithintheP-thcredibleregion.FigureB1showsthefractionofeventsfoundwithinthecredibleregionCRPasafunctionofP,bothforthe3Dvolumereconstructionandtheskypositionalone.Weemphasise,however,thatsincetheskymapsareconstructedbymarginalisingthefullvolumeposteriorprobabilities,the©2022TheAuthorsarXiv:2205.07252v2  [astro-ph.IM]  1 Sep 20222S.RinaldiandW.DelPozzo02000400060008000N012345S(N)[bits]2000400060008000N0.000000.000250.000500.000750.001000.001250.001500.00175dS(N)dN0123456α−1.5−1.0−0.50.00.51.01.5δ90%50%50%CR:58.4deg290%CR:231.8deg22446samplesFigureA1.Entropy(left),entropyderivative(centre)andskymap(right)forGW150914.Theskymapisproducedusing2446posteriorsamples.ThisnumberisautomaticallychosenusingthecriteriondescribedinAppendixAwith5zero-crossings.ThewindowlengthLissetto500samples.twotestsarenotindependent.Inbothcases,fullvolumeandskyposition,therecovereddistributionisinagreementwiththetheoreticalexpectations.Similarly,wetestedtheentropy-basedconvergencecrite-riontoestablishthethresholdnecessarytoproducereliableskymapsassoonaspossibleduringaMCMCrun.Were-peatedthesameexerciseofreconstructingthe3Dposteriordistributionbut,insteadofusingalltheavailablesamples,wecalledthereconstructionreadyassoonastheentropyderiva-tivechangedsignacertainnumberoftimes,seeAppendixA.dS(N)dNiscomputedusingawindowlengthof100samples.Thepp-plotsfor1,3and5zero-crossingsarereportedinFigureB1.Focusingonthethree-dimensionalreconstruction,weseethatinthiscasetherecovereddistributionisself-consistentfor5zero-crossings,supportingourproposalofusingthenumberofzero-crossingoftheentropyderivativeasaindicatorofconvergence.ThispaperhasbeentypesetfromaTEX/LATEXﬁlepreparedbytheauthor.MNRAS000,1–2(2022)FIGARO30.00.20.40.60.81.0P0.00.20.40.60.81.0FractionofeventswithinCRP1zero-crossing3zero-crossings5zero-crossingsAllsamples0.00.20.40.60.81.0P0.00.20.40.60.81.0FractionofeventswithinCVP1zero-crossing3zero-crossings5zero-crossingsAllsamplesFigureB1.Fractionofeventsfoundwithinasky-areacredibleregionCR(left)orcrediblevolumeCV(right)asafunctionofencompassedprobabilityP.Theexpecteddistributionisindicatedbytheblackdasheddiagonalline,whiletheshadedregionrepresentsthe95percentcredibleintervalforthecumulativedistribution,estimatedfromabetadistributionasin?.Thecoloureddashedlinesshowthecumulativedistributionsobtainedinterruptingtheposteriorreconstructionassoonasthecorrespondingentropyconditionissatisﬁedforeachevent,whilethethicksolidlineshowsthecumulativedistributionobtainedusingalltheavailablesamplesforeachevent.MNRAS000,1–2(2022)