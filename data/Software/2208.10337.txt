MNRAS000,1–20(2022)Preprint23August2022CompiledusingMNRASLATEXstyleﬁlev3.0CorrSim:AMultiwavelengthTimingObservationSimulatorJ.A.Paice1,2,3?,P.Gandhi2,R.Misra31DepartmentofPhysicsandAstronomy,UniversityofManchester,OxfordRd,Manchester,M139PL,UK1DepartmentofPhysicsandAstronomy,UniversityofSouthampton,Highﬁeld,Southampton,SO171BJ,UK2Inter-UniversityCentreforAstronomyandAstrophysics,Pune,Maharashtra411007,IndiaSubmittedtoMNRASinoriginalform2022AAAXX,Received2022AAAXX,Accepted2022AAAXXABSTRACTManyastronomicalsystemsdisplaycomplex,rapidvariabilityacrosstheelectromagneticspectrum.Studyingthisvariabilityisthekeytounderstandingtheunderlyingprocessesatplay.However,acombinationoflimitedorpatchytelescopeavailability,viewingconstraints,andtheunpredictableandfaintnatureofmanysourcesmeanthatobtainingdatawell-suitedtothistaskcanbetricky,especiallywhenitcomestosimultaneousmultiwavelengthobservations.Asaresult,researcherscanoftenﬁndthemselvestuningobservationalparametersinreal-timebytrial-and-error,ormayrealiselaterthattheirobservationwasnotlongenoughtoachievetheirgoals.Here,wepresentacodetomitigatesomeoftheseissuesandaidplanningofmultiwavelengthcoordinatedobservations.ThecodetakesatemporalandFouriermodelofasystem(i.e.PowerSpectra,Coherence,andLags)asinput,andreturnsasimulatedmultiwavelengthobservation,includingeﬀectsofnoise,telescopeparameters,andﬁnitesampling.Thegoalsofthisare:(i)Tosimulateapotentialobservation(toinformdecisionsaboutanobservation’sfeasibility);(ii)ToinvestigatehowdiﬀerentFouriermodelsaﬀectthevariabilityofthesystem(e.g.howalteringthefrequency-dependentcoherenceorFourierlagsbetweenbandscanaﬀectdataproductslikecross-correlationfunctions);and(iii)Tosimulateexistingdataandinvestigateitstrustworthiness.Weoutlinethemethodologybehindthecode,showhowavarietyofparameters(e.g.noisesources,observationlength,andtelescopechoice)canaﬀectdata,andpresentexamplesofthesoftwareinaction.Keywords:[ENTERKEYWORDS]1INTRODUCTIONWhenobservedatdiﬀerentwavelengths,manyastrophysi-calsourcescanshowstartlinglydiﬀerentsignals.Whilethesesignalsareoftenrapidandcomplex,theyareoftenallinterre-lated;theyaretheresultofsomebaseprocess(orprocesses)thatcreatedthem.Bystudyingthesediﬀerentsignals,anduncoveringtherelationshipsbetweenthem,wecanthusbegintodecodewhattheunderlyingprocessesare.Thisgeneraldescriptioncanbeappliedtomanyﬁeldsofastrophysics.Simultaneous(oratleastquasi-simultaneous)observationsonmultipletelescopeshavebeenkeytothestud-iesofsupernovae(Perleyetal.2019),MillisecondPulsars(Draghisetal.2019;Papittoetal.2019),Ultra-luminousX-raysources(Middletonetal.2017),ActiveGalacticNuclei(McHardyetal.2014),andevenKilonovae(Kasliwaletal.2017).Avaluabletestcaseisoneparticularﬁeld:thestudyofrapidvariabilityinX-rayBinaries.Notonlyarethesecom-plexsystems,withacompactobjectbeingsurroundedbyaswirlingaccretiondiscbeingfedfromacompanionstar,buttheyarealsoverydensesystems;theyareonlyafewhundredthousandtoafewmillionSchwarzchildradiiasthelargest?E-mail:johnapaice@gmail.comlengthscales.Toputthisinthetermsoftime,thedynamicaltimescale-thetimescaleatwhichmattercanﬂowbetweendiﬀerentpartsofthesystem-isontheorderofminutesfortypicalvalues(Franketal.2002).Meanwhile,thesystemsareonlyafewtensoflightsecondsacross,withlengthscalesclosetothecompactobjectofaround,andbelow,onelight-second.Thismeansthattworegions-emittingatdrasticallydiﬀerentwavelengths-canaﬀectoneotherontimescalesofminutestomilliseconds.Sincethesesourcesaresocomplexandcompact,rapid(of-tensub-second)multiwavelengthobservationsarekeytoun-derstandinghowtheirdiﬀerentregionsinteract,andwhatun-derlyingstructuresarepresent.Decadesofeﬀortherehaveresultedinagrowingcollectionofcorrelatedobservations,re-vealingcomplexlagsandrelations(forjustafewexamples,seeKanbachetal.2001;Durantetal.2008;Gandhietal.2008;Gandhietal.2010;Veledinaetal.2015;Gandhietal.2017;Paharietal.2017;Paiceetal.2019;Vincentellietal.2021).However,suchstudieshavehadseveralkeyproblemstoovercome.Forone,asimultaneousobservationbetweentwotelescopesisdiﬃculttoplan,andpronetomanyissuessuchasorbitalvisibility,day/nightcycles,packedschedules,andtheinitialdiﬃcultyofobtainingproposalsonallrequiredtele-scopes.Andonthenightofanobservation,lowcountrates,©2022TheAuthorsarXiv:2208.10337v1  [astro-ph.IM]  19 Aug 20222J.A.Paiceetal.obfuscatingnoise(bothintrinsic,suchasPoisson,andextrin-sic,suchasreadnoise),andpoorly-chosentimeresolutionscanallleadtobadorevenuselessdata.And,evenifdataareobtainedatahigh-enoughquality,itisonlynaturaltoask:Howrepresentativearethesedataofthesourceasawhole?Aﬁniteobservationtypicallycannotcapturethefullmodelofacomplexsystem;thisisparticu-larlytrueforX-rayBinaries,wherethebehaviourofasourcecanvarysuddenlyanddramaticallyoverthecourseoversev-eralweeks(see,e.g.,Veledinaetal.2017;Paiceetal.2021;Thomasetal.2022),orevenminutes(Gandhietal.2016,2017).Middletonetal.(2017)coversmanyoftheseproblemsingreaterdetail,andnotesmanyﬁeldsofstudywheresolvingthemcouldleadtosigniﬁcantadvancesinourunderstanding(includingacasestudywheresimultaneousobservationsleadtoarevolutionintheunderstandingofonesource,V404Cyg).Tosummarise,themainproblemsarethus;itisdiﬃculttoplananobservationthatwilldelivergood-qualitydata,andevenifanobservationiscarriedout,itisnottrivialtoknowifthosedatacorrespondwelltoamodelofthesource.Withtheseissuesinmind,wehavedevelopedaprogram,CorrSim.Givenbothsourceandobservationalproperties,CorrSimsimulatesanobservationandreturnvariousdataproducts,suchaslightcurves,cross-correlationfunctions,andcross-spectralanalyses.Thiswillallowforthetestingnotonlyofobservationalsetups,butalsovariousmodelsandhowtheyaﬀectthedataproduced.Inspeciﬁc,themotivationsoftheprogramare:(i)Toquantifytheminimumdatarequiredtoperformananalysis;i.e.theminimumlengthofanobservationthatwouldberequired,andwhatmagnitudeofmeasurementer-rorswouldstillproduceareliableresult.(ii)Toﬁndtheconditionsunderwhichtheshapeandsigniﬁcanceofobtainedcross-correlationfunctionscanbetrusted.(iii)Tounderstandtheeﬀectofdiﬀerentkindsofmea-surementerrorsandincoherentbroadbandnoiseonthedataanalysis.(iv)Forsmallerdatasetsand/orthosewithhighermea-surementerrors,toascertainwhichtypeofanalysiswouldprovidethemostreliableresults.(v)Toinvestigatetheambiguityoftimelagsintheanal-ysis,andinthecaseofperiodicsignalswherethetruetimelagisgreaterthanonetimeperiodaway,howtospotthisinrealdata.WewillﬁrstdetailtheworkingsandassumptionsofCorrSim(Sec.2).Wewillthenshowtheresultofputtingreal,observedsourcepropertiesintoCorrSim,andquantifyhowfactorssuchasobservationlength,noisesources,andchoiceoftelescopealtertheresultantdata(Sec.3).Wewillﬁnallydetailtwoexamplesofusingtheprogramto(i)in-formchoicesaboutahypotheticalupcomingobservation(Sec.4)and(ii)testhowmodiﬁedFouriercomponentsaﬀectthecross-correlationfunctions(Sec.5).Aglossaryofusedsym-bols(Sec.6)anddescriptionofcross-correlationandFourieranalysis(AppendixA)arealsoappendedattheendofthispaper.Wealsonotethefollowing:X-rayBinaries(XRBs)areref-erencedthroughoutthispaperasthemainmotivatingfactorbehindthework,andareusedascasestudiesinourexam-ples.However,CorrSimisbuilttobeaﬂexibleprogram,andshouldbeusefultoanymultiwavelengthastronomicalob-servationsdescribedandinvestigatedthetimeandFourierdomains.2CORRSIMWecreatedtheprogramCorrSimaspartofthisproject1.TheaimofCorrSimistopresentasimulatedresultofanobservation,andthenrunanalysisonthatresultandcompareittotheinputtedparameters.2.1InputsandOutputsTheinputsherearesplitintoSource(intrinsictotheobject)andObservation(intrinsictotheobservation)Parameters:•SourceParameters:–Meancountrates(¯A,¯B)–Unitsofcountspersecond.–FractionalRMSvalues(Frms,A,Frms,B)–unitsofper-cent.Deﬁnesthevariabilityofthelightcurves.–ModelPowerSpectra(pA,Model,pB,Model).TwopowerspectralmodeltypesaredeﬁnedinCorrSim:thesumma-tionofseveralLorentzians(Figure1),andabrokenpowerlaw(Figure2).Theshapeofthepowerspectraitselfonlyaﬀectsthelightcurve,butthedependenceofthecoherenceontimestronglyaﬀectstheshapeandstrengthofthecor-relationfunction.–ModelCoherence(γModel).ThisisdeﬁnedinCorrSimbytherelativecoherenceofdiﬀerentcomponentsinthepowerspectra.–ModelPhase/Timelags(δModel),asafunctionofFourierfrequency.Severaldiﬀerentwaystodeﬁnethelagshavebeenprovided,relatingtothedependenceofphaseortimewithFourierfrequencyineitherlog-logorsemi-logspace.–RedNoise–Boolean.–PoissonNoise–Boolean.•ObservationParameters:–ObservationLength(T)–unitsofseconds.–TimeResolution(dT)–unitsofseconds.–ScintillationNoise–Simulatesnoisefromatmosphericscintillation.Usesseveralsub-parameters:‘TelescopeDi-ameter’(m);‘TelescopeAltitude’(m);‘ExposureTime’(s);‘TargetAltitude’(◦);‘AtmosphericTurbulenceHeight’(m);andanempiricalvalue(Osbornetal.2015).–ReadoutNoise–Unitsofelectrons.Theoutputsare:(i)SimulatedLightcurvesforeachband(ii)CorrelationFunctionAnalysis(iii)FourierAnalysis(i.e.PowerSpectra,Coherence,andPhaseandTimelagsasafunctionofFourierfrequency)Someoftheseoutputshavesub-parametersforcontrollingtheirbehaviour,suchassegmentsizeandbinningforbothCorrelationFunctionandFourierAnalysis.1https://gitlab.com/astrojohnapaice/CorrSimMNRAS000,1–20(2022)CorrSim:AnObservationSimulator3Figure1.Examplesofmodelinputpowerspectra,madeupofsev-eralLorentzians.Toprow:FractionalRMSpower.Bottomrow:FractionalRMSpowermultipliedbyfrequency.EachcomponentLorentzianisplotted,aswellastheoverallsummation.NotethecoherentandincoherentLorentziansinSeriesB;somehavethesameshapebuthavediﬀerentnormalisations.Figure2.Examplesofmodelinputpowerspectra,madeupofabrokenpowerlaw.Toprow:FractionalRMSpower.Bottomrow:FractionalRMSpowermultipliedbyfrequency.Notethecoher-entandincoherentLorentziansinSeriesB,andhowthecoherentpowerlawhasadiﬀerentshapeandbreakfrequency.2.2MethodologyAﬂowchartshowingthemethodologyofCorrSimisshowninFig.3.Below,wegointodetailabouteachofthesesteps.Initially,CorrSim(optionally)adjuststheinputobserva-tionlengthinordertomaximisethespeedofthecalculations,whichgofasterwithsmallerfactors.Thisisdoneeitherbyadjustingthenumberofbinstotheclosest‘7-smooth’num-ber(anumberwithnoprimefactorlargerthan7;Berndt1994).CorrSimthencreatesthreepowerspectrafromthedetailsprovided–oneforBandA(pA),andoneforeachthecoher-Figure3.FlowchartdemonstratingtheprocessthatCorrSimusestocreateitsoutputs.entandincoherentpartsofBandB(pB,CohandPB,Increspec-tively).ItthennormalisesallthreetomatchthefractionalRMSvaluesgiven.RednoiseisthenaddedtoeachPowerSpectrum,ifdesired.Inthenextfewsteps,CorrSimwillcreatethetwosimu-latedlightcurvesfromthepowerspectra(SAandSB),usingmethodologysetoutinTimmer&Koenig(1995)(andhenceusestheirassumptions-e.g.thattherandomnessintheresul-tanttimeseriescomesonlyfromrandomisingthephasesandnottheamplitudesaswell).CorrSimﬁrstturnsthepowerspectraandtheinputlagsintocomplexseries;notethatwemustﬁrstcreatethreecomplexseries(SA,SB,coh,andSB,inc),oneforeachpowerspectrum,totakeintoaccountthecoher-entandincoherentpartsofBandB.Thesquarerootofallthreepowerspectraareﬁrsttakentobetheamplitudesofthreecomplexseries,andtheﬁrstbinisadjustedtobeequalto¯AN(or¯BN),whereNisthenumberofbins(apartfromMNRAS000,1–20(2022)4J.A.Paiceetal.SB,inc,wheretheﬁrstbinissettoequalzero).Thephasesofthecomplexseriesarethenrandomly,andseparately,gener-atedforBandAandtheincoherentpartofBandB(δAandδB,Increspectively).Then,thecoherentBandBphasesδB,Coharecalculatedthusly:δB,Coh=δA−δModel(1)whereδModelarethemodelphasesgivenasinputs.Theam-plitudesandargumentsarethencombinedintothreecomplexseries(SA,SB,coh,andSB,inc),andthenthecoherentandin-coherentcomplexseriesofBandBaresummedtogethertocreateasinglecomplexseriesforthatband:SB=SB,coh+SB,inc(2)ThesetworesultantcomplexseriesareinverselyFouriertransformedtocreatealightcurveforeachband.Finally,Poisson,scintillationandreadoutnoisearethen(optionally)addedtoeach,tocreatetheﬁnalsimulatedlightcurves.ThisisthecruxofCorrSim;theselightcurvessimulatethedatatakenofanobservedsource,i.e.animperfectrepre-sentationofthetruerelationshipbetweensignals,andareareanalogoustoarealobservationgiventhevarioussourceandobservationalparametersinput.Theselightcurvesarenotonlyplottedgraphically,butalsooutputtedascomma-separatedtextﬁles,incaseuserswishtousethemwiththeirowncode.Ifdesired,atthispoint,CorrSimessentiallyworksinreverse;ittakesthoselightcurvesandrunsbothCross-CorrelationandFourieranalysisonthem,asonewouldforreal,observeddata.MuchoftheFourieranalysisusesfunc-tionsfromStingrayforthecalculations.ExamplesoftheplotscreatedareseeninSection2.4.2.2.1ModellingtheCorrelationFunctionTheCorrelationFunction(CF)istheinverseFouriertrans-formofthecoherenceandlags,andthusamodelofthefunc-tioncanbereproducedpurelyfromtheseproperties.ThisisbasedonthemathematicaldeﬁnitionsofcoherencepresentedinVaughan&Nowak(1997),andisdeﬁnedinSectionA1.InCorrSim,amodeloftheCorrelationFunctionisproducedfromtheinitialcoherenceandlaginputs,andthemethodol-ogyisdescribedhere.AFouriertransformcreatesacomplexseries,whichcanbewhollydescribedbyitsamplitudeanditsarguments.Theamplitudeofthisseriesisdeﬁnedas:U=γModel∗p(pA)(FrmsA)∗(pB)(FrmsB))(3)whereUistheamplitude,γModelisthemodelCoherence,andpandFrmsarethepowerspectraandfractionalRMSvalues(foreachbandAandB).Theargumentsarethentakentobethephaselags.ThiscomplexseriesistheninverseFouriertransformed,andtherealpartistaken.Theresultisnormalisedwithaconstant(V)thusly:V=12∗dT∗√FrmsA∗FrmsB(4)wheredTisthetimeresolutionofthedata.Afterthenor-malisationisapplied,theﬁnalproductisthemodelCorrela-tionFunction.2.2.2ConvertingPhasetoTimePhaselags,whencombinedwiththefrequencytheyarefoundat,canbeconvertedtotimelagsusingEquationA11.However,thereisalimitationtophaselags;CorrSimadoptstheconventionthatphaselagsaregivenbetween±π.Iftheactualphaselagsareoutsideofthisrange,saybetweenπand2πradians,thenCorrSimwillshowthattheyarebetween−πand0radiansduetothecyclicalnatureofsinewaves.Thislimitationpassesontotimelags;a’true’timelagthatisbetween+πand+2πradiansinphasewillberepresentedasanegativetimelag.Thereisasolution–or,atleast,amitigation–tothis.Byusingthecorrelationfunction,wecanseewheresourcesofcorrelation(oranti-correlation)areoccurringandﬁndwhichfrequencybinsaremostlikelytobecorrect.Then,assumingthatphaselagsfollowareasonablycontinuousdistribution,weshiftthemby±2πradianstominimisediscontinuities.ThismethodisintrinsictoCorrSim.A‘ReferenceFre-quency’parameterisset(default1Hz)whichisassumedtobecorrect.Then,CorrSimlooksatthenextlowestfrequency.Thatpointiscomparedtothemeanofthepreviousthreepoints.Ifthediﬀerenceisgreaterthanπ,itandallpointsatlowerfrequenciesthanthisoneareshiftedby±2πtomin-imisethediscontinuity.Thisisrepeatedforeveryfrequencybin.Thesameprocedureisthenconducted,butinsteadgoingtohigherfrequencies.Thesecorrectedphaselags2arethenconvertedtotimelagsusingtheaboveequation.Thisisamethodthathasitsdrawbacks–anyprocessesconstrainedtojustasinglefrequencybin,suchasQuasi-PeriodicOscillations,maybemorethanπawayfromphaselagsinadjacentbins,andthiswillthusbemisrepresentedinthetimelags.Closeinspectionofthetimelagplots,andcomparisonwiththeCF,mayberequiredtoinvestigatethispossibility.2.3Assumptions,ModelsandNoiseSeveralassumptionshavebeenmadeinproducingCorrSim–thesehavebeenforsimplicityandeaseofuse,andnoneshouldstronglyaﬀecttheprimaryresults.Theyaredetailedhere.(i)PowerSpectraThebrokenpowerlaw,anditshandlingofcoherence,isasimpliﬁcationofthebehaviourofasource.Lorentzians,whilealsobeinglimitedintheirownways,oﬀermuchﬁnercontrol.(ii)PhaseandTimeLagsCorrSimapproximatesthephaseandtimelagsusingase-riesofconstant,linear,powerlaw,orpolynomialdistribu-tions.Thisdoesnottriviallyhandlethetruelagbehaviour–whichmaybebetterrepresentedbyotherdistributions–buttheversatilityofCorrSiminbeingabletohandleany2Thecorrectedphaselagsthemselvesarenotplotted;thephaselagsshownaretheonesgainedfromtheFourieranalysis,withoutanyshifting.MNRAS000,1–20(2022)CorrSim:AnObservationSimulator5numberofsegmentsmitigatesthissimpliﬁcation.Incalcu-latingthetimelags,CorrSimalsoassumesthatphaselagsareroughlycontinuousanddonotdeviatebymorethanπradiansbetweenfrequencybins.(iii)Simultaneous,ContinuousLightcurvesCorrSimcreateslightcurvesthataresimultaneous,sampledatthesamerate,andhavenogaps,andassumesthisisthecaseduringitsanalysis.Whilethisisnotwhollyrealisticformostmultiwavelengthobservations,itservesasagoodapproximation,andthesimultaneoussamplingvastlyspeedsupthecalculationofthecorrelationfunction.Ifauserwishestoanalysealightcurvethatisaﬀectedbygaps,thentheymaytakethelightcurvedatathatCorrSimgeneratesandcreatethegapsmanually,andthenusetheirowncodetodotheanalysis.(iv)NoiseCorrSimcurrentlyallowsforfoursourcesofnoise.Thewaythisnoiseiscalculatedisasimpliﬁcationofprocesseswithinthesourceandtheinstrument.Theirmethodsaredetailedhere.(a)Rednoise.Thisisnoisethatismoresigniﬁcantathigherpowers.UsingmethodssetoutinTimmer&Koenig(1995),thisnoiseismodelledbydrawingtworandomGaussiannumbersandthenmultiplyingthembyavalueproportionaltothemodelpowerspectraforeachfrequencybin.Thesetworesultantnumbersthenbecometherealandimaginarypartsofthecomplexarraywhichwilllatercre-atethelightcurve.(b)Poissonnoise.Thisnoiseaccountsforrandomvari-ationinthesource.Thisismodelledbytakingthelightcurve,andforeachbin,drawingarandomnumberfromaPoissondistribution(λ=countsinthatbin).(c)Scintillationnoise.Thisnoisearisesfromscintilla-tionseenbyground-basedtelescopes,causedbyvariationsintheatmosphere.CorrSimusesamodiﬁedversionofYoung’sapproximation,presentedinEquation7ofOsbornetal.(2015),whichisobservation-andtelescope-speciﬁc;therequiredparametersincludethetelescope’sdiameterandaltitude,thedistanceofthesourcefromzenith,theheightofatmosphericturbulence,exposuretime,andanempirical,telescope-speciﬁcconstant.Theequationgivesthevarianceofthescintillationnoise.Therefore,thisnoiseismodelledbytakingthelightcurve,andforeachbin,drawingarandomnumberfromaGaussiandistribution,withmean=countsinthatbin,andstandarddeviation=squarerootofYoung’sapproximation.(d)Readoutnoise.ThisnoisearisesfromtheimperfectampliﬁcationofasignalintheCCD,wherethetruechargeonanumberofelectronsismisread.ThisnoiseismodelledbydrawingfromaGaussiandistributioncentredonzero,withstandarddeviation=readoutnoiseinelectrons,foreachbin,andthenaddingthatnumberontothevalueofthebin.2.4OutputsFigure4showstheproducedlightcurvesandboththeinputandoutputcorrelationfunctions.Figure5showsexamplesofbothinputsandoutputsofCorrSim,andsomeobservationparameters.TheFourierpropertiesofthisexamplearebasedondatafromtheX-rayBinaryMAXIJ1820+070.Theinputparam-eters,suchastheFrms,powerspectra,andphaselags,areallapproximationstothosefoundintheanalysiscarriedoutbyPaiceetal.(2021),duringepoch4(itsinitialrisinghardstate,25daysafterpeakX-raybrightness,37daysaftertheoutburstwasﬁrstdetected).Meanwhile,thenoiseparametershavebeenselectedtocorrespondwithanOptical(BandA)andX-ray(BandB)observation(takenbytheHiPERCAMinstrumentattheGranTelescopioCanarias,RoquedeLosMuchachos,LaPalmaandtheNICERinstrumentontheISSrespectively).3DISCUSSIONI:COMPARISONOFPARAMETERSThesesimulationsallowustocomparediﬀerentaspectsofobservations,andseetheireﬀectsontheﬁnalproductswithrespecttotheinitialmodels.Inthissection,wewilldetailhowseveraldiﬀerentparameterscanaﬀecttheﬁnalproducts.TherearemanyparametersthatcanbevariedwithCorrSim,andnotallcanbeshownhere;moreﬁgurescanbeseenintheSupplementaryMaterial,foundonline.Asanexample,Figures6–8demonstratetheeﬀectsofvaryingtheobservationlength,thecountrate,andthetargetaltitude.EachﬁgureshowsthreediﬀerentsetupsanddetailstheireﬀectonthesimulatedCCFandFourieroutputs.Themodelsaregivenbyblacklines,andtheoutputsbycolouredlines.TheﬁrstrowistheCrossCorrelationFunction,withtheshadedregionindicatingthestandarderror;notethatthemodelCCFdoesnottakeeﬀectsofnoiseintoaccount,whichreducescoherenceandthusthecorrelationcoeﬃcient;themodelCCFthereforemaynotapproximateaCCFcreatedfromatheoreticallyinﬁniteobservation,andwouldinsteadhaveagreatermagnitude.Thesecondrowshowsthepowerspectra.TheblackdashedlinesarethemodelBandApowerspectra,withlightercoloureduncertaintiesrepresentingtheiroutputs,andtheblackdottedlinesarethemodelBandBpowerspectrawiththedarkercoloureduncertaintiesrepresentingtheiroutputs.LiketheCCF,themodelpowerspectradonottaketheeﬀectsofnoiseintoaccount.Thethirdrowshowsthecoherence.Thesemodels,liketheCCFandpowerspectra,donottaketheeﬀectsofnoiseintoaccount.Thefourthrowshowsthephaselags.Thisisconstrainedbetween±π,andadditionalmodelsatnormalisationsof±2πarealsoshown;the‘middle’model,dominantat1Hz,isthe‘correct’one.Modelphaselagsarenotaﬀectedbynoisesources.Theﬁfthrowshowsthetimelags.Solidblacklinesshowthemodeltimelags,whiledashedblacklinesshowtheinversemodeltimelags,forrepresentingnegativelags.Similarly,thesolidcolouredcirclesshowtheoutputs,andtheopencolouredcirclesshowtheirinverse.Timelagsareﬁxedatadeﬁnedref-erencefrequency,andthenshifteddependingonwhatcausesthesmallestdiscontinuities,asdescribedinSection2.2.2.Astheyarecalculatedfromthephaselags,themodeltimelagsarealsonotaﬀectedbynoisesources.Tables1–3showthedefaultinputsforthesetests(i.e.thevaluesthatwillbeusedunlessspeciﬁedotherwise);theseap-proximateareasonablybrightsourceobservedwithagoodtelescope.TheLorentzianandPhaseLagdistributionsinTa-MNRAS000,1–20(2022)6J.A.Paiceetal.Figure4.TheﬁrsthalfofacompilationplotprovidedbyCorrSim.Top,Middle:100s,10s,and2ssegmentsoftheproducedlightcurves(BandA,blue;bandB,red).The100ssegmenthasamovingaveragefunctionappliedoverﬁftypoints.Thedashedlinesrepresenttherangesoftheinsets.Bottom:Model(left)andsimulated(right)CCFs(BandBversusBandA,i.e.apeakatpositivelagsshowsBandBlaggingBandA),withthelatteralsoshowingtherangeoverwhichitwasaveraged.ThemodelCCFwascalculatedfromtheinputCoherence,PowerSpectra,andLags(seeFigure5,whilethereproducedCCFwasproducedfromthelightcurves.bles2&3areapproximationstotherealFourierpropertiesfoundintheX-rayBinaryMAXIJ1820+070duringitsApril2018hardstate(seeSec.2.4).3.1ErrorDependencyForthefollowingtests,allparameterswerekeptasthoseinTables1–3,unlessotherwisestated.Notethatthesedataareempirical,obtainedfromasinglerunofCorrSimeachtime,ratherthanmodelvalues.3.1.1ErrorintheCorrelationFunctionAnotherwaytoillustratehowdiﬀerentparametersaﬀecttheobservationisbylookingatthestandarderrorintheCCF.Theassumptionhereisthatiftheerrorislower,thesimulatedCCFwillbeclosertothetruemodelshape.WeranCorrSimagainwitheightdiﬀerentlengthsofobser-vation(64,128,256,512,1024,2048,4096,and8192seconds).ACCFwasconstructedfrom30ssegments,andstandarder-rorwascalculatedforeachbinfromthosesegments,asusual.Forthisdemonstration,themiddlethirdoftheCCFwasse-lected(from-10sto+10slags),andthenthemeanandtheMNRAS000,1–20(2022)CorrSim:AnObservationSimulator7Figure5.ThesecondhalfofacompilationplotprovidedbyCorrSim–inputFourierproperties(left)andresultsfromFourieranalysisofthelightcurves(right).Sincetheoutputsarecalculatedbysplittingupthelightcurveandaveragingoverseveralsegments,theyonlycoverasmallerrange;blackdashedboxesontheleftrepresentthisrange.FirstRow:PowerSpectraofBandA(blue)andB(red).CorrSimhasattemptedtoremovePoissonnoiseinthebands.SecondRow:Thecoherencebetweenthebands.Notehowthepresenceofuncorrelatednoisereducestheinputcoherence.ThirdRow:Thephaselags.Fortheoutput,sincephaselagsoutsideof±πaremeaningless,theplotwrapsaroundattheseranges.FourthRow:Thetimelags.Negativetimelagsarerepresentedasadashedlinefortheinput,andopencirclesfortheoutput.InCorrSim,areferencepointcangivenforcalculatingthetimelagsfromthephaselags,i.e.statingatwhichfrequencythephaselagscanbetrustedtobethetruevalue,andnotmultiplesof2πpriororhence.BottomInformation:Keyinputvalues.Forthenoisesources,theletters(A,B,AB,orn)representwhichbandsthatnoiseispresentin,ifany.standarddeviationofthestandarderrorwerecalculated.TheresultsareplottedinFigure9.3.1.2PercentageErrorintheFourierComponentsWecanalsolookatthemagnitudeoftheerrors.Forthis,weassumethatsmallererrorsmeanthattheobservationisclosertothemodel3.Byvaryingaparameter,wecanthusseehowmuchitaﬀectstheaccuracyoftheobservationbyquantifyingthechangeinmagnitudeoftheerror(relativetothevalueofthebin).3WeconsiderthisareasonableaxiomforillustrativepurposesMNRAS000,1–20(2022)8J.A.Paiceetal.Figure6.ThreediﬀerentrunsofCorrSimwithdiﬀerentlengthsofobservations;256s,1024s,and4096s(withatimeresolutionof2−5(0.004)s,thisisequivalentto213,215,and217binsrespectively)withdefaultnoiseadded.Notethesigniﬁcantdeviationathigherfrequencies,especiallywithshorterobservations.Thecorrelationfunctionandcoherencearealsolower,eveninthelongestobservations–themodelcorrelationfunctionandcoherencedonotpredictthedeviationduetonoise.MNRAS000,1–20(2022)CorrSim:AnObservationSimulator9Figure7.ThreediﬀerentrunsoftheCorrSimcodewithdiﬀerentcountrates;10cts/s,100cts/s,and1000cts/sforBandA(and50,500,and5000cts/sforBandBrespectively).NotehowthelowercountrateshavesigniﬁcantlylowercoherenceandmagnitudesoftheCCF.AlsoseehowpowerspectracanberecoveredmuchmoreeasilythanotherFourierproducts.MNRAS000,1–20(2022)10J.A.Paiceetal.Figure8.ThreerunsofCorrSimwithdiﬀerenttargetaltitudesanditseﬀectonscintillationnoise;10◦,25◦,and40◦.Allothernoisesourceswereturnedoﬀforthesesimulations,andscintillationnoisewasonlyappliedtoBandB(tosimulateaSpace+Groundbasedobservation).Allotherscintillationnoisevalueswerekeptatdefaults.Notehowscintillationnoisestronglyaﬀectsatargetat10◦,yethasminimaleﬀectonatargetat40◦(andthushigheraltitudes).MNRAS000,1–20(2022)CorrSim:AnObservationSimulator11Table1.Defaultvaluesforthecomparisondata.GroupParameterDefaultValueNotesObservationLengthofObservation(s)2048TimeResolution(s)0.03125=2−5BandAMeanCountRate(cts/s)1000FractionalRMS(%)0.31RedNoise?(Y/N)YPoissonNoise?(Y/N)YScintillationNoise?(Y/N)NReadoutNoise?(Y/N)NBandBMeanCountRate(cts/s)5000FractionalRMS(%)0.11RedNoise?(Y/N)YPoissonNoise?(Y/N)YScintillationNoise?(Y/N)YSeeFootnote1ReadoutNoise?(Y/N)Y4.5electronsFourierPowerSpectraModelLorenztiansSeeTable2LagModelPhaseSeeTable3PlottingCCFRange(s)30CCFBinning0FourierSegmentLength(Bins)212FourierRebinningFactor1.3ReferenceFrequency(Hz)1SeeFootnote21Usingreasonablevalues,analogoustotheNewTechnologyTelescope(NTT)atLaSilla,Chile(Tarenghi&Wilson1989):TelescopeDiameter=3.58m;TelescopeAltitude=2375m;ExposureTime=TimeResolution-1.5ms(i.e.‘Deadtime’of1.5ms);TargetAltitude=40◦;TurbulenceHeight=8000;EmpiricalCoeﬃcientCY=1.52Frequencyatwhichthephaselagisbeassumedtobecorrect(i.e.notshiftedby±2π)Table2.LorentziansparametersBandABandBNormWidthMidpointNormWidthMidpointCoherenceFraction450.50750.101/2004040500.10.11/5250.150.145201/150100.10.3643033331080120250Table3.PhaseLagParameters1.DistributionFreq.12Lag13Freq.22Lag23Freq.32Lag33Constant(Phase)0.001-4π/30.02---Power0.02-4π/30.252π/5--Linear0.252π/50.40--Linear0.405π--Polynomial5π200π285π/21Outsideofthespeciﬁedfrequencies,thelagissetto3π/42UnitsofHz3UnitsofRadiansSimilartotheprevioussection,weranCorrSimagainwitheightdiﬀerentlengthsofobservation(64,128,256,512,1024,2048,4096,and8192seconds),whiletheFourierSegmentLengthwassetto210bins.Fourierplotsweremadeforeachrun.Then,foreachofthePowerSpectra,Coherence,andTimeLags,themedianabsolutepercentageerrorwascalcu-latedoverallbins.TheresultsareplottedinFigure10.3.1.3DetectingaSub-SecondLagWecanalsovaryhowcorrelatedthelightcurvesare,andﬁndhowthataﬀectstheresultantCCF.Forthis,wealteredtheBandBLorentzians:allcoherencefractionsweresetto0,andthenthesecondLorentzianwassettoanormalisationof10andamidpointof1.Itscoherencefractionwasthenvaried,andtheresultantCCFwasplottedineachinstance.Figure11showsaselectionoftheresults.Asexpected,MNRAS000,1–20(2022)12J.A.Paiceetal.Figure9.EmpiricaldependencyofthestandarderrorintheCCF–anditsstandarddeviation–onobservationlength.Figure10.Empiricaldependencyofthemedianabsolutepercentageerroronobservationlength.whilethesub-secondlagisclearlyidentiﬁableatacoherencefractionof1,itisalmostcompletelygoneatafractionof0.001.Underthesesourceandobservationalconditions,thisgraphcanthustellusthatacoherencefractionof0.01istheminimumtodetectasub-secondlag,whilevaluesofatleast0.1aremuchpreferred.4DISCUSSIONII:EXAMPLEUSAGEWewillnowdemonstratehowanastronomermayuseCorrSimtoplanandmaximiseanobservation.LetussaytheywanttoobserveasourcesimilartothatgiveninTables1&2,butwithalowercountrate(100and1000counts/sinbandsAandBrespectively),andtheyhave1024sofob-servationtimewithatimeresolutionof0.03s(2−5).Thesourcehasbeenknowntoshowabroadprecognitiondipandasub-secondlag,aswellasasmallfeatureinthephaselags(describedinTable4).Itisthelattertwoinparticular–thesub-secondlagandthefeatureinthephaselags–thattheobserverwantstostudy.ByrunningCorrSimwiththeseparameters,ourastronomergetswhatisshowninFigure12.Initially,theyarenotpleasedwiththeresults–thesignal-to-noiseratio(S/N)istoolowFigure11.FourCCFscreatedbyvaryingthecoherencefractionofasingleLorentzianat1Hz,withallotherLorentziansat0coherence.Notehowthemagnitudeofthesub-secondlagchangeswitheachcoherencefraction.Representativeerrorsareplotted.fortheirpurposes,withthefeatureinthephaselagsindis-tinguishablefromrandomvariations,andthesub-secondlagnotasclearnorassmoothashoped.Nowtheyhaveseenthattheirplanwouldnotgivethemwhattheywant,theymakeadecisiontochangethesetupoftheobservation.Whatcanourastronomerdo?Theyhaveaselectionofpossibilitiesinfrontofthem,butordinarily,itmightmainlyinvolveguesswork(andluck)todecidebetweenthem.Fromtheiroptions,theywanttoinvestigatethreepossibilities:•1:Doubletheobservationlength.Byincreasingthelengthoftheobservation,onewouldincreasetheS/N.•2:Decreasetimeresolutionbyafactoroffour.Smallertimebinscancauseproblemslikereadoutnoisetobecomemoresigniﬁcant,ormissingsomephotonsduetodeadtime.Increasingthebinsize,andthusloweringthetimeresolution,wouldreducesucheﬀects.•3:Usingabettertelescope.Fortunately,ourintrepidas-tronomerknowsofanothertelescopetheycanuseforBandA.Thistelescopehasﬁvetimesthesensitivity(i.e.themeancountrateinBandAwouldbecome500)buttheycanonlyuseitforhalfthetime(i.e.observationlengthwouldbe512s).Isthereanetbeneﬁttousingthistelescope?Byalteringtheparameters,ourastronomerrunsthepro-gramwithallthesealternativepossibilities.Figure13showstheresults.Theresultingsimulationsshowthatthelongerobservationgivesagoodapproximationtothephaselags.Meanwhile,thelowerresolutionobservationgivesthehighestnormalisationintheCCF,andlessuncertaintyinthecoherencevalues.Finally,thebettertelescopehasalowerwhitenoiseﬂoor(i.e.thenoisedoesnotdominatethepowerspectrauntilhigherfrequenciesthanusual;notethediﬀerenceinpowerspectra).Theseareallimportantindiﬀerentways.Fortheinvesti-gationthe0.1slag,thelongerobservationoﬀersgoodS/N,andthealternativetelescopehasalowerwhite-noiseﬂooratthatfrequency.Meanwhile,thelowertimeresolutionbetterreplicatesthefrequencyrangeoftheuniquefeatureinthephaselags.Eitherway,theynowhavethisadditionalinformationwithwhichtheycanmaketheirdecision,whichinturncanleadtobetterdata.Thisability–toaskthesequestionsandgetinformativeanswers–iswhatCorrSimhopestoprovide.MNRAS000,1–20(2022)CorrSim:AnObservationSimulator13Table4.Example–PhaseLagParameters1.DistributionFreq.12Lag13Freq.22Lag23Freq32Lag33Linear0.13π/40.25π/5--Linear0.25π/50.32π/3--Linear0.32π/30.40--Linear0.405π--Polynomial5π200π285π/21Outsideofthespeciﬁedfrequencies,thelagissetto3π/42UnitsofHz3UnitsofRadiansFigure12.Fourierinputsandoutputsfortheexampleobservation.Notethelackofclarityintheoutputs,especiallyinthephaselags,comparedtotheinputs.MNRAS000,1–20(2022)14J.A.Paiceetal.Figure13.ThreemodiﬁedrunsofFigure12;doubletheobservationlength,fourtimeslowertimeresolution,andaﬁvetimesmoresensitivetelescopewithhalftheobservingtime.Eachsimulationhasbeenaveragedovereightbins.Notehoweachoptionhasbeneﬁtsanddrawbacks.MNRAS000,1–20(2022)CorrSim:AnObservationSimulator155DISCUSSIONIII:MODELTESTINGSofar,wehaveshowntheeﬀectofalteringparameters–bothobservationalandintrinsic–onresultantlightcurvesandtheirFourierproducts,andinparticular,thestrengthofCorrSiminsimulatingtheseeﬀects.AnotherstrengthofCorrSimisrecreatingapreviously-carriedoutobservation,andthenmodifyingvariousFourierparameterstoinvestigatehowtheyaﬀectotheroutputs,suchasthelightcurvesandcross-correlationfunctions.Withthis,onecantestvariousdiﬀerentmodelsofasource.ThiskindofanalysiswascarriedoutonMAXIJ1820+070,whichcanbeseeninSection4.5andAppendixA2ofPaiceetal.(2021).TheﬁguresshowingthesimulationshavebeenreplicatedinFigure14.Thisparticularanalysiswasmoti-vatedbyawishtoinvestigateanegative-lagcorrelationthathadappearedintheCCFofoneoftheepochs;thiscorre-lationwasnotpresentinanyotherepoch(mostofwhichhadevenhadanegative-laganti-correlationinstead),andwastheorisedtobeconnectedtoaQuasi-PeriodicOscilla-tion(QPO)alsopresentinthesource.ItwashopedthattheFouriercomponentsthatwerecreatingthisfeaturecouldbeidentiﬁed.ThisanalysiswascarriedoutbyﬁrstﬁndingtheFourierpropertiesofarealobservationofMAXIJ1820+070,andthenmodellingtheminCorrSim.Thesepropertieswerethenalteredtocreatefourvariations:theoriginal,uneditedmodelofthesource;aneditedmodelwiththeQPOremoved;aneditedmodelwithastretchofnegativelagsremoved(butkeepingtheQPO);andaneditedmodelwithboththeQPOandthenegativelagsremoved.BycreatingsimulatedCCFsfromeachofthemodels,itwasthusdeterminedthatthenegative-lagcorrelatedcompo-nentwascausedbyamixofboththeQPOandthenegativelagsworkingconstructively.RemovingeachindependentlycreatedCCFswhichstillshowanegative-lagcorrelation,butatalowersigniﬁcance.Removingbothcompletelyremovesthecomponent,insteadgivingaCCFproﬁlewithaslightanti-correlationatnegativelagsandanextendedcorrelationatpositivelags,similartothoseseenearlierinthesource,oreveninothersourcessuchasSwiftJ1753.5-0127(Durantetal.2008).Fromthis,theimportanceofbothofthesefeatureswasconcluded:Firstly,thattheQPOhadasigniﬁcanteﬀectontheCCF,andsuchfeaturesshouldbeconsideredinfutureobservationsasapossibleobfuscatingfactor;Secondly,thatarelativelysmallextentofnegativelagscanhaveasignif-icanteﬀectontheresultantCCF,evenwithouttheaddedcoherenceofaQPO.Studieslikethiscanbevaluableforfutureobservations.TheycanallowfortestingofalternativeFourierinputstoseehowvariabilitychanges–andthuswhichcomponentsaremostimportant.TheycanalsoallowforinvestigatingwhichFourierinputsandcombinationscreatesimilarCCFs,therebytestingalternativeexplanationsforalready-knownfeatures.Ineithercase,thesestudieshavethepotentialtogivevaluableinsightintotheinnerprocessesofXRBs.6CONCLUSIONSFirstandforemost,wehaveintroducedCorrSim,atoolforsimulatingtwocorrelatedlightcurvesbasedonavarietyofpa-rameters,bothintrinsictothesource(e.g.Meancountrate,Powerspectra,timelags),andtheobservation(e.g.observa-tionlengthandtelescopediameter).Throughthisprogram,wehaveshownhowamyriadofdiﬀerentparameterscanaﬀecttheresultsofanobservation;bothparametersintrinsictothesourceandcausedbyourownobservations.Wehavealsoshownhowtheseeﬀectsarenotalwaysclear;ahigheramountofrelativenoiseisexpectedtoaﬀectthevariabilityandshowupinthepowerspectra,butdoesnottypicallyleadonetoimagineareductioninthecorrelationfunction,asweseeinthesupplementarymaterial.Someoftheseparameterscanaﬀectobservationsinsig-niﬁcant,butsometimesunclear,ways;theeﬀectsofasmalltelescopeoralowaltitudetargetareknowntobedetrimen-tal,butsometimessuchparameterscannotbehelpedandanastronomermaywonderaboutthequalityofthedatatheycouldobtaindespitethis.Thisprogrampresentsawaytoanswerthesequestions.Andtheseanswerscanhaveaverypracticalside;morethanjustadjustingexpectations,onecanadjusttheparametersoftheobservationtomakesurethatanydatagainedwillbeofgoodquality.Thisistheﬁrstaimoftheprogram:Toprovideastronomerswithbothqualitativeandquantitativemetricswithwhichtheycanassessthequalityoftheresultantdata,andthenchangetheobservationalsetuptooptimisethem.Inthisway,theprogramcanbeatooltoactivelyincreasethequalityoffutureobservations.Wealsodemonstratedhowthisprogramcanbeusedtosimulatediﬀerentpropertiesofasource,showingapracticalexamplethatwascarriedoutinPaiceetal.(2021).There,thephaselagsweremanipulatedtoremovearangeofnegativelags,aQuasi-PeriodicOscillation,andthenboth,inordertoseetheeﬀectonthecorrelationfunction.Fromthesesimula-tions,itwasconcludedthatthepresenceofacorrelationatnegativeopticallagsisprobablynotanindicationofanop-ticalprocessoccurringbeforeanX-rayprocess,butinsteadismorelikelyaperiodicX-rayprocesshavinganopticalre-sponseatalaggreaterthanπradiansinphase.Thisdemonstratesthesecondaimofthisprogram:toallowastronomerstheabilitytotakemodelsofalready-obtaineddataandchangetheminordertobetterunderstandtheirmakeup,assesstheirvalidity,andthusinformthemofthecomponentsofthesystem.Throughtheseabilities,CorrSimcanbeofsigniﬁcantas-sistancetoastronomersacrossthetimelineofanobservation,andwillhelpinincreasingthefrequency,usefulness,andqual-ityofrapidcorrelatedobservationsinthefuture.ACKNOWLEDGEMENTSWeacknowledgesupportfromSTFCandaUGC-UKIERIThematicPartnership.JAPispartsupportedbyaUniversityofSouthamptonCentralVCScholarship,andacknowledgessupportfromtheERCundertheEuropeanUnion’sHorizon2020researchandinnovationprogramme(grantagreementNo.715051;Spiders).JAPalsothanksDAshtonforspectralMNRAS000,1–20(2022)16J.A.Paiceetal.Figure14.VarioussimulationsofMAXIJ1820+070,ascarriedoutinPaiceetal.(2021).Eachcolumnshowstwosimulationsoftheisband(optical)vsX-rays.Top:InputFouriercomponents.Ally-axesareshared.Bottom:CCFsmadebyconvertingtheFouriercomponentsintolightcurvesandthencross-correlating.CCFswereaveragedovermultiple10ssegments.Notethatthey-axesarenotshared.Left:Theredlinesareacloserepresentationofthedata.ThebluelinesareamodiﬁcationthatremovestheQPOandthenegativelagsfromtheisband’sFouriercomponentsbetween0.02–2Hz.Right:ThegreenlinesareamodiﬁcationthatjustremovestheQPO,andthegoldlinesareamodiﬁcationthatjustremovesthenegativelags.NotehowthebehaviourintheCCFchangesbetween-2and+3s,showingthesigniﬁcanceofeachcomponentoverthisrange.MNRAS000,1–20(2022)CorrSim:AnObservationSimulator17Table5.ListofSymbolsA(t)SignalAB(t)SignalBC(f)MeasuredCross-Spectrumc(τ)CorrelationCoeﬃcientDNormalisationforLdTTimeResolutionFrmsFractionalRMSfFrequency;dependantvariableofC,L,yf0MidpointforLfsegNumberofFrequenciesperSegmentiImaginaryNumberL(f)LorentzianmNumberofSegmentsNNumberofBinsnNoise(InPowerSpectra)pPowerSpectraqFormulashorthandinerroronγ2IRrms2FractionalRMSnormalisationSComplexSeriessSignal(NoiselessPowerSpectra)TObservationLengthtTime;dependantvariableofA,B,XUAmplitude(inPowerSpectralcalculations)VNormalisation(inPowerSpectralcalculations)X(t)InverseFourierTransformofy(f)y(f)FourierTransformofX(t)ΓFull-WidthatHalf-MaximumforLγ2I(f)IntrinsicCoherenceγModelModelCoherence∆TsampSamplingIntervalδLagsδτTimeLagsδφPhaseLagτLag;dependantvariableofctiminghelp,aswellasAStevensandDHuppenkothenforhelpwiththeStingraysoftware.SomesimulationswerebasedonobservationsbyGTC/HiPERCAMandNICER;wethanktheobserversfortheHiPERCAMobservations,VikDhillonandStuartLittlefair,andwealsothankKeithGendreau,Za-venArzoumanian,andtherestoftheNICERteamfortheirassistance.SMARTNethelpedtocoordinatethoseobserva-tions.ThisresearchmadeuseofsoftwareandwebtoolsfromtheHighEnergyAstrophysicsScienceArchiveResearchCen-ter(HEASARC).DATAAVAILABILITYSTATEMENTAlldatausedwithinthispaper(i.e.allsimulateddataonwhichtheﬁguresweregenerated)willbesharedonreasonablerequesttothecorrespondingauthor.Theprogramusedtogeneratethesedataisavailableathttps://gitlab.com/astrojohnapaice/CorrSim.GLOSSARYTable5givesalistanddeﬁnitionofallthesymbolsusedinthispaper.REFERENCESBendatJ.S.,PiersolA.G.,2000,MeasurementScienceandTech-nology,11,1825BerndtB.,1994,Ramanujan’snotebooks.PartIV.Springer,Ger-many,doi:10.1007/978-1-4612-0879-2DraghisP.,RomaniR.W.,FilippenkoA.V.,BrinkT.G.,ZhengW.,HalpernJ.P.,CamiloF.,2019,TheAstrophysicalJournal,883,108DurantM.,etal.,2008,ApJ,682,L45FrankJ.,KingA.,RaineD.J.,2002,AccretionPowerinAstro-physics:ThirdEdition.CambridgeUniversityPressGandhiP.,etal.,2008,MNRAS,390,L29GandhiP.,etal.,2010,MNRAS,407,2166GandhiP.,etal.,2016,MNRAS,459,554GandhiP.,etal.,2017,NatureAstronomy,1,859HuppenkothenD.,etal.,2019,ApJ,881,39KanbachG.,etal.,2001,Nature,414,180KasliwalM.M.,etal.,2017,Science,358,1559LewinW.H.G.,vanderKlisM.,2006,CompactStellarX-raySources.Vol.39,CambridgeUniversityPressMcHardyI.M.,etal.,2014,MNRAS,444,1469MiddletonM.J.,etal.,2017,NewAstron.Rev.,79,26MisraR.,BoraA.,DewanganG.,2018,AstronomyandComput-ing,23,83MiyamotoS.,KimuraK.,KitamotoS.,DotaniT.,EbisawaK.,1991,ApJ,383,784OsbornJ.,F¨ohringD.,DhillonV.S.,WilsonR.W.,2015,MNRAS,452,1707PahariM.,etal.,2017,MNRAS,469,193PaiceJ.A.,etal.,2019,MNRAS,490,L62PaiceJ.A.,etal.,2021,arXive-prints,p.arXiv:2105.11769PapittoA.,etal.,2019,TheAstrophysicalJournal,882,104PerleyD.A.,etal.,2019,MNRAS,484,1031TarenghiM.,WilsonR.N.,1989,inRoddierF.J.,ed.,Vol.1114,ActiveTelescopeSystems.SPIE,pp302–313,doi:10.1117/12.960835,https://doi.org/10.1117/12.960835ThomasJ.K.,CharlesP.A.,BuckleyD.A.H.,KotzeM.M.,LasotaJ.-P.,PotterS.B.,SteinerJ.F.,PaiceJ.A.,2022,MNRAS,509,1062TimmerJ.,KoenigM.,1995,A&A,300,707UttleyP.,CasellaP.,2014,SpaceScienceReviews,183,453VaughanB.A.,NowakM.A.,1997,ApJ,474,L43VaughanS.,EdelsonR.,WarwickR.S.,UttleyP.,2003,MNRAS,345,1271VeledinaA.,RevnivtsevM.G.,DurantM.,GandhiP.,PoutanenJ.,2015,MNRAS,454,2855VeledinaA.,GandhiP.,HynesR.,KajavaJ.J.E.,TsygankovS.S.,RevnivtsevM.G.,DurantM.,PoutanenJ.,2017,MNRAS,470,48VenablesW.N.,RipleyB.D.,2002,ModernAppliedStatisticswithS,FourthEdition.Springer,doi:10.1007/978-0-387-21706-2VincentelliF.M.,etal.,2021,MNRAS,503,614ZuY.,KochanekC.S.,PetersonB.M.,2011,ApJ,735,80vanderKlisM.,1997,inBabuG.J.,FeigelsonE.D.,eds,Statisti-calChallengesinModernAstronomyII.p.321(arXiv:astro-ph/9704273)APPENDIXA:METHODSAnalysisoftherelationshipbetweentwosignalscanbesplitintotwomainthemes;thosethattakeplaceinthetimedo-main(e.g.cross-correlationanalysis),andthosethattakeplaceinthefrequencydomain(e.g.Fourieranalysis).Eachhavetheirownbeneﬁtsanddrawbacks.MNRAS000,1–20(2022)18J.A.Paiceetal.Cross-correlationanalysisgivesacoeﬃcientforhowtwosignalsare’correlated’basedonsomelag(measuredintime,orbins).Cross-correlationanalysiscanbeusefulevenwithrelativelylownumbersofbins(comparedwithFourieranal-ysis)(later,Figure6willdemonstratehowinputCorrelationmodelscanbereasonablyreproducedatsmallobservationlengths,whileFouriermodelscannot).However,theresultofcross-correlationanalysisdoesnottriviallytranslateintoquantitativeconstraintsonsourceproperties.Forexample,multipleinterferingprocessesmay‘average-out’theresultantcoeﬃcientatcertainlagranges,anditcanbediﬃculttosepa-ratesourcefeaturesfromnoise,aswellasestimateconﬁdenceintervals.Cross-correlationanalysisalsodoesnotworkwellwhenthelagsbetweenthetwobandsarecausedbysome,potentiallyvariable,periodicprocess-theresultantvaluesmaynotshowthisuniquecause.Cross-frequencyanalysis,however,ideallysolvesthesetwoissues;itallowsonetodeterminethetimelagasafunctionoffrequency,andtheerrorsonthecoherenceandthetimelagsarebetterquantiﬁed(e.g.Vaughan&Nowak1997).How-ever,thisanalysistypicallyrequiresagreaternumberofbinsinthelightcurves,andahigherSignal-to-NoiseRatio(S/N).Additionally,ifthetime-lagislargerthanthetimeperiod(i.e.theresponseinthesecondlightcurveoccursmorethanoneoscillationawayfromthecauseintheﬁrstlightcurve),thereportedlagwillbemuchshorter,andthetruelagob-scured;inthiscase,itisnotclearwhatthefullimplicationsareforthemeasuredvalueanditserror.Investigatingthesequestionsanddeterminingwhichanalysisismostidealisoneofthemotivationsbehindthiswork.Herewewilldetailthetheoreticalandmathematicalun-derpinningofbothmethods.A1Cross-CorrelationAnalysisCorrelationFunctions(CFs)ﬁndtherelationshipsbetweentwosignalsasafunctionoflag.Theyproducea‘correla-tioncoeﬃcient’,between-1and+1,ateachofarangeoflagbins;-1indicatingpureanti-correlation,and+1indicat-ingpurecorrelation.Forexample,ifthereisasharpriseinSignalA,andthenasimilarsharpriseinSignalBdelayedby10seconds,thenaCorrelationFunctionofSignalBvsSignalAwillshowapositivecorrelationcoeﬃcientat+10s.Inversely,ifSignalBshowsadipinsteadofarise,thenthecorrelationcoeﬃcientat+10swillbenegativeinstead–ananti-correlation.AnexampleCorrelationFunction,withitscomponentsignals,isseeninFigureA1.CorrSimusestheCross-CorrelationFunction(CCF).ThisparticularCorrelationFunctionisdescribedinVenables&Ripley(2002),andisbestsuitedtosimultaneouslysampledlightcurves(whichwewillbeusing):c(τ)=1Nmin(N−τ,N)∑s=max(1,−τ)[A(t+τ)−A][B(t)−B](A1)whereA(t)andB(t)refertothetwosignalsdependantupontimet4,τisthedependantvariable(the‘lag’inunitsofbins)4Venables&Ripley(2002)useXiandXjforthese,anddeﬁnethecoeﬃcientascij(t);Thesehavebeenchangedsothatsymbolsareconsistentacrossthispaper.FigureA1.AnexampleCFfromcross-correlationanalysis,basedondatafromtheblackholeX-raybinaryMAXIJ1820+070(Paiceetal.2019).Notehowananti-correlationcanbeseenatalagof+2s,whileacorrelationcanbeseenat+5s.whereτ=1,...,N,andNisthetotalnumberofbinsinthesignals.TheCCFcanbemodelledmathematicallyfromFouriercomponents,andisdonesobyCorrSim.WedescribethisprocessinSection2.2.1.Thereisnostraightforwardmethodtoevaluateuncertain-tiesorerrorsincorrelationfunctions.CorrSimusesamethodofsplittingupthelightcurvesintosegments,creatingaCFfromeachsegment,andthenﬁndingthestandarderrorbe-tweentheseindividualCFs;thisisthemethodalsousedbycrosscorrinXspec.However,thereareothermethodsavail-able,thoughnotprogrammedintoCorrSim;Bootstrapping,forinstance,isamethodofdrawingarandomselectionofpoints(sometimeswithreplacement)andthencalculatingpropertiesfromthatselection;here,thatcantaketheformofﬁndingthespreadofvaluesfromabootstrappedselec-tionofindividualCFs.MoreadvancedmethodsincludeerroranalysiscarriedoutbytheJavelincode(seeZuetal.2011),orfromMisraetal.(2018)whocalculateananalyticalfor-mulationforCFerrors.A2FourierAnalysisFourieranalysis,alsoknownascross-spectralanalysis,isfoundedontheideathatanysignalcanbeconstructedbysummingtogetheraseriesofsinusoidsofvaryingphasesandamplitudes.Takingtwosimultaneouslightcurves,wecanpairupthosecomponentsinusoidswhichareatthesamefre-quency.Onecanthendeterminethecoherenceandlagsbe-tweentwosignalsasafunctionoffrequency,ratherthanhav-ingavalueatonetimelagforallfrequencies.Theseresultscanthenbeusedtohelpdisentanglethepro-cessesbetweenbandswhichmightbediﬃculttouncoveroth-erwise.Forexample,incross-correlationanalysis,strongly-correlatedprocessescouldhideweakly-correlatedones;how-ever,ifthestrongerprocessesonlyoccuratlowerfrequenciesandtheweakeronesathigherfrequencies,thenFourieranal-ysiswouldseparatethemout.ThisisespeciallyusefulforsourceswhichhaveprocessesacrosstheFourierspectrum–again,suchasX-raybinaries(seeLewin&vanderKlis2006,Ch.2).Additionally,theerrorsonthecoherenceandtheMNRAS000,1–20(2022)CorrSim:AnObservationSimulator19timelagsarebetterquantiﬁedthancross-correlationanaly-sis(Vaughan&Nowak1997).TheFouriertransformthatisusedinourworkistheFastFourierTransform(FFT)fromtheSciPypackage5.There,theequationforaFourierTransformedseriesydependantuponfrequencyfis:y(f)=N−1∑t=0e−2πiftNX(t)(A2)alongwithitsinverse,X(t)=1NN−1∑f=0e2πiftNy(f)(A3)whereX(t)istheseriestobeFouriertransformed,oflengthN,andiistheimaginarynumber6.ForFourieranalysis,Nshouldbeapoweroftwo;thiscanbeproblematicwhentry-ingtoanalyseatthelowestfrequencies(whichmayinvolveuptohalfofthedatanotbeingused),butforthehigherfrequencies,thelightcurvescanbeeasilysplitintosmallersegmentsandaveraged.MuchofthisresearchhasmadeuseoftheStingray7pythonpackage(Huppenkothenetal.2019),whichisusedinthecalculationofFouriercomponentsfromthesimulatedlightcurves.A2.1PowerSpectraApowerspectrumshowstheamountofvariability(‘power’)ateachfrequency,whichisdependantupontheamplitudeofthesinwavesatthatfrequency.‘Power’isanumbrellaterm,andthereareseveralwaystonormaliseit.Inourwork,thenormalisationthatwehaveusedistheFractionalRMS.ThisisdeﬁnedbyvanderKlis(1997)(seealsoMiyamotoetal.1991),andisgivenbytheformula:Rrms2=2∆Tsamp¯X2N(A4)Where∆Tsampisthesamplingintervalofthedata(i.e.the‘exposuretime’ofthetelescope),¯Xisthemeanrateofthese-ries,andNisthetotalnumberofbinsintheseries.Theunitsofthisnormalisationare(rms/mean)2Hz−1.Thisnormalisa-tionisuseful,particularforourresearch,sinceintegratingthepowerspectrumyieldsthefractionalvarianceofthedata(Vaughanetal.2003).PowerspectracanoftenbydescribedbyaseriesofLorentzians,whicharedistributionsgivenbytheform:L(f)=Dπ12Γ(f−f0)2+(12Γ)2(A5)whereDisthenormalisation(controlsitsmagnitude),ΓistheFullWidthatHalfMaximum(FWHM;controlsits5https://docs.scipy.org/doc/6IntheSciPydocumentation,thesearereferredtoasx(n),N,andjrespectively.7https://github.com/StingraySoftware/stingraywidth),andf0isthemidpoint(f0=0indicatesazero-centredLorentzian).ForanexampleofaPowerSpectrumbeingmod-elledbyaseriesofLorentzians,seeFigure1.A2.2CoherenceCoherenceisthemagnitudeofthecomplex-valuedcross-spectrum;i.e.howmuchtheamplitudesofthesinwavesrelatetoeachother.Ahighercoherencemeansthetwosig-nalsaremorecorrelatedatthatfrequency.Thisvalueiscon-strainedbetween0(completelyincoherent)and1(completelycoherent).ThecoherenceisgivenbyVaughan&Nowak(1997),andmathematicallycanbegiventhusly.AssumeaPowerSpectrap=|s|2+|n|2,where|s|2isthepowerofthesignal,and|n|2isthenoise.Thecoherencefunctionisthen:γ2I(f)=|hC(f)i|2h|sA(f)|2ih|sB(f)|2i(A6)|hC(f)i|2=|hs∗AsBi+hs∗AnBi+hn∗AsBi+hn∗AnBi|2(A7)wherethesubscriptIdenotesintrinsiccoherencebetweennoiselesssignals,subscriptsAandBrefertothetwosignals,anasteriskdenotesthecomplexconjugateofthepowerspec-tra,andfisfrequency.ForXRBs,thevariabilityusuallygiveshighpowerswithrelativelyhighcoherence.UsingtheerrorformulationofVaughan&Nowak(1997),theerrorsinthiscasecanbecom-putedlikeso:γ2I=|hCi|2−q2|sA|2|sB|2× 1±m−1/2(cid:20)2q4m(|hCi|2−q2)2+|nA|4|sA|4+|nB|4|sB|4+mδγ2Iγ4I(cid:21)1/2!(A8)wheremisthenumberofsegmentsaveragedover,andq2=|sA|2|nB|2+|nA|2|sB|2+|nA|2|nB|2m(A9)Vaughan&Nowak(1997)alsogiveanequationforhighpowersandrelativelylowcoherence;however,thisoptionisnotincludedinCorrSimbothforsimplicity’ssakeandbe-causethiscasedoesnottypicallyariseinXRBs.Thisisalsotrueforthecaseoflowpowers,combinedwiththefactthatnocompletesolutionexistsforconﬁdencevaluesundertheseconditions.A2.3PhaseandTimeLagsThephaselagsarethephaseangleofthecomplex-valuedcross-spectrum;i.e.theoﬀsetbetweenthesinwavesateachfrequency,asafunctionoftheirphase.Inunitsofradians,theyliebetween−πandπ,bothofwhichrelatetoperfectanti-phase,whileavalueof0relatestoperfectphase.Theerrorsonthephaselagsarecalculatedfromthecoher-ence:δφ=δφ±s1−γ2I2γ2Ifsegm(A10)MNRAS000,1–20(2022)20J.A.Paiceetal.whereγIisthecoherence,fsegisthenumberoffrequenciespersegment,andmisthenumberofsegmentsaveragedover(Bendat&Piersol2000;Uttley&Casella2014).Timelagsaresimilartophaselags,butare,unsurprisingly,afunctionoftime.Theyarecalculatedthusly:δτ=δφ2πf(A11)whereδφisthephaselag,andfisthefrequencyofthebin.Errorsonthetimelagsarecalculatedsimilarly.Intrinsicdrawbacksofphaselags,andpossiblesolutionstosuch,arediscussedin2.2.2.ThispaperhasbeentypesetfromaTEX/LATEXﬁlepreparedbytheauthor.MNRAS000,1–20(2022)CorrSim–SupplementaryMaterialAdditionalﬁguresforSection4of‘CorrSim:AMultiwavelengthTimingObservationSimulator’(Paice,Gandhi,Misraetal.[InPrep.]).ReferencesRodriguez-EspinosaJ.M.&AlvarezP.,1997,OpticalTelescopesofTodayandTomorrow(SPIE),2871,69–73,DOI:10.1117/12.269113TarenghiM.&WIlsonR.N.,1989,ActiveTelescopeSystems(SPIE),1114,302–313,DOI:10.1117/12.9608351arXiv:2208.10337v1  [astro-ph.IM]  19 Aug 2022Figure1:ThreediﬀerentrunsofCorrSimwithdiﬀerentlengthsofobservations;256s,1024s,and4096s(withatimeresolutionof2−5(0.004)s,thisisequivalentto213,215,and217binsrespectively).Nonoisewassimulatedforthisobservation.NotehowtheshorterobservationshavepoorresultstryingtoreplicatetheFourierinputsatlowerfrequencies.2Figure2:AsinFig.1,butwithdefaultnoiseadded.Notethesigniﬁcantdeviationathigherfrequencies,especiallywithshorterobservations.Thecorrelationfunctionandcoherencearealsolower,eveninthelongestobservations–themodelcorrelationfunctionandcoherencedonotpredictthedeviationduetonoise.3Figure3:AsinFig.2,butwiththewhitenoiseremoved.Noisewasremovedbyassumingthesecond-to-lastpointinthePowerSpectraiswhite-noisedominated,andtakingthatvalueawayfromallpoints.Thisisaverysimpleapproximation,butshowshowtheshapeofthepowerspectracanstillbe(mostly)recoveredbyapproximatingandremovingthewhitenoise.4Figure4:ThreediﬀerentrunsofCorrSimwithdiﬀerenttimeresolutions;31.3ms(2−5s),7.8ms(2−7s),and2ms(2−9s).Notethedangersateitherendofthescale–largertimeresolutionsdonotprobefarintotheFourierfrequencies,butsmallertimeresolutionscanbecomequicklynoise-dominated.5Figure5:ThreediﬀerentrunsofCorrSimwithdiﬀerentcountrates;10cts/s,100cts/s,and1000cts/sforBandA(and50,500,and5000cts/sforBandBrespectively).NotehowthelowercountrateshavesigniﬁcantlylowercoherenceandmagnitudesoftheCCF.AlsoseehowpowerspectracanberecoveredmuchmoreeasilythanotherFourierproducts.Missingdatainthecoherenceofthe10cts/ssimulationarefromNaNvalues.6Figure6:AsinFigure5,butwithnoiseremoved.Notehow,comparingwithFigure3,thereisalimittowhatremovingnoisecanrecoverwithvaryinglevelsofwhitenoise.7Figure7:ThreediﬀerentrunsofCorrSimwithdiﬀerentnoisesetups;nonoiseineitherband,justrednoiseinbothbands,andjustPoissonnoiseinbothbands.Notehowrednoisedecreasesthecoherenceatallfrequencies,whilePoissonnoiseincreasespoweratlowerfrequencies.8Figure8:ThreemorerunsofCorrSimwithdiﬀerentnoisesetups;scintillationnoiseinbothbands,readoutnoiseinbothbands,andallnoisesourcesinbothbands.Notehowbothscintillationnoiseandreadoutnoise,likePoissonnoise,increasepoweratthehighestfrequencies–aneﬀectwhichstackswhenthenoisesourcesarecombinedtogether.9Figure9:Threerunswithdiﬀerenttelescopesettingsforscintillationnoise;‘Poor’(1mdiameterat1000maltitude,withCY=2),‘Good’(3.58mat2400mwithCY=1.5,analogoustotheNewTechnologyTelescopeatLaSilla;Tarenghi&Wilson1989),and‘Great’(10.4mat2267mwithCY=1.3,analogoustotheGranTelescopioCanariasatRoquedelosMuchachos;Rodriguez-Esponosa&Alvarez1997).Allothernoisesourceswereturnedoﬀforthesesimulations,andscintillationnoisewasonlyappliedtoBandB.10Figure10:ThreerunsofCorrSimwithdiﬀerenttargetaltitudesanditseﬀectonscintillationnoise;10◦,25◦,and40◦.Allothernoisesourceswereturnedoﬀforthesesimulations,andscintillationnoisewasonlyappliedtoBandB(tosimulateaSpace+Groundbasedobservation).Allotherscintillationnoisevalueswerekeptatdefaults.Notehowscintillationnoisestronglyaﬀectsatargetat10◦,yethasminimaleﬀectonatargetat40◦(andthushigheraltitudes).11