Astronomy & Astrophysics manuscript no. 41891corr
August 29, 2022

©ESO 2022

2
2
0
2

g
u
A
6
2

]

M

I
.
h
p
-
o
r
t
s
a
[

1
v
7
6
7
2
1
.
8
0
2
2
:
v
i
X
r
a

The SVOM/ECLAIRs image trigger with wavelet-based background
correction optimised with a one-year simulation of observations

N. Dagoneau1 and S. Schanne1

CEA Paris-Saclay/IRFU, F-91191 Gif-sur-Yvette, France
e-mail: nicolas.dagoneau@cea.fr.

Received XXX; accepted XXX

ABSTRACT

Context. The Space-based multi-band astronomical Variable Objects Monitor (SVOM) mission under development will carry four
instruments, and in particular the coded-mask telescope named ECLAIRs, with a large ﬁeld of view of about 2 sr, operating in the
4–150 keV energy band. The trigger software on board ECLAIRs will search for high-energy transients such as gamma-ray bursts and
peculiar behaviour (e.g. strong outbursts) from known X-ray sources, in order to repoint the satellite to perform follow-up observations
with the onboard narrow ﬁeld of view instruments.
Aims. The image trigger, one of the two algorithms implemented in the software on board ECLAIRs, produces images over periods
of exposure ranging from 20 seconds to 20 minutes during which the Earth can cross the ﬁeld of view. The Cosmic X-ray Background
and contributions from known X-ray sources are expected to dominate the ECLAIRs astrophysical and instrumental background
and must be taken into account and corrected prior to coded-mask image deconvolution in order to optimise the sensitivity to faint
transients.
Methods. To correct these background components, we implemented and studied a traditional ﬁtting method and a new method based
on wavelet decomposition of the detector image. In order to study and to assess the performance of these methods, we performed a
one-year simulation of the image trigger on board ECLAIRs. From the images produced during this realistic observation scenario of
the SVOM mission, we also deﬁned a way to analyse the sky images to search for new sources.
Results. We present the algorithms behind the image trigger on board SVOM/ECLAIRs. We show that the wavelet method we
implemented provides similar results in terms of cleaning performance compared to the traditional ﬁtting method, and has the beneﬁt
of not requiring any assumption on the shape of the background on the detector. We also calibrate the detection threshold to be
adaptive and based on the quality of the reconstructed sky image.

Key words. Instrumentation: miscellaneous – Telescopes – Techniques: image processing

1. Introduction

Transient astrophysical events include various high-energy phe-
nomena such as gamma-ray bursts (GRBs) and ﬂares from X-
ray binaries or highly magnetized neutron stars. These short-
duration phenomena in the X-ray and gamma-ray energy do-
mains deserve fast detection to permit multi-wavelength follow-
up observations, which will allow us to study of the underlying
physics and to determine the distance of the emitting source.

This strategy will be followed by SVOM (Wei et al. 2016),
a French-Chinese mission currently under development and
planned to be operational after 2022. The fast detection of tran-
sient sources needs to be carried out directly on board the satel-
lite since it cannot rely on ground-based data processing due to
the lack of real-time large-volume data transmission from low-
Earth orbit to the ground.

The goal of the ECLAIRs coded-mask aperture telescope on
board SVOM (Godet et al. 2014) is to observe a large portion of
the hard X-ray sky and automatically detect and localise GRBs
and other kinds of transient sources, thanks to its trigger soft-
ware (Schanne et al. 2019). The software is implemented in the
Scientiﬁc Trigger and Control Unit (UGTS, French for Unité
de Gestion et de Traitement Scientiﬁque) (Schanne et al. 2013;
Le Provost et al. 2013).

The ECLAIRs instrument is made up of the UGTS; the CdTe
detector plane (80 × 80 pixels of active surface 4 × 4 mm2, 1

mm thick, separated by 0.5 mm), which detects photons from 4
to 150 keV; and the self-supporting tantalum mask (54 × 54 cm2
in size and 0.6 mm thick), which provides imaging capabilities
up to 120 keV and is located at a distance of 46 cm above the
detection plane.

The UGTS is composed of ten electronic boards that perform
diﬀerent functions (power management, data input-output man-
agement, and data processing). Two redundant boards are dedi-
cated to data processing. Each of these includes an FPGA to pre-
process the data for the trigger software and a Leon3 dual-core
CPU running the complete ECLAIRs ﬂight software, including
the trigger.

The trigger software is divided into two diﬀerent algorithms
to reﬂect the diversity of transient sources in terms of duration.
The ﬁrst is a count-rate trigger, well suited to detecting short
GRBs. It monitors the counts recorded by the detector plane on
timescales between 10 ms and 20.48 s, and performs excess de-
tection over background and imaging of those excesses. The sec-
ond algorithm is an image trigger, well suited to detecting long
GRBs. It analyses images built on timescales from 20.48 s to
approximately 20 min. This image trigger is also well adapted
to the detection of ultra-long GRBs (Dagoneau et al. 2020). The
present paper focuses on the general description of the image
trigger, including its algorithm and the processing, which are im-

Article number, page 1 of 10

 
 
 
 
 
 
A&A proofs: manuscript no. 41891corr

plemented to optimise the detection of transient sources in the
images that are produced.

2. Image trigger

The image trigger is the name given to one of the two trigger al-
gorithms implemented in the ECLAIRs onboard detection soft-
ware. An illustration of this algorithm is given in Fig. 1. This
algorithm runs in cycles of 20.48 s in four conﬁgurable energy
strips to reﬂect the spectral diversity of the transient sources; in
this paper the four strips are 4–20 keV, 4–50 keV, 4–120 keV, and
20–120 keV. The 80 × 80 pixel images recorded by the detector
plane within 20.48 s are called shadowgrams. The sky image is
reconstructed from the shadowgram using the mask deconvolu-
tion method (as is currently used by the IBIS telescope on board
the ESA INTEGRAL observatory; a description of the method
can be found in Goldwurm et al. 2003). This method permits
the reconstruction of point-like sources in the energy band be-
tween 4 and 120 keV where the mask (Ta of 0.6 mm thickness)
is opaque enough for such sources to produce shadowgrams with
good contrast.

S var.
Before the deconvolution,

The sky image has a size of 200 × 200 pixels with a pixel
angular size ranging from 33 arcmin in the centre of the ﬁeld
of view to 17.5 arcmin at the edge. The deconvolution uses
the detected number of counts per pixel Dcnt and, assuming a
Poissonian distribution per detector pixel (Dvar = Dcnt), it pro-
duces reconstructed sky images in number of counts (S cnt) and
variance (S var). A signal-to-noise (S/N) sky image is also built:
S S/N = S cnt/

√

the shadowgrams need to be
cleaned from the Cosmic X-ray Background (CXB) and the con-
tributions from bright known X-ray sources. The cleaning step is
described in Sect. 4. The background correction is performed on
the detected counts image. In theory, this correction leads to an
increase in variance in the shadowgram. However, this increase
is negligible (less than 1% in the corner of the shadowgram)
compared to the initial number of counts in 20 s (and thus to
the initial variance when modelling the distribution of the counts
by a Poisson distribution). For this reason, the uncorrected count
images are deconvolved to produce the variance of the sky.

The deconvolution leads to sky images that are subsequently
added (separate summation of the counts and the variances) into
a history of the most recent sky images. The resulting exposure
time of the sky images produced by summation is ∆Tn = 20.48×
2n s with n = [0, 6]. Thus, the available scales range from ∆T0
= 20.48 s to ∆T6 = 1310.72 s (approximately 20 min, see Fig.
1 for an illustration). Each of the sky images is searched for a
transient source. This step is described in Sect. 5.

Unlike the image triggers developed for previous missions
like Swift/BAT, the ECLAIRs image trigger must be able to op-
erate when the Earth passes through its ﬁeld of view (2 sr), which
occurs approximately every orbit (90 minutes). The Earth pas-
sages are the result of the strategy set up by SVOM to point the
ECLAIRs ﬁeld of view towards a roughly anti-solar direction in
order to trigger on sources that are immediately observable by
ground-based observatories located on the Earth’s night hemi-
sphere. The management of the Earth in the ﬁeld of view is ex-
plained throughout the paper at each step of the image trigger.

The ECLAIRs telescope will also transmit all the counts
recorded by the camera to the ground by X-band, where the
detection software can be executed oﬄine (typically with 6–
12 hr of delay) to adjust the parameters, detect low signiﬁcance
sources, and permit the update of the onboard software conﬁgu-
ration by telecommand.

Article number, page 2 of 10

3. Methodology

In order to develop and study the performance of the image trig-
ger, a simulation of a one-year SVOM observation sequence car-
ried out by the CNES is used (Jaubert et al. 2017). This sim-
ulation gives the satellite’s position on its orbit and its attitude
for every minute of this year. Figure 2 shows the positions of
the pointing directions on the sky in Galactic coordinates in the
one-year mission simulation. There are 1919 stable pointings.

For each pointing the shadowgrams are drawn by ray-tracing
CXB and known sources photons in the ﬁeld of view. A spa-
tially and spectrally ﬂat noise component is also added to the
shadowgram at the level of 0.003 counts/s/cm2/keV (taken from
the spectrum given in Mandrou et al. 2008, Fig. 2, integrated
over the ECLAIRs energy band), which takes into account the
mean contribution of particles, predominantly electrons, along
the orbit outside of the South Atlantic Anomaly region. The cat-
alogue of known sources is presented in Dagoneau et al. 2021.
The image trigger processes the shadowgrams. In the following
we consider a perfect eﬃciency of the detector between 4 and
150 keV, and we focus on the imaging process in the ECLAIRs
full band of 4–120 keV.

In this paper we present the optimisations of the image trig-
ger in terms of imaging performance, background modelling and
subtraction. The simulation of GRBs to estimate the GRB de-
tection rate by ECLAIRs were presented previously (Wei et al.
2016; Antier-Farfar 2016), based on a prototype trigger imple-
mentation (Schanne et al. 2013).

In order to evaluate the quality of the S/N sky images pro-
duced in which the image trigger searches for new sources, we
analysed the standard deviation of the S/N as well as the max-
imum of the S/N in each image at each timescale. In a cleaned
image (i.e. in a sky image built from the deconvolution of a clean
shadowgram, and possibly summed with other sky images) the
S/N should follow a standard normal distribution N(0,1).

4. Before deconvolution: Cleaning

The deconvolution may lead to some artefacts that mimic point
sources when the background noise is not uniform in the shad-
owgram. Because of the geometry of the ECLAIRs telescope
(and in particular the distance between the mask and the detec-
tor of 46 cm), an isotropic source such as the CXB manifests
itself by a non-uniform distribution of the counts on the detec-
tor. The deconvolution of such a shape generates artefacts in the
images of the sky that increase the width of the distribution of
S/N and reduce the detection eﬃciency of faint sources. Before
the deconvolution, the shadowgrams (∆T = 20.48 s) must there-
fore be corrected for the CXB, but also for the contribution of the
known bright sources (the eﬀects of not correcting bright sources
are presented in Dagoneau et al. 2021).

4.1. CXB correction

To correct the CXB, two methods are implemented in the on-
board software (with possible switching by telecommand). The
method that will be used by default is the traditional way already
used in the past (as an example for the Granat/SIGMA data pro-
cessing, Bouchet et al. 2001), which consists in subtracting a 2D
polynomial shape after a ﬁt in the shadowgram. This 2D poly-
nomial model is justiﬁed by the geometry of the instrument. For
a large ﬁeld-of-view instrument, an isotropic source in the sky
such as the CXB leads to a 2D distribution of the counts in the
shadowgram with more counts in the centre than in the corners.

N. Dagoneau and S. Schanne: The SVOM/ECLAIRs image trigger with wavelet-based background correction

Fig. 1. Illustration of the algorithm behind the image trigger for one energy strip. The vertical dotted lines delimit portions of 20.48 s. The green
blocks correspond to shadowgrams that are corrected and deconvolved. The blue blocks correspond to the images of the sky. For visibility, only
scales n = 0, n = 1, and n = 2 are shown (scale n = 6 is the result of the sum of 64 images of 20.48 s).

systematics is sky images, Krivonos et al. 2010). It results from
the fact that the background shape produced by the large size of
the ﬁeld of view modulated by the Earth’s presence appears as a
large-scale structure on the shadowgram, while the point-source
contributions are imprinted in small-scale structures on the shad-
owgram because of the small size of the coded-mask elements.
Thus, the shadowgram can be decomposed into diﬀerent
scales and a background-corrected version of the shadowgram
is reconstructed using only the smallest scales. The shadowgram
Ds at a scale s ≥ 1 and pixel position (i, j) is computed accord-
ing to Eq. (2) which is a convolution of the shadowgram at the
previous scale Ds−1 and a ﬁlter H; D0 corresponds to the raw
shadowgram:

Ds(i, j) =

l(cid:88)

l(cid:88)

m=−l

n=−l

H(m, n)Ds−1(i + 2s−1m, j + 2s−1n)

(2)

The algorithm is called à trous because, while it calculates
the diﬀerent scales of the detector image, the distance between
two pixels considered for the convolution by the ﬁlter increases
by a factor of 2. To compute the pixels of D1 the pixels taken
into account are neighbours in D0, whereas for the calculation at
scale s they are separated by a distance 2s−1, as shown in Fig. 3.
This allows larger and larger structures to be caught in the shad-
owgram as the scale increases. To keep the detector image size
identical at all scales (80 × 80), symmetric boundary conditions
are used: the image of the pixel of index −1 (which would be
outside the matrix) is the pixel of index 0; the image of the pixel
of index 80 (also outside the matrix) is the pixel of index 79.
Symmetric boundary conditions are appropriate for sources in
the partially coded ﬁeld of view (in contrast to cyclic boundary
conditions).

The 2D ﬁlter H is built from a 1D ﬁlter h such that H = hhT .
There are two possible 1D ﬁlters that are commonly used in the
à trous algorithm (Starck et al. 2007): h3 = (1/4, 1/2, 1/4) or
h5 = (1/16, 1/4, 3/8, 1/4, 1/16). The wavelet coeﬃcients Ws at
a scale s ≥ 1 and pixel position (i, j) are given by Eq. (3):

Article number, page 3 of 10

Fig. 2. Positions of the pointing directions on the sky in Galactic coor-
dinates in a one-year simulation by CNES (nominal phase, Jaubert et al.
2017).

This non-ﬂat distribution ﬂattens out when the ﬁeld of view de-
creases (e.g. when the distance between the mask and the detec-
tor increases). The model is deﬁned by Eq. 1 where i and j refer
to the pixel coordinates in the shadowgram:

M(i, j) = c0 + c1 · i + c2 · j + c3 · i2 + c4 · j2 + c5 · i · j.

(1)

In the absence of the Earth in the ﬁeld of view, this 2D shape
appears as a curved shape with a maximum at the centre of
the shadowgram. However, in the case of SVOM/ECLAIRs, this
method should also operate with the presence of the Earth in the
ﬁeld of view. The 2D shape applied allows for this correction,
and permits the modelling of a deﬁcit of counts in the direc-
tion of the Earth (see Fig. 5) without explicitly injecting into the
model the coordinates of the Earth in the ﬁeld of view.

We have implemented another method using wavelets and
the à trous algorithm (French for ‘with holes’) (Holschneider
et al. 1990; Starck & Murtagh 2002). This is the ﬁrst time that
this algorithm will be used to correct the background in detector
images from a coded-mask aperture telescope prior to decon-
volution (but already applied after the deconvolution to remove

1501209060300-30-60-90-120-150-75°-60°-45°-30°-15°0°15°30°45°60°75°A&A proofs: manuscript no. 41891corr

Fig. 3. Illustration of the calculation of the approximations by the à
trous algorithm applied to the central pixel (i, j) = (0, 0) for a ﬁlter of
size 3 × 3. At each scale D0, D1, and D2 (from left to right), the pixels
involved in the convolution with the ﬁlter to compute D1(0, 0), D2(0, 0),
and D3(0, 0) are shown in black.

Ws(i, j) = Ds−1(i, j) − Ds(i, j).

(3)

The image of the original shadowgram D can be recovered
by summing the diﬀerent wavelet coeﬃcients Ws and the last
scale Dsmax at the largest scale considered s = smax:

D(i, j) =

smax(cid:88)

s=1

Ws(i, j) + Dsmax(i, j).

(4)

The removal of the CXB is achieved by the reconstruction
of a cleaned shadowgram Dcleaned summing only a limited num-
ber of scales s = sth < smax. Thus, given that the wavelet co-
eﬃcient is the diﬀerence between two consecutive scales, the
cleaned shadowgram can be computed by the subtraction of the
shadowgram at scale sth and the raw shadowgram D0:

Dcleaned(i, j) = D0 − Dsth .

(5)

Thus, the algorithm needs two parameters to be chosen: one
ﬁlter among the two presented previously (h3 or h5) and the scale
sth to be used in order to build the corrected shadowgram con-
taining only the smallest scales, which contain most of the point-
source coded signal while reducing the inﬂuence of the back-
ground. The preliminary choice of these parameters is made in
such a way that the largest scale of the shadowgram Dsth contains
most of the non-uniform background. In order to evaluate this
and to deduce the most adapted parameters, we simulated shad-
owgrams of 20 s containing only CXB (plus the additional ﬂat
noise). The shadowgrams are cleaned with the wavelet method
using various combinations of the two parameters and then de-
convolved to produce the sky images that are summed together
to reach an exposure time of 20 min. The best parameters are
those that lead to a distribution of the S/N with a standard devia-
tion as close as possible to 1 in the images of the sky in 20 min.
As with the ﬁt method, the uncorrected counts shadowgram is
used as the variance to produce the variance of the sky, and thus
to compute the S/N.

Figure 4 gives the distribution of S/N in 20 min sky images
for diﬀerent combinations of the parameters. From this simula-
tion, we propose using at ﬁrst the ﬁlter h3 and a maximum scale
sth = 3 for the cleaning with the wavelet method. The threshold
scale sth = 3 is also justiﬁed by the geometry of the instrument.
It is equivalent to keeping, in the image to be deconvolved, the
scales whose characteristic size is 1 (s = 0), 2 (s = 1), or 4 pixels
(s = 2). The ratio of the mask-element size (m) to detector pixel
size (d) is m/d = 2.54. The value s = 2 is the smallest value for
which the characteristic size still covers the mask-element size,
while with the value s = 1 part of the point-source signal would

Article number, page 4 of 10

Fig. 4. Distribution of the S/N in 20 min sky images for diﬀerent com-
binations of the ﬁlter size and the maximum scale used for the wavelet
cleaning. The black solid curve corresponds to the normal distribution.
The best parameters (h3, sth = 3) are shown as the solid green curve.

remain in the large scales that are subtracted and would be lost in
the image to be deconvolved. The two parameters can be modi-
ﬁed after the launch by a telecommand from the ground, based
on the observation of the background in ﬂight conditions.

Figure 5 gives an example of the background correction in
the presence of the Earth in the ﬁeld of view, using either the
traditional ﬁt method or the wavelet method. The Earth in the
ﬁeld of view leads to a non-uniform distribution of the counts on
the detector, including a lack of counts in the lower left corner
(where no part of the detector is totally obscured). Both the tra-
ditional ﬁt method and the wavelet method make it possible to
correctly model this non-uniformity and to obtain a ﬂat distribu-
tion after subtraction.

4.2. Galactic ridge X-ray emission non-correction

In this section we study the inﬂuence of the Galactic ridge X-
ray emission (GRXE) and show that its inﬂuence on the images
produced by ECLAIRs is negligible, and that it is therefore not
necessary to integrate it into our simulations nor to worry about
its correction. The GRXE is modelled by a diﬀuse emission re-
gion centred on the Galactic centre. Its spatial distribution is
given by two perpendicular Lorentzian functions (Fig. 6, top left)
with a full width at half maximum of 21 deg along the Galactic
plane and 1.2 deg perpendicularly (Türler et al. 2010). We mod-
elled its spectrum, using as input the distribution shown in Türler
et al. (2010) (Fig. 10), which we approximate by a simple power
law E · FE = K · Eα. Using the two points with coordinates
(E = 4 keV, E · FE = 10 keV/cm2/s/sr) and (E = 100 keV,
E · FE = 1 keV/cm2/s/sr), we derive the values for the power-law
index α = −1.102 and the normalization K = 46 keV/cm2/s/sr at
1 keV. This spectrum is given in a region of 60 × 30 deg2, which
corresponds to 0.54 sr. Hence, the total GRXE ﬂux in that region
is 0.549 ph/cm2/s in 4–10 keV. We mimic the diﬀuse GRXE by
10000 point sources, distributed in the sky according to the two
Lorentzian functions described above, where each source has a
ﬂux equal to 1/10000 of the total GRXE ﬂux.

N. Dagoneau and S. Schanne: The SVOM/ECLAIRs image trigger with wavelet-based background correction

Fig. 5. Example of background correction with Earth’s presence in the
ﬁeld of view and without bright sources. Top left: Raw shadowgram
in counts (20 s exposure). Top right: Earth presence map. Middle left:
Fitted model of the shadowgram (2D polynomial ﬁt). Middle right:
Wavelet model of the shadowgram (D3). Bottom left: Shadowgram cor-
rected with the ﬁt method. Bottom right: Shadowgram corrected with
the wavelet method.

In a ﬁrst simulation (see Fig. 6) the Galactic plane was
aligned with one of the cross-arms of the coded mask1. As a
result, we observe that in 4–10 keV the GRXE projects about
160 counts/s on the detector, while the CXB projects about 3000
counts/s. This case where the Galactic plane is aligned with a
mask cross-arm is the worst; the superposition of the GRXE
source projections casts the shadow of one of the cross-arms in
the shadowgram (see bottom left panel of Fig. 6). However, in
the reconstructed sky images the GRXE is barely visible. Even
in the longest exposure of 20 min, the reconstructed structure
does not correspond to a point source, the S/R maximum is just
above 6σ, and the standard deviation of the S/N rises to 1.1 (see
bottom right panel of Fig. 6), such that this structure remains
below the trigger thresholds even in 20 min exposures.

We repeated the simulation with the Galactic plane tilted by
45 deg in the ﬁeld of view (Fig. 7). In this case the projections of
the simulated sources are no longer aligned with a cross-arm of
the mask, which results in a detector shadowgram showing low-
amplitude structures only, and a reconstructed sky image where

1 For mechanical reasons, the coded mask has no holes on the two
perpendicular central strips forming what is called the ‘mask cross’.
This cross is shown in Figure 1 in Cordier, B. & Wei, J. (2019)

Fig. 6. Study of the GRXE in 20 min (scale n = 6) in 4–10 keV. Top
left: The two Lorentzian functions used to model the GRXE in Galactic
longitude and latitude. Middle left: Sky map of the points sources used
to simulate the GRXE diﬀuse emission. Bottom left : Shadowgram in
counts on the detector (only GRXE). Top right : Shadowgram in counts
(GRXE and CXB combined). Middle right: Shadowgram after correc-
tion by quadratic ﬁt. Bottom right: Reconstructed sky image in S/N.

Fig. 7. Same as middle and bottom part of Fig. 6, but with the Galactic
plane tilted by 45 deg inside the ﬁeld of view.

Article number, page 5 of 10

A&A proofs: manuscript no. 41891corr

the GRXE diﬀuse emission is not visible, even for exposures up
to 20 min.

Therefore we conclude that the GRXE is negligible in the
ECLAIRs image trigger, mainly because the counts produced by
the GRXE emission region is smaller than that of the CXB, and
because the GRXE is a region of diﬀuse emission, much larger
in size than can be considered as a point source for ECLAIRs
for which the mask imaging is not a completely appropriate re-
construction technique. Consequently, this emission is not taken
into account in our one-year simulation nor in the image trigger
software.

Generally speaking, it should be noted that the data from
ECLAIRs could be used to study CXB and GRXE via speciﬁc
ground-based analyses.

4.3. Correction of known sources

For each pointing position of the spacecraft, we can build a cat-
alogue of bright X-ray sources and compute their coordinates in
the ECLAIRs local frame. The sources that need to be corrected
are mainly bright X-ray binaries (Dagoneau et al. 2021).

The correction of these known sources in the onboard cata-
logue is done in the shadowgram by ﬁtting a model of the sources
on the shadowgram and subtracting it. The model consists of the
weighted sum of the illumination functions of the sources in the
ﬁeld of view (and not obscured by the Earth). The illumination
function of a source is an array of the same size as the detec-
tor, which gives, for each pixel of the detector, the pixel fraction
illuminated by this source for the given position in the sky.

Depending on how the background is corrected, the ﬁt is ei-
ther performed simultaneously with the 2D polynomial shape of
the CXB (adding one parameter per source in Eq. 1) or after the
wavelet cleaning (because the projection of the coded-mask pat-
tern on the detector by point sources predominantly contributes
on small scales).

Figure 8 gives an example of the background correction with
Earth’s presence and bright sources in the ﬁeld of view for
the two methods. Here the ﬁeld of view contains many bright
sources, including the very bright Scorpius X-1 whose mask
shadow is clearly visible in the bottom left corner of the detector
image. In the model of the detector, the contribution from the
CXB is not visible because the sources, and especially Scorpius
X-1, are dominant. After the correction (for both methods), we
can see that some counts from the very bright source Scorpius
X-1 remain visible in the bottom left corner of the shadowgram.
This is caused by the subtraction of an average level from a count
distribution that has a large amplitude of variation in the case of a
very bright source. However, the consequence is limited because
most of the counts are subtracted and a possible residual at the
position of the source in the sky will be masked when searching
for a new source.

In the case where the CXB is cleaned with wavelets, the sub-
traction of the contribution from the known point sources is per-
formed in a second step where the ﬁt is based only on the mod-
els of the sources. Since the image has been transformed (Fig.
9, top left), the models of the sources to be ﬁtted must also be
transformed using the à trous algorithm with the same parame-
ters (Fig. 9, bottom row) to avoid that the source contributions
are only partially subtracted (Fig. 9, top right).

Article number, page 6 of 10

Fig. 8. Example of background correction with Earth’s presence and
with bright sources in the ﬁeld of view. Top left: Raw shadowgram in
counts (20 s exposure). Top right: Sky map with the Earth and the cor-
rected sources (Sco X-1, GX 349+2, GX 3+1, 4U 1705-440, GX 9+9).
Middle left: Fitted model of the shadowgram (2D polynomial and il-
lumination functions of sources). Middle right: Wavelet model of the
shadowgram (D3) combined with ﬁtted model of the sources. Bottom
left: Shadowgram corrected with the ﬁt method. Bottom right: Shadow-
gram corrected with the wavelet method.

5. After deconvolution: Calibrating the detection

threshold

After the cleaning of the detector images from the CXB and from
the known bright-source contributions, the shadowgrams of the
one-year simulation are ready to be deconvolved in order to re-
construct the sky images.

The sky pixels that are obscured by the Earth are set to 0 in
the counts images S cnt, variance images S var, and S/N images
S S/N (only in the ﬁrst scale of 20.48 s processed by the image
trigger). In order to prevent false triggers from a residual at the
position of a corrected catalogued source, pixels within a radius
of 6 pixels (conﬁgurable, see Dagoneau et al. 2021) around the
position of the source are set to 0 in these images. For a source
in the centre of the ﬁeld of view, the pixels within a radius of 6
pixels cover a solid angle of about 0.01 sr. Some other sources,
such as Hercules X-1, which are not bright enough to be cor-
rected in the 20 s shadowgrams but are bright enough to appear
in the images of the sky in 20 min, are also masked with ze-
ros at all timescales. In order to prevent some artefacts from the
deconvolution in very partially coded directions of the sky, the
sky pixels for which a mask pattern is projected in less than 50
pixels (conﬁgurable) of the detector are also set to 0 in these im-
ages. This way, pixels with a S/N of exactly 0 are excluded for
the computation of the standard deviation and for the new source
search by the image trigger.

N. Dagoneau and S. Schanne: The SVOM/ECLAIRs image trigger with wavelet-based background correction

Fig. 9. Processing details on the ﬁeld of view shown in Fig. 8. Top
left: Shadowgram corrected for the background contribution using the
wavelet method without source processing; the contribution of the
bright source Sco X-1 remains visible. Top right: Shadowgram cor-
rected for the background using the wavelet method followed by the
direct ﬁt of the illumination function of the bright known sources (the
same non-transformed illumination functions as used for the simulta-
neous ﬁt with the CXB); the contribution of the bright source is only
partially removed by this ﬁt. Bottom left: Illumination function (non-
transformed) for a source in the partially coded ﬁeld of view (used for
the direct ﬁt). Bottom right: Transformed illumination function by the
à trous wavelet-ﬁlter; this is the function to be ﬁtted after the wavelet
correction of the CXB in order to correctly remove the bright source
contribution (as shown in Fig. 8, bottom right).

From the previous work we conducted (Dagoneau et al.
2021), the standard deviation of the S/N in 20 min sky images
reaches, without any corrections, values higher than 50 for a
pointing towards the Galactic centre and in the region of Scor-
pius X-1. In addition, with the correction, near the Galactic poles
the correction reduces the standard deviation of the S/N in the
sky images to values close to 1. Figure 10 gives the distribution
of all the standard deviations in S/N images produced during
the one-year simulation (in 20 s and 20 min). In 20 s it remains
close to 1 in all the produced images, but in 20 min it increases
because of the more important number of bright X-ray sources,
even if they are corrected, in the Galactic centre. The histograms
only includes images composed of ten signiﬁcant pixels at least,
excluding images almost totally obscured by the Earth. The ex-
tension to values below and above 1 corresponds to sky images
where the Earth occupies a large part of the ﬁeld of view, and
thus few pixels are used to calculate the standard deviation. In
the 20 min plot, there are no values much lower than 1 because
in 20 min there are far fewer pixels that are permanently masked
by the Earth.

If the standard deviation allows the deviation of the S/N to be
characterised from the normal distribution, the value that needs
to be examined is the maximum value in the S/N images. The
image trigger looks for the maximum value in the S/N images
and starts an alert sequence if that value is above a threshold.
For a normal S/N distribution the threshold has been set to 6.5
in order to comply with the constraint of one false alert per day
as required by the alert system. This value can be obtained from
simulations in which a large number of realisations of the back-
ground are simulated and corrected; the sky images are then pro-

Fig. 10. Distribution of the standard deviation for each S/N sky image
of 20 s (top, 1510398 entries) and 20 min (bottom, 44895 entries) of
the one-year simulation. The black and blue curves correspond to the
images where the CXB was cleaned using the ﬁt method and the wavelet
method, respectively.

Fig. 11. Distribution of the maximum value for each S/N sky image
of 20 s (top, 1510398 entries) and 20 min (bottom, 44895 entries) of
the one-year simulation. The black and blue curves correspond to the
images where the CXB was cleaned using the ﬁt method and the wavelet
method, respectively. The red vertical bar corresponds to a value of 6.5.

duced by deconvolution and the maxima in S/N (or rather max-
ima in S/N divided by the standard deviation in the image in S/N,
see below) are recorded. Integrating the distribution of these val-
ues from the right until we reach the desired false alarm rate
(typically one per day), we ﬁnd a threshold close to 6.5. This
value is a little higher than the expected theoretical value (4.5)
for 400000 independent and identically distributed sky pixels ac-
cording to a normal distribution N(0,1) with a threshold at 3σ
per pixel (in reality the sky pixels are not independent and back-
ground residuals may remain after the correction).

Thus, we have to limit the presence of values at S/N > 6.5 to
keep the threshold of 6.5 and to detect faint transients. Figure 11
gives the distribution of all the maxima in S/N images produced
during the one-year simulation (in 20 s and 20 min). In 20 s, the
distribution is compatible with a threshold in S/N of 6.5, where
there are only a few images with S/N > 6.5. However, in 20 min,
there are many images in which the maximum S/N value is much
higher than 6.5. This is mainly the case in the Galactic centre
where there are many sources.

We also note that the two methods used to correct the CXB
give similar results in terms of maximum values and standard
deviation in the S/N sky images. This is the proof that wavelets

Article number, page 7 of 10

A&A proofs: manuscript no. 41891corr

Fig. 12. Distribution of the maximum value divided by the standard
deviation for each S/N sky image of 20 s (top, 1510398 entries) and 20
min (bottom, 44895 entries) of the one-year simulation. The black and
blue curves correspond to the images where the CXB was cleaned using
the ﬁt method and the wavelet method, respectively. The red vertical bar
corresponds to a value of 6.5.

Fig. 14. Distribution of the S/N is the sky image of Fig. 13. The red
dashed line and the red plain line correspond to a threshold of 6.5 × and
8 × the standard deviation, respectively.

Fig. 13. Sky image in S/N in 20 min. White pixels are excluded for
the search of new sources: known sources plus part of the ﬁeld of view
that is always obscured by the Earth during the 20 min. The CXB is
corrected using the wavelet method.

are able to correct the CXB, without any assumption on the shape
of the CXB on the detector.

In order to dynamically adapt the detection threshold ac-
cording to the quality of the sky images, we propose applying
a threshold of 6.5 times standard deviation of the S/N in the sky
image (but limited to 6.5 if the standard deviation is less than
1). Figure 12 gives the distribution of all the maxima divided by
the standard deviation in the S/N images produced during the
one-year simulation (in 20 s and 20 min). If the standard devi-
ation is smaller than 1, the threshold remains at a value of 6.5.
In 20 s, the distribution is not modiﬁed very much (because the
standard deviation is close to 1). However, in 20 min, the spread
of the distribution is reduced. It still overﬂows beyond 6.5, and
thus we can introduce a small dependence of the threshold on
the timescale between 6.5 in 20 s and 8 in 20 min.

Fig. 15. Exposure map for the 20 min corresponding to the sky image
shown in Fig. 13. The value 1 corresponds to the regions that are always
obscured by the Earth, the value 0 to those that are never obscured.

known sources, the S/N standard deviation is 2.08, which sets
an adapted detection threshold for new sources of 6.5 × 2.08 ≈
13.5. However, as we show in the distribution of Fig. 12, this can
be too low (the maximum in the sky image is 14.1) and raises
false alerts. Increasing the threshold slightly to 8 × 2.08 ≈ 16.6
allows detection at values that are far enough from the bulk of
the distribution (see Fig. 14).

In Fig. 13 the shape of the Earth may be surprising. This is
caused by the fact that the part of the sky masked by the Earth is
replaced by zero values only in the 20 s images. Thus, in the sky
images summed up to 20 min, only the part of the sky continu-
ously occulted by the Earth is masked. The regions that the Earth
has only partially occulted during the 20 min remain unmasked.
Figure 15 gives the exposure map for these 20 min, and shows
the portion of the sky permanently obscured by the Earth and
those that are only obscured during a fraction of the exposure
time.

We show as an example the longest timescale considered,
the 20 min sky image in Fig. 13, with the same pointing as for
Fig. 8. In this image, away from the Earth and the positions of

Finally, instead of considering separately the distributions of
the measured quantities in the S/N images, the maximum and
the maximum over the standard deviation, we now determine

Article number, page 8 of 10

N. Dagoneau and S. Schanne: The SVOM/ECLAIRs image trigger with wavelet-based background correction

derived above with the distributions of the two quantities consid-
ered separately.

6. Conclusion

In this paper we have presented the algorithm behind the image
trigger on board SVOM/ECLAIRs. This trigger will build and
analyse images of the sky on timescales of 20 s and 20 min. We
described the two methods that are implemented to correct the
CXB background: a traditional ﬁt method that has to work in the
case of the Earth’s presence in the ﬁeld of view, and an alter-
native method based on the à trous wavelet decomposition. The
two methods give similar results in terms of correction of the
detector images that are built from a one-year simulation of the
background, including known X-ray sources from the catalogue
we developed previously. In addition, we performed a calibration
of the detection threshold that adapts to the quality of the recon-
structed sky image according to the standard deviation of the S/N
in the sky image, with a weak dependence on the timescale.

The traditional method of correcting the background by ﬁt-
ting a 2D shape will be used from the beginning of ﬂight op-
erations, while the wavelet-based method, never applied before
the deconvolution for coded-mask aperture telescopes, will be
validated on the ground with the ﬁrst data. The background cor-
rection with the wavelet method does not require any assumption
on the shape of the background. Thus, it could be more resilient,
for example towards the spatial variations of the background on
the detector when the Earth crosses the ﬁeld of view or follow-
ing the activation of the detector by high-energy particles dur-
ing passages through the South Atlantic Anomaly of the Earth’s
magnetic ﬁeld.

The diﬀerent steps that we described will be implemented
in the onboard software. The code is executed on the onboard
Leon3 processor, and part of it has been benchmarked with a
few reference cases for computing performance and compared
to execution times obtained on a Linux machine from which we
derive the following estimates. Without sources in the ﬁeld of
view, the background correction takes about 0.4 s for the poly-
nomial ﬁt of the CXB and the wavelet background correction
takes about 0.3 s. With ten sources present, the combined ﬁt of
the CXB and the sources takes about 1.1 s, while the wavelet
background correction still takes 0.3 s to which 0.6 s need to
be added for the ﬁt of the ten sources alone. To these values,
about 0.9 s need to be added for the sky deconvolution. It ap-
pears that the wavelet method is therefore slightly faster than the
background correction by combined ﬁt in all cases.

Once ECLAIRs is in ﬂight, the same code implemented on
board can also be executed on ground computers using all the
photons recorded by the ECLAIRs camera, which will be sent to
the ground through X-band with 6 h to 12 h of delay. Thus, the
algorithm of the trigger and the diﬀerent methods for correcting
the background can be executed oﬄine on real data to test the
various parameters and to ﬁne-tune them, in order to optimise
the sensitivity of the instruments towards faint X-ray transients.

Acknowledgements. ECLAIRs is a cooperation between CNES, CEA and
CNRS, with CNES acting as prime contractor. This work is supported by CEA
and by the “IDI 2017” project of the French “Investissements d’Avenir” program,
ﬁnanced by IDEX Paris-Saclay, ANR-11-IDEX-0003-02. The authors would
like to warmly thank the anonymous referee for very helpful comments and sug-
gestions, including the question about the inﬂuence of the Galactic Ridge X-ray
Emission on long duration image reconstruction.

Article number, page 9 of 10

Fig. 16. Two-dimensional distribution of the maximum S/N vs the max-
imum S/N divided by the standard deviation for each sky image of 20
s. The colour corresponds to the number of entries (sky image) in each
bin. The red lines show the threshold applied on each axis. The back-
ground is corrected with the ﬁt method. The hatched area corresponds
to a region that is never populated because the standard deviation used
for division is never smaller than 1.

Fig. 17. Same as Fig. 16, but for the timescale of 20 min.

the 2D distribution of the two quantities, shown in Fig. 16 for
the timescale of 20 s and in Fig. 17 for the timescale of 20 min.
On the short timescale, both distributions are largely correlated,
which permits setting the thresholds in order to limit the false
alert rate to the value of 6.5 for both measured quantities. On the
large timescale, the 2D distribution is much larger for the maxi-
mum, while the spread in the maximum over standard deviation
is mainly observed for low values of the maximum. This permits
lowering the thresholds for both quantities, and requiring that
the maximum must be above the value of 8.5 and at the same
time the maximum over standard deviation above the value of
6.5. This logical ‘and’ condition considers the events located in
the upper right corner of the ﬁgure to be acceptable, and leaves
more room for detection than with the more stringent thresholds

A&A proofs: manuscript no. 41891corr

References

Antier-Farfar, S. 2016, PhD Thesis, Université Paris-Saclay. https://tel.

archives-ouvertes.fr/tel-01456239/document

Bouchet, L., Roques, J. P., Ballet, J., Goldwurm, A., & Paul, J. 2001, The Astro-

physical Journal, 548, 990, doi: 10.1086/318997

Cordier, B., & Wei, J. 2019, Memorie della Societa Astronomica Italiana, 90,

242

Dagoneau, N., Schanne, S., Atteia, J.-L., Götz, D., & Cordier, B. 2020, Experi-

mental Astronomy, 50, 91, doi: 10.1007/s10686-020-09665-w

Dagoneau, N., Schanne, S., Rodriguez, J., Atteia, J.-L., & Cordier, B. 2021, As-
tronomy & Astrophysics, 645, A18, doi: 10.1051/0004-6361/202038995
Godet, O., Nasser, G., Atteia, J.-., et al. 2014, Montréal, Quebec, Canada,

914424, doi: 10.1117/12.2055507

Goldwurm, A., David, P., Foschini, L., et al. 2003, Astronomy and Astrophysics,

411, L223, doi: 10.1051/0004-6361:20031395

Holschneider, M., Kronland-Martinet, R., Morlet, J., & Tchamitchian, P. 1990,
in Wavelets, ed. J.-M. Combes, A. Grossmann, & P. Tchamitchian, inverse
problems and theoretical imaging (Berlin, Heidelberg: Springer), 286–297,
doi: 10.1007/978-3-642-75988-8_28

Jaubert, J., Morand, V., & Jouret, M. 2017, Realistic mission scenariosfor satel-

lite power analysis, Tech. rep.

Krivonos, R., Revnivtsev, M., Tsygankov, S., et al. 2010, Astronomy and Astro-

physics, 519, A107, doi: 10.1051/0004-6361/200913814

Le Provost, H., Schanne, S., Flouzat, C., et al. 2013, in 2013 IEEE Nuclear
Science Symposium and Medical Imaging Conference, 1–6, doi: 10.1109/
NSSMIC.2013.6829557

Mandrou, P., Schanne, S., Cordier, B., et al. 2008, in AIP Conference Proceed-

ings (Nanjing (China): AIP), 338–341, doi: 10.1063/1.3027942

Schanne, S., Le Provost, H., Kestener, P., et al. 2013, in 2013 IEEE Nuclear
Science Symposium and Medical Imaging Conference, 1–5, doi: 10.1109/
NSSMIC.2013.6829408

Schanne, S., Dagoneau, N., Château, F., et al. 2019, Memorie della Soci-
eta Astronomica Italiana, 90, 267. http://adsabs.harvard.edu/abs/
2019MmSAI..90..267S

Starck, J.-L., Fadili, J., & Murtagh, F. 2007, IEEE Transactions on Image Pro-

cessing, 16, 297, doi: 10.1109/TIP.2006.887733

Starck, J.-L., & Murtagh, F. 2002, Astronomical image and data analysis, Astron-
omy and Astrophysics Library (Berlin Heidelberg: Springer-Verlag). https:
//doi.org/10.1007/978-3-662-04906-8

Türler, M., Chernyakova, M., Courvoisier, T. J.-L., et al. 2010, Astronomy and

Astrophysics, 512, A49, doi: 10.1051/0004-6361/200913072

Wei, J., Cordier, B., Antier, S., et al. 2016. https://arxiv.org/abs/1610.

06892

Article number, page 10 of 10

