APREPRINT-MAY2,2022Preoperativebraintumorimaging:modelsandsoftwareforsegmentationandstandardizedreportingDavidBouget1,*,AndréPedersen1,2,3,AsgeirStoreJakola4,5,VasileiosKavouridis6,KyrreEegEmblem7,RoelantS.Eijgelaar8,9,IvarKommers8,9,HilkoArdon10,FrederikBarkhof11,12,LorenzoBello13,MitchelS.Berger14,MarcoContiNibali13,JuliaFurtner15,ShawnHervey-Jumper14,AlbertJ.S.Idema16,BarbaraKiesel17,AlfredKloet18,EmmanuelMandonnet19,DomeniqueM.J.Müller8,9,PierreA.Robe20,MarcoRossi13,TommasoSciortino13,WimarVandenBrink21,MichielWagemakers22,GeorgWidhalm17,MarnixG.Witte23,AeilkoH.Zwinderman24,PhilipC.DeWittHamer8,9,OleSolheim6,25,IngeridReinertsen1,261DepartmentofHealthResearch,SINTEFDigital,NO-7465Trondheim,Norway2DepartmentofClinicalandMolecularMedicine,NorwegianUniversityofScienceandTechnology,NO-7491Trondheim,Norway3ClinicofSurgery,St.Olavshospital,TrondheimUniversityHospital,NO-7030Trondheim,Norway4DepartmentofNeurosurgery,SahlgrenskaUniversityHospital,41345Gothenburg,Sweden5DepartmentofClinicalNeuroscience,InstituteofNeuroscienceandPhysiology,SahlgrenskaAcademy,UniversityofGothenburg,40350Gothenburg,Sweden6DepartmentofNeurosurgery,St.Olavshospital,TrondheimUniversityHospital,NO-7030Trondheim,Norway7DepartmentofPhysicsandComputationalRadiology,DivisionofRadiologyandNuclearMedicine,OsloUniversityHospital,0450Oslo,Norway8DepartmentofNeurosurgery,AmsterdamUniversityMedicalCenters,VrijeUniversiteit,1081HVAmsterdam,TheNetherlands9CancerCenterAmsterdam,BrainTumorCenter,AmsterdamUniversityMedicalCenters,1081HVAmsterdam,TheNetherlands10DepartmentofNeurosurgery,TweeStedenHospital,5042ADTilburg,TheNetherlands11DepartmentofRadiologyandNuclearMedicine,AmsterdamUniversityMedicalCenters,VrijeUniversiteit,1081HVAmsterdam,TheNetherlands12InstitutesofNeurologyandHealthcareEngineering,UniversityCollegeLondon,LondonWC1E6BT,UK13NeurosurgicalOncologyUnit,DepartmentofOncologyandHemato-Oncology,HumanitasResearchHospital,UniversitàDegliStudidiMilano,20122Milano,Italy14DepartmentofNeurologicalSurgery,UniversityofCaliforniaSanFrancisco,SanFrancisco,CA94143,USA15DepartmentofBiomedicalImagingandImage-GuidedTherapy,MedicalUniversityVienna,1090Wien,Austria16DepartmentofNeurosurgery,NorthwestClinics,1815JDAlkmaar,TheNetherlands17DepartmentofNeurosurgery,MedicalUniversityVienna,1090Wien,Austria18DepartmentofNeurosurgery,HaaglandenMedicalCenter,2515VATheHague,TheNetherlands19DepartmentofNeurologicalSurgery,HôpitalLariboisière,75010Paris,France20DepartmentofNeurologyandNeurosurgery,UniversityMedicalCenterUtrecht,3584CXUtrecht,TheNetherlands21DepartmentofNeurosurgery,Isala,8025ABZwolle,TheNetherlands22DepartmentofNeurosurgery,UniversityMedicalCenterGroningen,UniversityofGroningen,9713GZGroningen,TheNetherlands23DepartmentofRadiationOncology,TheNetherlandsCancerInstitute,1066CXAmsterdam,TheNetherlands24DepartmentofClinicalEpidemiologyandBiostatistics,AmsterdamUniversityMedicalCenters,UniversityofAmsterdam,1105AZAmsterdam,TheNetherlands25DepartmentofNeuromedicineandMovementScience,NorwegianUniversityofScienceandTechnology,NO-7491Trondheim,Norway26DepartmentofCirculationandMedicalImaging,NorwegianUniversityofScienceandTechnology,NO-7491Trondheim,Norway*david.bouget@sintef.no1arXiv:2204.14199v1  [eess.IV]  29 Apr 2022APREPRINT-MAY2,2022ABSTRACTForpatientssufferingfrombraintumor,prognosisestimationandtreatmentdecisionsaremadebyamultidisciplinaryteambasedonasetofpreoperativeMRscans.Currently,thelackofstandardizedandautomaticmethodsfortumordetectionandgenerationofclinicalreports,incorporatingawiderangeoftumorcharacteristics,representsamajorhurdle.Inthisstudy,weinvestigatethemostoccurringbraintumortypes:glioblastomas,lowergradegliomas,meningiomas,andmetastases,throughfourcohortsofupto4000patients.TumorsegmentationmodelsweretrainedusingtheAGU-Netarchitecturewithdifferentpreprocessingstepsandprotocols.Segmentationperformanceswereassessedin-depthusingawide-rangeofvoxelandpatient-wisemetricscoveringvolume,distance,andprobabilisticaspects.Finally,twosoftwaresolutionshavebeendeveloped,enablinganeasyuseofthetrainedmodelsandstandardizedgenerationofclinicalreports:RaidionicsandRaidionics-Slicer.Segmentationperformanceswerequitehomogeneousacrossthefourdifferentbraintumortypes,withanaveragetruepositiveDicerangingbetween80%and90%,patient-wiserecallbetween88%and98%,andpatient-wiseprecisionaround95%.InconjunctiontoDice,theidentiﬁedmostrelevantothermetricsweretherelativeabsolutevolumedifference,thevariationofinformation,andtheHausdorff,Mahalanobis,andobjectaveragesymmetricsurfacedistances.WithourRaidionicssoftware,runningonadesktopcomputerwithCPUsupport,tumorsegmentationcanbeperformedin16to54secondsdependingonthedimensionsoftheMRIvolume.Forthegenerationofastandardizedclinicalreport,includingthetumorsegmentationandfeaturescomputation,5to15minutesarenecessary.Alltrainedmodelshavebeenmadeopen-accesstogetherwiththesourcecodeforbothsoftwaresolutionsandvalidationmetricscomputation.Inthefuture,amethodtoconvertresultsfromasetofmetricsintoaﬁnalsinglescorewouldbehighlydesirableforeasierrankingacrosstrainedmodels.Inaddition,anautomaticclassiﬁcationofthebraintumortypewouldbenecessarytoreplacemanualuserinput.Finally,theinclusionofpost-operativesegmentationinbothsoftwaresolutionswillbekeyforgeneratingcompletepost-operativestandardizedclinicalreports.Keywords3Dsegmentation,Deeplearning,RADS,MRI,Glioma,Meningioma,Metastasis,Open-sourcesoftware1IntroductionPrognosisinpatientswithbraintumorsisheterogeneouswithsurvivalratesvaryingfromweekstoseveralyearsdependingonthetumorgradeandtype,andforwhichmostpatientswillexperienceprogressiveneurologicalandcognitivedeﬁcit[1].Braintumorscanbeclassiﬁedaseitherprimaryorsecondary.Intheformer,tumorsoriginatefromthebrainitselforitssupportingtissueswhereasinthelattercancercellshavespreadfromtumorslocatedelsewhereinthebodytoreachthebrain(i.e.,brainmetastasis).AccordingtotheWorldHealthOrganizationclassiﬁcationoftumors[2],primarybraintumorsaregradedbyhistopathologicalandgeneticanalysesandcanberegroupedin100differentsubtypeswithfrequenttorelativelyrareoccurrences.Amongstthemostfrequentsubtypes,tumorsarisingfromthebrain’ssupportivecellpopulation(i.e.,glialtissue)arereferredtoasgliomas.Themoreaggressiveentitiesarelabelledashigh-gradegliomas(HGGs)andaregradedbetween3and4,whilethelessaggressiveentitiesarereferredtoasdiffuselowergradegliomas(LGGs)andaregradedbetween2and3.Tumorsarisingfromthemeninges,whichformtheexternalmembranouscoveringthebrain,arereferredtoasmeningiomas.Asidefromtheaforementionedlargecategories,otherandlessfrequenttumortypesexist(e.g.,inpituitary,sellar,orpinealregions).Eachtumorcategoryhasadistinctbiology,prognosis,andtreatment[3,4].Themostcommonprimarymalignantbraintumortypeinadultsishigh-gradegliomawhichremainsamongthemostdifﬁcultcancerstotreatwithalimited5-yearoverallsurvival[5].Forpatientsaffectedbybraintumors,prognosisestimationandtreatmentdecisionsaremadebyamultidisciplinaryteam(includingneurosurgeons,oncologists,andradiologists),andbasedonasetofpreoperativeMRscans.Ahighaccuracyinthepreoperativediagnosticsphaseisofutmostimportanceforpatientoutcomes.Judgementsconcerningthecomplexityorradicalityofsurgery,ortherisksofpostoperativecomplicationshingeondatagleanedfromMRscans.Additionally,tumor-speciﬁccharacteristicssuchasvolumeandlocation,orcorticalstructuresproﬁlecantoalargedegreebecollected[6].Retrospectively,suchmeasurementscanbegatheredfromtheanalysisofsurgicalcohorts,multicentertrials,orregistriesinordertodevisepatientoutcomepredictionmodels[7,8,9].Reliablemeasurementsandreportingoftumorcharacteristicsarethereforeinstrumentalinpatientcare.Standardreportinganddatasystems(RADSs)havebeenestablishedforseveralsolidtumorssuchasprostatecancer[10]andlungcancer[11].Veryfewattemptshavebeenmadeforbraincanceringeneral[12]orglioblastomas[13].ThemaingoalofRADSsistoproviderulesforimagingtechniques,terminologyofreports,deﬁnitionsoftumorfeatures,andtreatmentresponsetoreducepracticevariationandobtainreproducibletumorclassiﬁcation.AbroadimplementationcanfacilitatecollaborationsandstimulateevaluationfordevelopmentandimprovementofRADSs.Currently,thelackofstandardizedandautomaticmethodsfortumordetectioninbrainMRscansrepresentsamajorhurdletowardsthegenerationofclinicalreportsincorporatingawiderangeoftumorcharacteristics.Manualtumordelineationorassessmentbyradiologistsistime-consumingandsubjecttointraandinter-ratervariationsthat2APREPRINT-MAY2,2022aredifﬁculttocharacterize[14]andthereforerarelydoneinclinicalpractice.Asaresult,informativetumorfeatures(e.g.,locationorvolume)areoftenestimatedfromtheimagessolelybasedoncrudemeasuringtechniques(e.g.,eyeballing)[15].1.1RelatedworkFromthefast-growingdevelopmentintheﬁeldofdeeplearning,convolutionalneuralnetworkshavedemonstratedimpressiveperformanceinvarioussegmentationtasksandbenchmarkchallenges,withtheadded-valueofbeingfullyautomaticanddeterministic[16].Regardingbraintumorsegmentation,performanceshavespeciﬁcallybeenassessedontheBrainTumorSegmentationchallenge(BraTS)dataset[17,18].Occurringeveryyearsince2012,thechallengefocusesongliomas(i.e.,HGGsandLGGs)andhasreachedanotablecohortsizewithatotalof2040patientsincludedinthe2021edition,andmultipleMRsequencesincludedforeachpatient(i.e.,T1c,T1w,T2,FLAIR).SegmentationperformancehasbeenassessedusingtheDicesimilaritycoefﬁcientandthe95thpercentileHausdorffdistance(HD95)asmetrics[19].Thecurrentstate-of-the-artisanextensionofthennU-Netarchitecture[20]withanasymmetricalnumberofﬁltersbetweentheencodinganddecodingpaths,substitutionofallbatchnormalizationlayersbygroupnormalization,andadditionofaxialattention[21].AnaverageDicescoreof85%togetherwitha17.70mmHD95wereobtainedfortheenhancingtumorsegmentationtaskinglioblastomas.Thesegmentationofotherbraintumortypeshasbeensparselyinvestigatedintheliteratureincomparison,possiblyduetoalackofopen-accessannotateddata,asillustratedbyrecentreviewsorstudiesinvestigatingbraintumorsegmentationingeneral[22,23].Groviketal.usedamulticentricandmulti-sequencedatasetof165metastaticpatientstotrainasegmentationmodelwiththeDeepLabV3architecture[24,25].Thebestsegmentationresultswerearound79%Dicescorewith3.6falsepositivedetectionsperpatientonaverage.OtherpriorstudieshavefocusedonusingvariationsoftheDeepMedicarchitecture[26],usingcontrast-enhancedT1-weightedMRIvolumesasinput,totraintheirsegmentationmodels[27,28].Datasetswereofasimilarmagnitudewitharound200patients.However,inbothcasesthetestsetswerelimitedtoupto20patients,makingitdifﬁculttoassessthegeneralizationabilityofthetrainedmodelsintheabsenceofcross-validationstudies.ObtainedaverageDicescoresoverthecontrast-enhancingtumorwereapproximating75%,withalmost8falsepositivedetectionsperpatient.Fromarecentreviewontheuseofmachinelearningappliedtodifferentmeningioma-relatedtasksusingMRIscans[29],morethan30previousstudieshaveinvestigatedautomaticdiagnosisorgradingbutonlyahandfulfocusedonthesegmentationtask.Inaddition,datasets’magnitudeusedforsegmentationpurposeshasbeenconsistentlysmallerthanfortheothertasks,withbarelyupto126patientsinthereportedstudies.Laukampetal.reportedthebestDicescoresusingwell-known3DneuralnetworkarchitecturessuchasDeepMedicandBioMedIA,thoughattheexpenseofheavypreprocessingtechniquesthelikesofatlasregistration[30,31].Inapreviousstudy,weachievedequallypromisingperformanceusinganattention-basedU-Netarchitecture,reachinganaverageDicescoreofupto88%oncontrast-enhancedT1-weightedMRIvolumes[32].Inaddition,thecross-validationstudiesperformedoverupto600patientswithawiderangeoftumorsizes,comingfromthehospitalandtheoutpatientclinic,exhibitedaproperabilitytogeneralizefromthetrainedmodels.Tosummarize,withtheexceptionoftheBraTSchallenge,thereisadearthofhigh-qualityMRIdatasetsforbraintumorsegmentation.Furthermore,open-accesspretrainedmodelsandinferencecodearescarceandcanbecumbersometooperate,hencehinderingthegenerationofprivatedatasetsforbraintumorsegmentationtasks.Ontheotherhand,open-sourcetoolsarebeingdevelopedtoassistinimagelabelingandgenerationofAImodelsforclinicalevaluation,suchasMONAIlabel[33].Yet,theydonotintegratenorprovideaccesstothelatestandhighestperformingbraintumorsegmentationmodelsfromtheliterature.Fromavalidationstandpoint,thefocushasbeenonreportingDicescoresandoftenHausdorffdistances,whilemanyothermeaningfulandpossiblymorerelevantmetricsexistandcouldbeinvestigatedtobetterhighlightstrengthsandweaknessesofthedifferentsegmentationmethods[34,35].TheliteratureonRADSsforbraintumorsisequallyscarcewithonlyfewattemptsforpreoperativeglioblastomasurgery[13]orpost-treatmentinvestigation[36].Intheformer,automaticsegmentationandcomputationofrelevanttumorfeatureswasprovided,andanexcellentagreementhasbeenshownbetweencharacteristicscomputedoverthemanualandautomaticsegmentations.Inthelatter,theinterpretationofthepost-treatmentMRscanswasprovidedusingastructuredsetofrules,butdeprivedofanyautomatictumorsegmentationorimageanalysissupport.1.2ContributionsWhileresearchisexceedinglyaheadforgliomasegmentationundertheaegisoftheBraTSchallengecommunity,thesegmentationofmeningiomasandmetastasesistrailingbehind.Inaddition,validationstudiesintheliteraturehavetoooftenbeendominatedbyDicescorereportingandabroaderinspectionisessentialtoensureclinicalrelevance.Finally,theoutcomeofthisresearchisoftennotreadilyavailable,especiallyfortheintendedend-userswhoareclinicianswithoutprogrammingexperience.Assuch,thecontributionsofourstudyare:(i)thetrainingofrobustsegmentationmodelsforglioblastomas,lowergradegliomas,meningiomas,andmetastasesassessedusingapanelofmorethan20differentmetricstobetterhighlightperformance,(ii)thedevelopmentoftwosoftwaresolutionsenablingeasyuseofthetrainedmodelsandtumorfeaturescomputation:RaidionicsandRaidionics-Slicer,and(iii)open-accessmodelsandsourcecodeforthesoftwareandvalidationmetricscomputation.3APREPRINT-MAY2,20222DataForthisstudy,fourdifferentdatasetshavebeenassembled,oneforeachmaintumortypeconsidered:glioblastoma,lowergradeglioma,meningioma,andmetastasis.Thetumortypewasassessedattimeofsurgery,whenapplicable,followingthecurrentlyapplicableguidelines(i.e.,eitherWHO2007orWHO2016).Tumorsweremanuallysegmentedin3Dbytrainedratersusingassupporteitheraregiongrowingalgorithm[37]oragrowcutalgorithm[38],andsubsequentmanualediting.Trainedratersweresupervisedbyneuroradiologistsandneurosurgeons.Oncontrast-enhancedT1-weightedscans,thetumorwasdeﬁnedasgadolinium-enhancingtissueincludingnon-enhancingenclosednecrosisorcysts.OnFLAIRscans,thetumorwasdeﬁnedasthehyperintenseregion.Thefourdatasetsareintroducedin-depthinthesubsequentsections.AnoverallsummaryofthedataavailableisreportedinTable1,andsomevisualexamplesareprovidedinFig.1.Table1:Overviewofthedatasetsgatheredforthefourbraintumortypesconsidered.OnlyoneMRIsequenceisavailableforeachpatient,andT1ccorrespondstoGd-enhancedT1-weightedMRscans.TumortypeSequencetype#patients#sourcesVolumeaverage(ml)Volumerange(ml)GlioblastomaT1c21341534.37±28.83[0.01,243.39]LowergradegliomaFLAIR659451.71±78.60[0.14,478.83]MeningiomaT1c719219.40±28.62[0.07,209.38]MetastasisT1c396217.53±17.97[0.01,114.77]2.1GlioblastomasTheglioblastomadatasetismadeofatotalof2134Gd-enhancedT1-weightedMRIvolumesoriginatingfromfourteendifferenthospitals,andonepublicchallenge.Theﬁrst1841patientshavebeencollectedfromfourteendifferenthospitalsworldwide:38patientsfromtheNorthwestClinics,Alkmaar,Netherlands(ALK);97patientsfromtheAmsterdamUniversityMedicalCenters,locationVUmedicalcenter,Netherlands(AMS);86patientsfromtheUniversityMedicalCenterGroningen,Netherlands(GRO);103patientsfromtheMedicalCenterHaaglanden,theHague,Netherlands(HAG);75patientsfromtheHumanitasResearchHospital,Milano,Italy(MIL);74patientsfromtheHôpitalLariboisière,Paris,France(PAR);134patientsfromtheUniversityofCaliforniaSanFranciscoMedicalCenter,U.S.(SFR);49patientsfromtheMedicalCenterSlotervaart,Amsterdam,Netherlands(SLO);153patientsfromtheStElisabethHospital,Tilburg,Netherlands(TIL);171patientsfromtheUniversityMedicalCenterUtrecht,Netherlands(UTR);83patientsfromtheMedicalUniversityVienna,Austria(VIE);72patientsfromtheIsalahospital,Zwolle,Netherlands(ZWO);456patientsfromtheSt.Olavshospital,TrondheimUniversityHospital,Norway(STO);and249patientsfromtheSahlgrenskaUniversityHospital,Gothenburg,Sweden.Anin-depthdescriptionofmostcohortscanbefoundinarecentstudy[13].Theremaining293patientscorrespondtothetrainingsetoftheBraTSchallenge(edition2020),buthavealreadyundergonepreprocessingtransformationssuchasskull-stripping.Overall,MRIvolumedimensionsarecovering[159;896]×[86;896]×[17;512]voxels,andthevoxelsizeranges[0.26;1.25]×[0.26;2.00]×[0.47;7.50]mm3.AnaverageMRIvolumeis[303×323×193]pixelswithaspacingof[0.86×0.84×1.24]mm3.2.2LowergradegliomasThelowergradegliomadatasetismadeofatotalof659FLAIRMRIvolumes,withmostlygrade2diffusegliomas,comingfromfourdifferenthospitals:330patientsfromtheBrighamandWomensHospital,Boston,USA;165patientsfromtheSt.Olavshospital,TrondheimUniversityHospital,Norway;154patientsfromtheSahlgrenskaUniversityHospital,Gothenburg,Sweden;and10fromtheUniversityHospitalofNorthNorway,Norway.Overall,MRIvolumedimensionsarecovering[192;576]×[240;640]×[16;400]voxels,andthevoxelsizeranges[0.34;1.17]×[0.34;1.17]×[0.50;8.0]mm3.AnaverageMRIvolumeis[349×363×85]pixelswithaspacingof[0.72×0.72×4.21]mm3.2.3MeningiomasThemeningiomadatasetismadeof719Gd-enhancedT1-weightedMRIvolumes,mostlybuiltaroundadatasetpreviouslyintroduced[39],showcasingpatientseitherfollowedattheoutpatientclinicorrecommendedforsurgeryattheSt.Olavshospital,TrondheimUniversityHospital,Norway.Overall,MRIvolumedimensionsarecovering[192;512]×[224;512]×[11;290]voxels,andthevoxelsizeranges[0.41;1.05]×[0.41;1.05]×[0.60;7.00]mm3.AnaverageMRIvolumeis[343×350×147]pixelswithaspacingof[0.78×0.78×1.67]mm3.4APREPRINT-MAY2,2022Figure1:ExamplesofbraintumorsfromtherawMRIvolumescollectedinthisstudy.Eachrowillustratesatumortype:glioblastoma,lowergradeglioma,meningioma,metastasis(fromtoptobottom).Themanualannotationcontoursareoverlaidinred.5APREPRINT-MAY2,20222.4MetastasesThemetastasisdatasetismadeofatotalof396Gd-enhancedT1-weightedMRIvolumes,collectedfromtwodifferenthospitals:329patientsfromtheSt.Olavshospital,TrondheimUniversityHospital,Norway;and67patientsfromOsloUniversityHospital,Oslo,Norway.Overall,MRIvolumedimensionsarecovering[128;560]×[114;560]×[19;561]voxels,andthevoxelsizeranges[0.43;1.33]×[0.43;1.80]×[0.45;7.0]mm3.AnaverageMRIvolumeis[301×370×289]pixelswithaspacingof[0.85×0.76×1.08]mm3.3MethodsFirst,theprocessforautomaticbraintumorsegmentationincludingdatapreprocessing,neuralnetworkarchitecture,andtrainingdesignisintroducedinSection3.1.Second,thetumorcharacteristicsextractionprocess,usingthegeneratedtumorsegmentationasinput,issummarizedinSection3.2.Finally,adescriptionofthetwodevelopedsoftwaresolutionsforperformingsegmentationandstandardizedreportingisgiveninSection3.33.1TumorsegmentationThearchitectureselectedtotrainsegmentationmodelsforeachbraintumortypeisAGU-Net,whichhasshowntoperformwellonglioblastomaandmeningiomasegmentation[40,32].Inthefollowing,thedifferenttrainingblocksarepresentedwithsomeinnervariationsspeciﬁedbyromannumbersinsidebrackets.AglobaloverviewisprovidedinTable2summarizingusedvariants.Table2:Summaryofthemodeltrainingstrategyfollowedforeachtumortype.TumortypePreprocessingStrategyProtocolglioblastoma(ii)skull-stripping(i)from-scratch(i)leave-one-outlowergradeglioma(i)tightclipping(i)from-scratch(ii)5-foldMeningioma(i)tightclipping(i)from-scratch(ii)5-foldMetastasis(ii)skull-stripping(ii)transfer-learning(ii)5-foldArchitecture:Single-stageapproachleveragingmulti-scaleinputanddeepsupervisiontopreservedetails,coupledtoasingleattentionmodule.Thelossfunctionusedwastheclass-averagedDiceloss,excludingthebackground.Theﬁnalarchitecturewasasdescribedintheoriginalarticlewith5levelsand[16,32,128,256,256]asconvolutionblocks.Preprocessing:Thefollowingpreprocessingstepswereused:1.resamplingtoanisotropicspacingof1mm3usingsplineinterpolationoforder1fromNiBabel1.2.(i)tightclippingaroundthepatient’shead,excludingthevoidbackground,or(ii)skull-strippingusingacustombrainsegmentationmodel.3.volumeresizingto128×128×144voxelsusingsplineinterpolationoforder1.4.intensitynormalizationtotherange[0,1].Trainingstrategy:ModelsweretrainedusingtheAdamoptimizeroverabatchsizeof32sampleswithaccumulatedgradients(actualbatchsize2),stoppedafter30consecutiveepochswithoutvalidationlossimprovement,followingeither:(i)trainingfromscratchwith1e−3initiallearningrate,ortransferlearningwithaninitiallearningrateof1e−4ﬁne-tuningoverthebestglioblastomamodel.Forthedataaugmentationstrategy,thefollowingtransformswereappliedtoeachinputsamplewithaprobabilityof50%:horizontalandverticalﬂipping,randomrotationintherange[−20◦,20◦],andtranslationupto10%oftheaxisdimension.Trainingprotocol:Giventhemagnitudedifferencewithinourfourdatasets,twodifferentprotocolswereconsidered:(i)athree-waysplitatthehospitallevelwherebyMRIvolumesfromonehospitalconstitutedthevalidationfold;MRIvolumesfromasecondhospitalconstitutedthetestfold;andtheremainingMRIvolumesconstitutedthetrainingfold.Assuch,eachhospitalwasusedinturnasthetestsetinordertoproperlyassesstheabilityofthedifferentmodelstogeneralize.Or(ii)a5-foldcross-validationwithrandomtwo-waysplitoverMRIvolumeswherebyfourfoldsareusedinturnastrainingsetandtheremainingoneasvalidationset,withouttheexistenceofaproperseparatetestset.1https://github.com/nipy/nibabel6APREPRINT-MAY2,20223.2PreoperativeclinicalreportingForthegenerationofstandardizedpreoperativeclinicalreportsinareproduciblefashion,thecomputationoftumorcharacteristicswasperformedafteralignmenttoastandardreferencespace.Asdescribedin-depthinourpreviousstudy[13],thereferencespacewasconstitutedbythesymmetricMontrealNeurologicalInstituteICBM2009aatlas(MNI)[41].TheatlasspacenotpossessinganybrainaverageasFLAIRsequence,theT1atlasﬁlewasusedforalltumortypes.Foreachtumortype,thecollectionoffeaturesincludes:volume,laterality,multifocality,corticalstructurelocationproﬁle,andsubcorticalstructurelocationproﬁle.Speciﬁcallytailoredforglioblastomas,resectabilityfeaturesarethereforenotavailablefortheotherbraintumortypes.3.3ProposedsoftwareInordertomakeourmodelsandtumorfeatureseasilyavailabletothecommunity,wehavedevelopedtwosoftwaresolutions.Theﬁrstoneisastand-alonesoftwarecalledRaidionics,andthesecondoneisapluginto3DSlicergivenitspredominantandwidespreaduseintheﬁeld[42].Bothsolutionsprovideaccesstoasimilarback-endincludinginferenceandprocessingcode.However,theGUIandintendeduserinteractionsdiffer.Thetrainedmodelsarestoredinaseparateonlinelocationandaredownloadedontheuser’scomputeratruntime.Modelscanbeimprovedovertimeandachangewillbeautomaticallydetected,resultinginthereplacementofoutdatedmodelsontheuser’smachine.Figure2:IllustrationoftheRaidionicssoftwareaftergeneratingthestandardizedreportforapatientsufferingfromaglioblastoma.Theleftsidepresentsthetumorcharacteristicsbelongingtothereport,whereastherightsideoffersasimplisticviewer.3.3.1Stand-alonesolution:RaidionicsThesoftwareproposestwomodes:(i)single-usewhereonlyonepatientistobeprocessedandresultscanbevisuallyassessedinthe2Dviewer,and(ii)batch-modewherebyacollectionofpatientscanbeprocessedsequentiallywithoutanyviewingpossibility.Ineachmode,theoptionislefttotheusertosolelyperformtumorsegmentation,ortocomputethewholesetoftumorcharacteristicsandgeneratethestandardizedreport.Foreachpatient,thesoftwareexpectsanMRIscanasinput(i.e.,Gd-enhancedT1-weightedorFLAIRsequence)andthetumortypemustbemanuallyselected.Additionally,apre-existingtumorsegmentationmaskcanbeprovidedtobypasstheautomaticsegmentation,ifcollectingthetumorcharacteristicsisthemaininterestandmanualannotationshavebeenperformedbeforehand.Thetotalsetofprocessedﬁlessavedondiskincludesthestandardizedreports,brainandtumorsegmentationmasksinboth7APREPRINT-MAY2,2022patientandMNIspace,corticalandsubcorticalstructuresmasksinbothpatientandMNIspace,andtheregistrationﬁlestonavigatefrompatienttoMNIspace.Tocomplementthereportingandgivethepossibilityforfollow-upstatisticalstudies,thecompletesetofcomputedfeaturesisalsoprovidedincommaseparatedvalueformat(i.e.,.csv).ThesoftwarehasbeendevelopedinPython3.6.9,usingPySide2v5.15.2forthegraphicaluserinterface,andonlyusestheCentralProcessingUnit(CPU)forthevariouscomputations.ThesoftwarehasbeentestedandiscompatiblewithWindows(≥10),macOS(≥Catalina10.15),andUbuntuLinux(≥18.04).AnillustrationofthesoftwareisprovidedinFig.2.Cross-platforminstallersandsourcecodearefreelyavailableathttps://github.com/dbouget/Raidionics.3.3.23DSlicerplugin:Raidionics-SlicerThe3DSlicerpluginhasbeendevelopedusingtheDeepInferpluginasbaseline[43],andismostlyintendedfortumorsegmentationpurposes.Throughaslider,thepossibilityisprovidedtomanuallyaltertheprobabilitythresholdcutoffinordertoreﬁnetheproposedbinarymask.Furthermanualeditingcanbeperformedthereafterusingtheexisting3DSlicerfunctionalities.Theback-endprocessingcodehasbeenbundledintoaDockerimageforconvenience,andthereforeadministratorrightsarerequiredfortheend-usertoperformtheinstallationlocally.Thesameinputs,behaviour,andoutputscanbeexpectedasforthestand-alonesoftware.TheGitHubrepositoryforthe3DSlicerplugincanbefoundathttps://github.com/dbouget/Raidionics-Slicer,andanillustrationisprovidedinFig.3.Figure3:IllustrationoftheRaidionics-Slicerpluginaftergeneratingthestandardizedreportforapatientsufferingfromaglioblastoma.4ValidationstudiesInthevalidationstudies,onlytheautomaticsegmentationperformancesareassessed.Theclinicalvalidityandrelevanceoftheextractedtumorfeatureshasbeenaddressedthoroughlyinapreviousstudy[13].Tobettergraspthedifferentaspectsofthesegmentationperformance,awidersetofmetricsisstudiedasdescribedinSection4.1.Forthevoxel-wisesegmentationtask,onlytwoclassesareconsideredasthewholetumorextent(includingcontrast-enhancingregions,cysts,andnecrosis)isthetarget:non-tumortissueortumortissue.Inthatsense,apositivevoxelisavoxelexhibitingtumortissue,whereasanegativevoxelisavoxelexhibitingbackgroundornormaltissue.4.1MetricsFollowingareviewonmetricsforevaluating3Dmedicalimagesegmentation[35],abroadspectrumof25metricswasselected,computedeithervoxel-wiseorinstance-wise,andgroupedaccordingtothefollowingcategories:overlap-based,volume-based,informationtheory-based,probabilistic,andspatialdistance-based.Voxel-wise:Forquantifyingsemanticsegmentationperformance,wehaveselectedthefollowingmetricscomputeddirectlyandindiscriminatelyoverallvoxelsofagivenpatientMRIvolume:8APREPRINT-MAY2,20221.Overlap-based:(i)TruePositiveRate(TPR),alsocalledrecallorsensitivity,istheprobabilitythatanactualpositivevoxelwilltestpositive;(ii)TrueNegativeRate(TNR),alsocalledspeciﬁcity,istheprobabilitythatanactualnegativevoxelwilltestnegative;(iii)FalsePositiveRate(FPR),istheprobabilitythatafalsealarmwillberaised(i.e.,anegativevoxelwilltestpositive);(iv)FalseNegativeRate(FNR),alsocalledmissedrate,istheprobabilitythatatruepositivevoxelwilltestnegative;(v)PositivePredictiveValue(PPV),alsoreferredtoasprecision,istheratiooftrulypositivevoxelsoverallvoxelswhichtestedpositive;(vi)Dicescore(Dice),alsocalledtheoverlapindexandgaugingthesimilarityoftwosamples,isthemostcommonlyusedmetricinvalidatingmedicalvolumesegmentation[44];(vii)DiceTruePositivescore(Dice-TP)issimilartotheDicescore,butisonlycomputedoverthetruepositivepredictions(i.e.,whenthemodelfoundthetumor);(viii)IntersectionOverUnion(IoU),alsocalledtheJaccardindex,measuresthevolumesimilarityasthesizeoftheintersectiondividedbythesizeoftheunionoftwosamples[45];(ix)GlobalConsistencyError(GCE),deﬁnedastheerrormeasureaveragedoverallvoxels[46].2.Volume-based:(i)VolumetricSimilarity(VS),astheabsolutevolumedifferencedividedbythesumofthecomparedvolumes[47];(ii)RelativeAbsoluteVolumeDifference(RAVD),astherelativeabsolutevolumedifferencebetweenthejointbinaryobjectsinthetwoimages.Thisisapercentagevalueintherange[−1.0,∞)forwhicha0denotesanidealscore.3.Informationtheory-based:(i)NormalizedMutualInformation(MI),normalizationofthemutualinformationscoretoscaletheresultsbetween0(nomutualinformation)and1(perfectcorrelation)[48];(ii)VariationOfInformation(VOI),measuringtheamountofinformationlostorgainedwhenchangingfromonevariabletotheother,inthiscasetocompareclusteringpartitions[49].4.Probabilistic:(i)Cohen’sKappaScore(CKS),measuringtheagreementbetweentwosamples[50].Themetricrangesbetween−1.0and1.0wherebythemaximumvaluemeanscompleteagreement,andzeroorlowermeanschanceagreement;(ii)AreaUndertheCurve(AUC),ﬁrstpresentedasthemeasureofaccuracyinthediagnosticradiology[51],furtheradjustedforthevalidationofmachinelearningalgorithms;(iii)VolumeCorrelation(VC),asthelinearcorrelationinbinaryobjectvolume,measuredthroughthePearsonproduct-momentcorrelationcoefﬁcientwherethecoefﬁcientranges[−1.,1.];(iv)MatthewsCorrelationCoefﬁcient(MCC),asameasureofthequalityofbinaryandmulticlassclassiﬁcations,takingintoaccounttrueandfalsepositivesandnegativesandgenerallyregardedasabalancedmeasure[52].Themetricrangesbetween−1.0and1.0whereby1.0representsaperfectprediction,0.0anaveragerandomprediction,and−1.0aninverseprediction;(v)ProbabilisticDistance(PBD),asameasureofthedistancebetweenfuzzysegmentations[53].5.Spatial-distance-based:(i)95thpercentileHausdorffdistance(HD95),measuringtheboundarydelineationquality(i.e.,contours).The95%versionisusedtomakemeasurementsmorerobusttosmalloutliers[54];(ii)theMahalanobisdistance(MHD),measuringthecorrelationofallpointsandcalculatedaccordingtothevariantdescribedforthevalidationofimagesegmentation[55];(iii)AverageSymmetricSurfaceDistance(ASSD),astheaveragesymmetricsurfacedistancebetweenthebinaryobjectsintwoimages.Instance-wise:Forquantifyinginstancedetectionperformance,wechosethefollowingmetrics,reportedinapatient-wisefashion(PW)orinanobject-wisefashion(OW).Inthelatter,andincaseofmultifocaltumors,eachfocusisconsideredasaseparatetumor.Thedetectionthresholdhasbeensetto0.1%Dicetodeterminewhetheranautomaticsegmentationiseligibletobeconsideredasatruedetectionorafalsepositive.1.Overlap-based:(i)Recall,astheratioin%oftumorsproperlyidentiﬁed;(ii)Precision,astheratioin%oftumorsincorrectlydetected;(iii)F1-score(F1),measuringinformationretrievalasatrade-offbetweentherecallandprecision[56];(iv)FalsePositivesPerPatient(FPPP),astheaveragenumberofincorrectdetectionsperpatient.2.Probabilistic:(i)AdjustedRandIndex(ARI),asasimilaritymeasurebetweentwoclustersbyconsideringallpairsofsamplesandcountingpairsthatareassignedinthesameordifferentclustersbetweenthemodelpredictionandthegroundtruth[57].Themetricrangesfrom−1.0to1.0,wherebyrandomsegmentationhasanARIcloseto0.0and1.0standsforperfectmatch.3.Spatial-distance-based:(i)ObjectAverageSymmetricSurfaceDistance(OASSD),astheaveragesymmetricsurfacedistance(ASSD)betweenthebinaryobjectsintwovolumes.4.2MeasurementsPooledestimates,computedfromeachfold’sresults,arereportedforeachmeasurement[58].Overall,measurementsarereportedasmeanandstandarddeviation(indicatedby±)inthetables.9APREPRINT-MAY2,2022Voxel-wise:Forsemanticsegmentationperformance,theDicescoreiscomputedbetweenthegroundtruthvolumeandabinaryrepresentationoftheprobabilitymapgeneratedbyatrainedmodel.Thebinaryrepresentationiscomputedfortendifferentequally-spacedprobabilitythresholds(PT)intherange]0,1].Instance-wise:Forinstancedetectionperformance,aconnectedcomponentsapproachcoupledtoapairingstrategywasemployedtoassociategroundtruthanddetectedtumorparts.Aminimumsizethresholdof50voxelswassetandobjectsbelowthatlimitwerediscarded.AdetectionwasdeemedtruepositiveforanyDicescorestrictlyhigherthan0%.4.3ExperimentsTovalidatethetrainedmodels,thefollowingsetofexperimentswasconducted:(i)Overallperformancestudy:k-foldcross-validationstudiesforthedifferenttumortypesforassessingsegmentationperformance.Foreasyinterpretation,onlyDicescorestogetherwithpatient-wiseandobject-wiserecall,precision,andF1-scorevaluesarereported.(ii)Metricsanalysis:in-depthperformancecomparisonusingtheadditionalmetrics,andconfusionmatrixcomputationbetweenthemetricstoidentifyredundancyintheiruse.(iii)Representativemodelsselection:identiﬁcationofoneﬁnalsegmentationmodelforeachtumortype,whichwillbemadeavailableforuseinoursoftwaresolutions.(iv)Speedstudy:computationofthepureinferencespeedandthetotalelapsedtimerequiredtogeneratepredictionsforanewpatient,obtainedwithCPUsupportandreportedinseconds.Theoperationsrequiredtopreparethedatatobesentthroughthenetwork,toinitializetheenvironment,toloadthetrainedmodel,andtoreconstructtheprobabilitymapinthereferentialspaceoftheoriginalvolumeareaccountedfor.TheexperimentwasrepeatedtenconsecutivetimesoverthesameMRIvolumeforeachmodel,usingarepresentativesampleofeachdatasetintermsofdimensionandspacing.5Results5.1ImplementationdetailsResultswereobtainedusingacomputerwiththefollowingspeciﬁcations:IntelCoreProcessor(Broadwell,noTSX,IBRS)CPUwith16cores,64GBofRAM,TeslaV100S(32GB)dedicatedGPU,andaregularhard-drive.TrainingandinferenceprocesseswereimplementedinPython3.6usingTensorFlowv1.13.1,andthedataaugmentationwasperformedusingtheImgaugPythonlibrary[59].Themetricswereforthemostpartcomputedmanuallyusingtheequationsdescribedinthesupplementarymaterial,oralternativelyusingthesklearnv0.24.2[60]andmedpyv0.4.0[61]Pythonlibraries.Thesourcecodeusedforcomputingthemetricsandperformingthevalidationstudiesismadepubliclyavailableathttps://github.com/dbouget/validation_metrics_computation.5.2OverallperformancestudyTable3:Segmentationperformancesummaryforeachtumortype.Voxel-wisePatient-wiseObject-wiseTumortypeDiceDice-TPF1-scoreRecallPrecisionF1-scoreRecallPrecisionGlioblastoma85.69±16.9787.36±12.1797.40±01.0198.08±01.2996.76±01.4389.61±04.1185.78±07.9594.19±02.71LGG75.39±25.9581.24±16.0193.60±01.7492.86±03.1994.42±01.0781.58±02.2575.58±02.4188.70±03.16Meningioma75.00±30.5284.81±15.0790.67±01.4288.46±02.1293.25±04.7683.85±03.6080.93±04.3487.77±08.30Metastasis87.73±18.9490.02±12.8097.54±00.7697.46±01.3897.63±00.7788.71±01.3482.80±02.3895.60±01.45AnoverallsummaryofbraintumorsegmentationperformanceforallfourtumorsubtypesispresentedinTable3.MeningiomasandlowergradegliomasappearmoredifﬁculttosegmentgivenaverageDicescoresof75%,comparedtoaverageDicescoresof85%forglioblastomasandmetastases.Asimilartrend,yetwithaslightlysmallergap,canbenotedfortheDice-TPscoresrangingbetween81%and90%withastandarddeviationaround15%,indicatingthequalityandrelativestabilityofthetrainedmodels.Fromapatient-wiseperspective,thoseresultsdemonstratethedifﬁcultyofachievinggoodrecallwhilekeepingtheprecisionsteadilyabove95%.Eventhoughadirectcomparisontotheliteratureisimpossiblesincedifferentdatasetshavebeenused,obtainedperformanceison-parifnotbetterthanpreviouslyreportedperformanceswhereDicescoreshavebeenrangingfrom75%to85%.Regardingthelowergradegliomatumorsubtype,thediffusenatureofthetumorsandlesspronouncedgradientsoverimageintensitiesarepossibleexplanationsforthelowersegmentationperformance.Forthemeningiomacategory,thereasonforthelowerDice-scoreandrecallvaluescanbeattributedtothelargernumberofsmalltumors(<2ml)comparedtoothersubtypes.Inaddition,outliershavebeenidentiﬁedinthisdatasetwherebyasmallextentofthetumorswereeitherpartlyenhancingbecauseofcalciﬁcation,ornon-enhancingduetointraosseousgrowth.Forall10APREPRINT-MAY2,2022Figure4:Volume-wise(equallybinned)Diceperformanceasboxplotsforeachofthefourtumortypes.tumortypes,Dice-scoredistributionsarereportedagainsttumorvolumesinFig.4fortenequally-sizedbins.Formeningiomas,fourbinsarenecessarytogrouptumorswithavolumeupto4mlwhileonlyonebinisnecessaryfortheglioblastomas,indicatingavolumedistributionimbalancebetweenthetwotypes.Thediamond-shapedpointsoutsidetheboxesrepresentcaseswherethesegmentationmodeldidnotperformwell(cf.FiguresS1,S2,S3,andS4,Sup.Mat.).WhiletumorvolumesandoutlierMRscansarereasonsforthediscrepancyinDiceandrecallvaluesacrosstheboard,precisionisratherunaffectedandmorestable.Thenatureoftheconvolutionalneuralnetworkarchitectureandtrainingstrategyusedcanexplainthoseresults.Byleveragingvolumescoveringthefullbrain,globalrelationshipscanbelearnedbythetrainedmodelhencereducingtheconfusionbetweentumorregionsandothercontrast-enhancingstructuressuchasbloodvessels.GivenGPUmemorylimitation,thepreprocessedMRscanshaveundergoneasigniﬁcantdownsampling,andassuchsmalltumorsarereducedtoveryfewvoxels,impactingmainlyrecallperformance.Finally,anaveragedecreaseof∼10%canbenoticedbetweenpatient-wiseandobject-wisedetectionmetrics,wherebysatellitetumorsareonaverageanorderofmagnitudesmallerthanthemaintumor,andarehencemorepronetobeomittedorpoorlysegmentedbyourmodels.SegmentationperformanceisillustratedinFig.5.Eachrowcorrespondstoonetumortypeandeachcolumndepictadifferentpatient.5.3MetricsanalysisSide-by-sidevoxel-wiseperformancesregardingtheoverlap-basedmetricsarereportedinTable4andTable5.Unsurprisingly,giventhegoodprecisionperformanceandtheabsenceofpatientswithoutatumor,bothTNRanditsoppositeFPRscoresarealmostperfectforalltumortypes.Similarly,theTPRanditsoppositeFNRmetricsarescoringsimilarlytoDice.Withineachtumorcategory,theoverlap-basedmetricsarefollowingthesametrendwherebyahigheraverageDicescorewouldcorrelatewithahigherscoreforanyothermetricsandviceversa(e.g.,IoU).AnexceptioncanbemaderegardingthebehaviouroftheGCEmetric,scoringonaveragehigherforglioblastomasthanformeningiomasandassuchnotfollowingthesamepatternasDice.Uponcarefulvisualinspection,theGCEmetricseemstobeextremelysensitivetooutliers,eithercomingfromtheimagequalityormanualgroundtruthcorrectness(cf.toprowinFiguresS1-S4,Sup.Mat.).Giventhenon-normalizedstateoftheGCEmetric,anditsabsenceofanyupper11APREPRINT-MAY2,2022Figure5:Examplesofsegmentationperformances.Onerowillustratesonetumortype:glioblastoma,lowergradeglioma,meningioma,metastasis(fromtoptobottom),andeachcolumndepictsadifferentpatient.Themanualdelineationisshowninred,theautomaticsegmentationinblue,andthepatient-wiseDicescoreinwhite.bound,anextremelypooragreementbetweenmanualgroundtruthandautomaticsegmentationwillresultinascoreordersofmagnitudehigherthanitsaverageexpressionoveragivendataset.Regardingthetwovolume-basedmetrics,featuredrightmostinthesecondtable,anantagonisticpatterntowardsDicecanbeobserved.TheVSmetrichasthesamecross-typetrendasDicewithsimilaryetslightlygreaterscores.Ontheotherhand,whiletheRAVDmetricscoresbestoverthemetastasisgroupsimilartoDice,itsworstaveragevalueisobtainedfortheglioblastomagroup,hencepotentiallyexhibitingthesamefrailtytowardsoutliersasfortheGCEmetric.Nextoff,voxel-wiseperformanceforinformationtheory-basedandprobabilisticmetricareregroupedinTable6.TheMIandVOImetrics,bothbasedoninformationtheory,areexhibitinganinversebehaviourinlinewithobservationsabouttherelationshipbetweenDiceandGCEmetrics.Thenormalizedmutualinformationmetricrangesfrom0.66812APREPRINT-MAY2,2022Table4:Voxel-wiseoverlap-basedmetricsperformancesummaryforeachtumortype.TumortypeTPRTNRFPRFNRPPVGlioblastoma87.88±17.6499.96±00.0600.04±00.0612.12±17.6487.35±13.29LGG77.91±27.8999.90±00.1600.09±00.1622.08±27.8982.16±17.01Meningioma77.44±32.4899.97±00.0400.02±00.0422.56±32.4884.77±15.69Metastasis88.45±20.8299.98±00.0300.01±00.0311.54±20.8289.43±16.78Table5:Voxel-wiseperformancesummaryforeachtumortypeforoverlap-basedandvolume-basedmetrics.Overlap-basedVolume-basedTumortypeDiceDice-TPIoUGCE(1e4)VSRAVDGlioblastoma85.69±16.9787.36±12.1777.59±17.9912.34±12.5790.43±16.9413.98±171.2LGG75.39±25.9581.24±16.0165.72±25.3234.15±46.3482.20±26.4407.88±60.14Meningioma75.00±30.5284.81±15.0767.13±29.3909.04±17.5380.21±31.0807.87±61.31Metastasis87.73±18.9490.02±12.8081.56±20.4204.55±07.6291.37±18.6102.11±55.35to0.829forDicescoresbetween75%and87%,showcasingstabilitybutalsocorrelation.Onthecontrary,theVOImetricexpressesabehaviourconcurrenttoGCEwherebyworstperformanceisobtainedforthelowergradegliomasandthenglioblastomascategories,whileitperformsbestovermetastaseswhereDicealsoscoresthehighest.Aliketheaforementionedmetricgroupsexhibitinginnerdiscrepancies,threeoftheﬁveprobabilisticmetricsfollowasimilartrendscoringhighalongsideDice,withanaveragegapof0.1correspondingtoa∼10%Dicescoredifference.Meanwhile,thePBDmetrichasabehaviourofitsownscoringanorderofmagnitudeworseforthemeningiomacategorythanforthethreeothersubtypes.Themetricisnotnormalizedandanextremelypooragreementbetweenthemanualgroundtruthandautomaticsegmentationwouldresultinanextremelylargescore,similartotheGCEmetric,hencereportingthemedianscoreinadditionmightbeofinterest(cf.secondrowinFiguresS1-S4,Sup.Mat.).Table6:Voxel-wiseperformancesummaryforeachtumortypeforinformationtheory-basedandprobabilisticmetrics.Informationtheory-basedProbabilisticTumortypeMIVOICKSAUCVCMCCPBDGlioblastoma0.787±0.1680.011±0.0090.856±0.1690.939±0.0880.978±0.0890.875±0.1220.840±24.02LGG0.668±0.2460.026±0.0300.753±0.2590.889±0.1390.961±0.1190.812±0.1670.573±04.82Meningioma0.691±0.2910.008±0.0130.749±0.3050.887±0.1620.954±0.1490.841±0.1715.358±103.4Metastasis0.829±0.1910.004±0.0060.877±0.1890.942±0.1040.978±0.1000.901±0.1270.152±0.623Finally,thevoxel-wisedistance-basedmetricsarereportedinTable7.Similarcross-typetrendscanalsobenotedwherebythebestHD95of4.97mmisobtainedfortheglioblastomacategoryandtheworstHD95of10mmformeningiomas,heavilycorrelatedtoDiceperformance.OuraverageHD95resultsappearlowerthanpreviouslyreportedresultsintheliterature,howeverastrongstatementcanhardlybemadeasthetumorsfeaturedcanvaryhighlyintermsofvolumeandnumberofsatelliteswhichmightreﬂectgreatlyonmetrics’averagescores.Theothertwospatialdistance-basedmetricsdisplayasimilarbehaviourtoHD95,wherebytumortypescanberankedasfollowsbasedonbesttoworseperformance:glioblastoma,metastasis,lowergradeglioma,andmeningioma.Table7:Voxel-wiseperformancesummaryforeachtumortypeforspatialdistance-basedmetrics.TumortypeHD95MHDASSDGlioblastoma04.97±09.0600.41±03.6901.46±03.22LGG08.37±13.3100.53±03.2702.19±05.06Meningioma10.11±21.8200.72±03.5702.77±07.91Metastasis07.54±20.6100.54±04.5601.73±05.89Regardinginstance-wisemetrics,groupedinTable8,thecloseOASSDaveragevaluesbetweenglioblastomasandmeningiomasrepresentsthemostsurprisingoutcomegiventhe5%differenceinF1-score.Unsurprisingly,thelowergradegliomacategoryachievesthehighestaverageOASSDwith2.6mmtogetherwiththelowestF1-score.Asonemightexpect,theamountofFPPPcorrelatesgreatlywiththeaverageprecisionvaluesobtained.Ultimately,theARImetricgeneratesscoresextremelysimilartovoxel-wiseDiceandcorrelateshighlywiththeF1-scorewherebytheglioblastomaandmetastasiscategoriesobtainalmost0.1morethanforthemeningiomaandlowergradegliomasubtypes.Forcompleteness,thecorrelationbetweenthedifferentmetricscomputedinthisstudyhasbeenassessed,andtheresultsovertheglioblastomacategoryareshowninTable9(cf.othercorrelationmatricesinTablesS2,S4,S6,and13APREPRINT-MAY2,2022Table8:Instance-wiseperformanceforeachtumortype.TumortypeF1-scoreRecallPrecisionFPPPARIOASSDGlioblastoma89.61±04.1185.78±07.9594.19±02.710.078±0.0370.856±0.16901.45±02.82LGG81.58±02.2575.57±02.4088.67±03.160.129±0.0410.751±0.25902.60±06.10Meningioma83.85±03.6080.93±04.3487.77±08.300.151±0.1280.749±0.30501.62±04.09Metastasis88.71±01.3482.79±02.3895.60±01.450.061±0.0200.877±0.1890.672±0.869S8,Sup.Mat.).Somemetricshavebeenexcludedgiveninherentcorrelationfromtheircomputation,suchasFPRandFNRbeingtheoppositeofTNRandTPR.Similarly,metricshavingcomputationinavoxel-wise,patient-wise,orinstance-wisefashionwerenotconsideredinthematrix(i.e.,recall,precision,andF1-score).Overall,theconclusionsidentiﬁedbyanalyzingtherawaverageresultsarefurtherconﬁrmedwherebyamajorityofvoxel-wisemetricscorrelatewithoneanotherandthusdonotbringanyadditionalinformationtoDice.However,relevantinsightcanbeobtainedfromtheRAVDandGCE/VOImetricsgiventheirlowcorrelationtoDiceandtheirhighersensitivitytowardsoutliers,enablingtoquantifytheabilitytogeneralizeofthemodelorpotentiallythequalityofthedataandmanualgroundtruth(cf.thirdrowinFiguresS1-S4,Sup.Mat.).ThecorrelationbetweenHD95andMHDappearsalsoquitelowforspatialdistance-basedmetrics,indicatingapotentialusefulness.Finally,intheinstance-wisecategory,theOASSDisastand-alonemetricofferingtoproperlyassessmodelperformanceoverthedetectionofsatellitetumors.Toconclude,aﬁnalpoolofmetricstoconsiderforbenchmarkingpurposesandcapturingallaspectsofthesegmentationperformancesare:Dice,RAVD,VOI,HD95,MHD,andOASSD.Giventhetask,reportingpatient-wiseandinstance-wiserecall,precision,andF1-scoreisalwaysofinterestbecauseofaninnatecomprehensionoftheirmeaning,easytointerpretforcliniciansorotherend-users.Table9:Metricscorrelationmatrixforglioblastomasegmentation.Thecolorintensityofeachcellrepresentsthestrengthofthecorrelation,wherebluedenotesdirectcorrelationandreddenotesinversecorrelation.OverlapVolumeInformationtheoryProbabilisticSpatialdistanceInstance-wiseDiceTPRTNRPPVIoUGCEVSRAVDMIVOICKSAUCVCMCCPBDHD95MHDASSDARIOASSDDice1.00.70.290.620.98-0.220.94-0.350.99-0.231.00.710.781.0-0.34-0.55-0.43-0.711.0-0.3TPR0.71.0-0.17-0.070.71-0.080.620.10.7-0.080.71.00.510.71-0.26-0.38-0.34-0.470.7-0.2TNR0.29-0.171.00.580.28-0.760.29-0.360.33-0.760.29-0.170.230.29-0.04-0.16-0.04-0.270.29-0.22PPV0.62-0.070.581.00.64-0.240.55-0.490.64-0.250.62-0.070.470.63-0.16-0.38-0.21-0.470.62-0.22IoU0.980.710.280.641.0-0.240.9-0.290.99-0.240.980.710.710.99-0.28-0.55-0.37-0.70.98-0.31GCE-0.22-0.08-0.76-0.24-0.241.0-0.190.13-0.31.0-0.23-0.09-0.14-0.230.020.180.030.29-0.230.28VS0.940.620.290.550.9-0.191.0-0.370.9-0.20.940.620.760.92-0.36-0.48-0.43-0.650.94-0.26RAVD-0.350.1-0.36-0.49-0.290.13-0.371.0-0.310.15-0.350.1-0.39-0.340.180.190.140.28-0.350.15MI0.990.70.330.640.99-0.30.9-0.311.0-0.310.990.70.740.99-0.31-0.56-0.4-0.710.99-0.32VOI-0.23-0.08-0.76-0.25-0.241.0-0.20.15-0.311.0-0.23-0.08-0.15-0.240.030.180.030.3-0.240.28CKS1.00.70.290.620.98-0.230.94-0.350.99-0.231.00.710.781.0-0.34-0.55-0.43-0.711.0-0.3AUC0.711.0-0.17-0.070.71-0.090.620.10.7-0.080.711.00.510.71-0.27-0.38-0.34-0.470.71-0.2VC0.780.510.230.470.71-0.140.76-0.390.74-0.150.780.511.00.78-0.49-0.51-0.58-0.710.78-0.22MCC1.00.710.290.630.99-0.230.92-0.340.99-0.241.00.710.781.0-0.36-0.55-0.44-0.711.0-0.31PBD-0.34-0.26-0.04-0.16-0.280.02-0.360.18-0.310.03-0.34-0.27-0.49-0.361.00.160.970.29-0.340.05HD95-0.55-0.38-0.16-0.38-0.550.18-0.480.19-0.560.18-0.55-0.38-0.51-0.550.161.00.250.89-0.550.14MHD-0.43-0.34-0.04-0.21-0.370.03-0.430.14-0.40.03-0.43-0.34-0.58-0.440.970.251.00.4-0.430.06ASSD-0.71-0.47-0.27-0.47-0.70.29-0.650.28-0.710.3-0.71-0.47-0.71-0.710.290.890.41.0-0.710.2ARI1.00.70.290.620.98-0.230.94-0.350.99-0.241.00.710.781.0-0.34-0.55-0.43-0.711.0-0.3OASSD-0.3-0.2-0.22-0.22-0.310.28-0.260.15-0.320.28-0.3-0.2-0.22-0.310.050.140.060.2-0.31.05.4RepresentativemodelsselectionOnlyonemodelcanbeprovidedinthesoftwaresolutionsforeachtumortype,andthebestmodelselectionwasdoneempiricallyaccordingtothefollowingcriterion:sizeofthevalidationortestset,averageDicescoreandpatient-wiseF1-scoreperformances.Theexhaustivelistofchosenmodelsisthefollowing:themodeltrainedforfold0wasselectedfortheglioblastomas,themodeltrainedforfold3wasselectedforthelowergradegliomas,forthemeningiomasthemodeltrainedforfold2wasselected,andﬁnallyforthemetastasesthemodeltrainedforfold2wasselected.5.5SpeedstudyAcomparisoninprocessingspeedregardingpuretumorsegmentationandcompletegenerationofstandardizedreportsisprovidedinTable10,whenusingtheRaidionicssoftwarewithCPUsupport.Thehigh-endcomputeristhecomputerusedfortrainingthemodels,whereasthemid-endcomputerisaWindowslaptopwithanIntelCoreProcessor(i7@2.20GHz),and16GBofRAM.ForthesmallestMRIvolumesonaverage,17secondsareneededtoperformtumorsegmentationwhereas4.5minutesarerequiredtogeneratethecompletestandardizedreportwiththehigh-endcomputer.Unsurprisingly,thelargertheMRIvolumethemoretimerequiredtoperformthedifferentprocessingoperations(cf.SectionS3,Sup.Mat.).ForthelargestMRIvolumesoverall,59secondsareneededtoperformtumorsegmentationwhereas15minutesarerequiredtogeneratethecompletestandardizedreport.Whenusingthemid-endlaptop,overallruntimeisincreased14APREPRINT-MAY2,2022by1.5timesforthedifferentMRIvolumesizes.Onaverage,9minutesarenecessarytogeneratethestandardizedreportforMRIvolumesofreasonablequality.Table10:Segmentation(Segm.)andstandardizedreporting(SR)executionspeedsforeachtumorsubtype,usingourRaidionicssoftware.High-endcomputer(Desktop)Mid-endcomputer(Laptop)Dimensions(voxels)Segm.(s)SR(m)Segm.(s)SR(m)LGG394×394×8016.69±0.42604.50±0.0928.69±0.57707.32±0.07Meningioma256×256×17017.21±0.42505.48±0.1231.41±0.86209.09±0.32Glioblastoma320×320×22021.99±0.17705.89±0.0333.65±1.42909.06±0.24Metastasis560×560×56159.06±1.45415.35±0.4198.54±2.17124.06±0.936DiscussionInthisstudy,wehaveinvestigatedthesegmentationofarangeofcommonmainbraintumortypesin3DpreoperativeMRscansusingavariantoftheAttentionU-Netarchitecture.Wehaveconductedexperimentstoassesstheperformancesofeachtrainedmodelusingcloseto30metrics,anddevelopedtwosoftwaresolutionsforend-userstofreelybeneﬁtfromoursegmentationmodelsandstandardizedclinicalreports.Themaincontributionsarethehighperformancesofthemodels,on-parwithperformancesreportedintheliteraturefortheglioblastomas,withillustratedrobustnessandabilitytogeneralizethankstothemultipleandwidespreaddatasources.Inaddition,thetwoproposedopen-accessandopen-sourcesoftwaresolutionsincludeourbestmodels,togetherwithaRADSforcomputingtumorcharacteristics.ThisistheﬁrstopenRADSsolutionwhichsupportsallmajorbraintumortypes.Thesoftwareisuser-friendly,requiringonlyafewclicksandnoprogrammingtouse,makingiteasilyaccessibleforclinicians.Theoveralllimitationsarethosealreadyknownfordeeplearningapproacheswherebyahigheramountofpatientsordatasourceswouldimprovetheabilitytogeneralize,boostsegmentationperformances,andincreasetheimmunitytowardraretumorexpressions.Theemployedarchitecturealsostruggleswithsmallertumorsgiventhelargedownsamplingtofeedtheentire3DMRscaninthenetwork,hencetheneedforabetterdesigncombininglocalandglobalfeatureseitherthroughmultiplestepsorensembling.Thearchitectureandtrainingstrategyusedinthisstudywereidenticaltoourpreviouslypublishedworkconsideringthattheintentwasnottodirectlymakeadvancesonthesegmentationtask.Nevertheless,thestabilityandrobustnesstotrainefﬁcientmodelshadbeendocumented,alongsideperformancecomparisontoanotherwell-knownarchitecture(e.g.,nnU-Net[20]),thusnotprecludingitsusetotrainmodelsforotherbraintumortypes.Asidefromevidentoutliersinthedatasets,whereeithertumorswithpartialormissingcontrastuptakeorsuboptimalmanualannotationswereidentiﬁed,themajorpitfallfromusingtheAGU-Netarchitectureliesinitsstruggletosegmentequallysatisfactorilysmalltumorpieceswithavolumebelow2ml.Overall,theglioblastomamodelisexpectedtobethemostrobustandabletogeneralizesincepatientdatafrom15differentsourceswasused.Forothermodelstrainedondatafrommuchfewerhospitals,withanexpectedlimitedvariabilityinMRscanquality,theirrobustnessislikelytobeinferior.Whilelargerdatasetsisoftencorrelatedwithimprovedsegmentationperformance,themetastasismodelisthebestperformingwiththelowestamountofpatientsincluded.Therelativeeasinessofthetaskfromacleardemarcationofthetumorfromsurroundingnormaltissueincontrast-enhancedT1-weightedvolumes,andthepotentiallylowvarianceintumorcharacteristicswithpatientdatacomingfromtwohospitalsonly,canexplaintheresults.Additionally,themetastasismodelhasbeentrainedbytransfer-learningusingasinputthesecondbestperformingglioblastomamodelwherethemostdatawasused,whichmayhavebeenthecompellingfactor.Lower-gradegliomasrepresentthemostdifﬁculttypetomanuallysegmentsincetumorsarediffuseandinﬁltratingwithanaveragevolumeinFLAIRsequencesalothigherthaninT1sequencesfortheothertumortypes,andassuchoverallworseperformanceswereexpected.Thein-depthassessmentofalargerpoolofmetricsallowedustoidentifyredundancyanduniqueness,andprovedthattheDicescoreisoverallquiterobustandindicativeofexpectedperformance.However,thesoleuseofDicescorecannotcoverallaspectsofamodelperformance,andspatialdistance-basedmetrics(e.g.,HD95andMHD)aresuggestedtobeusedinconjunctionasprovidingvaluesuncorrelatedtoDice.Inaddition,somemetricswereidentiﬁedtobemoresensitivetooutliersandareassuchpowerfultoeitherassesstheabilitytogeneralizeofamodelacrossdataacquiredondifferentscannersfrommultiplesources,orquicklyidentifypotentialissuesinalargebodyofdata.Finally,anddependingonthenatureofthepatientsincludedinone’sstudyandamountofsatellitetumors,speciﬁcobject-wisemetricsareimperativetouse(e.g.,OASSD).Onlyacombinationofvariousmetricscomputedeithervoxel-wise,patient-wise,orinstance-wisecangivethefullpictureofamodel’sperformance.Unfortunately,interpretingandcomparingsetsofmetricscanprovechallengingandassuchfurtherinvestigationsregardingtheirmergingintoauniqueinformativeandcoherentscorearefundamental(e.g.,Roza[62]).Furthermore,aninadequacyliesinthenatureofthedifferentmetricswherebysomecanbecomputedacrossallsegmentationsgeneratedbyatrainedmodel,whereasothersareexclusivelyeligibleontruepositivecases,i.e.,whenthemodelhascorrectlysegmentedsome15APREPRINT-MAY2,2022extentofthetumor.Formodelsgeneratingperfectpatient-wiserecall,allmetricswillbeeligibleforeverysegmentation.However,inthisﬁeldofresearchandasoftoday,notrainedmodelcanfulﬁllthisrequirementduetothesubstantiallylargeinter-patientvariability.Ideally,theidentiﬁcationofrelevantmetrics,bringinguniqueinformationforinterpretingtheresults,shouldnotbeconﬁnedtothevalidationstudies.Moremetricsshouldbeconsideredtobeapartofthelossfunctioncomputationduringtrainingofneuralnetworkarchitectures.AttemptshavebeenmadetowardsusingtheHausdorffdistanceaslossfunction,butadirectminimizationischallengingfromanoptimizationviewpoint.Forexample,approximationofHausdorffdistancebasedondistancetransforms,onmorphologicaloperations,orwithcircularandsphericalkernelsshowedpotentialformedicalimagesegmentation[63].Ingeneral,acarefulmixbetweenlosses(e.g.,Dice,cross-entropy,andHD95)ischallengingtoachieveandadaptivestrategiesmightberequiredtoavoidreachingalocalminimumwhereoverallsegmentationperformancemaysuffer[64].Asacurrenttrendinthecommunity,inferencecodeandtrainedsegmentationmodelsareoftenatbestavailableonGitHubrepositories.Asaconsequence,onlyengineers,orpeoplewithsomeextentofknowledgeinmachinelearningandprogramming,canbeneﬁtfromsuchresearchadvances.Besides,theresearchfocusisheavilyangledtowardsgliomas,duetotheBraTSchallengeinﬂuence,wherebysegmentationmodelsareexpectedtoyieldsuperiorperformancethanformeningiomasandmetastases.Bydevelopingandgivingfreeandunrestrictedaccesstoourtwoproposedsoftwaresolutions,wehopetofacilitatemoreresearchonallbraintumortypes.Willingresearchinstituteshavetheopportunitytogenerateprivateannotateddatasetsatafasterpacethanthroughfullymanuallabourbyexploitingourtrainedmodels.HavingmadeallsourcecodeavailableonGitHub,ascustomarilydone,wemadetheefforttofurthermakestand-alonesolutionswitheasy-to-useGUIs.Hopefully,cliniciansandothernon-programmingend-usersshouldfeelmorecomfortablemanipulatingsuchtools,availableacrossthethreemajoroperatingsystemsandnecessitatingonlyacomputerwithaveragehardwarespeciﬁcations.Forthegenerationofstandardizedclinicalreports,thecomputationoftumorcharacteristicsreliesheavilyonthequalityoftheautomaticsegmentation,occasionalmishapsareexpectedasmodelsarenotperfectandcanomitthetumor.Therefore,manualinputswillberequiredsporadicallytocorrectthetumorsegmentation.Overtime,newandbettermodelswillbegeneratedandmadeavailableseamlesslyintothetwosoftwarethroughregularupdates.Inthefuture,anapproachincorporatingasetofmetricsandconvertingthemintooneﬁnalscorewouldbehighlydesirable(e.g.,Roza).Notonlywouldithelptoautomaticallyselectthebestmodelfromak-foldvalidationstudyfromoneuniquescore,butaproperassessmentandrankingacrossmultiplemethodswouldbeenabled.Withallpreoperativebraintumortypesavailableforsegmentationandreportinginoursoftware,akeymissingcomponentistheautomatictumortypeclassiﬁcationtosupplementmanualuserinput.Concurrently,thevarietyandamountoftumorcharacteristicstocomputeshouldbeextended,consideringmoretype-speciﬁcfeaturessimilartotheresectionindexforglioblastomas.Alternatively,bringingasimilarfocusonpost-operativesegmentationofresidualtumorisofgreatinteresttobothassessthequalityofthesurgeryandreﬁnetheestimatedpatientoutcome.Thegenerationofacompletepost-operativestandardizedclinicalreportwouldalsobepermittedwithnewfeaturessuchastheextentofresection.Otherwise,intensifyingthegatheringofpatientdatafrommorewidespreadhospitalcentersandalargerarrayofMRIscannersisalwaysofimportance.TheinclusionofmorethanoneMRsequenceperpatientassegmentationinputhasthepotentialtoboostoverallperformance,butatthesametimemightreducemodels’potencyasnotalwaysroutinelyavailableacrossallcentersworldwide.7ConclusionEfﬁcientandrobustsegmentationmodelshavebeentrainedonpre-operativeMRscansforthefourmainbraintumortypes:glioblastoma,lowergradeglioma,meningioma,andmetastasis.In-depthperformanceassessmentallowedtoidentifythemostrelevantmetricsfromalargepanel,computedeithervoxel-wise,patient-wise,orinstance-wise.Trainedmodelsandstandardizedreportinghavebeenmadepubliclyavailableandpackagedintoastand-alonesoftwareanda3DSlicerplugintoenableeffortlesswidespreaduse.DisclosuresTheauthorsdeclarethattheresearchwasconductedintheabsenceofanycommercialorﬁnancialrelationshipsthatcouldbeconstruedasapotentialconﬂictofinterest.Informedconsentwasobtainedfromallindividualparticipantsincludedinthestudy.AcknowledgmentsDatawereprocessedindigitallabsatHUNTCloud,NorwegianUniversityofScienceandTechnology,Trondheim,Norway.AuthorContributionsFundingacquisition,I.R.,O.S.,P.C.D.W.H.,K.E.E.,andA.S.J.;Datacuration,A.S.J.,K.E.E.,V.K.,I.K.,D.B.,H.A.,F.B.,L.B.,M.S.B.,M.C.N.,J.F.,S.H.-J.,A.J.S.I.,B.K.,A.K.,E.M.,D.M.J.M.,P.A.R.,M.R.,T.S.,W.A.v.d.B.,16APREPRINT-MAY2,2022M.W.,G.W.,O.S.andP.C.D.W.H.;Conceptualization,D.B.,A.P.,I.R.,O.S.andP.C.D.W.H.;Methodology,D.B.;Software,D.B.andA.P.;Validation,D.B.andA.P.;Visualization,D.B.;Supervision,I.R.,O.S.andP.C.D.W.H.;Projectadministration,I.R.,O.S.,andP.C.D.W.H.;Writing—originaldraft,D.B.,A.P.,I.R.,O.S.,A.S.J.,K.E.E.,andP.C.D.W.H.;Writing—reviewandediting,H.A.,F.B.,L.B.,M.S.B.,M.C.N.,J.F.,S.H.-J.,A.J.S.I.,B.K.,A.K.,E.M.,D.M.J.M.,P.A.R.,M.R.,T.S.,W.A.v.d.B.,M.W.,G.W.,M.G.W.andA.H.Z.FundingThisworkwasfundedbytheNorwegianNationalAdvisoryUnitforUltrasoundandImage-GuidedTherapy(usigt.org);South-EasternNorwayRegionalHealthAuthority;Contractgrantnumbers:2016102and2013069;Contractgrantsponsor:ResearchCouncilofNorway;Contractgrantnumber:261984;Contractgrantsponsor:NorwegianCancerSociety;Contractgrantnumbers:6817564and3434180;Contractgrantsponsor:EuropeanResearchCouncilundertheEuropeanUnion’sHorizon2020Program;Contractgrantnumber:758657-ImPRESS;anunrestrictedgrantofStichtingHanarthfonds,“Machinelearningforbetterneurosurgicaldecisionsinpatientswithglioblastoma”;agrantforpublic-privatepartnerships(AmsterdamUMCPPP-grant)sponsoredbytheDutchgovernment(MinistryofEconomicAffairs)throughtheRijksdienstvoorOndernemendNederland(RVO)andTopsectorLifeSciencesandHealth(LSH),“Picturingpredictionsforpatientswithbraintumors”;agrantfromtheInnovativeMedicalDevicesInitiativeprogram,projectnumber10-10400-96-14003;TheNetherlandsOrganisationforScientiﬁcResearch(NWO),2020.027;agrantfromtheDutchCancerSociety,VU2014-7113;theAnitaVeldmanfoundation,CCA2018-2-17.References[1]JuliaDay,DavidCGillespie,AlasdairGRooney,HelenJBulbeck,KarolisZienius,FlorienBoele,andRobinGrant.Neurocognitivedeﬁcitsandneurocognitiverehabilitationinadultbraintumors.Currenttreatmentoptionsinneurology,18(5):1–16,2016.[2]DavidNLouis,AriePerry,PieterWesseling,DanielJBrat,IanACree,DominiqueFigarella-Branger,CynthiaHawkins,HKNg,StefanMPﬁster,GuidoReifenberger,etal.The2021whoclassiﬁcationoftumorsofthecentralnervoussystem:asummary.Neuro-oncology,23(8):1231–1251,2021.[3]LisaMDeAngelis.Braintumors.NewEnglandjournalofmedicine,344(2):114–123,2001.[4]JamesLFisher,JudithASchwartzbaum,MargaretWrensch,andJosephLWiemels.Epidemiologyofbraintumors.Neurologicclinics,25(4):867–890,2007.[5]SarahLapointe,AriePerry,andNicholasAButowski.Primarybraintumoursinadults.TheLancet,392(10145):432–446,2018.[6]PhilippKickingereder,SinaBurth,AntjeWick,MichaelGötz,OliverEidel,Heinz-PeterSchlemmer,KlausHMaier-Hein,WolfgangWick,MartinBendszus,AlexanderRadbruch,etal.Radiomicproﬁlingofglioblastoma:identifyinganimagingpredictorofpatientsurvivalwithimprovedperformanceoverestablishedclinicalandradiologicriskmodels.Radiology,280(3):880–889,2016.[7]RaymondSawaya,MaaroufHammoud,DerekSchoppa,KennethRHess,ShuZWu,Wei-MingShi,andDavidMWiIdrick.Neurosurgicaloutcomesinamodernseriesof400craniotomiesfortreatmentofparenchymaltumors.Neurosurgery,42(5):1044–1055,1998.[8]TiitMathiesen,IntiPeredo,andStefanLönn.Two-yearsurvivaloflow-gradeandhigh-gradegliomapatientsusingdatafromtheswedishcancerregistry.Actaneurochirurgica,153(3):467–471,2011.[9]PascalOZinn,RivkaRColen,EkkehardMKasper,andJan-KarlBurkhardt.Extentofresectionandradiotherapyingbm:A1973to2007surveillance,epidemiologyandendresultsanalysisof21,783patients.Internationaljournalofoncology,42(3):929–934,2013.[10]JeffreyCWeinreb,JelleOBarentsz,PeterLChoyke,FrancoisCornud,MasoomAHaider,KatarzynaJMacura,DanielMargolis,MitchellDSchnall,FainaShtern,ClareMTempany,etal.Pi-radsprostateimaging–reportinganddatasystem:2015,version2.Europeanurology,69(1):16–40,2016.[11]SpencerCDyer,BrianJBartholmai,andChiWanKoo.Implicationsoftheupdatedlungctscreeningreportinganddatasystem(lung-radsversion1.1)forlungcancerscreening.JournalofThoracicDisease,12(11):6966,2020.[12]BenjaminMEllingson,MartinBendszus,JerroldBoxerman,DanielBarboriak,BradleyJErickson,MarionSmits,SarahJNelson,ElizabethGerstner,BrianAlexander,GregoryGoldmacher,etal.Consensusrecommendationsforastandardizedbraintumorimagingprotocolinclinicaltrials.Neuro-oncology,17(9):1188–1198,2015.[13]IvarKommers,DavidBouget,AndréPedersen,RoelantSEijgelaar,HilkoArdon,FrederikBarkhof,LorenzoBello,MitchelSBerger,MarcoContiNibali,JuliaFurtner,etal.Glioblastomasurgeryimaging—reportinganddata17APREPRINT-MAY2,2022system:Standardizedreportingoftumorvolume,location,andresectabilitybasedonautomatedsegmentations.Cancers,13(12):2854,2021.[14]ElisabettaBinaghi,ValentinaPedoia,andSergioBalbi.Collectionandfuzzyestimationoftruthlabelsinglialtumoursegmentationstudies.ComputerMethodsinBiomechanicsandBiomedicalEngineering:Imaging&Visualization,4(3-4):214–228,2016.[15]ErikMagnusBerntsen,AnneLineStensjøen,MarenStaursetLanglo,SolveigQuamSimonsen,PålChristensen,ViggoAndreasMoholdt,andOleSolheim.Volumetricsegmentationofglioblastomaprogressioncomparedtobidimensionalproductsandclinicalradiologicalreports.ActaNeurochirurgica,162(2):379–387,2020.[16]ShervinMinaee,YuriYBoykov,FatihPorikli,AntonioJPlaza,NasserKehtarnavaz,andDemetriTerzopou-los.Imagesegmentationusingdeeplearning:Asurvey.IEEEtransactionsonpatternanalysisandmachineintelligence,2021.[17]BjoernHMenze,AndrasJakab,StefanBauer,JayashreeKalpathy-Cramer,KeyvanFarahani,JustinKirby,YuliyaBurren,NicolePorz,JohannesSlotboom,RolandWiest,etal.Themultimodalbraintumorimagesegmentationbenchmark(brats).IEEEtransactionsonmedicalimaging,34(10):1993–2024,2014.[18]SpyridonBakas,HamedAkbari,AristeidisSotiras,MichelBilello,MartinRozycki,JustinSKirby,JohnBFreymann,KeyvanFarahani,andChristosDavatzikos.Advancingthecancergenomeatlasgliomamricollectionswithexpertsegmentationlabelsandradiomicfeatures.Scientiﬁcdata,4(1):1–13,2017.[19]UjjwalBaid,SatyamGhodasara,SuyashMohan,MichelBilello,EvanCalabrese,ErrolColak,KeyvanFarahani,JayashreeKalpathy-Cramer,FelipeCKitamura,SarthakPati,etal.Thersna-asnr-miccaibrats2021benchmarkonbraintumorsegmentationandradiogenomicclassiﬁcation.arXivpreprintarXiv:2107.02314,2021.[20]FabianIsensee,JensPetersen,AndreKlein,DavidZimmerer,PaulFJaeger,SimonKohl,JakobWasserthal,GregorKoehler,TobiasNorajitra,SebastianWirkert,etal.nnu-net:Self-adaptingframeworkforu-net-basedmedicalimagesegmentation.arXivpreprintarXiv:1809.10486,2018.[21]HuanMinhLuuandSung-HongPark.Extendingnn-unetforbraintumorsegmentation.arXivpreprintarXiv:2112.04653,2021.[22]ArtiTiwari,ShilpaSrivastava,andMilliePant.Braintumorsegmentationandclassiﬁcationfrommagneticresonanceimages:Reviewofselectedmethodsfrom2014to2019.PatternRecognitionLetters,131:244–260,2020.[23]SérgioPereira,AdrianoPinto,VictorAlves,andCarlosASilva.Braintumorsegmentationusingconvolutionalneuralnetworksinmriimages.IEEEtransactionsonmedicalimaging,35(5):1240–1251,2016.[24]EndreGrøvik,DarvinYi,MichaelIv,ElizabethTong,DanielRubin,andGregZaharchuk.Deeplearningenablesautomaticdetectionandsegmentationofbrainmetastasesonmultisequencemri.JournalofMagneticResonanceImaging,51(1):175–182,2020.[25]EndreGrøvik,DarvinYi,MichaelIv,ElizabethTong,LineBrennhaugNilsen,AnnaLatysheva,CathrineSaxhaug,KariDolvenJacobsen,ÅslaugHelland,KyrreEegEmblem,etal.Handlingmissingmrisequencesindeeplearningsegmentationofbrainmetastases:amulticenterstudy.NPJdigitalmedicine,4(1):1–7,2021.[26]KonstantinosKamnitsas,EnzoFerrante,SarahParisot,ChristianLedig,AdityaVNori,AntonioCriminisi,DanielRueckert,andBenGlocker.Deepmedicforbraintumorsegmentation.InInternationalworkshoponBrainlesion:Glioma,multiplesclerosis,strokeandtraumaticbraininjuries,pages138–149.Springer,2016.[27]YanLiu,StrahinjaStojadinovic,BrianHrycushko,ZabiWardak,StevenLau,WeiguoLu,YulongYan,SteveBJiang,XinZhen,RobertTimmerman,etal.Adeepconvolutionalneuralnetwork-basedautomaticdelineationstrategyformultiplebrainmetastasesstereotacticradiosurgery.PloSone,12(10):e0185844,2017.[28]OdelinCharron,AlexLallement,DelphineJarnet,VincentNoblet,Jean-BaptisteClavier,andPhilippeMeyer.Automaticdetectionandsegmentationofbrainmetastasesonmultimodalmrimageswithadeepconvolutionalneuralnetwork.Computersinbiologyandmedicine,95:43–54,2018.[29]EleftheriosNeromyliotis,TheodosisKalamatianos,AthanasiosPaschalis,SpyridonKomaitis,KonstantinosNFountas,EftychiaZKapsalaki,GeorgeStranjalis,andIoannisTsougos.Machinelearninginmeningiomamri:pasttopresent.anarrativereview.JournalofMagneticResonanceImaging,55(1):48–60,2022.[30]KaiRomanLaukamp,FrankThiele,GeorgyShakirin,DavidZopfs,AndreaFaymonville,MarcoTimmer,DavidMaintz,MichaelPerkuhn,andJanBorggrefe.Fullyautomateddetectionandsegmentationofmeningiomasusingdeeplearningonroutinemultiparametricmri.Europeanradiology,29(1):124–132,2019.18APREPRINT-MAY2,2022[31]KaiRomanLaukamp,LenhardPennig,FrankThiele,RobertReimer,LukasGörtz,GeorgyShakirin,DavidZopfs,MarcoTimmer,MichaelPerkuhn,andJanBorggrefe.Automatedmeningiomasegmentationinmultiparametricmri.ClinicalNeuroradiology,pages1–10,2020.[32]DavidBouget,AndréPedersen,SayiedAbdolMohiebHosainey,OleSolheim,andIngeridReinertsen.Menin-giomasegmentationint1-weightedmrileveragingglobalcontextandattentionmechanisms.arXivpreprintarXiv:2101.07715,2021.[33]TheMONAIConsortium.Projectmonai,December2020.[34]AnnikaReinke,MatthiasEisenmann,MinuDTizabi,CaroleHSudre,TimRädsch,MichelaAntonelli,TalArbel,SpyridonBakas,MJorgeCardoso,VeronikaCheplygina,etal.Commonlimitationsofimageprocessingmetrics:Apicturestory.arXivpreprintarXiv:2104.05642,2021.[35]AbdelAzizTahaandAllanHanbury.Metricsforevaluating3dmedicalimagesegmentation:analysis,selection,andtool.BMCmedicalimaging,15(1):29,2015.[36]BrentDWeinberg,AshwaniGore,Hui-KuoGShu,JeffreyJOlson,RichardDuszak,AlfredoDVoloschin,andMichaelJHoch.Management-basedstructuredreportingofposttreatmentgliomaresponsewiththebraintumorreportinganddatasystem.JournaloftheAmericanCollegeofRadiology,15(5):767–771,2018.[37]THuber,GAlber,SBette,TBoeckh-Behrens,JGempt,FRingel,EAlberts,CZimmer,andJSBauer.Reliabilityofsemi-automatedsegmentationsinglioblastoma.Clinicalneuroradiology,27(2):153–161,2017.[38]VladimirVezhnevetsandVadimKonouchine.Growcut:Interactivemulti-labelndimagesegmentationbycellularautomata.Inproc.ofGraphicon,volume1,pages150–156.Citeseer,2005.[39]DavidBouget,AndréPedersen,SayiedAbdolMohiebHosainey,JohannaVanel,OleSolheim,andIngeridRein-ertsen.Fastmeningiomasegmentationint1-weightedmagneticresonanceimagingvolumesusingalightweight3ddeeplearningarchitecture.JournalofMedicalImaging,8(2):024002,2021.[40]DavidBouget,RoelantSEijgelaar,AndréPedersen,IvarKommers,HilkoArdon,FrederikBarkhof,LorenzoBello,MitchelSBerger,MarcoContiNibali,JuliaFurtner,etal.Glioblastomasurgeryimaging–reportinganddatasystem:Validationandperformanceoftheautomatedsegmentationtask.Cancers,13(18):4674,2021.[41]VladimirSFonov,AlanCEvans,RobertCMcKinstry,CRobertAlmli,andDLCollins.Unbiasednonlinearaverageage-appropriatebraintemplatesfrombirthtoadulthood.NeuroImage,(47):S102,2009.[42]AndriyFedorov,ReinhardBeichel,JayashreeKalpathy-Cramer,JulienFinet,Jean-ChristopheFillion-Robin,SoniaPujol,ChristianBauer,DominiqueJennings,FionaFennessy,MilanSonka,etal.3dslicerasanimagecomputingplatformforthequantitativeimagingnetwork.Magneticresonanceimaging,30(9):1323–1341,2012.[43]AlirezaMehrtash,MehranPesteie,JordenHetherington,PeterABehringer,TinaKapur,WilliamMWellsIII,RobertRohling,AndriyFedorov,andPurangAbolmaesumi.Deepinfer:Open-sourcedeeplearningdeploymenttoolkitforimage-guidedtherapy.InMedicalImaging2017:Image-GuidedProcedures,RoboticInterventions,andModeling,volume10135,pages410–416.SPIE,2017.[44]LeeRDice.Measuresoftheamountofecologicassociationbetweenspecies.Ecology,26(3):297–302,1945.[45]PaulJaccard.Thedistributionoftheﬂorainthealpinezone.1.Newphytologist,11(2):37–50,1912.[46]DavidMartin,CharlessFowlkes,DoronTal,andJitendraMalik.Adatabaseofhumansegmentednaturalimagesanditsapplicationtoevaluatingsegmentationalgorithmsandmeasuringecologicalstatistics.InProceedingsEighthIEEEInternationalConferenceonComputerVision.ICCV2001,volume2,pages416–423.IEEE,2001.[47]RubénCárdenes,RodrigodeLuis-Garcia,andMeritxellBach-Cuadra.Amultidimensionalsegmentationevaluationformedicalimagedata.Computermethodsandprogramsinbiomedicine,96(2):108–124,2009.[48]DanielBRussakoff,CarloTomasi,TorstenRohlﬁng,andCalvinRMaurer.Imagesimilarityusingmutualinformationofregions.InEuropeanConferenceonComputerVision,pages596–607.Springer,2004.[49]MarinaMeil˘a.Comparingclusteringsbythevariationofinformation.InLearningtheoryandkernelmachines,pages173–187.Springer,2003.[50]JacobCohen.Acoefﬁcientofagreementfornominalscales.Educationalandpsychologicalmeasurement,20(1):37–46,1960.[51]AndrewPBradley.Theuseoftheareaundertheroccurveintheevaluationofmachinelearningalgorithms.Patternrecognition,30(7):1145–1159,1997.[52]PierreBaldi,SørenBrunak,YvesChauvin,ClausAFAndersen,andHenrikNielsen.Assessingtheaccuracyofpredictionalgorithmsforclassiﬁcation:anoverview.Bioinformatics,16(5):412–424,2000.19APREPRINT-MAY2,2022[53]GuidoGerig,MatthieuJomier,andMirandaChakos.Valmet:Anewvalidationtoolforassessingandimproving3dobjectsegmentation.InInternationalconferenceonmedicalimagecomputingandcomputer-assistedintervention,pages516–523.Springer,2001.[54]DanielPHuttenlocher,GregoryA.Klanderman,andWilliamJRucklidge.Comparingimagesusingthehausdorffdistance.IEEETransactionsonpatternanalysisandmachineintelligence,15(9):850–863,1993.[55]GoeffreyJMcLachlan.Mahalanobisdistance.Resonance,4(6):20–26,1999.[56]NancyChinchorandBethMSundheim.Muc-5evaluationmetrics.InFifthMessageUnderstandingConference(MUC-5):ProceedingsofaConferenceHeldinBaltimore,Maryland,August25-27,1993,1993.[57]LawrenceHubertandPhippsArabie.Comparingpartitions.Journalofclassiﬁcation,2(1):193–218,1985.[58]PeterRKilleen.Analternativetonull-hypothesissigniﬁcancetests.Psychologicalscience,16(5):345–353,2005.[59]AlexanderB.Jung,KentaroWada,JonCrall,SatoshiTanaka,JakeGraving,ChristophReinders,SarthakYadav,JoyBanerjee,GáborVecsei,AdamKraft,ZhengRui,JirkaBorovec,ChristianVallentin,SemenZhydenko,KilianPfeiffer,BenCook,IsmaelFernández,François-MichelDeRainville,Chi-HungWeng,AbnerAyala-Acevedo,RaphaelMeudec,MatiasLaporte,etal.imgaug.https://github.com/aleju/imgaug,2020.Online;accessed01-Feb-2020.[60]F.Pedregosa,G.Varoquaux,A.Gramfort,V.Michel,B.Thirion,O.Grisel,M.Blondel,P.Prettenhofer,R.Weiss,V.Dubourg,J.Vanderplas,A.Passos,D.Cournapeau,M.Brucher,M.Perrot,andE.Duchesnay.Scikit-learn:MachinelearninginPython.JournalofMachineLearningResearch,12:2825–2830,2011.[61]OskarMaier,AlexRothberg,PradeepReddyRaamana,RémiBèges,FabianIsensee,MichaelAhern,mamrehn,VincentXWD,andJayJoshi.loli/medpy:Medpy0.4.0,February2019.[62]MesutMelekandNeginMelek.Roza:anewandcomprehensivemetricforevaluatingclassiﬁcationsystems.ComputerMethodsinBiomechanicsandBiomedicalEngineering,pages1–13,2021.[63]DavoodKarimiandSeptimiuESalcudean.Reducingthehausdorffdistanceinmedicalimagesegmentationwithconvolutionalneuralnetworks.IEEETransactionsonmedicalimaging,39(2):499–513,2019.[64]AAliHeydari,CraigAThompson,andAsifMehmood.Softadapt:Techniquesforadaptivelossweightingofneuralnetworkswithmulti-partlossfunctions.arXivpreprintarXiv:1912.12355,2019.20APREPRINT-MAY2,20221Supplementarymaterial1.1MetricsGivenagroundtruthsegmentation(denotedasg)andanautomaticsegmentationcomingfromatrainedmodel(denotedasd),thefollowingfourvoxel-wisecardinalitiescanbedeﬁned,givenatotalamountofvoxelsXinagivenMRIvolume(ofdimensionsH×W×D).TP=|X|Xx=1(g(x)==1)&(d(x)==1)(1)TN=|X|Xx=1(g(x)==0)&(d(x)==0)(2)FP=|X|Xx=1(g(x)==0)&(d(x)==1)(3)FN=|X|Xx=1(g(x)==1)&(d(x)==0)(4)Usingthosecardinalitiesasbaseelements,theothervoxel-wisemetricscanbecomputedaccordingtothefollowingequations.TruePositiveRate(TPR):TPR=TPTP+FN(5)TrueNegativeRate(TNR):TNR=TNTN+FP(6)FalsePositiveRate(FPR):FPR=FPFP+TN(7)FalseNegativeRate(FNR):FNR=FNFN+TP(8)PositivePredictiveValue(PPV):PPV=TPTP+FP(9)Dice:Dice=2·TP2·TP+FP+FN(10)Jaccard:J=TPTP+FP+FN(11)IntersectionoverUnion(IoU):IoU=P|X|x=1g(x)∩d(x)P|X|x=1(g(x)∪d(x))(12)AreaUndertheCurve(AUC):AUC=1−FPR+FNR2(13)GlobalConsistencyError(GCE):GCE=1Xmin(cid:26)FN(FN+2TP)TP+FN+FP(FP+2TN)TN+FP,FP(FP+2TP)TP+FP+FN(FN+2TN)TN+FN(cid:27)(14)1arXiv:2204.14199v1  [eess.IV]  29 Apr 2022APREPRINT-MAY2,2022MathewsCorrelationCoefﬁcient(MCC):MCC=(TP·TN)−(FP·FN)p(TP+FP)·(TP+FN)·(TN+FP)·(TN+FN)(15)AdjustedRandIndex(ARI):a=0.5·((TP·(TP−1))+(FP·(FP−1))+(TN·(TN−1))+(FN·(FN−1)))b=0.5·(((TP+FN)2+(TN+FP)2)−(TP2+TN2+FP2+FN2))c=0.5·(((TP+FP)2+(TN+FN)2)−(TP2+TN2+FP2+FN2))d=(H·W·D)·(H·W·D−1)2·(a+b+c)ARI=2·(a·b−b·c)c2+b2+2·a·b+(a+d)·(c+b)(16)VariationOfInformation(VOI):h1=− FN+TPX·log2(cid:18)FN+TPX(cid:19)+1−(FN+TP)X·log2(cid:18)1−(FN+TP)X(cid:19)!h2=− FP+TPX·log2(cid:18)FP+TPX(cid:19)+1−(FP+TP)X·log2(cid:18)1−(FP+TP)X(cid:19)!p00=1ifTN==0elseTNXp01=1ifFN==0elseFNXp10=1ifFP==0elseFPXp11=1ifTP==0elseTPXh12=− log2(p00)·TNX+log2(p01)·FNX+log2(p10)·FPX+log2(p11)·TPX!MI=h1+h2−h12VOI=h1+h2−(2·MI)(17)ProbabilisticDistance(PBD):PBD=P|X|x=1|g(x)−d(x)|2·P|X|x=1(g(x)·d(x))(18)2APREPRINT-MAY2,20221.2MetricsanalysisForeachofthefourbraintumorsubtypes,thefollowingelementsareconsistentlyreported:thefold-wiseoverallperformances,themetricscorrelationmatrix,andaﬁgureshowingoutliercasesaccordingtodifferentmetrics.1.3GlioblastomasegmentationOverallsegmentationperformancesfortheglioblastomatumortypearereportedfold-wiseinTable1.TheaverageDicescoreisthelowestonfold9whichisunsurprisinggiventhesizeofthetestset,thelargestofall.Otherwise,theaverageDicescoreisrelativelystableacrossallfoldsbetween85%and88%.ThecorrelationmatrixbetweensomeoftheconsideredvalidationmetricsisshowninTable2.VisualsegmentationresultsareillustratedinFig.1wheretheGCE,PBD,RAVD,andHD95metricsscoredordersofmagnitudeabovetheiraverage,indicatingclearoutliersnotidentiﬁablebytheDicemetriconly.Intheﬁrstrow,thetwoleftmostexamplesexhibitundersegmentationandoversegmentationofthetumor.Thetworightmostexamplesareindicatingsubparmanualgroundtruthandwherepredictionsfromthemodelappearsslightlymoreaccurate.Inthesecondrow,thetwoleftmosttumorswherealmostcompletelymissedbythemodel,whileonlythecontrast-enhancingpartofthetumorwassegmentedinthetworightmostcases.Inthethirdrow,thethirdpatientfeaturesbothaglioblastomaandameningioma.Unfortunately,thetrainedmodelisnotmeanttoperformtumortypeclassiﬁcationandbothtumortypesarevisuallyquitesimilar.Asaresult,bothtumorshavebeensegmentedhencethelowmetricscoresbutfora94.69%Diceoverthesoleglioblastoma.Intheﬁrstandlastpatient,thecystdoesnotseemtohavebeenincludedinthegroundtruth,focusingonlyonthecontrast-enhancedparts.Finallyinthefourthrow,alloutliercasesfeaturedatumorwithaverysmallvolumewherebytheHD95scoredlowwhileallDicescoresreachedabove80%.Table1:Fold-wiseoverallsegmentationperformancefortheglioblastomatumortype.Pixel-wisePatient-wiseObject-wiseFold#SamplesDiceDice-TPF1-scoreRecallPrecisionF1-scoreRecallPrecision015387.97±12.2888.55±10.0399.0199.3598.6893.2789.2797.64110388.54±13.9590.29±06.3598.1998.0698.3292.9790.5895.4927586.44±16.0586.44±16.0598.75100.0097.5294.4492.6696.3037286.17±15.7087.39±12.0097.1798.6195.7790.5989.8091.40429387.03±15.2189.16±06.8796.5497.6195.5090.2889.3091.2858388.22±10.7988.22±10.7998.57100.0097.1989.8885.5094.7463884.73±17.9184.73±17.9199.34100.0098.6880.3468.0698.0477483.49±19.4287.01±09.3696.9995.8998.1296.3996.3996.3984986.84±15.8988.65±09.8798.4697.9698.9683.6772.7398.48945782.82±21.8585.25±16.8896.1097.1695.0786.8782.4491.821024984.70±20.4287.88±12.3897.0896.3997.7988.3681.5796.371113486.17±15.4587.47±11.3298.8798.5099.2486.3076.6198.81128686.80±12.6687.82±08.5197.4498.8496.0892.0590.9193.221317185.12±11.1985.62±09.1197.1799.4295.0292.6894.6790.76149788.77±10.3888.77±10.3899.13100.0098.2888.1580.8696.88Table2:Metricscorrelationmatrixfortheglioblastomasegmentation.Thecolorintensityofeachcellrepresentsthestrengthofthecorrelation,wherebluedenotesdirectcorrelationandreddenotesinversecorrelation.OverlapVolumeInformationtheoryProbabilisticSpatialdistanceInstance-wiseDiceTPRTNRPPVIOUGCEVSRAVDMIVOICKSAUCVCMCCPBDHD95MHDASSDARIOASSDDice1.00.70.290.620.98-0.220.94-0.350.99-0.231.00.710.781.0-0.34-0.55-0.43-0.711.0-0.3TPR0.71.0-0.17-0.070.71-0.080.620.10.7-0.080.71.00.510.71-0.26-0.38-0.34-0.470.7-0.2TNR0.29-0.171.00.580.28-0.760.29-0.360.33-0.760.29-0.170.230.29-0.04-0.16-0.04-0.270.29-0.22PPV0.62-0.070.581.00.64-0.240.55-0.490.64-0.250.62-0.070.470.63-0.16-0.38-0.21-0.470.62-0.22IOU0.980.710.280.641.0-0.240.9-0.290.99-0.240.980.710.710.99-0.28-0.55-0.37-0.70.98-0.31GCE-0.22-0.08-0.76-0.24-0.241.0-0.190.13-0.31.0-0.23-0.09-0.14-0.230.020.180.030.29-0.230.28VS0.940.620.290.550.9-0.191.0-0.370.9-0.20.940.620.760.92-0.36-0.48-0.43-0.650.94-0.26RAVD-0.350.1-0.36-0.49-0.290.13-0.371.0-0.310.15-0.350.1-0.39-0.340.180.190.140.28-0.350.15MI0.990.70.330.640.99-0.30.9-0.311.0-0.310.990.70.740.99-0.31-0.56-0.4-0.710.99-0.32VOI-0.23-0.08-0.76-0.25-0.241.0-0.20.15-0.311.0-0.23-0.08-0.15-0.240.030.180.030.3-0.240.28CKS1.00.70.290.620.98-0.230.94-0.350.99-0.231.00.710.781.0-0.34-0.55-0.43-0.711.0-0.3AUC0.711.0-0.17-0.070.71-0.090.620.10.7-0.080.711.00.510.71-0.27-0.38-0.34-0.470.71-0.2VC0.780.510.230.470.71-0.140.76-0.390.74-0.150.780.511.00.78-0.49-0.51-0.58-0.710.78-0.22MCC1.00.710.290.630.99-0.230.92-0.340.99-0.241.00.710.781.0-0.36-0.55-0.44-0.711.0-0.31PBD-0.34-0.26-0.04-0.16-0.280.02-0.360.18-0.310.03-0.34-0.27-0.49-0.361.00.160.970.29-0.340.05HD95-0.55-0.38-0.16-0.38-0.550.18-0.480.19-0.560.18-0.55-0.38-0.51-0.550.161.00.250.89-0.550.14MHD-0.43-0.34-0.04-0.21-0.370.03-0.430.14-0.40.03-0.43-0.34-0.58-0.440.970.251.00.4-0.430.06ASSD-0.71-0.47-0.27-0.47-0.70.29-0.650.28-0.710.3-0.71-0.47-0.71-0.710.290.890.41.0-0.710.2ARI1.00.70.290.620.98-0.230.94-0.350.99-0.241.00.710.781.0-0.34-0.55-0.43-0.711.0-0.3OASSD-0.3-0.2-0.22-0.22-0.310.28-0.260.15-0.320.28-0.3-0.2-0.22-0.310.050.140.060.2-0.31.03APREPRINT-MAY2,2022Figure1:Examplesofglioblastomaoutlierswherethegroundtruthisshowninredandtheautomaticsegmentationinblue.Eachpatientisseparatedbyadottedwhiteline,andeachrowfocusesonadifferentmetric,fromtoptobottom:GCE,PBD,RAVD,andHD95.Foreachpatient,bothmetricofinterestandDicescoresareprovidedinlightred.4APREPRINT-MAY2,20221.4LowergradegliomasegmentationOverallsegmentationperformancesforthelowergradegliomatumortypearereportedfold-wiseinTable3.TheaverageDicescoreisquitestableacrossthedifferentfolds,at75%,giventhealmostidenticalnumberofsamplestheyhold.Thesametrendcanbenoticedforthepatient-wiseandobject-wisemetricsacrosstheboard.ThecorrelationmatrixbetweensomeoftheconsideredvalidationmetricsisshowninTable4.VisualsegmentationresultsareillustratedinFig.2wheretheGCE,PBD,RAVD,andHD95metricsscoredordersofmagnitudeabovetheiraverage,indicatingclearoutliersnotidentiﬁablebytheDicemetriconly.Intheﬁrstrow,allexamplesexhibitextremelylargeanddiffusetumorswherebythemanualgroundtruthisfarfromsmoothandoftenparcelled.WhileDicescoresareoverallabove60%,onecannoticethatonlythebrighterregionsweresegmentedbythemodel.Inthesecondrow,tumorswithasmallvolumewerenotsegmentedwhileabrightnon-tumorregionhasbeensegmentedinthethirdcase.Inthelastrow,smallregionsfarfromthemaintumorlocationwereincorrectlysegmented,leadingtohighHD95valuesforreasonabletogoodDicescores.Table3:Fold-wiseoverallperformanceforthelowergradegliomasegmentation.Pixel-wisePatient-wiseObject-wiseFold#SamplesDiceDice-TPF1-scoreRecallPrecisionF1-scoreRecallPrecision013274.97±28.5683.87±12.9091.0989.3992.8578.2372.7884.56113277.46±22.8380.50±17.2194.8696.2193.5580.5976.4785.19213274.98±25.2079.18±18.4094.6894.7094.6783.6877.7890.54313076.54±22.7180.24±15.6195.4495.3895.4980.9472.6391.39413273.01±29.7782.36±15.1691.9888.6495.5884.4778.1891.85Table4:Metricscorrelationmatrixforthelowergradegliomasegmentation.Thecolorintensityofeachcellrepresentsthestrengthofthecorrelation,wherebluedenotesdirectcorrelationandreddenotesinversecorrelation.OverlapVolumeInformationtheoryProbabilisticSpatialdistanceInstance-wiseDiceTPRTNRPPVIOUGCEVSRAVDMIVOICKSAUCVCMCCPBDHD95MHDASSDARIOASSDDice1.00.830.150.480.98-0.20.91-0.110.98-0.21.00.830.811.0-0.45-0.51-0.66-0.671.0-0.34TPR0.831.0-0.15-0.020.8-0.160.740.280.8-0.150.831.00.670.82-0.4-0.37-0.56-0.510.83-0.29TNR0.15-0.151.00.490.19-0.660.12-0.340.24-0.680.16-0.140.010.160.03-0.14-0.0-0.150.16-0.21PPV0.48-0.020.491.00.54-0.170.32-0.650.54-0.190.48-0.020.360.51-0.01-0.41-0.19-0.450.48-0.23IOU0.980.80.190.541.0-0.240.87-0.110.99-0.240.980.80.740.98-0.37-0.53-0.59-0.660.98-0.36GCE-0.2-0.16-0.66-0.17-0.241.0-0.150.02-0.30.99-0.21-0.16-0.04-0.21-0.020.180.010.24-0.220.32VS0.910.740.120.320.87-0.151.0-0.10.86-0.160.910.740.750.89-0.49-0.38-0.63-0.580.91-0.25RAVD-0.110.28-0.34-0.65-0.110.02-0.11.0-0.120.04-0.110.28-0.1-0.120.00.110.020.12-0.110.02MI0.980.80.240.540.99-0.30.86-0.121.0-0.310.990.810.760.99-0.4-0.54-0.61-0.680.99-0.38VOI-0.2-0.15-0.68-0.19-0.240.99-0.160.04-0.311.0-0.21-0.16-0.04-0.21-0.020.190.010.25-0.220.33CKS1.00.830.160.480.98-0.210.91-0.110.99-0.211.00.830.811.0-0.45-0.51-0.66-0.671.0-0.35AUC0.831.0-0.14-0.020.8-0.160.740.280.81-0.160.831.00.670.83-0.4-0.37-0.56-0.510.83-0.29VC0.810.670.010.360.74-0.040.75-0.10.76-0.040.810.671.00.81-0.51-0.52-0.73-0.720.81-0.24MCC1.00.820.160.510.98-0.210.89-0.120.99-0.211.00.830.811.0-0.46-0.52-0.67-0.681.0-0.36PBD-0.45-0.40.03-0.01-0.37-0.02-0.490.0-0.4-0.02-0.45-0.4-0.51-0.461.00.160.870.26-0.450.1HD95-0.51-0.37-0.14-0.41-0.530.18-0.380.11-0.540.19-0.51-0.37-0.52-0.520.161.00.370.84-0.510.16MHD-0.66-0.56-0.0-0.19-0.590.01-0.630.02-0.610.01-0.66-0.56-0.73-0.670.870.371.00.45-0.660.16ASSD-0.67-0.51-0.15-0.45-0.660.24-0.580.12-0.680.25-0.67-0.51-0.72-0.680.260.840.451.0-0.670.23ARI1.00.830.160.480.98-0.220.91-0.110.99-0.221.00.830.811.0-0.45-0.51-0.66-0.671.0-0.35OASSD-0.34-0.29-0.21-0.23-0.360.32-0.250.02-0.380.33-0.35-0.29-0.24-0.360.10.160.160.23-0.351.05APREPRINT-MAY2,2022Figure2:Examplesoflowergradegliomaoutlierswherethegroundtruthisshowninredandtheautomaticsegmentationinblue.Eachpatientisseparatedbyadottedwhiteline,andeachrowfocusesonadifferentmetric,fromtoptobottom:GCE,PBD,RAVD,andHD95.Foreachpatient,bothmetricofinterestandDicescoresareprovidedinlightred.6APREPRINT-MAY2,20221.5MeningiomasegmentationOverallsegmentationperformancesforthemeningiomatumortypearereportedfold-wiseinTable5.TheaverageDicescoreisquitestableacrossthedifferentfolds,at75%,giventhealmostidenticalnumberofsamplestheyhold.Thesametrendcanbenoticedforthepatient-wiseandobject-wisemetricsacrosstheboard.ThecorrelationmatrixbetweensomeoftheconsideredvalidationmetricsisshowninTable6.VisualsegmentationresultsareillustratedinFig.3wheretheGCE,PBD,RAVD,andHD95metricsscoredordersofmagnitudeabovetheiraverage,indicatingclearoutliersnotidentiﬁablebytheDicemetriconly.Coronalslicesareprovidedincaseofalargeslicethickness.Table5:Fold-wiseoverallperformanceforthemeningiomasegmentation.Pixel-wisePatient-wiseObject-wiseFold#SamplesDiceDice-TPF1-scoreRecallPrecisionF1-scoreRecallPrecision014477.30±28.1884.32±16.5587.8891.6784.3977.6083.3372.60114474.93±31.6185.63±15.0291.8387.5096.6083.0875.0093.10214474.94±29.9483.65±16.5091.2389.5892.9487.5887.8287.34314374.76±32.5387.62±10.6691.2085.3197.9787.2079.2596.92414473.07±30.4682.85±15.5791.1988.1994.4083.8279.2388.96Table6:Metricscorrelationmatrixforthemeningiomasegmentation.Thecolorintensityofeachcellrepresentsthestrengthofthecorrelation,wherebluedenotesdirectcorrelationandreddenotesinversecorrelation.OverlapVolumeInformationtheoryProbabilisticSpatialdistanceInstance-wiseDiceTPRTNRPPVIOUGCEVSRAVDMIVOICKSAUCVCMCCPBDHD95MHDASSDARIOASSDDice1.00.850.110.40.98-0.340.94-0.040.99-0.351.00.850.821.0-0.29-0.43-0.68-0.561.0-0.28TPR0.851.0-0.13-0.070.84-0.340.770.40.85-0.340.851.00.620.85-0.26-0.26-0.54-0.330.85-0.29TNR0.11-0.131.00.410.11-0.490.12-0.420.15-0.520.12-0.130.180.110.03-0.18-0.06-0.240.12-0.24PPV0.4-0.070.411.00.46-0.060.28-0.70.44-0.070.4-0.070.370.410.06-0.44-0.17-0.530.4-0.03IOU0.980.840.110.461.0-0.330.89-0.050.99-0.340.980.840.760.98-0.23-0.47-0.61-0.580.98-0.27GCE-0.34-0.34-0.49-0.06-0.331.0-0.33-0.06-0.381.0-0.34-0.34-0.17-0.330.060.20.180.27-0.340.47VS0.940.770.120.280.89-0.331.0-0.060.9-0.340.940.770.780.92-0.31-0.37-0.68-0.510.94-0.25RAVD-0.040.4-0.42-0.7-0.05-0.06-0.061.0-0.04-0.04-0.040.4-0.2-0.03-0.110.220.060.34-0.04-0.09MI0.990.850.150.440.99-0.380.9-0.041.0-0.390.990.850.780.99-0.26-0.46-0.64-0.580.99-0.3VOI-0.35-0.34-0.52-0.07-0.341.0-0.34-0.04-0.391.0-0.35-0.35-0.2-0.340.080.210.210.29-0.350.47CKS1.00.850.120.40.98-0.340.94-0.040.99-0.351.00.850.811.0-0.29-0.43-0.68-0.561.0-0.28AUC0.851.0-0.13-0.070.84-0.340.770.40.85-0.350.851.00.620.85-0.26-0.26-0.54-0.330.85-0.29VC0.820.620.180.370.76-0.170.78-0.20.78-0.20.810.621.00.81-0.41-0.43-0.77-0.620.81-0.15MCC1.00.850.110.410.98-0.330.92-0.030.99-0.341.00.850.811.0-0.32-0.44-0.7-0.561.0-0.28PBD-0.29-0.260.030.06-0.230.06-0.31-0.11-0.260.08-0.29-0.26-0.41-0.321.00.070.840.13-0.290.14HD95-0.43-0.26-0.18-0.44-0.470.2-0.370.22-0.460.21-0.43-0.26-0.43-0.440.071.00.310.9-0.430.12MHD-0.68-0.54-0.06-0.17-0.610.18-0.680.06-0.640.21-0.68-0.54-0.77-0.70.840.311.00.45-0.680.21ASSD-0.56-0.33-0.24-0.53-0.580.27-0.510.34-0.580.29-0.56-0.33-0.62-0.560.130.90.451.0-0.570.14ARI1.00.850.120.40.98-0.340.94-0.040.99-0.351.00.850.811.0-0.29-0.43-0.68-0.571.0-0.28OASSD-0.28-0.29-0.24-0.03-0.270.47-0.25-0.09-0.30.47-0.28-0.29-0.15-0.280.140.120.210.14-0.281.07APREPRINT-MAY2,2022Figure3:Examplesofmeningiomaoutlierswherethegroundtruthisshowninredandtheautomaticsegmentationinblue.Eachpatientisseparatedbyadottedwhiteline,andeachrowfocusesonadifferentmetric,fromtoptobottom:GCE,PBD,RAVD,andHD95.Foreachpatient,bothmetricofinterestandDicescoresareprovidedinlightred.8APREPRINT-MAY2,20221.6MetastasessegmentationOverallsegmentationperformancesforthemeningiomatumortypearereportedfold-wiseinTable7.TheaverageDicescoreisquitestableacrossthedifferentfolds,at87%,giventhealmostidenticalnumberofsamplestheyhold.Thesametrendcanbenoticedforthepatient-wiseandobject-wisemetricsacrosstheboard.ThecorrelationmatrixbetweensomeoftheconsideredvalidationmetricsisshowninTable8.VisualsegmentationresultsareillustratedinFig.4wheretheGCE,PBD,RAVD,andHD95metricsscoredordersofmagnitudeabovetheiraverage,indicatingclearoutliersnotidentiﬁablebytheDicemetriconly.Overall,themetastasismodelhassubparprecisionbecauseofthesmallestamountoftrainingdata,sufferingabitfromtransferlearningfromtheHGGmodel,whichcanbeaddressedwithmoretrainingdata.Ascanbeseeninthesecondrow,themodelsegmentedacavityintheleftmostexample.Alargetumorportionhasbeenmissedatthetopoftheheadinthesecondcolumn,maybeasaresultinglimitationfromperformingskullstripping.Table7:Fold-wiseoverallperformanceforthemetastasesegmentation.Pixel-wisePatient-wiseObject-wiseFold#SamplesDiceDice-TPF1-scoreRecallPrecisionF1-scoreRecallPrecision07987.51±19.9890.96±10.0596.7496.2097.2887.8782.7393.6818089.03±16.8291.31±09.0598.0597.5098.6189.0882.8196.3628089.63±15.1689.63±15.1698.73100.0097.5091.1686.7396.0837584.13±22.2686.43±17.6096.8797.3396.4187.9482.4894.1748088.15±19.8891.58±09.8197.2596.2598.2787.4679.2297.60Table8:Metricscorrelationmatrixforthemetastasissegmentation.Thecolorintensityofeachcellrepresentsthestrengthofthecorrelation,wherebluedenotesdirectcorrelationandreddenotesinversecorrelation.OverlapVolumeInformationtheoryProbabilisticSpatialdistanceInstance-wiseDiceTPRTNRPPVIOUGCEVSRAVDMIVOICKSAUCVCMCCPBDHD95MHDASSDARIOASSDDice1.00.890.120.410.99-0.270.96-0.10.99-0.31.00.890.731.0-0.82-0.44-0.74-0.571.0-0.73TPR0.891.0-0.09-0.010.88-0.160.840.260.87-0.180.891.00.570.88-0.65-0.43-0.51-0.480.89-0.61TNR0.12-0.091.00.480.15-0.880.09-0.20.18-0.850.12-0.090.120.13-0.04-0.08-0.12-0.160.12-0.25PPV0.41-0.010.481.00.45-0.360.32-0.660.46-0.350.41-0.010.410.44-0.37-0.2-0.54-0.350.41-0.35IOU0.990.880.150.451.0-0.30.92-0.061.0-0.320.990.880.680.99-0.73-0.46-0.69-0.570.99-0.73GCE-0.27-0.16-0.88-0.36-0.31.0-0.230.05-0.351.0-0.28-0.16-0.21-0.290.140.170.190.29-0.280.44VS0.960.840.090.320.92-0.231.0-0.110.92-0.250.960.840.710.94-0.83-0.39-0.72-0.530.96-0.72RAVD-0.10.26-0.2-0.66-0.060.05-0.111.0-0.090.05-0.10.26-0.44-0.110.350.030.630.21-0.1-0.08MI0.990.870.180.461.0-0.350.92-0.091.0-0.370.990.880.71.0-0.77-0.45-0.72-0.580.99-0.74VOI-0.3-0.18-0.85-0.35-0.321.0-0.250.05-0.371.0-0.3-0.18-0.23-0.310.170.170.220.31-0.30.47CKS1.00.890.120.410.99-0.280.96-0.10.99-0.31.00.890.731.0-0.82-0.44-0.74-0.571.0-0.73AUC0.891.0-0.09-0.010.88-0.160.840.260.88-0.180.891.00.570.88-0.65-0.43-0.51-0.480.89-0.61VC0.730.570.120.410.68-0.210.71-0.440.7-0.230.730.571.00.73-0.73-0.47-0.88-0.790.73-0.33MCC1.00.880.130.440.99-0.290.94-0.111.0-0.311.00.880.731.0-0.81-0.45-0.74-0.581.0-0.72PBD-0.82-0.65-0.04-0.37-0.730.14-0.830.35-0.770.17-0.82-0.65-0.73-0.811.00.30.810.48-0.820.55HD95-0.44-0.43-0.08-0.2-0.460.17-0.390.03-0.450.17-0.44-0.43-0.47-0.450.31.00.430.79-0.440.15MHD-0.74-0.51-0.12-0.54-0.690.19-0.720.63-0.720.22-0.74-0.51-0.88-0.740.810.431.00.68-0.740.39ASSD-0.57-0.48-0.16-0.35-0.570.29-0.530.21-0.580.31-0.57-0.48-0.79-0.580.480.790.681.0-0.570.22ARI1.00.890.120.410.99-0.280.96-0.10.99-0.31.00.890.731.0-0.82-0.44-0.74-0.571.0-0.73OASSD-0.73-0.61-0.25-0.35-0.730.44-0.72-0.08-0.740.47-0.73-0.61-0.33-0.720.550.150.390.22-0.731.09APREPRINT-MAY2,2022Figure4:Examplesofmetastasisoutlierswherethegroundtruthisshowninredandtheautomaticsegmentationinblue.Eachpatientisseparatedbyadottedwhiteline,andeachrowfocusesonadifferentmetric,fromtoptobottom:GCE,PBD,RAVD,andHD95.Foreachpatient,bothmetricofinterestandDicescoresareprovidedinlightred.10APREPRINT-MAY2,20221.7RuntimeUsingarepresentativeMRIvolumeofeachtumortypeconsidered,thefollowingfourtablesindicateruntimeforthedifferentstepsperformedduringtheprocesstogeneratethestandardizedclinicalreports.Resultsarereportedwhenusingthehigh-endcomputer,eitherusingthestand-alonesoftwaresolutionorthe3DSlicerplugin.Themostnoticeabledifferencecomesfromthepenultimatestep(i.e.,Applyreg.)goingfrom183secondswiththelowergradegliomavolumeto792secondswiththemetastasisvolume.ThesizeoftheMRIvolumehasahugeimpactontheruntimenecessarytoapplytheinverseregistrationtransformonallcorticalandsubcorticalstructuresatlases,inordertoexpresstheminthepatientspace.Forthemetastasistumortype,theotherstepsperformingvolume-wiseoperations(e.g.,tumorsegmentationorregistration)alsohavealongerruntimegiventhedimensionsoftheMRIvolume,whencomparedtoatypicalglioblastomaMRscan.Table9:Runtimedistributionperstepinthestandardizedreportpipeline,computedandaveragedusinganhigh-endcomputerfortheglioblastomatumortype,eachexpressedinseconds.Brainsegm.Tumorsegm.Reg.preprocRegistrationApplyreg.Featurescomp.Raidionics25.72±0.12321.99±0.1771.394±0.01637.40±1.41154.56±0.91112.55±1.25Raidionics-Slicer23.04±00.6420.63±00.071.539±0.10995.18±0.88240.13±0.20120.63±4.05Table10:Runtimedistributionperstepinthestandardizedreportpipeline,computedandaveragedusinganhigh-endcomputerforthelowergradegliomatumortype,eachexpressedinseconds.Brainsegm.Tumorsegm.Reg.preprocRegistrationApplyreg.Featurescomp.Raidionics18.29±0.40216.69±0.4270.778±0.01332.10±1.32112.12±3.3490.28±1.03Raidionics-Slicer16.58±0.20116.24±0.2860.858±0.03274.76±1.97183.41±0.8889.91±1.92Table11:Runtimedistributionperstepinthestandardizedreportpipeline,computedandaveragedusinganhigh-endcomputerforthemeningiomatumortype,eachexpressedinseconds.Brainsegm.Tumorsegm.Reg.preprocRegistrationApplyreg.Featurescomp.Raidionics19.08±0.44517.21±0.4250.865±0.02337.79±2.63107.77±1.98146.08±4.12Raidionics-Slicer17.70±0.62417.07±0.5710.924±0.01690.58±1.03178.92±2.71144.35±2.49Table12:Runtimedistributionperstepinthestandardizedreportpipeline,computedandaveragedusinganhigh-endcomputerforthemetastasistumortype,eachexpressedinseconds.Brainsegm.Tumorsegm.Reg.preprocRegistrationApplyreg.Featurescomp.Raidionics68.58±1.45463.32±1.3106.906±0.22272.09±1.12573.33±9.76136.96±0.98Raidionics-Slicer59.37±1.26653.85±0.3587.097±0.174139.56±3.70792.76±17.13135.71±3.7111