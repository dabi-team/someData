2
2
0
2

n
u
J

7
1

]

M
Q
.
o
i
b
-
q
[

2
v
9
9
9
7
0
.
6
0
2
2
:
v
i
X
r
a

Learning diffusion coefficients, kinetic parameters, and the
number of underlying states from a multi-state diffusion
process: robustness results and application to PDK1/PKCα
dynamics

L.R. Baker1*, M.T. Gordon2, B.P. Ziemba2, V. Gershuny3, J.J. Falke2, D.M. Bortz1*,

1 Department of Applied Mathematics, University of Colorado, Boulder, CO, USA
2 Department of Biochemistry, University of Colorado, Boulder, CO, USA
3 Division of Applied Regulatory Science, Office of Clinical Pharmacology, Office of
Translational Sciences, Center for Drug Evaluation and Research, US Food and Drug
Administration, Silver Spring, MD, USA

* lewis.r.baker@colorado.edu, david.bortz@colorado.edu

Abstract

Systems driven by Brownian motion are ubiquitous. A prevailing challenge is inferring,
from data, the diffusion and kinetic parameters that describe these stochastic processes.
In this work, we investigate a multi-state diffusion process that arises in the context of
single particle tracking (SPT), wherein the motion of a particle is governed by a discrete
set of diffusive states, and the tendency of the particle to switch between these states is
modeled as a random process. We consider two models for this behavior: a mixture
model and a hidden Markov model (HMM). For both, we adopt a Bayesian approach to
sample the distributions of the underlying parameters and implement a Markov Chain
Monte Carlo (MCMC) scheme to compute the posterior distributions, as in [1]. The
primary contribution of this work is a study of the robustness of this method to infer
parameters of a three-state HMM, and a discussion of the challenges and degeneracies
that arise from considering three states. Finally, we investigate the problem of
determining the number of diffusive states using model selection criteria. We present
results from simulated data that demonstrate proof of concept, as well as apply our
method to experimentally measured single molecule diffusion trajectories of monomeric
phosphoinositide-dependent kinase-1 (PDK1) on a synthetic target membrane where it
can associate with its binding partner protein kinase C alpha isoform (PKCα) to form a
heterodimer detected by its significantly lower diffusivity.

All matlab software is available here:

https://github.com/MathBioCU/SingleMolecule

1

Introduction

Inference of physical parameters from experimental data is a ubiquitous problem in
applied mathematics. These parameters can have associated distributions and while
there are methods to infer distributions [2, 3] for the mean-field equation model, it is
frequently better to develop a stochastic process model. Building on a stochastic model,
a typical aim is to infer the underlying parameters from a realization of the process. For
Brownian motion, the parameter of interest is most often the diffusion coefficient. The
identification of multiple diffusion coefficients is the focus of this work in the context of

June 20, 2022

1/29

 
 
 
 
 
 
single particle tracking (SPT). Single particle tracking of proteins diffusing in 2
dimensions on a biological membrane is a rapidly growing experimental approach in
biophysics and biochemistry. Generally speaking, it is performed by selectively
attaching a small, non-perturbing fluorescent label (or tag) to a protein of interest, and
then recording the fluorescent protein’s movement on the membrane surface using a
single molecule total internal reflection fluorescence (sm TIRF) microscope. The
resulting movie is analyzed to generate a single molecule trajectory suitable for
quantitative analysis [4].

In the simplest case, the diffusion coefficient of the process is inferred via assuming
two-dimensional Brownian motion and plotting the mean square displacements of one or
more identical protein molecules against time, then calculating the diffusion constant
(D) from the slope of the resulting straight line (D = slope / 4). The resulting D value
is inversely proportional to the frictional drag of the molecule against the membrane,
and thus provides information about the membrane contacts and oligomer number of
the molecule as it executes simple Brownian diffusion on a homogeneous membrane
surface [4–7]. However, in more complex systems, Brownian motion can be inadequate
for modeling a protein with multiple diffusive states, since the protein may switch
between different membrane docking geometries, or may undergo transient binding
interactions with other membrane proteins, cytoskeletal elements, or membrane
inhomogeneities [5, 6, 6–18]. The resulting deviations of diffusive behavior from simple
Brownian motion invite a deeper interpretation of the underlying dynamics of the
system.

The present work focuses on systems in which the protein being observed switches
reversibly between two or more protein-membrane or protein-protein interaction states
while diffusing on the membrane surface. When the observed protein forms a new
membrane contact, or binds to another membrane-associated protein, its lateral
diffusion exhibits a decreased diffusion coefficient owing to the additional frictional drag
of the new membrane contact or bound protein against the lipid bilayer. Quantitative
studies have shown that on supported lipid bilayers, the frictional drags of multiple
species in a complex are additive, enabling calculation of the diffusion coefficient of the
complex from the summed frictional drags measured for the individual
components [5, 6, 15]. Here we refer to a stochastic diffusion process that includes
random switching between a finite number of modes or states, each characterized by
distinct diffusion coefficients, as a “switch diffusion process”.

In many biological systems, a protein diffusing on a biological membrane exhibits
multiple interaction states and modes of diffusion with distinct diffusion coefficients.
The protein kinase phosphoinositide-dependent kinase-1 (PDK1) possesses a lipid
binding domain1 with a strong affinity for specific target lipids2 whose levels in the cell
membrane are highest during a cell-signaling event. Single-molecule diffusion studies of
full length PDK1 reveal that, while bound to a specific target lipid, PDK1 exhibits
homogeneous 2-D diffusion adequately described by a single diffusion coefficient. PDK1
also contains a catalytic protein kinase domain which regulates activation of
membrane-bound protein kinase C (PKCα) [19, 20] and other AGC protein kinases.
Protein kinase C alpha isoform (PKCα) is one such kinase that docks to the membrane
surface and phosphoactivates multiple substrate proteins. A single-molecule diffusion
study [15] has revealed that membrane-bound PKCα exhibits two diffusion states
distinguished by shallow membrane and deep membrane penetration, as well as
correspondingly larger and smaller diffusion coefficients, respectively. Moreover, PDK1
and PKCα form a stable heterodimeric complex on the target membrane surface via a

1The pleckstrin homology (PH) domain.
2Phosphatidylinositol (3,4)-bisphosphate ( (PI(3,4)P2) and phosphatidylinositol (3,4,5)-trisphosphate

PIP3

June 20, 2022

2/29

(a) The colorbar indicates the frame number.

(b) Time series of total displacement between
each frame, along with a 30-frame running
average (blue curve).

Fig 1. A 637-frame trajectory of PDK1 on a synthetic membrane with
PKCα concentration near the K1/2 for the binding reaction, ensuring that th average
PDK1 molecule is bound to PKCα about half of the time. The observed PDK1
molecule appears to exhibit multiple modes of diffusion–in particular, the particle
displacements appear to be smaller between frames 230 and 400. The lipid composition
was PC/PS/PMA/PIP3 72/24/2/2 mol %.

PIF interaction between their kinase domains [10]. Given the much greater frictional
drag of PKCα against the bilayer, single-molecule diffusion analysis has revealed that
the binding of PDK1 to PKCα yields a heterodimer in which PDK1 diffusivity is greatly
reduced owing to the summed frictional drags of the PKCα and PDK1 molecules [10].

Figure 1a depicts the spatial trajectory of a membrane bound molecule of

phosphoinositide-dependent kinase-1 (PDK1) on a synthetic membrane containing its
binding partner protein kinase C (PKCα). The PKCα concentration is chosen to be near
3 of the PDK1-PKCα binding reaction, thereby driving about half of the PDK1
the K1/2
population into PDK1-PKCα heterodimers at any given time. Figure 1b displays
step-lengths vs time for consecutive 20 ms steps of the trajectory, as well as a moving
average smoothed by averaging the stepsizes over a moving 30-frame window. The latter
plot suggests the existence of two or three diffusion states including a low diffusivity
state from frames 230-400, an intermediate state, and a high diffusivity state observed
around frames 90, 190 and 410.

The critical elements of a switch diffusion process are its multiple underlying

diffusive states, which may be difficult to directly resolve in the diffusion tracks, and the
random transitions between these states. Two common approaches to modeling these
features are mixture models [5, 10, 14, 21] and hidden Markov models
(HMMs) [1, 12, 17, 22–24]. Mixture models are appealing in that they require inference of
fewer parameters, possess parametric statistical forms, and benefit from the fact that
observations may be treated as independent and identically distributed, which permits
use of a joint PDF as a likelihood function [25, 26]. These models can accurately
determine the fraction of total steps associated with each diffusive states, and the
diffusion coefficient of each state, but cannot provide kinetic information about the
diffusion state lifetimes nor the transition kinetics between states. HMMs, by contrast,
utilize more parameters and can provide the missing kinetic information. However,
observations from a stochastic process modeled as an HMM are temporally correlated,
which invalidates the use of a joint PDF as a likelihood function for parameter inference,

3The K1/2 is the equilibrium constant obtained in experimental conditions where, on average, half

of the protein binding sites are saturated with ligand.

June 20, 2022

3/29

which makes parameter inference less analytically tractable.

The advantage of using HMMs to infer physically relevant kinetic information about

the system in question makes research into their implementation very desirable. Das
and colleagues [1] motivated many subsequent studies of SPT trajectories using an
HMM framework. In their work, they develop a two-state HMM and describe a Markov
Chain Monte Carlo (MCMC) scheme to infer the parameters of their model and apply
their methodology to study the dynamics of the receptor LFA-1 on the surface of T cells.
Moreover, they present a detailed guide to implementation, including well-annotated
pseudocode of relevant algorithms. We build upon their contribution by extending their
methodology to include a third diffusive state, opening avenues into methods for
statistical model selection and robustness studies. A contributing author of the Das
study, Cairo, extended the 2-state study of LFA-1 to incorporate measurement
noise [17], and implemented a 2-state HMM to detect particle confinement of
ganglioside GM1 lipids to a harmonic potential well [12]. Noise propagation and
confinement are relevant considerations for applied problems; particle locations can only
be measured with finite precision, and biological membranes exhibit various diffusive
characteristics ranging from homogeneous to inhomogeneous. The work presented here
focuses on a simple, homogeneous, liquid-disordered membrane lipid bilayer, which is a
useful model system for studying signaling reactions on key cellular membranes depleted
of lipid microdomains (rafts), including the leukocyte leading edge membrane and the
leading edge-derived phagosomal membrane [27]. This simplicity is useful to our initial
exploration of the baseline robustness of the extended Das algorithms. In the present
studies, the particle locations are assumed to be known with arbitrary precision, and
the membranes employed are flat, well-mixed, and free of spatially-dependent membrane
inhomogeneities and diffusion barriers.

Lind´en and Elf proposed a variational Bayes approach to infer the underlying
parameters of HMMs [22, 28]. A significant contribution of this work is a mean-field
approximation to increase the tractability of analysis of their HMM, and a
cross-validation approach to the problem of model selection (that is, identification of the
number of underlying states). Recently, Falcao and Coombs [24] presented an infinite
hidden Markov model (iHMM) to simultaneously predict the cardinality of the state
space as well as model parameters. They implement their method to investigate the
motion of receptors on the plasma membrane of B cells. Absent from both of these
studies is a thorough examination of the robustness of their parameter inference schemes;
these works each validate their methodology with only a handful of simulated trials.

Predicting from a trajectory (or collection of trajectories) the number of underlying
diffusive states, diffusion coefficients associated with each state, and characterizing the
rate of transition between different states is a continuing area of research [1,22–24,28,29].
Robust identification of the number of underlying diffusive states is a notoriously
difficult problem that may provide insight into the nature of interactions between an
objective particle and specific components of its environment. Likewise, the ability to
estimate kinetic parameters of reactions that give rise to switch diffusion processes open
up potential avenues into researching treatments to related pathologies. For instance,
SPT experiments could be used to screen drug candidates to treat aberrant signaling
behavior, or to study the kinetic impact of mutations on the signaling or regulatory
competence of membrane proteins. Inference of these parameters and quantification of
the robustness of these inferences are the primary objectives of this work.

In Section 2 we will present an inference-motivated analysis of two common model
classes that describe the above phenomena, as well as a method for inferring Maximum
Likelihood Estimates (MLEs) of the two model classes using Markov chain Monte Carlo
(MCMC). In Section 3 we will empirically compare the two models using an ensemble of
synthetically-produced trajectories and test the ability of model selection criteria to

June 20, 2022

4/29

determine the number of diffusive states minimal a priori information. Finally, we
apply our analysis to a collection of PDK1 trajectories obtained via single molecule
TIRF microscopy, including the trajectory presented in Figure 1. As part of this
analysis, we explore a methodology whereby we treat the diffusion coefficients as known
quantities (inferred from previous experimental studies on the individual diffusion states
under conditions where switching is not detected [10]) in order accelerate and improve
estimation of the transition probabilities of the HMM.

Lastly, we note that all matlab software which produces the results is available here:

https://github.com/MathBioCU/SingleMolecule

2 Models and Parameter Inference

Two approaches to modeling switch-diffusion processes are mixture models and hidden
Markov models (HMMs). For the convenience of the reader and for reference, we
include a description of simple Brownian motion in two spatial dimensions in Section
A.1. The two model classes presented here are differentiated by the random process that
generates the underlying state sequence. The mixture model state sequence is a
Bernoulli scheme, while the HMM state sequence is a Markov chain. Each provides an
accompanying kinetic interpretation. A Bernoulli scheme describes a zero-order process,
since the rate of product formation is independent of the reactant concentration. The
Markov process, by contrast, describes a first-order reaction, since the rate of product
formation depends on the reactant concentration.

2.1 Mixture Models

The simplest model that captures multi-diffusion coefficient motion is the mixture
model, constructed as a sum of Rayleigh distributions, each representing the step size
distribution of a single diffusive state with a given diffusion constant D [5]. A particle
subject to 2-D Brownian diffusion whose location is sampled N times at fixed time
intervals τ will produce a sequence of independent 2D displacements O = (ri)N
with magnitudes ri = (cid:107)r(cid:107)2. A particle subject to k distinct diffusive states {Di}k
with respective probabilities {αi}k
distribution with pdf

i=1 has displacements drawn from the mixture

i=1 with
i=1

f (r; {α}k

j , {D}k

j ) =

k
(cid:88)

j=1

αj

r
4Djτ

e−r2/(4Dj τ ),

where the αj > 0 and (cid:80)k

j=1 αj = 1.

MLEs of the 2k − 1 parameters arising from this model θ = {(Di)k

i=1, (αi)k−1

i=1 } can

be inferred by maximizing the likelihood function

L(θ|O) =

N
(cid:89)

i=1

f (ri|θ) =

N
(cid:89)

(cid:32) k

(cid:88)

i=1

i=1

αj

ri
4Djτ

e−r2/(4Dj τ )

(cid:33)

,

or equivalently the log-likelihood function

(cid:96)(θ|O) =

N
(cid:88)

i=1

log





k
(cid:88)

j=1



e−r2

i /(4Dj τ )

 .

αj

ri
4Djτ

(1)

In contrast to the 1-state model described in the appendix, the MLEs of this mixture
model cannot be computed analytically. In this work, we calculate the MLE as the

June 20, 2022

5/29

Fig 2. A Markov chain permits a description of state switches where the probability of
state transitions depend on the initial state.

maximum a posteriori estimate, obtained by sampling the posterior distribution of θ
with MCMC. While MCMC is less computationally efficient than other gradient-based
optimization schemes, it has distinct benefits. Because it simulates a sample of the
posterior distribution of the parameters, it is less liable to be trapped in local extrema,
returning spurious results. Additionally, simulating the posterior distributions allows
quantification of credibility of parameter estimates.

2.2 Hidden Markov Models

The mixture model framework is flexible and general, and is ideal for determining the
diffusion coefficients and relative proportions of multiple diffusion states in a complex
diffusive system, especially a system with a large number of individual trajectories. Its
limitations include (i) the large number of individual steps that must be measured to
define multiple Rayleigh distributions, generally making this model unsuitable for
analyzing a individual trajectories, (ii) the inability to determine whether the multiple
states detected arise from state-switching within individual trajectories or a mixture of
single-state trajectories with distinct diffusion coefficients, and (iii) the lack of
information provided about kinetics in a system that switches between states.

For analyzing individual trajectories in which diffusion switches between distinct
states, the HMM can be applied whether or not the likelihood of switching from one
state to another depends on the initial state. This HMM model can reveal the switching
kinetics as well as the diffusion coefficients and relative proportions of the states. The
observable variables of the HMM are the displacements O of the particle, and whose
hidden variables s = (si)N
during each frame of the trajectory. See Das et al [1] for a detailed development of a
two-state hidden Markov model for diffusion. We present the k-state generalization
here, though we only consider models with up to k = 3 diffusive states in in this work.
i=1 with si ∈ {1, 2, ..., k}.

i=1, are the states (e.g. “bound” or “unbound”) of the particle

In this description, there is a hidden state sequence s = (si)N

June 20, 2022

6/29

IIIp12p21IIIIIIp13p12p21p23p32p31The state sequence s is a Markov chain with transition matrix T ∈ Rk×k.

T =








p11
p21
...
pk1

p12
p22
...
pk2

...
...
. . .
...








p1k
p2k
...
pkk

The entries of this transition matrix, pij, are the probabilities that the particle switches
from state i to state j over the course of a single frame (see Figure 2 for 2- and 3-state
illustrations of the Markov process). While in state si, the diffusion of the particle is
described by diffusion coefficient Di.

This model consists of k2 parameters: k diffusion coefficients, and k2 − k

independent transition probabilities (making use of the fact that T is row stochastic,
i.e., (cid:80)

j p(cid:96)j = 1).

Because the displacements ri are explicitly not independent, the likelihood function

of a set of parameters θ = {(Dj)k
succinctly represented as a joint pdf, as in the mixture model. However, a likelihood
function can be calculated recursively using the algorithm of Baum and Petrie [30]
which we review now.

i,(cid:96)=1} given an observation O cannot be

j=1, (pj(cid:96))k

Begin by considering the quantity

αm(κ) ∝ P [r1, r2, ..., rm; sm = κ|θ],

which is the probability of observing a partial trajectory (ri)m
in state κ, given θ. The likelihood of observing a full trajectory O of length N is the
probability of the trajectory ending in any of the k possible states, thus

i=1 of length m and ending

L (O|θ) ∝

k
(cid:88)

κ=1

αN (κ).

(2)

A trajectory of length m that ends in state κ can be obtained from a trajectory of
length m − 1 that transitions into state κ from any of the possible states, and then
observing a step drawn from the distribution governing state κ:

αm(κ) =

(cid:35)

αm−1(q)pqκ

(cid:34) k

(cid:88)

q=1

·

f (rm|sm = κ)
(cid:125)
(cid:123)(cid:122)
(cid:124)
P (observing displacement ri while in state κ)

(cid:124)

(cid:123)(cid:122)
P (transitioning into state κ)
(cid:34) k

(cid:35)

(cid:125)

=

αm−1(q)pqκ

(cid:88)

q=1

rm
4Dκτ

e−r2

m/(4Dκτ ).

This recursion is initialized using the steady-state probabilities of the Markov chain:
α0(κ) = πκ. A corresponding recursive formulation for the log-likelihood is used in
practice to avoid numerical overflow. As with the mixture model of Section 2.1, we
calculate the MLE using MCMC.

These two modeling frameworks are closely related, and we note that the k-state
mixture model is a special case of the k-state hidden Markov model. A k-state mixture
model can be recovered by setting pij = αj for each i, resulting in the transition matrix

T =








α1 α2
α1 α2
...
...
α1 α2








.

... αk
... αk
...
. . .
... αk

June 20, 2022

7/29

That is, if the transition from state i to j is independent of state i, the resulting HMM
is identical to the corresponding mixture model with the same diffusion coefficients.
Conversely, by the law of large numbers for Markov chains, a sufficiently long trajectory
will produce a distribution of step sizes matching that of a mixture model with mixing
coefficients αi equal to the steady state distributions πi of the Markov chain (provided
that the Markov chain is irreducible).

Kinetic rate constants are related to the transition probabilities through the equation

kij =

pij
τ

2.3 Parameter Inference via Markov Chain Monte Carlo

In each of the two models described above, our approach to parameter inference is
leveraged on determining the parameters θMLE that maximize the likelihood (or,
equivalently, the log-likelihood) function of an observation O given θ. Closed form
expressions for the MLEs (akin to equation 4) do not exist for the likelihood functions
arising from multiple diffusive states (equations 1 and 2). We use Markov chain Monte
Carlo (MCMC) to simulate the distribution of the likelihood function for both classes of
models, because the likelihood functions considered here tend to exhibit multiple local
extrema–especially as the number of underlying states increases–which can trap
gradient-based optimizers. Moreover, because MCMC simulates the posterior
distribution of the likelihood function, the credibility of the MLEs can be quantified.
This in turn allows the robustness of the parameter estimation scheme for each model
class to be directly compared. We use the maximum a posteriori (MAP) estimate as our
MLE.

The three-state HMM presents a difficulty due to the explicit coupling of the

i(cid:54)=j=1 and deduce

j(cid:54)=i pij. This requires that (cid:80)

underlying transition probabilities. We aim to infer (pij)k
pii = 1 − (cid:80)
j(cid:54)=i pij ≤ 1, which constrains the domain of the
likelihood function to triangular regions in the pijpik-planes (where i, j, k are distinct).
When proposals are generated as perturbations of the previous proposal along the
parameter axes, we have observed our MCMC sampler to exhibit unusually high
rejection rates, apparently a consequence of the sampler getting “stuck” in the corners.
To circumvent this, we use a Matlab implementation of Goodman and Weare’s
affine-invariant ensemble MCMC (GWMCMC) [31], [32]. Briefly, this implementation
uses a parallel ensemble of MCMC chains (called “walkers”). New proposals are drawn
along the line connecting two walkers in parameter space. By expanding the space of
allowable directions to draw new samples, GWMCMC mitigates the problem of
transition probabilities getting caught in corners. Moreover, GWMCMC does not
require a researcher to designate the scale of perturbations, since the magnitude of
perturbations scales dynamically as a function of the distance between walkers in
parameter space. In effect, GWMCMC permits efficient sampling without a priori
knowledge of the scales of the parameters.

In all of the presented results, GWMCMC was run using 200 walkers4. The MCMC

chains are initialized randomly, with diffusion coefficients drawn from a range of
[Dmin, Dmax], with

Dmin =

1
4τ

min
1≤i≤N

r2
i and Dmax =

1
4τ

max
1≤i≤N

r2
i .

4The number of walkers is, aside from the initialization of the ensemble, the only tunable parameter
of GWMCMC. The rule of thumb suggested by Goodman and Weare is to use a number of walkers that
is at least twice the dimension of the model parameter space, but more tends to be better [32]. We
experimented with 50 walker ensembles, and didn’t see a significant speedup or performance increase. On
the other hand, inclusion of more walkers wasn’t accompanied by a significant increase in computational
overhead.

June 20, 2022

8/29

These can be thought of as the largest and smallest point estimates of a single diffusion
coefficient supported by the data. The same Dmin and Dmax are used to constrain the
support of the likelihood function; in absence of this constraint, the MCMC sampler
occasionally diverges, as an unreasonably large diffusion coefficient can be offset in
likelihood by a Markov chain that seldom visits the anomalous state. Transition rates
are initialized entirely randomly, constrained only by the stochasticity property of the
transition matrix (as described above). The remaining 199 walkers are initialized in a
tight Gaussian ball around the first walker.

2.3.1 Convergence of MCMC Sampler

Standard MCMC convergence diagnostics (such as the Gelman-Rubin statistic) cannot
be implemented in applications of GWMCMC because the parallel chains of the
Goodman-Weare method are not independent. Instead, the standard approach to
assessing convergence is to estimate the integrated autocorrelation time, τcorr, of the
chains, which can be used to quantify the variance of the sampler. This can be leveraged
to determine how many steps are necessary to reduce the relative error of the estimated
MLE to be suitably small [32], [33]. Specifically, the criteria for convergence is

(cid:115)

zγ

σ2
θ
Meff

≤ ˆµθβ,

where zγ is the z-score, or “critical value” associated with a confidence level γ, σ2
the sample variance associated with samples of the parameter θ, Meff is the effective
independent sample size of the chain (Meff = M
τcorr
parameter θ, and β is the desired relative error of the estimated MLE. The chains were
diagnosed as converged when this inequality held for each parameter θ. Essentially, the
expression on the left is the width of a γ-level confidence interval based on effectively
independent samplings of θ. The expression on the right is a threshold for the width of
the confidence interval, relative to the sample mean of the parameter. In this work, we
selected γ = 0.95 (so zγ ≈ 1.96) and β = 10−4.

), ˆµθ is the sample mean of the

θ is

3 Model Comparisons and Robustness Results

In this section, we use an ensemble of simulated trajectories to empirically compare the
robustness of the inference scheme described above across model types. As part of this
analysis, we investigate how the robustness of the method scales with the number of
underlying states, giving particular focus to parameter estimation of three-state models.
Section 3.1 describes our procedure for simulating trajectories in the ensemble. Section
3.2 illustrates the inference scheme for a particular trajectory in the ensemble. Results
of the full ensemble analysis is contained in Section 3.3, which includes an application of
model selection criteria to predict the number of underlying diffusive states. Finally, we
apply our analysis to a collection of experimentally measured trajectories of PDK1 in
Section 3.3.1.

3.1 Simulation Design

The numerical experiment that follows uses synthetic diffusion data generated in the
following way: it is assumed that the diffusive state transitions are described by a
Markov process. To this end, a random (entirely arbitrary) 3 × 3 transition matrix is
constructed. Next, a set of diffusion coefficients is randomly selected from a range of
“biologically feasible” parameters, summarized in Table 1. These were chosen to be

June 20, 2022

9/29

roughly compatible with estimations of diffusion coefficients from previous work
considering membrane-targeting proteins [5].

D1
(10−3, 10−2)

D2
(10−2, 10−1)

D3

(0.5, 5)

Table 1. Ranges for “biologically feasible” diffusion coefficients. Units are µm2/s.

The trajectory was initialized randomly with the probability of initializing in state i

equal to the stationary probability of state i of the transition matrix. The particle’s
displacement was obtained by drawing coordinate displacements x and y from
N (0, 2Dτ ). Subsequent states were determined by propagating the Markov chain, which
dictated subsequent coordinate displacements. This process was repeated until a
trajectory consisting of 1000 displacements was obtained.

3.2 Comparison of HMM and Mixture Models

Consider a particle subject to three diffusive states5 in two spatial dimensions, with
displacements measured for 1000 frames6 with frame lag τ = 0.01. In order of increasing
magnitude, the diffusion coefficients corresponding to each state were selected to be
D1 = 0.0036513µm2/s, D2 = 0.024517µm2/s, D3 = 1.6539µm2/s.

The underlying state sequence was generated from the transition matrix





T =

0.3311
0.4693
0.9023 0.0716
0.3164 0.0554

0.1997
0.0261
0.6282



 .

The expected values of these mixture coefficients obtained from the steady state of the
Markov chain are α1 = 0.473, α2 = 0.2552, and α3 = 0.2719.

For the purpose of this analysis, we wished to differentiate bias in parameter

inference due to the inference scheme from the bias arising from taking a finite sample
of a random process (i.e., sampling error). Thus, we calculated transition rates and
mixing coefficients directly from the state sequence of the simulated trajectory to obtain





T =

0.3453 0.4691
0.8989 0.0903
0.3529 0.0769

0.1856
0.0108
0.5701





and mixing coefficients α1 = 0.501, α2 = 0.277, α3 = 0.222. Likewise, each diffusion
coefficient was estimated from the sample using Equation 4, using the subset of
displacements corresponding to each state. In other words, we calculated the best
possible estimate of each diffusion coefficient as if we had perfect knowledge of the
particle’s state sequence. The parameters used to generate the sample are tabulated
along with these retroactively calculated parameters in Table 2. Throughout this work,
when we compare an inferred parameter to a true value, we use the parameters
computed from the sample.

5We illustrate our analysis for a 3-state model. A 2-state analysis is similar, see [1]
6This is a commonly selected movie length in the HMM literature for simulated single particle

trajectories, as seen in [1], [17], [12].

June 20, 2022

10/29

D1

D2

D3

p12

p13

p21

p23

p31

p32

α1

α2

0.0702
0.0716

0.4693
0.4691

1.4083
1.5516

G 0.0089
0.0088
S

0.1997
0.1856
Table 2. Parameters used in simulation comparing HMM and mixture model classes.
Diffusion coefficients are reported in units of µm2/s. The row of generated “G”
parameters are those used to generate the trajectory, the row of sample “S” parameters
are those retroactively calculated from perfect knowledge of the trajectory.

0.9023
0.8989

0.0261
0.0108

0.3164
0.3529

0.0554
0.0769

0.473
0.501

0.255
0.277

For the 3-state HMM, we performed a 200 walker GWMCMC sampling of the
posterior distributions until the convergence criterion described in Section 2.3.1 was
achieved, which occurred after 1.7 × 107 total steps, or 85, 000 steps per walker7. Figure
3 depicts a trace of one walker in each parameter (other walkers of the ensemble are
similar). The (sample) parameter that we aim to infer is indicated by a horizontal black
line. Indeed, these traces appear to be reasonably well converged to the target value.

Fig 3. 3-state HMM parameter estimation traces. Top: Diffusion coefficients, Bottom
left; p12 and p13, Bottom center: p21 and p23, Bottom right: p31 and p32.

The marginalized posterior distributions8 obtained from our sampler are depicted in
Figure 4. Vertical axis labels are omitted because the distributions are proportional to
the likelihood function, but the particular heights of the distributions are irrelevant to
our analysis. True (sample) parameter values are indicated by vertical blue bars. The
mode of the distribution is taken to be our MLE9, which is marked by a vertical blue
line. The mode of the distribution is identified from a histogram of the GWMCMC
samples, indicated in red. The value of the mode depends on how the data is binned
into a histogram10; the default number of bins selected to discretize posterior

7The convergence criterion was checked after every 105 steps.
8Because we use a uniform prior, the posterior distributions sampled by GWMCMC are proportional

to the likelihood function.

9Maximum a posteriori (MAP) estimate is also used to describe this choice of estimator. The two

are equivalent when using a uniform prior.

10In order to clearly depict the posterior distributions, they are depicted on an interval that excludes
rare, unusually large samples. When the mode of the distribution is calculated, these observations are

June 20, 2022

11/29

distributions in this and subsequent analyses was 1000. We used the same binning to
calculate the highest density posterior interval (HDPI) containing 95% of the posterior
density, which we report in Table 3 along with the MLE for each parameter. This
credible interval quantifies the uncertainty of our MLE.

A similar analysis was performed for a 3-state mixture model using the same
simulated trajectory. We omit the traces and posterior distributions for brevity. The
GWMCMC sampler achieved convergence after 8.6 × 105 total steps, or 43000 steps per
walker. MLEs of diffusion coefficients and mixing coefficients obtained from this
analysis are tabulated in Table 3, along with their corresponding 95% credible intervals.

(a) Diffusion coefficients.
Fig 4. Posterior distributions of parameters obtained from a 3-state HMM analysis.

(b) Transition probabilities.

Fig 5. 3-state mixture model parameter estimation traces. True parameter values are
indicated with a thick black line. Left: MCMC samples of diffusion coefficients; Right:
MCMC samples of mixture coefficients.

Broadly, diffusion coefficients are estimated with a fairly high degree of accuracy and
neither model performs uniformly better than the other. D2 is both the least accurate
and least certain estimate for both models. A plausible explanation is that the D2
serves as a degree of freedom within the model to describe unusually large
displacements arising from state 1, or unusually small displacements arising from state
3. Mixture coefficients are inferred with high accuracy and moderate precision.
Transition probabilities of the HMM, by contrast, are more biased than than the mixing
coefficients. Curiously, the MLE transition rates give rise to a steady state distribution
that is more accurate than that inferred through the mixture model:
α1 = 0.4976, α2 = 0.2694.

In conclusion, neither model seems to decisively outperform the other for this
trajectory. The HMM took significantly longer to run to convergence (roughly 18-fold

included, which changes the width of the histogram bins. This is why the calculated mode (red line)
doesn’t always align with the apparent mode of the histogram.

June 20, 2022

12/29

Table 3. Summary of parameter estimation results for the trial described above.

θ

0.0088
0.0716
1.5516
0.501
0.277
0.4691
0.1856
0.8989
0.0108
0.3529
0.0769

ˆθmix
0.0084
0.0565
1.4719
0.4738
0.2935
-
-
-
-
-
-

95% CI

[0.0066,0.0097]
[0.006,0.0725]
[1.2784,1.7337]
[0.4052,0.5396]
[0.2338,0.3546]
-
-
-
-
-
-

|θ−ˆθ|
θ
0.0502
0.2104
0.0514
0.0542
0.0594
-
-
-
-
-
-

ˆθHMM
0.0080
0.0607
1.4694
0.4916
0.2709
0.4762
0.1935
0.8930
0.0220
0.3976
0.0409

95% CI

[0.0064,0.0191]
[0.0424,1.1757]
[1.2644,1.7153]
[0.4473, 0.5382]
[0.2271, 0.3191]
[0.0155,0.5642]
[0.1519,0.2415]
[0.3100,0.9850]
[0,0.5384]
[0.2977,0.6014]
[0,0.1790]

|θ−ˆθHMM|
θ
0.0926
0.1530
0.0530
0.0187
0.0220
0.0151
0.0424
0.0066
1.0291
0.1266
0.4679

D1
D2
D3
α1
α2
p12
p13
p21
p23
p31
p32

longer), and this extended computational time doesn’t directly translate to more
accurate parameter inference. However, the advantage of an HMM as a kinetic model
may, for some applications, outweigh the computational cost. In an effort to explore
how well these results hold up in general, we tested this procedure on the full ensemble
of simulated trajectories.

3.3 Ensemble Robustness Results Using Simulated

Trajectories

The example presented in the previous section illustrates a situation where the
parameter inference scheme works well for both models. In pursuit of a characterization
of the relative robustness of the two methods, as well as the relationship between
robustness and the dimension of parameter space, we performed a similar analysis on
the remainder of the ensemble described in Section 3.1. From each realization, we
implemented the inference scheme described in Section 2 to obtain 2- and 3-state model
parameter estimates for both the mixture model and the HMM. We calculated the
diffusion coefficient of a 1-state model via Equation 4. The estimated parameters were
compared to the sample parameters inferred from perfect knowledge of the particle’s
state sequence, as in the previous section. Figures 6 and 7 each illustrate the posterior
distributions of HMM parameters for three sample trials representative of poor, median,
and good trials (based on the L1 relative error of the parameter estimates). The relative
errors for all trials are depicted in Figure 8, which plots the relative error of each
parameter for each trial. Tables 4-7 summarize the relative bias across the ensemble for
each model class. For each model, the quartiles of the relative absolute bias describe
typical error among the model parameters across the ensemble trajectories. The
uncertainty of these estimate is summarized in these tables by the “width ratio”11,
which illustrates the relative uncertainty in the estimate for each parameter.

Unsurprisingly, the 2-state model parameters are generally inferred with greater
fidelity than the 3-state models. Both the 2-state mixture model and HMM parameters
are typically inferred within about 6% of the sample value. The 3-state mixture model
parameters are typically inferred within 12% of the sample value. By contrast, the
inference scheme struggles has difficulty inferring the smaller diffusion coefficients of the
3-state HMM (D1 is typically inferred with 100% error), and 20% error is typical among
the transition probabilities. This disparity is due in part to the fact that fewer than a

11The width ratio is calculated for parameter θ with MLE ˆθ and 95% credible interval [θ−, θ+] as
max({|ˆθ − θ−|, |ˆθ − θ+|)/ˆθ. It is the ratio of the distance from the MLE to the furthest edge of the
credible interval and the MLE itself.

June 20, 2022

13/29

third of the 3-state HMM analyses met the convergence criterion, highlighting the
computational challenge associated with this analysis.

Fig 6. Posterior distributions of 2-state HMM parameters from synthetic data. The
first row depicts a trial where parameters are inferred with the highest accuracy
(minimum L1 relative error); the second row depicts a typical trial (median L1 relative
error); the third row depicts a trial where parameters are inferred with worst accuracy
(maximum L1 relative error).

Fig 7. Posterior distributions of 3-state HMM parameters from synthetic data. The
first row depicts a trial where parameters are inferred with the highest accuracy
(minimum L1 relative error); the second row depicts a typical trial (median L1 relative
error); the third row depicts a trial where parameters are inferred with worst accuracy
(maximum L1 relative error).

Convergence and duration of the GWMCMC sampler is summarized in Figure 13.
Duration is quantified by the number of samples per walker. Among the 200 trajectories
of the ensemble 154 trajectories converged for the 3-state HMM analysis, 177
trajectories converged for the 3-state mixture model, 197 trajectories converged for the
2-state HMM, and 197 trajectories converged for the 2-state mixture model.

June 20, 2022

14/29

Fig 8. Relative error of 2- and 3-state HMM parameter estimates from ensemble of
synthetic trajectories.

June 20, 2022

15/29

D1
D2
α1

25%
0.0190
0.0011
0.0193

Relative (Absolute) Bias
50%
0.0388
0.0262
0.0635

75%
0.0764
0.1541
0.5598
Table 4. Quartiles of relative bias and width ratio among the estimates from 2-state
mixture trials. These statistics summarize 71 independent trials, of which 70 met the
convergence criterion.

Width Ratio
50%
0.3429
0.2146
0.3067

75%
0.1331
0.0480
0.2190

25%
0.2239
0.1343
0.1506

25%
0.0182
0.0113
0.0190
0.0131

Relative (Absolute) Bias
50%
0.0331
0.0262
0.0507
0.0449

75%
0.3071
0.2957
0.7274
0.3940
Table 5. Quartiles of relative bias and width ratio among the estimates from 2-state
HMM trials. These statistics summarize 66 independent trials.

Width Ratio
50%
0.1717
0.1470
0.2498
0.2273

25%
0.1227
0.1174
0.1500
0.1052

75%
0.0962
0.0482
0.1379
0.1107

D1
D2
p12
p21

D1
D2
D3
α1
α2

25%
0.0421
0.0483
0.0070
0.0131
0.0162

Relative (Absolute) Bias
50%
0.0998
0.1185
0.0205
0.0322
0.0341

75%
0.7342
1
0.2460
0.1917
0.2490
Table 6. Quartiles of relative bias and width ratio among the estimates from 3-state
mixture model trials. These statistics summarize 68 independent trials, 46 of which met
convergence criteria after 24 hours (wall-clock time).

Width Ratio
50%
0.4523
0.5085
0.1825
0.1442
0.1431

75%
0.2281
0.2574
0.0432
0.0706
0.807

25%
0.3422
0.3126
0.1476
0.0965
0.1112

25%
0.3043
0.0514
0.0092
0.0647

D1
D2
D3
All pij

Relative (Absolute) Bias
50%
1.0197
0.1405
0.0247
0.2234

75%
2.9995
0.4244
0.0502
0.8266

25%
0.3049
0.3547
0.1862
0.2755

Width Ratio
50%
0.4693
0.6628
0.2838
0.7621

75%
1.1512
51.40
0.6269
1.757

Table 7. Quartiles of relative bias and width ratio among the estimates from 3-state
HMM trials. Transition rates are pooled into the category of “all pij”. These statistics
summarize 68 independent trials, 22 of which met convergence criteria after 24 hours
(wall-clock time).

3.3.1 Number of States Determined by Model Selection Criteria

The Akaike information criterion (AIC) is computed as

AIC = 2k − 2ˆ(cid:96)

where k is the number of estimated parameters and ˆ(cid:96) is the maximum value of the
log-likelihood function for the model.

The Bayes information criterion (BIC), on the other hand, is derived from a

Bayesian viewpoint with equal prior probability on each model and vague priors (the
parameters are from a distribution from the Koopman-Darmois family, a very general

June 20, 2022

16/29

parametric family) [34] is computed as

BIC = log(n)k − 2ˆ(cid:96)

with k, ˆ(cid:96) as defined above and sample size n. Common to the AIC and BIC is a term to
penalize complex models and a goodness-of-fit term to select models that more
accurately reflect an observed sample. Specifically, the BIC assigns a more significant
penalty to parameter values when the sample size is larger.

Using the MLEs obtained from the ensemble, we computed the AIC and BIC for
each model type, for each trajectory of the ensemble. The model with the lowest score
in each criteria was selected as the most suitable model for the data. The AIC and BIC
both performed well based on HMM parameter estimates (81.5% and 83% accuracy,
respectively). The AIC and BIC based on mixture model parameter estimates
performed less well by comparison (73.5% and 72.5% accuracy, respectively).

AIC

BIC

HMM 81.5% 83%
73.5% 72.5%
Mixture

Table 8. Accuracy of AIC and BIC as a means to predict the number of underlying
states.

Parameter Inference from Trajectories of PDK1

Following analysis of calculated diffusion trajectories as decribed above, we applied our
HMM parameter estimation scheme to a collection of experimental PDK1 trajectories
that were measured using single molecule TIRF microscopy, with PKCα concentration
near the K1/2 for its binding to PDK1, thereby generating a population of PDK1
molecules that are bound to PKCα approximately half of the time. Single molecule
diffusion trajectories were imaged in movies collected at 20 msec per frame, which
defines the step time. Given the extensive computation time required for HMM analysis,
the trajectories analyzed were a curated subset of representative trajectories from
multiple movies collected under identical experimental conditions. Each representative
trajectory possessed long duration exceeding 375 steps, (7.5 sec total) and displayed
subjective evidence for multiple diffusive modes (as in 1b). Each trajectory is labeled
with a number (Trajectory “N”) identifying it within the collection of trajectories.
Similar to our method in Section 3.3, we performed all analyses with no prior

information, formal or otherwise. Our 1-state (Brownian motion) analysis was
performed using the analytic estimator of Equation 4. Our 2-state and 3-state HMM
analyses were performed independently of one another; completing an analysis of one
did not inform our approach to the other. In practice, sequential analysis is preferable,
so that interpretation of the simpler mixture model may inform the analysis of the
hidden Markov Model. Specifically, the diffusion coefficients inferred from the mixture
model may be used to constrain the parameter space of the HMM.

3.3.2

2-State Analysis

A membrane-associated, PDK1 monomer is tightly bound to its target lipid on a
timescale up to multiple seconds, and its 2-dimensional diffusion on the membrane
exhibits a D value defined by the frictional drag of the protein-lipid complex against the
viscous bilayer. PDK1 can reversibly associate with membrane-bound PKCα, yielding a

June 20, 2022

17/29

heterodimeric complex with a much larger frictional drag. Thus the diffusion coefficient
of PDK1 in the heterodimeric complex will be significantly smaller than that of the
PDK1 monomer. Given this understanding of a 2-state system, we interpret the smaller
diffusion coefficient, D1 as that of the PDK1-PKCα heterodimer, and the larger
diffusion coefficient as that of the PDK1 monomer. The association and dissociation
transition probabilities p12 are thus interpreted as (a) the probability of PDK1 and
PKCα to form the heterodimer between consecutive frames, and (b) p21 the probability
of the PDK1-PKCα heterodimer to dissociate between consecutive frames.

Figure 9 depicts posterior distributions of the parameters for a 2-state HMM. MLEs

and credible intervals are tabulated in the Supplemental Information (Section B.2.1).
The marginalized posterior distributions indicate good agreement of the value of the
high-mobility diffusion coefficient, D2 (ranging from about 1.5 − 1.9µm2/s) and, to a
lesser extent, the inferred transition probabilities. The D1 posterior distributions of
trajectories 4 and 11 indicate that this state is characterized by a larger diffusion
coefficient than in the other trajectories, and, uniquely, the 95% credible intervals of D1
and D2 overlap (Figure 10). This hints at the possibility that the states D1 and D2
appear in this model as two degenerate characterizations of the same, highly diffusive
state. This contrasts with the other trajectories, which exhibit both a high diffusivity
state and a distinct, well-defined low diffusivity state. The simplest explanation is that
Trajectories 4 and 11 track a defective protein possessing a native lipid-binding domain
that binds target lipid normally, and a non-native kinase domain unable to bind PKCα.
As a result, the proteins appear to spend the full trajectory duration in the
high-diffusivity, monomeric state. In any population of proteins, at least a few defective
molecules will be present, and our analysis hints this may be the case for the PDK1
molecules observed in Trajectories 4 and 11. For the three other trajectories the
lower-mobility state is characterized by a diffusion coefficient D1 in the range of
0.2 − 0.5µm2/s.

Fig 9. Posterior distributions from a 2-state HMM analysis of PDK1 trajectories.

Figure 10 also illustrates the credibility of inferred transition probabilities. Of note is

that (excepting trajectory 11), the per-frame probabilities of leaving either state are
confidently inferred to be significantly less than 1, which validates post hoc that the
protein generally remains in a given state at least for one full frame (20 msec), and that
multiple, undetected transitions between the two observed states are unlikely to occur
in a single frame. If the state transition probabilities were larger than, ∼ 0.5, this would
indicate a violation of the assumption that state transitions are generally slower than
the frame rate and thus detectable. In such a case, the frame rate would need to be
increased to detect transitions.

The transition probabilities p12 range from 0 − 0.11 and p21 range from 0 − 0.20.
The posterior distributions of first-order rate constants take the same shape as those for
the transition probabilities (with the horizontal axis scaled according to Equation 2.2)

June 20, 2022

18/29

Fig 10. 95% credible intervals of 2-state HMM parameters. MLEs are indicated by a
circle, 95% credible intervals are indicated by vertical bars. Left: Diffusion coefficients,
D1 colored blue, D2 colored gold. Right: Transition probabilities, p12 colored blue, p21
colored gold.

There is strong agreement of k21 among trajectories exhibiting evidence of two-state
switching (i.e., trajectories 7, 8 and 9) yielding a narrow range of 1.5 − 1.9s−1. For these
three trajectories, estimates of k12 range between 0.35 and 5.4s−1.

3.3.3

3-State Analysis

Recent work has uncovered previously unknown diffusion states of PKCα where the
major membrane-bound state is found to have two substates with the PKCα C1A
domain inserted into the membrane in either a shallow or deep configuration. When
PKCα is bound to PDK1, the deep configuration of C1A is predicted to confer a greater
frictional drag on the complex than its shallow conformation [15]. For this analysis, we
interpret the smallest diffusion coefficient, D1, to characterize the diffusion of PDK1
associated with PKCα (deep); D2 to characterize the diffusion of PDK1 associated with
PKCα (shallow); and the largest diffusion coefficient D3 to characterize the diffusion of
monomeric PDK1. The transition probabilities are interpreted accordingly, as in the
2-state analysis. We make no assumption restricting the possibility of interchange
between any two states (for instance, the complex PDK1-PKC(deep) may transition
directly (and reversibly) to monomeric PDK1).

Figure 11 depicts posterior distributions of the parameters for a 3-state HMM. The

posterior distributions of D2 obtained from trajectories 4 and 8 are notably bimodal,
with modes around 0.25 and 1.5 µm2/s that approximately agree with the Trajectory 8
estimates of D1 and D2 from the 2-state model (0.218 and 1.596µm2/s, respectively).
This can be interpreted as an identification error, where the label of D2 can alternately
be assigned to the states characterized by D1 and D3. Such a posterior distribution is
suggestive that a 3-state model over-fits the data. Interestingly, this additional degree of
freedom seems to have identified a low-mobility state in Trajectory 4 that was not
detected in the 2-state analysis. Similar identification errors appear to occur in all
trajectories, as illustrated in Figure 12. Specifically, the distributions of D2 overlap
significantly with those of D1 and D3, suggesting that the states are not all well-defined
and distinct.

The preference for a 2-state model over a 3-state model is supported by both the
AIC and BIC for nearly all trajectories considered, which would seem to contradict the
understood mechanism of PKCα activation. The simplest explanation is that the shallow
and deep states of the PDK1-PKCα heterodimer possess diffusivities that are too
similar to be resolved by the present analysis, such that only the monomer and
heterodimer states can be distinguished. A possible exception is trajectory 7, for which

June 20, 2022

19/29

Fig 11. Posterior distributions from 3-state HMM analysis of PDK1 trajectories.

Fig 12. 95% credible intervals for 3-state HMM. MLEs are indicated by a circle, 95%
credible intervals are indicated by vertical bars. Left: Diffusion coefficients, D1 colored
blue, D2 colored red, D3 colored gold. Right: Transition probabilities.

June 20, 2022

20/29

the BIC indicates no preference between a 2- and 3-state model. Interestingly, the
maximum likelihood estimates of the 3-state model for this trajectory,
D1 = 0.2126µm2/s, D2 = 0.4989µm2/s and D3 = 1.4591µm2/s, nearly match the
corresponding measurements in [15]. Given this agreement with a previous study, it is
possible that the rate constants tabulated in Table 13 for trajectory 7 may provide
preliminary insights into the transition kinetics of the full 3-state model with both
shallow and deep states of the PDK1-PKCα heterodimer.

Trajectory
4
7
8
9
11

1-State
879
577
1382
351
760

2-State
750
327
1225
248
765

3-State
764
336
1244
330
798

Trajectory
4
7
8
9
11

1-State
883
561
1387
355
764

2-State
748
325
1228
246
763

3-State
752
325
1232
318
786

Table 9. Model selection criteria. Left: AIC scores and Right: BIC scores associated
with 1, 2, 3-state HMMs for each PDK1 trajectory.

4 Conclusions and Discussion

In this work, we presented two model classes to describe a switch diffusion phenomena,
whereby a particle’s dynamics are governed by multiple modes of Brownian motion.12
Distinguishing these models is their respective treatment of the unobservable sequence
of diffusive states over the course of the trajectory. In the mixture model, the state
sequence is a realization a Bernoulli scheme, where subsequent states are effectively
determined by the flip of a weighted coin. For our HMM, the state sequence is a
realization of a Markov chain13. We developed k-state generalizations of both of these
models, including formulations of the likelihood functions for the purpose of parameter
inference. Furthermore, we presented detailed kinetic interpretations of the model
parameters, contending that the HMM provides a more valuable description of kinetics
of membrane-targeting proteins.

We build upon previous work [1], which prescribes an MCMC scheme to parameter

inference of a two-state HMM, by extending their methodology to consider both a
3-state HMM and mixture model. This extension uncovered several nontrivial practical
challenges that make an automated analysis computationally and analytically difficult.
Nevertheless, we improved upon the work of Das to develop a “black box” algorithm to
evaluate the maximum likelihood estimators of a model for a given trajectory, with
minimal user-specified tuning. We achieved this by implementing an affine invariant
ensemble MCMC sampler (GWMCMC), which efficiently samples posterior
distributions for badly-scaled problems.

We empirically assessed the robustness of the method by testing it on an ensemble of

simulated trajectories, which were constructed from a very general set of underlying
parameters. One component of our robustness study is a comparison between inference
of parameters between mixture models and HMMs. Our results indicate, unsurprisingly,
that the mixture model is more robust and tends to converge more quickly. Another
component of this study was an evaluation of the ability of two model selection criteria,
AIC and BIC, to identify the number of underlying diffusive states from data.
Surprisingly, we found that prediction of state size was exceptionally accurate for both
model selection criteria, across both model classes (Table 8), and that that these state

12All matlab software is available here: https://github.com/MathBioCU/SingleMolecule
13Interestingly, subsequent states are also determined by a coin flip, but the particular weights of the

coin depend on the present state.

June 20, 2022

21/29

predictions obtained from HMMs were more reliable, even though parameter inference
appears more robust for mixture models (Figure 8 and Tables 4-7).

The robustness test that we use in the present work was designed to evaluate the
ability of the method to infer parameters under an extremely broad range of conditions.
Our analysis indicates that the inference scheme typically performs quite well, even as
the number of diffusive states increases. In practice, one may reasonably expect the
parameter estimation schemes to perform better than indicated by the robustness test,
since the range of parameters chosen for the robustness analysis are more broad than
the parameters would be in their expected use case. Specifically, the HMM analysis
studied here is best suited for systems where the states exhibit long dwell times, since
an assumption of the physical system is that state transitions occur on a long timescale
(long dwell time) relative to the time span of an individual movie frame or diffusion step.
Our robustness study included trajectories with very short dwell times, with the
intention of assessing the efficacy of the method under the widest practicable range of
conditions. A robustness study that more accurately reflects the experimental
conditions that give rise to SPT trajectories (e.g. restricting pij (cid:28) 1 for i (cid:54)= j, or
requiring that the HMM transition matrix be diagonally dominant) may be a more
representative study. Our study, however, indicates that the long dwell time assumption
can be validated (or rejected) post hoc with reasonably high accuracy.

One can implement formal priors to reflect an understanding of the system. A
significant advantage to a Bayesian approach to parameter inference is that priors may
be used to reflect one’s beliefs about the parameters giving rise to a stochastic process.
We endeavored here to produce a robust approach to parameter inference that required
as little a priori information as possible. An expression of this agnostic approach was
the disuse of prior distributions. A specific choice of a prior that might be selected is a
beta distribution (or multivariate beta distribution, as appropriate) for the transition
probabilities of the HMM, to reflect the prediction that transition probabilities will be
small in magnitude compared to 1.

Efforts to reduce the dimension of parameter space are demonstrably worthwhile to

improve the robustness of inference, or to at least decrease computational cost. To
improve inference of transition probabilities and rate constants, one may wish to use
well-established literature diffusion coefficients, or compute diffusion coefficients using a
mixture model, then use these predeterminned D values to initialize the sampler to
decrease the computational time and result in higher fidelity sampling of modeled
diffusion coefficients. Or, such predetermined diffusion coefficients can be supplied to
the hidden Markov model to substantially reduce the dimensionality and computational
time of its search.

We applied our method to predict rate constants for interactions of PDK1 with
PKCα. We presented a detailed interpretation of the posterior distributions of our
model parameters. Our analysis highlights the challenge of parameter identifiability in
this context. Although the literature [10] and data including Figure 1b suggest the
existence of three diffusion states for this system, our HMM analysis provides a more
stable fit to the data for a two-state model than a three-state model. Initializing the
GWMCMC walkers with the three-state diffusion coefficients obtained from a previous
study dramatically reduced number of iterations necessary for convergence, but did not
produce a significantly better fit. Likewise, fixing the diffusion coefficients using those
obtained from a previous study resulted in further acceleration of convergence, but did
not result in less uncertainty in the extracted transition probabilities. Notably, the
three literature diffusion coefficients employed include one distinct value (D = 1.7µm2/s
corresponding to the high diffusivity PDK1 monomer state) and two smaller values
similar in magnitude (D = 0.41µm2/s and D = 0.17µm2/s corresponding to the
PDK1-PKCα heterodimer with PKCα in its shallow and deep states). The simplest

June 20, 2022

22/29

possibility is that the present approach is unable to resolve the latter two heterodimer
states. It follows that full resolution of three diffusion states would only be possible if
their diffusion coefficients were more distinct, or with a larger input data set. We did
find adequate agreement to report reasonable estimates for the first order transition
probabilities of a two-state model in which PDK1 switches between a kinetically stable
monomeric state and a kinetically stable PDK1, PKCα heterodimer. This two-state
model is sufficient to describe the kinetics of the monomer-heterodimer interconversion
and provides, to our knowledge, the first kinetic scheme for this biologically crucial
signaling reaction occurring on a membrane surface.

Although the findings of the two-state HMM analysis are better suited for

elucidating the basic kinetics of switching between simple, kinetically stable monomer
and heterodimer states, we hypothesize that the three-state HMM analysis may reveal
an additional complexity present in the monomer-heterodimer system. Specifically, in
the three-state analysis, the middle, broad diffusivity state (D2) is observed to exhibit a
range of diffusion constants that can encompass both monomer and heterodimer
diffusivities. We hypothesize this D2 state could represent an unstable rapid
interconversion state wherein PDK has a PKC nearby and is rapidly switching between
monomer (D3) and heterodimer (D1) states. When no PKC is nearby, the kinetically
stable monomer state (D3) is observed. When PDK and PKC combine with optimal
protein-protein and protein-membrane contacts, the kinetically stable heterodimer state
(D1) is observed. In the rapid interconversion state (D2) the optimal protein and
membrane contacts are not yet fully formed, leading to the rapid switching between the
unbound (monomer) and bound (heterodimer) states. Notably, the rapid
interconversion state (D2) would represent a novel, previously unobserved intermediate
state in the association reaction between two proteins on a membrane surface.
Moreover, we propose the three HMM states D1, D2 and D3 may correspond to the
slow, intermediate and fast states typically observed in running averages of total
displacement per frame vs time, as illustrated in Fig 1B above. In short, this
interpretation of the three-state HMM model still needs to be directly tested, but offers
an exciting direction for future study.

5 Acknowledgments

This research was supported in part by the NIH grants R01GM063235 and
R35GM144346 (to JJF), T32GM065103 (to MTG), R01GM126559 (to DMB) and NSF
grant 2054085 (to DMB). This work also utilized resources from the University of
Colorado Boulder Research Computing Group, which is supported by the National
Science Foundation (awards ACI-1532235 and ACI-1532236), the University of Colorado
Boulder, and Colorado State University. The authors would also like to thank Vanja
Duki´c (Department of Applied Mathematics, University of Colorado) for helpful
discussions concerning the Bayesian statistics and the sampling strategy.

References

1. Das R, Cairo CW, Coombs D. A hidden Markov model for single particle tracks
quantifies dynamic interactions between LFA-1 and the actin cytoskeleton. PLoS
Comput Biol. 2009;5(11):e1000556.

2. Banks HT, Bortz DM. Inverse Problems for a Class of Measure Dependent

Dynamical Systems. J Inverse Ill-Posed Probl. 2005;13(2):103–121.
doi:10.1515/1569394053978515.

June 20, 2022

23/29

3. Mirzaev I, Byrne EC, Bortz DM. An Inverse Problem for a Class of Conditional

Probability Measure-Dependent Evolution Equations. Inverse Probl.
2016;32(9):095005. doi:10.1088/0266-5611/32/9/095005.

4. Knight JD, Falke JJ. Single-molecule fluorescence studies of a PH domain: new

insights into the membrane docking reaction. Biophysical journal.
2009;96(2):566–582.

5. Knight JD, Lerner MG, Marcano-Vel´azquez JG, Pastor RW, Falke JJ. Single

molecule diffusion of membrane-bound proteins: window into lipid contacts and
bilayer dynamics. Biophysical journal. 2010;99(9):2879–2887.

6. Ziemba BP, Falke JJ. Lateral diffusion of peripheral membrane proteins on

supported lipid bilayers is controlled by the additive frictional drags of (1) bound
lipids and (2) protein domains penetrating into the bilayer hydrocarbon core.
Chemistry and physics of lipids. 2013;172:67–77.

7. Ziemba BP, Knight JD, Falke JJ. Assembly of Membrane-Bound Protein

Complexes: Detection and Analysis by Single Molecule Diffusion. Biochemistry.
2012;51(8):1638–1647. doi:10.1021/bi201743a.

8. Buckles TC, Ziemba BP, Masson GR, Williams RL, Falke JJ. Single-Molecule

Study Reveals How Receptor and Ras Synergistically Activate PI3Kα and PIP3
Signaling. Biophysical Journal. 2017;113(11):2396–2405.
doi:10.1016/j.bpj.2017.09.018.

9. Buckles TC, Ohashi Y, Tremel S, McLaughlin SH, Pardon E, Steyaert J, et al.

The G-Protein Rab5A Activates VPS34 Complex II, a Class III PI3K, by a Dual
Regulatory Mechanism. Biophysical Journal. 2020;119(11):2205–2218.
doi:10.1016/j.bpj.2020.10.028.

10. Gordon MT, Ziemba BP, Falke JJ. Single Molecule Studies and Kinase Activity
Measurements Reveal Regulatory Interactions between the Master Kinases
Phosphoinositide-Dependent-Kinase-1 (PDK1), Protein Kinase B (AKT1/PKB)
and Protein Kinase C (PKCα). Biophysical Journal. 2021;120(24).

11. Kusumi A, Sako Y, Yamamoto M. Confined lateral diffusion of membrane

receptors as studied by single particle tracking (nanovid microscopy). Effects of
calcium-induced differentiation in cultured epithelial cells. Biophysical journal.
1993;65(5):2021–2040.

12. Slator PJ, Burroughs NJ. A hidden Markov model for detecting confinement in
single-particle tracking trajectories. Biophysical journal. 2018;115(9):1741–1754.

13. Sch¨utz GJ, Schindler H, Schmidt T. Single-molecule microscopy on model

membranes reveals anomalous diffusion. Biophysical journal.
1997;73(2):1073–1080.

14. Yogurtcu ON, Johnson ME. Cytosolic proteins can exploit membrane localization
to trigger functional assembly. PLoS computational biology. 2018;14(3):e1006031.

15. Ziemba BP, Li J, Landgraf KE, Knight JD, Voth GA, Falke JJ. Single-molecule
studies reveal a hidden key step in the activation mechanism of membrane-bound
protein kinase C-α. Biochemistry. 2014;53(10):1697–1713.

16. Saxton MJ. Single-particle tracking: the distribution of diffusion coefficients.

Biophysical journal. 1997;72(4):1744–1753.

June 20, 2022

24/29

17. Slator PJ, Cairo CW, Burroughs NJ. Detection of diffusion heterogeneity in
single particle tracking trajectories using a hidden Markov model with
measurement noise propagation. PloS one. 2015;10(10):e0140759.

18. Qian H, Sheetz MP, Elson EL. Single particle tracking. Analysis of diffusion and
flow in two-dimensional systems. Biophysical journal. 1991;60(4):910–921.

19. Dutil EM, Toker A, Newton AC. Regulation of conventional protein kinase C
isozymes by phosphoinositide-dependent kinase 1 (PDK-1). Current Biology.
1998;8(25):1366–1375.

20. Leonard TA, R´o˙zycki B, Saidi LF, Hummer G, Hurley JH. Crystal structure and

allosteric activation of protein kinase C βII. Cell. 2011;144(1):55–66.

21. Koo PK, Weitzman M, Sabanaygam CR, van Golen KL, Mochrie SG. Extracting
diffusive states of Rho GTPase in live cells: towards in vivo biochemistry. PLoS
computational biology. 2015;11(10):e1004297.

22. Lind´en M, Elf J. Variational algorithms for analyzing noisy multistate diffusion

trajectories. Biophysical journal. 2018;115(2):276–282.

23. Elf J, Barkefors I. Single-molecule kinetics in living cells. Annual review of

biochemistry. 2019;88:635–659.

24. Falcao RC, Coombs D. Diffusion analysis of single particle trajectories in a

Bayesian nonparametrics framework. Physical biology. 2020;17(2):025001.

25. Geissen EM, Hasenauer J, Radde NE. Inference of finite mixture models and the
effect of binning. Statistical applications in genetics and molecular biology.
2019;18(4).

26. Bullerjahn JT, Hummer G. Maximum likelihood estimates of diffusion

coefficients from single-particle tracking experiments. The Journal of Chemical
Physics. 2021;154(23):234105.

27. Sitrin RG, Sassanella TM, Landers JJ, Petty HR. Migrating human neutrophils
exhibit dynamic spatiotemporal variation in membrane lipid organization.
American journal of respiratory cell and molecular biology. 2010;43(4):498–506.

28. Persson F, Lind´en M, Unoson C, Elf J. Extracting intracellular diffusive states
and transition rates from single-molecule tracking data. Nature methods.
2013;10(3):265–269.

29. Pohle J, Langrock R, van Beest FM, Schmidt NM. Selecting the number of states
in hidden Markov models: pragmatic solutions illustrated using animal movement.
Journal of Agricultural, Biological and Environmental Statistics.
2017;22(3):270–293.

30. Petrie T. Probabilistic functions of finite state Markov chains. The Annals of

Mathematical Statistics. 1969;40(1):97–115.

31. Goodman J, Weare J. Ensemble samplers with affine invariance. Communications

in applied mathematics and computational science. 2010;5(1):65–80.

32. Foreman-Mackey D, Hogg DW, Lang D, Goodman J. emcee: the MCMC hammer.
Publications of the Astronomical Society of the Pacific. 2013;125(925):306.

33. Sokal A. Monte Carlo methods in statistical mechanics: foundations and new

algorithms. In: Functional integration. Springer; 1997. p. 131–192.

June 20, 2022

25/29

34. Schwarz G, et al. Estimating the dimension of a model. Annals of statistics.

1978;6(2):461–464.

35. Saxton MJ. Single-particle tracking: connecting the dots. Nature methods.

2008;5(8):671–672.

36. Manzo C, Garcia-Parajo MF. A review of progress in single particle tracking:

from methods to biophysical insights. Reports on progress in physics.
2015;78(12):124601.

37. Casella G, Berger RL. Statistical inference. Cengage Learning; 2002.

38. Leroux BG. Maximum-likelihood estimation for hidden Markov models.

Stochastic Processes and their Applications. 1992;40(1):127–143.
doi:10.1016/0304-4149(92)90141-c.

39. Gilks R, Richardson S. Markov Chain Monte Carlo in practice. Chapman and

Hall/CRC; 1996.

40. Burnham KP, Anderson DR. Model selection and multimodel inference. vol. 2.

Springer New York; 2002.

41. Press WH, William H, Teukolsky SA, Vetterling WT, Saul A, Flannery BP.

Numerical recipes 3rd edition: The art of scientific computing. Cambridge
university press; 2007.

42. Fish KN. Total internal reflection fluorescence (TIRF) microscopy. Current

protocols in cytometry. 2009;50(1):12–18.

43. Bacallado S, Chodera JD, Pande V. Bayesian comparison of Markov models of
molecular dynamics with detailed balance constraint. The Journal of chemical
physics. 2009;131(4):07B622.

44. deLeeuw J. Introduction to Akaike (1973) Information theory and an extension of
the maximum likelihood principle. In: Breakthroughs in statistics. Springer; 1992.
p. 599–609.

45. Grinsted A. Ensemble MCMC sampler (https://github.com/grinsted/gwmcmc),

GitHub. Retrieved March 9, 2018. MATLAB Central. 2018;.

46. Saxton MJ. Lateral diffusion in a mixture of mobile and immobile particles. A

Monte Carlo study. Biophysical journal. 1990;58(5):1303–1306.

A Appendix

A.1 One Diffusive State

We’ll begin with a brief discussion of 2-D Brownian diffusion. A particle subject to 2-D
Brownian diffusion whose location is sampled N times after fixed time intervals τ will
produce a sequence of independent displacements O = (ri)N
simple Brownian diffusion, the coordinate displacements xi and yi are independent and
Normally distributed with mean 0 and variance 2Dτ . These coordinate displacements
are typically synthesized into a net displacement ri = |ri| = (cid:112)
straightforward to show that ri is Rayleigh-distributed (a rescaling of the Chi
distribution with two degrees of freedom), with pdf

i=1 with ri = (xi, yi). In

i + y2
x2

i . It’s

June 20, 2022

f (r|D, τ ) =

1
4Dτ

e−r2/(4Dτ ).

(3)

26/29

The likelihood of a given diffusion coefficient D, given an observation O is given by

L(D|O) ∝

N
(cid:89)

i=1

f (ri|D, τ ) =

1
4Dτ

(cid:32)

exp

−

(cid:33)

ri

.

1
4Dτ

N
(cid:88)

i=1

The maximum likelihood estimator of the diffusion coefficient DMLE is the value of D
that maximizes this quantity or, equivalently, the log likelihood

(cid:96)(D|O) = log (L(D|O) = −N log(Dτ ) −

1
4Dτ

N
(cid:88)

i=1

r2
i .

This function of D is maximized for

DMLE =

1
4τ N

N
(cid:88)

i=1

r2
i .

(4)

In other words, the diffusion coefficient that is best supported an observation O is
proportional to the average squared displacement. This method of analysis is typical in
the biochemistry literature and produces a formula familiar to biochemists who study
diffusion,

ssd(T ) =

N
(cid:88)

i=1

r2
i = 4DT

where ssd(T ) is the sum of squared displacements observed over a trajectory of length
T = N τ .

B Supplemental Information

B.1 MCMC Particulars

Parameter inference was performed using affine-invariant Markov Chain Monte Carlo
(GWMCMC). Initial transition probabilities and mixing coefficients were initialized
randomly, in accordance with the law of total probability. Diffusion coefficients were
likewise initialized randomly from Unif[Dmin, Dmax]. In all results presented here,
GWMCMC was performed with 200 walkers. Chain convergence was checked every 106
steps.

B.2 Results of HMM Analysis of PDK1 Trajectories

B.2.1 Tabulated 2-State HMM Results

B.2.2 Tabulated 3-State HMM Results

June 20, 2022

27/29

Fig 13. Length of GWMCMC chains, per walker. Left: 3-state models. Right: 2-state
models. Note the different in vertical scaling. Trials that did not achieve convergence
are indicated by a black ’x’.

Steps

448

636

751

650

375

ˆD1
1.4126
0.2869
0.2176
0.5228
1.2154

Traj 4

Traj 7

Traj 8

Traj 9

Traj 11

1.1304
0.2138
0.1698
0.4758
0.7326

1.6168
0.3490
0.2780
0.5753
1.5157

ˆD2
1.5024
1.5690
1.5961
1.7426
1.9203

1.2636
1.2621
1.4642
1.3730
1.3538

6.4763
2.0464
1.7513
2.3710
4.4696

ˆp12
0.0
0.0173
0.1080
0.0070
0.0480

0.0
0.0027
0.0520
0.0010
0.0

0.9487
0.0700
0.1900
0.0220
0.7310

ˆp21
0.0
0.0297
0.0239
0.0380
0.2040

0.0
0.0108
0.0099
0.0050
0.0210

0.9540
0.0676
0.0489
0.1240
0.8350

(a) Diffusion coefficients and transition probabilities.

Steps

448

636

751

650

375

ˆk12
0.0
0.87
5.4
0.35
2.4

Traj 4

Traj 7

Traj 8

Traj 9

Traj 11

0.0
0.14
2.6
0.05
0.0

47.
3.5
9.5
1.1
37.

ˆk21
0.0
1.5
1.2
1.9
10.

0.0
0.54
0.25
0.25
1.1

48.
3.4
6.2
6.2
42.

(b) First-order rate constants.

Table 10. MLEs and associated 95% confidence intervals from a 2-state HMM analysis
of PDK1 trajectories.

Steps

ˆD1

ˆD2

ˆD3

Traj 4

Traj 7

Traj 8

Traj 9

Traj 11

448

636

751

650

375

0.1682

0.1009

0.2490

1.5070

0.2172

1.6878

1.6155

1.3561

4.2285

0.2126

0.0884

0.3285

0.4989

0.2765

1.2554

1.4591

1.2576

1.7735

0.2094

0.1257

0.2780

1.5318

0.2268

1.6620

1.6318

1.4372

2.4550

0.5191

0.0781

0.5627

0.5557

0.4808

1.8561

1.7042

1.2686

3.8384

1.0840

0.5868

1.4190

1.3941

0.8561

2.7489

1.9776

1.4379

4.9190

Table 11. Diffusion coefficients estimated using a 3-state HMM obtained from analysis
of PDK1 trajectories, along with 95% credible intervals. Values are presented in units of
µm2/s.

June 20, 2022

28/29

Traj 4

Traj 7

Traj 8

Traj 9

Traj 11

Steps

448

636

751

650

375

ˆp12
0.0492
0.0250
0.0110
0.0030
0.0070

Steps

ˆp23

Traj 4

Traj 7

Traj 8

Traj 9

Traj 11

448

636

751

650

375

0.0

0.0

0.0

0.0

0.0
0.0
0.0
0.0
0.0

0.2954
0.5030
0.3610
0.5590
0.7720

0.0

0.8139

0.0

0.6980

0.0

0.8370

ˆp13
0.0199
0.0100
0.0731
0.0
0.0

ˆp31

0.0

0.0

0.0

0.0
0.0
0.0
0.0
0.0

0.1764
0.3001
0.1935
0.6010
0.5679

ˆp21
0.0120
0.1560
0.0200
0.0060
0.1220

ˆp32

0.0
0.0
0.0
0.0
0.0

0.5822
0.4760
0.6064
0.6000
0.7920

0.0

0.5445

0.0093

0.0

0.8253

0.0

0.2073

0.0100

0.0

0.6520

0.0

0.3889

0.0180

0.0

0.8460

0.0

0.6190

0.0110

0.0

0.3110

0.0

0.0

0.7270

0.0050

0.0

0.7100

0.0030

0.0

0.6560

0.0830

0.0

0.7560

Table 12. MLEs and associated 95% credible intervals for transition probabilities from
a 3-state model analysis of PDK1 trajectories.

Steps

448

636

751

650

375

Steps

448

636

751

650

375

ˆk12
2.5
1.3
0.55
0.15
0.35

ˆk23
0.0
0.0
0.0
0.0
0.25

0.0
0.0
0.0
0.0
0.0

0.0
0.0
0.0
0.0
0.0

15.
25.
18.
28.
39.

41.
35.
42.
31.
35.6

ˆk13
1.0
0.5
3.7
0.0
0.0

ˆk31
0.0
0.0
0.0
0.55
0.15

0.0
0.0
0.0
0.0
0.0

0.0
0.0
0.0
0.0
0.0

8.8
15.0
9.7
30.
28.

27.
10.
19.
16.
33.

ˆk21
0.6
7.8
1.0
0.30
6.1

ˆk32
0.47
0.50
0.90
0.0
4.2

0.0
0.0
0.0
0.0
0.0

0.0
0.0
0.0
0.0
0.0

29.
24.
30.
30.
39.

41.
33.
42.
36.
38.

Traj 4

Traj 7

Traj 8

Traj 9

Traj 11

Traj 4

Traj 7

Traj 8

Traj 9

Traj 11

Table 13. MLEs and associated 95% credible intervals for first-order rate constants
from a 3-state model analysis of PDK1 trajectories. Rate constants are reported in
units s−1.

June 20, 2022

29/29

