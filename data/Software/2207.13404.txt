Astronomy & Astrophysics manuscript no. arxiv
July 28, 2022

©ESO 2022

2
2
0
2

l
u
J

7
2

]

M

I
.
h
p
-
o
r
t
s
a
[

1
v
4
0
4
3
1
.
7
0
2
2
:
v
i
X
r
a

COMPTEL data analysis using GammaLib and ctools

J. Knödlseder1, W. Collmar2, M. Jarry1, and M. McConnell3, 4

1 Institut de Recherche en Astrophysique et Planétologie, Université de Toulouse, CNRS, CNES, 9 avenue Colonel Roche, 31028

Toulouse, Cedex 4, France

2 Max-Planck-Institut für extraterrestrische Physik, Postfach 1603, 85740 Garching, Germany
3 University of New Hampshire, Space Science Center, Durham, NH 03824, U.S.A.
4 Southwest Research Institute, Dept. of Earth, Oceans, and Space, Durham, NH. 03824, U.S.A.

Received 20 April, 2022; Accepted 3 June, 2022

ABSTRACT

More than 20 years after the end of NASA’s Compton Gamma-Ray Observatory mission, the data collected by its Imaging Compton
Telescope (COMPTEL) still provide the most comprehensive and deepest view of our Universe in MeV gamma rays. While most of
the COMPTEL data are archived at NASA’s High Energy Astrophysics Science Archive Research Center (HEASARC), the absence
of any publicly available software for their analysis means the data cannot beneﬁt from the scientiﬁc advances made in the ﬁeld
of gamma-ray astronomy at higher energies. To make this unique treasure again accessible for science, we developed open source
software that enables a comprehensive and modern analysis of the archived COMPTEL telescope data. Our software is based on a
dedicated plug-in to the GammaLib library, a community-developed toolbox for the analysis of astronomical gamma-ray data. We
implemented high-level scripts for building science analysis workﬂows in ctools, a community-developed gamma-ray astronomy
science analysis software framework. We describe the implementation of our software and provide the underlying algorithms. Using
data from the HEASARC archive, we demonstrate that our software reproduces derived data products that were obtained in the past
using the proprietary COMPTEL software. We furthermore demonstrate that our software reproduces COMPTEL science results
published in the literature. This brings the COMPTEL telescope data back into life, allowing them to beneﬁt from recent advances in
gamma-ray astronomy, and gives the community a means to unveil its still hidden treasures.

Key words. methods: data analysis – gamma rays: general – stars: neutron – binaries: general – nucleosynthesis

1. Introduction

The Imaging Compton Telescope (COMPTEL) was one of the
four telescopes aboard NASA’s Compton Gamma-Ray Obser-
vatory (CGRO) satellite, which was operated in low Earth or-
bit from April 1991 to May 2000 (Schönfelder et al. 1993).
The telescope scrutinised the gamma-ray sky in the 0.75 – 30
MeV energy range, and its observations still present the most
sensitive survey of the MeV sky ever performed. Since the end
of the CGRO mission, our view of the gamma-ray Universe
has evolved considerably, including observations of very high-
energy gamma rays from a plethora of objects and the discovery
of new source classes, such as novae, gamma-ray binaries, star-
forming regions, globular clusters, and starburst galaxies. Today,
the latest catalogue based on data from the Fermi Large Area
Telescope lists more than 5000 gamma-ray sources (Abdollahi
et al. 2020), and exploring the COMPTEL archive in light of
this knowledge has the potential to provide new insights into the
MeV sky (Collmar & Zhang 2014).

While most of the COMPTEL data accumulated during the
nine-year mission are stored at NASA’s High Energy Astro-
physics Science Archive Research Center (HEASARC)1, no
publicly available software had existed to analyse these data.
During CGRO operations the COMPTEL data were analysed
using the COMPTEL Processing and Analysis Software Sys-
tem (COMPASS) (de Vries & COMPTEL collaboration 1994),
but this system was only available at the COMPTEL collabora-
tion institutes and was decommissioned after the end of the mis-

1 https://heasarc.gsfc.nasa.gov/docs/cgro/archive/

sion. Nevertheless, a few science results were still obtained from
COMPTEL data after the end of the mission thanks to eﬀorts
at some COMPTEL collaboration institutes to keep Linux ports
of the COMPASS data-analysis system alive (Strong & Collmar
2019; Coleman & McConnell 2020).

In order to preserve the capability to analyse the unique
COMPTEL archive and to make COMPTEL data analysis ac-
cessible to the astronomical community at large, we have im-
plemented a dedicated COMPTEL plug-in for the GammaLib
library, a community-developed toolbox for the analysis of as-
tronomical gamma-ray data (Knödlseder et al. 2011). The plug-
in enables a reanalysis of COMPTEL data from the HEASARC
archive, including the computation of the COMPTEL instru-
ment response functions that until now had not been publicly
available. The plug-in beneﬁts from generic data analysis capa-
bilities provided by GammaLib, including the joint maximum-
likelihood ﬁtting of multiple energy bands and the combination
of COMPTEL data with data from other gamma-ray telescopes,
enabling novel analysis approaches that go beyond the capabili-
ties of the COMPASS system.

We furthermore extended the ctools gamma-ray astronomy
science analysis software (Knödlseder et al. 2016) with the ad-
dition of several dedicated Python scripts. These scripts provide
basic building blocks that each perform well-deﬁned COMPTEL
data analysis tasks. These building blocks can be combined to
create ﬂexible COMPTEL data analysis workﬂows for the ex-
ploration of the MeV sky.

In this paper we present the GammaLib plug-in and the
ctools COMPTEL science analysis scripts, including the algo-

Article number, page 1 of 31

 
 
 
 
 
 
A&A proofs: manuscript no. arxiv

rithms that were implemented, so that any science analysis that
makes use of the software has a solid reference. We demonstrate
that COMPTEL data analysis products derived using GammaLib
and ctools, such as data cubes and response functions, are iden-
tical to equivalent products produced with the COMPASS soft-
ware. We show that the background model that is implemented
in GammaLib and ctools provides a reliable description of the
COMPTEL instrumental background, and we discuss potential
biases and limitations. Finally, we apply the software to a num-
ber of science cases and demonstrate that our software repro-
duces results published in the literature. All the algorithms and
results presented in this paper were produced with GammaLib
and ctools version 2.0.0. The analysis scripts and data presented
in this work are available for download from Zenodo.2

2. The COMPTEL telescope

Before describing the software implementation, we recall some
COMPTEL fundamentals that are important for understanding
the remainder of the paper. COMPTEL was an imaging spec-
trometer that was sensitive to gamma rays in the energy range
0.75 – 30 MeV with an energy-dependent energy and angular
resolution of 5 − 8% (full width half maximum) and 1.7◦ − 4.4◦
(full width half maximum), respectively. The telescope had a
large ﬁeld of view of about one steradian and was sensitive to
detected gamma-ray sources at a 1 − 30 MeV ﬂux level of 10−9
erg cm−2 s−1 within an observing time of 106 s (Schönfelder
et al. 1993).

COMPTEL was composed of two modular detector layers
D1 and D2, separated by 158 cm, where an incident gamma-ray
photon was ﬁrst Compton scattered in one of the 7 modules of
D1 and then eventually interacted in one of the 14 modules of
D2. The Compton scatter direction (χ, ψ) was obtained from the
interaction locations in D1 and D2, the Compton scattering angle
¯ϕ was computed from the measured energy deposits E1 and E2
in D1 and D2, respectively, using
(cid:33)(cid:33)

(cid:32)

(cid:32)

¯ϕ = arccos

1 − mec2

,

(1)

1
E2

−

1
E

where E = E1 + E2 is the total energy deposit in the detectors,
and mec2 = 0.511 MeV is the rest energy of the electron.

The detector layers were surrounded by an active anti-
coincidence shield, composed of two veto domes for each layer,
that allowed for the reduction of instrumental background3 due
to charged particles. A further strong discriminator of instru-
mental background was the time of ﬂight (ToF) measurement,
which is the time diﬀerence between the interactions in D1 and
D2 (cf. Sect. 3.3).

COMPTEL data were often analysed in four standard energy
bands, covering 0.75 − 1, 1 − 3, 3 − 10 and 10 − 30 MeV, and if
not otherwise stated, the same energy bands will be adopted in
the present paper. Event selection parameters used in this paper
are discussed in Sect. 3.3.

3. Software implementation

3.1. GammaLib plug-in

The COMPTEL support was implemented in GammaLib as an
instrument plug-in that provides instrument-speciﬁc implemen-
tations of abstract virtual C++ base classes deﬁning the data

2 https://doi.org/10.5281/zenodo.6462842
3 Throughout this paper we denote by instrumental background all
events that are not related to celestial gamma-ray emission.

Article number, page 2 of 31

format and the instrument response functions. The plug-in also
comprises wrapper functions providing access to all COMPTEL-
speciﬁc C++ classes through the gammalib Python module. All
COMPTEL-speciﬁc classes begin with the letters GCOM.

3.2. COMPTEL data

COMPTEL data are available in the HEASARC archive and are
grouped by so-called viewing periods with typical durations of
two weeks during which the CGRO satellite had a stable point-
ing. In total, the HEASARC archive contains 255 exploitable
viewing periods, which is about 71% of the total number of 359
viewing periods that were executed by COMPTEL.4 All data are
provided in FITS format.

The input data that are relevant to GammaLib for a given
viewing period are event ﬁles, good time intervals, and orbit as-
pect data. The orbit aspect data comprise satellite orbit and tele-
scope pointing information that are needed for coordinate trans-
formations. COMPTEL data types are identiﬁed by a three-letter
code, which is EVP for event ﬁles, TIM for good time intervals,
and OAD for orbit aspect data. Each viewing period comprises a
single EVP and TIM ﬁle, OAD ﬁles are provided per day. EVP data
are handled by the GammaLib class GCOMEventList, TIM data
by GCOMTim, and OAD data by GCOMOad and GCOMOads, where
GCOMOad implements a single OAD record (or superpacket), and
GCOMOads implements a collection of OAD records. These data
structures are combined in an unbinned COMPTEL observation,
implemented by the GammaLib class GCOMObservation. To
construct an unbinned COMPTEL observation, the input data
for a viewing period can be speciﬁed either by their ﬁle names
or via a so-called observation deﬁnition XML ﬁle.

The HEASARC archive mixes diﬀerent versions of EVP ﬁles
that have diﬀerent levels of processing for the ToF values. Gam-
maLib will automatically correct for these diﬀerences, assuring
that ToF values accessed through GammaLib are always ToFIII
values (see Appendix B).

3.3. Event cubes

COMPTEL data analysis is performed on binned event data us-
ing three-dimensional event cubes spanned by the Compton scat-
ter direction (χ, ψ) and the Compton scattering angle ¯ϕ. The bin-
ning is performed for events within a given interval of total en-
ergy, and each energy interval is treated as an individual COMP-
TEL observation. Combining multiple energy intervals for spec-
tral analysis can be achieved by collecting the relevant COMP-
TEL observations in an observation container. The same holds
for the combination of multiple viewing periods for a joint max-
imum likelihood analysis.

The COMPTEL data space is implemented by the GCOMDri
class, and the GCOMDri::compute_dre method bins the events
found in an EVP ﬁle into an event cube. In this process, event
selection parameters are speciﬁed through the GCOMSelection
class, comprising selection intervals for D1 energy deposit, D2
energy deposit, ToF channel value, pulse shape discriminator
(PSD) channel value, rejection ﬂag and veto ﬂag. Standard event
selection parameters that were used throughout this paper are
summarised in Table 1.

4 Some viewing periods in the HEASARC archive are unreadable, and
data from the end of the mission were not archived. Details about issues
encountered in the HEASARC COMPTEL data archive are provided in
Appendix A.

J. Knödlseder et al.: COMPTEL data analysis using GammaLib and ctools

Table 1. Standard event selection parameters that are suitable for most
analysis situations and that were used throughout this paper.

Parameter
D1 energy deposit
D2 energy deposit
ToF value
PSD value
Rejection ﬂag
Veto ﬂag

Minimum Maximum
20 MeV
30 MeV
130
110
1000
0

70 keV
650 keV
115
0
1
0

Notes. ToF channel values are given in units of 0.25 ns.

Fig. 1. Time of ﬂight spectrum of COMPTEL events registered during
ground calibration (left) and in orbit (right). One ToF channel corre-
sponds to 0.25 ns. Downward moving photons interacting ﬁrst in D1
and then in D2 lead to a peak around channel 120, while upward mov-
ing photons interacting ﬁrst in D2 and then in D1 produce a peak around
channel 80. In the calibration data the upward moving photons can be
clearly distinguished from the downward moving photons, while in the
ﬂight data the downward moving photons are blended with the tail of
the dominating upward moving photons. The ﬁgure is adapted from
Knödlseder (1994).

The ToF value measures the time between the interaction of
the photons in the D1 and D2 modules, and provides a strong
discriminator against instrumental background. Figure 1 illus-
trates that the ToF distribution of the events shows two distinct
features: a forward peak associated with celestial photons that
ﬁrst interact in D1 followed by an interaction in D2, and a back-
ground peak due to events arising from a ﬁrst interaction in D2
followed by an interaction in D1. While both peaks were clearly
distinguishable in calibration data taken on ground (left panel of
Fig. 1), they are heavily blended in orbit due to the dominance
of upward moving background events (right panel of Fig. 1). Se-
lecting only events from the forward peak considerably improves
the signal-to-noise ratio, and Fig. 1 illustrates that the minimum
ToF value has a strong impact on the background discrimination,
with larger values removing more background at the expense of
rejecting also an increasing number of celestial photons.

To correct for the photon rejection by the ToF selection an
energy-dependent correction factor is applied to the instrument
response. This ToF correction is performed internally by Gam-
maLib (see Appendix C for details). Consequently, ﬂux values
returned by GammaLib are always corrected for ToF selection,
in contrast to the COMPASS system where the correction had to
be applied by the user posterior to the analysis.

An additional, but less important, event selection parameter
is the PSD value, which discriminates between neutron and pho-

ton interactions in D1, with gamma rays found around channel
80 and neutron-induced events above channel 100 (Schönfelder
et al. 1993). By default, the PSD selection interval is suﬃciently
large so that no ﬂux correction factor needs to be applied, yet
more stringent selection intervals that lead to improved perfor-
mance (Collmar et al. 1997) eventually require the application
of a PSD selection correction factor that is not implemented in
GammaLib.

Furthermore, the Earth atmosphere being a strong gamma-
ray source, an important background reduction is obtained by
excluding events that may originate from the Earth atmosphere.
This is achieved by requiring that event circles have a minimum
angular distance ζmin from the Earth horizon. In the process of
event binning, this requirement is translated into a constraint on
the so-called Earth horizon angle (EHA), which is deﬁned as the
angular distance between the scatter direction of an event and
the Earth horizon. Speciﬁcally, only the events are retained that
satisfy EHA ≥ EHAmin( ¯ϕ) with

EHAmin( ¯ϕ) = ¯ϕmin + ζmin,

(2)

where ¯ϕmin is the lower boundary of the event cube layer that
comprises the Compton scattering angle ¯ϕ. By default, ζmin = 5◦.
Event selection and binning in GammaLib is done per super-
packet, which is a bunch of eight spacecraft telemetry packets of
16.384 s duration that deﬁne the temporal granularity on which
spacecraft orbital data information is available. Orbital data per
superpacket are provided by the orbit aspect data (OAD) ﬁles, and
events will be used only if their times are contained in the valid-
ity interval of any of the available superpackets. Furthermore, su-
perpackets are considered valid only if their start and stop times
are fully enclosed in one of the good time intervals, speciﬁed by
the TIM ﬁle.5

Finally, the GCOMSelection class also supports the speciﬁ-
cation of phase intervals, so that events can be selected accord-
ing to the orbital phase of a gamma-ray binary or the rotational
phase of a pulsar. Owing to the diﬀerent timescales involved, the
handling of orbital phases diﬀers from that of pulsar phases. For
orbital phases, the phase as a function of event time is deﬁned via
an instance of the GModelTemporalPhaseCurve class, and the
phase selection is done at the level of superpackets, implying that
only orbital periods that are signiﬁcantly longer than the super-
packet duration of 16.384 s will produce meaningful results. We
illustrate this capability below by a phase-resolved analysis of
the gamma-ray binary LS 5039 (cf. Sect. 4.3). For pulsar phases,
the phase selection is done at the level of individual events, using
pulsar ephemerides and a Solar System barycentre time correc-
tion that is applied to the onboard time of the events. Details of
the implementation are given in Appendix D, and we illustrate
this capability below by a phase-resolved analysis of the Crab
pulsar and pulsar wind nebula (cf. Sect. 4.2.2).

Only events for modules that are signalled as active are
considered for the event binning. The detector module status
is provided by the GCOMStatus class that relies on a database
of daily status values that is provided with GammaLib. During
the COMPTEL operations a certain number of photomultiplier
tubes (PMTs) of the D2 modules failed, degrading the localisa-
tion precision of the event interactions in the respective mod-
ules. One option is to exclude these modules from the analysis,

5 We note that COMPTEL times are speciﬁed by two values: the trun-
cated Julian days (TJD), which is deﬁned as the number of modiﬁed
Julian days (MJD) minus 40 000, and the COMPTEL tics, which are
1/8 milliseconds long. As an example, TJD = 8393 and zero tics corre-
sponds to 1991-05-17T00:00:00 UT.

Article number, page 3 of 31

050100150200250ToF channel0500010000150002000025000Number of eventsGround calibration050100150200250ToF channel05000100001500020000Number of eventsIn orbitA&A proofs: manuscript no. arxiv

reducing the number of available events by about 25%. Alter-
natively, events from zones around the faulty PMTs can be ex-
cluded in the analysis, allowing recovery of a large fraction of the
events for the analysis. Both analysis options are implemented in
GammaLib (see Appendix E) and are explored in the analysis of
LS 5039 (cf. Sect. 4.3).

COMPTEL event cubes are stored as three-dimensional
FITS images with the ﬁle type designation DRE. Projections of
an event cube generated using GammaLib for viewing period
2.06 and total energies in the interval 1 − 3 MeV are shown in
Fig. 2 where for comparison the projections of an equivalent DRE
obtained using the COMPASS software are shown. The projec-
tions of the datasets are nearly indistinguishable, illustrating that
the event cubes generated by GammaLib are equivalent to those
produced by the COMPASS software.

direction for a given superpacket i. The fraction accounts for the
increased interaction length of oﬀ-axis photons within the D1
modules, where τ = 0.2 is the typical thickness of a D1 module
in radiation lengths. The sum is taken over all superpackets {S }
that satisfy the same selection criteria that were applied to the
event selection (cf. Sect. 3.3).

The exposure map is given in units of cm2s and is stored
as a two-dimensional FITS image with the ﬁle type designation
DRX. For illustration, Fig. 3 compares projections of the DRX ob-
tained by GammaLib for viewing period 2.0 to the projections
for an equivalent DRX that was obtained by COMPASS. The pro-
jections of the datasets are indistinguishable, illustrating that the
exposure maps generated by GammaLib are equivalent to those
produced by the COMPASS software.

3.4. Instrument response function

3.4.1. Factorisation

The COMPTEL instrument response function, given in units of
events cm2 photons−1, is factorised using

R(χ, ψ, ¯ϕ|α, δ, Eγ) = L
T

DRX(α, δ) DRG(χ, ψ, ¯ϕ) IAQ( ¯ϕ|ϕgeo, Eγ)
T

,

(3)

where DRX(α, δ) is the exposure in units of cm2s towards a given
celestial direction (α, δ), DRG(χ, ψ, ¯ϕ) is a geometry function that
speciﬁes the probability that a photon that was scattered in one
of the D1 modules into direction (χ, ψ) will encounter one of
the active D2 modules (the term also accounts for the Earth
horizon event selection, which introduces the ¯ϕ dependence),
IAQ( ¯ϕ|ϕgeo, Eγ) is the probability that a gamma-ray photon with
energy Eγ being Compton scattered in D1 interacts in D2, with
ϕgeo = arccos (sin ψ sin δ + cos ψ cos δ cos(χ − α))

(4)

being the angular separation between (χ, ψ) and (α, δ), L is the
livetime in units of s, and T is the exposure time in units of s.

The fraction L/T is the so-called deadtime correction factor,
specifying the fraction of time during which the telescope is able
to register events. For COMPTEL this fraction is rather constant
and was determined by van Dijk (1996) to be L/T = 0.965. This
value is hardcoded in GammaLib, and automatically applied to
all analysis results.

3.4.2. Exposure

The exposure map DRX(α, δ) is computed in GammaLib by the
method GCOMDri::compute_drx using

where Tsp = 16.384 s is the duration of a superpacket and
r1 = 13.8 cm is the radius of a D1 module. The cos θi factor
takes into account the reduction of the eﬀective D1 surface when
viewed from an oﬀ-axis direction θi, measured as the angle be-
tween the celestial direction (α, δ) and the COMPTEL pointing

6 We have chosen the second viewing period in the HEASARC archive
to illustrate the data cube comparisons in our paper since for the ﬁrst
viewing period we encountered percent-level diﬀerences that are plau-
sibly attributed to diﬀerences in our and the COMPASS processing con-
ﬁguration that we were not able to track down.

Article number, page 4 of 31

3.4.3. Geometry function

The geometry function DRG(χ, ψ, ¯ϕ) is the probability that a pho-
ton that was scattered in one of the D1 modules towards the di-
rection (χ, ψ) will encounter one of the active modules of D2. It
is computed by determining the geometrical area of the shadow
of the D1 modules that is cast on the D2 modules relative to
the total area of all seven D1 modules as a function of the scat-
ter direction. Optionally, zones around failed D2 module PMTs
can be excluded during this computation. The geometry function
also accounts for the Earth horizon event selection, which intro-
duces a ¯ϕ dependence in the probabilities. As the position of the
Earth with respect to the telescope changes continuously, the ge-
ometry function is recomputed for each superpacket, and the re-
sults are then averaged to provide an eﬀective geometry function
that applies to a given event cube. Similar to the computation of
the exposure map, the superpackets {S } considered are those that
satisfy the same selection criteria that were applied to the event
selection. Details are provided in Appendix F.

The computation of the geometry function is implemented
in the method GCOMDri::compute_drg and results are stored
as three-dimensional FITS images with the ﬁle type designa-
tion DRG. Figure 4 illustrates the result of the geometry function
computation, again in the form of projections for viewing period
2.0. Equivalent projections for a geometry function obtained us-
ing the COMPASS system are superimposed. The projections of
the datasets are indistinguishable, illustrating that the geometry
functions generated by GammaLib are equivalent to those pro-
duced by the COMPASS software.

3.4.4. Compton scattering probabilities

The Compton scattering probabilities IAQ( ¯ϕ|ϕgeo, Eγ) were com-
puted employing the method GCOMIaq::set using

Peﬀ(ϕ(cid:48)

geo, Eγ) × PKN(ϕ(cid:48)

geo, Eγ) ×

RD1(E1| ˆE1) RD2(E2| ˆE2) J( ¯ϕ|E1) dE1×

(cid:90) ϕgeo,max

ϕgeo,min
(cid:90) Emax
1

Emin
1
K(ϕ(cid:48)

geo|ϕgeo, θ) dϕ(cid:48)

geo

,
(6)

geo, Eγ) is an eﬃciency factor that is detailed in
where Peﬀ(ϕ(cid:48)
Appendix G.1, PKN(ϕ(cid:48)
geo, Eγ) is the contribution of the Klein-
Nishina cross-section to a given bin in ϕ(cid:48)
geo that is detailed in
Appendix G.2, and RD1(E1| ˆE1) and RD2(E2| ˆE2) are the energy
response functions of the D1 and D2 modules, respectively, that

DRX(α, δ) = Tsp

(cid:88)

i∈{S }

7πr2

1 cos θi

1 − exp (−τ/ cos θi)
1 − exp (−τ)

,

IAQ( ¯ϕ|ϕgeo, Eγ) =

(5)

J. Knödlseder et al.: COMPTEL data analysis using GammaLib and ctools

Fig. 2. Comparison of an event cube generated with GammaLib for viewing period 2.0 and the 1 − 3 MeV energy band (red solid) and the
equivalent event cube MPE-DRE-50607 produced by the COMPASS software (blue dashed). The left panel shows the distribution of χ values,
obtained by summing over all ψ and ¯ϕ, the middle panel shows the distribution of ψ values, obtained by summing over all χ and ¯ϕ, and the right
panel shows the distribution of ¯ϕ values, obtained by summing over all χ and ψ.

to ( ˆE1, ˆE2) is done using

ˆE2 =

Eγ
geo) Eγ
(1 − cos ϕ(cid:48)
mec2

+ 1

and ˆE1 = Eγ − ˆE2;



E2 = 1
2

(cid:115)

×

4mec2E1
1 − cos ¯ϕ

+ E2

1 − E1





(7)

(8)

gives the D2 energy deposit as a function of the D1 energy de-
posit (E1) and the Compton scattering angle ( ¯ϕ), and

J( ¯ϕ|E1) =

mec2

(1 − cos ¯ϕ)2

√

E1 sin ¯ϕ
(cid:113)
4mec2
1−cos ¯ϕ

+ E1

(9)

the variable

Jacobian for

transformation. Here
the
is
K(ϕ(cid:48)
geo|ϕgeo, θ) is a Gaussian kernel that provides some smearing
of the response in ϕgeo to take into account the event location
uncertainties in the D1 and D2 modules. The kernel formally
depends on the zenith angle θ of the incoming gamma-ray
photons. However, the IAQ is assumed independent of θ, and
hence the kernel will be computed for an average zenith angle
of θ = 25◦ (see Appendix G.4 for details).

The Compton scattering probabilities are stored as a two-
dimensional FITS image with the ﬁle type designation IAQ. For
illustration, Fig. 5 compares projections of the Compton scat-
tering probabilities obtained by GammaLib for the energy band
1 − 3 MeV to the projections for an equivalent ﬁle that was
obtained using COMPASS. Both projections are indistinguish-
able, and the same is true for the other energy bands that were
investigated. As demonstrated, the GammaLib implementation
accurately reproduces the response computations that were im-
plemented in COMPASS. We note that the implementation of
the COMPTEL response computation within GammaLib is cru-
cial for the preservation of COMPTEL data analysis capabilities,
since response functions are lacking in the HEASARC archive.
In addition to the internal response computation, GammaLib also
includes several response functions that were derived using sim-
ulations (Stacy et al. 1996), and that can be used as an alternative
to the internally computed response functions.

3.5. Background modelling
A considerable eﬀort was undertaken by the COMPTEL collab-
oration to understand and model the instrumental background

Article number, page 5 of 31

Fig. 3. Comparison of an exposure map obtained with GammaLib for
viewing period 2.0 (red solid) to the exposure map MPE-DRX-32302
obtained with COMPASS (blue dashed). The upper panel shows the
distribution of Galactic longitude values, obtained by summing over all
Galactic latitudes, and the lower panel shows the distribution of Galactic
latitude values, obtained by summing over all Galactic longitudes.

are detailed in Appendix G.3. The transformation from (ϕ(cid:48)

geo, Eγ)

0204060χ (deg)0100020003000400050006000Arbitrar  unitsχ distributionGammaLibCOMPASS0204060ψ (deg)01000200030004000500060007000Arbitrar  unitsψ distributionGammaLibCOMPASS01020304050̄φ (deg)025005000750010000125001500017500Arbitrar  units̄φ distributionGammaLibCOMPASS050100150200250300350Galactic longit de (deg)0.00.51.01.52.02.53.03.5Arbitrary  nits1e11GammaLibCOMPASS−75−50−250255075Galactic latit de (deg)0.00.51.01.52.02.53.03.5Arbitrary  nits1e11GammaLibCOMPASSA&A proofs: manuscript no. arxiv

Fig. 4. Comparison of a geometry function obtained with GammaLib for viewing period 2.0 (red solid) to the geometry function MPE-DRG-35128
obtained with COMPASS (blue dashed). The left panel shows the distribution of χ values, obtained by summing over all ψ and ¯ϕ, the middle
panel shows the distribution of ψ values, obtained by summing over all χ and ¯ϕ, and the right panel shows the distribution of ¯ϕ values, obtained by
summing over all χ and ψ.

Fig. 5. Comparison of projections of an IAQ obtained with GammaLib for the energy band 1 − 3 MeV (red solid) to projections for ROL-IAQ-755
obtained with COMPASS (blue dashed). The left panel shows the distribution of ϕgeo values, obtained by summing over all ¯ϕ, the middle panel
shows the distribution of ¯ϕ values, obtained by summing over all ϕgeo, and the right panel shows angular resolution measure ¯ϕ − ϕgeo.

in the three-dimensional COMPTEL data space (e.g. Bloemen
et al. 1994; Knödlseder 1994; van Dijk 1996; Weidenspoint-
ner et al. 2001). Satisfactory, although not perfect, results were
obtained using the so-called SRCLIX method that was devel-
oped by Bloemen et al. (1994) and that has undergone sev-
eral evolutions (van Dijk 1996). The SRCLIX method iter-
atively applies the BGDLIX algorithm, of which we imple-
mented two variants in GammaLib. For reference, we also imple-
mented the PHINOR algorithm (described below), and all back-
ground modelling methods are invoked in GammaLib via the
GCOMObservation::compute_drb method. The iterative SR-
CLIX method is implemented as a ctools script (cf. Sect. 3.6).

3.5.1. PHINOR

The motivation for the PHINOR algorithm is the observation that
the ratio of DRE and DRG multiplied by the solid angle Ω(χ, ψ) of
the event cube bins is to ﬁrst order independent of χ and ψ. This
leads to a background model given by

DRBphinor(χ, ψ, ¯ϕ) = DRG(χ, ψ, ¯ϕ) Ω(χ, ψ) ×
(cid:80)

χ(cid:48),ψ(cid:48) DRE(χ(cid:48), ψ(cid:48), ¯ϕ) − DRM(χ(cid:48), ψ(cid:48), ¯ϕ))
χ(cid:48),ψ(cid:48) DRG(χ(cid:48), ψ(cid:48), ¯ϕ) Ω(χ(cid:48), ψ(cid:48))

(cid:80)

,

(10)

where

DRM(χ(cid:48), ψ(cid:48), ¯ϕ) =

(cid:90)

α,δ,Eγ

I(α, δ, Eγ) R(χ(cid:48), ψ(cid:48), ¯ϕ|α, δ, Eγ) dα dδ dEγ

(11)

Article number, page 6 of 31

is the convolution of a model of celestial sources I(α, δ, Eγ)
with the instrument response function used to subtract any
source contribution from the data before normalisation. The
evaluation of DRM(χ(cid:48), ψ(cid:48), ¯ϕ) is implemented by the method
GCOMObservation::drm.

Despite its simplicity, the PHINOR algorithm yields gener-
ally empty residual maps above 10 MeV. However, for lower
energies signiﬁcant large-scale residuals are frequently observed
(van Dijk 1996).

3.5.2. BGDLIXA

The BGDLIXA algorithm applies a correction to the PHINOR
background model by adjusting ¯ϕ templates TPL(χ, ψ, ¯ϕ) over a
limited interval of ¯ϕ values to a normalisation function n(χ, ψ, ¯ϕ)
that reﬂects the background event distribution DRE(χ, ψ, ¯ϕ) −
DRM(χ, ψ, ¯ϕ) smoothed in χ and ψ using a running average (see
below). The BGDLIXA algorithm evaluates the expression

DRB(cid:48)

bgdlixa(χ, ψ, ¯ϕ) = TPL(χ, ψ, ¯ϕ)

(cid:80)

(cid:80)

¯ϕ(cid:48)∈{R ¯ϕ} n(χ, ψ, ¯ϕ(cid:48))
¯ϕ(cid:48)∈{R ¯ϕ} TPL(χ, ψ, ¯ϕ(cid:48))

,

(12)

where the summation is performed over the range R ¯ϕ = [ ¯ϕ −
∆ ¯ϕincl, ¯ϕ−∆ ¯ϕexcl]∪[ ¯ϕ+∆ ¯ϕexcl, ¯ϕ+∆ ¯ϕincl] with ∆ ¯ϕincl = ∆ ¯ϕ(cid:98)(Nincl−
1)/2(cid:99), ∆ ¯ϕexcl = ∆ ¯ϕ(cid:98)(Nexcl − 1)/2(cid:99), Nincl and Nexcl are either odd
integers or zero, and (cid:98)·/·(cid:99) designates the integer division opera-
tor. ∆ ¯ϕ is the bin size in ¯ϕ of the three-dimensional event cube,
which typically is 2◦. While in early days Nexcl > 0 was used,
later analyses set Nexcl = 0, which simpliﬁes the summation
range to R ¯ϕ = [ ¯ϕ − ∆ ¯ϕincl, ¯ϕ + ∆ ¯ϕincl]. Past COMPTEL analy-
ses generally used Nincl = 13 resulting in R ¯ϕ = [ ¯ϕ − 12◦, ¯ϕ + 12◦].

0204060χ (deg)050100150200250300Arbitrary unitsχ distributionGammaLibCOMPASS0204060ψ (deg)050100150200250300Arbitrary unitsψ distributionGammaLibCOMPASS01020304050̄φ (deg)300350400450500Arbitrary units̄φ distributionGammaLibCOMPASS01020304050φgeo (deg)0.00000.00020.00040.00060.00080.00100.00120.0014Arbitrary  nitsφgeo distrib tionGammaLibCOMPASS01020304050̄φ (deg)0.00000.00020.00040.00060.00080.00100.0012Arbitrary  nits̄φ distrib tionGammaLibCOMPASS−40−2002040̄φ−φgeo (deg)0.0000.0020.0040.0060.008Arbitrary  nits̄φ−φgeo distrib tionGammaLibCOMPASSJ. Knödlseder et al.: COMPTEL data analysis using GammaLib and ctools

Fig. 6. Comparison of PHINOR (blue dotted), BGDLIXA (dark green dashed), and BGDLIXE (light green dashed-dotted) background model
for viewing period 1.0 and the energy band 1 − 3 MeV to the DRE event distribution (red solid). The left panel shows the distribution of χ values,
obtained by summing over all ψ and ¯ϕ, the middle panel shows the distribution of ψ values, obtained by summing over all χ and ¯ϕ, and the right
panel shows the distribution of ¯ϕ values, obtained by summing over all χ and ψ.

As we will see later, Nincl is the most critical parameter of the
BGDLIXA algorithm, and speciﬁes the number of ¯ϕ layers of
the three-dimensional event cube over which the templates are
adjusted. If Nincl is large the fraction in Eq. (12) varies little with
¯ϕ, leading to a background model that essentially follows the
templates. For small values of Nincl the fraction in Eq. (12) ac-
commodates for diﬀerences between the templates and the nor-
malisation function, leading to a background model that follows
more closely the background event distribution at the expense of
including also some of the source events.
The ¯ϕ templates are computed using

TPL(χ, ψ, ¯ϕ) = DRBphinor(χ, ψ, ¯ϕ) ×

(cid:80)

(cid:80)

(cid:80)

χ(cid:48)∈{Rχ}
(cid:80)

ψ(cid:48)∈{Rψ}
(cid:80)

χ(cid:48)∈{Rχ}

ψ(cid:48)∈{Rψ}

¯ϕ(cid:48) DRE(χ(cid:48), ψ(cid:48), ¯ϕ(cid:48)) − DRM(χ(cid:48), ψ(cid:48), ¯ϕ(cid:48))
¯ϕ(cid:48) DRBphinor(χ(cid:48), ψ(cid:48), ¯ϕ(cid:48))

(cid:80)

,

(13)

which are an adjustment of the PHINOR background model to
match the ¯ϕ-integrated χ, ψ distribution of the data after sub-
tracting the contributions of celestial sources. To reduce the
impact of statistical ﬂuctuations of the data on the model, the
match is performed by a running-average summation over a
small range in χ and ψ, with Rχ = [χ − ∆χrunav, χ + ∆χrunav]
and Rψ = [ψ − ∆ψrunav, ψ + ∆ψrunav] where ∆χrunav = ∆χ Nrunav
and ∆ψrunav = ∆ψ Nrunav. Here, 2Nrunav + 1 speciﬁes the number
of χ and ψ bins over which the running-average summation is
performed, with ∆χ and ∆ψ being the bin size in χ and ψ of the
three-dimensional event cube, and Nrunav is an integer number.
Usually, ∆χ = ∆ψ = 1◦, and past analyses employed Nrunav = 3
resulting in a running averaging of ±3◦ around each χ, ψ pixel
(van Dijk 1996).

The adjustment of the ¯ϕ templates is done using a normali-

sation function computed using

n(χ, ψ, ¯ϕ(cid:48)) = DRG(χ, ψ, ¯ϕ(cid:48)) Ω(χ, ψ) ×
(cid:80)

(cid:80)

χ(cid:48)∈{Aχ}
(cid:80)

ψ(cid:48)∈{Aψ} DRE(χ(cid:48), ψ(cid:48), ¯ϕ(cid:48)) − DRM(χ(cid:48), ψ(cid:48), ¯ϕ(cid:48))
ψ(cid:48)∈{Aψ} DRG(χ(cid:48), ψ(cid:48), ¯ϕ(cid:48)) Ω(χ(cid:48), ψ(cid:48))

(cid:80)

χ(cid:48)∈{Aχ}

,

(14)

which is an analogue of Eq. (10) that is limited to a small
range of χ, ψ around the pixel of interest. Speciﬁcally, Aχ =
[χ − ∆χavgr, χ + ∆χavgr] and Aψ = [ψ − ∆ψavgr, ψ + ∆ψavgr] where
∆χavgr = ∆χ (cid:98)(Navgr − 1)/2(cid:99) and ∆ψavgr = ∆ψ (cid:98)(Navgr − 1)/2(cid:99).
Here, Navgr is an odd integer that speciﬁes the number of χ and
ψ bins over which the adjustment is performed, with ∆χ and ∆ψ
being the bin size in χ and ψ of the three-dimensional event cube.

Past analyses usually employed Navgr = 3 resulting in an averag-
ing of Aχ = [χ − 1◦, χ + 1◦] and Aψ = [ψ − 1◦, ψ + 1◦] (van Dijk
1996).

We want to point out that the COMPASS analysis system

implemented

n(χ, ψ, ¯ϕ(cid:48)) = DRG(χ, ψ, ¯ϕ(cid:48)) Ω(χ, ψ) ×

(cid:88)

(cid:88)

χ(cid:48)∈{Aχ}

ψ(cid:48)∈{Aψ}

DRE(χ(cid:48), ψ(cid:48), ¯ϕ(cid:48))
DRG(χ(cid:48), ψ(cid:48), ¯ϕ(cid:48)) Ω(χ(cid:48), ψ(cid:48))

(15)

instead of Eq. (14), which can lead to unreasonably large normal-
isations at the edge of the three-dimensional event cube where
DRG values are small. Using Eq. (14) avoids such problems, and
in fact leads to a simpliﬁed background modelling algorithm that
we implemented in GammaLib under the acronym BGDLIXE
(see below). Furthermore, we added a global ¯ϕ normalisation
step,
DRBbgdlixa(χ, ψ, ¯ϕ) = DRB(cid:48)

bgdlixa(χ, ψ, ¯ϕ) ×
χ(cid:48),ψ(cid:48) DRE(χ(cid:48), ψ(cid:48), ¯ϕ) − DRM(χ(cid:48), ψ(cid:48), ¯ϕ))

(cid:80)

(cid:80)

χ(cid:48),ψ(cid:48) DRB(cid:48)

bgdlixa(χ(cid:48), ψ(cid:48), ¯ϕ)

,

(16)

at the end of the computation so that the model is normalised to
the number of background events in each ¯ϕ layer.

3.5.3. BGDLIXE

Recognising that Eqs. (13) and (14) both do the same thing (that
is, they normalise the solid-angle-weighted geometry function
to the measured event distribution), the BGDLIX background
model can be simpliﬁed to

DRB(cid:48)

bgdlixe(χ, ψ, ¯ϕ) = DRBphinor(χ, ψ, ¯ϕ) ×
ψ(cid:48)∈{Aψ}
(cid:80)

χ(cid:48)∈{Aχ}
(cid:80)

(cid:80)

(cid:80)

(cid:80)

(cid:80)

¯ϕ(cid:48)∈{R ¯ϕ} DRE(χ(cid:48), ψ(cid:48), ¯ϕ(cid:48)) − DRM(χ(cid:48), ψ(cid:48), ¯ϕ(cid:48))
¯ϕ(cid:48)∈{R ¯ϕ} DRBphinor(χ(cid:48), ψ(cid:48), ¯ϕ(cid:48))

ψ(cid:48)∈{Aψ}

,

χ(cid:48)∈{Aχ}

(17)

which is a local ﬁt of the PHINOR background model to the
three-dimensional event distribution after subtracting any celes-
tial sources. We note that Nrunav is no longer a parameter of the
model, and the number of pixels in χ and ψ that are used for the
local ﬁt is determined by Navgr. We also included a ¯ϕ normalisa-
tion at the end of the computation equivalent to Eq. (16).

Figure 6 compares the event cube projections to the
projections for background models obtained using PHINOR,

Article number, page 7 of 31

020406080χ (deg)02000400060008000Arbitrary unit χ di tributionDREPHINORBGDLIXABGDLIXE020406080ψ (deg)02000400060008000Arbitrary unit ψ di tributionDREPHINORBGDLIXABGDLIXE0510152025̄φ (deg)05000100001500020000Arbitrary unit ̄φ di tributionDREPHINORBGDLIXABGDLIXEA&A proofs: manuscript no. arxiv

Table 2. COMPTEL-speciﬁc ctools scripts.

Task
Generate database
Select observations
Bin COMPTEL observations
Generate background model
Combine observations
Generate XML model for analysis
Fit model to data using SRCLIX method
Create TS map using SRCLIX method

Script
comgendb
comobsselect
comobsbin
comobsback
comobsadd
comobsmodel
comlixfit
comlixmap
comsrcdetect Detect sources in TS map
comobsres
comobssim
compulbin

Generate residuals
Simulate COMPTEL observations
Generate pulsar pulse proﬁle

BGDLIXA and BGDLIXE using the parameters Nrunav = 3,
Navgr = 3, Nincl = 13 and Nexcl = 0 proposed by van Dijk (1996).
While the PHINOR model provides a ﬁrst-order description of
the event distribution, it shows signiﬁcant diﬀerences in the de-
tails. The BGDLIXA and BGDLIXE models follow the event
distribution very closely, and both models are in fact indistin-
guishable from each other, demonstrating that their results are
equivalent for the parameter values chosen.

3.6. ctools scripts

To support the science analysis of COMPTEL data, we ex-
tended the ctools package with a number of dedicated Python
scripts, providing basic building blocks that each perform well-
deﬁned science data analysis tasks. This includes the genera-
tion of a database based on the data available in the HEASARC
archive, the selection of COMPTEL viewing periods from this
database, event binning and response computation, data com-
bination, background modelling, model ﬁtting, generation of
test statistic (TS) maps, residual inspection, observation simula-
tions, and source detection, as well as generation of pulsar pulse
proﬁles. These scripts complement the already existing generic
science analysis tools in ctools that may be used in combina-
tion with the new scripts. Table 2 summarises the COMPTEL-
speciﬁc scripts that we added to ctools.

Before starting a COMPTEL data analysis, a database needs
to be generated from the data that are available in the HEASARC
archive. This analysis step, which only needs to be performed
once on a given computer, is performed by the comgendb script.
Once the database is generated, a typical COMPTEL anal-
ysis starts with executing comobsselect to select the relevant
viewing periods for a given source or source region and observ-
ing time interval from the database. Results are provided as an
observation deﬁnition ﬁle in XML format, which contains all the
relevant information for the subsequent analysis steps. Following
selection, the data are binned into three-dimensional event cubes
and the corresponding DRX and DRG cubes are generated using
comobsbin. The binning can be done for an arbitrary number of
energy bands, enabling a joint spectral-spatial analysis that was
not supported by the original COMPASS software. comobsbin
also computes an initial background model DRB using the PHI-
NOR algorithm (see Sect. 4.1), as well as the IAQ response ma-
trices for the relevant energy bands. All output ﬁles are stored as
FITS ﬁles in a data store, avoiding the recomputation of identical
data ﬁles in subsequent analyses. Alternative background mod-
els using the algorithms described in Sect. 3.5 can be generated
using comobsback.

Article number, page 8 of 31

Individual viewing periods can be combined into single event
cubes for each energy band {E} using the comobsadd script,
leading to a considerable speed-up of the data analysis. The com-
bination of viewing periods is however not required, and alterna-
tively the data can be analysed using a joint maximum-likelihood
analysis of the selected viewing periods, a possibility that was
not supported by the original COMPASS software. Combination
of the viewing periods i is done using

DRE(χ, ψ, ¯ϕ|{E}) =

DRB(χ, ψ, ¯ϕ|{E}) =

(cid:88)

i

(cid:88)

i

DREi(χ, ψ, ¯ϕ|{E})

DRBi(χ, ψ, ¯ϕ|{E})

DRX(α, δ) =

(cid:88)

i

max
α(cid:48),δ(cid:48)

DRXi(α(cid:48), δ(cid:48))

DRG(χ, ψ, ¯ϕ) = 1
T

(cid:88)

i

Ti DRGi(χ, ψ, ¯ϕ),

(18)

(19)

(20)

(21)

where Ti is the exposure time of viewing period i and T = (cid:80)
i Ti
is the total exposure time of the combined data. We note that
Eq. (20) leads to an exposure map that is independent of α, δ
and that is given by the maximum of the DRX for each viewing
period, an approximation that is justiﬁed by the fact that the DRX
is rather ﬂat (see Fig. 3) and that the zenith angle variation in the
response computation (cf. Eq. (3)) is dominated by the geometry
function DRG (see also Knödlseder 1994).

In order to perform a maximum-likelihood analysis of the
data, a model deﬁnition ﬁle in XML format needs to be gen-
erated. We automatised this task with the comobsmodel script,
which in particular generates an adequate model deﬁnition for
ﬁtting the background model DRB to the data. COMPTEL back-
ground model ﬁtting is done using the DRBPhibarBins model
type, which introduces one scaling factor for each ¯ϕ layer for all
viewing periods and energy bands. In addition, comobsmodel
supports adding of a point source and diﬀuse model components
to the model deﬁnition XML ﬁle.

The main script for maximum-likelihood model ﬁtting is
comlixfit, which implements the iterative SRCLIX algorithm.
The algorithm starts from an input model deﬁnition XML
ﬁle and computes a DRM model of the celestial sources using
Eq. (11), which is then used to compute an initial background
model using one of the PHINOR, BGDLIXA, or BGDLIXE al-
gorithms. The script then uses the ctlike tool to ﬁt the source
and background models to the binned data. The celestial source
model that results from the ﬁt is then used to update the DRM
model and to regenerate a background model using the selected
algorithm. A new ctlike ﬁt is then performed using the updated
model, and the procedure is repeated until the maximum log-
likelihood change between subsequent iterations becomes neg-
ligible, typically less than 0.05. Usually, the SRCLIX algorithm
converges after a few iterations.

Figure 7 illustrates the algorithm by showing TS maps for
subsequent SRCLIX iterations for viewing period 1.0 that were
obtained using the cttsmap tool. The TS is deﬁned as

TS = 2 ln L(Ms + Mb) − 2 ln L(Mb)
(Mattox et al. 1996), where ln L(Ms + Mb) is the log-likelihood
value obtained when ﬁtting the source and the background mod-
els together to the data, and ln L(Mb) is the log-likelihood value

(22)

J. Knödlseder et al.: COMPTEL data analysis using GammaLib and ctools

Fig. 7. Test statistic maps of viewing period 1.0 (during which the Crab pulsar and pulsar wind nebula was observed) for the combined analysis
of the four standard COMPTEL energy bands as a function of the number of SRCLIX iterations, indicated in the upper-right corner of each panel.
The BGDLIXE algorithm with Navgr = 5, Nincl = 15, and Nexcl = 0 was employed. The lower-right panel shows the TS map obtained using the
comlixmap script. Colour maps are shown in units of

TS. Negative values correspond to negative ﬂuxes of the test source.

√

obtained when ﬁtting only the background model to the data.
Under the hypothesis that the background model Mb provides a
satisfactory ﬁt of the data, TS follows a χ2
n distribution with n
degrees of freedom, where n is the number of free parameters in
the source model component. Therefore,

p =

(cid:90) +∞

TS

χ2
n(x) dx

(23)

gives the chance probability (p-value) that the log-likelihood im-
proves by TS/2 when adding the source model Ms due to statis-
tical ﬂuctuations only (Cash 1979).

We note that viewing period 1.0 is an observation of the
Crab pulsar and pulsar wind nebula, which is by far the brightest
source of gamma rays in the COMPTEL energy range. For the
SRCLIX analysis, the data of the four standard energy bands
were analysed jointly, and the Crab was modelled as a point
source with power-law spectrum. The source location, prefac-
tor and spectral index were free parameters in the ﬁt. After each
iteration of the SRCLIX algorithm, a TS map7 was generated by
replacing the Crab in the ﬁtted model by a test source with ﬁxed
power-law spectral index of Γ = 2. The source visible at the
centre of the TS maps is the Crab, which is already signiﬁcantly
detected after the ﬁrst SRCLIX iteration. Subsequent iterations
slightly increase the source signiﬁcance, but overall the TS maps
change little. The SRCLIX algorithm converged after six itera-
tions.

The TS maps show a halo of marginal signiﬁcance around
the Crab, which can be explained by the fact that the maps were
obtained using a background model that assumed the presence

7 The TS map comprises 50 × 50 pixels of size 1◦ × 1◦ situated around
the Crab position.

of a point source at the location of the Crab. The event cone of a
test source placed a few degrees away from the Crab will pick up
some of the excess counts left by the background model, which
explains the halo in maps.

An alternative way to generate TS maps is provided by the
comlixmap script, which applies the SRCLIX algorithm to each
test source position, and which is the algorithm that was imple-
mented by the COMPASS task SRCLIX. Here each pixel in the
TS map corresponds to a diﬀerent background model, and when
moving away from the source location, no excess counts will re-
main in the data. This reduces the halo around the sources, as
illustrated in the last panel of Fig. 7 that shows the TS map that
was obtained using comlixmap for viewing period 1.0. At the
same time, negative residuals are ampliﬁed, which is explained
by the fact that the events of the Crab for test source positions
oﬀset from the source will be included as a smoothed event cone
in the background model. We note, however, that this is only
a feature of the TS maps, as ultimately, an adequate model of
celestial sources that describes the COMPTEL event distribu-
tion should be derived from the data. Using that model as DRM
in the BGDLIX algorithm will exclude any source events from
the smoothing algorithm, and hence provides a reliable back-
ground model. For this approach the comsrcdetect script can
be used, which extracts signiﬁcant sources from TS maps and
adds them to a model deﬁnition XML ﬁle. A subsequent run
of the comlixmap script will then show whether any additional
celestial sources remain in the data, building up iteratively an
adequate model of celestial sources.

Following model ﬁtting an inspection of the ﬁt residuals is
crucial. The comobsres script enables such an inspection by
projecting the residual between the event and model cubes onto

Article number, page 9 of 31

160170180190200−30−20−10010Galactic latitude (deg)1160170180190200−30−20−100102160170180190200−30−20−100103160170180190200Galactic longitude (deg)−30−20−10010Galactic latitude (deg)4160170180190200Galactic longitude (deg)−30−20−100105160170180190200Galactic longitude (deg)−30−20−10010comlixmap−5051015202530A&A proofs: manuscript no. arxiv

the sky by summing their content along the event cone using

N(α, δ) =

(cid:40)

(cid:88)

χ,ψ, ¯ϕ

and

M(α, δ) =

(cid:40)

(cid:88)

χ,ψ, ¯ϕ

DRE(χ, ψ, ¯ϕ),
0,

if ARMmin ≤ ¯ϕ − ϕgeo ≤ ARMmax
otherwise

(24)

DRM(χ, ψ, ¯ϕ),
0,

if ARMmin ≤ ¯ϕ − ϕgeo ≤ ARMmax
otherwise

(25)

where ϕgeo is the angular distance between a sky position (α, δ)
and the Compton scatter direction (χ, ψ), and [ARMmin, ARMmax]
deﬁnes a selection window for the so-called angular resolution
measure that is typically taken to be [−3◦, 3◦]. We note that DRM
designates here the model cube that comprises both the source
and background components. By default, comobsres uses

R(α, δ) = sgn(N(α, δ) − M(α, δ)) ×

(cid:115)

(cid:32)

2

N(α, δ) ln

N(α, δ)
M(α, δ)

(cid:33)
+ M(α, δ) − N(α, δ)

(26)

to compute the signiﬁcance of the residuals R(α, δ) in Gaussian
σ, where the sign term indicates whether the measured number
of counts is larger or smaller than the number of counts predicted
by the model. Some special cases need to be treated separately.
Namely, if N(α, δ) = 0 the residual signiﬁcance is

R(α, δ) = sgn(N(α, δ) − M(α, δ))

(cid:112)

2M(α, δ),

(27)

while if M(α, δ) = 0 the signiﬁcance cannot be computed and
we set R(α, δ) = 0.

The comobssim script enables the simulation of DRE event
cubes by sampling the events according to a Poisson distribu-
tion using the expectation given by a model. Speciﬁcally, simu-
lated events for a given celestial source model can be added by
comobssim to existing observations, allowing the study of ce-
lestial sources with known properties in real data, a possibility
that we use extensively in the next section.

Finally, compulbin will generate pulsar phase proﬁles by
applying the algorithms described in Appendix D to individual
events. Only events that satisfy the ARM selection according to
Eq. (24) will be retained in the phase proﬁles, with typical values
for the ARM window being [−3.5◦, 3.5◦].

4. Science validation

Having veriﬁed that GammaLib and ctools reproduce data prod-
ucts that are identical to the ones that were generated with the
COMPASS system, we now verify that the use of our software
for an analysis of the data provided by HEASARC reproduces
COMPTEL science results that were published in the literature.
If not stated otherwise, for the analyses that follow we apply
the event selection parameters speciﬁed in Table 1, a value of
ζmin = 5◦, and we exclude D2 modules for which there were
faulty photomultipliers.

4.1. Background model validation

An important step prior to any science analysis is the valida-
tion of the background model. An accurate background model

Article number, page 10 of 31

predicts the background event distribution within statistical ﬂuc-
tuations, and allows for a reliable and accurate determination
of the contribution of celestial gamma-ray sources to the mea-
sured events. As is obvious from Fig. 6, the PHINOR model cer-
tainly does not satisfy the ﬁrst criterion; hence, we no longer
consider this model here. On the other hand, the BGDLIXA
and BGDLIXE models look promising, and were generally used
in the past for science analysis of COMPTEL data. Since the
BGDLIXA and BGDLIXE algorithms are equivalent as long as
Nrunav ≤ Navgr, we limit our study here to the simpler BGDLIXE
,
algorithm. Speciﬁcally, we investigate which values of Navgr and
Nincl provide reliable background models without introducing
a signiﬁcant bias in the reconstruction of celestial gamma-ray
source characteristics. In agreement with previous studies of the
algorithms (cf. van Dijk 1996) we always set Nexcl = 0.

4.1.1. Residual maps

We started with modelling the background for all COMPTEL
viewing periods and the four standard COMPTEL energy bands
using comobsback and the BGDLIXE algorithm under varia-
tion of the parameters Navgr and Nincl. For each viewing period
and energy band we created residual maps and histograms us-
ing comobsres that we inspected visually. We note that due to
the dominance of the instrumental background in COMPTEL
data, we do not expect to see celestial gamma-ray emission in
the residual maps of individual viewing periods, with the excep-
tion of emission from the Crab pulsar and pulsar wind nebula,
which is the strongest gamma-ray source at MeV energies. We
ﬁnd a general trend of stronger residuals at lower energies, with
the largest residuals observed in the 1 − 3 MeV band. Notably,
residuals are stronger for viewing periods for which the Earth
horizon selection Eq. (2) introduces a strong ¯ϕ dependence in
the χ, ψ distribution of the events. The amplitude of the residuals
changes strongly under variation of Nincl, with larger residuals
for larger values of Nincl, while variations of Navgr impact the
residuals only moderately.

For illustration we show residual maps obtained using the
BGDLIXE algorithm for diﬀerent values of Navgr and Nincl and
for three representative viewing periods and the 1 − 3 MeV en-
ergy band in Figs. 8 and 9. Viewing period 1.0 is an observation
of the Crab pulsar and pulsar wind nebula, which is clearly visi-
ble in the residuals maps. Viewing period 223.0 is an observation
of 1E 1740.7–2942, a low-mass X-ray binary that is also known
as the ‘Great Annihilator’ and that is situated near the Galactic
centre. The residuals in this viewing period are relatively mod-
est. Viewing period 518.5 is an observation of the BL Lacertae
object S5 0716+714, which is among the viewing periods with
the worst residuals, featuring large zones of signiﬁcant excess
counts and negative depressions. The amplitude of the residu-
als clearly decreases with decreasing value of Nincl, while at the
same time smaller value of Nincl also reduce the signal from the
Crab. As we will show later, some of this signal can be recovered
using the iterative SRCLIX algorithm, yet small values of Nincl
tend to lead to an underestimation of source ﬂuxes. Therefore,
the choice of Nincl is necessarily a trade-oﬀ between the ampli-
tude of background residuals and the suppression of source ﬂux.
On the other hand, the amplitude of the residuals changes only
moderately with Navgr, with a slight increase of the residual am-
plitudes for increasing values of Navgr.

To systematically quantify the residuals for a given choice
of BGDLIXE parameters we computed for all viewing periods
and the four standard COMPTEL energy bands the mean and
random mean scatter (rms) of the residual maps. The results for

J. Knödlseder et al.: COMPTEL data analysis using GammaLib and ctools

Fig. 8. Residual maps for three viewing periods and the 1 − 3 MeV energy band with background modelled using the BGDLIXE algorithm for
Navgr = 5 and diﬀerent values of Nincl. The colour scale is limited to the range −5σ (blue) to +5σ (red). Viewing period 1.0 was selected because
it contains the Crab, viewing period 223.0 because it has a rather ﬂat residual, and viewing period 518.5 because it is among the viewing periods
with the worst residuals.

the BGDLIXE algorithm as a function of Nincl for Navgr = 5 and
as a function of Navgr for Nincl = 13 are shown in Fig. 10. The
violins represent the density distribution of the mean and rms
of the residual maps for all viewing periods. Viewing periods
including the Crab were excluded to avoid any bias due to the
presence of a strong source.

The plots conﬁrm that the largest spread in the mean and rms
are observed for lower energies, with a particularly large spread
for the 1 − 3 MeV energy band. A large spread indicates that
for some viewing periods the background model results in im-
portant residuals, while for other viewing periods the algorithm
performs rather well, as illustrated in Figs. 8 and 9. Reducing
Nincl considerably reduces the spread in the mean and rms values
for all energy bands, yet at some point the rms drops below the

expected value of 1, indicating that the background model par-
tially follows the statistical ﬂuctuations of the data. This is also
the regime where the source ﬂuxes start to get underestimated.

This overﬁtting can be slightly reduced by increasing Navgr
so that more events get included in the χ, ψ averaging, as indi-
cated in the lower row of Fig. 10. On the other hand, increasing
Navgr leads to a slight increase of the mean and rms distributions;
hence, the selected value of Navgr should also not be too large.

4.1.2. Flux reconstruction

As the next step we studied the impact of the BGDLIXE param-
eters on the ﬁtted values of celestial source parameters, such as
source position, extent, ﬂux and spectral index. We do this by

Article number, page 11 of 31

150175200225Galactic longitude (deg)402002040Galactic latitude (deg)Navgr=5, Nincl=21Viewing period 1.025025Galactic longitude (deg)402002040Galactic latitude (deg)Navgr=5, Nincl=21Viewing period 223.0100150Galactic longitude (deg)0204060Galactic latitude (deg)Navgr=5, Nincl=21Viewing period 518.542024150175200225Galactic longitude (deg)402002040Galactic latitude (deg)Navgr=5, Nincl=15Viewing period 1.025025Galactic longitude (deg)402002040Galactic latitude (deg)Navgr=5, Nincl=15Viewing period 223.0100150Galactic longitude (deg)0204060Galactic latitude (deg)Navgr=5, Nincl=15Viewing period 518.542024150175200225Galactic longitude (deg)402002040Galactic latitude (deg)Navgr=5, Nincl=5Viewing period 1.025025Galactic longitude (deg)402002040Galactic latitude (deg)Navgr=5, Nincl=5Viewing period 223.0100150Galactic longitude (deg)0204060Galactic latitude (deg)Navgr=5, Nincl=5Viewing period 518.542024A&A proofs: manuscript no. arxiv

Fig. 9. Same as Fig. 8 but for Nincl = 13 and diﬀerent values of Navgr.

using comobssim to add a simulated source at an oﬀset angle of
20◦ with respect to the pointing axis to the data of each viewing
period for the four standard energy bands. In that way, our study
relies essentially on the observed event distribution, and hence
is representative for a real analysis situation, while the charac-
teristics of the celestial source are known. As simulated source
model we use a spatially extended disk component with radius
of 3◦ combined with a spectral power-law component with an
energy ﬂux of 1.068 × 10−8 erg cm−2 s−1 within 0.75 − 30 MeV
and a spectral index of 2.1, which roughly corresponds to the
spectral parameters that are observed for the Crab. The simu-
lated data of each viewing period were then ﬁt jointly for the
four energy bands using comlixfit, determining the maximum
likelihood right ascension, declination, disk radius, energy ﬂux,
and spectral index of the source. Initial values for the iterative
ﬁtting procedure were oﬀset from the simulated values since in
a real data analysis the true source parameters are generally not

known in advance. Viewing periods including the Crab were ex-
cluded from the analysis to avoid any interference with a known
strong source of gamma rays. We furthermore assume that no
other source of gamma rays is signiﬁcantly detected in any of the
remaining individual viewing periods, considering these viewing
periods as empty ﬁelds for the purpose of this analysis.

For each ﬁtted source parameter, i, we determine the pull

Pull(pi) = pi − vi
σi

,

(28)

where pi is the ﬁtted value, vi is the simulated value, and σi is the
statistical parameter uncertainty as determined by comlixfit.
In the absence of systematic uncertainties, and under the as-
sumption that the statistical uncertainties are following a Gaus-
sian distribution, Pull(pi) follows a Gaussian distribution with a
mean of zero and a standard deviation of σ = 1.

Article number, page 12 of 31

150175200225Galactic longitude (deg)402002040Galactic latitude (deg)Navgr=3, Nincl=13Viewing period 1.025025Galactic longitude (deg)402002040Galactic latitude (deg)Navgr=3, Nincl=13Viewing period 223.0100150Galactic longitude (deg)0204060Galactic latitude (deg)Navgr=3, Nincl=13Viewing period 518.542024150175200225Galactic longitude (deg)402002040Galactic latitude (deg)Navgr=11, Nincl=13Viewing period 1.025025Galactic longitude (deg)402002040Galactic latitude (deg)Navgr=11, Nincl=13Viewing period 223.0100150Galactic longitude (deg)0204060Galactic latitude (deg)Navgr=11, Nincl=13Viewing period 518.542024150175200225Galactic longitude (deg)402002040Galactic latitude (deg)Navgr=19, Nincl=13Viewing period 1.025025Galactic longitude (deg)402002040Galactic latitude (deg)Navgr=19, Nincl=13Viewing period 223.0100150Galactic longitude (deg)0204060Galactic latitude (deg)Navgr=19, Nincl=13Viewing period 518.542024J. Knödlseder et al.: COMPTEL data analysis using GammaLib and ctools

Fig. 10. Violin plots of the mean and rms, in units of σ, of the residual maps with background modelled using the BGDLIXE algorithm for all
viewing periods except the ones that include the Crab. The mean and rms are shown as a function of Nincl for Navgr = 5 in the upper row and as
a function of Navgr for Nincl = 13 in the lower row. The groups of four violins correspond to the four standard energy bands; from left to right:
0.75 − 1 MeV (blue), 1 − 3 MeV (orange), 3 − 10 MeV (green), and 10 − 30 MeV (red). Horizontal black bars show the maximum, the median,
and the minimum values, respectively.

Figure 11 summarises the results of the analysis, showing
the pull distributions for all considered viewing periods as violin
plots, with violins for right ascension, declination, disk radius,
energy ﬂux, and spectral index. The expectations for purely sta-
tistical parameter ﬂuctuations are indicated by semi-transparent
violins with grey borders, the horizontal black bars indicate the
maximum, median and minimum pull of the distributions. The
upper row shows results as a function of Nincl for Navgr = 5, the
lower row shows results as a function of Navgr for Nincl = 13.

Figure 11 indicates that large values of Nincl lead to pull dis-
tributions that are broader than expected from statistical ﬂuctua-
tions only, in particular for the energy ﬂux, but also for the spec-
tral index and to a lesser extent for the other source parameters.
The broadening is due to background residuals in some of the
viewing periods for large Nincl, as illustrated in Fig. 8, which im-
pact the reconstructed source parameters. Reducing Nincl brings
the pull distributions more in line with the expectations, yet for
Nincl ≤ 13 the median pull of the ﬁtted energy ﬂux drops below
zero, indicating a systematic bias towards too low ﬂuxes. Specif-
ically, for Nincl = 5, where background residuals are very small
(cf. Fig. 8), the ﬂux reconstruction is strongly biassed, resulting
is a signiﬁcant underestimation of gamma-ray ﬂuxes. The opti-
mum value for Nincl is hence a trade-oﬀ between reduction of
background residuals and biassing the ﬂux determination.

Flux biassing is also observed with increasing value of Navgr,
with a minimum bias that occurs for Navgr = 5. Using hence
Navgr = 5 and Nincl = 15 for the BGDLIXE background mod-
elling leads to results that are basically free from any systematic
bias, although some signiﬁcant background residuals may persist

for this choice of values. As illustrated in Fig. 11, these back-
ground residuals translate into an additional uncertainty beyond
the statistical ﬂuctuations only. In the present case, the standard
deviation of the energy ﬂux pull distribution for Navgr = 5 and
Nincl = 15 is about twice as large as expected from statisti-
cal ﬂuctuations only. In other words, when analysing individ-
ual viewing periods using BGDLIXE parameters Navgr = 5 and
Nincl = 15, the uncertainties in the energy ﬂux related to the
background modelling roughly doubles the uncertainties due to
statistical ﬂuctuations only.

In the following we use Navgr = 5 and Nincl = 15 for the
analysis in our paper, and we generally recommend to use these
parameters for COMPTEL data analysis with GammaLib and
ctools. We note that these values apply for a binning of 1◦ in χ
and ψ and 2◦ in ¯ϕ, and that for a diﬀerent binning the parameters
need to be adjusted accordingly. Speciﬁcally, we used an equiv-
alent value of Nincl = 29 for analyses in our paper for which a
binning of 1◦ is applied in ¯ϕ.

4.2. Gamma-ray emission from the Crab

We began the science validation of our software with a spec-
tral analysis of the gamma-ray emission from the Crab pulsar
and pulsar wind nebula, which is the brightest source of gamma
rays at MeV energies. The MeV ﬂux is dominated by emission
from the pulsar wind nebula, yet using pulsar ephemerides de-
rived from radio observations the emission from the pulsar is
also clearly detectable over the entire COMPTEL energy range.
The emission from the Crab pulsar and pulsar wind nebula was

Article number, page 13 of 31

211917151311975Nincl1.00.50.00.51.0MeanNavgr=5211917151311975Nincl0.00.51.01.52.02.53.03.54.0RMSNavgr=535791113151719Navgr1.00.50.00.51.0MeanNincl=1335791113151719Navgr0.00.51.01.52.02.53.03.54.0RMSNincl=13A&A proofs: manuscript no. arxiv

Fig. 11. Violin plots of the ﬁtted parameter pull distributions for a simulated source at a 20◦ oﬀ-axis angle for all viewing periods except those
that include the Crab. The upper row shows results as a function of Nincl for Navgr = 5; the lower row shows results as a function of Navgr for
Nincl = 13. For all simulations the source was simulated as a spatially extended disk with a 3◦ radius and with a power-law spectrum of index
Γ = 2.1. Horizontal black bars show the maximum, the median, and the minimum values, respectively. Semi-transparent violins with grey borders
indicate the expected pull distributions from statistical ﬂuctuations only.

4.2.1. Total spectrum

We ﬁrst considered the combined emission from the Crab pul-
sar and pulsar wind nebula. In their analysis of ﬁve years of
COMPTEL observations, van der Meulen et al. (1998) analysed
the spectrum of the total Crab emission within the energy range
0.78 − 30 MeV in 30 narrow energy bins. Since this is the only
work that quotes total ﬂux values for the Crab (cf. Table 2 of the
publication), we used this study as reference.

We analysed the same data that was used by van der Meulen
et al. (1998) with GammaLib and ctools, except for viewing pe-
riod 0 that is not available at HEASARC and viewing period
426.0 for which the EVP ﬁle in the HEASARC archive has a
corrupted content. We binned the data according to the 30 en-
ergy bins deﬁned by van der Meulen et al. (1998) and combined
the data for all viewing periods using comobsadd using 80 bins
in χ and ψ that were centred on the position of the Crab pul-
sar, taken here to be 83.6331◦ in right ascension and 22.0145◦ in
declination (J2000). Similar to van der Meulen et al. (1998) we
used 50 bins in ¯ϕ, bin sizes of 1◦ in all three data space dimen-
sions, and instrument response functions derived by analytical
modelling.

We modelled the Crab using a point source with ﬁxed posi-
tion, as given above, and using power-law, exponentially cut-
oﬀ power-law or curved power-law spectral models. We ﬁt-
ted the data jointly for the 30 energy bins using comlixfit
with BGDLIXE background model parameters Navgr = 5 and
Nincl = 29. The best ﬁt was obtained using the exponentially

Fig. 12. Spectral energy distribution of the total emission from the Crab
pulsar and pulsar wind nebula as measured by COMPTEL in 30 bins
covering the energy band 0.78 − 30 MeV. Filled red dots correspond to
results obtained with ctools, and open blue dots correspond to results
obtained by van der Meulen et al. (1998) using COMPASS. The shaded
regions correspond to the 1σ uncertainty bands of the ﬁtted exponen-
tially cut-oﬀ power-law models.

studied extensively by COMPTEL in the past (e.g. Much et al.
1995b,a, 1996; van der Meulen et al. 1998; Kuiper et al. 2001).

Article number, page 14 of 31

211917151311975Nincl864202468PullNavgr=5Right Ascension211917151311975Nincl864202468Navgr=5Declination211917151311975Nincl864202468Navgr=5Radius211917151311975Nincl864202468Navgr=5Energy flux211917151311975Nincl864202468Navgr=5Index35791113151719Navgr864202468PullNincl=13Right Ascension35791113151719Navgr864202468Nincl=13Declination35791113151719Navgr864202468Nincl=13Radius35791113151719Navgr864202468Nincl=13Energy flux35791113151719Navgr864202468Nincl=13Index100101Energy (MeV)109E2 × dN/dE (erg cm2 s1)This workvan der Meulen et al. (1998)J. Knödlseder et al.: COMPTEL data analysis using GammaLib and ctools

cut-oﬀ power law

I(Eγ) = k

(cid:32)

Eγ
3.5MeV

(cid:33)−Γ

(cid:32)

exp

−

(cid:33)

,

Eγ
Ec

(29)

with k = (1.81 ± 0.06) × 10−4 ph cm−2 s−1 MeV−1, Γ = 2.00 ±
0.03, and Ec = 39.1 ± 9.7 MeV. van der Meulen et al. (1998)
do not quote the parameters of a ﬁtted spectral model to the
total Crab emission data, so we used the GammaLib multi-
wavelength interface to adjust the same spectral models to the
data of their Table 2, which also favoured the exponentially cut-
oﬀ power law with best ﬁtting parameters k = (1.70±0.05)×10−4
ph cm−2 s−1 MeV−1, Γ = 1.97 ± 0.02, and Ec = 29.8 ± 5.0 MeV.
While our prefactor k is about 6% larger than the one obtained
from ﬁtting the spectrum of van der Meulen et al. (1998), the
other spectral parameters are equivalent within statistical uncer-
tainties.

We then used ctbutterfly to determine uncertainty bands
for the spectral models and csspec to derive ﬂux points for the
30 energy bins. The results of our analysis are compared to those
of van der Meulen et al. (1998) in Fig. 12. The uncertainty bands
for the data of van der Meulen et al. (1998) were determined us-
ing ctbutterfly. Overall the agreement between both analyses
is quite good, yet as mentioned earlier, our ﬂux points lie some-
what above the ones determined by van der Meulen et al. (1998).
Possibly this discrepancy may be related to correction factors
that were applied posterior to COMPASS analyses at the time
that were not automatically taken into account by the software.
These correction factors include an energy-dependent ToF cor-
rection factor (cf. Table C.1), an energy-independent deadtime
correction factor of 0.965 as well as an energy-independent ﬂux
correction factor that was eventually applied to SRCLIX analy-
ses to correct for a ﬂux suppression that arose from the modiﬁ-
cation of the instrument response function (van Dijk 1996). We
recall that GammaLib automatically applies the ToF and dead-
time correction factors to the results. Whether or not such cor-
rection factors were applied by van der Meulen et al. (1998) is
not known, yet they may plausibly explain the 6% discrepancy
observed between the analyses.

4.2.2. Pulsar and nebula components

We now turn to an analysis that separates the emission from the
Crab pulsar and the pulsar wind nebula to validate the imple-
mentation of the pulsar phase computations. The most compre-
hensive analysis of the emission from the Crab pulsar and pulsar
wind nebula components using COMPTEL data was performed
by Kuiper et al. (2001) using data collected over the nine years
mission duration of CGRO. While Kuiper et al. (2001) used data
from 33 viewing periods with pointing axis within 30◦ of the
Crab pulsar, we analysed 24 viewing periods that we found with
the same selection criteria in the HEASARC database, cover-
ing the viewing periods speciﬁed in Table 1 of Kuiper et al.
(2001) between viewing period 1.0 and viewing period 616.1.
As in the analysis above, viewing period 426.0 was excluded
from the list since no usable EVP ﬁle exists for this observation
in the HEASARC database. Similarly to Kuiper et al. (2001) we
used ephemerides for the Crab pulsar from the Princeton radio
pulsar database, provided in the form of an ASCII ﬁle named
psrtime.dat8 that is part of the reference data of the X-ray

Fig. 13. Pulse proﬁles of the Crab pulsar derived using ctools for the
four standard energy bands (red) compared to pulse proﬁles derived by
Kuiper et al. (2001) using the COMPASS software (blue). The latter
proﬁles were scaled to match our results in amplitude, and a phase shift
of −0.03 was applied to match the proﬁles in phase.

Timing Explorer (XTE) module of the HEASoft software (ver-
sion 6.29).9

We ﬁrst used compulbin with an angular resolution measure
of ±3.5◦ to produce pulse proﬁles for the four standard COMP-
TEL energy bands, as displayed in Fig. 2 of Kuiper et al. (2001).
The results of this analysis are shown in Fig. 13, on which we
overlay for comparison the pulse proﬁles obtained by Kuiper
et al. (2001). Since the Kuiper et al. (2001) proﬁles were ob-
tained for a larger dataset and angular resolution measures that
were not speciﬁed in their paper, we scaled the proﬁles so that
the minimum and maximum number of events in the proﬁles
matches the numbers that we obtained in our analysis. We also
applied a phase shift of −0.03 to the pulse proﬁles of Kuiper
et al. (2001) to match them to our proﬁles. While we do not know
the origin of this small discrepancy in the pulse phases, we note
that a phase shift of −0.03 corresponds to a diﬀerence of about
0.5 arcsec in the assumed right ascension of the Crab pulsar. In
GammaLib, the pulsar position is taken from the ephemerides
ﬁle, which in the present case is the radio position in the Prince-
ton database, while Kuiper et al. (2001) do not specify the po-
sition that they assumed for the Crab pulsar. We note that the
radio position in the Princeton database diﬀers by about 0.5 arc-
sec from the International Celestial Reference System (ICRS)

8 Details are provided at https://heasarc.gsfc.nasa.gov/
lheasoft/ftools/fhelp/fasebin.html

9 The HEASoft software can be downloaded from https://
heasarc.gsfc.nasa.gov/docs/software/lheasoft/

Article number, page 15 of 31

0.000.250.500.751.001.251.501.752.00Phase4000425045004750Events0.75 - 1 MeV0.000.250.500.751.001.251.501.752.00Phase16000165001700017500Events1 - 3 MeV0.000.250.500.751.001.251.501.752.00Phase520054005600Events3 - 10 MeV0.000.250.500.751.001.251.501.752.00Phase1000105011001150Events10 - 30 MeVA&A proofs: manuscript no. arxiv

reduced in our analysis, suggesting that the enhancement is prob-
ably a statistical ﬂuctuation rather than a physical feature.

We also ﬁtted diﬀerent spectral models to the data of the
Crab pulsar and pulsar wind nebula, including power laws, expo-
nentially cut-oﬀ power laws and curved power laws. We deter-
mined the corresponding uncertainty bands using ctbutterfly
and overlay them on the spectral points in Fig. 14. Using an
exponentially cut-oﬀ power law for the nebula component in-
stead of a simple power law improved the TS value of the nebula
component by 6.5, corresponding to a detection signiﬁcance of
2.5σ for the spectral cutoﬀ. For the pulsar component no im-
provement was achieved when allowing for a cutoﬀ or a cur-
vature in the power law. For the Crab pulsar wind nebula, the
best ﬁtting parameters of Eq. (29) were k = (13.7 ± 0.5) × 10−5
ph cm−2 s−1 MeV−1, Γ = 2.15 ± 0.03, and Ec = 53.3 ± 15.5 MeV.
For the Crab pulsar the best ﬁtting power-law parameters were
k = (5.1 ± 0.3) × 10−5 ph cm−2 s−1 MeV−1 and Γ = 2.29 ± 0.06.
This compares to the spectral indices of 2.227 ± 0.013 and
2.24 ± 0.04 determined by Kuiper et al. (2001) for the nebula and
pulsar components using power-law models, respectively. While
our index for the pulsar component is compatible with their re-
sult, our index for the nebula component is ﬂatter, which can be
explained by the spectral cutoﬀ in our model. Using a simple
power law for the nebula component, as Kuiper et al. (2001) did,
we obtained a steeper index of 2.24±0.02 that is compatible with
their result.

4.3. Phase-resolved analysis of LS 5039

We now turn to an analysis of COMPTEL observations of the
gamma-ray binary LS 5039 in order to validate the ability to
conduct phase-resolved analyses with GammaLib and ctools.
Using an orbit-resolved analysis, Collmar & Zhang (2014)
found strong evidence that the MeV ﬂux of GRO J1823-12, the
strongest unidentiﬁed COMPTEL source in the Galactic plane, is
modulated along the binary orbit of about 3.9 days of LS 5039.
Speciﬁcally, using maximum likelihood signiﬁcance maps, the
authors demonstrated that GRO J1823-12 shows a more signif-
icant signal for the inferior conjunction period of LS 5039 as
compared to the superior conjunction period. The same trend
was also observed in their spectral analysis.

We repeated the analysis of Collmar & Zhang (2014) by
choosing all viewing periods with pointing within 35◦ of (l, b) =
(17.5◦, −0.5◦) from the HEASARC database. In total this re-
sulted in a list of 41 viewing periods, starting with viewing pe-
riod 5.0 and ending with viewing period 712.0. Up to viewing
period 712.0 our list is identical to Table 1 of Collmar & Zhang
(2014), yet the authors included 12 more viewing periods in their
analysis that are not available in the HEASARC archive. For our
analysis we combined the data in a data space of 140 × 123 × 25
bins of 1◦ × 1◦ × 2◦ in size and centred on (l, b) = (15.0◦, −4.5◦),
which corresponds to the same dimensions that were used by
Collmar & Zhang (2014) in some of their analyses. We used the
four standard COMPTEL energy bands for our analysis. Simi-
lar to Collmar & Zhang (2014) we used the binary ephemeris
of Casares et al. (2005), which is an orbital period of 3.90603
days with periastron passage (corresponding to phase 0) at JD
2451943.09, and we deﬁne phases 0.45 ≤ Φ < 0.9 as the inferior
conjunction interval (INFC) and phases Φ ≥ 0.9 and Φ < 0.45
as the superior conjunction interval (SUPC).

As the ﬁrst step we created TS maps of the region around
LS 5039 using comlixmap for the INFC and SUPC phase in-
tervals. The data for the four standard energy bands were anal-
ysed jointly, using a model composed of a test point source

Fig. 14. Spectral energy distributions of the Crab pulsar and pulsar
wind nebula components as determined using GammaLib and ctools
(red) and by Kuiper et al. (2001) using COMPASS (blue). Results for
the Crab pulsar are shown as dots, and results for the Crab pulsar wind
nebula are shown as triangles. The ﬁgure also shows the 1σ uncertainty
bands of the best ﬁtting spectral models for both components.

position provided by the Set of Identiﬁcations, Measurements,
and Bibliography for Astronomical Data (SIMBAD) service,10
which could be at the origin of the observed phase shift.

As the next step we determined the spectra of the Crab pul-
sar and pulsar wind nebula to compare them to those given in
Table 3 of Kuiper et al. (2001). For this purpose we binned
the events using comobsbin for the 12 energy bins speciﬁed
in that table. The data were binned separately for the Oﬀ Pulse
and Total Pulse phase intervals as deﬁned in Table 2 of Kuiper
et al. (2001), shifted by −0.03 to accommodate for the observed
phase shift. Speciﬁcally, the Oﬀ Pulse interval comprises phases
0.49 − 0.85 while the Total Pulse interval comprises phases
0.85 − 1 and 0 − 0.49. We ﬁtted the data for both intervals jointly
using comlixfit with the BGDLIXE parameters Navgr = 5 and
Nincl = 29. We used two point-source model components in our
ﬁt, one for the Crab nebula that was ﬁtted to the data of both
phase intervals, and one for the Crab pulsar that was only ﬁtted to
the data of the Total Pulse interval. Consequently, the Crab pul-
sar component modelled only events that were in excess of the
pulsar wind nebula component. Both point-source model com-
ponents were located at the position of the Crab pulsar, as de-
ﬁned above, and had a spectral model with a free ﬂux value for
each of the 12 energy bins. Similar to Kuiper et al. (2001), we
used simulated instrument response functions and 50 bins in ¯ϕ
with bin sizes of 1◦ for our analysis.

The spectra obtained with our analysis are shown in Fig. 14
together with the spectra obtained by Kuiper et al. (2001). The
agreement between the results is quite satisfactory and diﬀer-
ences are generally well within statistical uncertainties. We note
that there is no general ﬂux oﬀset between ours and the COM-
PASS analysis, as observed above for the total Crab spectrum,
and that diﬀerences are plausibly explained by the use of a dif-
ferent lists of viewing periods. Kuiper et al. (2001) noticed an
enhanced emission in the 10 − 15 MeV energy interval for the
Crab pulsar, and also in our analysis we found an equivalent fea-
ture. We note, however, that by shifting the phase interval deﬁ-
nition by +0.03 (i.e. using the original phase interval deﬁnition
of Kuiper et al. 2001) this spectral enhancement is considerably

10 See
Ident=Crab+pulsar&submit=SIMBAD+search

http://simbad.u-strasbg.fr/simbad/sim-basic?

Article number, page 16 of 31

100101Energy (MeV)109E2 × dN/dE (erg cm2 s1)NebulaPulsarThis workKuiper et al. (2001)J. Knödlseder et al.: COMPTEL data analysis using GammaLib and ctools

Fig. 15. Test statistic maps of LS 5039 for inferior conjunction (left) and superior conjunction (right) phase intervals derived by jointly ﬁtting the
four standard COMPTEL energy bands, covering 0.75 − 30 MeV. The location of LS 5039 is shown by a white plus symbol, and contours show
the 1σ, 2σ, and 3σ location uncertainties. The quasar PKS 1830–210 was included in the source model and hence is not visible in the maps.

Fig. 16. Spectral energy distributions and 1σ uncertainty bands of ﬁtted power-law models for LS 5039 for the INFC (solid lines and ﬁlled area)
and the SUPC (dashed lines and hatched area). The left panel compares the ctools and GammaLib results (red) to the results obtained by Collmar
& Zhang (2014) for an identical event selection (blue). The right panel compares the ctools and GammaLib results (red) to the results obtained
using the COMPASS software by excluding D2 modules with faulty PMTs (blue). Data points from Collmar & Zhang (2014) and derived using
COMPASS were displaced by 3% in energy for clarity.

and an additional point source at the location of the quasar
PKS 1830–210 that is spatially close to LS 5039. The spec-
tra of both components were modelled using power laws. In
addition, the source model included components for Galactic
diﬀuse emission based on template maps for bremsstrahlung
and inverse Compton emission with free scaling factors for
each energy bin.11 Furthermore, an isotropic component was
included to account for the cosmic gamma-ray background
emission, with intensity ﬁxed according to I(Eγ) = 1.12 ×
10−4(Eγ/5 MeV)−2.2 ph cm−2 s−1 MeV−1 sr−1 as suggested by
Weidenspointner (1999). The background was modelled using

11 We used the bremsstrahlung emission map with the COMPASS iden-
tiﬁer MPE-MIS-13006 and the inverse Compton emission map with the
COMPASS identiﬁer ROL-MIS-163 that were also used by Collmar &
Zhang (2014).

the BGDLIXE algorithm with parameters Navgr = 5 and Nincl =
15.

The resulting TS maps are shown in Fig. 15 for the INFC
(left) and SUPC (right) phase intervals. The maps can be com-
pared to those shown in Fig. 6 of Collmar & Zhang (2014),
which were determined separately for the 3−10 MeV and 10−30
MeV energy bands. In both analyses, LS 5039 is considerably
more signiﬁcant in the INFC phase interval but only weakly de-
tected in the SUPC phase interval. In the latter interval, the emis-
sion maximum seems to be displaced towards the north-east with
respect to the position of LS 5039 in ours and the analysis of
Collmar & Zhang (2014), yet the emission location is still com-
patible within the 3σ uncertainty contour with the position of
LS 5039.

As the next step we derived the spectral energy distribution
of LS 5039 for the four standard energy bands using csspec
for both phase intervals to reproduce Fig. 7 of Collmar &

Article number, page 17 of 31

51015202530Galactic longitude (deg)−15−10−5051015Galactic latitude (deg)INFC51015202530Galactic longitude (deg)−15−10−5051015Galactic latitude (deg)SUPC01020304050Test Statistic100101Energy (MeV)1010E2 × dN/dE (erg cm2 s1)INFCSUPCINFC (This work)SUPC (This work)INFC (Collmar & Zhang 2014)SUPC (Collmar & Zhang 2014)100101Energy (MeV)1010E2 × dN/dE (erg cm2 s1)INFCSUPCINFC (This work)SUPC (This work)INFC (COMPASS)SUPC (COMPASS)A&A proofs: manuscript no. arxiv

Our analysis reproduces the orbital light curve of Collmar
& Zhang (2014) within statistical uncertainties. Diﬀerences be-
tween their ﬂux points and ours can be explained by diﬀerences
in the event selection, as Collmar & Zhang (2014) use a larger
number of viewing periods compared to our analysis. Variations
of the same size are also observed in our analysis for the two
diﬀerent event selections, which, however, are well within sta-
tistical uncertainties, as expected.

4.4. 26Al line emission from Carina

As the next step we validated the capacities of GammaLib and
ctools for gamma-ray line emission analysis together with its
abilities to assess the spatial morphology of the emission. As
reference, we chose the COMPTEL detection of point-like 1.8
MeV line emission from the Carina region for this validation, as
reported by Knödlseder (1994) and Knödlseder et al. (1996a),
which are to our knowledge the only published studies where an
analysis using a parametric spatial model was performed with
COMPTEL.

In their studies the authors analysed COMPTEL data from
viewing periods 1 to 301 combined in a data space of 100×100×
25 bins of 1◦ × 1◦ × 2◦ in size, centred on (l, b) = (286.5◦, 0.5◦),
which corresponds to the peak position of the observed 1.8 MeV
line emission feature. The emission feature was found to be
compatible with a point-like source with an 1.8 MeV ﬂux of
(3.1±0.8)×10−5 ph cm−2 s−1 that was determined through model
ﬁtting. Using ﬁts of models with uniform intensity within a cir-
cular region centred on (l, b) = (286.5◦, 0.5◦), Knödlseder et al.
(1996a) determined a 2σ upper limit of 5.6◦ for the diameter of
the 1.8 MeV emission region. The analysis was done in a single
energy bin covering 1.7 − 1.9 MeV, and the instrumental back-
ground was modelled using measurements in adjacent energy
intervals that were corrected for the energy dependence of the
Compton scatter angle ¯ϕ. This method suppresses to ﬁrst order
emission from continuum gamma-ray sources (Knödlseder et al.
1996b).

We analysed the same data and adopted the same data space
deﬁnition that was used by Knödlseder et al. (1996a), yet we
tested an alternative analysis method that jointly handles the 26Al
line signal and any underlying continuum emission. This is more
in line with the GammaLib and ctools philosophy of explicitly
modelling all emission components and provides a more accu-
rate handling of underlying continuum emission. Speciﬁcally,

Table 3. Energy bins for 1.8 MeV gamma-ray line analysis.

Number Energies (MeV)
1.000 − 1.584
1.584 − 1.634
1.634 − 1.684
1.684 − 1.734
1.734 − 1.784
1.784 − 1.834
1.834 − 1.884
1.884 − 1.934
1.934 − 1.984
1.984 − 2.034
2.034 − 3.000

1
2
3
4
5
6
7
8
9
10
11

Notes. Bins 1 and 11 serve primarily to constrain continuum gamma-
ray emission, while bins 2 − 10 serve to trace the shape of the 1.8 MeV
gamma-ray line.

Fig. 17. Orbital light curve of LS 5039 in the 10 − 30 MeV energy
band. Data points for the ctools analysis were displaced by ±0.02 in
phase for clarity. Analysis results obtained under analysis conditions
identical to those in Collmar & Zhang (2014) (ζmin = 0◦ and fpmtflag
= 2) are shown as triangles and dashed error bars, and results obtained
using ζmin = 5◦ and fpmtflag = 0 are shown as dots and solid error
bars. Vertical lines indicate the deﬁnitions of the INFC and SUPC phase
intervals.

Zhang (2014). In addition, we also derived for both phase in-
tervals the uncertainty band of the ﬁtted power-law model us-
ing ctbutterfly. The results are shown in Fig. 16. For the
left panel we used exactly the same event selection that was
used by Collmar & Zhang (2014) which is a minimum distance
from the Earth horizon of ζmin = 0◦ and the use of circular ex-
clusion regions to handle D2 modules with failed PMTs (i.e.
fpmtflag = 2; cf. Appendix E). Only with this event selection
we were able to reproduce the 1 − 3 MeV ﬂux point of Collmar
& Zhang (2014), while using our standard setting of ζmin = 5◦
and fpmtflag = 0 that excludes D2 modules with failed PMTs
produced a notable variation of the 1−3 MeV ﬂux point between
inferior and superior conjunction. To verify that this variation
can indeed be attributed to diﬀerences in the event selection, we
also did an equivalent analysis with COMPASS using ζmin = 5◦
and fpmtflag = 0. This resulted in a 1 − 3 MeV ﬂux variation
between inferior and superior conjunction that was similar to that
observed in our analysis, conﬁrming that the spectral diﬀerences
are due to diﬀerences in the event selection. The corresponding
results are summarised in the right panel of Fig. 16.

As illustrated by the uncertainty bands of the ﬁtted power-
law model, the use of circular exclusion regions for D2 modules
with faulty PMTs leads to a ﬂatter (or softer) spectrum in supe-
rior conjunction, yet the variation seems still to remain within
statistical uncertainties, given the broadness of the uncertainty
band. After all, LS 5039 is a very faint source in SUPC, and
hence its spectral properties are only poorly constrained in this
phase interval.

Finally, we derived the orbital ﬂux variation in the 10 − 30
MeV energy band for the two diﬀerent event selections to repro-
duce Fig. 8 of Collmar & Zhang (2014). For this purpose we split
the 10−30 MeV data into ﬁve phase intervals of equal length and
ﬁtted the data using comlixfit with a source model comprising
components for LS 5039, PKS 1830–210, bremsstrahlung emis-
sion, inverse Compton emission and cosmic background emis-
sion (see above for details). The background was modelled us-
ing the BGDLIXE algorithm with parameters Navgr = 5 and
Nincl = 15. The results are shown in Fig. 17.

Article number, page 18 of 31

0.000.250.500.751.001.251.501.752.00Orbital phase0.00.51.01.52.02.53.03.510-30 MeV flux (10−5 (h cm−2 s−1)INFCSUPCf(mtfla =0 (This −o)k)f(mtfla =2 (This −o)k)Collma) & Zha&  (2014)J. Knödlseder et al.: COMPTEL data analysis using GammaLib and ctools

In their Fig. 2, Knödlseder et al. (1996a) present a 1.8 MeV
line emission maximum likelihood map of the Carina region,
and we produced an equivalent TS map with the same spatial
binning using comlixmap. Speciﬁcally, we ﬁtted point-source
models for the 1.8 MeV line emission and the 1 − 3 MeV con-
tinuum emission for a grid of source positions, producing hence
TS maps for both emission components. In the ﬁtting the ﬂuxes
of both point sources were constrained to non-negative values.
The resulting maps are shown in Fig. 19, where the left map can
be compared to the maximum likelihood map presented in Fig. 2
of Knödlseder et al. (1996a). Both maps show qualitatively com-
parable features, yet we obtained a maximum TS value of 23.1
at (l, b) = (285.5◦, 1.5◦) while Knödlseder et al. (1996a) found a
lower maximum TS value of 14.7 at (l, b) = (286.5◦, 0.5◦). Even-
tually, these diﬀerences may be explained by the background
modelling techniques and analysis methods that diﬀer signif-
icantly between the studies. We recall that Knödlseder et al.
(1996a) analyse the 1.8 MeV line data in a single energy bin cov-
ering 1.7 − 1.9 MeV and used a background model derived from
adjacent energy bands, which to ﬁrst order includes also contin-
uum emission, but which does not properly account for spectral
diﬀerences between instrumental background and diﬀuse emis-
sion components as well as diﬀerences in their ¯ϕ distributions
(Bloemen et al. 1999).

It is actually rather reassuring that both approaches pro-
duce qualitatively comparable maps, as already suggested by
Bloemen et al. (1999) who implemented a comparable analy-
sis method to ours. The continuum TS map indicates that the
continuum emission is located towards the Galactic plane, sug-
gesting that it originates from our Galaxy. We emphasise, how-
ever, that the statistical signiﬁcance of the emission features is
modest, and consequently the appearance of the map is notably
aﬀected by the statistical ﬂuctuations of the data. Nevertheless,
we note that observed TS maxima are not too far from maxima in
the Galactic bremsstrahlung emission, which eventually may be
the dominant MeV emission component near the Galactic plane
(Strong et al. 1996).

As the next step we ﬁtted the data with a source model com-
posed of a 1.8 MeV line component modelled using a point
source and a 1 − 3 MeV continuum component modelled us-
ing a combination of bremsstrahlung and inverse Compton spa-
tial maps as well as an isotropic component for the cosmic
gamma-ray background. The position of the point-source model
as well as the spectral parameters for the Galactic continuum
power-law components were free parameters in the ﬁt. Fitting
the data using comlixfit gave a best ﬁtting position of (l, b) =
(285.4◦ ±0.8◦, 1.3◦ ±0.7◦), a ﬂux of (3.1±0.6)×10−5 ph cm−2 s−1
and a TS value of 22.3 for the 1.8 MeV line component. Our 1.8
MeV line ﬂux is consistent with the value of (3.1 ± 0.8) × 10−5
ph cm−2 s−1 found by Knödlseder et al. (1996a), yet our best ﬁt-
ting position is oﬀset by about 1.4◦ from the one found in their
analysis. Replacing the point source for the 1.8 MeV line com-
ponent by a radial disk model did not improve the ﬁt and led
to a best ﬁtting disk radius of 0.003◦, which is near the mini-
mum value of 0.001◦ that we allowed in the analysis. Using the
ctulimit tool we derived a 2σ upper limit of 5.1◦ for the diam-
eter of the disk, a bit smaller than the value of 5.6◦ determined by
Knödlseder et al. (1996a). This diﬀerence is plausibly explained
by the larger detection signiﬁcance of the 1.8 MeV line emission
signal in our analysis, allowing us to put a stronger constraint on
the extent of the emission region.

Finally, we tried to reproduce Fig. 5.5 of Knödlseder (1994)
that shows the variation of the maximum log-likelihood value
and the ﬁtted 1.8 MeV line ﬂux as a function of spatial disk ra-

Article number, page 19 of 31

Fig. 18. Count spectrum of the Carina region determined for 11 bins
covering the energy band 1 − 3 MeV. The top panel shows the measured
number of counts per MeV together with the best ﬁtting background
model (green dashed), composed of instrumental background (green
dotted) and cosmic gamma-ray background. The combined source and
background model is shown as a black solid line. The bottom panel
shows the background model-subtracted count spectrum together with
the best ﬁtting 1.8 MeV line model (red solid) on top of the com-
bined Galactic continuum components (blue dashed), composed of
bremsstrahlung (blue dotted) and inverse Compton emission (blue dash-
dotted).

we split the data within the 1 − 3 MeV energy interval into 11
energy bins, speciﬁed in Table 3, and analysed them jointly us-
ing a combination of model components describing the 1.8 MeV
line signal, any underlying continuum gamma-ray emission and
the instrumental background. To model the 1.8 MeV line emis-
sion spectrum we used a Gaussian spectral component with a
ﬁxed mean of 1.809 MeV and a standard deviation of σ = 58.9
keV that corresponds to COMPTEL’s instrumental energy res-
olution at that energy. Similarly to our analysis of LS 5039 we
modelled continuum emission using template maps for Galactic
bremsstrahlung and inverse Compton emission and an isotropic
component for the cosmic gamma-ray background. The spec-
tra of the three continuum components were model using power
laws, where the prefactors and indices were free for the Galac-
tic components, while the prefactor and index were ﬁxed to
I(Eγ) = 1.12 × 10−4(Eγ/5 MeV)−2.2 ph cm−2 s−1 MeV−1 sr−1
for the cosmic gamma-ray background component, as suggested
by Weidenspointner (1999). The TS map was generated using
comlixmap and model ﬁtting was done using comlixfit with
the standard BGDLIX parameters Navgr = 5 and Nincl = 15.

We illustrate our analysis procedure in Fig. 18, which shows
the counts spectrum determined using Eq. (24) for the posi-
tion (l, b) = (286.5◦, 0.5◦) at which Knödlseder (1994) found
the 1.8 MeV line emission maximum and an ARM window of
±3◦. We also show the model components that were ﬁtted us-
ing comlixfit and that we extracted using Eq. (25). We used a
point source located at the ﬁxed position (l, b) = (286.5◦, 0.5◦) as
spatial model for the 1.8 MeV line component. Figure 18 illus-
trates that the data are dominated by instrumental background,
followed by cosmic gamma-ray background. The bottom panel
illustrates that, once these components are subtracted, a clear line
signal becomes apparent that is compatible with the expected
signature of the 26Al decay line. In addition, a continuum signal
is detected that is dominated by Galactic bremsstrahlung emis-
sion.

1.001.251.501.752.002.252.502.753.00Energy (MeV)100000150000200000Counts / MeVTotal (source + background)Background (instrumental + cosmic)Instrumental background1.001.251.501.752.002.252.502.753.00Energy (MeV)025005000750010000Residuals / MeV1.8 MeV lineGalactic continuumBremsstrahlungInverse ComptonA&A proofs: manuscript no. arxiv

Fig. 19. Test statistic maps of 1.8 MeV line emission (left) and 1 − 3 MeV continuum emission (right) obtained using comlixmap for the Carina
region. The map on the left is equivalent to Fig. 2 of Knödlseder et al. (1996a). Dashed contours in the map on the right reﬂect the intensity of
a combination of Galactic bremsstrahlung and inverse Compton emission maps as ﬁtted in an independent analysis where a model of a 1.8 MeV
line point source was ﬁtted together with a combination of bremsstrahlung and inverse Compton spatial maps to the data (see text).

background model, resulting in a much more constrained overall
model that leaves little freedom for the model to adjust.

5. Conclusion

We have implemented a comprehensive science analysis frame-
work for COMPTEL gamma-ray data in the GammaLib and
ctools software packages, and we have demonstrated that our
software reliably reproduces published analysis results that were
derived using the COMPASS software. Having public, free, and
validated software for COMPTEL science data analysis now
opens the HEASARC COMPTEL archive to the community for
scientiﬁc exploration. In the medium-energy gamma-ray band,
from 1 − 30 MeV, the COMPTEL archive still contains the most
sensitive observations ever performed, and a unique dataset for
exploring the non-thermal Universe and nuclear transition lines.
Since the 1990s when the COMPTEL data were taken, the ﬁeld
of gamma-ray astronomy has made impressive progress thanks
to satellites such as the International Gamma-Ray Astrophysics
Laboratory (INTEGRAL) and Fermi and ground-based observa-
tories such as the High Energy Stereoscopic System (H.E.S.S.),
the Major Atmospheric Gamma-ray Imaging Cherenkov Tele-
scope (MAGIC), and the Very Energetic Radiation Imaging
Telescope Array System (VERITAS). Many source classes that
are known today were not established as gamma-ray emitters
during the COMPTEL era, and the COMPTEL data were never
comprehensively analysed with the current knowledge in the
ﬁeld. An exception to this is the post-mission discovery of the
orbital modulation of MeV gamma-ray emission of LS 5039
in the COMPTEL archival data by Collmar & Zhang (2014),
a source that was not an established gamma-ray emitter in the
1990s. Thanks to GammaLib and ctools, such discoveries are
now achievable by the community at large.

We want to stress that our work was also motivated by the
goal of reducing the carbon footprint of astronomical research.
As recently pointed out by Knödlseder et al. (2022), the cur-
rent deployment rate of new astronomical observatories is not
compatible with the imperative of reducing the carbon footprint
across all activity sectors of modern societies, and this calls
for fundamental changes in astronomical practices in the future.
Among the many possible alternatives to the building of ever

Fig. 20. Variation in maximum log-likelihood with increasing radius of
the disk model (left) and ﬁtted 1.8 MeV line ﬂux (right). Data shown
as red ﬁlled dots and solid lines are those derived in this work, and data
shown as blue open dots and dashed lines are taken from Knödlseder
(1994).

dius. For that purpose, we determined the maximum likelihood
solution for a disk model with position ﬁxed at our maximum
likelihood solution (l, b) = (285.4◦, 1.3◦) for a set of disk radius
values starting with 0.001◦, and followed by 1◦ up to 10◦ with a
step size of 1◦. The results of our analysis are shown in Fig. 20,
which also includes the results shown in Fig. 5.5 of Knödlseder
(1994) for comparison. The log-likelihood proﬁle between both
analyses is very similar, yet our analysis turns out to be a bit more
constraining, probably owing to the more signiﬁcant detection of
the 1.8 MeV line emission feature with respect to the analysis of
Knödlseder (1994). The ﬂux attributed to the 1.8 MeV line com-
ponent changes actually very little with disk radius in our analy-
sis, while in Knödlseder (1994) the ﬂux decreases with increas-
ing disk radius. This diﬀerence is probably partly due to fact that
our analysis detects the 1.8 MeV line signal more signiﬁcantly,
but may also be related to our analysis method that gives free-
dom to the continuum emission model components to adjust as a
function of the 1.8 MeV disk model radius, while in Knödlseder
(1994) the continuum emission was implicitly subtracted by the

Article number, page 20 of 31

280285290295Galactic longit de (deg)−10.0−7.5−5.0−2.50.02.55.07.510.0Galactic latit de (deg)26Al280285290295Galactic longit de (deg)−10.0−7.5−5.0−2.50.02.55.07.510.0Galactic latit de (deg)Contin  m05101520Test Statistic0123456Test Statistic0.02.55.07.510.0Disk radius (deg)−8−6−4−20Log-likelihood differenceThis workKnödlseder et al. (1994)0.02.55.07.510.0Disk radius (deg)−1012341.8 MeV line flux (10−5 ph c −2 s−1s)This )orkKn(dlseder et al. (1994)J. Knödlseder et al.: COMPTEL data analysis using GammaLib and ctools

more and ever bigger new astronomical facilities is the exploita-
tion of archival data from past missions that may have scientiﬁc
treasures yet to be discovered. Since version 2.0.0, ctools esti-
mates the carbon footprint of its use based on the assessment of
Berthoud et al. (2020) for the GRICAD computing centre, and,
using this feature, we estimate that the work presented in this
publication resulted in the generation of 600 ± 300 kgCO2e of
greenhouse gases (GHGs) due to the computing related to the
analysis of archival data. This is about 40 times less than the
median per-publication emissions associated with the analysis of
data from an active astronomical observatory (Knödlseder et al.
2022). Taking all sources of emissions related to this work into
account, we estimate the carbon footprint of this research to be
1.9 ± 0.3 tCO2e (see Appendix H).

This assessment illustrates that the exploitation of archival
data instead of the development of new astronomical observato-
ries has the potential to dramatically reduce the carbon footprint
of astronomical research, which would help realise the reduc-
tions that are needed to limit global warming and reach the goals
of the Paris Climate Agreement. Past missions can be seen as
our scientiﬁc carbon legacy since the GHGs that were emitted
during their construction and operations are to a large extent still
present in the Earth’s atmosphere. To assure that these GHGs
were at least not emitted in vain, conservation of the archival
data and the development and maintenance of software for their
exploitation should therefore be of the utmost importance.

Acknowledgements. We would like to thank the anonymous referee for the very
careful reading of the manuscript and the many constructive suggestions. This
research made use of ctools, a community-developed gamma-ray astronomy
science analysis software (Knödlseder et al. 2016). ctools is based on Gam-
maLib, a community-developed toolbox for the scientiﬁc analysis of astronom-
ical gamma-ray data (Knödlseder et al. 2011). This work has made use of the
Python 2D plotting library matplotlib (Hunter 2007). This research has made
use of data and/or software provided by the High Energy Astrophysics Science
Archive Research Center (HEASARC), which is a service of the Astrophysics
Science Division at NASA/GSFC. This research has made use of the SIMBAD
database, operated at CDS, Strasbourg, France. This research is part of the #Low-
CarbonScience initiative that aims in reducing the carbon footprint of scientiﬁc
research, and has beneﬁtted from discussions held in the context of the GDR
Labos 1point5 and the Astro4Earth initiative.

References

Abdollahi, S., Acero, F., Ackermann, M., et al. 2020, ApJS, 247, 33
Berthoud, F., Bzeznik, B., Gibelin, N., et al. 2020, Estimation de l’empreinte car-
bone d’une heure.coeur de calcul, Research report, UGA - Université Greno-
ble Alpes ; CNRS ; INP Grenoble ; INRIA

Bloemen, H., Diehl, R., Hermsen, W., Knödlseder, J., & Schönfelder, V. 1999,

Astrophysical Letters and Communications, 38, 391

Bloemen, H., Hermsen, W., Swanenburg, B. N., et al. 1994, ApJS, 92, 419
Casares, J., Ribó, M., Ribas, I., et al. 2005, MNRAS, 364, 899
Cash, W. 1979, ApJ, 228, 939
Coleman, A. & McConnell, M. 2020, in American Astronomical Society Meet-
ing Abstracts, Vol. 235, American Astronomical Society Meeting Abstracts
#235, 206.04

Collmar, W., Wessolowski, U., Schönfelder, V., et al. 1997, in American Institute
of Physics Conference Series, Vol. 410, Proceedings of the Fourth Compton
Symposium, ed. C. D. Dermer, M. S. Strickman, & J. D. Kurfess, 1587–1591

Collmar, W. & Zhang, S. 2014, A&A, 565, A38
de Vries, C. P. & COMPTEL collaboration. 1994, in Astronomical Society of
the Paciﬁc Conference Series, Vol. 61, Astronomical Data Analysis Software
and Systems III, ed. D. R. Crabtree, R. J. Hanisch, & J. Barnes, 399

Diehl, R., Aarts, H., Bennett, K., et al. 1992, in Data Analysis in Astronomy,

201–216

Hunter, J. D. 2007, Computing In Science & Engineering, 9, 90
IPBES. 2019, Global assessment report on biodiversity and ecosystem ser-
vices of the Intergovernmental Science-Policy Platform on Biodiversity and
Ecosystem Services, ed. E. S. Brondizio, J. Settele, S. Díaz, & H. T. Ngo
(IPBES secretariat, Bonn, Germany)

IPCC. 2021, Climate Change 2021: The Physical Science Basis. Contribution
of Working Group I to the Sixth Assessment Report of the Intergovernmen-
tal Panel on Climate Change, ed. V. Masson-Delmotte, P. Zhai, A. Pirani,
S. Connors, C. Péan, S. Berger, N. Caud, Y. Chen, L. Goldfarb, M. Gomis,
M. Huang, K. Leitzell, E. Lonnoy, J. Matthews, T. Maycock, T. Waterﬁeld,
O. Yelekçi, R. Yu, & B. Zhou (Cambridge University Press), in press

IPCC. 2022, Climate Change 2022: Impacts, Adaptation, and Vulnerability. Con-
tribution of Working Group II to the Sixth Assessment Report of the Inter-
governmental Panel on Climate Change, ed. H.-O. Pörtner, Roberts, M. D.C.,
Tignor, E. Poloczanska, K. Mintenbeck, A. Alegría, M. Craig, S. Langsdorf,
S. Löschke, M. V., A. Okem, & B. Rama (Cambridge University Press), in
press

Knödlseder, J. 1994, diplomarbeit, Technische Universität München
Knödlseder, J., Bennett, K., Bloemen, H., et al. 1996a, A&AS, 120, 327
Knödlseder, J., Brau-Nogué, S., Coriat, M., et al. 2022, Nature Astronomy, 6,

503

Knödlseder, J., Mayer, M., Deil, C., et al. 2016, Astrophysics Source Code Li-

brary [ascl:1601.005]

Knödlseder, J., Mayer, M., Deil, C., et al. 2011, Astrophysics Source Code Li-

brary [ascl:1110.007]

Knödlseder, J., von Ballmoos, P., Diehl, R., et al. 1996b, in Society of Photo-
Optical Instrumentation Engineers (SPIE) Conference Series, Vol. 2806,
Gamma-Ray and Cosmic-Ray Detectors, Techniques, and Missions, ed. B. D.
Ramsey & T. A. Parnell, 386–397

Kuiper, L., Hermsen, W., Cusumano, G., et al. 2001, A&A, 378, 918
Landrigan, P., Fuller, R., Acosta, N., et al. 2017, The Lancet, 391
Martin, P., Brau-Nogué, S., Coriat, M., et al. 2022, arXiv e-prints,

arXiv:2204.12362

Mattox, J. R., Bertsch, D. L., Chiang, J., et al. 1996, ApJ, 461, 396
Much, R., Bennett, K., Buccheri, R., et al. 1995a, A&A, 299, 435
Much, R., Bennett, K., Buccheri, R., et al. 1995b, Advances in Space Research,

15, 81

Much, R., Harmon, B. A., Nolan, P., et al. 1996, A&AS, 120, 703
Pence, W. D., Chiappetti, L., Page, C. G., Shaw, R. A., & Stobie, E. 2010, A&A,

524, A42

Schönfelder, V., Aarts, H., Bennett, K., et al. 1993, ApJS, 86, 657
Stacy, J. G., Kippen, R. M., Kappadath, S. C., et al. 1996, A&AS, 120, 691
Strong, A. & Collmar, W. 2019, Mem. Soc. Astron. Italiana, 90, 297
Strong, A. W., Bennett, K., Bloemen, H., et al. 1996, A&AS, 120, 381
van der Meulen, R. D., Bloemen, H., Bennett, K., et al. 1998, A&A, 330, 321
van Dijk, R. C. A. 1996, PhD thesis, University of Amsterdam
Weidenspointner, G. 1999, PhD thesis, Technical University Munich
Weidenspointner, G., Varendorﬀ, M., Oberlack, U., et al. 2001, A&A, 368, 347

Article number, page 21 of 31

A&A proofs: manuscript no. arxiv

Appendix A: HEASARC archive

COMPTEL data in the HEASARC archive are grouped by so-
called viewing periods with typical durations of two weeks dur-
ing which the CGRO satellite had a stable pointing. In total,
there exist 359 viewing periods, of which 278 were archived at
HEASARC, covering viewing periods 1.0 to 719.0, where the
ﬁrst digit indicates the mission year or phase, with viewing peri-
ods smaller than 100 corresponding to mission year one. Some of
the viewing periods that are available in the HEASARC archive
cannot be exploited due to corrupted or missing data ﬁles, or
spacecraft operations that prevented data taking. The 23 view-
ing periods in the range 1.0 to 719.0 that are not exploitable are
listed in Table A.1. This leaves 255 exploitable viewing periods
in the HEASARC archive, which is about 71% of the total num-
ber of 359 viewing periods that were executed during the CGRO
mission.

Table A.1. Inexploitable viewing periods in the range 1.0 to 719.0 in
the COMPTEL HEASARC archive.

Target

G 224 − 40

Perseids shower

Reason
Missing EVP ﬁle
EVP ﬁle unreadable
Missing EVP ﬁle
Missing EVP ﬁle
Missing EVP ﬁle
Missing EVP ﬁle
Missing EVP ﬁle
Missing EVP ﬁle
Missing EVP ﬁle
Missing EVP ﬁle
Missing EVP ﬁle
Missing EVP ﬁle
Invalid event times in EVP

VP
22.0 Mrk 279
29.0
225.0 CGRO reboost
229.3
229.5 Gal 5 + 5
303.4 Not executed
303.5 Reboost
303.7 Nova Cygnus 92
308.3 Reboost
308.6 Virgo 283 + 75
311.3 Reboost
311.6 Virgo 284 + 75
426.0 Anticenter
617.2 CGRO reboost test Missing EVP ﬁle
617.4 CGRO reboost test Missing EVP ﬁle
Missing EVP ﬁle
617.6 CGRO reboost
Missing EVP ﬁle
619.0 Cir X–1
Missing EVP ﬁle
619.5 CGRO reboost
PSR 1055 − 52
Missing EVP ﬁle
627.0
Missing EVP ﬁle
632.0 Not executed
PKS 0235 + 164
Missing EVP ﬁle
632.1
2EG J1835 + 5919 Missing OAD ﬁles
711.0
Missing EVP ﬁle
718.0 Cen X–3

The HEASARC archive was created from the original
COMPTEL data using dedicated ﬁle conversion software that
generated FITS ﬁles following recognised standards (Pence
et al. 2010). While interpreting these FITS ﬁles using Gam-
maLib we found that the units in some of the table columns
were not correct. We summarise the inconsistencies that we en-
countered in Table A.2. We furthermore found that the good
time interval dataset for viewing period 8.0 with the identiﬁer
MPE-TIM-11481 only contains about half of the good time in-
tervals that were deﬁned in COMPASS, probably as the result of
a ﬁle truncation error in the input ASCII ﬁle that was used for
the generation of the FITS ﬁle in the HEASARC archive.

The HEASARC archive also comprises binned data products
for standard energy bands that can be used for analysis using
GammaLib, yet we note that the world coordinate system infor-
mation attached to these data products is incorrect. While the
FITS headers suggest that the data cubes are provided in Merca-
tor projection, the event cubes are presented in a cartesian pro-

Article number, page 22 of 31

Table A.2. Incorrect header units in FITS ﬁles in the COMPTEL
HEASARC archive.

File Column
EVP
EVP
EVP
EVP
EVP
EVP
EVP
BVC
BVC
BVC

TOF
PHIBAR
GLON_SCAT
GLAT_SCAT
AZIMUTH_SCAT
ZENITH_SCAT
EARTH_HORIZON
SSB_X
SSB_Y
SSB_Z

Written unit True unit
channels
ns
rad
deg
rad
deg
rad
deg
rad
deg
rad
deg
rad
deg
milli light seconds
km
milli light seconds
km
milli light seconds
km

jection with a reference latitude value of 0. For all event cubes
given in Mercator projection GammaLib assumes that they orig-
inate from the HEASARC archive and corrects the world coor-
dinate system information upon reading of the event cubes.

The HEASARC archive comprises further data products
such as telescope housekeeping data, gamma-ray burst detector
data and sky maps that are not used by GammaLib.

Appendix B: Time of ﬂight conversion
The HEASARC archive mixes diﬀerent versions of EVP ﬁles that
have diﬀerent levels of processing for the ToF values. The ver-
sions can be distinguished by the header keyword DSD_REP in
the EVP ﬁle, specifying either 2 for ToFII or 3 for ToFIII, where
the latter corrects for energy dependent eﬀects, aligning the for-
ward peak at channel number 120 (see van Dijk 1996 and Wei-
denspointner 1999 for an explanation of the ToF corrections). If
a version 2 EVP is encountered, the GCOMEventList class will
automatically convert ToFII values into ToFIII using

ToFIII = ToFII + 120 −


6(cid:88)



i=0

aiEi
1

+

4(cid:88)

i=0

biEi

2 − 118.3





(B.1)

with the coeﬃcients given by Tables B.1 and B.2 and the D1 and
D2 energy deposits E1 and E2 given in MeV. For the HEASARC
archive, ToF values accessed through GammaLib are therefore
always ToFIII values.

Table B.1. Coeﬃcients, ai, for the conversion from ToFII to ToFIII.

E1 ≤ 2.25 MeV
a0
111.74858
a1
28.280247
−45.024305
a2
a3
35.18321
−14.639463
a4
a5
3.1342536
−0.2711735
a6

> 2.25 MeV
116.25374
0.500407092
0.3818272
−0.080145513
0.006556979
−0.00024650067
3.507724 × 10−6

Appendix C: Flux correction due to time of ﬂight

selection

To correct for the photon rejection by the ToF selection an
energy-dependent correction factor needs to be applied to the
instrument response. Since this correction factor depends on the
ToF selection interval, it is computed in GammaLib during the

J. Knödlseder et al.: COMPTEL data analysis using GammaLib and ctools

Table B.2. Coeﬃcients, bi, for the conversion from ToFII to ToFIII.

After applying the clock correction, event times are con-

E2
b0
b1
b2
b3
b4

≤ 1.4 MeV
181.77024
−252.4107
371.09898
−232.83985
52.918785

1.4 − 5.5 MeV
120.91608
−0.1504849
−0.45526025
0.11710009
−0.0082172427

> 5.5 MeV
119.24278
−0.43134699
0.06018308
−0.002684779
3.7720986 × 105

event binning and stored using the header keyword TOFCOR in
the DRE FITS ﬁles. The correction factor is determined from a
linear interpolation of the values given in Table C.1, evaluated
√
EminEmax of the energy interval
at the geometric mean energy
[Emin, Emax] for which the event cube is generated. Only correc-
tions for ToFmax = 130 are supported.

Table C.1. Time of ﬂight correction factors for ToFmax = 130.

ToFmin
110
111
112
113
114
115
116
117
118
119

Geometric mean energy (MeV)

0.8660
1.14
1.17
1.21
1.26
1.32
1.40
1.50
1.63
1.79
2.01

1.7321
1.07
1.09
1.11
1.15
1.20
1.27
1.36
1.47
1.63
1.85

5.4772
1.02
1.03
1.05
1.07
1.11
1.17
1.24
1.35
1.51
1.73

17.3205
1.01
1.01
1.02
1.04
1.06
1.11
1.17
1.28
1.43
1.67

verted using

tSSB = tCGRO + ∆tCGRO→SSB − ∆tShapiro + ∆tUTC→TT + ∆tTT→TBD,
(D.1)

where ∆tCGRO→SSB corrects for the light travel time from CGRO
to the Solar System barycentre, ∆tShapiro corrects for the grav-
itational time delay near the Sun, also known as Shapiro de-
lay, ∆tUTC→TT converts from UTC to terrestrial time (TT), and
∆tTT→TBD converts from TT to the TDB time system. We note
that all time correction terms are themselves time dependent, yet
we ignore this time dependence in Eq. (D.1) to simplify the no-
tation. All terms are given in units of seconds.

The computation of the three terms ∆tCGRO→SSB − ∆tShapiro +
∆tTT→TBD is implemented by the GEphemerides::geo2ssb
method, which regroups all time corrections that depend on plan-
etary ephemerides. GammaLib deals with planetary ephemerides
through the GEphemerides class, and the software includes the
Jet Propulsion Laboratory (JPL) Development Ephemeris 200
including information about the Sun position, the Earth position
and its ﬁrst three time derivatives, and the time diﬀerence be-
tween TT and TDB in seconds on a daily basis between Julian
day (JD) 2436913 (10 December 1959) and 2469807 (31 De-
cember 2049). Speciﬁcally, the method computes

∆tCGRO→SSB = ˆn · (e + r)

and

∆tShapiro = −2t(cid:12) ln

(cid:32)
1 + ˆn · (e + r − s)
|e + r − s|

(cid:33)

,

Appendix D: Pulsar timing

ˆn =

where




cos δ cos α
cos δ sin α
sin δ





GammaLib supports generation of event cubes, geometry func-
tions and exposure maps for phase-resolved pulsar analysis.
For this purpose a speciﬁc processing is implemented in the
methods GCOMDri::compute_dre, GCOMDri::compute_drg,
and GCOMDri::compute_drx that
is used if the speciﬁed
GCOMSelection instance includes pulsar ephemerides data and
the speciﬁcation of pulsar phase intervals. All three methods will
ﬁrst trim the good time intervals of the observation so that they
only cover periods for which the speciﬁed pulsar ephemerides
are valid. In that way, GammaLib assures that only data will
be used for an analysis that cover intervals with valid pulsar
ephemeris information.

The remaining pulsar-speciﬁc code is implemented in
GCOMDri::compute_dre. First, the method converts arrival
times tCGRO of COMPTEL events at the CGRO satellite, speci-
ﬁed in the Coordinated Universal Time (UTC) time system, into
arrival times tSSB at the Solar System barycentre, speciﬁed in the
barycentric dynamical time (TDB) system.

As a side note, before 1992-06-25T01:00:00 UTC the CGRO
onboard clock was early by 2.042144 seconds, and this time
diﬀerence needs to be subtracted from the measured onboard
time to get the true arrival time in UTC. In GammaLib, this
subtraction is automatically performed when converting on-
board times, given in truncated Julian days (TJDs) and tics,
into GTime objects using the gammalib::com_time function,
and the conversion is undone when using the inverse functions
gammalib::com_tjd and gammalib::com_tics.

is the unit vector in celestial coordinates of a pulsar with right
ascension α and declination δ, e is the vector from the Solar Sys-
tem barycentre to the centre of the Earth, s is the vector from the
Solar System barycentre to the centre of the Sun, r is the vector
from the centre of the Earth to the CGRO spacecraft, and

t(cid:12) = 4.92549 × 10−6

(D.5)

is half the Schwarzschild radius of the Sun divided by the speed
of light. All vectors are given in units of light seconds and are
speciﬁed in the celestial coordinate system.

The Earth vector e at a given time tCGRO (speciﬁed in the TT

time system) is computed using the Taylor expansion

e = e(i) + ˙e(i)∆t + 1
2

¨e(i)∆t2 + 1
6

...
e (i)∆t3,

(D.6)

where i is the index of the nearest entry in time in the JPL
...
e (i) is the Earth position and its
database, e(i), ˙e(i), ¨e(i), and
ﬁrst three time derivatives for this entry, and

∆t = tCGRO − t(i)

(D.7)

is the time diﬀerence between the event time and the nearest
entry in the JPL database in units of days, which by deﬁnition
is in the range −0.5 and +0.5. Since the Sun moves only a little
around the Solar System barycentre, it is suﬃcient to take for
the Sun vector the nearest entry in the JPL database, which is

Article number, page 23 of 31

(D.2)

(D.3)

(D.4)

A&A proofs: manuscript no. arxiv

s = s(i). Finally, the conversion from the TT to the TDB time
system at a given time tCGRO is computed using

∆tTT→TDB = ∆tTT→TDB(i) + (∆tTT→TDB(i + 1) − ∆tTT→TDB(i))∆t,
(D.8)

where ∆tTT→TDB(i) is the nearest entry in the JPL database.

The last term in the time correction, ∆tUTC→TT, does not de-

pend on planetary ephemerides and is given by

∆tUTC→TT = 32.184 + nleap,

(D.9)

where nleap is the number of leap seconds. The computation of
∆tUTC→TT is implemented by the GTime::utc2tt method.

The HEASARC archive includes for most of the viewing pe-
riods ﬁles that provide for each superpacket the vectors e + r
as well as the correction terms ∆tUTC→TT + ∆tTT→TBD, avoid-
ing the need for planetary ephemerides. These so-called BVC
data can be handled by GammaLib through the classes GCOMBvc
and GCOMBvcs that manage individual data records as well as
entire ﬁles. Speciﬁcally, the method GCOMBvcs::tdelta com-
putes ∆tCGRO→SSB − ∆tShapiro + ∆tUTC→TT + ∆tTT→TBD, and if
the observation that should be binned includes BVC information,
GCOMDri::compute_dre will use this method instead of the al-
gorithm described above for the barycentric time correction. The
formulae used by GCOMBvcs::tdelta are identical to those de-
scribed above, except for the Shapiro time delay for which the
displacement of the Sun from the Solar System barycentre is ne-
glected:

∆tShapiro = −2t(cid:12) ln

(cid:32)

1 + ˆn · (e + r)
|e + r|

(cid:33)

.

(D.10)

Following the time correction, the pulsar phase Φ is com-
puted using the GPulsarEphemeris::phase method that im-
plements
Φ = Φ0 + ν∆t + 1
2

˙ν∆t2 + 1
6

(D.11)

¨ν∆t3,

where ν, ˙ν and ¨ν is the pulsar frequency and its ﬁrst two time
derivatives, ∆t = tSSB − t0 is the elapsed time since the reference
time of the ephemeris, and Φ0 is the pulsar phase at the reference
time. Only the fractional part of the pulsar phase is retained so
that its value is within the interval [0, 1).

Pulsar information, including speciﬁcally the ephemerides of
a pulsar, is handled by the GPulsar class that supports reading
of ephemeris information from various ﬁle formats. The format
most relevant to COMPTEL is the psrtime format, which is an
ASCII ﬁle format containing the radio pulsar database as main-
tained during the CGRO mission by the pulsar group at Prince-
ton and nowadays by the Jodrell Bank Centre for Astrophysics.12
Upon loading of a psrtime ﬁle, the GPulsar::load_psrtime
method computes from the data the pulsar phase at the reference
time using
Φ0 = ν∆t + 1
2

˙ν∆t2 + 1
6

(D.12)

¨ν∆t3,

where

∆t =(MJD0 − |MJD0|) × 86400 + ∆tCGRO→SSB − ∆tShapiro+

∆tUTC→TT + ∆tTT→TBD

(D.13)

12 https://www.jodrellbank.manchester.ac.uk

Article number, page 24 of 31

and MJD0 is the modiﬁed Julian day of the ephemeris reference
(the GEphemerides::geo2ssb method is used for this compu-
tation, and hence the Shapiro delay in Eq. (D.13) includes the
displacement of the Sun around the Solar System barycentre,
cf. Eq. (D.3)).

Appendix E: Handling of failed photomultiplier

tubes

COMPTEL comprised two detector layers, composed of 7 and
14 circular modules for D1 and D2, respectively. Modules of
the ﬁrst layer were composed of the liquid scintillator NE 213A
while modules of the second layer were made of NaI(Tl) scintil-
lator crystals. Each D1 module was viewed by eight PMTs while
each D2 module was viewed by seven PMTs. The relative ampli-
tudes of the PMT signals for a given module allowed localisation
of the interactions within the module with an average 1σ spatial
resolution of 2.3 cm for D1 modules and 1.5 cm for D2 modules
(Schönfelder et al. 1993).

During the operations of COMPTEL a certain number of D2
module PMTs failed (cf. Table E.1), degrading the interaction lo-
calisation capabilities within the concerned modules and hence
increasing the uncertainties in the determination of the event
scatter directions (χ, ψ). GammaLib implements several options
for handling data from D2 modules with failed PMTs, controlled
through the GCOMSelection::fpmtflag method that takes an
integer value of 0, 1, or 2. This integer value is a user parameter
of the ctools scripts comobsbin and compulbin that, by default,
is assumed to be 0.

For fpmtflag = 0, events registered in D2 modules with
failed PMTs are ignored, and the corresponding modules are also
excluded in the computation of the geometry function (cf. Ap-
pendix F). Conversely, for fpmtflag = 1 the failure of the
PMTs is ignored, and events from D2 modules are treated as
if the failed PMTs were still operating. Finally, for fpmtflag
= 2, circular exclusion regions are applied around the zones of
the failed PMTs for dates after their failure, as deﬁned in Table
E.1. Events localised within these regions are ignored and the
regions are removed in the computation of the geometry func-
tion (cf. Appendix F). Using circular exclusion regions was the
default for most of the COMPTEL analysis published in the lit-
erature in the past. The impact of the fpmtflag value on the
analysis results is illustrated for the case of the spectral energy
distribution of LS 5039 in Sect. 4.3.

Table E.1. D2 module exclusion circles applied following the failure of
PMTs at the speciﬁed dates.

TJD
8718
8737
8756
8981

VP
24.0
26.0
28.0
204.0

Date
6-4-1992
25-4-1992
14-5-1992
25-12-1992

Module
13
11
14
2

xe
9.0
-51.7
-34.7

ye
41.2
8.7
49.0
entire module

re
9.0
9.0
9.0

Notes. Module numbers are counted from 1. The circle centre locations
x and y and the circle radii r are given in units of cm.

Appendix F: Computation of the geometry function

The geometry function DRG is computed in GammaLib by the
method GCOMDri::compute_drg using
(cid:88)
DRG(χ, ψ, ¯ϕ) = 1
N

˜Gi(χ, ψ, ¯ϕ)

(F.1)

i∈{S }

where

δD1
k

=

and

δD2
l

=

(cid:40)

(cid:40)

with

(cid:40)

˜Gi(χ, ψ, ¯ϕ) =

J. Knödlseder et al.: COMPTEL data analysis using GammaLib and ctools

and

Gi(χ, ψ),
0,

if EHA(χ, ψ) ≥ EHAmin( ¯ϕ)
otherwise

,

(F.2)

cos βkl =

1 − r2
2)

kl − (r2
d2
2dklr2

.

(F.10)

where EHA(χ, ψ) is the distance between scatter direction (χ, ψ)
and the Earth horizon, EHAmin( ¯ϕ) is given by Eq. (2), and N is
the number of selected superpackets.

The Gi(χ, ψ) is the geometry factor for a given superpacket
and corresponds to the area of the shadow that is cast by all
active D1 modules on all active D2 modules for a given scat-
ter angle (χ, ψ) divided by the total area of all D1 modules.
The computation of the geometry factor is implemented in
GCOMDri::compute_geometry and calculated using

Gi(χ, ψ) = 1
7

6(cid:88)

k=0

δD1
k

13(cid:88)

l=0

δD2
l

˜okl(θ, φ),

fkle(θ, φ) =

(F.3)

The term fkle(θ, φ) accounts for the exclusion of circular
regions around failed PMTs and diﬀers from zero only for
fpmtflag = 2. It quantiﬁes the fractional overlap between the
projected D1 module k and the part of the exclusion region for
failed PMTs that is contained within D2 module l. The exclusion
region is circular, and speciﬁed by a geometric centre position
xe and ye and a radius re as given in Table E.1. Speciﬁcally, for
fpmtflag = 2





0,
f contained
le
f partial
kle

(θ, φ),

(θ, φ),

if dkl > r1 + r2 or dke < r1 + re
if dke + re < r1
otherwise

,

(F.11)

1, D1 module k active
0, otherwise

with

(F.4)

dke =

(cid:113)

(xe − xk + h tan θ cos φ)2 + (ye − yk + h tan θ sin φ)2

(F.12)

1, D2 module l active
0, otherwise

(F.5)

are determined using the GCOMStatus class.
In case of
fpmtflag = 0, failed modules according to Table E.1 are also
considered as inactive for superpacket dates after the dates of
PMT failure. Furthermore,

˜okl(θ, φ) =





0,
1 − fkle(θ, φ),
okl(θ, φ) − fkle(θ, φ),

if dkl ≥ r1 + r2
if dkl ≤ r2 − r1 + 0.1
otherwise

,

(F.6)

with r1 = 13.8 cm being the radius of a D1 module and r2 =
14.085 cm being the radius of a D2 module. We note the mar-
gin of 0.1 cm in Eq. (F.6), which assures numerical stability with
respect to rounding errors. The dkl is the projected distance be-
tween the centres of the D1 and D2 modules, given by

dkl =

(cid:113)

(xl − xk + h tan θ cos φ)2 + (yl − yk + h tan θ sin φ)2,

(F.7)

where xk and yk are the geometric positions of the D1 modules
and xl and yl the positions of the D2 modules with respect to
the optical axis in cm, h = 158 cm being the vertical separation
between D1 and D2 modules, (θ, φ) being the zenith and azimuth
angles of the Compton scatter direction (χ, ψ) with respect to the
COMPTEL pointing direction, and

okl(θ, φ) =

1(αkl − sin αkl cos αkl) + r2
r2

2(βkl − sin βkl cos βkl)

πr2
1

(F.8)

being the projected overlap of a D1 module and a D2 module
with

cos αkl =

d2
kl

1 − r2
2)

+ (r2
2dklr1

(F.9)

being the distance between the projected D1 module centres xk
and yk and the centre xe and ye of the exclusion region.

The f contained
le

(θ, φ) is the overlap for the case that the exclu-
sion circle is fully contained in the projected D1 module circum-
ference. In this case, the relevant overlap to take into account
is the overlap between the exclusion circle and the D2 module,
given by

f contained
le

(θ, φ) =





r2
2/r2
1,
1,
˜f contained
le

if r1 > dle + r2
if r2 > dle + r1

,

(F.13)

(θ, φ), otherwise

with

dle =

(cid:113)

(xe − xl)2 + (ye − yl)2

(F.14)

being the distance between the centres of the exclusion circle
and the D2 module, and

˜f contained
le

(θ, φ) =

1(αle − sin αle cos αle) + r2
r2

2(βle − sin βle cos βle)

πr2
1

(F.15)

being the overlap of the exclusion region and the D2 module
with

cos αle =

d2
le

1 − r2
2)

+ (r2
2dler1

and

cos βle =

1 − r2
2)

le − (r2
d2
2dler2

.

(F.16)

(F.17)

The evaluation of Eq. (F.13) is implemented by the method
GCOMDri::compute_surface.

Finally, f partial

kle

(θ, φ) speciﬁes the fractional overlap between
the projected D1 module, the D2 module and the exclusion
circle. This quantity is evaluated numerically by testing a
grid of 25 × 25 x and y positions around the exclusion cir-
cle. The numerical evaluation is implemented by the method
GCOMDri::compute_overlap.

Article number, page 25 of 31

A&A proofs: manuscript no. arxiv

Appendix G: Response computation

The following sections describe some details of the response
computations implemented in GammaLib.

Appendix G.1: Efﬁciency factors
The eﬃciency factor Peﬀ(ϕ(cid:48)
cording to

geo, Eγ) in Eq. (6) is factorised ac-

Peﬀ(ϕ(cid:48)

geo, Eγ) =PA1(Eγ) × PV1(Eγ) × PD1(Eγ) × PC(Eγ) ×

PMH(Eγ) × PSV(Eγ) ×
PPSD( ˆE1) × PA2( ˆE2) × PV23( ˆE2) × PD2( ˆE2) ×
PMS(ϕ(cid:48)
,
(G.1)

geo, Eγ)

with

ˆE2 =

(cid:16)

Eγ

1 − cos ϕ(cid:48)

geo

(cid:17) Eγ
mec2

+ 1

(G.2)

being the energy of the photon entering the D2 module for a
true scatter angle ϕ(cid:48)
geo and an incident photon energy of Eγ, and
ˆE1 = Eγ − ˆE2 being the true energy deposit in D1 for a single
Compton scattering by an angle of ϕ(cid:48)
geo. The GammaLib meth-
ods that implement the computation of the eﬃciency factors are
summarised in Table G.1.

Table G.1. GammaLib methods that implement the computation of the
eﬃciency factors.

geo, Eγ)

Factor
Peﬀ(ϕ(cid:48)
PA1(Eγ)
PV1(Eγ)
PD1(Eγ)
PC(Eγ)
PMH(Eγ)
PSV(Eγ)
PPSD( ˆE1)
PA2( ˆE2)
PV23( ˆE2)
PD2( ˆE2)
PMS(ϕ(cid:48)

geo, Eγ)

Method
GCOMIaq::weight_iaq
GCOMInstChars::trans_D1
GCOMInstChars::trans_V1
GCOMInstChars::prob_D1inter
GCOMIaq::weight_iaq
GCOMInstChars::prob_no_multihit
GCOMInstChars::prob_no_selfveto
GCOMInstChars::psd_correction
GCOMInstChars::trans_D2
GCOMInstChars::trans_V23
GCOMInstChars::prob_D2inter
GCOMInstChars::multi_scatter

The PA1(Eγ) is the transmission probability for photons for
the material above D1, which is composed essentially of alu-
minium, and is computed using

PA1(Eγ) = e−µAl(Eγ) labove,

(G.3)

where µAl(Eγ) is the energy-dependent interaction coeﬃcient of
aluminium in units of cm−1 that is interpolated using a log-log
interpolation of the values given in Table G.2 and labove = 0.147
cm is the thickness of the material above D1.

The PV1(Eγ) is the transmission probability for photons for

the ﬁrst Veto dome and is computed using

PV1(Eγ) = e−µVeto(Eγ) lV1 ,

(G.4)

log-log interpolation of the values given in Table G.2 and lV1 =
1.721 cm is the thickness of the ﬁrst Veto dome.

PD1(Eγ) is the interaction probability in D1 and is computed

using
PD1(Eγ) = 1 − e−µD1(Eγ) lD1,
(G.5)
where µD1(Eγ) is the energy-dependent D1 attenuation coeﬃ-
cient in units of cm−1 that is interpolated using a log-log inter-
polation of the values given in Table G.2 and lD1 = 8.5 cm is the
thickness of the D1 modules.

PC(Eγ) is the fraction of Compton scatter interactions among

all possible photon interactions within D1 and is given by

(cid:40)

PCompton(Eγ) =

1.067 − 0.0295Eγ + 3.4 10−4E2
γ,
1,

if Eγ ≥ 2 MeV
otherwise

,

(G.6)

with the additional constraint of 0 ≤ PCompton(Eγ) ≤ 1.

The PMH(Eγ) is the probability that there is no multi-hit. This
probability is computed using a log-log interpolation of the val-
ues of Table G.2. PSV(Eγ) is the probability that the photon was
not self-vetoed. This probability is computed using a linear in-
terpolation of the values of Table G.2.

The PPSD( ˆE1) is the D1 energy-dependent PSD correction

and is given by

(G.7)

PPSD( ˆE1) = 1 −

1

,

1727.9 × ˆE1

2.53 + 1
where ˆE1 is in units of MeV. This correction applies to a standard
PSD selection of 0–110.

PA2( ˆE2) gives the transmission probability of the aluminium

below the D1 modules and is computed using
PA2( ˆE2) = e−µAl( ˆE2) lT23,
(G.8)
where µAl( ˆE2) is the energy-dependent interaction coeﬃcient for
aluminium in units of cm−1 that is interpolated using a log-log
interpolation of the values given in Table G.2 and lbetween = 0.574
cm is the thickness of the aluminium plate.

PV23( ˆE2) gives the transmission probability of the second
and third veto domes that are situated between the D1 and D2
modules, and is computed using
PV23( ˆE2) = e−µVeto( ˆE2) lV23,
(G.9)
where µVeto( ˆE2) is the energy-dependent interaction coeﬃcient
of the Veto domes in units of cm−1 that is interpolated using a
log-log interpolation of the values given in Table G.2 and lV23 =
3.442 cm is the combined thickness of the second and third veto
domes.

PD2(Eγ) gives the interaction probability in D2 and is com-

puted using
PD2(Eγ) = 1 − e−µD2( ˆE2) lD2 ,
(G.10)
where µD2( ˆE2) is the energy-dependent D2 attenuation coeﬃ-
cient in units of cm−1 that is interpolated using a log-log inter-
polation of the values given in Table G.2 and lD2 = 7.525 cm is
the thickness of the D2 modules.

The PMS(Eγ, ˆE2) is the probability that a photon that has in-
teracted in D1 leaves the D1 module without any further interac-
tion. This probability is computed using

where µVeto(Eγ) is the energy-dependent interaction coeﬃcient
for the Veto dome in units of cm−1 that is interpolated using a

PMS(ϕ(cid:48)

geo, Eγ) =

(cid:82) rD1
0

(cid:82) lD1
0

Article number, page 26 of 31

µD1(Eγ)e−µD1(Eγ)z (cid:82) π

0

e−µD1( ˆE2) l(r,z,φ) dφ dz dr

πr2
D1

(cid:0)1 − e−µD1(Eγ) lD1(cid:1)

,

Table G.2. Eﬃciency parameters as a function of energy.

J. Knödlseder et al.: COMPTEL data analysis using GammaLib and ctools

E (MeV)
0.05
0.1
0.15
0.2
0.25
0.3
0.35
0.4
0.45
0.5
0.55
0.6
0.65
0.7
0.75
0.8
0.85
0.9
0.95
1.0
1.25
1.5
1.75
2.0
2.5
3.0
3.5
4.0
4.4
4.5
5.0
5.5
6.0
6.1
6.5
7.0
7.5
8.0
8.5
9.0
9.5
10.0
12.0
12.5
15.0
17.5
20.0
20.5
25.0
30.0
35.0
40.0
45.0
50.0

µVeto(E)
0.205944
0.169298
0.150704
0.137444
0.127823
0.119531
0.112835
0.106932
0.101949
0.097504
0.093717
0.090226
0.087195
0.084350
0.081692
0.079220
0.077065
0.075009
0.073052
0.071194
0.064013
0.058035
0.053580
0.049689
0.044222
0.039767
0.036580
0.033893

0.031814
0.030016
0.028562
0.027268

0.026254
0.025319
0.024462
0.023684
0.023043
0.022442
0.021880
0.021357

0.019618
0.018280
0.017477
0.016805

0.015988
0.015407
0.015158
0.014948
0.014756
0.014646

µAl(E)

0.432
0.3618
0.324

0.2781

0.24894

0.22707

0.21006

0.18468

0.16578

0.1166

0.0953

0.0837

0.07641

0.07155

0.06534

0.0621

0.05859

0.05805

0.05859

0.06048

0.06210

µD1(E)
0.178262
0.146770
0.130690
0.119207
0.110860
0.103667
0.097861
0.092743
0.088426
0.084574
0.081289
0.078260
0.075629
0.073160
0.070853
0.068708
0.066840
0.065057
0.063360
0.061749
0.055524
0.050340
0.046471
0.043092
0.038345
0.034476
0.031708
0.029373

0.027565
0.026002
0.024737
0.023611

0.022727
0.021912
0.021166
0.020488
0.019929
0.019405
0.018915
0.018459

0.016940
0.015770
0.015066
0.014475

0.013756
0.013242
0.013019
0.012830
0.012659
0.012558

µD2(E)

PMS(E)

PSV(E)

5.9821
2.15796
1.14871

0.57986

0.41471

0.336906

0.293233

1.0

1.0

1.0

1.0

1.0

0.242954

1.0

0.212493

0.993

0.170655

0.991

0.150837

0.985

0.134322

0.976

0.128817

0.975

0.127349

0.973

0.127716

0.971

0.130285

0.950

0.134689

0.929

0.147534

0.912

0.158544

0.913

0.915
0.917

0.176894

0.190840

0.201116

0.940

0.912

0.850

0.718

Notes. Interaction coeﬃcients, µ, are given in units of cm−1.

which integrates all possible second interaction locations within
a given D1 module assuming vertically incident photons, where

(G.11)

rD1 = 13.8 cm and lD1 = 8.5 cm is the radius and thickness
of a D1 module. l(r, z, φ) gives the remaining interaction length
for a photon that has interacted at radius r, vertical depth z and

Article number, page 27 of 31

A&A proofs: manuscript no. arxiv

Fig. G.1. Energy dependence of the eﬃciency factor Peﬀ(ϕ(cid:48)
= 25◦ (right).
energy dependence of its components for ϕ(cid:48)

geo

geo, Eγ) for the three geometrical scatter angles ϕ(cid:48)

geo

= 5◦, 25◦, and 50◦ (left) and the

azimuth angle φ of the module and is given by

Appendix G.3: Module spectral response functions

l(r, z, φ) =






lD1 − z
cos ϕ(cid:48)

geo

,

R(r, φ)
sin ϕ(cid:48)

geo

,

if l(r, z, φ) sin ϕ(cid:48)

geo ≤ R(r, φ)

otherwise

with

R(r, φ) =

(cid:113)

D1 − r2 sin2 φ − r cos φ.
r2

Appendix G.3.1: D1 spectral response
The spectral response RD1(E1| ˆE1) provides the probability for
measuring an energy E1 when an incident photon with energy
Eγ was Compton scattered by an angle ϕgeo, producing a true
ˆE1 in the detector module. The D1 response
energy deposit of
is implemented by the GCOMD1Response class and the response
evaluation is done using the GCOMD1Response::operator()
operator. The spectral D1 response is computed using a Gaussian

(G.12)

(G.13)

Figure G.1 illustrates the energy dependence of the eﬃciency

factor Peﬀ(ϕ(cid:48)

geo, Eγ) and its components.

RD1(E1| ˆE1) = T1(E1| ˆE1)
√
2π

σ( ˆE1)

exp


−



1
2




µp( ˆE1) − E1
σ( ˆE1)

2





,

(G.17)

Appendix G.2: Klein-Nishina contribution

PKN(ϕ(cid:48)

geo, Eγ) =

geo,max

(cid:82) ϕ(cid:48)
ϕ(cid:48)
geo,min
(cid:82) π
0

σKN(ϕ(cid:48)(cid:48)

geo, Eγ) dϕ(cid:48)(cid:48)
geo

σKN(ϕ(cid:48)(cid:48)

geo, Eγ) dϕ(cid:48)(cid:48)
geo

where µp( ˆE1) is the position of the Gaussian peak for true energy
deposit of ˆE1, with µp( ˆE1) ≈ ˆE1, and σ( ˆE1) is the standard devi-
ation of the Gaussian (Diehl et al. 1992). T1(E1| ˆE1) is a threshold
function, deﬁned by

(G.14)

contribution of
geo, Eγ) to the ϕ(cid:48)

the
is
σKN(ϕ(cid:48)(cid:48)
where the integrals are computed using

the Klein-Nishina
geo bin spanned by [ϕ(cid:48)

cross-section
geo,max],

geo,min, ϕ(cid:48)

(cid:90) ϕ(cid:48)

geo,max

ϕ(cid:48)
geo,min

σKN(ϕ(cid:48)(cid:48)

geo, Eγ) dϕ(cid:48)(cid:48)

geo

(cid:90) Eup
1

=

0
(cid:90) Elow

1

0

σKN(E(cid:48)

1, Eγ) dE(cid:48)

1 −

σKN(E(cid:48)

1, Eγ) dE(cid:48)

1

T1(E1| ˆE1) =

(G.15)






0,

if E1 ≤ Ethres

1

( ˆE1)

( ˆE1)

E1 − Ethres
1
∆E1( ˆE1)

,

if 0 < E1 − Ethres

1

( ˆE1) ≤ ∆E1( ˆE1)

,

0,

1,

if E1 > Emax

1

( ˆE1)

otherwise

(G.18)

with

(cid:90) E1

0

σKN(E(cid:48)

(cid:33)2

+ 1

+





− 1

(cid:32)

× log

1 −

(cid:33)

−

E1
Eγ

1,Eγ) dE(cid:48)
(cid:32)



1

2

mec2
Eγ
(cid:33)2

(cid:32)

= E1
Eγ

(cid:33)2

+ 2

mec2
E1
mec2
Eγ
(cid:33)2

(cid:32)

1
2

E1
Eγ

(cid:32)

+

mec2
Eγ

1
1 − E1
Eγ

1

1

( ˆE1) − 1
2

( ˆE1) = Emin
1
( ˆE1), Emax

∆E1( ˆE1). µp( ˆE1) and σ( ˆE1) as
where Ethres
( ˆE1) and ∆E1( ˆE1) are tabulated as a func-
well as Emin
1
ˆE1 in a calibration ﬁle of type SDA that is included in
tion of
GammaLib. Values for a given energy ˆE1 are obtained by linear
interpolation of the tabulated values.

The spectral response RD1(E1| ˆE1) is illustrated in the left
panel of Fig. G.2 for a selected number of input energies ˆE1. The
ﬁgure can be compared with Fig. 3c in Diehl et al. (1992), which
presents the response functions as implemented in COMPASS at
the time of the CGRO launch for comparable energies.

.

(G.16)

Article number, page 28 of 31

J. Knödlseder et al.: COMPTEL data analysis using GammaLib and ctools

Fig. G.2. Detector response functions RD1(E1| ˆE1) (left) and RD2(E2| ˆE2) (right) for a selected number of energies that have been chosen to allow
for a comparison with Figs. 3c and 4b in Diehl et al. (1992).

Appendix G.3.2: D2 spectral response
The spectral response RD2(E2| ˆE2) provides the probability for
measuring an energy E2 when an photon with energy ˆE2 hit a
D2 detector module. The D2 response is implemented by the
GCOMD2Response class and the response evaluation is done us-
ing the GCOMD2Response::operator() operator. The spectral
D2 response is computed using

RD2(E2| ˆE2) =(Ppp(E2| ˆE2) + Pse(E2| ˆE2) + Pde(E2| ˆE2) +
Ccom(E2| ˆE2) + Cbkg(E2| ˆE2)) × T2(E2| ˆE2) ,

(G.19)

which is a combination of three Gaussian and two continuum
components multiplied by a threshold function T2(E2| ˆE2) (Diehl
ˆE2 is the energy of the gamma-ray photon
et al. 1992). Here,
incident on a D2 module, and E2 is the measured energy deposit.

The ﬁrst Gaussian,

with µse( ˆE2) = µpp( ˆE2) − mec2 and µde( ˆE2) = µpp( ˆE2) − 2mec2,
where mec2 ≈ 511 keV is the rest energy of the electron.

The ﬁrst continuum component,

Ccom(E2| ˆE2) = Acom( ˆE2) ×
(cid:90) max(E2+3σ(E2),Ec)

E2−3σ(E2)

σKN(E| ˆE2) f (E|E2, ˆE2) K(E|E2) dE,

(G.23)

describes the so-called Compton tail which represents photons
that underwent a Compton scattering before escaping the D2
module. The component is the product of the Klein-Nishina
cross-section for Compton scattering,

σKN(E| ˆE2) =

(cid:32)

E/ ˆE2
1 − E/ ˆE2

mec2
ˆE2

(cid:33)2

−

E
ˆE2

+

1
1 − E/ ˆE2

,

(G.24)

Ppp(E2| ˆE2) =

App( ˆE2)
√
σ( ˆE2)
2π

exp


−



1
2




µpp( ˆE2) − E2
σ( ˆE2)

2





,

(G.20)

and the probability that the Compton scattered photon does not
undergo a second Compton scattering before escaping, empiri-
cally modelled using

describes the so-called photo-peak which represents photons that
were fully absorbed in the D2 module. We note that the position
µpp( ˆE2) of the photo-peak is not necessarily identical to the in-
cident energy, although below ∼ 10 MeV µpp( ˆE2) ≈ ˆE2 is well
satisﬁed.

The two subsequent Gaussians describe the single and dou-
ble escape peak, respectively, which are generated by photons
above 1.022 MeV that undergo pair creation resulting in the pro-
duction of two 511 keV gamma rays. The escape of one or both
of these 511 keV photons from the D2 module leads to charac-
teristic peaks at energies 0.511 MeV and 1.022 MeV below the
photo-peak energy. The escape peaks are modelled using
(cid:33)2
 (G.21)

Pse(E2| ˆE2) =

µse( ˆE2) − E2
σ(µse( ˆE2))

Ase( ˆE2)
√
σ(µse( ˆE2))


−

exp

1
2

2π



(cid:32)

and

Pde(E2| ˆE2) =

Ade( ˆE2)
√
σ(µde( ˆE2))

2π

exp

(cid:32)


−



1
2

µde( ˆE2) − E2
σ(µde( ˆE2))

(cid:33)2
 ,

(G.22)

f (E| ˆE2) =

(cid:40)

(cid:16)

exp
0,

−µ(E| ˆE2) l( ˆE2)

(cid:17)

,

if ˆE2 > 12.14 MeV
otherwise

,

(G.25)

where

µ(E| ˆE2) = 0.72 e−1.28( ˆE2−E)0.35 + 0.01 ( ˆE2 − E) + 0.014 ( ˆE2 − E)−2.5
(G.26)
is the total linear attenuation coeﬃcient in NaI, which is the scin-
tillator material of the D2 modules and
l( ˆE2) = 2.9 ln( ˆE2 − 11.14)
(G.27)
is an empirical path length in the D2 module, where ˆE2 is in units
of MeV. The product is convolved with a Gaussian kernel,

K(E|E2) =

1

σ(E2)

exp

√

2π

(cid:32)


−



1
2

E − E2
σ(E2)

(cid:33)2
 ,

(G.28)

to take the energy resolution of the D2 module into account,
where σ(E2) is the standard deviation of the detector response
at the reconstructed energy E2.

Article number, page 29 of 31

A&A proofs: manuscript no. arxiv

The second continuum component,

Cbkg(E2| ˆE2) = Abkg( ˆE2)

(cid:90) max(E2+3σ(E2), ˆE2)

E2−3σ(E2)

K(E|E2) dE,

(G.29)

is a ﬂat background component that is convolved by a Gaussian
kernel and that takes into account any higher-order scatterings in
the D2 modules.

The threshold function is deﬁned by

T2(E2| ˆE2) =







−



1
2





exp

Ethres
2

( ˆE2) − E2

σthres( ˆE2)

0,

1,

2

,





if E2 < Ethres

2

( ˆE2)

if E2 > Emax

2

( ˆE2)

,

otherwise

(G.30)

( ˆE2) = Emin
where Ethres
2
(cid:112)
∆E2( ˆE2)/2
2 log 2

2

( ˆE2) + 1
2

∆E2( ˆE2) and σthres( ˆE2) =

All ﬁve response components have amplitude parameters
(App, Ase, Ade, Acom and Abkg) that are tabulated as a function
of incident energy ˆE2 in a calibration ﬁle of type SDB. In addi-
tion, this ﬁle contains also tabulated values for the photo-peak
energy µpp( ˆE2), the standard deviation σ( ˆE2) and the minimum
( ˆE2) and
and maximum threshold energies Emin
width ∆E2( ˆE2). Values for a given energy ˆE2 are obtained by
linear interpolation of the tabulated values.

( ˆE2) and Emax

The spectral response RD2(E2| ˆE2) is illustrated in the right
panel of Fig. G.2 for a selected number of input energies ˆE2. The
ﬁgure can be compared with Fig. 4b in Diehl et al. (1992), which
presents the response functions as implemented in COMPASS at
the time of the CGRO launch for comparable energies.

2

2

Fig. G.3. Width σ(ϕ(cid:48)
tion of ϕ(cid:48)
35◦ (dashed-dotted green), and 50◦ (dotted purple).

geo, θ) of the Gaussian smoothing kernel as a func-
geo for zenith angles θ of 0◦ (solid blue), 25◦ (dashed orange),

respect to the D2 module in x and y direction, respectively, σz1 =
2.45 cm and σz2 = 2.17 cm is the vertical location spread in a
D1 and D2 module, respectively, assuming a homogenous event
distribution in the z-direction, and h = 158 cm is the distance
between the D1 and D2 modules. The functions

fxy(ϕ(cid:48)

geo, θ) = cos2 θ cos2 ϕ(cid:48)

geo(4 sin2 θ sin2 ϕ(cid:48)

geo

+ cos2 ϕ(cid:48)

geo − sin2 θ) +

sin2 θ ×

1
2
(cid:32)

cos2 θ cos2 ϕ(cid:48)

geo

+ sin2 θ sin2 ϕ(cid:48)

geo

(cid:32)
1 −

3
4

(cid:33)(cid:33)

cos2 ϕ(cid:48)

geo

(G.35)

Appendix G.4: Response convolution

The response is convolved with the Gaussian kernel

K(ϕ(cid:48)

geo|ϕgeo, θ) =

1
geo, θ)

σ(ϕ(cid:48)

exp

√

2π


−



1
2

(cid:32) ϕgeo − ϕ(cid:48)
geo
σ(ϕ(cid:48)
geo, θ)

(cid:33)2


and
fz(ϕ(cid:48)

geo, θ) = cos4 θ sin2 ϕ(cid:48)
geo cos2 ϕ(cid:48)
(cid:32)
1
2

cos2 θ sin2 θ

+

geo

− 3 sin2 ϕ(cid:48)

geo cos2 ϕ(cid:48)

geo

(G.31)

3
8

sin4 θ sin2 ϕ(cid:48)

geo cos2 ϕ(cid:48)

geo

(cid:33)

+

(G.36)

to take into account the location uncertainties of the events in the
D1 and D2 modules. The width σ(ϕ(cid:48)
geo, θ) of the Gaussian kernel
is a function of the scatter angle ϕ(cid:48)
geo and the zenith angle θ of
the incoming photon, measured with respect to the COMPTEL
pointing axis. The width
(cid:113)

σ(ϕ(cid:48)

geoθ) =

σ2

xy(ϕ(cid:48)

geo, θ) + σ2

z(ϕ(cid:48)

geo, θ)

(G.32)

is the squared mean of the uncertainty

xy(ϕ(cid:48)
σ2

geo, θ) =

(cid:16)
σ2
x

(cid:17)

+ σ2
y
h2

fxy(ϕ(cid:48)

geo, θ)

in the horizontal direction and the uncertainty

z(ϕ(cid:48)
σ2

geo, θ) =

(cid:16)

σ2
z1

(cid:17)

+ σ2
z2
h2

fz(ϕ(cid:48)

geo, θ)

(G.33)

(G.34)

in the vertical direction, where σx = 2.3 cm and σy = 1.96 cm
is the average horizontal location spread in a D1 module with

Article number, page 30 of 31

are the geometrical relations that transform from the uncertain-
ties within the modules to uncertainties in ϕ(cid:48)
geo for a given zenith
angle θ.

Since COMPTEL response functions have no explicit zenith
angle dependence, the computations are performed for an aver-
age zenith angle of θ = 25◦. The uncertainty introduced by this
approximation is illustrated in Fig. G.3, and amounts to less than
10% for zenith angle θ < 35◦.

Appendix H: Carbon footprint of this research

Given the repeated alarms of the scientiﬁc community on global
warming (IPCC 2021, 2022), biodiversity loss (IPBES 2019)
and air, water and soil pollution (Landrigan et al. 2017), the en-
vironmental impact of any human activity, including obviously
research, can no longer be ignored. Here we assess the GHG
emissions related to our research work, including contributions
from oﬃce use, research activities and research environment. We
based our assessment on the carbon footprint estimate of the
Institut de Recherche en astrophysique et planétologie (IRAP;

J. Knödlseder et al.: COMPTEL data analysis using GammaLib and ctools

Table H.1. Carbon footprint estimate by emission source of the research work behind this paper.

Source
Electricity to power oﬃce building
Heating of oﬃce building
Water usage in oﬃce building
Air conditioning in oﬃce building
Waste management
Computing infrastructure
Data ﬂow
Lunch meals
Home-to-oﬃce commuting
Total

Emissions kgCO2e
525 ± 53
422 ± 118
8 ± 2
80 ± 23
209 ± 106
400 ± 200
8 ± 8
171 ± 103
89 ± 36
1911 ± 284

Comments

Evaluated using csfootprint
Includes videoconferencing
10% classical, 10% ﬂexitarian, 80% vegetarian
90% cycling, 5% public transport, 5% car

Notes. The footprint is based on a total work time estimate of one FTE or 220 working days.

Martin et al. 2022) where most of the work for this research was
done. To attribute a share of the total footprint to our work, we
estimated that roughly one full time equivalent (FTE) was nec-
essary to accomplish this research, corresponding to 220 work-
ing days. Consequently, we use the annual emissions per source
from Martin et al. (2022) divided by the IRAP staﬀ of 263 per-
sons to assess the contributions from the various sources of GHG
emissions.

The results of our assessment are summarised in Table H.1.
We estimate the total carbon footprint of our research work to be
1.9 ± 0.3 tCO2e, composed of 1.2 ± 0.2 tCO2e (65%) for run-
ning the oﬃce building in which the work was done, 0.4 ± 0.2
tCO2e (21%) for the computing infrastructure and data ﬂow, and
0.3 ± 0.1 tCO2e (14%) for lunch meals and home-to-oﬃce com-
muting.

We based our assessment for computing on the carbon foot-
print estimation implemented in ctools, yet when we started
this research the relevant functionality was not yet available.
We note, however, that the carbon footprint estimate for the ﬁ-
nal analyses for this publication amounted to 60 kgCO2e, of
which 20 kgCO2e were attributed to power consumption and 40
kgCO2e to the computing infrastructure. Making the conserva-
tive estimate that ten analysis iterations were necessary for this
research work we obtain a total carbon footprint due to comput-
ing of 600 kgCO2e, of which 200 kgCO2e were due to power
consumption and 400 kgCO2e due to the computing infrastruc-
ture. To avoid double counting, we disregarded the contribution
of power consumption since it is already accounted for in the
electricity to power the oﬃce building.

For emission from lunch meals and home-to-oﬃce commut-
ing we took the speciﬁc habits of the co-authors weighted by
their contribution to the research into account. We note that our
research work did not require any professional travelling. The
footprint for a couple of video conferences that we organised for
this research is included under the ‘Data ﬂow’ source.

Article number, page 31 of 31

