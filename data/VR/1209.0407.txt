Astronomy&Astrophysicsmanuscript no. Posbic2012
March 16, 2018

c(cid:13) ESO 2018

2
1
0
2

p
e
S
3

]

R
S
.
h
p
-
o
r
t
s
a
[

1
v
7
0
4
0
.
9
0
2
1
:
v
i
X
r
a

SPADES: a stellar parameters determination software
H. Posbic1, D. Katz1, E. Caﬀau2,1, P. Bonifacio1, A. G´omez1, L. Sbordone2,1, and F. Arenou1

1 GEPI, Observatoire de Paris, CNRS, Universit´e Paris Diderot, Place Jules Janssen, 92190, Meudon, France
2 Zentrum f¨ur Astronomie der Universit¨at Heidelberg, Landessternwarte, K ¨onigstuhl 12, 69117, Heidelberg, Germany

Received 14 April 2012 / Accepted 16 July 2012

ABSTRACT

Context. As increasingly more spectroscopic data are being delivered by medium- and high-resolving power multi-object spectro-
graphs, more automatic stellar parameter determination softwares are being developed. The quality of the spectra collected also allows
the determination of elemental abundances.
Aims. SPADES is an automated software for determining: the radial velocity (Vr), the eﬀective temperature (Teﬀ), the surface gravity
(log g ), the metallicity ([Fe/H] ), and most importantly, the individual abundances. In this ﬁrst version it is targeted on the analysis
of mid-F-G dwarfs, but is meant to evolve to analyze any type of single stars.
Methods. SPADES relies on a line-by-line modeling to determine the stellar parameters.
Results. The internal systematic and random errors of SPADES were assessed by Monte Carlo method simulations with synthetic
spectra and the external systematic errors by analysing real ground-based observed spectra. For example, by simulating the Giraﬀe
setups HR13 and HR14B with synthetic spectra for a dwarf with Teﬀ = 5800 K, log g = 4.5, [Fe/H] = 0.0 dex and with a signal-to-
noise ratio (snr) of 100, the stellar parameters are recovered with no signiﬁcant bias and with 1-σ precisions of 8 K for Teﬀ, 0.05 for
log g , 0.009 for [Fe/H] , 0.003 for [Ti/Fe] and 0.01 for [Ni/Fe] .

Key words. Methods: data analysis - Techniques: spectroscopic - Stars: fundamental parameters - Stars: abundances

1. Introduction

The present and future large spectroscopic surveys are going
to signiﬁcantly increase the number of spectroscopic data to
be analyzed. A few examples are RAVE with some 250 000
stars observed so far (Boeche et al. 2011; Siebert et al. 2011),
the Gaia-ESO Survey with about 105 stars to be observed, Gaia
with about 200 million stars (Katz et al. 2004; Katz 2009). To
analyze these quantities of data, automatic spectra analysis
softwares are needed.

The development of automated spectra analysis software can
be traced back to the early 1990s. Since then, many programs
were developed based on a wide variety of methods: e.g. orthog-
onal vector projection (Cayrel et al. 1991; Perrin et al. 1995),
minimum distance method, e.g. TGMET (Katz et al. 1998;
Soubiran et al. 2003), and ETOILE (Katz 2001), artiﬁcial neural
networks (Bailer-Jones 2000; Allende Prieto et al. 2000), feature
ﬁtting softwares such as Abbo (Bonifacio & Caﬀau 2003), pro-
jection vector softwares such as MATISSE (Recio-Blanco et al.
2006; Bijaoui et al. 2008), principal component analysis soft-
wares such as MAχ (Jofr´e et al. 2010), and forward modeling
algorithm ILIUM (Bailer-Jones 2010). One can also cite
DAOSPEC (Stetson & Pancino 2008, 2010) and FITLINE
(Franc¸ois et al. 2003), which automatically measure equivalent
widths. DAOSPEC and FITLINE are not automated per-say
parameter determination softwares, but coupled with programs
that derive atmospheric parameters from equivalent widths, they
are used by many astronomers to automatically parameterize
stars.

The work presented here describes the development of a
new automatic stellar spectra analysis software. This is based

on line-by-line analysis. The reference lines are modeled. One
of the motivations to develop SPADES (Stellar PArameters
DEtermination Software) is the analysis of a set of 200 Giraﬀe
HR13 and HR14 spectra, mainly F-G dwarfs, that were collected
in the context of a study of the structure of the Galactic disk.
Therefore, the ﬁrst version of SPADES is illustrated and tested
with simulated Giraﬀe-like spectra of mid-F-G dwarfs. SPADES
is coded with Java.

SPADES is described in Sect. 2. It relies on auxiliary data:
a line list and a grid of reference spectra. They are presented in
Sect. 3. The performances of SPADES were evaluated by Monte
Carlo method simulations against synthetic spectra and by com-
parison to observed spectra of the Sun, ν And, β Vir, µ Her, and
σ Dra (see Sect. 4).

2. SPADES

2.1. General concept

SPADES automatically determine: the radial velocity (Vr), the
eﬀective temperature (Teﬀ), the surface gravity (log g ), the
metallicity ([Fe/H] ), and individual abundances ([X/Fe] for
the element X) for single stars. This ﬁrst version of SPADES is
focused on mid-F-G dwarfs and the micro-turbulence is set to
1 km s−1 .

Many of existing automatic spectra analysis softwares uses
global methods, meaning they process all pixels of the stud-
ied spectrum (Katz et al. 1998; Katz 2001; Soubiran et al. 2003;
Recio-Blanco et al. 2006). With SPADES we aimed to explore
another possibility, which is the line-by-line analysis. Each pa-
rameter is determined using a pre-deﬁned set of lines. The merits

1

 
 
 
 
 
 
H. Posbic et al.: SPADES

of this technique are, ﬁrst, the possibility to select lines that are
particularly sensitive to the stellar parameter to be determined,
and second, this allows one to exclude lines that are not correctly
modeled. A drawback is that only a fraction of the total available
information is used.

Often, whether automated or manual, methods using a line-
by-line analysis rely on equivalent width measurement and use a
curve-of-growth analysis. We chose to rely on synthetic spectra
modeling and proﬁle ﬁtting. The motivation is twofold. First, this
takes care of small blend problems. Assuming that the blend is
correctly modeled, its contribution to the observation and to the
modeled proﬁle will (partly) cancel out. Second, some parame-
ters can be derived by line proﬁle ﬁtting, e.g. Teﬀfrom the wings
of the Balmer lines. A drawback of this method is the need for
a very large library of synthetic spectra. Reading and process-
ing many synthetic spectra is computationally demanding and
therefore the analysis is slower.

In the line-by-line analysis the accuracy and precision of the
results is very sensitive to the determination of the continuum or
pseudo-continuum. Yet, this is often diﬃcult particularly in cool
and/or super metal-rich stars. SPADES determines “local” con-
tinuum from the comparison of the reference (synthetic) spectra
and the studied spectrum (see sect. 2.5.3).

As opposed to mean metallicities, SPADES determines iron
and individual elements abundances. To derive of the individual
abundances SPADES calculates on-the-ﬂy atmospheric models
and synthetic spectra for the values of Teﬀ, log g , [Fe/H] it had
determined (see sect. 2.6).

SPADES can simultaneously analyze various spectral do-
mains (possibly with diﬀerent resolving powers) of the same tar-
get, e.g. diﬀerent Giraﬀe setups, or diﬀerent orders of an echelle
spectrograph, or even spectral domains collected with diﬀerent
spectrographs.

2.2. Processing overview

A SPADES analysis proceeds in three steps: it ﬁrst determines
the radial velocity, then the atmospheric parameters, and ﬁnally
it determines the individual abundances.

The radial velocity is determined by cross-correlation with a

synthetic template (see sect. 2.4).

The three atmospheric parameters (eﬀective temperature,
surface gravity, iron over hydrogen ratio) are determined inde-
pendently (see sect. 2.5). Currently, each parameter is associated
to one diagnostics. SPADES was conceived to aggregate more
diagnostics along its life span and more will be added in the fu-
ture Current diagnostics are

– eﬀective temperature: Balmer line wings ﬁtting (suited for

Teﬀderivation in F-G dwarfs),

– surface gravity: ionization equilibrium,
– iron abundance: neutral iron line proﬁle ﬁtting.

The individual abundances are determined element per

element by line proﬁle ﬁtting.

The reader will notice that some of these diagnostics are sim-
ilar to those used in the so-called “detailed analysis”. Two diﬀer-
ences should be emphasized: (i) SPADES relies on proﬁle ﬁtting
and modeling rather than equivalent width measurement, and (ii)
the SPADES precision is not limited by the step in the grid of at-
mospheric models and spectra (see Sect. 2.5.1).

2

2.3. Pre-processing

Each of the three processing steps includes pre-processing
tasks. Pre-processing a spectrum includes shifting to rest frame,
excluding cosmics, excluding telluric lines, convolving the
synthetic spectrum to the resolving power of the ground-based
observed spectrum, normalizing to continuum and excluding
possible unexposed edges of the spectrum. Every functionality
remains an option: it can be switched on and oﬀ in the conﬁgu-
ration ﬁle by the user.

Shifting to rest frame is performed by using either a radial
velocity provided by the user or that determined by SPADES
(see sect. 2.4).

The exclusion of cosmics is performed by detecting the
ﬂuxes that lie signiﬁcantly above the continuum and replacing
their value by interpolation with the neighboring pixels.

The wavelengths of the telluric lines were pre-tabulated.
These lines are not cut. Their pixels are simply ﬂagged as not
valid and are excluded from all subsequent analysis.

The spectral resolution of the synthetic spectra should be
matched to the resolution of the ground-based observed spec-
trum. To do so, the reference spectra are convolved using a
Gaussian proﬁle (valid for slow rotators).

Raw spectrum

6400

6450

6500

6550

6600

Wavelength (A)

Final spectrum

x
u
F

l

d
e
s

i
l

a
m
r
o
N

0
0
0
0
0
5
1

0
0
0
0
0
5

0

0
.
1

8
.
0

6
.
0

4
.
0

2
.
0

0
.
0

6400

6450

6500

6550

6600

Wavelength (A)

Fig. 1. Observed Giraﬀe/VLT (HR14B setup) Sun spectrum be-
fore normalization, with the polynomial ﬁt shown as a thick blue
line (top) and after normalization (bottom)

The synthetic spectra are already normalized to continuum.
The studied spectrum is iteratively ﬁtted with a polynomial func-
tion, using a sigma-clipping technique to exclude the lines and
cosmic rays from the ﬁt. The degree of the polynomial is deﬁned
by the user, depending on the large-scale shape of the spectrum.
The studied spectrum is normalized to 1 at the level of the con-
tinuum by division by the polynomial. Figure 1 presents an ob-
served Giraﬀe/VLT (HR14 setup) Sun spectrum before normal-

H. Posbic et al.: SPADES

ization, with the polynomial shown as a thick blue line (top) and
after normalization (bottom).

Edge exclusion is necessary if the ground-based observed
spectrum suﬀers from underexposed or unexposed pixels.
SPADES can automatically detect and ﬂag as not valid the un-
derexposed/unexposed pixels.

2.4. First step: Radial velocity

The radial velocity determination is based on a cross-correlation
of the studied spectrum and a synthetic template spectrum.

The atmospheric parameters of the template spectrum are
chosen by the user. At this stage in the processing, SPADES
has not yet provided estimates for the atmospheric parameters
of the studied source. If no external information is available
to guide the choice of the template, it is likely that there will
be a mismatch between the ground-based observed spectrum
and the selected template. Monte Carlo method simulations
were performed to assess the impact of selecting a template
400 K and 1 000 K warmer than the studied spectrum. The tests
were conducted with 200 snr=50 synthetic studied spectra of
solar parameters. In both cases (400 and 1 000 K oﬀsets), the
mismatch leads to a bias of about 0.2 km s−1 and no signiﬁcant
change in the precision of the estimated radial velocities (see
table 1). A bias of 0.2 km s−1 represents about 1/60th of the
full width at half maximum (FWHM) and has a negligible
impact on the following steps of the analysis. If, a posteriori,
the parameters estimated by SPADES and those of the selected
template are signiﬁcantly diﬀerent, the radial velocity can be
re-estimated with a better matching template.

The studied and the template spectrum are pre-processed.
The reference spectrum is then shifted step by step in radial ve-
locity over an interval deﬁned by the user. In the tests, we used
an interval of -500 to 500 km/s. At each step, the synthetic spec-
trum is re-sampled to the same sampling as the studied spectrum.
At each step, the correlation coeﬃcient of the two spectra is cal-
culated:

Correlation function

8
0

.

6

.

0

4

.

0

2
0

.

0
0

.

i

t
n
e
c
i
f
f
e
o
C
n
o
i
t
a
e
r
r
o
C

l

−400

−200

0

200

400

Radial velocity (km/s)

Fig. 2. Correlation function for a synthetic studied spectrum
of solar parameters (Teﬀ = 5777 K, log g = 4.44 and [Fe/H]
= 0.0 dex) and S/N = 100 (Poisson noise) and a noiseless syn-
thetic template with the same atmospheric parameters

This allows one to estimate the radial velocity with a precision
better than the step used to shift the template.

The error on the radial velocity determination, σVr is esti-

mated with the Zucker (2003) formula:

CC(v) =

1
N

N

X
i=0

(S (i)− < S >) × (R(i)− < R >)
stdv(S ) × stdv(R)

,

(1)

N ×

Vr = −
σ2


C′′(m)
C(m)

C(m)2
1 − C(m)2

−1




,

(3)

where v is the velocity shift applied to the template spectrum,
N is the number of valid pixels in the studied spectrum, S (resp.
R) the studied (resp. reference) spectrum counts, < S > (resp.
< R >) the mean studied spectrum (resp. reference) counts, and
stdv the standard deviation:

stdv(X) = (cid:16)

1
N

N

X
i=0

(X(i)− < X >)2

1/2

,

(cid:17)

(2)

The correlation coeﬃcients as a function of the radial veloc-
ity shifts form the cross-correlation function. Figure 2 shows the
cross-correlation function obtained for a synthetic studied spec-
trum of solar parameters (Teﬀ = 5777 K, log g = 4.44 and [Fe/H]
= 0.0 dex) and S/N = 100 (Poisson noise) and a noiseless syn-
thetic template with the same atmospheric parameters.

The radial velocity of the observed source corresponds to
the maximum of the correlation function. The maximum is
derived in two steps. First, the highest correlation coeﬃcient is
found and then a second-degree polynomial is adjusted to the
correlation function in the vicinity of the highest coeﬃcient.

where C(m) is the value of the correlation function at its maxi-
mum, C′′(s) the value of the second derivative of the correlation
function at the maximum of the correlation function and N the
number of valid1 pixels in the ground-based observed spectrum.

The performances of the radial velocity estimation of the
radial velocity were assessed with a Monte Carlo method. For
three S/N: 30, 50 and 100, Giraﬀe HR13 and HR14B spectra
were simulated (200 per SNR) by injecting a synthetic spec-
trum with Poisson noise. The synthetic spectrum was a solar-like
spectrum in the rest frame. The same spectrum, but noiseless,
was used as template. Table 1 presents the median and disper-
sion of the distributions of radial velocities derived by SPADES
for each SNR. Because the true radial velocity of the studied
spectra is 0 km s−1 , the median of a distribution is an estimate
of the systematic error and the dispersion an estimate of the ran-
dom error.

1 Some non-valid pixels aﬀected by, e.g. telluric lines, could be ex-

cluded from the derivation of the correlation function (see Sect. 2.3).

3

 
H. Posbic et al.: SPADES

Table 1. Median and dispersion (in km s−1 ) of the radial velocity
distribution derived by SPADES for 200 studied spectra for SNR
30, 50 and 100.

SNR Vr median
(km s−1 )
-0.005
-0.006
0.002

100
50
30

σ Vr
(km s−1 )
0.03
0.06
0.11

SPADES is iteratively searching for the best matching syn-
thetic spectrum in a 3D space (Teﬀ, log g and [Fe/H] ). In this
ﬁrst version of SPADES, the search is split in three 1D minimiza-
tions, rather than using a multi-dimensional search method. The
motivation is that this facilitates visualizing and interpreting the
residuals and similarity functions (See e.g. Fig. 5) that depend
on a single parameter. In future versions, it would be interesting
to experiment with multi-dimensional minimization algorithms
such as Gauss-Newton, gradient, or Levenberg-Marquardt meth-
ods.

2.5. Second step: Stellarparameterdetermination

2.5.2. Starting parameters

2.5.1. Overview

SPADES determines the eﬀective temperature (Teﬀ), the sur-
face gravity (log g ), and the iron abundance ([Fe/H] ). In this
ﬁrst version targeted on mid-F-G dwarfs, we assumed a micro-
turbulence of 1 km s−1 for all our stars, including the tests with
the observed spectra.

The determination of the atmospheric parameters is iterative.
Initial values for the three parameters are provided either by
the user or by SPADES (see Sect. 2.5.2). Each parameter is
determined independently of the two others, leaving these two at
their initial values. At the beginning of a new iteration, the val-
ues of the three parameters are updated, therefore providing new
“initial” values. This is repeated until the convergence condition
is met: i.e. absolute diﬀerences between the parameters obtained
at iteration n and n − 1 all simultaneously lower than 10 K for
Teﬀ, 0.1 for log g , and 0.025 for [Fe/H] . The iterative approach
was chosen over a direct approach (e.g. scanning the whole grid
of 2000 reference spectra over all parameters at once), because
it was computationally faster. Yet, the iterative approach could
potentially be more complex in terms of convergence. The
convergence performances of SPADES are assessed in Sect. 4.3.

At any iteration, the estimation of each parameter follows the

same logic:
SPADES ﬁrst calculates a 1D grid of synthetic spectra, varying
only along the parameter that is estimated. This 1D-subgrid is
calculated from the large grid of synthetic spectra described in
Sect. 3.1. The grid is linearly interpolated to the ﬁxed values of
the other parameters. As an example, at the start of iteration n,
the starting values for the atmospheric parameters derived from
iteration n-1 are Teﬀ = 5743K, log g = 4.42, and [Fe/H] =
−0.02. The ﬁrst parameter to be determined in iteration n is Teﬀ.
A 1D-subgrid is linearly interpolated for Teﬀranging from 5200
to 6200 K by step of 200 K and log g = 4.42 and [Fe/H] =
−0.02 dex.

Each synthetic spectrum is then compared (not globally, but
the selected lines) to the ground-based observed spectrum ac-
cording to the diagnostic appropriate for the parameters to be
determined. As an example for Teﬀ, the Hα proﬁle of the ground-
based observed spectrum will be compared to that of each syn-
thetic spectrum.

The result of the comparison is a similarity indicator for each
node in the 1D-subgrid. This series of similarity indicators as a
function of the parameter to be determined form a function that
is analyzed (minimized or nulled, depending on the function)
for the best similarity value, leading to the best estimate of
the parameter to be determined. Interpolation or polynomial ﬁt
allows one to determine the parameter with a precision that is
not limited by the step of the 1D-subgrid.

SPADES proceeds iteratively to derive the atmospheric param-
eters. It therefore needs starting values for the eﬀective temper-
ature, surface gravity, and iron over hydrogen ratio prior to the
ﬁrst iteration. Those can be deduced from photometric or bibli-
ographic information if available.

If no external information is available, SPADES oﬀers the
possibility to perform a ﬁrst parameterization of the studied
source, using the TGMET/ETOILE method (Katz et al. 1998;
Katz 2001; Soubiran et al. 2003). The results of this ﬁrst anal-
ysis are used as starting values for the iterative parameterization
with SPADES.

The TGMET/ETOILE method is direct (not iterative). It
compares a studied spectrum to a library of reference spectra,
looking for those most similar in the least-squares-sense. The
parameters deduced for the studied spectrum could either be the
parameters of the most similar spectrum or a combination of the
parameters of the most similar spectra. Because SPADES is only
looking for starting values, it simply adopts the parameters of the
most similar spectrum.

The performances of the SPADES implementation of the
TGMET/ETOILE method (hereafter referred to as SPADES-
TE)) were assessed with a Monte Carlo method method. Starting
from a synthetic spectrum with Teﬀ = 5800 K, log g = 4.5,
[Fe/H] = −1 dex (which is a node of the grid of synthetic spec-
tra), three series of 200 studied spectra each were simulated for
S/N=100, 50 and 30, respectively, and the resolving power and
wavelength range of the Giraﬀe HR13 and HR14B setups. At
S/N=50 and 100, the correct node in the grid is recovered in
100% of the cases. At S/N=30, SPADES-TE returns most of the
time a solution biased by one grid step in Teﬀ(i.e. +200 K) and
two grid steps in [Fe/H] (i.e. +0.4 dex).

SPADES-TE was also tested on a Sun spectrum observed
with Giraﬀe HR13 and HR14B setups in twilight condi-
tions. SPADES-TE found Teﬀ = 5800 K, log g = 3.5 and
[Fe/H] = −0.2 dex, to be compared to the canonical parame-
ters for the Sun Teﬀ = 5777 K, log g = 4.44, and [Fe/H] = 0 dex.

We recall that the version of SPADES presented here is lim-
ited by the GRID of synthetic spectra and by the list of reference
lines to the mid-F-G dwarf stars. Future versions of the program
will rely on larger grid(s) and on several ﬁne-tuned line lists,
which will extend the scope of SPADES.

2.5.3. Line and continuum identiﬁcation and vertical

adjustment

line,

For each spectral
the pixels constituting the line are
dynamically identiﬁed using the synthetic spectra. Using the
rest wavelength of the line, SPADES starts from its center and
agregates pixels in each wing as long as the value of the signal

4

H. Posbic et al.: SPADES

6195

6200

6205

Wavelengths(A)

x
u
F

l

0
0

.

1

5
9

.

0

0
9

.

0

5
8

.

0

0
8

.

0

5
7

.

0

2
.
1

1
.
1

0
.
1

x
u
F

l

9
.
0

8
.
0

7
.
0

6
.
0

6290

6295

6300

6305

Wavelengths(A)

Fig. 3. Two examples: (i) pixel identiﬁcation in the reference line
(green crosses), (ii) pseudo-continuum selection (blue circles),
and (iii) vertical adjustment of the synthetic reference spectrum
(red line) to the studied spectrum (black line). In the top plot,
the pseudo-continuum area (blue circles) were selected automat-
ically by SPADES and were used for the vertical adjustment. In
the bottom plot, no valid pseudo-continuum area was found. The
pixels in the line (green crosses) were used for the vertical ad-
justment.

This parameter is adjustable by the user. Figure 3 shows two
examples of sets of pixels associated to a line, i.e. green crosses
on the ﬁgures.

SPADES relies on proﬁles ﬁtting. This requires adjusting the
observed and synthetic spectra on the same vertical scale. It is
possible, in the pre-processing, to normalize the overall contin-
uum to 1. This is a global adjustment on the whole spectrum.
This is not enough for the comparison of two lines. Therefore,
SPADES systematically adjusts locally, line by line, the vertical
level of the synthetic line to the one of the observed line.

SPADES ﬁrst identiﬁes ﬂat areas (pseudo-continuum) in the
synthetic spectrum in the vicinity of the studied line and selects
one on each side of the line. It then checks that these two areas
also correspond to pseudo-continuum in the studied spectrum. If
the check is positive, it uses these areas to vertically scale the
synthetic spectrum on the studied one, by linear regression, i.e.
there are two degrees of freedom, vertical scaling, and slope.

If there are no ﬂat areas in the synthetic spectrum or the
studied spectrum contains (a) line(s) in the selected pseudo-
continuum, another method is used for the vertical adjustement.
The method depends on the diagnostic. For all diagnostics re-
lying on the quadratic sum of the residuals (e.g. the iron abun-
dance, Sect. 2.5.6), the pixels in the lines are directly used for
the vertical adjustment (allowing here for a single degree of free-
dom, the vertical scale). For the diagnostic that relies on the the
sum of residuals (i.e. the surface gravity, Sect. 2.5.5), SPADES
uses pre-tabulated pseudo-continuum.

An exception to this scheme is the Hα line used to derive of
the eﬀective temperature, for which the pseudo-continuum and
line area are pre-tabulated.

Figure 3 shows the local vertical adjustement of a synthetic
spectrum (red) to a studied spectrum (black). In the top plot,
the pseudo-continuum area (blue circles) were selected automat-
ically by SPADES and were used for the vertical adjustment of
the synthetic reference spectrum (red line) to the studied spec-
trum (black line). In the bottom plot, no valid pseudo-continuum
area was found. The pixels in the line (green crosses) were used
for the vertical adjustment.

2.5.4. Effective temperature

In this article, the stars considered are mid-F-G dwarfs, the
wings of the Balmer lines are very sensitive to the eﬀective tem-
perature (van’t Veer-Menneret & Megessier 1996; Fuhrmann
1998, 2004, 2008; Barklem et al. 2002; Cayrel et al. 2011). In
this study, SPADES used the wings of Hα present in Giraﬀe
setup HR14B to derive the eﬀective temperature. The core of
Hα was excluded because it is less sensitive to Teﬀvariation and
poorly modeled, specially using 1D LTE models, which is the
case here.

As presented in section 2.5.1, a 1D grid of synthetic spectra
was calculated, diﬀering only by the eﬀective temperature. After
pre-processing and vertical adjustment, each synthetic spectrum
was compared to the studied spectrum. For each synthetic spec-
trum, the degree of similarity of the synthetic Hα wings with the
studied one, is calculated as the quadratic sum of the residuals
between the pixels in the two lines:

increases. If less than ﬁve pixels are associated to the line, it is
considered too weak and rejected from the subsequent analysis.

S imHα =

N

X
i=0

(S (i) − R(i))2,

(4)

5

H. Posbic et al.: SPADES

Teff function

log(g) determination Function

6500

6520

6540

6560

6580

6600

6620

Wavelengths(A)

0

.

1

8

.

0

x
u
F

l

6
0

.

4
0

.

2

.

0

0
1

.

8
0

.

x
u
F

l

6
.
0

4
.
0

2
.
0

l

s
a
u
d
s
e
r

i

d
e
r
a
u
q
S

l

i

s
a
u
d
s
e
R
d
e
r
a
u
q
S

5
.
1

0
.
1

5
.
0

0
.
0

4

3

2

1

0

l

s
a
u
d
s
e
R

i

5
0
.
0

3
0
.
0

1
0
.
0

1
0
.
0
−

5000

5500

6000

6500

2.0

2.5

3.0

3.5

4.0

4.5

5.0

Teff (K)

log(g)

[Fe/H] determination Function

Ni abundance determination Function

l

i

s
a
u
d
s
e
R
d
e
r
a
u
q
S

6
0
.
0

5
0
.
0

4
0
.
0

3
0
.
0

2
0
.
0

1
0
.
0

−2.0

−1.5

−1.0

−0.5

0.0

0.5

−0.3

−0.2

−0.1

0.0

0.1

0.2

0.3

[Fe/H]

[Ni/Fe]

Fig. 5. Examples, for a synthetic studied spectrum, of similarity
functions as a function of eﬀective temperature (top left), sur-
face gravity (top right), iron over hydrogen ratio (bottom left)
and nickel over iron ratio (bottom right). The polynomial (or lin-
ear interpolation for the surface gravity) used to minimize the
functions are represented as blue lines.

6550

6555

6560

Wavelengths(A)

line.

Fig. 4. Comparison of the Hα wings in the studied spectrum
(black line) with the 1D grid of synthetic spectra (red lines)
ranging here from 5000 (narrowest wings) to 6600 K (broad-
est wing). The pseudo-continuum area is labeled with blue dots
and thehave been valid pixels in the Hα wings are identiﬁed with
green crosses. The bottom plot is a zoom on the blue wing.

where N is the number of valid pixels in the Hα line, S (i) (resp.
R(i) the counts of the studied spectrum (resp. reference spec-
trum) for pixel i.

Figure 4 shows the comparison of the Hα wings in the
studied spectrum (black line) with the 1D grid of synthetic
spectra (red lines) ranging here from 5000 (narrowest wings) to
6600 K (broadest wing). The pseudo-continuum area is labeled
with blue dots and the valid pixels in the Hα wings are identiﬁed
with green crosses. The bottom plot is a zoom on the blue wing.

The degrees of similarity versus the eﬀective temperature
deﬁne a function that is minimum for the eﬀective temperature
of the studied source. The minimum is found by ﬁtting a
second-degree polynomial around the lowest similarity value.
The top left plots in Figure 5 and 6 give examples of similarity
functions as a function of eﬀective temperature, for a synthetic
spectrum and for the ground-based observed spectrum of
ν And respectively. Each synthetic spectrum in the 1D subgrid
corresponds to a red dot. The second-degree polynomial ﬁtted
to the similarity function to minimize it is represented as a blue

The similarity functions for the synthetic spectra and ν And
show similar degrees of regularity and smoothness. The ﬁrst rea-
son is that the spectrum of ν And has a good S/N ratio. The sec-
ond reason is that in each point (red dots) the similarity func-
tions derives from the comparison of the same noisy studied
spectrum with diﬀerent noiseless synthetic spectra. The noises
on the points of a similarity function are correlated. The noise in
the studied spectrum and the systematic diﬀerences between the
studied and synthetic spectra propagate to the similarity func-
tions, not so much as ﬂuctuation and irregularities in the func-
tions, but as a vertical and horizontal shift and as a ﬂattening of
the curvature of the functions.

2.5.5. Surface gravity by ionization equilibrium

The ionization equilibrium method is based on the fact that the
abundances determined from lines of the same element, but with
diﬀerent ionization stages, should be the same. Building on this
idea, SPADES simultaneously models Fe lines in two ionization
stages: FeI and FeII.

Similarly as for Teﬀ, a 1D grid of synthetic spectra, diﬀer-
ing only by the surface gravity (this time) was calculated. For
each a “degree of ionization equilibrium” (hereafter refered to
as “gravity similarity”) is calculated as

S imgrav =

1
NFeI

NFeI

X
l=0

Resl −

1
NFeII

NFeII

X
l=0

Resl,

(5)

6

 
 
 
H. Posbic et al.: SPADES

Teff function

log(g) determination Function

FeI line

l

s
a
u
d
s
e
r

i

d
e
r
a
u
q
S

l

i

s
a
u
d
s
e
R
d
e
r
a
u
q
S

5
.
1

0
.
1

5
.
0

0
.
0

6
.
1

4
.
1

2
.
1

0
.
1

8
.
0

6
.
0

4
.
0

l

s
a
u
d
s
e
R

i

3
0
.
0

1
0
.
0

1
0
.
0
−

3
0
.
0
−

5200

5600

6000

6400

2.0

2.5

3.0

3.5

4.0

4.5

5.0

5.5

Teff (K)

log(g)

[Fe/H] determination Function

Ni abundance determination Function

l

i

s
a
u
d
s
e
R
d
e
r
a
u
q
S

8
0
.
0

6
0
.
0

4
0
.
0

2
0
.
0

−1.0

−0.5

0.0

0.5

−0.4

−0.2

0.0

0.2

0.4

[Fe/H]

[Ni/Fe]

Fig. 6. ν And similarity functions as a function eﬀective temper-
ature (top left), surface gravity (top right), iron over hydrogen
ratio (bottom left), and nickel over iron ratio (bottom right). The
polynomial (or linear interpolation for the surface gravity) used
to minimize the functions are represented as blue lines.

where NFeI (resp. NFeII ) are the numbers of FeI (resp. FeII) lines
used and Ri the count residuals for the line l:

Resl =

N

X
i=0

(S (i) − R(i)),

(6)

where N is the number of valid pixels in the line, S (i) (resp. R(i)
the count of the studied spectrum (resp. reference spectrum) for
pixel i.

Figure 7 shows an FeI line (top, green crosses) and an FeII
line (bottom, green crosses), used by SPADES to determine of
log g . The studied spectrum (log g = 4.5) is denoted in black and
the red lines are the synthetic reference spectra of the 1D subgrid
ranging from log g = 2.0 to log g = 5.0 by steps of 0.5. The neu-
tral iron line is alsmost insensitive to gravity, while the singly
ionized iron line becomes stronger for decreasing gravities.

The gravity similarity, as deﬁned above, should be null for
the surface gravity of the studied source. The zero of the grav-
ity similarity function is found by interpolation. The top right
plots in Figure 5 and ﬁgure 6 give an example of similarity func-
tions as a function of surface gravity. Each synthetic spectrum
in the 1D subgrid corresponds to a red dot. The linear interpo-
lation used to ﬁnd the gravity corresponding to the zero gravity
similarity is represented as a blue line.

2.5.6. iron over hydrogen ratio

The [Fe/H] determination is based on a global FeI line proﬁle
ﬁtting. For the other parameters, a 1D grid of synthetic spectra,
diﬀering only by the iron abundance, was calculated. For each

0
0
.
1

0
9
.
0

0
8
.
0

0
7
.
0

0
.
1

9
.
0

8
.
0

7
.
0

x
u
F

l

x
u
F

l

6320

6321

6322

6323

6324

6325

Wavelengths(A)

FeII line

6245

6246

6247

6248

6249

6250

Wavelengths(A)

Fig. 7. FeI line (top, green crosses) and an FeII line (bottom,
green crosses), used by SPADES to determine of log g . The
studied spectrum (log g = 4.5) is given in black and the red lines
are the synthetic reference spectra of the 1D subgrid ranging
from log g = 2.0 to 5.0 by step of 0.5.

synthetic spectrum, the global similarity between all synthetic
neutral iron lines and all observed neutral iron lines is derived as

S imFe =

NFeI

X
l=0

Res2
l ,

(7)

where NFeI is the number of neutral iron lines in the list of ref-
erence lines, Res2
l is the square of the count residuals for line l,
given by formula 6.

The iron content of the source corresponds to the minimum
similarity degree. It is found by adjusting a third-degree polyno-
mial through the “iron similarity function”. A third-degree poly-
nomial is preferred over a second-degree polynomial, because
the “iron similarity function” is usually asymmetric: steeper on
the metal-rich side than on the metal-poor side. The bottom left
plots in Figure 5 and ﬁgure 6 give an example of similarity func-
tions as a function of the iron over hydrogen ratio. Each synthetic
spectrum in the 1D subgrid corresponds to a red dot. The third-
degree polynomial ﬁtted to the similarity function to minimize it
is represented as a blue line.

2.6. Third step: Individualabundances

Once the iterative determination of the three atmospheric param-
eters has converged, the individual abundances are determined.
The general principle is very similar to the determination of
the iron content, except that the determination is direct and not
within an iterative loop with several other parameters.

Each element was determined individually, using a diﬀerent
pre-deﬁned list of lines. The diﬀerence with the [Fe/H] deter-
mination method is that for each element, the 1D grid was cal-
culated on-the-ﬂy for the Teﬀ, log g , and [Fe/H] determined by
SPADES and varying only by the abundance of the element to

7

 
 
 
H. Posbic et al.: SPADES

be determined. SPADES interpolates on-the-ﬂy the input ﬁles
for the Kurucz programs (e.g. the opacity distribution functions
- ODF (Castelli & Kurucz 2004)) and calls Kurucz ATLAS9
(Kurucz 2005) to calculate the atmospheric models and Kurucz
SYNTHE (Kurucz 2005) to compute the synthetic spectra. The
GNU-Linux ported versions of ATLAS9 and SYNTHE were
used (Sbordone et al. 2004; Sbordone 2005).

Element per element, for each synthetic spectrum the global
similarity between all synthetic lines and all observed lines of
the element X is derived as

S imX =

NX

X
l=0

Res2
l ,

(8)

where NX is the number of lines of the element X in the list of
reference lines and Res2
l is the square of the count residuals for
line l, given by formula 6.

The abundance of the element X corresponds to the minimal
similarity degree. It is found by adjusting a third-degree poly-
nomial through the element X similarity function. The bottom
right plots in Figure 5 and ﬁgure 6 give an example of similarity
functions as a function of nickel over iron ratio. Each synthetic
spectrum in the 1D subgrid corresponds to a red dot. The third-
degree polynomial ﬁtted to the similarity function to minimize it
is represented as a blue line.

3. Auxiliary data

3.1. Reference grid of modelsand synthetic spectra

The unidimensional reference grids used to derive the stellar pa-
rameters are calculated by SPADES by interpolation using a pre-
calculated grid. Models and synthetic spectra were calculated us-
ing the Kurucz programs ATLAS9 and SYNTHE (Kurucz 2005)
ported to GNU-Linux (Sbordone et al. 2004; Sbordone 2005).
About 2000 models and spectra were generated over the follow-
ing range of parameters:

– Eﬀective temperature: Teﬀfrom 4800 to 6800 K with a step

of 200 K.

– Surface gravity: log g from 2.0 to 5.5 with a step of 0.5.

– iron abundance: [Fe/H] from -3.0 to 1.0 dex with a step of

0.20 dex.

– Microturbulence: ξ = 1 km s−1

The models were calculated with the overshooting option
switched oﬀ and l/Hp = 1.25. The convergence of each
model was checked. The spectra were calculated for the spec-
tral domain ranging from 600 to 680 nm, corresponding to the
Giraﬀe/VLT HR13 and HR14 setups and a resolving power
R = 300 000 (SPADES convolves and re-samples the synthetic
spectra to the resolving power(s) of the studied spectrum).

4. Performance assessment

To assess the performances of SPADES, three series of tests
were performed.

The aim of the ﬁrst series was to assess the internal system-
atic and random errors obtained as a function of the S/N ratio,
but independently of the question of the initialization parame-
ters. We also investigated the correlations between the errors on
the diﬀerent parameters.

In the second tests, high S/N ground-based observed spectra

were analyzed with SPADES to assess the external errors.

SPADES proceeds iteratively to derive the atmospheric pa-
rameters. The third series of tests aims to assess the convergence
properties of SPADES when it is initialized with parameters that
are signiﬁcantly oﬀ the true values.

All tests were performed for the wavelength range and
the resolving power of the HR13 (R = 22 500) and HR14B
(R = 28 000) Giraﬀe setups. The three series of tests are pre-
sented below.

Result Teff distribution

Result log(g) distribution

y
c
n
e
u
q
e
r
F

y
c
n
e
u
q
e
r
F

5
2

0
2

5
1

0
1

5

0

0
4

0
3

0
2

0
1

0

y
c
n
e
u
q
e
r
F

0
4

0
3

0
2

0
1

0

5770

5790

5810

5830

4.2

4.3

4.4

4.5

4.6

4.7

4.8

Teff (K)

log(g)

Result [Fe/H] distribution

Result [Ni/Fe] distribution

y
c
n
e
u
q
e
r
F

0
5

0
4

0
3

0
2

0
1

0

−0.08

−0.04

0.00 0.02 0.04

−0.05

0.00

0.05

0.10

[Fe/H]

[Ni/Fe]

Fig. 8. Distributions of the Teﬀ(top left), log g (top right), [Fe/H]
(bottom left) and [Ni/Fe] (bottom right), estimated by SPADES
for 200 S/N=50 simulated HR13 and HR14B Giraﬀe spectra.
The true parameters are Teﬀ = 5800 K, log g = 4.5, [Fe/H]
= 0.0 dex, and [Ni/Fe] = 0.0 dex

3.2. List of reference lines

The reference lines used to derive the surface gravity, iron abun-
dance, and individual abundances were extracted from the line
list of Bensby et al. (2003). We note that the astrophysical oscil-
lator strengths provided by Bensby et al. (2003) were not used
in calculating of the synthetic spectra (see Sect. 3.1). For consis-
tency, we used the Kurucz oscillator strengths for all lines (ref-
erence or not).

4.1. Internal errors

The internal systematic and random errors were assessed
by Monte Carlo method. Starting from a synthetic spectrum
from the reference grid with Teﬀ = 5800 K, log g = 4.5,
[Fe/H] = 0.0 dex, ξ = 1 km s−1 and solar abundance scale,
three series of 200 noisy spectra were generated for SNRs
30, 50 and 100. The noise was injected following a Poisson

8

H. Posbic et al.: SPADES

distribution. The 600 spectra were analyzed with SPADES
to estimate their Teﬀ, log g , [Fe/H] as well as [Ti/Fe] and
[Ni/Fe] ratios as examples of abundance ratios estimates. In
this ﬁrst test, SPADES was initialized with the true parameters
of the synthetic spectra. Table 2 presents the medians and
dispersions of the distributions of residuals,
i.e. estimated
minus true, of the parameters derived by SPADES for each S/N
ratio. Figure 8 shows the distributions of Teﬀ, log g , [Fe/H]
, and [Ni/Fe] estimated by SPADES for the 200 S/N=50 spectra.

The distributions of

temperature and gravity residuals
present no signiﬁcant biases. The systematic errors on the iron
over hydrogen and titanium and nickel over iron ratios are of
about a few milli-dex and are most of the time one order of mag-
nitude smaller than the random errors. The random errors are
small, e.g. at S/N=30: less than 30 K for Teﬀ, 0.15 for log g and
a few hundredths of dex for the abundance ratios. we emphasize
that these are internal errors accounting only for photon noise.
External errors are assessed in Sect. 4.2.

Table 2. Medians and dispersions of the distributions of resid-
uals, i.e. estimated minus true, on Teﬀ, log g , [Fe/H] , [Ti/Fe]
and [Ni/Fe] derived by SPADES for the S/N: 100, 50 and 30.

med(Teﬀ res)
σ Teﬀ res
med(log g res)
σ log g res
med([Fe/H] res)
σ [Fe/H] res
med([Ti/Fe] res)
σ [Ti/Fe] res
med([Ni/Fe] res)
σ [Ni/Fe] res

(K)
(K)

(dex)
(dex)
(dex)
(dex)
(dex)
(dex)

S/N=100
0
8
0.00
0.05
0.002
0.009
0.004
0.003
-0.004
0.010

S/N=50
0
16
0.00
0.09
-0.001
0.020
0.005
0.040
0.002
0.030

S/N=30
0
27
0.00
0.15
-0.003
0.030
0.005
0.060
0.010
0.050

Figure 9 presents the estimate by SPADES of Teﬀ, log g ,
and [Fe/H] versus each other for the 200 stars with S/N=100
(top), S/N=50 (middle), and S/N=30 (bottom). The clearer er-
ror correlation is between the eﬀective temperature and the iron
abundance: an error of −50 K corresponds to an error of about
−0.075 dex. This correlation, as the others, is intrinsic to the
physics of the stellar atmopsheres. While Hα is weakly sensi-
tive to metallicity (van’t Veer-Menneret & Megessier 1996), the
equivalent width of the iron lines is sensitive to the eﬀective tem-
perature.

4.2. External errors: ground-based observed spectra

The ﬁrst series of tests was devoted to internal errors. The source
of noise was Poissonian photon noise. The aim of the second
series was to assess the external systematic errors. There are
several possible sources of external systematics. In particular,
the physics of the stellar atmospheres do not reproduce the
reality perfectly (e.g. discrepant oscillator strengths,
local
thermodynamical Equilibrium assumption, 1D modeling of the
atmosphere), there are usually instrumental calibration residuals
(e.g. from bias, ﬂat-ﬁeld, possibly fringing, etc.) and residuals
from the observing conditions (e.g. from sky-subtraction).

f
f
e
T

f
f
e
T

f
f
e
T

0
0
9
5

0
0
8
5

0
0
7
5

0
0
9
5

0
0
8
5

0
0
7
5

0
0
9
5

0
0
8
5

0
0
7
5

f
f
e
T

0
0
9
5

0
0
8
5

0
0
7
5

]

H
/
e
F

[

5
0
.
0

5
0
.
0
−

5
1
.
0
−

4.0 4.2 4.4 4.6 4.8 5.0

−0.15

−0.05

0.05

4.0 4.2 4.4 4.6 4.8 5.0

log(g)

[Fe/H]

log(g)

f
f
e
T

0
0
9
5

0
0
8
5

0
0
7
5

]

H
/
e
F

[

5
0
.
0

5
0
.
0
−

5
1
.
0
−

4.0 4.2 4.4 4.6 4.8 5.0

−0.15

−0.05

0.05

4.0 4.2 4.4 4.6 4.8 5.0

log(g)

[Fe/H]

log(g)

f
f
e
T

0
0
9
5

0
0
8
5

0
0
7
5

]

H
/
e
F

[

5
0
.
0

5
0
.
0
−

5
1
.
0
−

4.0 4.2 4.4 4.6 4.8 5.0

−0.15

−0.05

0.05

4.0 4.2 4.4 4.6 4.8 5.0

log(g)

[Fe/H]

log(g)

Fig. 9. SPADES estimate of Teﬀ, log g , and [Fe/H] versus each
others for the 200 stars with S/N=100 (top), S/N=50 (middle),
and S/N=30 (bottom).

4.2.1. The Giraffe solar spectrum

To investigate these problems, we retrieved from the Giraﬀe
archive (Royer et al. 2005, 2008) the high S/N ratio HR13
(R = 22 500) and HR14B (R =28 000) observed solar spectrum.
The Giraﬀe solar spectrum was acquired in twilight conditions,
which could alter the equivalent widths (Molaro et al. 2008).
Moreover, the library of reference spectra used by SPADES was
calulated with the Kurucz oscillator strengths (log gf), not with
astrophysical log gf, even for the reference lines used by the dif-
ferent diagnostics. We therefore proceeded in two steps to ana-
lyze the Giraﬀe solar spectrum. First the eﬀective temperature
and surface gravity were ﬁxed to their bibliographic values, i.e.
Teﬀ = 5777 K and log g = 4.44, and only the iron over hydro-
gen and titanium and nickel over iron ratios were determined
by SPADES. Then, in a second step, the solar spectrum was re-
analyzed, this time requesting SPADES to determine the ﬁve pa-
rameters Teﬀ, log g , [Fe/H] , [Ti/Fe] , and [Ni/Fe] .

Table 3 lists the iron over hydrogen and titanium and nickel
over iron ratios derived by SPADES when the eﬀective tempera-
ture and surface gravity were ﬁxed to their bibliographic values
Teﬀ = 5777 K and log g = 4.44. The iron over hydrogen and tita-
nium over iron ratios are underestimated by −0.08 and −0.09 dex
respectively, while the nickel over iron ratio is close to the true
value.

The solar spectrum was then re-analyzed,

requesting
SPADES to also determine Teﬀand log g . SPADES was initial-
ized with the bibliographic parameters Sun and converged in ﬁve
iterations. Table 4 presents the parameters obtained by SPADES
for the Giraﬀe solar spectrum.

The eﬀective temperature derived by SPADES, 5689 K, is
88 K lower than the bibliographic temperature Teﬀ = 5777 K.
Figure 10 shows a zoom on the red wing of the Hα line
from the Giraﬀe HR14B solar spectrum (black line). Two syn-

9

H. Posbic et al.: SPADES

Table 3. iron over hydrogen and titanium and nickel over iron
ratios derived by SPADES for a solar HR13 and HR14B so-
lar spectrum, when the eﬀective temperature and surface grav-
ity were ﬁxed to their bibliographic values Teﬀ = 5777 K and
log g = 4.44.

[Fe/H]
(dex)
-0.08

[Ti/Fe]
(dex)
-0.09

[Ni/Fe]
(dex)
-0.03

Table 4. Eﬀective temperature, surface gravity, iron over hydro-
gen and titanium and nickel over iron ratios derived by SPADES
for the Giraﬀe HR13 and HR14B solar spectra.

Teﬀ
(K)
5689

log g

4.46

[Fe/H]
(dex)
-0.18

[Ti/Fe]
(dex)
-0.06

[Ni/Fe]
(dex)
0.04

thetic spectra are overplotted: in red a synthetic spectrum with
Teﬀ = 5689 K and in blue Teﬀ = 5777 K (the values of the
other parameters are those of the Sun: log g = 4.44 and [Fe/H]
= 0.0 dex). The red spectrum (Teﬀ = 5689 K) agrees much better
agreement with the Giraﬀe solar spectrum than the blue spec-
trum (Teﬀ = 5777 K).

x
u
l
f

d
e
s

i
l

a
m
r
o
N

0
.
1

9
.
0

8
.
0

7
.
0

6
.
0

6564

6566

6570

6568
Wavelengths(A)

6572

6574

6576

Fig. 10. Zoom on the red wing of the Hα line from the Giraﬀe
HR14B solar spectrum (black line). Two synthetic spectra are
overplotted: in red a synthetic spectrum with Teﬀ = 5689 K and
in blue Teﬀ = 5777 K (the values of the other parameters are
those of the Sun: log g = 4.44 and [Fe/H] = 0.0 dex).

The surface gravity derived by SPADES, log g = 4.46 is

consistent with the Sun’s gravity log g = 4.44.

The iron to hydrogen ratio derived by SPADES is underes-
timated by −0.18 dex with respect to the Sun. There are two
main origins for this oﬀset. On the one hand, there is the oﬀset

10

of −0.08 dex reported in table 3 that is likely due to the mod-
eling of the spectra, in particular slightly discrepant oscillator
strengths, and also to possible equivalent width alterations due
to twilight observing, as reported by Molaro et al. (2008). On
the other hand, as discussed in Sect. 4.1, the error on the eﬀec-
tive temperature propagates into an error on the iron abundance.
The oﬀset of −88 K here propagates into an oﬀset of −0.1 dex.
The titanium and nickel over iron ratios derived when
Teﬀand log g are determined by SPADES are similar to those
obtained when Teﬀand log g were ﬁxed to their bibliographic
values. The reason is that the iron, titanium and nickel abun-
dances are all similarly aﬀected by the −88 K oﬀset and
therefore the eﬀect partly canceled out in the logarithmic ratios
of titanium over iron and nickel over iron.

4.2.2. S4N reference spectra

The parameters of the Sun are very accurately known, which
makes it a natural target to assess the performances of SPADES.
On the other hand, Molaro et al. (2008) reported an alteration of
the equivalent widths of the lines in the Giraﬀe solar spectrum,
which was acquired in twilight conditions.

To further test the performances of SPADES with a ground-
based observed spectrum, we selected 5 stars, the Sun, ν And
(HD9826), β Vir (HD102870), µ Her (HD161797) and σ Dra
(HD185144) in Cayrel et al. (2011). The authors derived the
eﬀective temperatures of their stars from angular diameters
measured with interferometry. All their stars have diameters
known to 2% or better, leading to an accuracy on the eﬀective
temperatures of about 25 K. All stars are bright and were exten-
sively studied. Cayrel et al. (2011) adopted for log g and [Fe/H]
recent determinations from the PASTEL catalog (Soubiran et al.
2010). We proceeded similarly, adopting for log g and [Fe/H]
the median over the ﬁve most recent determinations contained
in PASTEL. The titanium and nickel over iron ratios were
extracted from Valenti & Fischer (2005). The spectra for the ﬁve
stars were retrieved from the S4N library (Allende Prieto et al.
2004). They were degraded in resolving power and in sampling
and restricted in wavelength to the Giraﬀe HR13 and HR14B
setups.

SPADES converged in two (ν And) to four (µ Her and σ Dra)
iterations. Table 5 lists the bibliographic parameters and the pa-
rameters derived by SPADES for the ﬁve tests stars. Fig. 11 dis-
plays the temperatures, gravities, iron over hydrogen and nickel
over iron ratios estimated by SPADES versus their bibliographic
values. Table 6 presents the mean and dispersion of the residuals
(SPADES minus bibliographic) on the estimation of the atmo-
spheric parameters as well as the titanium and nickel over iron
ratios.

On average, the eﬀective temperature is recovered with a
bias of +46 K. For the same stars, Cayrel et al. (2011) found a
bias of similar amplitude, but with the opposite sign, of about
−90 K. In addition to the small statistics and the details of
the Hα proﬁle ﬁting, we note that the physics used to com-
pute the grids of models and synthetic spectra diﬀer in several
aspects. SPADES relies on Kurucz ATLAS9 models computed
with the mixing length parameter l/Hp = 1.25 and SYNTHE
spectra (see Sect. 3.1). Cayrel et al. (2011) used the Kurucz
ATLAS9 models with l/Hp = 0.5 and a modiﬁed version of
the Kurucz BALMER9 with the Stark broadening treatment of

 
Table 5. Bibliographic parameters and parameters derived by
SPADES for the ﬁve tests stars.

4.3. Convergence properties

4.3.1. First test

H. Posbic et al.: SPADES

name

Sunbib
SunS PADES
ν Andbib
ν AndS PADES
β Virbib
β VirS PADES
µ Herbib
µ HerS PADES
σ Drabib
σ DraS PADES

Teﬀ
(K)
5777
5829
6170
6177
6062
6113
5540
5624
5287
5322

log g

4.44
4.15
4.12
4.18
4.11
3.44
3.99
4.41
4.57
4.64

[Fe/H]
(dex)
0.00
0.05
0.06
−0.01
0.16
0.22
0.28
0.24
−0.23
−0.19

[Ti/Fe]
(dex)
0.00
−0.12
0.02
−0.11
−0.01
−0.18
−0.08
0.06
0.00
0.05

[Ni/Fe]
(dex)
0.00
−0.09
−0.02
0.00
0.01
−0.04
0.02
0.18
−0.03
0.00

0
0
2
6

0
0
0
6

0
0
8
5

0
0
6
5

0
0
4
5

0
0
2
5

3
.
0

2
.
0

1
.
0

0
.
0

1
.
0
−

3
.
0
−

)

K

(

S
E
D
A
P
S

f
f
e
T

)
x
e
d
(

S
E
D
A
P
S

]

H
/
e
F

[

S
E
D
A
P
S

)
g
(
g
o

l

6
.
4

4
.
4

2
.
4

0
.
4

8
.
3

6
.
3

4
.
3

5200

5400

5600

5800

6000

6200

3.4

3.6

3.8

4.0

4.2

4.4

4.6

Teff bib (K)

log(g) bib 

)
x
e
d
(

S
E
D
A
P
S

]
e
F

/
i

N

[

2
.
0

1
.
0

0
.
0

1
.
0
−

2
.
0
−

−0.3

−0.2

−0.1

0.0

0.1

0.2

0.3

−0.2

−0.1

0.0

0.1

0.2

[Fe/H] bib (dex)

[Ni/Fe] bib (dex)

Fig. 11. Temperatures (top left), gravities (top right), iron over
hydrogen (bottom left), and nickel over iron ratios (bottom right)
estimated by SPADES versus their bibliographic values.

Table 6. Means and dispersions of the residuals (SPADES minus
bibliographic) on the estimation of the atmospheric parameters
as well as the titanium and nickel over iron ratios.

Teﬀ
(K)
46
25

log g

−0.08
0.37

[Fe/H]
(dex)
0.01
0.05

[Ti/Fe]
(dex)
−0.05
0.12

[Ni/Fe]
(dex)
0.01
0.09

mean
σ

Stehl´e & Hutcheon (1999) and impact broadening by neutral hy-
drogen collisions of Allard et al. (2008).

The iron over hydrogen and nickel over iron ratios are
recovered without signiﬁcant oﬀsets. The titanium over iron
ratio, determined from four Ti
lines (without astrophysical
log gf adjustement), presents an oﬀset of −0.05 dex. To the limit
of the small statistics, the error on Teﬀshows no trend with Teﬀ.

SPADES proceeds iteratively to derive the atmospheric parame-
ters Teﬀ, log g , and [Fe/H] . In the ﬁrst series of tests, SPADES
was initialized with the true parameters. Of course, in reality, the
true parameters are unknown. The aim of this third series of tests
is to assess the behavior of SPADES when it is initialized with
parameters that are signiﬁcantly diﬀerent from the true values.

For this third test, 34 single stars were generated. Their pa-
rameters were randomly drawn following uniform distributions
over the following intervals: Teﬀin [5200, 6400] K, log g in [3.0,
4.5], and [Fe/H] in [-2.0, 0.6] dex. No star was simulated for
[Fe/H] below -2.0, because the four Fe II lines present in the
Giraﬀe HR13 and HR14B become too weak to allow derivat-
ing the surface gravity. This is illustrated in the top right plot
of Figure 12, which shows three synthetic spectra of metal-
licity [Fe/H] = 0.0 dex (blue), [Fe/H] = −1.0 dex (red),
[Fe/H] = −2.0 dex (black). The line at 6456.39 Å is an Fe II
line. At [Fe/H] = -2.0 dex, the line is barely visible.

FeI line

FeII line  

x
u
l
f

d
e
z

i
l

a
m
r
o
N

x
u
l
f

d
e
z

i
l

a
m
r
o
N

0
.
1

9
.
0

8
.
0

7
.
0

6
.
0

5
.
0

4
.
0

0
.
1

9
.
0

8
.
0

7
.
0

6
.
0

5
.
0

4
.
0

x
u
l
f

d
e
z

i
l

a
m
r
o
N

0
.
1

9
.
0

8
.
0

7
.
0

6
.
0

5
.
0

4
.
0

6156

6157

6158

6159

6455

6456

6457

6458

Wavelength (A)

Wavelength (A)

Ni line

Ti line

x
u
l
f

d
e
z

i
l

a
m
r
o
N

0
.
1

9
.
0

8
.
0

7
.
0

6
.
0

5
.
0

4
.
0

6326

6327

6328

6329

6256

6257

6258

6259

6260

Wavelength (A)

Wavelength (A)

Fig. 12. Extract of three synthetic spectra of metallicity [Fe/H]
=0.0 dex (blue), [Fe/H] =-1.0 dex (red), [Fe/H] =-2.0 dex
(black), showing the inﬂuence of the metallicity on an Fe I line
(top left), an Fe II line at 6456.39 Å (top right), a Ni I line (bot-
tom left) and a Ti I line at 6258.11 Å (bottom right).

For each of the 34 single stars, three noisy HR13 and HR14B
Giraﬀe spectra were simulated for S/N of 30, 50 and 100. The
noise was Poissonian photon noise. The three series of 34 spec-
tra were analyzed by SPADES. In all 102 cases SPADES was
initialized with the same parameters: Teﬀ = 5800 K, log g = 3.0
and [Fe/H] = −1.0 dex. The left side of Figure 13 presents the
diﬀerences between the true parameters of the 34 synthetic stars
and the initialization parameters: Teﬀ(top), log g (middle) and
[Fe/H] (bottom).

11

 
 
 
 
 
 
 
 
 
 
 
H. Posbic et al.: SPADES

Histogram of Teff (true) − (5800)

Histogram of Teff (true) − Teff(result)

y
c
n
e
u
q
e
r
F

5
1

0
1

5

0

−600 −400 −200

0

200

400

600

−600 −400 −200

0

200

400

600

Teff(true) − (5800)

Teff(true) − Teff(result)

Histogram of log(g) (true) − (3.0)

Histogram of log(g) (true) − log(g)(result)

y
c
n
e
u
q
e
r
F

0
1

8

6

4

2

0

0.0

0.2

0.4

0.6

0.8

1.0

1.2

1.4

−2

−1

0

1

2

log(g)(true) − (3.0)

log(g)(true) − log(g)(result)

Histogram of [Fe/H] (true) − (−1.0)

Histogram of [Fe/H] (true) − [Fe/H](result)

y
c
n
e
u
q
e
r
F

0
2

5
1

0
1

5

0

y
c
n
e
u
q
e
r
F

y
c
n
e
u
q
e
r
F

y
c
n
e
u
q
e
r
F

4

3

2

1

0

5

4

3

2

1

0

4

3

2

1

0

−1.0

−0.5

0.0

0.5

1.0

1.5

−1.0

−0.5

0.0

0.5

1.0

1.5

[Fe/H](true) − (−1.0)

[Fe/H](true) − [Fe/H](result)

Fig. 13. Left: Diﬀerences between the true parameters of the 34
synthetic stars and the initialization parameters: Teﬀ(top), log g
(middle) and [Fe/H] (bottom). Right: Distributions of Teﬀ(top),
log g (middle) and [Fe/H] (bottom) residuals for S/N=50.

SPADES converged for 33 out of the 34 stars in at most
six iterations (for all SNRs). It did not converge for one star
with the parameters: Teﬀ = 5386 K, log g = 4.3, and [Fe/H]
= 0.4 dex. At the ﬁrst iteration, the diﬀerence of 500 K between
the true Teﬀand the initialization value and the high true metallic-
ity [Fe/H] = 0.4 dex, led SPADES to look for a synthetic spec-
trum with a metallicity higher than 1 dex, i.e. beyond the upper
boundary of the library of synthetic spectra. Unable to ﬁnd the
synthetic spectrum, SPADES stopped processing this spectrum
(at all three SNRs).

In all 33 converging stars, it was observed that the eﬀective
temperature converged faster than the other parameters. This is
because in mid-F-G dwarfs the Hα wings are hardly sensitive
to wrong log g and [Fe/H] (van’t Veer-Menneret & Megessier
1996), while on the contrary log g and [Fe/H] are sensitive
to wrong Teﬀ. This suggests a possible future evolution for
SPADES, which could at the ﬁrst iteration determine only
Teﬀand then at the next iterations determine all three atmospheric
parameters. This would probably have prevented SPADES from
looking for spectra outside the boundaries of the library for the
34th spectrum.

Table 7 presents the medians and the dispersions of the dis-
tributions of Teﬀ, log g , and [Fe/H] residuals, i.e. estimated mi-
nus true, derived by SPADES for each S/N ratio. The right side
of Figure 13 shows the distributions of Teﬀ(top), log g (middle),
and [Fe/H] (bottom) residuals for S/N=50. The performances
derived from test 3 (for of a wider variety of input atmospheric
parameters) are similar to those obtained in test 1. The conver-
gence process has therefore a very moderate impact on SPADES
ﬁnal Teﬀ, log g , and [Fe/H] .

Out of the 33 converged stars, [Ti/Fe] and [Ni/Fe] ratios
were derived for 21. Below ametallicity of about −1.4 dex (the

12

Table 7. Medians and dispersions of the distributions of Teﬀ,
log g , and [Fe/H] residuals, i.e. estimated minus true, derived
by SPADES for the SNRs 100, 50 and 30.

med(Teﬀ res)
σ Teﬀ res
med(log g res)
σ log g res
med([Fe/H] res)
σ [Fe/H] res

(K)
(K)

(dex)
(dex)

S/N=100
8
17
-0.03
0.08
0.00
0.02

S/N=50
10
24
0.00
0.15
0.00
0.03

S/N=30
0
27
0.02
0.25
-0.01
0.03

precise value is a function of Teﬀ), the lines contained in the
HR13 and HR14B become too weak to derive the abundances.
This is illustrated by the bottom left and bottom right plots in
Figure 12. At [Fe/H] = −1 dex (red line), the Ni and Ti lines (at
6258.11 Å) are already weak and at [Fe/H] = −2 dex they are
not visible anymore.

Table 8 presents the medians and the dispersions of the dis-
tributions of [Ti/Fe] and [Ni/Fe] residuals, i.e. estimated minus
true, derived by SPADES for the SNRs 100, 50 and 30. The sys-
tematic and random errors derived from test 3 are on average
larger than those obtained from test 1. The main reason is very
likely that in test 3, [Ti/Fe] and [Ni/Fe] ratios are obtained for
a wide range of metallicities down to [Fe/H] ∼ −1.4 dex, while
in test 1 a solar abundance star was considered.

Table 8. Medians and dispersions of the distributions of [Ti/Fe]
and [Ni/Fe] residuals, i.e. estimated minus true, derived by
SPADES for the SNRs 100, 50 and 30.

med([Ti/Fe] res)
σ [Ti/Fe] res
med([Ni/Fe] res)
σ [Ni/Fe] res

(dex)
(dex)
(dex)
(dex)

S/N=100
0.008
0.020
-0.007
0.030

S/N=50
0.03
0.07
0.02
0.07

S/N=30
0.06
0.12
0.05
0.07

4.3.2. Second test

Iterative methods present the risk to converge toward a local
minimum, rather than the global minimum. To investigate this
risk in more detail, we selected one out of the 34 times 200 spec-
tra analyzed in Sect. 4.3.1 above, with S/N=50. The true param-
eters of the spectrum were Teﬀ = 5992 K, log g = 4.4, [Fe/H]
= −0.3 dex, [Ti/Fe] = 0 dex and [Ni/Fe] = 0 dex. SPADES an-
alyzed the spectrum a ﬁrst time, starting from its true parameters
and found Teﬀ = 6025 K, log g = 4.35, [Fe/H] = −0.26 dex,
[Ti/Fe] = 0.04 dex and [Ni/Fe] = 0.05 dex. SPADES then re-
analyzed the spectrum another 50 times, but with starting pa-
rameters randomly chosen following uniform distributions cen-
tered on the true parameters and widths of ± 500 K (Teﬀ), ± 0.5
(log g ) and ± 0.4 dex ([Fe/H] ). The volume in the parameters
space considered for the initialization is larger, i.e. conservative,
with respect to the estimated performances of SPADES-TE (see
Sect. 2.5.2). Table 9 presents the means and residuals of the pa-
rameters determined by SPADES when initialized randomly mi-
nus those determined by SPADES when initialized with the true
parameters. Means and dispersions are all low, showing that at
S/N=50, SPADES is very weakly sensitive to the initialization
conditions.

H. Posbic et al.: SPADES

Table 9. Means and dispersions of the residuals (SPADES ini-
tialized randomly minus SPADES initialized with the true pa-
rameters) on the estimation of the atmospheric parameters as
well as the titanium and nickel over iron ratios.

Teﬀ
(K)
1
3

log g

−0.01
0.02

[Fe/H]
(dex)
−0.007
0.007

[Ti/Fe]
(dex)
0.002
0.004

[Ni/Fe]
(dex)
−0.007
0.007

mean
σ

5. Summary

The automated stellar parameters determination software
SPADES was presented. It relies on a line by line comparison
between the studied spectrum and synthetic spectra. SPADES
derives the radial velocity, the eﬀective temperature, the surface
gravity, and the iron and individual abundances.

SPADES internal systematic and random errors were
assessed by Monte Carlo method. For example, simulating
Giraﬀe HR13 and HR14B setups from synthetic spectra for
a star with Teﬀ = 5800 K, log g = 4.5, [Fe/H] = 0.0 dex
and for a S/N of 100, the stellar parameters were recovered
with no signiﬁcant bias and with 1-σ precisions of 8 K for the
temperature, 0.05 for the log g , 0.009 for [Fe/H] , 0.003 for
[Ti/Fe] , and 0.01 for [Ni/Fe] . The external systematic errors
were evaluated with ground-based observed spectra and the
convergence properties were assessed by a Monte Carlo method.

Several evolutions of SPADES are planned. On the one hand,
we aim to adapt and test SPADES for a greater variety of spec-
tral types and luminosity classes. This includes addingare the
micro-turbulence to the parameters determined by SPADES. On
the other hand, we plant to implement additional diagnostics to
determine the atmospheric parameters, e.g. use the wings of the
strong lines to derive the surface gravity (for example Mg Ib
triplet in dwarfs or infra-red Ca II triplet in giants).

Acknowledgements. This work is ﬁnanced by the CNRS (Centre National de la
Recherche Scientiﬁque) and the CNES (Centre National d’Etudes Spatiales). We
would like to thank R. Kurucz for making publicly available the ATLAS9 and
SYNTHE programs and F. Castelli for providing the new ODF tables. We are
grateful to the referee for his/her very fruitful comments and suggestions.

References

Allard, N. F., Kielkopf, J. F., Cayrel, R., & van’t Veer-Menneret, C. 2008, A&A,

480, 581

Allende Prieto, C., Barklem, P. S., Lambert, D. L., & Cunha, K. 2004, A&A,

420, 183

Allende Prieto, C., Rebolo, R., Garc´ıa L´opez, R. J., et al. 2000, AJ, 120, 1516
Bailer-Jones, C. A. L. 2000, A&A, 357, 197
Bailer-Jones, C. A. L. 2010, MNRAS, 403, 96
Barklem, P. S., Stempels, H. C., Allende Prieto, C., et al. 2002, A&A, 385, 951
Bensby, T., Feltzing, S., & Lundstrom, I. 2003, VizieR Online Data Catalog,

341, 527

Bijaoui, A., Recio-Blanco, A., & de Laverny, P. 2008, in American Institute
of Physics Conference Series, Vol. 1082, American Institute of Physics
Conference Series, ed. C. A. L. Bailer-Jones, 54–60

Boeche, C., Siebert, A., Williams, M., et al. 2011, ArXiv e-prints
Bonifacio, P. & Caﬀau, E. 2003, A&A, 399, 1183
Castelli, F. & Kurucz, R. L. 2004, ArXiv Astrophysics e-prints
Cayrel, R., Perrin, M.-N., Barbuy, B., & Buser, R. 1991, A&A, 247, 108
Cayrel, R., van’t Veer-Menneret, C., Allard, N. F., & Stehl´e, C. 2011, A&A, 531,

A83+

Franc¸ois, P., Depagne, E., Hill, V., et al. 2003, A&A, 403, 1105
Fuhrmann, K. 1998, A&A, 338, 161
Fuhrmann, K. 2004, Astronomische Nachrichten, 325, 3
Fuhrmann, K. 2008, MNRAS, 384, 173

Jofr´e, P., Panter, B., Hansen, C. J., & Weiss, A. 2010, A&A, 517, A57
Katz, D. 2001, Journal of Astronomical Data, 7, 8
Katz, D. 2009, in SF2A-2009: Proceedings of the Annual meeting of the French
Society of Astronomy and Astrophysics, ed. M. Heydari-Malayeri, C. Reyl’E,
& R. Samadi, 57

Katz, D., Munari, U., Cropper, M., et al. 2004, MNRAS, 354, 1223
Katz, D., Soubiran, C., Cayrel, R., Adda, M., & Cautain, R. 1998, A&A, 338,

151

Kurucz, R. L. 2005, Memorie della Societa Astronomica Italiana Supplementi,

8, 14

Molaro, P., Levshakov, S. A., Monai, S., et al. 2008, A&A, 481, 559
Perrin, M.-N., Friel, E. D., Bienayme, O., et al. 1995, A&A, 298, 107
Recio-Blanco, A., Bijaoui, A., & de Laverny, P. 2006, MNRAS, 370, 141
Royer, F., J´egouzo, I., Chiligarian, I., Prugniel, P., & Le Sidaner, P. 2008, in
Astronomical Spectroscopy and Virtual Observatory, ed. M. Guainazzi &
P. Osuna, 53

Royer, F., Prugniel, P., & J´egouzo, I. 2005,

in SF2A-2005: Semaine de
l’Astrophysique Francaise, ed. F. Casoli, T. Contini, J. M. Hameury, &
L. Pagani, 645

Sbordone, L. 2005, Memorie della Societa Astronomica Italiana Supplementi, 8,

61

Sbordone, L., Bonifacio, P., Castelli, F., & Kurucz, R. L. 2004, Memorie della

Societa Astronomica Italiana Supplementi, 5, 93

Siebert, A., Williams, M., Siviero, A., et al. 2011, VizieR Online Data Catalog,

3265, 0

Soubiran, C., Bienaym´e, O., & Siebert, A. 2003, A&A, 398, 141
Soubiran, C., Le Campion, J.-F., Cayrel de Strobel, G., & Caillo, A. 2010, A&A,

515, A111

Stehl´e, C. & Hutcheon, R. 1999, A&AS, 140, 93
Stetson, P. B. & Pancino, E. 2008, PASP, 120, 1332
Stetson, P. B. & Pancino, E. 2010, in Astrophysics Source Code Library, record

ascl:1011.002, 11002

Valenti, J. A. & Fischer, D. A. 2005, ApJS, 159, 141
van’t Veer-Menneret, C. & Megessier, C. 1996, A&A, 309, 879
Zucker, S. 2003, MNRAS, 342, 1291

13

0
.
1

8
.
0

x
u
F

l

6
.
0

4
.
0

2
.
0

6550

6555

6560

Wavelengths(A)

