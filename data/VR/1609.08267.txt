7
1
0
2

r
a

M
8
2

]

V
C
.
s
c
[

2
v
7
6
2
8
0
.
9
0
6
1
:
v
i
X
r
a

De-noising,StabilizingandCompleting3DReconstructionsOn-the-gousingPlanePriorsMaksymDzitsiuk1,2,JÂ¨urgenSturm2,RobertMaier1,LingniMa1andDanielCremers1Abstractâ€”Creating3Dmapsonrobotsandothermobiledeviceshasbecomearealityinrecentyears.Online3DreconstructionenablesmanyexcitingapplicationsinroboticsandAR/VRgaming.However,thereconstructionsarenoisyandgenerallyincomplete.Moreover,duringonlinereconstruction,thesurfacechangeswitheverynewlyintegrateddepthimagewhichposesasigniï¬cantchallengeforphysicsenginesandpathplanningalgorithms.Thispaperpresentsanovel,fastandrobustmethodforobtainingandusinginformationaboutplanarsurfaces,suchaswalls,ï¬‚oors,andceilingsasastagein3DreconstructionbasedonSignedDistanceFields(SDFs).Ouralgorithmrecoverscleanandaccuratesurfaces,reducesthemovementofindividualmeshverticescausedbynoiseduringonlinereconstructionandï¬llsintheoccludedandunobservedregions.Weimplementedandevaluatedtwodifferentstrategiestogenerateplanecandidatesandtwostrategiesformergingthem.Ourimplementationisoptimizedtoruninreal-timeonmobiledevicessuchastheTangotablet.Inanextensivesetofexperiments,wevalidatedthatourapproachworkswellinalargenumberofnaturalenvironmentsdespitethepresenceofsigniï¬cantamountofocclusion,clutterandnoise,whichoccurfrequently.Wefurthershowthatplaneï¬ttingenablesinmanycasesameaningfulsemanticsegmentationofreal-worldscenes.I.INTRODUCTIONInthispaperweinvestigatetheproblemofreal-time,on-device3Dreconstruction.Whileexisting3Dreconstructionalgorithms[1]â€“[6]aremostlytargetedatofï¬‚ineuseoftheresulting3Dmodels,manyapplicationsinroboticsandARgamingrequirethatvalidanddependablemodelsexistalreadyduringmodelacquisition,e.g.,becausetherobotorplayeractivelyexplorestheenvironmentwhilethe3Dmodelisbeingacquired.Thisleadstoseveralinterestingproblemsthathavenâ€™tre-ceivedmuchattentionsofarandthatwetackleinthispaper:First,the3Dmodelchangeswitheverynewobservation,whichleadstoawobblingsurfaceandchangingtopology(seeFig.3forananalysis),whichposesaproblemforpathplanningalgorithmsandphysicssimulations.Forexample,virtualballsthrownintothemeshofacurrentlyreconstructedroomwillcontinuouslyrollaroundasthereconstructiongetsreï¬ned.Atowerofvirtualobjectsfallswithoutuserinterventionforthesamereason(Fig.2).Second,the3Dreconstructiontypicallycontainsholesandisgenerallyin-complete,evenafterscanninghasbeenï¬nalized.Similarly,1MaksymDzitsiuk,RobertMaier,LingniMaandDanielCremersarewiththeComputerVisionGroup,DepartmentofComputerScience,TechnicalUniversityofMunich{dzitsiuk,maierr,lingni,cremers}@in.tum.de.2MaksymDzitsiukandJÂ¨urgenSturmarewithGoogle{dzitsiuk,jsturm}@google.com.(a)Rawreconstruction(b)De-noisedreconstruction(c)Holeï¬lling(d)ObjectsegmentationFig.1.Real-worldscansgenerallysufferfromnoiseandholesinthereconstructedmodels(topleft).Inman-madeenvironments,thenoisecanbesigniï¬cantlyreducedbyapplyingaplaneprior(topright).Furthermore,byextendingthedetectedplanesintounobservedregions,holescanbeï¬lledautomatically(bottomleft).Thisalsoenablesscenesegmentationandobjectdetection(bottomright).thiscausesproblemsforrobotnavigationandsimulatedavatarsthatcannotreasonaboutspaceoutsideofthealreadyscannedarea.Third,thereconstructionsaregenerallynoisy(especiallyinthebeginning)whichis(atleast)visuallyunpleasantifnotproblematicfortraversabilityanalysis.Ourgoalisthustode-noise,stabilizeandcomplete3Dscansduringmodelacquisition.Whilethisisahardprobleminthegeneralcase,itbecomestractableinindoorenvironmentswherewemayexpectmanyplanarsurfaces.Incorporatingplanepriorsinto3Dindoorreconstructionsce-nariosyieldscleaner,morerealisticandmorecomplete3Dmodelsofroomsorhouse-scaleenvironmentsbyimprovingthegeometricreconstructionofwalls,ï¬‚oorsandotherplanarsurfaces.Figure1illustratesourapproach.Itisclearlyvisiblethatthenoiseissigniï¬cantlyreducedonplanarsurfacesresultinginamoreaccurateandvisuallymoreappealinggeometric3Dreconstruction.Furthermore,weareabletoclosevariousholesintheï¬‚oorandthewalls.Finally,objectscanbesegmentedandsemanticinformationcanbeattachedtothereconstructedscene.Toachievehigh-qualityreconstructionsfromcommodityRGB-Dsensors,manyapproachesfusenoisyrawdepthmapsinmemoryefï¬cientdatastructuressuchassigneddistanceï¬elds(SDF)[7].Theseimplicitsurfacerepresentationsallow 
 
 
 
 
 
Fig.2.Continuous3Dreconstructionisproblematicforphysicsengines.ThisimageshowsavirtualJengatowerstandingonaplanarsurface.Duetosensornoiseduringreconstruction,thetowerfallsoverwithoutapplyingaplaneprior.Fig.3.Duringonline3Dreconstruction,thesurfaceisconstantlymovingduetosensornoise.Theplotshowstherootmeansquaredifference(RMSD)betweenverticesofthereconstructedmeshovertime.Theexamineddataincludesstaticobservationofï¬‚oorover250frames,executed10times.forhighlyaccurategeometricrecontructionsandprovidetherequiredscalabilityandmemoryefï¬ciency.Inthispaper,weintroduceanefï¬cientmethodtoapplyaplanepriorduringSDF-based3Dreconstruction.Theaccompanyingvideocanbefoundathttps://youtu.be/8OxwiRpmzn4.Themaincontributionsofthispaperare:â€¢Weproposeanalgorithmforreal-time3Dreconstruc-tiononmobiledevicesthatincorporatespriorsformodellingplanarsurfacesofindoorenvironments.â€¢Weintroduceanovelwayofestimatingplanesbyï¬ttingthemtoSignedDistanceFields.ThepresentedmethodisbasedonrobustleastsquaresandisfasterthanRANSAC-basedmethods.Thedetectedlocalplanecandidatesaremergedtoï¬ndgloballyconsistentplanes.â€¢Weapplyourapproachtosigniï¬cantlyreducenoiseonï¬‚atsurfacesbycorrectingSDFvaluesusingdetectedplanes.Further,wedemonstratethatthemethodcanbeusedtoï¬llholesinincompletereconstructed3Dmodels.Lastly,weuseplanepriorstodirectlyobtainobject-levelandsemanticsegmentation(e.g.walls)ofindoorenvironments.II.RELATEDWORKInthissection,weï¬rstdiscussthemostrelatedworksofstate-of-the-artRGB-Dbased3Dreconstruction.Second,wediscusstheuseofplanepriorsin2.5/3Dreconstruction.3Dreconstructionwithsigneddistanceï¬elds:Kinect-FusionbyNewcombeetal.[1]wastheï¬rstsystemtoreconstructhighlyaccurate3Dmodelsofpersons,objectsandworkspacesoflimitedsize.ExtensionstoKinectFusionfocusonvariousaspectsof3Dmodeling.Bylowetal.[8]performdirectcameratrackingagainsttheSDF,whileNiessneretal.[3]enablelarge-scale3Dmappingusinganefï¬cientvoxelhashingscheme.Otherapproachestackletheproblemoflarge-scale3Dreconstructionbydirectframe-to-(key)frametrackingwithcontinuousposegraphoptimiza-tion[2]andsubsequentdatafusioninanOctree-basedSDFrepresentation[9]orbyachievingglobalconsistencyusingsubmap-basedbundleadjustment[10].Recently,theBundleFusionsystembyDaietal.[6]extends[3]toallowforlarge-scalereconstructionofpreviouslyunseengeometricaccuracy.However,noneoftheseframeworksexploitsplanepriorsfortrackingorimprovingthereconstructionquality.AsthesesystemsusuallyextensivelyrelyontheuseofGPUsorpowerfulCPUs,real-time3Dreconstructionapproachesfortheapplicationonmobiledeviceshavebeendesignedspeciï¬cally.KÂ¨ahleretal.[5]modiï¬edthevoxelhashingframework[3]toefï¬cientlyworkinreal-timeonamobileNVIDIAShieldTabletwithabuilt-inGPU.Finally,ourworkisbasedonCHISEL[4]whichenablesdensehouse-scale3Dreconstructionsinreal-timeonaTangodevice.ThesystemdoesnotrelyonaGPUandcombinesvisual-inertialodometryforlocalizationwithanefï¬cientspatiallyhashedSDFvolumeformapping.Ourapproachusesthisimplicitsurfacerepresentationandcombinesitwithplanepriorsinordertoimprovereconstructionsinvariousways.Incorporatinggeometricpriorsduring3Dreconstruc-tion:Planesegmentationisausefulpreprocessingformanyindoorenvironmentmappingandtrackingalgorithms.Given3Dpointclouds,onecommonlyusedplaneseg-mentationalgorithmisbasedonRANdomSAmpleCon-sensus(RANSAC)[11].RANSAC-basedalgorithmsï¬ndthepointclusterthatbestï¬tsaplanemodel,buttheyalsoproducefalsedetectionsinmanysituationsbecauseofnotconsideringunderlyingconnectivityofpoints.Totacklethisdrawback,manysolutionshavebeendevelopedbasedonregion-growing[12]â€“[15].WhenusingRGB-Dcameras,directplanedetectionondepthmapsbecomepossible,sincedensedepthmapsembedorganizedpointclouds.Holzetal.[16]proposedafastplanedetectionwhichperformsfastnormalestimationusingintegralimagesandsubsequentlyclusterspointsintoplanarregionsaccordingtothenormals.Fengetal.[17]developedanagglomerativehierarchicalclustering(AHC)algorithmwhichï¬ndsblock-wiseplanarregionswithleastsquaresplaneï¬ttingandthenmergesthelocalregionstoformcompleteplanesegments.Jiangetal.[18]ï¬tcuboidstodepthimagesbyï¬rstdividingtheimageintoplanarsuperpixelsandthenusingRANSACtogeneratesuitablecuboidcandidates.Silbermanetal.[19]useaprobabilisticmodeltocompletetheboundariesofoccludedobjectsbydetectingthedominantplanesfrompartialvoxelbasedreconstruction.MostdirectlyrelatedtoourapproachistheworkbyZhangetal.[15],whichsegmentsincomingdepthposeDepthFusionPlaneCandidateGenerationPlaneMergingTriangulationmeshSDFlocalplanesreï¬nedplanesFig.4.Pipelineoverview.Ourmainapproachaddstwosteps(boldnodes)tothe3Dreconstructionpipeline.LocalplanecandidategenerationhappensdirectlyontheSDFgridbyusinganadaptedleastsquaresï¬ttingapproach.Afterlocalplanesareestimated,theyareclusteredintofewerreï¬nedplanesthatrepresentrealobjectsinthescene.Thereï¬nedplanemodelscanbeusedforanypurpose,e.g.duringtriangulationtoreducethenoiseonplanarsurfaces.depthimagesandthensimilarlymaintainsasetofplanesandpropagatesthisinformationtotheSDF.Despiteallproposedplanesegmentationalgorithms,noneofthesolutionshavebeendevelopedforimplicitsurfacerepresentationssuchasSDFs.AdditionallytoevaluatingRANSAConthereconstructedmesh,wehavedevelopedanovelapproachofï¬ttingplanesdirectlytoSDFgrids,withouttheneedforanexplicitsurfacerepresentation.Asevaluationshows,thisapproachsigniï¬cantlyreducestheruntimeoftheï¬ttingprocessanddoesnotrequireadditionalstorage,makingitapplicableonmobiledevicesandrobots.III.3DRECONSTRUCTIONPIPELINETheTangovisualinertialodometry(VIO)algorithmusesaï¬sh-eyecameraandanIMUtotrackits3Dposeinreal-time.Inpost-processing,thecameraposescanbereï¬nedusingbundleadjustmenttofurtherreducedrift.WeimplementedourapproachontopofCHISEL[4],whichisthe3Dre-constructionpipelineinProjectTango.Atitsheart,CHISELusesatwoleveldatastructuretostoretheSDF:Theï¬rstlevelcontainsblocksofvoxels,whicharecalledvolumesthroughoutthispaper.Volumesarespatiallyhashedintoadynamic3Dmapbasedontheirintegercoordinates.Theyareallocatedanddeallocateddynamicallytostoreonlytheareaswheremeasurementsareobserved.Eachvolumeconsistsofaï¬xed3Dgridofvoxels,whicharestoredsequentiallyinmemory.EachvoxelcontainsanestimateoftheSDFandanassociatedweight.Whenincorporatinganewdepthimage,volumesgetmarkedforre-meshing.Aftertheupdateiscomplete,weextractameshofeveryvolumethathasbeenmarkedusingMarchingCubes.Typically,everyvoxelhasasizeof3cmandeveryvolumeconsistsof163voxels(correspondingtoacubeof48cmsidelength).Thedepthcamerahasaresolutionof160Ã—120pixelsandoperatesataframerateof5fps.Allofouralgorithmshavebeendesignedtoruninreal-timeonaTangodevice,exceptifnotedotherwise.IV.PLANESEGMENTATIONOursegmentationalgorithmconsistsoftwostages(Fig.4):First,wedetectplanarsurfaceslocallyineachvolumeandestimateplanecandidateparameters(localï¬tting,candi-dategeneration).Second,weusetheseplanecandidatestoestimateparametersoflarger,multi-volumeplanemodels(clustering,merging).Theseplanes,thatwealsousetogenerateï¬nalmesh,arecalledreï¬nedthroughoutthepaper.AsdescribedinSec.III,oursurfacerepresentationisstoredasaspatiallyhashedgridofvolumesthatcontainSDFvoxels.Weusethesamedatastructuretostoreinformationaboutdetectedandreï¬nedplanesforeveryvolume.A.NotationWedenotea3Dpositionwithx=(xyz)>âˆˆR3.Ifneeded,wedenotewithÂ¯x=(xyz1)>âˆˆR4theaugmentedvector.A3DplaneinHessiannormalformisdenotedasp=(n1n2n3d)>âˆˆR4wheren=(n1n2n3)>âˆˆR3istheplanenormalofunitlength,i.e.,|n|=1.ThesigneddistanceofaplaneptoapointxthencorrespondstopÂ¯x.AnallocatedvolumeiâˆˆNhasitscenteratviâˆˆR3andconsistsofm3voxels(m=16inourexperiments,whereeachvoxelhasasidelengthof3cm).Everyvolumemayhaveuptooneassociatedplanecandidatepiandasetofreï¬nedplanesQi={q1,...}.TheSDFvalue(storedinthediscretevoxelgrid)forany3DpointcanberetrievedusingthefunctionÎ¦:R3â†’R.B.GeneratingplanecandidatesWeimplementedandevaluatedtwodifferentwaysforgeneratingplanecandidates:RANSACandleastsquares.a)RANSAC:ByusingMarchingCubes,wecreateameshfromeachSDFvolumeandrun3-pointRANSAConitsverticesforï¬ndingplanes.Thesegmentisconsideredplanariftheratioofinliersisaboveacertainthreshold(0.8workedwellforus).Themaximuminlierdistanceparameterdeï¬neshowaggressivelyplanesareï¬ttedtothesurface.Wefoundthatavalueof2cmworkswellonTangodataandallowstargetingonlystrictlyplanarsurfaces.Toreï¬netheplanemodel,wesetthenormaltothesmallesteigenvalueofthecovariancematrixoftheinliervertices.Weï¬‚iptheï¬ttedplaneparameterstoensurethatthenormalpointsinthesamedirectionastheaveragenormalofmeshfaces.Pervolume,weextractatmostone(themostdominant)planecandidate.b)LeastSquares:InsteadofextractinganintermediatemeshfromeachSDFvolumeandï¬ttingaplanetoitsvertices,wedevelopedamoreelegantmethodfordirectlyï¬ttingaplanetotheSDFvaluesofavolume,basedonrobustleastsquares.Weï¬rstdeterminethesetofvoxelsV={xk}insideavolumethatarerelevantforplaneï¬tting,wherexkâˆˆR3arethe3Dcoordinatesofthevoxelcenters.Sinceweonlywanttoconsidervoxelsthatcontainvaliddistancevalues,weonlyincludevoxelsxkwithÎ¦(xk)<0.8Ï„,whereÏ„istheSDFtruncationvalue(10cminourcase).Wealsoexcludevoxelswithweightequaltozero,i.e.unobservedregions.ToobtaintheplaneparameterspâˆˆR4foravolume,weminimizethefollowingleastsquaresproblem:argminpXxkâˆˆV(rk)2(1)withper-voxelresidualsrk:rk:=pÂ¯xkâˆ’Î¦(xk).(2)Thisformulationisequivalenttominimizingthedifferencebetweenthedistancefromtheplanetothevoxelcenter(com-putedbypÂ¯xk)andtheSDFvalueÎ¦(xk)(asmeasurement),whichencodesthedistanceofthevoxelcentertotheclosestsurface.Wedeterminewhetherthevolumecontainsaplanebasedontheaverageoftheabsoluteper-voxelresiduals.Wefoundthatathresholdof2cmworkswelltodetectalllocalplanarregions.However,itisinpracticenotalwaysthecasethatallvoxelsinsideavolumeactuallybelongtothesameplane.Therefore,weintegrateanadditionalweightingfunctionwbasedontherobustHuberlossfunction,whichgiveslessweighttooutliers,intotheregularleastsquaresformulationabove.Thisleadstothefollowingweightedleastsquaresformulation:argminpXxkâˆˆVw(rk)(rk)2(3)withw(r)=(12r2for|r|â‰¤Î´,Î´(|r|âˆ’12Î´),otherwise.(4)Empirically,wefoundthatthevalueofÎ´=5cmworksbestforthistask.Weminimizethisproblembyapplyingtheiterativelyre-weightedleastsquares(IRLS)algorithm,inwhichcompu-tationofweightsandplaneparametersarealternated.C.MergingplanesSincevolumesarerelativelysmallchunksofreconstructedgeometry(inourcaseabouthalfameterineachdimension),theplaneï¬ttingdescribedabovecanrobustlydetectthepresenceofasingleplanewithinavolume.Furthermore,thisallowsustodetectplanesindependentlyandinparallelforeveryvolume.Thisalsoguaranteesaconstantruntimesincethenumberofupdatedvolumesperframeislimited(duetothemaximumrangeofthesensor),evenifthetotalmapsizeisgrowing.However,duetosensornoise,theplaneestimatesinadjacentvolumesofthesameplanearetypicallynotidentical.Toreconstructlargerplanarstructureslikewallsortabletops,wethereforeneedtomergeplanecandidatesatagloballevelandpropagatethembacktoeveryaffectedvolume.Notethatthismeansthatthenumberofvolumesthatneedtobere-meshedafteranupdategrowslinearlywiththemapsize(sinceallvolumessharingthesamereï¬nedplaneneedtobeupdated).Tokeepourimplementationreal-timecapable,weonlymarkthosevolumesforre-meshingğ›¾ğ‘ğ‘ğ‘£%ğ‘‘VoxelVolumeLocal planeFig.5.Planemergingconditions.PlaneqismergedwithplanepiftheangleÎ³isbelowathreshold(cid:15)andtheunsigneddistancedbetweenqandvolumecenterviprojectedonpissmallerthanthresholdÎ».thatarewithinacertainradiusofourcurrentposition.Weimplementedthefollowingtwoalgorithmsforplanemerging:RANSACandgreedyregiongrowing.a)RANSAC:Ourclusteringapproachisbasedona1-pointRANSACandadaptedtoï¬ndparametersofaplanethatissimilartothemostplanesinagivenset.OneachRANSACiterationwerandomlypickaplanecandidatepifromthesetofallplanecandidatesinthemap.Weneedtoevaluatehowmanyoftheotherplanecandidatespjwithi6=jareinlierstopi.Letxij=vjâˆ’(piÂ¯vj)ni,(5)betheprojectionofvolumecentervjontotheplanepi.Wethencheckthefollowingtwocriteriatodeterminewhetherpjisaninliertopi(seeFig.5foranillustration):1)theangulardifferencebetweenqandpisbelowacertainthreshold(wefoundthat3degreesworkswellforindoorenvironments),i.e.,ninj>cos(cid:15)(6)2)theEuclideandistancebetweenÂ¯xijandpiisbelowacertainthreshold,i.e.,|piÂ¯xij|<Î».(7)Weaddedthelatterconditiontomakemergingofdistantplaneslesslikelyeveniftheyhavesimilarnormals(Î»=5cminourcase).Afterï¬ndingthelargestsetofinliersandreï¬ningtheplaneparameters,westorethereï¬nedplaneforpropagation(explainedbelow).Toacceptareï¬nedplane,wetypicallyrequireittohaveacertainnumberofsupportingvolumes,whichinturncorrespondstoaminimumsurfacearea.Dependingontheapplication,itcanbeusefultorestrictestimationtoonlylargerplanes,likewallsorlargefurnituresurfaces.b)RegiongrowingThismergingmethodselectsoneoftheplanecandidatesinthemapandexecutesbreadth-ï¬rsttraversalofitsneighbors,addingallvolumesthathavecompatibleplanecandidatestothecurrentlymergedplane.Allvolumesadjacenttoavolumethathavesimilarplanesareaddedtothetraversalqueue.Planesimilarityisdeterminedinthesamewayasinthepreviousapproach.Adrawbackofthismethodisthatoutcomedependsoninitialplaneselectedforregiongrowing.c)PlanepropagationInmanycasesSDFvolumescontainmorethanoneplane(e.g.atwallintersections,shelvesorFig.6.Usingplanepriorstoreducenoisein3Dreconstruction.Originalreconstruction(left)andreconstructionusingplanepriors(right).anysmallrectangularobjects).TobeabletoqueryallcloseplanesateachSDFvoxel,weextendthereï¬nedplanesbypropagatingthemtoallintersectedvolumesthatarewithinaparametricdistance.Asaresult,eachvolumecanhaveoneormorereï¬nedplanesQi={q1,...}associatedthatcanbeusedfornoisereduction,holeï¬lling,andpossiblyotherapplicationssuchasimprovedcameratrackingortexturing.D.NoisereductionIndoorenvironmentsareusuallydominatedbyï¬‚atsurfaceslikewalls,ï¬‚oorandshelves,butsincethedepthdataofmobilesensorsisnoisy,theï¬nal3Dreconstructionscontainnoticeableartifacts,seeFig.6(left).Theerrorsinreconstruc-tioncanalsocomefrominaccuratelocalizationorsparsedepthdata.Afterwefoundasetofreï¬nedplanespervolumeasdescribedintheprevioussubsection,wearenowabletoextractabettermesh.Tothisend,wedeï¬neanewSDFthatisbasedontheoriginalSDFbutreplacesthedistancevaluesofvoxelsnearaplanebytheactualdistancetotheplane.LetÎ¦(x)betheoriginalSDFvalueforapointx.Wethendeï¬neamodiï¬edSDFÎ¦0(x)basedonÎ¦(x)andthesetofreï¬nedplanesQiofthecorrespondingvolumei.Letpclosest(x)âˆˆPibethereï¬nedplanewhichistheclosesttox.Letpmin(x)âˆˆPibethereï¬nedplanewhichishassmallestsigneddistancetox.LetDclosest(x)=Â¯xpclosest(x)andDmin(x)=Â¯xpmin(x)bethedistancestosuchplanesfromapointx,respectively.Then,wecancomputeareï¬nedSDFvaluethatcombinestheplaneswithexistingSDFvaluesasfollows:Î¦0(x)=ï£±ï£´ï£´ï£´ï£²ï£´ï£´ï£´ï£³Dmin(x)ifâˆƒp,qâˆˆQ:âˆ’Ï„<Â¯x>pÂ·Â¯x>q<0Dclosest(x)if|Dclosest(x)|<Ï„and|Dclosest(x)âˆ’Î¦(x)|<Ï„Î¦(x)otherwise(8)Letusdiscusseverylineofthisequationseparately:1)Theï¬rstcaseistargetedatvoxelsnearplaneinter-sections(seeFig.7foranillustration).Weusethesmallestsigneddistanceofallcloseplanesinareaswhenthereï¬nedplanesarenotallofthesamesign.Inthiscase,xismostlikelylocatedbehindaplaneandthusshouldbeassignedanegativevalue.2)ThesecondcaseappliestovoxelsthatarelocatedclosetoaplaneandthusgettheirdistancevaluesÎ¦=0ğ‘ğ‘¥Ì…=0ğ‘â€™ğ‘¥Ì…Â±ğœ=0ğ‘ğ‘¥Ì…=0+--+ğ—,ğ—-ğ—.ğ‘ğ‘Fig.7.CasesofSDFcorrectionatplaneintersections:atpointxAandxCweusethedistancetothenearestplane;atxBandareashighlightedinredweusethelowestsigneddistancetotheplane.ğ‘ğ—#ğ·(ğ—#)ğ—#ğ—â€™ğ·(ğ—â€™)ğ‘ğ—â€™ğ—(ğ·(ğ—()ğ‘ğ—(Î¦=0ğ‘ğ‘¥Ì…=0ğ‘ğ‘¥Ì…Â±ğœ=0ğ‘Fig.8.DifferentSDFcorrectioncasesatcentersofvoxelsxA,xB,xC.xA-distancetoplaneisusedsincethevoxelisclosetotheplaneandnotnearanintersection;xB-originalvalueisusedbecausethepointisoutsideoftruncationdistancetotheplane;xCoriginalvalueisusedbecausedifferencebetweenDclosest(xC)=pÂ¯xcandÎ¦(xC)islargerthantruncationdistance.overwrittenbythedistancetothisplane(seeFig.8foranillustration).3)Otherwise,wetaketheoriginalSDFvalueinareasthatarefarfromanydetectedplanes.E.JitterreductionEvenafterï¬ttingplanestothemodel,theresultingmesh-ingstillshowjitterduringtheonlinereconstruction,albeitatalowerlevel.Tofurtherreduceorpossiblyfullyeliminatejitter,weonlyupdatethecoefï¬cientsofthosereï¬nedplanes(andthusre-meshthecorrespondingvolumes)thatdifferbymorethan1degree.F.Holeï¬llingWhenusingmobiledevicesforhandheld3Dreconstruc-tion,theresultingmodelsareoftenincomplete,withunob-servedpartsoftheenvironmentappearingasholesinthere-constructedmesh.Suchmissinggeometryalsooccursbehindfurnitureandregionsoccludedbyobjects.Thiscanimposeseriousproblemsinmanyaugmentedrealityapplications,forexamplewhenobjectsorgamecharactersfallthroughholesintheï¬‚oororenteraroomthroughawall.Fillingholesin3Dmapsisalsodesirableforrobotnavigation,forexample,topreventquadrotorstoï¬‚ythroughapparentholesinawallduetomissingdataortoenableagroundrobottoplanapathduetogapsintheï¬‚oorplane.Tocompletethegeometrywhereitispossibleandproducesmoothclosedsurfaces,weextendthereï¬nedplanarregionsandcalculateSDFvaluesinunobservedvoxelsfromeq.8.Thisapproachcanalsobeusedforgeneratingindoorstructureassumptionsinthelargeunobservedareas.ForFig.9.Fillingunobservedpartsofreconstructioninâ€™LivingRoom-kt1â€™(top)andâ€™Ofï¬ce-kt1â€™(bottom)datasetsof[20].Ourcompletionadded72.6%and64.2%tothesurfacearearespectively,recoveringallwalls.example,theï¬‚oorplanecanbeassumedtobeinï¬niteaslongasthisdoesnotcontradictanyexistingobservations.Ifonlydistantpiecesofadjacentwallshavebeenobserved,suchextrapolationgivesusinformationabouttheirintersectioneventhoughitwasnotseenbythedevice.Sinceeachvolumehasaseparatemeshinourrecon-structionpipeline,wecansimplifyvolumeswhichcontainonlyplanargeometrybyreplacingthemwithonlytwofaceswhichformaquadrilateral.Thisenablesmoreefï¬cientstorageandprocessingofmeshes,whichcanbeusedforexampleincollisionavoidance.G.SegmentationFindingplaneequationsofthewallsinaroomisusefultoclusterthesceneintoasetdisjointofobjects.Separationofplanarregionshappensnaturallyinbothapproachesofplaneclustering,whereweassignanIDtoeachglobalplane.Additionally,weassignoneofthefollowingsemanticlabels:ï¬‚oor,wall,ceilingandotherbyimposingthefollowingrules:1)Thesupportareaofaplanehastobegreaterthanathresholddeï¬nedforeachlabel.Weusethenumberofcandidatesthatweremergedasanimplicitmeasureofplanarregionareasize(valueof4workedwellforï¬‚oorandwalls).2)Angulardifferencebetweenplaneâ€™snormalandIMUgravityvectorhastobewithinalimitsetforeachlabel.Forourevaluation,weusedathresholdof10degreesdifferencewithunitangles.Moreover,suchlabellingcanbeusedtoreconstructonlythepartsoftheisosurfacethatbelongtothewalls.Combinedwithholeï¬llingasdescribedabove,thisresultsinare-constructionthatcontainsonlytheroomâ€™swalls,completelyremovingallotherobjectsandfurniture.Thiscouldbeusedforexampleinautomatic3Dï¬‚oorplanextraction.TABLEI.Evaluationsontheamountofaddedsurfaceareabytheholeï¬llingalgorithmtothemeshreconstructionwithindoordatasets.DatasetRawm2Filledm2ImprovePosterroom95.52107.3812.41%Kidsroom75.6695.7526.55%ICL-NUIMlivingroom164.52111.3572.60%ICL-NUIMofï¬ce188.58145.4564.20%BundleFusionapt0113.40135.7719.72%BundleFusionofï¬ce194.40137.1945.33%Average88.68122.1540.14%Havingallï¬‚atsurfacessegmented,wecanalsosegmentfurnitureandotherobjectsinthescenebasedontheirmeshconnectivity.Forthis,weï¬rstextractameshofeverythingthatisnotaplane.Bytraversingthemeshinbreadth-ï¬rstsearch,wecansegmenteveryvertexaspartofthecurrentobject.Ifnounsegmentedverticescanbeadded,theobjectisï¬nalizedandtheprocessiscontinuedtothenextunsegmentedvertexwithanewobjectID.Thisenablesasimplebutefï¬cientdecompositionofthe3Dreconstructionforfurtherobjectrecognition.V.EVALUATIONANDEXPERIMENTALRESULTSA.QualitativeresultsWeevaluatedourapproachintendifferentindoorandout-doorscenes,asshowninFig.10.Inthisexperimentweusedthefastestcombinationofmethods,whichisplanecandidateestimationwithSDFï¬ttingandglobalclusteringwith1-pointRANSAC.Weusedparametervaluesasspeciï¬edpreviously.AlldatawasrecordedonaTangotabletandpost-processedonaPCforvisualization.a)Noiseremoval:ThesecondrowshowstherawreconstructionfromCHISEL[4]withoutincorporatingplanepriors.Thewallsandtheï¬‚oorarenoisyandincomplete.Thethirdrowshowsthe3Dreconstructionafteraddingtheplanepriorfornoisereduction.Themodelslookmuchcleaner,althoughincertaincasessmalldetailslikepostersonthewalldisappear.b)Jitterremoval:ReferringbacktoFig.3,withourapproachweareabletocompletelyeliminatemeshjitteronalldetectedï¬‚atsurfacesduringonlinereconstruction.Thevideoaccompanyingthispaper(alsofoundathttps://youtu.be/8OxwiRpmzn4),weshowourmethodusedformeshstabilization.c)Holeï¬lling:Weevaluatedtheholeï¬llingapplicationbycomparingtheareaaddedtothemeshusingplanesinunobservedregions.Forthisevaluationweuseourdatasetsofroomswhereallmajorwallsareatleastpartiallyobserved.Wealsousepubliclyavailabledatasetsfrom[20],[21],[6].Thedatashowsthatineachscenewewereabletoreasonablyaugmenttheoriginalreconstruction,addingonaverage40.14%ofmesharea.Weconcludethatourapproachcanrecoversigniï¬cantamountofunobservedandoccludedsurfacesforindoorenvironments.d)Semanticlabellingofplanes:Fig.10showshowourapproachcanbeappliedfordetectionofwalls(green)andï¬‚oor(red).Oursystemfoundallwallsandï¬‚oorswithexceptionofkitchendataset,wheretheplaneï¬ttedtowalldidnotreceivesemanticlabellingduetosmallobservedarea.PosterroomKidsroomBedroomLivingroomCopyroomOfï¬ceï¬‚oorKitchenClosetLockersOutdoorsFig.10.Reconstructionexamples.Fromtoptobottom:originalreconstruction,de-noised,holesï¬lled,semanticsegmentationofplanes(green:wall,red:ï¬‚oor).Fig.11.Usingplanesforobjectsegmentation.Theplanesaremarkedwithcheckerboardpattern,whileseparateobjectsareassigneddifferentcolors.Wealsoevaluatedthenumberofcorrectclassiï¬cationsofwallsinthescene.Intheseruns,20of21wallsweredetectedcorrectlywiththeonlyexceptionofthekitchenwallthatissigniï¬cantlyoccludedbytheworktopandshelves.Therefore,weconcludethatourapproachiscapableofï¬ndingmajorwallsourtestenvironmentsat95%accuracy.B.ObjectsegmentationObjectsegmentationisdoneasapost-processingsteponameshwithsegmentedplanes.Fig.11showsthataslongasthereisnoconnectivitybetweenobjectsandthewallsaredetected,segmentationisperformedcorrectly.Twocasesinthetoprowshowhowtopologicallyconnectedobjects(acurtainandapieceoffurniture)arewronglysegmentedasonepiece.Fig.12.Runtimesduringonlinereconstructionofthedatasetâ€Posterroomâ€onamobiledevice.Thismethodgenerallyworkswellforindoorenviron-ments,whereallobjectsaresomehowattachedtoplanarregions.Ontheroomscalewecancoarselydetectfurnitureanddynamicactors,whereasonthesmallerscalewecansegmentobjectslayingonatableorconveyorlentthatmayneedtobepickedupwitharobotarm.C.RuntimeevaluationWeevaluatedruntimeperformanceofdifferentmethodsdescribedinthispapertoï¬ndthebestcombinationofplaneï¬ttingandmergingapproaches.Weusedadevicewith4GBRAMand4-coreprocessorwith2GHzfrequencyfortheruntimeevaluation.AllcomputationalprocessingdescribedinthissectionisperformedonlyontheCPU.WesetthemaximumnumberofRANSACiterationsforlocalï¬ttingandglobalassociationto100and50respectively.Themaximumnumberofiterationsforlocalï¬ttingusingiterativelyre-weightedleastsquaresonSDFis30.TheresultisgiveninTab.II:Thebasecase,whereweupdatetheSDFtakes40.8msperframe,whileextractingthemeshtakes72.8ms.Whenweenabletheplaneprior,weneed14.5ms(or8%)morecomputationtime.Notethatthetimedependsalsoonthescene.ForexampletheoutdoortreegeneratesmorecandidateswhenusingRANSACsincemanyreconstructedauxilarymeshesaredenselypackedwithTABLEII.Runtimecomparisonofplaneï¬ttingandclusteringapproaches.Dataset#frames#candidateplanes#mergedplanesTimeperframe[ms]DetectionmethodMergingmethodCandidategenerationMergingRANSACSDFï¬ttingRANSACRegiongrowingSDFfusionRANSACSDFï¬ttingRANSACRegiongrowingPosterroom94323021361063.285.218.93.66.8Kidsroom4431221175644.553.914.12.44.0Bedroom10521213348.614.34.40.90.5Ofï¬ceï¬‚oor20047471130.533.213.00.80.9Printer19231392342.325.76.81.31.4Livingroom495106932248.462.317.92.02.5Kitchen22432323330.524.311.12.32.1Closet32551514444.025.57.32.01.3Lockers48594973532.252.813.72.73.9Outdoors27262111124.165.718.90.80.6Average36880723440.844.312.61.92.4leaves,generatingmoreverticesresultinginmorecandidatesandlongerprocessing.WhilethenumbersoflocallyfoundplanesaresimilarbetweenRANSACandSDFï¬tting,theruntimesofSDFï¬ttingisonaverage3.4timesbetter.ThisismainlycausedbyeliminatinggenerationofanauxiliarymeshwithMarchingCubesthatisneededforRANSACtoï¬taplanetovertices.Toseedynamicsofprocessing,wemeasuretimespentonSDFfusion,candidategenerationandmerging.Fig.(12)showsthatprocessingtimesintroducedbyplaneï¬ttingaresmallcomparedtotheSDFfusion,whichincludesdepthintegrationandmeshgeneration.Thetimecomplexityofcandidategenerationisgenerallyconstantbecausethenum-berofvolumesobservedineachframeisroughlythesame.Planeclusteringduration,however,dependslinearlyonthetotalnumberofcandidatesinthemap,growingovertimeuntilthedistancebetweenthecameraandsomecandidatesreachesapre-deï¬nedthreshold.Overall,oursystemiscapableofonlineprocessingatinteractiveframeratesonamobiledevice.ThepreferredmethodsforcandidategenerationandplanemergingareleastsquaresonSDFand1-pointRANSACrespectively.VI.CONCLUSIONWepresentedanewapproachofï¬ndingandusingplanarsurfacesduringonline3Dreconstructionofindoorenvi-ronments.Ourplanedetectionalgorithmconsistsoflocalplaneï¬ttingandglobalplanemerging.Weshowthatlocalcandidategenerationcanbeefï¬cientlytackledbyleastsquaresplaneestimationdirectlyontheSDFgrid.Globalclusteringcanbeeffectivelydoneby1-pointRANSAConallcandidates.Wedemonstratedhowusingourapproachcansigniï¬cantlyreducenoiseinonlineandofï¬‚ine3Dreconstructionsandmakethemmorevisuallyappealing.Omittingre-meshingofplanarregionsresolvesthevertexjitterproblemofï¬‚atsurfaces.Byextendingplanarregionsintounobservedandoccludedpartsofthesceneweareabletorecovermissinginformationofroomstructureandï¬llholesalreadyduringreconstruction.REFERENCES[1]R.Newcombe,A.Davison,S.Izadi,P.Kohli,O.Hilliges,J.Shotton,D.Molyneaux,S.Hodges,D.Kim,andA.Fitzgibbon,â€œKinectFusion:Real-timedensesurfacemappingandtracking,â€inISMAR,2011.[2]C.Kerl,J.Sturm,andD.Cremers,â€œDensevisualslamforRGB-Dcameras,â€inIROS,2013.[3]M.NieÃŸner,M.ZollhÂ¨ofer,S.Izadi,andM.Stamminger,â€œReal-time3Dreconstructionatscaleusingvoxelhashing,â€ACMTransactionsonGraphics(TOG),vol.32,no.6,p.169,2013.[4]M.Klingensmith,I.Dryanovski,S.Srinivasa,andJ.Xiao,â€œChisel:Realtimelargescale3dreconstructiononboardamobiledevice,â€inRSS,2015.[5]O.KÂ¨ahler,V.Prisacariu,C.Ren,X.Sun,P.Torr,andD.Murray,â€œVeryhighframeratevolumetricintegrationofdepthimagesonmobiledevices,â€TVCG,vol.21,no.11,pp.1241â€“1250,2015.[6]A.Dai,M.NieÃŸner,M.ZollÂ¨ofer,S.Izadi,andC.Theobalt,â€œBundlefu-sion:Real-timegloballyconsistent3dreconstructionusingon-the-ï¬‚ysurfacere-integration,â€ACMTransactionsonGraphics(TOG),2017.[7]B.CurlessandM.Levoy,â€œAvolumetricmethodforbuildingcomplexmodelsfromrangeimages,â€inSIGGRAPH,1996.[8]E.Bylow,J.Sturm,C.Kerl,F.Kahl,andD.Cremers,â€œReal-timecameratrackingand3Dreconstructionusingsigneddistancefunctions,â€inRSS,2013.[9]F.SteinbrÂ¨ucker,J.Sturm,andD.Cremers,â€œVolumetric3Dmappinginreal-timeonaCPU,â€inICRA,2014.[10]R.Maier,J.Sturm,andD.Cremers,â€œSubmap-basedbundleadjustmentfor3DreconstructionfromRGB-Ddata,â€inGCPR,2014.[11]R.Schnabel,R.Wahl,andR.Klein,â€œEfï¬cientransacforpoint-cloudshapedetection,â€ComputerGraphicsForum,2007.[12]J.Poppinga,N.Vaskevicius,A.Birk,andK.Pathak,â€œFastplanedetectionandpolygonalizationinnoisy3drangeimages,â€inIROS.IEEE,2008,pp.3378â€“3383.[13]J.-E.DeschaudandF.Goulette,â€œAfastandaccurateplanedetectionalgorithmforlargenoisypointcloudsusingï¬lterednormalsandvoxelgrowing,â€in3DPVT,May2010.[14]L.Ma,R.Favier,L.Do,E.Bondarev,andP.deWith,â€œPlanesegmentationanddecimationofpointcloudsfor3denvironmentreconstruction,â€inCCNC,2013,pp.43â€“49.[15]Y.Zhang,W.Xu,Y.Tong,andK.Zhou,â€œOnlinestructureanalysisforreal-timeindoorscenereconstruction,â€ACMTransactionsonGraphics(TOG),vol.34,no.5,p.159,2015.[16]D.Holz,S.Holzer,R.Rusu,andS.Behnke,â€œReal-timeplanesegmentationusingrgb-dcameras,â€inRobotSoccerWorldCup,2011,pp.306â€“317.[17]C.Feng,Y.Taguchi,andV.Kamat,â€œFastplaneextractioninorganizedpointcloudsusingagglomerativehierarchicalclustering,â€inICRA,2014,pp.6218â€“6225.[18]H.JiangandJ.Xiao,â€œAlinearapproachtomatchingcuboidsinRGBDimages,â€inCVPR,2013.[19]N.Silberman,L.Shapira,R.Gal,andP.Kohli,â€œAcontourcompletionmodelforaugmentingsurfacereconstructions,â€inECCV,2014,pp.488â€“503.[20]A.Handa,T.Whelan,J.McDonald,andA.Davison,â€œAbenchmarkforRGB-Dvisualodometry,3DreconstructionandSLAM,â€inICRA,2014.[21]S.Choi,Q.-Y.Zhou,andV.Koltun,â€œRobustreconstructionofindoorscenes,â€inCVPR,2015.