1
2
0
2

r
a

M
5

]

Y
S
.
s
s
e
e
[

4
v
9
9
3
0
0
.
8
0
9
1
:
v
i
X
r
a

Inverse Optimization with Kernel Regression:
Application to the Power Forecasting and Bidding of a
Fleet of Electric Vehicles

Ricardo Fern¬¥andez-Blancoa,‚àó, Juan Miguel Moralesa,b, Salvador Pinedaa,c,
¬¥Alvaro Porrasa

aOASYS research group, University of Malaga, Malaga, Spain
bDepartment of Applied Mathematics, University of Malaga, Malaga, Spain
cDepartment of Electrical Engineering, University of Malaga, Malaga, Spain

Abstract

This paper considers an aggregator of Electric Vehicles (EVs) who aims to learn

the aggregate power of his/her Ô¨Çeet while also participating in the electricity

market. The proposed approach is based on a data-driven inverse optimization

(IO) method, which is highly nonlinear. To overcome such a caveat, we use

a two-step estimation procedure which requires solving two convex programs.

Both programs depend on penalty parameters that can be adjusted by using

grid search.

In addition, we propose the use of kernel regression to account

for the nonlinear relationship between the behavior of the pool of EVs and

the explanatory variables, i.e., the past electricity prices and EV Ô¨Çeet‚Äôs driving

patterns. Unlike any other forecasting method, the proposed IO framework

also allows the aggregator to derive a bid/oÔ¨Äer curve, i.e. the tuple of price-

quantity to be submitted to the electricity market, according to the market rules.

We show the beneÔ¨Åts of the proposed method against the machine-learning

techniques that are reported to exhibit the best forecasting performance for

this application in the technical literature.

Keywords:

Inverse optimization; kernel regression; forecasting; electric

‚àóCorresponding author
Email addresses: Ricardo.FCarramolino@gmail.com (Ricardo Fern¬¥andez-Blanco),

Juan.Morales@uma.es (Juan Miguel Morales), spinedamorente@gmail.com (Salvador
Pineda), alvaroporras19@gmail.com ( ¬¥Alvaro Porras)

Preprint submitted to Journal of LATEX Templates

March 8, 2021

 
 
 
 
 
 
vehicles.

Nomenclature

The main notation used throughout the text is stated below for quick refer-

ence. Other symbols are deÔ¨Åned as required.

Sets and Indices

B

Set of energy blocks, indexed by b.

Bc/d Set of energy blocks associated with the charging/discharging power, in-

dexed by b.

T

Set of time periods, indexed by t and œÑ .

‚Ñ¶X

Set of time periods belonging to the set X = {tr, v, test} where tr, v, test

refer to the training, validation, and test set, in that order.

Parameters

Eb,t, Eb,t Width for the aggregate discharging/charging power block b in time

period t [kW].

H

Feasibility penalty parameter.

Kt,œÑ

M

NB

Œªt

zt

Œ≥

Value of the kernel on two feature vectors at time periods t and œÑ .

Regularization hyper-parameter.

Number of energy blocks.

Electricity price in time period t [e/kWh].

Vector of regressors in period t.

Hyper-parameter related to the Gaussian kernel.

2

Decision Variables

mb,t Marginal utility of block b of the aggregate power in time period t

[e/kWh].

pb,t

Power in block b and time period t [kW].

P t, P t Lower and upper bound for the aggregate power in time period t [kW].

Œ±t, Œ±t CoeÔ¨Écient relative to the kernel regression of the lower/upper power

bounds in period t ‚àà ‚Ñ¶tr [kW].

(cid:15)t

Duality gap in time period t ‚àà ‚Ñ¶tr [e].

¬µ, ¬µ

Intercept for the lower/upper power bounds [kW].

ŒΩb

Intercept for the marginal utility of block b [e/kWh].

Œæ+
t

, Œæ‚àí
t

Slack variables associated with the lower power bound in time period t

[kW].

+
t , Œæ

‚àí
t Slack variables associated with the upper power bound in time period t

Œæ

[kW].

œÅt

CoeÔ¨Écient relative to the kernel regression of the marginal utility in

time period t ‚àà ‚Ñ¶tr [e/kWh].

1. Introduction

According to the White Paper on transport of the European Commission

(2011), one of the main goals to achieve a sustainable transport system is to

halve the use of ‚Äòconventionally fuelled‚Äô cars in urban transport by 2030; phase

them out in cities by 2050; achieve essentially CO2-free city logistics in major

urban centres by 2030. This will spur the use of electric vehicles (EVs) across

Europe (European Commission, 2011). Although nowadays the penetration of

EVs in the European market is slow albeit steady, the estimated electricity

demand from all EVs worldwide was 54 TWh in 2017 (Bunsen et al., 2018).

3

Thus, the growing electriÔ¨Åcation of the road transport will impact the power

system operation and planning of the future and, as a consequence, new actors

and facilities will come into play, e.g. aggregator agents (Bandpey & Firouzjah,

2018), or battery swap stations (Yang & Sun, 2015).

Within the context of the restructured power industry, the aggregator agents

face several challenges: (i) the forecast of the charging power of the Ô¨Çeet of EVs

in the short-term, and (ii) the determination of a bid curve to participate in

the electricity market to maximize their proÔ¨Åts when the Ô¨Çeet of EVs is large

enough. Nowadays, the EVs may be prepared with bi-directional vehicle-to-grid

(V2G) capabilities, which means that the EVs can extract power from and inject

power into the electrical grid while parked (Kempton & Tomi¬¥c, 2005). This is

possible as long as the EVs are equipped with the necessary smart metering-

and-control infrastructure as well as a suitable connection to the electrical grid.

In this case, the aggregator will also need to forecast the EV-Ô¨Çeet discharging

power.

Short-term load forecasting is widely applied in the power sector to predict

the electricity demand (and price) for diÔ¨Äerent granularity levels (Shahidehpour

et al., 2003). In the last years, EV charging load forecasting tools have been

proposed in the technical literature by means of ARIMA-based models (Amini

et al., 2016; Korolko et al., 2015); machine-learning techniques (Majidpour et al.,

2016; Sun et al., 2016; Xydas et al., 2013), such as support vector regression;

or big data technologies (Arias & Bae, 2016). All these papers neglected the

bi-directional V2G capabilities of the EVs. Moreover, the above methodolo-

gies aimed to provide a single-purpose application, i.e., the forecasting of the

charging power of either an EV or a Ô¨Çeet of EVs. Instead, we propose here a

multi-purpose application for the aggregator of EVs in order to not only forecast

the EV-Ô¨Çeet power, but also to derive a bid/oÔ¨Äer curve according to the rules

of the electricity market, e.g. see OMIE (2019).

In this paper, we apply inverse optimization (IO) to forecast the EV-Ô¨Çeet

power while deriving a bid/oÔ¨Äer curve. The goal of an IO problem is to infer the

optimization model parameters given a set of observed decision variables or mea-

4

surements collected by an observer. For instance, Zhang & Xu (2010) applied IO

for linearly-constrained convex problems in the industrial and managerial areas

but its application was limited to single observed decisions. Aswani et al. (2018)

proposed a statistically consistent methodology for IO when the measurements

of the optimal decisions of a convex optimization problem are noisy. In a more

general context, when the observer has imperfect information, Esfahani et al.

(2018) devised a distributionally robust inverse optimization problem. IO has

also been applied for equilibrium problems (Bertsimas et al., 2015), multiobjec-

tive convex optimization (Roland et al., 2016), or robust optimization (Chan &

Kaw, 2019). However, few papers have implemented IO in the Ô¨Åeld of power

systems (Saez-Gallego et al., 2016; Saez-Gallego & Morales, 2017; Lu et al.,

2018; Ruiz et al., 2013; Zhou et al., 2010).

Zhou et al. (2010) applied IO in the context of generation expansion plan-

ning to Ô¨Ånd an eÔ¨Äective incentive policy; Ruiz et al. (2013) estimated rival

marginal oÔ¨Äer prices for a strategic producer in a network-constrained day-

ahead market by using IO; Saez-Gallego et al. (2016) prescribed an IO ap-

proach by using bi-level programming to infer the market bid parameters of a

pool of price-responsive consumers; in Saez-Gallego & Morales (2017), a novel

IO approach was devised to statistically estimate the aggregate load of a pool

of price-responsive buildings in the short-term; and, Ô¨Ånally, Lu et al. (2018)

applied IO to estimate the demand response characteristics of price-responsive

consumers, as similarly done in Saez-Gallego et al. (2016). Unlike existing works

(Saez-Gallego et al., 2016; Saez-Gallego & Morales, 2017; Lu et al., 2018; Ruiz

et al., 2013; Zhou et al., 2010), we address the EV-Ô¨Çeet power forecasting with

an IO approach in which the prediction tool accounts for two distinctive fea-

tures: (i) the pool of EVs may be equipped with V2G capabilities, and (ii)

there may exist a strong nonlinear relationship between the EV-Ô¨Çeet power and

the explanatory variables, namely past EVs‚Äô charging/discharging patterns and

past electricity prices. To capture these nonlinear relations, we endogenously

introduce kernels into the proposed IO approach.

Kernels are widespread in the literature on machine learning, as can be

5

seen in Hofmann et al. (2008); Trevor et al. (2009); Ben¬¥ƒ±tez-PeÀúna et al. (2019),

just to name a few; and, in power systems, they were mainly used to predict

electricity prices (Dudek, 2018; Kekatos et al., 2013, 2014). Kekatos et al. (2013)

applied a kernel regression to forecast the electricity prices from the Midwest

Independent System Operator day-ahead market in which the kernel itself is

constructed by the product of three kernels: one for vectorial data and other

two to account for non-vectorial data such as time and nodal information. This

approach was generalized to low-rank kernel-based learning models in Kekatos

et al. (2014). Finally, Dudek (2018) devised a probabilistic forecast method

built on the Nadaraya-Watson estimator to predict the electricity prices from

the Polish balancing and day-ahead markets.

The contributions of this paper are threefold:

‚Ä¢ From a modeling perspective, we provide an IO framework to forecast

the aggregate power of a Ô¨Çeet of EVs with V2G capabilities. In addition,

the outcome of this framework may be used to bid/oÔ¨Äer in the electricity

market by using the estimated price-quantity tuples. To the best of the

authors‚Äô knowledge, this is the Ô¨Årst time in the technical literature that IO

has been used to forecast the aggregate power of a price-responsive EVs‚Äô

aggregator and to derive a suitable bid/oÔ¨Äer curve for such an aggregator.

‚Ä¢ We approximate the solution of the generalized IO problem by using a

data-driven two-step estimation procedure. This procedure requires solv-

ing two diÔ¨Äerent convex programming problems, which makes the process

of building the forecasting model computationally aÔ¨Äordable. As a salient

feature of this work, a kernel is endogenously incorporated into the regres-

sion functions.

‚Ä¢ We thoroughly analyze the performance of the proposed methodology by

using real-life data based on the latest National Household Travel Sur-

vey (NHTS, 2019) and we compare the results against those provided by

two machine-learning techniques, namely support vector regression and

6

kernel-ridge regression. The former has been reported to exhibit the best

forecasting performance for the present application in the technical liter-

ature (Xydas et al., 2013; Sun et al., 2019).

The rest of the document is organized as follows: Section 2 provides the IO

methodology; Section 3 gives a general overview on the comparison methodolo-

gies; in Section 4, we analyze a case study for a residential aggregator of EVs;

conclusions are duly drawn in Section 5; and, Ô¨Ånally, Appendix A presents a

mixed-integer linear programming problem to generate synthetic data on the

behavior of an EV Ô¨Çeet.

2. Inverse Optimization Methodology

To put the problem in context, we aim to forecast or learn the EV-Ô¨Çeet

power pt (also known as aggregate power) in time period t of a price-responsive

aggregator, who is also interested in deriving a bid/oÔ¨Äer curve to be submitted

to the electricity market. The participants of the electricity market, namely

consumers and producers, must submit a bid/oÔ¨Äer curve consisting of blocks of

energy and price. For the consumers, the bid curve should be monotonically non-

increasing, whereas, for the producers, the oÔ¨Äer curve should be monotonically

non-decreasing, e.g. see OMIE (2019). We assume a rational aggregator, which

means that the market strategy of the EV Ô¨Çeet fundamentally relies on arbitrage,

by behaving as a consumer when the electricity price is low and, on the contrary,

by acting as a producer when the price is high.

In order to predict the EV-Ô¨Çeet aggregate power and to derive a bid/oÔ¨Äer

curve, the aggregator may use past observed data, which are denoted as explana-

tory variables, features or regressors. As one should expect for a price-responsive

aggregator, the regressors in time period t can be the lagged electricity price

t‚àíl or aggregate power p(cid:48)
Œª(cid:48)
t‚àíl, ‚àÄl = 1, 2, .... In addition, past EV driving pat-
terns, meteorological data, or categorical data (e.g., time information) can also

be used for forecasting purposes.

7

Within this context, we Ô¨Årst introduce the proposed forecasting1 model in

Section 2.1. Subsequently, Section 2.2 explains how we can account for past

information. Finally, Section 2.3 thoroughly describes the two-step procedure

to estimate the required parameters of the forecasting model.

2.1. Forward Model

The key idea of this work is to forecast the EV-Ô¨Çeet power by using a simple

optimization (linear programming) model which may, to some extent, mimic

its real behavior. In addition, unlike other forecasting techniques, this model

is able to derive a bid/oÔ¨Äer curve, as imposed by rules of electricity markets.

Therefore, the formulation of the forward model that, we assume, represents

the aggregate response of an EV Ô¨Çeet to the electricity prices at time period t,

is mathematically expressed as:

pb,t (mb,t ‚àí Œªt)

max
pb,t

(cid:88)

b‚ààB

subject to:

P t ‚â§

(cid:88)

b‚ààB

pb,t ‚â§ P t : (Œ≤

, Œ≤t)

t

0 ‚â§ pb,t ‚â§ Eb,t : (œÜc
b,t
Eb,t ‚â§ pb,t ‚â§ 0 : (œÜd
b,t

, œÜ

c
b,t),

, œÜ

d
b,t),

‚àÄb ‚àà Bc

‚àÄb ‚àà Bd,

(1a)

(1b)

(1c)

(1d)

where dual variables are represented in parentheses after a colon in the respective

constraints. For the sake of unit consistency, hourly time periods are considered.

The reconstruction problem (1) aims to maximize the welfare of the EV

aggregator, as given by the objective function (1a). This objective function is

made up of the EV Ô¨Çeet‚Äôs surplus, which is related to the aggregate charging and

discharging power. The aggregate power is positive when the EVs‚Äô aggregator

is charging, i.e., it behaves as a consumer. Otherwise, the aggregate power

takes on negative values when the aggregator is discharging, i.e., it acts as a

1This problem is also known as forward or reconstruction problem in the IO jargon.

8

producer. We assume step-wise oÔ¨Äer/bid price functions as depicted in Fig.

1, as is customary in real-world electricity markets, e.g.

see OMIE (2019).

Constraints (1b) represent the lower and upper bounds on the aggregate power.

Constraints (1c) impose the lower and upper bound on each block b within

the set Bc of charging power blocks. Since the charging power is assumed to

be non-negative, then pb,t is bounded between 0 and a positive power bound

Eb,t. Likewise, constraints (1d) impose the lower and upper bound on each

block b within the set Bd of the discharging power blocks. We assume that the

discharging power is non-positive and thus pb,t is bounded between a negative
power bound Eb,t and 0. Note that the total power pt = (cid:80)

b pb,t.

m‚àí3
m‚àí2
m‚àí1
m1
m2
m3

)
h
W
k
/
e
(

e
c
i
r
P

E‚àí3 E‚àí2

E‚àí1

‚àí120‚àí100 ‚àí80 ‚àí60 ‚àí40 ‚àí20

0

E1

20

E2 E3

40

60

80

100

Power p (kW)

Figure 1: Three-block stepwise oÔ¨Äer (bid) price function of the EVs‚Äô aggregator.

In this

example, the oÔ¨Äer (bid) price function is represented to the left (right) of the y-axis, and the

sets Bd = {‚àí3, ‚àí2, ‚àí1} and Bc = {1, 2, 3}.

As previously stated, we want to anticipate the EV-Ô¨Çeet power response by

solving (1). However, to this end, the set of parameters Œ¶ = {Eb,t, Eb,t, mb,t, P t,

P t} needs to be estimated since they are a priori unknown. These parameters

should be functions of time and of any regressor that the forecaster may con-

sider meaningful and explanatory of the EV-Ô¨Çeet‚Äôs operational behavior and,

therefore, are to be inferred from past observations of the aggregate power p(cid:48)
t,

the electricity price Œª(cid:48)

t, and the regressors that are eventually considered. This

fact gives rise to a generalized IO problem, which is highly nonlinear and non-

convex. This problem can be naturally formulated as a bilevel optimization

problem, which may be computationally nonviable when moderately increasing

the sample size. To deal with such complexity, we apply a methodology that

9

builds on the one Ô¨Årst proposed in Saez-Gallego & Morales (2017).

In that

paper, however, the regression function is linear in their features and may be

limited to capture nonlinear relations between the EV-Ô¨Çeet power and the re-

gressors. To circumvent such a caveat, and as one of the salient features of

this work, we incorporate kernels into the regression functions. Furthermore,

the forward model we propose, i.e. problem (1), allows for power intakes and

outputs, unlike the one used in Saez-Gallego & Morales (2017). This extra dose

of model Ô¨Çexibility is critical to capture the behavior of an EV Ô¨Çeet with V2G

capabilities since the aggregator power may be positive when the net power

comes from the grid (i.e. the aggregator acts as a consumer) or negative when

the net power Ô¨Çows into the grid (i.e. the aggregator behaves as a producer).

Therefore, the forecasting model is tailored to account for this dual operational

mode by introducing diÔ¨Äerentiated marginal utility blocks both for charging and

discharging.

2.2. Accounting for Past Information: Kernels

In the realm of machine learning, the kernel functions are rather popular in

learning algorithms (Hofmann et al., 2008) since they are able to capture nonlin-

ear relationships between the dependent and the explanatory variables. Unlike

in Saez-Gallego & Morales (2017), where aÔ¨Éne functions were used to model

the dependence of the parameters of the forward model (1) on the regressors,

we propose the use of kernel regressions to estimate P t, P t, and mb,t:

P t = ¬µ +

P t = ¬µ +

(cid:88)

œÑ ‚àà‚Ñ¶tr
(cid:88)

œÑ ‚àà‚Ñ¶tr

Œ±œÑ Kt,œÑ ,

‚àÄt ‚àà T

Œ±œÑ Kt,œÑ ,

‚àÄt ‚àà T

mb,t = ŒΩb +

(cid:88)

œÑ ‚àà‚Ñ¶tr

œÅœÑ Kt,œÑ ,

‚àÄt ‚àà T .

(2)

(3)

(4)

Many kernel functions can be used: polynomial, hyperbolic tangent, Gaus-

sian, among others. For the sake of illustration purposes, the Gaussian kernel

10

(Trevor et al., 2009) can be deÔ¨Åned as follows:

Kt,œÑ = K (zt, zœÑ ) = e‚àíŒ≥(cid:107)zt‚àízœÑ (cid:107)2
2,

‚àÄt ‚àà T , œÑ ‚àà ‚Ñ¶tr,

(5)

wherein Œ≥ is a scale parameter inversely proportional to the variance of the

Gaussian function; and (cid:107)zt ‚àí zœÑ (cid:107)2

2 is the squared Euclidean distance between

two feature vectors at time periods t and œÑ . Thus, the Gaussian kernel can be

interpreted as a similarity measure between two time periods, i.e., if the two

feature vectors are identical zt = zœÑ , then the value of Kt,œÑ = 1, otherwise its

value ranges in the interval (0, 1].

As previously mentioned, meaningful or explanatory features should be used

in the kernel regression function for adequately inferring the estimates. In the

proposed IO methodology, the power bounds P t and P t are key to captur-

ing the price-responsiveness of the aggregator since they determine the width

and the range of the step-wise price-response function of the EV Ô¨Çeet. For in-

stance, if the electricity price is high, one should expect that the EV Ô¨Çeet will

behave as a producer (in V2G mode) and therefore, the power bounds would

take on negative values, this way producing a step-wise oÔ¨Äer curve displaced

towards negative power values (i.e., discharge). On the contrary, if the price

is low, one should expect the opposite: the EV Ô¨Çeet would act as a consumer,

with the power bounds taking positive values and deÔ¨Åning a step-wise bidding

curve displaced towards positive power values (i.e., charge). On the other hand,

the marginal utilities aim to capture the price-sensitivity of the EVs aggregate

power. Therefore, by making both the power bounds and the marginal utilities

dependent on past prices along with past values of the aggregate EV-Ô¨Çeet power

and/or other external factors, we can capture the changes in the EV-Ô¨Çeet power

due to price variations over time.

Illustrative example. Let us assume that zt comprises only one regressor,

e.g. the electricity price in the previous time period, i.e., zt = Œªt‚àí1. Thus, Fig.

2 provides the values of the kernel for each time period t of a day with respect

to the second time period œÑ = 2, i.e., Kt,œÑ =2, for diÔ¨Äerent values of parameter Œ≥.

Moreover, the values of the regressor zt for the 24 hours are shown in the Ô¨Ågure.

11

We can observe that high values of Œ≥ lead to kernel values equal to 1 just when

the two regressors are very close to each other (e.g., see time periods 21‚Äì23 for

Œ≥ = 1); conversely, low values of Œ≥ lead to kernel values equal to 1 even when the

regressors are very diÔ¨Äerent from each other (e.g., see values for all time periods

when Œ≥ = 0.001). Therefore, we need to carefully tune the hyper-parameter Œ≥,

as described in Section 2.3.3.

)
h
W
M
/
e
(

t

1
‚àí
Œª
=
z

t

r
o
s
s
e
r
g
e
R

100

80

60

40

20

0

2
=
œÑ
,
t

K

f
o

e
u
l
a
V

1

0.8

0.6

0.4

0.2

0

1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24
Time period t (h)
Œ≥ = 0.1

Œ≥ = 0.001

Regressor

Œ≥ = 0.01

Œ≥ = 1

Figure 2: Values of the Gaussian kernel for each time period t of a day with respect to

period œÑ = 2, i.e., Kt,œÑ =2, for diÔ¨Äerent values of the parameter Œ≥ in the right y-axis and the

corresponding regressor values in the left y-axis.

2.3. Two-step Estimation Procedure

The thrust of this work is the estimation of the set of parameters Œ¶ =

{Eb,t, Eb,t, mb,t, P t, Pt} and the corresponding coeÔ¨Écient estimates ¬µ, Œ±t, ¬µ, Œ±t,

ŒΩb, œÅt of the regression functions described in (2)‚Äì(4). To do that, we can

use bilevel optimization, however, as mentioned previously, it may lead to a

prohibitive computational burden when moderately increasing the sample size.

Therefore, we resort to a two-step procedure based on two convex programming

problems: (i) the feasibility problem, which is devoted to estimating all param-

eters that determine the feasibility of the observed EV-Ô¨Çeet power values in the

forward problem (1) (i.e., the power bounds), and (ii) the optimality problem,

which estimates the marginal utility of the EVs‚Äô aggregator, i.e., the parameters

of problem (1) that are related to the optimality of the observed power values.

The key idea of the feasibility problem is to shape the power bounds P t and

12

P t so that a certain percentage H of the observed EV-Ô¨Çeet power values are

feasible for the forward problem (1). Note that the width for the aggregate

power blocks Eb,t and Eb,t can be easily computed from the estimated power

bounds by assuming that the energy blocks are all of same length. Conversely,

the optimality problem estimates the marginal utilities mb,t driven by the min-

imization of the duality gap of the forward problem once the power bounds are

Ô¨Åxed. Its aim is thus to make the observed EV-Ô¨Çeet power values as optimal

as possible for problem (1) (recall that we use (1) as the forward model). It

should be noted that the pair (mb,t, Eb,t) for all blocks constitutes the bid curve

of the aggregator at time period t. Likewise, the pair (mb,t, ‚àíEb,t) for all blocks

constitutes the oÔ¨Äer curve of the aggregator at time period t. In practice, those

curves may be submitted to the market operator, who is the entity responsible

for the Ô¨Ånancial management of electricity markets, e.g. see OMIE (2019).

2.3.1. Feasibility Problem

Given a Ô¨Åxed value of control parameter H ‚àà [0, 1), this problem can be

formulated as:

min
Œûf p

(cid:88)

t‚àà‚Ñ¶tr

(cid:16)

H

Œæ

‚àí
t + Œæ‚àí
t

(cid:17)

+

(cid:88)

t‚àà‚Ñ¶tr

(1 ‚àí H)

(cid:16)

Œæ

+
t + Œæ+
t

(cid:17)

subject to:

P t ‚àí p(cid:48)

t = Œæ

+
t ‚àí Œæ

‚àí
t ,

t ‚àí P t = Œæ+
p(cid:48)
t
‚àÄt ‚àà ‚Ñ¶tr

‚àí Œæ‚àí
t

P t ‚â• P t,

,

‚àÄt ‚àà ‚Ñ¶tr

‚àÄt ‚àà ‚Ñ¶tr

Constraints (2)‚Äì(3)

Œæ

+
t , Œæ+
t

, Œæ

‚àí
t , Œæ‚àí
t

‚â• 0,

‚àÄt ‚àà ‚Ñ¶tr,

(6a)

(6b)

(6c)

(6d)

(6e)

(6f)

where the set of variables to be optimized is Œûf p = {P t, P t, Œæ
¬µ, Œ±t, Œ±t}. Note that problem (6) is a convex program.

+
t , Œæ+
t

, Œæ

‚àí
t , Œæ‚àí
t

, ¬µ,

The objective function (6a) minimizes the sum of feasibility and infeasibility

slack variables associated with the power bounds. Constraints (6b)‚Äì(6c) are the

power bound constraints with the feasibility and infeasibility slack variables,

13

where p(cid:48)

t is the observed EV-Ô¨Çeet power value at time period t. Constraints

(6d) ensure that the upper bound of the aggregate power is greater than its

respective lower bound. Constraints (6e) impose kernel regression functions

for the power bounds wherein the coeÔ¨Écients to be estimated are ¬µ, ¬µ, Œ±t,

Œ±t. Finally, constraints (6f) declare the variables Œæ

+
t , Œæ+
t

, Œæ

‚àí
t , Œæ‚àí
t

as non-negative.

Importantly, the higher the value of H, the wider the power bounds delivered

by (6) and, therefore, the more price-responsive the EV Ô¨Çeet is expected to be.

The use of kernels increases the Ô¨Çexibility of the regression function when

increasing the size of the training set. However, it also tends to over-Ô¨Åtting.

To control the risk of over-Ô¨Åtting, a regularization parameter M ‚àà [0, 1] is used

to factor in the sum of the squared values of the coeÔ¨Écient estimates Œ±t and

Œ±t, similarly to what is typically done in kernel-ridge regression (Trevor et al.,

2009). Thus, the objective function (6a) should be replaced with:

M

min
Œûf p

(cid:88)

(cid:0)Œ±2

t + Œ±2
t

(cid:1)

t‚àà‚Ñ¶tr

+ (1 ‚àí M ) (cid:2) (cid:88)

H

(cid:16)

Œæ

‚àí
t + Œæ‚àí
t

(cid:17)

+

t‚àà‚Ñ¶tr

(cid:88)

t‚àà‚Ñ¶tr

(1 ‚àí H)

(cid:16)

Œæ

+
t + Œæ+
t

(cid:17)(cid:3).

(7)

Both hyper-parameters M and H in the objective function and parameter Œ≥

of the kernel regression function must be adequately adjusted to modulate the

power bounds to the observed EV-Ô¨Çeet power values so that the out-of-sample

forecasting error is minimized.

2.3.2. Optimality Problem

Once the power bounds (i.e., (cid:98)P t, (cid:98)P t) are estimated from (6), we can compute
the power block limits (cid:98)Eb,t, ‚àÄb ‚àà Bc and (cid:98)Eb,t, ‚àÄb ‚àà Bd based on the assignments
described in Table 1. The optimality problem can then be derived by using

14

results from duality theory of linear programming and it can be formulated as:

min
Œûop

(cid:88)

(cid:15)t

t‚àà‚Ñ¶tr

(cid:98)P tŒ≤t ‚àí (cid:98)P tŒ≤

+

t

(cid:98)Eb,tœÜ

c
b,t ‚àí

(cid:88)

b‚ààBc

(cid:88)

b‚ààBd

(cid:98)Eb,tœÜd
b,t

‚àí (cid:15)t =

(8a)

b,t (mb,t ‚àí Œªt) , ‚àÄt ‚àà ‚Ñ¶tr
p(cid:48)

(8b)

(cid:88)

b‚ààB

‚àí œÜc
b,t

‚àí œÜd
b,t

+ œÜ

c
b,t ‚àí Œ≤

+ œÜ

d
b,t ‚àí Œ≤

t

t

Constraints (4)

+ Œ≤t = mb,t ‚àí Œªt,

‚àÄb ‚àà Bc, t ‚àà ‚Ñ¶tr

+ Œ≤t = mb,t ‚àí Œªt,

‚àÄb ‚àà Bd, t ‚àà ‚Ñ¶tr

ŒΩb ‚â• ŒΩb+1,

‚àÄb ‚àà B \ {b = NB}

Œ≤

, Œ≤t, œÜc
b,t

t

, œÜ

c
b,t, œÜd
b,t

, œÜ

d
b,t ‚â• 0,

‚àÄt ‚àà ‚Ñ¶tr,

(8c)

(8d)

(8e)

(8f)

(8g)

where the set of decision variables is Œûop = {mb,t, (cid:15)t, Œ≤

, Œ≤t, œÜc
b,t

t

, œÜ

c
b,t, œÜd
b,t

, œÜ

d
b,t,

ŒΩb, œÅt}. Note that problem (8) is a convex program.

Table 1: Value of (cid:98)Eb,t, ‚àÄb ‚àà Bc and (cid:98)Eb,t, ‚àÄb ‚àà Bd

(cid:98)P t ‚â• (cid:98)P t ‚â• 0 (cid:98)P t ‚â§ (cid:98)P t ‚â§ 0 (cid:98)P t ‚â• 0 ‚â• (cid:98)P t

(cid:98)Eb,t

(cid:98)Eb,t

b = 1

b ‚àà Bc \ {1}

b = ‚àí1

(cid:17)

(cid:16)

(cid:98)P t
(cid:98)P t‚àí (cid:98)P t
NB ‚àí1
0

b ‚àà Bd \ {‚àí1}

0

0

0

(cid:16)

(cid:98)P t
(cid:98)P t‚àí (cid:98)P t
NB ‚àí1

(cid:17)

(cid:98)P t/NB

(cid:98)P t/NB

(cid:98)P t/NB

(cid:98)P t/NB

The objective function (8a) minimizes the sum of the duality gaps of problem

(1). Constraints (8b) is the relaxed equality constraint associated with the

strong duality theorem. Constraints (8c)‚Äì(8d), (8g) are the dual feasibility

constraints. Constraints (8e) impose a kernel regression function, with ŒΩb and

œÅt as the coeÔ¨Écients to be estimated, in order to relate the marginal utilities

and the regressors. Finally, constraints (8f) set the marginal utilities to be

monotonically non-increasing, as imposed by rules in electricity markets (OMIE,

2019).

15

2.3.3. Statistical Computation of Hyper-Parameters

The main goal of this work is to learn the EV-Ô¨Çeet power for each period

t ‚àà ‚Ñ¶test with the forward model (1), which relies on the knowledge of a series of

parameters, i.e., the power bounds and the marginal utilities. Those parameters

are estimated with the models described in Sections 2.3.1 and 2.3.2, whose

outcome depend on the value of three hyper-parameters: H, M , and Œ≥. Their

optimal values are computed by using a grid search technique. We recursively

solve problems (6) and (8) for the training set ‚Ñ¶tr; and we then solve the forward

problem (1) over the validation set ‚Ñ¶v by using the estimated parameters Œ¶ =

{Eb,t, Eb,t, mb,t, P t, P t} as well as the electricity price at time period t ‚àà ‚Ñ¶v.
Thus, we set as the optimal values of the hyper-parameters those that lead to

the least out-of-sample forecasting error in ‚Ñ¶v.

3. Comparison Methodologies

We compare the performance of the proposed kernel-based IO approach,

hereinafter referred to as kio, against (i) the state-of-the-art model to forecast

the EV-Ô¨Çeet power, namely kernelized support vector regression (svr ), (ii) a

kernel-ridge regression model (krr ), (iii) an IO approach with linear kernels

(lio), and (iv) persistence or naive models. Note that we use a Gaussian kernel

in the regression functions of the feasibility problem and a linear kernel in the

regression function of the optimality problem, as this combination exhibited the

best trade-oÔ¨Ä between forecasting performance and simplicity in our numerical

experiments.

Regarding the svr and krr, we respectively use the epsilon-svr and the kernel-

ridge regression models implemented in the scikit-learn library (Pedregosa et al.,

2011) under the Python programming language. The interested reader is re-

ferred to Smola & Sch¬®olkopf (2004) for a detailed description of the svr. For

the sake of comparison, we also use the Gaussian kernel and we tune the cor-

responding hyper-parameters via grid search. SpeciÔ¨Åcally, we tune the cost of

constraints violation C and the parameter associated with the kernel Œ≥ for svr ;

and the penalty parameter Œ¥ and the Œ≥ parameter for krr.

16

Regarding the naive models, we use three diÔ¨Äerent ones since the EV-Ô¨Çeet

power may experience seasonal patterns: h-naive, d-naive, and w-naive, in which

the forecast value of the aggregate power at time t is equal to the observed value

at time t ‚àí 1, t ‚àí 24, and t ‚àí 168, in that order. Note that the forecast error of

the naive models provides insight into the diÔ¨Éculty of prediction.

The performance of the methods is compared with two metrics: the mean

absolute error (MAE) and the root mean square error (RMSE) on the test set.

4. Case Study

We Ô¨Årst describe the data used for the case study in Section 4.1. Subse-

quently, we comprehensively analyze the results from the proposed approach

for three cases of charging behavior without enabling the V2G capabilities in

Section 4.2. Finally, Section 4.3 presents the results for two cases when the

electric vehicles are integrated with V2G services.

4.1. EV-Ô¨Çeet Data

For learning purposes, we would be only interested in the time series of

electricity prices, the aggregate power of an EV Ô¨Çeet, and the total number of

available vehicles to charge or discharge. However, to our knowledge, there is

no real-life data available about an EVs‚Äô aggregator. Thus, we resort to the

formulation of an optimization problem to simulate the behavior of such an EV

Ô¨Çeet. The interested reader is referred to Appendix A for a detailed description

of this simulator.

We assume a residential aggregator with 100 EVs. For the sake of simplicity,

the technical parameters associated with each EV are identical: The maximum

charging rate is 7.4 kW, the round-trip eÔ¨Éciency is 0.95, the minimum and

maximum energy rates are 10 and 51 kWh, in that order, and the energy rating

per kilometer is 0.137 kWh/km (Renault, 2019). Due to the lack of real-life

data about the parameters associated with the driving patterns (availability

proÔ¨Åles and energy required for transportation) of EVs, we resort to the National

17

Household Travel Survey (NHTS, 2019). From this data base, we can extract

the availability status by using the departure/arrival time periods for each daily

trip. SpeciÔ¨Åcally, we assume that the EV is available until it begins its Ô¨Årst

daily trip and after it returns from its last daily trip for each day of the year.

Otherwise the EV is unavailable and thus it may be in a motion status. The

energy required for transportation œáv,t can be computed as the product of the

travelled distance and energy rating per kilometer (i.e., 0.137 kWh/km).

The electricity prices are obtained from the ENTSO-e Transparency Plat-

form (ENTSO-e, 2019) for the period comprising January 9th till February 19th

in Spain. We also assume that the load shedding cost C P = 1000 e/kWh. We

run daily simulations with 15-min time steps to build a synthetic database for

a pool of EVs.

The simulations have been performed on a Linux-based server with one CPU

clocking at 2.6 GHz and 2 GB of RAM using CPLEX 12.6.3 (CPLEX, 2019)

under Pyomo 5.2 (Hart et al., 2011). Optimality gap is set to 0%. The input data

Ô¨Åles for reproducing the results have been shared with the scientiÔ¨Åc community

in https://github.com/groupoasys/Aggregated-EV-data.

4.2. Forecast Results without Enabling V2G Capabilities

We assume that EVs do not enable their V2G capabilities (i.e. Bd

v = 0 in

the model (A.1)‚Äì(A.9) in the Appendix A) and we compare the results for

three cases: (i) a case in which the EVs satisfy their energy needs by using a

naive charging; (ii) a case in which the charging is highly synchronized, which

occurs when C S is set to 0 in (A.1)‚Äì(A.9); and (iii) a case in which the charging

synchronization is avoided, which we attain by setting C S = 520 e/MWh2.

Those cases are respectively denoted as naive-ch, sync, and non-sync. Note

that, in the former case, i.e. naive-ch, each EV will be charged to its required

maximum energy as soon as it is available, thus neglecting the dependence of

the charging power on the price; whereas, the latter cases sync and non-sync are

driven by the cost minimization of the EVs‚Äô aggregator wherein the electricity

prices are accounted for. As an example, Fig. 3 shows the EV-Ô¨Çeet charging

18

power of a certain day for the three cases along with the electricity prices. As

can be seen, the choice of C S (cid:54)= 0 is a simple albeit convenient way to avoid

the undesirable charging synchronization by smoothing the aggregate power.

In addition, we can observe that the charging pattern of the naive-ch case is

independent of the prices.

)
h
W
k
(

r
e
w
o
p

g
n
i
g
r
a
h
C

350

280

210

140

70

0

100

80

60

40

20

0

)
h
W
M
/
e
(

e
c
i
r
P

1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24
Time period (h)
Case sync

Case non-sync

Case naive-ch

Price

Figure 3: Charging power for cases naive-ch, sync, and non-sync in the left y-axis and the

corresponding electricity prices in the right y-axis.

Figure 4: Power versus price for cases (a) naive-ch, (b) sync, and (c) non-sync.

The sizes of the training, validation, and test sets are 672 h, 168 h, and

168 h, in that order. Fig. 4 represents the hourly electricity price versus the

corresponding charging power for all periods of the ‚Ñ¶tr for the cases mentioned

above. As can be seen, the aggregate power of the non-sync case depends

linearly on the price, unlike the naive-ch and sync cases. For the naive-ch case,

we consider 17 regressors, namely the charging power and the total number of
EVs available for the six periods previous to time t, i.e., pt‚àíl and (cid:80)
v œÇv,t‚àíl,
‚àÄl = 1...6, and 5 binary-valued categorical variables to indicate the hour of the

day. For the cases sync and non-sync, we consider 12 regressors, namely the

19

        $ J J U H J D W H  S R Z H U   N :          3 U L F H    0 : K   D         $ J J U H J D W H  S R Z H U   N :           E        $ J J U H J D W H  S R Z H U   N :           F electricity price and the charging power for the six periods previous to time t,

i.e., Œªt‚àíl and pt‚àíl, ‚àÄl = 1...6. We also assume six energy blocks in total. Finally,

hyper-parameter H ranges in the interval [0.5, 1.0) with 0.01 steps, M ranges in

the interval [0.0001, 0.0024] with 0.0001 steps, and Œ≥ = {0.1, 0.01}. For the case

sync, the proposed approach kio takes on average 12.6 s, 2.6 s, and 31.3 s to run

each feasibility problem, optimality problem, and all the forward problems for

the ‚Ñ¶v, in that order. The computing times are of the same order of magnitude

for the other cases. It should be noted that those computing times would be

even suitable for an hour-ahead forecasting if the grid search technique were

parallelized.

The optimal hyper-parameters for all models and cases are given in Table 2.

The information given in this table is quite valuable and we can make two main

remarks. First, cases sync and non-sync are price-driven and thus their optimal

values of parameter H ‚àó are very high (0.82 and 0.94 respectively) compared to

the optimal value (H ‚àó = 0.64) for the case naive-ch, which is insensitive to the

prices. In other words, the power bounds for the former cases are wider than for

the latter one. Therefore, the optimality problem, which is used to estimate the

marginal utility, plays a major role to learn the aggregate response of the EV

Ô¨Çeet for the price-driven cases. This is expected as the marginal utilities encode

the impact of the current electricity price on the aggregate power of the EV

Ô¨Çeet. Second, it should be noted that the optimal values of H ‚àó for the models

kio and lio are quite similar, except for the case naive-ch, for which lio is unable

to identify the insensitiveness of the aggregate power to the price.

The error metrics of the test set for all models are compared in Table 3

for the three cases. In the naive-ch case, the least RMSE is obtained with the

proposed model kio with an error reduction of 4.4% and 17.3% compared to krr

and svr. In the sync case, the proposed model kio achieves 28.3% reduction in

RMSE and 15.3% reduction in MAE compared to the w-naive, which provides

the best performance among the naive models. As expected, we can also observe

that the kio outperforms lio by reducing RMSE and MAE by 40.6% and 42.2%

since kio is able to capture the nonlinear relations between the EV-Ô¨Çeet power

20

Table 2: Optimal Values of the Hyper-Parameters

Case

kio

krr

svr

lio

H ‚àó = 0.64

Œ¥‚àó = 0.01 C ‚àó = 100 H ‚àó = 0.91

naive-ch

M ‚àó = 0.0002

Œ≥‚àó = 0.1

Œ≥ = 0.01

Œ≥‚àó = 0.1

H ‚àó = 0.82

Œ¥‚àó = 0.1

C ‚àó = 10 H ‚àó = 0.89

sync

M ‚àó = 0.0001

Œ≥‚àó = 0.1

Œ≥‚àó = 0.1

Œ≥‚àó = 0.1

H ‚àó = 0.94

Œ¥‚àó = 0.1

C ‚àó = 1

H ‚àó = 0.94

non-sync

M ‚àó = 0.002

Œ≥‚àó = 0.1

Œ≥ = 0.1

Œ≥‚àó = 0.01

Table 3: Error Metrics ‚Äì Cases without V2G Services (kW)

Model

kio

krr

svr

lio

h-naive

d-naive

w-naive

naive-ch

sync

non-sync

RMSE MAE RMSE MAE RMSE MAE

8.6

9.0

10.4

16.8

90.3

13.2

10.8

3.7

3.5

5.7

6.4

29.3

4.8

4.6

35.2

35.5

41.7

59.3

72.7

64.8

49.1

13.3

15.7

14.7

23.0

25.3

22.3

15.7

5.5

7.4

7.6

5.9

11.3

17.3

13.0

3.8

5.2

5.0

3.9

7.1

13.3

9.1

and the electricity price shown in Fig. 3. Finally, the performance of kio is

comparable to the performance of other machine-learning techniques such as

krr or svr. In the non-sync case, the aggregator behaves as a price-responsive

EV Ô¨Çeet with a linear dependence and thus both kio and lio models achieve the

least errors in the ‚Ñ¶test compared to the other benchmarks. Note also that, in

this case, the h-naive is the one with the least error among the naive models.

However, the RMSE of the kio is decreased by 51.3%, 25.7%, and 27.6% with

21

Figure 5: Estimated power bounds as well as forecast and observed power for case naive-ch.

respect to the one attained with the models h-naive, krr, and svr, in that order.

Overall, the kio model is characterized for being versatile since it makes good

predictions under any pattern of the EV-Ô¨Çeet power with the price.

Apart from the improvement in terms of RMSE and MAE of the kio against

the rest of the models to learn the EV-Ô¨Çeet power, the proposed approach is

able to provide a bid curve, as imposed by rules in electricity markets (OMIE,

2019). Figures 5‚Äì7 show the results for cases naive-ch, sync, and non-sync,

respectively. In Fig. 6.(a) and 7.(a), we show the estimated marginal utilities

for the six blocks for each hour of the Ô¨Årst day of the ‚Ñ¶test and for the cases sync

and non-sync. In those Ô¨Ågures, we also show the decreasing bid curves at hour 5

in the inset plots, which are also presented in Tables 4‚Äì5. Correspondingly, Fig.

5, 6.(b), 7.(b) depict the estimated bounds as well as the forecast and observed

EV-Ô¨Çeet power for such a day.

In the naive-ch case, the kio provides coincident power bounds, as illustrated

in Fig. 5, which means that the optimality problem (i.e. the marginal utility

estimation problem, which captures the price eÔ¨Äect) is useless and thus the

aggregate charging power can be directly explained by estimating the bounds.

In Fig. 6.(a) and 7.(a), we can observe that the kio model identiÔ¨Åes whether

the EV-Ô¨Çeet power is price-responsive or not by assigning diÔ¨Äerent values to the

marginal utility for each block. On the one hand, in Fig. 6.(a), the blockwise

marginal utilities are almost identical at any time period, thus suggesting an

22

           7 L P H  S H U L R G   K            $ J J U H J D W H  S R Z H U   N :  ) R U H F D V W 2 E V H U Y H G % R X Q G VFigure 6: Results for case sync: (a) Estimated marginal utility price per block (in grey) and

electricity price (in black) and (b) estimated power bounds as well as forecast and observed

power. Note that the inset plot represents the bid price function and the corresponding

electricity price of hour 5.

almost all-or-nothing price response of the EV Ô¨Çeet for the sync case. In this

case, the power bounds are basically shaping the EV-Ô¨Çeet charging forecast. On

the other hand, for the non-sync case, the bounds are generally wider than those

obtained for the sync case (see Fig. 7.(b)). The marginal utility is thus shaping

the aggregate power forecast since the kio model gives rise to a wider range of

marginal utility values at any time period, as can be observed in Fig. 7.(a).

In short, unlike any other forecasting tool, we gain interpretability with the

proposed IO approach kio due to two aspects: (i) the width of the bounds, which

sheds light on the price-responsiveness of the EV Ô¨Çeet; and (ii) the derivation of

a bid curve when there exists a dependence of the EV-Ô¨Çeet power on the price,

as can be seen in the inset plots of Figs. 6.(a)‚Äì7.(a) and Tables 4‚Äì5.

23

               3 U L F H    0 : K   D            7 L P H  S H U L R G   K              $ J J U H J D W H  S R Z H U   N :   E  ) R U H F D V W 2 E V H U Y H G % R X Q G V     3 R Z H U       3 U L F HFigure 7: Results for case non-sync: (a) Estimated marginal utility price per block (in grey)

and electricity price (in black) and (b) estimated power bounds as well as forecast and observed

power. Note that the inset plot represents the bid price function and the corresponding

electricity price of hour 5.

4.3. Forecast Results with V2G Services

We now assume that EVs may enable their V2G capabilities (i.e. Bd

v (cid:54)= 0 in

the model (A.1)‚Äì(A.9)) and we compare the results for two cases: (i) a highly-

synchronized power case when C S = 0; and (ii) a case in which the power

synchronization is avoided when C S = 52 e/MWh2. Those cases are denoted

as sync and non-sync. The problem setup is identical to that explained in

Section 4.2. Table 6 provides the error metrics on the ‚Ñ¶test for all models. As

can be seen, kio clearly outperforms by far the lio and naive models for both

cases. Notwithstanding, the performance of lio in terms of error is closer to the

proposed approach for the non-sync case because the EV-Ô¨Çeet power is more

price-responsive. Also, the performance of kio is similar to the machine-learning

techniques krr and svr in the case sync; and the RMSE (MAE) decreases by

4.8% and 5.9% (11.4% and 6.7%) compared to krr and svr, respectively, in the

24

               3 U L F H    0 : K   D            7 L P H  S H U L R G   K         $ J J U H J D W H  S R Z H U   N :   E  ) R U H F D V W 2 E V H U Y H G % R X Q G V    3 R Z H U         3 U L F HTable 4: Bid Curve at Hour 5 ‚Äì Case sync

Block

1

2

3

4

5

6

Marginal utility (‚Ç¨/MWh)

42.7

42.4

42.4

42.4

42.4

42.4

Power block (kW)

38.7

31.1

31.1

31.1

31.1

31.1

Table 5: Bid Curve at Hour 5 ‚Äì Case non-sync

Block

1

2

3

4

5

6

Marginal utility (‚Ç¨/MWh)

45.5

45.4

44.7

43.3

41.6

40.5

Power block (kW)

26.0

8.1

8.1

8.1

8.1

8.1

case non-sync.

Table 6: Error Metrics ‚Äì Cases with V2G Services (kW)

sync

non-sync

RMSE MAE RMSE MAE

Model

kio

krr

svr

lio

148.6

94.3

146.9

108.4

147.1

92.4

172.1

120.0

h-naive

235.4

142.2

d-naive

261.8

162.5

w-naive

199.5

112.3

33.5

35.2

35.6

36.2

49.5

71.1

60.4

20.9

23.6

22.4

23.7

30.0

50.2

37.7

5. Conclusions

This paper proposes a data-driven two-step estimation procedure relying on

two main concepts: inverse optimization and kernel regression. This novel ap-

proach allows to capture the nonlinear relationship between an aggregate price-

response and the associated explanatory variables, while deriving a bid/oÔ¨Äer

curve, as imposed by rules in electricity markets. We apply such a framework

to learn the aggregate price-response of an EV Ô¨Çeet. The proposed approach

25

attains a better performance (around 20%‚Äì40% error reduction) than naive or

linear models. Moreover, it achieves a similar or better (depending on the case)

performance than state-of-the-art machine-learning techniques such as support

vector regression or kernel-ridge regression. Overall, the proposed approach is

versatile since its performance is good regardless of the price-power relation.

Very interestingly, besides, it increases the degree of interpretability of the pre-

diction model compared to existing approaches in the literature since a bid/oÔ¨Äer

curve can be readily derived.

6. Acknowledgements

This project has received funding in part by the Spanish Ministry of Econ-

omy, Industry, and Competitiveness through project ENE2017-83775-P; in part

by the European Research Council (ERC) under the European Union‚Äôs Horizon

2020 research and innovation programme (grant agreement No 755705); and in

part by Fundaci¬¥on Iberdrola EspaÀúna 2018. The authors thankfully acknowledge

the computer resources, technical expertise and assistance provided by the SCBI

(Supercomputing and Bioinformatics) center of the University of Malaga.

Appendix A. Aggregator of Electric Vehicles

To simulate the behavior of a pool of EVs, i.e., its aggregate power, we

assume an aggregator of EVs in residential districts who aims to minimize their

26

total costs. This can be mathematically expressed as:

(cid:32)

min
Œûev

(cid:88)

t‚ààT

Œªt‚àÜtpt +

C D

v,t + C P sv,t

(cid:17)

+ C S‚àÜt2p2
t

(cid:33)

(cid:88)

(cid:16)

v‚ààV

subject to:

pt =

(cid:88)

v‚ààV

(cv,t ‚àí dv,t) ,

‚àÄt ‚àà T

socv,t = socv,t‚àí1 + ‚àÜt

(cid:18)

Œ∑c
vcv,t ‚àí

(cid:19)

dv,t
Œ∑d

0 ‚â§ cv,t ‚â§ Bc

vœÇv,t,

‚àÄv ‚àà V, t ‚àà T

0 ‚â§ dv,t ‚â§ Bd

v œÇv,t,

‚àÄv ‚àà V, t ‚àà T

SOC v,t ‚â§ socv,t ‚â§ SOC v,t,

‚àÄv ‚àà V, t ‚àà T

socv,NT = socv,0,

‚àÄv ‚àà V

C D

v,t = Av,t + Fvdv,t,

‚àÄv ‚àà V, t ‚àà T

sv,t ‚â• 0,

‚àÄv ‚àà V, t ‚àà T ,

(A.1)

(A.2)

(A.4)

(A.5)

(A.6)

(A.7)

(A.8)

(A.9)

‚àí œáv,t + sv,t ‚àÄv ‚àà V, t ‚àà T

(A.3)

where the set of decision variables Œûev = {cv,t, C D

v,t, dv,t, pt, sv,t, socv,t}, V is the

set of EVs in the Ô¨Çeet, T is the set of time periods. The variable pt represents the

power the aggregator buys in the electricity market whereas the variables cv,t

and dv,t represent the charging power from and discharging power to the grid of

EV v in period t. The variable C D

v,t represents the cost of battery degradation

due to motion and charging/discharging cycle of EV v in period t. The variables

sv,t act as a load shedding term when the energy balance of the EVs cannot be

satisÔ¨Åed. Finally, socv,t is the state of charge of the battery of EV v in period t.
In addition, Œªt is the electricity price in period t; ‚àÜt is the time step; C P is the
load shedding cost; C S is a penalty cost to avoid power synchronization; Œ∑c(d)

v

is the charging (discharging) eÔ¨Éciency for the EV v; œáv,t represents the energy

required for transportation of each EV throughout the time horizon; Bc

v and

Bd

v are the maximum charging and discharging power of EV v, respectively; œÇv,t

represents the availability of the EV v in period t; SOC v,t and SOC v,t are the

minimum and maximum limits of the energy state of charge of EV v in period

t; NT is the number of time periods; Fv is the degradation cost per kW due

27

to charging-discharging cycles and it depends on the battery cost of EV v; and

Av,t is the degradation cost due to motion of EV v in time period t.

The problem (A.1)‚Äì(A.9) aims to minimize the total costs as given in (A.1),

which comprise four terms: (i) the operational costs due to charging from and

discharging to the grid, (ii) the degradation costs of the vehicles‚Äô batteries, (iii)

the load shedding costs when the equation associated with the energy state-of-

charge evolution is violated, and (iv) the penalty costs to avoid power synchro-

nization that may lead to overloads in the distribution network (Sarker et al.,

2016). Constraints (A.2) relate the power bought in the electricity market with

the charging and discharging power. Constraints (A.3) model the energy state

of charge evolution while taking into account the energy required for transporta-

tion. Expressions (A.4) and (A.5) impose the lower and upper bounds for the

charging and discharging power, in that order. Constraints (A.6) set the lower

and upper bounds for the energy state of charge of the EVs. Expressions (A.7)

enforce boundary conditions on the energy state-of-charge of the EVs. Expres-

sions (A.8) model the battery degradation costs based on the motion status

and the discharging energy, as described in Ortega-Vazquez (2014). Finally,

constraints (A.9) deÔ¨Åne the non-negativity character of the variable sv,t.

References

Amini, M. H., Kargarian, A., & Karabasoglu, O. (2016). ARIMA-based decou-

pled time series forecasting of electric vehicle charging demand for stochastic

power system operation. Electric Power Systems Research, 140 , 378‚Äì390.

Arias, M. B., & Bae, S. (2016). Electric vehicle charging demand forecasting

model based on big data technologies. Applied energy, 183 , 327‚Äì339.

Aswani, A., Shen, Z.-J., & Siddiq, A. (2018). Inverse optimization with noisy

data. Operations Research, 66 , 870‚Äì892.

Bandpey, M. F., & Firouzjah, K. G. (2018). Two-stage charging strategy of

plug-in electric vehicles based on fuzzy control. Computers & Operations

Research, 96 , 236‚Äì243.

28

Ben¬¥ƒ±tez-PeÀúna, S., Blanquero, R., Carrizosa, E., & Ram¬¥ƒ±rez-Cobo, P. (2019).

Cost-sensitive feature selection for support vector machines. Computers &

Operations Research, 106 , 169‚Äì178.

Bertsimas, D., Gupta, V., & Paschalidis, I. C. (2015). Data-driven estimation

in equilibrium using inverse optimization. Math. Progr., 153 , 595‚Äì633.

Bunsen, T., Cazzola, P., Gorner, M., Paoli, L., ScheÔ¨Äer, S., Schuitmaker, R.,

Tattini, J., & Teter, J. (2018). Global EV Outlook 2018: Towards cross-modal

electriÔ¨Åcation. Technical Report ‚Äì International Energy Agency.

Chan, T. C., & Kaw, N. (2019). Inverse optimization for the recovery of con-

straint parameters. European Journal of Operational Research, .

CPLEX (2019). IBM ILOG CPLEX Optimisation Studio. [Online]. Available:

https://www.ibm.com/analytics/cplex-optimizer.

Dudek, G. (2018). Probabilistic forecasting of electricity prices using kernel

regression. In 2018 15th International Conference on the European Energy

Market (EEM) (pp. 1‚Äì5).

ENTSO-e (2019).

European Network of Transmission System Operators

(ENTSO-e). [Online]. Available: https://www.entsoe.eu/.

Esfahani, P. M., ShaÔ¨Åeezadeh-Abadeh, S., Hanasusanto, G. A., & Kuhn, D.

(2018). Data-driven inverse optimization with imperfect information. Math.

Progr., 167 , 191‚Äì234.

European Commission

(2011).

White Paper:

Roadmap

to

a

Single

European Transport Area

‚Äì Towards

a

competi-

tive

and

resource

eÔ¨Écient

transport

system COM(2011)

144

Ô¨Ånal.

[Online].

Available:

https://eur-lex.europa.eu/legal-

content/EN/TXT/PDF/?uri=CELEX:52011DC0144&from=EN.

Hart, W. E., Watson, J. P., & WoodruÔ¨Ä, D. L. (2011). Pyomo: Modeling

and solving mathematical programs in Python. Mathematical Programming

Computation, 3 , 219‚Äì260. doi:10.1007/s12532-011-0026-8.

29

Hofmann, T., Sch¬®olkopf, B., & Smola, A. J. (2008). Kernel methods in machine

learning. The annals of statistics, (pp. 1171‚Äì1220).

Kekatos, V., Veeramachaneni, S., Light, M., & Giannakis, G. B. (2013). Day-

ahead electricity market forecasting using kernels. In 2013 IEEE PES Inno-

vative Smart Grid Technologies Conf. (ISGT) (pp. 1‚Äì5).

Kekatos, V., Zhang, Y., & Giannakis, G. B. (2014). Electricity market forecast-

ing via low-rank multi-kernel learning. IEEE Journal of Selected Topics in

Signal Processing, 8 , 1182‚Äì1193.

Kempton, W., & Tomi¬¥c, J. (2005). Vehicle-to-grid power fundamentals: Calcu-

lating capacity and net revenue. Journal of power sources, 144 , 268‚Äì279.

Korolko, N., Sahinoglu, Z., & Nikovski, D. (2015). Modeling and forecasting

self-similar power load due to EV fast chargers. IEEE Transactions on Smart

Grid , 7 , 1620‚Äì1629.

Lu, T., Wang, Z., Wang, J., Ai, Q., & Wang, C. (2018). A data-driven stack-

elberg market strategy for demand response-enabled distribution systems.

IEEE Transactions on Smart Grid , 10 , 2345‚Äì2357.

Majidpour, M., Qiu, C., Chu, P., Pota, H. R., & Gadh, R. (2016). Forecasting

the EV charging load based on customer proÔ¨Åle or station measurement?

Applied energy, 163 , 134‚Äì141.

NHTS (2019). National Household Travel Survey (NHTS) data. [Online]. Avail-

able: https://nhts.ornl.gov/.

OMIE (2019).

Spanish Market Operator.

[Online]. Available:

http://www.omie.es/.

Ortega-Vazquez, M. A. (2014). Optimal scheduling of electric vehicle charg-

ing and vehicle-to-grid services at household level including battery degrada-

tion and price uncertainty. IET Generation, Transmission & Distribution, 8 ,

1007‚Äì1016.

30

Pedregosa, F., Varoquaux, G., Gramfort, A., Michel, V., Thirion, B., Grisel, O.,

Blondel, M., Prettenhofer, P., Weiss, R., Dubourg, V., Vanderplas, J., Passos,

A., Cournapeau, D., Brucher, M., Perrot, M., & Duchesnay, E. (2011). Scikit-

learn: Machine learning in Python. Journal of Machine Learning Research,

12 , 2825‚Äì2830.

Renault

(2019).

Data Sheet Renault ZE ZOE.

[Online]. Available:

http://electromovilidad.net/renault/Ô¨Åcha-tecnica-renault-zoe/.

Roland, J., Figueira, J. R., & De Smet, Y. (2016). Finding compromise solutions

in project portfolio selection with multiple experts by inverse optimization.

Computers & Operations Research, 66 , 12‚Äì19.

Ruiz, C., Conejo, A. J., & Bertsimas, D. J. (2013). Revealing rival marginal

oÔ¨Äer prices via inverse optimization. IEEE Transactions on Power Systems,

28 , 3056‚Äì3064.

Saez-Gallego, J., & Morales, J. M. (2017). Short-term forecasting of price-

responsive loads using inverse optimization.

IEEE Transactions on Smart

Grid , 9 , 4805‚Äì4814.

Saez-Gallego, J., Morales, J. M., Zugno, M., & Madsen, H. (2016). A data-driven

bidding model for a cluster of price-responsive consumers of electricity. IEEE

Transactions on Power Systems, 31 , 5001‚Äì5011.

Sarker, M. R., Ortega-Vazquez, M., Kirschen, D., & Zhang, B. (2016). Electric

Vehicles as Grid Resources. Ph.D. thesis University of Washington Libraries.

Shahidehpour, M., Yamin, H., & Li, Z. (2003). Market operations in electric

power systems: forecasting, scheduling, and risk management. John Wiley &

Sons.

Smola, A. J., & Sch¬®olkopf, B. (2004). A tutorial on support vector regression.

Statistics and computing, 14 , 199‚Äì222.

31

Sun, B., Sun, X., Tsang, D. H., & Whitt, W. (2019). Optimal battery purchasing

and charging strategy at electric vehicle battery swap stations. European

Journal of Operational Research, 279 , 524‚Äì539.

Sun, Q., Liu, J., Rong, X., Zhang, M., Song, X., Bie, Z., & Ni, Z. (2016).

Charging load forecasting of electric vehicle charging station based on support

vector regression. In 2016 IEEE PES Asia-PaciÔ¨Åc Power and Energy Eng.

Conf. (APPEEC) (pp. 1777‚Äì1781).

Trevor, H., Robert, T., & JH, F. (2009). The elements of statistical learning:

data mining, inference, and prediction.

Xydas, E., Marmaras, C., Cipcigan, L. M., Hassan, A., & Jenkins, N.

(2013). Forecasting electric vehicle charging demand using support vector

machines. In 2013 48th International Universities‚Äô Power Engineering Con-

ference (UPEC) (pp. 1‚Äì6).

Yang, J., & Sun, H. (2015). Battery swap station location-routing problem with

capacitated electric vehicles. Computers & Operations Research, 55 , 217‚Äì232.

Zhang, J., & Xu, C. (2010). Inverse optimization for linearly constrained convex

separable programming problems. European Journal of Operational Research,

200 , 671‚Äì679.

Zhou, Y., Wang, L., & McCalley, J. D. (2010). EÔ¨Äective incentives design for

renewable energy generation expansion planning: An inverse optimization

approach. In IEEE PES General Meeting (pp. 1‚Äì7).

32

