ImprovedDescriptionofAtomicEnvironmentsusingLow-costPolynomialFunctionswithCompactSupportMartinP.Bircher,1AndreasSingraber,2,1andChristophDellago1,a)1)FacultyofPhysicsUniversityofViennaBoltzmanngasse5A-1090Wien,Austria2)InstituteforTheoreticalPhysicsTUWien-ViennaUniversityofTechnologyWiednerHauptstraße8-10A-1040Wien,AustriaThepredictionofchemicalpropertiesusingMachineLearning(ML)techniquescallsforasetofappropriatedescriptorsthataccuratelydescribeatomicand,onalargerscale,molecularenvironments.Amappingofconformationalinformationonaspacespannedbyatom-centredsymmetryfunctions(SF)hasbecomeastan-dardtechniqueforenergyandforcepredictionsusinghigh-dimensionalneuralnetworkpotentials(HDNNP).AnappropriatechoiceofSFsisparticularlycrucialforaccurateforcepredictions.Establishedatom-centredSFs,however,arelimitedintheirﬂexibility,sincetheirfunctionalformrestrictstheangulardomainthatcanbesampledwithoutintroducingproblematicderivativediscontinuities.Here,weintroduceaclassofatom-centredsymmetryfunctionsbasedonpolynomialswithcompactsupportcalledpolynomialsymme-tryfunctions(PSF),whichenableafreechoiceofboth,theangularandtheradialdomaincovered.WedemonstratethattheaccuracyofPSFsiseitheronparorconsiderablybetterthanthatofconventional,atom-centredsymmetryfunctions.Inparticular,agenericsetofPSFswithanintuitivechoiceoftheangulardomaininspiredbyorganicchemistryconsiderablyimprovespredictionaccuracyfororganicmoleculesinthegaseousandliquidphase,withreductionsinforcepredictionerrorsoveratestsetapproaching50%forcertainsystems.Contrarytoestablishedatom-centredSFs,computationofPSFdoesnotinvolveanyexponentials,andtheirintrinsiccompactsupportsupersedesuseofseparatecutoﬀfunctions,facilitatingthechoiceoftheirfreeparameters.Mostimportantly,thenumberofﬂoatingpointoperationsrequiredtocomputepolynomialSFsintroducedhereisconsiderablylowerthanthatofotherstate-of-the-artSFs,enablingtheireﬃcientim-plementationwithouttheneedofhighlyoptimisedcodestructuresorcaching,withspeedupswithrespecttootherstate-of-the-artSFsreachingafactorof4.5to5.Thislow-eﬀortperformancebeneﬁtsubstantiallysim-pliﬁestheiruseinnewprogramsandemergingplatformssuchasgraphicalprocessingunits(GPU).Overall,polynomialSFswithcompactsupportimproveaccuracyofboth,energyandforcepredictionswithHDNNPswhileenablingsigniﬁcantspeedupswithrespecttotheirwell-establishedcounterparts.I.INTRODUCTIONInthepastdecade,computationalchemistryhasseenatremendousincreaseinuseofmachinelearning(ML)techniquestoovercomethelength-andtimescaleprob-lemburdeningﬁrstprinciplesmethods1–4.Assuch,MLtechniqueshaveseenparticularlybeneﬁcialuseinMolec-ularDynamics(MD)simulationsinthecondensedphase.Byprovidinghighlyelaborateﬁttingmechanisms,MLallowsforaccurateinterpolationbetweentrainingpointsonthepotentialenergysurface(PES)generatedfromacomputationallymoreexpensivereferencemethod.Thisenables,e.g.,MDsimulationsofwatertobeperformedatthenano-ratherthanthepicosecondscalewithforcesandenergiesofﬁrstprinciplesaccuracy5,6.Whilestillmoreexpensivethanclassicalforceﬁelds,MLtechniquescanincorporateinformationfromtheunderlyingPESwelloutsideoflocalminima,makingthesimulationofchemicalreactionspossible.Incontrasttoreactiveforce-a)Electronicmail:christoph.dellago@univie.ac.atﬁelds,noassumptionsonthefunctionalformofthein-teractionsandtherefore,theunderlyingPES,havetobemade7,8.Instead,theﬁtiscarriedoutmostlyinablack-boxmanner,withoneofthemostprominentad-justableinputparametersbeingasetoffunctionsthatuniquelydescribetheenvironmentofeveryatominamannerthatisinvariantbothtopermutation,rotationandtranslation4,9,10.Machinelearningtechniquescommonlyusedtointer-polatebetweenﬁrstprinciplesdataincludekernel-basedmethods11–14andneuralnetworkpotentials(NNP)15,16.AprominentframeworkofthelatterisduetoBehlerandParrinello17,18,whoadvocatedtheuseofhigh-dimensionalneuralnetworkpotentials(HDNNP)incom-binationwithatom-centredinputfunctions.Inthecon-textofHDNNPs,thesefunctionsarecommonlyreferredtoassymmetryfunctions(SF)19.Ideally,thesefunctionsprovideauniquedescriptionoftheatomicenvironmentofeverystructureinthetrainingset.Severalfunctionalformshavebeenproposed20,21,whichcommonlyincludearadialandangularpartmultipliedbyacutoﬀfunctionthatensuresthattheformerarenaughtoutsideofprede-ﬁnedbounds.SFsarethereforecommonlyaproductofarXiv:2010.14414v3  [physics.chem-ph]  1 Feb 20212uptothreediﬀerenttypesoffunctions,andparametris-ingthemproperlyforagivenchemicalsystemcanbe-comenon-trivial.AnintuitiveconstructionofSFscanbebasedonstructuralfeaturesofthesystemathand.Forinstance,suﬃcientspatialresolutioncouldbeobtainedbytakingintoaccountallrelevantpeaksintheradialdistributionfunctionofthesystemandbycoveringallchemicallyrelevantanglesspannedbyanatomandtwoofitsneighbours.Thewidthandcentreofasymmetryfunctionshouldthenreﬂectﬂuctuationsofthequantityitdescribesinthetrainingdata.Suchastrategyhassuccessfullybeenused,e.g.fortheconstructionofaneuralnetworkofwaterandice,includingdiﬀerenticephases5,22,23.However,whereassuchanon-automatedapproachcanyieldsymmetryfunctionsetsmuchsmallerthanthosegeneratedusingautomatedprocedures21,24,therearesomepitfallsassociatedtoanintuitiveapproach:Whilethepositionofthemaximaofradialfunctionscangen-erallybefreelychosenwithinthecutoﬀradius,thisisnotnecessarilythecaseforangularterms,whicharecommonlybasedonacosineandwhicharethereforere-strictedtopeakateither0orπ.Introducingasimplephaseshiftinthecosinehasbeenshowntoworkwellforenergyevaluations25,butitwouldbeboundtofailforforcepredictions,sinceanyshiftinacosinewillin-evitablyintroducederivativediscontinuitiesat0andπ:Theevaluationofanglesisrestrictedtoadomainof[0,π],imposingsymmetriesintheangularfunctionsoftheformf(ϑ)=f(−ϑ)andf(π+ϑ)=f(π−ϑ).Phaseshiftsbreakthissymmetryandintroducenon-zeroderivativesatf(0)andf(π).Sincederivativesoftheangularfunc-tionsareusedtocomputeforces(videinfra),thisresultsinnon-uniquedescriptionsatϑ=0andϑ=π.Inordertoaccountforequilibriumanglesthatarenotcentredoneitherpeakandwhichonlyﬂuctuateoverafewdegress–suchasadoublebond–onethereforeuseslinearcombinationsofangularsymmetryfunctionswhicharecentredoneither0orπ,increasingtheoverallnum-berofSFsused.ThepresenceofcutoﬀfunctionsalsoobfuscatesthechoiceofinputSFparameters:IftheSFareconstructedfromstucturalpropertiessuchasthera-dialdistributionfunctionofaliquid,thepositionoftheradialpeaksisnoteasilydeducedfromtheinputparam-eters,sincetheproductofradialtermandcutoﬀfunctionmayexhibitashiftedmaximumandamorerapiddecaywithrespecttotheGaussianfunctionalone.Inparticu-lar,iftheGaussianisnotcentredontheorigin,thismayleadtoasymmetryfunctionthatisnotsymmetricwithrespecttoitspeak.Therefore,itisusuallynecessarytoploteverysinglesymmetryfunctioninordertomonitorthecorrespondencebetweentheinputparametersandtheﬁnalsystemsetup.Hence,parametrisingsymmetryfunctionsbasedonstructuralpropertiescanbeacum-bersomeprocedure.Whileuniversalrulestogeneratein-putSFshavebeenproposed21,24,theyoftenincreasethenumberofSFneededwithrespecttoanoptimal,tailoredsetofparameters.Thiscanhamperperformance.Whenusinghigh-qualityﬁrstprinciplesmethodstogeneratethetrainingset,theﬁrstprinciplecalculationsusuallyrepresentthecomputationalbottleneck.How-ever,boththetrainingoftheneuralnetworkitselfaswellasitsuseinproductivecalculationscarryacertainover-headthatistypicallylargerthanthatofclassicalforceﬁelds.Thecomputationalcostofthetrainingisinpartassociatedtothenumberofsymmetryfunctionsused,aswellastheircomputationalcomplexity.Whileitispos-sibletostorethevaluesofallsymmetryfunctionsduringtraining26,makingtheircalculationnecessaryonlyonceattheverybeginningofthetrainingprocedure,thisisevidentlyimpossiblewhentheneuralnetworkpotentialisusedtopredictunknownstructurese.g.duringaMDrun.Factorsthatcontributetotheoverheadofsym-metryfunctionevaluationaretwo-fold:Themostpop-ularchoicefortheradialtermareGaussianfunctions.However,exponentialsarecomparablyexpensivetocom-pute.Furthermore,thecalculationofacutoﬀfunction(oftencosinesorhyperbolictangents)introducesanad-ditionaloverheadwithrespecttobareradialfunctions.Tothisend,optimisedcutoﬀfunctionsbasedonpoly-nomialshavealreadybeenproposed.Still,thedisad-vantagesoftheevaluationofexponentialsfortheradialterms,theirpossiblybecomingasymmetricduetomulti-plicationwithacutoﬀfunctionandtheimpracticabilityofintroducingphaseshiftsintheangularcomponentsremain.Whilestrategiestoreducethelargenumberofﬂoatingpointoperationsduringsymmetryfunctionevaluationhavebeendeveloped,e.g.bygroupingandcaching26,27,thisinvolvesintermediatestorageofquan-tities,loopbreaksandmanyif-statements,renderingtheirimplementationcumbersome,reducingcoderead-abilityandmakingperformancebeneﬁtsbothproblem-andarchitecturedependent.ItwouldthereforebedesirabletohaveaframeworkathandwherethenumberofﬂoatingpointoperationsinSFevaluationsissubstantiallyreduced,wheretheSFremainsymmetricwithrespecttotheirmaxima,wherethein-putparametersdirectlyreﬂecttheshapeoftheresultingfunction,andwherethemaximumoftheangularcompo-nentcanbeadjustedtoreﬂectequilibriumangles.Thiswouldalleviatetheneedtoploteverysymmetryfunc-tionduringconstruction,makingtheresultingproceduremoreeﬀecientandlesserror-prone,greatlysimplifyingthechoiceofparametersbasedonstructuralpropertiesofthesystemathand.Mostimportantly,areductionofﬂoatingpointoperationssupersedestheneedofcomplexcodeoptimisationandrenderstheeﬃcientimplementa-tionofsymmetryfunctionsarchitecture-independent.Inthefollowing,wewilldemonstratethatfurthersim-pliﬁcationstoexistingsymmetryfunctionsarepossiblebyreplacingtheproduct-basedansatzofradial,angu-larandcutoﬀfunctionbyaproductofpolynomialswithcompactsupport,makingtheuseofcutoﬀfunctionsob-solete.Suchpolynomialsymmetryfunctionshavetheadvantageofallowingforangulartermstobecentredanywherewithinϑ∈[0,π]withoutintroducingderiva-3tivediscontinuitiesatϑ=0andϑ=π.Thelatterisofparticularimportanceforforceevaluations,asdiscon-tinutitiesinsymmetryfunctionderivativeswilldirectlyimpacttheforcescomputed.Theevaluationofthesepolynomialsymmetryfunctionsdoesnotinvolveexpo-nentiation.Instead,themostdemandinglow-leveloper-ationbecomesthecalculationofanarccosinewhencom-putingangularterms.Theuseofonesimplefunctionalformforbothangularandradialtermsconsiderablyre-ducesthenumberofﬂoatingpointoperationsassociatedtotheevaluationofasingleSF.Thisdoesnotonlyre-sultinsigniﬁcantsimpliﬁcationsintheunderlyingcode,butcomesatthebeneﬁtofspeedupsofuptoafactorofabout4.5to5,whiletheirperformancewithrespecttohighlyoptimisedcacheandgroupingbasedSFimple-mentationsstillreachesafactorofalmost2withouttheneedoffurtheralgorithmicoptimisations.Thistextisorganisedasfollows:First,webrieﬂyin-troducetheconceptofHDNNPsanddescribethemathe-maticalformofcommonlyusedsymmetryfunctionsﬁrstproposedbyBehlerandParrinello4,17.Wethenintro-duceournewpolynomialsymmetryfunctions(PSF).Wewillgoontodemonstratethatuseofpolynomialsymme-tryfunctionscanimproveaccuracyofneuralnetworkpo-tentialswhencomparedtoconventionalsymmetryfunc-tions.Tothisend,bothdynamicandstaticpropertieswillbecomparedforawaterandcoppersulﬁdemodelsystem.BytrainingaHDNNPfortherotationoftheaminogroupoftheorganicdyeDMABN28,29,wewillshowthattheangularﬂexibilityofpolynomialsymme-tryfunctionssimpliﬁesthechoiceofangularparameterscomparedtoBehler-Parrinellotypesymmetryfunctions(BPSF).HDNNPsforliquidethylbenzeneandanisolethatweretrainedusingbothPSFandPBSFwillfurthersupportthisperspective.Finally,wewillshowthatuseofPSFinconjunctionwithrecentlyproposedweightedatom-centredsymmetryfunctions(wACSF)21canfur-therimproveperformanceofHDNNPsforpredictingen-thalpiesofformationoftheQM930database.WewillconcludethediscussionbycomparingexecutiontimesfortheevaluationoftheNNPsbetweenBPSFsandPSFs,showingthattheexecutiontimepersymmetryfunctionissubstantiallyreducedforourpolynomialansatz.II.SYMMETRYFUNCTIONSFORHIGH-DIMENSIONALNEURALNETWORKPOTENTIALSA.NeuralNetworksinaNutshellFirstapplicationsofneuralnetworkpotentialsincom-putationalchemistrydatebackasfaras199515.Aconsiderableadvanceinthepredictionofmolecularforcesandenergieswasmadein2007,whenBehlerandParrinello17proposedtousehigh-dimensionalneuralnet-workpotentials(HDNNP)incombinationwithaﬁcti-ciousdecompositionofthepotentialenergyVfromNindividualatoms:V=NXiVi(Gi)(1)TheatomiccontributionVidependsonthechemicalen-vironmentofatomi,whichisdescribedbyatupleofNjinputvaluesGi={G1,...,Gj}.Theforcesonthekthatomfollowfromthegradient:−∇kV=−NXiNjXj∂Vi∂Gi,j∇kGi,j(2)TheGiareusedastheinputlayerofafeed-forwardneuralnetwork(Fig.1)thatyieldsthescalarVi.Thenetworkitselfisconstitutedbymultiplelayersofnodes,whichareconnectedtoeachotherbyvirtueofweightsanm.Startingfromasetofinputvalues(Gi),thedataispropagatedtonodenofhiddenlayerkasfollows:ykn=fa bkn+MlXmalknmylm!,(3)wherel=k−1,yknrepresentsthevalueofthenodeandfaisanon-linearactivationfunction.bkndenotesthebiasassociatedtoyknandMlisthenumberofneuronsinlayerl.Oneindependentneuralnetworkperelementisused.Togetherwiththebiasesbkn,theweightsanmaretheﬁttingparametersoftheHDNNP.TheatomicenvironmentdescriptorsGiarecommonlycalledsymmetryfunctions(SF).Inordertoensureper-mutationalsymmetry,thesymmetryfunctionsareiden-ticalforallatomsofthesameelement.However,inor-dertoaccountforvaryingchemicalenvironments(bondlengths,van-der-Waalsradii,relevantbondangles),theycandiﬀerbetweendiﬀerentelements.Anappropriatechoiceofsymmetryfunctionsiscrucialinordertoreli-ablydiscriminatebetweenuniquepointsonthePES.B.Behler-ParrinelloSymmetryFunctionsInthecaseofBehler-ParrinelloHDNNPs,theinputlayerconsistsofscalarsobtainedfromapredeterminedsetofatom-centredsymmetryfunctions.Thechoiceofsymmetryfunctionsshoulddiscriminatebetweenallrel-evantstructuralfeatures,suchthateverydistinctpointonthepotentialenergysurfaceisdescribedbyauniquetupleofsymmetryfunctionvalues.Inpractice,thisisachievedbycombiningasetofsphericallysymmetricandangle-dependentfunctionsthathavetobeparametrisedappropriately.SomeexamplesaregiveninFig.2.Fortheradialpart,BehlerandParrinellosuggested:fradB(r,rs)=e−η(r−rs)2,(4)whererisaninteratomicdistanceandrsitsreferencepoint.Anangulardependencycanbyintroducedbya4bknGNiG2iG1iy11y1nyk1yknViFIG.1.SchematicrepresentationofaBehler-ParrinelloHDNNPforagivenelementi.ThreesymmetryfunctionsGiareusedasinput,andtheatomiccontributiontotheto-talpotentialenergyViispredicted.LabelscorrespondtoEq.3.functionoftheform:fangB(ϑ,λ,ζ)=(1+λcos(ϑ))ζ,(5)whereϑistheangleformedbyanythreeatoms,boundby[0,π].Thisfunctionappropriatelyhas∂fangB/∂ϑ|ϑ=0=∂fangB/∂ϑ|ϑ=π=0.Forλ=1,maximumandminimumofthefunctionlieat0andπ,respectively;forλ=−1,theinverseholds.Chosingζ>1allowstocontractthefunction,resultinginamorerapiddecay.Valuesofζ<1arenotpossible,sincethiswouldresultinnon-zeroderivativesattheboundaries.WhiletheformoffangB(ϑ,λ,ζ)guaranteeszeroderiva-tivesattheboundariesforappropriatechoicesofλandζ,theexponentialinfradB(r,rc)isﬁniteeverywhere.There-fore,acutoﬀfunctionwithcutoﬀradiusrcisintroduced,whichensuresthattheradialtermanditsderivativesarezeroforallr>rc.Commonchoicesofcutoﬀfunctionfc(r,rc)includefc(r,rc)=(12hcos(cid:16)πrrc(cid:17)+1iforr≤rc0forr>rc(6)orfc(r,rc)=(tanh3(cid:16)1−rrc(cid:17)forr≤rc0forr>rc(7)Withthischoiceoffunctions,theradialsymmetryfunctionGicentredonanatomiisgivenbyasumoverallitsneighboursjthatarewithinarcofi:Gradi(rc,rs)=Xj6=ifradB(rij,rs)fc(rij,rc).(8)Notethatsuchaproductmayhaveawidthandamax-imumdiﬀerentfromfradBalone,seealsoFig.2.Thean-gularsymmetryfunctionisconstructedfromaproductofangularandradialterms,withthesumencompassingallneighboursjandk6=j.Dependingontheradialterm,twotypesofangularsymmetryfunctionscanbedistinguished,namelynarrown,Gang.ni(rc,rs,λ,ζ)=2(1−ζ)Xj6=i,k>jfradB(rij,rs)fradB(rik,rs)fradB(rjk,rs)fangB(ϑijk,λ,ζ)fc(rij,rc)fc(rik,rc)fc(rjk,rc),(9)whichalsoconstrainstheinteratomicdistancebetweenatomsjandk,andthewideformw:Gang.wi(rc,rs,λ,ζ)=2(1−ζ)Xj6=i,k>jfradB(rij,rs)fradB(rik,rs)fangB(ϑijk,λ,ζ)fc(rij,rc)fc(rik,rc),(10)theevaluationofwhichismorecomputationallyexpedi-entduetothelackofaradialtermforjk.Thesesym-metryfunctionshavesuccessfullybeenappliedinawidevarietyofcontexts.Notethatthedistributionofsym-metryfunctionvaluesatλ=−1isnotsymmetricwithrespecttoλ=1duethepresenceofaradialfunction21.Fig.3displaysthedependencyofBPSFsonthepositionofatomicneighbour(s).Recently,Singraberetal.haveintroducedasimpleex-pressionforfcbasedonpolynomials27:fpolyc(r,rc)=(fpoly2(cid:16)rrc(cid:17)for0≤r≤rc0forr>rc(11)withthepolynomial:fpoly2(x)=x3(x(15−6x)−10)+1(12)withfpoly2(0)=1andfpoly2(1)=0.Atx=0andx=1,Eq.12hascontinuousderivativesuptosecond500.20.40.60.81051015fradBr[a.u.]1η=40,x0=01η=10,x0=4.000.20.40.60.81051015fr[a.u.]fradBfcfradB00.511.520123fangBθ[rad]λ=−1,ζ=1λ=1,ζ=4FIG.2.Radial(left),angular(middle)andcutoﬀ(right)functionsproposedbyBehler.Left:Duetotherepulsiveexchangewall,regionsaroundr=0areneversampled,andtheradialfunctionthereforeneednotbe0atr=0.Middle:Asimplecutoﬀfunctionwithcontinuousderivativesat0andrcismultipliedwiththeradialtermtoobtainafunctionwithcompactsupport.NotethatthismultiplicationshiftsthemaximaofGaussiansthatarenotcentredonr0=0.Right:Minimumandmaximumofthecosineareswappedforλ=−1.Specifyingζ>1contractsthefunctiontowardsitsmaximum.1η=4000,rs=01η=20,rs=41η=8,rs=81η=12,rs=01η=10,rs=01η=40,rs=000.20.40.60.8100.20.40.60.8100.20.40.60.800.40.81.21.62λ=1,ζ=1012345678λ=−1,ζ=3010203040506070λ=−1,ζ=6FIG.3.Radial(upperrows)andangular(lowerrows)symmetryfunctionsoftheBehler-Parrinellotype.Thereferenceatomiispositionedattheorigin.Forradialfunctions,theplotshowsthedependencyoffradBonthepositionofneighbourj.Forangularfunctions,itisassumedthatoneneighbouringatomjhasaﬁxedpositionatx=0,y=1,withtheplotshowingthedependencyoffangBonthepositionofthesecondneighbourk.order,whichensuresacontinuous,smoothtransitiontooutsideofthecompactset.Similarpolynomialswithcon-tinuousderivativesuptoevenhigherordercanbeeasilyconstructed27,buttheirusedoesnotresultinanyprac-ticalbeneﬁt18.ThemainadvantageofpolynomialcutoﬀfunctionsasintroducedinRef.27liesintheirexpedientevaluationcomparedtoexpressionsbasedonhyperbolictangentorcosine,reducingtheoverheadduetothecutoﬀfunction.However,thecomputationofcostlyexponen-tialsisstillneededforallradialcomponents.Hence,agroupingstrategywasproposedinRef.27whichavoidsmultipleevaluationsofthesameexponentialterm,re-sultinginconsiderablespeedups.C.PolynomialSymmetryFunctionswithCompactSupportOnonehand,thesummationovertheargumentsofGangstillinvolvesasubstantialnumberofexponentialfunctionsthathavetobeexplicitlyevaluatedevenwhenagroupingstrategyisused.Ontheotherhand,thepresentchoiceoffangimpliesthat,inordertospeciﬁcallysampleangleswhicharenotcentredclosetoeither0orπ,acombinationofseveralvaluesofλandζisnecessary,sinceintroducinganangularshiftϑ0wouldinevitablyviolatetheboundarycondition∂fang/∂ϑ=0attheboundsoftheangulardomain.Inthefollowing,wewillattempt600.20.40.60.81051015fradPSFr[a.u.]rs=0,∆r=14rs=4,∆r=600.20.40.60.81051015fradPASr[a.u.]rs=0,∆r=14rs=4,∆r=600.510123fangPSFθ[rad]ϑ0=π,∆ϑ=πϑ0=π/3,∆ϑ=π/6FIG.4.RadialPSF(left),radialPAS(middle)andangular(right)SFswithcompactsupportproposedhere.Left:Radialfunctionwithpoint-symmetryaround0.5rmax.Notethatnocutoﬀfunctionisneeded,whichenablesaprecisechoiceofmaximaandshifts.Middle:Asymmetryicradialfunctionwithlongertail,withashapecomparabletotheproductofaGaussianandacutoﬀfunctioninFig.2.Right:AngularpolynomialSF.Notethattheangulardomaincanbefreelychosenanddoesnotneedtohavemaximaat0orπ.toovercomethisissuebyconstructingasimplesetofsymmetryfunctionsbasedonpolynomialswithcompactsupportwhichcanbeusedtoindiscriminatelydescribebothanglularandradialdependencies.Inordertodoso,wegeneraliseEq.11toagenericform,expressedintermsoftheboundariesxmin,xmaxoftheunderlyingdomain.Inparticular,forourpolynomialsymmetryfunctionsfPSF,wealsoallowforargumentsx<0:fPSF(x,x0,∆x)=fpoly2(cid:0)x−x0∆x(cid:1)forx0≤x≤x0+∆xfpoly2(cid:0)x0−x∆x(cid:1)forx0−∆x≤x<x00elsewhere(13)wherex0=12(xmax+xmin)and∆x=12(xmax−xmin).Theresultingfunctionissymmetricwithrespecttox0andhascontinuousderivatives–uptoanorderdeterminedbytheconstructionoffpoly2–onallR3.Itispossibletofurtherinﬂuencethedecayoftheradialfunctionbyappropriatelymodifyingitsargumentsuchthatthesymmetryfunctiondecaysmorerapidlyarounditsmaximumwhilealsoapproaching0moreslowly,thusbreakingthepointsymmetryaroundfPSF(0.5).Wethereforedeﬁnetheasymmetricpolynomialsymmetryfunction(PAS)as:fPAS(x,x0,∆x)=fpoly2(cid:16)2(x−x0)∆x−(cid:0)x−x0∆x(cid:1)2(cid:17)forx0≤x≤x0+∆xfpoly2(cid:16)2(x0−x)∆x−(cid:0)x0−x∆x(cid:1)2(cid:17)forx0−∆x≤x<x00elsewhere(14)whichoﬀersthesamebeneﬁtsasfPSFforx∈[0,1].Byconstruction,fPASresemblestheshapeoftheproductofalocal,narrowGaussianfunctionwithacutoﬀfunctionandcanthereforebeusedtoadaptexistingBPSF-setupstopolynomialform.ThefunctionalformsoffPASandfPSFaredepictedinFig.4.Thecorrespondingradialsymmetryfunctionscannowbeconstructedas:Grad/Pi=Xj6=ifP(rij,rs,∆r).(15)withfPeitherfPSForfPAS.Theirnarrowangularcounterpartsread:Gang.n/Pi=Xj6=i,k>jfP(rij,rs,∆r)fP(rik,rs,∆r)fP(rjk,rs,∆r)fPSF(ϑijk,ϑ0,∆ϑ)(16)whilethewideangularfunctionsbecome:Gang.w/Pi=Xj6=i,k>jfP(rij,rs,∆r)fP(rik,rs,∆r)fPSF(ϑijk,ϑ0,∆ϑ)(17)7∆r=12,rs=0∆r=6,rs=4∆r=4,rs=8∆r=12,rs=0∆ϑ=90◦,ϑ0=0◦∆r=10,rs=0∆ϑ=40◦,ϑ0=120◦∆r=8,rs=0∆ϑ=20◦,ϑ0=109.1◦00.20.40.60.8100.20.40.60.8100.20.40.60.8100.20.40.60.8100.20.40.60.8100.20.40.60.81FIG.5.Radial(upperrows)andangular(lowerrows)symmetryfunctionsofthePAStype.Thereferenceatomiispositionedattheorigin.Forradialfunctions,theplotshowsthedependencyoffradBonthepositionofneighbourj.Forangularfunctions,itisassumedthatoneneighbouringatomjhasaﬁxedpositionatx=0,y=1,withtheplotshowingthedependencyoffangBonthepositionofthesecondneighbourk.NotethatwithPSFandPASitbecomespossibletocoverspeciﬁcangularrangesassociated,e.g.todoublebonds(60◦angle,lowermiddle)ortetrahedra(109.1◦,lowerright).wheretheradialcomponentfPcanagainbedescribedbybothfPAForfPSF.Bothtypesofangularsymmetryfunctioncanbecentredanywherewithin[0,π],providedthat∂fPSF/∂δ|ϑ=0=0and∂fPSF/∂δ|ϑ=π=0.Thisen-ableschemicallyintuitivechoicesofangularmaxima,i.e.60◦foradoublebondor109,4◦foracarbon-carbonsin-glebond.Fig.5showsthedependencyofPAS-typesym-metryfunctionsonthepositionofatomicneighbour(s).Eqs13to14donotinvolveanyexponentials,andthemostexpensivearithmeticoperation,aninversecosine,hasamodestcomputationalfootprint.III.COMPUTATIONALMETHODSA.TrainingoftheHDNNPAllHDNNPsweretrainedusingthen2p2package26,27,31.HDNNPsforthepredictionofen-thalpiesofformationintheQM930databasewereobtainedusingtheprotocolofRef.21withﬁve-foldcrossvalidation,butwithoutdatasetnormalisation.Fortheremainingsetups,10trainingrunspersystemarecarriedoutwithanindependentseedfortherandomnumbergeneratoreach.IfthevalueGiofagivensymmetryfunctionneverexceeds10−3overthewholetestset,thefunctionisdiscardedbeforetraining.ThechoiceofGiisdetailedintheSupportingInformation.Resultsdiscussedinthistextrefertothebestsetofweightsoutof10independentruns(5fortheQM9set),whicharedeﬁnedastheweightsthatyieldthelowestforcerootmean-squaredeviation(RMSD)withrespecttoatestsetconstitutedby10%oftraining-setstructuresthatwererandomlyremovedbeforetraining.IfseveralsetsofweightsyieldforceRMSDsthatareidenticaltoafew%,thesetthatdisplaysthelowestrelativeerrorinenergypredictionsisused.B.TrainingSetsThesystemsinvestigatedherearedepictedinFig.6.Thetrainingsetsforwaterandcoppersulphidecor-respondtothosepublishedinRefs5and26,respec-tively.ForcesandenergiesforanisolatedDMABNmolecule,liquidethylbenzeneandanisole(16moleculesinaperiodicbox)wereobtainedfromhigh-temperatureCar-ParrinelloMolecularDynamicsrunsperformedwiththeCPMDcode32usingtheSCANexchange-correlationfunctional33.TheaminogroupofDMABNwasrotatedusingaslowlygrowingharmonicrestraint,givingrisetoasetofnon-equilibriumconformers.Detailsonthecom-putationalsetupcanbefoundintheSupportingInfor-mation.C.TestSetsTestsetsconsistsof10%randomlychosenconﬁgura-tionsthatareremovedfromthetrainingsetbeforetrain-ingandwhicharethenusedtovalidatethepredictivepoweroftheneuralnetworkpotential.8FIG.6.Systemsstudiedhere.Fromlefttoright:Water,Cu2S,DMABN,liquidethylbenzeneandanisole.0.00010.0010.010.10510152025RMSD(Firef,Finnp)[a.u.]epochBPSFPSFPAS00.050.10.150.201020304050P(∆F)[%]∆F[%]BPSFPSFPASFIG.7.ForcepredictionsonwatersetofRef.26.RefdenotesreferencesforcesandnnpthepredictionbytheHDNNP.Left:LogarithmiclearningcurveshowingthedecreaseoftheRMSDbetweenpredictedandreferenceforcesasafunctionoftrainingsteps(epochs).TherearenoappreciablediﬀerencesbetweenBPSF,PSFandPAS.AthinlinedenotesthetargetRMSDof50meV/Å.Right:DistributionP(∆F)ofrelativeforceerrors,(∆F=Fnnp−Fref)/FrefforBPSF,PSFandPAS.D.MolecularDynamicsusingNeuralNetworkPotentialsAllMDsimulationsusingHDNNPswerecarriedoutusingthen2p2-interface27,31totheLAMMPScode34,35.SystemsetupsaredetailedintheSupportingInforma-tion.IV.RESULTSANDDISCUSSIONA.WaterWeﬁrstassesstheaccuracythatcanbeattainedwithpolynomialSFsbycomparingtheeﬃciencyandaccuracyofbothtrainingandproductivesimulationsusingiden-ticallysetupHDNNPs.TwosetupsofpolynomialSFswillbeused:One,PSF,consistingentirelyofsymmet-ricfunctionsoftheform13,andonemixedsetup,PAS,includingbothsymmetricandasymmetricradialcompo-nents.WewillcompareagainstareferencesetupusingBPSFs,whichhassuccessfullybeenusedinRef.26todescribethePESofwaterandseveralicephases.PSFandPASwereconstructedbyplottingtheBPSFsandusingtheirpeaksandthefullwidthathalfmaximumasroughindicatorsforthepolynomialinput.Forsakeofsimplicity,theonlysymmetricradialterms(PSF-type)inthePASsetwerethosewithmaximumwidth;allotherswerechosentobeoftheantisymmetrictype.First,wecomparethelearningcurvesofbothmeth-odstoassesstheeﬃciencyofthetrainingprocedure.Here,wedeﬁnethelearningcurveastheRMSDbetweentrainedenergyandforcesandtheirreferenceasafunc-tionofthenumberoftrainingsteps(epochs).CurvesforBehler-ParrinellotypeandpolynomialSFsetupsareplottedinFig.7andarevirtuallyindistinguishable,sug-gestingthatbothtypesofsymmetryfunctionscanbetrainedwithequaleﬃciency.RMSDsatthelasttrainingsteparecomparablebetweendiﬀerentmethods,withthelargestremainingforcedeviationbeingobservedforthePSFsetup.Conversely,thelowestforceRMSDisob-servedforthePASsetup.BPSFsyieldatrainingerrorintermediatebetweenPASandPSFdata.Thesameconclusionholdswhenanalysingthedistri-butionofbothforceandenergyerrorswithinthetestset:ForceRMSDsare43.7meV/ÅforBPSFs,48.5meV/ÅforPSFand43.2meV/ÅforPAS,respectively.EnergyRMSDsrangefrom1.17meVfoBPSFsto0.95meVforPAS.Inpracticalapplications,thesevaluescouldbeconsideredidentical.InFig.7,wehistogramboththerelativeforceerrorforHDNNPstrainedwithBehler-ParrinellotypeandpolynomialSFs.Theresultingdistri-butionsforthetestsetcomparewellbetweenPSF,PASandBPSF:Allrelativeerrorsshowarapiddecay,indi-900.511.522.50246810g(r)r[Å]BPSFPSFPAS05001000150020002500300035004000050010001500MSD[Å2/ps2]t[ps]BPSFPSFPASFIG.8.PropertiesofwaterobtainedduringamoleculardynamicsrunwithHDNNPstrainedusingBPSF,PSFandPAS.Left:Oxygen-oxygenradialdistributionfunctiong(r)averagedovera2nsNVTtrajectory.g(r)obtainedusingdiﬀerentsymmetryfunctionspracticallyshownodiﬀerence.Right:Mean-squareddisplacementsanderrorsobtainedover2nsofMDintheNVEensemble.Errormarginsforalllinesoverlap,suggestingequivalencybetweenallsymmetryfunctionsinvestigatedhere.catinganexcellentqualityoftheﬁt.PASandBPSFshowverysimilarrelativeerrordistributions,whereasthedistributionofPSFskewsverylightlytowardstheright;however,wewillshowthatthisisofnopracticalrelevance.Fig.9showspredictedforcesagainsttheirref-erencevalues;ideally,allvaluesshouldlieonadiagonal.UseofPASandPSFimprovestheaccuracyofthemostextremeforcevaluesateitherendofthegraph,whichlieclosertothediagonalthanforBPSF.Thisindicatesthat,althoughforceRMSDsdiﬀeronlylittlebetweenthediﬀerentSFsetups,qualitativeimprovementstoconven-tionalBPSFsarepossiblebyuseofaPSForPASset.Fig.8providesapracticalcomparisonofthepredictive−0.5−0.2500.250.5−0.5−0.2500.250.500.02Finnp[a.u.]|Finnp−Firef|[a.u.]Firef[a.u.]BPSFPSFPASFIG.9.Predicted(nnp)vs.reference(ref)forcesasobtainedusingBPSF,PSFandPAS.Adeviationfromthediagonalin-dicatesanerrorintheforceprediction.PASandPSFfurtherimprovethedescriptionoftheforceslargestinmagnitude.Absolutedeviationsfromthediagonalareplottedinthetoppanel.powerofthediﬀerentnetworks.Boththeradialdistribu-tionfunction(leftpanel)aswellasthemeansquaredis-placementasafunctionoftime,fromwhichthediﬀusioncoeﬃcientcanbederived,(rightpanel)arepracticallyindistinguishablebetweenBPSF,PASandPSF.TheseresultsfurthersupportthatpolynomialSFsareaviablealternativetothecommonlyusedBehler-Parrinellotypefunctions.Theexcellentagreementbetweenradialdis-tributionfunctionsandmean-squareddisplacementsob-tainedfromMolecularDynamicssuggestthatthesmalldiﬀerencesinforceRMSDoverthetestsetdonoten-tailsigniﬁcantchangesinthequalityofthepredictionsmadebytheHDNNP.Notably,themean-squareddis-placements(MSD)forPSFandBPSFarevirtuallyiden-tical.B.CoppersulﬁdeAllsymmetryfunctionsetupsusedforwaterwerebasedontheoptimised,hand-selectedsetofRef.5.Suchaselectionbyhandmaynotalwaysbepossible.Inthefollowing,weshallfurthervalidatetheaccuracyofPSFandPASbycomparingtheirperformancetotheaccuracyofasemi-automaticallygeneratedsetofBPSFsforcop-persulﬁde.IthasbeenshowinRef.26thataHDNNPwithBPSFscanbesuccessfullyusedtoobservestructuralphasetransitionsinthiscompound.Fig.10comparesabsoluteandrelativeforceerrorsobtainedusingBPSFsofRef.26aswellasourPSFandPAS.ForceRMSDsare51.9meV/ÅforBPSF,56.7meV/ÅforPSFand52.3meV/ÅforPAS,whichcor-respondsroughlytoa10%diﬀerencebetweenPSFandBPSF.Again,theperformanceofBPSFandPASisonpar,whereasuseofPSFleadstoslightlylargererrors,whichisalsoreﬂectedintherelativeerrordistributionskewinglightlytotheright.Overall,however,thisef-fectisexpectedtoremainnegligibleinpracticalapplica-10−0.4−0.200.20.4−0.4−0.200.20.4Finnp[a.u.]Firef[a.u.]BPSFPSFPAS00.010.020.030.040.050.060.070.0801020304050P(∆F)[%]∆F[%]BPSFPSFPASFIG.10.ForcepredictionsontheCu2Stestsetcorrespondingto10%ofthestructuresofthetrainingsetofRef.26.RefdenotesreferencesforcesandnnpthepredictionbytheHDNNP.Left:Predicted(nnp)vs.reference(ref)forcesasobtainedusingBPSF,PSFandPAS.Shownaretheforceslargestinmagnitude.Adeviationfromthediagonalindicatesanerrorintheforceprediction.PASandPSFarebetterabletotrainthelargestforcesinthetestset,whichisreﬂectedinasmallerdeviationfromthediagonal.Right:DistributionP(∆F)ofrelativeforceerrors,(∆F=Fnnp−Fref)/FrefforBPSF,PSFandPAS.−0.2−0.100.10.2−0.2−0.100.10.2Finnp[a.u.]Firef[a.u.]BPSFPSFPAS00.020.040.060.080.10.120.140.160.1801020304050P(∆F)[%]∆F[%]BPSFPSFPASFIG.11.ForcepredictionqualityforanisolatedDMABNmolecule,includingarotationofitsaminogroupalonganon-equilibriumpath.Left:Predicted(nnp)vs.reference(ref)forcesasobtainedusingBPSF,PSFandPAS.Adeviationfromthediagonalindicatesanerrorintheforceprediction.PASforcesremainclosertothediagonalthaneitherBPSFandPSF.Right:DistributionP(∆F)ofrelativeforceerrors,(∆F=Fnnp−Fref)/FrefforBPSF,PSFandPAS.WhereasthedistributionforBPSFandPASaresimilar,PSFagainskewslightlytowardstheright.tions.Deviationsfromthediagonalinthegraphcompar-ingpredictionandreferenceforces(Fig.10,rightpanel)donotexhibitvisiblediﬀerences,furtherindicatingthatthegeneralperformanceofallsymmetryfunctiontypesinvestigatedhereremainscomparableandthatthedif-ferencesinforceRMSDsobservedherearenotexpectedtoinﬂuencethequalityofthepredictionsinasigniﬁcantmanner.EnergyRMSDsremainsimilarforallmethods,spanningarangefrom0.99meVforPASto1.06meVforBPSF.C.Organicmolecules:GasphaseandliquidsInthefollowing,weshallcomparetheperformanceofBPSFsgeneratedaccordingtoRef.24withourpolyno-mialsymmetryfunctionsusinganisolated(gas-phase)DMABNmoleculeandliquidethylbenzene.WenotethatoptimalsymmetryfunctionsetupscouldpossiblybefoundforallSFtypesinvestigatedhere;however,sincethisisatime-intensiveprocedure,themainpurposeofthiscomparisonistocomparetheout-of-the-boxperfor-manceofsomegenericsetsofSFs.Tothisend,weintroduceasimplegenerationschemeforradialsymmetryfunctionparametersgivenaminimalandmaximumwidth,∆minand∆max,andamaximumcutoﬀradiusrc.ForN0symmetryfunctionswhicharesymmetricw.r.ttotheorigin,wechoosethewidth∆i0parametersofthei-thoutofN0PSForPASas:∆00=rc(18)∆i0=∆max−(i−1)(∆max−∆min)N0−2;i≥1(19)ForagivennumberNsofsymmetryfunctionswhichare11−0.100.1−0.100.1Finnp[a.u.]Firef[a.u.]BPSFPSFPAS00.010.020.030.040.050.060.070.080.0901020304050P(∆F)[%]∆F[%]BPSFPSFPASFIG.12.Forcepredictionforethylbenzeneinitsliquidstate.Left:Predicted(nnp)vs.reference(ref)forcesasobtainedusingBPSF,PSFandPAS.Adeviationfromthediagonalindicatesanerrorintheforceprediction.PASforcesremainclosertothediagonalthaneitherBPSFandPSF.Right:DistributionP(∆F)ofrelativeforceerrors,(∆F=Fnnp−Fref)/FrefforBPSF,PSFandPAS.WhereasthedistributionforPSFandPASaresimilar,BPSFsskewconsiderablytotheright,indicatingasubstantialdiﬀerenceinaccuracy.−0.2−0.100.10.2−0.2−0.100.10.2Finnp[a.u.]Firef[a.u.]BPSFPSFPAS00.010.020.030.040.050.060.0701020304050P(∆F)[%]∆F[%]BPSFPSFPASFIG.13.Forcepredictionforliquidanisole.Left:Predicted(nnp)vs.reference(ref)forcesasobtainedusingBPSF,PSFandPAS.Adeviationfromthediagonalindicatesanerrorintheforceprediction.PASforcesremainclosertothediagonalthaneitherBPSFandPSF.Right:DistributionP(∆F)ofrelativeforceerrors,(∆F=Fnnp−Fref)/FrefforBPSF,PSFandPAS.WhereasthedistributionforBPSFandPASaresimilar,PSFskewslightlytowardstheright.However,thisdiﬀerenceismuchlesspronouncedthantheoneobservedforBPSFinFig.12.centredatris6=0,weobtainshiftsandwidths∆isas:∆is=2rcNs+1(20)ris=(i−1)∆is2(21)ThispartitioningisreminiscenttotheoneintroducedbyGasteggeretalinRef.21.Angleswerechosentoreﬂectcommonstructuralfeaturesencounteredinorganicchem-istry:Linearityfortriplebonds,60◦and109.1◦anglestodescribedouble-andsinglecarbon-carbonbonds,respec-tively.Thisresultedinthefollowingangularfunctions:ϑ10=0◦,ϑ11=90◦andϑ13=180◦with∆ϑ1,2,3=90◦;ϑ40=60◦,ϑ50=120◦andϑ60=109.1◦with∆ϑ4,5,6=60◦each.Forsakeofcomparison,thecutoﬀfunctiondis-tanceforBPSFsandthemaximumextentofPASandPSFweresetto15a.u.StructuresintheDMABN-setcoverregionsofthePESthermallyaccessibleat1320K,includingaforcedrotationaroundtheaminogroupalonganon-equilibriumpath.Thisresultsinmanyforceswithlargemagnitudewhicharewelloutsideoftheequilibriumregimeinwhichsimpleharmonicpotentialscanalsoyieldgoodapproximations.TheDMABNsetthereforeservesasanassessmentforthetransferabilityofourpolynomialSFstostructureswhichareconsiderablyoﬀ-equilibrium.ForceRMSDsonthetestsetamountto63.2meV/ÅforBPSF,56.6meV/ÅforPSFand54.0meV/ÅforPAS.ThisdiﬀerenceisdirectlyreﬂectedintherightpanelofFig.11,wheretheforcehistogramsshowanincreasingspreadtowardslargervalueswhengoingfromPASoverPSFtoBPSF.Notethatthisamountstoadiﬀerenceexceeding15%betweenworst(BPSF)andbest(PAS)set.EnergyRMSDsrangefrom0.64meVforPSFto0.72meVforBPSF,withtheoverallerrorremaininglowforalltypesoffunctions.Theforcepredictionsobtainedhereimplythatforagenerictestsetcontainingasigniﬁcantamountofoﬀ-equilibriumstructures,genericPASand12PSFsetsareabletooutperformBPSFs.WewillnowshowthatthesameconsiderationsalsoholdforanorganicliquidinwhichvanderWaalsinter-actionsdominate.Foratestsetofliquidethylbenzene,usingthesamesymmetryfunctionsetupsasforDMABN,weﬁndforcepredictionRMSDsof89.5meV/ÅforBPSFs,68.9meV/ÅforPSFand61.7meV/ÅforPAS,respectively.Thiscorrespondstoadiﬀerenceinaccuracyapproaching50%betweenBPSFandPAS.Whereastheseconsiderablediﬀerencesarenotevidentfromthediago-nalforce-to-forceplotintheleftpanelofFig.12,theybecomevisibleintheforcehistogramintherightpanel:HistogramsforPSFandPASareverysimilar,withtheonlysigniﬁcantdiﬀerencebeingthepeakaround0%,butBPSFsskewconsiderablytotheright,andmuchmoresothanwhatwasobservedforPSFinthecaseofwa-terorCu2S.EnergyRMSDsareabout0.05meVforallSFsstudiedhere,whichisofexcellentaccuracy.Forliq-uidanisole,allsymmetryfunctionsetupsresultinaboutequallyaccuratepredictions:ObservedforcepredictionRMSDsamountto100.8meV/ÅforBPSFsandacom-parable106.5meV/ÅforPSF,withthelowestdeviationagainbeingobservedat98.7meV/ÅforPAS.AllSFsyieldenergyRMSDsthatcanbeconsideredidentical,withinasmallrangefrom0.08meVforBPSFto0.11meVforPASandPSF.Overall,thetrendsobtainedforforcepredictionsinorganicmoleculesindicatethatourgenericPASandPSFsetupsonaverageexhibitsuperiortransferabilitybetweensystems,whileatthesametimeretaininglowerforceerrorsonthetestsetscomparedtogenericBPSFs.Importantly,whereasBPSFsperformedconsiderablyworsethanpolynomialfunctionsforliquidethylbenzene,neitherPASnorPSFshowedaconsider-ablyinferiorperformancewithrespecttoBPSFinanyoftheothersystemsinvestigatedhere.Energypredic-tionsaremuchmorerobustwithrespecttothechoiceofsystem,theyremainofcomparableaccuracyforallSFsinvestigatedhere.D.QM9DatabaseInordertopinpointpossibleimprovementswhensolelyenergiesaretobetreated,wehaveconstructedasetofweightedatom-centredsymmetryfunctions(wACSF)basedonPASandhaveusedthissettopredictenthalpiesofformationintheQM9database.Inordertorenderthetrainingmorechallenging,andcontrarytoRef.21,enthalpiesinthedatasetwereneithernormalisednorrescaled.PASweresetupaccordingtotheprocedureoutlinedinSectionIVC,employingamaximumwidthof8Åandusingarandomchoiceof10000structuresfortraining(andtesting)asoutlinedinRef.21,there-mainderbeingusedasavalidationset.Meanabsoluteerrors(MAE)overpredictedenthalpiesofformationfortheremaining≈124000moleculesofthedatabasewereaveragedover5independentpartioningsintotrain,testandvalidationsetsasinRef.21.TABLEI.MAE[kcal/mol]overtraining,testandvalidationsetoftheQM9databaseasdescribedinthemaintext.Notethatthedatasetwasnotnormalised.MAETrainingTestValidationBPSF1.5111.2110.72PAS1.632.132.24AsshowninTableI,whileperformanceonthetrain-ingsetiscomparablebetweenthebestBPSFsetre-portedinRef.21andPAS,thequalityofthepredic-tionsontestandvalidationsetswithinagivenselectionof10000test-andtrainingstructuresconsiderablyim-proveswhenPASareused.Fortherandompartitioningsintotrainingandtestdatastudiedhere,errorsobtainedfromHDNNPstrainedwithPASareabout5-foldsmallerthantheirBPSFcounterparts.ItshouldbenotedthatonceBPSFareusedtotrainaHDNNPonanappropri-atelynormalisedandrescaledtrainingset,theirperfor-manceapproachesthatofPASonanon-normalisedtestset21.Thisindicatesthattherobustnessofthepredic-tionssubstantiallyincreaseswhenPASareused,astestandvalidationerroraresubstantiallylowerevenwhenthedatasetisnotsubjectedtoanynormalisation.E.ComputationalFootprintThechoiceofsymmetryfunctionshasaninﬂuenceonboth,thecomputationalfootprintoftrainingaswellasthecostofforcepredictionsduringproductionruns.Fortheformer,ifSFscanbecalculatedforallstructuresinthetrainingsetandthenstored,itismainlythenum-berofSFsthatinﬂuencesperformance:MoreSFsimplymoreweightstobeoptimisedandassuchresultinhigherexecutiontimes.Memoryrequirementswillgrowaswellasthenumberofsymmetryfunctionsincreases.Evenifa(generic)setoftwosymmetryfunctionsmightcomprisethesamenumberofinputfunctions,pruningoffunctionsthatneverexceedacertainthreshold(typically10−3)canresultindiﬀerentsetsizesduringtraining.InproductiveMDruns,SFshavetoberecalculatedforeverynewstruc-tureandhence,performancewillnotonlybedeterminedbytheirsheernumber,butalsobythenumberandtypeofﬂoatingpointoperationsinvolvedintheircomputa-tion.Inthefollowing,wewillanalysebothperformanceTABLEII.MDsimulationexecutiontimeof360watermolecules(100timesteps,4cores).SFGroups/Cachingde-notesthealgorithmicoptimisationsoutlinedinRef.27,valuesinparenthesesdenotespeedups.OptimizationBPSFPSFPASNone37.287.72(×4.83)8.07(×4.62)SFGroups/Caching12.506.82(×1.83)6.90(×1.81)SpeedupviaOpt.×2.98×1.13×1.1713TABLEIII.Numberofsymmetryfunctionseﬀectivelyusedduringtrainingofthesystemsinvestigatedhereafterremov-ingSFswithamplitudes<10−3.BPSF-parameterswerecho-senaccordingtoRef.24.SystemBPSFPASWater576254Cu2S138162178DMABN893852841Ethylbenzene272366368Anisole102510571036relatedaspects.TableIIliststhecostofrunning100stepsofMDforaperiodicboxcontaining360watermoleculesusingtheHDNNPsinvestigatedherebothforastraightforwardcalculationofallSFsaswellasusinganoptimisedalgo-rithmtailoredfordistributedmemoryparallelisationoncoreprocessingunits(CPUs)asreportedinRef.27.Theformerservesasameasureforthecostoftheﬂoating-pointoperationsassociatedtoeverySFtype;thiscor-respondstothelimitofallNoutofNsymmetryfunc-tionsbeingindependentanddiﬀerentlyparametrised.Incomparisonwiththeformer,thelatterindicatestheben-eﬁtofunderlyingalgorithmicoptimisations;thishow-everrequiresthatasubsetoftheNsymmetryfunc-tionscontainidenticalparametersandcutoﬀfunctionsinordertobeneﬁtfromagroupingandcachingstrat-egy.TheeﬀectivespeedupsobtainedbyusingPSForPASforthewatersetupreachalmostafactorof5whennogroupingorcachingstrategyisapplied.Thisindi-catesthatthenumberofexpensiveﬂoatingpointopera-tionsissigniﬁcantlyreducedwhenpurelypolynomialSFsareused.Viceversa,symmetryfunctiongroupingandcachinghasamuchlowerinﬂuenceofexecutiontimesofPSFandPAS,wherethoseoptimisationsreducethecom-putationalcostbyabout15%.AswouldbeexpectedbythelargernumberoftermsinvolvedintheevaluationofPAS,theircomputationisslightlymoreexpensivethantheevaluationofPSF.However,thediﬀerenceissmallenoughtobenegligibleinpractice.Incontrast,BPSFs–forwhichgroupingandcachingstrategiesweredevelopedintheﬁrstplace–beneﬁtfromspeedupsofuptoafactorof3whengroupingandcachingstrategiesareintroduced.Notethat,byconstruction,PASandPSFarenotintendedtorequireuseofoptimi-sationstrategies,whichisreﬂectedincomparablymod-estspeedupsuponintroductionofgroupingandcaching.Still,eveninthosecases,PSFandPASarealmostafactorof2fasterthanBPSF.Inaddition,itshouldbenotedthatPASyieldthelowestRMSDonwaterwiththesmallesttotalnumberofSFs;theythereforedonotonlylowerthecomputationalcost,butalsothememoryfootprintwithrespecttoBPSFs.TableIIIcomparesthenumbersofsymmetryfunctionseﬀectivelyusedduringtrainingafterpruningallSFsthatneverexceedamagnitudeof10−3.Thisproviedsamea-sureforcomputationalcostandmemoryrequirements.Apartfromethylbenzene,inwhichsigniﬁcantlymoreSFsofBPSF-typewereremovedduringpruning,numbersarecomparablebetweenBPSF,PSFandPAS.ItshouldbenotedthatallsystemsexceptwaterweretrainedwithautomaticallygeneratedsetsofSFparameters,whichalsoaccountsforthediﬀerentextentoffunctionswithmaximumamplitudeof<10−3inthesesetups.Inthiscontext,itisinterestingtonotethatinspiteofthestruc-turalsimilaritiesbetweenanisoleandethylbenzene,forBPSFs,thereisasigniﬁcantdiﬀerenceinthenumberofprunedsymmetryfunctions.ForPASandPSF,nosuchdiﬀerencecanbeobserved;thiscanalsoaccountforthelargererrorsinforceRMSDsthatareobservedwhenethylbenzeneistrainedwithasetofBPSFs.Withinthehand-pickedsetofSFsforwater,diﬀerencesbetweenPSFandPASarenotable,withthelatterallowingforare-ductionofabout15%withrespecttotheformer.BPSFslieinbetween.Thissuggeststhat,forhand-selectedsets,PASallowforanevensmallernumberofSFstobeused.Overall,theperformanceofPSFandBPSFswascom-parableforallsystemsstudiedhere.ForceRMSDsforwaterandCu2SwereslightlyhigherforPSF,however,thiswasnotreﬂectedinthedynamicandstructuralprop-ertiesofwaterobtainedby2nsofHDNNP-MD,whereresultsusingPSFandBPSFsshowedexcellentagree-ment.Ontheotherhand,forDMABNandliquidethylbenzene,PSFconsiderablyoutperformedBPSFs.Forallsystems,PASwereabletooutperformeitherPSForBPSF.Inparticular,whenusedinthewACSFscheme21,PASgreatlyimproveperformanceoverBPSFfordatasetsthatarenotnormalised,indicatingsuperiorrobust-ness.WethereforestronglyrecommendPASforfutureHDNNPsetups,sincetheyallowtospeedupproductiveMDrunsbyafactorof1.8andfurtherimproveaccu-racyoftheHDNNPs.Inparticular,duetotheirﬂoatingpointcostbeinglowerbyaboutafactorofalmost5,weparticularlyrecommenduseofPASforimplementa-tionswherecachingandgroupingstrategiesarenotfea-sible.Thiscan,forinstance,bethecasewhenoﬄoad-ingcomputationofSFstoGPUs,wheretheresolutionofif-statementsandloopbreaksassociatedtooptimi-sationschemescanconsiderablyslowdowncomputationwithrespecttopurelyarithmeticoperations.Notleast,thankstotheirsmallcomputationalfootprint,PAScanalsobeusedinprogramsthathavenotundergoneexten-siveoptimisation,andtheirsimplestructurefacilitatesimplementationandcalculationofderivativesuptoanarbitraryorderdeﬁnedbytheunderlyingpolynomial.V.CONCLUSIONANDOUTLOOKHere,wehaveintroducedanewfamilyofsymmetryfunctionsforBehler-ParrinelloHDNNPs,basedonpoly-nomialswithcompactsupportforbothradialandan-gularenvironments,whichsupersedesuseofaseparatesetofradialcutoﬀfunctions.Thecentresandwidthsofourpolynomialsymmetryfunctionscanbefreelychosen.14Thisisnotablythecaseforangularfunctions,whichhavesofarbeenrestrictedtopeakat0◦or180◦.Aslongassymmetryofderivativeson0◦and180◦ismaintained,angularfunctionscanbecentredonanypointwithin[0◦,180◦]andtheirwidth∆ϑcanbefreelychosen.Wehaveintroducedtwotypesofradialsymmetryfunctions,PSFandPAS,withtheformerbeingpoint-symmetricon[rs,rs+∆],whereasthelatterhavealong-rangetailreminiscentoftheproductofacutoﬀfunctionandaGaussian.Ourpolynomialsymmetryfunctionsconsid-erablysimplifythechoiceofradialsymmetryfunctionparameterswithrespecttocommonGaussianfunctions,sincethepositionofmaximaandminimacanbestraight-forwardlypredictedwithouthavingtotakeintoaccountshiftsandasymmetriesintroducedbyacutoﬀfunction.TheaccuracyofaPSF-andPAS-basedsetupwithrespecttoconventionalBPSFswasassessedforvariousphasesofwater,forsolidCu2Saswellasfororganicmoleculesinthegaseousandliquidphase.Forwater,Cu2andDMABN,PSF,PASandBPSFallshowedexcellentaccuracy.Structuralanddynamicpropertiesobtainedfrom2nsHDNNP-MDofliquidwaterrevealednorel-evantdiﬀerencesbetweentheneuralnetworkpotentialsobtainedwithanyofthethreesymmetryfunctiontypes.Inthecaseofoﬀ-equilibriumstructuresofaDMABNmoleculeinthegasphase,PASandPSFhaveoutper-formedBPSFsforforcepredictionsby15%andimprovedenergyRMSDsby50%.Thissituationwasmuchmoreprominentforliquidethylbenzene,whereforceRMSDsoverthetestsetweremorethan50%higherforBPSFthanforPSForPAS.Forcepredictionerrorsweregen-erallyhigherforliquidanisole,however,theyremainedhighlycomparablebetweenalltypesofSFsstudiedhere.Generally,PSFperformedonparwithBPSF,exceptforethylbenzenewheretheyperformedconsiderablybetter.Forallsystemsstudiedhere,PASconsistentlyyieldedthebestresults.ByusingPASinweightedatom-centredSFs(wACSFs),thepredictivepowerofaHDNNPtrainedon10000non-normalisedstructuresoftheQM9databasewasconsiderablyimproved,withmeanabsoluteerrorsfortraining,testandvalidationsetbeingaboutﬁve-foldlowerthanforBPSF-basedwACSFs.WehavedemonstratedthatHDNNP-MDofliquidwa-terisabout2timesfasterusingPSForPAScomparedtoBPSF,constitutingaconsiderableimprovementofper-formanceandhence,sampling.IntermsoftheﬂoatingpointoperationsassociatedtotheevaluationofSFs,wefoundthatuseofPSFresultsinspeedupsofafactorofabout5withrespecttoBPSF,andspeedupsassociatedtotheslightlymorecomplexPASstillexceedafactorof4.5.ThenumberofsymmetryfunctionsusedforthesystemsinvestigatedherewerecomparablebetweenPSF,PASandBPSF,althoughresultsforthehand-pickedsetforwaterindicatethatsetupswithPAScanpotentiallyreducethenumberofSFsusedwithrespecttocom-monBPSFs,thereforesavingonmemoryandonthecostoftrainingbyreducingthenumberofﬁttingparame-ters.Giventhesubstantialreductioninextensiveﬂoat-ingpointoperationsassociatedtotheuseofPSFandPAS,andgiventhataccuracyofgenericsetsofPASisconsistentlybetterthanthatofBPSF,weadvocateuseofPASasamethodofchoiceforfutureimplementations.Inparticular,theirsimplestructurenotonlysimpliﬁestheirimplementationandmakestheirsetupstraightfor-ward,buttheirsmallcomputationalfootprintcanalsofacilitatetheirportingtodiﬀerentsystemarchitectureswithouttheneedforextensiveoptimisation.Overall,wehaveshownthatbyconstructingSFswithcompactsupport,substantialperformancegainsofuptoafactorofalmost5canbeobtainedwithoutimpact-ingaccuracyoftheresultingHDNNPs.PolynomialSFsareeasytoimplementandsetup,sincetheyallowforaﬂexiblechoiceofradialandangulardomaindonotre-quireanycutoﬀfunctions.OurpolynomialsymmetryfunctionsthereforelendthemselvesforallapplicationsofHDNNPs,beitforequilibriumoroﬀ-equilibriumstuc-turesofisolatedmolecules,liquidsorsolids.ACKNOWLEDGEMENTSMPBacknowledgesapostdoctoralfellowshipfromtheSwissNationalScienceFondation(project184500).ASacknowledgessupportfromtheEuropeanUnion’sHorizon2020researchandinnovationprogrammeunderGrantAgreementNo.676531(projectE-CAM).There-sultspresentedherewereinpartobtainedusingtheVi-ennaScientiﬁcCluster(VSC).REFERENCES1P.O.Dral,“QuantumChemistryintheAgeofMachineLearn-ing,”J.Phys.Chem.Lett.11,2336–2347(2020).2A.C.MaterandM.L.Coote,“DeepLearninginChemistry,”J.Chem.Inf.Model.59,2545–2559(2019).3K.T.Butler,D.W.Davies,H.Cartwright,O.Isayev,andA.Walsh,“Machinelearningformolecularandmaterialssci-ence,”Nature559,547–555(2018).4J.Behler,“Perspective:Machinelearningpotentialsforatomisticsimulations,”J.Chem.Phys.145,170901(2016).5T.Morawietz,A.Singraber,C.Dellago,andJ.Behler,“HowvanderWaalsinteractionsdeterminetheuniquepropertiesofwater,”Proc.Natl.Acad.Sci.U.S.A.113,8368–8373(2016).6B.Cheng,E.A.Engel,J.Behler,C.Dellago,andM.Ceriotti,“Abinitiothermodynamicsofliquidandsolidwater,”Proc.Natl.Acad.Sci.U.S.A.,201815117(2019).7T.P.Senftle,S.Hong,M.M.Islam,S.B.Kylasa,Y.Zheng,Y.K.Shin,C.Junkermeier,R.Engel-Herbert,M.J.Janik,H.M.Ak-tulga,T.Verstraelen,A.Grama,andA.C.T.vanDuin,“TheReaxFFreactiveforce-ﬁeld:Development,applicationsandfu-turedirections,”npjComputationalMaterials2,1–14(2016).8G.Barcaro,V.Carravetta,L.Sementa,andS.Monti,“Reactiveforceﬁeldsimulationsofsiliconclusters,”AdvancesinPhysics:X4,1634487(2019).9V.L.Deringer,M.A.Caro,andG.Csányi,“MachineLearningInteratomicPotentialsasEmergingToolsforMaterialsScience,”Adv.Mater.0,1902765(2019).10F.A.Faber,L.Hutchison,B.Huang,J.Gilmer,S.S.Schoen-holz,G.E.Dahl,O.Vinyals,S.Kearnes,P.F.Riley,andO.A.15vonLilienfeld,“PredictionErrorsofMolecularMachineLearn-ingModelsLowerthanHybridDFTError,”J.Chem.TheoryComput.13,5255–5264(2017).11A.P.Bartók,R.Kondor,andG.Csányi,“Onrepresentingchem-icalenvironments,”Phys.Rev.B87,184115(2013).12A.P.Bartók,M.C.Payne,R.Kondor,andG.Csányi,“GaussianApproximationPotentials:TheAccuracyofQuantumMechan-ics,withouttheElectrons,”Phys.Rev.Lett.104,136403(2010).13M.Rupp,A.Tkatchenko,K.-R.Müller,andO.A.vonLilienfeld,“FastandAccurateModelingofMolecularAtomizationEnergieswithMachineLearning,”Phys.Rev.Lett.108,058301(2012).14A.P.Thompson,L.P.Swiler,C.R.Trott,S.M.Foiles,andG.J.Tucker,“Spectralneighboranalysismethodforautomatedgen-erationofquantum-accurateinteratomicpotentials,”J.Comput.Phys.285,316–330(2015).15T.B.Blank,S.D.Brown,A.W.Calhoun,andD.J.Doren,“Neuralnetworkmodelsofpotentialenergysurfaces,”J.Chem.Phys.103,4129–4137(1995).16J.Behler,“Neuralnetworkpotential-energysurfacesinchem-istry:Atoolforlarge-scalesimulations,”Phys.Chem.Chem.Phys.13,17930–17955(2011).17J.BehlerandM.Parrinello,“GeneralizedNeural-NetworkRepre-sentationofHigh-DimensionalPotential-EnergySurfaces,”Phys.Rev.Lett.98,146401(2007).18J.Behler,“Constructinghigh-dimensionalneuralnetworkpoten-tials:Atutorialreview,”Int.J.QuantumChem.115,1032–1050(2015).19J.Behler,“Atom-centeredsymmetryfunctionsforconstruct-inghigh-dimensionalneuralnetworkpotentials,”J.Chem.Phys.134,074106(2011).20P.GeigerandC.Dellago,“Neuralnetworksforlocalstructuredetectioninpolymorphicsystems,”J.Chem.Phys.139,164105(2013).21M.Gastegger,L.Schwiedrzik,M.Bittermann,F.Berzsenyi,andP.Marquetand,“wACSF—Weightedatom-centeredsymmetryfunctionsasdescriptorsinmachinelearningpotentials,”J.Chem.Phys.148,241709(2018).22T.MorawietzandJ.Behler,“ADensity-FunctionalTheory-BasedNeuralNetworkPotentialforWaterClustersIncludingvanderWaalsCorrections,”J.Phys.Chem.A117,7356–7366(2013).23T.MorawietzandJ.Behler,“AFull-DimensionalNeuralNetworkPotential-EnergySurfaceforWaterClustersuptotheHexamer,”Z.Phys.Chem.227,1559–1581(2013).24G.Imbalzano,A.Anelli,D.Giofré,S.Klees,J.Behler,andM.Ceriotti,“Automaticselectionofatomicﬁngerprintsandref-erenceconﬁgurationsformachine-learningpotentials,”J.Chem.Phys.148,241730(2018).25J.S.Smith,O.Isayev,andA.E.Roitberg,“ANI-1:Anexten-sibleneuralnetworkpotentialwithDFTaccuracyatforceﬁeldcomputationalcost,”Chem.Sci.8,3192–3203(2017).26A.Singraber,T.Morawietz,J.Behler,andC.Dellago,“Paral-lelMultistreamTrainingofHigh-DimensionalNeuralNetworkPotentials,”J.Chem.TheoryComput.15,3075–3092(2019).27A.Singraber,J.Behler,andC.Dellago,“Library-BasedLAMMPSImplementationofHigh-DimensionalNeuralNetworkPotentials,”J.Chem.TheoryComput.15,1827–1840(2019).28M.P.BircherandU.Rothlisberger,“Plane-WaveImplemen-tationandPerformanceofà-la-CarteCoulomb-AttenuatedExchange-CorrelationFunctionalsforPredictingOpticalExcita-tionEnergiesinSomeNotoriousCases,”J.Chem.TheoryCom-put.14,3184–3195(2018).29M.J.G.Peach,P.Benﬁeld,T.Helgaker,andD.J.Tozer,“Ex-citationenergiesindensityfunctionaltheory:Anevaluationandadiagnostictest,”J.Chem.Phys.128,044118(2008).30R.Ramakrishnan,P.O.Dral,M.Rupp,andO.A.vonLilien-feld,“Quantumchemistrystructuresandpropertiesof134kilomolecules,”ScientiﬁcData1,140022(2014).31A.Singraber,“N2p2:NeuralNetworkPotentialPackage,”Comp-PhysVienna(2018).32CPMDconsortium,“CPMD,”JointlybyIBMCorp.andbyMaxPlanckInstitute,Stuttgart(2000).33J.Sun,A.Ruzsinszky,andJ.P.Perdew,“StronglyConstrainedandAppropriatelyNormedSemilocalDensityFunctional,”Phys.Rev.Lett.115,036402(2015).34S.Plimpton,“FastParallelAlgorithmsforShort-RangeMolecu-larDynamics,”J.Comput.Phys.117,1–19(1995).35S.Plimpton,A.Thompson,S.Moore,andA.Kohlmeyer,“LAMMPSMolecularDynamicsSimulator,”(2004).SupportingInformation:ImprovedDescriptionofAtomicEnvironmentsusingLow-costPolynomialFunctionswithCompactSupportMartinP.Bircher,1AndreasSingraber,2,1andChristophDellago1,a)1)FacultyofPhysicsUniversityofViennaBoltzmanngasse5A-1090Wien,Austria2)InstituteforTheoreticalPhysicsTUWien-ViennaUniversityofTechnologyWiednerHauptstraße8-10A-1040Wien,AustriaI.SYSTEMSETUPSA.GenerationofTrainingDataAlltrainingsetsthatareﬁrstreportedhereweregen-eratedwithadevelopmentalversionoftheCPMD1code,usingtheSCAN2exchange-correlationfunctionalandPBE3pseudopotentialsoftheMartins-Troulliertype4.Aplanewavecutoﬀwasusedthroughout,andcalcula-tionsonisolatedsystemsusedtheTuckerman-MartynaPoissonsolver5inordertodecoupleperiodicimages.Aplanewavecutoﬀenergyof80Rywasusedthroughout.Inaccordancewithstandardpractice,hydrogenatomsinCar-ParrinelloMD(CPMD)werereplacedbydeuterium,andtheﬁctitiouselectronicmasswassetto600a.u.;thewavefunctionconvergencethresholdwassetto10−7a.u.onthemaximumnormofthegradient.Ifnotstatedoth-erwise,Nosé-Hooverchains6wereusedtothermostatthesystems.1.WaterandCopperSulﬁdeTrainingsetsforwaterwereobtainedfromRef.7.DataforCu2ScorrespondstothesetofRef.8.HDNNP-MDof360watermoleculeswasperformedusingtheLAMMPS9programviathecorrespondingn2p2-interface.Atimestepof1fswasusedthrough-out.Apre-equilibratedsnapshotof360liquidwatermoleculesatexperimentaldensity(cubicsupercellwitha=b=c=22.211Å3)waspropagatedintheNVTensembleforatotalof2nsat300K,followedby2nsofHDNNP-MDintheNVEensemble.2.DMABNAnisolatedmoleculeofp–(N,N–dimethylamino)-benzonitrile(DMABN)wasplacedina15Å3orthorhom-bicbox.20000stepsofCPMDwithatimestepof4a.u.a)Electronicmail:christoph.dellago@univie.ac.atwereperformedat990K.800structuresofthistrajec-torywereselectedforthetrainingset.Inordertoobtainanon-equilibriumpathalongarotationoftheaminogroup,aharmonicrestraintwithk=0.005a.u.wassetupbetweenthedihedralplanesoffourcarbonsofthephenylringandadihedralspannedbytwocarbonsofthephenylring,thenitrogenaswellasonecarbonoftheaminogroup.Thevalueoftherestraintwassettogrowby0.25◦per4a.u.overatotalof9950timesteps.398regularlyspacedstructureswereselectedalongthistra-jectory,withthetrainingdatacontainingatotalof1198diﬀerentstructures.3.EthylBenzeneandAnisoleInordertoobtainadiversesetofstructuresforthesesystems,Born-OppenheimerMD(BOMD)simulationsusingatimestepof10a.u.wereperformed,with16moleculescontainedincubicsupercellsattheexperimen-taldensity(a=b=c=14.8206Å3forethylbenzeneanda=b=c=14.24Å3foranisole).BOMDofethylbenzenewasperformedfor11750stepsintheNVTen-sembleat420K,and468equispacedstructuresoftheresultingtrajectorywereusedtoconstitutethetrainingset.BOMDofanisolewasperformedfor10640stepsintheNVEensembleat420K,followedby1725stepsat1320Kinordertosamplerotationsofthemethoxygroup.494equispacedstructureswereselectedforthetrainingset.4.QM9EnthalpiesofformationoftheQM9databaseweretakenfromRef.10.ContrarytoRef.11,enthalpieswereneitherrescalednornormalised.B.TrainingofHDNNPsAllHDNNPsweretrainedwiththen2p2programpackage12.Symmetryfunctionsthatdonottakeval-uesabove10−3wereremovedfromthesetups.Thresh-oldforforceandenergyupdatesweresetto100%ofarXiv:2010.14414v3  [physics.chem-ph]  1 Feb 20212TABLEI.Rootmean-squaredeviation(RMSD)ofenergy[meV]andforce[meV/Å]predictionsforboth,trainingandtestsets,ofallmoleculesstudiedhere.SystemSFRMSD(Etrainnnp,Etrainref)RMSD(Etestnnp,Etestref)RMSD(Ftrainnnp,Ftrainref)RMSD(Ftestnnp,Ftestref)BPSF1.171.1743.743.7WaterPSF1.141.2748.048.5PAS0.951.0143.343.2BPSF1.061.1451.751.9Cu2SPSF1.041.1558.056.7PAS0.991.0152.352.3BPSF0.410.7457.663.2DMABNPSF0.210.6446.956.6PAS0.190.7145.054.0BPSF0.050.2287.089.5EthylbenzenePSF0.170.2567.171.2PAS0.050.2258.661.7BPSF0.080.32100.3100.8AnisolePSF0.110.32104.9106.5PAS0.110.2896.798.7TABLEII.Meanabsoluteerrors(MAE)[kcal/mol]foren-thalpiesofformationoftheQM9database.HDNNPsweretrainedusing5independentpartitioningsofthetrain/test(10000selectedstructures).Datasetswerenotnormalisedorrescaled.SFTypeSet1Set2Set3Set4Set5Training1.351.521.431.471.78BPSFTest2.203.9227.4112.729.78Validation4.546.3918.3013.9210.44Training1.531.641.691.601.71PASTest1.972.062.462.072.08Validation2.032.292.332.172.36thegivenRMSDonthetrainingset,withupdatecan-didatesbeingrandomlyselectedfromstructureswhereforceandenergyerrorsmeetthesecriteria.Theen-ergytoforceupdateratio(whereapplicable)was1:9.10%ofstructuresinthetrainingsetwererandomlydis-cardedatthebeginningandkeptforvalidationoftheresultingHDNNP(trainingvs.testset).MinimisationoftheweightswasperformedusingaKalmanﬁlterasreportedinRef.8overatotalof25epochsforwater,Cu2S,DMABNandethylbenzen,29epochsforanisoleand100epochsfortheQM9database.Inputﬁlesfortrainingrunscanbedownloadedfromthen2p2reposi-tory:https://github.com/CompPhysVienna/n2p2.II.RMSDSFORFORCESANDENERGIES:TRAININGANDTESTSETSTableIlistsforceandenergyRMSDsobtainedontrainingandtestsets.Datareferstothebestoutof10trainingruns.TableIIshowstraining,testandvali-dationerrorsfortheQM9databaseaveragedover5in-TABLEIII.PASparametersforwACSFusedfortrainingtheQM9database.7radialand6×6angulartermswereused.‘Set’referstothenomenclatureofthemaintext;typereferstothechoiceoffPwithinagivenSFsetup.ThesameSFswereusedforallpossiblecombinationsofelements.SetTypermin[a.u.]rmax[a.u.]ϑmin[◦]ϑmax[◦]PASPSFradial-88PASradial-66PASradial-44PASradial-22PASradial04PASradial26PASradial48PSFangularnarrow-88PASangularnarrow-66PASangularnarrow-44PASangularnarrow-22PASangularnarrow04PASangularnarrow26-180.00180.000.00360.000.00180.000.00120.0060.00180.0049.10169.10dependentpartitioningsof10000selectedstructuresintotrainingandtestset,withtheremainderbeingusedasavalidationsetasinRef.11.III.SYMMETRYFUNCTIONSSFparametersforallsystemsstudiedherecanbedownloadedfromthen2p212repository:https://github.com/CompPhysVienna/n2p2.Behler-typeSFsetupsforwaterandCu2Swereﬁrstreported3inRefs13and8,respectively.PASandPSFparametersarereportedinTablesV(Cu2S)andVI(water).BPSFforDMABN,anisoleandethylbenzenewereobtainedusingtheprocedureofRef.14,usingacutoﬀof15a.u.RadialBPSFconsistsof8automaticallygenerated,shiftedtermsperelementcombinationwhereaswidean-gularfunctionsweregeneratedfrom5non-shiftedradialtermsand8angularterms(λ=±1andζ={1,2,4,6}).ParametersforPASandPSFareshowninTableIV.FortheQM9database,weightedatom-centredsymmetryfunctions(wACSF)asintroducedinRef.11wereused.TheBPSFsetadoptedforcomparisoncorrespondstothebestsetreportedinRef.11;ourPASparametersareshowninTableIII.IV.REFERENCES1CPMDconsortium,“CPMD,”JointlybyIBMCorp.andbyMaxPlanckInstitute,Stuttgart(2000).2J.Sun,A.Ruzsinszky,andJ.P.Perdew,“StronglyConstrainedandAppropriatelyNormedSemilocalDensityFunctional,”Phys.Rev.Lett.115,036402(2015).3J.P.Perdew,K.Burke,andM.Ernzerhof,“Generalizedgradientapproximationmadesimple,”Phys.Rev.Lett.77,3865–3868(1996).4N.TroullierandJ.L.Martins,“Eﬃcientpseudopotentialsforplane-wavecalculations,”Phys.Rev.B43,1993–2006(1991).5G.J.MartynaandM.E.Tuckerman,“Areciprocalspacebasedmethodfortreatinglongrangeinteractionsinabinitioandforce-ﬁeld-basedcalculationsinclusters,”J.Chem.Phys.110,2810–2821(1999),https://doi.org/10.1063/1.477923.6G.J.Martyna,M.L.Klein,andM.Tuckerman,“Nosé–hooverchains:Thecanonicalensembleviacontinuousdynamics,”TheJournalofChemicalPhysics97,2635–2643(1992),https://doi.org/10.1063/1.463940.7T.Morawietz,A.Singraber,C.Dellago,andJ.Behler,“HowvanderWaalsinteractionsdeterminetheuniquepropertiesofwater,”Proc.Natl.Acad.Sci.U.S.A.113,8368–8373(2016).8A.Singraber,J.Behler,andC.Dellago,“Library-BasedLAMMPSImplementationofHigh-DimensionalNeuralNetworkPotentials,”J.Chem.TheoryComput.15,1827–1840(2019).9S.Plimpton,A.Thompson,S.Moore,andA.Kohlmeyer,“LAMMPSMolecularDynamicsSimulator,”(2004).10R.Ramakrishnan,P.O.Dral,M.Rupp,andO.A.vonLilien-feld,“Quantumchemistrystructuresandpropertiesof134kilomolecules,”ScientiﬁcData1,140022(2014).11M.Gastegger,L.Schwiedrzik,M.Bittermann,F.Berzsenyi,andP.Marquetand,“wACSF—Weightedatom-centeredsymmetryfunctionsasdescriptorsinmachinelearningpotentials,”J.Chem.Phys.148,241709(2018).12A.Singraber,“N2p2:NeuralNetworkPotentialPackage,”Comp-PhysVienna(2018).13A.Singraber,T.Morawietz,J.Behler,andC.Dellago,“Paral-lelMultistreamTrainingofHigh-DimensionalNeuralNetworkPotentials,”J.Chem.TheoryComput.15,3075–3092(2019).14G.Imbalzano,A.Anelli,D.Giofré,S.Klees,J.Behler,andM.Ceriotti,“Automaticselectionofatomicﬁngerprintsandref-erenceconﬁgurationsformachine-learningpotentials,”J.Chem.Phys.148,241730(2018).4TABLEIV.PSFandPASparametersforDMABN,ethylben-zeneandansiole.Parametersapplytoallpossiblecombina-tionsofelements.11radialand9×6angulartermswereincludedforeverypossiblecombinationofneighbours.‘Set’referstothenomenclatureofthemaintext;typereferstothechoiceoffPwithinagivenSFsetup.SetTypermin[a.u.]rmax[a.u.]ϑmin[◦]ϑmax[◦]PASPSFradial-1515PASradial-1414PASradial-1212PASradial-1010PASradial-88PASradial-66PASradial-55PASradial-2.57.5PASradial010PASradial2.512.5PASradial5.015.0PSFangularwide-1515PASangularwide-1414PASangularwide-1212PASangularwide-1010PASangularwide-88PASangularwide-66PASangularwide010PASangularwide2.512.5PASangularwide5.015.0-90.0090.0090.00270.000.00180.000.00120.0060.00180.0049.10169.10PSFPSFradial-1515PSFradial-1313PSFradial-1111PSFradial-99PSFradial-77PSFradial-55PSFradial-33PSFradial06PSFradial39PSFradial612PSFradial915.0PSFangularwide-1515PSFangularwide-1313PSFangularwide-1111PSFangularwide-99PSFangularwide-77PSFangularwide-55PSFangularwide010.0PSFangularwide2.512.5PSFangularwide5.015.0-90.0090.0090.00270.000.00180.000.00120.0060.00180.0049.10169.105TABLEV.PSFandPASparametersforcoppersulﬁde.InthePASset,9radialand(3+3)×4angulartermswereincludedperelementcombination.8radialand(3+3)×4angularfunctionswereusedinthePSFset.‘Set’referstothenomenclatureofthemaintext;typereferstothechoiceoffPwithinagivenSFsetup.SetTypermin[Å]rmax[Å]ϑmin[◦]ϑmax[◦]PASPSFradial-66PASradial-66PASradial-5.55.5PASradial-55PASradial-4.54.5PASradial-44PASradial-2.52.5PASradial-1.253.75PASradial05PSFangularwide-66PASangularwide-66PASangularwide-5.55.5-180.00180.000.00360.0035.00135.0059.10159.10PSFangularnarrow-66PASangularnarrow-66PASangularnarrow-5.55.5-180.00180.000.00360.0035.00135.0059.10159.10PSFPSFradial-66PSFradial-55PSFradial-44PSFradial-33PSFradial-22PSFradial-13PSFradial04PSFradial15PSFangularwide-66PSFangularwide-4.54.5PSFangularwide-3.03.0-90.0090.000.00180.0090.00270.0059.10159.10PSFangularnarrow-66PSFangularnarrow-4.54.5PSFangularnarrow-3.03.0-90.0090.000.00180.0090.00270.0059.10159.106TABLEVI.PSFandPASparametersforwaterPSFTypermin[Å]rmax[Å]Typeϑmin[◦]ϑmax[◦]PASTypermin[Å]rmax[Å]ϑmin[◦]ϑmax[◦]PSFradialHH-12.0012.0PSFradialHH-12.0012.00PSFradialHH-10.7510.75PASradialHH-11.5011.50PSFradialHH-9.259.25PASradialHH-9.3759.375PSFradialHH-7.257.25PASradialHH-6.009.60PSFradialHH-3.47.0PASradialHH-3.757.35PSFradialHH-1.95.5PASradialHH-2.255.85PSFradialHH-0.904.50PASradialHH0.004.00PSFradialHH0.03.2PSFradialOH-12.0012.0PSFradialHO-12.0012.00PSFradialOH-10.7510.75PASradialHO-11.5011.50PSFradialOH-9.259.25PASradialHO-9.3759.375PSFradialOH-7.257.25PASradialHO-7.007.75PSFradialOH-4.156.95PASradialHO-4.506.30PSFradialOH-2.74.5PASradialHO-3.004.80PSFradialOH-1.703.5PASradialHO-1.703.50PSFradialOH-0.82.6PSFradialOO-12.012.0PSFradialOO-12.0012.00PSFradialOO-10.7510.75PASradialOO-12.0012.00PSFradialOO-9.259.25PASradialOO-11.5011.70PSFradialOO-7.257.25PASradialOO-9.3759.375PSFradialOO-1.08.2PASradialOO-3.3010.5PSFradialOO0.207.30PASradialOO-1.759.00PSFradialOO1.36.45PASradialOO2.607.75PSFradialOO2.355.65PASradialOO1.506.50PSFangularnarrowHOO-12.012.00180.0PASangularnarrowHOO-12.0012.0045.0315.0PSFangularnarrowHOO-8.408.4045.0315.0PASangularnarrowHOO-12.0012.00-135.0135.0PSFangularnarrowHOO-8.408.40-135.0135.0PASangularnarrowHOO-7.3757.3750.0360.0PSFangularnarrowHOO-5.95.90.0360.0PASangularnarrowHOO-7.3757.375-180.0180.0PSFangularnarrowHOO-5.95.9-180.0180.0PSFangularnarrowHHO-12.012.00180.0PASangularnarrowHHO-12.0012.0045.0315.0PSFangularnarrowHHO-7.257.2545.0315.0PASangularnarrowHHO-12.0012.00-135.0135.0PSFangularnarrowHHO-7.257.25-135.0135.0PASangularnarrowHHO-10.5010.500.0360.0PSFangularnarrowHHO-5.95.90.0360.0PASangularnarrowHHO-10.5010.50-180.0180.0PSFangularnarrowHHO-5.95.9-180.0180.0PASangularnarrowHHO-7.3757.3750.0360.0PSFangularnarrowHHO-5.05.00.0360.0PASangularnarrowHHO-7.3757.375-180.0180.0PSFangularnarrowHHO-5.05.0-180.0180.0PASangularnarrowHHO-5.255.25-180.0180.0PSFangularnarrowHHO-2.82.8-180.0180.0PSFangularnarrowOOO-12.012.00180.0PASangularnarrowOOO-12.0012.0045.0315.0PSFangularnarrowOOO-8.48.445.0315.0PASangularnarrowOOO-12.0012.00-135.0135.0PSFangularnarrowOOO-8.48.4-135.0135.0PASangularnarrowOOO-10.5010.500.0360.0PSFangularnarrowOOO-5.95.90.0360.0PASangularnarrowOOO-10.5010.50-180.0180.0PSFangularnarrowOOO-5.95.9-180.0180.0PSFangularnarrowOHO-12.012.00180.0PASangularnarrowOHO-12.0012.0045.0315.0PSFangularnarrowOHO-8.48.445.0315.0PASangularnarrowOHO-12.0012.00-135.0135.0PSFangularnarrowOHO-8.48.4-135.0135.0PASangularnarrowOHO-10.5010.500.0360.0PSFangularnarrowOHO-5.95.90.0360.0PASangularnarrowOHO-10.5010.50-180.0180.0PSFangularnarrowOHO-5.95.9-180.0180.0PSFangularnarrowOHH-12.012.00180.0PASangularnarrowOHH-12.0012.0045.0315.0PSFangularnarrowOHH-7.257.2545.0315.0PASangularnarrowOHH-12.0012.00-135.0135.0PSFangularnarrowOHH-7.257.25-135.0135.0PASangularnarrowOHH-10.5010.500.0360.0PSFangularnarrowOHH-5.95.90.0360.0PASangularnarrowOHH-10.5010.50-180.0180.0PSFangularnarrowOHH-4.354.350.0360.0PASangularnarrowOHH-7.3757.3750.0360.0PSFangularnarrowOHH-5.95.9-180.0180.0PASangularnarrowOHH-7.3757.375-180.0180.0PSFangularnarrowOHH-4.354.35-180.0180.0