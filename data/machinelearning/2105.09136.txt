2
2
0
2

n
a
J

3
1

]

G
L
.
s
c
[

3
v
6
3
1
9
0
.
5
0
1
2
:
v
i
X
r
a

Periodic Freight Demand Estimation for
Large-scale Tactical Planning

Greta Laagea,b,*, Emma Frejingerc,b, Gilles Savarda,d

a Department of Mathematics and Industrial Engineering, École Polytechnique de Mon-
tréal
b CIRRELT
c Department of Computer Science and Operations Research, Université de Montréal
d IVADO

Abstract

Freight carriers rely on tactical planning to design their service network to sat-
isfy demand in a cost-effective way. For computational tractability, deterministic
and cyclic Service Network Design (SND) formulations are used to solve large-
scale problems. A central input is the periodic demand, that is, the demand ex-
pected to repeat in every period in the planning horizon. In practice, demand is
predicted by a time series forecasting model and the periodic demand is the av-
erage of those forecasts. This is, however, only one of many possible mappings.
The problem consisting in selecting this mapping has hitherto been overlooked in
the literature. We propose to use the structure of the downstream decision-making
problem to select a good mapping. For this purpose, we introduce a multilevel
mathematical programming formulation that explicitly links the time series fore-
casts to the SND problem of interest. The solution is a periodic demand estimate
that minimizes costs over the tactical planning horizon. We report results in an
extensive empirical study of a large-scale application from the Canadian National
Railway Company. They clearly show the importance of the periodic demand es-
timation problem. Indeed, the planning costs exhibit an important variation over
different periodic demand estimates and using an estimate different from the mean
forecast can lead to substantial cost reductions. Moreover, the costs associated
with the periodic demand estimates based on forecasts were comparable to, or
even better than those obtained using the mean of actual demand.

Keywords Freight transportation, tactical planning, large-scale, periodic demand,
forecasting demand.

1

Introduction

Freight transportation is essential to society and its economic development. In order
to satisfy demand in a cost-effective way, freight carriers are faced with a multitude
of planning problems. In this context, Service Network Design (SND) is an important

*Corresponding author.
E-mail addresses: greta.laage@polymtl.ca (G. Laage)

1

 
 
 
 
 
 
class of problems. Consider, for example, the Multicommodity Capacitated Fixed-
charge Network Design (MCND) problem (Magnanti and Wong, 1984). The objective
is to design a capacitated network – a tactical plan – allowing to transport demand for a
set of commodities between different origin-destination pairs at a minimum cost. The
latter is given by the sum of ﬁxed and variable costs. The tactical plan is deﬁned over a
given period (e.g., a week) and is repeated over a planning horizon (e.g., a few months).
Given this cyclic nature of the tactical plan, it relies on an accurate representation of
periodic demand, i.e., demand that repeats in each period.

In any realistic setting, demand for commodities is subject to uncertainty. This has
naturally led to stochastic SND formulations (e.g., Crainic et al., 2020). As even deter-
ministic SND problems are NP-hard, stochastic formulations are limited to fairly small
size problems and cannot yet be used in most real large-scale applications. Hence, a
wealth of applications in practice relies on deterministic formulations and point esti-
mates of periodic demand. We focus on the problem of deﬁning such periodic demand
for large-scale deterministic SND formulations. It has been overlooked in the literature
since most of the work on SND focus on the optimization problem only (demand is
assumed to be ﬁxed and known in numerical studies). In practice, demand is typically
predicted by a time series forecasting model and the periodic demand is the average of
those forecasts.

The key motivation behind our work resides in the mapping from time series fore-
casts to periodic demand. Indeed, the average is merely one, out of many possible
mappings. If the SND problem is sensitive to extreme demand values, selecting an-
other mapping than the average, such as the third quartile, could lead to cost reductions.
Despite its potential importance, there is no study in the literature focusing on the pe-
riodic demand estimation problem linking time series forecasts to the tactical planning
problem of interest. Our work addresses this gap, and we use a MCND formulation for
illustration purposes.

The impact of demand forecast errors on revenue has been studied in the context
of airline revenue management. Through simulation analysis in a simpliﬁed setting,
Weatherford and Belobaba (2002) show that reducing demand forecast errors by 25%
increase revenue by a minimum of 1-2%. Fiig et al. (2019) conﬁrm those ﬁndings in a
more complex airline revenue management setting and show that reduced forecast er-
rors lead to increased revenue. As opposed to passenger transportation, freight carriers
typically have ﬂexibility regarding the routing of demand as long as it respects certain
constraints, such as delivery time. Moreover, the freight demand origin-destination
matrices are often unbalanced, meaning that there can be excess supply in certain di-
rections. It implies that the cost associated with demand forecast errors can vary over
commodities. This further motivates the importance of linking the periodic demand
estimation and the corresponding SND problem.

Our proposed methodology to address the periodic demand estimation problem
proceeds in two steps: First we forecast demand for a given set of commodities for each
period of the planning horizon. This corresponds to a multivariate multistep time series
forecasting problem. In the second step, we solve a mathematical program whose so-
lution is the periodic demand that minimizes ﬁxed and variable costs over the planning
horizon. It is based on mappings from the time series forecasts to periodic demand.
Different mappings correspond to different periodic demand estimates. We propose to
use the structure of the downstream SND problem when selecting the mapping. The
proposed mathematical program hence explicitly links the mappings to the SND for-
mulation (in our case MCND).

2

1.1 Review of Work Related to Freight Demand Forecasting

The multivariate multistep time series forecasting problem in the ﬁrst step of our meth-
odology is particularly challenging for three main reasons. First, forecasting models
rely on historical data that result from operational decisions. Hence, the demand data
are constrained by available capacity. This means that demand recorded in the data may
not correspond to actual demand. In the literature this is referred to as truncated or cen-
sored data depending on how the data are constrained by the supply. Second, there are
a large number of commodities and a relatively long forecasting horizon which can
lead to spatiotemporal correlations. Third, the demand varies over time and long-term
dependencies and seasonality can be speciﬁc to each commodity. This highlights the
potential need for modeling both commodity speciﬁc behavior and correlations be-
tween commodities. There is an extensive body of literature on censored / truncated
data and time series forecasting. In this work we do not propose methodological con-
tributions to this literature. Rather, we use existing models to analyze the performance
of our periodic demand estimation methodology. For this purpose, we provide next a
brief and high-level view of the literature where we ﬁrst discuss censored and truncated
data, followed by time series forecasting.

Truncated or censored data arise in a broad variety of applications in different disci-
plines (e.g., engineering, sociology and economics). In our case, truncated data refer to
demand records that are missing, for example, due to a transport service being unavail-
able. On the contrary, censored data refer to partially observed demand, for example,
when the capacity of a given service is reached. Ignoring related issues may result in
positively or negatively biased forecasts depending on the type of censoring or trunca-
tion (see, e.g., Queenan et al., 2007; Vulcano et al., 2012; Azadeh et al., 2014; Weath-
erford, 2016, for an in-depth discussion of these issues and an overview of methods
with application in revenue management).

The literature identiﬁes essentially two broad ways to deal with censored or trun-
cated data (Queenan et al., 2007). First, adapt the data capture process. This can consist
in capturing additional data (e.g., lost sales) or to aggregate data records such that they
are no longer censored or truncated. In this paper we adopt an aggregation approach
and we provide a motivation for this choice in Section 3.1. The second and more so-
phisticated approach consists in deﬁning a statistical method whose aim is to recover
the latent – unobserved – distribution generating the observations. Many of the exist-
ing methods are rooted in statistical survival analysis (e.g., Klein and Moeschberger,
2005). Unfortunately, standard methods are based on independence assumptions that
typically do not hold in a transportation setting due to its intrinsic challenges (Fields
et al., 2021). Namely, (i) censoring/truncation is common (ii) demand for different
commodities impact each other as they share the same capacity (iii) alternative trans-
port services (substitutes) are common which result in so-called recapture (demand for
second-best options) and spill (demand is lost to competition). Because of these chal-
lenges, specialized methods are required. Fields et al. (2021) propose such a method
and they also provide an excellent literature review with a focus on transport applica-
tions.

We now turn our attention to the extensive body of literature in statistics and ma-
chine learning dealing with time series forecasting. Statistical methods have focused
on parametric models informed by domain expertise, such as autoregressive processes,
moving averages (Box et al., 2015), and exponential smoothing (Gardner Jr, 1985).
Methods have been developed for univariate seasonal time series, such as seasonal
ARIMA (Box et al., 2015) and Holt Winter’s method (Holt, 2004; Winters, 1960). Vec-

3

tor autoregressive (VAR) models extend the autoregressive (AR) models to multivari-
ate time series prediction problems (Lütkepohl, 2013). They capture interrelationships
among multiple variables, and Vector Error-Correction (VEC) models are preferably
used when the time series are cointegrated. However, the number of parameters in
VAR and VEC models is large for problems with many variables. This can lead to un-
certainty in the estimation of the parameters which, in turn, may lead to inaccurate pre-
dictions (Litterman, 1986). More recently, the machine learning (Ahmed et al., 2010)
and deep learning (Goodfellow et al., 2016) literature have provided non-parametric
models that learn temporal dynamics in a data-driven manner. The capacity of neural
networks to model complex data to forecast, for instance, trafﬁc ﬂows is increasingly
exploited (Nguyen et al., 2018). The Long Short-Term Memory (LSTM) recurrent neu-
ral network (Hochreiter and Schmidhuber, 1997; Sutskever et al., 2014) is a successful
architecture to model both short-term and long-term dependencies (Längkvist et al.,
2014). Nevertheless, empirical evidence suggests that it is still hard to achieve a level
of accuracy comparable to that of classic time series models (e.g., Makridakis et al.,
2018) often due to limited data quantity.

Both models from machine learning and statistics have been used and compared for
a variety of applications, including transportation (Karlaftis and Vlahogianni, 2011). In
this context we distinguish studies focusing on one particular carrier (our setting) from
those studying freight ﬂow from a transport system perspective. In the latter case, they
often consider a strategic setting requiring long-term demand forecasts (e.g., De Jong
et al., 2004; Cambridge, 2008; Chow et al., 2010). The literature focusing on a speciﬁc
freight carrier and, in particular, on intermodal transportation is scarce. A few works
have, however, focused on forecasting intermodal demand over small networks of port
terminals (Milenkovi´c et al., 2019) with either statistical models (Schulze and Prinz,
2009) or neural networks (Tsai and Huang, 2017).

1.2 Contributions

This paper offers both methodological and empirical contributions. First, we formally
introduce the periodic demand estimation problem and propose a two-step methodol-
ogy. The core methodological contribution resides in the problem deﬁnition and the
formulation used in the second step. More precisely, based on time series forecasts ob-
tained in the ﬁrst step, we propose a multilevel mathematical programming formulation
whose solution is a periodic demand estimate that minimizes ﬁxed and variable costs.
The formulation hence explicitly links the periodic demand estimates to the tactical
planning problem of interest. Under weak assumptions, it is computationally tractable
as it can be solved sequentially to optimality.

Second, we describe a real large-scale application for intermodal (container) trans-
portation at the Canadian National Railway Company (CN) – one of the largest rail-
roads in North America. We use the MCND formulation proposed by Morganti et al.
(2020) for a block planning problem. They focused on the SND problem – supply
optimization – and treated demand as ﬁxed and known using historical values. Unlike
them, we focus on periodic demand estimates obtained from forecasts, i.e., the input
to the MCND formulation. The methodological and empirical contributions are there-
fore distinct from those of Morganti et al. (2020). We present an extensive empirical
study clearly showing the importance of the periodic demand estimation problem. To
assess the sensitivity to different forecasting models and related error distributions, we
compare forecasting models from the statistics and deep learning literature. In turn, we
analyze the impact of the deﬁnition of periodic demand distinguishing between time

4

series forecast errors and the errors introduced by different periodic demand estimates.
Moreover, we benchmark against the approach used in practice that consists in averag-
ing time series forecasts.

1.3 Paper Organization

The remainder paper is structured as follows. Next, we formally introduce the periodic
demand estimation problem. In Section 3, we describe the proposed two-step method-
ology. We then focus on empirical results, ﬁrst introducing our application in Section 4,
followed by the results in Section 5. Finally, Section 6 concludes and outlines some
directions for future research.

2 Problem Description

We start by brieﬂy summarizing the planning process we consider (see illustration in
Figure 1), taking the point of view of a freight carrier wishing to deﬁne a tactical plan.
First, the carrier estimates the periodic demand for each commodity over the tactical
planning horizon. Second, the periodic demand estimates are used as an input to solve
the tactical planning problem of interest. The latter involves design decisions that are
ﬁxed over the tactical planning horizon, and ﬂow decisions in each period. The tactical
level is framed with a red, dashed, line in Figure 1. At the operational level (framed
with a blue, dotted, line in the ﬁgure) the tactical plan is adjusted – i.e., the ﬂow deci-
sions – according to actual demand realizations. In addition to these adjustments, other
decisions could be taken to cope with demand ﬂuctuations, such as outsourcing. There
are hence two sources of costs to consider in the tactical planning process: the ﬁxed
cost of the tactical plan (design decisions) and the variable cost (ﬂow and outsourcing
decisions) resulting from the adjustments in each period. Our objective, illustrated in
the ﬁgure with a thick orange left arrow, is to use the information from the planning
problem to estimate the periodic demand that minimizes the tactical costs.

Tactical planning

Operational planning

Demand in
each period

Demand
Forecasting
Problem

Periodic
Demand
Estimation

Service
Network
Design

Adjustments
to the
tactical plan

Figure 1: Tactical and operational planning processes of a freight carrier

We attend to large-scale problems that require a deterministic formulation of the
SND problem to be computationally tractable. Therefore, at the tactical planning level,
demand is treated as ﬁxed and known while, in reality, it varies in each period. In this
section we describe in detail the problem of estimating the periodic demand so as to
minimize ﬁxed and variable costs. We ﬁrst introduce notation related to the tactical and
operational planning time horizons. We then deﬁne the various concepts of demand we
encounter, followed by a description of an MCND formulation. Finally, we describe

5

links between observed demand, periodic demand and the MCND formulation, which
formally introduces our problem.

For the demand forecasting problem, it is important to distinguish the tactical and
operational planning horizons. We therefore introduce two different notations related
to time. First, the tactical planning horizon T can be divided into periods of equal
length t = 1, . . . , T . Second, each period t can be further divided into D time periods,
d = 1, . . . , D, that we here refer to as the operational horizon. Figure 2 provides an
illustration where the tactical horizon is composed of T = 3 weeks, and a week t is
composed of D = 7 days.

t = 0

t = 1

d = 1

t = 2

d = 6

t = T = 3

Operational

Period

Tactical horizon T

Figure 2: Time scales for planning of a freight carrier

Let yt be the demand vector of period t, yt = (yt1, . . . , ytK)(cid:62) where ytk is the
quantity of commodity k to be transported during period t. In this context, a commodity
k is characterized by its origin ok, destination dk and type γk. We denote the set of
commodities K and its cardinality K. Let yt
d be the demand vector for each operational
d = (yt
time d = 1, . . . , D, within period t, yt
dk is the demand
for commodity k to be carried at time d in period t. The demand for a period t is hence

dK)(cid:62) where yt

d1, . . . , yt

ytk =

D
(cid:88)

d=1

yt
dk,

k ∈ K.

(1)

Furthermore, we introduce the demand matrix for horizon T , YT ∈ RT ×K
, with
[YT ]tk = ytk. For a given tactical planning horizon T , the plan is repeated at each
t = 1, . . . , T . Let ypT be the periodic demand vector for tactical horizon T , ypT =
(ypT
is the periodic demand for commodity k. To simplify the
notation, we henceforth remove the superscript T but recall that the periodic demand
and the demand matrix always refer to a given horizon.

K )(cid:62), where ypT

1 , . . . , ypT

+

k

We focus on estimating the periodic demand yp. In this context it is important to
note that time series forecasting models produce demand forecasts for each commodity
in each period t. That is, at period t0, the forecasting models output an estimate of
Y denoted ˆY which consists in T point estimates ˆyt0+1, . . . , ˆyt0+T . The periodic
k are then estimated from these forecasts ˆY, or, for validation or analysis,
demands yp
from Y. Let h denote the mapping of Y to a periodic demand vector yp:

h : RT ×K

+ → RK
+
Y (cid:55)→ yp = h(Y).

(2)

When the periodic demand is a mapping of the forecasts, we use the notation ˆyp =
h( ˆY). Our objective is to deﬁne the mapping h minimizing ﬁxed and variable planning
costs.

6

In the following we provide a more detailed motivation of our work by means of
a small example. Figure 3 has two graphs showing two demand distributions (one dot
per period) with identical mean (depicted with a solid line). The mean represents one
particular mapping yp = h(Y). However, there are many other possible mappings. In
the example, we illustrate three of those: the maximum, median and third quartile. As
opposed to the mean, these other mappings do not result in the same periodic demand
estimates in the right- and left-hand graphs. If the SND problem is sensitive to extreme
values, then one can clearly see that the third quartile or the maximum could be more
adequate mappings than the mean. The importance of ﬁnding an appropriate mapping
is the key motivation behind our work and we use the structure of the decision-making
problem of interest (SND) to guide the choice of mapping.

Figure 3: Illustration of a periodic demand from point estimates for T periods

We now introduce a path-based MCND formulation (Crainic, 2000) that we use for
illustrating our methodology. An arc-based formulation can be found, e.g., in Chouman
et al. (2017). Let G = (N , A) denote a space-time graph where N is the set of nodes
and A is the set of arcs. Commodity k uses a path p, i.e., a sequence of arcs in G.
The source node of the ﬁrst arc is ok, and the sink node of the last arc is dk. Let P
denote the set of paths. In the case of insufﬁcient capacity, demand is outsourced and
we denote P out ⊂ P the paths corresponding to outsourcing options. Furthermore,
let Pk denote the set of paths for commodity k, P out
k ⊂ Pk the outsourcing paths for
commodity k and Kp the set of commodities that can use p. Note that here we refer
to outsourcing in a broad sense. It could mean outsourcing to a third party, or making
use of additional capacity from the same carrier that was not originally part of the plan.
For example, in our intermodal rail transportation application (Section 4), outsourcing
means using capacity from non-intermodal trains.

The MCND problem consists in satisfying demand at minimum cost. It has two
categories of decision variables: Binary design variables zp, ∀p ∈ P, equal to one
if path p is used and zero otherwise, and ﬂow variables xpk ≥ 0, ∀k ∈ K, p ∈ Pk.
Depending on the type of freight (bulk versus containers, for instance), xpk could be

7

integer. The path-based mixed integer linear programming formulation is:

MCND min
z,x

(cid:88)

p∈P

C design
p

zp +

(cid:88)

(cid:88)

C ﬂow

p xpk +

k∈K

p∈Pk\P out
k

(cid:88)

(cid:88)

k∈K

p∈P out
k

C out

p xpk

(3)

s.t.

(cid:88)

p∈Pk
(cid:88)

xpk = yp
k,

xpk ≤ upzp,

k∈Kp
xpk ≥ 0,
zp ∈ {0, 1},

k ∈ K,

p ∈ P,

k ∈ K, p ∈ Pk,
p ∈ P.

(4)

(5)

(6)

(7)

The objective function (3) includes a ﬁxed design cost C design
≥ 0 for the paths built to
transport demand. The second cost is the variable ﬂow cost C ﬂow
p ≥ 0 which accounts
for satisﬁed demand and the third cost C out
is the ﬂow cost of outsourced de-
mand. Although not strictly necessary, we separate the latter two terms for the analysis
of the results in Section 5. Constraints (4) ensure that the periodic demand is satisﬁed
for each commodity. Constraints (5) enforce ﬂows on selected paths only, and that the
ﬂow does not exceed the path capacity, up.

p ≥ C ﬂow

p

p

MCND is solved to obtain a tactical plan based on a given periodic demand. How-
ever, in practice, demand varies from one period to another. The tactical plan is there-
fore adjusted at the operational planning level. That is, in each period the commodity
ﬂows can be adjusted to satisfy the actual demand value of this period also taking
into account other uncertain aspects, such as schedule delays. The observed data yt
d,
typically used for training forecasting models, result from this operational planning
process. Consequently, data at this level of detail can be constrained by the available
services and the observed demand may therefore be censored or truncated.

In summary, we focus on estimating periodic demand yp at a given time t0 for a tac-
tical planning horizon T . The demand forecasts ˆyt0+1, . . . , ˆyt0+T are obtained using
historical data of demand {ys
d, s = t0 − 1, t0 − 2, . . . , t0 − H, d = 1, . . . , Ds} where
H is the number of periods in the historical data and Ds is the number of operational
time intervals in each period s. The periodic demand should be deﬁned such that it
minimizes ﬁxed costs, as well as variable costs associated with adapting the plan over
the tactical planning horizon. It is hence necessary to link the mapping h to the tactical
planning problem of interest. In the following section, we propose a formulation for
this purpose using MCND as an example of tactical planning problem formulation.

3 Periodic Demand Estimation

Each time a tactical plan is to be deﬁned, our approach proceeds in two steps. First,
we use a time series forecasting model to predict demand for each period in the plan-
ning horizon. Second, we solve a multilevel formulation for the joint periodic demand
estimation and tactical planning problem. For the ﬁrst step we rely on state-of-the-art
forecasting models, while the second step constitutes the core of our methodological
contribution. In the following section, we describe assumptions and their implications
on the time series forecasting problem. In Section 3.2, we delineate the mathematical
programming formulation.

8

3.1 Time Series Forecasting

1k, . . . , yt

In this section we focus on the time series forecasting problem. Our objective is to
predict, at period t, T point estimates ˆyt+1, . . . , ˆyt+T . We consider a medium-term
forecasting horizon (two to three months), hence we require a tactical precision level.
However, as we highlight in the previous section, historical data capture operational
ﬂows which can be constrained by the supply. Hence, for a given t, the time series
of operational data records {yt
dk, . . . , yt
Dk} may be subject to truncation or
censoring. Moreover, the observations can be right or left censored. Consider, on
the one hand, a service that has reached its capacity and the operations are forced to
leave demand behind. This would result in a right censored observation. On the other
hand, consider the services used to transport the demand left behind, those observations
would be left censored. The setting is therefore complex, and we do not assume any
knowledge on the process leading to censoring or truncation (this prevents the use of
some existing statistical methods, such as the one proposed by Fields et al., 2021).
We note, however, that detailed data on operational decisions could provide at least
partial information on that process.
Instead, we adopt a data aggregation approach
to deal with censoring/truncation. If two weak assumptions are satisﬁed, we can use
aggregate historical uncensored data for time series forecasting.

Recall from the problem description that demand which cannot be satisﬁed by the
planned capacity is outsourced. This is typically the case for carriers as unsatisﬁed
demand would otherwise accumulate over time periods. Taking into account the out-
sourcing, demand is hence assumed satisﬁed in each time period t. This leads us to the
following assumption on the historical data.

Assumption 1 Historical data are uncensored when aggregated over time periods.
That is, ys = (cid:80)Ds

d, s = t − 1, t − 2, . . . , t − H are uncensored.

d=1 ys

If this assumption is satisﬁed, we do not need statistical uncensoring methods but ag-
gregation results in fewer data points to learn from. In this context we describe two
important trade-offs that we consider. First, the one between data quantity and vari-
ance. Using operational (e.g., daily) as opposed to aggregate data results in more ob-
servations. However, operational observations typically have higher variance. Second,
the trade-off between the prediction granularity/precision and the length of the predic-
tion horizon. We focus on tactical planning and hence forecast over a horizon that far
exceeds that of operational planning. Forecasting over a tactical horizon (e.g., two to
three months) but at an operational precision (e.g., daily) may lead to unnecessarily
large variance in prediction errors. We now introduce an assumption related to this
second trade-off.

The tactical planning problem formulation is based on a space-time graph. The
departure and arrival times of a commodity k are hence implicitly given by ok and
dk. We assume that the arrival and departure times are endogenous decisions, stated in
other words, in the following assumption.

Assumption 2 Predicted demand per time period for each commodity, ˆyt, t = 1, . . . , T ,
are sufﬁciently precise for tactical planning.

This is a weak assumption considering that, if exogenous predictions of ˆyt
d, d =
1, . . . , Dt are required for each t = 1, . . . , T , it is possible to deﬁne a model (dif-
ferent from the time series one) that projects ˆyt down to that level. We note that the
latter would require an uncensoring method.

9

3.2 A Multilevel Formulation

We deﬁne the feasible set of periodic demand vectors

Y = {ˆyp = hi(ˆy1, . . . ˆyT ), i = 1, . . . , I}

(8)

by a ﬁnite set of mappings hi, i = 1, . . . , I (2). We propose the following multilevel
formulation PDE for the periodic demand estimation problem.

PDE min
ˆyp

C PDE =

T
(cid:88)





(cid:88)

t=1

p∈P

C design
p

zp +

(cid:88)

(cid:88)

C ﬂow

p xtpk +

k∈K

p∈Pk\P out
k





C out

p xtpk

(cid:88)

(cid:88)

k∈K

p∈P out
k

s.t. ˆyp ∈ Y

MCND min
z,x

s.t.

(cid:88)

p∈P

(cid:88)

C design
p

zp +

(cid:88)

(cid:88)

C ﬂow

p xpk +

k∈K

p∈Pk\P out
k

(cid:88)

(cid:88)

k∈K

p∈P out
k

C out

p xpk

xpk = ˆyp
k,

xpk ≤ upzp,

k ∈ K,

p ∈ P,

p∈Pk
(cid:88)

k∈Kp

xpk ≥ 0,
zp ∈ {0, 1},

k ∈ K, p ∈ Pk,
p ∈ P,

wMCND

min
x1,...,xT

T
(cid:88)





(cid:88)

(cid:88)

C ﬂow

p xtpk +

t=1

k∈K

p∈Pk\P out
k





C out

p xtpk

(cid:88)

(cid:88)

k∈K

p∈P out
k

s.t.

(cid:88)

p∈Pk
(cid:88)

k∈Kp

xtpk = ˆytk,

t = 1, . . . , T, k ∈ K,

xtpk ≤ upzp,

t = 1, . . . , T, p ∈ P,

xtpk ≥ 0,

t = 1, . . . , T, k ∈ K, p ∈ Pk.

(9)

(10)

(11)

(12)

(13)

(14)

(15)

(16)

(17)

(18)

(19)

The upper level selects ˆyp that minimizes the total ﬁxed and variable costs over
the whole tactical planning horizon. The objective function (9) hence depends on the
design and ﬂow variables from the lower levels MCND and wMCND, respectively.
We note that ﬁxed costs incur in each time period as they correspond to cost associated
with running services. The objective function could, however, be easily modiﬁed to the
case where ﬁxed costs incur once over the time horizon. This multilevel formulation
allows to obtain important information for the carrier: the periodic demand ˆyp and the
plan repeated in each period. MCND and wMCND form two sequential problems.
Moreover, they have a different temporal interpretation. While MCND is a single-
period problem, wMCND is a multi-period problem (there are T periods). In Figure 1,
where the length of the planning horizon goes from medium term (left-hand side) to
short term (right-hand side), MCND corresponds to the SND problem, while wMCND
serves as a proxy for the operational planning problem (framed with a blue, dotted, line
in the ﬁgure).

In wMCND we introduce the ﬂow variables xtpk for commodity k on path p in
period t and determine ﬂows for each period minimizing variable cost (16) for a ﬁxed

10

design solution z given by MCND. Constraints (17) ensure that the demand is satisﬁed
for each commodity in each period. The set of paths Pk includes outsourcing paths
P out
for a commodity k, so constraints (12) and (17) can always be satisﬁed. Con-
k
straints (18) enforce ﬂows in each period to be only on selected paths and smaller than
the capacity of the path. We draw the attention to the time series forecasts that occur in
wMCND while the periodic demand estimates occur in MCND.

The decision variables of wMCND do not occur in the objective function (11) of
MCND. Thus, for (z∗, x∗) an optimal solution of MCND, if z∗ is feasible for wM-
CND, then z∗ is an optimal solution to MCND-wMCND. We can therefore make the
following claim.

Claim 1 If z∗ is feasible for wMCND, then MCND-wMCND can be solved sequen-
tially to optimality for a ﬁxed ˆyp.

In other words, for a given ˆyp, we ﬁrst solve MCND to obtain z∗ (and x∗). We then
solve wMCND with design variables ﬁxed to z∗, hence obtaining x∗
T . We
note that the feasibility assumption is weak, as outsourcing, albeit costly, is generally
possible in practice. When the set of paths contains such outsourcing paths, all demand
can be satisﬁed. If the feasibility assumption does not hold, it has to be solved as a
bilevel problem which is considerably more involved (see, e.g., Colson et al., 2005, for
a survey).

2, . . . , x∗

1, x∗

In this work, we consider four mappings in Y,

yp

max = h1(y1, . . . , yT ) = max
t=1,...,T

yt,

yp

mean = h2(y1, . . . , yT ) =

1
T

T
(cid:88)

t=1

yt,

(20)

(21)

(23)

(22)

yp
q2 = h3(y1, . . . , yT ) = Q2(yt, t = 1 . . . , T ),
yp
q3 = h4(y1, . . . , yT ) = Q3(yt, t = 1 . . . , T ),
representing the maximum, mean, second quartile Q2 and third quartile Q3, respec-
tively. The corresponding estimates from the forecasts are denoted ˆyp
mean, ˆyp
q2
and ˆyp
q3. Given that we consider a discrete Y of small cardinality, we ﬁnd the solution
to PDE by solving MCND-wMCND for each yp ∈ Y. The mappings may be seen
as a restriction on the full feasible space (any feasible periodic demand vector). For
a given computing time budget, there is hence a trade-off between the time it takes to
solve MCND-wMCND and the number of considered mappings. Higher quality so-
lutions may be found by increasing the number of considered mappings. The choice
of mappings can therefore be adapted to each application. As we report in Section 5,
for our application, we ﬁnd solutions that lead to substantial cost reductions using the
aforementioned mappings.

max, ˆyp

In the following section, we describe a speciﬁc instance of (9)-(19) in the context

of tactical planning for intermodal rail transportation.

4 Application

In order to apply the proposed methodology, we need an application for which we have
access to historical data on demand as well as a formulation of a SND problem. We

11

consider intermodal (container) transportation by rail at our industrial partner, CN. As
we further detail in Section 5, we have access to six years of data. Moreover, Morganti
et al. (2020) describe a speciﬁc instance of MCND designed to solve the so-called
block planning problem. However, they solely focus on the optimization problem and
take daily demand values as ﬁxed and known. In other words, they ignore the need
for demand forecasts and hence the problem we focus on in this paper. We there-
fore use their formulation as an application for our methodology. In this section we
start by brieﬂy describing CN’s operations and the formulation proposed in Morganti
et al. (2020). Then, in Section 4.1, we slightly adapt the formulation such that it takes
weekly, as opposed to daily, demand as input. Finally, in Section 4.2 we introduce the
application-speciﬁc PDE formulation.

The intermodal network of CN is composed of 24 main intermodal terminals and
133 origin-destination (OD) pairs. Figure 4 depicts a map of the network. The rail
tracks extend from Eastern to Western Canada and from Canada to Southern United
States. The railroad carries a variety of container types (20, 40, 45, 48 and 53-feet
long), yet for tactical planning purposes they can be aggregated into either 40-feet or
53-feet containers. Indeed, 20-feet containers can be considered as half-40-feet con-
tainers. Other sizes (45, 48 and 53-feet) occupy the same locations on railcars (so-
called slots, Mantovani et al., 2018) as 53-feet containers. A commodity is deﬁned by
an origin, a destination and container type, and we consider a total of K = 170 com-
modities. Two commodities can hence have the same OD pair but differ by container
type. The tactical period is a week and a tactical horizon lasts T = 10 weeks. The train
schedule is repeated each week and CN operates so that demand over a week is satis-
ﬁed. Assumption 1 therefore holds. More precisely, in case of insufﬁcient capacity on
intermodal trains, they use general cargo trains or additional ad hoc intermodal trains
to satisfy demand.

Figure 4: Intermodal Network of the Canadian National Railway Company. Source:
www.cn.ca

Morganti et al. (2020) introduce a path-based Block Planning formulation (BP)
which is a speciﬁc instance of MCND. A block refers to a consolidation of railcars.

12

In this context, a block is a set of railcars ﬂowing as a single unit between a given OD
pair and where containers loaded on the railcars have the same OD. The formulation
is deﬁned based on a space-time graph generated from a schedule of intermodal trains
and CN’s physical network. The graph contains 28,854 arcs and 15,269 nodes. A
block is a path in this graph and the set is denoted B with |B| = 2, 208. We keep this
notation to be consistent with Morganti et al. (2020) but note that the set B corresponds
to the set of paths P in MCND. The set B contains a subset of artiﬁcial blocks Bartif
whose role is to transport demand exceeding capacity. They hence correspond to the
outsourcing paths. They are built without design cost, i.e., C design
= 0, ∀b ∈ Bartif.
Similarly to MCND, Bk and Bartif
denote respectively the set of blocks and the set of
artiﬁcial blocks for commodity k, and Kb the set of commodities that can use b.

k

b

Below we brieﬂy describe BP and refer to Morganti et al. (2020) for more details.
There are three categories of decision variables. First, the design variables zb, b ∈
B where zb equals one if block b is built, and zero otherwise. Second, integer ﬂow
variables xbk, k ∈ K, b ∈ Bk that equal the number of containers for commodity k
transported on block b. Third, auxiliary variables for the number of 40-feet v40
b and
53-feet v53
b double-stack platforms to carry the containers assigned to block b ∈ B.

BP min
x,z

s.t.

(cid:88)

C design
b

zb +

(cid:88)

(cid:88)

C ﬂow

bk xbk +

b∈B\Bartif
(cid:88)

xbk = yp
k,

k∈K

b∈Bk\Bartif

k

(cid:88)

(cid:88)

k∈K

b∈Bartif

k

C out

bk xbk

k ∈ K,

(24)

(25)

b∈Bk
xbk ≤ yp

kzb,


v53
b = max

0,







1
2





(cid:88)

xbk −

(cid:88)

k∈Kb,τk=53

k∈Kb,τk=40

v40
b =

(cid:38)

1
2

(cid:32)

(cid:88)

(cid:33)(cid:39)

xbk

− v53
b ,

(cid:88)

(cid:0)L40v40

k∈Kb
b + L53v53
b

(cid:1) ≤ ua,

b∈Ba
zb ∈ {0, 1},
b ∈ N,
v40
b , v53
xbk ∈ N,

k ∈ K, b ∈ Bk, (26)






xbk

 ,






b ∈ B,

b ∈ B,

a ∈ AT M ,

b ∈ B,

b ∈ B,
k ∈ K, b ∈ Bk.

(27)

(28)

(29)

(30)

(31)

(32)

The objective function (24) minimizes ﬁxed and variable costs as well as a variable
cost associated with outsourced demand (ﬂow on artiﬁcial blocks). Constraints (25)
ensure that the demand is satisﬁed by either the network capacity or outsourcing. Con-
straints (26) enforce ﬂows to be on selected blocks only. Constraints (27) and (28)
ﬁx the number of platforms required to transport the demand. These constraints take
into account how containers of different sizes can be double stacked. Since 40-feet
platforms use less train capacity than 53-feet platforms, they are used whenever there
are less 53-feet containers than 40-feet ones (40-feet container stacked in the bot-
tom position and 53-feet container on top), and 53-feet platforms are used otherwise.
Constraints (29) ensure that the train capacity, expressed in number of feet, is not ex-
ceeded. The platform lengths are denoted L40 and L53, respectively. The train capac-
ity, ua, a ∈ AT M , is deﬁned for the set of arcs in the space-time graph that represent

13

moving trains, AT M . We denote by Ba the set of blocks that use train moving arc
a ∈ AT M .

Finally, we give an order of magnitude of the size of the formulation BP. In the
case of the instances we solve in this paper, there are over 386,000 variables and some
18,000 constraints.

4.1 Block Generation For Weekly Demand Inputs

While the tactical plan is computed for a weekly schedule, Morganti et al. (2020) as-
sume that the time at which the demand arrives to the system within the week is given
exogenously. We provide an illustrative example in Figure 5a. Demand enters the net-
work via a node noted DIN which is associated to one admissible train departure node.
Containers are either assigned to a block, or wait at the terminal, represented by ﬂow
on arcs called ContainersWaiting.

Under Assumption 2, we propose a slightly different block generation so that the
model optimally distributes the weekly demand over the train departures. For this
purpose, we introduce a new set of nodes N WIN such that there is one node WIN
∈ N WIN per terminal θ ∈ Θ, where Θ is the set of terminals in the network. We
nWIN
θ
also introduce a new set of arcs AWIN = {(nWIN
}, where N DIN
is the set of DIN nodes for terminal θ.

, j) | θ ∈ Θ, j ∈ N DIN

θ

θ

θ

We illustrate this change compared to Morganti et al. (2020) in Figure 5b. For each
terminal, the node WIN receives the weekly demand input and splits the commodity
ﬂow to the different DIN nodes on the arcs AWIN at no cost. Instead of arriving at
different points in time, demand now arrives in one source node and the model selects
the optimal distribution over the week.

DIN

DIN’

a ∈ AWIN

a(cid:48) ∈ AWIN

DIN

ContainersWaiting

DIN’

nWIN
θ

Daily
Demand In

Daily
Demand In

Weekly
Demand In

(a) Morganti et al. (2020)

(b) Our model

Figure 5: Illustration of the difference between Morganti et al. (2020) and our model

4.2 Periodic Demand Estimation Problem

In this section we present the application-speciﬁc PDE formulation. The MCND for-
mulation is replaced by BP. The formulation has two differences compared to Morganti
et al. (2020). First, we change the block generation as described in Section 4.1. Sec-
ond, and more importantly, demand is represented by ﬁrst level decision variables ˆyp as

14

opposed to parameters representing ground truth demand values. Moreover, we intro-
duce a weekly ﬂow formulation, wBP. For this third level we introduce ﬂow variables
and auxiliary platform variables for each week t, xtbk, v40
tb , t ∈ T , k ∈ K, b ∈ B.

tb , v53

PDE BP min
ˆyp

CPDE =






T
(cid:88)

t=1

(cid:88)

Cdesign
b

zb +

(cid:88)

(cid:88)

Cﬂow

tbk xtbk +

(cid:88)

(cid:88)

Cout

tbkxtbk

b∈B\Bartif

k∈K

b∈Bk\Bartif

k

k∈K

b∈Bartif

k






s.t. ˆyp ∈ Y,

BP min
x,z

(cid:88)

Cdesign
b

zb +

(cid:88)

(cid:88)

Cﬂow

bk xbk +

(cid:88)

(cid:88)

Cout

bk xbk

b∈B\Bartif

k∈K

b∈Bk\Bartif

k

k∈K

b∈Bartif

k

(cid:88)

s.t.

xbk = ˆyp
k,

k ∈ K,

b∈Bk
xbk ≤ ˆyp

v53
b = max

kzb,

0,







1
2





(cid:88)

xbk −

(cid:88)

k∈Kb,τk=53

k∈Kb,τk=40

xbk








 ,

k ∈ K, b ∈ Bk,




v40
b =

(cid:88)









1
2

(cid:88)

− v53
b ,

xbk








(cid:0)L40v40




k∈Kb
(cid:1) ≤ ua,
b + L53v53
b

b∈Ba
zb ∈ {0, 1},
v40
b , v53
b ∈ N,
xbk ∈ N,

wBP

min
x1,...,xT






T
(cid:88)

(cid:88)

t=1

k∈K

b ∈ B,

b ∈ B,

a ∈ AT M ,

b ∈ B,

b ∈ B,
k ∈ K, b ∈ Bk,


(cid:88)

Cﬂow

tbk xtbk +

b∈Bk\Bartif

k

(cid:88)

b∈Bartif

k

Cout

tbkxtbk




(cid:88)

s.t.

xtbk = ˆytk,

b∈Bk
xtbk ≤ ˆytkzb,

t ∈ T , k ∈ K,

(45)

t ∈ T , k ∈ K, b ∈ Bk,

v53
tb = max


0,











1
2

(cid:88)

xtbk −

(cid:88)

k∈Kb,τk=53

k∈Kb,τk=40





xtbk








 ,

v40
tb =

(cid:88)









1
2






(cid:0)L40v40

(cid:88)

xtbk



k∈Kb
tb + L53v53
tb

− v53
tb ,




(cid:1) ≤ ua,

b∈Ba
v40
tb , v53
xtbk ∈ N,

tb ∈ N,

t ∈ T , b ∈ B,

t ∈ T , b ∈ B,

t ∈ T , a ∈ AT M ,

(49)

t ∈ T , b ∈ B,
t ∈ T , k ∈ K, b ∈ Bk.

(50)

(51)

(33)

(34)

(35)

(36)

(37)

(38)

(39)

(40)

(41)

(42)

(43)

(44)

(46)

(47)

(48)

The objective function (33) has the same structure as (9), with design costs, ﬂow costs
and outsourcing costs. We note that we deﬁne BP (35)-(43) using periodic demand
ˆyp, while we deﬁne wBP (44)-(51) for ﬁxed design variables and weekly demand ˆyt.

15

Furthermore, there is no ﬁxed cost associated with b ∈ Bartif. Therefore, a solution for
BP is always feasible for wBP. Using Claim 1, we can solve BP-wBP sequentially.

5 Computational Results

Our dataset contains the observed daily container shipments of all types of containers
on each OD pair of the rail network, collected over 6 years, from December 2013
to November 2019. The tactical plan is weekly. To ensure the observed demand is
not constrained by the supply, we do a weekly aggregation of 2,226 observations of
daily demand for each commodity. This results in 318 observations per commodity.
Hence, ytk refers to the number of containers of type τk to be carried from origin ok to
destination dk during week t.

In this section, we ﬁrst provide a descriptive analysis of the data. We report the
results of the time series forecasting models in Section 5.2. Finally, in Section 5.3 we
report results for the periodic demand estimation problem. Note that, for conﬁdentiality
reasons, we only report relative numbers in all results.

5.1 Descriptive Analysis

The large size of the transportation network and the large number of commodities sug-
gest the presence of spatio-temporal correlation. We provide here an analysis of the
different types of correlations we identiﬁed: between commodities and between com-
modities and weather.

5.1.1 Correlation Between Commodities

We start by analyzing interweek correlation by computing, for each commodity, esti-
mates of the Pearson correlation coefﬁcient between weekly shipments over successive
weeks. Figure 6a presents the distribution of the coefﬁcient over the commodities for
lags from 1 to 10 weeks. It shows that there are substantial positive correlations be-
tween weeks for all commodities. Correlations are strong between successive weeks
and are slightly weaker for longer lags.

We now turn our attention to intercommodity correlations. For each pair of com-
modities, we compute estimates of the Pearson correlation coefﬁcient between weekly
shipments over successive weeks. We present in Figure 6b the distribution of those
correlations for lags from 1 to 10 weeks. There are 170 commodities, hence 28,730 in-
tercommodity correlation coefﬁcients to examine at each lag. Correlations vary across
pairs of commodities. Some are large (positive or negative) for short and longer lags,
while 50% of the pairs have a weak correlation between -0.2 and 0.2. Outliers at each
time lag represent 9% of the signiﬁcant coefﬁcients.

In summary, the data shows evidence of two types of correlation: strong positive
interweek correlation between the weekly shipments over successive weeks, and strong
intercommodity correlation between the weekly shipments of different commodities.
Interweek correlation highlights the potential need for an autoregressive model while
intercommodity correlation highlights a potential need for a model able to learn various
dependence structures from the data.

16

(a) Distribution of interweek correlations

(b) Distribution of intercommodity correlations

over commodities.

over commodities.

Figure 6: Distribution of the Pearson correlation coefﬁcient for the two different types
of correlations. We consider only the coefﬁcients which met the 95% conﬁdence level
threshold and we indicate their proportion in parentheses.

5.1.2 Correlation Between Demand and Weather

Weather can be an important aspect for rail freight transportation, especially in North
America where railways extend over the subcontinent which is subject to major weather
disruptions such as snowstorms. To assess the importance of weather on shipments,
we use meteorological data and estimate the Pearson correlation coefﬁcient between
weekly shipments and several weather indicators. The data comes from National
Oceanic and Atmospheric Administration (NOAA, https://www.ncdc.noaa.gov/) for
terminals in the United States and from Statistics Canada (https://www.statcan.gc.ca)
for terminals in Canada. More precisely, we use the average daily temperature and to-
tal daily snowfall in centimeters for the main 17 terminals for the complete time range
covered by the data. We compute the weekly temperature as the average temperature
over the week and the accumulated snow (cm) as the sum of the daily values. For
each terminal, at each week t, we sum the total departing and arriving demand over all
commodities.

Figure 7 shows the distribution over the terminals of the Pearson correlation coef-
ﬁcient between accumulated snow over week t and departing and arriving demand at
week t + lag. We note a negative correlation for both arriving and departing demand
for successive weeks. It is weaker for longer lags.

We present in Figure 8 the distribution over the terminals of the Pearson correlation
coefﬁcient between the average temperature and the demand arriving or departing over
terminals. It shows an average positive correlation between demand and temperature
which is weaker for longer lags. Some terminals have, however, negative correlations.
This can be explained by a seasonality effect. On the one hand, summer and spring are
busier periods for most ODs and temperatures are higher than the rest of the year. On
the other hand, for import terminals, fall and the Chinese New Year are busier periods
when temperatures are lower.

Correlation between demand and weather highlights the potential need for a fore-
casting model which can include weather features. In the following section, we present
forecasting results for different forecasting models, ranging from very simple ones

17

(a) Departing Demand

(b) Arriving Demand

Figure 7: Distribution of the Pearson correlation coefﬁcient between accumulated snow
over week t and demand (arriving and departing) at week t + lag over all the terminals.
We consider only the coefﬁcients which met the 95% conﬁdence level threshold and
we indicate their proportion in parentheses.

(a) Departing Demand

(b) Arriving Demand

Figure 8: Distribution of the Pearson correlation coefﬁcient between average tempera-
ture at week t and demand (arriving and departing) at week t+lag over all the terminals.
We consider only the coefﬁcients which met the 95% conﬁdence level threshold and
we indicate their proportion in parentheses.

18

based on strong independence assumptions to neural networks that relax some of those
assumptions.

5.2 Time Series Forecasting Results

Time series forecasts serve as input to the PDE problem. We therefore aim to assess the
sensitivity with respect to this input. For this purpose we train models of different types:
one statistical model (a basic autoregressive process, AR) and two machine learning
models (a feed-forward neural network, FFNN, and a recurrent neural network, RNN).
In the context of our application, there are advantages and drawbacks associated with
each of the models. The purpose here is not to ﬁnd the best possible forecasting model.
Rather, we aim to assess the impact on the periodic demand estimates (hence the output
of our methodology) of different types of models exhibiting different forecast error
distributions. Based on the results reported in this section we retain two speciﬁc models
that are used to solve the PDE problem (this is the focus of Section 5.3). Demand
forecasting is known to be an inherently hard task with relatively large errors. In order
to assess if this is also the case here, we include a naive baseline model (CONSTANT).
If prediction errors are large for a naive model, and it is hard to improve upon this
baseline, then this can be an indication that the prediction task is hard.

In the following we provide some details on the data used for training and testing,
and then we describe the models. Section 5.2.1 outlines our forecast accuracy measures
and we report results in Section 5.2.2.

We divide the dataset into a training, validation and test sets. Time series fore-
casting models require the last seen observed data before predicting the demand to
come. Thus, we use the ﬁrst ﬁve years of data for training (December 2013 - Decem-
ber 2018), the next four months of data for validation (January 2019 - April 2019) and
the last seven months (May 2019 - November 2019) for testing. At each week t0 in
the dataset, we forecast demand for all commodities for t = t0 + 1, . . . , t0 + T . We
consider T = 10 weeks. To simplify the notation, we assume t0 = 0 and refer to the
estimates by t = 1, . . . , T .

CONSTANT This is the simplest possible model. It is based on the assumptions that
commodities k ∈ K are independent and that the demand from observed week t0 is the
forecasts for the next T weeks:

ˆy1 = · · · = ˆyT = y0.

(52)

AR For each commodity, we ﬁt a basic autoregressive AR(p) process on the training
data. This implies that the commodities are treated as independent. We use the esti-
mated coefﬁcients ˆφ = ( ˆφ1, . . . , ˆφp)T to compute the forecasts on the test set. The
multistep forecasts for t > 1 are obtained using

ˆytk = ˆφ1k ˆyt−1,k + · · · + ˆφtky0k + · · · + ˆφpkyt−p,k.

(53)

FFNN and RNN We leverage the capacity of these models to forecast demand for
multiple commodities simultaneously. As opposed to CONSTANT and AR, they relax
the independence assumption on the commodities. We build one main neural network
architecture described in Figure 9. It is composed of 2 inputs layers, a stack of hidden
dense or recurrent layers and one output layer. We consider several variants of this
architecture. When the layers in the grey square are dense (or feed-forward), it forms

19

the feed-forward architecture (FFNN). When the layers are LSTM, it forms the recur-
rent architecture (RNN). The dimension of the output layer is equal to the number of
commodities that we predict simultaneously.

LINEAR
LAYER

INPUT
LAYER 1

INPUT
LAYER 2

HIDDEN
LAYERS

OUTPUT
LAYER

Figure 9: Neural network architecture

At each period t0, the output layer computes the forecast for the next time step
t0 + 1. Input Layer 1 is dedicated to external data such as weather features to model the
correlation between demand and weather. Input Layer 2 is dedicated to the autoregres-
sive modeling. It takes as input the demand of the previous weeks of all commodities,
either observed or forecasted. When we generate the multistep demand forecasts, for
Input Layer 2, we use ˆyt0+1 to forecast demand at t0 + 2, ˆyt0+1 and ˆyt0+2 for t0 + 3,
until t0 + T with ˆyt0+1, . . . , ˆyt0+T −1.

We evaluate several variants of the architecture to model the spatiotemporal cor-
relations and the correlation with weather. They differ depending on the considered
input data: lagged observed/forecasted demand and/or weather features. To train, vali-
date and test the model, we use real observed weather data described in Section 5.1. At
prediction time, such information is not available and we would then rely on weather
forecasts. These results are hence designed to assess the potential for weather-related
features in an optimistic setting in regards to their accuracy.

Forecasting 170 commodities simultaneously requires a rich and large dataset. Our
dataset is fairly limited as it contains only 318 weekly demand data points for each
commodity. To facilitate the forecasting task, we create a partition of K and train
a neural network for each set of the partition. For this purpose, we split the set of
commodities into 2 subsets: K53 which contains commodities of 53-feet container type
and K40 which contains commodities of 40-feet container (|K53| = 58 and |K40| =
112). Table 1 summarizes the model variants. Their names include a letter “W” if
weather features are used to train the model, and “SPLIT” to indicate a partition of K.

Commodities Weather features Autoregressive Features

RNN
FFNN
RNN-W
FFNN-W
RNN-W-SPLIT1
RNN-W-SPLIT2
FFNN-W-SPLIT1
FFNN-W-SPLIT2

K
K
K
K
K53
K40
K53
K40

(cid:88)
(cid:88)
(cid:88)
(cid:88)
(cid:88)
(cid:88)

(cid:88)
(cid:88)
(cid:88)
(cid:88)
(cid:88)
(cid:88)
(cid:88)
(cid:88)

Table 1: Features and set of commodities for each variant of the neural network archi-
tecture evaluated

The neural networks are trained with the backpropagation algorithm and the stochas-
tic gradient descent using a Mean Squared Error (MSE) loss. For each model, we do a
hyperparameter search with the Tree of Parzen Estimators implemented in the python

20

library Hyperopt (Bergstra et al., 2013). We select the set of hyperparameters which
minimizes the MSE on the validation dataset. We report the detailed input features and
the chosen set of hyperparameters for each trained model in the Appendix (Table 8).

5.2.1 Forecast Accuracy Measures

We measure the accuracy on the test set with two metrics:
Percentage Error (WAPE)

the Weighted Absolute

(cid:80)

WAPEk =

t0∈Dtest
(cid:80)

(cid:80)T

t=1 |yt0+t,k − ˆyt0+t,k|
t=1 yt0+t,k

(cid:80)T

t0∈Dtest

× 100, k = 1, . . . , K,

(54)

where Dtest is the test set of size N , and the Root Mean Squared Error (RMSE)

RMSEk =

(cid:118)
(cid:117)
(cid:117)
(cid:116)

1
N × T

(cid:88)

T
(cid:88)

t0∈Dtest

t=1

(yt0+t,k − ˆyt0+t,k)2, k = 1, . . . , K.

(55)

The WAPE is a weighted version of the Mean Absolute Percentage Error (MAPE)
which handles small or zero demand values. Low demands are frequent in our data for
some commodities with sparse demand over the year. Hence the importance of having
a metric independent to the scale of the time series such as WAPE. The RMSE is also
an important metric to consider, as it puts a high weight on large errors.

5.2.2 Results

Table 2 reports the performance metrics averaged over all commodities. We note that
the metrics for models based on a partition of the commodities (SPLIT) are averaged
over the partitions. The results show that the AR model has the best performance
and it is considerably better than the NN models. The CONSTANT baseline has a
WAPE close to AR but a considerably worse RMSE. The fact that the errors are overall
large and that the performance of CONSTANT is close to the other models in terms of
WAPE, is an indication that the prediction task is hard.

The descriptive statistics in Section 5.1.1 show strong intercommodity correlations.
Nevertheless, the AR model, based on the assumption that demands for commodities
are independent, performs better than the NN models where this assumption is relaxed.
Neural networks have more parameters to ﬁt on the same limited data. While they
have the capacity to model non-linear relationships, they also require more data to be
trained. We believe that our data containing only 318 observations for each commodity
is too limited for training the NN models. We note that these ﬁndings are consistent
with other studies (e.g., Makridakis et al., 2018). That is, basic time series models
outperform deep learning models on difﬁcult time series forecasting tasks, such as this
one. Recall that we aggregate the daily data into weekly observations to circumvent is-
sues related to demand being constrained by the supply (data truncation and censoring).
Without the aggregation we would have had seven times more observations. However,
even 2,226 observations is considered a very small dataset for training neural networks
and daily observations have higher variance than weekly ones.

The results for the deep learning models conﬁrm that adding weather features and
considering all commodities simultaneously help to improve the performance. This is
consistent with the descriptive statistics reported in Section 5.1.2. Previous demands
for all commodities constitute relevant information to consider.

21

Model
CONSTANT
AR
FFNN
FFNN-W
FFNN-W-SPLIT
RNN
RNN-W
RNN-W-SPLIT

RMSE WAPE
34.7%
34.0%
38.7%
37.1%
37.2%
37.8%
37.8%
38.6%

86.0
78.0
105.2
84.8
90.4
105.1
86.3
85.2

Table 2: Performance metrics of the forecasting models averaged over all commodities.
The best and second-best metric values are highlighted in bold.

Henceforth, we keep two forecasting models when analyzing periodic demand re-
sults: the overall best performing model (AR) as well as the best deep learning model
(FFNN-W).

5.3 Periodic Demand Estimation

Before diving into the results for the periodic demand estimation problem, we recall
some important details. In the PDE program (33)-(51), the decision variables relate
to the periodic demand estimate ˆyp, deﬁned as a mapping from the demand forecasts.
It serves as a parameter of the SND problem at the second level, BP, deﬁning the
services offered by the carrier at each period of the tactical horizon. The third level
wBP corresponds to the ﬂow problem with ﬁxed services but where the demand (and
hence ﬂow variables) differs from the periodic demand estimate. The matrix of demand
forecasts, ˆY is an input to wBP. Our objective is to analyze the impact of the periodic
demand estimate. That is, the costs resulting from selecting a speciﬁc ˆyp to solve BP
and wBP. We therefore divide the results into two parts. The purpose is to disentangle
the errors associated with the periodic demand estimation from those associated with
the demand forecasts. The two parts are brieﬂy described in the following:

• Analysis 1: The impact of periodic demand estimation. We assume we have
no forecast errors, i.e., the carrier knows perfectly the demand to come for the
planning horizon. The periodic demand is estimated with the mappings (20)-
(23) from historical data (ground truth values) and we compute the tactical costs
generated by those periodic demands.

• Analysis 2: The impact of imperfect demand forecasts. We estimate the pe-
riodic demands from forecasts obtained with the AR and FFNN-W models. We
compute the associated tactical costs and compare them to Analysis 1.

We consider two demand instances – I1 and I2 – from the test set of the forecasting
models. They are from two distinct periods: I1 covers a spring/summer period (May
6th to July 14th, 2019) while I2 covers a summer/fall period (July 29th to October 6th,
2019). Both instances have K = 170 commodities and a tactical planning horizon of
T = 10 weeks. Instance I2 corresponds to a busier period for the carrier: Figure 10
shows the difference of the total demand summed over all commodities of I2 at each
week relative to the total demand of I1. We note that the total demand for I2 can be
up to 20% higher than its I1 counterpart.

22

Figure 10: Percentage difference of the total demand at each week of I2 relative to I1

All the results are generated by ﬁxing the variable ˆyp in PDE and sequentially solv-
ing BP-wBP. We recall that the periodic demand yp is a mapping from actual demand
values while ˆyp is a mapping from demand forecasts. Similarly, Y is the matrix of ac-
tual demand values while ˆY is the matrix of demand forecasts. We denote by BP(yp)
and BP(ˆyp) when BP is solved with yp and ˆyp, respectively, in constraints (36). Fur-
thermore, we denote by wBP(Y) and wBP( ˆY) when wBP is solved with demand
values Y and ˆY, respectively, in constraints (45). Finally, due to the large number of
variables (several million) of (33)-(51) for both instances I1 and I2, we focus on a
comprehensive analysis of aggregate statistics of solution quality, rather than values of
decision variables.

5.3.1 Analysis 1: The Impact of Periodic Demand Estimation

The analysis in this section is based on two sets of results for demand instances I1 and
I2:

• Reference: We solve BP(yt) for t = 1, . . . , T .

In other words, we do not
restrict the demand to be periodic and we obtain a tactical cost C PDE
(33). We
note that this constitutes a lower bound on C PDE: At each week, the blocks built
are speciﬁc for the demand to best exploit the network capacity.

ref

• Periodic: We solve BP(yp
. ) − wBP(Y) with the four periodic demand vectors
q2 and yp
max, yp
mean, yp
yp
q3. For each solution, we compute the percentage gap to
the reference cost C PDE
.

ref

ref

Table 3 reports the results where each number is the percentage gap to the reference
. Since the latter is a lower bound, column C PDE contains only positive
cost C PDE
values. Recall that costs at an aggregate level – C design, C ﬂow and C out – result from
non-trivial trade-offs between costs associated with design and ﬂow decisions at the
path level that, in turn, are all linked through the demand. Hence, we cannot analyze

23

each component independently of the others. We can, however, note a trend due to the
nature of periodic demand. Namely, C design and C ﬂow decrease while C out increases
when periodic demand is used since the plan then needs to be adapted to the weekly
demand. If actual weekly demand cannot be satisﬁed by the periodic plan, then it will
be outsourced at a per unit ﬂow cost C out
tbk that is higher than that of the periodic plan
C ﬂow
tbk . The parameter values in the objective function (33) have been ﬁxed through an
extensive validation process with CN as part of the work reported in Morganti et al.
(2020). The values are such that they represent actual costs whenever possible and, in
particular, that the solutions reﬂect CN’s operations and are implementable in practice.
Therefore, we treat the parameter values as ﬁxed and given in this study.

Periodic
Deﬁnition yp
in BP

Percentage gap between costs

C PDE

C design

C ﬂow

C out

I1

I2

yp
max
yp
mean
yp
q2
yp
q3

yp
max
yp
mean
yp
q2
yp
q3

77.3% -2.8% -3.4% 84.0%
93.3% -16.9% -4.4% 101.3%
93.8% -16.8% -3.3% 101.8%
28.4% -7.5% -1.2% 30.8%

73.0% -14.1% -5.7% 76.6%
40.6% -20.0% -2.8% 42.6%
41.6% -23.2% -2.8% 43.6%
23.1% -14.8% -2.6% 24.3%

Table 3: Percentage gap between tactical cost C PDE and reference cost C PDE
. We use
historical data for the demand at each week, that is wBP(Y). The minimum value for
C PDE indicates the optimal periodic demand estimate in the subset Y we consider.

ref

Two important ﬁndings emerge from the results. First, the tactical cost has an
important variation over the different periodic demand estimates. This underlines the
importance of the periodic demand estimation problem. Second, using another estimate
than the commonly used mean periodic demand yp
mean can lead to an important cost
reduction. In our case using the third quartile yp
q3 reduces the total costs by 33.6% in
I1, and by 12.4% in I2 with respect to yp
mean. When a smaller periodic demand estimate
is used, yp
q2 for instance, less blocks are built (the numbers of variables where
zb = 1 decreases). This leads to increased outsourced demand when actual demand is
higher than planned as there are not enough blocks for all commodities.

mean and yp

We analyze total periodic demand (T (cid:80)

k∈K yp
k) relative to total actual demand
((cid:80)T
k∈K ytk) to explain the results. We report the values for each mapping in
Table 4. The total periodic demand of yp
max is almost three times larger than the one of
yp
q3 in both instances which explains the large gap in their costs. The design made from
solving BP(yp
max)
which generates fewer blocks in the network. The advantage is that they can be better
used. The design from solving BP(yp
max) is made of a large number of small blocks
(the number of variables where zb = 1 is large) which cannot accommodate all actual
demands. In this case, outsourced demand increases for certain commodities because
the shared train capacities are divided between a large number of blocks (some actual

q3) is based on a lower estimation of the periodic demand than BP(yp

(cid:80)

t=1

24

demands xtbk need to be ﬁxed to zero to satisfy capacity constraints). We highlight that
while the increase in outsourced demand seems large, it represents only few percent of
the total demand.

(cid:80)

k∈K ytk

t=1

(cid:80)T
yp
max
yp
mean
yp
q2
yp
q3

I1
-

I2
-

34.8% 31.8%
0.0%
0.0%
-1.0% -0.5%
11.8% 11.7%

Table 4: Total periodic demand relative to total actual demand. The point of reference
is indicated by a dash.

5.3.2 Analysis 2: The Impact of Imperfect Demand Forecasts

In practice, carriers rely on demand forecasts to estimate a periodic demand and build
the design for the tactical planning horizon. Then, at each week of the horizon, they
adapt operationally the tactical plan based on observed demand. In this section, we
follow our methodology and analyze the quality of the solution a posteriori.

We proceed in two steps: First, we estimate the periodic demand by solving BP(ˆyp)−

wBP( ˆY) (i.e., using the forecasts) for each mapping h and select the one minimizing
C PDE (33). Second, we assess the tactical cost associated with the periodic demand
estimate. For this purpose we solve BP(ˆyp) − wBP(Y). Note that we use actual de-
mand values Y to accurately assess this cost. Hence, it is affected by two combined
sources of error: the one of the periodic demand estimation and the forecast error, both
discussed separately in previous sections.

Step 1: Periodic demand estimation. We report results in Table 5 and indicate by a
mean). We note that the forecasts ˆY depend on both the
dash the point of reference (ˆyp
forecasting model and the instance. In other words, we can only compare results from
the same forecasting model and the same instance. The results show that, in all cases,
the tactical costs are minimized with ˆyp
max. In contrast, Analysis 1 based on historical
data shows that tactical costs are minimized with yp
q3. This can be explained by the fact
that forecasting models smooth demand and struggle to accurately predict peaks. With
the historical data we have access to the maximum demand which can be an outlier,
thus expensive. Following the methodology, we choose the periodic demand estimate
having the lowest cost for Step 2. It is ˆyp

max for both forecasting models.

Step 2: Assessment of the tactical costs. Table 6 reports the relative costs resulting
from solving BP(ˆyp) − wBP(Y). We use the same reference as in Analysis 1, that
, the lower bound on C PDE. In addition to the best periodic demand identiﬁed
is C PDE
ref
by our methodology, we report the result for ˆyp
mean. Consistent with the ﬁndings in
Analysis 1, we note that using the latter leads to a large increase in costs. Despite
the relatively large forecast errors reported in Table 2, the results show that estimating
periodic demand using our methodology can even reduce the costs compared to yp
computed on perfect information (historical data).
We report the relative total demand values (T (cid:80)

k) in Table 7. For instance I1,
max overestimate the reference demand. The design

both periodic demand estimates ˆyp

k∈K yp

mean

25

Periodic
Demand yp
in BP

Forecasting Model

AR

FFNN-W

I1

I2

ˆyp
max
ˆyp
mean
ˆyp
q2
ˆyp
q3

ˆyp
max
ˆyp
mean
ˆyp
q2
ˆyp
q3

-38.4% -32.2%

-
17.5%
-30.8%

-
28.0%
-18.8%

-7.4% -28.4%

-
12.7%
8.8%

-
29.2%
-11.7%

Table 5: Percentage gap between tactical costs C PDE resulting from solving BP(ˆyp) −
wBP( ˆY) with forecasts of demand from two models: AR and FFNN-W. For each
model and each instance, we compare the value with the one from ˆyp

mean.

Periodic
Demand yp
in BP

Percentage gap between costs

C PDE

C design

C ﬂow

C out

I1

I2

Historical data
Historical data
AR
AR
FFNN-W
FFNN-W

Historical data
Historical data
AR
AR
FFNN-W
FFNN-W

yp
mean
yp
q3
ˆyp
max
ˆyp
mean
ˆyp
max
ˆyp
mean

yp
mean
yp
q3
ˆyp
max
ˆyp
mean
ˆyp
max
ˆyp
mean

93.3% -16.9% -4.4% 101.3%
30.8%
28.4% -7.5 % -1.2%
55.9% -17.8% -1.9%
60.6%
125.1% -14.1% -3.9% 135.8%
48.2% -12.3% -2.5%
52.4%
117.4% -16.2% -6.0% 127.5%

40.6% -20.0% -2.8 % 42.6%
23.1% -14.8% -2.6 % 24.3%
50.1% -23.6% -10.0% 52.8%
137.6% -31.8% -12.1% 144.4%
80.0% -25.3% -7.1 % 83.9%
164.4% -31.1% -17.8% 172.6%

Table 6: Percentage gap between tactical costs resulting from solving BP(ˆyp) −
wBP(Y) and reference cost C PDE

ref used in Analysis 1 (BP(yt) for t = 1, . . . , T ).

26

built is capable of handling more demand, which results in less outsourced demand.
However, they underestimate the periodic demand yp
q3 (based on actual demand) hence
the plan is built on a reduced demand, which in turn lead to more outsourced demand
compared to yp
q3. For instance I2, the periodic demand estimate ˆyp,AR
max overestimates
the total demand yet it leads to an increase in outsourced demand. This is because the
estimate ˆyp,AR
max either overestimates demand for commodities that already lack capacity
with actual average demand yp
mean, or it underestimates demand for some commodities
for which blocks are then not built in the design and are consequently outsourced at
each week.

mean

Historical data yp
Historical data yp
q3
ˆyp
AR
max
ˆyp
FFNN-W
max

I1
-

I2
-

11.9% 11.7%
10.2% 0.7%
10.0% -1.4%

Table 7: Total periodic demand summed over commodities. The point of reference is
indicated by a dash.

In summary, the results show that the PDE problem can be of high value. Based on
ground truth data (no forecast error) we obtain an important cost reduction using the
third quartile as opposed to the mean over the tactical planning horizon. Even though
our time series forecasts have relatively high errors, the periodic demand estimate re-
sulting from our methodology leads to a cost reduction compared to the commonly
used average value computed based on ground truth values. This further highlights the
importance of the problem introduced in this paper.

6 Conclusion and Future Research

Tactical planning is essential to freight carriers. For example, it aims at designing ser-
vice networks to meet demand while minimizing cost. In this work we focused on
large-scale tactical planning that is restricted to deterministic models for the sake of
computational tractability. Even though the estimate of the periodic demand is a cen-
tral input to such models, the associated estimation problem has not been studied in
the literature. In this paper we addressed this gap: We formally introduced the peri-
odic demand estimation problem and we proposed a methodology that proceeds in two
steps. The ﬁrst step consists in using a time series forecasting model to predict demand
for each period in the tactical planning horizon. The second step deﬁnes periodic de-
mand as a solution to a multilevel mathematical program that explicitly connects the
estimation problem to the tactical planning problem of interest. This allows to esti-
mate periodic demand such that the costs are minimized. Since the origin-destination
demand matrices typically are unbalanced, this can be of importance as the cost of
forecast errors is not evenly distributed across commodities.

We reported results for a real large-scale application at the Canadian National Rail-
way Company. The results clearly showed the importance of the periodic demand
estimation problem when compared to the approach commonly used in practice. The
latter consists in averaging the time series forecasts over the tactical planning horizon.
Compared to this practice, the results showed that using another estimate can lead to a
substantial reduction in cost. As expected, the results also showed that the time series

27

forecasting problem is difﬁcult and the forecast errors hence are relatively large. Nev-
ertheless, the periodic demand estimates that resulted from the proposed methodology
still led to costs that were comparable to, or even better, than those obtained by using
the average demand baseline computed on perfect information (i.e., no forecast error).
Moreover, the costs were substantially reduced compared to averaging the forecasts.

In terms of exposition, we chose to limit the methodology to the MCND formu-
lation. However, the methodology may apply to other cyclic network design formu-
lations. Similarly, adaptation of the tactical plan in each period (wMCND and wBP
formulations) can also be represented differently from this paper. The methodology
hinges on the separation between the design variables that are ﬁxed for all periods in
the tactical planning horizon while the ﬂow decisions are not. The adaptation of the
ﬂow decisions serves as a proxy for operational costs.

The work reported in this paper constituted a ﬁrst step in addressing the periodic
demand estimation problem that hitherto has been overlooked in the literature. We
showed that adequately addressing it can lead to important cost reductions. Given that
we introduced a new problem, it opens up a number of directions for future research.
Two direct extensions consist in improving the time series forecasts (step one in the
methodology), and extending the feasible set of periodic demand values to more gen-
eral mappings. The latter requires an effective solution approach.

Another promising avenue for future research consists in formally linking the peri-
odic demand estimation problem to other related research areas. Here we identify two
such areas. First, stochastic programming. We assume a deterministic and cyclic for-
mulation for computational tractability. However, computing power improves fast and
a stochastic formulation is a promising avenue, for example, taking into account the
uncertainty around the point forecasts (error distributions or prediction intervals). The
second area of research is end-to-end learning that focuses on incorporating the value
of a prediction for a downstream decision-making problem already in the training /
estimation (see, e.g., Bengio, 1997; Ferber et al., 2020; Kotary et al., 2021). Such cri-
terion stand in contrast to traditional prediction ones (e.g., minimizing squared errors).
While there is a recent surge in the related literature, none of the existing methods can
tackle formulations of the type we consider here. Namely, MILP formulations where
predictions occur in the constraints.

Acknowledgments

This research was funded by the Canadian National Railway Company (CN) Chair
in Optimization of Railway Operations at Université de Montréal and a Collaborative
Research and Development Grant from the Natural Sciences and Engineering Research
Council of Canada (CRD-477938-14). Moreover, we gratefully acknowledge the close
collaboration with personnel from different divisions of CN. We would also like to
thank the ﬁve anonymous reviewers as well as Frederic Semet and Jonathan Jalbert
who provided valuable comments that helped us improve the manuscript.

References

Ahmed, N. K., Atiya, A. F., Gayar, N. E., and El-Shishiny, H. An empirical comparison
of machine learning models for time series forecasting. Econometric Reviews, 29(5-
6):594–621, 2010.

28

Azadeh, S. S., Marcotte, P., and Savard, G. A taxonomy of demand uncensoring meth-
ods in revenue management. Journal of Revenue and Pricing Management, 13(6):
440–456, 2014.

Bengio, Y. Using a ﬁnancial training criterion rather than a prediction criterion. In

International Journal of Neural Systems, 8, 433–443, 1997.

Bergstra, J., Yamins, D., and Cox, D. D. Making a science of model search: Hyperpa-
rameter optimization in hundreds of dimensions for vision architectures. ICML’13:
Proceedings of the 30th International Conference on International Conference on
Machine Learning, 28:115–123, 2013.

Box, G. E., Jenkins, G. M., Reinsel, G. C., and Ljung, G. M. Time Series Analysis:

Forecasting and Control. John Wiley & Sons, 2015.

Cambridge, S. Forecasting statewide freight toolkit, 606. Transportation Research

Board, 2008.

Chouman, M., Crainic, T. G., and Gendron, B. Commodity representations and cut-
set-based inequalities for multicommodity capacitated ﬁxed-charge network design.
Transportation Science, 51(2):650–667, 2017.

Chow, J. Y., Yang, C. H., and Regan, A. C. State-of-the art of freight forecast modeling:

lessons learned and the road ahead. Transportation, 37(6):1011–1030, 2010.

Colson, B., Marcotte, P., and Savard, G. Bilevel programming: A survey. 4OR, 3:

87–107, 2005.

Crainic, T. G. Service network design in freight transportation. European Journal of

Operational Research, 122(2):272–288, 2000.

Crainic, T. G., Hewitt, M., Maggioni, F., and Rei, W. Partial benders decomposition:
General methodology and application to stochastic network design. Transportation
Science, 2020. doi: 10.1287/trsc.2020.1022.

De Jong, G., Gunn, H., and Walker, W. National and international freight transport
models: an overview and ideas for future development. Transport Reviews, 24(1):
103–124, 2004.

Ferber, A., Wilder, B., Dilkina, B., and Tambe, M. MIPaaL: Mixed integer program
as a layer. Proceedings of the AAAI Conference on Artiﬁcial Intelligence, 34(02):
1504–1511, 2020.

Fields, E., Osorio, C., and Zhou, T. A data-driven method for reconstructing a distri-
bution from a truncated sample with an application to inferring car-sharing demand.
Transportation Science, 55(3):616–636, 2021.

Fiig, T., Weatherford, L. R., and Wittman, M. D. Can demand forecast accuracy be
Journal of Revenue and Pricing Management, 18(4):

linked to airline revenue?
291–305, 2019.

Gardner Jr, E. S. Exponential smoothing: The state of the art. Journal of Forecasting,

4(1):1–28, 1985.

Goodfellow, I., Bengio, Y., and Courville, A. Deep Learning. MIT press, 2016.

29

Hochreiter, S. and Schmidhuber, J. Long short-term memory. Neural Computation, 9

(8):1735–1780, 1997.

Holt, C. C. Forecasting seasonals and trends by exponentially weighted moving aver-

ages. International Journal of Forecasting, 20(1):5–10, 2004.

Karlaftis, M. G. and Vlahogianni, E. I. Statistical methods versus neural networks in
transportation research: Differences, similarities and some insights. Transportation
Research Part C: Emerging Technologies, 19(3):387–399, 2011.

Klein, J. and Moeschberger, M. Survival Analysis: Techniques for Censored and Trun-

cated Data. Springer-Verlag, New York, 2005.

Kotary, J., Fioretto, F., Hentenryck, P. V., and Wilder, B. End-to-end constrained opti-

mization learning: A survey, 2021.

Längkvist, M., Karlsson, L., and Loutﬁ, A. A review of unsupervised feature learning
and deep learning for time-series modeling. Pattern Recognition Letters, 42:11–24,
2014.

Litterman, R. B. Forecasting with bayesian vector autoregressions—ﬁve years of ex-

perience. Journal of Business & Economic Statistics, 4(1):25–38, 1986.

Lütkepohl, H.

Introduction to Multiple Time Series Analysis. Springer Science &

Business Media, 2013.

Magnanti, T. L. and Wong, R. T. Network design and transportation planning: Models

and algorithms. Transportation Science, 18(1):1–55, 1984.

Makridakis, S., Spiliotis, E., and Assimakopoulos, V. Statistical and machine learning
forecasting methods: Concerns and ways forward. PlOS ONE, 13(3):1–26, 2018.

Mantovani, S., Morganti, G., Umang, N., Crainic, T. G., Frejinger, E., and Larsen, E.
The load planning problem for double-stack intermodal trains. European Journal of
Operational Research, 267(1):107 – 119, 2018.

Milenkovi´c, M., Milosavljevic, N., Bojovi´c, N., and Val, S. Container ﬂow forecast-
ing through neural networks based on metaheuristics. Operational Research, 1–33,
2019.

Morganti, G., Crainic, T. G., Frejinger, E., and Ricciardi, N. Block planning for inter-
modal rail: Methodology and case study. Transportation Research Procedia, 47:19
– 26, 2020.

Nguyen, H., Kieu, L.-M., Wen, T., and Cai, C. Deep learning methods in transportation

domain: A review. IET Intelligent Transport Systems, 12(9):998–1004, 2018.

Queenan, C. C., Ferguson, M., Higbie, J., and Kapoor, R. A comparison of unconstrain-
ing methods to improve revenue management systems. Production and Operations
Management, 16(6):729–746, 2007.

Schulze, P. M. and Prinz, A. Forecasting container transshipment in germany. Applied

Economics, 41(22):2809–2815, 2009.

30

Sutskever, I., Vinyals, O., and Le, Q. V. Sequence to sequence learning with neural
networks. In Advances in Neural Information Processing Systems, 27, 3104–3112,
2014.

Tsai, F.-M. and Huang, L. J. Using artiﬁcial neural networks to predict container ﬂows
between the major ports of Asia. International Journal of Production Research, 55
(17):5001–5010, 2017.

Vulcano, G., Van Ryzin, G., and Ratliff, R. Estimating primary demand for substi-
tutable products from sales transaction data. Operations Research, 60(2):313–334,
2012.

Weatherford, L. The history of unconstraining models in revenue management. Journal

of Revenue and Pricing Management, 15(3):222–228, Jul 2016.

Weatherford, L. and Belobaba, P. Revenue impacts of fare input and demand forecast
accuracy in airline yield management. Journal of the Operational Research Society,
53(8):811–821, 2002.

Winters, P. R. Forecasting sales by exponentially weighted moving averages. Manage-

ment Science, 6(3):324–342, 1960.

Appendix

Input features of neural networks

Input Layer 1 It is dedicated to external data features such as weather data and
temporal context, for all models. We use real observed weather data described in Sec-
tion 5.1, to assess their potential in an optimistic setting in regards to their accuracy. At
prediction time, we would then rely on weather forecasts.

All models contain two features as temporal context, that is the week number of the
forecasted week and the month number of the Monday of the forecasted week. Weather
features, for models that include them, consist in the average daily temperature, the
accumulated snow (cm) and the accumulated precipitations (mm) of the forecasted
week for the main 17 terminals in the network.

Input Layer 2 Features in Input Layer 2 are lagged observed or forecasted (when
doing inferences) demand of commodities predicted by the model. The number of lags
was found through hyperparameters optimization, and is given in Table 8 below.

31

Hyper-parameters of neural networks

Model

RNN
RNN-W
RNN-W-SPLIT1
RNN-W-SPLIT2
FFNN
FFNN-W
FFNN-W-SPLIT1
FFNN-W-SPLIT2

Lags

Weather
Features

Hidden
layers

3
4
3
8
3
4
3
5

NO
YES
YES
YES
NO
YES
YES
YES

1
1
3
2
3
3
2
3

Size
Hidden
Layers
700
260
460
220
540
600
700
580

Dropout

Learning
Rate

0.25
0.12
0.10
0.23
0.14
0.11
0.06
0.15

0.1
0.1
0.1
0.1
0.01
0.1
0.01
0.1

Table 8: Table of hyperparameters of the neural networks

32

