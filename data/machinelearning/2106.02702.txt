1
2
0
2

n
u
J

4

]
I

A
.
s
c
[

1
v
2
0
7
2
0
.
6
0
1
2
:
v
i
X
r
a

Subgroup Fairness in Two-Sided Markets

Quan Zhou1, Jakub Marecek2, and Robert N. Shorten1,3

1University College Dublin, Ireland.
2Czech Technical Univeristy in Prague, the Czech Republic.
3 Imperial College London, UK.

June 8, 2021

Abstract

It is well known that two-sided markets are unfair in a number of ways.
For instance, female workers at Uber earn less than their male colleagues
per mile driven. Similar observations have been made for other minority
subgroups in other two-sided markets.

Here, we suggest a novel market-clearing mechanism for two-sided
markets, which promotes equalisation of the pay per hour worked across
multiple subgroups, as well as within each subgroup. In the process, we
introduce a novel notion of subgroup fairness (which we call Inter-fairness),
which can be combined with other notions of fairness within each subgroup
(called Intra-fairness), and the utility for the customers (Customer-Care)
in the objective of the market-clearing problem. While the novel non-linear
terms in the objective complicate market clearing by making the problem
non-convex, we show that a certain non-convex augmented Lagrangian
relaxation can be approximated to any precision in time polynomial in
the number of market participants using semi-deﬁnite programming. This
makes it possible to implement the market-clearing mechanism eﬃciently.
On the example of driver-ride assignment in an Uber-like system, we
demonstrate the eﬃcacy and scalability of the approach, and trade-oﬀs
between Inter- and Intra-fairness.

1

Introduction

As the two-sided markets [1, 2] of the so-called “gig economy” grow, fairness
thereof is becoming important both from ethical and legal stand points [3–6].
For example, the (former) chief economist of Uber [7] documented a roughly
7% gender earnings gap amongst drivers, but contented that the gender earning
gap might be due to men picking their time and location of rides better, and
also due to men accumulating experience quickly [7, 8], considering that men
can work more hours per week than women in the study. Indeed, many other
studies [9] show that women are much less likely than men to work regularly in

1

 
 
 
 
 
 
two-sided markets. It was recently reported that in the US, gig work constituted
a lower share of total earnings for women than for men: [10] report 16%, versus
23% for men. In the UK, [11] found that 75% of female gig workers earned
less than £11,500 per annum, compared with 61% of all workers. Although
these issues have been longstanding in labour-market structures, the COVID-19
pandemic has set women’s labour force participation back more than 30 years,
according a report from U.S. Department of Labour [12] and exposed the urgent
need for better solutions that support all working women. We aim to develop
market-clearing mechanisms for two-sided markets that would explicitly improve
subgroup fairness, while being eﬃciently computable.

In the context of a two-sided market, where workers are matched with jobs
by a matching platform, we deﬁne the eﬀorts to provide better services to both
sides as Worker-Care and Customer-Care, respectively. From the perspective
of workers, we suggest one should like to distinguish between the following two
notions of fairness:

1) Intra-fairness: Motivated by concepts such as Proportional Fairness in [13],
Intra-fairness purses the proportional parity of worker utility (e.g., salary
and allowance) such that over time, the accumulated utility, proportional
to the workload (e.g, working hours and active time) for every worker,
should be equalised.

2) Inter-fairness: By analogy with demographic parity, our notion of Inter-
fairness strives to ensure that the proportion of accumulated utility to
the workload should to be equalised across the (majority and minority)
subgroups. A typical example of Inter-fairness would be closing up the
gender gap of accumulated utility, proportional to the workload. In the
context of this notion of fairness, overlapping subgroups [14] can also be
accommodated.

Related notions are well known in classiﬁcation problems [15]. While there
have been some attempts to equalise the pay and opportunity across all workers
[13, 16, 17] (Intra-fairness, to use our terms), the notion of subgroup fairness (or
Inter-fairness) has received very little attention. In contrast, we aim to equalise
the pay per hour worked both across subgroups based on gender, ethnicity, or
other sensitive attributes, as required by current or proposed [18] legislation,
and within each subgroup.

Notice that the notion of Intra-fairness might be in conﬂict with Inter-
fairness, but that it may be possible to improve one of the objectives without
worsen the other too much. We present a natural formulation of the market-
clearing problem utilising a weighted sum of these objectives, and its augmented
Lagrangian relaxation formulation. We also illustrate the trade-oﬀ between Intra-
and Inter-fairness computationally.

2

2 Related Work

The last few years have seen an unprecedented explosion in attention of fairness
[19, 20, 16, 21, 14, 22, 23, e.g.] in artiﬁcial intelligence and machine learning.
Much of the work focuses on classiﬁcation [24, 19, 20, 22, e.g.] and recommen-
dation systems [25, 17, e.g.], and speciﬁcally on notions of subgroup fairness
therein. One can request a classiﬁer’s statistic, such as raw positive classiﬁcation
rate (also sometimes known as statistical parity), false positive and false negative
rates, to be equalised across the subgroups so that the error caused by the
algorithm be proportionately spread across subgroups. Trivially, one aim to
achieve this by “fairness under unawareness”, where the protected attributes are
not given. The shortcoming of this approach is obvious when there are some
other features related to protected attributes and those features could be used
to predict the protected attributes. The notions of “equal opportunity” in [19]
and “counterfactual fairness ” of [26] require the predictor to be unrelated to
protected attributes. In other words, they can be seen as the revised version of
unawareness that gets rid of the eﬀects of those unobserved features related to
protected attributes. In contrast, “demographic parity” requires the proportion
of each segment of a protected class (e.g., gender) should receive the positive
outcome at equal rates, although this might be unfair in the case of unbalanced
distributions of features between advantaged and disadvantaged subgroups, even
in the absence of biases.

Independently, the individual deﬁnition of fairness asks for constraints to
equalise the outcome across all pairs of individuals, rather than across subgroups.
In other words, it requires that “similar individuals should be treated similarly”
[24]. This notion of fairness has been considered by [13, 16] in the context of
ride-hailing, in two papers most closely related to ours, albeit with exponential-
time solvers for the simpler market-clearing problem. Considering that there are
multiple conﬂicting notions of fairness possible, we should like to consider these,
and to provide eﬃcient market-clearing mechanisms.

3 Modelling Fairness in Two-Sided Markets

Two-sided markets [1] model platforms that enable the interaction between the
two sides: customers submitting jobs i ∈ Ct, for t ∈ T +, and workers j ∈ D. For
example, the system of Uber can be modelled as a two-sided market with direct
connections. In this case, workers would be Uber drivers and jobs can be the
rides of customers. Note that jobs are assumed to be independent from each
other, although one customer might oﬀer multiple jobs.

3.1 Notation
In period t, a list of jobs i ∈ Ct are oﬀered with payment payi
t
all workers j ∈ D in the two-sided market. A binary variable Aj
t
workers’ availability in period t, i.e., Aj

for each job to
indicating all
t = 1 if worker j is online and waiting

3

for a job in period t. Accordingly, we split all workers D into two sets: DAt=1
and DAt=0, by their availability such that all available workers in period t are in
set DAt=1 and unavailable ones in set DAt=0. Further, another binary variable
M (i,j)
is set to be 1 if worker j is assigned job i in period t. Note that worker j
t
cannot get any jobs if she is oﬄine and we assume that one worker can get at
most one job in a single period, thus (cid:80)
, for j ∈ D, t ∈ T +. Also,
each job must be matched with exactly one worker, such that (cid:80)
= 1,
for i ∈ Ct, t ∈ T +.
Let d(i,j)
denotes the suitability between job i and worker j in period t.
t
Speciﬁcally, d(i,j)
can be regarded as the distance between worker j and the
pick-up location of job i in period t, or as the (estimated) customer’s waiting
time for pick-up. Note that d(i,j)
is normally unavailable if the worker is oﬀ-line.
From the customers’ point of view, their service experience (“Customer-Utility”)
is highly related to suitability d(i,j)
, especially, customers’ waiting time. Here, if
job i is accepted by worker j in period t, we set

j∈D M (i,j)

M (i,j)
t

≤ Aj
t

i∈Ct

t

t

t

t

Customer-Utility := −d(i,j)

t

,

(1)

for i ∈ Ct. On the other hand, workers need to cover the cost of driving to pick-
up location and a long wait for pick-up would negatively aﬀect their customer
and
reviews. For simplicity, we assume Worker-Utility j is only related to payi
t
d(i,j)
if she receives job i in period t. But the utility would be 0 if she does not
t
receive any jobs or she is oﬄine. We have

Worker-Utility uj

t :=

M (i,j)
t

(cid:18) i
pay
t

−d(i,j)
t

(cid:19)

,

(cid:88)

i∈Ct

(2)

for j ∈ DAt=1 and uj
reject a job if it cannot bring any beneﬁt, and hence we set uj
Also, we deﬁne U j
t
t, such that U j
we deﬁne Λj
t
t. For simplicity, Λj
t
available till period t: Λj
accumulated utility proportional to workload (U j
worker j til the end of period t.

t := 0, for j ∈ DAt=0. In real life, the worker would rather
t ≥ 0, for j ∈ D.
as the accumulated utility of worker j in the end of period
t = U j
t−1 + uj
0 = 0, for j ∈ D. Further,
to be the accumulated workload of worker j in the end of period
is calculated by the number of periods that worker j is
, for j ∈ D, t ∈ T +. We denote the ratio of
) to be the return rate of

, for t ∈ T +\{0} and U j

t = (cid:80)t

k=1 Aj

t /Λj

k

t

t

3.2 Fairness Notions in Worker-Care

In a two-sided market, the platform often make eﬀorts to provide better services
for end-users, although there might be some trade-oﬀ between both sides. We
can deﬁne the terms Customer-Care and Worker-Care to distinguish the eﬀorts
invested in both sides. In the case of ride-sharing platforms, Customer-Care is
directly set to be the sum of Customer-Utility, as in (3) and we always expect

4

to maximise Customer-Care.

Customer-Care := −

(cid:88)

(cid:88)

i∈Ci

j∈DAt=1

M (i,j)
t

× d(i,j)
t

,

(3)

We have a detailed discussion of Worker-Care in the following text.

Parity of Worker-Utility: One would like to assure that for all pairs (j1, j2) of
workers, the diﬀerence in the accumulated utilities U j1
is as small as
t
possible. However, to pursue superﬁcial equality of worker utility regardless of
the diﬀerence in active time does not reward hard work and technical excellence.
Suppose a worker who works every day earns the same amount as the other
worker who works one day in a week, this is unfair indeed. Hence, we would like
to skip this notion.

, U j2
t

t /Λj2

t

t /Λj1

t

Intra-fairness: Proportional Parity of Worker-Utility: Alternatively, the notion
of Intra-fairness asks for proportional parity of Worker-Utility. One would like
to assure that for all pairs (j1, j2) of workers, the diﬀerence between the return
rates U j1
is as small as possible.

and U j2

The pairwise diﬀerences can be evaluated in a number of ways. A large
family of such measures of inequality in a population, due to [27], is known as
the generalised entropy indices GE(α), α ∈ R. The earlier indices developed by
[28, 29] are special cases of GE(1), GE(0) within this family. Another popular
measure of inequality is the Gini index, for which we use we use the aggregate-
value formulation of [30], instead of the formula from the World Bank [31], which
requires probability distribution of incomes or ranking of incomes. In addition,
we also compare against another, linearised notion of proportional parity, which
has been proposed by [13].

In general, we denote the term representing Intra-fairness till period t ∈ T +

by Intra-Fairt, and deﬁne it case-wise:


Intra-Fair
t

=

(cid:17)α

(cid:17)

− 1




(cid:16)(cid:16) U j
t
Λj
t ×µt
ln U j
t
Λj
t ×µt

(cid:80)

1
α(α−1)|D|
(cid:80)

1
|D|

1
|D|

(cid:80)

j∈D

j∈D
U j
t
Λj
t ×µt
j∈D ln Λj
t ×µt
U j
t
(cid:80)

1
2µt|D|2
(cid:80)

j∈D

j1,j2∈D
(cid:12)
(cid:12)
(cid:12)maxk∈D
(cid:80)

(cid:12)
(cid:12)
(cid:12)
U k
Λk

U j1
t
Λj1
t

t−1

t−1

(cid:12)
(cid:12)
(cid:12)

− U j2
t
Λj2
t
(cid:12)
− U j
(cid:12)
t
(cid:12)
Λj
t

for GE(α)t
for GE(1)t
for GE(0)t
for Ginit

for linearised

(4)

where α (cid:54)= 0, 1 and µt := 1
|D|

j∈D U j
is the average return rate till
period t. Lower Intra-fairness indicates higher equality and zero Intra-fairness
means absolute equality.

t /Λj

t

Inter-fairness: Gender Gap of Worker-Utility: The notion of Inter-fairness re-
quests the proportional parity of Worker-Utility among subgroups. If we pick
one worker randomly from each subgroup, the diﬀerence among their the return
rates is as small as possible.

5

Considering the gender earnings gap among workers, we split the set of
workers D into two subgroups: D(f ) for female worker, D(m) for male workers.
So far, we have deﬁned the set of subgroups S := {f, m} and an element of
S is denoted by s. Correspondingly, we have the average return rate for each
subgroup: µ(s)

, for s ∈ S.

(cid:80)

j∈D(s) U j

t /Λj

t

t = 1

|D(s)|

An important property of GE index allows one to decompose overall inequality
into inequality within subgroups and the diﬀerences between subgroups [32, 33],
such that

GE(1)t =

(cid:88)

ν(s)ω(s)

t GE(1)(s)

t

(cid:88)

+

ν(s)ω(s)

t

ln ω(s)
t

,

s∈S
(cid:124)

(cid:123)(cid:122)
within subgroup term

(cid:125)

s∈S
(cid:124)
(cid:125)
(cid:123)(cid:122)
between subgroup term

GE(0)t =

(cid:88)

ν(s) GE(0)(s)

t

+

(cid:88)

ν(s) ln

s∈S
(cid:125)
(cid:123)(cid:122)
(cid:124)
within subgroup term

s∈S
(cid:124)

(cid:123)(cid:122)
between-subgroup term

,

1
ω(s)
t
(cid:125)

(5)

(6)

t

:= µ(s)
t
µt

and ω(s)

where ν(s) := |D(s)|
|D|

. Note that GE(1)(s)

are GE(1)
and GE(0) indices of subgroup s in period t but we will not use them in the
following text. The between-subgroup terms of GE(1), GE(0) indices in equations
(5)-(6) can give us some ideas on deﬁning gender gap of Worker-Utility. We
gather all ideas above with a straightforward deﬁnition to be Inter-Fairt till
period t ∈ T + in (7).

, GE(0)(s)

t

t

Inter-Fair
t

:=






ln ω(s)
t

t

1. (cid:80)
2. (cid:80)
(cid:12)
(cid:12)µ(f )
(cid:12)

s∈S ν(s)ω(s)
s∈S ν(s) ln 1
ω(s)
t
t − µ(m)

3.

(cid:12)
(cid:12)
(cid:12)

t

GE(1)t
GE(0)t

(7)

Please note that the formula of Inter-Fairt can be easily extended to the cases

of multiple subgroups or overlapping subgroups of sensitive attributes.

4 Formulating Intra-, Inter-fairness and Customer-

Care

So far, we have mentioned three objectives that we wish to maximise (Customer-
Care) or minimise (Intra-fairness and Inter-Fair). However, the three objectives
are usually in conﬂict with each other. A natural approach to multi-objective
problems utilises a convexiﬁcation, e.g., a weighted sum of the objectives.

The resulting natural formulation entails selecting scalar weights γ(1), γ(2), γ(3)
and minimising convexiﬁed optimisation problem deﬁned in formulation (8), in
binary variables M (i,j)
, for j ∈ D.
The input of formulation (8) in period t is composed of d(i,j)
, for i ∈ Ct, j ∈ D;
Aj
t

, for i ∈ Ct, j ∈ D, and auxiliary variables uj
t

, for j ∈ D; |D(s)|, for s ∈ S; and γ(1), γ(2), γ(3).

, for i ∈ Ct; U j

, payi
t

, Λj
t

t−1

t

t

6

min
M (i,j)
t

, uj
t

s.t.

γ(1) Intra-Fair +γ(2) Inter-Fair −γ(3) Customer-Care

M (i,j)
t

(cid:18) i
pay
t

(cid:19)

−d(i,j)
t

(cid:88)

i∈Ct

= uj
t ,

j ∈ DAt=1

0 = uj
t ,

j ∈ DAt=0

M (i,j)
t

≥ 0,

j ∈ D

M (i,j)
t

= 1,

i ∈ Ct

Aj

t −

(cid:88)

i∈Ct
(cid:88)

j∈D

∈ {0, 1},

i ∈ Ct,

j ∈ D

M (i,j)
t
uj
t ≥ 0,

j ∈ D

(8a)

(8b)

(8c)

(8d)

(8e)

(8f)

(8g)

4.1 Augmented Lagrangian Relaxation

To optimise Formulation (8), one can utilise an augmented Lagrangian relaxation.
Instead of linear equality constraints in (8b,8c,8e,8f), we can consider their
violations squared.

For constraint (8b,8c,8e), their violations squared are straightforward: for

(cid:16)

(cid:17)2

0 − uj
t

, φ(2)
j

, φ(3)
i

, j ∈ DAt=0. As in [34],
instance, constraint (8c) can be transferred to
we can bring those violations squared into the objective with positive multipliers:
φ(1)
for the violation squared of constraint (8b,8c,8e) By making the
j
multipliers larger, we penalise constraint violations more severely, thereby forcing
the minimiser of the objective with quadratic penalty terms closer to the feasible
region for the constrained problem.
For integrality constraints M (i,j)

∈ {0, 1} in (8e), one may consider replace
it with a new constraint in (9) and bring it to the objective with a multiplier
φ(4)
i,j

, while one can also limit M (i,j)

to be non-negative.

t

t

(cid:16)

M (i,j)
t

M (i,j)
t

− 1

(cid:17)

= 0.

(9)

Figure 1 suggests the resulting augmented-Lagrangian reformulation in con-
tinuous variables M (i,j)
, for j ∈ D. Please be aware that
t
the values of φ(1)
, φ(2)
will be given directly in numeric illustration so they
j
are not regarded as variables in the formulation. The input of the formulation
in Figure 1 in period t is the same as that of the natural formulation (8).

, for i ∈ Ct, j ∈ D and uj
t
, φ(3)
i

j

Moreover, we can also consider the Lagrangian relaxation of the natural
formulation (8) and lift constraints (8b-8e) to the objective with Lagrangian mul-
tipliers λ(1)
respectively. Combined with augmented-Lagrangian
reformulation in Figure 1, we give a full relaxation formulation in Supplemental
materials which, however, will not be used for following numeric experiment for
simplicity.

, λ(3)
i

, λ(4)
j

, λ(2)
j

j

7

min
M (i,j)
t

,uj
t

γ(1) Intra-Fair +γ(2) Inter-Fair −γ(3) Customer-Care

(cid:88)

+

φ(1)
j

(cid:32)

(cid:88)

j∈DAt=1

i∈Ct

M (i,j)
t

(cid:18) i
pay
t

(cid:19)

−d(i,j)
t

(cid:33)2

− uj
t

+

(cid:88)

φ(2)
j

(cid:17)2

(cid:16)

uj
t

j∈DAt=0

+

(cid:88)

i∈Ct





(cid:88)

φ(3)
i



2

M (i,j)
t

− 1



+

j∈D
M (i,j)
t

≥ 0,

j ∈ D;

s.t.

Aj

t −

(cid:88)

i∈Ct

(cid:88)

(cid:88)

i∈Ct

j∈D

i,j M (i,j)
φ(4)

t

(cid:16)

M (i,j)
t

− 1

(cid:17)

M (i,j)
t

≥ 0,

i ∈ Ct,

j ∈ D;

uj
t ≥ 0,

j ∈ D;

Figure 1: The augmented-Lagrangian reformulation of the natural formulation (8)
in continuous variables M (i,j)
, for j ∈ D. The input is
the same as that of the natural formulation (8).

, for i ∈ Ct, j ∈ D and uj
t

t

4.2 Eﬃcient Approximability to Any Precision

Interestingly, one can optimise over the non-convex augmented Lagrangian of
Figure 1 to any ﬁxed precision in polynomial time. Formally, for any (cid:15) > 0,
one can approximate the solution of the non-convex non-linear optimisation
problem in Figure 1 to (cid:15) precision on the Turing machine in time polynomial in
the dimension. The proof follows from Theorem 2 of [34] and Theorems 5.1 and
5.2 of [35]. In particular, the Figure 1 plays the role of the equivalent problem
PE in Figure 1 and we can approximate the semideﬁnite programming (SDP)
relaxation B3 of [34] to any ﬁxed precision in polynomial time, following the
reasoning of Remark 5.1 of [35].

Notice that without considering the details of the bit-complexity of the
representation of the solution, one could apply standard convergence analyses
of primal-dual interior point methods for SDP bound B3 of Theorem 2 of [34],
instead of the results of [35].

Notice that across both the natural integer-programming formulation (8) and
the SDP relaxation of Figure 1, it is hard to prove tracking (regret) guarantees [23]
for on-line solvers for the time-varying problem. In the case of the convex SDP,
this may seem surprising, but [36] have recently shown that even under strong
assumptions on the regularity of the SDP (Slater’s and LICQ and continuity
of the changes to the input, e.g., only due to movements of the drivers), the
trajectory of solutions may be non-diﬀerentiable, there may be bifurcations,
and certain other irregular behaviours. This seems to rule out many traditional
approaches [37] of time-varying convex optimisation.

8

5 Experiments

Experimentally, we set out to answer these questions:

Q1. What combination of the individual measures of Intra- and Inter-fairness
in an objective function of the market-clearing mechanism works the best,
with respect to the individual measures of Intra- and Inter-fairness?

Q2. What is the trade-oﬀ between the Intra- and Inter-fairness?

In the Supplemental material, we also address other questions, such as: Can
the proposed market-clearing mechanism be implemented eﬃciently? How
stable is the trade-oﬀ in cross-validation? To answer these questions, we have
implemented:

• the augmented Lagrangian formulation of Figure 1 using the tssos library1
of Wang et al [38, 39, 38] following Section 4.2. For reference, we have
also implemented the non-convex version using IBM CPLEX Optimizer
Python API (CPLEX).

• the natural formulation (8) in two modelling frameworks: IBM CPLEX
Optimizer Python API and IBM Decision Optimisation CPLEX Optimizer
API for Python (DOcplex).

Subsequently, we used:

• IBM CPLEX Optimizer as Mixed Integer Linear Programming (MILP)
solver via its native API. This provides global optima of (8), but in the
worst case, in exponential time.

• IBM CP Optimizer as a Constraint Programming (CP) solver via DOcplex.

This does not provide guarantees of global optimality.

• SDPA as an SDP solver via the tssos library. This provides global optima
of Figure 1 in the worst case in polynomial time, as discussed in Section
4.2. As the degrees of objective and constraints in Figure 1 are all less
or equal to 2, we used the ﬁrst order of the correlative and term sparsity
exploiting moment/SOS (CS-TSSOS) hierarchy [38].

We include the comparison of runtime across the 3 solvers and 2 formulations in
the Supplemental material, which shows that the augmented Lagrangian relax-
ation does improve the runtime, compared with the exponential-time algorithms
of [13] for optimising Proportional Fairness.

We tested the methods on a subset of the well-known 2018 Yellow Taxi
Trip Dataset2, which were collected and provided to the NYC Taxi and Limou-
sine Commission (TLC) by technology providers authorised under the Taxicab &

1https://github.com/wangjie212/TSSOS
2https://data.cityofnewyork.us/Transportation/2018-Yellow-Taxi-Trip-Data/

t29m-gskq under licence http://www1.nyc.gov/home/terms-of-use.page

9

Figure 3: The distribu-
tions of Intra 2 and In-
ter 2 trade-oﬀ from 100
trials with formulation
Intra 5 + Inter 3 (L).
Each dot represents the
values of Intra 2 and In-
ter 2 measured post hoc
for the result of a trial.
The histograms on top
and on left show the dis-
tributions of Intra 2 and
Inter 2 for 100 trials, re-
spectively.

Figure 2: Experimental results of four formulations
implemented for 30 times (4 × 30 runs in total), in
DOcplex, with the same batch of NYC taxi dataset
but diﬀerent d(i,j)
for each run. The mean values of
six indices for the 30 implementations are denoted
as bars while the black horizontal line on top of each
bar denotes mean ± one standard deviation.

t

Livery Passenger Enhancement Programs (TPEP/LPEP). This dataset includes
ﬁelds capturing pick-up and drop-oﬀ dates/times, pick-up and drop-oﬀ locations,
trip distances, itemised fares, rate types, payment types, and driver-reported
passenger counts. While the dataset is large, the matching of rides to drivers is
typically run frequently, for small batches of rides and drivers. Indeed: making
the batches larger would leave both customers and drivers to wait longer for their
matches. Even during the rush hour, it may be preferable to narrow down the
search area (to a few closest drivers) and utilise the same small batch sizes. We
have hence run a repeated k-fold cross-validation with randomly chosen batches
from the dataset. (See Section 5.2 and Supplemental material for the details.)
To formalise each batch: Suppose there are 5 jobs in period t, i.e., Ct =
{i0, . . . , i4}. We have 5 workers in the system in total, i.e., D = {j0, . . . , j4},
among which j2, j4 are females. Hence, |D| = 5, |D(f )| = 2, |D(m)| = 3. All
workers are all available in period t, thus Aj
t = 1, for j ∈ D. For simplicity, we
assume in period t all workers are new to the system, hence their accumulated
utility U j
are zero. We deﬁne the maximal
return rate til period t − 1 as mt−1 := maxk∈D U k
.The values of payi
t−1/Λk
t, i ∈
Ct correspond to the trip distances within the batch. The values of d(i,j)
, i ∈
, φ(2)
Ct, j ∈ D are uniform random variables from the interval of [0, 0.5]. φ(1)
i

and accumulated active time Λj

t−1

t−1

t−1

j

t

10

 , Q W U D     * (   , Q W U D     * (   , Q W U D     * L Q L  , Q W H U   , Q W H U   , Q W H U   0 H D V X U H P H Q W V  R I  , Q H T X D O L W \                         9 D O X H V     ) R U P X O D W L R Q V , Q W U D      , Q W H U   , Q W U D      , Q W H U   , Q W U D      , Q W H U   6  K U  H W  D O       , Q W U D   , Q W H U  are both set to 10 in following experiments so that the optimum of Augmented-
Lagrangian relaxation in Figure 1 can be reached. We do not consider Customer-
Care in experiments focusing on the trade-oﬀ between notions of fairness and
set γ(3) to 0 across all formulations.

5.1 A Comparison of the Notions of Fairness

To answer Q1, notice that we have three types of Inter-fairness in (7), which
are called Inter 1,..., Inter 3, and ﬁve types of Intra-fairness in (4), which are
called Intra 1, ..., Intra 5. We can optimise with respect to a combination of
these, and evaluate the Optimizer with respect to any of these fairness measures
post hoc. To reduce the number of comparisons to be made, but to preserve the
comparability with the results of [13], who minimise Intra 5 without considering
Inter-fairness, we use Intra 5 in the objective throughout, possibly combined
with Inter 1, Inter 2 or Inter 3 with equal weights. This way, we obtain four
explicit formulations: Intra 5 + Inter 1, Intra 5 + Inter 2, Intra 5 + Inter 3, and
“Sühr et al. 2019”, where γ(2) = 0 and γ(1) = 1.

In Figure 2, we compare the four formulations, as suggested by four diﬀerent
colours, in terms of mean values of Intra 2 (GE(1)t), Intra 3 (GE(0)t), Intra 4
(Ginit), and Inter 1, Inter 2, Inter 3 for 30 runs, as suggested by the bars. The four
formulations are implemented for 30 times each (4 × 30 runs in total) in IBM®
Decision Optimisation CPLEX Optimizer Modelling for Python (DOcplex), with
the same batch randomly chosen from the dataset but diﬀerent d(i,j)
for each
run. Each experiment gives a matching of workers and jobs, from which we can
calculate the values of Intra 2 (GE(1)t), Intra 3 (GE(0)t), Intra 4 (Ginit), and
Inter 1, Inter 2, Inter 3 for each implementation. The black vertical line on top
of each bar suggests mean ± one standard deviation.

t

In terms of Intra-fairness, we included Intra 5 in the objective throughout,
and the results are comparable across all four formulations and all three measures
of Intra-fairness used in the evaluation. In terms of Inter-fairness, however, we
show that including the Inter-fairness in the objective, improves the Inter 1,
Inter 2, Inter 3 measures of Inter-fairness, without a detrimental impact on
the Intra-fairness. The minimisation of a combination of Intra- and Inter-
fairness, especially Intra 5 + Inter 3, signiﬁcantly decreases Inter-fairness, does
not lower measures of Intra-fairness as “Sühr et al. 2019”. In particular, we
conducted a one-way ANOVA test on index Inter 3 across the four formulations,
which suggests that the mean values of index Inter 3 are signiﬁcantly diﬀerent
(f = 16.06, p = 8.46 × 10−9). Especially, an independent T test between index
Inter 3 of Intra 5 + Inter 3 and “Sühr et al. 2019” shows that Intra 5 + Inter 3
has a signiﬁcant eﬀect on improving Inter-fairness (t = −4.95, p = 6.69 × 10−6).

5.2 A Trade-oﬀ between Intra- & Inter-fairness

To answer Q2, notice that Intra-, Inter-fairness, and Customer-Care objectives
are in conﬂict, but we can trace the set of Pareto optimal solutions. Pareto
optimal solutions provide an optimal trade-oﬀ between multiple objectives, in

11

Figure 4: An illustration of the trade-oﬀ between Intra- and Inter-fairness
in a single trial. The position of each dot represent the value of Intra- and
Inter-fairness from one experiment using the implementation of the augmented-
Lagrangian formulation in Figure 1 in tssos. Red dots suggest the use of
γ(1) = 1, γ(2) = 0, as in [13]. Green dots suggest the use of Intra 5 + Inter 3 (L).
The Pareto front is shown by a black curve. See the Supplemental material for
further details.

the sense that it is not possible to improve one objective without detriment
to another objectives. The set of all Pareto optimal solutions is known as the
Pareto front.

Here, we focus on the trade-oﬀ between Intra- and Inter-fairness, while the
same procedures can be extended to Customer-Care too. (See [15, 20].) For
the formulation “Intra 5 + Inter 1”, the value of γ(1) is uniformly sampled from
[0.5, 0.9] with the interval of 0.1 and γ(2) is set to 1 − γ(1). Note that the term
“(L)” in the legend shows that we use the augmented Lagrangian formulation in
Figure 1 instead of the natural formulation (8) for implementation. In “Sühr et
al. 2019”, we take γ(1) = 1, γ(2) = 0. For each formulation, we run 250 times
with a batch chosen randomly from the dataset being the same across the two
formulations.

In Figure 4, we present the results of each run of an experiment using tssos
with one dot. For each experiment, we calculate the values of Intra 2,...,Intra 4
and Inter 1,...,Inter 3 from the results post hoc. We use the results to position
the dots in the corresponding sub-plots. The results of “Sühr et al. 2019
(L)” [13], which are shown in red dots, are overwhelmingly dominated by the
results of our formulation Intra 5 + Inter 3 (L), which are shown by green dots.
Correspondingly, Pareto front, which is shown by a black curve, is composed
mostly of results of Intra 5 + Inter 3 (L). While this results should not be
particularly surprising, it suggests that Inter-fairness can be included in the
objective without any harm in terms of Intra-fairness.

Since each batch contains only 5 jobs, there might be concerns about whether
it can be representative of the behaviour on the Yellow Taxi Trip Dataset. We

12

Intra 2 [GE1]Inter 1Intra 2 [GE1]Inter 2Intra 2 [GE1]Inter 3Intra 3 [GE0]Inter 1Intra 3 [GE0]Inter 2Intra 3 [GE0]Inter 3Intra 4 [Gini]Inter 1Intra 4 [Gini]Inter 2Intra 4 [Gini]Inter 3Pareto frontSühr et al. 2019 (L)Intra 5 + Inter 3 (L)have hence performed additional trials, where in each trial, a new batch is
sampled from the Yellow Taxi Trip Dataset as described above and used across
all implementations. In Figure 3, we present the distributions of Intra 2 and
Inter 2 trade-oﬀ from 100 trials with Intra 5 + Inter 3 (L) ( γ(1) = γ(2) = 0.5).
Each dot represents the values of Intra 2 and Inter 2 of one trial. The histograms
on top and one left side show the distribution of Intra 2 and Inter 2 of the 100
trials. We include the pseudo code for the cross-validation and the trade-oﬀ plots
between all other Intra-fairness and Inter-fairness notions in the Supplemental
material.

6 Conclusions

We have introduced the notion of Inter-fairness across subgroups in a two-
sided market, in addition to Intra-subgroup fairness, among individuals within
a subgroup. We have explored the trade-oﬀ between Intra-group and Inter-
group fairness on the example of a ride-hailing using Yellow Taxi Trip Dataset.
Furthermore, we have shown that considering both objectives at the same time
is possible within the market clearing, and leads to a an eﬃciently approximable
non-convex augmented Lagrangian formulation. We have presented promising
computational results for several numerical routines; an approach considering
a convex combination of objectives Intra 5 and Inter 3 seemed particularly
promising.

We hope that the notion, the insights, and algorithms may be applicable
across a range of two-sided markets, such as online labour platforms and college
admissions, and perhaps extended towards comprehensive framework for multiple
fairness criteria, such as the fairness resolution model in [40] and the permutation
testing framework in [41]. One could also consider robust [22, 21] extensions.

Acknowledgements

Quan’s and Bob’s work has been supported by the Science Foundation Ireland
under Grant 16/IA/4610. Jakub acknowledges funding from RCI (reg. no.
CZ.02.1.01/0.0/ 0.0/16_019/0000765) supported by the European Union. We
are grateful to Angela Zhang for her kind reading of the manuscript.

References

[1] J.-C. Rochet and J. Tirole, “Deﬁning two-sided markets,” Citeseer, Tech.

Rep., 2004.

[2] ——, “Two-sided markets: a progress report,” The RAND journal of eco-

nomics, vol. 37, no. 3, pp. 645–667, 2006.

[3] A. R. Barzilay and A. Ben-David, “Platform inequality: gender in the

gig-economy,” Seton Hall L. Rev., vol. 47, p. 393, 2016.

13

[4] N. Van Doorn, “Platform labor: on the gendered and racialized exploita-
tion of low-income service work in the ‘on-demand’economy,” Information,
Communication & Society, vol. 20, no. 6, pp. 898–914, 2017.

[5] C. Liang, Y. Hong, B. Gu, and J. Peng, “Gender wage gap in online gig
economy and gender diﬀerences in job preferences,” Available at SSRN
3266249, 2018.

[6] E. Bokányi and A. Hannák, “Understanding inequalities in ride-hailing
services through simulations,” Scientiﬁc reports, vol. 10, no. 1, pp. 1–11,
2020.

[7] C. Cook, R. Diamond, J. Hall, J. A. List, and P. Oyer, “The gender earnings
gap in the gig economy: Evidence from over a million rideshare drivers,”
National Bureau of Economic Research, Tech. Rep., 2018.

[8] M. Bertrand, C. Goldin, and L. F. Katz, “Dynamics of the gender gap
for young professionals in the ﬁnancial and corporate sectors,” American
economic journal: applied economics, vol. 2, no. 3, pp. 228–55, 2010.

[9] A. Hunt and E. Samman, “Gender and the gig economy,” ODI Working

Paper 546, Tech. Rep., 2019.

[10] D. Farrell and F. Greig, “Paychecks, paydays, and the online platform
economy,” in Proceedings. Annual Conference on Taxation and Minutes of
the Annual Meeting of the National Tax Association, vol. 109.
JSTOR,
2016, pp. 1–40.

[11] B. Balaram, J. Warden, and F. Wallace-Stephens, “Good gigs: A fairer

future for the uk’s gig economy,” London: RSA, 2017.

[12] J. Jones, “5 facts about the state of the gender pay gap,” [EB/OL], https://

blog.dol.gov/2021/03/19/5-facts-about-the-state-of-the-gender-pay-gap.

[13] T. Sühr, A. J. Biega, M. Zehlike, K. P. Gummadi, and A. Chakraborty,
“Two-sided fairness for repeated matchings in two-sided markets: A case
study of a ride-hailing platform,” in Proceedings of the 25th ACM SIGKDD
International Conference on Knowledge Discovery & Data Mining, 2019,
pp. 3082–3092.

[14] F. Yang, M. Cisse, and S. Koyejo, “Fairness with overlapping groups; a
probabilistic perspective,” in Advances in Neural Information Processing
Systems, H. Larochelle, M. Ranzato, R. Hadsell, M. F. Balcan, and
H. Lin, Eds., vol. 33. Curran Associates,
Inc., 2020, pp. 4067–
4078. [Online]. Available: https://proceedings.neurips.cc/paper/2020/ﬁle/
29c0605a3bab4229e46723f89cf59d83-Paper.pdf

[15] T. Speicher, H. Heidari, N. Grgic-Hlaca, K. P. Gummadi, A. Singla,
A. Weller, and M. B. Zafar, “A uniﬁed approach to quantifying algorithmic
unfairness: Measuring individual &group unfairness via inequality indices,”

14

in Proceedings of the 24th ACM SIGKDD International Conference on
Knowledge Discovery & Data Mining, 2018, pp. 2239–2248.

[16] N. S. Lesmana, X. Zhang, and X. Bei,

“Balancing eﬃciency and
fairness in on-demand ridesourcing,” in Advances in Neural Information
Processing Systems, H. Wallach, H. Larochelle, A. Beygelzimer, F. d’Alché
Buc, E. Fox, and R. Garnett, Eds., vol. 32. Curran Associates, Inc.,
2019. [Online]. Available: https://proceedings.neurips.cc/paper/2019/ﬁle/
3070e6addcd702cb58de5d7897bfdae1-Paper.pdf

[17] G. K. Patro, A. Biswas, N. Ganguly, K. P. Gummadi, and A. Chakraborty,
“Fairrec: Two-sided fairness for personalized recommendations in two-sided
platforms,” in Proceedings of The Web Conference 2020, 2020, pp. 1194–
1204.

[18] C. C. Giapponi and S. A. McEvoy, “The legal, ethical, and strategic implica-
tions of gender discrimination in compensation: Can the fair pay act succeed
where the equal pay act has failed?” Journal of Individual Employment
Rights, vol. 12, no. 2, 2005.

[19] M. Hardt, E. Price, E. Price, and N. Srebro, “Equality of opportunity in
supervised learning,” in Advances in Neural Information Processing Systems,
D. Lee, M. Sugiyama, U. Luxburg, I. Guyon, and R. Garnett, Eds., vol. 29.
Curran Associates, Inc., 2016. [Online]. Available: https://proceedings.
neurips.cc/paper/2016/ﬁle/9d2682367c3935defcb1f9e247a97c0d-Paper.pdf

[20] M. Wick, S. Panda, and J.-B. Tristan,

a
in Advances in Neural Information Processing
trade-oﬀ revisited,”
Systems, H. Wallach, H. Larochelle, A. Beygelzimer, F. d’Alché Buc,
E. Fox, and R. Garnett, Eds., vol. 32. Curran Associates,
Inc.,
2019. [Online]. Available: https://proceedings.neurips.cc/paper/2019/ﬁle/
373e4c5d8edfa8b74fd4b6791d0cf6dc-Paper.pdf

“Unlocking fairness:

[21] P. Lahoti, A. Beutel, J. Chen, K. Lee, F. Prost, N. Thain, X. Wang,
“Fairness without demographics through adversarially
and E. Chi,
in Advances in Neural Information Processing
reweighted learning,”
Systems, H. Larochelle, M. Ranzato, R. Hadsell, M. F. Balcan,
and H. Lin, Eds., vol. 33. Curran Associates,
Inc., 2020, pp.
728–740. [Online]. Available: https://proceedings.neurips.cc/paper/2020/
ﬁle/07fc15c9d169ee48573edd749d25945d-Paper.pdf

[22] S. Wang, W. Guo, H. Narasimhan, A. Cotter, M. Gupta, and M. Jordan,
“Robust optimization for fairness with noisy protected groups,” in Advances
in Neural Information Processing Systems, H. Larochelle, M. Ranzato,
R. Hadsell, M. F. Balcan, and H. Lin, Eds., vol. 33. Curran Associates,
Inc., 2020, pp. 5190–5203. [Online]. Available: https://proceedings.neurips.
cc/paper/2020/ﬁle/37d097caf1299d9aa79c2c2b843d2d78-Paper.pdf

15

[23] S. Cayci, S. Gupta, and A. Eryilmaz,

“Group-fair online allocation
in continuous time,”
in Advances in Neural Information Processing
Systems, H. Larochelle, M. Ranzato, R. Hadsell, M. F. Balcan, and
H. Lin, Eds., vol. 33. Curran Associates,
Inc., 2020, pp. 13 750–
13 761. [Online]. Available: https://proceedings.neurips.cc/paper/2020/ﬁle/
9ec0cfdc84044494e10582436e013e64-Paper.pdf

[24] C. Dwork, M. Hardt, T. Pitassi, O. Reingold, and R. Zemel, “Fairness
through awareness,” in Proceedings of the 3rd innovations in theoretical
computer science conference, 2012, pp. 214–226.

[25] H. Abdollahpouri, G. Adomavicius, R. Burke, I. Guy, D. Jannach,
T. Kamishima, J. Krasnodebski, and L. Pizzato, “Multistakeholder rec-
ommendation: Survey and research directions,” User Modeling and User-
Adapted Interaction, vol. 30, no. 1, pp. 127–158, 2020.

[26] M. J. Kusner, J. Loftus, C. Russell, and R. Silva, “Counterfactual fairness,”
in Advances in Neural Information Processing Systems, 2017, pp. 4066–4076.

[27] A. F. Shorrocks, “The class of additively decomposable inequality measures,”
Econometrica: Journal of the Econometric Society, pp. 613–625, 1980.

[28] H. Theil, “The measurement of inequality by components of income,” Eco-

nomics Letters, vol. 2, no. 2, pp. 197–199, 1979.

[29] ——, “World income inequality and its components,” Economics Letters,

vol. 2, no. 1, pp. 99–102, 1979.

[30] D. Mookherjee and A. Shorrocks, “A decomposition analysis of the trend in
uk income inequality,” The Economic Journal, vol. 92, no. 368, pp. 886–902,
1982.

[31] B. Milanovic and S. Yitzhaki, Decomposing world income distribution: Does

the world have a middle class? The World Bank, 2001.

[32] S. Mussard, F. Seyte, and M. Terraza, “Decomposition of gini and the
generalized entropy inequality measures,” Economics Bulletin, vol. 4, no. 7,
pp. 1–6, 2003.

[33] R. N. Costa, S. Pérez-Duarte et al., “Not all inequality measures were
created equal-the measurement of wealth inequality, its decompositions,
and an application to european household wealth,” European Central Bank,
Tech. Rep., 2019.

[34] S. Poljak, F. Rendl, and H. Wolkowicz, “A recipe for semideﬁnite relaxation
for (0, 1)-quadratic programming,” Journal of Global Optimization, vol. 7,
no. 1, pp. 51–73, 1995.

[35] L. Porkolab and L. Khachiyan, “On the complexity of semideﬁnite programs,”

Journal of Global Optimization, vol. 10, no. 4, pp. 351–365, 1997.

16

[36] A. Bellon, D. Henrion, V. Kungurtsev, and J. Marecek, “Time-varying
semideﬁnite programming: Geometry of the trajectory of solutions,” arXiv
preprint arXiv:2104.05445, 2021.

[37] A. Simonetto, E. Dall’Anese, S. Paternain, G. Leus, and G. B. Giannakis,
“Time-varying convex optimization: Time-structured algorithms and appli-
cations,” Proceedings of the IEEE, vol. 108, no. 11, pp. 2032–2048, 2020.

[38] J. Wang, V. Magron, J. B. Lasserre, and N. H. A. Mai, “Cs-tssos: Correlative
and term sparsity for large-scale polynomial optimization,” arXiv preprint
arXiv:2005.02828, 2020.

[39] J. Wang, V. Magron, and J.-B. Lasserre, “Chordal-tssos: a moment-sos
hierarchy that exploits term sparsity with chordal extension,” arXiv preprint
arXiv:2003.03210, 2020.

[40] P. Awasthi, C. Cortes, Y. Mansour, and M. Mohri, “Beyond individual and

group fairness,” arXiv preprint arXiv:2008.09490, 2020.

[41] C. DiCiccio, S. Vasudevan, K. Basu, K. Kenthapadi, and D. Agarwal,
“Evaluating fairness using permutation tests,” in Proceedings of the 26th
ACM SIGKDD International Conference on Knowledge Discovery & Data
Mining, 2020, pp. 1467–1477.

[42] J.-C. Rochet and J. Tirole, “Two-sided markets: an overview,” Institut

d’Economie Industrielle working paper, 2004.

[43] D. Zeng and A. Psomas, “Fairness-eﬃciency tradeoﬀs in dynamic fair di-
vision,” in Proceedings of the 21st ACM Conference on Economics and
Computation, ser. EC ’20. New York, NY, USA: Association for Comput-
ing Machinery, 2020, p. 911–912.

[44] R. M. Karp, U. V. Vazirani, and V. V. Vazirani, “An optimal algorithm
for on-line bipartite matching,” in Proceedings of the twenty-second annual
ACM symposium on Theory of computing, 1990, pp. 352–358.

[45] A. Torrico, S. Ahmed, and A. Toriello, “A polyhedral approach to online
bipartite matching,” Mathematical Programming, vol. 172, no. 1-2, pp.
443–465, 2018.

[46] A. Bernstein, J. Holm, and E. Rotenberg, “Online bipartite matching with
amortized o (log 2 n) replacements,” Journal of the ACM (JACM), vol. 66,
no. 5, pp. 1–23, 2019.

[47] V. Nanda, P. Xu, K. A. Sankararaman, J. P. Dickerson, and A. Srinivasan,
“Balancing the tradeoﬀ between proﬁt and fairness in rideshare platforms
during high-demand hours,” arXiv preprint arXiv:1912.08388, 2019.

[48] M. Fahrbach, Z. Huang, R. Tao, and M. Zadimoghaddam, “Edge-weighted
online bipartite matching,” arXiv preprint arXiv:2005.01929, 2020.

17

[49] Z. Huang and Q. Zhang, “Online primal dual meets online matching with
stochastic rewards: conﬁguration lp to the rescue,” in Proceedings of the
52nd Annual ACM SIGACT Symposium on Theory of Computing, 2020, pp.
1153–1164.

[50] Y. Li, J. Fang, Y. Zeng, B. Maag, Y. Tong, and L. Zhang, “Two-sided online
bipartite matching in spatial data: experiments and analysis,” GeoInfor-
matica, vol. 24, no. 1, pp. 175–198, 2020.

[51] P. Cheng, X. Jian, and L. Chen, “An experimental evaluation of task
assignment in spatial crowdsourcing,” Proceedings of the VLDB Endowment,
vol. 11, no. 11, pp. 1428–1440, 2018.

[52] Z. Huang, N. Kang, Z. G. Tang, X. Wu, Y. Zhang, and X. Zhu, “How to
match when all vertices arrive online,” in Proceedings of the 50th Annual
ACM SIGACT Symposium on Theory of Computing, 2018, pp. 17–29.

[53] L. Kazemi and C. Shahabi, “Geocrowd: enabling query answering with
spatial crowdsourcing,” in Proceedings of the 20th international conference
on advances in geographic information systems, 2012, pp. 189–198.

[54] Y. Tong, L. Wang, Z. Zimu, B. Ding, L. Chen, J. Ye, and K. Xu, “Flexible
online task assignment in real-time spatial data,” Proceedings of the VLDB
Endowment, vol. 10, no. 11, pp. 1334–1345, 2017.

[55] L. Zhang, T. Hu, Y. Min, G. Wu, J. Zhang, P. Feng, P. Gong, and J. Ye,
“A taxi order dispatch model based on combinatorial optimization,” in Pro-
ceedings of the 23rd ACM SIGKDD international conference on knowledge
discovery and data mining, 2017, pp. 2151–2159.

[56] Z. Huang, Z. G. Tang, X. Wu, and Y. Zhang, “Online vertex-weighted
bipartite matching: Beating 1-1/e with random arrivals,” ACM Transactions
on Algorithms (TALG), vol. 15, no. 3, pp. 1–15, 2019.

[57] Z. Huang, B. Peng, Z. G. Tang, R. Tao, X. Wu, and Y. Zhang, “Tight
competitive ratios of classic matching algorithms in the fully online model,”
in Proceedings of the Thirtieth Annual ACM-SIAM Symposium on Discrete
Algorithms. SIAM, 2019, pp. 2875–2886.

[58] J. P. Dickerson, K. A. Sankararaman, A. Srinivasan, and P. Xu, “Balancing
relevance and diversity in online bipartite matching via submodularity,” in
Proceedings of the AAAI Conference on Artiﬁcial Intelligence, vol. 33, 2019,
pp. 1877–1884.

[59] F. Ahmed, J. P. Dickerson, and M. Fuge, “Diverse weighted bipartite b-

matching,” arXiv preprint arXiv:1702.07134, 2017.

[60] C. Chen, L. Zheng, V. Srinivasan, A. Thomo, K. Wu, and A. Sukow,
“Conﬂict-aware weighted bipartite b-matching and its application to e-
commerce,” IEEE Transactions on Knowledge and Data Engineering, vol. 28,
no. 6, pp. 1475–1488, 2016.

18

[61] K. Fu, F. Meng, J. Ye, and Z. Wang, “Compacteta: A fast inference system
for travel time prediction,” in Proceedings of the 26th ACM SIGKDD
International Conference on Knowledge Discovery & Data Mining, 2020,
pp. 3337–3345.

[62] L. Zhu, W. Yu, K. Zhou, X. Wang, W. Feng, P. Wang, N. Chen, and
P. Lee, “Order fulﬁllment cycle time estimation for on-demand food delivery,”
in Proceedings of the 26th ACM SIGKDD International Conference on
Knowledge Discovery & Data Mining, 2020, pp. 2571–2580.

[63] Z. Wang, K. Fu, and J. Ye, “Learning to estimate the travel time,” in Pro-
ceedings of the 24th ACM SIGKDD International Conference on Knowledge
Discovery & Data Mining, 2018, pp. 858–866.

[64] Y. Ge, C. Liu, H. Xiong, and J. Chen, “A taxi business intelligence system,”
in Proceedings of the 17th ACM SIGKDD international conference on
Knowledge discovery and data mining, 2011, pp. 735–738.

[65] M. Qu, H. Zhu, J. Liu, G. Liu, and H. Xiong, “A cost-eﬀective recommender
system for taxi drivers,” in Proceedings of the 20th ACM SIGKDD inter-
national conference on Knowledge discovery and data mining, 2014, pp.
45–54.

[66] S. Qian, J. Cao, F. L. Mouël, I. Sahel, and M. Li, “Scram: A sharing
considered route assignment mechanism for fair taxi route recommendations,”
in Proceedings of the 21th ACM SIGKDD International Conference on
Knowledge Discovery and Data Mining, 2015, pp. 955–964.

[67] M. Grbovic and H. Cheng, “Real-time personalization using embeddings
for search ranking at airbnb,” in Proceedings of the 24th ACM SIGKDD
International Conference on Knowledge Discovery & Data Mining, 2018,
pp. 311–320.

[68] G. K. Patro, A. Chakraborty, N. Ganguly, and K. Gummadi, “Incremental
fairness in two-sided market platforms: on smoothly updating recommen-
dations,” in Proceedings of the AAAI Conference on Artiﬁcial Intelligence,
vol. 34, no. 01, 2020, pp. 181–188.

[69] R. Mehrotra, B. Carterette, Y. Li, Q. Yao, C. Gao, J. Kwok, Q. Yang, and
I. Guyon, “Advances in recommender systems: From multi-stakeholder mar-
ketplaces to automated recsys,” in Proceedings of the 26th ACM SIGKDD
International Conference on Knowledge Discovery & Data Mining, 2020,
pp. 3533–3534.

[70] L. R. Ford Jr and D. R. Fulkerson, “A suggested computation for maximal
multi-commodity network ﬂows,” Management Science, vol. 5, no. 1, pp.
97–101, 1958.

[71] J. R. Correa, A. S. Schulz, and N. E. Stier-Moses, “Fast, fair, and eﬃcient
ﬂows in networks,” Operations Research, vol. 55, no. 2, pp. 215–225, 2007.

19

[72] J. J. Jarvis and H. D. Ratliﬀ, “Note—some equivalent objectives for dynamic
network ﬂow problems,” Management science, vol. 28, no. 1, pp. 106–109,
1982.

[73] E. Koutsoupias and C. Papadimitriou, “Worst-case equilibria,” in Annual
Symposium on Theoretical Aspects of Computer Science. Springer, 1999,
pp. 404–413.

[74] C. Papadimitriou, “Algorithms, games, and the internet,” in Proceedings of
the thirty-third annual ACM symposium on Theory of computing, 2001, pp.
749–753.

[75] M. Mavronicolas and P. Spirakis, “The price of selﬁsh routing,” in Proceedings
of the thirty-third annual ACM symposium on Theory of computing, 2001,
pp. 510–519.

[76] A. Czumaj, P. Krysta, and B. Vöcking, “Selﬁsh traﬃc allocation for server
farms,” in Proceedings of the thiry-fourth annual ACM symposium on Theory
of computing, 2002, pp. 287–296.

[77] A. S. Schulz and N. Stier Moses, “On the performance of user equilibria in

traﬃc networks,” in Proceedings of SODA, 2003, pp. 86–87.

[78] T. Roughgarden and É. Tardos, “How bad is selﬁsh routing?” Journal of

the ACM (JACM), vol. 49, no. 2, pp. 236–259, 2002.

[79] J. R. Correa, A. S. Schulz, and N. E. Stier-Moses, “Selﬁsh routing in
capacitated networks,” Mathematics of Operations Research, vol. 29, no. 4,
pp. 961–976, 2004.

[80] ——, “On the ineﬃciency of equilibria in congestion games,” in Interna-
tional Conference on Integer Programming and Combinatorial Optimization.
Springer, 2005, pp. 167–181.

[81] ——, “A geometric approach to the price of anarchy in nonatomic congestion
games,” Games and Economic Behavior, vol. 64, no. 2, pp. 457–469, 2008.

[82] R. Zwick, Fair game?: The use of standardized admissions tests in higher

education. Psychology Press, 2002.

[83] J. Hyman, “Act for all: The eﬀect of mandatory college entrance exams
on postsecondary attainment and choice,” Education Finance and Policy,
vol. 12, no. 3, pp. 281–311, 2017.

[84] N. Garg, H. Li, and F. Monachou, “Standardized tests and aﬃrmative action:
The role of bias and variance,” arXiv preprint arXiv:2010.04396, 2020.

[85] J. Furuta, “Rationalization and student/school personhood in us college
admissions: The rise of test-optional policies, 1987 to 2015,” Sociology of
Education, vol. 90, no. 3, pp. 236–254, 2017.

20

[86] G. Ross, “Social justice and social justice leadership for african american
male students and the sat/act scores,” Act Scores (October 10, 2020), 2020.

[87] R. M. Anderson, H. Heesterbeek, D. Klinkenberg, and T. D. Hollingsworth,
“How will country-based mitigation measures inﬂuence the course of the
covid-19 epidemic?” The Lancet, vol. 395, no. 10228, pp. 931–934, 2020.

21

A Additional Related Work

A.1 Online Matching in Two-Sided Markets

The gig economy is often modelled as a “two-sided market”, cf. [1, 42, 2]. The
nascent study of fairness-eﬃciency trade-oﬀs in such dynamic markets [43] has
not encompassed subgroup fairness yet. It builds, however, on an extensive
literature on online bipartite matching, which has been studied at least since
[44]. Notice that, ultimately, one matches workers to jobs.

There are several models of online bipartite matching.

In the model of
[44], one part of the bipartite graph (“workers”) is ﬁxed and known in advance,
while nodes from the other part (“jobs”) arrive online and must immediately
be matched or discarded [45–47]. This model has many applications in online
advertising platforms [48, 49]; a wide range of novel applications arise [50] in
the sharing economy, including applications within task assignment in spatial
crowd-sourcing, real-estate agencies, and food delivery [51–54]. Especially, in
the application of ride-sharing platforms, it could be a powerful tool for taxi
order dispatch systems [55].

In the fully online matching model of [52, 56, 57], all vertices are allowed
to arrive online. This seems particularly useful in ride-hailing platforms, where
drivers could be matched rapidly to customers seeking a ride, while both drivers
and customers are often assumed to arrive in an on-line manner.

Throughout both models, the online matching literature focuses on max-
imising the aggregate value of the matching [44, 46, 51, 54, 52]. However, in
many real-world problems, it is also important to consider the contributions of
diversity [58], for instance, matching academic papers to potential reviewers [59],
recommendations of new books and movies on eBay to potential buyers [60].
This notion of diversity in matching can be seen as a step towards the notion of
fairness that we introduce.

Ride sharing is one of the most important sections of the gig economy, and
there is a considerable amount of research focussed on it. For instance, travel
time prediction [61–63], recommendation systems [64–67]. While the traditional
way is to focus on the satisfaction of passengers, drivers’ experience in ride
hailing platforms is attracting increasing attention, such as discrimination against
minorities [13], frequent updates leaving no room for the producers to adjust
[68]. To balance between eﬃciency and fairness, [69] discuss multi-objective
ranking and recommendation techniques. Particularly, [66] design a sharing
considered a route assignment mechanism for fair taxi route recommendations
without sacriﬁcing driving eﬃciency.

A.2 Dynamic Network Flows

Bipartite matching should be seen as a special case of network ﬂows.
[70]
initiated the study of minimising latency. [71, 72] proposed three fairness notions
in dynamic ﬂows, e.g., minimising the average latency, minimising the maximum
latency, or ensuring similar users experience similar latency. The objective

22

of minimising the average latency has been discussed, for example, by [73–76].
[77–81] consider the average latency, for instance. In the example of a ride-hailing
system where the assigned ﬂows can be seen as drivers’ utility, to minimise the
maximum latency or the average latency in network routing is also a powerful
tool for equalising the drivers’ utility. However, the fairness in network ﬂows has
not taken subgroup fairness into account.

A.3 College Admission

In addition to two-sided markets, the proposed method in our paper oﬀers
an insight into the well-known problem of college admission, which has long
been a source of controversy. From the colleges’ standpoint, the objective of
the admission oﬃce is to maximise the expected academic quality of admitted
students. From the point of view of fairness and diversity, measures of scholastic
aptitude (e.g., the ACT and SAT), have long been seen as a “wealth test” [82–84].
In the US, a substantial attention has hence focussed on the so-called aﬃrmative
action, which has been designed to increase the educational attainment of
disadvantaged students [83]. This has recently developed into test-optional
college admissions [85, 86]. This trend has been accelerated by the onset of the
Covid-19 pandemic [87]. In the application of college admission, candidates can
be divided into subgroups by race, gender, language etc. and there is no limit on
overlapping subgroups. Our Inter-fairness would request some statistical indices,
such as the rate of admission, to be equalised across diﬀerent subgroups. Clearly,
Inter-fairness focuses on lifting ethnic diversity and on balancing between ethnic
diversity and academic quality, we could also use the weighted sum of the two
objectives.

B Full Details of the Formulations

B.1 Full Formulation

We consider the Lagrangian relaxation of the natural formulation (8) and lift con-
straints (8b-8e) to the objective with Lagrangian multipliers λ(1)
, λ(3)
i
respectively. Combined with augmented-Lagrangian reformulation in Figure 1,
we give a full relaxation formulation in Figure 5.

, λ(2)
j

, λ(4)
j

j

C Appendix C: Full Details of the Experiments

C.1 Cross Validation

Let us denote the batched input described in Section 5 in the main body of the
paper with Ot. Since batch Ot contains only 5 jobs, there might be concerns
about whether it can capture the behaviour of the whole dataset of NYC Taxi.
We call it a trial if the same subset of trip distances in NYC Taxi dataset is used

23

min
,uj

M (i,j)
t

t ,φ,λ

γ(1) Intra-Fair +γ(2) Inter-Fair −γ(3) Customer-Care

+ (cid:80)

j∈DAt=1 φ(1)

j

(cid:16)(cid:80)

i∈Ct

(cid:16)

M (i,j)
t

payi

t −d(i,j)

t

(cid:17)

− uj
t

(cid:17)2

+ (cid:80)

j∈DAt=0 φ(2)

j

(cid:17)2

(cid:16)

uj
t

+ (cid:80)

φ(3)
i

i∈Ct

(cid:16)(cid:80)

j∈D M (i,j)

t

(cid:17)2

− 1

+ (cid:80)

i∈Ct

(cid:80)

j∈D φ(4)

i,j M (i,j)

t

(cid:16)

M (i,j)
t

(cid:17)

− 1

(cid:16)(cid:80)

i∈Ct

(cid:16)

M (i,j)
t

payi

t −d(i,j)

t

(cid:17)

− uj
t

(cid:17)

+ (cid:80)

λ(3)
i

(cid:16)(cid:80)

j∈D M (i,j)

t

(cid:17)

− 1

+ (cid:80)

j∈D λ(4)

j

(cid:16)(cid:80)

M (i,j)
t

− Aj
t

i∈Ct

(cid:17)

s.t.

≥ 0,

j

j∈DAt=1 λ(1)

+ (cid:80)
M (i,j)
t
φ(1)
j ≥ 0,
λ(1)
j ∈ R,

j ∈ D;

i ∈ Ct,
j ∈ D; φ(2)
j ∈ D; λ(2)

j ≥ 0,
j ∈ R,

j ∈ D;

(cid:16)

(cid:17)

j

i∈Ct

uj
t

+ (cid:80)

j∈DAt=0 λ(2)
uj
t ≥ 0,
j ∈ D; φ(3)
j ∈ D; λ(3)

i ≥ 0,
i ∈ R,

i ∈ Ct;
i ∈ Ct; λ(4)

j ≥ 0,

j ∈ D.

Figure 5: The full relaxation reformulation of the natural formulation (8)

in all implementations. For each trial, a new subset of trip distances is randomly
chosen from the whole dataset.

We re-do the same experiments in Figure 4 for 4 trials. Figure 6 presents
the trade-oﬀ plots of 4 other trials. Each dot represents one experiment of the
implementation of augmented-Lagrangian formulation in Figure 1 in tssos. Red
dots denote the experiment of “Sühr et al. 2019 (L)”. Our method Intra 5 +
Inter 3 (L) is denoted by green dots. The position of each dot represents the
value of Intra-fairness and Inter-fairness from the experiment results. The Pareto
front is shown by a black curve. Note that across Figure 4 and 6, each sub-plot
in the 3 × 3 trade-oﬀ plot (a trial) uses the same x-axis and y-axis limits as the
same sub-plot of other trials. The procedure is in algorithm 1.

Additionally, we implemented the formulation Intra 5 + Inter 3 (L) ( γ(1) =
γ(2) = 0.5) for 100 trials, with one run in each trial. In Figure 3, we give the
distributions of Intra 2 and Inter 2 trade-oﬀ from the 100 trials. Each blue dot
represents the values of Intra 2 and Inter 2 of one trial. The histograms on the
top and on the left side show the distribution of Intra 2 and Inter 2 of 100 trials.
See Algorithm 2.

C.2 Runtime

In Figure 8, we compare the runtime of formulations of [13] and our method
(Intra 5 + Inter 3) in CP Optimizer (CP), CPLEX (MILP), and tssos (SDP)
respectively. The four types of red curves suggest the runtime of formulations
[13] in (8) and the Lagrangian variant of Figure 1 (suggested by “(L)”) as a
function of the number of variables. Then, the four types of green curves denote
the runtime of formulations Intra 5 + Inter 3 in (8) and Figure 1 (“(L)”, again).
Alongside the mean across 10 runs presented by a curve, there is a shaded error
band at mean ± 1 standard deviations. The upper sub-plot in Figure 8 gives
the overview of the runtime of all formulations and all solvers.

24

(a) Trial 1.

(b) Trial 2.

(c) Trial 3.

(d) Trial 4.

Figure 6: Each sub-ﬁgure presents trade-oﬀ between Intra- and Inter-fairness
with Pareto-Front of one trial. Each dot represents one experiment of the
implementation of augmented-Lagrangian formulation in Figure 1 in tssos. Red
dots denote the experiment of “Sühr et al. 2019 (L)”. Our method Intra 5 +
Inter 3 (L) is denoted by green dots. The position of each dot represent the value
of Intra-fairness and Inter-fairness from the experiment results. The Pareto front
is shown by a black curve.

25

Intra 2 [GE1]Inter 1Intra 2 [GE1]Inter 2Intra 2 [GE1]Inter 3Intra 3 [GE0]Inter 1Intra 3 [GE0]Inter 2Intra 3 [GE0]Inter 3Intra 4 [Gini]Inter 1Intra 4 [Gini]Inter 2Intra 4 [Gini]Inter 3Intra 2 [GE1]Inter 1Intra 2 [GE1]Inter 2Intra 2 [GE1]Inter 3Intra 3 [GE0]Inter 1Intra 3 [GE0]Inter 2Intra 3 [GE0]Inter 3Intra 4 [Gini]Inter 1Intra 4 [Gini]Inter 2Intra 4 [Gini]Inter 3Intra 2 [GE1]Inter 1Intra 2 [GE1]Inter 2Intra 2 [GE1]Inter 3Intra 3 [GE0]Inter 1Intra 3 [GE0]Inter 2Intra 3 [GE0]Inter 3Intra 4 [Gini]Inter 1Intra 4 [Gini]Inter 2Intra 4 [Gini]Inter 3Intra 2 [GE1]Inter 1Intra 2 [GE1]Inter 2Intra 2 [GE1]Inter 3Intra 3 [GE0]Inter 1Intra 3 [GE0]Inter 2Intra 3 [GE0]Inter 3Intra 4 [Gini]Inter 1Intra 4 [Gini]Inter 2Intra 4 [Gini]Inter 3(a) Inter-Fair1 vs
Fair2

Intra-

(b) Inter-Fair2 vs
Fair2

Intra-

(c) Inter-Fair3 vs
Fair2

Intra-

(d) Inter-Fair1 vs
Fair3

Intra-

(e) Inter-Fair2 vs
Fair3

Intra-

(f) Inter-Fair3 vs
Fair3

Intra-

(g) Inter-Fair1 vs
Fair4

Intra-

(h) Inter-Fair2 vs
Fair4

Intra-

(i) Inter-Fair3 vs
Fair4

Intra-

Figure 7: The distributions of Intra- and Inter-fairness trade-oﬀ from 100 trials
of formulation Intra 5 + Inter 3 (L) via tssos. In each sub-ﬁgure, each dot
represents the values of corresponding Intra-fairness and Inter-fairness notions
of one trial. The histograms on top and on left side show the distribution of
Intra-fairness and Inter-fairness of the 100 trials.

26

 , Q W U D   , Q W H U   , Q W U D   , Q W H U   , Q W U D   , Q W H U   , Q W U D   , Q W H U   , Q W U D   , Q W H U   , Q W U D   , Q W H U   , Q W U D   , Q W H U   , Q W U D   , Q W H U   , Q W U D   , Q W H U  Algorithm 1 Cross Validation (5 Trials)
Input: N = 5: The number of trials; |C| = 5: The size of a batch; NYT Taxi

Dataset.

Output: Figure 4 display one trial and the rest trials are in Figure 6.
1: Initialise n = 1.
2: for n = 1, . . . , N do
3:

Randomly pick a batch from NYC Taxi Dataset with size of |C| = 5.

Others are in section 5. (for input in steps 4 & 5)

4:

5:

6:

7:

Implement formulation “Intra 5 + Inter 3 (L)” in ﬁgure 1 with parameters
γ(1) = 0.5, 0.6, . . . , 0.9, γ(2) = 1 − γ(1) and γ(3) = 0, for 50 runs. (50 × 5 runs
in total)

Implement formulation “Sühr et al. 2019 (L)” in ﬁgure 1 with parameters

γ(1) = 1, γ(2) = γ(3) = 0, for 250 runs. (250 × 1 runs in total)

Each run matches jobs and drivers from the batch. From each match, we
can calculate measures of inequality, i.e., Intra 2 (GE(1)t), Intra 3 (GE(0)t),
Intra 4 (Ginit), and Inter 1, Inter 2, Inter 3, deﬁned in (4) and (7).

Make a 3 × 3 trade-oﬀ plot (9 sub-plots in total), with ﬁxed x-axis and

y-axis limits for each sub-plot, as in Figure 4 and 6.

8: end for

Algorithm 2 Cross Validation (100 Trials)
Input: N = 100: The number of trials; |C| = 5: The size of a batch; NYT Taxi

Dataset.

Output: The trade-oﬀ plot of all trials in Figure 3 and 7.
1: initialise n = 1.
2: for n = 1, . . . , N do
3:

Randomly pick a batch from NYC Taxi Dataset with size of |C| = 5.

Others are in section 5. (for input in step 4)

Implement formulation “Intra 5 + Inter 3 (L)” in ﬁgure 1 with parameters

γ(1) = γ(2) = 0.5 and γ(3) = 0, for 1 run.

The run matches jobs and workers from the batch. From each match, we

4:

5:

calculate measures of inequality:

• Intra-fairness: Intra 2 (GE(1)t), Intra 3 (GE(0)t), Intra 4 (Ginit),

deﬁned in (4).

• Inter-fairness: Inter 1, Inter 2, Inter 3, deﬁned in (7).

6: end for
7: Make a trade-oﬀ plot of each pair of Intra- and Inter-fairness across the 100

Trials, as in Figure 7 (9 sub-ﬁgures in total).

8: Note: Figure 3 is the sub-ﬁgure (b) Inter 2 vs Intra 2 in Figure 7.

27

Figure 8: The runtime of formulations “Sühr et al. 2019” and our method
Intra 5 + Inter 3 using CP Optimizer (CP), CPLEX (MILP), and an SDP
solver (SDPA), respectively. The four types of red curves denote the runtime of
formulations “Sühr et al. 2019” against the number of variables while the four
types of green curves denote that of formulations Intra 5 + Inter 3. The mean
runtime and mean ± one standard deviations across 10 runs are presented by
curves with shaded error bands. The sub-plot on the right gives a zoom in after
eﬀect of those four curves which overlap with each other in the left sub-plot.

28

255075100125150175200The number of variables010203040runtime [seconds]Sühr et al. 2019 @CPIntra 5 + Inter 3 @CPSühr et al. 2019 (L) @SDPIntra 5 + Inter 3 (L) @SDPSühr et al. 2019 @MILPIntra 5 + Inter 3 @MILPSühr et al. 2019 (L) @MILPIntra 5 + Inter 3 (L) @MILP255075100125150175200The number of variables0.00.51.01.52.0runtime [seconds]Sühr et al. 2019 @MILPIntra 5 + Inter 3 @MILPSühr et al. 2019 (L) @MILPIntra 5 + Inter 3 (L) @MILP