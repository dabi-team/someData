1FastStrainEstimationandFrameSelectioninUltrasoundElastographyusingMachineLearningAbdelrahmanZayed,StudentMember,IEEEandHassanRivaz,SeniorMember,IEEEAbstract—UltrasoundElastographyaimstodeterminetheme-chanicalpropertiesofthetissuebymonitoringtissuedeformationduetointernalorexternalforces.Tissuedeformationsareestimatedfromultrasoundradiofrequency(RF)signalsandareoftenreferredtoastimedelayestimation(TDE).GiventwoRFframesI1andI2,wecancomputeadisplacementimagewhichshowsthechangeinthepositionofeachsampleinI1toanewpositioninI2.TwoimportantchallengesinTDEincludehighcomputationalcomplexityandthedifﬁcultyinchoosingsuitableRFframes.SelectingsuitableframesisofhighimportancebecausemanypairsofRFframeseitherdonothaveacceptabledeformationforextractinginformativestrainimagesoraredecorrelatedanddeformationcannotbereliablyestimated.Herein,weintroduceamethodthatlearns12displacementmodesinquasi-staticelastographybyperformingPrincipalComponentAnalysis(PCA)ondisplacementﬁeldsofalargetrainingdatabase.Intheinferencestage,weusedynamicprogramming(DP)tocomputeaninitialdisplacementestimateofaround1%ofthesamples,andthendecomposethissparsedisplacementintoalinearcombinationofthe12displacementmodes.Ourmethodassumesthatthedisplacementofthewholeimagecouldalsobedescribedbythislinearcombinationofprincipalcomponents.WethenusetheGLobalUltrasoundElastography(GLUE)methodtoﬁne-tunetheresultyieldingtheexactdisplacementimage.Ourmethod,whichwecallPCA-GLUE,ismorethan10timesfasterthanDPincalculatingtheinitialdisplacementmapwhilegivingthesameresult.ThisisduetoconvertingtheproblemofestimatingmillionsofvariablesinDPintoamuchsimplerproblemofonly12unknownweightsoftheprincipalcomponents.OursecondcontributioninthispaperisdeterminingthesuitabilityoftheframepairI1andI2forstrainestimation,whichweachievebyusingtheweightvectorthatwecalculatedforPCA-GLUEasaninputtoamulti-layerperceptron(MLP)classiﬁer.WevalidatePCA-GLUEusingsimulation,phantom,andinvivodata.Ourclassiﬁertakesonly1.5msduringthetestingphaseandhasanF1-measureofmorethan92%whentestedon1,430instancescollectedfrombothphantomandinvivodatasets.IndexTerms—Ultrasoundelastography,Principalcomponentanalysis(PCA),Timedelayestimation(TDE),Multi-Layerper-ceptron(MLP)classiﬁer.I.INTRODUCTIONULTRASOUNDelastographyhasnumerousapplicationsinmedicaldiagnosisofdiseasesandinimage-guidedinterventions[1]–[8].Forexample,itcouldbeusedinimagingcancertumorsbyestimatingthestrainimagesincetumorsarenormallymorerigidthanthesurroundingtissue.UltrasoundAbdelrahmanZayedandHassanRivazarewiththeDepartmentofElectricalandComputerEngineeringandPERFORMCentre,ConcordiaUniversity,Montreal,QC,H3G1M8,Canada.Email:azayed@encs.concordia.caandhrivaz@ece.concordia.ca.elastographyhastwomainbrancheswhicharedynamicandquasi-staticelastography[9].Dynamicelastographyreferstothequantitativeestimationofthemechanicalpropertiesofthetissue.Quasi-staticelastography,whichisourfocusinthispaper,ismorerelatedtoestimatingthedeformationofthetissuewhenanexternalforceisapplied[10],[11].Recentworkhasshownsuccessinperformingultrasoundelastographyusingdifferentmethodssuchasspatialangularcompounding[12],multi-compressionstrategy[13],Lagrangiantracking[14]andguidedcircumferentialwaves[15].Inaddition,otherworkhasexploitedthepowerofdeeplearningtoachievethesamegoal[16]–[23].Inspiteofthevariousapplicationsthatultrasoundelas-tographyhas,italsohassomechallenges.Oneofthesechallengesisthattimedelayestimation(TDE)betweenframesofradiofrequency(RF)dataiscomputationallyexpensive.ThemethodsusedforcalculatingtheTDEareeitheroptimization-based[24]–[26]orwindow-based[27]–[29].Inoptimization-basedtechniques,thedisplacementimageisestimatedbyminimizingacostfunction.Inwindow-basedtechniques,theobjectiveistoﬁndthedisplacementthatmaximizesasimilaritymetricsuchasnormalizedcrosscorrelation(NCC)betweentwowindowsinthetwoframesbeforeandafterdeformation.Herein,weproposeacomputationallyefﬁcienttechniqueforestimatinganapproximateTDEbetweentwoRFframes.Tothatend,weﬁrstlearnthemodesofTDEbyacquiringalargetrainingdatabaseoffree-handpalpationelastographybyintentionallycompressingthetissueindifferentmanners.Wethenperformprincipalcomponentanalysis(PCA)toextractthemodesofTDE.Attheteststage,weﬁrstrundynamicpro-gramming(DP)ononly1%ofRFdatatoextractasparseTDEbetweentwoframesI1andI2.WethenestimatetheweightsofprincipalcomponentsthatbestapproximatethissparseTDE,andsubsequentlyusetheweightedprincipalcomponentsasaninitialTDEforGLobalUltrasoundElastography(GLUE)[24].WethereforecallourmethodPCA-GLUE.PCA-GLUEwasinspiredbythesuccessof[30]innaturalimages.SimilarworkbyPohlmanandVarghese[31]hasshownpromisingresultsondisplacementestimationusingdictionaryrepresentations.AnotherchallengethatultrasoundelastographyfacesisthesuitabilityoftheRFframestobeusedforstrainestimation.ThetwoRFframesusedarecollectedbeforeandafterapplyinganexternalforce.Dependingonthedirectionoftheappliedforce,differentqualitiesofstrainimageswouldbeobtained.Tobemoreprecise,in-planedisplacementresultsinhigh-qualitystrainimages,whereasout-of-planedisplacementresultsinlow-qualitystrainimages[32],[33].ThismeansthatarXiv:2110.08668v1  [eess.IV]  16 Oct 20212collectingultrasounddataneedsthepersontobeexperiencedinapplyingpurelyaxialforce.Forimagingsomeorgans,itishardtoholdtheprobeandapplyapurelyaxialforceevenforexperts.Furthermore,evenforpureaxialcompression,twoRFframescanbedecorrelatedduetointernalphysiologicalmotions,renderingaccurateTDEchallenging.Manysolutionshavebeenintroducedforsolvingthisproblem.Lubinskietal.[34]suggestedaveragingseveraldisplacementimagestoimprovethequality.Theweightsusedarenotequal,theyratherdependonthestepsize(i.e.certainimageswouldhavehigherweightsthanothers).Hiltawskyetal.[35]triedtotackletheout-of-planedisplacementbydevelopingamechanicalcompressionapplicatortoforcethemotiontobein-plane.Jiangetal.[36]deﬁnedametricthatinformstheuserwhetherornottotrustthepairofRFframesforstrainestimation.ThismetricisthemultiplicationoftheNCCofthemotioncompensatedRFﬁeldandtheNCCofthemotioncompensatedstrainﬁeld.Otherapproaches[37],[38]usedanexternaltrackersoastopickuptheRFframesthatarecollectedroughlyfromthesameplane.Theyusedthetrackingdatatoﬁndpairsthathavethelowestcostaccordingtoapredeﬁnedcostfunction.Althoughallofthepreviouslymentionedapproachesshowedanimprovementinthequalityofthestrainimage,theyalsohavesomedrawbacks.Theapproachesintroducedin[35],[37],[38]needanexternaldevicesuchasthemechanicalapplicatorortheexternaltracker.Thisnotonlycomplicatestheprocessofstrainestimation,butalsomakesitmoreexpensive.Theapproachintroducedin[36]givesafeedbackonthequalityofthestrainimageonlyafterestimatingTDE,whichmeansthatitisnotacomputationallyefﬁcientmethodforframeselection.ThemethodweproposeinthispaperselectssuitableframesbeforeestimatingTDEandisalsocomputationallyefﬁcient.Herein,weintroduceanewmethodwiththreemaincontri-butions,whichcanbesummarizedasfollows:1)WedevelopafasttechniquetocomputetheinitialdisplacementimagebetweentwoRFframes,whichisthesteppriortotheestimationoftheexactdisplacementimage.Ourmethodcouldalsobeusedtospeedupdifferentdisplacementestimationmethodsbyprovidinginitialestimates.2)WeintroduceaclassiﬁerthatgivesabinarydecisionforwhetherthepairofRFframesissuitableforstrainestimationinonly1.5msonadesktopCPU.3)PCA-GLUE,whichreliesonDPtocomputetheinitialdisplacementmap,isrobusttopotentialDPfailures.Thisworkisanextensionofourrecentwork[39],[40],withthefollowingmajorchanges.First,wereplacethemulti-layerperceptron(MLP)classiﬁerwithamorerobustonethatcangeneralizebettertounseendata.Second,weusedautomaticallyannotatedimagesfortrainingtheclassi-ﬁer,comparedtomanualannotationthatwepreviouslyusedin[40].Third,testingisnowsubstantiallymorerigorousandisperformedon5differentdatasetsfromsimulation,phantomandinvivodata.Andlast,thecriteriaformeasuringtheperformanceoftheclassiﬁerusedinthispaperaretheaccuracyandF1-measureinsteadofusingthesignaltoNoiseRatio(SNR)andContrasttoNoiseRatio(CNR)in[40].Ourcodeisavailableathttps://code.sonography.aiandathttps://github.com/AbdelrahmanZayedII.METHODSInthiswork,wehavetwomainobjectiveswhicharefastTDEandautomaticframeselection.WeﬁrstproposeamethodthatcomputesasuperiorapproximateTDEcomparedtoDP[41],whilebeingmorethan10timesfaster.Theideaissimpleandlogical:wecomputeNprincipalcomponentsdenotedbyb1tobNfromrealexperimentsthatdescribeTDEundertheeffectofanexternalforce.Inotherwords,theapproximatedisplacementimageisalinearcombi-nationoftheseprincipalcomponents.Duringdatacollection,weappliedtheforceinthe6degreesoffreedom(DOF)toensuregeneralityandadatasetofdisplacementimageswasobtainedusingGLUE.UsingPCA,wewereabletocomputeourprincipalcomponents.Fig.1showsthedirectionsoftheappliedforceaswellassomeoftheprincipalcomponentslearned.Forframeselection,ourgoalwassimplytohaveaclassiﬁerthatcanclassifywhetherthetwoRFframesaresuitableforstrainestimation.OnecanconsideranapproachofhavingaclassiﬁerthattakesthetwoRFframes,wherethesamplesaretheinputfeatures(suchas[18]and[20]),andoutputsabinarydecisionof1forsuitableframesand0otherwise.ThisapproachwouldneedapowerfulGPUasthenumberofsamplesineachRFframeisapproximately1million.Tosimplifytheproblem,wemakeuseofourrepresentationforthedisplacementimagebytheprincipalcomponents.Wecanthinkofthisasadimensionalityreductionmethodforthehugenumberoffeaturesthatwehad,wheretheinputfeaturevectorcanbesimplytheN-dimensionalweightvectorw,whichrepresentstheweightofeachprincipalcomponentintheinitialdisplacementimage.Ourlow-dimensionalweightvectorwistheinputtoamulti-layerperceptron(MLP)classiﬁerthatwouldoutputabinarynumber1or0dependingonwhetherthetwoRFframesaresuitableornotforstrainestimation.A.FeatureextractionConsiderhavingtwoRFframesI1andI2collectedbeforeandaftersomedeformation,eachofsizem×l,wheremisthenumberofsamplesinanRF-lineandlisthenumberaRFlines.Ourgoalistoestimateacoarsedisplacementimagethatdescribestheaxialmotionthateachsamplehashad[42].WestartbyrunningtheDPalgorithmononlypRFlinesoutofthetotallRFlines(wherep<<l)togettheintegerdisplacementofk=m×ppixels.Wethenformak-dimensionalvectornamedcafterapplyingasimplelinearinterpolationtothekestimatestomakethemsmoother,sothattheintegerestimatesbecomelinearlyincreasingwithdepthinsteadofthestaircaseapproximation,asshowninFig.2.Next,weconstructthematrixAsuchthatA=b1(q1)b2(q1)b3(q1)...bN(q1)b1(q2)b2(q2)b3(q2)...bN(q2).........................................b1(qK)b2(qK)b3(qK)...bN(qK)(1)3Ultrasound ProbePhantomθz(a)Directionsofap-pliedforce(b)Axialdeformation(z)(c)In-planerotation(θ)Fig.1:Principalcomponentsofin-planeaxialdisplacement(inmm)learnedfrombothinvivoandphantomexperiments.In(a),translationoftheprobealongzanditsrotationbyθgeneratesaxialdeformationinthephantom.In(b),extensionandcompressionprincipalcomponentsalongzareshown.In(c),displacementarisingfromrotationbyθisshown.(a)Beforeinterpolation(b)AfterinterpolationFig.2:ThedisplacementofacertainRFlinebeforeandafterinterpolation.wheretheNvectorsfromb1tobNrepresentourNprincipalcomponents,q1toqKcorrespondtoour2DcoordinatesofthesparsefeatureschosenalongthepRFlinesbeforedeformation.Forexample,foranRFframeofsize2304×384,ifwesetpto1andchoosethesparsefeaturestobealongtheRFlinenumber200.Thenk=2304andq1toqKwouldbe{(1,200),(2,200),.....,(2304,200)}.Next,wecomputetheweightvectorw=(w1,...,wN)Taccordingtothefollowingequationˆw=argminw||Aw–c||(2)Thisimpliesthatwechoosetheweightvectorwthatdecom-posestheactualdisplacementimageintoalinearcombinationoftheprincipalcomponentsweightedbysomecoefﬁcientssoastohavetheminimumsum-of-squarederror.B.Implementation1)ImplementingPCA-GLUEforstrainestimation:Strainestimationreliesontheextractedfeaturestocalculatetheintegerdisplacementimageˆd.ˆd=N∑n=1ˆwnbn(3)Eq.3showshowtocalculatetheintegerdisplacementimageˆdfromtheweightvectorw,whichisthenpassedtoGLUEtoobtaintheexactdisplacementimaged.Finally,theresultingimageisspatiallydifferentiatedtoobtainthestrainimage.Algorithm1summarizestheprocedurefollowedbyPCA-GLUE.Algorithm1PCA-GLUE1:procedurePCA-GLUE2:ChoosepequidistantRFlines.3:RunDPtogettheintegeraxialdisplacementofthepRFlines.4:SolveEq.2togetthevectorw.5:ComputetheinitialaxialdisplacementˆdofallRFlinesbyEq.3.6:UseGLUEtocalculatetheexactaxialdisplacement.7:Strainisobtainedbyspatialdifferentiationofthedisplacement.8:endprocedure2)ImplementingtheMLPclassiﬁerforframeselection:TheMLPclassiﬁertakestheweightvectorw(seeAlgorithm1steps2to4)astheinputfeaturevector.Thegroundtruth(i.e.whetherI1andI2aresuitableforstrainestimationornot)isobtainedaccordingtotheproceduredescribedinAlgorithm2.Theissuewiththisalgorithmisthatitisslowbecauseofthreecomputationallyexpensivestepsof2,3and4.Assuch,itcannotbeperformedonmanypairsofRFframesinreal-time.Ourgoalistotrainaclassiﬁerthatpredictstheoutputofstep5bybypassingsteps2to4.Thearchitectureofourclassiﬁerisrelativelysimple,withaninputlayer,3hiddenlayers,andanoutputlayer.TheinputlayertakestheN-dimensionalvectorw.The3hiddenlayerscontain256,128and64hiddenunitswithaRectiﬁedLinearUnit(ReLU)astheactivationfunction.Theoutputlayercontainsoneunit,wherethepredictedvaluecorrespondstotheNormalizedcrosscorrelation(NCC)betweenI1andI20suchthat4Algorithm2LabellingthedatasetfortheMLPclassiﬁer1:procedure2:RFframesI1andI2arepassedtoGLUEtoobtainthedisplacementimage.3:I2isdeformedandinterpolatedaccordingtothecomputeddisplacementimageyieldingI20.4:WecalculatetheNormalizedcrosscorrelation(NCC)betweenI1andI20.5:Theﬁnaldecisionis1iftheNCCishigherthan0.9and0otherwise.6:endprocedure≅w1+ w2                  +w3+w12…..w1w2w3…….w12ClassifierAlgorithm1 (steps2-5)BeforeCompressionAfterCompressionFig.3:Theoverallprocedureusedforframeselection.GiventwoRFframes(weareshowingheretheB-modeimagesforillustration)collectedbeforeandafterdeformation,weﬁrstestimatetheintegerdisplacementimageˆd(inmm)usingPCA-GLUE,byapplyingAlgorithm1(steps2-5).WethenusetheweightvectorwastheinputfeaturevectortotheMLPclassiﬁer.NCC=∑i(I1(i)−¯I1)(I2(i)0−¯I20)q∑i(I1(i)−¯I1)2∑i(I2(i)0−¯I20)2∀i∈I1∩I20(4)where¯I1and¯I20arethemeanvaluesoftheRFframesI1andI20respectively.NCChasbeenwidelyusedasasimilaritymetricbyseveralimageregistrationmethods[43]–[46].Inthiswork,weclaimthattheNCCbetweenI1andI20isanindicatorforthesuitabilityofI1andI2forelastography.Therefore,weapplyathresholdonthevalueofboththepredictedNCCandthegroundtruthNCCtocomputethebinaryequivalent,whichis1whentheNCCishigherthan0.9and0otherwise.Onepossiblecriticismtoourworkmightbethatwedonotdirectlyestimatethebinaryoutput.ThisisbecausebetterresultswereobtainedwhentrainingisdonetoestimatetheNCC,asopposedtotrainingtoobtainabinarydecision.ThereasonisthattheNCCvalueprovidesmoreinformationtothenetworkforbetterDoesthe classifier givea binary1?Given2 RF frames beforeand afterdeformation.The pair of RF frames isnot suitablefor elastography.YesNoUse GLUE to calculate the exact axial displacement.Compute the initial axial displacement of all RF lines by Eq. 3.Solve Eq. 2 to get the vector wand give it to the MLP classifier.Run DP to get the integer axial displacement of the p RF lines.Choose p equidistant RF lines.Strain is obtained by spatial differentiation of the displacement.Fig.4:FlowchartofRFframeselectionandstrainestimation.trainingcomparedtoitsthresholdedbinarynumber.Italsomakesthederivativeofthelossfunctionsmoother,resultinginimprovedbackpropagation.Anotherbeneﬁtistobeabletopickupthebestpossibleframetobepairedwithacertainframe,wherewepairitwiththeframewiththehighestNCCinaspeciﬁedwindowofthe16nearestframes,whichhasonlyonesolution(assumingthatthereexistgoodframesinthewindow),comparedtomultiplesolutionsiftheresultisjustabinarynumber.Ourlossfunctionisthemeansquareerror(MSE)betweentheestimatedNCCandtheactualNCCbeforethresholding.WeuseAdamoptimizer[47]withalearningrateof1e−3.ThecodeiswritteninPythonusingKeras[48].Fig.3showstheoverallprocedurefollowedbyouralgorithmforframeselection.Fig.4containsaﬂowchartthatshowshowstrainestimationandframeselectionareaugmentedtogether.C.DataCollection1)PCA-GLUE:Wecollected4,055RFframesfrom3differentCIRSphantoms(Norfolk,VA),namelyModels040GSE,039and059atdifferentlocationsatConcordiaUni-versity’sPERFORMCentre.Model040GSEhas3differentcylindricalregionswithelasticitymoduliof10,40and60kPa.The039and059modelshavesphericalinclusionsthataredistributedthroughoutthephantoms.Theelasticitymodulioftheinclusionsare27kPaforModel039andintherangeof10-15kPaformodel059.Thecompressionwasappliedin3differentdirections:in-planeaxialmotion,in-planerotationandout-of-planelateralmotion.Theultrasounddeviceusedisthe12RAlpinionUltrasoundmachine(Bothell,WA)withanL3-12Hhighdensitylineararrayprobeatacenterfrequencyof8.5MHzandsamplingfrequencyof40MHz.Wealsohaveaccessto298RFframescollectedatJohnsHopkinsHospitalfrom3differentpatientswhowereundergo-ingliverablationforprimaryorsecondarylivercancersusingAntaresSiemenssystem(Issaquah,WA)atacenterfrequencyof6.67MHzwithaVF10-5lineararrayatasamplingrateof40MHz.Thestudyhastheapprovaloftheinstitutional5reviewboardandaninformedconsentwasobtainedfromthepatients.3,635RFframesoutofthetotal4,055phantomRFframes,alongwith137invivoRFframesoutofthetotal298invivoRFframeswereusedforobtainingtheprincipalcomponentsb1tobNbyfollowingtheprocedureinAlgorithm3,leaving420phantomRFframesand161invivoRFframesforvalidatingourmethod.Itisimportanttonotethatthetrainingdatawasexcludedfromfurtherevaluation.ThesimulationdatawasgeneratedusingFieldIIsoftware[49].ABAQUS(Providence,RI)softwarewasusedtoapplysomecompression,andthegroundtruthdisplacementwasgeneratedusingﬁniteelementmethod(FEM).2)MLPclassiﬁer:WeusedthedatathatwecollectedforPCA-GLUEfortrainingourMLPclassiﬁer.Itwastrainedon4,662instancesfrombothphantomandinvivodata,whichwerepartitionedbetweentrainingandvalidationwitharatio80:20.Testingwasdoneonadifferentdatasetcomposedof1,430frames.ThegroundtruthwasobtainedbyfollowingtheprocedureinAlgorithm2.D.MetricsusedforperformanceassessmentInordertobeabletoquantitativelymeasuretheperfor-manceofthestrainestimationalgorithmPCA-GLUE,weusetwoqualitymetricswhicharetheSNRandCNR[50],suchthat:CNR=CN=s2(¯sb−¯st)2σ2b+σ2t,SNR=¯sσ(5)where¯standσ2tarethestrainaverageandvarianceofthetargetwindow,¯sbandσ2barethestrainaverageandvarianceofthebackgroundwindowrespectively.WeusethebackgroundwindowforSNRcalculation(i.e.¯s=¯sbandσ=σb).Theback-groundwindowischoseninauniformregionwherethestrainvaluesdonotvaryconsiderably.ItisworthmentioningthattheSNRandCNRvaluesareobtainedastheaverageover10differentexperiments.Precisionandrecallaretwoimportantmetricsforassessingtheperformanceofaclassiﬁer.TheF1-measureincorporatesbothmetricsasfollows:F1−measure=2(Precision×Recall)(Precision+Recall(6)III.RESULTSForourresults,wesetN=12.Thismeansthateverydisplacementimageisrepresentedby12axialprincipalcom-ponentsintheformofa12-dimentionalvectorw.Forresultswithdifferentnumberofprincipalcomponents,pleaserefertotheSupplementaryMaterialofthispaper.Wefoundthatthisrepresentationcaptures95%ofthevarianceintheoriginaldata.FortheNCCmethod,weusedwindowsofsize(5.42×12.49)λ.ForDPestimation,thetunableparameterαDPissetto0.2.ForGLUE,theparametersusedduringphantomexperimentsareα1=5,α2=1,β1=5andβ2=1.Duringinvivoexperiments,wechangeGLUE’sparameterstoα1=20,α2=1,β1=20andβ2=1,toaccountfortheincreasednoise.ForNCC,GLUEandPCA-GLUE,thestrainimageAlgorithm3Obtainingtheprincipalcomponents1:procedure2:RunGLUEonthe3,772RFframepairscollected(3,635fromthephantomdatasetand137fromtheinvivodataset),yielding3,772displacementimages.3:Reshapeeverydisplacementimagefroma2304×384matrixintoan884,736×1vector.4:FormthedatamatrixXofsize884,736×3,772byconcatenatingthe3,772vectors.5:Computethecovariancematrixasfollows:S=1n×X0×X0T,whereX0isthematrixXaftersubt-ractingthemeanvalueoftheelementsineachrow(wesetnto3,772).6:ObtaintheeigenvaluesofthematrixSandsortthemdescendingly.7:Computetheeigenvectorscorrespondingtothelargest12eigenvalues.8:Obtainthe12principalcomponentsfortheaxialdispl-acementimages(Fig.1(b)and(c))byreshapingeachofthe12eigenvectorsfroman884,736×1vectorintoa2,304×384matrix.9:endprocedureisobtainedfromthedisplacementimageusingleastsquarestrainestimation[51].Fortherunningtime,wetrainedPCA-GLUEin5hours,buttrainingisdoneonlyonce.Fortesting,weestimatetheinitialdisplacementinjust258msfortwoverylargeRFframesofsizes2304×384usingan8thgeneration3.2GHzIntelcorei7comparedto2.6secondsifweuseDP.Fortheframeselection,featureextractionandlabelingthedatatook30hours,whichincludedtheprocedureinAlgorithm2.TheactualtrainingoftheMLPclassiﬁertook29.16seconds,whiletestingtakesonly1.5ms.TABLEI:TheSNRandCNRvaluesoftheaxialstrainimagesforthephantomexperiment.Targetwindowsandbackgroundwindowsareofsize3mm×3mmand5mm×5mmrespectivelyasshowninFig.5.SNRiscalculatedforthebackgroundwindow.MethodusedSNRCNRNCC18.1816.86GLUE22.3120.65PCA-GLUE23.5221.46A.PhantomResults1)StrainEstimation:Fig.5showsacomparisonbetweenthestrainestimatedusingNCC,GLUEandPCA-GLUEforthephantomexperiment,wherethedashedcirclespointtotheinclusion.TheresultsofGLUEandPCA-GLUElookalmostthesame,buttheadvantageofusingPCA-GLUEisthatitestimatestheinitialestimatesmorethan10timesfaster.TableIshowstheSNRandCNRvaluesobtainedusingdifferentmethods.6(a)B-mode(b)NCC(c)GLUE(d)PCA-GLUEStraincolorbarFig.5:TheB-modeultrasoundandaxialstrainimageusingNCC,GLUEandPCA-GLUEfortherealphantomexperiment.ThetargetandbackgroundwindowsareusedforcalculatingSNRandCNR.Dashedcontouroutlinestheinclusion.(a)B-mode(b)StrainfromSkip1method(c)StrainfromSkip2method(d)StrainfromourmethodStraincolorbarFig.6:TheB-modeultrasoundandPCA-GLUEaxialstrainimageforthephantomexperimentusingdifferentframeselectionmethods.NotethatthepairofRFdatausedforestimatingstrainisdifferentfromthatofFig.5.(a)B-modepatient1(b)NCC(c)GLUE(d)PCA-GLUEStraincolorbarFig.7:TheB-modeultrasoundandaxialstrainimageusingNCC,GLUEandPCA-GLUEfortheinvivoliverdatabeforeablation.Dashedcontouroutlinesthetumor.TABLEII:TheaccuracyandF1-measureofourclassiﬁeronthephantomandinvivotestdata.DatasetSizeAccuracyF1-measurePhantom353instances85.11%93.20%Patient1147instances89.74%96.86%Patient2707instances70.43%93.2%Patient3223instances91.58%92.52%2)FrameSelection:Ourframeselectionalgorithmiscom-paredtothesimplemethodthatchoosesthepairofRFframessuchthattheyareoneortwoframesapart.Fig.6showsthedifferencebetweenapplyingourmethodandtheﬁxedskipframepairingwhileusingPCA-GLUEforstrainestimation.Ourmethodconsidersawindowof16frames,8ofthemarebeforethedesiredframeand8areafterit.Tochooseagoodframetobepairedwiththedesiredframe,weruntheMLP7(a)B-modepatient2afterablation(b)NCC(c)GLUE(d)PCA-GLUEStraincolorbarFig.8:TheB-modeultrasoundandaxialstrainimageusingNCC,GLUEandPCA-GLUEfortheinvivoliverdataafterablation.Dashedcontouroutlinesthetumor.(a)B-mode(b)StrainfromSkip1method(c)StrainfromSkip2method(d)StrainfromourmethodStraincolorbarFig.9:TheB-modeultrasoundandPCA-GLUEaxialstrainimagefortheinvivoliverdatausingdifferentframeselectionmethods.NotethatthepairofRFdatausedforestimatingstrainisdifferentfromthatofFig.7.(a)Thecorrectdisplacementforacer-tainRFline(b)Theincorrectdisplacementforacer-tainRFline(c)StrainestimatedbyGLUE(d)StrainestimatedbyPCA-GLUEFig.10:StrainestimatedbybothGLUEandPCA-GLUEgiventhatDPfailedincomputingcorrectinitialestimates.ThefailureoccuredintheRFlineshowninred.TABLEIII:TheSNRvaluesoftheaxialstrainimagesfortheinvivodata.DatasetNCCGLUEPCA-GLUEPatient113.2321.1121.19Patient22.0921.3321.20Patient313.2125.6623.94modelonthe16pairsandchoosethepairthathasthehighestNCC(wedon’tapplythethresholdinghere).WecanobservethatourmethodselectsRFframesthataresuitableforstrainTABLEIV:TheCNRvaluesoftheaxialstrainimagesfortheinvivoliverdata.DatasetNCCGLUEPCA-GLUEPatient111.0120.3420.66Patient2-0.4613.5217.05Patient39.8716.6615.95estimationanditsubstantiallyoutperformstheﬁxedskipframepairingmethodssuchasSkip1andSkip2.Tomakethevalidationmoreconcrete,wetestourclassiﬁer8on353instancestoclassifythemassuitableornotsuitableforstrainestimation.ThegroundtruthisobtainedaspreviouslydiscussedinAlgorithm2.TableIIshowstheaccuracyandF1-measureforourclassiﬁeronnewdatathatthemodelhasnotseenbefore.Theresultsshowthatourclassiﬁerisabletogeneralizewelltounseendata,andthatitcouldbeusedinpractice.B.InvivoResults1)StrainEstimation:Fig.7and8showtheresultsobtainedwhenrunningNCC,GLUEandPCA-GLUEontheliverdataset,wherebothGLUEandPCA-GLUEyieldverysimilarresults.Thedashedellipsespointtothetumors.TablesIIIandIVshowtheSNRandCNRcalculated.2)FrameSelection:Fig.9showsacomparisonbetweenthestrainestimatedusingbothourframeselectionmethodandtheﬁxedskipframepairingontwoRFframescollectedfromtheinvivoliverdata.TableIIshowstheaccuracyandF1-measureobtainedfortheliverdataset.C.PCA-GLUErobustnessOurmethodisnotonlycapableofestimatingstrainorselectingsuitableRFframes,itisalsorobusttoincorrectinitialdisplacementestimateswhenDPfails.ThemaindifferencebetweenPCA-GLUEandGLUEisinestimatingtheinitialdisplacementimage,whereGLUEusesDPtoestimatethedisplacementofeverysingleRFline,whereasPCA-GLUEappliesDPforonly5RFlines,thenusesalinearcombinationofpreviouslycomputedprincipalcomponentsasaninitialdisplacementimage.Therefore,ifDPfailsinestimatingthecorrectdisplacementforacertainRFline,thatmeansthatGLUEwouldhaveanincorrectinitialdisplacementimage,whichaffectstheﬁne-tuneddisplacementimage.ThereasonbehindthisrobustnessisthatPCA-GLUEreliesontheprincipalcomponentspreviouslycomputedofﬂine,suchthattheresultinginitialdisplacementimageisrepresentedasalinearcombinationofthem.Therefore,ifincorrectresultswereamongthe5RFlineschosenbyPCA-GLUE,itwouldstillbeabletoestimatethestraincorrectlyduetotheadditionalstepofestimatingTDEasasumofprincipalcomponents.Fig.10showshowbothGLUEandPCA-GLUEperformwhentheygetincorrectinitialestimatesfromDP.Fig.11showsacomparisonbetweenthestrainestimatedbybothGLUEandPCA-GLUEontheﬁniteelementmethod(FEM)simulationdatabeforeandafteraddingagaussiannoisewithµ=0andσ2=0.1225to10%oftheRFlines.ThelargeerrorontheseRFlinescouldbecausedinreallifeduetoairbubblesbetweentheprobeandtissue,orlargeout-of-planemotioninsomeregions.D.VaryingthenumberofsparsefeaturesFig.12showstheeffectofrunningDPonmorethan5RFlines.Wecanconcludethattheaccuracyofthestrainestimationdoesnotimproveanyfurtherwhensettingptoavaluemorethan5.AsmoreRFlinescorrespondtomorefeaturesandconsequentlymorecomputations,wechoosethesmallestvaluep=5withoutsacriﬁcingtheaccuracy.Formoreanalysisandresultsatdifferentvaluesofp,pleaserefertotheSupplementaryMaterialofthepaper.IV.DISCUSSIONWepresentedanovelmethodthatcanestimateacoarsedisplacementmapfromasparsesetofdisplacementdataprovidedbyDP.Foranimageofsize2304×384,DPtakes163msandestimationofcoarsedisplacementﬁeldtakes95ms,foratotalof258ms.WealsopresentedanovelmethodforframeselectionthatclassiﬁesapairofRFDataassuitableorunsuitableforelastographyinonly1.5ms.TheinputtoourclassiﬁeristhewvectorandnottheRFdataorthedisplacementimage.Thereasonisthatinferencewithsuchlow-dimensionalinputisverycomputationallyefﬁcient.Duringtraining,wetriedusingdatasetswithandwithoutinclusionstoobtaintheprincipalcomponents.Ourconclusionisthatthepresenceorabsenceofinclusionsinthetrainingdatadoesnotaltertheprincipalcomponentsandconsequentlythestrainestimated.Whatiscriticalforlearningtheprincipalcomponentsisthepresenceofdifferenttypesofdeformation,suchasaxial,lateralandrotationaldeformation.Itisworthmentioningthatwewereonlyconcernedwiththeaxialdisplacement,aswecouldn’tcomputeanyprincipalcomponentsthatdescribethelateraldisplacement.ThereasonisthatbyfollowingAlgorithm3forthelateraldisplacement,wefoundthatthevarianceisnotconcentratedintheﬁrstfeweigenvectors,unliketheaxialdisplacement.Itisratheralmostequallydistributedoverhundredsofeigenvectors(resemblingwhitenoise).Weconcludethatcapturing95%ofthevariancewouldrequireustosavehundredsofprincipalcomponents,whichisnotpractical.Therefore,weonlyusetheintegerestimatesforthek=m×ppixelscomputedbyDP,followedbybi-linearinterpolationwhichprovidesanacceptableinitiallateraldisplacement,comparedtothealternativeapproachwherewerunDPonallRFlines.AcomparisonbetweenthelateraldisplacementestimatedbythetwoapproachesisshownintheSupplementaryMaterial.ThecombinationofN=12andp=5isnotaﬁxedchoiceofthehyperparameters,asdifferentdatasetswouldrequiredifferenttuning.Inourcase,thischoiceisadequateforallthedatasetsused.V.CONCLUSIONInthispaper,weintroducedanewmethodwithtwomaincontributionswhicharefaststrainestimationandRFframeselection.Inaddition,ourmethodisrobusttoincorrectinitialestimatesbyDP.Ourmethodismorethan10timesfasterthanGLUEinestimatingtheinitialdisplacementimage,whichisthesteppriortotheexactdisplacementestimation,whilegivingthesameorbetterresults.OurMLPclassiﬁerusedforframeselectionhasbeentestedon1,430unseenpairsofRFframesfrombothphantomandinvivodatasets,andtheF1-measureobtainedwasalwayshigherthan92%.Thisprovesthatourmethodisefﬁcientandthatitcouldbeusedcommercially.9(a)B-modebeforenoiseaddition(b)groundtruth(c)GLUE(d)PCA-GLUEStraincolorbar(e)B-modeafternoiseaddition(f)groundtruth(g)GLUE(h)PCA-GLUEStraincolorbarFig.11:TheB-modeultrasoundandgroundtruthaxialstrainaswellastheresultofbothGLUEandPCA-GLUEforthesimulationdatabeforeandafteraddinggaussiannoisewithµ=0andσ2=0.1225to10%oftheRFlines.(a)B-mode(b)Strainusing5RFlines(c)Strainusing15RFlines(d)Strainusing30RFlinesStraincolorbarFig.12:TheB-modeultrasoundandaxialstrainimageusingPCA-GLUEfortherealphantomexperimentasweincreasethenumberofRFlinespfrom5to30.VI.ACKNOWLEDGMENTThisworkwasbyfundedRichardandEdithStraussFoun-dation.TheauthorswouldliketothankDrs.E.Boctor,M.ChotiandG.HagerforprovidinguswiththeinvivopatientsdatafromJohnsHopkinsHospital.WealsothankMortezaMirzaeiforhishelpincollectingthephantomdataandforprovidinguswithanoptimizedversionoftheNCCcode,aswellastheveryfruitfuldiscussions.WewouldlikealsotothankMdAshikuzzamanforforhishelpfulcommentsandforprovidinguswiththesimulationdata.REFERENCES[1]J.-L.Gennisson,T.Defﬁeux,M.Fink,andM.Tanter,“Ultrasoundelastography:principlesandtechniques,”Diagnosticandinterventionalimaging,vol.94,no.5,pp.487–495,2013.[2]R.M.Sigrist,J.Liau,A.ElKaffas,M.C.Chammas,andJ.K.Willmann,“Ultrasoundelastography:reviewoftechniquesandclinicalapplications,”Theranostics,vol.7,no.5,p.1303,2017.[3]K.Fujimoto,M.Kato,M.Kudo,N.Yada,T.Shiina,K.Ueshima,Y.Yamada,T.Ishida,M.Azuma,M.Yamasaki,etal.,“Novelimageanalysismethodusingultrasoundelastographyfornoninvasiveevalua-tionofhepaticﬁbrosisinpatientswithchronichepatitisc,”Oncology,vol.84,no.Suppl.1,pp.3–12,2013.[4]M.Menzilcioglu,M.Duymus,S.Citil,S.Avcu,G.Gungor,T.Sahin,S.Boysan,O.Altunoren,andA.Sarica,“Strainwaveelastographyforevaluationofrenalparenchymainchronickidneydisease,”TheBritishjournalofradiology,vol.88,no.1050,p.20140714,2015.10[5]R.G.Barr,K.Nakashima,D.Amy,D.Cosgrove,A.Farrokh,F.Schafer,J.C.Bamber,L.Castera,B.I.Choi,Y.-H.Chou,etal.,“Wfumbguide-linesandrecommendationsforclinicaluseofultrasoundelastography:Part2:breast,”Ultrasoundinmedicine&biology,vol.41,no.5,pp.1148–1160,2015.[6]M.Brock,C.vonBodman,R.J.Palisaar,B.L¨oppenberg,F.Sommerer,T.Deix,J.Noldus,andT.Eggert,“Theimpactofreal-timeelastographyguidingasystematicprostatebiopsytoimprovecancerdetectionrate:aprospectivestudyof353patients,”TheJournalofurology,vol.187,no.6,pp.2039–2043,2012.[7]J.Bojunga,E.Herrmann,G.Meyer,S.Weber,S.Zeuzem,andM.Friedrich-Rust,“Real-timeelastographyforthedifferentiationofbenignandmalignantthyroidnodules:ameta-analysis,”Thyroid,vol.20,no.10,pp.1145–1150,2010.[8]G.Ferraioli,C.Filice,L.Castera,B.I.Choi,I.Sporea,S.R.Wilson,D.Cosgrove,C.F.Dietrich,D.Amy,J.C.Bamber,etal.,“Wfumbguidelinesandrecommendationsforclinicaluseofultrasoundelastog-raphy:Part3:liver,”Ultrasoundinmedicine&biology,vol.41,no.5,pp.1161–1179,2015.[9]T.JHall,P.EBarboneg,A.AOberai,J.Jiang,J.-F.Dord,S.Goenezen,andT.GFisher,“Recentresultsinnonlinearstrainandmodulusimaging,”Currentmedicalimagingreviews,vol.7,no.4,pp.313–327,2011.[10]K.Parker,M.Doyley,andD.Rubens,“Imagingtheelasticpropertiesoftissue:the20yearperspective,”Physicsinmedicine&biology,vol.56,no.1,p.R1,2010.[11]J.Ophir,I.Cespedes,H.Ponnekanti,Y.Yazdi,andX.Li,“Elastography:aquantitativemethodforimagingtheelasticityofbiologicaltissues,”Ultrasonicimaging,vol.13,no.2,pp.111–134,1991.[12]Q.He,L.Tong,L.Huang,J.Liu,Y.Chen,andJ.Luo,“Performanceoptimizationoflateraldisplacementestimationwithspatialangularcompounding,”Ultrasonics,vol.73,pp.9–21,2017.[13]Y.Wang,M.Bayer,J.Jiang,andT.J.Hall,“Large-strain3-dinvivobreastultrasoundstrainelastographyusingamulti-compressionstrategyandawhole-breastscanningsystem,”Ultrasoundinmedicine&biology,vol.45,no.12,pp.3145–3159,2019.[14]R.M.PohlmanandT.Varghese,“Physiologicalmotionreductionusinglagrangiantrackingforelectrodedisplacementelastography,”UltrasoundinMedicine&Biology,2019.[15]G.-Y.Li,Q.He,G.Xu,L.Jia,J.Luo,andY.Cao,“Anultrasoundelastographymethodtodeterminethelocalstiffnessofarterieswithguidedcircumferentialwaves,”Journalofbiomechanics,vol.51,pp.97–104,2017.[16]S.Wu,Z.Gao,Z.Liu,J.Luo,H.Zhang,andS.Li,“Directrecon-structionofultrasoundelastographyusinganend-to-enddeepneuralnetwork,”inInternationalConferenceonMedicalImageComputingandComputer-AssistedIntervention.Springer,2018,pp.374–382.[17]C.Hoerig,J.Ghaboussi,andM.F.Insana,“Data-drivenelasticityimagingusingcartesianneuralnetworkconstitutivemodelsandtheau-toprogressivemethod,”IEEEtransactionsonmedicalimaging,vol.38,no.5,pp.1150–1160,2018.[18]B.Peng,Y.Xian,andJ.Jiang,“Aconvolutionneuralnetwork-basedspeckletrackingmethodforultrasoundelastography,”in2018IEEEInternationalUltrasonicsSymposium(IUS).IEEE,2018,pp.206–212.[19]Z.Gao,S.Wu,Z.Liu,J.Luo,H.Zhang,M.Gong,andS.Li,“Learningtheimplicitstrainreconstructioninultrasoundelastographyusingprivilegedinformation,”Medicalimageanalysis,vol.58,p.101534,2019.[20]M.G.KibriaandH.Rivaz,“Gluenet:Ultrasoundelastographyusingconvolutionalneuralnetwork,”inSimulation,ImageProcessing,andUltrasoundSystemsforAssistedDiagnosisandNavigation.Springer,2018,pp.21–28.[21]B.Peng,Y.Xian,Q.Zhang,andJ.Jiang,“Neuralnetwork-basedmotiontrackingforbreastultrasoundstrainelastography:Aninitialassessmentofperformanceandfeasibility,”UltrasonicImaging,p.0161734620902527,2020.[22]A.K.TehraniandH.Rivaz,“Displacementestimationinultrasoundelastographyusingpyramidalconvolutionalneuralnetwork,”IEEETransactionsonUltrasonics,Ferroelectrics,andFrequencyControl,2020.[23]D.Sun,X.Yang,M.-Y.Liu,andJ.Kautz,“Pwc-net:Cnnsforopticalﬂowusingpyramid,warping,andcostvolume,”inProceedingsoftheIEEEConferenceonComputerVisionandPatternRecognition,2018,pp.8934–8943.[24]H.S.HashemiandH.Rivaz,“Globaltime-delayestimationinultrasoundelastography,”IEEEtransactionsonultrasonics,ferroelectrics,andfrequencycontrol,vol.64,no.10,pp.1625–1636,2017.[25]H.Rivaz,E.M.Boctor,M.A.Choti,andG.D.Hager,“Real-timeregularizedultrasoundelastography,”IEEEtransactionsonmedicalimaging,vol.30,no.4,pp.928–945,2011.[26]M.Ashikuzzaman,C.J.Gauthier,andH.Rivaz,“Globalultrasoundelastographyinspatialandtemporaldomains,”IEEEtransactionsonultrasonics,ferroelectrics,andfrequencycontrol,vol.66,no.5,pp.876–887,2019.[27]J.JiangandT.J.Hall,“Acoupledsubsampledisplacementestimationmethodforultrasound-basedstrainelastography,”PhysicsinMedicine&Biology,vol.60,no.21,p.8347,2015.[28]L.YuanandP.C.Pedersen,“Analyticalphase-tracking-basedstrainestimationforultrasoundelasticity,”IEEEtransactionsonultrasonics,ferroelectrics,andfrequencycontrol,vol.62,no.1,pp.185–207,2015.[29]J.LuoandE.E.Konofagou,“Afastnormalizedcross-correlationcalcu-lationmethodformotionestimation,”IEEEtransactionsonultrasonics,ferroelectrics,andfrequencycontrol,vol.57,no.6,pp.1347–1357,2010.[30]J.WulffandM.J.Black,“Efﬁcientsparse-to-denseopticalﬂowesti-mationusingalearnedbasisandlayers,”inIEEEConf.onComputerVisionandPatternRecognition(CVPR)2015,June2015.[31]R.M.PohlmanandT.Varghese,“Dictionaryrepresentationsforelec-trodedisplacementelastography,”IEEEtransactionsonultrasonics,ferroelectrics,andfrequencycontrol,vol.65,no.12,pp.2381–2389,2018.[32]T.J.Hall,Y.Zhu,andC.S.Spalding,“Invivoreal-timefreehandpalpationimaging,”Ultrasoundinmedicine&biology,vol.29,no.3,pp.427–435,2003.[33]R.Chandrasekhar,J.Ophir,T.Krouskop,andK.Ophir,“Elastographicimagequalityvs.tissuemotioninvivo,”Ultrasoundinmedicine&biology,vol.32,no.6,pp.847–855,2006.[34]M.A.Lubinski,S.Y.Emelianov,andM.O’Donnell,“Adaptivestrainestimationusingretrospectiveprocessing[medicaluselasticityimag-ing],”IEEEtransactionsonultrasonics,ferroelectrics,andfrequencycontrol,vol.46,no.1,pp.97–107,1999.[35]K.M.Hiltawsky,M.Kr¨uger,C.Starke,L.Heuser,H.Ermert,andA.Jensen,“Freehandultrasoundelastographyofbreastlesions:clinicalresults,”Ultrasoundinmedicine&biology,vol.27,no.11,pp.1461–1469,2001.[36]J.Jiang,T.J.Hall,andA.M.Sommer,“Anovelperformancedescriptorforultrasonicstrainimaging:Apreliminarystudy,”IEEEtransactionsonultrasonics,ferroelectrics,andfrequencycontrol,vol.53,no.6,pp.1088–1102,2006.[37]H.Rivaz,P.Foroughi,I.Fleming,R.Zellars,E.Boctor,andG.Hager,“Trackedregularizedultrasoundelastographyfortargetingbreastradio-therapy,”inInternationalConferenceonMedicalImageComputingandComputer-AssistedIntervention.Springer,2009,pp.507–515.[38]P.Foroughi,H.-J.Kang,D.A.Carnegie,M.G.vanVledder,M.A.Choti,G.D.Hager,andE.M.Boctor,“Afreehandultrasoundelas-tographysystemwithtrackingforinvivoapplications,”Ultrasoundinmedicine&biology,vol.39,no.2,pp.211–225,2013.[39]A.ZayedandH.Rivaz,“Fastapproximatetime-delayestimationinultrasoundelastographyusingprincipalcomponentanalysis,”in201941stAnnualInternationalConferenceoftheIEEEEngineeringinMedicineandBiologySociety(EMBC).IEEE,2019,pp.6204–6207.[40]A.ZayedandH.Rivaz,“Automaticframeselectionusingmlpneuralnetworkinultrasoundelastography,”inInternationalConferenceonImageAnalysisandRecognition.Springer,2019,pp.462–472.[41]H.Rivaz,E.Boctor,P.Foroughi,R.Zellars,G.Fichtinger,andG.Hager,“Ultrasoundelastography:adynamicprogrammingapproach,”IEEEtransactionsonmedicalimaging,vol.27,no.10,pp.1373–1377,2008.[42]B.S.Garra,“Elastography:history,principles,andtechniquecompari-son,”Abdominalimaging,vol.40,no.4,pp.680–697,2015.[43]B.D.deVos,F.F.Berendsen,M.A.Viergever,M.Staring,andI.Iˇsgum,“End-to-endunsuperviseddeformableimageregistrationwithaconvo-lutionalneuralnetwork,”inDeepLearninginMedicalImageAnalysisandMultimodalLearningforClinicalDecisionSupport.Springer,2017,pp.204–212.[44]S.Chicotay,E.David,andN.S.Netanyahu,“Atwo-phasegeneticalgorithmforimageregistration,”inProceedingsoftheGeneticandEvolutionaryComputationConferenceCompanion,2017,pp.189–190.[45]H.LiandY.Fan,“Non-rigidimageregistrationusingself-supervisedfullyconvolutionalnetworkswithouttrainingdata,”in2018IEEE15thInternationalSymposiumonBiomedicalImaging(ISBI2018).IEEE,2018,pp.1075–1078.[46]A.Subramaniam,P.Balasubramanian,andA.Mittal,“Ncc-net:Nor-malizedcrosscorrelationbaseddeepmatcherwithrobustnesstoillumi-11nationvariations,”in2018IEEEWinterConferenceonApplicationsofComputerVision(WACV).IEEE,2018,pp.1944–1953.[47]D.P.KingmaandJ.Ba,“Adam:Amethodforstochasticoptimization,”arXivpreprintarXiv:1412.6980,2014.[48]F.Cholletetal.,“Keras,”2015.[49]J.A.Jensen,“Field:Aprogramforsimulatingultrasoundsystems,”in10thNordic-BalticConferenceonBiomedicalImaging,Vol.4,Supple-ment1,Part1:351–353,1996.[50]J.Ophir,S.K.Alam,B.Garra,F.Kallel,E.Konofagou,T.Krouskop,andT.Varghese,“Elastography:ultrasonicestimationandimagingoftheelasticpropertiesoftissues,”ProceedingsInst.Mech.Eng.,PartH:J.Eng.inMed.,vol.213,no.3,pp.203–233,1999.[51]F.KallelandJ.Ophir,“Aleast-squaresstrainestimatorforelastography,”Ultrasonicimaging,vol.19,no.3,pp.195–208,1997.1FastStrainEstimationandFrameSelectioninUltrasoundElastographyusingMachineLearningAbdelrahmanZayed,StudentMember,IEEEandHassanRivaz,SeniorMember,IEEEThissupplementarymaterialprovidesresultsthatarecom-plementarytothoseinthepaper.WeinvestigatetheeffectofchangingthehyperparameterN,whichreferstothenumberofprincipalcomponentsused,forbothphantomandinvivodata.Wealsosimulatetheeffectofchangingthehyperparameterp,whichreferstothenumberofRFlinesusedforextractingthesparsefeatures.Dependingontherateofchangeofthedisplacementimageinthehorizontaldirection,differentvaluesofpareneeded.Usingthesimulationdata,wealsoshowthatourmethodworksfordifferentcompressionlevels.Inaddition,weper-formanexperimentwherewegiveout-of-planeRFframepairs(i.e.poor)tothemulti-layerperceptronclassiﬁer,toseewhetheritcancorrectlyclassifythemasbadpairs.Finally,weperformanexperimenttoshowthatitisac-ceptabletoonlycomputethelateraldisplacementforpRFlines,followedbybi-linearinterpolation,ascomparedtothemorecomputationallyexpensivesolutionofcalculatingthedisplacementofallRFlines.WecomparetheaxialstrainproducedbyGLUEwhileprovidingitwithaninitiallateraldisplacementusingbothmethods.I.RESULTSWeuseddifferentnumberofprincipalcomponentsforbothphantomandinvivodatasetstojustifyourchoiceofN=12.Fig.1,2and3showthatN=6isachoicethatworksforallthedatasetsexcepttheinvivodatasetafterablation.Therefore,wesetN=12forourexperiments.Fig.4,5and6showthatp=2isalsoachoicethatworksforallthedatasetsexcepttheinvivodatasetafterablation.Therefore,wesetp=5sinceitdoesn’tnoticeablyincreasethecomputationalcomplexity.TablesIandIIshowacomparisonbetweenthesignaltoNoiseRatio(SNR)andContrasttoNoiseRatio(CNR)ofbothPCA-GLUEandGLUEfordifferentlevelsofcompressionfrom1%to6%.Inaddition,wecollectednewdatawheretheprobedisplacementiscompletelyout-of-plane,tryingtomimicaninexperienceduser.Wefoundthatoutofatotalof160out-of-planeRFframepairs,ourclassiﬁeronlychose11pairsassuitableforelastography,achievinganaccuracyof93.125%.ThisshowstheabilityofourclassiﬁertodistinguishtheRFframescollectedbyaninexperienceduser.Fig.7shows3ofthe11casesthatwereclassiﬁedassuitableRFpairs.Althoughthecompressionwasnotintheaxialdirection,thedisplacementimagesarenotcompletelyout-of-plane.WealsocompareourapproachtothemorecomputationallyexpensivemethodwherethelateraldisplacementimagesgiventoGLUEareobtainedbypassingonallRFlines.Fig.8,9TABLEI:TheCNRvaluesoftheaxialstrainimagesforthesimulationdataatdifferentcompressionlevels.CompressionlevelGLUEPCA-GLUE1%21.5619.743%21.5920.236%22.0619.58TABLEII:TheSNRvaluesoftheaxialstrainimagesforthesimulationdataatdifferentcompressionlevels.CompressionlevelGLUEPCA-GLUE1%22.5822.863%25.4723.536%28.3827.98and10showthatthe2methodsyieldthesameresultsonbothphantomandinvivodatasets.arXiv:2110.08668v1  [eess.IV]  16 Oct 20212(a)B-mode(b)StrainusingN=6(c)StrainusingN=12(d)StrainusingN=24(e)ColorbarFig.1:TheB-modeultrasoundandaxialstrainimageusingPCA-GLUEfortherealphantomexperimentasweincreasethenumberofprincipalcomponentsNfrom6to24.Thecolorbarisforthestrainimagesonly.(a)B-mode(b)StrainusingN=6(c)StrainusingN=12(d)StrainusingN=24(e)ColorbarFig.2:TheB-modeultrasoundandaxialstrainimageusingPCA-GLUEfortheinvivoliverdatabeforeablationasweincreasethenumberofprincipalcomponentsNfrom6to24.Thecolorbarisforthestrainimagesonly.(a)B-mode(b)StrainusingN=6(c)StrainusingN=12(d)StrainusingN=24(e)ColorbarFig.3:TheB-modeultrasoundandaxialstrainimageusingPCA-GLUEforinvivoliverdataafterablationasweincreasethenumberofprincipalcomponentsNfrom6to24.Thecolorbarisforthestrainimagesonly.3(a)B-mode(b)Strainusingp=2(c)Strainusingp=5(d)Strainusingp=10(e)ColorbarFig.4:TheB-modeultrasoundandaxialstrainimageusingPCA-GLUEfortherealphantomexperimentasweincreasethenumberofRFlinespfrom2to10.Thecolorbarisforthestrainimagesonly.(a)B-mode(b)Strainusingp=2(c)Strainusingp=5(d)Strainusingp=10(e)ColorbarFig.5:TheB-modeultrasoundandaxialstrainimageusingPCA-GLUEfortheinvivoliverdatabeforeablationasweincreasethenumberofRFlinespfrom2to10.Thecolorbarisforthestrainimagesonly.(a)B-mode(b)Strainusingp=2(c)Strainusingp=5(d)Strainusingp=10(e)ColorbarFig.6:TheB-modeultrasoundandaxialstrainimageusingPCA-GLUEforinvivoliverdataafterablationasweincreasethenumberofRFlinespfrom2to10.Thecolorbarisforthestrainimagesonly.4(a)B-mode(b)Case1(c)Case2(d)Case3Fig.7:Someofthedisplacementimagesincorrectlyclassiﬁedassuitableforelastography.(a)B-mode(b)Strainusingmethod1(c)Strainusingmethod2(d)ColorbarFig.8:Acomparisonbetweentheaxialstrainestimatedusing2methodsforthephantomexperiment.Inmethod1,thelateraldisplacementgiventoGLUEisobtainedbypassingonallRFlines.Inthemethod2,thelateraldisplacementgiventoGLUEisobtainedbypassingonlyon5RFlines,followedbybi-linearinterpolation.Thecolorbarisforthestrainimagesonly.(a)B-mode(b)Strainusingmethod1(c)Strainusingmethod2(d)ColorbarFig.9:Acomparisonbetweentheaxialstrainestimatedusing2methodsfortheinvivoliverdatabeforeablation.Inmethod1,thelateraldisplacementgiventoGLUEisobtainedbypassingonallRFlines.Inmethod2,thelateraldisplacementgiventoGLUEisobtainedbypassingonlyon5RFlines,followedbybi-linearinterpolation.Thecolorbarisforthestrainimagesonly.5(a)B-mode(b)Strainusingmethod1(c)Strainusingmethod2(d)ColorbarFig.10:Acomparisonbetweentheaxialstrainestimatedusing2methodsfortheinvivoliverdataafterablation.Inmethod1,thelateraldisplacementgiventoGLUEisobtainedbypassingonallRFlines.Inmethod2,thelateraldisplacementgiventoGLUEisobtainedbypassingonlyon5RFlines,followedbybi-linearinterpolation.Thecolorbarisforthestrainimagesonly.