9
1
0
2

y
a
M
6
2

]

A
G
.
h
p
-
o
r
t
s
a
[

2
v
5
1
2
9
0
.
5
0
9
1
:
v
i
X
r
a

MNRAS 000, 1–18 (2015)

Preprint 28 May 2019

Compiled using MNRAS LATEX style ﬁle v3.0

A Bayesian direct method implementation to ﬁt emission
line spectra: Application to the primordial He abundance
determination

Vital Fern´andez1(cid:63), Elena Terlevich1, Angeles I. D´ıaz2,3,4, Roberto Terlevich1,5
1Instituto Nacional de Astrof´ısica, ´Optica y Electr´onica, Luis E. Erro 1, 72840 Tonantzintla, Puebla, Mexico
2Departamento de F´ısica Te´orica, Universidad Aut´onoma de Madrid, E-28049 Madrid, Spain
3Centro de Investigaci´on Avanzada en F´ısica Fundamental CIAFF-UAM
4Astro-UAM, UAM, Unidad Asociada CSIC
5 Institute of Astronomy, University of Cambridge, Madingley Rd., Cambridge CB3 0HA , UK

Accepted XXX. Received YYY; in original form ZZZ

ABSTRACT
This work presents a Bayesian algorithm to ﬁt the recombination and collisionally
excited line spectra of gas photoionized by clusters of young stars. The current model
consists in fourteen dimensions: two electron temperatures, one electron density, the
extinction coeﬃcient, the optical depth on the HeI recombination lines and nine ionic
species. The results are in very good agreement with those previously published us-
ing the traditional methodology. The probabilistic programming library PyMC3 was
chosen to explore the parameter space via a NUTs sampler. These machine learning
tools provided excellent convergence quality and speed. The primordial helium abun-
dance measured from a multivariable regression using oxygen, nitrogen and sulfur was
YP, O−N −S = 0.243 ± 0.005 in agreement with a standard Big Bang scenario.

Key words:
abundance

cosmology:primordial helium abundance – ISM:HII regions – sulfur

1 INTRODUCTION

The Standard Big Bang Nucleosynthesis (SBBN) is the
model of choice for explaining the non-zero helium mass
fraction observed in the universe for objects with al-
most zero metals. Inside its framework for a certain set
of atomic parameters, the primordial nucleosynthesis by-
products (D, 4He, 3He and 7 Li) can be modelled as a func-
tion of the baryons-to-photons ratio, η. These are commonly
referred to as light elements and an empirical conﬁrma-
tion of their primordial abundances can provide very strong
constraints on the early universe. An indirect measurement
for these primordial abundances can be accomplished from
the analysis of the Cosmic Microwave Background (CMB)
since η can be measured from its spectrum. Recently, the
Planck Collaboration et al. (2018a) combined their CMB
measurements with the algorithms by Pisanti et al. (2008)
to predict the light element abundances under a ΛCDM
paradigm. Their prediction for the primordial helium mass
fraction is YP = 0.24672
. However, once the
ﬁtting is repeated allowing YP and Ne f f (the number of neu-
trino species) to vary, the prediction uncertainty increases

+(0.00011)0.00061
−(0.00012)0.00061

(cid:63) E-mail: vi.fernandez@inaoep.mx (Vital Fern´andez)

© 2015 The Authors

with Ne f f = 2.89+0.63
to Y BB N
−0.57
P
lifetime without uncertainties of τn = 880.2s.

= 0.247+0.034
−0.036

using a neutron

The measurement of YP involves the analysis of chemi-
cally unevolved gas reservoirs. In the recent work by Cooke
& Fumagalli (2018), the helium abundance was measured
from the absorption features of intergalactic gas observed
against the light of a background quasar. Their YP =
0.250+0.033
value is in agreement with the SBBN Planck Col-
−0.025
laboration et al. (2018b) prediction. In the past, this tech-
nique has provided very accurate measurements for the pri-
mordial deuterium mass fraction (see Carswell et al. 1994)
which may extend to the YP estimation. Currently, however,
state of the art measurements for YP are obtained from the
chemical analysis of the photo-ionised gas in extragalactic
HII regions.

Over 40 years ago, Peimbert & Torres-Peimbert (1974)
and Lequeux et al. (1979) published what is now known
as the traditional method to determine YP. These authors
argued that in low metallicity regions the chemical enrich-
ment (dY/dZ) is linear. They proposed to use oxygen as the
tracer for the total metal content dY/dZ ≈ dY/dO. This is a
very convenient choice for three reasons: ﬁrstly oxygen is the
most common element after hydrogen and helium, account-
ing for almost half the metals mass fraction, Z. Secondly, in
the optical range oxygen has very intense lines, which pro-

 
 
 
 
 
 
2

V. Fern´andez, E. Terlevich, A. I. D´ıaz, R. Terlevich

Figure 1. Box and whisker plot with the percentage increase in emission line ﬂux after the continua correction has been applied for
some of the emission lines observed in increasing wavelength and the number of HIIGs contributing to the statistic. The middle line in
the boxes represents the sample median increased percentage while the box edges represent the 16t h and 84t h percentiles. The whiskers
represent the lower and upper outliers.

vide an accurate measurement for its main ionic populations
O+, O2+(cid:17)
(cid:16)
. Finally, oxygen is a heavy element produced by
very massive stars in very short time scales. This guarantees
that the gas reservoir is not largely contaminated by the cur-
rent star-forming burst. These assumptions make it possible
to apply a linear regression on the Y vs O/H abundances
relation for a given data sample. The coordinate O/H = 0
corresponds to Y = YP: the helium abundance produced by
the primordial nucleosynthesis.

Recent primordial helium abundance determinations
using this technique have been published by Izotov et al.
(2014) with YP = 0.2551 ± 0.0022, Aver et al. (2015)
with YP = 0.2449 ± 0.004, Peimbert et al. (2016) with
YP = 0.2446 ± 0.0029 and Valerdi et al. (2019) with YP =
0.2451 ± 0.0026. The last works from Peimbert and collab-
orators include a computation of the neutron lifetime us-
ing the measured value YP and a SBBN model. The es-
timated values: τn = 870 ± 14 and τn = 873 ± 14 are in
good agreement with the value measured by Pattie et al.
(2018) τn = 877.7 ± 0.7st at + 0.4/−0.2sys. Additionally, Fer-
n´andez et al. (2018) (hereafter F2018) published the ﬁrst YP
determination using sulfur as the metallicity tracer result-
ing in YP,S = 0.244 ± 0.006. A multivariable linear regres-
sion using oxygen, nitrogen and sulfur was proposed giving
YP, O−N −S = 0.245 ± 0.007. It can be appreciated that the
latter three groups measurements agree with a SBBN sce-
nario, while the value from Izotov et al. (2014) is 2.2σ above
the standard cosmology predictions. This discrepancy may
be explained by the complexity in the chemical analysis. Pe-
imbert & Peimbert (2011) summarised thirteen uncertainty
sources, most of them systematic, which aﬀect the helium
abundance calculation. Many of these error sources also im-
pact the metals abundance determination. These include the
uncertainty on the atomic data, the temperature and den-
sity distributions or the accuracy on the ionisation correction
factors.

The methodology described in F2018 follows a standard
approach to derive the chemical composition of ionised gas.
This procedure, recently reviewed by Peimbert et al. (2017)
and P´erez-Montero (2017) is designed to isolate each phe-
nomenon contributing to the observed emission. However, as
both the astronomical data and models complexity keep in-
creasing, this methodology becomes more cumbersome to

apply. This is the reason why many researchers are em-
bracing methodologies capable of exploring a multidimen-
sional space. Examples of chemical analysis in the optical
spectral range include the pioneer work by Olive & Skill-
man (2001) and Olive & Skillman (2004) which ﬁtted simul-
taneously ﬁve parameters contributing to the helium lines
emission. The aim of this new methodology is to provide
a better quantiﬁcation of the errors for the helium abun-
dance determination. Later, this methodology was further
enhanced by Aver et al. (2011); Aver et al. (2013); Aver
et al. (2015), who included the hydrogen emission lines and
increased the number of dimensions to eight. They also dis-
cussed the impact of the computational technique in order
to explore the parameter space. Their chosen sampler was
COSMOMC (see Li et al. 2014), a Fortran based program
which applies a Markov Chain Monte Carlo (MCMC) pro-
cess via a Metropolis-Hastings algorithm.

In this paper, we propose a methodology to ﬁt the re-
combination and collisionally excited emission spectra. As it
was done in F2018, the electron temperature and density are
determined using the direct method (see Osterbrock & Fer-
land 2005) which are anchored by appropriate collisionally
excited line ratios. The main advantage of the new method
is that all the model parameters contributing to the ob-
served emission are solved simultaneously. This represents
a space with up to fourteen dimensions. These parameters
include nine ionised species of argon, helium, oxygen, ni-
trogen and sulfur in the optical and near infrared regions.
To solve this system, we apply a HMC (Hamiltonian Monte
Carlo) sampler based in machine learning algorithms. These
tools provide a remarkable convergence quality and speed,
which would have been impossible with standard MCMC
algorithms. The data used is the one described in F2018.

The paper is organised as follows: Section 2 brieﬂy re-
views the F2018 sample and the treatment to account for the
stellar and nebular continua. Section 3 describes how the di-
rect method was adapted to a Bayesian paradigm and a tech-
nical description of the HMC sampler. Section 4 overviews a
set of test cases to evaluate the accuracy and physical viabil-
ity of the new technique. Section 5 presents the results and
discusses merits and limitations of this technique. Finally,
Section 6 summarises the main results.

MNRAS 000, 1–18 (2015)

2 THE DATA

The data used in this paper are the 27 HII galaxies presented
in Table 1 of F2018. In that paper we discussed the selection
of the objects, the data reduction process and the derivation
of their chemical abundances. The trends Y − O/H, Y − N/H
and Y −S/H and the obtained values for YP are also discussed
in that paper.

The measurement of the line ﬂuxes has been described
in detail in F2018. The process takes into account correc-
tions for extinction and for underlying stellar and nebular
continua. For the starforming ionised regions, the nebular
continuum can reach comparable values to the underlying
stellar continuum (see Reines et al. 2009).

The impact of this treatment of the spectra is illustrated
in Fig. 1, where we plot the percentage increase in the line
ﬂuxes after the corrections have been applied for the most
relevant recombination lines in our spectra. Even though
the contribution for the strong hydrogen Balmer lines may
be considered negligible, we observe about a 20 % increase
in the HeI lines intensity once the continuum correction is
taken into account and this percentage changes with wave-
length.

3 BAYESIAN DIRECT METHOD.

The ﬂux from an emission line can be expressed as a function
of the transition emissivity relative to a Balmer line, e.g. H β:

FX i+, λ
FHβ

= Xi+ (cid:15)X i+, λ (Te, ne)
(cid:15)Hβ (Te, ne)

· 10−c(Hβ)· fλ · kHeI, λ (τ, Te, ne)

(1)

(cid:16)

where (cid:15)X i+, λ/(cid:15)H β is the relative emissivity at the transition
wavelength λ, for an ion with abundance Xi+, at certain
cm−3(cid:17)
electron temperature Te (K) and electron density ne
.
The term c (H β) is the logarithmic extinction at H β for a
reddening law fλ. The parameter kHeI, λ represents a ﬂuo-
rescence excitation correction for the HeI lines calculated by
Benjamin et al. (2002) as a function of the optical depth τ.
Traditionally, as already mentioned, the parameters in
eq. 1 are solved individually by isolating the diﬀerent pro-
cesses contributing to the observed ﬂux. Usually, the ﬁrst
step consists in computing c (H β) from the diﬀerence be-
tween the theoretical and observed ﬂuxes of the hydrogen
Balmer series. This is a valid approach since most of the
hydrogen is ionised. Additionally, their emissivity remains
almost constant for the expected Te and ne values.

The next step in the traditional method consists in
computing the ionic abundances from the observed emis-
sion lines. In the so called direct method, we calculate
the emissivity coeﬃcient by providing values for Te and ne
obtained by measuring temperature-sensitive and density-
sensitive line ratios. Finally, using these parameters back in
eq. 1 the ionic abundance can be computed from each emis-
sion line.

As we discussed in F2018, however, there are problems
inherent to this method. Firstly, it can underestimate the
uncertainty in the model parameters since these are ﬁtted
individually. To properly propagate the error to the abun-
dances, several iterations may be necessary, as well as com-

MNRAS 000, 1–18 (2015)

A Bayesian direct method implementation

3

Table 1. Priors and likelihood distributions in our model. The
term X i+ includes all the ionic metal abundances: Ar 2+, Ar 3+, y+,
y2+, O+, O2+, N +, S+ and S2+. These abundances are deﬁne in
12 + log (cid:0)X i+(cid:1) scale.

Parameter

Prior distribution

Tl ow
Thi gh
ne
c(H β)
X i+
y+
y2+
τ

N or mal(µ = 15000 K, σ = 5000 K)
N or mal(µ = 15000 K, σ = 5000 K)
µ = 150 cm−3, σ = 50 cm−3(cid:17)

N or mal

(cid:16)

logN or mal (µ = 0, σ = 1)
N or mal(µ = 5, σ = 5)
1/10 · logN or mal (µ = 0, σ = 1)
1/1000 · logN or mal (µ = 0, σ = 1)
logN or mal (µ = 0, σ = 0.4)

Parameter

Likelihood distribution

F

X i+, λ
FH β

N or mal(µ =

F

X i+, λ, ob s
FH β

, σ =

σ

X i+, λ, ob s
FH β

)

plex networks of chained Monte Carlo algorithms. Secondly,
eq. 1 represents the most basic interpretation. As we intro-
duce more complexity in the physics of the problem, like e.g.
kτ in eq. 1, it becomes harder to solve the model parameters.
Finally, with the large amount of data available today, plus
its larger wavelength coverage, this methodology becomes
harder to apply.

In this paper, we use a method that allows to ﬁt all
the parameters in eq. 1 simultaneously. These are two elec-
tron temperatures for the low and high ionisation regions,
Tlow and Thigh, one electron density ne, which is assumed
to remain constant within the star forming region, the ex-
tinction coeﬃcient c (H β) and nine ionic abundances Ar2+,
Ar3+, y+, y2+, O+, O2+, N+, S+ and S2+. Here we add the
optical depth, τ, to account for the ﬂuorescence excitation
in the helium lines as tabulated by Benjamin et al. (2002).
This brings the maximum number of dimensions to fourteen
and in order to explore this relatively large parameter space,
it becomes necessary to apply machine learning tools.

Currently, data science has become very popular due
to the computational advances in three domains: big data,
deep learning and probabilistic programming. In the ﬁrst
ﬁeld, the user is interested in ﬁnding patterns in large data
sources. In deep learning, the user deﬁnes the parameter
space via neural networks which have several ‘depths’. Fi-
nally, probabilistic programming focuses in declaring mod-
els, whose parameters and outputs are probability functions.
We applied the probabilistic programming package PyMC3
by Salvatier et al. (2016), which makes use of the deep
learning library Theano by The Theano Development Team
et al. (2016) to deﬁne the physical model. This package in-
cludes a NUTs (No-U-Turns) sampler (see Hoﬀman & Gel-
man 2011) to explore the parameter space. This sampler
follows a Hamiltonian Monte Carlo (HMC) paradigm, which
drops the stochastic jumps from the Markov Chain by an in-
formed sampling guided by the mathematical model deriva-
tives. This algorithm implementation involves a more chal-
lenging programming experience than a MCMC sampler.
Still, this HMC algorithm provides excellent convergence
quality for large parameter spaces. Moreover, this sampler
decreases the ﬁtting computational time from several hours
(> 6 h) to a couple of minutes.

It may be inferred from the previous deﬁnition that

4

V. Fern´andez, E. Terlevich, A. I. D´ıaz, R. Terlevich

Table 2. Fitting results for the test cases with increasing number of parameters described in the text

Parameter True value

Tl ow
ne
S+
S2+
O+
O2+
Ar 2+
Ar 3+
N +
c(H β)
Thi gh
y+
y2+
τ

15590
500
5.48
6.36
7.80
8.05
5.72
5.06
5.84
0.100
16000
0.0850
0.00088
1.0

Test 1
15590 ± 244
491 ± 39
5.479 ± 0.014
6.360 ± 0.015
(cid:55)
(cid:55)
(cid:55)
(cid:55)
(cid:55)
(cid:55)
(cid:55)
(cid:55)
(cid:55)
(cid:55)

Test 2
15750 ± 252
492 ± 39
5.459 ± 0.028
6.332 ± 0.036
7.768 ± 0.047
8.037 ± 0.022
5.696 ± 0.031
5.049 ± 0.019
5.820 ± 0.027
0.137 ± 0.047
(cid:55)
(cid:55)
(cid:55)
(cid:55)

Test 3
16470 ± 787
494 ± 39
5.402 ± 0.064
6.258 ± 0.084
7.663 ± 0.116
8.027 ± 0.026
5.634 ± 0.071
5.043 ± 0.021
5.762 ± 0.064
0.21 ± 0.09
16310 ± 334
(cid:55)
(cid:55)
(cid:55)

Test 4
15640 ± 282
492 ± 36
5.475 ± 0.019
6.354 ± 0.022
7.794 ± 0.037
8.048 ± 0.017
5.715 ± 0.019
5.058 ± 0.016
5.835 ± 0.019
0.11 ± 0.018
16020 ± 193
0.0850 ± 0.001
0.00088 ± 0.00001
0.991 ± 0.225

any probabilistic programming implementation is intrinsi-
cally Bayesian. This paradigm is characterised by the appli-
cation of the Bayesian theorem:
Pr (θ|y) = Pr (y|θ) Pr (θ)

(2)

Pr (y)

where Pr (θ) is referred to as the prior. This term represents
the probability distribution of the model parameters θ before
the ﬁtting. Pr (y|θ) is the likelihood of the model and it pro-
vides an evaluation on how the observational data y adjusts
to the theoretical model. Pr (y) is referred to as the evidence.
This parameter is actually the integral of the numerator in
eq. 2 over the complete parameter space and it represents
the probability that the observed data has been generated
by the processes described by the model. Finally, P (θ|y) is
the probability of the model parameters given the obser-
vations. In a Bayesian inference, the posterior provides the
user with a credible region: given the observed data, there
is a 95% probability that the true value of θ falls within this
credible region CRθ . To successfully compute this diagnos-
tic, however, it is essential to properly deﬁne the terms in
the Bayesian theorem.

Recently, Tak et al. (2018) reviewed the quality of
Bayesian models in astronomical literature. These authors
emphasised how improper priors can result in output dis-
tributions not meeting the posterior propriety. An example
of improper prior includes a uniform distribution covering
the real space (−∞, ∞). Moreover, in the particular case of a
NUTs sampler a uniform prior can dramatically aﬀect both
the convergence quality and the simulation speed. To deal
with this issue, in the Bayesian approach, one can deﬁne a
joint distribution using proper priors to ensure the posterior
propriety. On the one hand, we can rely on the scientiﬁc ev-
idence to implement very informative (or constrained) prior
distributions. On the other hand, in cases where little phys-
ical knowledge is available, it is acceptable to provide un-
informative (or wide) prior distributions. In practice, this
provides a uniform probability distribution for a region of
interest. These two strategies are considered here and the
input priors are displayed in Table 1. The following para-
graphs describe how the traditional direct method applied
in F2018 was adjusted to a Bayesian paradigm using proper
priors:

• We consider in this study two ionisation regions. These
are characterised by two electron temperatures: Tlow and

Thigh. In the low ionisation region the ionised species are
Ar2+, H+, O+, N+, S+ and S2+. The high ionisation species
are Ar3+, He+, He2+ and O2+. The two temperatures share
the same prior design: a Gaussian distribution with µ =
15000 K and σ = 5000 K. This range provides a good cov-
erage for the temperatures commonly encountered in HII
galaxies (as it was shown in F2018). The temperature de-
pends on the auroral lines observed: [SI I I] 6312˚A for Tlow
and [OI I I] 4363˚A for Thigh. In the objects where only one
auroral line was available, only the corresponding tempera-
ture priors is declared. The other temperature is calculated
using the linear relation provided by P´erez-Montero (2017):

te [OI I I] = 1.0807te [SI I I] − 0.0846

(3)

where te is in 104K units.

(cid:16)

• The

density

electron

calculation

< 100 cm−3(cid:17)

from the
[SI I] λλ6717,6731˚A line ratio falls within the very low
density regime for most objects
. This is actu-
ally the regime at which this line ratio becomes less sensitive
to density. This means that the [SI I] density cannot be
computed to high accuracy. This is not, however, a big issue
from the chemical analysis point of view as for most ionised
species the emissivity also remains independent with the
density at these regimes. This can be an issue from the
mathematical point of view, though. If the density cannot
be ﬁtted from the available data, the resulting posterior
distribution will actually be the prior one. In order to force
the simulation to stay in a representative density region,
we deﬁne the density prior via a Gaussian distribution with
µ = n[SI I] and σ = σne [SI I ] measured in F2018.

• The reddening curve chosen for this work is the ’LMC
average’ published by Gordon et al. (2003) with a RV = 3.4
appropriate for a star forming region. The gas extinction in
these objects is usually very low (e.g. Terlevich et al. 1991).
This parameter, however, cannot be negative. To account for
this physical limit a log-normal distribution was chosen with
σ = 1.0. This guarantees higher probability to the expected
extinction coeﬃcient range.

• In F2018, all calculations involving the line emissivities
were accomplished using PyNeb (see Luridiana et al. 2015).
Third party libraries, however, are not easily imported into
deep learning algorithms. Implementing a 2-dimensional in-
terpolation on emissivity grids is beyond the scope of this

MNRAS 000, 1–18 (2015)

A Bayesian direct method implementation

5

randomness in the observables is caused by the model pa-
rameters, which behave as a probability distribution. This
interpretation has a physical foundation in models such as
this one. For example: Te is generally interpreted as the re-
sult of a Maxwellian velocity distribution of the electrons. In
practice, it is not common for spectra to show the same un-
certainty everywhere along the wavelength range. For exam-
ple, in the present case it is essential to assert the diﬀerence
in uncertainty between the [OI I I] auroral and nebular lines.
A valid approach to account for this uncertainty consists
in establishing a normal distribution, whose standard devia-
tion is weighted by the observational error, as the likelihood.
This was the approach considered in this model (shown in
Table 1) with a normal distribution likelihood with µ = Fλ
and σ = σFλ for each emission line where Fλ represents the
ﬂux relative to H β including the error propagation in the
ratio.

4 MODEL TEST CASES

Possibly the most discouraging feature of Monte Carlo sim-
ulations is assessing the convergence quality. Fortunately, in
empirical models such as this one, the convergence can be
evaluated graphically. This process has two phases:

In the ﬁrst one, a set of values is chosen for the model
parameters from which the synthetic observables are gen-
erated. Afterwards, this synthetic spectrum is fed into the
algorithm: The output ﬁttings are then compared with the
true values. In addition to a good accuracy it is expected
that the credible region width is of the same order as the
uncertainty found in the traditional methodology. Table 2
displays in column 1 a set of values for the model parameters,
which were used to generate an array of synthetic emission
lines using eq. 1. In the test cases below, a uniform 2% un-
certainty was adopted for the emission lines ﬂux considered.
The following paragraphs describe these test cases.

Tlow, ne, S+, S2+(cid:17)
(cid:16)

In the simplest example only four model parame-
using ﬁve emission lines:
ters are ﬁtted
[SI I] λλ6717,6731˚A, [SI I I] λ6312˚A and [SI I I] λλ9069, 9531˚A.
In a Monte Carlo simulation, such as this one, the user de-
clares the number of iterations and the number of tuning
steps, which are the number of initial steps not included in
the ﬁnal statistics. This is because they account for the time
the algorithm requires to reach the optimum jump step size
to the solution region. An additional good practice consists
in repeating the simulation to conﬁrm that the initial con-
ditions do not alter the results. Fortunately, packages such
as PyMC3 can parallelize the models easily by running one
simulation per machine processor. Once all the ﬁttings ﬁn-
ish, the parameters measurement includes the traces from
all the machine cores. This enables shorter simulations and
a better resource management. All this information can be
seen in Fig.2. The four plots on the left side represent the
model parameter traces evolution with time. It can be appre-
ciated that during the simulation steps, all the traces have a
white noise-like appearance. This signals a simulation which
has successfully converged to a parameter space coordinate
(not necessarily the right one). This simulation conﬁgura-
tion consists in 6000 simulation steps and 2000 tuning steps
parallelised in a 1.8-GHz i7-5400U dual-core processor lap-

Figure 2. Output ﬁt plot for the 1st test case: sulfur emission
only. In colour in the electronic version.

project. The alternative chosen is a strategy commonly used
in the traditional chemical analysis: Parametrised equations
for the emissivity as a function of the electron temperature
and density. For each emission line an emissivity grid was
computed using PyNeb for the references in Table A2 in the
appendix and which also includes the emissivity parametri-
sation for each ion. Table A3 displays the ﬁtted coeﬃcients
for the 8, 000 - 25, 000 K and 1-600 cm−3 surface for each emis-
sion line. These ﬁttings provide the line emissivity in log
scale. This was done for two reasons: ﬁrst, the emissivity
grids are easier to ﬁt in a log scale surface. Second, to im-
prove the metal abundance sampling it was desirable to use
the standard 12+log (cid:0)X+(cid:1) notation. For the ionic abundances
uninformative priors can be applied. For the metal species
Gaussian distributions are considered with µ = 5 and σ = 5.
The y+ and y2+ abundances are given in the linear scale and
a log-normal distribution is used to model their priors with
µ = 0 and σ = 1. The values drawn from these priors are
scaled by the expected y+ and y2+ regime via coeﬃcients
ky+ = 1/10 and ky2+ = 1/1000.

• To account for ﬂuorescence excitation on the helium
lines, a new correction has been included on the analy-
sis. The radiative transfer calculations from Benjamin et al.
(2002) are included in eq. 1 as a function of Thigh and ne.
A successful ﬁtting for this parameter depends on the avail-
ability of HeI lines which are sensitive to this eﬀect. As it
will be showed in the next section test cases, this param-
eter ﬁts properly in synthetic observations for both prior
probability distributions considered. However, our current
observational data lacks emission lines which are strongly
aﬀected by this phenomenon. Therefore, it cannot be quan-
tiﬁed. Consequently, we deﬁned a prior with a log-normal
distribution with µ = 0 and σ = 0.4. This choice is justiﬁed
by the following arguments: 1) In Aver (2012), it was shown
that more than half of the ﬁfty successfully ﬁtted spectra
using the same optical depth model have an opacity below
one and only three objects displayed opacities above four.
Therefore, this distribution guarantees a proper prior, even
if very informative, which is justiﬁed by known data. This
is an acceptable practice for statistical inference in scientiﬁc
models. 2) Using synthetic test cases, it was conﬁrmed that
this probability distribution does not result in degeneracies
with other parameters, in particular y+. This was not the
case of prior designs, which covered large τ values.

The last element to deﬁne in eq. 2 is the model likelihood. At
this point, it is important to remember that in the Bayesian
paradigm there is not uncertainty in the model data y: any

MNRAS 000, 1–18 (2015)

6

V. Fern´andez, E. Terlevich, A. I. D´ıaz, R. Terlevich

Figure 3. Left) Output ﬁt plot for the 2nd test case: all metals emission and light extinction. Right) Output ﬁt plot for the 3r d test
case: two electron temperatures. In colour in the electronic version.

top. These simulation pairs are joined in Fig.2 where we can
see that the traces are indistinguishable. These traces pro-
vide us with the statistics for the parameters measurement.
The value written over the traces are the mean and standard
deviation from the traces. These are the values in Table 2.
The 16th and 84th percentiles from the posterior distribution
are written on the ordinate axis. The median value is given
in the histograms. It can be concluded from this initial test
that the simulation ﬁttings are in good agreement with the
true values.

Fig. 3 displays the results for the test cases 2 and 3 sim-
ilarly to Fig.2, but now all the metal emission lines are in-
cluded as input. Consequently, all metals ionic abundances
are included as well. In this simulation, we still only have
one temperature prior (Tlow). In order to compute the phys-
ically correct temperature for the high ionization ions, the
algorithm automatically includes the empirical linear model
in eq. 3. Hence, at each iteration the temperature value
drawn from this distribution is applied directly to compute
the emissivity for the low ionization species emissivity. For
the high ionization ones, however, this temperature is pre-
viously corrected according to eq. 3. It may be concluded
from the results that all the abundances were properly ﬁt-
ted even for elements, such as the argon ions, where only
one emission line was observed for each ion. The extinc-
tion coeﬃcient c(H β) is also considered in the analysis. Usu-
ally, the extinction cannot be determined using collision-
ally excited lines due to their sensitivity to temperature and
density. In this case, however, we can see from Fig. 3 that
c (H β) was successfully measured using only collisionally ex-
cited lines. There are two reasons for that: ﬁrst, two auroral

lines, [OI I I] λ4363˚A and [SI I I] λ6312˚A, are anchoring the
electron temperature. Second, this ﬁtting includes emission
lines from [OI I I] λ4363˚A to [SI I I] λ9531˚A. This wide wave-
length range guarantees data points with varying sensitivity
to the extinction, which improves the sampling of c (H β).

In the 3r d test case, the simulation includes a prior Thigh
for the high ionization region electron temperature. It should
be emphasised that in the previous test cases the ionised
species had the same assignment the low or high ionisation
regions. The diﬀerence now is that Thigh is ﬁtted along the
rest of the model parameters instead of being calculated us-
ing eq. 3. It can be appreciated in the right hand side of Fig.
3 that in this simulation there is a greater uncertainty in all
the parameter ﬁttings. This is because the previous condi-
tions are no longer met. To begin with only one auroral line is
anchoring each electron temperature. Moreover, in this sim-
ulation only the [OI I I] and [Ar IV] emissions are located in
the high ionisation region. These lines cover a narrow wave-
length range to sample the parameter space which makes
the c (H β) sampling harder. Finally, some small divergence
on the traces for some parameters during the simulation can
be appreciated. We conclude that this test case does not
have enough data to ﬁt the model parameters.

(cid:17)

(cid:16)

y+, y2+, τ

In the 4th test case, the simulation runs the com-
plete model: three more dimensions
are included
reaching a total of fourteen. As all the hydrogen and helium
lines in the covered spectral region are included, the number
of inputs has also increased. Moreover, the hydrogen recom-
bination lines provide a ﬁrm anchor to the dust extinction
since this parameter has the greatest impact in their in-
tensity. Fig. 4 shows that in this case the simulation has

MNRAS 000, 1–18 (2015)

A Bayesian direct method implementation

7

tribution which represents the physical parameter magni-
tude and behaviour as close as possible. Nevertheless, from
the computational point of view, it is encouraged to use
the same probability distributions centred at zero for all the
model parameters and parameterizing the theoretical model
instead. This is because the sampling process becomes more
eﬃcient. We can conﬁrm in Table A4 that the prior design
is not aﬀecting the results and the simulations are consis-
tently converging at the same coordinate. These test cases
represent an ideal scenario, where all the necessary inputs
are available. In real observations where some emission lines
may not be available the prior design impact needs to be
checked again.

An additional graphical tool to establish a Monte Carlo
simulation convergence quality is a scatter plot matrix. This
is shown in Fig. 5, in which the parameter traces from the
complete test case are plotted against each other as surface
distributions. The red lines mark the true value location,
which are within the algorithm sampled region. It can be
appreciated that there is some degeneracy between the met-
als ionic abundance and electron temperature. This degen-
eracy, however, is intrinsic for the physical model since for
the temperature and abundance range these parameters are
correlated. This degeneracy might be decreased by param-
eterizing the mathematical parameter space, thus making
it easier to sample. This would also improve the speed of
the model, which for the current implementation is over 100
steps per second. However, the current algorithm conver-
gence quality and speed is good and the ﬁttings presented
display accuracy and precision in the measurement. In the
second phase, the algorithm is tested on real observations
and its convergence is compared to the synthetic ones. This
is done in the following section using the data values from
F2018.

5 RESULTS AND DISCUSSION

The initial implementations of this Bayesian algorithm in
real spectra resulted in a slow sampling process or even fail-
ure to launch. This was caused by some emission lines which
had a very narrow likelihood in the inference model. For
example, in this sample spectra the [OI I I] λ5007˚A and Hα
lines can display uncertainties below 0.5% of their integrated
ﬂux. Running synthetic test cases with similar likelihoods we
learned that the algorithm found it hard to ﬁnd a solution
given the wide temperature and abundance priors provided.
This uncertainty does not really represent the physical pro-
cesses intrinsic randomness. Instead, it quantiﬁes the emis-
sion line signal-to-noise ratio. Consequently, applying this
uncertainty in the emission line likelihood implies very small
sampling steps for the model parameters. As most of the pro-
posed parameter values are rejected the simulation runs very
slowly. To deal with this issue a minimum 2% uncertainty
was set on the emission lines likelihood. This is the value
used in the test cases, which provided stable solutions and
measurements with the expected uncertainty.

Fig.6 corresponds to the ﬁtting of SHOC022. In most
object ﬁttings, the correlation between the ionic abundances
and the electron temperatures seem to be more pronounced
than the one displayed in Fig. 5 for synthetic inputs. Still, it
can be established that the data is well represented by the

Figure 4. Output ﬁt plot for the 4t h test case: complete model.
In colour in the electronic version.

properly converged. Additionally, it can be appreciated that
all the parameter ﬁttings are very close to the true values
tabulated in Table 2.

An important practice in Bayesian models is to check
the impact of the priors design in the sampling process
and results. The results from additional test cases for the
complete model can be found in Table A4. In the 5th test
case the Thigh temperature prior has a uniform distribution
which covers the complete temperature range: from 8000
to 22000K. In the 6th test case both temperature priors
have a Gaussian distribution but Tlow is centred at 10000K
while Thigh is centred at 20000K. Both distributions have
a standard deviation of 2500K which means that the true
values at 15590K and 16000K have a relatively low proba-
bility. In the 7th and 8th test cases we are assigning uni-
form priors for the optical depth and the electron density
respectively. In the former case, the uniform priors lower
and upper limits are 0 and 10 while in the latter the lim-
its are 1 and 1000 cm−3. Finally, in the 9th test case the
ionic helium abundance priors are deﬁned by the relation:
yi+ = kyi+ + Normal (µ = 0.0, σ = 1.0) · kyi+ , where kyi+ = 0.1
and kyi+ = 0.001 for the y+ and y2+ abundances respectively.
These priors represent a basic reparameterization: Distribu-
tion centred at zero with a certain oﬀset. This prior design
is not easy to read from a researcher point of view. Indeed,
it may seem the obvious choice to assign a probability dis-

MNRAS 000, 1–18 (2015)

8

V. Fern´andez, E. Terlevich, A. I. D´ıaz, R. Terlevich

Figure 5. Scatter plot matrix for the 4t h test case with a complete model. The red crosses over the surface plots represent the true
values used to compute the synthetic ﬂuxes. This plot has been created using the corner library by Foreman-Mackey (2016).

theoretical model and the correlation between parameters
is the one expected. An exception, however, is the optical
depth τ. The surface plots in Fig.6 for this parameter im-
ply a sampling limited by a mathematical boundary rather
than a true ﬁtting. The reason behind these results can be
found in the available helium lines in the sample spectra. As
it was explained in F2018, due to a mismatch between our
data and the available Single Stellar Populations (SSP) syn-
thesis models wavelength range: only three HeI lines include
a correction for the underlying stellar population (HeIλ4471,
5876 and 6678˚A). These emission lines, however, are weakly

aﬀected by ﬂuorescence. As shown in Benjamin et al. (2002),
the correction kτ in eq.1 for the HeI6678˚A line accounts for
less than 0.4% even for the highest τ values. Therefore, it is
very hard to ﬁt τ in a parameter space, where the other di-
mensions have a much larger impact in the ﬁnal line ﬂux. Ac-
tually, the τ surface distributions in Fig.6 correspond to the
input prior in Table 1: a log-normal distribution with µ = 0
and σ = 0.4. Therefore, the optical depth cannot be mea-
sured from the provided observation inputs. Nevertheless,
the ﬂuorescence excitation is still being taken into account
for this parameter and the simulation behaves as a standard

MNRAS 000, 1–18 (2015)

A Bayesian direct method implementation

9

Figure 6. Scatter plot matrix for SHOC022. This plot has been created using the corner library by Foreman-Mackey (2016).

Monte Carlo algorithm for a user-declared parameter distri-
bution. This is an improvement from the helium abundance
analysis in F2018. The scatter plots for the complete HIIGs
sample can be found in the online support material.

Once the simulation convergence quality has been con-
ﬁrmed, the next step consists in evaluating the ﬁtting re-
sult. In a frequentist analysis this can be done via the χ2
test. This is the approach followed by Aver et al. (2015)
and references therein, where galaxies with χ2 < 5.5 are ex-
cluded from the YP regression. In the Bayesian paradigm,
there is not an universal estimator which can quantify the
ﬁtting quality. However, in this particular analysis an ef-

ﬁcient evaluation can be accomplished by comparing the
output ﬂux distribution with the input observed emission
ﬂuxes. This comparison can be found in the tables included
in the supporting online material. This information can also
be represented graphically and is shown in Fig.7: The ﬁt-
ted emission line ﬂux distributions are plotted from bluest
to reddest wavelength. The distributions are colour coded
according to the ion responsible for each transition. Each
plot cell includes the observed line ﬂux as a vertical line and
its uncertainty as a shaded area. These results correspond
to the initial ﬁtting of the object. In general, it can be ap-
preciated that the ﬂux distributions centre is very close to

MNRAS 000, 1–18 (2015)

10

V. Fern´andez, E. Terlevich, A. I. D´ıaz, R. Terlevich

case B recombination theoretical value. Consequently, this
line have been excluded in most objects ﬁtting except for
those with the higher redshift.

• HeI

lines: not all helium lines are ﬁtted with the
same precision. For example in SHOC022 the ﬁtted ﬂux
for HeIλ6678˚A is 6% above the observed value while the
HeIλ4471˚A and HeIλ5876˚A ﬂuxes disagree only by a 0.5%
and a 2% respectively. In the particular case of the helium
lines this behaviour can be explained by the absorption from
the underlying stellar population. As it was shown in Fig. 1,
each line is aﬀected diﬀerently by this eﬀect. Additionally,
in the SSP synthesis applied in F2018 the ﬁtted continuum
does not include the uncertainty. Consequently, our current
methodology cannot quantify which helium line absorptions
are better ﬁtted (as indeed was also the case in F2018). The
methodology presented in this paper, though, makes it much
easier to check which are the lines contributing more to the
helium abundance uncertainty.

• [OI I] λλ7319, 7330˚A lines: In order to include the re-
combination correction from Liu et al. (2001) our algorithm
takes as an input the integrated ﬂux from both lines even
though our spectral resolution can separate the [OI I] dou-
blet.

• [N I I] lines: Some of our objects show a broad Hα com-
ponent, that made diﬃcult the deblending of the narrow Hα
and [N I I] lines as explained in F2018. The observed ratio of
the [N I I] doublet lines diﬀer from the theoretical value for
some of the objects and large uncertainty was measured.
Since the [N I I] λ6548˚A line is almost three times weaker
than [N I I] λ6583˚A and therefore harder to deblend, it was
excluded in those ﬁttings were a large mismatch was found
in both lines ﬁttings.

• [SI I I] lines: Even though the [SI I I] λ6312˚A line is ﬁt-
ted with good precision, there is a small mismatch for the
infrared lines due to telluric contamination. As discussed
in F2018, even with the extra observations to calibrate
the sky features the ratio between the [SI I I] λ9069˚A and
[SI I I] λ9531˚A lines is within 5% of the expected value. Our
theoretical model, however, does not include the sky contri-
bution in the [SI I I] computation, hence the slight disagree-
ment between the observed ﬂuxes and the simulated ones.
Our analysis follows the same approach as in F2018: both
lines are included in the chemical analysis except in those
cases where the telluric calibration observations were not
available. For those objects, only the line less aﬀected by
the sky was used.

Once the discrepancies between the ﬂux distributions gener-
ated by the simulation and the observed line ﬂuxes have been
dealt with, we may proceed with the next phase: evaluating
the posterior distributions for the model parameters. This
provides an opportunity to compare the results with those
obtained classically. The results for SHOC022 are given in
Table A1 in the appendix. For the rest of the sample, the re-
sults are given online. In these tables, column 1 corresponds
to the parameter label, column 2 is the measurement pub-
lished in F2018, columns 3 and 4 are the trace mean and
standard deviation, columns 5, 6 and 7 are the 50th (me-
dian), 16th and 84th percentiles and column 8 is the per-
centage diﬀerence between the F2018 measurement and the
present one. The graphical simulations presented in section
4 are also available for each object. The one corresponding

MNRAS 000, 1–18 (2015)

Figure 7. Relative emission line ﬂux posteriors from the initial
ﬁtting of SHOC022. The output ﬂux distributions are plotted
from blue to red wavelength. The distributions are colour coded
according to the ion producing each feature. The vertical black
lines represent the observed emission ﬂuxes and the grey shaded
area their uncertainty. In colour in the electronic version.

the observed value and their width is representative of the
measurement uncertainty. There are, however, some ﬂux dis-
crepancies which require additional explanation:

• Hγ: The algorithm fails to ﬁt this emission line. The rea-
son can be found in the instrumental setup: For most objects
this line lies right at the low wavelength edge. Consequently,
the pixels belonging to this line have a greater noise, which is
not being propagated by our current reduction pipeline. This
was clearly observed during the c (H β) calculation in F2018,
where this line did not match the extinction calculated from
the comparison between the Hα to H β ﬂux ratio with the

A Bayesian direct method implementation

11

Table 3. Sample ﬁtting results. The values displayed correspond
to the mean and standard deviation for ne , the low and high
ionization region Te and the extinction coeﬃcient.

HII Galaxy
FTDTR-1
IZw18
MRK36-A1
MRK36-A2
MRK475
FTDTR-2
IZw70
MRK689
MRK67
FTDTR-3
SHOC022
FTDTR-4
FTDTR-5
FTDTR-6
FTDTR-7
MRK627
PHL293B
FTDTR-8
SHOC263
FTDTR-9
FTDTR-10

ne [SI I]
(cm−3)
42.1±20
31.1±20
30.4±20
64.1±27
36.5±19
39.5±22
38.4±20
41.8±20
70.5±31
45.7±19
37.0±20
45.0±20
146±86
45.9±20
133±18
44.2±21
113±27
49.7±22
233±60
145±48
582±80

Te [SI I I ]
(K)
14500±740
19000±1300
14900±610
13000±290
14100±390
-
11200±500
10300±390
12900±470
13000±430
11600±600
12400±590
-
12700±500
13300±350
10500±470
15600±640
-
-
11800±870
-

Te [OI I I ]
(K)
-
-
14700±780
15900±320
14600±320
13900±680
-
-
-
13000±320
12300±610
15100±310
13600±1600
13000±380
13900±210
11400±760
16600±230
13100±1500
11000±340
11800±740
16500±630

c(H β)
0.233±0.024
0.0567±0.019
0.0743±0.022
0.0516±0.019
0.0787±0.022
0.109±0.025
0.0873±0.023
0.266±0.028
0.238±0.027
0.101±0.023
0.123±0.026
0.186±0.024
0.122±0.027
0.181±0.025
0.289±0.023
0.151±0.027
0.225±0.027
0.151±0.029
0.0685±0.021
0.208±0.028
0.0850±0.023

Figure 8. Posterior distributions for the ﬁtting of SHOC022. The
vertical line in the right hand side histograms corresponds to the
parameter measurement published in F2018 using the traditional
chemical analysis. In colour in the electronic version.

to the ﬁnal ﬁtting of SHOC022 can be found in Fig. 8 where
the vertical line in the histograms corresponds to the param-
eter measurement in F2018 and the shaded area represents
its uncertainty. It can be easily noticed that the τ poste-
rior is actually the prior log-normal as previously discussed.
In general, however, most parameters agree well, within the
5%, with those from F2018. The following paragraphs dis-
cuss patterns encountered in most object ﬁttings:

• Tlow and Thigh: We have shown in F2018 that, when
one of the temperature diagnostic lines [OI I I] λ4363˚A or
[SI I I] λ6312˚A had larger uncertainty than the other, it was
excluded from the analysis and the corresponding temper-
ature was calculated using eq. 3. In order to duplicate the
same procedure here, two actions were necessary. First to re-
place the corresponding prior by eq. 3. However, as discussed
in section 4 second test case, once eq. 3 is added to the sim-
ulation both auroral lines, and their uncertainty, dominate
the temperature ﬁtting. Therefore, as done in F2018, the
second step consisted in excluding that line from the ﬁtting.
• ne [SI I]: In many objects there is a perfect match be-
tween the new ne [SI I] value and the one published in F2018.
This is expected since the density prior is well constrained
from the density measured via the [SI I] λλ6717,6731˚A ra-
tio. In some cases, including SHOC022 in Fig. 8, we obtain
lower densities (e.g. ne [SI I] = 37 cm−3 vs ne [SI I] = 50 cm−3

MNRAS 000, 1–18 (2015)

in F2018 37% smaller in this case). As it was described in
F2018 the reported density values in cases were ne [SI I] <
75 cm−3 the density applied in the chemical analysis was
ne [SI I] = 50 ± 25 cm−3. Therefore these results are consis-
tent with those previously published.

• c (H β): We found that for some objects the extinction
measured via the current algorithm was higher and with
a greater uncertainty than those in F2018. In particular,
MRK475 and PHL293,with very low extinction values in
F2018 (cH β ≈ 0.01) the new extinction coeﬃcient measure-
ments are one order of magnitude larger. There are several
reasons why this should be the case: to start with, in the
current analysis there are thirteen additional parameters in
the ﬁtting. Secondly, while in the traditional methodology
H β and Hα dominate the c (H β) calculation, in the current
algorithm all emission lines are contributing to its measure-
ment. In this study, the number of collisionally excited lines
is greater than the recombination ones. Consequently, they
weight heavily in the extinction determination. Neverthe-
less, as long as the simulated line ﬂuxes match the observed
ones it can be concluded that the new value quantiﬁes the
extinction adequately.

• Ar+3: This ion abundance measurement depends exclu-
sively on the [Ar IV] λ4741˚A observation. This is a weak line
even when compared with the helium ones. In the extreme
case of I Zw18, the uncertainty for this line is above 20% of
the observed ﬂux. Due to these issues the sampler had prob-
lems to ﬁt the Ar3+ abundance in this galaxy. Consequently,
the prior for this parameter was changed from the one in
Table 1 to a normal distribution with µ = 4.5 and σ = 0.5.
This prior provided a more informative sampling improving
the ﬁtting for this parameter.

12

V. Fern´andez, E. Terlevich, A. I. D´ıaz, R. Terlevich

Table 4. Helium, oxygen, and nitrogen ionic abundances.

HII Galaxy

FTDTR-1
IZw18
MRK36-A1
MRK36-A2
MRK475
FTDTR-2
IZw70
MRK689
MRK67
FTDTR-3
SHOC022
FTDTR-4
FTDTR-5
FTDTR-6
FTDTR-7
MRK627
PHL293B
FTDTR-8
SHOC263
FTDTR-9
FTDTR-10

+

H e

+/H
0.0975±0.0018
0.0752±0.0018
0.0767±0.0018
0.0784±0.0015
0.0821±0.0018
0.0750±0.0022
0.0939±0.0020
0.0795±0.0018
0.0836±0.0020
0.0833±0.0019
0.0833±0.0020
0.0865±0.0017
0.0764±0.0040
0.0821±0.0017
0.0840±0.0015
0.0869±0.0022
0.0669±0.0018
0.0737±0.0035
0.0874±0.0042
0.0876±0.0032
0.0736±0.0031

+

H e2+/H
0.00117±0.00017
0.000527±0.00
0.00180±0.00013
0.00124±0.00
0.00171±0.00
0.000963±0.00024
0.000570±0.00014
-
0.000964±0.00
-
0.00134±0.00014
0.000744±0.00
-
0.000884±0.00
0.000407±0.00
-
0.00174±0.00017
-
-
0.00160±0.00013
0.000976±0.00014

+(cid:1)

12 + log (cid:0)O

+/H
7.22±0.11
6.59±0.11
7.27±0.084
7.60±0.052
7.28±0.062
-
7.99±0.11
8.24±0.10
7.63±0.083
7.33±0.077
7.83±0.13
7.73±0.11
-
7.58±0.094
7.39±0.062
8.16±0.12
6.89±0.086
7.30±0.27
8.04±0.093
7.82±0.18
6.98±0.095

12 + log

(cid:16)

O2+/H
7.72±0.060
7.00±0.065
7.72±0.060
7.66±0.025
7.79±0.028
7.84±0.061
7.96±0.066
8.19±0.060
7.95±0.048
8.09±0.032
7.94±0.065
7.82±0.025
8.04±0.10
7.96±0.038
8.03±0.021
8.00±0.094
7.62±0.019
7.85±0.040
8.01±0.047
8.01±0.086
7.53±0.046

+(cid:17)

+(cid:1)

12 + log (cid:0) N

+/H
5.31±0.056
4.79±0.057
5.56±0.048
5.68±0.039
5.68±0.042
5.53±0.059
6.37±0.050
6.28±0.047
5.84±0.049
5.59±0.046
6.21±0.057
6.00±0.050
-
5.76±0.051
5.69±0.029
6.52±0.053
-
5.32±0.16
6.59±0.045
6.21±0.080
5.84±0.048

Table 5. Sulphur and argon ionic abundances

HII Galaxy

FTDTR-1
IZw18
MRK36-A1
MRK36-A2
MRK475
FTDTR-2
IZw70
MRK689
MRK67
FTDTR-3
SHOC022
FTDTR-4
FTDTR-5
FTDTR-6
FTDTR-7
MRK627
PHL293B
FTDTR-8
SHOC263
FTDTR-9
FTDTR-10

+(cid:1)

12 + log (cid:0)S

+/H
5.15±0.046
4.70±0.048
5.32±0.036
5.43±0.024
5.38±0.027
5.26±0.047
5.87±0.048
5.92±0.045
5.51±0.037
5.21±0.034
5.74±0.054
5.61±0.048
5.25±0.11
5.41±0.040
5.27±0.028
5.96±0.051
4.96±0.036
5.27±0.11
5.96±0.036
5.70±0.076
5.39±0.038

5.1 Comparison between methods

12 + log

(cid:16)

S2+/H
5.83±0.046
5.15±0.047
5.98±0.037
6.16±0.026
6.13±0.030
5.98±0.043
6.36±0.046
6.55±0.044
6.17±0.039
6.14±0.035
6.40±0.052
6.22±0.046
6.01±0.098
6.27±0.040
6.08±0.030
6.53±0.049
5.73±0.039
6.00±0.10
6.56±0.043
6.47±0.070
6.07±0.034

+(cid:17)

(cid:16)

ICF

S3+(cid:17)
1.93±0.10
1.19±0.041
1.22±0.045
1.17±0.018
1.15±0.021
1.53±0.098
-
-
1.28±0.045
1.93±0.086
-
1.15±0.024
1.88±0.35
1.23±0.039
1.70±0.050
-
1.60±0.10
1.90±0.24
-
-
-

12 + log

(cid:16)

Ar 2+/H

+(cid:17)

12 + log

(cid:16)

Ar 3+/H

+(cid:17)

5.13±0.052
4.59±0.057
5.38±0.036
5.49±0.024
5.51±0.028
5.31±0.056
5.73±0.048
5.78±0.045
5.60±0.038
5.51±0.034
5.69±0.055
5.58±0.048
5.37±0.12
5.60±0.040
5.44±0.028
5.83±0.053
5.14±0.037
5.41±0.11
5.81±0.036
5.66±0.081
5.26±0.043

5.14±0.074
3.85±0.12
4.66±0.098
4.64±0.049
4.57±0.068
5.02±0.11
-
-
5.00±0.095
5.48±0.033
-
4.67±0.066
5.30±0.17
4.88±0.076
5.28±0.023
-
4.91±0.082
5.38±0.078
-
-
-

The ﬁtting results for the complete sample are tabulated
as follows: the electron density (ne [SI I]), the low and high
ionisation temperatures and the logarithmic extinction coef-
ﬁcient at H β are shown in columns 2, 3, 4 and 5 in Table 3.
The optical depth, deﬁned as the mean value from the prior
distribution, was found to be τ ≈ 1.05 for most objects.
Table 4 includes the y+ and y2+ abundances in columns 2
and 3, the oxygen abundances, columns 4 and 5 and nitro-
gen N+abundance in column 6. Table 5 displays the sulfur
ionic abundances in columns 2 and 3 and the argon ionic
abundances in columns 5 and 6. The ICF
is shown
in Column 4 and was obtained following F2018, calculated
via the S2+, Ar2+, Ar3+ abundances. Finally, Table 6 dis-

S3+(cid:17)

(cid:16)

plays the element abundances: column 2 corresponds to the
helium abundance while columns 3 and 4 correspond to the
helium mass fractions computed using the oxygen and sulfur
abundances respectively. columns 5, 6 and 7 are the oxygen,
nitrogen and sulfur abundances as 12 + log (X). We calculate
the total abundances as in F2018, by adding the ionic abun-
dances for each element using the traces as in a standard
Monte Carlo.

In general, these measurements agree very well with
the ones published in F2018. The diﬀerences between both
methods is below 3% for most parameters except ne and
c (H β) as discussed above. A special case is the galaxy
PHL293B. The comparison between the simulation ﬂuxes
and the observed ones is as good as for the rest of the sam-

MNRAS 000, 1–18 (2015)

A Bayesian direct method implementation

13

Table 6. Element abundances and helium mass fractions using either oxygen YO/H or sulphur YS/H .

HII Galaxy
FTDTR-1
IZw18
MRK36-A1
MRK36-A2
MRK475
FTDTR-2
IZw70
MRK689
MRK67
FTDTR-3
SHOC022
FTDTR-4
FTDTR-5
FTDTR-6
FTDTR-7
MRK627
PHL293B
FTDTR-8
SHOC263
FTDTR-9
FTDTR-10

H e/H
0.0987±0.0018
0.0757±0.0018
0.0785±0.0018
0.0796±0.0015
0.0838±0.0018
0.0760±0.0022
0.0944±0.0021
0.0795±0.0018
0.0846±0.0020
0.0833±0.0019
0.0846±0.0020
0.0873±0.0017
0.0764±0.0040
0.0830±0.0017
0.0844±0.0015
0.0869±0.0022
0.0687±0.0018
0.0737±0.0035
0.0874±0.0042
0.0892±0.0032
0.0746±0.0031

Y(O/H )
0.283±0.0037
0.232±0.0042
0.239±0.0041
0.241±0.0035
0.251±0.0040
-
0.273±0.0044
0.240±0.0042
0.252±0.0043
0.249±0.0042
0.252±0.0044
0.258±0.0038
-
0.248±0.0039
0.252±0.0033
0.257±0.0048
0.215±0.0044
0.227±0.0084
0.258±0.0092
0.262±0.0070
0.229±0.0072

Y(S/H )
0.283±0.0037
0.232±0.0042
0.239±0.0041
0.242±0.0035
0.251±0.0040
0.233±0.0052
0.274±0.0043
0.241±0.0042
0.253±0.0044
0.250±0.0042
0.253±0.0044
0.259±0.0038
0.234±0.0093
0.249±0.0039
0.252±0.0034
0.258±0.0048
0.215±0.0044
0.228±0.0084
0.259±0.0092
0.263±0.0070
0.230±0.0073

12 + log (O/H)
7.84±0.070
7.15±0.077
7.85±0.050
7.93±0.029
7.91±0.027
-
8.27±0.090
8.51±0.082
8.12±0.059
8.16±0.031
8.19±0.069
8.08±0.053
-
8.12±0.040
8.12±0.021
8.39±0.085
7.70±0.022
7.97±0.082
8.32±0.068
8.23±0.095
7.64±0.053

12 + log (N/H)
5.93±0.041
5.35±0.038
6.15±0.063
6.01±0.035
6.31±0.045
-
6.65±0.032
6.56±0.029
6.33±0.037
6.41±0.053
6.57±0.043
6.36±0.024
-
6.30±0.051
6.42±0.031
6.75±0.045
-
6.00±0.16
6.88±0.042
6.63±0.069
6.50±0.057

12 + log (S/H)
6.20±0.056
5.36±0.049
6.15±0.035
6.30±0.024
6.26±0.028
6.24±0.055
6.48±0.046
6.64±0.044
6.36±0.043
6.47±0.027
6.49±0.052
6.37±0.042
6.35±0.091
6.41±0.037
6.37±0.023
6.63±0.049
6.00±0.038
6.35±0.071
6.65±0.040
6.54±0.071
6.15±0.034

ple. The parameter ﬁttings, however, disagree considerably
from those in F2018. The measured electron temperatures
are 10% and 5% above the F2018 values for Te [SI I I] and
Te [OI I I] respectively and the c (H β) magnitude increased
from 0.01 to 0.23 once all the lines are taken in consideration.
Terlevich et al. (2014) presented WHT-ISIS and X-shooter
spectra to study the broad (FW H M = 1000 km/s) and very
broad (FW H M = 4000 km/s) components, as well as the blue
shifted and absorption components in H β for this object.
Reviewing observations for this galaxy from 2005-2013 they
concluded that this uncommon emission must be caused by
the young ionising cluster wind. In a forthcoming paper we
will try to adapt the emission model to better ﬁt this ob-
ject’s complex structure. FTDTR-10 also shows some dis-
agreement with the helium abundance previously measured.
In order to understand this discrepancy, it will be necessary
to repeat the chemical analysis using published spectra from
other sources such as the SDSS. For this paper, however, we
exclude these galaxies from the YP − Z regressions. The sim-
ulation results for these HIIGs are also available online.

The methodology applied in this paper presents the ad-
vantage of being able to include (or exclude) lines very easily
and to quantify their impact on the target abundances. This
includes the chlorine and neon abundances not measured in
the current study. As discussed in section 4, this algorithm
computes ionic transition emissivity via the traditional ap-
proach: parameterised equations as a function of the elec-
tron density and temperature. In contrast, the treatment in
F2018 consisted in a bilinear interpolation in a very ﬁne grid
generated with PyNeb for each transition. For the hydro-
gen and metals considered both approaches provide results
which agree within 1% for the complete temperature and
density domains considered. This is not the case for helium,
that depends on temperature and density in a remarkably
more complex manner. Some of the parametric equations
considered for the Porter et al. (2012) recombination coeﬃ-
cients include those from Porter et al. (2007), Olive & Skill-
man (2004) and P´erez-Montero (2017). None of them guar-

MNRAS 000, 1–18 (2015)

antee a precision better than 1% for the region of interest.
In order to improve the ﬁtting, three temperature domains
were considered: the 8000 K − 12000 K, 12000 K − 15000K and
15000K − 22000K ranges. Even with this treatment, however,
the discrepancy for some HeI emissivities goes up to 5% at
uneven Te and ne intervals. The ideal solution consists of
introducing a bilinear interpolation for the emissivity calcu-
lation. Such an approach has been implemented by Foreman-
Mackey et al. (2019) in the exoplanet library. This will be
the approach to follow in the next algorithm iteration.

The simultaneous ﬁtting of all the emission line ﬂuxes
provides a more realistic analysis on how each one behaves.
In general, the helium lines were more likely to display a
missmatch with their expected ﬂux values than those from
the oxygen or sulfur ions. As explained in section 2 the
ﬂux absorption from the underlying stellar population varies
with wavelength. This is a plausible cause for the disagree-
ment in the HeI lines. A large discrepancy between the HeI
lines was observed in the two starforming regions in M RK36.
This galaxy is the only one in our sample where two bursts
were observed within the same slit. It is possible that some
cross talk in the spectra extraction is contributing to the
mismatch between the helium lines measurement. Addition-
ally, the scheme applied in F2018 to ﬁt the HIIGs continua
does propagate the uncertainty introduced in the HeI lines
intensity. Therefore, the current algorithm does not quantify
which recombination lines are more contaminated by the un-
derlying stellar continua. There are additionally processes
contributing to the individual temperatures. For example,
the HeIλ5876˚A intensity may be contaminated by the NaI
D1 and D2 lines. Finally, a ﬂuorescence contribution could
not be properly ﬁtted by the available HeI lines. These is-
sues, however, are also aﬀecting the F2018 and therefore the
present y and y2+ measurements agree very well with those
published in F2018.

To the best of our knowledge, this is the ﬁrst algo-
rithm capable of ﬁtting both the recombination and colli-
sionally excited line spectra in a parameter space including

14

V. Fern´andez, E. Terlevich, A. I. D´ıaz, R. Terlevich

Table 7. Comparison between the synthetic test case published in
Aver et al. (2015) and one ﬁtted with our algorithm. The metal
emission parameters have been excluded from this comparison
since they are not ﬁtted by those authors methodology. Similarly,
the absorption on the hydrogen and helium lines are not included
since they are not ﬁtted by our algorithm.

Parameter True value Aver et al (2015)

y+
y2+
ne (He)
τ (HeI)
Te (He)
c(H β)
×104(cid:17)
(cid:16)

ξ

0.085
0.00088
500.0
1.0
16000.0
0.10

1.0

0.0858 ± 0.0027
(cid:55)
473 ± 67
0.78 ± 0.31
17320 ± 1090
0.09 ± 0.03
13+19
+13

Current work
0.0851 ± 0.0009
0.00088 ± 0.00002
487 ± 34
0.95 ± 0.18
16311 ± 824
0.106 ± 0.015
(cid:55)

the electron density and temperature. There exist, however,
many multi-dimensional chemical samplers based on strong
lines. An example of these libraries are HII-CHI-MISTRY
by P´erez-Montero (2014), IZI by Blanc et al. (2014), BOND
by Vale Asari et al. (2016) or GAME by Ucci et al. (2018).
Unlike the algorithm presented here, these tools ﬁt the input
ﬂuxes from photoionisation model grids rather than a direct
computation. These techniques provide their own advan-
tages. For example, they make possible the chemical analy-
sis of high redshift objects, they allow the modelling of more
complex temperature and density structures or can help to
solve the double value nature of some strong line diagnostics.
There is a lot to be learned from the techniques applied by
these tools to explore photoionisation grids. However, due
to the high precision needed for determining YP, strong line
methods are not suitable for this work. The strong line di-
agnostic strategy will be explored in future developments
of this algorithm. For example, instead of using the ﬂuores-
cence correction from Benjamin et al. (2002), the algorithm
could derive a better correction from photoionisation grids
tailored for each object. Currently, the closest analogues to
our algorithm are found in studies to determine YP.

(cid:0)He+(cid:1), Te

Izotov & Thuan (2004) and Izotov et al. (2007, 2013)
and references therein developed a self-consistent helium
abundance determination method. This scheme consists in
a Monte Carlo process chain to account for the systematic
eﬀects on the HeI lines. Izotov and colleagues vary stochas-
(cid:0)He+(cid:1) and τ (3889) over a range of
tically the Ne
expected values to compute y+. Afterwards, the best solution
for the helium abundance is ﬁtted via a χ2test. Each emis-
sion line is assigned a diﬀerent underlying stellar absorption
and the helium lines are included in the χ2 minimisation.
The methodology introduced by Olive & Skillman (2001)
and Olive & Skillman (2004) and later enhanced in Aver
(2012); Aver et al. (2013) and references therein, also follows
a frequentist paradigm applied to Izotov and collaborators
data. Their algorithm ﬁts the nine dimensions space simul-
taneously via a MCMC sampler. Both authors, however, em-
phasize how the χ2 ﬁtting quality depends on the available
HeI lines sensitivity to model parameters. For example, the
data in Izotov et al. (2014) reaches the HeIλ10830˚A line
which, unlike most recombination features, is very sensitive
to the electron density. Aver et al. (2015) concluded after
using these observations in their algorithm, that the uncer-
tainty in YP decreased by more than 50%.

As a ﬁnal quality check, we may compare our results

with the ones by Aver et al. (2015). This can be easily done
by adding two additional dimensions to the model: Te (He)
and ne (He). These are the electron temperature and density
contributing exclusively to the HeI and HeI I emissivity. In
this 5th test case, the HeIλ3889 and 10830˚A lines have been
included in the analysis in order to make the simulations as
similar as possible to each other. Table 7 compares the re-
sults from the synthetic test case in Aver et al. (2015) with
the one solved using our HMC algorithm. This table does
not include the metals electron density and temperatures
nor the ionic abundances contributing to the collisionally
excited lines since Aver et al. (2015) does not include them.
Similarly, the absorption on hydrogen (aH ) and helium (aH e)
are not tabulated since our algorithm does not cover them.
Once this is done, the number of parameters for the recom-
bination lines is very similar: the algorithm from Aver and
collaborators includes a correction for collisional excitation
on the hydrogen lines, which our current model does not.
This correction consists in a parametrisation by Anderson
et al. (2000) and Anderson et al. (2002), which depends on
Te and the ratio of neutral to ionized hydrogen atoms, ξ. On
the other hand, our algorithm includes the y2+ abundance
which is measured from the HeI I4686˚A line. We conclude
from the results that both methods have similar accuracy
and precision. The precision on the helium temperature and
density is not as good as for the collisionally excited lines.
This is expected due to the low sensitivity of the recombi-
nation lines to these parameters. Indeed this is the reason
why the helium abundance is measured to such a good accu-
racy despite the relatively large uncertainty on the electron
temperature. This is, though, not good enough for the pri-
mordial helium abundance determination, where ideally one
would like to reach accuracies better than 1%. A more suit-
able prior for the helium temperature could be designed by
modelling the T (He) priors from the available Te [SI I I] or
Te [OI I I] as it was done by Peimbert & Peimbert (2002).
Additionally, the width in this temperature prior could also
be added as a model dimension. This would provide a quan-
tiﬁcation of the temperature ﬂuctuations, and thus, a direct
comparison with the YP regression by Peimbert et al. (2017).

5.2 YP regression

The helium mass fractions displayed in Table 6 were cal-
culated using the same procedure as in F2018. In sum-
mary,
for the oxygen and nitrogen YP regressions, the
YP, O = f (HeI/H, O/H) formulation from Peimbert & Torres-
Peimbert (1974) and Lequeux et al. (1979) was applied. For
the regression with sulfur the classical relation was modiﬁed
to:

YP, S =

(cid:16)

4 He
H

1 − 20 · O
S

S
H

(cid:17)

1 + 4 He
H

(4)

where the O/S ratio is computed from the sulfur to oxy-
gen relation from the low metallicity BCDs (Blue Com-
pact Dwarfs) sample published by Dors Jr. et al. (2016):
log (S/O) = −1.53 ± 0.03. As it was done in F2018 the YP, O
value is used in the Y − N regression since the oxygen abun-
dance is necessary to compute the nitrogen one. A Monte
Carlo algorithm described in F2018 was used to perform the

MNRAS 000, 1–18 (2015)

A Bayesian direct method implementation

15

Table 8. Primordial helium abundance determinations from all
the linear regression combinations and comparison with the liter-
ature.

P, O

Element regression
YP, O
YP, N
YP, S
YP, O−N −S
Y 1
Y 1
Y 1
Y 1
Y 2
Y 3
Y 4
Y 5

P, O−N −S

P, Pl a nc k B B N

P, O

P, O

P, O

P, N

P, S

Value
0.241 ± 0.004
0.244 ± 0.003
0.240 ± 0.004
0.243 ± 0.005
0.246 ± 0.005
0.251 ± 0.005
0.244 ± 0.006
0.245 ± 0.007

0.2446 ± 0.0029
0.2449 ± 0.0040
0.2551 ± 0.0022
0.24467 ± 0.0002

Number of objects
16
17
19
16

18
18
21
17

5
15
28
-

[1] F2018 [2] Peimbert et al. (2016) [3] Aver et al. (2015) [4]
Izotov et al. (2014) [5] Planck Collaboration et al. (2018b) (This
value represents an upper limit from the four ΛCD M parameter
conﬁgurations presented by the authors)

new methodology can complete a full direct method chem-
ical analysis. Since the new scheme ﬁts all the ionic species
simultaneously we take the YP, O−N −S determination as the
preferred one:

YP, O−N −S = 0.243 ± 0.005

This result is consistent with the determinations from the
Planck experiment in a framework provided by a standard
Big Bang cosmology.

6 CONCLUSIONS

The nebular abundances computed using the traditional di-
rect method are compared with those from a new Bayesian
algorithm which simultaneously ﬁts a 14 parameters chemi-
cal model. The emission line ﬂuxes belong to the 21 HIIGs
sample presented in F2018 where the recombination lines
have been corrected by the underlying stellar population.
The model parameters are one electron density, two electron
temperatures (for the low and high ionization species), the
logarithmic extinction coeﬃcient at H β, the optical depth
for the HeI transitions and nine ionic abundances: Ar2+,
Ar3+, y+, y2+, O+, O2+, N+, S+ and S2+. The sampling of
this relatively big parameter space was successful thanks to
machine learning tools. The new HMC sampling shortens
the simulation length from several hours to a couple of min-
utes while providing a stable convergence in contrast to the
better known MCMC samplers. The main conclusions from
this analysis are:

• The direct method was adapted to a Bayesian paradigm
by a careful design for the model parameter priors. Unin-
formative (wide) probability distributions were successfully
applied for the electron temperatures, the ionic abundances
and the extinction coeﬃcients. In contrast, informative pri-
ors were necessary for the electron density and the optical
depth. For ne this was necessary due to the fact that for these

Figure 9. Primordial helium linear regressions using oxygen, ni-
trogen and sulfur as metallicity tracer.

Y −O, Y − N and Y − S regressions, as well as the multivariable
regression using the three metals.

Fig.9 shows the regressions using oxygen, nitrogen and
sulfur. The results from the linear ﬁtting are listed in Ta-
ble 8. The ﬁrst four rows correspond to the primordial
helium abundance computations using the chemical abun-
dances from the Bayesian algorithm. The following four rows
correspond to the values published in F2018 using the tra-
ditional methodology. In the ﬁnal rows in Table 8 we re-
produce recent YP determinations from the literature. It can
be concluded from this comparison that the YP determina-
tions from both methodologies agree within their uncertain-
ties. The largest disagreement may be found in the YP, N
measurement. This could be due to having excluded the
[N I I] λ6548˚A line in some of the objects due to discrepancies
with the observed values. The current YP, N result is closer
to the oxygen and sulfur regressions than the one given in
F2018. Slightly lower values for YP, O and YP, S can be ap-
preciated also. This can be explained by the helium emissiv-
ity computation as discussed previously. Nevertheless, the
results match very well those from the traditional determi-
nations. Noticeably, the uncertainty has decreased for all
the YP determinations. This is a remarkable achievement,
specially once it is considered how quickly and cleanly the

MNRAS 000, 1–18 (2015)

16

V. Fern´andez, E. Terlevich, A. I. D´ıaz, R. Terlevich

low density HIIGs sample (below the low density limit) none
of the available collisionally excited ratios are good diagnos-
tic tools. On the other hand, The HeI lines available in our
data are weakly aﬀected by the ﬂuorescence excitation. Con-
sequently, the optical depth which parametrises it could not
be ﬁtted in these observations. We still took it into consider-
ation while calculating the HeI ﬂuxes as if it were a standard
Monte Carlo simulation.

• A set of synthetic test cases with increasing number
of model parameters are presented to conﬁrm the accuracy
and precision of the sampler. Once the algorithm is applied
on real observations the behaviour and correlation observed
on the parameters remain constant. An issue, however, was
encountered during the ﬁtting of real observations due to the
high precision in the strong lines such as [OI I I] λ5007˚A and
Hα. A minimum accuracy of 2% was imposed in the observed
ﬂuxes. The precision in the results is as good, though, as the
one expected from these high quality observations.

• In order to test the success of the simulation, we propose
a graphical comparison between the input ﬂuxes and the out-
put ﬂux distributions from the ﬁtting. We found in general
a very good match between the two. Some objects, however,
displayed a sizeable mismatch in the Hγ and [N I I] λ6548˚A
ﬂuxes which can be explained by technical constraints in the
observations. In those cases, the lines were excluded from the
ﬁtting.

• In general, we obtain a very good match with the abun-
dances published in F2018. Nevertheless, the new values for
the logarithmic extinction coeﬃcient were higher for some
objects and with a consistent larger uncertainty. This can be
explained by the diﬀerence in procedure: while in the tradi-
tional methodology only Hα and H β end up contributing to
the c (H β) calculation in this new analysis all the lines are.
In spite of this, the abundances obtained are similar, as the
extinction for these objects is relatively small.

• An additional synthetic test case was presented in or-
der to reproduce the test case in Aver et al. (2015). The
T e (He) and ne (He) are added as additional parameters in
the HeI and HeI I ﬂuxes calculation. Despite the diﬀerence in
mathematical and computational schemes our algorithm can
replicate the accuracy and precision in the measurement of
the parameters in common. It is argued, however, that given
the low dependency of the recombination lines on electron
temperature and density, the input prior design may have
a larger weight in the ﬁtting results. In the near future we
plan to explore new observations and theoretical models to
better constrain the Te (He) and ne (He) measurement.

• The primordial helium abundance measurement from
the new chemical abundances is in good agreement with
those in F2018. The biggest disagreement was found for
the Y − N regression which resulted in a lower YP, N value
obtained in the present work. This is a consequence of
the excluded [N I I] λ6548˚A lines due to a mismatch with
the model ﬂuxes. The present result, however, is in good
agreement with YP, O and YP, S. Since this technique ﬁts
all the ionic abundances simultaneously, we take the mul-
tivariable linear regression as our chosen measurement giv-
ing YP, O−N −S = 0.243 ± 0.005. This result is consistent with
Standard Big Bang Nucleosynthesis.

lows to increase the complexity of the theoretical model. In
future work, we will focus in including third party data grids
during the sampling process. This will improve the emissiv-
ity computation for the helium lines which was one of the
challenges found in this paper. Finally, we hope to include
the continua computation in the ﬁtting. This task has two
purposes: a better quantiﬁcation of the stellar continuum
absorption on the helium lines and a better estimation of
T (He) via the nebular continuum jumps. The algorithms
developed in this work are not yet available in the standard
python distribution channels. However, all the scripts can be
found at the following github account until they are properly
published (https://github.com/Vital-Fernandez).

ACKNOWLEDGEMENTS

Vital Fern´andez is indebted to Enrique P´erez and Daniel
Miralles for their generous discussions on the nebular and
stellar continua determination, respectively. Similarly, he is
grateful to Erick Aver for his prompt replies on the physical
and computational characteristics of his helium abundance
determination algorithm.

We are indebted to an anonymous referee whose de-
tailed comments contributed to the improvement of the pa-
per.

This work could not have been accomplished without
the work and generosity from the PyMC3 development team.
V. F. also expresses his gratitude to Dan Foreman-Mackey
for his insight on how to use data science algorithms in as-
tronomical research.

We thank the Spanish allocation committee (CAT) for
awarding observing time and the cheerful technical support
from the observatory personnel. Vital Fern´andez is grate-
ful to the Mexican research Council (CONACYT) for sup-
porting this research through studentship 554031/300844
and Elena and Roberto Terlevich acknowledge CONA-
CYT for research grant CB-2008-103365. This work has
been supported by DGICYT grants AYA2013-47742-C4-3-P
and AYA2016-79724-C4-1-P. Partial ﬁnancial support came
also from project SELGIFS: PIRSES-GA- 2013-612701-
SELGIFS. Vital Fern´andez and Elena and Roberto Terlevich
are grateful to the hospitality of the Departamento de F´ısica
Te´orica at the Universidad Aut´onoma de Madrid, Spain dur-
ing a visit to advance with this study.

Funding for the creation and distribution of the SDSS
Archive has been provided by the Alfred P. Sloan Founda-
tion, the Participating Institutions, the National Aeronau-
tics and Space Administration, the National Science Foun-
dation, the US Department of Energy, the Japanese Mon-
bukagakusho and the Max Planck Society. The SDSS Web
site is http://www.sdss.org.

This research has made use of the NASA/IPAC Ex-
tragalactic Database (NED) which is operated by the Jet
Propulsion Laboratory California Institute of Technology,
under contract with the National Aeronautics and Space
Administration.

REFERENCES

We obtain in general lower uncertainties than we did with
the classical direct method. This new chemical analysis al-

Aggarwal K. M., Keenan F. P., 2000, VizieR Online Data Catalog,

212

MNRAS 000, 1–18 (2015)

A Bayesian direct method implementation

17

Anderson H., Ballance C. P., Badnell N. R., Summers H. P., 2000,
Journal of Physics B: Atomic, Molecular and Optical Physics,
33, 1255

Anderson H., Ballance C. P., Badnell N. R., Summers H. P., 2002,
Journal of Physics B: Atomic, Molecular and Optical Physics,
35, 1613

Aver E., 2012, PhD thesis, University of Minnesota
Aver E., Olive K. A., Skillman E. D., 2011, Journal of Cosmology

Nebulae and Active Galactic Nuclei, edici´on: 2nd ed. edn.
Palgrave Macmillan, Sausalito, Calif.
Pattie R. W., et al., 2018, Science, 360, 627
Peimbert A., Peimbert M., 2002, in Revista Mexicana de Astrono-

mia y Astroﬁsica Conference Series. pp 250–250

Peimbert A., Peimbert M., 2011, Proceedings of the International

Astronomical Union, 7, 466

Peimbert M., Torres-Peimbert S., 1974, The Astrophysical Jour-

and Astroparticle Physics, 2011, 043

nal, 193, 327

Aver E., Olive K. A., Porter R. L., Skillman E. D., 2013, Journal

Peimbert A., Peimbert M., Luridiana V., 2016, arXiv:1608.02062

of Cosmology and Astro-Particle Physics, 2013, 017

[astro-ph]

Aver E., Olive K. A., Skillman E. D., 2015, arXiv:1503.08146

[astro-ph]

Benjamin R. A., Skillman E. D., Smits D. P., 2002, The Astro-

physical Journal, 569, 288

Peimbert M., Peimbert A., Delgado-Inglada G., 2017, Publica-
tions of the Astronomical Society of the Paciﬁc, 129, 082001

P´erez-Montero E., 2014, SciRate
P´erez-Montero E., 2017, Publications of the Astronomical Society

Blanc G. A., Kewley L., Vogt F. P. A., Dopita M. A., 2014, The

of the Paciﬁc, 129, 043001

Astrophysical Journal, 798, 99

Carswell R. F., Rauch M., Weymann R. J., Cooke A. J., Webb
J. K., 1994, Monthly Notices of the Royal Astronomical Soci-
ety, 268, L1

Cooke R. J., Fumagalli M., 2018, Nature Astronomy, p. 139
Dors Jr. O. L., Perez-Montero E., Hagele G. F., Cardaci M. V.,

Pisanti O., Cirillo A., Esposito S., Iocco F., Mangano G., Miele
G., Serpico P. D., 2008, Computer Physics Communications,
178, 956

Planck Collaboration et

al.,

2018a,

arXiv

e-prints, p.

arXiv:1807.06205

Planck Collaboration et

al.,

2018b,

arXiv

e-prints, p.

Krabbe A. C., 2016, arXiv:1601.01520 [astro-ph]

arXiv:1807.06209

Dufton P. L., Hibbert A., Kingston A. E., Doschek G. A., 1982,

Podobedova L. I., Kelleher D. E., Wiese W. L., 2009, Journal of

The Astrophysical Journal, 257, 338

Fern´andez V., Terlevich E., D´ıaz A. I., Terlevich R., Rosales-
Ortega F. F., 2018, Monthly Notices of the Royal Astronom-
ical Society, 478, 5301

Foreman-Mackey D., 2016, The Journal of Open Source Software,

24

Foreman-Mackey D., Barentsen G., Barclay T., 2019, Exoplanet

v0.1.4, https://doi.org/10.5281/zenodo.2561395

Galavis M. E., Mendoza C., Zeippen C. J., 1995, Astronomy and

Astrophysics Supplement Series, 111, 347

Galav´ıs Galav´ıs M. E., Mendoza C., Zeippen C. J., 1997, Astron-

omy and Astrophysics Supplement Series, 123, 13

Physical and Chemical Reference Data, 38, 171

Porter R. L., Ferland G. J., MacAdam K. B., 2007, The Astro-

physical Journal, 657, 327

Porter R. L., Ferland G. J., Storey P. J., Detisch M. J., 2012,
Monthly Notices of the Royal Astronomical Society, 425, L28
Porter R. L., Ferland G. J., Storey P. J., Detisch M. J., 2013,
Monthly Notices of the Royal Astronomical Society: Letters,
433, L89

Pradhan A. K., Montenegro M., Nahar S. N., Eissner W., 2006,
Monthly Notices of the Royal Astronomical Society: Letters,
366, L6

Ramsbottom C. A., Bell K. L., 1997, Atomic Data and Nuclear

Gordon K. D., Clayton G. C., Misselt K. A., Landolt A. U., Wolﬀ

Data Tables, 66, 65

M. J., 2003, The Astrophysical Journal, 594, 279

Reines A. E., Nidever D. L., Whelan D. G., Johnson K. E., 2009,

Hoﬀman M. D., Gelman A., 2011, arXiv:1111.4246 [cs, stat]
Hudson C. E., Ramsbottom C. A., Scott M. P., 2012, The Astro-

arXiv:0911.0447 [astro-ph]

Salvatier J., Wiecki T. V., Fonnesbeck C., 2016, PeerJ Computer

physical Journal, 750, 65

Science, 2, e55

Izotov Y. I., Thuan T. X., 2004, The Astrophysical Journal, 602,

Storey P. J., Hummer D. G., 1995, Monthly Notices of the Royal

200

Astronomical Society, 272, 41

Izotov Y. I., Thuan T. X., Stasi´nska G., 2007, The Astrophysical

Storey P. J., Zeippen C. J., 2000, Monthly Notices of the Royal

Journal, 662, 15

Astronomical Society, 312, 813

Izotov Y. I., Stasinska G., Guseva N. G., 2013, arXiv:1308.2100

Tak H., Ghosh S. K., Ellis J. A., 2018, Monthly Notices of the

[astro-ph]

Izotov Y. I., Thuan T. X., Guseva N. G., 2014, arXiv:1408.6953

[astro-ph]

Royal Astronomical Society, 481, 277

Tayal S. S., 2000, The Astrophysical Journal, 530, 1091
Tayal S. S., 2007, The Astrophysical Journal Supplement Series,

Johnson C. T., Kingston A. E., Dufton P. L., 1986, Monthly No-

171, 331

tices of the Royal Astronomical Society, 220, 155

Tayal S. S., 2011, The Astrophysical Journal Supplement Series,

Kaufman V., Sugar J., 1986, Journal of Physical and Chemical

195, 12

Reference Data, 15, 321

Tayal S. S., Zatsarinny O., 2010, The Astrophysical Journal Sup-

Lequeux J., Peimbert M., Rayo J. F., Serrano A., Torres-Peimbert

plement Series, 188, 32

S., 1979, Astronomy and Astrophysics, 80, 155

Li M.-H., Wang P., Chang Z., Zhao D., 2014, arXiv:1409.1354

[astro-ph, physics:hep-th]

Liu X.-W., Luo S.-G., Barlow M. J., Danziger I. J., Storey P. J.,
2001, Monthly Notices of the Royal Astronomical Society,
327, 141

Terlevich R., Melnick J., Masegosa J., Moles M., Copetti M. V. F.,
1991, Astronomy and Astrophysics Supplement Series, 91, 285
Terlevich R., Terlevich E., Bosch G., D´ıaz A., H¨agele G., Cardaci
M., Firpo V., 2014, Monthly Notices of the Royal Astronom-
ical Society, 445, 1449

The Theano Development Team et al., 2016, arXiv:1605.02688

Luridiana V., Morisset C., Shaw R. A., 2015, Astronomy and

[cs]

Astrophysics, 573, A42

Ucci G., Ferrara A., Pallottini A., Gallerani S., 2018, Monthly

Mendoza C., Zeippen C. J., 1982, Monthly Notices of the Royal

Notices of the Royal Astronomical Society, 477, 1484

Astronomical Society, 198, 127

Olive K. A., Skillman E. D., 2001, New Astronomy, 6, 119
Olive K. A., Skillman E. D., 2004, The Astrophysical Journal,

Vale Asari N., Stasi´nska G., Morisset C., Cid Fernandes R., 2016,
Monthly Notices of the Royal Astronomical Society, 460, 1739
Valerdi M., Peimbert A., Peimbert M., Sixtos A., 2019, arXiv

617, 29

e-prints, p. arXiv:1904.01594

Osterbrock D. E., Ferland G. J., 2005, Astrophysics of Gaseous

Wiese W. L., Fuhr J. R., Deters T. M., 1996, Atomic Transition

MNRAS 000, 1–18 (2015)

18

V. Fern´andez, E. Terlevich, A. I. D´ıaz, R. Terlevich

Probabilities of Carbon, Nitrogen, and Oxygen : A Critical
Data Compilation. Springer

Zeippen C. J., 1982, Monthly Notices of the Royal Astronomical

Society, 198, 111

APPENDIX A: EXTRA MATERIAL

This section includes the tabulated results for the galaxy
SHOC022 ﬁtting presented in the discussion, as well as the
atomic data references and their parametrisations.

This paper has been typeset from a TEX/LATEX ﬁle prepared by
the author.

MNRAS 000, 1–18 (2015)

A Bayesian direct method implementation

19

Table A1. SHOC022 ﬁtting results.

Parameter
Tl ow
ne
Thi gh
Ar 2+
N +
O+
O2+
S+
S2+
c(H β)
τ
y+
y2+
O I
H I
N I
H I
S I
H I
H e I
H I
YO
YS

F2018 value
11390
49.46
12170
5.736
6.238
7.966
7.972
5.767
6.419
0.1205
None
0.08388
0.001362
8.270
6.552
6.612
None
0.2532
0.2542

Mean
11590
37.04
12270
5.686
6.210
7.827
7.937
5.744
6.399
0.1229
1.075
0.08328
0.001340
8.192
6.575
6.486
0.08462
0.2521
0.2528

Standard deviation Number of points Median
11590
36.91
12280
5.684
6.208
7.822
7.933
5.742
6.398
0.1227
0.9978
0.08327
0.001339
8.188
6.571
6.485
0.08460
0.2520
0.2528

597.2
20.36
609.4
0.05484
0.05657
0.1275
0.06491
0.05402
0.05150
0.02568
0.4445
0.001974
0.0001416
0.06910
0.04346
0.05178
0.001979
0.004405
0.004418

12000
12000
12000
12000
12000
12000
12000
12000
12000
12000
12000
12000
12000
12000
12000
12000
12000
12000
12000

16t h percentile
11000
17.05
11660
5.632
6.153
7.699
7.874
5.690
6.347
0.09705
0.6639
0.08131
0.001200
8.124
6.533
6.434
0.08263
0.2477
0.2484

84t h percentile Diﬀerence %

12190
57.30
12880
5.741
6.266
7.953
8.001
5.797
6.451
0.1488
1.479
0.08521
0.001479
8.261
6.617
6.538
0.08656
0.2564
0.2572

1.703
-34.01
0.9137
-0.9107
-0.4898
-1.836
-0.4868
-0.4333
-0.3336
1.816
None
-0.7379
-1.764
-0.9948
0.2797
-1.954
None
-0.4633
-0.5568

Table A2. Atomic data references for the emission lines considered along with the parametrised relations.

Ion

H
He
He+
Ion
O+
S+
O+2
N +
S+2
S+3
Ar +2
Ar +3

Atomic data

Storey & Hummer (1995)
Porter et al. (2013)
Storey & Hummer (1995)

Collision Strengths

Transition probabilities

Pradhan et al. (2006); Tayal (2007)
Tayal & Zatsarinny (2010)
Aggarwal & Keenan (2000)
Tayal (2011)
Hudson et al. (2012)
Tayal (2000)
Galavis et al. (1995)
Ramsbottom & Bell (1997)

Zeippen (1982); Wiese et al. (1996)
Podobedova et al. (2009)
Storey & Zeippen (2000); Wiese et al. (1996)
Wiese et al. (1996); Galav´ıs et al. (1997)
Podobedova et al. (2009)
Dufton et al. (1982); Johnson et al. (1986)
Kaufman & Sugar (1986); Galavis et al. (1995)
Mendoza & Zeippen (1982)

Emissivity parametrisation
a + b · log (Te ) + c · log2 (Te )
(a + b · ne ) · log (te ) − log (c + d · ne )
a + b · log (te )
Emissivity parametrisation

a + b
Te

· log (Te ) + c · log (Te ) + log (1 + d · ne )

a + b · log (Te ) + c · log (Te )

Table A3. Emissivity parametrisation coeﬃcients for the relations given in Table A2. The Fitting precision for the HI, HeII and metal
emissivities is better than 1% for all the temperature and density ranges. In the HeI emissivities the precision decreases with up to a 5%
discrepancy in the ne and Te range of interest.

Line
4341 Hγ
4363 [OI I I ]
4471 HeI
4686 HeI I
4470 [Ar IV ]
4959 [OI I I ]
5007 [OI I I ]
5876 HeI
6312 [SI I I]
6548 [N I I]
6563 Hα
6583 [N I I]
6678 HeI
6717 [SI I ]
6731 [SI I ]
7136 [Ar I I I ]
7319 + 7330 [OI I]
9069 [SI I I]
9531 [SI I I ]

a
-0.846
4.97
0.0153
1.09
5.68
5.23
5.71
0.000
5.25
5.12
1.59
5.59
0.000637
6.29
6.14
5.90
4.84
5.47
5.86

b
0.230
-2.71
0.000383
-0.0630
-1.21
-1.26
-1.26
0.000791
-1.64
-0.906
-0.492
-0.906
0.000833
-0.924
-0.910
-0.820
-2.48
-0.675
-0.675

c
-0.0251
0.530
2.20
-
0.736
0.570
0.570
0.828
0.712
0.545
0.0522
0.545
2.93
0.423
0.399
0.506
0.459
0.584
0.584

d
-
-
0.000041
-
-
-
-
0.000052
-
-
-
-
0.000109
0.00002
0.0001
-
0.00021
-
-

MNRAS 000, 1–18 (2015)

20

V. Fern´andez, E. Terlevich, A. I. D´ıaz, R. Terlevich

Table A4. Fitting results for additional test cases with diﬀerent priors design described in the text.

Parameter True value

Tl ow
ne
S+
S2+
O+
O2+
Ar 2+
Ar 3+
N +
c(H β)
Thi gh
y+
y2+
τ

15590
500
5.48
6.36
7.80
8.05
5.72
5.06
5.84
0.100
16000
0.0850
0.00088
1.0

Test 5
15640 ± 283
493 ± 36
5.474 ± 0.020
6.354 ± 0.023
7.793 ± 0.037
8.048 ± 0.017
5.715 ± 0.020
5.058 ± 0.016
5.835 ± 0.020
0.106 ± 0.018
16020 ± 195
0.085 ± 0.001
0.00088 ± 0.00001
0.987 ± 0.228

Test 6
15580 ± 280
493 ± 36
5.478 ± 0.019
6.359 ± 0.022
7.802 ± 0.037
8.047 ± 0.017
5.719 ± 0.019
5.057 ± 0.016
5.839 ± 0.019
0.104 ± 0.018
16040 ± 198
0.085 ± 0.001
0.00088 ± 0.00002
0.990 ± 0.228

Test 7
15640 ± 281
489 ± 38
5.474 ± 0.020
6.354 ± 0.022
7.795 ± 0.037
8.049 ± 0.017
5.715 ± 0.019
5.059 ± 0.016
5.836 ± 0.019
0.106 ± 0.018
16010 ± 196
0.085 ± 0.001
0.00088 ± 0.00002
1.030 ± 0.281

Test 8
15630 ± 286
498 ± 38
5.476 ± 0.020
6.355 ± 0.023
7.794 ± 0.037
8.049 ± 0.017
5.716 ± 0.019
5.059 ± 0.015
5.836 ± 0.019
0.105 ± 0.018
16020 ± 191
0.085 ± 0.001
0.00088 ± 0.00002
0.972 ± 0.230

Test 9
15630 ± 282
497 ± 38
5.476 ± 0.020
6.355 ± 0.022
7.794 ± 0.037
8.049 ± 0.017
5.716 ± 0.020
5.059 ± 0.015
5.836 ± 0.019
0.105 ± 0.018
16020 ± 193
0.085 ± 0.001
00088 ± 00002
0.976 ± 0.228

MNRAS 000, 1–18 (2015)

